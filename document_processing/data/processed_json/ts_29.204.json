{
  "metadata": {
    "specification_id": "ts_29.204",
    "version": "18.0.0",
    "title": "3GPP TS 29.204",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29204-i00/29204-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:19:16.929227",
    "total_chunks": 22
  },
  "chunks": [
    {
      "chunk_id": "ts_29.204_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document provides functional description of the SS7 Security Gateway. The document covers also network architecture, routeing considerations, and protocol details.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies.  In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[2]\t3GPP TS 29.078: \"Customized Applications for Mobile network Enhanced Logic (CAMEL) Phase 4; CAMEL Application Part (CAP) specification\".\n[3]\tETSI ETS 300 358: \"ISDN Completion of Calls to Busy Subscriber (CCBS) supplementary service; Functional capabilities and information flows\".\n[4]\t3GPP TS 23.066: \"Support of GSM Mobile Number Portability (MNP) stage 2\".\n[5]\tITU-T Recommendation Q.773: \"Specifications of Signalling System No.7; Transaction capabilities formats and encoding\".\n[6]\t3GPP TS 33.200: \"3G Security; Network Domain Security (NDS); Mobile Application Part (MAP) application layer security\".\n[7]\tITU-T Recommendation E.164: \" The international public telecommunication numbering plan\".\n[8]\t3GPP TS 33.204: \"3G Security; Network Domain Security (NDS); Transaction Capabilities Application Part (TCAP)  user security\".\n[9]\tITU-T Recommendations Q.711 to Q.716 (07/96), White Book Signalling Connection Control Part (SCCP).\n[10]\t3GPP TS 21.905: \"Vocabulary for 3GPP Specifications\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.002",
        "ts_29.078",
        "ts_23.066",
        "ts_33.200",
        "ts_33.204",
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.204_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [10] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [10].\nTCAP user:\t\t\tApplication Part identified by one of the following SCCP Subsystem Numbers:\t\t\t\t\t\t\t0000 0110\t\tHLR (MAP)\t\t\t\t\t\t\t0000 0111\t\tVLR (MAP)\t\t\t\t\t\t\t0000 1000\t\tMSC (MAP)\t\t\t\t\t\t\t0000 1001\t\tEIR (MAP)\t\t\t\t\t\t\t0000 1010\t\tis allocated for evolution (possible Authentication Centre)\t\t\t\t\t\t\t1001 0001\t\tGMLC (MAP)\t\t\t\t\t\t\t1001 0010\t\tCAP\t\t\t\t\t\t\t1001 0011\t\tgsmSCF (MAP) or IM-SSF (MAP) or Presence Network Agent\t\t\t\t\t\t\t1001 0101\t\tSGSN (MAP)\t\t\t\t\t\t\t1001 0110\t\tGGSN (MAP)\t\t\t\t\t\t\t0000 1011\t\tSSAP",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.204_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the following abbreviations apply:\nCC\tCountry Code\nGSMA\tGlobal System for Mobile communications Association\nIV\tInitialisation Vector\nMAC\tMessage Authentication Code\nMNP\tMobile Number Portability\nMSISDN\tMobile Station International ISDN Number\nNDC\tNational Destination Code\nNE\tNetwork Entit\nPLMN\tPublic Land Mobile Network y\nRN\tRouteing Number\nSAD\tSecurity Association Database\nSEG\tSecurity Gateway\nSPD\tSecurity Policy Database\nSPI\tSecurity Parameter Index\nSRF\tSignalling Relay Functio\nTCAP\tTranscaction Capabilities Application Part\nUDT\tSCCP Unitdata message\nXUDT\tSCCP Extended Unitdata message n",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_4",
      "section_id": "4",
      "section_title": "Network architecture",
      "content": "In a PLMN that employs SS7 Security Gateways all TCAP user signalling messages entering or leaving the PLMN have to transit an SS7 Security Gateway which belongs to the PLMN and which performs the protection of leaving (i.e. outbound) messages and the protection checking and de-protection or blocking of entering (i.e. inbound) messages.\nOne or several SS7 Security Gateways may be employed within a PLMN.\nAn SS7 Security Gateway may be co-located with any TCAP user NE or it may stand alone. However, for the purpose of this document and without imposing any restrictions, it is assumed that the SS7 Security Gateways is a stand alone entity.\nIt is further assumed that the SS7 Security Gateways are located at the boarder of the PLMN i.e. inbound messages transit an SS7 Security Gateway before they reach any other node within the PLMN, and outbound messages transit an SS7 Security Gateway immediately before reaching a node outside the PLMN.\nSS7 routeing is not impacted by the SS7 Security Gateway Architecture. As a consequence SS7 Security Gateways are stateless at TCAP level: No TCAP dialogue states are maintained in the SS7 Security Gateway since the outbound dialogue request message may transit a different SS7 Security Gateway than the corresponding inbound dialogue response message; similarly the inbound dialogue request message may transit a different SS7 Security Gateway than the corresponding outbound dialogue response message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_4.1",
      "section_id": "4.1",
      "section_title": "Scenarios",
      "content": "SS7 Security Gateways perform protection, de-protection, blocking and unmodified passing of TCAP user messages depending on the scenario as described below:\nNote that scenarios 4.1.5, 4.1.6, 4.1.7, 4.1.8, and 4.1.9 are not applicable if all PLMN's TCAP user NEs are interconnected by PLMN internal signalling links and routing tables are set up not to allow these scenarios.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_4.1.1",
      "section_id": "4.1.1",
      "section_title": "Outbound traffic (not yet protected) from own to foreign NE",
      "content": "This scenario is shown in figure 4.1.1. The message is originated at a NE inside the PLMN. It may transit several transit nodes inside the PLMN before it reaches the SS7 Security Gateway. This SS7 Security Gateway protects the message according to the relevant Security Policy with the relevant Security Association. The message may then transit several nodes outside the PLMN (including an SS7 Security Gateway) before it reaches its destination.\nFigure 4.1.1: Outbound traffic (not yet protected) from own to foreign NE",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.2",
      "section_id": "4.1.2",
      "section_title": "Inbound traffic from foreign to own NE",
      "content": "This scenario is shown in figure 4.1.2. The message is originated at a NE outside the PLMN. It may transit several transit nodes (including an SS7 Security Gateway) outside the PLMN before it reaches the PLMN's SS7 Security Gateway. This SS7 Security Gateway checks whether the message is correctly protected according to the relevant security association. If it is not, the message is blocked (discarded), otherwise it is de-protected. To determine the relevant security association the fact that the message may have been relayed by an MNP-SRF in a transit network (see Clause 4.1.10 and 5.1.2) needs to be taken into account. After successful de-protection the message may then transit several nodes inside the PLMN before it reaches the TCAP user NE.\nFigure 4.1.2: Inbound traffic from foreign to own NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.10",
        "figure_4.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.3",
      "section_id": "4.1.3",
      "section_title": "Inbound transit traffic",
      "content": "This scenario is shown in figure 4.1.3. The message is originated at a NE outside the transit PLMN. It may transit several transit nodes outside the transit PLMN before it reaches the SS7 Security Gateway in inbound direction. This SS7 Security Gateway passes the message unmodified. The message may then transit several transit nodes inside the transit PLMN, another SS7 Security Gateway of the transit PLMN in outbound direction (see Clause 4.1.4), and several transit nodes outside the transit and destination PLMN (potentially including an SS7 Security Gateway) before it reaches the destination PLMN.\nNote: A PLMN operator may decide not to act as transit network for specific or all combinations of origin and destination. In this case the SS7 Security Gateway may block the inbound message.\nFigure 4.1.3: Inbound transit traffic",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.4",
        "figure_4.1.3"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.4",
      "section_id": "4.1.4",
      "section_title": "Outbound transit traffic (not relayed)",
      "content": "This scenario is shown in figure 4.1.4. The message is originated at a NE outside the transit PLMN. It may transit several transit nodes outside the transit PLMN (including an SS7 Security Gateway), an SS7 Security Gateway of the transit PLMN in inbound direction (see Clause 4.1.3), and several transit nodes inside the transit PLMN before it reaches the SS7 Security Gateway in outbound direction. This SS7 Security Gateway passes the message unmodified. The message may then transit several transit nodes outside the transit and destination PLMN (potentially including an SS7 Security Gateway) before it reaches the destination PLMN.\nFigure 4.1.4: Outbound transit traffic (not relayed)",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.3",
        "figure_4.1.4"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.5",
      "section_id": "4.1.5",
      "section_title": "Outbound traffic from own to own NE",
      "content": "This scenario is shown in figure 4.1.5. The message is originated at a NE inside the PLMN. It may transit several transit nodes inside the PLMN before it reaches the SS7 Security Gateway in outbound direction. This SS7 Security Gateway protects the message according to the relevant Security Association. The message may then transit several transit nodes outside the PLMN, another SS7 Security Gateway of the PLMN in inbound direction (see Clause 4.1.6) and several transit nodes within the PLMN before it reaches the destination NE inside the PLMN.\nFigure 4.1.5: Outbound traffic from own to own NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.6",
        "figure_4.1.5"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.6",
      "section_id": "4.1.6",
      "section_title": "Inbound traffic from own to own NE",
      "content": "This scenario is shown in figure 4.1.6. The message is originated at a NE inside the PLMN. It may transit several transit nodes inside the PLMN, an SS7 Security Gateway of the PLMN in outbound direction (see Clause 4.1.5), and several transit nodes outside the PLMN before it reaches the SS7 Security Gateway in inbound direction. This SS7 Security Gateway checks whether the message is correctly protected according to the relevant Security Association. If it is not, the message is blocked (discarded), otherwise it is de-protected. The message may then transit several transit nodes inside the PLMN before it reaches the destination NE inside the PLMN.\nFigure 4.1.6: Inbound traffic from own to own NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.5",
        "figure_4.1.6"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.7",
      "section_id": "4.1.7",
      "section_title": "Outbound traffic from foreign to own NE",
      "content": "This scenario is shown in figure 4.1.7. The message is originated at a NE outside the PLMN. It may transit several transit nodes outside the PLMN, an SS7 Security Gateway of the PLMN in inbound direction (see Clause 4.1.2), and several transit nodes inside the PLMN before it reaches the SS7 Security Gateway in outbound direction. This SS7 Security Gateway protects the message according to the reverse relevant Security Association. The message may then transit several transit nodes outside the PLMN, another SS7 Security Gateway of the PLMN in inbound direction (see Clause 4.1.2) and several transit nodes within the PLMN before it reaches the destination NE inside the PLMN.\nFigure 4.1.7: Outbound traffic from foreign to own NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.2",
        "figure_4.1.7"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.8",
      "section_id": "4.1.8",
      "section_title": "Inbound traffic from own to foreign NE",
      "content": "This scenario is shown in figure 4.1.8. The message is originated at a NE inside the PLMN. It may transit several transit nodes inside the PLMN, an SS7 Security Gateway of the PLMN in outbound direction (see Clause 4.1.1), and several transit nodes outside the PLMN before it reaches the SS7 Security Gateway in inbound direction. This SS7 Security Gateway checks whether the message is correctly protected according to the relevant security association. If it is not, the message is blocked (discarded); otherwise it is passed unmodified. The message may then transit several transit nodes inside the PLMN, another SS7 Security Gateway of the PLMN in outbound direction (see Clause 4.1.9) and several transit nodes outside the PLMN (including an SS7 Security Gateway) before it reaches the destination NE outside the PLMN.\nFigure 4.1.8: Inbound traffic from own to foreign NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.1",
        "clause_4.1.9",
        "figure_4.1.8"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.9",
      "section_id": "4.1.9",
      "section_title": "Outbound traffic (already protected) from own to foreign NE",
      "content": "This scenario is shown in figure 4.1.9. The message is originated at a NE inside the PLMN. It may transit several transit nodes inside the PLMN, an SS7 Security Gateway of the PLMN in outbound direction (see Clause 4.1.1), several transit nodes outside the PLMN, an SS7 Security Gateway of the PLMN in inbound direction (see Clause 4.1.8), and several transit nodes inside the PLMN before it reaches the SS7 Security Gateway. This SS7 Security Gateway passes the message unmodified. The message may then transit several transit nodes outside the PLMN (including an SS7 Security Gateway) before it reaches the destination NE outside the PLMN.\nFigure 4.1.9: Outbound traffic (already protected) from own to foreign NE",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.1",
        "clause_4.1.8",
        "figure_4.1.9"
      ]
    },
    {
      "chunk_id": "ts_29.204_4.1.10",
      "section_id": "4.1.10",
      "section_title": "Outbound transit traffic (relayed by SRF)",
      "content": "This scenario is shown in figure 4.1.10. The message (originally destined for the PLMN) is originated at a NE outside the transit PLMN. It may transit several transit nodes outside the transit PLMN (including an SS7 Security Gateway), an SS7 Security Gateway of the transit PLMN in inbound direction (see Clause 4.1.2), several transit nodes inside the transit PLMN, and an MNP-SRF which replaces the SCCP called party address of the message before it reaches the SS7 Security Gateway in outbound direction. This SS7 Security Gateway recognizes that the message was relayed by an SRF by analyzing the SCCP called party address and protects the message with the relevant Security Association. The message may then transit several transit nodes outside the transit and destination PLMN (potentially including an SS7 Security Gateway) before it reaches the destination PLMN.\nFigure 4.1.10: Outbound transit traffic (relayed by SRF)",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1.2",
        "figure_4.1.10"
      ]
    },
    {
      "chunk_id": "ts_29.204_5.1.1",
      "section_id": "5.1.1",
      "section_title": "General",
      "content": "With regard to TCAP user traffic the SS7 Security Gateway performs message protection, protection checking and de-protection, transparent passing, and blocking of messages depending on the message's origin (SCCP calling party address), the message's destination (SCCP called party address), and the message's direction (inbound or outbound) as shown in figure 5.1.1.\nFigure 5.1.1 Process SS7 Security Gateway (sheet 1 of 2)\nFigure 5.1.1 Process SS7 Security Gateway (sheet 2 of 2)\nFigure 5.1.2 Macro Check_Direction (sheet 1 of 1)\nFigure 5.1.3 Macro Inbound_own_to_own (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message is not protected\" takes the \"no\"-exit ifuser-information within the Dialogue Portion is identified by the object identifier ss7-ProtectedDialogueAS oroperationCode within an Invoke or ReturnResult Component takes the global value ss7-ProtectedDialogueAS  orerrorCode within an ReturnError Component takes the global value ss7-ProtectedDialogueAS.\nThe decision box \"message should be protected according to SPD\" takes the \"yes\"-exit if the message's SCCP calling party address identifies a PLMN for which an SPD entry for incoming messages exists.\nThe decision box \"fall back allowed according to SPD\" takes the \"yes\"-exit if the SPD entry for incoming messages is marked \"fall back allowed\".\nThe decision box \"calling party address consistent with SPI\" takes the \"yes\"-exit if the SPI within the message's Security Header points to an SA that was negotiated with the PLMN derived from the message's SCCP calling party address.\nThe decision box \"protection mode acceptable according to SPD\" takes the \"yes\"-exit if the protection mode within the message's Security Header is found in the SPD-entry for incoming messages.\nFigure 5.1.4 Macro Inbound_own_to_foreign (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message is not protected\" takes the \"no\"-exit ifuser-information within the Dialogue Portion is identified by the object identifier ss7-ProtectedDialogueAS  oroperationCode within an Invoke or ReturnResult Component takes the global value ss7-ProtectedDialogueAS  orerrorCode within an ReturnError Component takes the global value ss7-ProtectedDialogueAS.\nThe decision box \"message should be protected according to SPD\" takes the \"yes\"-exit if the message's SCCP called party address identifies a PLMN for which an SPD entry for outgoing messages exists.\nThe decision box \"fall back allowed according to SPD\" takes the \"yes\"-exit if the SPD entry for outgoing messages is marked \"fall back allowed\".\nThe decision box \"called party address consistent with SPI\" takes the \"yes\"-exit if the SPI within the message's Security Header points to an SA that was negotiated with the PLMN derived from the message's SCCP called party address.\nThe decision box \"protection mode correct\" takes the \"yes\"-exit if the presence/absence of octets 10 and 11 within the message's Security Header is consistent with the protection mode in the SPD-entry for outgoing messages. Note that octets 10 and 11 of the Security Header are only used to construct the IV which is not needed (and shall therefore be absent) if the protection mode is \"authenticity and integrity\".\nFigure 5.1.5 Macro Inbound_foreign_to_own (sheet 1 of 2)\nFigure 5.1.5 Macro Inbound_foreign_to_own (sheet 2 of 2)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message is not protected\" takes the \"no\"-exit ifuser-information within the Dialogue Portion is identified by the object identifier ss7-ProtectedDialogueAS  oroperationCode within an Invoke or ReturnResult Component takes the global value ss7-ProtectedDialogueAS  orerrorCode within an ReturnError Component takes the global value ss7-ProtectedDialogueAS.\nThe decision box \"relayed by SRF\" takes the \"yes\"-exit if the SCCP called party address consists of a Routing Number (RN) pointing to the own network and an MSISDN pointing to a relay network within the portability cluster.\nThe decision box \"message should be protected according to SPD (relay network)\" takes the \"yes\"-exit if an SPD entry for incoming messages exists for the relay network.\nThe decision box \"Fall Back allowed according to SPD (relay network)\" takes the \"yes\"-exit if the SPD entry for incoming messages (from the relay network) is marked \"fall back allowed\".\nThe decision box \"message should be protected according to SPD (orig. network)\" takes the \"yes\"-exit if the message's SCCP calling party address identifies a PLMN for which an SPD entry for incoming messages exists.\nThe decision box \"Fall Back allowed according to SPD (relay network)\" takes the \"yes\"-exit if the SPD entry for incoming messages (from the network identified by the SCCP calling party address) is marked \"fall back allowed\".\nThe decision box \"calling party address consistent with SPI\" takes the \"yes\"-exit if the SPI within the message's Security Header points to an SA that was negotiated with the PLMN derived from the message's SCCP calling party address.\nThe decision box \"protection mode acceptable according to SPD (relay network)\" takes the \"yes\"-exit if the presence/absence of octets 10 and 11 within the message's Security Header is consistent with a protection mode found in the SPD-entry (for incoming messages from the network identified by the SPI). Note that octets 10 and 11 of the Security Header are only used to construct the IV which is not needed (and shall therefore be absent) if the protection mode is \"authenticity and integrity\".\nThe decision box \"protection mode acceptable according to SPD (orig. network)\" takes the \"yes\"-exit if the presence/absence of octets 10 and 11 within the message's Security Header is consistent with a protection mode found in the SPD-entry (for incoming messages from the network identified by the SCCP calling party address). Note that octets 10 and 11 of the Security Header are only used to construct the IV which is not needed (and shall therefore be absent) if the protection mode is \"authenticity and integrity\".\nFigure 5.1.6 Macro Outbound_own_to_own (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message needs to be protected according to SPD\" takes the \"yes\"-exit if an SPD entry for outgoing messages exists (for messages sent to the own network).\nFigure 5.1.7 Macro Outbound_own_to_foreign (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message is protected\" takes the \"yes\"-exit ifuser-information within the Dialogue Portion is identified by the object identifier ss7-ProtectedDialogueAS  oroperationCode within an Invoke or ReturnResult Component takes the global value ss7-ProtectedDialogueAS  orerrorCode within an ReturnError Component takes the global value ss7-ProtectedDialogueAS.\nThe decision box \"message needs to be protected according to SPD\" takes the \"yes\"-exit if an SPD entry for outgoing messages exists (for messages sent to the network identified by the SCCP called party address).\nFigure 5.1.8 Macro Outbound_foreign _to_own (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message needs to be protected according to SPD\" takes the \"yes\"-exit if an SPD entry for incoming messages exists (for messages received from the network identified by the SCCP calling party address). If more than one acceptable protection modes are present, one may be chosen.\nThe task box \"protect message with reverse SA\" performs protection of the message with the SA that is to be used for de-protection when receiving messages from the network in question.\nFigure 5.1.9 Macro Outbound_foreign _to_foreign (sheet 1 of 1)\nThe decision box \"message contains protectable parameter\" takes the \"yes\"-exit if user-information is present in the Dialogue Portion, ora parameter is present in an Invoke or ReturnError Component, ora result is present in a ReturnResult Component.\nThe decision box \"message is protected\" takes the \"yes\"-exit ifuser-information within the Dialogue Portion is identified by the object identifier ss7-ProtectedDialogueAS  oroperationCode within an Invoke or ReturnResult Component takes the global value ss7-ProtectedDialogueAS  orerrorCode within an ReturnError Component takes the global value ss7-ProtectedDialogueAS.\nThe decision box \"relayed by SRF\" takes the \"yes\"-exit if the SCCP called party address consists of a Routing Number (RN) pointing to the own network and an MSISDN pointing to a relay network within the portability cluster.\nThe decision box \"message needs to be protected according to SPD takes the \"yes\"-exit if an SPD entry for outgoing messages exists (for messages sent to the network identified by the SCCP called party address).",
      "chunk_type": "definition",
      "cross_references": [
        "figure_5.1.1",
        "figure_5.1.2",
        "figure_5.1.3",
        "figure_5.1.4",
        "figure_5.1.5",
        "figure_5.1.6",
        "figure_5.1.7",
        "figure_5.1.8",
        "figure_5.1.9"
      ]
    },
    {
      "chunk_id": "ts_29.204_5.1.2",
      "section_id": "5.1.2",
      "section_title": "Interactions with Mobile Number Portability",
      "content": "In Mobile Number Portability scenarios (see 3GPP TS 23.066 [4]) a Signalling Relay Function (SRF) may relay SCCP traffic by modifying the SCCP called party address as shown in figure 4.1.10.\nA relayed message's SCCP called party address consists of a Routing Number (RN) and an MSISDN (see 3GPP TS 23.066 [4]).\nAn SS7 Security Gateway needs to recognize (by analyzing the SCCP called party address) whether or not a message was relayed in order to\na)\tdistinguish outbound transit traffic relayed by an SRF in the own network (which needs to be protected) from other outbound transit traffic (which needs to be passed transparently), and to\nb)\tdistinguish inbound terminating traffic relayed by an SRF within the portability cluster (where the check needs to be based on the policy identified by the MSISDN within the SCCP called party address) from other inbound terminating traffic (where the check needs to be based on the policy identified by the SCCP calling party address).\nNOTE :\tIn MNP-SRF scenarios, when the relaying PLMN does not make use of TCAP-User Security, messages sent from a source PLMN to a destination PLMN via the relaying PLMN are unprotected although protection may be desired for messages sent from the source PLMN to the destination PLMN. Network operators may therefore want to negotiate use of TCAP-User Security with all PLMNs of a portability cluster.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.1.10",
        "ts_23.066"
      ]
    },
    {
      "chunk_id": "ts_29.204_5.1.3",
      "section_id": "5.1.3",
      "section_title": "Interactions with SCCP segmentation",
      "content": "When the incoming SCCP message makes use of SCCP segmenting (i.e. several XUDT messages are received rather than one UDT or a single XUDT message) the SS7 Security Gateway has to perform reassembling before processing the message, and it may have to perform segmenting before sending the processed message.\nIt may happen that the received SCCP message (containing an unprotected TCAP user payload) is not segmented (UDT or single XUDT), but after security processing the message's length is increased, so that the processed message needs to be segmented before it is sent. This situation may be undesired (since transfer of XUDT messages is not guaranteed by all transit networks) but cannot be avoided by the SS7 Security Gateway (see note).\nNote:\tThe support of message segmentation at the SCCP layer in all transit networks could be enforced by mandating the usage of the White Book SCCP [9]. GSMA would work with International Carriers to ensure that fully operationally-verified support of XUDT is available before TCAPsec gateways are deployed.\nIt may also happen that the received (protected) message is segmented (several XUDTs), but after security processing the message's length is decreased, so that the processed message does not need to be segmented before it is sent. In this case the de-protecting SS7 Security Gateway needs to know some SCCP-details of the original unprotected message as sent from the originating NE to the protecting SS7 Security Gateway. These original SCCP information needs to be transported within the TCAP-user parameter of the protected message. Depending on this information the de-protecting SS7-Security Gateway can decide whether to send a UDT or a single XUDT message towards the destination. .\nIn cases where the received unprotected message is not segmented but the (to be) sent protected message needs to be segmented, the SS7 Security Gateway has to replace the message's SCCP calling party address with its own address. This is to guarantee uniqueness of the combination of the SCCP calling party address and the Segmentation local reference in the (to be) sent message. The original SCCP calling party address needs to be transported within the TCAP-user parameter of the (first segment of the) protected message.\nIf the received protected message contains an original SCCP calling party address within the TCAP-user parameter, the de-protecting SS7 Security Gateway has to replace the SCCP calling party address with the original SCCP calling party address before forwarding the de-protected message to the destination.\nAn SS7 Security Gateway that has sent a segmented, protected message with a replaced SCCP calling party address may receive an SCCP XUDTS message with its own address as called party address. In this case the SS7 Security Gateway shall retrieve the original SCCP calling party address, the original TCAP Message type and TCAP transaction id from the data parameter of the received XUDTS message and construct a UDTS message with unmodified Return cause, called party address replaced with the retrieved original calling party address, unmodified calling party address, and Data parameter containing the retrieved TCAP message type and TCAP transaction id, and forward it to the destination.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_5.1.4.1",
      "section_id": "5.1.4.1",
      "section_title": "Transformation of unprotected message to protected message",
      "content": "The unprotected TCAP-user message is either transported within an SCCP UDT message or it is transported within a single SCCP XUDT message or it is segmented over several SCCP XUDT messages. Other SCCP message types are not subject to protection.\nThe transformation process is done in 3 steps:\nStep 1: SCCP re-assembly of the unprotected message\nIn a first step the unprotected message is transformed into an intermediate unprotected representation which is made up of the following parameters:\nSCCP Message typeSCCP Protocol classSCCP Hop counter (optional)SCCP Called party addressSCCP Calling party addressSCCP Segmentation local reference (optional)SCCP Importance (optional)SCCP Data (made up of the following parameters:\tTCAP Message type\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTCAP orig. Transaction Id (optional)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTCAP dest. Transaction Id (optional)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTCAP Dialogue Portion (optional)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTCAP Component Portion (optional))\nIf the unprotected message was transported within an SCCP UDT message, the intermediate unprotected representation of the message takes the following values:\nSCCP Message type\t\t\t\t\t\t\t\t\t\tUDTSCCP Protocol class\t\t\t\t\t\t\t\t\t\tsame as in the received UDT messageSCCP Hop counter\t\t\t\t\t\t\t\t\t\tabsentSCCP Called party address\t\t\t\t\t\t\t\tsame as in the received UDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the received UDT messageSCCP Segmentation local reference\t\t\t\t\tabsentSCCP Importance\t\t\t\t\t\t\t\t\t\tabsentSCCP Data\t\t\t\t\t\t\t\t\t\t\t\tsame as in the received UDT message\nIf the unprotected message was transported within a single SCCP XUDT message, the intermediate unprotected representation of the message takes the following values:\nSCCP Message type\t\t\t\t\t\t\t\t\t\tXUDTSCCP Protocol class\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Hop counter\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT message SCCP Called party address\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Segmentation local reference\t\t\t\t\tabsentSCCP Importance\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Data\t\t\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT message\nIf the unprotected message was segmented over several SCCP XUDT messages, the intermediate unprotected representation of the message takes the following values:\nSCCP Message type\t\t\t\t\t\t\t\t\t\tXUDTSCCP Protocol class\t\t\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Hop counter\t\t\t\t\t\t\t\t\t\tsame as in the first received XUDT message SCCP Called party address\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Segmentation local reference\t\t\t\t\tsame as in the first received XUDT messageSCCP Importance\t\t\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Data\t\t\t\t\t\t\t\t\t\t\t\tconcatenation of the received segments (for details of the re-\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tassembly procedure see ITU-T Q.714 [9])\nStep 2: Protection\nIn a second step the intermediate unprotected representation is transformed into an intermediate protected representation which is made up of the following parameters:\nSCCP Hop counter (optional)SCCP Called party addressSCCP Calling party addressSCCP Segmentation local reference (optional)SCCP Importance (optional)Original SCCP info (made up of the following parameters:\tOriginal SCCP Calling party address (optional)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOriginal SCCP Message type\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tOriginal SCCP Protocol class)Original TCAP info (made up of the following parameters:\tOriginal TCAP Message type\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\totid (optional)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdtid (optional))TCAPsec Security headerTCAPsec Cipher- or CleartextTCAPsecMAC\nThe intermediate unprotected representation of the message takes the following values:\nSCCP Hop counter\t\t\t\t\t\t\t\t\t\t\t\t\tsame as SCCP Hop counter in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representationSCCP Called party address\t\t\t\t\t\t\t\t\t\t\tsame as in the intermediate unprotected representationSCCP Calling party address\t\t\t\t\t\t\t\t\t\t\tsame as in the intermediate unprotected representationSCCP Segmentation local reference\t\t\t\t\t\t\t\tsame as in the intermediate unprotected representationSCCP Importance\t\t\t\t\t\t\t\t\t\t\t\t\tsame as SCCP Importance in the intermediate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representationOriginal SCCP info made up of the following parameters:\tOriginal SCCP Message type\t\t\t\t\t\t\t\t\tsame as SCCP Message type in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representation\tOriginal SCCP Protocol class\t\t\t\t\t\t\t\t\tsame as SCCP Protocol class in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representationOriginal TCAP info made up of the following parameters:\tOriginal TCAP Message type\t\t\t\t\t\t\t\t\tsame as  TCAP Message type in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representation\tTCAP otid\t\t\t\t\t\t\t\t\t\t\t\t\t\tsame as TCAP orig. Transaction Id in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representation\tTCAP dtid\t\t\t\t\t\t\t\t\t\t\t\t\t\tsame as TCAP dest. Transaction Id in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunprotected representationTCAPsec Security header\t\t\t\t\t\t\t\t\t\t\tSee 3GPP TS 33.204 [8]TCAPsec Cipher- or Cleartext\t\t\t\t\t\t\t\t\t\tresult of applying the encryption function to the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcatenation of Dialogue Portion and Component \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tPortion  of the intermediate unprotected representation\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(ciphertext), or concatenation of Dialogue Portion and \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tComponent Portion of the intermediate unprotected \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trepresentation(cleartext)TCAPsec MAC\t\t\t\t\t\t\t\t\t\t\t\t\t\tresult of applying the integrity function to the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconcatenation of Security header and Cipher- or \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tCleartext of the intermediate protected representation.\nStep 3: SCCP segmentation of the protected message\nIn a third step the intermediate protected representation is transformed into a single SCCP UDT message, a single SCCP XUDT message, or several SCCP XUDT messages depending on the Original SCCP Message type of the intermediate protected representation and the need for segmentation as follows:\nIf the Original SCCP Message type in the intermediate protected representation takes the value \"UDT\" and the message need not be segmented, it is transformed into a single SCCP UDT message with following parameter values:\nMessage Type\t\t\t\t\tUDTProtocol class\t\t\t\t\t\tsame as Original SCCP Protocol class in the intermediate protected representationCalled party address\t\t\t\tsame as SCCP Called party address  in the intermediate protected representationCalling party address\t\t\t\tsame as SCCP Calling party address in the intermediate protected representationData\t\t\t\t\t\t\t\t(see below)\nIf the Original SCCP Message type in the intermediate protected representation takes the value \"XUDT\" and the message need not be segmented, it is transformed into a single SCCP XUDT message with following parameter values:\nMessage Type\t\t\t\t\tXUDTProtocol class\t\t\t\t\t\tsame as Original SCCP Protocol class in the intermediate protected representationHop counter\t\t\t\t\t\tsame as Original SCCP Hop counter in the intermediate protected representationCalled party address\t\t\t\tsame as SCCP Called party address  in the intermediate protected representationCalling party address\t\t\t\tsame as SCCP Calling party address in the intermediate protected representationData\t\t\t\t\t\t\t\t(see below)Segmentation\t\t\t\t\t\tabsentImportance\t\t\t\t\t\tsame as Original SCCP Importance in the intermediate protected representation\nIf the Original SCCP Message type in the intermediate protected representation takes the value \"UDT\" and the message needs to be segmented, it is transformed into several SCCP XUDT message with following parameter values:\nMessage Type\t\t\t\t\tXUDTProtocol class\t\t\t\t\t\tfirst segment: class 1 (in sequence delivery), return option: same as in Original SCCP\t\t\t\t\t\t\t\t\t\tProtocol class in the intermediate protected representation\t\t\t\t\t\t\t\t\tsubsequent segment: class 1 (in sequence delivery), return option: no special optionsHop counter\t\t\t\t\t\tabsentCalled party address\t\t\t\tsame as SCCP Called party address  in the intermediate protected representationCalling party address\t\t\t\tthe SS7 Security Gateway's own addressData\t\t\t\t\t\t\t\t(segment of see below)Segmentation\t\t\t\t\t\tsee [9]Importance\t\t\t\t\t\tabsent\nIf the Original SCCP Message type in the intermediate protected representation takes the value \"XUDT\" and the message needs to be segmented, it is transformed into several SCCP XUDT message with following parameter values:\nMessage Type\t\t\t\t\tXUDTProtocol class\t\t\t\t\t\tfirst segment: class 1 (in sequence delivery), return option: same as in Original SCCP\t\t\t\t\t\t\t\t\t\tProtocol class in the intermediate protected representation\t\t\t\t\t\t\t\t\tsubsequent segment: class 1 (in sequence delivery), return option: no special optionsHop counter\t\t\t\t\t\tsame as Original SCCP Hop counter in the intermediate protected representationCalled party address\t\t\t\tsame as SCCP Called party address  in the intermediate protected representationCalling party address\t\t\t\tif SCCP Segmentation Local reference is present in the intermediate protected\t\t\t\t\t\t\t\t\t\t\trepresentation: same as  SCCP Calling party address in the intermediate protected\t\t\t\t\t\t\t\t\t\trepresentation;\t\t\t\t\t\t\t\t\totherwise: the SS7 Security Gateway's own addressData\t\t\t\t\t\t\t\t(segment of see below)Segmentation\t\t\t\t\t\tsee [9]; if SCCP Segmentation Local reference is present in the intermediate protected\t\t\t\t\t\t\t\t\trepresentation, the same value shall be used.Importance\t\t\t\t\t\tsame as Original SCCP Importance in the intermediate protected representation.\nThe SCCP Data parameter (re-assembled) shall take the following value:\nTCAP Message type\t\t\tunidirectional\t\tTCAP DialoguePortion\t\tabsent\t\tTCAP ComponentPortion\tone invoke component with:\t\t\t\t\t\tinvokeId\t\t\t(any legal value)\t\t\t\t\t\tlinkedId\t\t\tabsent\t\t\t\t\t\toperationCode\tlocal value 90 (secureTransport)\t\t\t\t\t\tparameter\t\t\tANY DEFINED BY operationCode\n.$SS7-Secure-Transport-Operation-and-DataTypes {\nitu-t identified-organization (4) etsi (0) mobileDomain (0)\ngsm-Network (1) modules (3) ss7-Secure-Transport-Operation-and-DataTypes (27) version1 (1)}\nDEFINITIONS\nIMPLICIT TAGS\n::=\nBEGIN\nEXPORTS\nsecureTransport\n;\nIMPORTS\nOPERATION\nFROM Remote-Operations-Information-Objects {\njoint-iso-itu-t remote-operations(4)\ninformationObjects(5) version1(0)}\n;\nsecureTransport  OPERATION ::= {\nARGUMENT\nSecureTransportArg\nCODE\tlocal:90 }\nSecureTransportArg ::= SEQUENCE {\noriginalSCCP-Info\t[0] OriginalSCCP-Info\tOPTIONAL,\noriginalTCAP-Info\t[1] OriginalTCAP-Info,\nprotectedPayload\t[2] ProtectedPayload\n}\nOriginalSCCP-Info ::= SEQUENCE {\noriginalSCCP-MessageType\t[0] OriginalSCCP-MessageType\t\t\tOPTIONAL,\n-- original SCCP-MessageType shall be present if it is different from the actual\n-- SCCP-Message type; otherwise it may be absent\noriginalSCCP-ProtocolClass\t[1] OriginalSCCP-ProtocolClass\t\t\tOPTIONAL\n-- originalSCCP-ProtocolClass shall be present if it is different from the actual\n-- SCCP-Protocol class (first segment); otherwise it may be absent.\noriginalSCCP-CallingPartyAddress\t[2] OriginalSCCP-CallingPartyAddress\tOPTIONAL,\n-- originalSCCP-CallingPartyAddress shall be present if and only if the actual\n-- SCCP Calling party address is the SS7 Security Gateway's own address\n}\nOriginalSCCP-MessageType ::= ENUMERATED {\nudt  (9),\nxudt  (17) }\n-- this parameter shall take the value of the Original SCCP Message type from the\n-- intermediate protected representation\nOriginalSCCP-ProtocolClass ::= OCTET STRING(SIZE(1))\n-- coded according to ITU-T Q.713\nOriginalSCCP-CallingPartyAddress ::= OCTET STRING(SIZE(3..18))\n-- coded according to ITU-T Q.713\n-- Octet 1: Address indicator\n-- Octets 2 - n: Address\nOriginalTCAP-Info ::= SEQUENCE {\noriginalTCAP-MessageType\tOriginalTCAP-MessageType,\notid\t\t\tOTID\t\t\tOPTIONAL,\ndtid\t\t\tDTID\t\t\tOPTIONAL\n}\nOriginalTCAP-MessageType ::= ENUMERATED {\nunidirectional  (97),\nbegin  (98),\nend  (100),\ncontinue (101),\nabort (103)}\n-- this parameter shall take the value of the Original TCAP Message type from the\n-- intermediate protected representation\nOTID ::= OCTET STRING(SIZE(1..4))\n-- OTID shall take the value of the TCAP otid from the intermediate protected\n-- representation\nDTID ::= OCTET STRING(SIZE(1..4))\n-- DTID shall take the value of the TCAP dtid from the intermediate protected\n-- representation\nProtectedPayload ::= OCTET STRING(SIZE(13..3438))\n-- The protected payload is the concatenation of\n-- 9 or 11 octets SecurityHeader,\n-- n octets ciphertext or cleartext, and\n-- 4 octets MAC\n-- The SecurityHeader is coded as follows (see 3GPP TS 33.204 [8]):\n-- Octets 1-4: SPI\n-- Octets 5-8: TVP. The TVP is a 32 bit time stamp. Its value is binary coded\n--\t\t         and indicates the number of intervals of 100 milliseconds\n--\t\t         elapsed since 1st January 2002, 0:00:00 UTC\n-- Octet 9: Indicator Byte with bits 7-1 spare and bit 0 if set indicates presence of\n--\t\tOctets 10-11\n-- Octet 10: SS7 SEG-Id\n-- Octet 11: Prop\n.#END",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.204"
      ]
    },
    {
      "chunk_id": "ts_29.204_5.1.4.2",
      "section_id": "5.1.4.2",
      "section_title": "Transformation of protected message to unprotected message",
      "content": "The protected TCAP-user message is either transported within an SCCP UDT message or it is transported within a single SCCP XUDT message or it is segmented over several SCCP XUDT messages. Other SCCP message types are not subject to protection.\nThe transformation process is done in 3 steps:\nStep 1: SCCP re-assembly of the protected message\nIn a first step the protected message is transformed into the intermediate protected representation (see chapter 5.1.4.1):\nIf the protected message was transported within an SCCP UDT message, the intermediate protected representation of the message takes the following values:\nSCCP Hop counter\t\t\t\t\t\t\t\t\t\tabsentSCCP Called party address\t\t\t\t\t\t\t\tsame as in the received UDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the received UDT messageSCCP Segmentation local reference\t\t\t\t\tabsentSCCP Importance\t\t\t\t\t\t\t\t\t\tabsentOriginal SCCP info\t\t\tOriginal SCCP Calling party address\t\tabsent\t\t\tOriginal SCCP Message type\t\t\t\tUDT\t\t\tOriginal SCCP Protocol class\t\t\t\tsame as SCCP Protocol class in the received UDT messageOriginal TCAP info \t\t\tOriginal TCAP Message type\t\t\t\tsame as Original TCAP Message type in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received message\t\t\totid\t\t\t\t\t\t\t\t\t\t\tsame as otid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived message\t\t\tdtid\t\t\t\t\t\t\t\t\t\t\tsame as dtid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec Security header\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec Cipher- or Cleartext\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec MAC\t\t\t\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived message\nIf the protected message was transported within a single SCCP XUDT message, the intermediate protected representation of the message takes the following values:\nSCCP Hop counter\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Called party address\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the received XUDT messageSCCP Segmentation local reference\t\t\t\t\tabsentSCCP Importance\t\t\t\t\t\t\t\t\t\tsame as in the received XUDT messageOriginal SCCP info\t\t\tOriginal SCCP Calling party address\t\tabsent\t\t\tOriginal SCCP Message type\t\t\t\tsame as OriginalSCCP-MessageType in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received message\t\t\tOriginal SCCP Protocol class\t\t\t\tsame as OriginalSCCP-ProtocolClass in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received messageOriginal TCAP info \t\t\tOriginal TCAP Message type\t\t\t\tsame as Original TCAP Message type in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received message\t\t\totid\t\t\t\t\t\t\t\t\t\t\tsame as otid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived message\t\t\tdtid\t\t\t\t\t\t\t\t\t\t\tsame as dtid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec Security header\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec Cipher- or Cleartext\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived messageTCAPsec MAC\t\t\t\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived message\nIf the protected message was transported within several SCCP XUDT message, the intermediate protected representation of the message takes the following values:\nSCCP Hop counter\t\t\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Called party address\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Calling party address\t\t\t\t\t\t\t\tsame as in the first received XUDT messageSCCP Segmentation local reference\t\t\t\t\tsame as in the first received XUDT messageSCCP Importance\t\t\t\t\t\t\t\t\t\tsame as in the first received XUDT messageOriginal SCCP info\t\t\tOriginal SCCP Calling party address\t\tsame as OriginalSCCP-CallingPartyAddress in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received reassembled message\t\t\tOriginal SCCP Message type\t\t\t\tsame as OriginalSCCP-MessageType in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received reassembled message\t\t\tOriginal SCCP Protocol class\t\t\t\tsame as OriginalSCCP-ProtocolClass in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received reassembled messageOriginal TCAP info \t\t\tOriginal TCAP Message type\t\t\t\tsame as OriginalTCAP-MessageType in the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent parameter of the received reassembled message\t\t\totid\t\t\t\t\t\t\t\t\t\t\tsame as otid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived reassembled message\t\t\tdtid\t\t\t\t\t\t\t\t\t\t\tsame as dtid in the TCAP-invoke component parameter of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived reassembled messageTCAPsec Security header\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived reassembled messageTCAPsec Cipher- or Cleartext\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived reassembled messageTCAPsec MAC\t\t\t\t\t\t\t\t\t\t\tsame as received in the TCAP-invoke component parameter of the\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treceived reassembled message\nStep 2: De-Protection\nIn a second step the intermediate protected representation is transformed into an intermediate unprotected representation (see chapter 5.1.4.1):\nThe intermediate unprotected representation of the message takes the following values:\nSCCP Message type\t\t\t\t\t\t\t\t\t\t\tsame as OriginalSCCP-MessageType from the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent's parameter of the intermediate protected \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trepresentationSCCP Protocol class\t\t\t\t\t\t\t\t\t\t\tsame as OriginalSCCP-ProtocolClass from the TCAP-invoke \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomponent's parameter of the intermediate protected \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trepresentationSCCP Hop counter\t\t\t\t\t\t\t\t\t\t\tsame as SCCP Hop counter in the intermediate protected \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trepresentationSCCP Called party address\t\t\t\t\t\t\t\t\tsame as SCCP Called party address in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprotected representationSCCP Calling party address\t\t\t\t\t\t\t\t\tif OriginalSCCP-CallingPartyAddress is present in the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tintermediate protected representation, its value is taken; \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\totherwise same as SCCP Calling party address of the \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tintermediate protected representationSCCP Segmentation local reference\t\t\t\t\t\tif SCCP Message type in the intermediate unprotected \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trepresentation is XUDT, then same as in the intermediate\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprotected representation; otherwise absent.SCCP Importance\t\t\t\t\t\t\t\t\t\t\tsame as in the intermediate unprotected representationSCCP Data :\tTCAP Message type\t\t\t\t\t\t\t\t\t\tsame as OriginalTCAP-MessageType in the intermediate \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprotected representation\tTCAP orig. Transaction Id\t\t\t\t\t\t\t\tsame as otid in the intermediate protected representation\tTCAP dest. Transaction Id\t\t\t\t\t\t\t\tsame as dtid in the intermediate protected representation\tTCAP Dialogue Portion (optional)\t\t\t\t\t\tFirst part of the cleartext (as indicated by TAG and LENGTH \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taccording to BER). If encryption was applied then ciphertext \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tneeds to be converted first to cleartext\tTCAP Component Portion (optional))\t\t\t\t\tsecond part of the cleartext (as indicated by TAG and \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLENGTH\taccording to BER). If encryption was applied then \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tciphertext\tneeds to be converted first to cleartext\nStep 3: SCCP segmentation of the unprotected message\nIn a third step the intermediate unprotected representation is transformed into a single SCCP UDT message, a single SCCP XUDT message, or several SCCP XUDT messages depending on the SCCP Message type of the intermediate unprotected representation and the need for segmentation as follows:\nIf the SCCP Message type in the intermediate unprotected representation is \"UDT\", it is transformed into a single SCCP UDT message with following parameter values:\nMessage Type\t\t\t\t\tUDTProtocol class\t\t\t\t\t\tsame as SCCP Protocol class in the intermediate unprotected representationCalled party address\t\t\t\tsame as SCCP Called party address  in the intermediate unprotected representationCalling party address\t\t\t\tsame as SCCP Calling party address in the intermediate unprotected representationData\t\t\t\t\t\t\t\tsame as SCCP Data in the intermediate unprotected representation\nIf the SCCP Message type in the intermediate unprotected representation is \"XUDT\" and the message does not need to be segmented, it is transformed into a single SCCP XUDT message with following parameter values:\nMessage type\t\t\t\t\t\tXUDTProtocol class\t\t\t\t\t\tsame as SCCP Protocol class in the intermediate unprotected representationHop counter\t\t\t\t\t\tsame as SCCP Hop counter in the intermediate unprotected representationCalled party address\t\t\t\tsame as SCCP Called party address in the intermediate unprotected representationCalling party address\t\t\t\tsame as SCCP Calling party address in the intermediate unprotected representationData\t\t\t\t\t\t\t\tsame as SCCP Data in the intermediate unprotected representationSegmentation\t\t\t\t\tabsentImportance\t\t\t\t\t\tsame as SCCP Importance in the intermediate unprotected representation\nIf the SCCP Message type in the intermediate unprotected representation is \"XUDT\" and the message needs to be segmented, it is transformed into several SCCP XUDT message with following parameter values:\nMessage type (all segments)\t\t\t\t\t\tXUDTProtocol class (first segment)\t\t\t\t\tclass 1 (in sequence delivery), return option: same as in SCCP Protocol \t\t\t\t\t\t\t\t\t\t\t\t\tclass of the intermediate unprotected representation\t\t\t\t(subsequent segments)\t\t\tclass 1 (in sequence delivery), return option: no special optionsHop counter (all segments)\t\t\t\t\t\tsame as SCCP Hop counter in the intermediate unprotected representationCalled party address (all segments)\t\t\t\tsame as SCCP Called party address in the intermediate unprotected \t\t\t\t\t\t\t\t\t\t\t\t\trepresentationCalling party address (all segments)\t\t\tsame as SCCP Calling party address in the intermediate unprotected \t\t\t\t\t\t\t\t\t\t\t\t\trepresentationData\t\t\t\t\t\t\t\t\t\t\t\tsegment of SCCP Data from the intermediate unprotected representation\t\t\t\t\t\t\t\t\t\t\t\t\t(see ITU-T Q.714 [9])Segmentation\t\t\t\t\t\t\t\t\tsee [9]. Local reference shall be taken from the intermediate unprotected \t\t\t\t\t\t\t\t\t\t\t\t\trepresentation Importance (all segments)\t\t\t\t\t\tsame as SCCP Importance in the intermediate unprotected representation",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.204_5.1.4.3",
      "section_id": "5.1.4.3",
      "section_title": "Handling of received XUDTS messages and UDTS messages",
      "content": "An SS7 Security Gateway shall not try to re-assemble XUDTS messages, since the SCCP option \"return on error\" is not set for subsequent XUDT segments. As a consequence the SS7 Security Gateway shall not try to protect or de-protect XUDTS messages (fragments) or UDTS messages. However, special handling of XUDTS messages and UDTS messages is required as follows:\nOutbound direction\nInstead of re-assembling and protecting the XUDTS messages or protecting UDTS messages, the SS7 Security Gateway shall remove the TCAP Dialogue Portion and the TCAP Component Portion from the SCCP Data parameter before sending the XUDTS message or UDTS message. This is in order not to pass the cleartext (or fragment of the cleartext) in outbound direction. SCCP message type and addresses shall not be changed.\nAn example is shown in figure 5.1.4.3-1: A transit node in PLMN 2 cannot deliver the UDT message and therefore returns an UDTS message. SS7 Security Gateway 2 in PLMN 2 removes the cleartext (TCAP dialogue portion and TCAP component portion) from the SCCP data parameter. SS7 Security Gateway 1 in PLMN 1 recognizes that the received UDTS message does not contain a TCAP unidirectional message with a secure transport invoke component and therefore it does not modify the SCCP message.\nFigure 5.1.4.3-1: XUDTS messages and UDTS messages (Outbound direction)\nInbound direction\nInstead of re-assembling and de-protecting the XUDTS messages or de-protecting UDTS messages, the SS7 Security Gateway shall analyze the SCCP Called party address. If it matches with the SS7 Security Gateway's own address, it shall recover the OriginalSCCP-CallingPartyAddress from the (fragment in the) data parameter and replace the SCCP Called party address with the recovered value. In any case the SS7 Security Gateway shall recover and analyze the TCAP Message type from the (fragment in the) data parameter. If the recovered value is \"unidirectional\" and a invoke component with operation code \"secure transport\" is included, the SS7 Security Gateway shall recover the originalTCAP-MessageType, otid, and dtid from the OriginalTCAP-Info, replace the TCAP Message type with the original TCAP-MessageType, insert otid and dtid and remove the remaining material from the SCCP data parameter. If the received message is an XUDTS message and the original SCCP Message type was UDT then the SS7 Security shall modify the SCCP Message type to UDTS.\nAn example is shown in figure 5.1.4.3-2: A transit node in a transit network cannot deliver the XUDT messages and therefore returns an XUDTS message (note that the second XUDT does not have the SCCP return option set). SS7 Security Gateway 1 in PLMN 1 recognizes that the received XUDTS message does contain a TCAP unidirectional message with a secure transport invoke component and therefore, since the original SCCP-MessageType is UDT, modifies the SCCP Message type from XUDTS to UDTS. Furthermore, the TCAP MessageType is modified from unidirectional to the original TCAP-MessageType, the Transaction Ids are inserted, and the remaining material (fragment of the ciphertext) is removed.In addition the SS7 Security Gateway 1 in PLMN 1 recognizes that the received XUDTS message does contain SS7 Security Gateway 1's own address as SCCP Called party address and therefore replaces it with the original SCCPCalling party address.\nFigure 5.1.4.3-2: XUDTS messages and UDTS messages (inbound direction)\nAnnex A (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2006-06\nCT#32\nCP-060320\nApproved as version 7.0.0\n7.0.0\n2006-09\nCT#33\nCP-060413\n0001\nAddition of abbreviations and correction of a note\n7.1.0\n2008-12\nCT#42\nUpgraded unchanged from Rel-7\n8.0.0\n2009-12\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2011-03\n-\n-\n-\nUpdate to Rel-10 version (MCC)\n10.0.0\n2012-09\n-\n-\n-\nUpdate to Rel-11 version (MCC)\n11.0.0\n2014-09\n-\n-\n-\nUpdate to Rel-12 version (MCC)\n12.0.0\n2015-12\nCT#70\n-\n-\nUpdate to Rel-13 version (MCC)\n13.0.0\n2017-03\nCT#75\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2018-06\nCT#80\n-\n-\nUpdate to Rel-15 version (MCC)\n15.0.0\n2020-07\nCT#88e\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2022-04\n-\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_5.1.4.3-1",
        "figure_5.1.4.3-2"
      ]
    }
  ]
}