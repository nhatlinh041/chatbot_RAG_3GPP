{
  "metadata": {
    "specification_id": "ts_23.066",
    "version": "18.0.0",
    "title": "3GPP TS 23.066",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23066-i00/23066-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:44:59.170148",
    "total_chunks": 11
  },
  "chunks": [
    {
      "chunk_id": "ts_23.066_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document describes several alternatives for the realisation of Mobile Number Portability.\nThe present document includes information applicable to network operators, service providers, switch and database manufacturers and national regulators.\nIt is left to operator and implementation decisions which option, or combination of options, is used, taking into account the regulatory and architectural constraints that may prevail. The possible implications of these options on internal node functions and on signalling performance are not covered in the present document.\nNormative Annex A of the present document describes the technical realisation of the handling of calls to ported UMTS or GSM mobile subscribers using IN technology.\nNormative Annex C of the present document describes the technical realisation of the handling of calls to ported UMTS or GSM mobile subscribers using Signalling Relay technology.\nNormative Annex A and Normative Annex C describe alternative solutions. The network operator may choose the solution to be used in his network.\nNormative Annex B of the present document describes the technical realisation of the handling of non-call related SCCP signalling for ported UMTS or GSM mobile subscribers using Signalling Relay technology.\nThe present document does not specify the porting process.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.066_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or nonâ€‘specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies.  In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TSÂ 21.905: \"3G Vocabulary\".\n[2]\t3GPP TSÂ 22.066: \"Support of Mobile Number Portability (MNP); Service description. StageÂ 1\".\n[3]\t3GPP TSÂ 23.018: \"Basic call handling; Technical realisation\".\n[4]\tETSI ETS 300 009 (1991): \"Integrated Services Digital Network (ISDN); CCITT Signalling System No. 7 â€“ Signalling Connection Control Part (SCCP) [connectionless services] to support international interconnection\".\n[5]\tETSI ETS 300 374-1: \"Intelligent Network (IN); Intelligent Network Capability Set 1 (CS1); Core Intelligent Network Application Protocol (INAP); Part 1: protocol specification\".\n[6]\tITU-T Recommendation Q.769.1; ISDN User Part (ISUP); Enhancements for the support of Number Portability\".\n[7]\tETSI EN 300 356-2 V4.1: \"Integrated Services Digital Network (ISDN); Signalling System No.7; ISDN User Part (ISUP) version 4 for the international interface; Part 2: ISDN supplementary services [ITU-T Recommendation Q.730 modified]\".\n[8}\tCTIA report on Wireless Number Portability, Version 2.0.0.\n[9]\tANSI T1.660 â€“ 1998, American National Standards for Telecommunications â€“ Signaling System Number 7 â€“ NumberPortability Call Completion to a Portable Number.\n[10]\tANSI T1.111-1996, American National Standards for Telecommunication â€“ Signalling System No. 7 (SS7) Message Transfer Part (MTP).\n[11]\tANSI T1.112-1996, American National Standards for Telecommunication â€“ Signalling System No. 7 (SS7) Signalling Connection Control Part (SCCP).\nNote: Translation Types 10 and 14 will be published in the next revision of ANSI T1.112.\n[12]\tAmerican National Standard for Telecommunications â€“ Signalling System Number 7 (SS7) - ISDN User Part (ISUP) - ANSI T1.113-1995.\n[13]\tAmerican National Standard for Telecommunications - Signalling System Number 7 (SS7) â€“Transaction Capabilities Application Part (TCAP) - ANSI T1.114-1996.\n[14]\tETSI EN 302 097 V1.2: \"Integrated Services Digital Network (ISDN); Signalling System No.7; ISDN User Part (ISUP); Enhancements for support of Number Portability (NP)\".\n[15]\tTI - Technical Requirements No. 3, April 1999, Number Portability Database and Global Title Translation.\n[16]\t3GPP TS 23.096: \"Mobile Name Identification Supplementary Service â€“ Stage 2\".\n[17]\tNorth American Numbering Council (NANC) Functional Requirement Specification, Number Portability Administration Center- Service Management System (NPAC-SMS), Version 1.0, May 25, 1995; Version 2.0, June 2, 1997.\n[18]\t3GPP TSÂ 23.078: \"Customised Applications for Mobile network Enhanced Logic (CAMEL) Phase 4 â€“ Stage 2\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_22.066",
        "ts_23.018",
        "ts_23.096",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.066_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the following terms and definitions apply.\ndonor network: subscription network from which a number is ported in the porting process. This may or may not be the number range holder network\ninterrogating network entity: entity that submits a non-call related signalling message to interrogate the HLR\ninterrogating network: network in which the interrogating network entity resides\nmobile number portability: ability for a mobile subscriber to change  mobile network subscription  within the same country whilst retaining his/her original MSISDN(s). Additional regulatory constraints apply in North America.\nmobile number portability information: an information set relevant to Mobile Number Portability for a mobile subscriber. It may contain one or more of Routeing Number, generic IMSI MSISDN,and Number Portability Status.\nnetwork operator: GSM PLMN operator\nnon-call related signalling message: all signalling messages where the MSISDN is used to route the message on SCCP level except MAP SRI without OR parameter set (i.e. SRI_SMS, SRI for SOR, Send_IMSI, CCBS_Request etc)\nNorth American GSM Number portability: the ability for a subscriber to change subscription between North American GSM networks and other subscription networks within a regulated geographical area within North America.\nnumber portability database: operational database (used in real time at call set-up) which provides portability information\nnumber portability location register: internal MAP application terminating function (MATF) in the MNP-SRF network entity with an (unspecified) interface with a NPDB\nnumber portability status: information indicating the status of number portability for a mobile subscriber. It may be one of: own number ported out, own number not ported out, foreign number ported in, foreign number ported to a foreign network, foreign number not known to be ported\nnumber range holder network: network to which the number range containing the ported number has been allocated\noriginating network: network where the calling party is located\nportability domain: set of GSM PLMNs in a country between which MSISDNs may be ported or a set of North American GSM Mobile networks and other subscription networks within a regulated geographical area within North America\nportability network: a PLMN or ,in North America, a PSTN or an ISDN network\nportable number: E.164 number that can be ported between networks in one nation\nported number: portable number that has undergone the porting process\nported subscriber: subscriber of a ported number\nporting process: description of the transfer of a number between network operators\nrecipient network: network that receives the number in the porting process. This network becomes the subscription network when the porting process is complete\nrouteing number: routeing number is the data stored against the ported number or the non-ported number in the Number Portability Database. The routeing number points to Subscription Network or Recipient Network\nservice key: service Key can identify to the entity holding the Number Portability Database that the service logic for Mobile Number Portability should apply. The Service Key value for Mobile Number Portability is administered in the MSC, and is passed transparently to the entity holding the Number Portability Database\nservice provider: entity that offers service subscriptions to individual subscribers and contracts with a network operator to implement services for a specific MSISDN. A service provider may contract with more than one network operator\nservice provider portability: transfer of numbers between two unique Service Providers\nsubscription network: network with which the customer's Service Provider has a contract to implement the customer's services for a specific MSISDN\nNOTE:\tThe term \"recipient network\" is used during the porting process. The recipient network becomes the \"subscription network\" after the completion of the porting process.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.066_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the following abbreviations apply:\nCCBS\tCall Completion on Busy Subscriber\nCCF\tCall Completion Function\nCdPA\tCalled Party Address\nCgPA\tCalling Party Address\nCNAP\tCalling Name Presentation\nCNDB\tCalling Name Database\nCRMNP\tCall Related Mobile Number Portability\nFCI\tForward Call Indicator\nGAP\tGeneric Address Parameter\nGMSC\tGateway MSC\nGMSCB\tThe GMSC in HPLMNB\nGTT\tGlobal Title Translation\nHLR\tHome Location Register\nHPLMNB\tThe subscription network of the B subscriber\nIAM\tInitial Address Message\nIDP\tInitial Detection Point\nIE\tInformation Element\nINE\tInterrogating Network Entity\nIF\tInformation Flow\nIPLMN\tInterrogating PLMN\nMATF\tMAP application Terminating Function\nMNP\tMobile Number Portability\nMNP-SRF\tSignalling Relay Function for support of MNP\nMSA\tMobile Station of the A subscriber\nMSB\tMobile Station of the B subscriber\nMSC\tMobile-services Switching Centre\nMSISDN\tMobile Station International ISDN Number\nMSRN\tMobile Station Roaming Number\nNANP\tNorth American Numbering Plan\nNAGNP\tNorth American GSM Number Portability\nNPDB\tNumber Portability Database\nNPLMN\tThe number range holder network of the B subscriber\nNPLR\tNumber Portability Location Register\nOQoD\tOriginating call Query on Digit Analysis\nPLMN\tPublic Land Mobile Network\nQoHR\tQuery on HLR Release\nRN\tRouteing Number\nSMS\tShort Message Service\nSOR\tSupport of Optimal Routeing\nSRI\tSend Routeing Information\nSTP\tSignalling Transfer Point\nTQoD\tTerminating call Query on Digit Analysis\nTT\tTranslation Type\nVMSC\tThe Visited MSC\nVMSCB\tThe VMSC of the B subscriber\nFurther GSM related abbreviations are given in 3GPP TS 21.905: \"3G Vocabulary\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.066_4.1",
      "section_id": "4.1",
      "section_title": "Overview",
      "content": "Mobile Number Portability (MNP) is the ability for a UMTS or GSM mobile subscriber to change the subscription network within a portability domain whilst retaining her original MSISDN or MSISDNs.\nNorth American GSM Number Portability (NAGNP) is the ability for a subscriber to change subscription between North American GSM networks and other subscription networks within a regulated geographical area within North America.\nAs part of the porting process administrative actions have to be performed by the network operators of the number range holder network, donor network, recipient network and, as an option, by operators of other national UMTS or GSM networks as follows:\na)\tif the number range holder network is identical with the donor network:\nRecipient network:\nadd an entry in the HLR;add an entry in the Number Portability Database.\nDonor network:\nadd an entry in the Number Portability Database;delete the entry related to the ported MSISDNs in the HLR.\nOther networks in the portability domain:\nadd an entry in the Number Portability Database (if direct routeing is used).\nb)\tif the number range holder network is identical with the recipient network:\nRecipient network:\nadd an entry in the HLR;delete any entry related to the ported MSISDN in the Number Portability Database.\nDonor network:\ndelete any entry related to the ported MSISDN in the Number Portability Database;delete the entry related to the ported MSISDNs in the HLR.\nOther networks in the portability domain:\ndelete any entry related to the ported MSISDN in the Number Portability Database.\nc)\tif the number range holder network is different from both the recipient and the donor network:\nRecipient network:\nadd an entry in the HLR;add an entry in the Number Portability Database.\nNumber range holder network:\nupdate the Number Portability Database\nDonor network:\ndelete (or update) the entry in the Number Portability Database;delete the entry related to the ported MSISDNs in the HLR.\nOther networks in the portability domain:\nupdate the Number Portability Database (if an entry for the ported MSISDN exists).\nNote that the order of sequence for the administrative actions to be performed both within a network and by different network operators is significant with respect to prevention of disruption in service to the mobile subscriber and prevention of looping calls between networks during the porting process.\nTermination of a subscription for a ported number results in the deletion of any entry in an HLR and NPDB of that number.\nIf a call fails because databases are not correctly synchronised, the network entity that detects the inconsistency will raise an MNP specific alarm to the operation and maintenance subsystem.\nThe present document does not specify the porting process. It specifies the functionality needed to set-up calls to both ported and non ported subscribers including the functionality needed to query an NPDB for MNP information (in order to be able to charge correctly for CAMEL pre-paid calls and SMS) (Normative Annex A and Normative Annex C), and the functionality needed to relay non-call related signalling messages to the HLR in the subscription network (Normative Annex B) .",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.066_4.2",
      "section_id": "4.2",
      "section_title": "Compatibility",
      "content": "The IAM sent to the subscription network may contain additional routeing information. Within a portability domain the method how to convey the Routeing Number in the IAM between two portability networks shall be agreed upon by the two network operators involved (for an ITU-T ISUP solution see [6] and for an ANSI ISUP solution see [8] and [9]).\nIn general, IN-based and MNP-SRF (call-related) solutions are compatible and may coexist in the same portability domain. The only restriction refers to the case where the number range holder network relays call-related MAP messages (i.e. SRI for national calls) to the subscription network. If this solution is selected by at least one network operator within a portability domain, all the portability networks and transit networks affected must fulfil the following requirements:\n1.\tThe SCCP interfaces between networks in a portability domain must be agreed. This refers to the SCCP addressing mechanism being used (e.g. number lengths, natures of address and translation types for call-related MAP messages).For messages that do not cross network boundaries the SCCP addressing mechanism is a choice of the network operator.\n2.\tThe subscription network must be able to generate the SRI ack to allow the onward routeing of the call from the number range holder network to the subscription network.\nIn the rest of the possible architectures for MNP, no interworking problems have been identified. In these cases, network architectures used within one portability network (e.g. IN, MNP-SRF) are regarded as operator dependent.\nIn order to avoid loops and incompatibility situations, all the networks within a portability domain shall use the same routeing convention either direct routeing, indirect routeing or indirect routeing with reference to the Subscription network. As an alternative, indirect routeing can interwork successfully with direct routeing if the routeing number is transferred in the IAM or if dedicated traffic connections are used.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.066_4.3",
      "section_id": "4.3",
      "section_title": "Common Functionality of the MNP-SRF",
      "content": "In a PLMN that supports mobile number portability, SCCP messages sent to an HLR may be relayed by an MNP-SRF. Depending on the implemented solution (IN-based or MNP-SRF-based), on the type of message (call-related, non-call-related or MNP information request) and on the porting status of the called subscriber, the MNP-SRF may modify the SCCP called party address and route the message to a different HLR or to the subscription network, or terminate the dialogue and response to the INE.\nFigure 1 shows the general steering functionality for SCCP message routeing. It shows the SCCP routeing principle for mobile number portability within a network.\nNote that call related messages in the IN-based solution are not routed to the MNP-SRF. Therefore Normative Annex A of the present document does not mention the MNP-SRF.However, the usage of the IN-based solution for the call-related messages should allow operators to have the routeing of the non call-related messages determined in the same database. See [7] for the description of the access of the MNP-SRF (node with relay capability) to the NPDB (external database).\nIn order to guard against the possibility that the porting data for an MSISDN is inconsistent between PLMNs in a porting domain, the SCCP hop counter may be used to prevent indefinite looping of messages between PLMNs. The MNP-SRF would then decrement the SCCP hop counter for every message that is relayed. It should be noted that the use of the SCCP hop counter requires the use of non segmented SCCP XUDT messages as defined in ITU-T 1996 SCCP recommendations or in the ANSI T1.112-1996 SCCP recommendations for North America, reference [11].\nFigure 1: Steering Function for SCCP Message routeing\nFigure 2 shows the process MNP_SRF in the MNP-SRF. The procedures MNP_SRF_MATF_Call_Related, MNP_SRF_Non_Call_Related and MNP_SRF_MATF_Info_Request are described in Normative Annex C and Normative Annex B of the present document. Note that in networks which support the IN-based solution for call related signalling, a distinction on SCCP level for call related and non-call related messages is needed and that the MNP-SRF does not require to include MATF's since call related messages and MNP information request messages are not terminated at the MNP-SRF.\nThe test \"MNP info-request\" is a test on the SCCP Translation Type if a dedicated Translation Type value for MNP information request messages is used in the network. The handling of SCCP messages in the MNP-SRF in networks which do not make use of a dedicated Translation Type value for MNP information request messages is for further study.\nThe test \"call-related\" is a test on the SCCP Translation Type if a dedicated Translation Type value for call related messages is used in the network. The handling of SCCP messages in the MNP-SRF in networks which do not make use of a dedicated Translation Type value for call related messages is for further study.\nFigure 2: Process MNP_SRF",
      "chunk_type": "general",
      "cross_references": [
        "figure_1",
        "figure_2"
      ]
    },
    {
      "chunk_id": "ts_23.066_5",
      "section_id": "5",
      "section_title": "Common Architecture for call setup",
      "content": "Figure 3 shows the general architecture of a portability domain for routeing of calls. The more detailed architecture within the networks depends on the chosen solution (IN-based or MNP/SRF-based) and options and is described in Normative Annex A and Normative Annex C of the present document.\nThe architecture for non-call related signalling is described in Normative Annex B of the present document.\nFigure 3: General architecture of a portability domain for routeing of calls\nThe following routeing conventions are identified:\n1.\tDirect Routeing of calls is a PLMN option that allows to route calls directly from the PLMN supporting this option to the ported subscriber's subscription network.\n2.\tIndirect Routeing of calls is a PLMN option which allows to route calls from the PLMN supporting this option via the number range holder network to the ported subscriber's subscription network.\n3.\tIndirect Routeing of calls with reference to the subscription network is a PLMN option for PLMN operators having chosen the MNP-SRF solution for call related signalling described in Normative Annex C. If all PLMNs within a portability domain support this option, calls are routed from the originating network to the number range holder network. The number range holder network obtains onward routeing information from the subscription network and routes the call onward to the ported subscriber's subscription network.\nThe following action in the different networks can be identified:\n1.\tIf the call is originated outside the portability domain, the IAM (1) is received by the number range holder network.\n2a.\tIf the call is originated in another national network and the other national network does not support originating call query (i.e. Indirect Routeing of calls is applicable), the IAM (2) is received by the number range holder network.\n2b.\tIf the call is originated in another national network and the other national network supports originating call query (i.e. Direct Routeing of calls is applicable), the IAM (7) containing the routeing number is sent to the subscription network. If the routeing number is not used in the IAM sent from the national originating network to the subscription network, all transit networks involved are required to look up an NPDB in order to retrieve routeing information to route the call to the subscription network without looping.\n3a.\tIf the call is originated in the subscription network and the subscription network does not support originating call query (i.e. Indirect Routeing of calls is applicable), the IAM (3) is received by the number range holder network.\n3b.\tIf the call is originated in the subscription network and the subscription network supports originating call query (i.e. Direct Routeing of calls is applicable), it sends an IAM (8) containing the MSRN to the visited network of the called subscriber.\n3c.\tIf the subscription network receives IAM (6 or 7) containing the routeing number, it sends an IAM (8) containing the MSRN to the visited network of the called subscriber.\n4a.\tIf the call is routed via the number range holder network, and the number range holder network supports the MNP-SRF/MATF solution with the option 'MATF in subscription network' described in Normative Annex C of the present document (i.e. Indirect Routeing of calls with reference to the subscription network is applicable), the number range holder network sends SRI (4) to the subscription network. The subscription network returns SRI ack (5) containing the routeing number. The number range holder network then sends IAM (6) containing the routeing number to the subscription network. If the routeing number is not used in the IAM sent from the number range holder network to the subscription network, all transit networks involved are required to look up an NPDB in order to retrieve routeing information to route the call to the subscription network without looping.\n4b.\tIf the call is routed via the number range holder network, and the number range holder network supports the IN solution described in Normative Annex A of the present document or the MNP-SRF/MATF solution with the option 'MATF inside number range holder network' described in Normative Annex C of the present document, the number range holder network sends IAM (6) containing the routeing number to the subscription network.",
      "chunk_type": "general",
      "cross_references": [
        "figure_3"
      ]
    },
    {
      "chunk_id": "ts_23.066_6.1",
      "section_id": "6.1",
      "section_title": "Procedure MNP_MT_GMSC_Set_MNP_Parameters",
      "content": "The procedure MNP_MT_GMSC_Set_MNP_Parameters is shown in figure 4. It is called from the process MT_GMSC defined in 3G TS 23.018 [3].\nFigure 4: Procedure MNP_MT_GMSC_Set_MNP_Parameters",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_4",
        "ts_23.018_figure_4",
        "ts_23.018"
      ]
    },
    {
      "chunk_id": "ts_23.066_6.2",
      "section_id": "6.2",
      "section_title": "Procedure MNP_MT_GMSC_Check_MNP_Indicators",
      "content": "The procedure MNP_MT_GMSC_Check_MNP_Indicators is shown in figure 5. It is called from the process MT_GMSC defined in 3G TS 23.018 [3].\nFigure 5: Procedure MNP_MT_GMSC_Check_MNP_Indicators",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5",
        "ts_23.018_figure_5",
        "ts_23.018"
      ]
    },
    {
      "chunk_id": "ts_23.066_6.3",
      "section_id": "6.3",
      "section_title": "Procedure MNP_SRF_Check_MNP_Indicator",
      "content": "The procedure MNP_SRF_Check_MNP_Indicator is shown in figure 6. It is called from the procedures MNP_SRF_Non_Call_Related and MNP_SRF_MATF_Call_Related.\nFigure 6: Procedure MNP_SRF_Check_MNP_Indicator\nAnnex A (normative):IN Call-Related Technical Realisation\nA.1\tArchitecture\nA.1.1\tNetwork Options\nThere are two IN-based solutions for querying the NPDB :-\n-\tETSI Core INAP\n-\tANSI IN Query.\nThe following network operator options are defined for the MT calls in the GMSC:\n-\tTerminating call Query on Digit Analysis (TQoD);\n-\tQuery on HLR Release (QoHR).\nIn a GSM network that supports the IN-based approach for call related MNP, each GMSC shall support at least one of these options.\nThe following network operator option is defined for MO calls in VMSCA and for forwarded calls in the GMSC and VMSCB:\n-\tOriginating call Query on Digit Analysis (OQoD).\nIn a GSM network which supports the IN-based approach for call related MNP, it is a network operator decision, taking into account the regulatory and architectural constraints that may prevail, whether or not VMSCs and GMSCs support this option.\nThe use of OQoD in transit switches in a PLMN while avoiding multiple database interrogations is for further study.\nThe interworking between the CCF and the SSF for MNP is for further study.\nNote that for different number ranges different options may be chosen.\nAn IN-based solution for querying the NPDB may also be used by the gsmSCF in order to be able to apply different charging tariffs for CAMEL pre-paid subscribers' calls or short messages established/sent when roaming in their home PLMN and directed to ported and non-ported mobile subscribers, depending on whether or not the called and the calling subscriber subscribe to the same PLMN.\nA.1.2\tNo NP Query required â€“ Number is not subject for portability\nFigure A.1.2 shows the architecture for a call to a number that is not subject for portability. This can be for several reasons like for example:\n-\tthe national regulator has stipulated some number series as being non-portable or;\n-\tin an initial phase only a limited amount of subscribers might port in certain number blocks and some operators might want to treat the call routeing according to traditional routeing plans without any change.\nFigure A.1.2: Call to a non-ported number, no NP query required\n1\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the Number range holder network being the Subscription network.\n2\tWhen GMSCB receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the HLRB including the MSISDN in the request.\n3\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber currently is registered;\n4\tThe MSC/VLRB returns an MSRN back to the HLRB.\n5\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n6\tGMSCB uses the MSRN to route the call to VMSCB.\nA.1.3\tNP Query in Number Range Holder Network\nA.1.3.1\tTQoD â€“ Number is not ported\nFigure A.1.3.1 shows the architecture for a call where the Originating network has no knowledge whether the MSISDN is ported or not and uses the traditional routeing plans for routeing the call to the Number range holder network for further routeing decisions.\nFigure A.1.3.1: Call to a non-ported number using TQoD procedure\n1\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the Number range holder network being the Subscription network.\n2\tWhen GMSCB receives the ISUP IAM, it will send a database query to the NPDB as a result of analysis of the received MSISDN. The MSISDN is included in the query to the NPDB.\n3\tThe NPDB detects that the MSISDN is not ported and responds back to the GMSCB to continue the normal call setup procedure for MT calls.\n4\tThe GMSCB requests routeing information by submitting a MAP SRI to the HLRB, including the MSISDN in the request.\n5\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber owning the MSISDN currently is registered.\n6\tThe MSC/VLRB returns an MSRN back to the HLRB.\n7\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n8\tGMSCB uses the MSRN to route the call to VMSCB.\nNote that the NPDB may be outside the number range holder network if a shared NPDB is used.\nA.1.3.2\tTQoD â€“ Number is ported\nFigure A.1.3.2 shows the architecture for a call where the Originating network has no knowledge whether the MSISDN is ported or not and uses the traditional routeing plans for routeing the call to the Number range holder network for further routeing decisions.\nFigure A.1.3.2: Call to a ported number using TQoD procedure\n1\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the Number range holder network.\n2\tWhen GMSCA receives the ISUP IAM, it will send a database query, including the MSISDN, to the NPDB as a result of analysis of the received MSISDN.\n3\tThe NPDB detects that the MSISDN is ported and responds back to the GMSCA with a Routeing Number pointing out the Subscription network.\n4\tThe call is routed to the Subscription network based on the Routeing Number carried in ISUP IAM message; also the MSISDN is included in IAM.\n5\tThe GMSCB requests routeing information by submitting a MAP SRI to the HLRB, including the MSISDN in the request. The capability to route messages to the correct HLR is required.\n6\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber currently is registered.\n7\tThe MSC/VLRB returns an MSRN back to the HLRB.\n8\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n9\tGMSCB uses the MSRN to route the call to VMSCB.\nNote that the NPDB may be outside the number range holder network if a shared NPDB is used.\nA.1.3.3\tQoHR â€“ Number is ported\nFigure A.1.3.3 shows the architecture for a call where the Originating network has no knowledge whether the MSISDN is ported or not and uses the traditional routeing plans for routeing the call to the Number range holder network for further routeing decisions.\nFigure A.1.3.3: Call to a ported number using QoHR procedure\n1\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the Number range holder network.\n2\tWhen GMSCA receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the HLRA including the MSISDN in the request.\n3\tThe HLRA returns a MAP SRI ack with an \"Unknown Subscriber\" error since no record was found for the subscriber in the HLRA.\n4\tWhen GMSCA receives the error indication form the HLRA, this will trigger the sending of a database query to the NPDB, including the MSISDN in the query.\n5\tThe NPDB detects that the MSISDN is ported and responds back to the GMSCA with a Routeing Number pointing out the Subscription network.\n6\tThe call is routed to the Subscription network based on the Routeing Number carried in ISUP IAM message; also the MSISDN is included in IAM.\n7\tThe GMSCB requests routeing information by submitting a MAP SRI to the HLRB, including the MSISDN in the request. The capability to route messages to the correct HLR is required.\n8\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber currently is registered.\n9\tThe MSC/VLRB returns an MSRN back to the HLRB.\n10\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n11\tGMSCB uses the MSRN to route the call to VMSCB.\nNote that the NPDB may be outside the number range holder network if a shared NPDB is used.\nA.1.4\tNP Query in Originating Network\nA.1.4.1\tOQoD â€“ Number is not ported\nFigure A.1.4.1 shows the architecture for a call where already the Originating network has the knowledge whether the MSISDN is ported or not and can route the call directly to the Subscription network that in this case is the same as the Number range holder network.\nFigure A.1.4.1: Call to a non-ported number using OQoD procedure\n1\tA call is initiated by Mobile Subscriber A towards Mobile Subscriber B, using the MSISDN of the called subscriber.\n2\tWhen VMSCA receives the call setup indication, it will send a database query to the NPDB as a result of analysis of the received MSISDN, including the MSISDN in the query.\n3\tThe NPDB detects that the MSISDN is not ported and responds back to the VMSCA to continue the normal call setup procedure for MO calls. Depending on database configuration option, the NPDB could either return a Routeing Number on not ported calls, as done for ported calls, or the call is further routed using the MSISDN number only towards the Number range holder network.\n4\tThe call is routed to the Number range holder/Subscription network based on the MSISDN or Routeing Number carried in ISUP IAM message.\n5\tThe GMSCB requests routeing information by submitting a MAP SRI to the HLRB, including the MSISDN in the request.\n6\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber currently is registered.\n7\tThe MSC/VLRB returns an MSRN back to the HLRB.\n8\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n9\tGMSCB uses the MSRN to route the call to VMSCB.\nNote that the NPDB may be outside the national originating network if a shared NPDB is used.\nA.1.4.2\tOQoD â€“ Number is ported\nFigure A.1.4.2 shows the architecture for a call where already the Originating network has the knowledge that the MSISDN is ported and can route the call directly to the Subscription network without involving the Number range holder network.\nFigure A.1.4.2: Call to a ported number using OQoD procedure\n1\tA call is initiated by Mobile Subscriber A towards Mobile Subscriber B, using the MSISDN of the called subscriber.\n2\tWhen VMSCA receives the call setup indication, it will send a database query to the NPDB as a result of analysis of the received MSISDN including the MSISDN in the query.\n3\tThe NPDB detects that the MSISDN is ported and responds back to the VMSCA with a Routeing Number pointing out the Subscription network.\n4\tThe call is routed to the Subscription network based on the Routeing Number carried in ISUP IAM message; also the MSISDN is included in IAM.\n5\tThe GMSCB requests routeing information by submitting a MAP SRI to the HLRB, including the MSISDN in the request. The capability to route messages to the correct HLR is required.\n6\tThe HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber currently is registered.\n7\tThe MSC/VLRB returns an MSRN back to the HLRB.\n8\tThe HLRB responds to the GMSCB by sending an SRI ack with an MSRN.\n9\tGMSCB uses the MSRN to route the call to VMSCB.\nNote that the NPDB may be outside the national originating network if a shared NPDB is used.\nA.1.4.3\tIN-Query for CAMEL pre-paid service\nFigure A.1.4.3 shows the architecture for a call or MO-Short-Message originated by a CAMEL pre-paid subscriber while roaming in the Home PLMN where the gsmSCF needs to know whether or not calling and called subscriber subscribe to the same PLMN in order to apply the correct charging tariff.\nFigure A.1.4.3: IN-Query for pre-paid service\n1\tA call or short message is initiated by Mobile Subscriber A towards Mobile Subscriber B, using the MSISDN of the called subscriber.\n2\tWhen VMSCA receives the call setup indication, it will send a CAP IDP message to the gsmSCF. The IDP contains the called party's MSISDN.\n3\tIf the calling subscriber roams in her Home PLMN and the called subscriber's MSISDN indicates that the called subscriber subscribes to a PLMN within the calling subscriber's Home Country, the gsmSCF queries the NPDB based on the called party's MSISDN.Otherwise the tariff to be applied does not depend on the called subscriber's porting status and enough information to apply the correct tariff is available; go to 5.\n4\tThe NPDB returns a routing number to the gsmSCF pointing out the called subscriber's subscription network. Based on this information the gsmSCF applies the appropriate tariff for pre-paid subscriber A.\n5\tThe gsmSCF returns CAP AC and CAP CUE messages  to the VMSCA.\n6\tThe call or short message is set up.\nNote that the NPDB and gsmSCF may be integrated within one physical entity.\nA.2\tInformation flows\nIn the following figures the NPDB is shown as belonging to the Number range holder network or to the national originating network. However, the NPDB may be shared within one portability domain i.e. nation-wide.\nFigure A.2.1 shows the information flow for successful QoHR.\nNumber range holder network\nsubscription network\nvisited network\nGMSC\nHLR\nNPDB\nGMSC\nHLR\nVLR\nVMSC\nIAM\n----ðŸ¡ª\nSRI\n---ðŸ¡ª\nneg. result\nðŸ¡¨----\n\"query\"\n------------------------ðŸ¡ª\n\"routing\"\nðŸ¡¨------------------------\nIAM\n--------------------------------------------ðŸ¡ª\nSRI\n----ðŸ¡ª\nPRN\n----ðŸ¡ª\nPRN ack\nðŸ¡¨----\nSRI ack\nðŸ¡¨----\nIAM\n--------------------------------------------ðŸ¡ª\nFigure A.2.1\nFigure A.2.2 shows the information flow for unsuccessful QoHR (unallocated number).\nNumber range holder network\nGMSC\nHLR\nNPDB\nIAM\n-----------------ðŸ¡ª\nSRI\n----------------ðŸ¡ª\nnegative result\nðŸ¡¨----------------\n\"query\"\n--------------------------------------------------------------ðŸ¡ª\n\"result\"\nðŸ¡¨--------------------------------------------------------------\nREL\nðŸ¡¨----------------\nFigure A.2.2\nFigure A.2.3 shows the information flow for successful TQoD.\nNumber range holder network\nsubscription network\nvisited network\nGMSC\nHLR\nNPDB\nGMSC\nHLR\nVLR\nVMSC\nIAM\n----ðŸ¡ª\n\"query\"\n------------------------ðŸ¡ª\n\"routing\"\nðŸ¡¨------------------------\nIAM\n--------------------------------------------ðŸ¡ª\nSRI\n----ðŸ¡ª\nPRN\n----ðŸ¡ª\nPRN ack\nðŸ¡¨----\nSRI ack\nðŸ¡¨----\nIAM\n--------------------------------------------ðŸ¡ª\nFigure A.2.3\nFigure A.2.4 shows the information flow for unsuccessful TQoD (number not ported).\nNumber range holder network\nvisited network\nGMSC\nHLR\nNPDB\nVLR\nVMSC\nIAM\n-------ðŸ¡ª\n\"query\"\n-----------------------------------ðŸ¡ª\n\"result\"\nðŸ¡¨-----------------------------------\nSRI\n-------ðŸ¡ª\nPRN\n------------------------------------ðŸ¡ª\nPRN ack\nðŸ¡¨------------------------------------\nSRI ack\nðŸ¡¨-------\nIAM\n--------------------------------------------------------------------------------------------ðŸ¡ª\nFigure A.2.4\nFigure A.2.5 shows the information flow for successful OQoD (number ported).\nNational originating network A\nsubscription network B\nvisited network B\nVMSC\nNPDB\nGMSC\nHLR\nVLR\nVMSC\nSet-up\n-----ðŸ¡ª\n\"query\"\n------ðŸ¡ª\n\"routing\"\nðŸ¡¨-----\nIAM\n----------------------------ðŸ¡ª\nSRI\n-----ðŸ¡ª\nPRN\n-----ðŸ¡ª\nPRN ack\nðŸ¡¨-----\nSRI ack\nðŸ¡¨-----\nIAM\n-----------------------------------------------------ðŸ¡ª\nFigure A.2.5\nFigure A.2.6 shows the information flow for unsuccessful OQoD (number not ported in).\noriginating network\nNumber range holder network\nVMSCA\nNPDB\nGMSC\nSet-up\n----------------ðŸ¡ª\n\"query\"\n----------------ðŸ¡ª\n\"routing\"\nðŸ¡¨----------------\nIAM\n----------------------------------------------------------------ðŸ¡ª\ncontinue as shown in figures A.2.1, A.2.2, A.2.3 and A.2.4\nFigure A.2.6\nA.3\tFunctional requirements of network entities\nA.3.1\tFunctional requirement of GMSC\nA.3.1.1\tProcedure MOBILE_NUMBER_PORTABILITY_IN_QoHR\nThe procedure MOBILE_NUMBER_PORTABILITY_IN_QoHR is shown in figure A.1.3. It is called from the procedure Obtain_Routeing_Address defined in 3G TSÂ 23.018 [3].\nThe text in this clause is a supplement to the definition in the SDL diagrams; it does not duplicate the information in the SDL diagrams.\nThe query to NPDB contains the service key for MNP query and the called party's MSISDN.\nFigure A.3.1.1: Procedure MOBILE_NUMBER_PORTABILITY_IN_QoHR\nA.3.1.2\tProcedure MOBILE_NUMBER_PORTABILITY_IN_TQoD\nThe procedure MOBILE_NUMBER_PORTABILITY_IN_TQoD is shown in figure A.3.1.2. It is called from the procedure Obtain_Routeing_Address defined in 3G TSÂ 23.018 [3].\nThe text in this clause is a supplement to the definition in the SDL diagrams; it does not duplicate the information in the SDL diagrams.\nThe \"query\" to NPDB contains the service key for MNP query and the called party's MSISDN.\nFigure A.3.1.2: Procedure MOBILE_NUMBER_PORTABILITY_IN_TQoD\nA.3.2\tFunctional requirement of MSC\nA.3.2.1\tProcedure MOBILE_NUMBER_PORTABILITY_IN_OQoD\nThe procedure MOBILE_NUMBER_PORTABILITY_IN_OQoD is shown in figure A.3.2.1. It is called from the procedure Outgoing_Call_Setup_MSC and from the process MT_CF_MSC defined in 3G TSÂ 23.018 [3].\nThe text in this clause is a supplement to the definition in the SDL diagrams; it does not duplicate the information in the SDL diagrams.\nThe MSC may recognise own numbers as not being within the ported number range. For foreign numbers however, the MSC will not in general know whether the number is portable. The test \"called party number is a portable national MSISDN\" takes the \"yes\" exit if the number is a foreign national MSISDN or an own portable MSISDN.\nThe \"query\" to NPDB contains the service key for MNP query and the called party's MSISDN.\nFigure A.3.2.1: Procedure MOBILE_NUMBER_PORTABILITY_IN_OQoD\nA.3.3\tFunctional requirement of NPDB\nA.3.3.1\tProcess IN_QUERY_NPDB\nThe process IN_QUERY_NPDB is shown in figure A.3.3.1.\nFigure A.3.3.1: Process IN_QUERY_NPDB\nA.4\tContents of messages\nThis clause specifies the content of the following messages:\nOn the ISUP interface:\nIAM.\nOn the MSC - NPDB interface:\n\"query\";\n\"routing\";\n\"result\".\nMessages in the MSC â€“ NPDB interface are mapped into ETSI Core INAP or ANSI IN Query messages according to the protocols on this interface. This is listed in the following table:\nMessages in MSC-NPDB interface\nINAP messages\nANSI IN Query  messages\n\"query\"\nINITIAL DP\nProvideInstruction:Start\n\"routing\"\nCONNECT\nCONTINUE\nConnectionControl:Connect\n\"result\"\nCONTINUE\nRELEASE CALL\nConnectionControl:Connect\nIn the tables that follow, information elements are shown as mandatory (M), conditional (C) or optional (O). A mandatory information element shall always be present. A conditional information element shall be present if certain conditions are fulfilled; if those conditions are not fulfilled it shall be absent. An optional element may be present or absent, at the discretion of the application at the sending entity.\nA.4.1\tMessages on the ISUP interface\nA.4.1.1\tIAM for ETSI ISUP interface\nThis message is specified in [14]. It is necessary for the IAM to contain the information needed to route the call to the subscription network of the ported subscriber. The ways in which this may be coded are shown in [14].\nA.4.1.2\tIAM for ANSI ISUP interface\nThis message is specified in [8] and [9]. It is necessary for the IAM to contain the information needed to route the call to the subscription network of the ported subscriber. The ways in which this may be coded are shown in [8] and [9].\nA.4.2\tMessages on the MSC - NPDB interface\nA.4.2.1\tINITIAL DP\nThis message is specified in [5]. The following information elements are required:\nInformation element name\nRequired\nDescription\nService Key\nM\nIdentifies the requested IN service (MNP query)\nCalled Party Number\nM\nThe possibly ported MSISDN\nA.4.2.2\tINITIAL DP negative response\nThis message is specified in [5]. The negative response information element can take the following values:\n1.\tmissing parameter;\n2.\tunexpected data value;\n3.\tunexpected parameter;\n4.\tsystem failure.\nA.4.2.3\tCONNECT\nThis message is specified in [5]. It shall be ensured that the information in the Connect message shall be aligned with the coding supported in the ISUP signalling.\nA.4.2.4\tCONTINUE\nThis message is specified in [5]. This message does not contain any information element.\nA.4.2.5\tRELEASE CALL\nThis message is specified in [5]. The following information elements are required:\nInformation element name\nRequired\nDescription\nCause\nM\nIndicates the reason for releasing the call\nA.4.2.6\tProvideInstruction:Start\nParameter\nType\nNumber of Octets\nContents\nPackage Type Identifier\nM\n1\nQuery with Permission\nComponent Type Identifier\nM\n1\nInvoke (last)\nOperation Code Identifier\nM\n1\nNational TCAP\nOperation Code\nM\n2\nprovideInstruction:Start (reply required)\nService Key\nM\n11*\n10 digit called party number digits\nDigits (calling party number)\nM 1\n6-9\n3,6 or 10 ANI digits\nDigits (LATA)\nM 1\n6\nLATA ID\nOriginating Station Type\nM 1\n1\nBinary value of ANI II digits\nNote:\n*\t=\tValue specific for number portability\n1\t=\tThis mandatory parameter is required for the message but the content is not essential for number portability.\nA.4.2.7\tConnectionControl:Connect\nParameter\nType\nNumber of Octets\nContents\nPackage Type Identifier\nM\n1\nResponse\nComponent Type Identifier\nM\n1\nInvoke (last)\nOperation Code Identifier\nM\n1\nNational TCAP\nOperation Code\nM\n2\nconnectionControl:Connect (no reply required)\nDigits (Carrier)\nM 1\n6\n3 or 4 digit CIC\nDigits (Routing Number)\nM\n9*\n10 digit RN or Dialed Number\nBilling Indicators\nM 1\n4\nUnspecified\nNote:\n*\t=\tValue specific for number portability\n1\t=\tThis mandatory parameter is required for the message but the content is not essential for number portability.\nAnnex B (normative):Handling of Non-Call Related Signalling\nB.1\tHandling of Non-call Related Signalling\nB.1.1\tRouteing Conventions\nFigure B.1.1 illustrates the routeing of non-call related signalling messages between networks in a number portability environment.\nFigure B.1.1: Routeing of non-call related signalling messages in a number portability environment\nIf a non-call related signalling message is originated outside the portability domain, this message (1) is received by the number range holder network. The number range holder network routes the message (5) onward to the subscription network.\nIf a non-call related signalling message is originated in a network inside the portability domain and this network supports direct routeing, this message (3) is routed to the subscription network.\nIf a non-call related signalling message is originated in a network inside the portability domain and this network does not support direct routeing, the message (2, 4) is routed to the number range holder network. The number range holder network routes the message (5) onward to the subscription network. This is referred to as indirect routeing.\nB.1.2\tNetwork Architecture\nIn a PLMN that supports MNP, non-call related signalling messages as mentioned in clauseÂ B.1.1 are relayed by an MNP-Signalling Relay Function (MNP-SRF). The MNP-SRF provides re-routeing capability for signalling messages addressed using the MSISDN. The MNP-SRF obtains routeing information from the NP database to identify the subscription network associated with a particular national MSISDN. The interface between the MNP-SRF and the NP database is considered implementation dependent and is not detailed further. For further details see clause 4.3.\nFrom the perspective of the PLMN in which the MNP-SRF resides, the MSISDN in the CdPA represents either:\n1\tAn own number ported out.\n2\tAn own number not ported out.\n3\tA foreign number ported in.\n4\tA foreign number ported to a foreign network.\n5\tA foreign number not known to be ported.\nWhen a PLMN supports direct routeing (clause B.1.1), all non-call related signalling messages where the MSISDN in the CdPA belongs to a number range owned by a PLMN in the portability domain and all non-call related signalling messages which are relayed towards the network, are routed to the PLMN's MNP-SRF for treatment.\nIn case 2 and 3 the MNP-SRF relays the message to the Subscriber Database supporting the Network Service e.g. HLR and Calling Name Database.\nIn case 1, 4 and 5 the MNP-SRF relays the message to subscription network.\nWhen a PLMN does not support direct routeing, only non-call related signalling messages where the MSISDN in the CdPA belongs to a number range owned by the PLMN itself and all non-call related signalling messages which are relayed towards the network are routed to the PLMN's MNP-SRF for treatment. All other messages are routed to the number range holder network.\nFor this routeing convention, only cases 1, 2 and 3 are applicable:\nIn case 2 and 3 the MNP-SRF relays the message to the Subscriber Database supporting the Network Service e.g. HLR and Calling Name Database.\nIn case 1 the MNP-SRF relays the message to the subscription network.\nB.2\tSignalling Scenarios\nB.2.1\tNon-call Related Signalling Message for a Non-ported Number â€“ Indirect Routeing\nFigure B.2.1 shows the MNP-SRF operation for routeing a non-call related signalling message for a non-ported number where the interrogating network is inside the portability domain and indirect routeing is used or the interrogating network is outside the portability domain.\nFigure B.2.1: MNP-SRF operation for routeing a non-call related signalling message for a non-ported number where the interrogating network is inside the portability domain and indirect routeing is used or the interrogating network is outside the portability domain\nNOTE:\tthat the TT may have a different value, e.g. TT=17 in the case of CCBS Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message.\nThe Interrogating Network Entity (INE) submits a non-call related signalling message. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being non-ported using information that may be retrieved from an NP database. Figure B.2.1 shows an example where the MNP-SRF function then re-routes the message to HLRB.\nB.2.2\tNon-call Related Signalling Message for a Ported or Nonâ€‘ported Number â€“ Direct Routeing\nFigure B.2.2 shows the MNP-SRF operation for routeing a non-call related signalling message for a ported or non-ported number where the interrogating network supports direct routeing. If the interrogating network is the subscription network, MNP-SRFA and MNP-SRFB coincide; i.e. the signalling message passes the MNP-SRF only once.\nFigure B.2.2: MNP-SRF operation for routeing a non-call related signalling message for a ported or non-ported number where the interrogating network supports direct routeing\nNOTE 1: the TT may have a different value, e.g. TT=17 in the case of CCBS Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message .\nNOTE 2: the CdPA may have different values in the GT address and the nature of address fields.\nThe Interrogating Network Entity (INE) submits a non-call related signalling message. When MNP-SRFA receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the subscription network using information that may be retrieved from an NP database. The MNP-SRF function then modifies the CdPA according to the rules agreed for the portability domain and routes the message to MNP-SRFB in the subscription network.\nWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information that may be retrieved from an NP database. Figure B.2.2 shows an example where the MNP-SRF function then re-routes the message to HLRB.\nB.2.3\tNon-call Related Signalling Message for a Ported NumberÂ â€‘Â Indirect Routeing\nFigure B.2.3 shows the MNP-SRF operation for indirectly routeing (i.e. via the number range holder network) a non-call related signalling message for a ported subscriber.\nFigure B.2.3: MNP-SRF operation for indirectly routeing (i.e. via the number range holder network) a non-call related signalling message for a ported subscriber\nNOTE 1: the TT may have a different value, e.g. TT=17 in the case of CCBS Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message.\nNOTE 2: the CdPA may have different values in the GT address and the nature of address fields.\nThe Interrogating Network Entity (INE) submits a non-call related signalling message. This message is routed on MSISDN global title to MNP-SRFA in the number range holder network.\nWhen MNP-SRFA receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the subscription network using information that may be retrieved from an NP database. The MNP-SRF function then modifies the CdPA according to the rules agreed for the portability domain and routes the message to MNP-SRFB in the subscription network.\nWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information that may be retrieved from an NP database. Figure B.2.3 shows an example where the MNP-SRF function then re-routes the message to HLRB.\nB.3\tFunctional Requirements of Network Entities\nB.3.1\tProcedure MNP_SRF_Non_Call_Related\nFigure B.3.1 shows the procedure MNP_SRF_Non_Call_Related. This procedure handles non-call related signalling messages. It is called from the process MNP_SRF (see clause 4.3).\nThe check \"CdPA contains own number ported out?\" identifies all mobile numbers from number ranges allocated to the network the MNP-SRF is located in and which are ported to other networks. In this case the message is relayed to the subscription network.\nThe check \"CdPA contains own number not ported out?\" identifies all mobile numbers from the number ranges allocated to the network the MNP-SRF is located in and which are still served by the network the MNP-SRF is located in, i.e. the numbers are not ported out. In this case the message is relayed to the HLR in the network.\nThe check \"CdPA contains foreign number ported in?\" identifies all mobile numbers from the number ranges not allocated to the network the MNP-SRF is located in and which are served by the network the MNP-SRF is located in, i.e. the numbers are ported in. In this case the message is relayed to the HLR in the network.\nThe check \"CdPA contains foreign number ported to a foreign network?\" identifies all mobile numbers from the number ranges not allocated to the network the MNP-SRF is located in and which are not served by the MNP-SRF is located in and not served by the network the number range is allocated to, i.e. the numbers are ported to a foreign network. In this case the message is relayed to the subscription network.\nThe remaining numbers \"CdPA contains number not known to be ported ?\" are mobile numbers from the number ranges not allocated to the network the MNP-SRF is located in and which are also not served by the network the MNP-SRF is located in. In this case the message is relayed to the number range holder network.\nFigure B.3.1: Procedure MNP_SRF_Non_Call_Related\nB.4\tSignalling Scenarios (informative)\nThis (informative) clause contains examples of signalling scenarios.\nB.4.1\tDelivery of SMS to a Non-ported Number â€“ Direct Routeing â€“ MNP-SRF acts as SCCP Relay\nFigure B.4.1 shows the MNP-SRF operation for delivering an SMS message to a non-ported number.\nFigure B.4.1: SRF operation for delivering an SMS message to a non-ported number where the SRI_for_SM message is submitted by a national interrogating network\n1.\tThe SMSC forwards a SM to the SMS-GMSC via a proprietary interface.\n2.\tThe SMS-GMSC generates a routeing enquiry for SM delivery. The MAP SRI_for_SM message is routed to the network's MNP-SRF.\n3.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being non-ported using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n4.\tHLRB responds to the routeing enquiry by sending back an SRI_for_SM ack with the address of the VMSC.\n5.\tThe SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS message.\n6.\tVMSCB further delivers the message to MSB.\nB.4.2\tDelivery of SMS to a Non-ported Number - Direct RouteingÂ â€“ MNP-SRF acts as Higher-level Relay\nFigure B.4.2 shows the MNP-SRF operation for delivering an SMS message to a non-ported number where the SRI_for_SM message is submitted by a national interrogating network. For further details of the higher level relay function (e.g. TC relay), the reader is referred to [7].\nFigure B.4.2: SRF operation for delivering an SMS message to a non-ported number where the SRI_for_SM message is submitted by a national interrogating network\n1.\tThe SMSC forwards a SM to the SMS-GMSC via a proprietary interface.\n2.\tThe SMS-GMSC generates a routeing enquiry for SM delivery. The MAP SRI_for_SM message is routed to the network's MNP-SRF.\n3.\tWhen MNP-SRFB receives the message it terminates the TCAP dialogue and an MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the TCAP portion of the message and identifies the MSISDN as being non-ported using information which may be retrieved from an NP database. The MNP-SRF function then initiates a new dialogue and routes the message to HLRB.\n4.\tHLRB responds to the routeing enquiry by sending back an SRI_for_SM ack with the address of the VMSC.\n5.\tMNP-SRFB responds to the routeing enquiry by sending back an SRI_for_SM ack with the address of the VMSC to the SMS-GMSCA.\n6.\tThe SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS message.\n7.\tVMSCB further delivers the message to MSB.\nB.4.3\tDelivery of SMS to a Ported Number â€“ Indirect Routeing\nFigure B.4.3 shows the MNP-SRF operation for delivering an SMS message to a ported number where the interrogating network does not support direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRF(s). If the MNP-SRF(s) use(s) a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.3: SRF operation for delivering an SMS message to a ported number where the interrogating network does not support direct routeing\n1.\tThe SMSC forwards a SM to the SMS-GMSC via a proprietary interface.\n2.\tThe SMS-GMSC generates a routeing enquiry for SM delivery. The MAP SRI_for_SM message is routed to the number range holder network's MNP-SRF.\n3.\tWhen MNP-SRFB' receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported using information which may be retrieved from an NP database. As the message is non-call related, the MNP-SRF function then populates the CdPA with either a routeing number or a concatenation of a routeing number and MSISDN. After modifying the CdPA, the message is routed to MNP-SRFB in the subscription network.\n4.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n5.\tHLRB responds to the routeing enquiry by sending back an SRI_for_SM ack with the address of the VMSC.\n6.\tThe SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS message.\n7.\tVMSCB further delivers the message to MSB.\nB.4.4\tDelivery of SMS to a Ported Number â€“ Direct Routeing\nFigure B.4.4 shows the MNP-SRF operation for delivering an SMS message to a ported number where the interrogating network supports direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.4: SRF operation for delivering an SMS message to a ported number where the interrogating network supports direct routeing\n1.\tThe SMSC forwards a SM to the SMS-GMSC via a proprietary interface.\n2.\tThe SMS-GMSC generates a routeing enquiry for SM delivery. The MAP SRI_for_SM message is routed to the network's MNP-SRF.\n3.\tWhen MNP-SRFA receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported using information which may be retrieved from an NP database. As the message is non-call related, the MNP-SRF function then populates the CdPA with either a routeing number or a concatenation of a routeing number and MSISDN. After modifying the CdPA, the message is routed to MNP-SRFB in the subscription network.\n4.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n5.\tHLRB responds to the routeing enquiry by sending back an SRI_for_SM ack with the address of the VMSC.\n6.\tThe SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS message.\n7.\tVMSCB further delivers the message to MSB.\nB.4.5\tInternational SOR for a Non-ported Number\nFigure B.4.5 shows the MNP-SRF operation for optimally routeing an international call to a non-ported number.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRF. If the MNP-SRF uses a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.5: SRF operation for optimally routeing an international call to a non-ported number\n1.\tMSA originates a call to MSISDN.\n2.\tVMSCA routes the call to the originating network's GMSCA.\n3.\tWhen GMSCA receives the ISUP IAM, it requests routeing information by submitting a MAP SRI with SOR parameter set to the number range holder network of the dialled MSISDN. Within the number range holder network, the message is routed to the network's MNP-SRF.\n4.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being non-ported using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n5.\tWhen HLRB receives the SRI, it responds to the GMSCA by sending back an SRI ack with a MSRN.\n6.\tGMSCA uses the MSRN to route the call to VMSCB.\n7.\tVMSCB further establishes a traffic channel to MSB.\nB.4.6\tSOR for a Ported Number â€“ Indirect Routeing\nFigure B.4.6 shows the MNP-SRF operation for optimally routeing a call (using SOR) to a ported number where the interrogating network does not support direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.6: MNP-SRF operation for optimally routeing a call (using SOR) to a ported number where the interrogating network does not support direct routeing\n1.\tMSA originates a call to MSISDN.\n2.\tVMSCA routes the call to the network's GMSCA.\n3.\tWhen GMSCA receives the ISUP IAM, it requests routeing information by submitting a MAP SRI with SOR parameter set to the number range holder network of the dialled MSISDN. Within the number range holder network, the message is routed to the network's MNP-SRF.\n4.\tWhen MNP-SRFB' receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported using information which may be retrieved from an NP database. As the message is non-call related, the MNP-SRF function then populates the CdPA with either a routeing number or a concatenation of a routeing number and MSISDN. After modifying the CdPA, the message is routed to MNP-SRFB in the subscription network.\n5.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n6.\tWhen HLRB receives the SRI, it responds to the GMSCA by sending back an SRI ack with a MSRN.\n7.\tGMSCA uses the MSRN to route the call to VMSCB.\n8.\tVMSCB further establishes a traffic channel to MSB.\nB.4.7\tAny Time Interrogation for a Ported Number â€“ Indirect Routeing\nFigure B.4.7 shows the MNP-SRF operation for routeing an Any_Time_Interrogation message for a ported number where the interrogating network does not support direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.7: MNP-SRF operation for routeing an Any_Time_Interrogation message for a ported number where the interrogating network does not support direct routeing\n1.\tThe gsmSCF generates an Any_Time_Interrogation (ATI) message. The message is routed to the number range holder network's MNP-SRF.\n2.\tWhen MNP-SRFB' receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported using information which may be retrieved from an NP database. As the message is non-call related, the MNP-SRF function then populates the CdPA with either a routeing number or a concatenation of a routeing number and MSISDN. After modifying the CdPA, the message is routed to MNP-SRFB in the subscription network.\n3.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n4.\tHLRB responds to the ATI by sending back an ATI ack with the requested information.\nB.4.8\tAny Time Interrogation for a Ported Number â€“ Direct Routeing\nFigure B.4.8 shows the MNP-SRF operation for routeing an Any_Time_Interrogation message for a ported number where the interrogating network supports direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRF. If the MNP-SRF uses a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.8: MNP-SRF operation for routeing an Any_Time_Interrogation message for a ported number where the interrogating network supports direct routeing\n1.\tThe gsmSCF generates an Any_Time_Interrogation (ATI) message. The message is routed to the network's MNP-SRF.\n2.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n3.\tHLRB responds to the ATI by sending back an ATI ack with the requested information.\nB.4.9\tCCBS where the Busy Subscriber is a Ported SubscriberÂ â€‘Â Direct Routeing\nFigure B.4.9 shows the MNP-SRF operation for routeing a CCBS Request for a ported number where the interrogating network supports direct routeing.\nThe message flows for this scenario are based on the use of an SCCP-relay function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function (e.g. TC-relay), then the response message will go via the MNP-SRF as shown in B.4.2. For further details of the signalling relay functions, the reader is referred to [7].\nFigure B.4.9: MNP-SRF operation for routeing a CCBS Request for a ported number where the interrogating network supports direct routeing\n1.\tThe VMSCA receives a ISUP Release message with cause value 'subscriber busy' from VMSCB.\n2.\tVLRA/VMSCA sends a Register_CC_Entry to HLRA using the HLRA address as CdPA on SCCP.\n3.\tThe HLRA sends a CCBS Request message to the networks MNP-SRFA.\n4.\tWhen MNP-SRFA receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported using information which may be retrieved from an NP database. As the message is non-call related, the MNP-SRF function then populates the CdPA with either a routeing number or a concatenation of a routeing number and MSISDN. After modifying the CdPA, the message is routed to MNP-SRFB in the subscription network.\n5.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n6.\tHLRB can now respond to HLRA by sending back a CCBS ack message.\nB.4.10\tCalling Name Presentation Flows â€“ MNP-SRF acts as SCCP Relay\nFigure B.4.10 shows the MNP-SRF operation for delivering an CNAP message to an ANSI Calling Name Database.\nFigure B.4.10: SRF operation for delivering an CNAP message to the CNDB\n1.\tAn incoming call ( an Initial Address message with Generic Name parameter set to \"presentation allowed\"  is received at a MSC. The MSC inteerogates the VLR to determine if the called party is subscribed to the CNAP service. The VLR Response indicates that the called party is subscribed to CNAP;\n2.\tThe MSC generates a TCAP message \"Query With Permission\". The Query With Permission message is routed to the network's MNP-SRF;\n3.\tWhen MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies which CNDB the MSISDN is populated using information which may be retrieved from an NP database. The MNP-SRF function then populates the CdPA with an CNDB address. After modifying the CdPA, the message is routed to CNDB;\n4.\tCNDB responds to the routeing enquiry by sending back a Query With Permission ack with the address of the MSC. The MSC can now deliver the Calling Name to the terminating subscriber .\nAnnex C (normative):MNP Signalling Relay Function - Call Related Signalling\nC.1\tHandling of Call Related Signalling\nThe  MAP messages affected by MNP are the MAP_SEND_ROUTING_INFORMATION (SRI) message without OR parameter set sent to the HLR and the MAP_ANY_TIME_INTERROGATION (ATI) message with parameter MNP-requestedInfo present terminated in the MNP-SRF.\nIn a PLMN supporting MNP with direct routeing using signalling relay, all incoming calls and calls originated in the network for which the called party number is within the ranges owned by any network in the portability domain, the gateway MSCs will send an SRI such that it will be handled by the MNP-SRF in that network.\nIn a PLMN supporting MNP with direct routeing, where the called party number is within the ranges owned by any network in the portability domain, the INE sends an MNP Information request (ATI) such that it will be handled by the MNP-SRF in the network.\nIn a PLMN supporting MNP with indirect routeing using signalling relay, all incoming calls and calls originating in the network, for which the called party number is within the range owned by the network, the gateway MSCs will send SRI such that it will be handled by the MNP-SRF in that network.\nIn a PLMN supporting MNP with indirect routeing, the INE sends an MNP Information Request (ATI) such that it will be handled by the MNP-SRF in the Number Range Holder Network.\nThe MNP-SRF obtains routeing information from the NP database to identify the subscription network associated with a particular national MSISDN. The interface between the MNP-SRF and the NP database is considered implementation dependent and is not detailed further.\nFrom the perspective of the PLMN in which the MNP-SRF resides, the CdPA represents one of:\n1.\tAn own number ported out.\n2.\tAn own number not ported out.\n3.\tA foreign number ported in.\n4.\tA foreign number ported to a foreign network.\n5.\tA foreign number not known to be ported.\nCases 4 and 5 are applicable only for direct routeing.\nFor SRI:\nIn case 1, the MNP-SRF may perform one of the following depending on agreements within the number portability domain.\na.\tAn SRI response is sent containing the necessary routeing information to route the call to the subscription network. This is performed by an internal MAP Application Termination Function (MATF) known as the Number Portability Location Register (NPLR).\nb.\tIf indirect routeing of calls with reference to the subscription network is used, the message is relayed to the MNP-SRF in the subscription network, whose NPLR provides the necessary routeing information in an SRI response. The use of an NPLR in the subscription network can only be by agreement within the number portability domain.\nIn cases 2 and 3, the MNP-SRF relays the message to the HLR. For further details of the signalling relay function, the reader is referred to [7].\nIn case 4, an SRI response is sent, containing the necessary routeing information to route the call to the subscription network.\nIn case 5, an SRI response is sent, containing the necessary routeing information to route the call to the number range holder network.\nFor ATI:\nIn all cases the MNP information request (ATI) is sent to the MNP_SRF_MATF_Info_Request procedure/ MAP Application Termination Function (MATF) for handling. A response is sent to the INE containing MNP information or an error is returned.\nC.2\tFunctional Requirements of Network Entities\nC.2.1\tProcedure MNP_SRF_MATF_Call_Related\nFigure C.2.2 shows the procedure MNP_SRF_MATF_Call_Related. This procedure handles call-related signalling messages. It is called from the process MNP_SRF (see clause 4.3).\nThe check \"message has been relayed\" identifies all call related signalling messages which are relayed from the number range holder network towards the subscription network in the case of Indirect Routeing with reference to subscription network implementation. These messages only refer to numbers ported into the network.\nThe check \"own number not ported out\" identifies all mobile numbers from number ranges allocated to the network the MNP-SRF/MATF is located in and which are not ported to other networks. In this case the call related message is relayed to the HLR in the network.\nThe check \"foreign number ported in\" identifies all mobile numbers from the number ranges not allocated to the network the MNP-SRF/MATF is located in and which are served by the network the MNP-SRF/MATF is located in. In this case the call related message is relayed to the HLR in the network.\nThe check \"foreign number not known to be ported\" identifies all mobile numbers from the number ranges not allocated to the network the MNP-SRF/MATF is located in and which are also not served by the network the MNP-SRF/MATF is located in. In this case the call is sent to the SRF_MATF procedure for handling.\nThe check \"foreign number ported to foreign network\" identifies all mobile numbers from the number ranges not allocated to the network the MNP-SRF/MATF is located in and which are not served by the network the MNP-SRF is located in and not served by the network the number range is allocated to, i.e. the number is ported between two other networks. In this case the call related message is sent to the SRF_MATF procedure for handling.\nThe remaining cases \"own number ported out\" are mobile numbers allocated to the network the MNP-SRF/MATF is located in and which are served by other networks, i.e. the number is ported out to another network. In this case the call is relayed to the MATF in the subscription network if this option is the one used by the operator, or sent to the SRF_MATF procedure for handling if not.\nC.2.2\tProcess SRI_NPLR\nFigure C.2.2.2 shows the process SRI_NPLR.\nThe check \"unknown subscriber\" identifies a subscriber without any associated available information.\nIf the GMSC is in the database own network then a routeing number is provided to route to the number range holder network.\nIf the GMSC is not in the database own network then the enquiry has been routed from the number range holder network, so the call should fail.\nThe database query uses the MSISDN received at the application level in the SRI, rather then the CdPA of the SCCP level.\nIf an error must be set as a result of the check \"terminate\", the user error \"unknown subscriber\" shall be used. If version 3 or higher of the MAP protocol is in use, then the diagnostic \"NPDB mismatch\" may be used.\nThe check \"HPLMN MSISDN Range\" identifies if the MSISDN received in the SRI exists in a MSISDN Range owned by the HPLMN. This is a North American Network implementation option and allows a MAP Error \"Unknown Subscriber\" to be sent to the GMSC instead of the MSISDN.\nThe check \"HPLMN RN Range\" identifies if the Routeing Number assigned to the MSISDN within the SRI_NPLR is assigned to the HPLMN. This is a North American Network implementation option and allows a MAP Error  \"Unknown Subscriber\" to be sent to the GMSC instead of the RN+MSISDN.\nC.2.3\tProcedure MNP_SRF_MATF_Info_Request\nFigure C.2.3.1 shows the procedure MNP_SRF_MATF_Info_Request. This procedure handles an information request signalling message to provide MNP information for a subscriber. It is called from the process MNP_SRF (see clause 4.3).\nC.2.4\tProcess ATI_NPLR\nFigure C.2.3.2 shows the process ATI_NPLR.\nThe database query uses the MSISDN received at the application level in the ATI, rather than the CdPA of the SCCP level.\nFigure C.2.2: Procedure MNP_SRF_MATF_Call_Related\nFigure C.2.2.1: Procedure MATF\nFigure C.2.2.2: Process SRI_NPLR\nFigure C.2.3.1: Procedure MATF_Info_Request\nFigure C.2.3.2: Process ATI_NPLR\nC.3\tCall Scenarios\nThe notation TT=SRI in diagrams in this clauseÂ assumes that SRI=CRMNP for ETSI and SRI = Translation Type 14 for ANSI. The use of other translation types is for further study. The message flows for the following scenarios are based on the use of an SCCP relay function in MNP-SRF(s). The message flows for the higher level relay function (e.g. TC relay) in MNP-SRF are not covered here, but the principle can be found in B.4.2. For further details of the signalling relay function, the reader is referred to [7].\nC.3.1\tCall to a Non-Ported Number or Number Ported into the Network\nFigure C.3.1 shows the signalling involved for a call to a non-ported number or number ported into the network (see 3GÂ TS 23.018 [3]).\nFigure C.3.1: Call to a non-ported number\n1.\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the subscription network being the number range holder network, if the number is non-ported.\n2.\tWhen GMSCB receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n3.\tWhen the MNP_SRF/MATF receives the message, the MNP_SRF/MATF analyses the MSISDN in the CdPA and identifies the MSISDN as being non-ported. The MNP_SRF/MATF function then replaces the CdPA by an HLRB address. After modifying the CdPA, the message is routed to HLRB.\n4.\tWhen HLRB receives the SRI, it responds to the GMSCB by sending an SRI ack with an MSRN that identifies the MSB in the VMSCB.\n5.\tGMSCB uses the MSRN to route the call to VMSCB.\nC.3.2\tCall to a Ported Number â€“ Originating NetworkÂ =Â Subscription Network â€“ Direct Routeing\nFigure C.3.2 shows the signalling involved for a call to a ported number via direct routeing where the call is originated in the subscription network.\nFigure C.3.2: Call to a ported number via direct routeing where the call is originated in the subscription network\n1.\tMSA originates a call to MSISDN.\n2.\tVMSCA routes the call to the network's GMSCA.\n3.\tWhen GMSCA receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n4.\tWhen the MNP_SRF/MATF receives the message, it analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network. The MNP_SRF/MATF function then replaces the CdPA by an HLRA address. After modifying the CdPA, the message is routed to HLRA.\n5.\tWhen HLRA receives the SRI, it responds to the GMSCA by sending an SRI ack with an MSRN that identifies the MSB in the VMSCB.\n6.\tGMSCA uses the MSRN to route the call to VMSCB.\nC.3.3\tMobile Originated Call to a Ported or not known to be Ported Number â€“ Originating Network ï‚¹Subscription Networkâ€“ Direct Routeing\nFigure C.3.3 shows the signalling involved for a national mobile originated call to a number not Subscribed in the originating network via direct routeing. The scenario describes signalling in the originating network using direct routeing in the cases when an own number is ported out, a foreign number is not known to be ported or a foreign number is ported to other foreign network.\nFigure C.3.3: National mobile originated call to a ported number via direct routeing\n1.\tMSA originates a call to MSISDN.\n2.\tVMSCA routes the call to the network's GMSCA.\n3.\tWhen GMSCA receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n4.\tWhen the MNP_SRF/MATF receives the message, it analyses the MSISDN in the CdPA and identifies the MSISDN as not known to be ported or being ported to another network. As the message is a SRI message, the MNP_SRF/MATF responds to the GMSCA by sending an SRI ack with a RN + MSISDN; For the case the number is not known to be ported the routeing number may be omitted.\n5.\tGMSCA uses the (RN +) MSISDN to route the call to GMSCB in the subscription network. Depending on the interconnect agreement, the RN will be added in the IAM or not.\nC.3.4\tCall to a Ported Number â€“ Indirect Routeing\nFigure C.3.4 shows the signalling involved for a call to a ported number via indirect routeing.\nFigure C.3.4: Call to a ported number via indirect routeing\n1.\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the number range holder network.\n2.\tWhen GMSCA in the number range holder network receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n3.\tWhen the MNP_SRF/MATF receives the message, it analyses the MSISDN in the CdPA and identifies the MSISDN as being ported to another network. As the message is an SRI message, the MNP_SRF/MATF responds to the GMSCA by sending an SRI ack with a RN + MSISDN.\n4.\tGMSCA uses the RN + MSISDN to route the call to GMSCB in the subscription network. Depending on the interconnect agreement, the RN will be added in the IAM or not.\nC.3.5\tCall to a Ported Number â€“ Indirect Routeing with Reference to Subscription Network\nFigure C.3.5 shows the signalling involved for a call to a ported number where indirect routeing with reference to the subscription network is used.\nFigure C.3.5: National or international originated call to a ported number where indirect routeing with reference to the subscription network is used\n1.\tFrom an Originating Exchange a call is set up to MSISDN. The call is routed to the number range holder network.\n2.\tWhen GMSCA in the number range holder network receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n3.\tWhen MNP_SRF/MATF receives the message, MNP_SRF/MATF operation is triggered. The MNP_SRF/MATF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported to another network. As the message is a SRI message, the MNP_SRF/MATF function relays the message to the subscription network by adding a routeing number to the CdPA which information may be retrieved from a database. After modifying the CdPA, the message is routed to the subscription network.\n4.\tWhen MNP_SRF/MATF in the subscription network receives the SRI, it responds to the GMSCA in the number range holder network by sending a SRI ack with a RN + MSISDN.\n5.\tGMSCA uses the (RN +) MSISDN to route the call to GMSCB in the subscription network; Depending on the interconnect agreement, the RN will be added in the IAM or not.\n6.\tWhen GMSCB in the subscription network receives the ISUP IAM, it requests routeing information by submitting a MAP SRI to MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.\n7.\tWhen MNP_SRF/MATF receives the message, MNP_SRF/MATF operation is triggered. The MNP_SRF/MATF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as being ported into the network. The MNP_SRF/MATF function then replaces the CdPA by an HLRB address which information may be retrieved from a database. After modifying the CdPA, the message is routed to HLRB.\n8.\tWhen HLRB receives the SRI, it responds to the GMSCB by sending an SRI ack with an MSRN that identifies the MSB in the VMSCB.\n9.\tGMSCB uses the MSRN to route the call to VMSCB.\nNOTE:\tThe MNP_SRF/MATF in this scenario has only information about all ported numbers to one subscription network, except those for which subscription information is held in the subscription networks HLR. In this scenario the routeing depends always on the number range holder and the subscription network.\nC.3.6\tMNP Info Query - Direct Routeing\nFigure C.3.6: MNP-SRF operation for providing MNP Information where direct routeing applies\nIn a PLMN using a MNP-SRF based MNP solution supporting direct routeing, the INE always sends the MNP information request, containing the CdPA, to the MNP-SRF in that network.\nThe INE may query the MNP information for the called party number or the calling party number.\nThe INE requesting MNP information may be a gsmSCF for prepaid services (see 3GPP TS 23.078 [18]).\nIn order to provide enough information for a CAMEL SCP to charge correctly for CAMEL Pre-Paid Calls and SMS to national MSISDNs originated in the HPLMN, operators should ensure that the NPDB contains, at least, MNP information for 'own numbers ported out' and 'foreign numbers ported in'.\nC.3.7\tMNP Info Query - Indirect Routeing\nFigure C.3.7: MNP-SRF operation for Providing MNP information  where indirect routeing applies\nThe Interrogating Network Entity (INE) submits a MNP Information request message to the MNP-SRFB, which triggers MNP-SRF operation. The MNP-SRF functionality analyses the MSISDN in the application level and queries an MNP database to get the MNP information. The INE may query the MNP information for the called party number or the calling party number.\nThe INE requesting MNP information may be a gsmSCF for prepaid services (see 3GPP TS 23.078 [18]).\nC.4\tInformation Flows\nFigure C.4.1 shows the information flow for a successful delivery of a call to a non-ported number or number ported into the network. The figure is related to figure C.3.1.\nFigure C.4.1: Successful delivery of a call to a non-ported subscriber or number ported into the network\nFigure C.4.2 shows the signalling involved for a call to a ported number via direct routeing where the call is originated in the subscription network. The figure is related to figure C.3.2.\nFigure C.4.2: Successful delivery of a call to a ported number via direct routeing where the call is originated in the subscription network\nFigure C.4.3 shows the signalling involved for a national mobile originated call to a ported number via direct routeing. The figure is related to figure C.3.3.\nFigure C.4.3: Successful delivery of a national mobile originated call to a ported number via direct routeing\nFigure C.4.4 shows the signalling involved for a national mobile originated call to a not known to be ported number via direct routeing. The figure is related to figure C.3.3.\nFigure C.4.4: Successful delivery of a national mobile originated call to a not known to be ported number via direct routeing\nFigure C.4.5 shows the signalling involved for a call to a ported number via indirect routeing. The figure is related to figure C.3.4.\nFigure C.4.5: Successful delivery of a call to a ported number via indirect routeing\nFigure C.4.6 shows the signalling involved for a call to a ported number where indirect routeing with reference to the subscription network is used. The figure is related to figure C.3.5.\nFigure C.4.6: Successful delivery for a call to a ported number where indirect routeing with reference to the subscription network is used\nC.5\tContents of the messages\nThis clause contains detailed description of the messages shown in this part B of the specification.\nThe contents of the messages used on the gsmSCF â€“ MNP-SRF interface are specified in 3G TS 23.078 [19]. When the message is sent from the NPLR to the gsmSCF, the MNP specific information are defined as in clause C.5.2. The gsmSCF may transit the information received from NPLR to the gateway MSC with the CAP Connect message in order to avoid a subsequent SRI message.\nC.5.1\tSend Routeing Info\nThe contents of this message are specified in 3G TS 23.018 [3].\nC.5.2\tSend Routeing Info ack\nThe contents of this message are specified in 3G TS 23.018 [3]. In the case that the message is sent from the NPLR to the GMSC, the following MNP specific information is defined:\nInformation element name\nRequired\nDescription\nImsi\nM\nThe IMSI returned by an NPLR is a generic IMSI, i.e. it is not tied necessarily to the Subscriber. MCC and MNC values in this IMSI shall point to the Subscription Network of the B Subscriber\nMsrn\nC\nWhen returned from the NPLR, this parameter contains a Routeing Number that points to Subscription Network. If concatenate addressing is used, it also contains the MSISDN in addition to the Routeing Number.In the case of a number which is not known to be ported, the Routeing Number may be omitted as an operator option. If the routeing number is omitted, this parameter contains only the MSISDN.\nMsisdn\nC\nMSISDN of the B subscriber. This information element shall be present if MSRN contains the routeing number to reach the subscription network for B subscriber and the MSISDN is not contained in the MSRN information element.\nMNP Indicator\nU\nIndicates the number portability status of the subscriber.\nC.6\tHandling of MAP to ISUP mapping (informative)\nDifferent configurations can be possible within a portability domain depending on the versions of MAP and ISUP protocols being used. The following clauses describe possible interworking scenarios.\nC.6.1\tETSI Mapping direction: ISUP to MAP\nThe GMSC always constructs the Send Routeing Info message using the MSISDN. If the incoming IAM corresponds to a ported number the GMSC shall retrieve the MSISDN from the corresponding parameter in the IAM.\nC.6.2\tETSI Mapping direction: MAP to ISUP\nIn MAP SRIack messages from NPLR, MAP versions 1 and 2 only support concatenate addressing for MNP. If MSISDN parameter is present in the SRIack, this means that separate addressing is used in MAP; this is only possible if MAP version 3 is used. MAP version 3 can also support concatenate addressing. In all cases, when a Routeing Number is returned, it is included in the MSRN parameter of the SRIack.\nRegardless of how MAP is established, the possible mappings of the parameters in ISUP IAM message is one of these 4 options (see also [6]):\n1.\tCdPN parameter includes only the MSISDN.\n2.\tCdPN parameter includes both RN and MSISDN concatenated.\n3.\tCdPN parameter includes the MSISDN and NRN parameter includes the Routeing Number.\n4.\tCdPN parameter includes the Routeing Number and CDN parameter includes the MSISDN.\nIn all cases, the method to transport the routeing number in the IAM depends on the interfaces agreed by the operators in the portability domain.\nC.6.3\tANSI Mapping direction: ISUP to MAP\nThe GMSC always constructs the Send Routeing Info message using the MSISDN. If the incoming IAM corresponds to a ported number the GMSC shall retrieve the MSISDN from the corresponding  parameter in the IAM.\nThe IAM message is specified for ANSI ISUP implementation in [8] and [9].\nC.6.4\tANSI Mapping direction: MAP to ISUP\nIn MAP SRIack messages from NPLR, MAP versions 1 and 2 only support concatenate addressing for MNP. If MSISDN parameter is present in the SRI Ack, this means that separate addressing is used in MAP; this is only possible if MAP version 3 is used. MAP version 3 can also support concatenate addressing. In all cases, when a Routeing Number is returned, it is included in the MSRN parameter of the SRI Ack.\nRegardless of how MAP is established, the possible mappings of the parameters in ISUP IAM message is one of these 4 options (see also [8] and [9]):\nMAP Parameters\nSRI Ack\nISUP Parameters\nIAM\nIMSI\nSubscriber IMSI\nCdPN\nMSRN\nMSRN\nMSRN\nMAPS TO\nGAP\nN/A\nMSISDN\nNot Present\nFCI Bit M Indicator\n1\nMNP Indicator\nNot Present\nMAP Parameters\nSRI Ack\nISUP Parameters\nIAM\nIMSI\nDefault IMSI\nCdPN\nDialled DN\nMSRN\nDialled DN\nMAPS TO\nGAP\nN/A\nMSISDN\nNot Present\nFCI Bit M Indicator\n1\nMNP Indicator\nNotKnownToBePorted\nMAP Parameters\nSRI Ack\nISUP Parameters\nIAM\nIMSI\nDefault IMSI\nCdPN\nRN\nMSRN\nRN\nMAPS TO\nGAP\nDialled DN\nMSISDN\nDialled DN\nFCI Bit M Indicator\n1\nMNP Indicator\nOwnNumberPortedOut\nMAP Parameters\nSRI Ack\nISUP Parameters\nIAM\nIMSI\nDefault IMSI\nCdPN\nRN\nMSRN\nRN\nMAPS TO\nGAP\nDialled DN\nMSISDN\nDialled DN\nFCI Bit M Indicator\n1\nMNP Indicator\nForeign Number PortedToForeignNetwork\nIn all cases, the method to transport the routing number in the IAM depends on the interfaces agreed by the operators in the portability domain.\nAnnex D:Void\nAnnex E (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n#03\nTransferred to 3GPP CN2\nAug 1999\n3.0.0\n#05Oct 1999\n001\nHarmonisation of terminology interrogating\n3.1.0\n#05Oct 1999\n002\nProposed changes to B.4.2 Delivery of SMS to a Non-ported Number - Direct Routeing â€“ MNP-SRF acts as Higher-level Relay\n3.1.0\n#05Oct 1999\n003\nClarification of NPLR functionality in not known to be ported case\n3.1.0\n#07Mar 2000\n007\n1\nEditorial cleanup\n3.2.0\n#07Mar 2000\n008\n4\nAlignment of IN interface with Fixed Networks\n3.2.0\n#07Mar 2000\n009\n3\nDetection of database synchronisation errors in SRF\n3.2.0\n#07Mar 2000\n012\n2\nResult of Public Enquiry 9953\n3.2.0\n#07Mar 2000\n015\n1\nClarification of NPDB error detection and MNP specific call handling\n3.2.0\n#08Jun 2000\n019\n2\nNorth American Service Provider Number Portability impacts for Mobile Number Portability\n3.3.0\n#11\nMar 2001\nRelease 4 after CN#11\n4.0.0\n#16\nMar 2002\nReferences updated\n4.0.1\n#16\nJun 2002\nRelease 5 after CN#16\n5.0.0\n#20\nJun 2003\n023\n1\nIN-based solution for correct charging of calls to ported or non-ported subscribers originated by pre-paid subscribers\n5.1.0\n#21\nSep 2003\n026\n1\nIncorrect CAMEL pre-paid charging in MNP networks\n5.2.0\nCN#22\nDec 2003\n027\nIncorrect implementation of  CR 023r1\n5.3.0\nCN#22\nDec 2003\n028\n1\nMNP correction for prepaid charging\n5.3.0\nCN#26\nRelease 6 after CN#26\n6.0.0\nCT#36\nUpgraded unchanged from Rel-6\n7.0.0\nCT#42\nUpgraded unchanged from Rel-7\n8.0.0\nCT#46\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2011-03\n-\nUpdate to Rel-10 version (MCC)\n10.0.0\n2012-09\n-\nUpdate to Rel-11 version (MCC)\n11.0.0\n2014-09\n-\nUpdate to Rel-12 version (MCC)\n12.0.0\n2015-12\nUpdate to Rel-13 version (MCC)\n13.0.0\n2017-03\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2018-06\n-\nUpdate to Rel-15 version (MCC)\n15.0.0\n2020-07\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2022-03\n-\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.3",
        "figure_6",
        "ts_23.018",
        "ts_23.078"
      ]
    }
  ]
}