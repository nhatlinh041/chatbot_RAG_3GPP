{
  "metadata": {
    "specification_id": "ts_23.228",
    "version": "18.9.0",
    "title": "3GPP TS 23.228",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23228-i90/23228-i90.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:42:24.834024",
    "total_chunks": 240
  },
  "chunks": [
    {
      "chunk_id": "ts_23.228_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "This document defines the stage-2 service description for the IP Multimedia Core Network Subsystem (IMS), which includes the elements necessary to support IP Multimedia (IM) services. ITU‑T Recommendation I.130 [4] describes a three-stage method for characterisation of telecommunication services, and ITU‑T Recommendation Q.65 [3] defines stage 2 of the method.\nThis document does not cover the Access Network functionality except as they relate to provision of IM services, these aspects are covered in the normative Annexes.\nThis document identifies the mechanisms to enable support for IP multimedia applications. In order to align IP multimedia applications wherever possible with non-3GPP IP applications, the general approach is to adopt non-3GPP specific IP based solutions.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 23.002: \"Network Architecture\".\n[2]\tCCITT Recommendation E.164: \"Numbering plan for the ISDN era\".\n[3]\tCCITT Recommendation Q.65: \"Methodology – Stage 2 of the method for the characterisation of services supported by an ISDN\".\n[4]\tITU Recommendation I.130: \"Method for the characterization of telecommunication services supported by an ISDN and network capabilities of an ISDN\".\n[5]\t3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework (AF)\".\n[6]\tVoid.\n[7]\t3GPP TS 23.221: \"Architectural Requirements\".\n[8]\t3GPP TS 22.228: \"Service requirements for the IP multimedia core network subsystem\".\n[9]\t3GPP TS 23.207: \"End-to-end QoS concept and architecture\".\n[10]\tVoid.\n[10a]\t3GPP TS 24.229: \"IP Multimedia Call Control based on SIP and SDP; Stage 3\".\n[11]\t3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".\n[11a]\t3GPP TS 29.207: \"Policy control over Go interface\".\n[12]\tIETF RFC 3261: \"SIP: Session Initiation Protocol\".\n[13]\tIETF RFC 3986: \"Uniform Resource Identifiers (URI): Generic Syntax\".\n[14]\tIETF RFC 4282: \"The Network Access Identifier\".\n[15]\tIETF RFC 3966: \"The tel URI for Telephone Numbers\".\n[16]\tIETF RFC 3761 (April 2004): \"The E.164 to Uniform Resource Identifiers (URI) Dynamic Delegation Discovery System (DDDS) Application (ENUM)\".\n[16a]\tIETF RFC 4941: \"Privacy Extensions for Stateless Address Autoconfiguration in IPv6\".\n[17]\tITU Recommendation G.711: \"Pulse code modulation (PCM) of voice frequencies\".\n[18]\tITU Recommendation H.248: \"Gateway control protocol\".\n[19]\t3GPP TS 33.203: \"Access Security for IP-based services\".\n[20]\t3GPP TS 33.210: \"Network Domain Security: IP network layer security\".\n[21]\tVoid.\n[22]\t3GPP TR 22.941: \"IP Based Multimedia Services Framework\".\n[23]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[24]\t3GPP TS 23.003: \"Technical Specification Group Core Network; Numbering, addressing and identification\".\n[25]\t3GPP TS 32.240: \"Telecommunication management; Charging management; Charging architecture and principles\".\n[26]\t3GPP TS 32.260: \"Telecommunication Management; Charging Management; IP Multimedia Subsystem (IMS) charging\".\n[27]\t3GPP TS 22.071: \"Technical Specification Group Services and System Aspects, Location Services (LCS); Service description, Stage 1\".\n[28]\t3GPP TS 23.271: \"Technical Specification Group Services and System Aspects, Functional stage 2 description of LCS\".\n[29]\t3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced Logic (CAMEL) Phase 3 - Stage 2\".\n[29a]\t3GPP TS 22.340: \"IMS Messaging; Stage 1\".\n[30]\t3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\".\n[31]\t3GPP TS 23.240: \"3GPP Generic User Profile - Architecture; Stage 2\".\n[32]\t3GPP TS 22.250: \"IP Multimedia Subsystem (IMS) group management\"; Stage 1\".\n[33]\tIETF RFC 2766: \"Network Address Translation-Protocol Translation (NAT-PT)\".\n[34]\tIETF RFC 2663: \"IP Network Address Translator (NAT) Terminology and Considerations\".\n[35]\tVoid.\n[36]\t3GPP TS 23.141: \"3rd Generation Partnership Project; Technical Specification Group Services and System Aspects; Presence Service\".\n[37]\tVoid.\n[38]\tIETF RFC 3840: \"Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)\".\n[39]\tIETF RFC 3323: \"A Privacy Mechanism for the Session Initiation Protocol (SIP)\".\n[40]\tIETF RFC 3325: \"Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Network\".\n[41]\tIETF RFC 3312: \"Integration of resource management and Session Initiation Protocol (SIP)\".\n[42]\tIETF RFC 3841: \"Caller Preferences for the Session Initiation Protocol (SIP)\".\n[43]\tIETF RFC 3428: \"Session Initiation Protocol (SIP) Extension for Instant Messaging\".\n[44]\tIETF RFC 3263: \"Session Initiation Protocol (SIP): Locating SIP Servers\".\n[45]\tIETF RFC 5245: \"Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols\".\n[46]\tIETF RFC 5766: \"Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)\".\n[47]\tIETF RFC 5389: \"Session Traversal Utilities for NAT (STUN)\".\n[48]\tIETF RFC 5626: \"Managing Client Initiated Connections in the Session Initiation Protocol (SIP)\".\n[49]\tIETF RFC 5627: \"Obtaining and Using Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)\".\n[50]\tIETF RFC 5628: \"Registration Event Package Extension for Session Initiation Protocol (SIP) Globally Routable User Agent URIs (GRUUs)\".\n[51]\tIETF RFC 4787: \"Network Address Translation (NAT) Behavioural Requirements for Unicast UDP\".\n[52]\t3GPP TS 23.279: \"Combining Circuit Switched (CS) and IP Multimedia Subsystem (IMS) services; Stage 2\".\n[53]\t3GPP TS 22.173: \"IMS Multimedia Telephony Service and supplementary services; Stage 1\".\n[54]\t3GPP TS 23.203: \"Policy and Charging Control architecture\".\n[55]\t3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".\n[56]\t3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic 3GPP Internet Protocol (IP) access\".\n[57]\tIETF RFC 4769: \"IANA Registration for an Enumservice Containing Public Switched Telephone Network (PSTN) Signaling Information\".\n[58]\t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[59]\t3GPP TS 29.333: \"Multimedia Resource Function Controller (MRFC) - Multimedia Resource Function Processor (MRFP) Mp Interface; Stage 3\".\n[60]\t3GPP2 X.S0011: \"cdma2000 Wireless IP Network Standard\".\n[61]\t3GPP2 C.S0001-D: \"Introduction to cdma2000 Spread Spectrum Systems - Revision D\".\n[62]\t3GPP2 C.S0024-A: \"cdma2000 High Rate Packet Data Air Interface Standard, April 2004\".\n[63]\t3GPP2 C.S0084-000: \"Overview for Ultra Mobile Broadband (UMB) Air Interface Specification\".\n[64]\t3GPP TS 24.167: \"3GPP IMS Management Object (MO); Stage 3\".\n[65]\tIETF RFC 3022: \"Traditional IP Network Address Translator (Traditional NAT)\".\n[66]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) Centralized Services\".\n[67]\t3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity\".\n[68]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[69]\t3GPP TS 31.103: \"Characteristics of the IP Multimedia Services Identity Module (ISIM) application\".\n[70]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[71]\t3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model; Stage 2\".\n[72]\tIETF RFC 3264: \"An Offer/Answer Model with Session Description Protocol\".\n[73]\t3GPP TS 23.333: \"Multimedia Resource Function Controller (MRFC) - Multimedia Resource Function Processor (MRFP) Mp interface: Procedures Descriptions\".\n[74]\t3GPP TS 23.334: \" IMS Application Level Gateway (IMS-ALG) - IMS Access Gateway (IMS-AGW) interface: Procedures Descriptions\".\n[75]\t3GPP TS 29.162: \"Interworking between the IM CN subsystem and IP networks\".\n[76]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[77]\t3GPP TS 22.153: \"Multimedia priority service\".\n[78]\tETSI ES 282 003: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Resource and Admission Control Sub-System (RACS): Functional Architecture\".\n[79]\t3GPP TS 29.328: \"IP Multimedia (IM) Subsystem Sh Interface; Signalling flows and message contents\".\n[80]\t3GPP TS 23.380: \"IP Multimedia Subsystem (IMS); IMS Restoration Procedures\".\n[81]\t3GPP TS 24.525: \"Business trunking; Architecture and functional description\".\n[82]\t3GPP TS 23.402: \"Architecture Enhancements for non-3GPP accesses\".\n[83]\t3GPP TS 33.328: \"IP Multimedia (IM) Subsystem media plane security\".\n[84]\tIETF RFC 8825: \"Overview: Real Time Protocols for Brower-based Applications\".\n[85]\tW3C: \"WebRTC 1.0: Real-time Communication Between Browsers\", W3C Recommendation, 26 January 2021, https://www.w3.org/TR/2021/REC-webrtc-20210126/.\n[86]\tW3C: \"Cross-Origin Resource Sharing\", W3C Proposed Recommendation, 05 December 2013, http://www.w3.org/TR/2013/PR-cors-20131205/.\n[87]\tITU-T Recommendation T.140: \"Protocol for multimedia application text conversation\".\n[88]\tIETF RFC 6455: \"The WebSocket Protocol\".\n[89]\tIETF RFC 7118: \"The WebSocket Protocol as a Transport for the Session Initiation Protocol (SIP)\".\n[90]\tIETF RFC 4571: \"Framing Real-time Transport Protocol (RTP) and RTP Control Protocol (RTCP) Packets over Connection-Oriented Transport\".\n[91]\t3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core Network (CN) subsystem\".\n[92]\t3GPP TS 23.179: \"Functional architecture and information flows to support mission critical communication services; Stage 2\".\n[93]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[94]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[95]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[96]\t3GPP TS 29.514: \"5G System; Policy Authorization Service; Stage 3\".\n[97]\t3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage 2\".\n[98]\t3GPP TS 29.563: \"5G System (5GS); Home Subscriber Server (HSS) services for interworking with Unified Data Management (UDM); Stage 3\".\n[99]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description\".\n[100]\t3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC) protocol specification\".\n[101]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description\".\n[102]\t3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol specification\".\n[103]\t3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support network data analytics services\".\n[104]\t3GPP TS 26.264: \"IMS-based AR Real-Time Communication\".\n[105]\t3GPP TS 24.186: \"IMS Data Channel applications; Protocol specification\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002",
        "ts_33.310",
        "ts_23.221",
        "ts_22.228",
        "ts_23.207",
        "ts_24.229",
        "ts_29.214",
        "ts_29.207",
        "ts_33.203",
        "ts_33.210",
        "ts_22.941",
        "ts_23.060",
        "ts_23.003",
        "ts_32.240",
        "ts_32.260",
        "ts_22.071",
        "ts_23.271",
        "ts_23.078",
        "ts_22.340",
        "ts_29.228",
        "ts_23.240",
        "ts_22.250",
        "ts_23.141",
        "ts_23.279",
        "ts_22.173",
        "ts_23.203",
        "ts_23.107",
        "ts_23.204",
        "ts_23.167",
        "ts_29.333",
        "ts_24.167",
        "ts_23.292",
        "ts_23.237",
        "ts_21.905",
        "ts_31.103",
        "ts_23.401",
        "ts_23.218",
        "ts_23.333",
        "ts_23.334",
        "ts_29.162",
        "ts_26.114",
        "ts_22.153",
        "ts_29.328",
        "ts_23.380",
        "ts_24.525",
        "ts_23.402",
        "ts_33.328",
        "ts_24.610",
        "ts_23.179",
        "ts_23.501",
        "ts_23.502",
        "ts_23.503",
        "ts_29.514",
        "ts_23.632",
        "ts_29.563",
        "ts_36.300",
        "ts_36.321",
        "ts_38.300",
        "ts_38.321",
        "ts_23.288",
        "ts_26.264",
        "ts_24.186"
      ]
    },
    {
      "chunk_id": "ts_23.228_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "Refer to TS 23.002 [1] for the definitions of some terms used in this document.\nFor the purposes of the present document the terms and definitions given in TR 21.905 [68] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [68].\nFor the purposes of the present document, the following terms and definitions given in TS 23.003 [24] apply:\n-\tDistinct Public Service Identity\n-\tPublic User Identity\n-\tWildcarded Public User Identity\n-\tWildcarded Service User Identity\nAlias Public User Identities: A set of Public User Identities that belong to the same alias group as specified in TS 29.228 [30].\nALG: Application Level Gateway (ALG) is an application specific functional entity that allows communication between disparate address realm or IP versions, e.g. an IPv6 node to communicate with an IPv4 node and vice versa, when certain applications carry network addresses in the payloads like SIP/SDP. NA(P)T-PT or NA(P)T is application unaware whereas ALGs are application specific translation entities that allow a host running an application to communicate transparently with another host running the same application but in a different IP version or IP address realm. See IETF RFC 2663 [34] for more details.\nFor IMS, an IMS ALG provides the necessary application function for SIP/SDP protocols in order to communicate between different address realms or IP versions, e.g. IPv6 and IPv4 SIP applications.\nApplication data channel: A data channel within an IMS session used to transfer data of data channel applications between UEs or between the UE and the network.\nAR Application Server: An application server used to control the service logic related to AR communication via IMS data channel.\nBootstrap data channel: A data channel established within an IMS session between the UE and the network, to transfer a graphical user interface that can include a list of data channel applications.\nBusiness trunking: as defined in TS 24.525 [81].\nData channel application: A HTML page including JavaScript(s) and optionally image(s) and style sheet(s). It is downloaded from the network to the UE through the bootstrap data channel.\nDC Application Server: An application server that interacts with the DCSF and the DC media function for data channel traffic handling.\nDistinct Public User Identity: used in relation to wildcarded Public User/Service Identities to denote an explicitly provisioned Public User/Service Identity. See more details in TS 23.003 [24].\nEntry point: In the case that border control concepts are to be applied in an IM CN subsystem, then these are to be provided by capabilities within the IBCF, and the IBCF acts as an entry point for this network (instead of the I‑CSCF). In this case the IBCF and the I‑CSCF can be co-located as a single physical node. If border control concepts are not applied, then the I-CSCF is considered as an entry point of a network. If the P‑CSCF is in the home network, then the I‑CSCF is considered as an entry point for this document.\nExit point: If operator preference requires the application of border control concepts then these are to be provided by capabilities within the IBCF, and requests sent towards another network are routed via a local network exit point (IBCF), which will then forward the request to the other network (discovering the entry point if necessary).\nGeographical Identifier: A Geographical Identifier identifies a geographical area within a country or territory. See more details in clause E.8.\nGeo-local service number: A local service number that is used to access a service in the roamed network (a local service where the subscriber is located).\nHome local service number: A local service number is used to access a service that is located in the home network of the user.\nHSS Group ID: This refers to one or more SBI capable HSS instances managing a specific set of IMPIs/IMPUs.\nIMC: IMS Credentials as defined in TR 21.905 [68].\nIMS application reference: An IMS application reference is the means by which an IMS communication service identifies an IMS application.\nIMS application: An IMS application is an application that uses an IMS communication service(s) in order to provide a specific service to the end-user. An IMS application utilises the IMS communication service(s) as they are specified without extending the definition of the IMS communication service(s).\nIMS communication service identifier: An IMS communication service identifier uniquely identifies the IMS communication service associated with the particular IMS request.\nIMS communication service: An IMS communication service is a type of communication defined by a service definition that specifies the rules and procedures and allowed medias for a specific type of communication and that utilises the IMS enablers.\nIMS enabler: An IMS enabler is a set of IMS procedures that fulfils specific function. An IMS enabler may be used in conjunction with other IMS enablers in order to provide an IMS communication service.\nInstance identifier: An identifier, that uniquely identifies a specific UE amongst all other UEs registered with the same Public User Identity.\nInter-IMS Network to Network Interface: The interface which is used to interconnect two IM CN subsystem networks. This interface is not constrained to a single protocol.\nIP Flow: Unidirectional flow of IP packets with the following properties:\n-\tsame destination IP address and port number;\n-\tsame source IP address and port number;\n-\tsame transport protocol (port numbers are only applicable if used by the transport protocol).\nIP-Connectivity Access Network: refers to the collection of network entities and interfaces that provides the underlying IP transport connectivity between the UE and the IMS entities. An example of an \"IP-Connectivity Access Network\" is GPRS.\nIP SM GW (IP short message gateway): An IP SM GW is an AS providing the support of Short Message Service of the IMS domain. See more details in TS 23.204 [56].\nLocal Service Number: A local service number is a telephone number in non-international format. A local service number is used to access a service that may be located in the home network of the user (home local service number) or the roamed network of the user (geo-local service number).\nMedia Flow: One or more IP flows carrying a single media instance, e.g. an audio stream or a video stream. In the context of this specification the term Media Flow is used instead of IP Flow regardless of whether the actual IP packet corresponds to media plane information (e.g. audio RTP flow) or control signalling (e.g. RTCP or SIP Signalling).\nMPS: Based on TS 22.153 [77]. Multimedia Priority Service allows authorized users to obtain and maintain radio and network resources with priority, also during national security or emergency situations when PLMN congestion may occur.\nMPS session: A session (e.g. voice, video, data session) for which priority treatment is applied for allocating and maintaining radio and network resources.\nMPS-subscribed UE: A UE having a USIM with MPS subscription.\nNAT-PT/NAPT-PT: NAT-PT uses a pool of globally unique IPv4 addresses for assignment to IPv6 nodes on a dynamic basis as sessions are initiated across the IP version boundaries. NAT-PT binds addresses in IPv6 network with addresses in IPv4 network and vice versa to provide transparent routing between the two IP domains without requiring any changes to end points, like the UE. NAT-PT needs to track the sessions it supports and mandates that inbound and outbound data for a specific session traverse the same NAT-PT router.\nNAPT-PT provides additional translation of transport identifier (e.g. TCP and UDP port numbers, ICMP query identifiers). This allows the transport identifiers of a number of IPv6 hosts to be multiplexed into the transport identifiers of a single assigned IPv4 address. See IETF RFC 2766 [33] for more details.\nNetwork Address Translation (NA(P)T): method by which IP addresses are mapped from one group to another, transparently to end users. Network Address Port Translation, or NA(P)T is a method by which many network addresses and their TCP/UDP (Transmission Control Protocol/User Datagram Protocol) ports are translated into a single network address and its TCP/UDP ports. See RFC 3022 [65] for further details.\nOutbound: Managing Client Initiated Connections in the Session Initiation Protocol (Outbound) defines behaviours for User Agents, registrars and proxy servers that allow requests to be delivered on existing connections established by the User Agent. See RFC 5626 [48] for further details.\nPreferred Circuit Carrier Access: An IMS service that allows a specific long distance circuit carrier to be selected for a long distance call.\nPreferred Circuit Carrier Selection: An IMS service that allows the subscriber to select a long distance circuit carrier per call when dialling a call origination.\nService User: According to TS 22.153 [77].\nStand-alone Non-Public Network: A non-public network not relying on network functions provided by a PLMN.\nSTUN: Simple Traversal of UDP Through NAT (STUN), provides a toolkit of functions. These functions allow entities behind a NAT to learn the address bindings allocated by the NAT, to keep those bindings open, and communicate with other STUN-aware devices to validate connectivity. See RFC 5389 [47] for further details.\nSTUN Keep-alive: Is a usage of STUN, to keep NAT bindings open.\nSTUN Relay: Is a usage of STUN, that allows a client to request an address on the STUN server itself, so that the STUN server acts as a relay. See IETF RFC 5766 [46] for further details.\nSubscriber: A Subscriber is an entity (comprising one or more users) that is engaged in a Subscription with a service provider. The subscriber is allowed to subscribe and unsubscribe services, to register a user or a list of user authorized to enjoy these services, and also to set the limits relative to the use that users make of these services.\nTransport address: A unique identifier of transport-layer address, i.e. a combination of a network address, protocol identifier and port number. For example an IP address and a UDP port.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.002",
        "ts_21.905",
        "ts_23.003",
        "ts_29.228",
        "ts_24.525",
        "ts_23.204",
        "ts_22.153"
      ]
    },
    {
      "chunk_id": "ts_23.228_3.2",
      "section_id": "3.2",
      "section_title": "Symbols",
      "content": "For the purposes of the present document the following symbols apply:\nCr\tReference Point between an AS and an MRFC for media control.\nCx\tReference Point between a CSCF and an HSS.\nDx\tReference Point between an I‑CSCF and an SLF.\nGi\tReference point between GPRS and an external packet data network.\nGm\tReference Point between a UE and a P‑CSCF or between an IP-PBX and a P‑CSCF.\nISC\tReference Point between a CSCF and an Application Server and between a CSCF and an MRB.\nIu\tInterface between the RNS and the core network. It is also considered as a reference point.\nIx\tReference Point between IBCF and TrGW.\nIci\tReference Point between an IBCF and another IBCF belonging to a different IM CN subsystem network or between an IBCF and an IP-PBX.\nIzi\tReference Point between a TrGW and another TrGW belonging to a different IM CN subsystem network.\nLe\tReference Point between an AS and a GMLC.\nMa\tReference Point between an AS and an I‑CSCF.\nMb\tReference Point used for IMS media transport to IP network services.\nMf\tReference Point between a transit function and AS.\nMg\tReference Point between an MGCF and a CSCF.\nMi\tReference Point between a CSCF and a BGCF.\nMj\tReference Point between a BGCF and an MGCF.\nMk\tReference Point between a BGCF/IMS ALG and another BGCF.\nMm\tReference Point between a IBCF/CSCF/BGCF/IMS ALG and an IP multimedia network.\nMr\tReference Point between an CSCF and an MRFC.\nMr′\tReference Point between an AS and an MRFC for session control.\nMp\tReference Point between MRFP and MRFC.\nMs\tReference point between an IBCF and Application Server\nMw\tReference Point between a CSCF and another CSCF.\nMx\tReference Point between a CSCF/BGCF and IBCF.\nRc\tReference Point between an AS and an MRB.\nSh\tReference Point between an AS (SIP‑AS or OSA‑CSCF) and an HSS.\nSi\tReference Point between an IM-SSF and an HSS.\nUt\tReference Point between UE and an Application Server.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_3.3",
      "section_id": "3.3",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [68] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [68].\n5GS\t5G System\nAPI\tApplication Program Interface\nAPN\tAccess Point Name\nAS\tApplication Server\nA2P\tApplication to Person\nBCSM\tBasic Call State Model\nBG\tBorder Gateway\nBGCF\tBreakout Gateway Control Function\nBS\tBearer Service\nCAMEL\tCustomised Application Mobile Enhanced Logic\nCAP\tCamel Application Part\nCDR\tCharging Data Record\nCN\tCore Network\nCS\tCircuit Switched\nCSCF\tCall Session Control Function\nCSE\tCAMEL Service Environment\nDC\tData Channel\nDCAR\tData Channel Application Repository\nDCMTSI\tData Channel Multimedia Telephony Service for IMS\nDCSF\tData Channel Signalling Function\nDHCP\tDynamic Host Configuration Protocol\nDNN\tData Network Name\nDNS\tDomain Name System\nECN\tExplicit Congestion Notification\nENUM\tE.164 Number Mapping\nGGSN\tGateway GPRS Support Node\nGLMS\tGroup and List Management Server\nGMLC\tGateway Mobile Location Centre\nGRUU\tGlobally Routable User Agent URI\nGUP\tGeneric User Profile\nHSS\tHome Subscriber Server\nIBCF\tInterconnection Border Control Function\nI‑CSCF\tInterrogating‑CSCF\nIETF\tInternet Engineering Task Force\nIM\tIP Multimedia\nIMC\tIMS Credentials\nIMS\tIP Multimedia Core Network Subsystem\nIMS ALG\tIMS Application Level Gateway\nIMSI\tInternational Mobile Subscriber Identifier\nIN\tIntelligent Network\nIP\tInternet Protocol\nIPv4\tInternet Protocol version 4\nIPv6\tInternet Protocol version 6\nIP‑CAN\tIP-Connectivity Access Network\nIP‑SM‑GW\tIP Short Message Gateway\nISDN\tIntegrated Services Digital Network\nISIM\tIMS SIM\nISP\tInternet Service Provider\nISUP\tISDN User Part\nIWF\tInterworking Function\nNP\tNumber portability\nMAP\tMobile Application Part\nMGCF\tMedia Gateway Control Function\nMGF\tMedia Gateway Function\nMRB\tMedia Resource Broker\nMRFC\tMultimedia Resource Function Controller\nMRFP\tMultimedia Resource Function Processor\nNAI\tNetwork Access Identifier\nNAPT\tNetwork Address Port Translation\nNAT\tNetwork Address Translation\nNA(P)T-PT\tNetwork Address (Port-Multiplexing) Translation-Protocol Translation\nII-NNI\tInter-IMS Network to Network Interface\nOSA\tOpen Services Architecture\nP2A\tPerson to Application\nP2P\tPerson to Person\nP‑CSCF\tProxy‑CSCF\nPCC\tPolicy and Charging Control\nPCEF\tPolicy and Charging Enforcement Function\nPCRF\tPolicy and Charging Rules Function\nPDN\tPacket Data Network\nPDP\tPacket Data Protocol e.g. IP\nP‑GRUU\tPublic Globally Routable User Agent URI\nPLMN\tPublic Land Mobile Network\nPSI\tPublic Service Identity\nPSTN\tPublic Switched Telephone Network\nQoS\tQuality of Service\nRAB\tRadio Access Bearer\nRFC\tRequest for Comments\nSCS\tService Capability Server\nS‑CSCF\tServing‑CSCF\nSDP\tSession Description Protocol\nSGSN\tServing GPRS Support Node\nSLF\tSubscription Locator Function\nSNPN\tStand-alone Non-Public Network\nSSF\tService Switching Function\nSS7\tSignalling System 7\nSIM\tSubscriber Identity Module\nSIP\tSession Initiation Protocol\nS‑GW\tSignalling Gateway\nTAS\tTelephony Application Server\nT‑GRUU\tTemporary Globally Routable User Agent URI\nTHIG\tTopology Hiding Inter-network Gateway\nTrGW\tTransition Gateway\nUE\tUser Equipment\nUMTS\tUniversal Mobile Telecommunications System\nURL\tUniversal Resource Locator\nUSIM\tUMTS SIM",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.0",
      "section_id": "4.0",
      "section_title": "General",
      "content": "The IP Multimedia CN subsystem comprises all CN elements for provision of multimedia services. This includes the collection of signalling and media related network elements as defined in TS 23.002 [1]. IP multimedia services are based on an IETF defined session control capability which, along with multimedia transport capabilities, utilises the IP-Connectivity Access Network (this may include an equivalent set of services to the relevant subset of CS Services).\nIn order to achieve access independence and to maintain a smooth interoperation with wireline terminals across the Internet, the IP multimedia subsystem attempts to be conformant to IETF \"Internet standards\". Therefore, the interfaces specified conform as far as possible to IETF \"Internet standards\" for the cases where an IETF protocol has been selected, e.g. SIP and RTP.\nThe IP multimedia core network (IM CN) subsystem enables operators to offer their subscribers multimedia services. The IM CN subsystem should enable the convergence of, and access to, voice, video, messaging, data and web-based technologies for the wireless and wireline user.\nThe complete solution for the support of IP multimedia applications consists of terminals, IP-Connectivity Access Networks (IP‑CAN), and the specific functional elements of the IM CN subsystem described in this technical specification. Examples of IP-Connectivity Access Network are:\n-\tthe GPRS core network with GERAN and/or UTRAN radio access networks; and\n-\tEPC core network and E-UTRAN radio access network; and\n-\t5GS access network.\nFigure 4.0 below represents the IMS reference architecture including interfaces towards CS network and other IP based multimedia Networks. Details of the roles of these nodes are described in clauses 4.6, 4.7 and 4.7a.\nNOTE 1:\tSome entities defined as part of the IMS Subsystem can also be used by other subsystems.\nNOTE 2:\tThe Ici and Izi reference points are only applicable for IP Multimedia Networks that are IMS subsystems.\nNOTE 3:\tIn certain configuration, two entities can exchange SIP messages directly with each other without a reference point being defined between them (e.g. intermediate entity(ies) not record-routed).\nFigure 4.0: Reference Architecture of the IP Multimedia Core Network Subsystem\nA description of the functional entities can be found in TS 23.002 [1].",
      "chunk_type": "definition",
      "cross_references": [
        "figure_4.0",
        "ts_23.002"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.1",
      "section_id": "4.1",
      "section_title": "Relationship to CS domain and the IP-Connectivity Access Network",
      "content": "The IP multimedia subsystem utilizes the IP‑CAN to transport multimedia signalling and bearer traffic. IP‑CANs that maintain the service while the terminal moves, hide these moves from the IP multimedia subsystem.\nThe IP multimedia subsystem is independent of the CS domain although some network elements may be common with the CS domain. This means that it is not necessary to deploy a CS domain in order to support an IP multimedia subsystem based network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.1.1",
      "section_id": "4.2.1.1",
      "section_title": "Support of CAMEL or IN",
      "content": "It shall be possible for an operator to offer access to services based on the CSE or IN Service Environment for its IM CN subsystem subscribers. It should be noted that there is no requirement for any operator to support CAMEL or IN services for their IM CN subsystem subscribers or for inbound roamers.\nFor more information refer to clause 4.2.4.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.2.4"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.2.1.2",
      "section_id": "4.2.1.2",
      "section_title": "Support of OSA",
      "content": "It shall be possible for an operator to offer access to services based on OSA for its IM CN subsystem subscribers. This shall be supported by an OSA API between the Application Server (AS) and the network.\nFor more information refer to clause 4.2.4.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.2.4"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.2.1.3.1",
      "section_id": "4.2.1.3.1",
      "section_title": "Service information exchanged between Application Servers",
      "content": "To avoid conflicting interactions between services they execute, different ASs involved in the same IMS session (within an operator network or across networks) shall be able to exchange the following service interaction information:\n-\tindication of services that have been performed, and\n-\toptionally, additional indication of services that should be further avoided.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.1.3.2",
      "section_id": "4.2.1.3.2",
      "section_title": "Handling by the Application Server",
      "content": "If an AS provides one or more services, the AS may include service interaction information in SIP signalling, identifying the service that it has executed.\nIf an AS provides one or more services which are known to be negatively impacted by the subsequent execution of a service by another AS, the AS may include, in addition to the an indication of the services executed, service interaction information in SIP signalling, indicating the services that should be avoided.\nAn AS receiving a SIP message containing an indication\n-\tthat a service has been executed previously, and/or\n-\tthat a service should be avoided,\nmay, depending on local policy, take this information into account. The service interaction information shall be such that an AS receiving this information should not be able to misinterpret the information and shall ignore such information that it does not recognize.\nService interaction information for standardized services shall be standardized but there shall also be the ability to exchange globally unique service information for non-standardized services.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.1.3.3",
      "section_id": "4.2.1.3.3",
      "section_title": "Deletion of services interaction information",
      "content": "The service interaction information shall be removed when it is sent to the UE via P-CSCF or to an entity outside the trust domain or when it is not in compliance with service level agreements with other domains.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.2",
      "section_id": "4.2.2",
      "section_title": "Support of numbers in non-international format in the IMS",
      "content": "Phone or telephone numbers which are not in the international format can allow the access of the visited services (local service numbers) and the access of numbers in a local addressing plan. Since numbers in non-international format are widely used in legacy fixed and mobile CS networks the seamless co-operation with these networks require the support of numbers in non-international format (including local service numbers) in the IMS. It is up to the operator's policy when and which type of numbers in non-international format can be used. In the rest of this clause the term 'visited access network' is used to indicate the network in which the user is physically located. In the case of GPRS access this is the VPLMN. In the case of other access types this is most probably the IP‑CAN provider.\nThe use of numbers in non-international format including local service numbers shall be provided in the following manner:\n1.\tIt shall be possible for the HPLMN to determine whether a user is using a number in non-international format according to an addressing plan used in the visited network or a geo-local service number. This shall be based upon an indication received from the UE. The same indication shall be used to access local services as well as to use a local addressing plan. This indication shall be included in the Request URI of the SIP request. If a user intends to use a number according to an addressing plan used at his/her current physical location or a local service number at his/her current physical location, then there shall be information about the visited access network independently from the location of the P‑CSCF included in the Request-URI of the SIP request.\n2.\tThe P‑CSCF shall route the session towards the S‑CSCF as per the session origination procedures.\nProcessing the Request URI (e.g. address analysis and potential modification such as translation into globally routable format, e.g. a globally routable PSI) shall be performed by an Application Server in the subscriber's Home Network. The S‑CSCF routes the SIP request towards this Home Network Application Server based upon filter criteria which are triggered by the information in the 'local indication' received from the UE. The AS may need to identify the visited access network, e.g. from information in SIP signalling or via the Sh interface.\nWhen clause 4.15a (Roaming Architecture for Voice over IMS with Local Breakout) is in use, and the Home Network decides to loop-back the call to the visited network, and when the indication is received that the number is in accordance with the visited network numbering plan the Home network can choose to not translate numbers in non-international format, and pass on the non-international number as received, to the VPLMN.\nWhen clause 4.15b (Roaming Architecture for Voice over IMS with home routed traffic) is in use, a translation to an international routable number may be needed, but this is beyond the scope of this specification e.g. an implementation specific NNI to the VPLMN (or other 3rd party in the visited country) is needed.\n3.\tThen the AS passes the session request back to the S‑CSCF with Request URI that contains either a globally routable SIP URI or a Tel URI with number in international format, or a Tel URI with number in non-international format if clause 4.15a (Roaming Architecture for Voice over IMS with Local Breakout) is in use and the Home network does not translate the number in non-international format. The SIP request shall contain enough information to route to the network hosting the service or using the addressing plan and allow the terminating network to identify the intended end point (e.g. service).\n4.\tThe S‑CSCF routes the SIP request, via normal IMS routing principles, towards its destination (e.g. a server in the visited access network identified by a PSI) using the Mw or Mm interfaces.\nNOTE:\tFor users who have roamed, services relevant to the locality of the user may also be provided by the home network.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.15"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.2.3",
      "section_id": "4.2.3",
      "section_title": "Support of roaming users",
      "content": "The architecture shall be based on the principle that the service control for Home subscribed services for a roaming subscriber is in the Home network, e.g. the Serving‑CSCF is located in the Home network.\nFigure 4.1: Service Platform in Home Network\nFigure 4.2: External Service Platform\nThere are two possible scenarios to provide services:\n-\tvia the service platform in the Home Network\n-\tvia an external service platform (e.g. third party or visited network)\nThe external service platform entity could be located in either the visited network or in the 3rd party platform. The standardised way for secure 3rd party access to IMS services is via the OSA framework, see clause 4.2.4.\nThe roles that the CSCF plays are described below.\n-\tThe Proxy‑CSCF shall enable the session control to be passed to the Serving‑CSCF.\n-\tThe Serving‑CSCF is located in the home network. The Serving‑CSCF shall invoke service logic.\nA Proxy‑CSCF shall be supported in both roaming and non-roaming case, even when the Serving‑CSCF is located in the same IM CN Subsystem.\nReassigning the Proxy‑CSCF assigned during CSCF discovery is not a requirement in this release. Procedures to allow registration time Proxy‑CSCF reassignment may be considered in future releases.\nProcedures shall be supported to allow assigning different Proxy‑CSCFs when a user registers from multiple UE(s) simultaneously.\nNetwork initiated Proxy‑CSCF reassignment is not a requirement.\nThe use of additional elements to be included in the SIP signalling path is optional. Such additional elements may provide functions as described in clause 4.14 and Annex I.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.2.4",
        "clause_4.14",
        "figure_4.1",
        "figure_4.2"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.2.4",
      "section_id": "4.2.4",
      "section_title": "IP multimedia Subsystem Service Control Interface (ISC)",
      "content": "The ISC interface is between the Serving CSCF and the service platform(s).\nAn Application Server (AS) offering value added IM services resides either in the user's home network or in a third party location. The third party could be a network or simply a stand-alone AS.\nThe Serving‑CSCF to AS interface is used to provide services residing in an AS. Two cases were identified:\n-\tServing‑CSCF to an AS in Home Network.\n-\tServing‑CSCF to an AS in External Network (e.g. Third Party or Visited)\nThe SIP Application Server may host and execute services. The SIP Application Server can influence and impact the SIP session on behalf of the services and it uses the ISC interface to communicate with the S‑CSCF. The S‑CSCF shall be able to supply the AS with information to allow it to execute multiple services in order within a single SIP transaction.\nThe ISC interface shall be able support subscription to event notifications between the Application Server and S‑CSCF to allow the Application Server to be notified of the implicit registered Public User Identities, registration state and UE capabilities and characteristics in terms of SIP User Agent capabilities and characteristics.\nThe S‑CSCF shall decide whether an Application Server is required to receive information related to an incoming initial SIP request to ensure appropriate service handling. The decision at the S‑CSCF is based on (filter) information received from the HSS. This filter information is stored and conveyed on a per Application Server basis for each user. It shall be possible to include a service indication in the filter information, which is used to identify services and the order that they are executed on an Application Server within a single SIP transaction. The name(s)/address(es) information of the Application Server (s) are received from the HSS.\nFor an incoming SIP request, the S‑CSCF shall perform any filtering for ISC interaction before performing other routing procedures towards the terminating user, e.g. forking, caller preferences etc.\nThe S‑CSCF does not handle service interaction issues.\nOnce the IM SSF, OSA SCS or SIP Application Server has been informed of a SIP session request by the S‑CSCF, the IM SSF, OSA SCS or SIP Application Server shall ensure that the S‑CSCF is made aware of any resulting activity by sending messages to the S‑CSCF.\nFrom the perspective of the S‑CSCF, the \"SIP Application server\", \"OSA service capability server\" and \"IM-SSF\" shall exhibit the same interface behaviour.\nWhen the name/address of more than one Application Server is transferred from the HSS, the S‑CSCF shall contact the Application Servers in the order supplied by the HSS. The response from the first Application Server shall be used as the input to the second Application Server. Note that these multiple Application Servers may be any combination of the SIP Application server, OSA service capability server, or IM-SSF types.\nThe S‑CSCF does not provide authentication and security functionality for secure direct third party access to the IM subsystem. The OSA framework provides a standardized way for third party secure access to the IM subsystem.\nIf a S‑CSCF receives a SIP request on the ISC interface that was originated by an Application Server destined to a user served by that S‑CSCF, then the S‑CSCF shall treat the request as a terminating request to that user and provide the terminating request functionality as described above. Both registered and unregistered terminating requests shall be supported.\nIt shall be possible for an Application Server to generate SIP requests and dialogs on behalf of users. Requests originating sessions on behalf of a user are forwarded to the S‑CSCF serving the user, if the AS has knowledge of the S‑CSCF assigned to that user and the S‑CSCF shall perform regular originating procedures for these requests.\nOriginating requests on behalf of registered and unregistered users shall be supported.\nMore specifically the following requirements apply to the IMS Service control interface:\n1.\tThe ISC interface shall be able to convey charging information as per TS 32.240 [25] and TS 32.260 [26].\n2.\tThe protocol on the ISC interface shall allow the S‑CSCF to differentiate between SIP requests on Mw, Mm and Mg interfaces and SIP Requests on the ISC interface.\nFigure 4.3: Void\nBesides the Cx interface the S‑CSCF supports only one standardised protocol for service control, which delegates service execution to an Application Server. The protocol to be used on the ISC interface shall be SIP (as defined by IETF RFC 3261 [12], other relevant IETF RFC's, and additional enhancements introduced to support 3GPP´s needs on the Mw, Mm, Mg interfaces).\nThe notion of a \"SIP leg\" used throughout this specification is identical to the notion of a call leg which is the same as a SIP dialog defined by IETF RFC 3261 [12]. The same SIP leg that is received by the S‑CSCF on the Mw, Mm and Mg interfaces is sent on the ISC interface. The same SIP leg that is received by the S‑CSCF on the ISC interface is sent on the Mw, Mm and Mg interfaces.\nConcerning the relationship between the SIP legs of the ISC interface and the SIP legs of the Mw, Mm, and Mg interfaces the S‑CSCF acts as a SIP proxy, as shown in Figures 4.3a – 4.3e below.\nFigures 4.3a-4.3e below depict the possible high-level interactions envisioned between the S‑CSCF and the Application Server.\nFigure 4.3a: Application Server acting as terminating UA, or redirect server\nFigure 4.3b: Application Server acting as originating UA\nFigure 4.3c: Application Server acting as a SIP proxy\nFigure 4.3d: Application Server performing 3rd party call control\nFigure 4.3e: A SIP leg is passed through the S‑CSCF without Application Server involvement\n4.2.4a\tHSS to service platform Interface\nThe Application Server (SIP Application Server and/or the OSA service capability server and/or IM-SSF) may communicate to the HSS. The Sh and Si interfaces are used for this purpose.\nFor the Sh interface, the following shall apply:\n1.\tThe Sh interface is an intra-operator interface.\n2.\tThe Sh interface is between the HSS and the \"SIP Application Server\" and between the HSS and the \"OSA service capability server\". The HSS is responsible for policing what information will be provided to each individual Application Server.\n3.\tThe Sh interface transports transparent data for e.g. service related data , user related information, etc.In this case, the term transparent implies that the exact representation of the information is not understood by the HSS or the protocol.\n4.\tThe Sh interface also supports mechanisms for transfer of user related data stored in the HSS (e.g. user service related data, MSISDN, visited network capabilities, UE Time Zone and user location information (e.g. cell global ID/Service Area ID or the address of the serving network element, VPLMN ID, etc.)). The Sh interface supports retrieving the Private User Identities using the same Public User Identity. In the case of a Public User Identity being shared across multiple Private User Identities within the same IMS subscription, the Sh interface supports the transfer of the Private User Identities that share the Public User Identity.\nNOTE 1:\tBefore providing information relating to the location of the user to a SIP Application Server, detailed privacy checks frequently need to be performed in order to meet the requirements in TS 22.071 [27]. The SIP Application Server can ensure that these privacy requirements are met by using the Le interface to the GMLC (see TS 23.271 [28]) instead of using the Sh interface.\n5.\tThe Sh interface also supports mechanisms for transfer of standardised data, e.g. for group lists, which can be accessed by different Application Servers. Those Application Servers sharing the data shall understand the data format. This enables sharing of common information between Application Servers, e.g. data managed via the Ut reference point.\n6.\tThe Sh interface also supports mechanisms that allow Application Servers to activate/deactivate their own existing initial filter criteria stored in the HSS on a per subscriber basis.\nThe Si interface is between the HSS and the IM-SSF. It transports CAMEL subscription information including triggers for use by CAMEL based application services.\nNOTE 2:\tCAMEL subscription data can also be transferred from the HSS to the IM-SSF via the Sh interface.\n4.2.4b\tS‑CSCF Service Control Model\nFigure 4.3f: Service Control Model with Incoming Leg Control and Outgoing Leg Control\nFigure 4.3f illustrates the relationship between the S‑CSCF and AS. It includes a first-level of modelling inside the S‑CSCF and inside the AS. To keep the model simple only one incoming leg and one outgoing leg are shown. In practice a session may consist of more than one incoming leg and/or more than one outgoing leg(s), when using User Agents. An AS may create one or more outgoing legs independent of incoming legs. An AS may create one or more outgoing legs even when there are no incoming legs.\nWhile the above figures show session related flows, the service control model can be applied to other SIP transactions such as registration. Incoming or outgoing leg information e.g. state information, may be passed between the S‑CSCF and AS implicitly or explicitly. Implicitly means that SIP information in transit carries information about the state of the session (e.g. an INVITE message received at the S‑CSCF on an incoming leg may be sent to the AS with no changes or with some additional information). Explicitly means that SIP information is generated, e.g. to transfer state change information from an S‑CSCF to an AS in circumstances where there is no ongoing SIP transaction that can be used. It is a matter for Stage 3 design to determine when to use implicit or explicit mechanisms and to determine what extensions to SIP are necessary.\nThe internal model of the S‑CSCF (shown in Figure 4.3f) may sometimes exhibit proxy server like behaviour either by passing the requests to the Application Server or by passing the requests out of the system. A Proxy server may maintain session state or not. The S‑CSCF may sometimes exhibit User Agent like behaviour. Some Applications require state to be maintained in the S‑CSCF. Their exact behaviour depends on the SIP messages being handled, on their context, and on S‑CSCF capabilities needed to support the services. It is a matter for Stage 3 design to determine the more detailed modelling in the S‑CSCF.\nThe internal model of the AS (shown in Figure 4.3f) may exhibit User Agent like behaviour. The exact behaviour depends on the SIP messages being handled and on their context. Detailed Stage 3 modelling for the AS is not required.\nThe definitions used in the model are:\nCombined ILSM OLSM – Incoming/outgoing Leg State Model: Models the behaviour of an S‑CSCF for handling SIP messages on incoming and outgoing session legs. The Combined I/OLSM shall be able to store session state information. It may act on each leg independently, acting as a SIP Proxy, Redirect Server or User Agent dependant on the information received in the SIP request, the filter conditions specified or the state of the session.\nIt shall be possible to split the application handling on each leg and treat each endpoint differently.\nILCM - Incoming Leg Control Model: Models the behaviour of an S‑CSCF for handling SIP information sent to and received from an AS for an incoming session leg. The ILCM shall store transaction state information.\nOLCM - Outgoing Leg Control Model: Models the behaviour of an S‑CSCF for handling SIP information received from and sent to an AS for an outgoing session leg. The OLCM shall store transaction state information.\nAS-ILCM - Application Server Incoming Leg Control Model: Models AS behaviour for handling SIP information for an incoming leg. The AS-ILCM shall store Transaction State, and may optionally store Session State depending on the specific service being executed.\nAS-OLCM - Application Server Outgoing Leg Control Model: Models AS behaviour for handling SIP information for an outgoing leg. The AS-OLCM shall store Transaction State, and may optionally store Session State depending on the specific service being executed.\n4.2.4c\tI-CSCF to AS reference point (Ma)\nThe Ma reference point is between the Interrogating CSCF and the service platform(s).\nThe Interrogating‑CSCF to AS reference point is used to:\n-\tforward SIP requests destined to a Public Service Identity hosted by an Application Server directly to the Application Server;\n-\toriginate a session on behalf of a user or Public Service Identity, if the AS has no knowledge of a S CSCF assigned to that user or Public Service Identity.\nIt shall be possible for an Application Server to originate a session on behalf of users or Public Service Identities. If the AS has no knowledge of the serving S‑CSCF for that user or Public Service Identity, such requests are forwarded to an I‑CSCF, and the I CSCF shall perform regular originating procedures for these requests.\nSession origination requests on behalf of registered and unregistered users shall be supported.\nThe Ma reference point shall be able to convey charging information according to TS 32.240 [25] and TS 32.260 [26].\nThe protocol to be used on the Ma reference point shall be SIP (as defined by RFC 3261 [12], other relevant IETF RFCs, and additional enhancements introduced to support 3GPP´s needs on the Mw, Mm, Mg reference points).\nConcerning the relationship between the SIP legs of the Ma reference point and the SIP legs of the Mw, Mm, and Mg reference points the I‑CSCF acts as a SIP proxy, as shown in Figures 4.3f and 4.3g below.\nFigures 4.3f and 4.3g below depict the possible high-level interactions envisioned between the I‑CSCF and the Application Server.\nFigure 4.3f: I‑CSCF forwarding a SIP request destined to a Public Service Identity to an Application Server hosting this Public Service Identity\nFigure 4.3g: Application Server originating a session on behalf of a user or a Public Service Identity, having no knowledge of the S‑CSCF to use",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.3",
        "ts_32.240",
        "ts_32.260",
        "ts_22.071",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.2.5",
      "section_id": "4.2.5",
      "section_title": "The QoS requirements for an IM CN subsystem session",
      "content": "The selection, deployment, initiation and termination of QoS signalling and resource allocation shall consider the following requirements so as to guarantee the QoS requirement associated with an IM CN subsystem session.\n1.\tIndependence between QoS signalling and Session Control\nThe selection of QoS signalling and resource allocation schemes should be independent of the selected session control protocols. This allows for independent evolution of QoS control and the session control in the IM CN subsystem.\n2.\tNecessity for End-to-End QoS Signalling and Resource -Allocation\nEnd-to-end QoS indication, negotiation and resource allocation during the session set-up in the IM CN subsystem should be enforced for those services and applications that require QoS better than best-effort.\n3.\tVoid.\n4.\tRestricted Resource Access at the IP BS Level\nAccess to the resources and provisioning of QoS at IP BS Level should be authenticated and authorized by applying appropriate QoS policies via the IP Policy Control element\n5.\tRestricted Resource Access at the IP-Connectivity Access Network (i.e. layer-2) Level\nAccess to the resources and provisioning of QoS at the IP-Connectivity Access Network Level should be authenticated and authorized by using existing registration/security/QoS policy control mechanisms of the IP‑CAN.\n6.\tCo-ordination between Session Control and QoS Signalling/Resource Allocation\na.\tIn establishing an IMS session, it shall be possible for an application to request that the resources needed for bearer establishment be successfully allocated before the destination user is alerted.\nb.\tIn establishing an IMS session, it shall be possible, dependent on the application being offered, to prevent the use of the bearer until the session establishment is completed.\nc.\tIn establishing an IMS session, it shall be possible for a terminating application to allow the destination user to participate in determining which bearers shall be established.\nd.\tSuccessful bearer establishment shall include the completion of any required end-to-end QoS signalling, negotiation and resource allocation.\ne.\tIn establishing an IMS session, it shall be possible to use already allocated bearer resources, if these resources fulfil the needs of the session. However, note that QoS policy control mechanisms of the IP‑CAN may not allow to use already allocated bearer resources.\nThe initiation of any required end-to-end QoS signalling, negotiation and resource allocation processes at different network segments shall take place after the initiation and delivery of a session set-up request.\n7.\tThe Efficiency of QoS Signalling and Resource Allocation\nThe sequence of end-to-end QoS signalling, negotiation and resource allocation processes at different network segments should primarily consider the delay in negotiating end-to-end QoS and reserving resources that contributes to the session set-up delay. Parallel or overlapping QoS negotiation and resource reservation shall be allowed where possible.\n8.\tDynamic QoS Negotiation and Resource Allocation\nChanges (upgrading or downgrading) of QoS provided to an active IMS session shall be supported based on either the request from the IM application or the current network loads or link quality (e.g. radio link quality).\nIt shall be possible to maintain a resource allocation in excess of the resources needed for current media flows (but within the restrictions imposed by points #4 and #5 above), in order to e.g. switch to different media flow characteristics without risk of admission control failure.\n9.\tPrevention of Theft of Service\nThe possibility for theft of service in the IM CN subsystem shall be no higher than that for the corresponding packet data and circuit switched services.\n10.\tPrevention of Denial of Service\nThe system unavailability due to denial of service attacks in the IM CN subsystem shall be no greater than that for the corresponding packet data and circuit switched services.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.6",
      "section_id": "4.2.6",
      "section_title": "QoS Requirements for IM CN subsystem signalling",
      "content": "Depending on the bearer establishment mode, the UE or the IP‑CAN shall be able to establish a dedicated signalling IP‑CAN bearer for IM Subsystem related signalling or utilize a general-purpose IP‑CAN bearer for IM subsystem signalling traffic.\nThe use of a dedicated signalling IP‑CAN bearer for IM Subsystem related signalling may provide enhanced QoS for signalling traffic.\nIf a dedicated signalling IP‑CAN bearer is to be used for IM Subsystem related signalling, rules and restrictions may apply to the bearer according to operator implementation. A set of capabilities shall be standardised to provide user experience consistency and satisfy user expectation. The rules and restrictions on other capabilities beyond the standardised set are configured by the operator in the IP‑CAN.\nTo enable the described mechanism to work without requiring end-user interaction and under roaming circumstances, it is a requirement for the UE to be made aware of the rules and restrictions applied by the visited network operator. If there is no mechanism available for providing the information about the restrictions back to the UE, the available set of rules and restrictions in this Release is the set of capabilities as defined below.\nThe dedicated signalling IP‑CAN bearer is subject to restrictions, the capabilities to be applied are defined as follows: all messages from the UE that use a dedicated signalling IP‑CAN bearer shall have their destination restricted to:\n-\tthe P‑CSCF assigned for this UE, or to any one of the set of possible P‑CSCFs that may be assigned to this UE.\n-\tand towards DHCP and DNS servers within the IMS operator's domain where the P‑CSCF is located.\nThe UE is not trusted to implement these restrictions, therefore the restrictions are enforced in the IP‑CAN by the operator.\nThe IP‑CAN shall be able to apply rules and restrictions for the IM CN subsystem traffic. In particular, the IP‑CAN shall be able to identify IM CN subsystem signalling traffic in order for the operator to decide on what particular rating to apply to the IM CN subsystem signalling traffic. This includes the ability to apply a special rating to at least SIP, DHCP, DNS and HTTP traffic for IMS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.7.1",
      "section_id": "4.2.7.1",
      "section_title": "SIP Forking",
      "content": "SIP forking is the ability of a SIP proxy server to fork SIP request messages to multiple destinations according to IETF RFC 3261 [12].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.7.2",
      "section_id": "4.2.7.2",
      "section_title": "Forking within and outside the IM CN Subsystem",
      "content": "The IM CN subsystem shall have the capability to fork requests to multiple destinations; this capability is subject to rules for forking proxies defined in IETF RFC 3261 [12].\n-\tThe S‑CSCF shall support the ability for a Public User Identity to be registered from multiple contact addresses, as defined in IETF RFC 3261 [12]. The S‑CSCF shall support forking so that an incoming SIP request addressed to a Public User Identity is proxied to multiple registered contact addresses. This allows forking across multiple contact addresses of the same Public User Identity.\n-\tWhen multiple contact addresses have been registered, then the S‑CSCF shall exhibit the following behaviour with regards to forking the incoming SIP request:\n1.\tIf the UE has indicated capability information upon IMS registration in terms of SIP User Agent capabilities and characteristics described in IETF RFC 3840 [38], then the S‑CSCF shall use it to generate a target contact set using the matching mechanism described in IETF RFC 3841 [42]. If the UE has not indicated any capabilities for the contact addresses upon registration, then the S‑CSCF may still use the preference information, if indicated for the contact addresses upon registration, as described in the following bullet point below.\n2.\tIf the UE has indicated preference information for contact addresses upon registration, then the S‑CSCF shall use it to decide if parallel or sequential forking is used across the contact addresses that have matching callee capabilities, as described in IETF RFC 3261 [12]. If the UE has not indicated any preference for the matching contact addresses upon registration, or if the preferences for the matching contact addresses have equal value, then it is up to the configuration of the S‑CSCF if parallel or sequential forking is to be performed across the contact addresses that have matching callee capabilities.\n-\tApplication Servers in the IMS shall not act as a forking proxy towards the S‑CSCF in the sense of IETF RFC 3261 [12].\nNOTE 1:\tThe AS may subscribe to the registration event package to retrieve the contact address(es) of the UE. Based on this information the AS may act as a forking proxy in the sense of IETF RFC 3261 [12] towards other nodes than the S‑CSCF.\nNOTE 2:\tThe AS may initiate multiple requests towards the registered Public User Identities of a user, however, this is not considered as forking in the sense of IETF RFC 3261 [12].\nAdditionally, other networks outside the IM CN Subsystem are able to perform SIP forking.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.2.7.3",
      "section_id": "4.2.7.3",
      "section_title": "Support for forked requests",
      "content": "UE and MGCF shall be ready to receive responses generated due to a forked request and behave according to the procedures specified in IETF RFC 3261 [12] and in this clause.\nThe UE and MGCF may accept or reject early dialogues from different terminations as described in IETF RFC 3261 [12], for example if the UE is only capable of supporting a limited number of simultaneous dialogs.\nUpon the reception of a first final 200 OK (for INVITE), the UE or MGCF shall acknowledge the 200 OK. In addition the UE or MGCF may require updating the allocated resources according to the resources needed. If the UE or MGCF receives a subsequent 200 OK, the UE or MGCF shall acknowledge the dialogue and immediately send a BYE to drop the dialog.\nNOTE:\tUpon the reception of a first final 200 OK (for INVITE), the UE or MGCF may terminate the early dialogue, as specified in IETF RFC 3261 [12].\nThe UE and MGCF may include preferences according to IETF RFC 3841 [42], in INVITE's, indicating that proxies should not fork the INVITE request. The S‑CSCF and AS should follow the preferences, if included in the INVITE request. On the terminating side, UE and MGCF shall be able to receive, as specified in IETF RFC 3261 [12], several requests for the same dialog that were forked by a previous SIP entity.\nApplication Servers and MRFCs shall be capable to handle forked requests according to the procedures specified in IETF RFC 3261 [12].",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.3.1",
      "section_id": "4.3.1",
      "section_title": "Address management",
      "content": "The mechanisms for addressing and routing for access to IM CN subsystem services and issues of general IP address management are discussed in TS 23.221 [7].\nWhen a UE is assigned an IPv6 prefix, it can change the global IPv6 address it is currently using via the mechanism defined in IETF RFC 4941 [16a], or similar means. When a UE is registered in the IM CN Subsystem with an IP address, any change to this IP address that is used to access the IM CN subsystem will result in dropping the active SIP dialogs, and shall trigger automatic registration. This automatic registration updates the UE's IP address and security association. To avoid disruption of ongoing IM CN subsystem services, the UE should not change the IP address that it uses to access the IM CN subsystem while engaged in active SIP dialogs (e.g. INVITE or SUBSCRIBE-NOTIFY dialogs).",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.2",
      "section_id": "4.3.2",
      "section_title": "Void",
      "content": "Figure 4.4: Void",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.4"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.3.0",
      "section_id": "4.3.3.0",
      "section_title": "General",
      "content": "There are various identities that may be associated with a user of IP multimedia services. This clause describes these identities and their use.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.3.3.1",
      "section_id": "4.3.3.1",
      "section_title": "Private User Identities",
      "content": "Every IM CN subsystem user shall have one or more Private User Identities. The private identity is assigned by the home network operator, and used, for example, for Registration, Authorization, Administration, and Accounting purposes. This identity shall take the form of a Network Access Identifier (NAI) as defined in IETF RFC 4282 [14]. It is possible for a representation of the IMSI to be contained within the NAI for the private identity.\n-\tThe Private User Identity is not used for routing of SIP messages.\n-\tThe Private User Identity shall be contained in all Registration requests, (including Re-registration and De-registration requests) passed from the UE to the home network.\n-\tAn ISIM application shall securely store one Private User Identity. For UEs supporting only non-3GPP accesses or UEs accessing IMS via SNPN, if neither ISIM nor USIM is present, but IMC is present, the Private User Identity shall be stored in IMC. It shall not be possible for the UE to modify the Private User Identity information stored on the ISIM application or IMC.\n-\tThe Private User Identity is a unique global identity defined by the Home Network Operator, which may be used within the home network to identify the user's subscription (e.g. IM service capability) from a network perspective. The Private User Identity identifies the subscription, not the user.\n-\tThe Private User Identity shall be permanently allocated to a user's subscription (it is not a dynamic identity), and is valid for the duration of the user's subscription with the home network.\n-\tThe Private User Identity is used to identify the user's information (for example authentication information) stored within the HSS (for use for example during Registration).\n-\tThe Private User Identity may be present in charging records based on operator policies.\n-\tThe Private User Identity is authenticated only during registration of the user, (including re-registration and de-registration).\n-\tThe HSS needs to store the Private User Identity.\n-\tThe S‑CSCF needs to obtain and store the Private User Identity upon registration and unregistered termination.\n-\tIf mobile terminated short message service without MSISDN as defined in TS 23.204 [56] is required then the Private User Identity shall be based on the IMSI according to TS 23.003 [24], clause 13.3.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_13.3",
        "ts_23.204",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.3.2",
      "section_id": "4.3.3.2",
      "section_title": "Public User Identities",
      "content": "Every IM CN subsystem user shall have one or more Public User Identities (see TS 22.228 [8]), including at least one taking the form of a SIP URI (see IETF RFC 3261 [12]). The Public User Identity is used by any user for requesting communications to other users. For example, this might be included on a business card.\n-\tBoth telecom numbering and Internet naming schemes can be used to address users depending on the Public User identities that the users have.\n-\tThe Public User Identity shall take the form as defined in TS 23.003 [24].\n-\tAn ISIM application shall securely store at least one Public User Identity. For UEs supporting only non-3GPP accesses or UEs accessing IMS via SNPN, if neither ISIM nor USIM is present, but IMC is present, the Public User Identity shall be stored in IMC. It shall not be possible for the UE to modify the Public User Identity, but it is not required that all additional Public User Identities be stored on the ISIM application or IMC.\n-\tA Public User Identity shall be registered either explicitly or implicitly before originating IMS sessions and originating IMS session unrelated procedures can be established by a UE using the Public User Identity. Subscriber-specific services for unregistered users may nevertheless be executed as described in clause 5.6.5. Each implicit registration set shall contain at least one Public User Identity taking the form of a SIP URI.\nNOTE:\tAn implicit registration set can contain Public User Identities of more than one service profile. When sending a third party registration request (for details see clause 5.4.1.7 in TS 24.229 [10a]) to an AS based on an initial filter criteria in a service profile, the third party registration request will include a Public User Identity taking the form of a SIP URI from that service profile within the implicit registration set.\n-\tIt shall be possible to identify Alias Public User Identities. For such a group of Public User Identities, operations that enable changes to the service profile and the service data configured shall apply to all the Public User Identities within the group. This grouping information shall be stored in the HSS. It shall be possible to make this grouping information available to the AS via the Sh interface, and Sh operations are applicable to all of the Public User Identities within the same Alias Public User Identity group. It shall be possible to make this information available to the S‑CSCF via the Cx interface. It shall be possible to make this information available to the UE via the Gm interface.\n-\tA Public User Identity shall be registered either explicitly or implicitly before terminating IMS sessions and terminating IMS session unrelated procedures can be delivered to the UE of the user that the Public User Identity belongs to. Subscriber-specific services for unregistered users may nevertheless be executed as described in clause 5.12.\n-\tIt shall be possible to register globally (i.e. through one single UE request) a user that has more than one public identity via a mechanism within the IP multimedia CN subsystem (e.g. by using an Implicit Registration Set). This shall not preclude the user from registering individually some of his/her public identities if needed.\n-\tPublic User Identities are not authenticated by the network during registration.\n-\tPublic User Identities may be used to identify the user's information within the HSS (for example during mobile terminated session set-up).\n4.3.3.2a\tGlobally Routable User Agent URI (GRUU)\nA Globally Routable User Agent URI (GRUU) is an identity that identifies a unique combination of Public User Identity and UE instance that allows a UE to address a SIP request to a specific Public User Identity UE combination instance, as opposed to a Public User Identity, in order to ensure that the SIP request is not forked to another registered UE of the same Public User Identity. There are two types of GRUUs; Public GRUUs (P‑GRUUs) and Temporary GRUUs (T‑GRUUs). P‑GRUUs are GRUUs that reveal the Public User Identity of the user and are very long lived. T‑GRUUs are GRUUs that contain a URI that do not reveal the Public User Identity of the user and are valid until the contact is explicitly de-registered or the current registration expires. The IM CN subsystem shall support the capability for IMS UEs to obtain both T‑GRUUs and P‑GRUUs when performing IMS registration, exchange GRUUs using SIP requests and responses and use GRUUs to address SIP requests to specific UEs according to RFC 5627 [49].\n4.3.3.2a.1\tArchitecture Requirements\nThe following architectural requirements shall apply to support of GRUU in the IMS:\n0.\tIf a UE could become engaged in a service (e.g. telephony supplementary service) that potentially requires the ability to identify and interact with a specific UE even when multiple UEs share the same single Public User Identity then the UE should support GRUU.\n1.\tA GRUU shall be registered in the IMS network with a unique combination of specific Public User Identity and UE.\n2.\tIf a UE supports GRUU, it shall indicate support for a GRUU that is associated with a specific Public User Identity at the time of registration of the Public User Identity. The UE shall use the same instance ID for all registration requests regardless of the access network used for registration. A function that registers on behalf of a UE shall use the same Instance ID as if that UE had performed the registration itself.\nNOTE 1:\tIf the UICC is replaced the UE is still considered to be same UE instance and so the UE instance ID is not changed by using a different UICC.\n3.\tThe IMS network shall be able to receive an indication of support for GRUU for a specific Public User Identity at a specific UE instance and be able to generate both P‑GRUU's and T‑GRUU's and return them back to the UE that indicated support for GRUU.\nNOTE 2:\tThe UE may have a registration request that indicates GRUU support, but the GRUU will not be returned if IMS network does not support generation of GRUUs.\n4.\tWhen the IMS network receives indication of GRUU support for a specific Public User Identity from the UE during a registration request, the IMS network shall also generate P‑GRUU's and T‑GRUU's for all implicitly registered Public User Identities belonging to the same implicit registration set. The IMS network shall communicate all these other GRUUs to the UE.\n5.\tRegistrations of all GRUUs associated with a specific Public User Identity shall also be directed to the same S‑CSCF.\n6.\tThe IMS network will be able to generate GRUU's for any UE registered with a valid SIP URI.\n7.\tThe IMS network shall generate the same P‑GRUU for a given Public User Identity and Instance Identifier combination.\n8.\tThe IMS network shall generate a different T‑GRUU for a given Public User Identity and Instance Identifier combination for each registration and re-registration.\n9.\tThe IMS network shall be able to derive the Public User Identity directly from the P‑GRUU. The Public User Identity derived from the P‑GRUU used to identify the contact address of the sender shall be same as the Public User Identity used to identify the initiator or an associated Public User Identity. If the URI in the SIP Contact header of the sender carries a parameter indicating that it is a GRUU but does not comply with the stated requirement or if there is no registration corresponding to the GRUU, then the IMS network should reject the request.\n10.\tThe IMS network shall be able to route requests destined to a GRUU to the UE instance registered with that GRUU.\n11.\tThe IMS network shall not fork SIP requests addressed to a GRUU to separate UEs.\n12.\tA UE that is capable of supporting GRUUs shall be able to differentiate between a GRUU and a Public User Identity.\n13.\tThe IMS network shall support establishment of session or non-session related communication using a GRUU.\n14.\tA UE supporting GRUUs shall be able to inter-work with an IMS network not supporting GRUUs.\n15.\tA UE supporting GRUUs shall be able to inter-work with a UE not supporting GRUUs per RFC 5627 [49].\n16.\tA UE or network that supports GRUUs shall not negatively affect networks or UEs that do not support GRUUs.\n17.\tIt shall be possible to define iFCs that match the Public User Identity part of a GRUU.\n18.\tIt shall be possible for iFCs to determine whether the Request URI of a message contains a GRUU, and then trigger to Application Servers that are only applicable for GRUUs.\n19.\tIt shall be possible to provide terminating services to a GRUU associated with a currently unregistered subscriber.\nNOTE 3:\tThe network may not be able to validate the unregistered GRUU of a currently unregistered or registered subscriber, such that operator policy might restrict the services available to the GRUU under these conditions.\n20.\tIt shall be possible to apply same level of privacy irrespective whether GRUU is used or not.\n4.3.3.2b\tWildcarded Public User Identity\nIt shall be possible to support a wildcarded Public User Identity. A wildcarded Public User Identity expresses a set of Public User Identities grouped together. It shall be possible to include and express the wildcarded Public User Identity in the implicit registration set according to clause 5.2.1a.\nOnly distinct Public User Identities shall be used for explicit registration. The implicit registration of a wildcarded Public User Identity shall be handled in the same manner as the implicit registration of a distinct Public User Identity from a network perspective, with only one service profile associated to the wildcarded Public User Identity.\nIt shall be possible for a user to have a distinct Public User Identity even if it matches a wildcarded Public User Identity. Such a distinct Public User Identity may have a different service profile than the wildcarded Public User Identity.\nEditor's note:\tIt is to TBD if a distinct Public User Identity shall be included in the same implicit registration or not. If stage 3 protocol solution found for this issue, then they can be in separate implicit registration set.\nThe matching of a distinct Public User Identity shall take precedence over matching of wildcarded Public User Identity. When the value of a Public User Identity matches what is expressed as an implicitly registered wildcarded Public User Identity and there is no better match, then the procedures are the same as in the case that the identifier matches an implicitly registered distinct Public User Identity.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.6.5",
        "ts_24.229_clause_5.4.1.7",
        "clause_5.12",
        "clause_5.2.1",
        "ts_22.228",
        "ts_23.003",
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.3.3",
      "section_id": "4.3.3.3",
      "section_title": "Routing of SIP signalling within the IP multimedia subsystem",
      "content": "Routing of SIP signalling within the IMS shall use SIP URIs or other (non SIP) AbsoluteURIs. AbsoluteURIs are defined in IETF RFC 3986 [13]. Routing of SIP signalling within the IMS using AbsoluteURI (non SIP) shall only be supported for IMS signalling from IMS user to external networks. E.164 [2] format Public User Identities shall not be used for routing within the IMS, and session requests based upon E.164 format Public User Identities will require conversion into SIP URI format for internal IMS usage.\n4.3.3.3a\tHandling of dialled number formats\nWhen using a phone number as the dialled address, the UE can provide this number in the form of a SIP URI or a TEL URI. This phone number can be in the form of E.164 format (prefixed with a '+' sign), or a local format using local dialling plan and prefix. The IMS will interpret the phone number with a leading '+' to be a fully defined international number.\n4.3.3.3b\tTermination of session with the TEL URI format Public User Identity\nIf a terminating session with a TEL URI is used, the HSS and the SLF (in the case that more than one independently addressable HSS is utilized by a network operator) shall support the TEL URI format Public User Identity.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.3.3.4",
      "section_id": "4.3.3.4",
      "section_title": "Relationship of Private and Public User Identities",
      "content": "The home network operator is responsible for the assignment of the Private User Identities, and Public User Identities; other identities that are not defined by the operator may also exist.\nFigure 4.5: Relationship of the Private User Identity and Public User Identities\nThe IMS Service Profile is a collection of service and user related data as defined in TS 29.228 [30]. The Service Profile is independent from the Implicit Registration Set, e.g. Public User Identities with different Service Profiles may belong to the same Implicit Registration Set. Initial filter criteria in the service profile provide a simple service logic comprising of user / operator preferences that are of static nature i.e. they do not get changed on a frequent basis. It shall be possible to identify Alias Public User Identities. See clause 4.3.3.2 for more details.\nApplication servers will provide more complex and dynamic service logic that can potentially make use of additional information not available directly via SIP messages (e.g. location, time, day etc.).\nThe IMS service profile is defined and maintained in the HSS and its scope is limited to IM CN Subsystem. A Public User Identity shall be registered at a single S‑CSCF at one time. All Public User Identities of an IMS subscription shall be registered at the same S‑CSCF. The service profile is downloaded from the HSS to the S‑CSCF. Only one service profile shall be associated with a Public User Identity at the S‑CSCF at a given time. Multiple service profiles may be defined in the HSS for a subscription. Each Public User Identity is associated with one and only one service profile. Each service profile is associated with one or more Public User Identities.\nAn ISIM application shall securely store the home domain name of the subscriber. For UEs supporting only non-3GPP accesses or UEs accessing IMS via SNPN, if neither ISIM nor USIM is present, but IMC is present, the home domain name shall be stored in IMC. It shall not be possible for the UE to modify the information from which the home domain name is derived.\nIt is not a requirement for a user to be able to register on behalf of another user which is third party registration specified in IETF RFC 3261 [12] or for a device to be able to register on behalf of another device or for combinations of the above for the IM CN subsystem for this release.\nPublic User Identities may be shared across multiple Private User Identities within the same IMS subscription. Hence, a particular Public User Identity may be simultaneously registered from multiple UEs that use different Private User Identities and different contact addresses. If a Public User Identity is shared among the Private User Identities of a subscription, then it is assumed that all Private User Identities in the IMS subscription share the Public User Identity.\nThe relationship for a shared Public User Identity with Private User Identities, and the resulting relationship with service profiles and IMS subscription, is depicted in Figure 4.6.\nAn IMS subscription may support multiple IMS users.\nNOTE 1:\tThe Public User Identity sharing mechanism described above is not intended to support sharing of identities across large numbers of Private User Identities, since this would result in all these users being forced to be associated with the same IMS subscription and hence the same S‑CSCF.\nNOTE 2:\tSubscription data is assumed to indicate which Public User Identities within a subscription are shared and which are not.\nFigure 4.6: The relation of a shared Public User Identity (Public-ID-2) and Private User Identities\nAll Service Profiles of a user shall be stored in the same HSS, even if the user has one or more shared Public User Identities.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.3.2",
        "figure_4.5",
        "figure_4.6",
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.3.5",
      "section_id": "4.3.3.5",
      "section_title": "Relationship of Public User Identities, GRUUs, and UEs",
      "content": "Each Public User Identity may have one or more Globally Routable User Agent URIs (GRUUs). There are two types of GRUU, P‑GRUUs and T‑GRUUs which are associated with Public User Identities and are generated and assigned to the UE together during registrations and re-registration in a pair of one P‑GRUU and one T‑GRUU. Each pair of a P‑GRUU and a T‑GRUU is associated with one Public User Identity and one UE. During subsequent re-registrations the same P‑GRUU will be assigned to the UE but a new and different T‑GRUU will be generated and assigned. After a re-registration all the previous T‑GRUUs generated during the period of this registration are all still valid. A UE may retain some or all of the previous T‑GRUUs obtained during the initial registration or previous re-registrations along with the new T‑GRUU or the UE may replace some or all of the previous T‑GRUUs with the new T‑GRUU. The current set of the P‑GRUU and all T‑GRUUs which are currently valid during this registration period is referred to here as the GRUU set. This relationship is depicted in figure 4.6a. If a UE registers (explicitly or implicitly) with multiple Public User Identities, a separate GRUU set is associated with each. If different UEs register with the same Public User Identity, a different GRUU set is associated with each.\nNOTE:\tIf the UICC is replaced the UE is still considered to be same UE instance and if that UE instance with a different UICC registers the same Public User Identity as was registered with the previous UICC the same P-GRUU will be assigned for that Public User Identity UE instance combination.\nFigure 4.6a: The relationship of Public User Identities, GRUUs, and UEs",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.6"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.4",
      "section_id": "4.3.4",
      "section_title": "Identification of network nodes",
      "content": "The CSCF, BGCF and MGCF nodes shall be identifiable using a valid SIP URI (Host Domain Name or Network Address) on those interfaces supporting the SIP protocol, (e.g. Gm, Mw, Mm, and Mg). These SIP URIs would be used when identifying these nodes in header fields of SIP messages. However this does not require that these URIs will be globally published in DNS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.3.5.1",
      "section_id": "4.3.5.1",
      "section_title": "ENUM/DNS translation mechanism",
      "content": "The ENUM/DNS translation mechanism as specified in IETF RFC 3761 [16] can be used by all IMS nodes that require E.164 address to SIP URI resolution. The actual ENUM/DNS database(s) used to perform address translations are outside the scope of 3GPP and are therefore a matter for the network operator. There is no requirement that the universal ENUM service on the Internet be used. As such, it is possible that the ENUM/DNS mechanism uses a different top level domain to that of \"e164.arpa.\" (as mandated in IETF RFC 3761 [16], clause 1.2), therefore, the top level domain to be used for ENUM domain names shall be a network operator configurable option in all IMS nodes that can perform ENUM/DNS resolution.\nIn some scenarios, owners of ENUM servers may require information on who is the querying IMS operator, to determine an appropriate response (including whether to respond at all). This capability is required on the egress of the IMS network, particularly in the presence of shared network elements and intermediary IMS network(s) between the originating IMS operator and target ENUM/DNS server(s).\nENUM databases may contain Number Portability information. Number Portability is further described in clause 4.18.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_1.2",
        "clause_4.18.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.5.2",
      "section_id": "4.3.5.2",
      "section_title": "Handling of Tel URIs",
      "content": "The S‑CSCF shall support the ability to translate the E.164 address contained in a Request-URI in the Tel: URI format (as specified in IETF RFC 3966 [15]) to a SIP routable SIP URI using the ENUM/DNS translation mechanism as specified in clause 4.3.5.1. If this translation succeeds, then the session shall be routed according to the returned SIP URI. If this translation fails, then the session may be forwarded to a BGCF for further routing (e.g. to the PSTN) as described in clause 5.19 or appropriate notification shall be sent to the originating session endpoint, depending on network operator configuration.\nWhen clause 4.15a (Roaming Architecture for Voice over IMS with Local Breakout) is in use, and the Home Network decides to loop-back the call to the visited network, the Home network can choose not to translate the E.164 address in the Request URI to a globally routable SIP URI, and leave it to the visited network.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.3.5.1",
        "clause_5.19",
        "clause_4.15"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.5.3",
      "section_id": "4.3.5.3",
      "section_title": "Handling of SIP URIs representing a telephone number",
      "content": "Per network operator policy, the network may attempt to resolve and route a SIP URI representing a telephone number and a domain that does not own the target user using the ENUM/DNS translation mechanism specified in clause 4.3.5.1. The need for address resolution may be triggered by the S‑CSCF, and the I‑CSCF or transit function, as determined by network operator configuration. Procedures applied to the S‑CSCF, I‑CSCF and transit functions are outlined below.\nWhen an originating S‑CSCF receives an originating request with a Request-URI containing the SIP representation of an E.164 number, network operator policy shall dictate whether the procedure shall be carried out for all the domains of the SIP URI where those domains belong to the home network, or not at all. If operator policy indicates that the procedure is to be performed, then the S‑CSCF shall reuse the procedure specified in clause 4.3.5.for handling of Tel URIs.\nIf the operator policy at the originating S‑CSCF dictates that the procedure shall not be performed or the SIP URI containing the representation of an E.164 number contains a domain that does not belong to the home network, then the S‑CSCF shall handle and route the request in the same manner as a SIP URI.\nPrior to an HSS Location Query, the I‑CSCF shall translate a SIP URI representing a telephone number contained in a Request‑URI into the Tel: URI format specified in IETF RFC 3966 [15]. The resultant Tel URI shall then be used for performing the HSS Location Query.\nIf the HSS Location Query response indicates that the user does not exist, and if configured by operator policy, the I‑CSCF shall invoke the portion of transit functionality that translates the E.164 address contained in the Tel URI in the Request‑URI into a routable SIP URI, reusing the procedure specified in 4.3.5.2 for handling of Tel URIs.\nNOTE:\tThe entire transit functionality is not required for this purpose.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.5.1",
        "clause_4.3.5"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.3.6",
      "section_id": "4.3.6",
      "section_title": "Public Service Identities",
      "content": "With the introduction of standardized presence, messaging, conferencing, and group service capabilities in IM CN subsystem, there is a need for Public Service Identities (PSIs). These identities are different from the Public User Identities in the respect that they identify services, which are hosted by Application Servers. In particular, Public Service Identities are used to identify groups, see clause 4.10. For example a chat-type service may use a Public Service Identity (e.g. sip:chatlist_X@example.com) to which the users establish a session to be able to send and receive messages from other session participants. As another example, local service may be identified by a globally routable Public Service Identity.\nPublic Service Identities shall take the form as defined in TS 23.003 [24].\nThe IM CN subsystem shall provide the capability for users to create, manage, and use Public Service Identities under control of AS. It shall be possible to create statically and dynamically a Public Service Identity.\nEach Public Service Identity is hosted by an Application Server, which executes the service specific logic as identified by the Public Service Identity.\nThe IM CN Subsystem shall provide capability of routing IMS messages using Public Service Identity.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.10",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.4",
      "section_id": "4.4",
      "section_title": "Signalling concepts",
      "content": "A Single session control between the UE and CSCF:\n-\tFor Multi-Media type services delivered via the IP‑CAN within this architecture, a single session control protocol shall be used between the user equipment UE and the CSCF (over the Gm reference point).\nProtocols over the Gm reference point :\n-\tThe single protocol applied between the UE and CSCF (over the Gm reference point) within this architecture will be based on SIP (as defined by IETF RFC 3261 [12], other relevant IETF RFC's, and additional enhancements required to support 3GPP's needs).\nA Single session control on the Mw, Mm, Mg, Mi, Mj, Mk, Mx:\n-\tA single session control protocol shall be used on the session control interfaces between:\n-\tMGCF and CSCF (Mg),\n-\tbetween CSCFs (Mw),\n-\tbetween a CSCF/IMS ALG and external IP networks (Mm),\n-\tbetween CSCF and BGCF (Mi),\n-\tbetween BGCF and MGCF (Mj),\n-\tbetween BGCF/IMS ALG and BGCF (Mk), and\n-\tbetween BGCF/CSCF and IBCF (Mx).\nProtocols for the Mw, Mm, Mg, Mi, Mj, Mk, Mx:\n-\tThe single session control protocol applied to these interfaces will be based on SIP (as defined by IETF RFC 3261 [12], other relevant IETF RFC's, and additional enhancements required to support 3GPP´s needs).\nUNI vs. NNI session control :\n-\tThe SIP based signalling interactions between CN elements may be different than SIP based signalling between the UE and the CSCF.\nBased on operator preference, border control functions may be applied between two IM CN subsystem networks or between an IM CN subsystem network and other SIP based multimedia network, see clause 4.14 and Annex I for details.\nRestrict access from external networks :\n-\tThe signalling solution shall allow the operator to restrict access from external networks (application level).\nAccess to HSS :\n-\tA network operator can control access to the HSS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.14"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.5",
      "section_id": "4.5",
      "section_title": "Mobility related concepts",
      "content": "The following procedures are supported by an UE when accessing IMS:\n-\tConnect to the IP‑CAN and acquire the necessary IP address, which includes, or is followed by, the P‑CSCF discovery procedure. The mobility related procedures and IP address management principles for the IP‑CAN are described in the relevant IP‑CAN specifications;\n-\tRegister to the IM subsystem as defined by the IMS registration procedures;\n-\tIf an UE explicitly deactivates the IP‑CAN bearer that is being used for IMS signalling, it shall first de-register from the IMS (while there is no IMS session in progress);\n-\tIf an UE explicitly deactivates the IP‑CAN bearer that is being used for IMS signalling while an IMS session is in progress, the UE must first release the session and de-register from the IMS and then deactivate the IP‑CAN bearers;\n-\tIf an UE changes its IP address according to IP‑CAN procedures (e.g. TS 23.221 [7]), the UE shall re- register in the IMS by executing the IMS registration;\n-\tIf an UE acquires an additional IP address due to establishing an additional IP‑CAN bearer through a different access network, the UE may perform an IMS registration using this IP address as the contact address. If IMS registration is performed, this IMS registration may co-exist with the previous IMS registration from this UE and the UE shall be notified that this IMS registration results in multiple simultaneous registrations.\n-\tIn order to be able to deliver an incoming IMS session, the IP‑CAN bearer that is being used for IMS signalling need to remain active as long as the UE is registered in the IM CN subsystem;",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.6.0",
      "section_id": "4.6.0",
      "section_title": "General",
      "content": "The CSCF may take on various roles as used in the IP multimedia subsystem. The following clauses describe these various roles.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.6.1",
      "section_id": "4.6.1",
      "section_title": "Proxy‑CSCF",
      "content": "The Proxy‑CSCF (P‑CSCF) is the first contact point within the IM CN subsystem. Its address is discovered by UEs using the mechanism described in the clause \"Procedures related to Local CSCF Discovery\". The P‑CSCF behaves like a Proxy (as defined in IETF RFC 3261 [12] or subsequent versions), i.e. it accepts requests and services them internally or forwards them on. The P‑CSCF shall not modify the Request URI in the SIP INVITE message. The P‑CSCF may behave as a User Agent (as defined in the IETF RFC 3261 [12] or subsequent versions), i.e. in abnormal conditions it may terminate and independently generate SIP transactions.\nNOTE 1:\tWhen requests are sent towards another domain they may, if required, be routed via a local network exit point (IBCF), which will then forward the request to the entry point of the other domain. More details on this can be found in clause 4.14 and Annex I.\nThe P-CSCF in the role of an AF may interact with the Policy and Charging Architecture; the P-CSCF may interact over the Rx interface (see TS 29.214 [11]) with the Policy and Charging Architecture defined in TS 23.203 [54]; the P-CSCF may interact over the Rx interface (see TS 29.214 [11]) or over the N5 interface (using the Npcf_PolicyAutorization service, see TS 29.514 [96]) with the Policy and Charging Architecture defined in TS 23.503 [95].\nThe functions performed by the P‑CSCF are:\n-\tForward the SIP register request received from the UE to an entry point determined using the home domain name, as provided by the UE.\n-\tForward SIP messages received from the UE to the SIP server (e.g. S‑CSCF) whose name the P‑CSCF has received as a result of the registration procedure.\n-\tEnsure that the SIP messages received from the UE to the SIP server (e.g. S‑CSCF) contain the correct or up to date information about the access network type currently used by the UE, when the information is available from the access network. Depending on operator policies, the P‑CSCF may insert in any SIP message (request or response) the access network type currently used by the UE, when the information is available from the access network.\nNOTE 2:\tFor the 3GPP access network, the P‑CSCF can derive information about the access network type currently used by the UE using PCC mechanisms as specified in TS 23.203 [54] and in TS 29.214 [11], or in TS 23.503 [95] and in TS 29.514 [96].\nNOTE 3:\tIMS entities other than P‑CSCF will not be informed by this mechanism of the change in the access network unless SIP messages are exchanged.\n-\tBased on operator policies, and the availability of the user location information and/or UE Time Zone from the access network, ensure that relevant SIP messages contain the correct or up to date information about the user location information, and/or UE Time Zone provided by the access network currently used by the UE.\nNOTE 4:\tFor the 3GPP access networks and for TWAN access (as defined in clause 16 of TS 23.402 [82]), the P‑CSCF can retrieve user location information and/or UE Time Zone related to the access network currently used by the UE using PCC mechanisms, as specified in TS 23.203 [54] and in TS 29.214 [11], or in TS 23.503 [95] and in TS 29.514 [96].\n-\tForward the SIP request or response to the UE.\nDetect and handle an emergency session establishment request.\n-\tGeneration of CDRs.\n-\tMaintain a Security Association between itself and each UE, as defined in TS 33.203 [19].\n-\tShould perform SIP message compression/decompression.\n-\tAuthorization of bearer resources and QoS management. For details see TS 23.203 [54] and TS 23.503 [95].\n-\tDetection and handling of an originating or terminating IMS MPS session establishment or session modification request (see also clause 5.21).\n-\tMay support the Paging Policy Differentiation for IMS conversational voice as described in clause E.9 and clause Y.9.\n-\tMay subscribe to notification of changes in the type of access network using PCC mechanisms as specified in TS 23.203 [54] and in TS 29.214 [11] or in TS 23.503 [95] and in TS 29.514 [96].",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.14",
        "ts_23.402_clause_16",
        "clause_5.21",
        "ts_29.214",
        "ts_23.203",
        "ts_29.514",
        "ts_23.503",
        "ts_23.402",
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.6.2.0",
      "section_id": "4.6.2.0",
      "section_title": "General",
      "content": "Interrogating‑CSCF (I‑CSCF) is the contact point within an operator's network for all connections destined to a user of that network operator, or a roaming user currently located within that network operator's service area.\nNOTE- 1:\tIf border control concepts are applied, the contact point within an operator's network may be different, see clause 4.14 and Annex I for details.\nNOTE 2:\tWhen requests are sent towards another domain they may, if required, be routed via a local network exit point (IBCF), which will then forward the request to the entry point of the other domain. More details on this can be found in clause 4.14 and Annex I.\nThere may be multiple I‑CSCFs within an operator's network. The functions performed by the I‑CSCF are:\nRegistration\n-\tAssigning a S‑CSCF to a user performing SIP registration (see the clause on Procedures related to Serving‑CSCF assignment)\nSession-related and session-unrelated flows\n-\tRoute a SIP request received from another network towards the S‑CSCF.\n-\tTranslate the E.164 address contained in all Request‑URIs having the SIP URI with user=phone parameter format into the Tel: URI format of IETF RFC 3966 [15] before performing the HSS Location Query. In the event the user does not exist, and if configured by operator policy, the I‑CSCF may invoke the portion of the transit functionality that translates the E.164 address contained in the Request‑URI of the Tel: URI format to a routable SIP URI.\n-\tObtain from HSS the Address of the S‑CSCF.\n-\tForward the SIP request or response to the S‑CSCF determined by the step above\nBased on local configuration, the I‑CSCF may perform transit routing functions (see clause 5.19). If the I‑CSCF determines, based on an HSS query, that the destination of the session is not within the IMS, it may forward the request or it may return with a failure response toward the originating endpoint.\nCharging and resource utilisation:\n-\tGeneration of CDRs.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.14",
        "clause_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.6.3",
      "section_id": "4.6.3",
      "section_title": "Serving‑CSCF",
      "content": "The Serving‑CSCF (S‑CSCF) performs the session control services for the UE. It maintains a session state as needed by the network operator for support of the services. Within an operator's network, different S‑CSCFs may have different functionalities. The functions performed by the S‑CSCF during a session are:\nFor Registration:\n-\tMay behave as a Registrar as defined in IETF RFC 3261 [12] or subsequent versions, i.e. it accepts registration requests and makes its information available through the location server (e.g. HSS).\n-\tWhen a registration request includes an Instance ID with the contact being registered and indicates support for GRUU, the S‑CSCF shall assign a unique P‑GRUU and a new and unique T‑GRUU to the combination of Public User Identity and Instance ID.\n-\tIf a registration request indicates support for GRUU, the S‑CSCF shall return the GRUU set assigned to each currently registered Instance ID.\n-\tThe S‑CSCF shall notify subscribers about registration changes, including the GRUU sets assigned to registered instances.\n-\tDuring registration process, the S-CSCF shall provide policy information, if available, for a Public User Identity from the HSS to the P-CSCF and/or UE.\nNOTE 1:\tFor example, the policy information includes MPS IMS Subscription status and policy applicable to enterprise network subscribers.\nFor Session-related and session-unrelated flows:\n-\tSession control for the registered endpoint's sessions. It shall reject IMS communication to/from Public User Identity(s) that are barred for IMS communications after completion of registration, as described in clause 5.2.1.\n-\tMay behave as a Proxy Server as defined in IETF RFC 3261 [12] or subsequent versions, i.e. it accepts requests and services them internally or forwards them on, possibly after translation.\n-\tMay behave as a User Agent as defined in IETF RFC 3261 [12] or subsequent versions, i.e. it may terminate and independently generate SIP transactions.\n-\tBased on the determined served user, handle interaction with Services Platforms for the support of Services\n-\tProvide endpoints with service event related information (e.g. notification of tones/announcement together with location of additional media resources, billing notification)\n-\tFor an originating endpoint (i.e. the originating user/UE, or originating AS)\n-\tObtain from a database the Address of the entry point for the network operator serving the destination user from the destination name (e.g. dialled phone number or SIP URI), when the destination user is a customer of a different network operator, and forward the SIP request or response to that entry point.\nIf a GRUU is received as the contact, ensures that the Public User Identity of the served user in the request and the Public User Identity encapsulated in the P‑GRUU or associated with the T‑GRUU belongs to the same service profile.\n-\tWhen the destination name of the destination user (e.g. dialled phone number or SIP URI), and the originating user is a customer of the same network operator, forward the SIP request or response to an I‑CSCF within the operator's network.\n-\tDepending on operator policy, forward the SIP request or response to another SIP server located within an ISP domain outside of the IM CN subsystem.\n-\tForward the SIP request or response to a BGCF for call routing to the PSTN or CS Domain.\n-\tEnsure the originating end point is subscribed to the determined IMS communication service.\n-\tEnsure that the content of the SIP request or response (e.g. value included in Content-Type SIP header, media lines included in SDP) sent or received by the originating endpoint matches the determined IMS communication service definition, based on originating user's subscription.\n-\tWhen the INVITE message includes an MPS code or an MPS input string, forward the INVITE, including the Service User's priority level if available.\n-\tWhen an MPS user is authorized by an AS for priority service, include the Service User's priority level received from the AS in the INVITE and forward the INVITE.\nNOTE 2:\tThe mechanism to provide authorisation by an AS for priority service is out of scope of this specification.\n-\tAttestation of the identity of the originating subscriber if configured through operator policies. Optionally the S-CSCF can invoke an AS for attestation of the identity of originating subscriber, if configured through operator policies.\nNOTE 3:\tOnly one network element performs attestation for an originating subscriber in the originating network.\n-\tAssertion of authorization for the Resource-Priority information for an IMS priority session if configured through operator policies. Optionally, the S-CSCF can invoke an AS for assertion and signing of the authorization for the Resource-Priority information for the IMS priority session, if configured through operator policies.\n-\tIf the request is an originating request from an Application Server:\n-\tVerify that the request coming from the AS is an originating request, determine the served user and apply procedures accordingly (e.g. invoke interaction with Service Platforms for originating services, etc.).\n-\tProcess and proceed with the request even if the served user on whose behalf the AS had generated the request is unregistered. If the served user is unregistered, the S‑CSCF shall execute any unregistered origination service logic on behalf of the served user before forwarding requests from an AS.\n-\tProcess and proceed with other requests to and from the served user on whose behalf the AS had generated the request.\n-\tReflect in the charging information that an AS has initiated the session on behalf of a served user.\n-\tFor a destination endpoint (i.e. the terminating user/UE)\n-\tForward the SIP request or response to a P‑CSCF.\n-\tModify the SIP request for routing an incoming session to CS domain according to HSS and service control interactions, if the user is to receive the incoming session via the CS domain.\n-\tForward the SIP request or response to a BGCF for call routing to the PSTN or the CS domain.\n-\tEnsure the terminating end point is subscribed to the determined IMS communication service.\n-\tEnsure that the content of SIP request or response (e.g. value included in Content-Type SIP header, media lines included in SDP) sent or received by the destination end point matches the determined IMS communication service definition, based on terminating user's subscription.\n-\tIf the SIP request contains preferences for characteristics of the destination endpoint, perform preference and capability matching as specified in IETF RFC 3312 [41].\n-\tOptionally for a redirected session, if configured through operator policies, performs attestation of the identity of the diverting subscriber initiating the diversion.\n-\tProxies a terminating request to an AS associated with the terminating user for signature verification if signature verification is required.\nNOTE 4:\tThe S-CSCF would normally proxy any terminating request to an AS via ISC for additional processing.\n-\tFor an originating request with a Request URI containing the SIP representation of an E.164 number, and configured per operator policy:\n-\tthe S‑CSCF attempts translation of the E.164 address in the SIP URI to a globally routable SIP URI using the procedures specified in clause 4.3.5. As stated in clause 4.3.5, if the E.164 address translation fails, the request may be forwarded to a BGCF to allow routing to the PSTN and if the translation succeeds, the Request URI is updated and the request is routed based on the SIP URI that was obtained.\nNOTE 5:\tWhen requests are sent towards another domain they may, if required, be routed via a local network exit point (IBCF), which will then forward the request to the entry point of the other domain. More details on this can be found in clause 4.14 and Annex I.\nBased on local configuration, the S‑CSCF may be provisioned as the contact point within an operator's network for transit IMS scenarios and may perform transit routing functions (see clause 5.19).\nCharging and resource utilisation:\n-\tGeneration of CDRs",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.1",
        "clause_4.3.5",
        "clause_4.14",
        "clause_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.6.4",
      "section_id": "4.6.4",
      "section_title": "Breakout Gateway Control Function",
      "content": "Based on local configuration, the Breakout Gateway Control Function (BGCF) may be provisioned as the contact point within an operator's network for transit IMS scenarios as described in clause 5.19. Otherwise the BGCF processes requests for routing from an S‑CSCF for the case were the S‑CSCF has determined that the session cannot be routed using DNS or ENUM/DNS (see clauses 5.4.3, 5.19 and 4.3.5 for more information).\nThe BGCF determines the next hop for routing the SIP message. This determination may be based on information received in the protocol, administrative information, and/or database access. For PSTN terminations, the BGCF determines the network in which PSTN/CS Domain breakout is to occur. If the routing determination is such that the breakout is to occur in the same network in which the BGCF is located, then the BGCF shall select a MGCF that will be responsible for the interworking with the PSTN/CS Domain. If the routing determination results in break out in another network, the BGCF will forward this session signalling to another BGCF in the selected network. If the routing determination results in the session being destined for another IMS network, the BGCF forwards the message to an I‑CSCF in this IMS network. If the BGCF determines that there is another IP destination for the next hop, it forwards the message to that contact point.\nThere may be multiple BGCFs within an operator's network. The functions performed by the BGCF are:\n-\tDetermines the next hop for SIP routing.\n-\tFor PSTN terminations, select the network in which the interworking with the PSTN/CS Domain is to occur. If the interworking is in another network, then the BGCF will forward the SIP signalling to the BGCF of that network.\n-\tFor PSTN terminations, select the MGCF in the network in which the interworking with PSTN/CS Domain is to occur and forward the SIP signalling to that MGCF. This may not apply if the interworking is a different network.\n-\tGeneration of CDRs\nNOTE:\tWhen requests are sent towards another domain they may, if required, be routed via a local network exit point (IBCF), which will then forward the request to the entry point of the other domain. More details on this can be found in clause 4.14 and Annex I.\nThe BGCF may make use of information received from other protocols, or may make use of administrative information, when making the choice of which network the interworking shall occur.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.19",
        "clause_4.14"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.7",
      "section_id": "4.7",
      "section_title": "Multimedia Resource Function",
      "content": "The architecture concerning the Multimedia Resource Function is presented in Figure 4.7 below.\nFigure 4.7: Architecture of MRF\nThe MRF is split into Multimedia Resource Function Controller (MRFC) and Multimedia Resource Function Processor (MRFP).\nTasks of the MRFC are the following:\n-\tControl the media stream resources in the MRFP.\n-\tInterpret information coming from an AS and S‑CSCF (e.g. session identifier) and control MRFP accordingly.\n-\tGenerate of CDRs.\nTasks of the MRFP include the following:\n-\tControl of the bearer on the Mb reference point.\n-\tProvide resources to be controlled by the MRFC.\n-\tMixing of incoming media streams (e.g. for multiple parties).\n-\tMedia stream source (for multimedia announcements).\n-\tMedia stream processing (e.g. audio transcoding, media analysis).\n-\tFloor Control (i.e. manage access rights to shared resources in a conferencing environment).\nTasks of an Application Server with regards to MRF are e.g. the following:\n-\tConference booking and management of booking information (e.g. start time, duration, list of participants)\nThe protocol used for the Mr and Mr′ reference points is SIP (as defined by IETF RFC 3261 [12], other relevant IETF RFCs, and additional enhancements introduced to support 3GPP´s needs).\nThe Cr reference point allows interaction between an Application Server and an MRFC for media control. Further information on the Cr reference point is provided in TS 23.218 [71].\nThe Mp reference point allows an MRFC to control media stream resources provided by an MRFP.\nThe Mp reference point has the following properties:\n-\tFull compliance with the H.248 standard.\n-\tOpen architecture where extensions (packages) definition work on the interface may be carried out.\nThe protocol for the Mp reference point is described in TS 29.333 [59].\n4.7a\tMedia Resource Broker\nThe MRB supports the sharing of a pool of heterogeneous MRF resources by multiple heterogeneous applications. The MRB assigns (and later releases) specific suitable MRF resources to calls as requested by the consuming applications, based on MRF attributes specified by the applications as well as other criteria. For more information see TS 23.218 [71].",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.7",
        "ts_23.218",
        "ts_29.333"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.8",
      "section_id": "4.8",
      "section_title": "Security Concepts",
      "content": "IM CN Subsystem functional elements provide security, as needed, by security methods defined in TS 33.203 [19] and TS 33.210 [20]. If interacting with external Networks, Security Associations are provided in accordance with operator policy.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203",
        "ts_33.210"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.9",
      "section_id": "4.9",
      "section_title": "Charging Concepts",
      "content": "IM CN subsystem functional elements provide support for offline and online charging. This includes support for charging correlation, e.g. between IM CN subsystem and PS domain. The charging architecture, charging principles and charging data for IM CN subsystem are described in TS 32.240 [25] and TS 32.260 [26]. The charging correlation information between IM CN subsystem and PS domain are also described in TS 24.229 [10a] and TS 29.207 [11a].",
      "chunk_type": "general",
      "cross_references": [
        "ts_32.240",
        "ts_32.260",
        "ts_24.229",
        "ts_29.207"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.10.0",
      "section_id": "4.10.0",
      "section_title": "General",
      "content": "This clause describes architectural concepts to fulfil the requirements for IMS Group Management described in TS 22.250 [32].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_22.250"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.10.1",
      "section_id": "4.10.1",
      "section_title": "IMS group administration",
      "content": "The capabilities required for IMS group management are defined in clause 5.4 of TS 22.250 [32]. The Ut reference point is used to manage groups from the UE. This does not preclude the use of other mechanisms for group management, e.g. using OSA or OA&M mechanisms; the details of these other mechanisms are out of scope of this document.\nThe Ut reference point shall support a scenario where one single Application Server is used to create groups that can be utilized for different services, possibly hosted by different ASs.\nNOTE:\tSuch an Application Server is sometimes referred to as a Group and List Management Server (GLMS).",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.250_clause_5.4",
        "ts_22.250"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.10.2",
      "section_id": "4.10.2",
      "section_title": "Group identifiers",
      "content": "Each group shall be addressable by a globally unique group identifier. The group identifier shall take the form of a Public Service Identifier.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.11",
      "section_id": "4.11",
      "section_title": "Relationship to 3GPP Generic User Profile (GUP)",
      "content": "It shall be possible to apply the mechanisms and format of the 3GPP Generic User Profile (GUP) to IM CN Subsystem user related data. The 3GPP Generic User Profile (GUP) is described in TS 23.240 [31].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.240"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.12",
      "section_id": "4.12",
      "section_title": "Network Address Translation traversal in access network",
      "content": "It shall be possible to support the scenario where a NAT(-PT)/NAPT(-PT) residing between the IMS functionality in the UE and the P‑CSCF has to be traversed for IMS communication. This shall include at least the types of NATs that implement address and port dependent mapping together with address and port dependent filtering, RFC 4787 [51].\nNOTE:\tThe UE may be one piece of equipment, or it may be a network of elements located on a end-user's physical premises.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.13.1",
      "section_id": "4.13.1",
      "section_title": "General",
      "content": "This clause describes the architectural requirements for the identification of IMS communication services.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.13.2",
      "section_id": "4.13.2",
      "section_title": "Identification of IMS communication Services",
      "content": "An IMS Communication Service Identifier (ICSI) provides a framework for the identification of IMS communication services utilising the IMS enablers. An IMS communication service is provided via the use of the IMS enablers. At terminals, the use of a communication service identifier is similar to the use of the port concept in TCP/IP, in that it allows applications in a terminal and the network that use SIP for communication purposes to be identified. In the terminal this means dispatching a SIP message to the correct application, and in the network it means selection of the correct application server over ISC. Examples of IMS based applications and communication services are OMA messaging and OMA PoC.\nAn IMS communication service defines restrictions to which SIP procedures are possible within a single SIP session or standalone transaction and how those SIP procedures are used. The IMS communication service contains an aggregation of zero, one, or several media components and the service logic managing the aggregation, represented in the protocols used. Its behaviour and characteristics may be standardized as done for the two examples above, or proprietary and specific for e.g. an operator or an enterprise.\nA service description specifies this behaviour and states e.g. the allowed media combinations and state transitions as a consequence of signalling and use of IMS enablers in the network and terminals.\nNOTE 1:\tThe application server(s) required to support the IMS communication service are required to be included in the path of the standalone transaction or SIP session at the establishment of the SIP dialogue and therefore can not be linked in after the initial SIP request, i.e. once a SIP session has been established, it is not possible to change the IMS communication service for that session. A UE can establish a new SIP session with another IMS communication service identifier if it is required to add a media that is not supported by the existing IMS communication service.\nThe need of applying a service identifier is to be taken within the specification of each individual service.\nThe communication service identifier identifies IMS communication services and shall be included in the relevant SIP methods.\nThe IMS communication service identifier shall fulfil the following requirements:\n1.\tIt shall be possible for the UE and an Application Server (AS) to set the IMS communication service identifier in a SIP request, e.g. in the REGISTER and INVITE request.\n2.\tBased on operator policy the S‑CSCF or an AS shall be able to validate an IMS communication service identifier in a SIP request. This includes e.g. to check the syntactical correctness of a service identifier, and policing the usage of a communication service identifier. It shall also be possible for the S‑CSCF and an AS to indicate that the value of the IMS communication service is validated. An asserted IMS communication service identifier shall be able to be indicated by the service in SIP responses to the SIP request along with information that the IMS communication service identifier is asserted.\nNOTE 2:\tIf the asserted IMS communication service provided in the SIP response differs from the requested IMS communication service, the UE can make a local decision on whether it wish to continue the session. The UE will ignore any IMS communication service it does not support. User interaction is not needed.\nNOTE 3:\tIf the asserted IMS communication service provided in the SIP response differs from the requested IMS communication service, the VPLMN can make a local decision on whether it wish to continue the session. If continuing, the asserted IMS communication service is used in VPLMN for the remainder of the session (e.g. to provide service aware charging).\n3.\tIt shall be possible, e.g. for the UE, S‑CSCF and AS, to identify an IMS service uniquely by the IMS communication service identifier.\n4.\tIt shall be possible for the S‑CSCF to invoke appropriate service logic based on the IMS communication service identifier contained in a SIP request, e.g. route a SIP request containing a service identifier based on initial filter criteria to the correct AS.\n5.\tIt shall be possible for the UE to invoke appropriate application based on the IMS communication service identifier contained in a received SIP request.\n6.\tIt shall be possible for the UE to indicate its service capabilities to the network, e.g. during registration, using the IMS communication service identifier.\nNOTE 4:\tThe UE does not need to indicate all the service capabilities it supports to the network.\n7.\tIt shall be possible for the network to inform the UE about service capabilities, represented by ICSIs, of the network.\n8.\tThe structure of the IMS communication service identifier shall be as simple as possible, i.e. the IMS communication service identifier shall be limited to identify a service.\n9.\tBased on operator policy S‑CSCF and AS shall consider the IMS communication service identifier for online and offline charging, e.g. put appropriate data into call detailed records.\n10.\tThe communication service identifier shall be capable of being an input into the policy control and charging rules.\n11.\tIt shall be possible to use the IMS communication service identifier as a means to authorize whether a subscriber is allowed to initiate or receive request for a communication service.\n12.\tThe communication service identifier shall be taken into account when selecting the correct UE(s), if multiple UEs are registered for the same Public User Identity(s).\n13.\tThe usage of communication service identifiers shall not adversely affect interoperability between IMS networks and interoperability with external SIP networks and CS networks. The behaviour of a network receiving the IMS requests without an IMS communication service identifier is a matter of operator policy. Usage of communication service identifiers shall not decrease the level of interoperability with networks and UEs that are unaware of the communication service identifier.\n14. It shall be possible for the IMS network and UE to support communications that do not use a communication service identifier. In the case that an IMS communication service identifier is not present then the network may assume a particular IMS communication service.\n15.\tThe usage of communication service identifiers shall not restrict the inherent capabilities of SIP.\n16.\tThe usage of communication service identifiers shall not require additional user interaction, i.e. the communication service identifier is assumed to be \"added\" by the UE that initiates the communication.\n17.\tWhere a communication service needs to be identified, one requested IMS communication service identifier shall be included by the originator of the session in the SIP method that initiates a SIP dialogue or standalone transaction. In addition to the requested IMS communication service, the supported IMS communication services may be included.\n18.\tThis version of the specification does not require the capability to use multiple requested IMS communication service identifiers in the SIP method that initiates a SIP dialogue or standalone transaction. However, the protocol implementation shall nonetheless be prepared to transport more than one requested IMS communication service identifier and the network shall be prepared to handle the situation if multiple IMS communication service identifiers are received but the network is only required to take action on one of the values. The same applies for the UE.\n19.\tTo facilitate service aware charging for roaming, it shall be possible to provide an asserted IMS communication identifier service to the VPLMN.\nThe network and the terminal shall be able to continue operation as defined in 3GPP Release 5 and 3GPP Release 6.\nThe communication service identifier shall be available at least in the following interfaces:\n-\tISC, Gm, Ma, Mi, Mj, Mk, Mw, Mg, Mr, Mr′;\n-\tCx; Dx (e.g. as part of the iFC);\n-\tRx, N5;\n-\tRf, Ro.\nNOTE 5:\tThe communication service identifier does not replace the public service identity (PSI). The communication service identifier would be used to indicate the communication service used to access the service addressed via a PSI, and is required to identify the communication service even when SIP requests are sent towards another entity without using a PSI.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.13.3",
      "section_id": "4.13.3",
      "section_title": "Identification of IMS applications",
      "content": "An IMS application is an application that uses an IMS communication service(s) in order to provide a specific service to the end-user. The IMS application uses specific IMS Communication Service(s) and provides the end user service through the reuse of the SIP communication part of service. The IMS application does not extend the definition of the IMS communication service. The IMS application reference identifies the application utilising the IMS communication service.\nFigure 4.13-1: IMS applications on top of an IMS communication service\nThe IMS application reference is used to identify the IMS applications other than the default for the IMS communication service. The IMS application reference has significance at the UE and the SIP AS behaving as SIP endpoints. The means to transport the IMS application reference is defined within the IMS communication services. When used, it shall be possible to transport the IMS application reference on at least on the following interfaces:\n-\tISC, Gm, Ma; Mi, Mj, Mk, Mw, Mg, Mr, Mr′, Rx, N5, Rf, Ro.\nIt shall be possible to register the IMS application reference. The IMS application reference can be taken into account when selecting the correct UE(s), if multiple UEs are registered for the same Public User Identity(s).",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.13-1"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.14",
      "section_id": "4.14",
      "section_title": "Border Control concepts",
      "content": "Based on operator preference, border control functions may be applied between two IM CN subsystem networks or between an IM CN subsystem network and other SIP based multimedia network. These functions are provided by the IBCF and include:\n-\tControlling transport plane functions;\n-\tSupporting functions to allow establishing communication between disparate address realms' SIP applications;\n-\tSupporting functions to allow establishing communication between IM CN subsystems using different media codecs based on the interworking agreement and session information;\n-\tProviding network configuration hiding to restrict the following information from being passed outside of an operator's network: exact number of S‑CSCFs, capabilities of S‑CSCFs, or capacity of the network, etc;\nNOTE 1:\tNetwork configuration hiding was not intended to be invoked in IMS roaming scenarios when the P‑CSCF and IBCF are both located in the visited network as information available in certain SIP headers may be used by the home network for further processing of signalling messages.\n-\tScreening SIP signalling information based on source/destination and operator policy (e.g. remove information that is of local significance to an operator) and optionally, for an IBCF located in the home network, policing the IMS Communication Service ID;\n-\tGeneration of CDRs;\n-\tInvoking an IWF when interworking between different SIP profiles or different protocols (e.g. SIP and H.323) is necessary; in this case the IWF acts as an entry point for the IMS network;\nNOTE 2:\tIWF and IBCF may be co-located. The IWF is not specified within this release of the specification.\n-\tSelecting the appropriate signalling interconnect.\n-\tIndicating whether an incoming SIP request is to be handled as an originating request by subsequent nodes in the IMS network.\n-\tFor an originating session leaving an IBCF, the IBCF of the originating network, if configured through operator policies, invokes an AS for the signing of attestation and identity information, if available in the incoming request. The IBCF includes the signed information in the outgoing request.\n-\tFor an originating session leaving an IBCF, the IBCF of the originating network, if configured through operator policies, invokes an AS for the signing of Resource-Priority related information, if available in the incoming request. The IBCF includes the signed Resource-Priority related information in the outgoing request.\n-\tFor a terminating session entering the IBCF without identity attestation information, the IBCF adds, if configured through policies, gateway attestation information based on the network from which the request was received.\n-\tFor a terminating session entering the IBCF with signed identity attestation information, the IBCF, if configured through policies, invokes an AS for signature verification.\n-\tFor a terminating session entering the IBCF with signed Resource-Priority information, the IBCF, if configured through policies, invokes an AS for signature verification.\nIf border control concepts are to be applied in an IMS network, the IBCF acts as an entry point for this network (instead of the I‑CSCF), and also acts as an exit point for this network.\nNOTE 3:\tIn this case the IBCF and I‑CSCF may be co-located as a single physical node.\nBased on local configuration, the IBCF may perform transit routing functions (see clause 5.19).\nMore detailed description of these functions is provided in Annex I.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.15.1",
      "section_id": "4.15.1",
      "section_title": "General concepts",
      "content": "IMS generally provides services to end user customers of a network operator by directly supporting multimedia communications services to or from that operator's customers. However IMS may also be used in a number of other configurations where the capabilities of IMS are used to support CS domain customers of an IMS operator or in various other kinds of business arrangements where the capabilities may be used to support interconnection of other networks.\nClause 4.15.2 describes several types of configurations in which IMS might be used to support such network interconnection. These are not intended to represent all possible applications of IMS, but rather provide some basis for the mechanisms by which IMS provides these transit functionalities. Further description of IMS transit network procedures are found in Clauses 5.4a.2 and 5.19.\nClause 4.15.3 describes the cases in which IMS application services can be provided in relation to the IMS transit traffic.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.15.2",
        "clause_4.15.3"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.15.2",
      "section_id": "4.15.2",
      "section_title": "IMS transit network configurations",
      "content": "There are at least three general cases in which IMS may be used for transit network support. These could be classified as in the following:\na)\tIMS operator providing transit functionality for its own, non-IMS (CS domain), customers:In this case the operator is serving its own customers, some of which have been migrated to IMS while others are still CS Domain subscribers. In this case SIP traffic arrives at a configured entry point and PSTN traffic arrives at the operator's MGCF. This is similar to the normal Mobile Terminating cases for IMS, but in this case the CS domain subscribers do not have an IMS subscription. For the case where the destination user is not an IMS subscriber, the operator needs to route the session to the CS domain.\nb)\tIMS operator providing transit functionality to enterprise networks:In this case the operator is serving as a transit network for an enterprise IP network and provides connectivity to both PSTN and IP endpoints. Traffic from the enterprise network arrives at a provisioned routing entity and needs to be routed to either an IP network or to the PSTN depending on the terminating endpoint.\nc)\tIMS operator providing transit functionality to other network operators:In this case the operator is serving as an IMS session based routing backbone for a PSTN operator or another IP network and provides connectivity to both PSTN and IP endpoints (PSTN <‑> PSTN, IP <‑> IP, PSTN <‑> IP). Traffic from the PSTN operator arrives at configured MGCFs for translation to SIP. IMS traffic arrives at a configured entry point. In either case the operator needs to route the traffic to either an IP network or to the PSTN depending on the terminating endpoint.\nAn IMS operator can provide transit functionality as above in addition to (originating or terminating) IMS services. In these situations analysis of an incoming SIP request is required before it can be determined whether transit or terminating services need to be provided for this request.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.15.3",
      "section_id": "4.15.3",
      "section_title": "Providing IMS application services in transit network scenarios",
      "content": "When IMS provides transit functionality to other network operators or enterprise networks, the IMS may also provide IMS applications services to the network operator or enterprise network.\nFigure 4.15.3-1: IMS application services reference point for transit network scenarios\nThe Transit service invocation shall be performed based on local configured Transit invocation criteria that are provided for the specific transit scenario.\nThe Transit invocation criteria for invocation shall have the possibility to take into account,\n-\t(served) preceding network,\n-\t(served) succeeding network, and\n-\tother additional session information.\nNOTE:\tThe Transit invocation criteria are intended to be per served interconnected network basis and not per subscriber basis.\nSimilar to the initial filter criteria for a user profile, the Transit invocation criteria may have service point triggers based on different information in the request, such as source/destination, SIP method, session case, SIP header, and SIP body. The service invocation procedure shall support suppression/avoidance of conflicting services, multiple invocations of the same service and loopback scenarios.\nThe IMS application services provided can be classified as:\na)\tOriginating IMS application services:\nIn this case the IMS operator provides IMS application services for SIP traffic being received from the served network operator or enterprise network. The application services, appropriate for the received SIP traffic, will be invoked when received from the served network, after which the traffic is routed towards the destination endpoint.\nb)\tTerminating IMS application services:\nIn this case the IMS operator provides IMS application services for SIP traffic destined to a served network operator or enterprise network. The application services, appropriate for the received SIP traffic, will be invoked when the served network has been identified as the next network, or when the traffic has been identified as destined to the served network.\n4.15a\tRoaming Architecture for Voice over IMS with Local Breakout\nThe Transit and Roaming Function is the combined functionalities of the transit network functions as defined in clause 4.15 and the roaming specific functions defined in this clause.\nThe following architectural requirements apply:\n-\tThe P-CSCF, S-CSCF, the Transit and Roaming Function, and other nodes performing routing procedures in different networks may control the application of OMR procedures by indicating in the signalling whether an IBCF/TrGW should not apply OMR.\n-\tIn order to allow scenarios where the media is not routed through the originating HPLMN, IBCFs handling incoming requests to the network should support OMR and allow bypass of TrGWs. Anchoring of media may be controlled via outgoing IBCFs.\n-\tThe HPLMN shall decide whether to perform the loopback procedure based on local policy and on knowledge of the support of the procedure in the VPLMN.\n-\tThe VPLMN shall be provided by the HPLMN with enough information to determine whether home routing has been applied (or has not been applied):\n-\tThe HPLMN shall send an indication to the VPLMN that this session set-up is a loopback to allow differentiation from any other incoming call. By this means the VPLMN is able to apply the correct treatment for this looped incoming leg incl. charging and routing decisions.\n-\tIf local policy requires access to BGCF routing data to make the loopback decision for a particular originating INVITE request, then the loopback decision should be performed in the BGCF. Else it should be performed in the S‑CSCF.\n-\tThe Transit and Roaming Function shall perform call routing towards the terminating network by selecting appropriate egress point (e.g. MGCF for CS/PSTN, IBCF to other IMS networks, or I-CSCF for termination in own network). The Transit and Roaming Function may use information such as originating UE location information to select a nearby egress point for media anchoring.\n-\tThe VPLMN may provide the HPLMN with a reference to the preferred Transit and Roaming Function to steer the selection of the Transit and Roaming Function. If the VPLMN does not provide the Transit and Roaming Function address then the HPLMN shall use the default derived address for the VPLMN.\n-\tWhen the HPLMN operator does not use loopback to the Transit and Roaming Function in VPLMN, the HPLMN shall be able to anchor the media. This ensures that the signalling and media are routed together.\nAn overview of the principles and flows of the Roaming Architecture for Voice over IMS with Local Breakout are depicted in Annex M, clause M.3.\n4.15b\tRoaming Architecture for Voice over IMS with home routed traffic\nIn this scenario, the anchor point for the IP address for both the IMS signalling and media traffic is in the home network for a roaming UE, i.e. for 3GPP systems, the GGSN, PGW or UPF for a roaming UE is in the HPLMN of the UE.\nThe following architecture requirements apply:\n-\tThe P-CSCF is located in the HPLMN\nAdditional architecture requirements and functions that are needed to support IMS services with home routed traffic are depicted in Annex W for EPS and in Annex Y for 5GS.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.15",
        "figure_4.15.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.16.1",
      "section_id": "4.16.1",
      "section_title": "Telephony Application Server",
      "content": "The Telephony Application Server is a SIP AS providing the network support for the multimedia telephony service, TS 22.173 [53]. If specific procedures and message flows include or require media interaction, the TAS and MRFC may be collocated.\nNOTE:\tThe support of multimedia telephony services may be allocated to one or more Application Servers.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.173"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.16.2",
      "section_id": "4.16.2",
      "section_title": "Identification of multimedia telephony",
      "content": "The multimedia telephony communication service shall be associated with a communication service identifier to allow easy identification of the service.\nWhen multimedia telephony is supported in a network, Voice/video calls originating from the PSTN/CS domain shall be marked with the communication service identifier associated with multimedia telephony communication service.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.16.3",
      "section_id": "4.16.3",
      "section_title": "Session setup principles",
      "content": "When establishment of UE initiated IP‑CAN bearer(s) for the media is required it is recommended to reserve IP‑CAN bearer(s) at the reception of the SDP answer. If the UE has been made aware of the operator policies with regards to allowed media for the multimedia telephony service, then the UE may reserve IP‑CAN bearer(s) at the sending of the SIP INVITE request. For multimedia telephony, the UE should only mark resource reservation as required for voice and video.\nWhen there are no requirements for resource reservation or when required resources are available on the originating side, the P‑CSCF on the terminating side may send available session information to the PCRF/PCF at the reception of the SDP offer, as in such cases the UE can attempt resource reservation before sending the SDP answer.\nIf configured through policies, the telephony AS, or any other AS, may perform for originating requests attestation of the identity of the originating subscriber.\nIf configured through policies, the telephony AS, or any other AS, may perform for originating IMS priority sessions, assertion of authorization for the Resource-Priority information.\nIf configured through operator policies, the telephony AS may perform for diverted sessions attestation of the identity of the diverting subscriber initiating the diversion,\nIn addition, and if configured through policies, the telephony AS, or any other AS, may perform for terminating requests signature verifications, if one or more signatures is included.\nNOTE:\tOnly one network element performs attestation for an originating subscriber in the originating network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.17.1",
      "section_id": "4.17.1",
      "section_title": "IP Short Message Gateway (IP-SM‑GW)",
      "content": "The IP‑SM‑GW acts as an SIP-AS in the IMS domain to provide the protocol interworking for the delivery of the short message between the UE and the Service Centre. All functionalities and interfaces of IP‑SM‑GW are defined in TS 23.204 [56].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.204"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.18.1",
      "section_id": "4.18.1",
      "section_title": "Number portability",
      "content": "Number portability (NP) allows a user to retain their E.164 number when changing subscriptions from one network operator to another. As such, NP applies to TEL URIs and SIP URIs representing E.164 addresses. NP is subject to regional requirements and is accomplished through the retrieval of ported data from those databases. The specification of these databases is out of the scope of this document, but the NP data may be accessed through ENUM/DNS or accessed via existing (PSTN‑ and CS‑domain) NP databases using the legacy PSTN/CS-domain protocols, such as TCAP.\nSupport of NP within a network and the exact means to make the number portability data available to IMS, is subject to and configured per operator policy. NP is not mandated by this specification on any network operator.\nAs configured per operator policy, IMS ENUM interfaces can be updated to support handling of the PSTN ENUM service per IETF RFC 4769 [57], which provides a URI containing an E.164 number with NP routing information and NP dip indicators. The IMS entity receiving NP information as a result of an ENUM/DNS query (e.g. S‑CSCF), needs to support NP protocol parameters retrieved as part of ENUM/DNS procedures contained in clause 4.3.5. This IMS entity and any subsequent IMS entities/network elements used to process the call to the PSTN shall not remove the NP protocol parameters inserted in SIP messaging as part of the NP data retrieval procedure.\nNP data can also be made available by means of direct access to PSTN/CS‑domain NP Databases using the legacy PSTN/CS-Domain interfaces and protocols. To support this existing interface within the network, the requesting and subsequent network elements need to support, or not remove, NP protocol parameters within SIP messages that result from the NP data retrieval procedures. The procedures to retrieve the NP data using the legacy PSTN/CS‑domain interfaces are out of scope of this specification.\nAlternatively, per operator policy, the BGCF can retrieve NP data as part of the procedures to select an MGCF for PSTN connection. The interface used at the BGCF to retrieve the NP data is out of scope of this specification.\nWhen clause 4.15a (Roaming Architecture for Voice over IMS with Local Breakout) is in use, and the Home Network decides to loop-back the call to the visited network, the Home network can choose not to retrieve NP data, and leave it to the visited network.\nAlternatively, per operator policy, the MGCF may support legacy interfaces to retrieve number portability data.\nNOTE:\tAlthough legacy protocols are used to access the number portability database, this does not imply that the IMS nodes (CSCFs, BGCFs) need to implement such protocols.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.5",
        "clause_4.15"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.19.1",
      "section_id": "4.19.1",
      "section_title": "Preferred Circuit Carrier Access and Per Call Circuit Carrier Selection",
      "content": "Preferred Circuit Carrier Access allows the network operator to configure a preferred long distance circuit carrier for a subscriber, set of subscribers or all subscribers on the network. All long distance calls from a subscriber are routed to the long distance circuit carrier when preferred circuit carrier access applies. A SIP message parameter indicates the preferred circuit carrier selected. This parameter can be delivered to the PSTN. An application server can be used to insert preferred circuit carrier parameters. The BGCF needs to consider, and can insert, the preferred circuit carrier parameters when routing calls towards an MGCF.\nPreferred Circuit Carrier Selection per call, also known as Dial-around, allows the subscriber to request a long distance carrier for a specific call. A dial-around request is dialled by the subscriber along with the called party number at call origination. As configured per operator policy, the dial-around circuit carrier selection can take precedence over other preferred circuit carrier selection that can be configured in the network. Therefore, based on operator policy, the preferred circuit carrier parameter is not to be replaced if already present in a SIP message with a dial-around indicator. A SIP message parameter indicates the preferred circuit carrier selected with a dial-around indicator. This parameter is delivered to the PSTN.\nSupport of preferred circuit carrier access and dial-around is optional within a network and is subject to, and configured per, operator policy.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.20",
      "section_id": "4.20",
      "section_title": "Support of IMS Service Centralization and Continuity",
      "content": "IMS Service Centralization, defined in TS 23.292 [66] provides communication services such that all services, and service control, are based on IMS mechanisms and enablers. It enables IMS services when using CS access as bearer for the media.\nIMS Service Continuity, defined in TS 23.237 [67] provides Session Transfer mechanisms to maintain service continuity in the event of access transfer for the case when such events are not hidden from the IMS session layer and thus service continuity could not otherwise be maintained.\nAll functionalities and reference points are defined in TS 23.292 [66] and TS 23.237 [67].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.292",
        "ts_23.237"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.21",
      "section_id": "4.21",
      "section_title": "Support of Overlap Signalling",
      "content": "The support of overlap signalling consists of the functionality for conversion between overlap and en-bloc, as well as the functionality for digit collection.\nThe above mentioned functionalities may be implemented in different network nodes depending on the operator's deployment strategy (e.g. AS, IBCF, MGCF).\nNOTE 1:\tSupport for overlap signalling in the IMS is an option limited to the interworking function located within the PSTN/ISDN networks that use overlap signalling.\nNOTE 2:\tDigit collection limits the number of messages with incomplete number and to find another node that support overlap signalling.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.22.1",
      "section_id": "4.22.1",
      "section_title": "General",
      "content": "The ECN profile used to trigger codec rate adaptation for Multimedia Telephony is defined in TS 26.114 [76] and affects the following IMS entities: UE, MGCF/IM-MGW, IBCF/TrGW, IMS-ALG/ IMS-AGW, MRFP/MRFC, and the MSC Server enhanced for ICS/MSC Server enhanced for SRVCC with SIP/CS-MGW.\nAs specified in TS 26.114 [76]:\n-\tan MGCF/IM-MGW can be used for inter-working between an ECN-capable client in a 3GPP network that properly handles ECN-marked packets and a CS network;\n-\tan IBCF/TrGW supporting Multimedia Telephony can be used for interworking between an ECN-capable entity in a 3GPP network that properly handles ECN-marked packets, and:\n-\ta remote entity that does not use ECN;\n-\ta remote entity that supports ECN in different way than what is specified for Multimedia Telephony clients;\n-\ta network which does not handle ECN-marked packets properly.\nA UE supporting Multimedia Telephony and ECN shall support the procedures described in TS 26.114 [76].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.22.2",
      "section_id": "4.22.2",
      "section_title": "CS GERAN/UTRAN Interworking at MGCF/IM-MGW",
      "content": "If MGCF/IM-MGW supports Multimedia Telephony compliant ECN, it shall:\n-\tsupport ECN Multimedia Telephony client procedures as described in TS 26.114 [76], except that the MGCF and IM-MGW do not determine whether ECN can be used based on the Radio Access Technology that is used towards the client; the MGCF/ IM-MGW act as an ECN endpoint towards the Multimedia Telephony terminal;\n-\tsupport SDP ability to negotiate to ECN according to TS 26.114 [76];\n-\tbe capable of enabling end-to-end rate adaptation between Multimedia Telephony terminal and the CS terminal or IM-MGW by performing the following:\n-\tnegotiate the use of ECN with the Multimedia Telephony terminal, if it can be confirmed that the network used towards the Multimedia Telephony terminal properly handles ECN-marked packets;\nNOTE 1:\tAn operator can ensure that the network used towards the Multimedia Telephony terminal properly handles ECN-marked packets by setting corresponding requirements on network equipment, and verifying that those requirements are met. No active signalling (\"probing\") during normal operation is required to ensure this.\n-\ttrigger rate adaptation request towards the Multimedia Telephony terminal when receiving in the incoming IMS media flow IP packets marked with ECN-CE, regardless of whether the IM-MGW applies or does not apply transcoding;\n-\tinter-work adaptation requests between the Multimedia Telephony terminal and the CS GERAN/UTRAN when the IM-MGW bridges compatible codec configurations between the interfaces without applying a transcoding function; if the IM-MGW prefers to receive a lower codec mode rate from the Multimedia Telephony terminal than what the CS network indicates, e.g. after having received IP packets with ECN-CE, the IM-MGW may replace the codec mode requested from the CS side with the codec mode that the IM-MGW prefers;\n-\tperform media adaptation (e.g. reduce media bit-rate) towards the Multimedia Telephony terminal when receiving from the latter an adaptation request and the IM-MGW applies transcoding.\nNOTE 2:\tFor CS interworking the MGCF/MGW does not have to perform transcoding if the same codec is selected on the CS and PS network.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.22.3",
      "section_id": "4.22.3",
      "section_title": "Interworking with non-ECN IP network and/or terminal at IBCF/TrGW",
      "content": "An IBCF/TrGW may support Multimedia Telephony using ECN and can be used to enable ECN within the local network when either the remote network cannot be confirmed to properly handle ECN-marked packets or the remote entity does not support or use ECN.\nIn order to support Multimedia Telephony using ECN when interworking with a remote network that cannot be confirmed to properly handle ECN-marked packets and/or with a remote terminal does not support or use ECN, the IBCF/TrGW shall:\n-\tdetermine from local configuration if the remote network properly handles ECN-marked packets;\n-\tdetermine with SDP offer/answer procedures if the remote entity supports ECN;\n-\tsupport SDP ability to negotiate to ECN according to TS 26.114 [76];\n-\tbe capable of enabling end-to-end rate adaptation between the local Multimedia Telephony terminal and the remote entity or TrGW by performing the following towards the local Multimedia Telephony terminal:\n-\tnegotiate the use of ECN;\n-\tsupport ECN Multimedia Telephony client procedures as described in TS 26.114 [76], except that the IBCF/TrGW does not determine whether ECN can be used based on the Radio Access Technology; the IBCF/TrGW acts as an ECN endpoint towards the ECN capable Multimedia Telephony terminal;\n-\ttrigger rate adaptation request towards the Multimedia Telephony terminal when receiving in the incoming IMS media flow IP packets marked with ECN-CE, regardless of whether the TrGW applies or does not apply transcoding; this requires that the IBCF provides the TrGW with the media configuration, even if transcoding is not supported or applied, when the IP termination is configured with ECN;\n-\tforward adaptation requests between the Multimedia Telephony terminal and the remote entity when the TrGW bridges compatible codec configurations between the interfaces without applying a transcoding function; if the TrGW prefers to receive a lower codec mode rate from the Multimedia Telephony terminal than what the other SIP network indicates, e.g. after having received IP packets with ECN-CE, the TrGW may replace the codec mode requested from the other SIP network with the codec mode that the TrGW prefers;\n-\tperform media adaptation (e.g. reduce media bit-rate) towards the Multimedia Telephony terminal when receiving from the latter an adaptation request and the TrGW applies transcoding.\nNOTE:\tFor this interworking the IBCF/TrGW does not have to perform transcoding if the same codec is selected on both sides of the TrGW.",
      "chunk_type": "general",
      "cross_references": [
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.22.4",
      "section_id": "4.22.4",
      "section_title": "Interworking with non-3GPP ECN IP terminal at IBCF/TrGW",
      "content": "An IBCF/TrGW supporting Multimedia Telephony compliant ECN can also be used to enable ECN end-to-end if the remote entity uses ECN in a different way than what is described in TS 26.114 [76], e.g. if the remote entity only supports probing for the ECN initiation phase or it needs the ECN feedback.\nNOTE:\tFor this interworking the IBCF/TrGW does not have to perform transcoding if the same codec is selected between both terminals.",
      "chunk_type": "general",
      "cross_references": [
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.22.5",
      "section_id": "4.22.5",
      "section_title": "ECN support at IMS-ALG/IMS-AGW",
      "content": "The P-CSCF shall be able to disallow the negotiation of ECN during SDP offer/answer exchanges if the IMS-AGW does not support transparent forwarding of the ECN bits or if the IMS core network or the access network used towards the Multimedia Telephony terminal do not properly handle ECN-marked packets.\nAn IMS-AGW supporting ECN shall be able to forward the ECN bits as instructed by the IMS-ALG.\nThe IMS-ALG/IMS-AGW may act as an ECN endpoint towards the access network and/or the IMS Core Network to enable ECN when the ECN connection cannot be established or maintained transparently (e.g. after PS-CS Access Transfer).\nWhen acting as an ECN endpoint the IMS-AGW shall support end-to-end rate adaptation between the local terminal and the remote entity by performing the following:\n-\ttrigger rate adaptation request towards the ECN-capable peer when receiving in the incoming IMS media flow IP packets marked with ECN-CE, regardless of whether the IMS-AGW applies or does not apply transcoding;\n-\tforward adaptation requests between the local and the remote peer when the IMS-AGW bridges compatible codec configurations between the interfaces without applying a transcoding function;\n-\tperform media adaptation (e.g. reduce media bit-rate) towards the ECN-capable peer when receiving from the latter an adaptation request and the IMS-AGW applies transcoding.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.22.6",
      "section_id": "4.22.6",
      "section_title": "ECN support at MRFC/MRFP",
      "content": "An MRFC/MRFP may support Multimedia Telephony using ECN and may act as an ECN endpoint to enable ECN with a local ECN-capable terminal within a local network that properly handles ECN-marked packets (see TS 23.333 [73]).\nThis requires that the MRFC/MRFP performs the following:\n-\tsupport SDP ability to negotiate to ECN according to TS 26.114 [76];\n-\tbe capable of enabling end-to-end rate adaptation between the local Multimedia Telephony terminal and the MRFP by performing the following towards the local Multimedia Telephony terminal:\n-\tnegotiate the use of ECN;\n-\tsupport ECN Multimedia Telephony client procedures as described in TS 26.114 [76], except that the MRFC/MRFP does not determine whether ECN can be used based on the Radio Access Technology; the MRFC/MRFP acts as an ECN endpoint towards the ECN capable Multimedia Telephony terminal;\n-\ttrigger rate adaptation request towards the Multimedia Telephony terminal when receiving in the incoming IMS media flow IP packets marked with ECN-CE;\n-\tperform media adaptation (e.g. reduce media bit-rate) towards the Multimedia Telephony terminal when receiving from the latter an adaptation request.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.333",
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.22.7",
      "section_id": "4.22.7",
      "section_title": "CS GERAN/UTRAN Interworking at the MSC Server enhanced for ICS/MSC Server enhanced for SRVCC with SIP/CS-MGW",
      "content": "If the MSC Server enhanced for ICS/MSC Server enhanced for SRVCC with SIP/CS-MGW supports Multimedia Telephony compliant ECN, it shall support the procedures specified in clause 4.22.2 respectively for the MGCF and IM-MGW.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.22.2"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.23.1",
      "section_id": "4.23.1",
      "section_title": "General",
      "content": "An IMS network may implement functionality for IMS serving network nodes (S‑CSCF, Transit Function) to handle load balancing, i.e. the technique to distribute workload evenly across two or more network nodes implementing the same functions, in order to get optimal resource utilization.\nFor S‑CSCFs, load balancing may be applied for received initial registration requests (see clause 4.23.2).\nFor Transit Functions, load balancing may be applied for received service requests, i.e. initial SIP requests requesting a service (see clause 4.23.3).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.23.2",
        "clause_4.23.3"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.23.2",
      "section_id": "4.23.2",
      "section_title": "Registration-based load balancing of S-CSCFs",
      "content": "Load balancing of S‑CSCFs for received initial registration requests may be based on load balancing functionality performed by an I‑CSCF or it may be based on mechanisms outside IMS functional entities (such as DNS). An example of the DNS-based load balancing approach is the use of functionality that collects load information of S‑CSCFs, applies a load balancing algorithm and provides the outcome to a (Dynamic) DNS, which subsequently is used implicitly by I‑CSCFs.\nAn I‑CSCF that performs load balancing of S‑CSCFs for initial registration requests shall assign a received registration request to one of the available and suitable S‑CSCFs using a load balancing algorithm. Such load balancing algorithm may take load information of the S‑CSCFs into consideration if available. Load information may be obtained via management interfaces, via proprietary interfaces, or via other mechanisms.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.23.3",
      "section_id": "4.23.3",
      "section_title": "Registration independent load balancing of Transit Functions",
      "content": "Load balancing of Transit Functions for received service requests may be based on load balancing functionality performed by an IMS functional entity that is the immediate source of the service request to the Transit Function (e.g. an IBCF or an I‑CSCF), or it may be based on mechanisms outside IMS functional entities (such as DNS). An example of the DNS-based load balancing approach is the use of functionality that collects load information of Transit Functions, applies a load balancing algorithm and provides the outcome to a (Dynamic) DNS, which subsequently is used implicitly by IMS functional entities that require the IP-address of a Transit Function for routing a service request.\nAn IMS functional entity that performs load balancing of Transit Functions for service requests shall assign a received service request to one of the available and suitable Transit Functions using a load balancing algorithm. Such load balancing algorithm may take load information of the Transit Functions into consideration if available. Load information may be obtained via management interfaces, via proprietary interfaces, or via other mechanisms.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.24",
      "section_id": "4.24",
      "section_title": "Support of Restoration Procedures",
      "content": "An I‑CSCF that performs recovery of S‑CSCFs for registration requests shall determine failure of an S‑CSCF implicitly (i.e. via a timeout) or explicitly (i.e. via a failure message) and shall reroute the registration request to another S‑CSCF based on the restoration procedures as defined in TS 23.380 [80].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.25.1",
      "section_id": "4.25.1",
      "section_title": "General",
      "content": "Network elements within the IP Multimedia CN subsystem may have to cope with high volume of signalling traffic with significant traffic peaks. An IMS network may therefore implement overload control functionality in IMS network elements to prevent overload situations.\nFor that purpose, two different mechanisms are provided:\n-\tA mechanism based on next-hop monitoring of overload, where an IMS node acting as a SIP server may provide overload control feedback to its neighbours. This mechanism is described in clause 4.25.2.\nNOTE 1:\tThis mechanism is well suited for preventing overload of core network servers (CSCF) where overload is not due to calls to a specific application/destination.\n-\tA filter-based mechanism where an IMS node acting as SIP server, may send load control filters to another IMS node that has subscribed for receiving this information. This mechanism is described in clause 4.25.3.\nNOTE 2:\tThis mechanism is particularly well suited for application servers when the source of overload is due to calls to a specific destination (e.g. a 800 application overloaded by mass calling to a particular destination).\nEmergency calls shall not be affected by the overload traffic restrictions due to overload control and MPS priority information shall be taken into account when applying by the overload traffic restrictions based on received indications.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.25.2",
        "clause_4.25.3"
      ]
    },
    {
      "chunk_id": "ts_23.228_4.25.2",
      "section_id": "4.25.2",
      "section_title": "Next-hop monitoring of overload",
      "content": "For IMS entities supporting next-hop monitoring of overload, these IMS entities shall support a mechanism for monitoring overload of neighbour nodes with minimal overhead, to enable scenarios where the overload status needs to be adjusted frequently.\nIMS entities supporting SIP, e.g. S-CSCF, shall be able to provide overload control feedback to their neighbours by providing load reduction directives within SIP responses. The neighbour nodes shall be able to adapt the traffic sent to the overloaded node by restricting the traffic offered to the overloaded neighbour node in accordance with the overload status information received.\nIt is recommended that when next-hop monitoring of overload is deployed for a specific function, all neighbour nodes also support the feedback of overload control status and support the overload traffic restriction procedures towards the specific function being monitored.\nThe next hop monitoring of overload procedures should at least be possible to use for the following scenarios:\n-\tNetwork internal overload control between core functions, e.g. between different CSCFs.\n-\tApplication Server overload control (i.e. between CSCF and AS).\n-\tRoaming and Interconnect (e.g. between IBCFs of two different networks).\n-\tTransit scenarios (e.g. between IBCF and Transit function).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.25.3",
      "section_id": "4.25.3",
      "section_title": "Filter based Overload Control",
      "content": "When filter based Overload Control is deployed, an IMS entity supporting SIP overload control (e.g. originating AS or S-CSCF) may subscribe to traffic filter information of specific IMS SIP server destination which may be subject to overload (e.g. an 800 application overloaded by mass calling to a specific number), and perform overload traffic restriction according to the information received. Alternatively, when the destination is not in IMS, the IMS entity performing the overload traffic restrictions may subscribe to an IMS SIP server providing traffic filter information related to the destination, or can have configured overload traffic filter information for the specific destination.\nIMS entities supporting this mechanism shall match all SIP requests they send against received traffic filter information.\nIf such a filter based mechanism is used, it is recommended that the function performing the overload traffic restrictions be as close to originating party as possible, while still having sufficiently aggregated traffic to perform restrictions on, e.g. by allowing the originating AS/S-CSCF to subscribe to the traffic filter information from a terminating AS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_4.26",
      "section_id": "4.26",
      "section_title": "Support for Business Trunking",
      "content": "An IMS network may support business trunking for IP‑PBXs in two different modes.\n-\tRegistration mode, or\n-\tStatic mode.\nIn both modes, the IP‑PBX can be provisioned as a subscriber in the HSS.\nIn registration mode, the IP‑PBX registers to and receives service from the IMS network in same manner as an ordinary subscriber.\nIn static mode, the IP‑PBX does not perform any registration procedures.\nDescription on the support for IP‑PBX business trunking is provided in Annex S and TS 24.525 [81]. The support for business trunking in static mode is provided by either an IBCF or a P‑CSCF and clarified in Annex S.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.525"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.0",
      "section_id": "5.0",
      "section_title": "General",
      "content": "This clause documents the main procedures that are used for the provision of services in the IP multimedia subsystem. These procedures are described using text description as well as information flow diagrams. The procedures described in this document are meant to provide a high level description and are not intended to be exhaustive.\nIn the following clauses, user roaming procedures apply to cases where P‑CSCF is located in the visited network. Procedures for cases where the user is roaming and the P‑CSCF is located in the home network are similar to procedures for a non-roaming user.\n5.0a\tSession-unrelated procedures\nThe IM CN Subsystem provides means to conduct session-unrelated interactions between users, e.g. OPTIONS query, outband REFER. These interactions are described in IETF RFC 3261 [12], and other possible IETF RFCs. The generic capability exchange mechanism is defined in TS 23.279 [52].\nThese interactions shall use and fully comply with the basic mechanisms described for session-related procedures of the IM CN Subsystem. These mechanisms include e.g. routing, security, service control, network hiding as described in other clauses and specifications.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.279"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.1.0",
      "section_id": "5.1.0",
      "section_title": "Establishing IP-Connectivity Access Network bearer for IM CN Subsystem Related Signalling",
      "content": "Before the UE can request IM services, an appropriate IP‑CAN bearer must be available to carry IM Subsystem related signalling.\nFor a UE using the IMS Local Breakout procedure as shown in Annex M, the IP address of the UE obtained from the local Gateway (i.e. single IP address) is used for both IM Subsystem related signalling and media.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.1.0",
      "section_id": "5.1.1.0",
      "section_title": "General",
      "content": "The Proxy‑CSCF discovery shall be performed using one of the following mechanisms:\n-\tAs part of the establishment of connectivity towards the IP-Connectivity Access Network, if the IP-Connectivity Access Network provides such means.\n-\tAlternatively, the P‑CSCF discovery may be performed after the IP connectivity has been established. To enable P‑CSCF discovery after the establishment of IP connectivity, the IP-Connectivity Access Network shall provide the following P‑CSCF discovery option to the UE:\n-\tUse of DHCP to provide the UE with the domain name and/or IP address of a Proxy‑CSCF and the address of a Domain Name Server (DNS) that is capable of resolving the Proxy‑CSCF name, as described below in clause 5.1.1.1.\n-\tThe UE may be configured (e.g. during initial provisioning or via a 3GPP IMS Management Object (MO), TS 24.167 [64] or in the ISIM, TS 31.103 [69]) to know the fully qualified domain name (FQDN) of the P‑CSCF or its IP address. If the domain name is known, DNS resolution is used to obtain the IP address.\nIf DNS is used to obtain the IP address of the P-CSCF, the name-address resolution mechanism is allowed to take the load information of the P-CSCFs (e.g. obtained using network management procedures) into consideration when deciding the address of the P-CSCF for the UE.\nIn the case where UE is aware of more than one P‑CSCF address, the selection shall be based on home operator configured policy to select the P‑CSCF.\nNOTE:\tSubject to home operator policy, the UE selects the Home P‑CSCF to be used by either using a pre-configured Home P‑CSCF FQDN or according to TS 24.167 [64]. This can be done without the UE first performing the local P‑CSCF discovery (e.g. DHCP).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.1.1",
        "ts_24.167",
        "ts_31.103"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.1.1.1",
      "section_id": "5.1.1.1",
      "section_title": "DHCP/DNS procedure for P‑CSCF discovery",
      "content": "The DHCP relay agent within the IP-Connectivity Access Network relays DHCP messages between UE and the DHCP server.\nFigure 5.0a: P‑CSCF discovery using DHCP and DNS\n1.\tEstablish an IP-Connectivity Access Network bearer if not already available by using the procedures available in the IP-Connectivity Access Network.\n2.\tThe UE requests a DHCP server and additionally requests the domain name and/or IP address of the P‑CSCF and IP addresses of DNS servers. It may require a multiple DHCP Query/Response message exchange to retrieve the requested information.\n3.\tThe UE performs a DNS query to retrieve a list of P‑CSCF(s) IP addresses from which one is selected. If the response does not contain the IP addresses, an additional DNS query is needed to resolve a Fully Qualified Domain Name (FQDN) to an IP address.\nAfter reception of domain name and IP address of a P‑CSCF the UE may initiate communication towards the IM subsystem.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.0"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.1.2.1",
      "section_id": "5.1.2.1",
      "section_title": "Assigning a Serving‑CSCF for a user",
      "content": "When a UE attaches and makes itself available for access to IMS services by explicitly registering in the IMS, a S‑CSCF shall be assigned to serve the UE.\nThe assignment of an S‑CSCF is performed in the I‑CSCF. The following information is needed in the selection of the S‑CSCF:\n1.\tRequired capabilities for user servicesThis information is provided by the HSS.\n2.\tOperator preference on a per-user basis This information is provided by the HSS.\n3.\tCapabilities of individual S‑CSCFs in the home networkThis is internal information within the operator's network. This information may be used in the S‑CSCF selection. This information is obtained by the I‑CSCF by methods not standardised in this release.\n4.\tTopological (i.e. P‑CSCF) information of where the user is locatedThis is internal information within the operator's network. This information may be used in the S‑CSCF selection. The P‑CSCF name is received in the registration request. The topological information of the P‑CSCF is obtained by the I‑CSCF by methods not standardised in this Release.\n5.\tTopological information of where the S‑CSCF is locatedThis is internal information within the operator's network. This information may be used in the S‑CSCF selection. This information is obtained by the I‑CSCF by methods not standardised in this release.\n6.\tAvailability of S‑CSCFsThis is internal information within the operator's network. This information may be used in the S‑CSCF selection. This information is obtained by the I‑CSCF by methods not standardised in this release.\nIn order to support the S‑CSCF selection described above and to allow the S‑CSCF to perform its tasks, it is required that the following types of information be transferred between the CSCF and the HSS:\n1\tThe Cx reference point shall support the transfer of CSCF-UE security parameters from HSS to CSCF.\n-\tThis allows the CSCF and the UE to communicate in a trusted and secure way (there is no à priori trust relationship between a UE and a CSCF)\n-\tThe security parameters can be for example pre-calculated challenge-response pairs, or keys for an authentication algorithm, etc.\n2\tThe Cx reference point shall support the transfer of service parameters of the subscriber from HSS to CSCF.\n-\tThis may include e.g. service parameters, Application Server address, triggers, information on subscribed media etc. The information on subscribed media is provided in the form of a profile identifier; details of the allowed media parameters associated with the profile identifier are configured in the S‑CSCF.\n3\tThe Cx reference point shall support the transfer of CSCF capability information from HSS to CSCF.\n-\tThis may include e.g. supported service set, protocol version numbers etc.\n4\tThe Cx reference point shall support the transfer of session signalling transport parameters from CSCF to HSS. The HSS stores the signalling transport parameters and they are used for routing mobile terminated sessions to the Serving‑CSCF.\n-\tThe parameters may include e.g. IP-address and port number of CSCF, transport protocol etc.\nThe information mentioned in items 1 – 4 above shall be transferred before the CSCF is able to serve the user. It shall also be possible to update this information while the CSCF is serving the user, for example if new services are activated for the user.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.2.2",
      "section_id": "5.1.2.2",
      "section_title": "Cancelling the Serving‑CSCF assignment",
      "content": "Cancellation of the assigned Serving CSCF is either:\n-\tInitiated from the Serving CSCF itself, e.g. due to timeout of the registration\n-\tPerformed as a result of an explicit deactivation/de-registration from the IMS. This is triggered by the UE.\n-\tPerformed due to a request from the HSS over the Cx interface, e.g. due to changes in the subscription.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.3",
      "section_id": "5.1.3",
      "section_title": "Procedures related to Interrogating‑CSCF",
      "content": "The architecture shall support multiple I‑CSCFs for each operator. A DNS-based mechanism for selecting the I‑CSCF shall be used to allow requests to be forwarded to an I‑CSCF based, for example, on the location or identity of the forwarding node.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.4",
      "section_id": "5.1.4",
      "section_title": "Procedures related to Proxy‑CSCF",
      "content": "The routing of the SIP registration information flows shall not take into account previous registrations (i.e. registration state). The routing of the session information flows (e.g. INVITE) shall take into account the information received during the registration process.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.5.0",
      "section_id": "5.1.5.0",
      "section_title": "General",
      "content": "Whenever a modification has occurred in the subscription data that constitutes the data used by the S‑CSCF, the complete subscription data set shall be sent to the S‑CSCF by the HSS. HSS shall use the Push model for downloading the subscription data to the S‑CSCF.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.1.5.1",
      "section_id": "5.1.5.1",
      "section_title": "Subscription updating information flow",
      "content": "This clause provides the information flows for subscription data updating procedure.\nFigure 5.0b: Subscription data updating\n1.\tThe HSS sends the Cx-Update_Subscr_Data with the subscription data to the S‑CSCF.\n2.\tThe S‑CSCF sends Cx-Update_Subscr_Data Resp to the HSS to acknowledge the sending of Cx-Update_Subscr_Data",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.0"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.2.0",
      "section_id": "5.2.0",
      "section_title": "General",
      "content": "The following clauses address requirements and information flows related to registration in the IP multimedia subsystem. Assumptions that apply to the various information flows are listed as appropriate.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.2.1",
      "section_id": "5.2.1",
      "section_title": "Requirements considered for registration",
      "content": "The following points are considered as requirements for the purpose of the registration procedures.\n1.\tThe architecture shall allow for the Serving‑CSCFs to have different capabilities or access to different capabilities. E.g. a VPN CSCF or CSCFs in different stages of network upgrade.\n2.\tThe network operator shall not be required to reveal the internal network structure to another network. Association of the node names of the same type of entity and their capabilities and the number of nodes will be kept within an operator's network. However disclosure of the internal architecture shall not be prevented on a per agreement basis.\n3.\tA network shall not be required to expose the explicit IP addresses of the nodes within the network (excluding firewalls and border gateways).\n4.\tIt is desirable that the UE will use the same registration procedure(s) within its home and visited networks.\n5.\tIt is desirable that the procedures within the network(s) are transparent to the UE, when it registers with the IM CN subsystem.\n6.\tThe Serving‑CSCF is able to retrieve a service profile of the user who has IMS subscription. The S‑CSCF shall check the registration request against the filter information and if necessary inform Application Servers about the registration of the user; it shall be possible for the filter information to allow either just the initial registrations of the user or also subsequent re-registrations to be communicated to the Application Servers. The Serving‑CSCF knows how to reach the Proxy‑CSCF currently serving the user who is registered.\n7.\tThe HSS shall support the possibility to bar a Public User Identity from being used for IMS non-registration procedures. The S‑CSCF shall enforce these barring rules for IMS. Examples of use for the barring function are as follows:\n-\tCurrently it is required that at least one Public User Identity shall be stored in the ISIM application or, for UEs supporting only non-3GPP accesses or UEs accessing IMS via SNPN, in the IMC, if IMC is present. If the user/operator wants to prevent this Public User Identity from being used for IMS communications, it shall be possible to do so in the network without affecting the ISIM application or IMC directly.\n8.\tThe HSS shall support the possibility to restrict a user from getting access to IM CN Subsystem from unauthorized visited networks.\n9.\tIt shall be possible to register multiple public identities via single IMS registration procedure from the UE. See clause 5.2.1a for details.\n10.\tIt shall be possible to register a Public User Identity that is simultaneously shared across multiple contact addresses (at the same or via separate UEs) via IMS registration procedures. However, each registration and each de-registration process always relates to a particular contact address and a particular Private User Identity.\nThe number of allowed simultaneous registrations is defined by home operator policy, e.g. locally configured at the S-CSCF or, when registration is requested via separate UEs, per subscribed value if received from the HSS.\n10a.\tIt shall be possible for the UE to indicate to the network whether the registration adds a new contact to an existing registration from the same UE.\n11.\tRegistration of a Public User Identity shall not affect the status of already registered Public User Identity(s), unless due to requirements by Implicit Registration set defined in clause 5.2.1a.\n12.\tWhen multiple UEs share the same public identity (es), each UE shall be able to register its contact address(es) with IMS.\n13.\tThe UE may indicate its capabilities and characteristics in terms of SIP User Agent capabilities and characteristics described in IETF RFC 3840 [38] during IMS registration. The UE may also update its capabilities by initiating a re-registration when the capabilities are changed on the UE.\n14.\tIf a UE supports GRUU, the UE shall indicate its support for GRUUs and obtain a P‑GRUU and a T‑GRUU for each registered Public User Identity during IMS registration as described in RFC 5627 [49].\n15.\tThe P‑CSCF may subscribe to notifications of the status of the IMS Signalling connectivity after successful initial user IMS Registration.\n16.\tWhen the access network type information is available from the access network, the P‑CSCF shall ensure that the IMS registration request received from the UE to the SIP server (e.g. S‑CSCF) contains the correct information. The P‑CSCF may subscribe to notification of changes in the type of access network.\n17.\tThe P‑CSCF shall cancel any active subscription e.g. to notifications of the status of the IMS Signalling connectivity and/or of the change of access network type when the user is de-Registered from the IM CN subsystem.\n18.\tWhen the UE determines that the radio conditions are suitable for IMS PS voice/video services (e.g. UE is in normal coverage or in CE mode A as defined in Annex E, clause E.1.2) then UE may register for IMS voice/video services.\n5.2.1a\tImplicit Registration\n5.2.1a.0\tGeneral\nWhen an user has a set of Public User Identities defined to be implicitly registered via single IMS registration of one of the Public User Identity's in that set, it is considered to be an Implicit Registration. No single public identity shall be considered as a master to the other Public User Identities. Figure 5.0c shows a simple diagram of implicit registration and Public User Identities. Figure 5.0d shows a similar diagram when multiple Private User Identities are involved. In order to support this function, it is required that:\n-\tHSS has the set of Public User Identities that are part of implicit registration.\n-\tCx reference point between S‑CSCF and HSS shall support download of all Public User Identities associated with the implicit registration, during registration of any of the single Public User Identities within the set.\n-\tAll Public User Identities of an Implicit Registration set must be associated to the same Private User Identities. See figure 5.0d for the detailed relationship between the public and private user entities within an Implicit Registration set.\n-\tWhen one of the Public User Identities within the set is registered, all Public User Identities associated with the implicit registration set are registered at the same time.\n-\tWhen one of the Public User Identities within the set is de-registered, all Public User Identities that have been implicitly registered are de-registered at the same time.\n-\tRegistration and de-registration always relates to a particular contact address and a particular Private User Identity. A Public User Identity that has been registered (including when implicitly registered) with different contact addresses remains registered in relation to those contact addresses that have not been de-registered.\n-\tPublic User Identities belonging to an implicit registration set may point to different service profiles; or some of these Public User Identities may point to the same service profile.\n-\tWhen a Public User Identity belongs to an implicit registration set, it cannot be registered or de-registered individually without the Public User Identity being removed from the implicit registration list.\n-\tAll IMS related registration timers should apply to the set of implicitly registered Public User Identities\n-\tS‑CSCF, P‑CSCF and UE shall be notified of the set of Public User Identities belonging to the implicitly registered function. Session set up shall not be allowed for the implicitly registered Public User Identities until the entities are updated, except for the explicitly registered Public User Identity.\n-\tThe S‑CSCF shall store during registration all the Service profiles corresponding to the Public User Identities being registered.\n-\tWhen a Public User Identity is barred from IMS communications, only the HSS and S‑CSCF shall have access to this Public User Identity.\nFigure 5.0c: Relationship of Public User Identities when implicitly registered\nFigure 5.0d: The relation of two shared Public User Identities (Public-ID-3 and 4) and Private User Identities\n5.2.1a.1\tImplicit Registration for UE without ISIM or IMC\nIf an UE is registering in the IMS without ISIM or, for UEs supporting only non-3GPP accesses or UEs accessing IMS via SNPN, without IMC, it shall require the network's assistance to register at least one Public User Identity, which is used for session establishment & IMS signalling. Implicit registration shall be used as part of a mandatory function for these ISIM-less or IMC-less UEs to register the Public User Identity(s). In addition to the functions defined in clause 5.2.1a, the following additional functions are required for this scenario.\n-\tThe Temporary public identity shall be used for initial registration process\n-\tIt shall be defined in HSS that if the user does not have implicit registration activated then the user shall not be allowed to register in the IMS using the Temporary Public User Identity.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.2.1",
        "figure_5.0"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.2.2.1",
      "section_id": "5.2.2.1",
      "section_title": "Requirements to consider for registration",
      "content": "The additional requirement for the registration information flow for this clause is:\n1.\tA Serving‑CSCF is assigned at registration, this does not preclude additional Serving‑CSCFs or change of CSCF at a later date. Procedures for use of additional CSCFs are not standardised in this release.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.2.2.2",
      "section_id": "5.2.2.2",
      "section_title": "Assumptions",
      "content": "The following are considered as assumptions for the registration procedures as described in clause 5.3.2.3:\n1.\tIP‑CAN bearer is already established for signalling and a mechanism exists for the first REGISTER message to be forwarded to the proxy.\n2.\tThe I‑CSCF shall use a mechanism for determining the Serving‑CSCF address based on the required capabilities. The I‑CSCF obtains the name of the S‑CSCF from its role as an S‑CSCF selector (Figure 5.1) for the determination and allocation of the Serving‑CSCF during registration.\n3.\tThe decision for selecting the S‑CSCF for the user in the network is made in the I‑CSCF.\n4.\tA role of the I‑CSCF is the S‑CSCF selection.\nIn the information flows described in clauses 5.2.2.3 and 5.2.2.4, there is a mechanism to resolve a name and address. The text in the information flows indicates when the name-address resolution mechanism is utilised. These flows do not take into account security features such as user authentication. The description of the impact of IMS security features is done in TS 33.203 [19].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.2.3",
        "figure_5.1",
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.2.2.3",
      "section_id": "5.2.2.3",
      "section_title": "Registration information flow – User not registered",
      "content": "The application level registration can be initiated after the registration to the access is performed, and after IP connectivity for the signalling has been gained from the access network. For the purpose of the registration information flows, the user is considered to be always roaming. For user roaming in their home network, the home network shall perform the role of the visited network elements and the home network elements.\nFigure 5.1: Registration – User not registered\n1.\tAfter the UE has obtained IP connectivity, it can perform the IM registration. To do so, the UE sends the Register information flow to the proxy (Public User Identity, Private User Identity, home network domain name, UE IP address, Instance Identifier, GRUU Support Indication).\n2.\tUpon receipt of the register information flow, the P‑CSCF shall examine the \"home domain name\" to discover the entry point to the home network (i.e. the I‑CSCF). The proxy shall send the Register information flow to the I‑CSCF (P‑CSCF address/name, Public User Identity, Private User Identity, P‑CSCF network identifier, UE IP address). A name-address resolution mechanism is utilised in order to determine the address of the home network from the home domain name. The P‑CSCF network identifier is a string that identifies at the home network, the network where the P‑CSCF is located (e.g. the P‑CSCF network identifier may be the domain name of the P‑CSCF network).\n3.\tThe I‑CSCF shall send the Cx-Query/Cx-Select-Pull information flow to the HSS (Public User Identity, Private User Identity, P‑CSCF network identifier).\nThe HSS shall check whether the user is registered already. The HSS shall indicate whether the user is allowed to register in that P‑CSCF network (identified by the P‑CSCF network identifier) according to the User subscription and operator limitations/restrictions if any.\n4.\tCx-Query Resp/Cx-Select-Pull Resp is sent from the HSS to the I‑CSCF. It shall contain the S‑CSCF name, if it is known by the HSS, or the S‑CSCF capabilities, if it is necessary to select a new S‑CSCF. When capabilities are returned, the I‑CSCF shall construct a name from the capabilities returned.\nIf the checking in HSS was not successful the Cx-Query Resp shall reject the registration attempt.\n5.\tThe I‑CSCF, using the name of the S‑CSCF, shall determine the address of the S‑CSCF through a name-address resolution mechanism. The name-address resolution mechanism is allowed to take the load information of the S‑CSCFs (e.g. obtained using network management procedures) into consideration when deciding the address of the S-CSCF. The I‑CSCF also determines the name of a suitable home network contact point, possibly based on information received from the HSS. I‑CSCF shall then send the register information flow (P‑CSCF address/name, Public User Identity, Private User Identity, P‑CSCF network identifier, UE IP address to the selected S‑CSCF. The home network contact point will be used by the P‑CSCF to forward session initiation signalling to the home network.\nThe S‑CSCF shall reject the registration if the number of registered contact addresses for a Public User Identity from the same UE exceeds the limit of simultaneous registrations configured at the S‑CSCF. The S-CSCF shall also reject the registration from separate UEs if the allowed number of simultaneous registrations according to the S-CSCF configuration or per subscribed value for a Public User Identity received from the HSS exceeds the limit of simultaneous registrations. The S‑CSCF shall store the P‑CSCF address/name, as supplied by the visited network. This represents the address/name that the home network forwards the subsequent terminating session signalling to the UE. The S‑CSCF shall store the P‑CSCF Network ID information.\n6.\tThe S‑CSCF shall send Cx-Put/Cx-Pull (Public User Identity, Private User Identity, S‑CSCF name) to the HSS.\n7.\tThe HSS shall store the S‑CSCF name for that user and return the information flow Cx-Put Resp/Cx-Pull Resp (user information) to the S‑CSCF. The user information passed from the HSS to the S‑CSCF shall include one or more names/addresses information which can be used to access the platform(s) used for service control while the user is registered at this S‑CSCF. The S‑CSCF shall store the information for the indicated user. In addition to the names/addresses information, security information may also be sent for use within the S‑CSCF.\n8.\tBased on the filter criteria, the S‑CSCF shall send register information to the service control platform and perform whatever service control procedures are appropriate.\n9.\tThe S‑CSCF shall return the 200 OK information flow (home network contact information, a GRUU set) to the I‑CSCF.\n10.\tThe I‑CSCF shall send information flow 200 OK (home network contact information, a GRUU set) to the P‑CSCF. The I‑CSCF shall release all registration information after sending information flow 200 OK.\n11.\tThe P‑CSCF shall store the home network contact information, and shall send information flow 200 OK (a GRUU set) to the UE. The P‑CSCF may subscribe to notifications of the status of the IMS Signalling connectivity from PCRF/PCF (see TS 23.203 [54] and TS 23.503 [95] for more details).\nIf the S-CSCF receives the priority information of the MPS subscribed-UE as a part of user profile from the HSS, the S-CSCF provides the priority information to the P-CSCF and the P-CSCF stores this information for the MPS-subscribed UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.1",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.2.2.4",
      "section_id": "5.2.2.4",
      "section_title": "Re-Registration information flow – User currently registered",
      "content": "Periodic application level re-registration is initiated by the UE either to refresh an existing registration or in response to a change in the registration status of the UE. A re-registration procedure can also be initiated when the capabilities of the UE have changed or the IP‑CAN has changed. The UE should perform IMS re-registration when the IP-CAN used by the UE changes between 3GPP access and WLAN access.\nRe-registration follows the same process as defined in clause 5.2.2.3 \"Registration Information Flow – User not registered\". When initiated by the UE, based on the registration time established during the previous registration, the UE shall keep a timer shorter than the registration related timer in the network.\nNOTE 1: if the UE does not re-register, any active sessions may be deactivated.\nFigure 5.2: Re-registration - user currently registered\n1.\tThe UE initiates a re-registration. For periodic registration, the UE initiates a re-registration prior to expiry of the agreed registration timer. To re-register, the UE sends a new REGISTER request. The UE sends the REGISTER information flow to the proxy (Public User Identity, Private User Identity, home network domain name, UE IP address, capability information, Instance Identifier, GRUU Support Indication).\n2.\tUpon receipt of the register information flow, the P‑CSCF shall examine the \"home domain name\" to discover the entry point to the home network (i.e. the I‑CSCF). The proxy does not use the entry point cached from prior registrations. The proxy shall send the Register information flow to the I‑CSCF (P‑CSCF address/name, Public User Identity, Private User Identity, P‑CSCF network identifier, UE IP address). A name-address resolution mechanism is utilised in order to determine the address of the home network from the home domain name. The P‑CSCF network identifier is a string that identifies at the home network, the network where the P‑CSCF is located (e.g. the P‑CSCF network identifier may be the domain name of the P‑CSCF network).\nNOTE 2:\tThe P-CSCF may force the UE to attempt initial registration with another P-CSCF, instead of forwarding its re-registration request. This is useful e.g. to move users from a P-CSCF to another P-CSCF without interrupting the service to these users.\n3.\tThe I‑CSCF shall send the Cx-Query information flow to the HSS (Public User Identity, Private User Identity and P‑CSCF network identifier).\n4.\tThe HSS shall check whether the user is registered already and return an indication indicating that an S‑CSCF is assigned. The Cx-Query Resp (indication of entry contact point, e.g. S‑CSCF) is sent from the HSS to the I‑CSCF.\n5.\tThe I‑CSCF, using the name of the S‑CSCF, shall determine the address of the S‑CSCF through a name-address resolution mechanism. The I‑CSCF also determines the name of a suitable home network contact point, possibly based on information received from the HSS. I‑CSCF shall then send the register information flow (P‑CSCF address/name, Public User Identity, Private User Identity, P‑CSCF network identifier, UE IP address to the selected S‑CSCF. The home network contact point will be used by the P‑CSCF to forward session initiation signalling to the home network.\nThe S‑CSCF shall store the P‑CSCF address/name, as supplied by the visited network. This represents the address/name that the home network forwards the subsequent terminating session signalling to the UE.\n6.\tThe S‑CSCF shall send Cx-Put/Cx-Pull (Public User Identity, Private User Identity, S‑CSCF name) to the HSS. Note: Optionally as an optimisation, the S‑CSCF can detect that this is a re-registration and omit the Cx-Put/Cx-Pull request.\n7.\tThe HSS shall stores the S‑CSCF name for that user and return the information flow Cx-Put Resp/Cx-Pull-Resp (user information) to the S‑CSCF. The S‑CSCF shall store the user information for that indicated user.\n8.\tBased on the filter criteria, the S‑CSCF shall send re-registration information to the service control platform and perform whatever service control procedures are appropriate.\nNOTE 3:\tThe service control environment can be notified of the current IP-CAN type serving the UE via this procedure.\n9.\tThe S‑CSCF shall return the 200 OK information flow (home network contact information, a GRUU set) to the I‑CSCF.\n10.\tThe I‑CSCF shall send information flow 200 OK (home network contact information, a GRUU set) to the P‑CSCF. The I‑CSCF shall release all registration information after sending information flow 200 OK.\n11.\tThe P‑CSCF shall store the home network contact information, and shall send information flow 200 OK (a GRUU set) to the UE.\nIf the S-CSCF receives the priority information of the MPS subscribed-UE as a part of user profile from the HSS, the S-CSCF provides the priority information to the P-CSCF and the P-CSCF stores this information for the MPS-subscribed UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.2.2.3",
        "figure_5.2"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.2.2.5",
      "section_id": "5.2.2.5",
      "section_title": "Stored information.",
      "content": "Table 5.1 provides an indication of some of the information stored in the indicated nodes during and after the registration process. Note that Table 5.1 is not an exhaustive list of stored information, i.e. there can be additional information stored due to registration.\nTable 5.1 Information Storage before, during and after the registration process\nNode\nBefore Registration\nDuring Registration\nAfter Registration\nUE - in local network\nCredentials\nHome Domain\nProxy Name/Address\nSame as before registration\nCredentials\nHome Domain\nProxy Name/Address\nUE P‑GRUU\nAt least one T‑GRUU\nProxy‑CSCF\n- in Home or Visited network\nRouting Function\nInitial Network Entry point\nUE Address\nPublic and Private User IDs\nAccess Network Type\nFinal Network Entry point\nUE Address\nPublic and Private User IDs\nAccess Network Type\nInterrogating‑CSCF - in Home network\nHSS or SLF Address\nServing‑CSCF address/name\nP‑CSCF Network ID\nHome Network contact Information\nNo State Information\nHSS\nUser Service Profile\nP‑CSCF Network ID\nServing‑CSCF address/name\\\nServing‑CSCF (Home)\nNo state information\nHSS Address/name\nUser profile (limited – as per network scenario)\nProxy address/name\nP‑CSCF Network ID\nPublic/Private User ID\nUE IP Address\nUE P‑GRUU\nUE T‑GRUU\nMay have session state Information\nSame as during registration",
      "chunk_type": "general",
      "cross_references": [
        "table_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.3.1",
      "section_id": "5.3.1",
      "section_title": "Mobile initiated de-registration",
      "content": "When the UE wants to de-register from the IMS then the UE shall perform application level de-registration. De-registration is accomplished by a registration with an expiration time of zero seconds. De-registration follows the same path as defined in clause 5.2.2.3 \"Registration Information Flow – User not registered\".\nFigure 5.3: De-registration - user currently registered\n1.\tThe UE decides to initiate de-registration. To de-register, the UE sends a new REGISTER request with an expiration value of zero seconds. The UE sends the REGISTER information flow to the proxy (Public User Identity, Private User Identity, home network domain name, UE IP address).\n2.\tUpon receipt of the register information flow, it shall examine the \"home domain name\" to discover the entry point to the home network (i.e. the I‑CSCF). The proxy does not use the entry point cached from prior registrations. The proxy shall send the Register information flow to the I‑CSCF (P‑CSCF address/name, Public User Identity, Private User Identity, P‑CSCF network identifier, UE IP address). A name-address resolution mechanism is utilised in order to determine the address of the home network from the home domain name. The P‑CSCF network identifier is a string that identifies at the home network, the network where the P‑CSCF is located (e.g. the P‑CSCF network identifier may be the domain name of the P‑CSCF network).\n3.\tThe I‑CSCF shall send the Cx-Query information flow to the HSS (Public User Identity, Private User Identity, P‑CSCF network identifier).\n4.\tThe HSS shall determine that the Public User Identity is currently registered. The Cx-Query Resp (indication of entry point, e.g. S‑CSCF) is sent from the HSS to the I‑CSCF.\n5.\tThe I‑CSCF, using the name of the S‑CSCF, shall determine the address of the S‑CSCF through a name-address resolution mechanism and then shall send the de-register information flow (P‑CSCF address/name, Public User Identity, Private User Identity, UE IP address) to the S‑CSCF.\n6. Based on the filter criteria, the S‑CSCF shall send de-registration information to the service control platform and perform whatever service control procedures are appropriate. Service control platform removes all subscription information related to this specific Public User Identity.\n7.\tBased on operator choice the S‑CSCF can send either Cx-Put (Public User Identity, Private User Identity, clear S‑CSCF name) or Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name), and the Public User Identity is no longer considered registered in the S‑CSCF. If the user has (originating – see 5.6.5, or terminating – see 5.12) services related to unregistered state, the S‑CSCF sends Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name) in order to keep the S‑CSCF name in the HSS for these services.\nThe HSS then either clears or keeps the S‑CSCF name for that Public User Identity according to the Cx-Put request. If the S‑CSCF name is kept, then the HSS shall be able to clear the serving S‑CSCF name at any time.\n8.\tThe HSS shall send Cx-Put Resp to the S‑CSCF to acknowledge the sending of Cx-Put.\n9.\tThe S‑CSCF shall return the 200 OK information flow to the I‑CSCF. The S‑CSCF may release all registration information regarding this specific registration of the Public User Identity after sending information flow 200 OK.\n10.\tThe I‑CSCF shall send information flow 200 OK to the P‑CSCF.\n11.\tThe P‑CSCF shall send information flow 200 OK to the UE. The P‑CSCF releases all registration information regarding this specific registration of the Public User Identity after sending information flow 200 OK. If the P‑CSCF has an active subscription to notifications of the status of the IMS Signalling connectivity, the P‑CSCF shall cancel the subscription (see TS 23.203 [54] and TS 23.503 [95] for more details).",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.2.2.3",
        "figure_5.3",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.3.2.0",
      "section_id": "5.3.2.0",
      "section_title": "General",
      "content": "If an ungraceful session termination occurs (e.g. flat battery or mobile leaves coverage), when a stateful proxy server (such as the S‑CSCF) is involved in a session, memory leaks and eventually server failure can occur due to hanging state machines. To ensure stable S‑CSCF operation and carrier grade service, a mechanism to handle the ungraceful session termination issue is required. This mechanism should be at the SIP protocol level in order to guarantee access independence for the IM CN subsystem.\nThe IM CN subsystem can initiate a Network Initiated De-Registration procedures for the following reasons:\n-\tNetwork Maintenance.Forced re-registrations from users, e.g. in the case of data inconsistency at node failure, in the case of UICC lost, etc. Cancelling the current contexts of the user spread among the IM CN Subsystem network nodes at registration, and imposing a new IM registration solves this condition.\n-\tNetwork/traffic determined.The IM CN subsystem must support a mechanism to avoid duplicate registrations or inconsistent information storage. This case will occur when a user roams to a different network without de-registering the previous one. This case may occur at the change of the roaming agreement parameters between two operators, imposing new service conditions to roamers.\n-\tApplication Layer determined. The service capability offered by the IM CN Subsystem to the Application Layers may have parameters specifying whether all IM CN subsystem registrations are to be removed, or only those from one or a group of terminals from the user, etc.\n-\tSubscription ManagementThe operator must be able to restrict user access to the IM CN subsystem upon detection of contract expiration, removal of IM subscription, fraud detection, etc. In the case of changes in service profile of the user, e.g. the user subscribes to new services, it may possible that new S‑CSCF capabilities, which are required from the S‑CSCF, are not supported by the current S‑CSCF which has been assigned to the user. In this case, it shall be possible to actively change the S‑CSCF by using the network initiated de-registration by HSS procedure.\nThe following clauses provide scenarios showing SIP application de-registration. Note that these flows have avoided the strict use of specific SIP protocol message names. This is in an attempt to focus on the architectural aspects rather than the protocol.\nTwo types of network-initiated de-registration procedures are required:\n-\tTo deal with registrations expirations.\n-\tTo allow the network to force de-registrations following any of the approved possible causes for this to occur.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.3.2.1",
      "section_id": "5.3.2.1",
      "section_title": "Network Initiated Application (SIP) De-registration, Registration Timeout",
      "content": "The following flow shows a network initiated IM CN subsystem terminal application (SIP) de-registration based on a registration timeout. A timer value is provided at initial registration and is refreshed by subsequent re-registrations. The flow assumes that the timer has expired. The locations (home or visited network) of the P‑CSCF and S‑CSCF are not indicated as the scenario remains the same for all cases.\nFigure 5.4: Network initiated application de-registration, registration timeout\n1.\tThe registration timers in the P‑CSCF and in the S‑CSCF expire. The timers are assumed to be close enough that no external synchronisation is required. The P‑CSCF updates its internal databases to remove the Public User Identity from being registered. It is assumed that any cleanup of IP-Connectivity Access Network resources will be handled by independent means. If the P‑CSCF has an active subscription to notifications of the status of the IMS Signalling connectivity, the P‑CSCF shall cancel the subscription (see TS 23.203 [54] and TS 23.503 [95] for more details).\n2.\tBased on the filter criteria, the S‑CSCF shall send de-registration information to the service control platform and perform whatever service control procedures are appropriate. Service control platform removes all subscription information related to this specific Public User Identity.\n3.\tBased on operator choice the S‑CSCF can send either Cx-Put (Public User Identity, Private User Identity, clear S‑CSCF name) or Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name), and the Public User Identity is no longer considered registered in the S‑CSCF. If the user has (originating – see 5.6.5, or terminating – see 5.12) services related to unregistered state, the S‑CSCF sends Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name) in order to keep the S‑CSCF name in the HSS for these services.\nThe HSS then either clears or keeps S‑CSCF name for that Public User Identity according to Cx-Put the request. If the S‑CSCF name is kept, then the HSS shall be able to clear the serving S‑CSCF name at any time.\n4.\tThe HSS shall send Cx-Put Resp to the S‑CSCF to acknowledge the sending of Cx-Put.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.4",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.3.2.2.0",
      "section_id": "5.3.2.2.0",
      "section_title": "General",
      "content": "For different reasons (e.g. subscription termination, lost terminal, etc.) a home network administrative function may determine a need to clear a user's SIP registration. This function initiates the de-registration procedure and may reside in various elements depending on the exact reason for initiating the de-registration.\nOne such home network element is the HSS, which already knows the S‑CSCF serving the user and that for this purpose makes use of the Cx-Deregister. Another home network element that could initiate the de-registration is the S‑CSCF, in which case it makes use of the Cx-Put to inform the HSS. Other trusted/secured parties may also initiate de-registration to the S‑CSCF.\nThe following flow shows a network initiated IM CN subsystem terminal application (SIP) de-registration based on an administrative action for example. The IP transport infrastructure is not notified. If complete packet access is to be denied, a transport layer administrative mechanism would be used. This scenario does not address the administrative mechanisms used for updating any subscriber records, EIR records, access authorization, etc. This scenario only addresses the specific action of clearing the SIP application registration that is currently in effect.\nAs determined by the operator, on-going sessions may be released by using network initiated session release procedures in clause 5.10.3.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.10.3"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.3.2.2.1",
      "section_id": "5.3.2.2.1",
      "section_title": "Network Initiated De-registration by HSS, administrative",
      "content": "Figure 5.5: Network initiated application de-registration by HSS, administrative\n1.\tHSS initiates the de-registration, sending a Cx-Deregister (user identity) which may include the reason for the de-registration.\n2.\tBased on the filter criteria, the S‑CSCF shall send de-registration information to the service control platform and perform whatever service control procedures are appropriate.\n3.\tThe S‑CSCF issues a de-registration towards the P‑CSCF for this user and updates its internal database to remove the user from being registered. The reason for the de-registration received from the HSS shall be included if available.\n4.\tThe P‑CSCF informs the UE of the de-registration and without modification forwards the reason for the de-registration, if available. Due to loss of contact with the mobile, it might be possible that the UE does not receive the information of the de-registration.\n5.\tThe P‑CSCF sends a response to the S‑CSCF and updates its internal database to remove the user from being registered. If the P‑CSCF has an active subscription to notifications of the status of the IMS Signalling connectivity, the P‑CSCF shall cancel the subscription (see TS 23.203 [54] for more details).\n6.\tWhen possible, the UE sends a response to the P‑CSCF to acknowledge the de-registration. A misbehaving UE or a UE that is out of P‑CSCF coverage could not answer properly to the de-registration request. The P‑CSCF should perform the de-registration in any case, e.g. after the timer for this request expires.\nIf the UE does not perform automatic re-registration due to the de-registration the user shall be informed about the de-registration and of the reason, if available.\nNOTE 1:\tSteps 4 and 5 may be done in parallel: the P‑CSCF does not wait for an answer from the UE before answering to the S‑CSCF\n7.\tThe S‑CSCF returns a response to the entity that initiated the process.\nNOTE 2:\tAnother trusted/secured party may also request for de-registration via HSS through administrative mechanisms provided by the operator.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.5",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.3.2.2.2",
      "section_id": "5.3.2.2.2",
      "section_title": "Network Initiated De-registration by Service Platform",
      "content": "A service platform may determine a need to clear a user's SIP registration. This function initiates the de-registration procedure and resides in a service platform.\nThe following flow shows a service control initiated IMS terminal application (SIP) de-registration.\nFigure 5.5a: Network initiated application de-registration, service platform\n1.\tThe S‑CSCF receives de-registration information from the service platform and invokes whatever service logic procedures are appropriate. This information may include the reason for the de-registration.\n2.\tThe S‑CSCF issues a de-registration towards the P‑CSCF for this user and updates its internal database to remove the user from being registered. The reason for the de-registration shall be included, if available.\n3.\tThe P‑CSCF informs the UE of the de-registration, and without modification forwards the reason for the de-registration, if available. Due to loss of contact with the mobile, it might be possible that the UE does not receive the information of the de registration.\n4.\tThe P‑CSCF sends a response to the S‑CSCF and updates its internal database to remove the user from being registered. If the P‑CSCF has an active subscription to notifications of the status of the IMS Signalling connectivity, the P‑CSCF shall cancel the subscription (see TS 23.203 [54] for more details).\n5.\tWhen possible, the UE sends a response to the P‑CSCF to acknowledge the de-registration. A misbehaving UE or a UE that is out of P‑CSCF coverage could not answer properly to the de-registration request. The P‑CSCF should perform the de-registration in any case, e.g. after the timer for this request expires.\nIf the UE does not perform automatic re-registration due to the de-registration the user shall be informed about the de-registration and of the reason, if available.\nNOTE 1:\tSteps 4 and 5 may be done in parallel: the P‑CSCF does not wait for an answer from the UE before answering to the S‑CSCF\n6.\tBased on operator choice the S‑CSCF can send either Cx-Put (Public User Identity, Private User Identity, clear S‑CSCF name) or Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name). In both cases the Public User Identity is no longer considered registered in the S‑CSCF. If the user has (originating - see 5.6.5, or terminating - see 5.12) services related to unregistered state, the S‑CSCF may send Cx-Put (Public User Identity, Private User Identity, keep S‑CSCF name) in order to keep the S‑CSCF name in the HSS for these services.\nThe HSS then either clears or keeps S‑CSCF name for that Public User Identity according to Cx-Put the request.\n7.\tThe HSS shall send Cx-Put Resp to the S‑CSCF to acknowledge the sending of Cx-Put.\nNOTE 2:\tAnother trusted/secured party may also initiate the de-registration, for example, by issuing a third party SIP registration with timer set to 0 via S‑CSCF.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.5",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.0",
      "section_id": "5.4.0",
      "section_title": "General",
      "content": "Basic IMS sessions between users will always involve two S‑CSCFs (one S‑CSCF for each). The session flow is decomposed into two parts: an origination part between the UE & the S‑CSCF and termination part between the S‑CSCF and the UE, including all network elements in the path.\nA basic session between a user and a PSTN endpoint involves an S‑CSCF for the UE, a BGCF to select the PSTN gateway, and an MGCF for the PSTN.\nThe session flow is decomposed into three parts – an origination part, an inter-Serving‑CSCF/ MGCF part, and a termination part. The origination part covers all network elements between the UE (or PSTN) and the S‑CSCF for that UE (or MGCF serving the MGW). The termination part covers all network elements between the S‑CSCF for the UE (or MGCF serving the MGW) and the UE (or PSTN).",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.1",
      "section_id": "5.4.1",
      "section_title": "Bearer interworking concepts",
      "content": "Voice bearers from the IM CN subsystem need to be connected with the voice bearers of other networks. Elements such as Media Gateway Functions (MGW) are provided to support such bearer interworking. One of the functions of the MGW may be to support transcoding between a codec used by the UE in the IM CN subsystem and the codec being used in the network of the other party.\nDefault codecs to be supported within the UE are IP‑CAN dependent and hence are defined in the respective IP‑CAN specific documents. The use of default codecs within the UE enables the IM CN subsystem to interwork with other networks on an end to end basis or through transcoding.\nThe IM CN subsystem is also able to interwork with the CS networks (e.g. PSTN, ISDN, CS domain of some PLMN) by supporting transcoding in the IMS MGW element. Furthermore to allow interworking between users of the IM CN subsystem and IP multimedia fixed terminals and other codecs may (this is implementation dependent) be supported by the MGW.\nIn order to support existing network capabilities, it is required that IMS supports endpoints (e.g. UE, MRFP, MGCF for interworking with the PSTN) able to send or receive DTMF tone indications using the bearer, i.e. inband signalling. An additional element for bearer interworking is the interworking of these DTMF tones and out-of-band signalling between one network and another. In such a case, the MGW shall provide tone generation and may provide detection under the control of the MGCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.2",
      "section_id": "5.4.2",
      "section_title": "Interworking with Internet",
      "content": "Depending on operator policy, the S‑CSCF may forward the SIP request or response to another SIP server located within an ISP domain outside of the IM CN subsystem.\nIt is possible that the external SIP client does not support one or more of the SIP extensions required for IMS end points to set up IMS sessions (e.g. Preconditions, Update, 100Rel) as described in TS 24.229 [10a], then the UE or other SIP user agents within the IMS should be able to fall back to SIP procedures which allow interworking towards the external client. Depending on the home network operator policy, the network may restrict session initiation requests towards and from external SIP clients without the support of SIP extensions defined for IMS sessions.\n5.4.2a\tIP version interworking\nFollowing interworking scenarios exist:\nApplication Level Interworking\nIt should be possible for users connected to an IMS network to communicate with users that are connected to SIP based networks that use a different IP version via interworking or that are in a separate addressing range (e.g. NA(P)T functionality is set at the border of the IMS). Annex I describes in more detail how such interworking is performed for IMS.\nTransport Level Interworking\nInter-working also includes tunnelling level interconnection of IMS networks via transit networks that use a different IP version using for example, configured tunnels as described in TS 23.221 [7]. Figure 5.5b below shows an example configuration scenario where two IPv6 IMS networks are connected via an IPv4 network.\nFigure 5.5b: Example tunnelling of IPv6 traffic over IPv4 networks",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.221_figure_5.5",
        "figure_5.5",
        "ts_24.229",
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.3",
      "section_id": "5.4.3",
      "section_title": "Interworking with PSTN",
      "content": "The S‑CSCF, possibly in conjunction with an Application Server, shall determine that the session should be forwarded to the PSTN. The S‑CSCF will forward the Invite information flow to the BGCF in the same network.\nThe BGCF selects the network in which the interworking should occur, and the selection of the interworking network is based on local policy.\nIf the BGCF determines that the interworking should occur in the same network, then the BGCF selects the MGCF which will perform the interworking, otherwise the BGCF forward the invite information flow to the BGCF in the selected network.\nThe MGCF will perform the interworking to the PSTN and control the MG for the media conversions.\nThe high level overview of the network initiated PSTN interworking process is shown in figure 5.6.\nFigure 5.6: Network based PSTN interworking breakout process",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_5.6"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.4",
      "section_id": "5.4.4",
      "section_title": "Requirements for IP multi-media session control",
      "content": "In order for operators to be able to offer a \"carrier-grade\" IP multimedia service, and to require bearers whose features (e.g. Bandwidth) are coherent with the media components negotiated through CSCFs, the following features shall be offered:\n1.\tBoth end points of the session shall be able to negotiate (according to service /UE settings,) which resources (i.e. which media components) need to be established before the destination party is alerted. The session signalling shall ensure that these resources (including IP-Connectivity Access Network resources and IP multimedia backbone resources) are made available or reserved before the destination UE rings.\nThis should nevertheless not prevent the UE from offering to the end-user the choice of accepting or rejecting the components of the session before establishing the bearers.\n2.\tDepending on regulatory requirements, the IP multimedia service shall be able to charge the originating party for the IP-Connectivity Access Network service of both originating and destination side or when reverse charging applies to charge the terminating party for the IP-Connectivity Access Network service of both originating and terminating side. This implies that it should be easy to correlate CDR held by the IP-Connectivity Access Network service with a session.\n3.\tThe session control function of IP multimedia network of an operator (CSCF) shall be able (according to operator choice) to have a strict control (e.g. on source /destination IP address, QoS) on the flows associated with session established through SIP entering the IP multimedia bearer network from IP-Connectivity Access Network service. This does not mean that CSCF is the enforcement point (which actually is the Gateway between the IP-Connectivity Access Network and the IP multimedia network) but that the CSCF may be the final decision point for this control.\n4.\tThe session control and bearer control mechanisms shall allow the session control to decide when user plane traffic between end-points of a SIP session may start/shall stop. This allows this traffic to start/stop in synchronisation with the start/stop of charging for a session.\n5.\tThe IP-Connectivity Access Network service shall be able to notify the IP multimedia session control when the IP-Connectivity Access Network service has either modified or suspended or released the bearer(s) of a user associated with a session (because e.g. the user is no longer reachable).\n6.\tThe solution shall comply with the architectural rules relating to separation of bearer level, session control level, and service level.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.5.1",
      "section_id": "5.4.5.1",
      "section_title": "Session Path Information during Registration and Session Initiation",
      "content": "During registration and session initiation there are SIP mechanisms, which provide the means to determine the session path.\nAfter registration the P‑CSCF stores the S‑CSCF name, possibly IBCF names and the S‑CSCF stores the P‑CSCF name and possibly IBCF names (see 4.3.4) as part of the UE related information.\nThere is a need to store the session path that is determined during the session initiation request in order to route the subsequent session requests through this determined path. This is needed in order to route these session requests through certain nodes, e.g. the ones performing Service Control, or interconnect functions. CSCFs are assumed to perform certain actions:\n1.\tCSCFs (Proxy and Serving) store a certain part of the session path determined during session initiation. This allows CSCFs to generate requests that traverse all elements on a Route path.\n2.\tThe P‑CSCF shall check correct usage of the header values. Should an UE build inaccurate header(s) in a SIP request, the P‑CSCF may reject the request. If an operator policy requires enforcing the routes stored in P‑CSCF, the P‑CSCF shall overwrite the header(s) provided by the UE with the appropriate values.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.5.2",
      "section_id": "5.4.5.2",
      "section_title": "P‑CSCF in the Session Path",
      "content": "All SIP signalling to or from the UE traverses the P‑CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.5.3",
      "section_id": "5.4.5.3",
      "section_title": "S‑CSCF in the Session Path",
      "content": "All initial requests to or from the UE traverse the S‑CSCF assigned to the UE. The S‑CSCF uses the \"Record-Route\" mechanism defined in IETF RFC 3261 [12] to remain in the signalling path for subsequent requests too; in short terms: the S‑CSCF \"record-routes\". This is considered the default behaviour for all IMS communication. However, if Application Servers under operator control guarantee the home control of the session, then it may not be required that all subsequent requests traverse the S‑CSCF. In such cases the operator may choose that the S‑CSCF does not \"record-route\". The detailed record-route behaviour is configured in the S‑CSCF, e.g. on a per-service basis. The S‑CSCF decides whether it performs record-routing or not based on operator configuration in the S‑CSCF.\nSee also Annex F for background information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.6.0",
      "section_id": "5.4.6.0",
      "section_title": "General",
      "content": "Due to different capabilities of the originating and terminating terminals, it might not be possible to establish all the media suggested by the originator for a particular session. In addition, the destination user may have different preferences of type of media depending on who is originating and on the situation e.g. being in a meeting or driving the car, etc.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.6.1",
      "section_id": "5.4.6.1",
      "section_title": "Objectives",
      "content": "The general objectives concerning terminal capabilities and end-user behaviour are listed below.\n-\tThe capabilities of the terminal have impact on the SDP description in the SIP session flows, since different terminals may support different media types (such as video, audio, application or data) and may have implemented different set of codecs for audio and video. Note that the capabilities of the terminal may change when an external device, such as a video camera is attached to the terminal.\n-\tThe configuration of the terminal changes the capabilities of the terminal. This can be done by attaching external devices or possibly by a user setting of certain parameters or profiles in the terminal.\n-\tThe preferences of the destination user may depend on who is originating the session and on the situation. Cost, associated with the session, may also be another factor, i.e. depending on time of the day or day of the week etc. Due to this reason the user may want to accept or reject certain media components.\n-\tThe available resources in the network play an important role, as certain media streams, consuming high bandwidth, may be denied. Therefore, before the user is alerted that the session set up is successful, it is assumed that the network has guaranteed and has reserved the needed resources for one or several media streams of the session. This does not preclude the possibility for the user to indicate his/her preferences regarding the session also after the alerting, in which case the initial resource reservations may have to be modified.\n-\tEnd-to-end quality of service may be provided by using a variety of mechanisms, including guaranteed end-to-end QoS and best effort. The network may not be able to guarantee the requested end-to-end QoS. This may be the case when the user is establishing sessions through the public Internet. On the other hand, certain sessions, with the agreement of the initiating and terminating endpoints, should have the right to go through even without having the requested QoS guarantee.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.6.2",
      "section_id": "5.4.6.2",
      "section_title": "End-user expectations",
      "content": "From the end-user point of view the following user interactions can be listed:\n-\tFor outgoing sessions, it is assumed that the user would like to select certain parameters that define the proposed session. This can be pre-configured as preferences or defined on a per session basis.\n-\tFor incoming sessions, it is assumed that the terminal will establish a dialogue with the user. Such dialogue allows the user to manually accept some of the proposed parameters by the originator. This is typically media type (audio, video, whiteboard) and different quality parameters per media type. As an alternative, the user preferences may be pre-configured.\n-\tBefore establishing or accepting a new session, the user may define or agree on the following parameters. Some of these parameters may be pre-configured and others are defined on a per session basis.\n1.\tType of media, i.e. audio, video, whiteboard, etc. This represents the user preferences of media types.\n2.\tCombination of QoS attributes and selection of codec. This represents the quality of the media component, the cost and the probability of availability of resources both in the access network and in the core network.\n3.\tSubset of capabilities used in the terminal. Terminals can have different set of capabilities. However, the user may or may not want to use the maximum set of capabilities. For instance, a user might want to establish a low cost video session with a small window on the screen.\n4.\tEnd-to-end quality of service. For certain media streams, the user may want assured end-to-end QoS while for other streams the QoS may be optional or even not desired at all (best effort).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.6.3",
      "section_id": "5.4.6.3",
      "section_title": "Mechanism for bearer establishment",
      "content": "In order to fulfil the above requirements, it is needed that the destination user can be pre-alerted before the bearer establishment and negotiation and IP-Connectivity Access Network bearer activation has taken place. This gives room for the destination user to choose the media streams and codecs required before an expensive resource (as the air interface is) is established.\nFigure 5.7 shows the mechanism for the bearer establishment in which the pre-alerting occurs before the initial bearer creation procedures are performed. Furthermore, a user interaction may also occur after the initial bearers are created as shown in figure 5.7. If the session originator receives multiple provisional responses for the same session indicating that the session has been forked in the network, the UE may choose to process a pre-configured number of responses. In the case of multiple responses, the resources requested by the UE shall be the \"logical OR\" (i.e. least upper bound) of the resources indicated in the multiple responses to avoid allocation of unnecessary resources. The UE shall never request more resources then was originally proposed in the Original INVITE.\nThe \"Other x‑CSCFs\" entity in figure 5.7 comprises several CSCFs: I‑CSCF and S‑CSCFs. For the sake of simplicity only the IP-Connectivity Access Network is shown, and the Policy Decision Functions have been omitted from the diagram.\nFigure 5.7: Bearer establishment showing optional pre-alerting\n1.\tUE(A) starts a Session Initiation procedure to UE(B) that includes an SDP proposal.\nThe steps 2-4 are optional and may depend on terminal implementation and/or terminal pre-configured settings.\n2.\tThe user at UE(B) is pre-alerted.\n3.\tAn indication of the pre-alerting may be sent towards UE(A).\n4.\tUser at UE(B) will then interact and express his/her wishes regarding the actual session.\n5.\tUE(B) generates accepted SDP based on terminal settings, terminal pre-configured profiles and optionally the user's wishes.\n6.\tThe accepted SDP is forwarded to UE(A) in the payload of a reliable SIP response.\n7.\tInitial bearer creation procedure is performed. During this bearer creation step the resources in the UE(A)'s and UE(B)'s IP‑CANs are reserved. Bearer resources in external networks may also be reserved at this point.\nThe steps 8-10 are also optional and may be skipped.\n8.\tTerminal at UE(B) starts ringing.\n9.\tThe alerting indication is sent towards UE(A).\n10.\tUser at UE(B) may interact and express his/her wishes regarding the actual session.\n11.\tUE(A) and UE(B) may perform bearer modification procedure at this point, if the initial bearers reserved in step 7 and the wishes of user at UE(B) are different. During this bearer modification step the resources in the IP‑CANs of UE(A) and UE(B) may be modified, and the resource reservation in the external network may also be modified.\n12.\tSession initiation procedure is acknowledged.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.7"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.6.4",
      "section_id": "5.4.6.4",
      "section_title": "Session progress indication to the originating UE",
      "content": "The pre-alerting or alerting indications returned to the originating UE shall enable the originating UE to inform the calling user of the session progress prior to the arrival of the incoming media (for example the originating UE may synthesise ringing locally).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.7.0",
      "section_id": "5.4.7.0",
      "section_title": "General",
      "content": "At IP‑CAN bearer activation the user shall have access to either IP‑CAN services without Policy and Charging Control, or IP‑CAN services with Policy and Charging Control. It is operator choice whether to offer both or only one of these alternatives for accessing the IM Subsystem.\nWhen using IP‑CAN without Policy and Charging Control, IP-CAN bearers are established according to the user's subscription, local operator's IP bearer resource based policy, local operator's admission control function and roaming agreements.\nWhen using IP‑CAN with Policy and Charging Control, PCC decisions (e.g. authorization and control) are also applied to the IP-CAN bearer.\nThe description in this clause and the following clauses (clauses 5.4.7.1 - 5.4.7.7) is applicable for the case when Policy and Charging Control is employed.\nThe IP-Connectivity Access Network contains a Policy and Charging Enforcement Function (PCEF, in 5GS corresponding to the combination of SMF and UPF) that has the capability of policing packet flow into the IP network, and restricting the set of IP destinations that may be reached from/through an IP‑CAN bearer according to a packet classifier.\nNOTE:\tHow PCEF is distributed in SMF and UPF in 5GS is specified in TS 23.501 [93] and TS 23.203 [54].\nThis policy 'gate' function has an external control interface that allows it to be selectively 'opened' or 'closed' on the basis of IP destination address and port. When open, the gate allows packets to pass through (to the destination specified in the classifier) and when closed, no packets are allowed to pass through. The control is performed by a PCRF/PCF (the interface between the PCRF/PCF and the P‑CSCF is the Rx interface standardised in TS 23.203 [54] or the N5 interface (using the Npcf_PolicyAutorization service), standardised in TS 23.503 [95] and TS 29.514 [96]).\nThere are eight interactions defined for Policy and Charging Control:\n1.\tAuthorize QoS Resources.\n2.\tResource Reservation.\n3.\tEnabling of media flows authorized in (1), e.g. 'open' the 'gate'.\n4.\tDisabling of media flows authorized in (1), e.g. 'close' the 'gate'.\n5.\tRevoke Authorization for IP‑CAN and IP resources.\n6.\tIndication of IP‑CAN bearer release from the PCEF in the IP-Connectivity Access Network to the PCRF/PCF.\n7.\tAuthorization of IP‑CAN bearer modification.\n8.\tIndication of IP‑CAN bearer modification from the PCEF in the IP-Connectivity Access Network to the PCRF/PCF.\nThese requirements and functional description of these interactions are explained further in the following clauses. The complete specification of the interface between the PCRF/PCF and the PCEF is contained in TS 23.203 [54] and TS 23.503 [95].\nThe Policy and Charging Control can also be used to enable the P-CSCF to retrieve the user location and/or UE Time Zone information from the access network as specified in TS 23.203 [54] and TS 23.503 [95].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.501",
        "ts_23.203",
        "ts_23.503",
        "ts_29.514"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.1",
      "section_id": "5.4.7.1",
      "section_title": "Authorize QoS Resources",
      "content": "The Authorize QoS Resources procedure is used during an establishment and a modification of a SIP session. The P‑CSCF shall use the SDP contained in the SIP signalling to derive the session information that is relevant for Policy and Charging Control and forwards it to the PCRF/PCF. The PCRF/PCF shall use the received information to calculate the proper authorization. This enables the PCRF/PCF to authorize the required QoS resources.\nNOTE:\tAlthough session information is incomplete in the terminating side P‑CSCF at the reception of the SDP offer, it can be sent to PCRF/PCF whenever the SDP offer (contained in the session establishment request or session modification request) indicates no requirements for resource reservation or that the required resources are already available on the originating side, as in such cases no SDP answer is received before the PCRF/PCF is requested to authorize the required QoS resources.\nThe authorization shall be expressed in terms of the IP resources to be authorized and shall include limits on media flows, and may include restrictions on IP destination address and port. The PCC shall authorize each SIP session independently (including additional parallel sessions, e.g. Call Waiting) and shall take into consideration the amount of IP resources the user's subscription allows.\n5.4.7.1a\tResource Reservation with Policy and Charging Control\nThe IP‑CAN provides the Policy and Charging Enforcement Point that implements the policy decisions for performing admission control and authorising the IP‑CAN and IP BS QoS Resource request, and policing media flows entering the external IP network.\nAuthorization of IP‑CAN and IP QoS Resources shall be required for access to the IP Multimedia Subsystem. The IP‑CAN shall determine the need for authorization, possibly based on provisioning and/or based on requested parameters, which may be IP‑CAN specific.\nResource Reservation is initiated either by the UE or the IP‑CAN depending on the bearer establishment mode selected for the IP‑CAN session, see TS 23.203 [54] and TS 23.503 [95]:\n-\tResource reservation requests initiated from the UE shall (if possible for the used IP‑CAN) contain the traffic mapping information which enables the IP‑CAN to correctly match the reservation request to the corresponding authorization. The authorization is normally 'Pulled' from the PCRF/PCF by the PCEF within the IP‑CAN when the reservation request is received from the UE.\nNOTE:\tWhen a UE combines multiple media flows onto a single IP‑CAN bearer, all the traffic mapping information related to those media flows are provided in the resource reservation request.\nWith a request for IP‑CAN QoS resources, the PCEF within the IP‑CAN shall verify the request is less than the sum of the authorized IP resources (within the error tolerance of the conversion mechanism) for all of the combined media flows.\n-\tResource reservation requests initiated by the IP‑CAN take place after successful authorization of QoS resources. The PCRF/PCF \"Pushes\" the authorization for IP‑CAN bearer resources to the PCEF within the IP‑CAN, which then enforces the authorization by either modifying the characteristics of one existing IP‑CAN bearer or requesting the establishment of a new one.\n-\tResource reservation requests initiated by the IP‑CAN shall (if possible for the used IP‑CAN) contain the traffic mapping information which enables the UE to correctly match the reservation request to the corresponding media of the SIP session.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.2",
      "section_id": "5.4.7.2",
      "section_title": "Enabling of Media Flows",
      "content": "The PCRF/PCF makes policy decisions and provides an indication to the PCEF within the IP‑CAN that the user is now allowed to use the allocated QoS resources for per-session authorizations unless this was done based on Policy and Charging Control at the time of the Resource Reservation procedure. If there is more than one response for the same session, indicating that the session has been forked in the network, the PCRF/PCF may authorize the \"logical OR\" of the resources requested in the responses. When the session established indication has been received, if the PCRF/PCF earlier have authorized the \"logical OR\" of the resources then the PCRF/PCF will modify the authorization and enable the corresponding media flows according to the session established indication.\nThe PCEF within the IP‑CAN enforces the policy decisions. The IP‑CAN shall restrict any use of the IP resources prior to this indication from the PCRF/PCF, e.g. by keeping the gate closed and disabling the use of resources for the media flow. Based on local policy, IP‑CAN and/or IP resources may be allowed to be used by the user at the time they are authorized by the PCRF/PCF.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.7.3",
      "section_id": "5.4.7.3",
      "section_title": "Disabling of Media Flows",
      "content": "The PCRF/PCF makes policy decisions and provides an indication to the PCEF within the IP‑CAN about revoking the user's capacity to use the allocated QoS resources for per-session authorizations. The indication for disabling media flows shall be sent as a separate decision to the PCEF within the IP‑CAN corresponding to the previous request to enable media flows.\nThe PCEF within the IP‑CAN enforces the policy decisions. The IP‑CAN shall restrict any use of the IP resources after this indication from the PCRF/PCF, e.g. by closing the gate and blocking the media flow.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.7.4",
      "section_id": "5.4.7.4",
      "section_title": "Revoke Authorization for IP-Connectivity Access Network and IP Resources",
      "content": "At IP multimedia session release, the UE should deactivate the IP‑CAN bearer(s) used for the IP multimedia session. In various cases the UE will be unable to perform this release itself. The PCRF/PCF provides indication to the PCEF within the IP‑CAN when the resources previous authorized, and possibly allocated by the UE, are to be released. The IP‑CAN shall deactivate the IP‑CAN bearer used for the IP multimedia session.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.7.5",
      "section_id": "5.4.7.5",
      "section_title": "Indication of IP-Connectivity Access Network bearer release",
      "content": "Any release of IP‑CAN bearer(s) that were established based on authorization from the PCRF/PCF shall be reported to the PCRF/PCF by the PCEF within the IP‑CAN.\nThis indication is forwarded to the P‑CSCF and may be used by the P‑CSCF to initiate a session release towards the remote endpoint e.g. if all IP-CAN bearer(s) associated with the session were released, the procedures in clause 5.10.3.1 can be executed.\nNOTE:\tIf only a subset of IP-CAN bearer(s) were released, then the UE can update the ongoing session with the remainder of allowed media flows or a subset of allowed media flows.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.10.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.6",
      "section_id": "5.4.7.6",
      "section_title": "Authorization of IP-Connectivity Access Network bearer modification",
      "content": "When an IP‑CAN bearer is modified by the UE, such that the requested QoS falls outside of the limits that were authorized at IP‑CAN bearer activation (or last modification) or such that new binding information is received, then the PCEF within the IP‑CAN shall verify the authorization of this IP‑CAN bearer modification.\nIf the PCEF within the IP‑CAN does not have sufficient information to authorize the IP‑CAN bearer modification request, the PCEF within the IP‑CAN shall send an authorization request to the PCRF. The PCRF authorizes the modified IP‑CAN bearer based on the current session information. Note that the P‑CSCF sends an update of the session information in the case of a modification of a SIP session which results in an update of the authorization as described in clause 5.4.7.1.\nWhen the P‑CSCF sends an update of the session information and the bearer establishment is controlled by the IP‑CAN, the PCRF/PCF shall send an updated authorization to the PCEF. The PCEF within the IP‑CAN enforces the policy decision accordingly (e.g. by requesting the reservation of new IP‑CAN bearer resources in the case of the addition of a new media component to the session or release of previously reserved resources if a media component has been removed from the IP Multimedia session).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.7.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.7",
      "section_id": "5.4.7.7",
      "section_title": "Indication of IP-Connectivity Access Network bearer modification",
      "content": "When an IP‑CAN bearer is modified such that the maximum bit rate (downlink and uplink) is downgraded to 0 kbit/s or changed from 0 kbit/s to a value that falls within the limits that were authorized at IP‑CAN bearer activation (or last modification) then the PCEF within the IP‑CAN shall report this to the PCRF/PCF.\nThis indication is forwarded to the P‑CSCF and may be used by the P‑CSCF to initiate a session release towards the remote endpoint.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.7.8.1",
      "section_id": "5.4.7.8.1",
      "section_title": "Network Detected Concurrent Sessions",
      "content": "The following scenarios for concurrent sessions are subject to resource sharing:\n-\tThe UE is engaged in a session, puts the session on hold, then initiates a new session to a new UE.\n-\tThe UE is engaged in a session and receives an incoming session, puts the ongoing session on hold to accept the incoming session.\n-\tThe UE is engaged in multiple sessions, puts all sessions on hold and creates a conferencing session.\nFor a UE engaged in multiple sessions, with only one active session at any time, the network may be able to share resources for media components of the same type and that are common to these multiple sessions.\nResource sharing shall only be indicated for concurrent sessions that employ resource reservation based on TS 23.203 [54] or TS 23.503 [95].\nWhen a UE puts a session on hold, it may put all or a subset of the media components of the session on hold. In such a case, the resource sharing applies only to the media components that are on hold and not to the rest of media components belonging to this IMS session\nAn emergency session shall not share resources with any other session.\nNOTE:\tResource sharing to be shared for any media component can be allowed for one direction as well as both directions. According to TS 24.229 [10a] and TS 24.610 [91] it is not prohibited that a UE may send media towards a held UE, i.e. uplink media can occur even when a UE puts a remote UE on hold. The P-CSCF or SIP AS can therefore be locally configured to allow resource sharing in both directions if the P-CSCF or SIP AS knows that the UE will not send media to a remote UE on hold.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.203",
        "ts_23.503",
        "ts_24.229",
        "ts_24.610"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.8.2",
      "section_id": "5.4.7.8.2",
      "section_title": "Initiating Resource Sharing for Network Detected Concurrent Sessions",
      "content": "If the P-CSCF is configured to apply resource sharing, it may at establishment of a new Rx session or a new Npcf_PolicyAutorization application session context with the PCRF/PCF, indicate that resources may be shared in uplink and/or downlink direction by assigning an uplink and/or downlink tag to each media component of an IMS session unless it is an IMS emergency session.\nNOTE:\tThe assignment of tags to media components is regardless of any future sharing decision.\nIf this is the first IMS session of a UE, the P-CSCF shall assign new tags. Upon detection by the P-CSCF that a UE is engaged in multiple sessions, it shall determine if these sessions fulfil the criteria specified in clause 5.4.7.8.1 and have common media components that can share resources. If so, the P-CSCF may activate resource sharing by assigning the same existing tag to each media component whose resources can be shared amongst the IMS sessions. Otherwise, the P-CSCF shall assign new tags that are different from any tag previously assigned for this UE. The PCRF/PCF may then authorize resource sharing based on these tags. For further information, see TS 23.203 [54].\nWhenever resource sharing is active, the P-CSCF shall ensure that the UE can only receive the media flow for one session at a time by closing the gates for all other media flows that can share the same resource, i.e. having the same tag.\nSIP AS may indicate to a supporting P-CSCF to apply resource sharing to each media lines included in SDP of an IMS session. When SIP AS is used, P-CSCF, based on the local policy, may follow the resource sharing policy from SIP AS. The interaction between P-CSCF and SIP AS for handling Resource sharing procedure is defined in TS 24.229 [10a].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.7.8.1",
        "ts_23.203",
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.7.9",
      "section_id": "5.4.7.9",
      "section_title": "Priority sharing for concurrent sessions",
      "content": "The P-CSCF may indicate to the PCRF/PCF that the resource allocation for a media flow is allowed to use the same priority as other media flows of the same media type for the UE engaged in multiple sessions by providing a priority sharing indicator and an optional pre-emption control information in addition to the application identifier and the service priority. For MCPTT, the service priority and the priority sharing indicator are defined in TS 23.179 [92]. The pre-emption control information is used to indicate to the PCRF/PCF how to perform pre-emption in accordance to TS 23.203 [54] and TS 23.503 [95].\nThe following scenario is subject to priority sharing:\n--\tThe P-CSCF receives a priority sharing indicator associated with the media flow from the Application Server.\nUpon detection by the P-CSCF that a session includes a priority sharing indicator for a media flow and may optionally include pre-emption control information, the P-CSCF shall convey to the PCRF/PCF the priority sharing indicator and, when available, the pre-emption control information as described in TS 23.203 [54] and TS 23.503 [95].\nNOTE 1:\tThe Application Server is not supposed to include the priority sharing indicator for an emergency session.\nNOTE 2:\tThe priority sharing enables the usage of one bearer per QCI/5QI for a UE having multiple sessions; otherwise sessions with different service priorities would end up in different bearers.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.179",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.8",
      "section_id": "5.4.8",
      "section_title": "QoS-Assured Preconditions",
      "content": "This clause contains concepts for the relation between the resource reservation procedure and the procedure for end-to-end sessions.\nA precondition is a set of constraints about the session, which are introduced during the session initiation. The recipient of the session generates an answer, but does not alert the user or otherwise proceed with session establishment until the preconditions are met. This can be known through a local event (such as a confirmation of a resource reservation), or through a new set of constraints sent by the caller.\nThe set-up of a \"QoS-Assured\" session will not complete until required resources have been allocated to the session. In a QoS-Assured session, the QoS bearer for the media stream shall be successfully established according to the QoS preconditions defined at the session level before the UE may indicate a successful response to complete the session and alert the other end point. The principles for when a UE shall regard QoS preconditions to be met are:\n-\tA minimum requirement to meet the QoS preconditions defined for a media stream in a certain direction, is that an appropriate IP‑CAN bearer is established at the local access for that direction.\n-\tSegmented resource reservation is performed since the end points are responsible to make access network resource reservations via local mechanisms.\n-\tThe end points shall offer the resources it may want to support for the session and negotiate to an agreed set. Multiple negotiation steps may be needed in order to agree on a set of media for the session. The final agreed set is then updated between the end points.\n-\tThe action to take if a UE fails to fulfil the pre-conditions (e.g. failure in establishment of an RSVP session) depends on the reason for failure. If the reason is lack of resources in the network (e.g. an admission control function in the network rejects the request for resources), the UE shall fail to complete the session. For other reasons (e.g. lack of RSVP host or proxy along the path) the action to take is local decision within the UE. It may for example 1) choose to fail to complete the session, 2) attempt to complete the session by no longer requiring some of the additional actions.\nNOTE 1:\tTo avoid unwanted session setup delay and IP‑CAN signalling load, QoS-Assured sessions needs to be used with care and it is decided per application which media that require resource reservation.\nThe following cases exist in the context of using \"QoS-Assured\" preconditions for IMS:\na.\tThe IMS session requires the reservation of additional bearer resources, and the UE requires confirmation from the other endpoint of the fulfilment of the pre-conditions related to this resource reservation. An endpoint may not require the reservation of bearer resources, and may therefore immediately indicate the local fulfilment of the pre-conditions. One example of such SIP endpoint is the MGCF used for PSTN interworking. In these cases, one or both of the reservation confirmation messages may not be sent.\nb.\tThe IMS session does not require the reservation of additional bearer resources, and both endpoints indicate in their initial session setup message that the pre-conditions are fulfilled.\nc.\tThe IMS session does not require the reservation of additional bearer resources, and the endpoints do not use the mechanism to indicate \"QoS-Assured\" pre-conditions.\nNOTE 2:\tThe flows of clauses 5.5, 5.6 and 5.7 depict the case where both UEs require confirmation from each other of the fulfilment of the pre-conditions. The flow in clause 5.7a depicts the case where the IMS session does not require the reservation of additional bearer resources and the endpoints do not use pre-conditions.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.7"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.9.0",
      "section_id": "5.4.9.0",
      "section_title": "General",
      "content": "The S‑CSCF and Application Servers (SIP‑AS, IM-SSF, OSA-SCS) shall be able to send service information messages to endpoints. This shall be done based on a SIP Request/Response information exchange containing the service information and/or a list of URI(s) pointing to the location of information represented in other media formats. The stimulus for initiating the service event related information message may come from e.g. a service logic residing in an Application Server.\nIn addition, the end points shall also be able to send information to each other. This information shall be delivered using SIP based messages. The corresponding SIP messages shall be forwarded along the IMS SIP signalling path. This includes the S‑CSCF but may also include SIP Application Servers. The information may be related or unrelated to any ongoing session and/or may be independent of any session. Applicable mechanisms (for e.g. routing, security, charging, etc) defined for IMS SIP sessions shall also be applied for the SIP based messages delivering the end-point information. The length of the information transferred is restricted by the message size (e.g. the MTU), so fragmentation and re-assembly of the information is not required to be supported in the UE. This information may include e.g. text message, http url, etc.\nThis mechanism considers the following issues:\n-\tThe IMS has the capability to handle different kinds of media. That is, it is possible to provide information contained within several different media formats e.g. text, pictures or video.\n-\tThe UE's level of supporting service event related information and its exchange may depend on the UE's capabilities and configuration.\n-\tA UE not participating in the service related information exchange shall not be effected by a service related information exchange possibly being performed with another UE of the session.\nNOTE:\tThe service event related information exchange may either take place in the context of a session, or independently outside the context of any existing session.\nFigure 5.8: Providing service event related information to related endpoint\n1.\tWhen a service event occurs that the S‑CSCF or the Application Server wishes to inform an endpoint about, the S‑CSCF or the Application Server generates a message request containing information to be presented to the user. The contents may include text describing the service event, a list of URI(s) or other service modification information.\n2.\tP‑CSCF forwards the message request.\n3.\tUE presents the service-related information, to the extent that it conforms to its capabilities and configuration, to the user.\n4.\tPossibly after interaction with the user, the UE will be able to include information in the response to the S‑CSCF.\n5.\tP‑CSCF forwards the response.\nNOTE 1:\tThe UE may retrieve service event related information using IP‑CAN or IMS procedures.\nNOTE 2:\ttransport aspects of the information transfer described above may require further considerations.",
      "chunk_type": "definition",
      "cross_references": [
        "figure_5.8"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.9.1",
      "section_id": "5.4.9.1",
      "section_title": "Subscription to event notifications",
      "content": "The SIP‑event notification mechanism allows a SIP entity to request notification from remote nodes indicating that certain standardised events have occurred. Examples of such of events are changes in presence states, changes in registration states, changes in Subscription authorization policies (see TS 23.141 [36]) and other events that are caused by information changes in e.g. Application Servers or S‑CSCF.\nIt shall be possible to either fetch relevant information once or monitor changes over a defined time. It shall be possible for a user to subscribe to events related to his/her own subscription (e.g. when the user subscribes to his own registration state) or to events related to other users' subscription (an example is when a watcher subscribes to presence information of a presentity, see TS 23.141 [36]).\nThe S‑CSCF is not mandated to stay in the path after the initial SubscribeEvent request and ACK has been exchanged, if the S‑CSCF does not execute any functions for the subsequent requests and responses of the dialog. The example, in figure 5.8a below, assumes that the S‑CSCF does not want to execute any functions for the subsequent requests.\nFigure 5.8a: Subscription to event in AS\n1.\tThe UE initiates a subscription to an AS requesting notification of any changes in specified information stored in the control of the AS\n2.\tThe P‑CSCF remembers (from the registration process) the next hop CSCF for this UE, i.e. the SubscribeEvent is forwarded to the S‑CSCF in the home network.\n3.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this request.\n4.\tThe S‑CSCF applies regular routing procedures and forwards the request to the next hop.\n5.\tThe AS acknowledges the SubscribeEvent request.\n6.\tThe S‑CSCF forwards the acknowledgement to the P‑CSCF.\n7.\tThe P‑CSCF forwards the acknowledgement to the UE.\n8.\tAs soon as the AS sends an acknowledgement to accept the subscription, the AS sends an EventNotification message with the current information the UE subscribed to. The EventNotification is sent along the path set-up by the SubscribeEvent dialog to the P‑CSCF allocated to the UE. Further notifications, if monitor of changes was requested, sent by the AS is sent along the same path.\n9.\tThe P‑CSCF forwards the EventNotification to the UE.\n10.\tThe UE acknowledges the EventNotification.\n11.\tThe P‑CSCF forwards the acknowledgement to the AS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.8",
        "ts_23.141"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.11",
      "section_id": "5.4.11",
      "section_title": "Signalling Transport Interworking",
      "content": "A Signalling gateway function (S‑GW) is used to interconnect different signalling networks i.e. SCTP/IP based signalling networks and SS7 signalling networks. The signalling gateway function may be implemented as a stand alone entity or inside another entity (see TS 23.002 [1]). The session flows in this specification do not show the S‑GW, but when interworking with PSTN/CS domain, it is assumed that there is a S‑GW for signalling transport conversion.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.12.0",
      "section_id": "5.4.12.0",
      "section_title": "General",
      "content": "Depending on the service nature, different mechanisms may be used for configuration and routing of PSIs according to operator preference.\nWhen PSIs are created, the uniqueness of a PSI shall be ensured. Note that only the username part of a PSI is definable within a predefined hostname(s).\nWhenever possible, routing to/from a Public Service Identity (PSI) should be provided using basic principles used for IMS routing.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.12.1",
      "section_id": "5.4.12.1",
      "section_title": "PSIs on the originating side",
      "content": "The Application Server hosting the PSI may be invoked as an originating Application Server. This can be achieved by modifying the filter information within the subscription information of the users intending to use the service identified by the PSI. The PSI is then made available to these users.\nThe SIP requests are directed to the corresponding Application Server hosting the service according to the originating filtering rules in the S‑CSCF of the user who is using the service.\nSuch statically pre-configured PSIs are only accessible internally from within the IMS of the operator's domain where the PSI is configured.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.12.2",
      "section_id": "5.4.12.2",
      "section_title": "PSIs on the terminating side",
      "content": "The Application Server hosting the PSI may be invoked as a terminating Application Server via information stored in the HSS. Such PSIs are globally routable and can be made available to users within and outside the operator domain, and can take the following form:\n-\tDistinct PSIs are defined in TS 23.003 [24]. Distinct PSIs can be created, modified and deleted in the HSS by the operator via O&M mechanisms. Distinct PSIs can also be created and deleted by users using the Ut interface using the means described in clause 5.4.12.3 for subdomain-based PSIs.\n-\tThe distinct PSI may be activated in the HSS by the AS using the Sh interface.\n-\tWildcarded PSIs are defined in TS 23.003 [24]. Wildcarded PSI ranges can be created, modified and deleted in the HSS by the operator via O&M mechanisms. Specific PSIs within a wildcarded range can be created and deleted by users using the Ut interface to the AS hosting the wildcarded range, or by the operator via O&M mechanisms.\nFor both the distinct PSIs and wildcarded PSIs, there are two ways to route towards the AS hosting the PSI:\na)\tThe HSS maintains the assigned S‑CSCF information and ISC Filter Criteria information for the \"PSI user\" to route to the AS hosting the PSI according to IMS routing principles. In this case, the I‑CSCF receives SIP requests at the terminating side, queries the HSS and directs the request to the S‑CSCF assigned to the \"PSI user\". The S‑CSCF forwards the session to the Application Server hosting the PSI according to the terminating ISC Filter Criteria.\nb)\tThe HSS maintains the address information of the AS hosting the PSI for the \"PSI user\". In this case, the AS address information for the PSI is returned to the I‑CSCF in the location query response, in which case the I‑CSCF will forward the request directly to the AS hosting the PSI.\nThe AS hosting the PSI in combination with its entry in the HSS is referred to as \"PSI user\".\nFigure 5. 19d depicts a routing example for incoming session where the session request is routed directly to the AS hosting the PSI.\nFigure 5.19e depicts an example routing scenario where the basic IMS routing via S‑CSCF is used to route the session.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.12.3",
        "figure_5",
        "figure_5.19",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.12.3",
      "section_id": "5.4.12.3",
      "section_title": "Subdomain based PSIs",
      "content": "Subdomains defined for PSIs allow both operators and users to define specific PSIs within subdomains for specific applications. For this purpose, subdomains can be defined by the operator in the DNS infrastructure. Specific PSIs within a subdomain can be created and deleted by users using the Ut interface to the AS hosting the subdomain, or by the operator via O&M mechanisms.\nSubdomain based PSIs are globally routable and can be made available to users within and outside the operator domain.\nIn this case, there are two ways to route towards the AS hosting the PSI:\na)\tWhen the subdomain name is defined in the global DNS, then the originating S‑CSCF or a Transit Function receives the IP address of the AS hosting the PSI, when it queries DNS. The principles defined in IETF RFC 3263 [44] may be used. For example, a NAPTR query and then a SRV query may be used to get the IP address of the AS.\nb)\tThe PSI is resolved by the global DNS to an I‑CSCF address in the domain where the AS hosting the PSI is located. The I‑CSCF recognises the subdomain (and thus does not query the HSS). It resolves the same PSI to the address of the actual destination AS hosting the PSI using an internal DNS mechanism, and forwards the requests directly to the AS.\nFigure 5.19f shows an example of DNS based routing of an incoming session from an external network. The routing from the external network leads to the entry point of the IMS subsystem hosting the subdomain of the PSI.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.12.4",
      "section_id": "5.4.12.4",
      "section_title": "PSI configuration in the HSS",
      "content": "In order to support configuration of an AS hosting a PSI, the distinct PSIs and/or wildcarded PSI ranges hosted in the AS need to be configured in the HSS. The configuration shall include procedures to allow:\n-\tDistinct PSIs and wildcarded PSI ranges to be configured in the HSS via operation and maintenance procedures,\n-\tAuthorization and verification of access as \"PSI user\" with the Public Service Identity hosted by the AS, e.g. for AS-originating requests,\n-\tAccess to \"PSI user\" information (e.g. the S‑CSCF assigned) over the Cx reference point from the CSCF nodes,\n-\tDefining the \"PSI user\" similar to the principle of IMS user, without requiring any subscription/access information (e.g. CS/PS domain data) that are required for IMS user.\nNote that the PSI configuration in the HSS does not affect the filter criteria based access to an AS as defined in the user profiles.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.4.12.5",
      "section_id": "5.4.12.5",
      "section_title": "Requests originated by the AS hosting the PSI",
      "content": "The AS hosting the PSI may originate requests with the PSI as the originating party. For such originating requests, the home IMS network shall be capable to perform the following functions:\n-\tNetwork Domain Security, TS 33.210 [20], shall be used where applicable.\n-\tCharging requirements such as providing appropriate accounting and charging functions via the charging entities shall be supported according to TS 32.240 [25].\n-\tIf the target identity is a Tel URI (as specified in IETF RFC 3966 [15]), ENUM translation needs to be performed as described in clause 4.3.5.2, and the request shall be routed based on the translation result appropriately.\nRouting from the Originating AS hosting the PSI can be performed as follows:\na)\tIf the AS supports routing capabilities (e.g. ENUM support, etc), the AS may forward the originating request to the destination network without involving a S‑CSCF. If this option is applied where the target identity is a Tel URI, the AS shall perform an ENUM query and route the request based on the translation result.\nb)\tIf the AS does not support routing capabilities, the AS may forward the originating request to the IMS Transit Functions. The IMS Transit Functions will then route the session initiation request to the destination.\nc)\tIf the session requires the use of a S‑CSCF: either the PSI has an S‑CSCF assigned, in which case the AS forwards the originating request to this S‑CSCF, which then processes the request as per regular originating S‑CSCF procedures, or the PSI has no S‑CSCF assigned, in which case the AS sends the session initiation request to an I‑CSCF that will allocate an S‑CSCF to the PSI.\nTo prevent fraudulent or unsecure IMS traffic possibly caused by AS originated requests, security and authentication procedures may be performed towards the AS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.3.5.2",
        "ts_33.210",
        "ts_32.240"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.4.13",
      "section_id": "5.4.13",
      "section_title": "Transcoding concepts",
      "content": "IMS control plane entities, including the P‑CSCF, Application Servers or (for inter-domain sessions) the IBCF, may check the SDP offer/answer information associated with session requests and responses, to determine the need for transcoding. If such a need is determined to exist, media transcoding resources are reserved from the MRFP (via the MRFC), the IMS-AGW, or the TrGW.\nTranscoding requires knowledge of the codecs supported by the end points and may be invoked at the originating or terminating network based on interworking agreements (e.g. local policy) or service level agreement (SLA).\nFor more details concerning transcoding involving MRFC/MRFP interworking see clause 5.14, Annex P and TS 23.218 [71], and for the IBCF/TrGW implementation consult clause 4.14 and Annex I, clause I.3.3.\n5.4a\tOverview of session flow procedures\n5.4a.1\tEnd-to-End session flow procedures\nThis clause contains the overview description and list of individual procedures for the end-to-end session flows.\nFor an IP Multi-Media Subsystem session, the session flow procedures are shown in the following diagram.\nFigure 5.9: Overview of Session Flow Sections\nThe following procedures are defined:\nFor the origination sequences:\n-\t(MO#1) Mobile origination, roaming , see clause 5.6.1;\n-\t(MO#2) Mobile origination, home, see clause 5.6.2;\n-\t(PSTN-O) PSTN origination, see clause 5.6.3;\n-\t(NI-O) Non-IMS network origination (external SIP client), see clause 5.6.4;\n-\t(AS-O) Application Server origination, see clause 5.6.5.\nFor the termination sequences:\n-\t(MT#1) Mobile termination, roaming, see clause 5.7.1;\n-\t(MT#2) Mobile termination, home, see clause 5.7.2;\n-\t(MT#3) Mobile termination, CS Domain roaming, see clause 5.7.2a;\n-\t(PSTN-T) PSTN termination, see clause 5.7.3;\n-\t(NI-T) Non-IMS network termination (external SIP client), see clause 5.7.4;\n-\t(AS-T#1) PSI based Application Server termination, direct, see clause 5.7.5;\n-\t(AS-T#2) PSI based Application Server termination, indirect, see clause 5.7.6;\n-\t(AS-T#3) PSI based Application Server termination, direct, using DNS, see clause 5.7.7;\n-\t(AS-T#4) PUI based Application Server termination, indirect, see clause 5.7.8.\nFor Serving‑CSCF/MGCF-to-Serving‑CSCF/MGCF sequences:\n-\t(S-S#1) Session origination and termination are served by different network operators, see clause 5.5.1;\n-\t(S-S#2) Session origination and termination are served by the same operator, see clause 5.5.2;\n-\t(S-S#3) Session origination with PSTN termination in the same network as the S‑CSCF, see clause 5.5.3;\n-\t(S-S#4) Session origination with PSTN termination in a different network to the S‑CSCF, see clause 5.5.4.\nThe media being offered and acknowledged to can take multiple negotiation steps or only one negotiation may be used. In these flows, a minimum of two negotiations has been shown. But the subsequent responses may not carry any media information and just confirm the initial media set agreement.\nFor example, for a non-roaming user initiating a session to another non-roaming user, each a subscriber of the same network operator, it is possible to construct a complete end-to-end session flow from the following procedures:\n-\t(MO#2) Mobile origination, home,\n-\t(S-S#2) Single network operator,\n-\t(MT#2) Mobile termination, home.\nThere are a large number of end-to-end session flows defined by these procedures. They are built from combinations of origination, serving to serving, and termination procedures, as determined from the following table. For each row of the table, any one of the listed origination procedures can be combined with any one of the serving-serving procedures, which can be combined with any one of the termination procedures.\nService control can occur at any point during a session, based on the filter criteria.\nNote that the flows show service control only for the initial INVITE for originating and terminating party as an example.\nThe flows assume precondition mechanism is used, but as shown in clause 5.7a, a UE may originate a session without using preconditions.\nTable 5.2: Combinations of session procedures\nOrigination Procedure\n(pick one)\nServing‑CSCF-to-Serving‑CSCF Procedure (pick one)\nTermination Procedure (pick one)\nMO#1\tMobile origination,\troaming, home control of\tservices (2).\nMO#2\tMobile origination,\tlocated in home service\tarea.\nPSTN-O\tPSTN origination.\nAS-O\tApplication Server\torigination\nNI-O\tNon-IMS network\torigination\nS-S#1\tDifferent network operators\tperforming origination and\ttermination, with home control of\ttermination (2).\nMT#1\tMobile termination,\troaming, home control of \tservices(2).\nMT#2\tMobile termination,\tlocated in home service \tarea.\nMT#3\tMobile termination, CS \tDomain roaming.\nAS-T#1,2,3,4 Application\tServer terminations\nNI-T\tNon-IMS network \ttermination\nMO#1\tMobile origination, \troaming, home control of \tservices (2).\nMO#2\tMobile origination, \tlocated in home service \tarea.\nAS-O\tApplication Server \torigination\nS-S#2\tSingle network operator\tperforming origination and \ttermination, with home control of \ttermination.\nMT#1\tMobile termination, \troaming, home control of \tservices(2).\nMT#2\tMobile termination, \tlocated in home service \tarea.\nMT#3\tMobile termination, CS \tDomain roaming.\nAS-T#1,2,3,4\tApplication \tServer terminations\nMO#1\tMobile origination, \troaming, home control of \tservices (2).\nMO#2\tMobile origination, \tlocated in home service \tarea.\nAS-O\tApplication Server \torigination\nS-S#3\tPSTN termination in the \tsame network as the S‑CSCF.\nPSTN-T\tPSTN termination.\nMO#1\tMobile origination,\troaming, home control of services (2).\nMO#2\tMobile origination, \tlocated in home service \tarea.\nAS-O\tApplication Server \torigination\nS-S#4\tPSTN termination in\tdifferent network than the \tS‑CSCF\nPSTN-T\tPSTN termination.\n5.4a.2\tTransit network session flow procedures\nIn addition to the combinations of flows constructed from the above scenarios, elements of an IMS network may be used by an operator in support of transit network scenarios. Figure 5.9a shows session flow combinations for transit network scenarios.\nFigure 5.9a: Overview of Session Flow Sections for transit scenarios\nTable 5.2a: Combinations of IMS transit network procedures\nOrigination Procedure\n(pick one)\nIMS Transit Network Procedure\nTermination Procedure\n(pick one)\nMO#1\tMobile origination,\troaming, home control of\tservices (2).\nMO#2\tMobile origination,\tlocated in home service\tarea.\nPSTN-O\tPSTN origination.\nNI-O\tNon-IMS network\torigination\nI-T\tIMS Transit Network\nMT#1\tMobile termination, \troaming, home control of \tservices(2).\nMT#2\tMobile termination, \tlocated in home service \tarea.\nMT#3\tMobile termination, CS \tDomain roaming.\nPSTN-T\tPSTN termination.\nNI-T\tNon-IMS network \ttermination\nThe following procedures are defined:\nFor the origination sequences:\n-\t(MO#1) Mobile origination, roaming , see clause 5.6.1;\n-\t(MO#2) Mobile origination, home, see clause 5.6.2;\n-\t(PSTN-O) PSTN origination, see clause 5.6.3;\n-\t(NI-O) Non-IMS network origination (external SIP client), see clause 5.6.4;\nFor the termination sequences:\n-\t(MT#1) Mobile termination, roaming, see clause 5.7.1;\n-\t(MT#2) Mobile termination, home, see clause 5.7.2;\n-\t(MT#3) Mobile termination, CS Domain roaming, see clause 5.7.2a;\n-\t(PSTN-T) PSTN termination, see clause 5.7.3;\n-\t(NI-T) Non-IMS network termination (external SIP client), see clause 5.7.4;\nFor the IMS transit network aspects see clause 5.19.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.218_clause_5.14",
        "clause_4.14",
        "clause_5.6.1",
        "clause_5.6.2",
        "clause_5.6.3",
        "clause_5.6.4",
        "clause_5.6.5",
        "clause_5.7.1",
        "clause_5.7.2",
        "clause_5.7.3",
        "clause_5.7.4",
        "clause_5.7.5",
        "clause_5.7.6",
        "clause_5.7.7",
        "clause_5.7.8",
        "clause_5.5.1",
        "clause_5.5.2",
        "clause_5.5.3",
        "clause_5.5.4",
        "clause_5.7",
        "clause_5.19",
        "table_5.2",
        "figure_5.9",
        "ts_23.218"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.5.0",
      "section_id": "5.5.0",
      "section_title": "General",
      "content": "This clause presents the detailed application level flows to define the procedures for Serving‑CSCF/MGCF to Serving‑CSCF/MGCF.\nIn the IM CN subsystem the MGCF is considered as a SIP endpoint. It translates ISUP/BICC messages of the PSTN side to SIP signalling of the IM CN subsystem side and vice-versa. It should also be noted that the MGCF does not invoke Service Control.\nThis clause contains four session flow procedures, showing variations on the signalling path between the Serving‑CSCF that handles session origination, and the Serving‑CSCF that handles session termination. This signalling path depends on:\n-\twhether the originator and destination are served by the same network operator,\n-\twhether the network operators have chosen to hide their internal configuration.\nThe Serving‑CSCF handling session origination performs an analysis of the destination address, and determines whether it is a subscriber of the same network operator or a different operator.\nIf the analysis of the destination address determined that it belongs to a subscriber of a different operator, the request is forwarded) to a well-known entry point in the destination operator's network, the I‑CSCF. The I‑CSCF queries the HSS for current location information. The I‑CSCF then forwards the request to the S‑CSCF. If the analysis of the destination address determines that it belongs to a subscriber of the same operator, the S‑CSCF passes the request to a local I‑CSCF, who queries the HSS for current location information. The I‑CSCF then forwards the request to the S‑CSCF.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.5.1",
      "section_id": "5.5.1",
      "section_title": "(S-S#1) Different network operators performing origination and termination",
      "content": "The Serving‑CSCF handling session origination performs an analysis of the destination address, and determines that it belongs to a subscriber of a different operator. The request is therefore forwarded to a well-known entry point in the destination operator's network, the I‑CSCF. The I‑CSCF queries the HSS for current location information, and finds the user either located in the home service area, or roaming. The I‑CSCF therefore forwards the request to the S‑CSCF serving the destination user.\nRefer to table 5.2 in clause 5.4a to see which origination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Originating Network\".\nMO#1\tMobile origination, roaming. The \"Originating Network\" of S-S#1 is therefore a visited network.\nMO#2\tMobile origination, home. The \"Originating Network\" of S-S#1 is therefore the home network.\nPSTN-O\tPSTN origination. The \"Originating Network\" of S-S#1 is the PSTN network. The elements of figure 5.16 replace all elements of the Originating network and Originating Home Network in figure 5.10.\nAS-O\tApplication Server origination. The\" Originating Network\" of S-S#1 is the home network. The element labelled S‑CSCF#1 corresponds to the S-SCSF in figure 5.16b.\nNI-O\tNon-IMS network origination. The external SIP client of figure 5. 16b replaces all elements of the Originating network and Originating Home Network in figure 5.10. There may be other non-IMS SIP servers on the path that are not shown.\nRefer to table 5.2 in clause 5.4a to see which termination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Terminating Network\".\nMT#1\tMobile termination, roaming. The \"Terminating Network\" of S-S#1 is a visited network.\nMT#2\tMobile termination, located in home service area. The \"Terminating Network\" of S-S#1 is the home network.\nMT#3\tMobile termination, CS Domain roaming. The \"Terminating Network\" of S-S#1 is a CS domain network.\nAS-T#1,2,3,4\tApplication Server termination. The elements of the corresponding AS-T termination figure (5.7.5, 5.7.6, 5.7.7, and 5.7.8) replace all elements of the Terminating Home Network and Terminating Network off figure 5.10.\nNI-T\tNon-IMS network terminations. The external SIP client of figure5.19a replaces all elements of the Terminating Home Network and Terminating Network in figure 5.10. There may be other non-IMS SIP servers on the path that are not shown.\nFigure 5.10: Serving to serving procedure - different operators\nProcedure S-S#1 is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow. This message should contain the initial media description offer in the SDP.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. For S-S#1, this flow is an inter-operator message to the I‑CSCF entry point for the terminating user. S‑CSCF#1 forwards the INVITE request directly to I‑CSCF#2, the well-known entry point into the terminating user's network\n4.\tI‑CSCF#2 (at the border of the terminating user's network) shall query the HSS for current location information.\n5.\tHSS responds with the address of the current Serving‑CSCF for the terminating user.\n6.\tI‑CSCF#2 forwards the INVITE request to the S‑CSCF (S‑CSCF#2) that will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt\n8.\tThe sequence continues with the message flows determined by the termination procedure.\n9.\tThe media stream capabilities of the destination are returned along the signalling path, as per the termination procedure.\n10.\tS‑CSCF#2 forwards the SDP to I‑CSCF#2\n11.\tI‑CSCF#2 forwards the SDP to S‑CSCF#1.\n12.\tS‑CSCF#1 forwards the SDP to the originator, as per the originating procedure.\n13.\tThe originator decides on the offered set of media streams, confirms receipt of the Offer Response with a Response Confirmation, and forwards this information to S‑CSCF#1 by the origination procedures. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 12 or a subset.\n14-15.\tS‑CSCF#1 forwards the offered SDP to S‑CSCF#2.\n16.\tS‑CSCF#2 forwards the offered SDP to the terminating endpoint, as per the termination procedure\n17-20.\tThe terminating end point acknowledges the offer with answered SDP and passes through the session path to the originating end point.\n21-24.\tOriginating end point acknowledges successful resource reservation and the message is forwarded to the terminating end point.\n25-28.\tTerminating end point acknowledges the response and this message is sent to the originating end point through the established session path.\n29-32.\tTerminating end point then generates ringing and this message is sent to the originating end point through the established session path.\n33-36.\tTerminating end point then sends 200 OK via the established session path to the originating end point.\n37-40.\tOriginating end point acknowledges the establishment of the session and sends to the terminating end point via the established session path.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "table_5.2",
        "figure_5.16",
        "figure_5.10",
        "figure_5"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.5.2",
      "section_id": "5.5.2",
      "section_title": "(S-S#2) Single network operator performing origination and termination",
      "content": "The Serving‑CSCF handling session origination performs an analysis of the destination address, and determines that it belongs to a subscriber of the same operator. The request is therefore forwarded to a local I‑CSCF. The I‑CSCF queries the HSS for current location information, and finds the user either located in the home service area, or roaming. The I‑CSCF therefore forwards the request to the S‑CSCF serving the destination user.\nRefer to table 5.2 in clause 5.4a to see which origination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Originating Network\".\nMO#1\tMobile origination, roaming. The \"Originating Network\" of S-S#2 is therefore a visited network.\nMO#2\tMobile origination, home. The \"Originating Network\" of S-S#2 is therefore the home network.\nAS-O\tApplication Server origination. The\" Originating Network\" of S-S#1 is the home network. The element labelled S‑CSCF#1 corresponds to the S‑CSCF in figure 5.16b.\nRefer to table 5.2 in clause 5.4a to see which termination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Terminating Network\".\nMT#1\tMobile termination, roaming,. The \"Terminating Network\" of S-S#2 is a visited network.\nMT#2\tMobile termination, home. The \"Terminating Network\" of S-S#2 is the home network.\nMT#3\tMobile termination, CS Domain roaming. The \"Terminating Network\" of S-S#2 is a CS domain network.\nAS-T#1,2,3,4\tApplication Server termination. The elements of the corresponding AS-T termination figure (5.7.5, 5.7.6, 5.7.7, and 5.7.8) replace all elements of the Terminating Home Network and Terminating Network off figure 5.11.\nFigure 5.11: Serving to serving procedure - same operator\nProcedure S-S#2 is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow. This message should contain the initial media description offer in the SDP.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. Since it is local, the request is passed to a local I‑CSCF.\n4.\tI‑CSCF shall query the HSS for current location information.\n5.\tHSS responds with the address of the current Serving‑CSCF for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to the S‑CSCF (S‑CSCF#2) that will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt\n8.\tThe sequence continues with the message flows determined by the termination procedure.\n9-12.\tThe terminating end point responds with an answer to the offered SDP and this message is passed along the established session path.\n13-16.\tThe originator decides on the offered set of media streams, confirms receipt of the Offer Response with a Response Confirmation, and forwards this information to S‑CSCF#1 by the origination procedures. This message is forwarded via the established session path to the terminating end point. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 12 or a subset.\n17-20.\tTerminating end point responds to the offered SDP and the response if forwarded to the originating end point via the established session path.\n21-24.\tOriginating end point sends successful resource reservation information towards the terminating end point via the established session path.\n25-28.\tTerminating end point sends successful resource reservation acknowledgement towards the originating end point via the established session path\n29-32.\tTerminating end point sends ringing message toward the originating end point via the established session path.\n33-36.\tThe SIP final response, 200-OK, is sent by the terminating endpoint over the signalling path. This is typically generated when the user has accepted the incoming session setup attempt. The message is sent to S‑CSCF#2 per the termination procedure.\n37-40.\tThe originating endpoint sends the final acknowledgement to S‑CSCF#1 by the origination procedures and it is then sent over the signalling path to the terminating end point.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "table_5.2",
        "figure_5.16",
        "figure_5.11"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.5.3",
      "section_id": "5.5.3",
      "section_title": "(S-S#3) Session origination with PSTN termination in the same network as the S‑CSCF.",
      "content": "The Serving‑CSCF handling session origination performs an analysis of the destination address, and determines, with support of applications or other databases, that the session is destined to the PSTN. The request is therefore forwarded to a local BGCF. The BGCF determines that the MGCF should be in the same network, and selects a MGCF in that network. The request is then forwarded to the MGCF.\nRefer to table 5.2 in clause 5.4a to see which origination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Originating Network\".\nMO#1\tMobile origination, roaming. The \"Originating Network\" of S-S#3 is therefore a visited network.\nMO#2\tMobile origination, located in home service area. The \"Originating Network\" of S-S#3 is therefore the home network.\nAS- O\tApplication Server origination. The\" Originating Network\" of S-S#1 is the home network. The element labelled S‑CSCF corresponds to the S‑CSCF in figure 5.16b.\nRefer to table 5.2 in clause 5.4a to see which termination sequences share this common S-S procedure. In addition the text below clarifies the role of the \"Terminating Network\".\nPSTN-T\tPSTN termination. This occurs when the MGCF is selected to be in the same network as the S‑CSCF.\nFigure 5.12: Serving to PSTN procedure - same operator\nProcedure S-S#3 is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow. This message should contain the initial media description offer in the SDP.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt\n3.\tS‑CSCF#1 performs an analysis of the destination address. From the analysis of the destination address, S‑CSCF#1 determines that this is for the PSTN, and passes the request to the BGCF.\n4.\tThe BGCF determines that the MGCF shall be in the same network, and hence proceeds to select an appropriate MGCF. The SIP INVITE request is forwarded to the MGCF. The PSTN terminating information flows are then followed.\n5-7.\tThe media stream capabilities of the destination are returned along the signalling path, as per the PSTN termination procedure.\n8.\tThe originator decides the offered set of media streams, confirms receipt of the Offer Response with a Response Confirmation, and forwards this information to S‑CSCF#1 by the origination procedures. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 7 or a subset.\n9-10.\tS‑CSCF#1 forwards the offered SDP to the terminating endpoint as per the PSTN terminating procedures via the established session path.\n11-13.\tThe terminating end point answers to the offered SDP and the message is passed through the established session path to the originating end point.\n14-16.\tWhen the originating endpoint has completed the resource reservation procedures, it sends the successful resource reservation message to S‑CSCF#1 by the origination procedures and it is passed to the terminating end point through the session path.\n17-19.\tThe terminating endpoint acknowledges the result and the message is passed onto the originating end point via the session path.\n20-22.\tTerminating end point generates ringing message and forwards it to BGCF which in turn forwards the message to SCSCF#1. S‑CSCF#1 forwards the ringing message to the originator, per the origination procedure.\n23.\tWhen the destination party answers, the termination procedure results in a SIP 200-OK final response to the BGCF.\n24-25.\tThe BGCF forwards this information to the S‑CSCF#1 and then it is forwarded to the originating end point.\n26.\tThe 200-OK is returned to the originating endpoint, by the origination procedure from terminating end point.\n27.\tThe originating endpoint sends the final acknowledgement to S‑CSCF#1 by the origination procedures.\n28.\tS‑CSCF#1 forwards this message to the terminating endpoint as per the PSTN terminating procedures.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "table_5.2",
        "figure_5.16",
        "figure_5.12"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.5.4",
      "section_id": "5.5.4",
      "section_title": "(S-S#4) Session origination with PSTN termination in a different network from the S‑CSCF.",
      "content": "The Serving‑CSCF handling session origination performs an analysis of the destination address, and determines, with support of applications or other databases, that the session is destined to the PSTN. The request is therefore forwarded to a local BGCF. The BGCF determines that the PSTN interworking should occur in another network, and forwards this to a BGCF in the interworking network. The BGCF then selects a MGCF in that network. The request is then forwarded to the MGCF.\nRefer to table 5.2 in clause 5.4a to see which origination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Terminating Network\".\nMO#1\tMobile origination, roaming. The \"Originating Network\" of S-S#4 is therefore a visited network.\nMO#2\tMobile origination, located in home service area. The \"Originating Network\" of S-S#4 is therefore the home network.\nAS- O\tApplication Server origination. The\" Originating Network\" of S-S#1 is the home network. The element labelled S‑CSCF#1 corresponds to the S‑CSCF in figure 5.16b.\nRefer to table 5.2 in clause 5.4a to see which termination sequences share this common S-S procedure. In addition the text below clarifies the role of the\" Terminating Network\".\nPSTN-T\tPSTN termination. This occurs when the MGCF is selected to be in a different network than the S‑CSCF.\nFigure 5.13: Serving to PSTN procedure - different operator\nProcedure S-S#4 is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow. This message should contain the initial media description offer in the SDP.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt\n3.\tS‑CSCF#1 performs an analysis of the destination address. From the analysis of the destination address, S‑CSCF#1 determines that this is for the PSTN, and passes the request to the BGCF#1.\n4.\tThe BGCF#1 determines that the PSTN interworking should occur in interworking network, and forwards the request on to BGCF#2.\n5.\tBGCF#2 determines that the MGCF shall be in the same network, and hence proceeds to select an appropriate MGCF. The SIP INVITE request is forwarded to the MGCF. The PSTN terminating information flows are then followed.\n6-8.\tThe media stream capabilities of the destination are returned along the signalling path, as per the PSTN termination procedure.\n9.\tS‑CSCF#1 forwards the SDP to the originator, as per the originating procedure.\n10.\tThe originator decides the offered set of media streams, confirms receipt of the Offer Response with a Response Confirmation, and forwards this information to S‑CSCF#1 by the origination procedures. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 12 or a subset.\n11-13.\tS‑CSCF#1 forwards the offered SDP to the terminating endpoint, as per the PSTN terminating procedure.\n14-17.\tTerminating end point responds to the offer via the established session path towards the originating end point.\n18-21.\tWhen the originating endpoint has completed the resource reservation procedures, it sends the successful resource reservation message to S‑CSCF#1 by the origination procedures and it is forwarded to the terminating end point via established session path.\n22-25.\tThe terminating end point responds to the message towards the originating end point.\n26-29.\tTerminating end point generates ringing message towards the originating end point.\n30-33.\tTerminating end point sends 200 OK when the destination party answers the session.\n34-37.\tOriginating end point acknowledges the establishment of the session.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "table_5.2",
        "figure_5.16",
        "figure_5.13"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.0",
      "section_id": "5.6.0",
      "section_title": "General",
      "content": "This clause presents the detailed application level flows to define the Procedures for session originations.\nThe flows presented in the clause assume the use of Policy and Charging Control for the establishment of QoS-Assured Sessions.\nThe session origination procedures specify the signalling path between the UE initiating a session setup attempt and the Serving‑CSCF that is assigned to perform the session origination service. This signalling path is determined at the time of UE registration, and remains fixed for the life of the registration.\nA UE always has a proxy (P‑CSCF) associated with it. This P‑CSCF performs resource authorization, and may have additional functions in handling of emergency and priority sessions. The P‑CSCF is determined by the CSCF discovery process, described in clause 5.1.1 (Local CSCF Discovery).\nAs a result of the registration procedure, the P‑CSCF determines the next hop toward the Serving‑CSCF. This next hop is to the S‑CSCF in the home network (MO#1). These next-hop addresses could be IP addresses, or could be names that are translated via DNS to an IP address.\nSessions originated in the PSTN to a destination in an IMS network are a special case of the Origination procedures. The MGCF uses H.248 [18] to control a Media Gateway, and communicates with the SS7 network. The MGCF initiates the SIP request, and subsequent nodes consider the signalling as if it came from a S‑CSCF.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.1",
      "section_id": "5.6.1",
      "section_title": "(MO#1) Mobile origination, roaming",
      "content": "This origination procedure applies to roaming users.\nThe UE is located in a visited network, and determines the P‑CSCF via the CSCF discovery procedure described in clause 5.1.1. The home network advertises the S‑CSCF as the entry point from the visited network.\nWhen registration is complete, P‑CSCF knows the name/address of the next hop in the signalling path toward the serving‑CSCF.\nFigure 5.14: Mobile origination procedure - roaming\nProcedure MO#1 is as follows:\n1.\tUE sends the SIP INVITE request, containing an initial SDP, to the P‑CSCF determined via the CSCF discovery mechanism. The initial SDP may represent one or more media for a multi-media session.\n2.\tP‑CSCF remembers (from the registration procedure) the next hop CSCF for this UE.\nThis next hop is either the S‑CSCF that is serving the visiting UE.\nP-CSCF determines whether the INVITE message requires priority handling based on user profile stored during the registration procedure and/or the priority requested by the user and/or MPS code/identifier included in the INVITE message. If the session is determined to require priority handling, then P-CSCF inserts/replaces the priority indication and forwards the INVITE to the S-CSCF.\n3.\tS‑CSCF validates the service profile, if a GRUU is received as the contact, ensures that the Public User Identity of the served user in the request and the Public User Identity associated with the GRUU belongs to the same service profile, and invokes any origination service logic required for this user. This includes authorization of the requested SDP based on the user's subscription for multi-media services. If the Request URI contains the SIP URI representation of an E.164 address then the procedure specified in clause 4.3.5.3 applies.\n4.\tS‑CSCF forwards the request, as specified by the S-S procedures. When the INVITE message includes priority indication, the S-CSCF forwards the INVITE, including the Service User's priority level if available.\n5.\tThe media stream capabilities of the destination are returned along the signalling path, per the S-S procedures.\n6.\tS‑CSCF forwards the Offer Response message to P‑CSCF.\n7.\tP‑CSCF instructs the PCRF/PCF to authorize the resources necessary for this session.\n8.\tP‑CSCF forwards the Offer Response message to the originating endpoint.\n9.\tUE decides the offered set of media streams for this session, confirms receipt of the Offer Response and sends the Response Confirmation to the P‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 8 or a subset. If new media are defined by this SDP, a new authorization (as in Step 7) will be done following Step 14. The originating UE is free to continue to offer new media on this operation or on subsequent exchanges using the Update method. Each offer/answer exchange will cause the P‑CSCF to instruct the PCRF/PCF to repeat the Authorization step (Step 7) again.\n10.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the reservation procedures for the resources needed for this session after determining the needed resources in step 8 as shown in Figure 5.14. Otherwise, the IP‑CAN initiates the reservation of required resources after step 7.\n11.\tP‑CSCF forwards the Response Confirmation to S‑CSCF.\n12.\tS‑CSCF forwards this message to the terminating endpoint, as per the S-S procedure.\n13-15.\tThe terminating end point responds to the originating end with an acknowledgement. If Optional SDP is contained in the Response Confirmation, the Confirmation Acknowledge will also contain an SDP response. If the SDP has changed, the P‑CSCF validates that the resources are allowed to be used.\n16-18.\tWhen the resource reservation is completed, UE sends the successful Resource Reservation message to the terminating endpoint, via the signalling path established by the INVITE message. The message is sent first to P‑CSCF.\n19-21.\tThe terminating end point responds to the originating end when successful resource reservation has occurred. If the SDP has changed, the P‑CSCF authorizes that the resources are allowed to be used.\n22-24.\tTerminating end point may generate ringing and it is then forwarded via the session path to the UE.\n25.\tUE indicates to the originating user that the destination is ringing.\n26.\tWhen the destination party answers, the terminating endpoint sends a SIP 200-OK final response, as specified by the termination procedures and the S-S procedures, to S‑CSCF.\n27.\tS‑CSCF sends a SIP 200-OK final response along the signalling path back to P‑CSCF.\n28.\tP‑CSCF indicates that the media flows authorized for this session should now be enabled.\n29.\tP‑CSCF sends a SIP 200-OK final response to the session originator.\n30.\tUE starts the media flow(s) for this session.\n31-33.\tUE responds to the 200 OK with a SIP ACK message sent along the signalling path.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.1",
        "clause_4.3.5.3",
        "figure_5.14"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.2",
      "section_id": "5.6.2",
      "section_title": "(MO#2) Mobile origination, home",
      "content": "This origination procedure applies to users located in their home service area.\nThe UE is located in the home network, and determines the P‑CSCF via the CSCF discovery procedure described in clause 5.1.1. During registration, the home network allocates an S‑CSCF in the home network.\nWhen registration is complete, P‑CSCF knows the name/address of S‑CSCF.\nFigure 5.15: Mobile origination procedure - home\nProcedure MO#2 is as follows:\n1.\tUE#1 sends the SIP INVITE request, containing an initial SDP, to the P‑CSCF determined via the CSCF discovery mechanism. The initial SDP may represent one or more media for a multi-media session.\n2.\tP‑CSCF remembers (from the registration procedure) the next hop CSCF for this UE. In this case it forwards the INVITE to the S‑CSCF in the home network.\nP-CSCF determines whether the INVITE message requires priority handling based on user profile stored during the registration procedure and/or the priority requested by the user and/or MPS code/identifier included in the INVITE message. If the session is determined to require priority handling, then P-CSCF inserts/replaces the priority indication and forwards the INVITE to the S-CSCF.\n3.\tS‑CSCF validates the service profile, if a GRUU is received as the contact, ensures that the Public User Identity of the served user in the request and the Public User Identity associated with the GRUU belong to the same service profile, and invokes any origination service logic required for this user. This includes authorization of the requested SDP based on the user's subscription for multi-media services. If the Request URI contains the SIP representation of an E.164 address then the procedure specified in clause 4.3.5.3 applies.\n4.\tS‑CSCF forwards the request, as specified by the S-S procedures. When the INVITE message includes priority indication, the S-CSCF forwards the INVITE, including the Service User's priority level if available.\n5.\tThe media stream capabilities of the destination are returned along the signalling path, per the S-S procedures.\n6.\tS‑CSCF forwards the Offer Response message to P‑CSCF.\n7.\tP‑CSCF instructs the PCRF/PCF to authorize the resources necessary for this session.\n8.\tP‑CSCF forwards the Offer Response message to the originating endpoint.\n9.\tUE decides the offered set of media streams for this session, confirms receipt of the Offer Response and sends the Response Confirmation to P‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in Step 8 or a subset. If new media are defined by this SDP, a new authorization (as in Step 7) will be done following Step 14. The originating UE is free to continue to offer new media on this operation or on subsequent exchanges using the Update method. Each offer/answer exchange will cause the P‑CSCF to repeat the Step 7 again.\n10.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates resource reservation procedures for the offered media as shown in Figure 5.15. Otherwise, the IP‑CAN initiates the reservation of required resources after step 7.\n11.\tP‑CSCF forwards this message to S‑CSCF.\n12.\tS‑CSCF forwards this message to the terminating endpoint, as per the S-S procedure.\n13-14.\tThe terminating end point responds to the originating end with an acknowledgement. If Optional SDP is contained in the Response Confirmation, the Confirmation Acknowledge will also contain an SDP response. If the SDP has changed, the PCSCF authorizes the media.\n15.\tPCSCF forwards the answered media towards the UE.\n16-18.\tWhen the resource reservation is completed, UE sends the successful Resource Reservation message to the terminating endpoint, via the signalling path established by the INVITE message. The message is sent first to P‑CSCF.\n19-21.\tThe terminating end point responds to the originating end when successful resource reservation has occurred. If the SDP has changed, the P‑CSCF again authorizes that the resources are allowed to be used.\n22-24.\tThe destination UE may optionally perform alerting. If so, it signals this to the originating party by a provisional response indicating Ringing. This message is sent to S‑CSCF per the S-S procedure. It is sent from there toward the originating end along the signalling path.\n25.\tUE indicates to the originating user that the destination is ringing.\n26-27.\tWhen the destination party answers, the terminating endpoint sends a SIP 200-OK final response along the signalling path to the originating end, as specified by the termination procedures and the S-S procedures, to S‑CSCF.\n28.\tP‑CSCF indicates that the media flows authorized for this session should now be enabled.\n29.\tP‑CSCF passes the 200-OK response back to UE.\n30.\tUE starts the media flow(s) for this session.\n31-33.\tUE responds to the 200 OK with an ACK message which is sent to P‑CSCF and passed along the signalling path to the terminating end.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.1",
        "clause_4.3.5.3",
        "figure_5.15"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.3",
      "section_id": "5.6.3",
      "section_title": "(PSTN-O) PSTN origination",
      "content": "The MGCF in the IM CN subsystem is a SIP endpoint that initiates requests on behalf of the PSTN and Media Gateway. The subsequent nodes consider the signalling as if it came from a S‑CSCF. The MGCF incorporates the network security functionality of the S‑CSCF. This MGCF does not invoke Service Control, as this may be carried out in the GSTN or at the terminating S‑CSCF.\nDue to routing of sessions within the PSTN, this origination procedure will only occur in the home network of the destination subscriber. However, due to cases of session forwarding and electronic surveillance, the destination of the session through the IM CN subsystem may actually be another PSTN termination.\nFigure 5.16: PSTN origination procedure\nThe PSTN Origination procedure is as follows:\n1.\tThe PSTN establishes a bearer path to the MGW, and signals to the MGCF with a IAM message, giving the trunk identity and destination information.\n2.\tThe MGCF initiates a H.248 command, to seize the trunk and an IP port.\n3.\tThe MGCF initiates a SIP INVITE request addressed to a tel URI or, if directed by operator's local policy, to a SIP URI (using an E.164 address in the user portion and the setting user=phone), includes an initial SDP in the INVITE request, and forwards the request to a configured I‑CSCF, as per the proper S-S procedure. If configured through policies, the MGCF adds to the SIP INVITE attestation information based on the trunk identity or other sources of the request.\n4.\tThe media stream capabilities of the destination are returned along the signalling path, per the S-S procedures.\n5.\tMGCF initiates a H.248 command to modify the connection parameters and instruct the MGW to reserve the resources needed for the session.\n6.\tMGCF decides the offered set of media streams for this session, confirms receipt of the Offer Response and sends the Response Confirmation per the S-S procedures.\n7.\tTerminating end point responds to the Response Confirmation. If Optional SDP is contained in the Response Confirmation, the Confirmation Acknowledge will also contain an SDP response.\n8.\tMGW reserves the resources needed for the session.\n9.\tWhen the resource reservation is completed, MGCF sends the successful Resource Reservation message to the terminating endpoint, per the S-S procedures.\n10.\tTerminating end point responds to the successful media resource reservation.\n11.\tThe destination endpoint may optionally perform alerting. If so, it signals this to the originating party by a provisional response indicating Ringing. This message is sent to MGCF per the S-S procedure.\n12.\tIf alerting is being performed, the MGCF forwards an ACM message to PSTN.\n13.\tWhen the destination party answers, the terminating and S-S procedures result in a SIP 200-OK final response being sent to MGCF.\n14.\tMGCF forwards an ANM message to the PSTN.\n15.\tMGCF initiates a H.248 command to alter the connection at MGW to make it bi-directional.\n16.\tMGCF acknowledges the SIP final response with a SIP ACK message.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.16"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.4",
      "section_id": "5.6.4",
      "section_title": "(NI-O) Non-IMS Origination procedure from an external SIP client",
      "content": "This clause describes the session setup procedures when originating from an external SIP client that doesn't support the required IMS SIP extensions, towards an IMS UE.\nAn incoming SIP request may arrive, where the UE detects that the originating party does not support the IMS SIP extensions described in TS 24.229 [10a]. If the external SIP client does not support the Precondition extension of SIP, the UE continues to setup the session without activating media transfer until the session has been accepted. Figure 5.16a shows an example of an end-to-end session setup in such a case.\nFor illustration purposes these session flows show the case of a non-roaming termination. This flow is a variant of MT#2 defined in clause 5.7.2. The same principles apply in roaming cases, i.e. analogous variants of MT#1 defined in clause 5.7.1 are also supported for interworking with SIP clients that do not support the required IMS procedures.\nFigure 5.16a: Originating session from external SIP client\n1-2.\tA session request arrives at the UE in the IMS network with media information but without requiring precondition capability.\n3.\tP‑CSCF examines the media parameters. If P‑CSCF finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session initiation attempt.\nNOTE 1:\tWhether the P‑CSCF should interact with PCRF/PCF in this step is based on operator policy.\n4.\tP‑CSCF forwards the INVITE request to the UE.\n5.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE begins the resource reservation according to the session and media parameters as shown in Figure 5.16a. Otherwise, the IP‑CAN initiates the reservation of required resources after step 10.\n6-8.\tRinging information is sent end to end towards the originating party. These steps may proceed in parallel with step 5.\n9.\tThe UE accepts the session with a 200 OK response.\n10.\tBased on operator policy the P‑CSCF may instruct the PCRF/PCF to authorize the resources necessary for this session.\n11-12.\tThe 200 OK response is forwarded to the originating party.\n13-15.\tThe originating party acknowledges the session.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.7.2",
        "clause_5.7.1",
        "figure_5.16",
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.5.1",
      "section_id": "5.6.5.1",
      "section_title": "(AS-O) Origination at Application Server",
      "content": "This origination procedure applies to an Application Server that initiates a session on behalf of a user or a Public Service Identity. If the AS initiates the session on behalf of a user, the user may be an IMS user (i.e. referred to by a Public User Identity) or a non-IMS user (i.e. with no profile in the HSS, e.g. a PSTN user). It will be referred as a non-IMS user. If the AS initiates the session on behalf of a user, the identity-related fields of the initial request are populated the same way as if the request was originated by the user himself.\nIn the case of originating unregistered procedures, the handling of the S‑CSCF in the HSS will follow the same principle as terminating unregistered user handling.\nIn the case of originating unregistered procedures, the S‑CSCF shall execute any unregistered origination service logic before forwarding requests from an AS on behalf of an IMS user (i.e. referred to by a Public User Identity) or a Public Service Identity, as specified by the S-S procedures. In order to allow an AS to retrieve the S‑CSCF name via Sh interface the S‑CSCF may keep its name in the HSS for Public User Identities that have services related to the unregistered state.\nAS shall contact the S‑CSCF only in the case that it has the knowledge of the serving S‑CSCF based, e.g. on Sh query or third party registration. Otherwise, AS shall contact an I‑CSCF to continue the session initiation.\nThe procedure described below assumes that the Application Server takes care of the user plane connection.\nFigure 5.16b: Application Server origination procedure\nProcedure for Application Server origination is as follows:\n1.\tThe AS may proceed in either of the following ways:\n-\tIf the session requires the use of a S‑CSCF and:\n-\tIf the AS has acquired the address of the S‑CSCF (if not available already) for the Public User Identity or the Public Service Identity on whose behalf the AS intends to originate the session, e.g. through Sh interface or based on third party registration, the AS sends the session initiation request to the S‑CSCF (see step 2a).\n-\tIf the AS could not acquire a S‑CSCF address for the Public User Identity or the Public Service Identity, the AS sends the session initiation request to an I‑CSCF (see step 2d).\n-\tIf the Public Service Identity on whose behalf the AS intends to generate the session does not require the use of a S‑CSCF or if the user on whose behalf the AS intends to generate the session is a non-IMS user:\n-\tIf the AS supports routing capabilities (e.g. ENUM support, etc.), the AS sends the session initiation request directly towards the terminating network. In this case the AS may use the principles defined in IETF RFC 3263 [44] (see step 2b) to route the session initiation request.\n-\tIf the AS doesn't support routing capabilities, the AS shall send the session initiation request to the IMS Transit Functions (see step 2c). The IMS Transit Functions routes the session initiation request to the destination as described in clause 5.19.\n2a.\tThe AS sends the SIP INVITE request, containing an initial SDP, to the S‑CSCF.\nThe initial SDP may represent one or more media for a multi-media session.\n2b.\tThe AS sends the SIP INVITE request, containing an initial SDP, to the terminating network.\nThe subsequent steps assume that the session initiation procedure involves the S‑CSCF, i.e. they show the continuation of step 2a.\n2c.\tThe AS sends the SIP INVITE request, containing an initial SDP, to the IMS Transit Functions.\n2d.\tThe AS sends the SIP INVITE request, containing an initial SDP, to an I‑CSCF indicating that it is an originating request. The I‑CSCF selects the S‑CSCF and forwards the SIP INVITE to that S‑CSCF for further process. If the request is sent on behalf of the unregistered user, the procedure is described in clause 5.6.5.3.\n3.\tS‑CSCF identifies the incoming request as an originating request, and invokes any origination service logic required for this Public User Identity / Public Service Identity. The S‑CSCF handles the incoming request as an authenticated and authorized request, as it was originated by a trusted entity within the network. If the Request URI contains the SIP representation of a telephone number then the procedure specified in clause 4.3.5.3 applies.\n4.\tS‑CSCF forwards the request, as specified by the S-S procedures.\n5-6.\tThe media stream capabilities of the destination are returned along the signalling path.\n7-8.\tThe AS decides the offered set of media streams for this session, confirms receipt of the Offer Response and sends the Response Confirmation along the signalling path towards the destination network. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response or a subset. The AS is free to continue to offer new media on this operation or on subsequent exchanges using the Update method.\n9-10.\tThe terminating end point responds to the originating end with an acknowledgement, which is forwarded along the session signalling path. If Optional SDP is contained in the Response Confirmation, the Confirmation Acknowledge will also contain an SDP response.\n11-12.\tThe terminating endpoint responds to the originating end when successful resource reservation has occurred.\n13-14.\tThe destination UE may optionally perform alerting. If so, it signals this to the originating party by a provisional response indicating Ringing. This message is sent to the AS along the signalling path.\n15-16.\tWhen the destination party answers, the terminating endpoint sends a SIP 200-OK final response along the signalling path to the originating end.\n17-18.\tThe AS responds to the 200 OK with an ACK message which is passed along the signalling path to the terminating end.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.19",
        "clause_5.6.5.3",
        "clause_4.3.5.3",
        "figure_5.16"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.6.5.3",
      "section_id": "5.6.5.3",
      "section_title": "S‑CSCF selection by I‑CSCF for AS Originating call procedures",
      "content": "In figure 5.16c below the AS has no information of the serving S‑CSCF, and therefore the AS sends the request to an I‑CSCF as the entry point of the home network of the Public User Identity or the Public Service Identity. The AS finds an I‑CSCF by using the same mechanism as the S‑CSCF uses to find an I‑CSCF of the terminating network (see clauses 5.5.1 and 5.5.2). The request shall indicate that it is an originating request sent on behalf of the Public User Identity or the Public Service Identity.\nNOTE 1:\tIf border control concepts are applied, the contact point within an operator's network may be different, see clause 4.14 and Annex I for details.\nNOTE 2:\tThe procedure described below can be used by an external AS that cannot access HSS data using the Sh interface.\nThe procedure described below assumes that the Application Server takes care of the user plane connection.\nThis is shown by the information flow in figure 5.16c:\nFigure 5.16c: S‑CSCF selection by I‑CSCF for AS Originating call procedure\n1.\tThe I‑CSCF receives an INVITE message indicating that it is an AS originating procedure.\n2.\tThe I‑CSCF queries the HSS for current location information of the Public User Identity/Public Service Identity on whose behalf the request is sent.\n3.\tThe HSS either responds with the required S‑CSCF capabilities which the I‑CSCF should use as an input to select a S‑CSCF or provides the I‑CSCF with the previously allocated S‑CSCF name for that user or service.\nNOTE 3:\tThe HSS sends back the capabilities even if the Public User Identity/Public Service Identity is not registered and has no initial filter criteria related to the unregistered state.\n4.\tIf the I‑CSCF has not been provided with the location of the S‑CSCF, the I‑CSCF selects a S‑CSCF.\n5.\tThe I‑CSCF forwards the INVITE request to the S‑CSCF. The I‑CSCF must indicate that it is an originating request sent on behalf of the Public User Identity/Public Service Identity.\n6.\tThe S‑CSCF sends Cx-Put/Cx-Pull (Public User Identity/Public Service Identity, S‑CSCF name) to the HSS. When multiple and separately addressable HSSs have been deployed by the network operator, then the S‑CSCF needs to query the SLF to resolve the HSS. The HSS stores the S‑CSCF name for Public Service Identity or Public User Identities of that user. This will result in all traffic related to the Public Service Identity or the Public User Identities of that user being routed to this particular S‑CSCF until the registration period expires or the user attaches the Public User Identity to the network.\nNOTE 4:\tOptionally the S‑CSCF can omit the Cx-Put/Cx-Pull request if it has the relevant information from the user profile.\n7.\tThe HSS shall store the S‑CSCF name for that user or service and return the information flow Cx-Put Resp/Cx-Pull Resp (user information) to the S‑CSCF. The S‑CSCF shall store it.\n8.\tThe S‑CSCF invokes whatever service logic is appropriate for this call attempt, if required.\nNOTE 5:\tIf the Public User Identity/Public Service Identity is not registered and has no initial filter criteria related to the unregistered state, the S‑CSCF just routes the request further without invoking any service logic for this request.\n9.\tThe session setup continues as for normal origination procedures.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.14",
        "figure_5.16"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.0",
      "section_id": "5.7.0",
      "section_title": "General",
      "content": "This clause presents the detailed application level flows to define the Procedures for session terminations.\nThe flows presented in the clause assume the use of Policy and Charging Control for the establishment of QoS-Assured Sessions.\nThe session termination procedures specify the signalling path between the Serving‑CSCF assigned to perform the session termination service and the UE. This signalling path is determined at the time of UE registration, and remains fixed for the life of the registration.\nA UE always has a proxy (P‑CSCF) associated with it. This P‑CSCF performs resource authorization for the sessions to the UE and may have additional functions in handling of priority sessions. The P‑CSCF is determined by the CSCF discovery process, described in clause 5.1.1 (Local CSCF Discovery).\nAs a result of the registration procedure, the P‑CSCF knows the address of the UE. The assigned S‑CSCF, knows the name/address of the P‑CSCF (procedure MT#3, and MT#4, depending on the location of S‑CSCF and P‑CSCF).\nSessions destined to the PSTN are a special case of the Termination procedures. The MGCF uses H.248 to control a Media Gateway, and communicates with the SS7 network. The MGCF receives and processes SIP requests, and subsequent nodes consider the signalling as if it came from a S‑CSCF.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.1",
      "section_id": "5.7.1",
      "section_title": "(MT#1) Mobile termination, roaming",
      "content": "This termination procedure applies to roaming users.\nThe UE is located in a visited network, and determines the P‑CSCF via the CSCF discovery procedure described in clause 5.1.1. The home network advertises the S‑CSCF as the entry point from the visited network.\nWhen registration is complete, S‑CSCF knows the name/address of its next hop in the signalling path, the P‑CSCF and P‑CSCF knows the name/address of the UE.\nFigure 5.17: Mobile termination procedure - roaming\nProcedure MT#1 is as follows:\n1.\tThe originating party sends the SIP INVITE request, containing an initial SDP, via one of the origination procedures, and via one of the Inter-Serving procedures, to the Serving‑CSCF for the terminating users.\n2.\tS‑CSCF validates the service profile, and invokes any termination service logic required for this user. This includes authorization of the requested SDP based on the user's subscription for multi-media services.\n3.\tS‑CSCF remembers (from the registration procedure) the next hop CSCF for this UE. It forwards the INVITE to the P‑CSCF in the visited network.\n4.\tIf the P-CSCF determines that the termination is for an MPS session, the P-CSCF derives the session information and invokes dynamic policy sending the derived session information to the PCRF/PCF. The P‑CSCF remembers (from the registration procedure) the UE address, and forwards the INVITE to the UE.\n5.\tUE determines the subset of the media flows proposed by the originating endpoint that it supports, and responds with an Offer Response message back to the originator. The SDP may represent one or more media for a multi-media session. This response is sent to P‑CSCF.\n6.\tP‑CSCF instructs the PCRF/PCF to authorize the resources necessary for this session.\nNOTE:\tP‑CSCF can additionally authorize the resources in step 4 in scenarios where request indicates requirements for resource reservation or that the required resources are already available on the originating side, as in such cases no SDP answer is received before the PCRF/PCF is requested to authorize the required QoS resources.\n7.\tP‑CSCF forwards the Offer Response message to S‑CSCF.\n8.\tS‑CSCF forwards the Offer Response message to the originator, per the S-S procedure.\n9.\tThe originating endpoint sends a Response Confirmation via the S-S procedure, to S‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response sent in Step 8 or a subset. If new media are defined by this SDP, a new authorization (as in Step 6) will be done following Step 12. The originating UE is free to continue to offer new media on this operation or on subsequent exchanges using the Update method. Each offer/answer exchange will cause the P‑CSCF to repeat the Step 6 again.\n10.\tS‑CSCF forwards the Response Confirmation to P‑CSCF. This may possibly be routed through the I‑CSCF depending on operator configuration of the I‑CSCF.\n11.\tP‑CSCF forwards the Response Confirmation to UE.\n12.\tUE responds to the Response Confirmation with an acknowledgement. If Optional SDP is contained in the Response Confirmation, the Confirmation Ack will also contain an SDP response. If the SDP has changed, the P‑CSCF authorizes that the resources are allowed to be used.\n13.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the reservation procedures for the resources needed for this session as shown in Figure 5.17. Otherwise, the IP‑CAN initiates the reservation of required resources after step 6.\n14-15.\tPCSCF forwards the Confirmation Ack to the S‑CSCF and then to the originating end point via session path. Step 14 may be similar to Step 7 depending on whether or not configuration hiding is used.\n16-18.\tWhen the originating endpoint has completed its resource reservation, it sends the successful Resource Reservation message to S‑CSCF, via the S-S procedures. The S‑CSCF forwards the message toward the terminating endpoint along the signalling path.\n19.\tUE#2 alerts the destination user of an incoming session setup attempt.\n20-22.\tUE#2 responds to the successful resource reservation towards the originating end point.\n23-25.\tUE may alert the user and wait for an indication from the user before completing the session setup. If so, it indicates this to the originating party by a provisional response indicating Ringing. This message is sent to P‑CSCF and along the signalling path to the originating end.\n26.\tWhen the destination party answers, the UE sends a SIP 200-OK final response to P‑CSCF.\n27.\tP‑CSCF indicates to PCRF/PCF that the media flows for this session should now be enabled.\n28.\tUE starts the media flow(s) for this session.\n29-30.\tP‑CSCF sends a SIP 200-OK final response along the signalling path back to the S‑CSCF.\n31-33.\tThe originating party responds to the 200-OK final response with a SIP ACK message that is sent to S‑CSCF via the S-S procedure and forwarded to the terminating end along the signalling path.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.1",
        "figure_5.17"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.2",
      "section_id": "5.7.2",
      "section_title": "(MT#2) Mobile termination, home",
      "content": "This termination procedure applies to users located in their home service area.\nThe UE is located in the home network, and determines the P‑CSCF via the CSCF discovery procedures described in clause 5.1.1.\nWhen registration is complete, S‑CSCF knows the name/address of P‑CSCF, and P‑CSCF knows the name/address of the UE.\nFigure 5.18: Mobile termination procedure - home\nProcedure MT#2 is as follows:\n1.\tUE#1 sends the SIP INVITE request, containing an initial SDP, via one of the origination procedures, and via one of the Serving to Serving‑CSCF procedures, to the Serving‑CSCF for the terminating user.\n2.\tS‑CSCF validates the service profile, and invokes any termination service logic required for this user. This includes authorization of the requested SDP based on the user's subscription for multi-media services.\n3.\tS‑CSCF remembers (from the registration procedure) the next hop CSCF for this UE. It forwards the INVITE to the P‑CSCF in the home network.\n4.\tIf the P-CSCF determines that the termination is for an MPS session, the P-CSCF derives the session information and invokes dynamic policy sending the derived session information to the PCRF/PCF. The P‑CSCF remembers (from the registration procedure) the UE address, and forwards the INVITE to the UE.\n5.\tUE determines the subset of the media flows proposed by the originating endpoint that it supports, and responds with an Offer Response message back to the originator. The SDP may represent one or more media for a multi-media session. This response is sent to P‑CSCF.\n6.\tP‑CSCF instructs PCRF/PCF to authorize the resources necessary for this session.\nNOTE:\tP‑CSCF can additionally authorize the resources in step 4 in scenarios where request indicates no requirements for resource reservation or that the required resources are already available on the originating side, as in such cases no SDP answer is received before the PCRF/PCF is requested to authorize the required QoS resources.\n7.\tP‑CSCF forwards the Offer Response message to S‑CSCF.\n8.\tS‑CSCF forwards the Offer Response message to the originator, per the S-S procedure.\n9.\tThe originating endpoint sends a Response Confirmation via the S-S procedure, to S‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response sent in Step 8 or a subset. If new media are defined by this SDP, a new authorization (as in Step 6) will be done following Step 12. The originating UE is free to continue to offer new media on this operation or on subsequent exchanges using the Update method. Each offer/answer exchange will cause the P‑CSCF to repeat the Step 6 again.\n10.\tS‑CSCF forwards the Response Confirmation to P‑CSCF.\n11.\tP‑CSCF forwards the Response Confirmation to UE.\n12.\tUE responds to the Response Confirmation with an acknowledgement. If Optional SDP is contained in the Response Confirmation, the Confirmation Ack will also contain an SDP response. If the SDP has changed, the P‑CSCF authorizes that the resources are allowed to be used.\n13.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the reservation procedures for the resources needed for this session as shown in Figure 5.18. Otherwise, the IP‑CAN initiates the reservation of required resources after step 6.\n14-15.\tThe response is forwarded to the originating end point.\n16-18.\tWhen the originating endpoint has completed its resource reservation, it sends the successful Resource Reservation message to S‑CSCF, via the S-S procedures. The S‑CSCF forwards the message toward the terminating endpoint along the signalling path.\n19.\tUE#2 alerts the destination user of an incoming session setup attempt.\n20-22.\tUE#2 responds to the successful resource reservation and the message is forwarded to the originating end.\n23-25.\tUE may alert the user and wait for an indication from the user before completing the session. If so, it indicates this to the originating party by a provisional response indicating Ringing. This message is sent to P‑CSCF and along the signalling path to the originating end.\n26.\tWhen the destination party answers, UE sends a SIP 200-OK final response to P‑CSCF.\n27.\tP‑CSCF indicates that the authorized media flows for this session should now be enabled.\n28.\tUE starts the media flow(s) for this session.\n29-30.\tP‑CSCF forwards the 200-OK to S‑CSCF, following the signalling path.\n31-33.\tThe session originator responds to the 200-OK by sending the ACK message to S‑CSCF via the S-S procedure and it is forwarded to the terminating end along the signalling path.\n5.7.2a\t(MT#3) Mobile termination, CS Domain roaming\nThis termination procedure applies to a user registered for CS services, either in the home network or in a visited network. The user has both IMS and CS subscriptions but is unregistered for IMS services\nFigure 5.18a: Mobile Terminating procedures to a user that is unregistered for IMS services but is registered for CS services\n1.\tIf the terminating user does not have an S‑CSCF allocated, the session attempt is routed according to the clause 5.12.1 (Mobile Terminating procedures to unregistered IMS user that has services related to unregistered state).\n2.\tS‑CSCF invokes service control appropriate for this session setup attempt, which may result in e.g. re-routing the session to a messaging service, or continued routing towards the user's CS domain termination address (e.g. E.164).\n3.\tS‑CSCF performs whatever further actions are appropriate for this session setup attempt. In the case of routing towards the user's CS domain termination address, the S‑CSCF performs an analysis of this address. From the analysis of the destination address, S‑CSCF determines that this is for the CS domain, and passes the request to the BGCF.\n4.\tThe BGCF forwards the SIP INVITE message to the appropriate MGCF in the home network, or to a BGCF in another network. This depends on the PSTN interworking configuration of the IMS network. Eventually, the session initiation arrives to an MGCF.\n5.\tNormal session setup continues according to PSTN-T flow as described in clause 5.7.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.1",
        "clause_5.12.1",
        "clause_5.7.3",
        "figure_5.18"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.3",
      "section_id": "5.7.3",
      "section_title": "(PSTN-T) PSTN termination",
      "content": "The MGCF in the IM CN subsystem is a SIP endpoint that initiates and receives requests on behalf of the PSTN and Media Gateway (MGW).Other nodes consider the signalling as if it came from a S‑CSCF. The MGCF incorporates the network security functionality of the S‑CSCF.\nPSTN termination may be done in the same operator's network as the S‑CSCF of the session originator. Therefore, the location of the MGCF/MGW are given only as \"Terminating Network\" rather than \"Home Network\" or \"Visited Network\".\nFurther, agreements between network operators may allow PSTN termination in a network other than the originator's visited network or home network. This may be done, for example, to avoid long distance or international tariffs.\nFigure 5.19: PSTN termination procedure\nThe PSTN termination procedure is as follows:\n1.\tMGCF receives an INVITE request, containing an initial SDP, through one of the origination procedures and via one of the inter-serving procedures.\n2.\tMGCF initiates a H.248 interaction to pick an outgoing channel and determine media capabilities of the MGW.\n3.\tMGCF determines the subset of the media flows proposed by the originating endpoint that it supports, and responds with an Offer Response message back to the originator. This response is sent via the S-S procedure.\n4.\tThe originating endpoint sends a Response Confirmation. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response sent in Step 3 or a subset. The originating UE is free to continue to offer new media on this operation or on subsequent exchanges using the Update method.\n5.\tMGCF initiates a H.248 interaction to modify the connection established in step #2 and instruct MGW to reserve the resources necessary for the media streams.\n6.\tMGCF responds to the offered media towards the originating party.\n7.\tGW reserved the resources necessary for the media streams.\n8.\tWhen the originating endpoint has completed its resource reservation, it sends the successful Resource Reservation message to MGCF, via the S-S procedures.\n9.\tMGCF sends an IAM message to the PSTN.\n10.\tMGCF sends response to the successful resource reservation towards originating end.\n11.\tThe PSTN establishes the path to the destination. It may optionally alert the destination user before completing the session. If so, it responds with an ACM message.\n12.\tIf the PSTN is alerting the destination user, MGCF indicates this to the originating party by a provisional response indicating Ringing. This message is sent via the S-S procedures.\n13.\tWhen the destination party answers, the PSTN sends an ANM message to MGCF.\n14.\tMGCF initiates a H.248 interaction to make the connection in the MGW bi-directional.\n15.\tMGCF sends a SIP 200-OK final response along the signalling path back to the session originator.\n16.\tThe Originating party acknowledges the final response with a SIP ACK message.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.4",
      "section_id": "5.7.4",
      "section_title": "(NI-T) Non-IMS Termination to an external SIP client",
      "content": "This clause describes the IMS session setup procedures towards external SIP clients that don't support the required IMS SIP extensions.\nIn this scenario, the UE originates an IMS session without requiring the support for precondition capabilities, towards an external SIP entity that does not support those capabilities. Since required resources are not yet available at the UE, all the media components are set to inactive. In this example the external SIP client does not support the Precondition extension of SIP so the related precondition information within SIP/SDP is ignored.\nWhen both parties have agreed to the session and media parameters and the UE has established resources for the media, the UE initiates session modification setting the status of the media components to active and is thus enabling the media transfer to start. Figures 5.19b and 5.19c together illustrate session flows for one possible originating session establishment towards a non-IMS client in an external network with QoS authorization and Policy and Charging Control support.\nFor illustration purposes these session flows show the case of a non-roaming origination. This flow is a variant of MO#2 defined in clause 5.6.2. The same principles apply in roaming cases, i.e. analogous variants of MO#1 defined in clause 5.6.1 are also supported for interworking with SIP clients that do not support the required IMS procedures.\nFigure 5.19a: Void\nFigure 5.19b: Terminating session towards external SIP client, initiate session set up not requiring precondition capabilities and with inactive media\nThe UE initiates an INVITE message, which indicates the support of the precondition capability Since required resources are not yet available, the UE sets all media components to inactive state, as shown in figure 5.19b.\n1‑3.\tUE initiates a new IMS session indicating the support of the precondition capability and setting all media components to inactive state.\n4‑5.\tAcknowledgement of the session and media parameters are sent from the terminating side to the P‑CSCF.\n6.\tThe P‑CSCF may at this point instruct PCRF/PCF to authorize the resources being negotiated.\n7.\tThe acknowledgement of the session and media parameters forwarded towards the originating UE.\n8‑10.\tThe session is established, but media transfer is not allowed yet.\n11.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. The UE starts the resource reservation for the media as shown in Figure 5.19b. Otherwise, the IP‑CAN initiates the reservation of required resources after step 6.\nFigure 5.19c: Continuation of terminating session towards external SIP client, session set up with active media\nOnce the session parameters have been agreed and the UE has successfully reserved resources for the media components, the session set-up continues by setting the media components to active, as shown in session flow 5.19c.\n12‑14.\tUE initiates activation of media by initiating an INVITE procedure towards the terminating party.\n15‑16.\tThe terminating party accepts media activation, and corresponding signalling is passed back towards the originating party along the session path.\n17.\tThe P‑CSCF receives the acceptance of media activation. At this point, the P‑CSCF may instruct the PCRF/PCF to enable the media flows that have been authorized for the session.\n18.\tThe P‑CSCF forwards the signalling message to the originating UE indicating that the session setup can continue and activation of media is performed.\n19‑21.\tThe Session establishment is then acknowledged through the session path.\nAt this point in time, the session is established between the two parties.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6.2",
        "clause_5.6.1",
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.5",
      "section_id": "5.7.5",
      "section_title": "(AS-T#1) PSI based Application Server termination – direct",
      "content": "This clause depicts a routing example for incoming session where the session request is routed directly to the AS hosting the PSI.\nFigure 5.19d: Incoming session, direct route towards the AS\n1.\tI‑CSCF receives a request destined to the PSI.\n2-3.\tI‑CSCF queries the HSS in order to determine the next hop in the routing path for the PSI.\n4.\tHSS determines the routing information, i.e. the address of the AS hosting the PSI.\n5.\tHSS returns the AS address to the I‑CSCF.\n6-7.\tI‑CSCF forwards the request to the address received from the query.\n8-9.\tSession setup continues as per existing procedures.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.6",
      "section_id": "5.7.6",
      "section_title": "(AS-T#2) PSI based Application Server termination – indirect",
      "content": "This clause depicts an example routing scenario where the basic IMS routing via S‑CSCF is used to route the session.\nFigure 5.19e: Incoming session, indirect route to AS via S‑CSCF\n1.\tI‑CSCF receives a request destined to the PSI.\n2-3.\tI‑CSCF queries HSS in order to determine the next hop in the routing path for the PSI.\n4.\tHSS determines the routing information, which is the S‑CSCF defined for the \"PSI user\".\n5.\tHSS returns the S‑CSCF address/capabilities to the I‑CSCF.\n6-7.\tI‑CSCF, as per existing procedures, forwards the request towards the entity (i.e. S‑CSCF) received from the query, or the I‑CSCF selects a new S‑CSCF if required.\n8.\tS‑CSCF evaluates the filter criteria and gets the AS address where to forward the request.\n9.\tThe request is then routed towards the AS identified by the filter criteria.\n10-12.\tSession setup continues as per existing procedures.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.7",
      "section_id": "5.7.7",
      "section_title": "(AS-T#3) PSI based Application Server termination – DNS routing",
      "content": "This clause shows an example of DNS based routing of an incoming session from an external network. The routing from the external network leads to the entry point of the IMS subsystem hosting the subdomain of the PSI.\nFigure 5.19f: Incoming session, direct route to AS using DNS\n1.\tI‑CSCF receives a request that is destined to the PSI.\n2.\tI‑CSCF has been configured with the list of supported domains/network names, or it may have been configured to directly query a local DNS server.\n3.\tIn this case the I‑CSCF checks the list and finds a match.\n4.\tI‑CSCF sends DNS query to find the route.\n5.\tDNS server returns the IP address of the AS hosting the PSI.\n6-7.\tI‑CSCF forwards the request towards the IP address received from the query.\n8-9.\tSession setup continues as per existing procedures.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.7.8",
      "section_id": "5.7.8",
      "section_title": "(AST#4) Termination at Application Server based on service logic",
      "content": "This termination procedure applies to an Application Server that terminates a session. In this case the addressed user is a UE and is not hosted by the AS. Based on the invoked service logic at the Application Server the session is terminated at the AS.\nThe procedure described below assumes that the Application Server takes care of the user plane connection.\nFigure 5.19g: Application Server termination\n1.\tI‑CSCF receives a request destined to the user.\n2-3.\tI‑CSCF queries HSS in order to determine the next hop in the routing path for the user.\n4.\tHSS determines the routing information, which is the S‑CSCF defined for the user.\n5.\tHSS returns the S‑CSCF address/capabilities to the I‑CSCF.\n6-7.\tI‑CSCF, as per existing procedures, forwards the request to S‑CSCF that will handle the session termination.\n8.\tS‑CSCF evaluates the filter criteria and gets the AS address where to forward the request.\n9.\tThe request is then routed towards the AS identified by the filter criteria. The AS terminates the session instead of allowing it to continue on to the address end user.\n10-12.\tSession setup continues as per existing procedures.\n5.7a\tProcedures for the establishment of sessions without preconditions\n5.7a.1\tGeneral\nThese clauses present the general end-to-end session flow procedures without preconditions. The flow in clause 5.7a.2 is applicable to services without real-time QoS requirements before session becomes active, and thus do not need to set-up dedicated IP‑CAN bearers but can use existing IP‑CAN bearers, and to services which do not require that the terminating endpoint obtains a SIP‑level notification when the originating endpoint's IP‑CAN bearer becomes available.\nNOTE:\tThe flows in clauses 5.6 and 5.7 apply for services with real-time QoS requirements before session becomes active.\nNote that the flows in these clauses do not show the use of a THIG. If a THIG is used, the use is completely analogous to the use in clauses 5.5, 5.6 and 5.7.\n5.7a.2\tProcedures for the establishment of sessions without preconditions - no resource reservation required before session becomes active\nFigure 5.19h: End-to-end session flow procedure without preconditions - no resource reservation required before session becomes active\n1.\tUE#1 sends the SIP INVITE request, containing an initial SDP, to the P‑CSCF#1 determined via the P‑CSCF discovery mechanism. The initial SDP may represent one or more media for a multi-media session. It should be noted that a media offer without preconditions in general implies that the offering entity might expect to receive incoming media for any of the offered media as soon as the offer is received by the other endpoint. Therefore either an existing IP‑CAN bearer is assumed to be available for use or the application is implemented such that incoming media is not expected until some later point in time.\n2.\tP‑CSCF#1 examines the media parameters. If P‑CSCF#1 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session initiation attempt.\nNOTE 0a:\tWhether the P‑CSCF should interact with PCRF/PCF in this step is based on operator policy.\n3.\tP‑CSCF#1 forwards the INVITE request to S‑CSCF#1 along the path determined upon UE#1's most recent registration procedure.\n4.\tBased on operator policy S‑CSCF#1 validates the user's service profile and may invoke whatever service control logic is appropriate for this INVITE request. This may include routing the INVITE request to an Application Server, which processes the request further on.\n5.\tS‑CSCF#1 forwards INVITE request to I‑CSCF#2.\n6.\tI‑CSCF#2 performs Location Query procedure with the HSS to acquire the S‑CSCF address of the destination user (S‑CSCF#2).\n7.\tI‑CSCF#2 forwards the INVITE request to S‑CSCF#2.\n8.\tBased on operator policy S‑CSCF#2 validates the user's service profile and may invoke whatever service control logic is appropriate for this INVITE request. This may include routing the INVITE request to an Application Server, which processes the request further on.\n9.\tS‑CSCF#2 forwards the INVITE request to P‑CSCF#2 along the path determined upon UE#2's most recent registration procedure.\n10.\tP‑CSCF#2 examines the media parameters. If P‑CSCF#2 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session initiation attempt.\nNOTE 0b:\tWhether the P‑CSCF should interact with PCRF/PCF in this step is based on operator policy.\n11.\tP‑CSCF#2 forwards the INVITE request to UE#2.\n12. - 17.\tUE#2 may optionally generate a ringing message towards UE#1.\n18.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. UE#2 may reserve a dedicated IP‑CAN bearer for media based on the media parameters received in the SDP offer as shown in Figure 5.19h. Otherwise, the IP‑CAN#2 initiates the reservation of required resources after step 20 instead.\nNOTE 1:\tThe sequential ordering of 18 and 19 does not indicate that these steps are necessarily performed one after the other. If step 19 is performed before step 18 is finished, UE#2 shall use an existing IP‑CAN bearer to send and receive media unless the application is such that a new bearer is not needed until some later point in time. If step 18 is performed successfully, media are sent and received by UE#2 on the dedicated IP‑CAN bearer.\n19.\tUE#2 accepts the session with a 200 OK response. The 200 OK response is sent to P‑CSCF#2.\n20.\tBased on operator policy P‑CSCF#2 may instruct PCRF/PCF to authorize the resources necessary for this session.\n21. - 24.\tThe 200 OK response traverses back to UE#1.\n25.\tBased on operator policy P‑CSCF#1 may instruct the PCRF/PCF to authorize the resources necessary for this session.\n26.\tP‑CSCF#1 forwards the 200 OK response to UE#1.\n27. - 31.\tUE#1 acknowledges the 200 OK with an ACK, which traverses back to UE#2.\n32.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. UE#1 may reserve a dedicated IP‑CAN bearer for media based on the media parameters received in the SDP answer as shown in Figure 5.19h. Otherwise, the IP‑CAN#1 initiates the reservation of required resources after step 25.\nNOTE 2:\tThe sequential ordering of 27 and 32 does not indicate that these steps are necessarily performed one after the other. If step 32 is performed successfully, media are sent and received by UE#1 on the reserved dedicated IP‑CAN bearer. UE#1 may also use an existing IP‑CAN bearer to send and receive media.\n5.7a.3\tVoid",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.7",
        "figure_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.8.0",
      "section_id": "5.8.0",
      "section_title": "General",
      "content": "When a mobile terminated session set-up arrives at an I‑CSCF that is authorized to route sessions, the I‑CSCF interrogates the HSS for routing information. The mobile terminated sessions for a user shall be routed to a S‑CSCF.\nThe Cx reference point shall support retrieval of routing information from HSS to I‑CSCF. The resulting routing information is the contact information of S‑CSCF.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.8.1",
      "section_id": "5.8.1",
      "section_title": "User identity to HSS resolution",
      "content": "This clause describes the resolution mechanism, which enables the I‑CSCF, the S‑CSCF and the AS to find the address of the HSS, that holds the subscriber data for a given user identity when multiple and separately addressable HSSs have been deployed by the network operator. This resolution mechanism is implemented using a Subscription Locator Function (SLF) or a Diameter Proxy Agent that proxies the request to the HSS. This resolution mechanism is not required in networks that utilise a single HSS e.g. optionally, it could be switched off on the I‑CSCF and on the S‑CSCF and/or on the AS using O&M mechanisms. An example for a single HSS solution is a server farm architecture. By default, the resolution mechanism shall be supported.\nOn REGISTER and on MT INVITEs, the I‑CSCF queries the HSS for user's subscription specific data, e. g. the actual location or authentication parameters. This also has to be accomplished by the S‑CSCF on REGISTER. In the case when more than one independently addressable HSS is utilized by a network operator, the HSS where user information for a given subscriber is available has to be found. To get the HSS name the I‑CSCF and the S‑CSCF query the SLF entity or the I‑CSCF and the S‑CSCF send the query to the HSS via a Diameter Proxy Agent.\nThe SLF is accessed via the Dx interface or via the Dh interface. The Dx interface is the standard interface between the CSCF and the SLF and the Dh interface is the standard interface between the AS and the SLF. The synchronisation between the SLF and the different HSSs is an O&M issue.\nA way to use the SLF is described in the following.\nThe Dx interface provides:\n-\tan operation to query the SLF from the I‑CSCF or from the S‑CSCF, respectively.\n-\ta response to provide the HSS name towards the I‑CSCF or towards the S‑CSCF, respectively.\nBy sending the Dx-operation DX_SLF_QUERY the I‑CSCF or the S‑CSCF indicates a user identity of which it is looking for an HSS. By the Dx-operation DX_SLF_RESP the SLF responds with the HSS name. The I‑CSCF or the S‑CSCF, respectively, continues by querying the selected HSS. The I‑CSCF may forward the HSS name towards the S‑CSCF. The S‑CSCF may use this name to find the subscriber's HSS.\nClause 5.8.2 presents the session flows on REGISTER and clause 5.8.3 on INVITE messages.\nThe Dh interface provides:\n-\tan operation to query the SLF from the AS.\n-\ta response to provide the HSS name towards the AS.\nBy sending the Dh-operation DH_SLF_QUERY the AS indicates a Public User Identity of which it is looking for an HSS. By the Dh-operation DH_SLF_RESP the SLF responds with the HSS name. The AS continues by querying the selected HSS. The AS may store the HSS name for the subsequent Sh-operations.\nClause 5.8.4 presents the message flow on the Dh interface.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.8.3",
        "clause_5.8.4"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.8.2",
      "section_id": "5.8.2",
      "section_title": "SLF on register",
      "content": "Figure 5.20: SLF on register (1st case)\n1.\tI‑CSCF receives a REGISTER request and now has to query for the location of the user's subscription data.\n2.\tThe I‑CSCF sends a DX_SLF_QUERY to the SLF and includes as parameter the user identity which is stated in the REGISTER request.\n3.\tThe SLF looks up its database for the queried user identity.\n4.\tThe SLF answers with the HSS name in which the user's subscription data can be found.\n5.\tThe I‑CSCF can proceed by querying the appropriate HSS.\nFigure 5.20a: SLF on register (2nd case)\n1.\tI‑CSCF sends a REGISTER request to the S‑CSCF. This now has to query for the location of the user's subscription data.\n2.\tThe S‑CSCF sends a DX_SLF_QUERY to the SLF and includes as parameter the user identity which is stated in the REGISTER request.\n3.\tThe SLF looks up its database for the queried user identity.\n4.\tThe SLF answers with the HSS name in which the user's subscription data can be found.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.20"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.8.3",
      "section_id": "5.8.3",
      "section_title": "SLF on UE invite",
      "content": "Figure 5.21: SLF on UE invite\n1.\tI‑CSCF receives an INVITE request and now has to query for the location of the user's subscription data.\n2.\tThe I‑CSCF sends a DX_SLF_QUERY to the SLF and includes as parameter the user identity which is stated in the INVITE request. If the user identity is an E.164 number in the SIP URI with user=phone parameter format the I‑CSCF shall first translate it into the Tel: URI format per IETF RFC 3966 [15] prior to sending to the SLF the DX_SLF_QUERY.\n3.\tThe SLF looks up its database for the queried user identity.\n4.\tThe SLF answers with the HSS name in which the user's subscription data can be found.\nTo prevent an SLF service failure e.g. in the event of a server outage, the SLF could be distributed over multiple servers. Several approaches could be employed to discover these servers. An example is the use of the DNS mechanism in combination with a new DNS SRV record. The specific algorithm for this however does not affect the basic SLF concept and is outside the scope of this document.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.21"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.8.4",
      "section_id": "5.8.4",
      "section_title": "SLF on AS access to HSS",
      "content": "The flow shown below is where the AS queries the SLF to identify the HSS to access.\nFigure 5.21a: SLF on AS access to HSS\n1.\tAn AS sends a DH_SLF_QUERY to the SLF and includes as a parameter the Public User Identity.\n2.\tThe SLF looks up its database for the queried Public User Identity.\n3.\tThe SLF answers with the HSS name in which the user's subscription data can be found.\n4.\tThe AS sends the Sh message towards the correct HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.21"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.9",
      "section_id": "5.9",
      "section_title": "Routing of mid-session signalling",
      "content": "During the signalling exchanges that occur to establish an IM Session, the following elements must ensure future signalling messages related to this session are routed through them:\n-\tP‑CSCF serving the originating UE, in order to generate the CDR record in the roaming case, and to force release of the resources used for the session.\n-\tS‑CSCF serving the originating UE, in order to invoke any service logic required at session setup completion, and to generate the CDR record at session termination.\n-\tS‑CSCF serving the terminating UE, in order to invoke any service logic required at session setup completion, and to generate the CDR record at session termination.\n-\tP‑CSCF serving the terminating UE, in order to generate the CDR record in the roaming case, and to force release of the resources used for the session.\nOther CSCFs (e.g. I‑CSCFs) may optionally request this as well, for example if they perform some function needed in handling mid-session changes or session clearing operations.\nAll signalling message from the UE related to IMS sessions shall be sent to the P‑CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.10.0",
      "section_id": "5.10.0",
      "section_title": "General",
      "content": "This clause provides scenarios showing SIP application session release. Note that these flows have avoided the strict use of specific SIP protocol message names. This is in an attempt to focus on the architectural aspects rather than the protocol. SIP is assumed to be the protocol used in these flows.\nThe session release procedures are necessary to ensure that the appropriate billing information is captured and to reduce the opportunity for theft of service by confirming that the bearers associated with a particular SIP session are deleted at the same time as the SIP control signalling and vice versa. Session release is specified for the following situations:\n-\tNormal session termination resulting from an end user requesting termination of the session using session control signalling or deletion of the IP bearers associated with a session;\n-\tSession termination resulting from network operator intervention;\n-\tLoss of the session control bearer or IP bearer for the transport of the IMS signalling; and\n-\tLoss of one or more radio connections which are used to transport the IMS signalling.\nAs a design principle the session release procedures shall have a high degree of commonality in all situations to avoid complicating the implementation.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.10.1",
      "section_id": "5.10.1",
      "section_title": "Terminal initiated session release",
      "content": "The following flow shows a terminal initiated IM CN subsystem application (SIP) session release. It is assumed that the session is active and that the bearer was established directly between the two visited networks (the visited networks could be the Home network in either or both cases). Furthermore, the flow also assumes that Policy and Charging Control is in use.\nFigure 5.22: Terminal initiated session release\n1.\tOne party hangs up, which generates a message (Bye message in SIP) from the UE to the P‑CSCF.\n2.\tDepending on the bearer establishment mode selected for the IP‑CAN session, release resource(s) shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the release procedures for the resources used for this session as shown in Figure 5.22. Otherwise, the IP‑CAN initiates the release of used resources after step 4.\n3.\tVoid.\n4.\tThe P‑CSCF instruct the PCRF/PCF to remove the authorization for resources that had previously been issued for this endpoint for this session. This step will also result in a release indication to the IP‑CAN to confirm that the IP bearers associated with the session have been deleted.\n5.\tThe P‑CSCF sends a Hangup to the S‑CSCF of the releasing party.\n6.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n7.\tThe S‑CSCF of the releasing party forwards the Hangup to the S‑CSCF of the other party.\n8.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n9.\tThe S‑CSCF of the other party forwards the Hangup on to the P‑CSCF.\n10.\tThe P‑CSCF instructs the PCRF/PCF to remove the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the IP‑CAN to confirm that the IP bearers associated with the UE#2 session have been deleted.\n11.\tThe P‑CSCF forwards the Hangup on to the UE.\n12.\tThe terminal responds with an acknowledgement, the SIP OK message (number 200), that is sent back to the P‑CSCF.\n13.\tDepending on the bearer establishment mode selected for the IP‑CAN session, release resource(s) shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the release procedures for the resources used for this session as shown in Figure 5.22. Otherwise, the IP‑CAN initiates the release of used resources after step 11.\n14\tVoid.\n15.\tThe SIP OK message is sent to the S‑CSCF.\n16.\tThe S‑CSCF of the other party forwards the OK to the S‑CSCF of the releasing.\n17.\tThe S‑CSCF of the releasing party forwards the OK to the P‑CSCF of the releasing.\n18.\tThe P‑CSCF of the releasing party forwards the OK to the UE.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.22"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.10.2",
      "section_id": "5.10.2",
      "section_title": "PSTN initiated session release",
      "content": "The following flow shows a PSTN terminal initiated IM CN subsystem application (SIP) session release. It is assumed that the session is active and that the bearer was established to the PSTN from the Home Network (the visited network could be the Home network in this case). Furthermore, this flow assumes that Policy and Charging Control is used.\nFigure 5.23: PSTN initiated session release\n1.\tPSTN party hangs up, which generates an ISUP REL message to the MGCF.\n2.\tThe MGCF sends a Hangup (Bye message in SIP) to the S‑CSCF to notify the terminal that the far end party has disconnected.\n3.\tStep 3 may be done in parallel with Step 2. Depending on the GSTN network type Step 3 may need to wait until after step 14. The MGCF notes the reception of the REL and acknowledges it with an RLC. This is consistent with the ISUP protocol.\n4.\tThe MGCF requests the MGW to release the vocoder and ISUP trunk using the H.248/MEGACO Transaction Request (subtract). This also results in disconnecting the two parties in the H.248 context. The IP network resources that were reserved for the message receive path to the PSTN for this session are now released. This is initiated from the MGW. If RSVP was used to allocated resources, then the appropriate release messages for that protocol would be invoked here.\n5.\tThe MGW sends an acknowledgement to the MGCF upon completion of step 4.\n6.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n7.\tThe S‑CSCF forwards the Hangup to the P‑CSCF.\n8.\tThe P‑CSCF instructs the PCRF/PCF to remove the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the IP‑CAN to confirm that the IP bearers associated with the UE#2 session have been deleted.\n9.\tThe P‑CSCF forwards the Hangup to the UE.\n10.\tThe terminal responds with an acknowledgement, the SIP OK message (number 200), which is sent back to the P‑CSCF.\n11-12.\tThe IP network resources that had been reserved for the message receive path to the endpoint for this session are released, taking into account the bearer establishment mode used for the IP‑CAN session. Steps 11and 12 may be done in parallel with step 10. If RSVP was used to allocated resources, then the appropriate release messages for that protocol would be invoked here.\n13.\tThe SIP OK message is sent to the S‑CSCF.\n14.\tThe S‑CSCF forwards the message to the MGCF.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.23"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.10.3.0",
      "section_id": "5.10.3.0",
      "section_title": "Removal of IP‑CAN bearer used to transport IMS SIP signalling",
      "content": "It is possible that the IP‑CAN removes the IP‑CAN bearer used to transport IMS SIP signalling (e.g. due to overload situations).\nIn this case the UE or network shall initiate a procedure to re-establish (or modify where possible) an IP‑CAN bearer to transport IMS SIP signalling. After the re-establishment of an IP‑CAN bearer the UE should perform a re-registration to the IMS.\nIf the re-establishment (or the modification) fails then the UE or network shall de-activate all other IMS related IP‑CAN bearer(s).\nThe deactivation of the IP‑CAN bearer(s) results in the P‑CSCF being informed via PCRF/PCF of the IP-CAN bearer release P-CSCF may, depending on policy, initiate a network initiated session release as described in clause 5.10.3.1.\nThe failure in re-establishing the ability to communicate towards the UE results also in the P‑CSCF/PCRF/PCF being informed that the IMS SIP signalling transport to the UE is no longer possible which shall lead to a network initiated session release (initiated by the P‑CSCF) as described in clause 5.10.3.1 if any IMS related session is still ongoing for that UE. Additionally, the P‑CSCF shall reject subsequent incoming session requests towards the remote endpoint indicating that the user is not reachable, until either:\n-\tthe registration timer expires in P‑CSCF and the user is de-registered from IMS.\n-\ta new Register message from the UE is received providing an indication to the P‑CSCF that the IMS SIP signalling transport for that user has become available again and session requests can be handled again.\nThe P‑CSCF shall not assume that the IMS SIP signalling transport is lost unless the P‑CSCF receives a notification of loss of signalling connectivity from the PCRF/PCF as defined in this clause. The P‑CSCF shall not reject subsequent incoming session requests towards the remote endpoint based upon notification of other events e.g. upon PCRF/PCF notification of loss of a media bearer or upon the failure to deliver an INVITE message to the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.10.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.10.3.1.0",
      "section_id": "5.10.3.1.0",
      "section_title": "General",
      "content": "This clause assumes that Policy and Charging Control is applied\nThe following flows show a Network initiated IM CN subsystem application (SIP) session release. It is assumed that the session is active and that the bearer was established directly between the two visited networks (the visited networks could be the Home network in either or both cases).\nA bearer is removed e.g. triggered by a UE power down, due to a previous loss of coverage, or accidental/malicious removal, etc. In this case an IP‑CAN session modification procedure (GW initiated) will be performed (see TS 23.203 [54] and TS 23.503 [95]). The flow for this case is shown in Figure 5.26.\nOther network initiated session release scenarios are of course possible.",
      "chunk_type": "definition",
      "cross_references": [
        "figure_5.26",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.10.3.1.1",
      "section_id": "5.10.3.1.1",
      "section_title": "Network initiated session release - P‑CSCF initiated – after removal of IP-Connectivity Access Network bearer",
      "content": "Figure 5.26: Network initiated session release - P‑CSCF initiated – after removal of IP‑CAN bearer\n1.\tA bearer related to the session is terminated. The P‑CSCF receives an indication via PCRF/PCF of IP‑CAN bearer release.\n2.\tThe P‑CSCF instructs PCRF/PCF to remove the authorization for resources related to the released bearer that had previously been issued for this endpoint for this session (see TS 23.203 [54] and TS 23.503 [95]). It is optional for the P‑CSCF to instruct PCRF/PCF to deactivate additional IP‑CAN bearers (e.g. an IP‑CAN bearer for chat could still be allowed).\n3.\tThe P‑CSCF decides on the termination of the session. For example, the P‑CSCF may decide to terminate the session if all IP‑CAN bearers related to the same IMS session are deleted. In the event of the notification that the signalling transport to the UE is no longer possible, the P‑CSCF shall terminate any ongoing session with that specific UE.\nIf the P‑CSCF decides to terminate the session, then the P‑CSCF instructs the PCRF/PCF to remove the authorization for resources that has previously been issued for this endpoint for this session (see TS 23.203 [54] and TS 23.503 [95]).\nThe following steps are only performed if the P‑CSCF has decided to terminate the session.\n4.\tThe P‑CSCF generates a Hangup (Bye message in SIP) to the S‑CSCF of the releasing party.\n5.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n6.\tThe S‑CSCF of the releasing party forwards the Hangup to the S‑CSCF of the other party.\n7.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n8.\tThe S‑CSCF of the other party forwards the Hangup on to the P‑CSCF.\n9.\tThe P‑CSCF instructs the PCRF/PCF to remove the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the IP‑CAN to confirm that the IP bearers associated with the session have been deleted for UE#2.\n10.\tThe P‑CSCF forwards the Hangup on to the UE.\n11.\tThe UE responds with an acknowledgement, the SIP OK message (number 200), which is sent back to the P‑CSCF.\n12-13.\tSteps 12 and 13 may be done in parallel with step 11. The IP network resources that had been reserved for the UE for this session are released, taking into account the bearer establishment mode used for the IP‑CAN session. If RSVP was used to allocated resources, then the appropriate release messages for that protocol would be invoked here.\n14.\tThe SIP OK message is sent to the S‑CSCF.\n15.\tThe S‑CSCF of the other party forwards the OK to the S‑CSCF of the releasing party.\n16.\tThe S‑CSCF of the releasing party forwards the OK to the P‑CSCF of the releasing party.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.26",
        "ts_23.203",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.10.3.2",
      "section_id": "5.10.3.2",
      "section_title": "Network initiated session release - S‑CSCF Initiated",
      "content": "The following flow shows a network-initiated IM CN subsystem application session release, where the release is initiated by the S‑CSCF. This can occur in various service scenarios, e.g. administrative, or prepaid.\nThe procedures for clearing a session, when initiated by an S‑CSCF, are as shown in the following information flow. The flow assumes that Policy and Charging Control is in use.\nFigure 5.27: Network initiated session release - S‑CSCF initiated\nInformation flow procedures are as follows:\n1.\tS‑CSCF#1 decides the session should be terminated, due to administrative reasons or due to service expiration.\n2.\tS‑CSCF#1 sends a Hangup message to P‑CSCF#1.\n3.\tP‑CSCF#1 removes the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the IP‑CAN to confirm that the IP bearers associated with the session have been deleted for UE#1.\n4.\tP‑CSCF#1 forwards the Hangup message to UE#1.\n5.\tUE#1 stops sending the media stream to the remote endpoint, and the resources used for the session are released taking into account the bearer establishment mode used for the IP‑CAN session.\n6.\tUE#1 responds with a SIP‑OK message to its proxy, P‑CSCF#1.\n7.\tP‑CSCF#1 forwards the SIP‑OK message to S‑CSCF#1.\n8.\tS‑CSCF#1 sends a Hangup message to S‑CSCF#2. This is done at the same time as flow#2.\n9.\tS‑CSCF#2 invokes whatever service logic procedures are appropriate for this ending session.\n10.\tS‑CSCF#2 forwards the Hangup message to P‑CSCF#2.\n11.\tP‑CSCF#2 removes the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the IP‑CAN to confirm that the IP bearers associated with the session have been deleted for UE#2.\n12.\tP‑CSCF#2 forwards the Hangup message to UE#2.\n13.\tUE#2 stops sending the media stream to the remote end point, and the resources used for the session are released taking into account the bearer establishment mode used for the IP‑CAN session.\n14.\tUE#2 acknowledges receipt of the Hangup message with a SIP‑OK final response, send to P‑CSCF#2.\n15.\tP‑CSCF#2 forwards the SIP‑OK final response to S‑CSCF#2.\n16.\tS‑CSCF#2 forwards the SIP‑OK final response to S‑CSCF#1.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.27"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.1.0",
      "section_id": "5.11.1.0",
      "section_title": "General",
      "content": "This clause gives information flows for the procedures for placing sessions on hold that were previously established by the mechanisms of clauses 5.4, 5.5, 5.6, and 5.7, and resuming the session afterwards. Two cases are presented: mobile-to-mobile (UE-UE), and a UE-initiated hold of a UE-PSTN session.\nFor a multi-media session, it shall be possible to place a subset of the media streams on hold while maintaining the others.\nThese procedures do not show the use of optional I‑CSCFs. If an I‑CSCF was included in the signalling path during the session establishment procedure, it would continue to be used in any subsequent flows such as the ones described in this clause.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.1.1",
      "section_id": "5.11.1.1",
      "section_title": "Mobile-to-Mobile Session Hold and Resume Procedures",
      "content": "An IMS session was previously established between an initiating UE and a terminating UE. Each of these UEs has an associated P‑CSCF, and a S‑CSCF assigned in their home network. The procedures are independent of whether the P‑CSCFs are located in the home or visited networks. Therefore there is no distinction in this clause of home network vs. visited network.\nThe hold and resume procedures are identical whether the UE that initiated the session also initiates the session-hold, or whether the UE that terminated the session initiates the session-hold.\nWhen a media stream has been placed on hold, it shall not be resumed by any endpoint other than the one that placed it on hold.\nThe procedures for placing a media stream on hold, and later resuming the media stream, are as shown in the following information flow:\nFigure 5.28: Mobile to Mobile session hold and resume\nInformation flow procedures are as follows:\n1.\tUE#1 detects a request from the user to place a media stream on hold. UE#1 stops sending the media stream to the remote endpoint, but keeps the resources for the session reserved.\n2.\tUE#1 sends a Hold message to its proxy, P‑CSCF#1.\n3.\tP‑CSCF#1 forwards the Hold message to S‑CSCF#1.\n4.\tS‑CSCF#1 forwards the Hold message to S‑CSCF#2.\n5.\tS‑CSCF#2 forwards the Hold message to P‑CSCF#2.\n6.\tP‑CSCF#2 forwards the Hold message to UE#2.\n7.\tUE#2 stops sending the media stream to the remote endpoint, but keeps the resources for the session reserved.\n8.\tUE#2 acknowledges receipt of the Hold message with a 200-OK final response, send to P‑CSCF#2.\n9.\tP‑CSCF#2 forwards the 200 OK final response to S‑CSCF#2.\n10.\tS‑CSCF#2 forwards the 200 OK final response to S‑CSCF#1.\n11.\tS‑CSCF#1 forwards the 200 OK final response to P‑CSCF#1.\n12.\tP‑CSCF#1 forwards the 200 OK final response to UE#1.\n13.\tUE#1 detects a request from the user to resume the media stream previously placed on hold. UE#1 sends a Resume message to its proxy, P‑CSCF#1.\n14.\tP‑CSCF#1 forwards the Resume message to S‑CSCF#1.\n15.\tS‑CSCF#1 forwards the Resume message to S‑CSCF#2.\n16.\tS‑CSCF#2 forwards the Resume message to P‑CSCF#2.\n17.\tP‑CSCF#2 forwards the Resume message to UE#2.\n18.\tUE#2 resumes sending the media stream to the remote endpoint.\n19.\tUE#2 acknowledges receipt of the Resume message with a 200-OK final response, sent to P‑CSCF#2.\n20.\tP‑CSCF#2 forwards the 200 OK final response to S‑CSCF#2.\n21.\tS‑CSCF#2 forwards the 200 OK final response to S‑CSCF#1.\n22.\tS‑CSCF#1 forwards the 200 OK final response to P‑CSCF#1.\n23.\tP‑CSCF#1 forwards the 200 OK final response to UE#1.\n24.\tUE#1 resumes sending the media stream to the remote endpoint.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.28"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.1.2",
      "section_id": "5.11.1.2",
      "section_title": "Mobile-initiated Hold and Resume of a Mobile-PSTN Session",
      "content": "An IMS session was previously established between an initiating UE and a MGCF acting as a gateway for a session terminating on the PSTN, or between an initiating MGCF acting as a gateway for a session originating on the PSTN to a terminating UE. The UE has an associated P‑CSCF, an S‑CSCF assigned in its home network, and a BGCF that chooses the MGCF. The procedures are independent of whether the P‑CSCF is located in the subscriber's home or visited network. Therefore there is no distinction in this clause of home network vs. visited network.\nThe session hold and resume procedure is similar whether the UE initiated the session to the PSTN, or if the PSTN initiated the session to the UE. The only difference is the optional presence of the BGCF in the case of a session initiated by the UE. Note that the BGCF might or might not be present in the signalling path after the first INVITE is routed.\nThe procedures for placing a media stream on hold, and later resuming the media stream, are as shown in the following information flow:\nFigure 5.29: Mobile-initiated Hold and Resume of a Mobile-PSTN Session\nInformation flow procedures are as follows:\n1.\tUE detects a request from the user to place a media stream on hold. UE#1 stops sending the media stream to the remote endpoint, but keeps the resources for the session reserved.\n2.\tUE sends a Hold message to its proxy, P‑CSCF.\n3.\tP‑CSCF forwards the Hold message to S‑CSCF.\n4.\tS‑CSCF forwards the Hold message to BGCF.\n5.\tBGCF forwards the Hold message to MGCF.\n5a\tMGCF sends a CPG(hold) in order to express that the call has been placed on hold.\n6.\tMGCF initiates a H.248 interaction with MGW instructing it to stop sending the media stream, but to keep the resources for the session reserved.\n7.\tMGCF acknowledges receipt of the Hold message with a 200-OK final response, send to BGCF.\n8.\tBGCF forwards the 200-OK to the S‑CSCF.\n9.\tS‑CSCF forwards the 200 OK final response to P‑CSCF.\n10.\tP‑CSCF forwards the 200 OK final response to UE.\n11.\tUE detects a request from the user to resume the media stream previously placed on hold. UE sends a Resume message to its proxy, P‑CSCF.\n12.\tP‑CSCF forwards the Resume message to S‑CSCF.\n13.\tS‑CSCF forwards the Resume message to BGCF.\n14.\tBGCF forwards the Resume message to MGCF.\n14a.\tMGCF sends a CPG(resume) in order to resume the call.\n15.\tMGCF initiates a H.248 interaction with MGW instructing it to resume sending the media stream.\n16.\tMGCF acknowledges receipt of the Resume message with a 200-OK final response, sent to BGCF.\n17.\tBGCF forwards the 200 OK final response to the S‑CSCF.\n18.\tS‑CSCF forwards the 200 OK final response to P‑CSCF.\n19.\tP‑CSCF forwards the 200 OK final response to UE.\n20.\tUE resumes sending the media stream to the remote endpoint.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.29"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.1.3",
      "section_id": "5.11.1.3",
      "section_title": "PSTN-initiated Hold and Resume of a Mobile-PSTN Session",
      "content": "An IMS session was previously established between an initiating UE and a MGCF acting as a gateway for a session terminating on the PSTN, or between an initiating MGCF acting as a gateway for a session originating on the PSTN to a terminating UE. The UE has an associated P‑CSCF, an S‑CSCF assigned in its home network, and a BGCF that chooses the MGCF. The procedures are independent of whether the P‑CSCF is located in the subscriber's home or visited network. Therefore there is no distinction in this clause of home network vs. visited network.\nThe session hold and resume procedure is similar whether the UE initiated the session to the PSTN, or if the PSTN initiated the session to the UE. The only difference is the optional presence of the BGCF in the case of a session initiated by the UE. Note that the BGCF might or might not be present in the signalling path after the first INVITE is routed.\nThe following information flow shows the procedures, where the session is set on hold from the PSTN side:\nFigure 5.29a: PSTN-initiated Hold and Resume of a Mobile-PSTN Session\nInformation flow procedures are as follows:\n1.\tThe call is placed on hold in the PSTN.\n2.\tThe MGCF receives a CPG (hold) from the PSTN, which indicates that the call has been placed on hold.\n3.\tMGCF sends a Hold message to BGCF.\n4.\tBGCF forwards the Hold message to S‑CSCF.\n5.\tS‑CSCF forwards the Hold message to P‑CSCF.\n6.\tP‑CSCF forwards the Hold message to the UE.\n7.\tUE stops sending the media stream to the remote endpoint, but keeps the resources for the session reserved.\n8.\tThe UE acknowledges receipt of the Hold message with a 200-OK final response, send to P‑CSCF.\n9.\tP‑CSCF forwards the 200-OK final response to S‑CSCF.\n10.\tS‑CSCF forwards the 200 OK final response to BGCF.\n11.\tBGCF forwards the 200 OK final response to MGCF.\n12.\tThe call is resumed in the PSTN.\n13.\tMGCF receives a CPG (resume) request from the PSTN, which indicates that the call is resumed.\n14.\tMGCF sends a resume message to BGCF.\n15.\tBGCF forwards the Resume message to S‑CSCF.\n16.\tS‑CSCF forwards the Resume message to P‑CSCF.\n17.\tP‑CSCF forwards the Resume message to UE.\n18.\tUE resumes sending the media stream to the remote endpoint.\n19.\tUE acknowledges receipt of the Resume message with a 200-OK final response, sent to P‑CSCF.\n20.\tP‑CSCF forwards the 200 OK final response to the S‑CSCF.\n21.\tS‑CSCF forwards the 200 OK final response to BGCF.\n22.\tBGCF forwards the 200 OK final response to MGCF.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.29"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.2.0",
      "section_id": "5.11.2.0",
      "section_title": "General",
      "content": "This clause gives information flows for the procedures for an anonymous session. However, sessions are not intended to be anonymous to the originating or terminating network operators.\nThe purpose of the mechanism is to give an IMS user the possibility to withhold certain identity information as specified in IETF RFC 3323 [39] and IETF RFC 3325 [40].\nThe privacy mechanism for IMS networks shall not create states in the CSCFs other than the normal SIP states.\nIMS entities shall determine whether they are communicating with an element of the same Trust Domain for Asserted Identity or not as described in IETF RFC 3325 [40].",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.2.1",
      "section_id": "5.11.2.1",
      "section_title": "Signalling requirements for anonymous session establishment",
      "content": "The user shall be able to request that her identity information is not revealed to the terminating party.\nIf the originating user requests the session to be anonymous, the terminating side must not reveal any identity or signalling routing information to the destination endpoint. The terminating network should distinguish at least two cases, first where the originator intended the session to be anonymous, and second where the originator's identity was deleted by a transit network.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.2.2",
      "section_id": "5.11.2.2",
      "section_title": "Bearer path requirements for anonymous session establishment",
      "content": "Procedures for establishment of an anonymous bearer path are not standardised in this release.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.3.0",
      "section_id": "5.11.3.0",
      "section_title": "General",
      "content": "This clause gives information flows for:\n-\tthe procedures for determining the set of negotiated characteristics between the endpoints of a multi-media session, determining the initial media characteristics (including common codecs) to be used for the multi-media session, and\n-\tthe procedures for modifying a session within the existing resources reservation or with a new resources reservation (adding/deleting a media flow, changing media characteristics including codecs, changing bandwidth requirements) when the session is already established.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.3.1",
      "section_id": "5.11.3.1",
      "section_title": "Codec and media characteristics flow negotiation during initial session establishment",
      "content": "Initial session establishment in the IM CN subsystem must determine a negotiated set of media characteristics (including a common codec or set of common codecs for multi-media sessions) that will be used for the session. This is done through an end-to-end message exchange to determine the complete set of media characteristics, then the decision is made by the session initiator as to the initial set of media flows.\nThe session initiator includes an SDP in the SIP INVITE message that lists every media characteristics (including codecs) that the originator is willing to support for this session. When the message arrives at the destination endpoint, it responds with the media characteristics (e.g. common subset of codecs) that it is also willing to support for the session. Media authorization is performed for these media characteristics. The session initiator, upon receiving the common subset, determines the media characteristics (including codecs) to be used initially.\nThe negotiation may take multiple media offered and answered between the end points until the media set is agreed upon.\nOnce the session is established, the procedures of clause 5.11.3.2 may be used by either endpoint to change to a different media characteristic (e.g. codec) that was included in the initial session description, and for which no additional resources are required for media transport. The procedures of clause 5.11.3.3 may be used by either endpoint to change the session, which requires resources beyond those allocated to the existing session.\nThe flow presented here assumes that Policy and Charging Control is in use.\nFigure 5.30: Codec negotiation during initial session establishment\nThe detailed procedure is as follows:\n1.\tUE#1 inserts the codec(s) to a SDP payload. The inserted codec(s) shall reflect the UE#1's terminal capabilities and user preferences for the session capable of supporting for this session. It builds a SDP containing bandwidth requirements and characteristics of each, and assigns local port numbers for each possible media flow. Multiple media flows may be offered, and for each media flow (m= line in SDP), there may be multiple codec choices offered.\n2.\tUE#1 sends the initial INVITE message to P‑CSCF#1 containing this SDP\n3.\tP‑CSCF#1 examines the media parameters. If P‑CSCF#1 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session initiation attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session initiation with media parameters that are allowed by local policy of P‑CSCF#1's network according to the procedures specified in IETF RFC 3261 [12].\nIn this flow described in Figure 5.30 above the P‑CSCF#1 allows the initial session initiation attempt to continue.\nNOTE 1:\tWhether the P‑CSCF should interact with PCRF/PCF in this step is based on operator policy.\n4.\tP‑CSCF#1 forwards the INVITE message to S‑CSCF#1\n5.\tS‑CSCF#1 examines the media parameters. If S‑CSCF#1 finds media parameters that local policy or the originating user's subscriber profile does not allow to be used within an IMS session, it rejects the session initiation attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session initiation with media parameters that are allowed by the originating user's subscriber profile and by local policy of S‑CSCF#1's network according to the procedures specified in IETF RFC 3261 [12].\nIn this flow described in Figure 5.30 above the S‑CSCF#1 allows the initial session initiation attempt to continue.\n6.\tS‑CSCF#1 forwards the INVITE, through the S-S Session Flow Procedures, to S‑CSCF#2.\n7.\tS‑CSCF#2 examines the media parameters. If S‑CSCF#2 finds media parameters that local policy or the terminating user's subscriber profile does not allow to be used within an IMS session, it rejects the session initiation attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session initiation with media parameters that are allowed by the terminating user's subscriber profile and by local policy of S‑CSCF#2's network according to the procedures specified in IETF RFC 3261 [12].In this flow described in Figure 5.30 above the S‑CSCF#2 allows the initial session initiation attempt to continue.\n8.\tS‑CSCF#2 forwards the INVITE message to P‑CSCF#2.\n9.\tP‑CSCF#2 examines the media parameters. If P‑CSCF#2 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session initiation attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session initiation with media parameters that are allowed by local policy of P‑CSCF#2's network according to the procedures specified in IETF RFC 3261 [12].\nIn this flow described in Figure 5.30 above the P‑CSCF#2 allows the initial session initiation attempt to continue.\nNOTE 2:\tWhether the P‑CSCF should interact with PCRF/PCF in this step is based on operator policy.\n10.\tP‑CSCF#2 forwards the INVITE message to UE#2.\n11.\tUE#2 determines the complete set of codecs that it is capable of supporting for this session. It determines the intersection with those appearing in the SDP in the INVITE message. For each media flow that is not supported, UE#2 inserts a SDP entry for media (m= line) with port=0. For each media flow that is supported, UE#2 inserts a SDP entry with an assigned port and with the codecs in common with those in the SDP from UE#1.\n12.\tUE#2 returns the SDP listing common media flows and codecs to P‑CSCF#2\n13.\tP‑CSCF#2 authorizes the QoS resources for the remaining media flows and codec choices.\n14.\tP‑CSCF#2 forwards the SDP response to S‑CSCF#2.\n15.\tS‑CSCF#2 forwards the SDP response to S‑CSCF#1.\n16.\tS‑CSCF#1 forwards the SDP response to P‑CSCF#1.\n17.\tP‑CSCF#1 authorizes the QoS resources for the remaining media flows and codec choices.\n18.\tP‑CSCF#1 forwards the SDP response to UE#1.\n19.\tUE#1 determines which media flows should be used for this session, and which codecs should be used for each of those media flows. If there was more than one media flow, or if there was more than one choice of codec for a media flow, then UE#1 need to renegotiate the codecs by sending another offer to reduce codec to one with the UE#2.\n20-24.\tUE#1 sends the \"Offered SDP\" message to UE#2, along the signalling path established by the INVITE request\nThe remainder of the multi-media session completes identically to a single media/single codec session, if the negotiation results in a single codec per media.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.11.3.2",
        "clause_5.11.3.3",
        "figure_5.30"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.3.2",
      "section_id": "5.11.3.2",
      "section_title": "Codec or media characteristics flow change within the existing reservation",
      "content": "After the multi-media session is established, it is possible for either endpoint to change the set of media flows or media characteristics (e.g. codecs) for media flows. If the change is within the resources already reserved, then it is only necessary to synchronise the change with the other endpoint. Note that an admission control decision will not fail if the new resource request is within the existing reservation.\nThe flow presented here assumes that Policy and Charging Control is in use.\nFigure 5.31: Codec or media flow change - same reservation\nThe detailed procedure is as follows:\n1.\tUE#1 determines that a new media stream is desired, or that a change is needed in the codec in use for an existing media stream. UE#1 evaluates the impact of this change, and determines the existing resources reserved for the session are adequate. UE#1 builds a revised SDP that includes all the common media flows determined by the initial negotiation, but assigns a codec and port number only to those to be used onward. UE#1 stops transmitting media streams on those to be dropped from the session.\n2-6.\tUE#1 sends an INVITE message through the signalling path to UE#2. At each step along the way, the CSCFs recognise the SDP is a proper subset of that previously authorized, and take no further action.\n7.\tUE#2 receives the INVITE message, and agrees that it is a change within the previous resource reservation. (If not, it would respond with a SDP message, following the procedures of 5.11.3.1). UE#2 stops sending the media streams to be deleted, and initialises its media receivers for the new codec.\n8-12.\tUE#2 forwards a 200-OK final response to the INVITE message along the signalling path back to UE#1.\n13.\tUE#1 starts sending media using the new codecs. UE#1 also releases any excess resources no longer needed.\n14-18.\tUE#1 sends the SIP final acknowledgement, ACK, to UE#2.\n19.\tUE#2 starts sending media using the new codecs. UE#2 also releases any excess resources no longer needed",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.31"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.3.3",
      "section_id": "5.11.3.3",
      "section_title": "Codec or media characteristics flow change requiring new resources and/or authorization",
      "content": "After the multi-media session is established, it is possible for either endpoint to change the set of media flows or media characteristics (e.g. codecs) for media flow(s). If the change requires different resources beyond those previously reserved, then it is necessary to perform the resource reservation and bearer establishment procedures. If the reservation request fails for whatever reason, the original multi-media session remains in progress.\nThe flow presented here assumes that Policy and Charging Control is in use.\nFigure 5.32: Codec or media flow change - new reservation\nThe detailed procedure is as follows:\n1.\tUE#1 inserts the revised set of codecs to a SDP payload. The inserted codec(s) shall reflect the UE#1's terminal capabilities and user preferences for the session. It builds a SDP containing bandwidth requirements and characteristics of each, and assigns local port numbers for each possible media flow. Multiple media flows may be offered, and for each media flow (m= line in SDP), there may be multiple codec choices offered.\n2.\tUE#1 sends an INVITE message to P‑CSCF#1 containing this SDP.\n3.\tP‑CSCF#1 examines the media parameters. If P‑CSCF#1 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session modification attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session modification with media parameters that are allowed by local policy of P‑CSCF#1's network according to the procedures specified in IETF RFC 3261 [12].In this flow described in Figure 5.32 above the P‑CSCF#1 allows the initial session modification attempt to continue.\nNOTE 1:\tWhether the P‑CSCF interacts with PCRF/PCF in this step is based on operator policy.\n4.\tP‑CSCF#1 forwards the INVITE message to S‑CSCF#1.\n5.\tS‑CSCF#1 examines the media parameters. If S‑CSCF#1 finds media parameters that local policy or the originating user's subscriber profile does not allow to be used within an IMS session, it rejects the session modification attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session modification with media parameters that are allowed by the originating user's subscriber profile and by local policy of S‑CSCF#1's network according to the procedures specified in IETF RFC 3261 [12]. In this flow described in Figure 5.32 above the S‑CSCF#1 allows the initial session modification attempt to continue.\n6.\tS‑CSCF#1 forwards the INVITE, through the S-S Session Flow Procedures, to S‑CSCF#2.\n7.\tS‑CSCF#2 examines the media parameters. If S‑CSCF#2 finds media parameters that local policy or the terminating user's subscriber profile does not allow to be used within an IMS session, it rejects the session modification attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session modification with media parameters that are allowed by the terminating user's subscriber profile and by local policy of S‑CSCF#2's network according to the procedures specified in IETF RFC 3261 [12].In this flow described in Figure 5.32 above the S‑CSCF#2 allows the initial session modification attempt to continue.\n8.\tS‑CSCF#3 forwards the INVITE message to P‑CSCF#2.\n9.\tP‑CSCF#2 examines the media parameters. If P‑CSCF#2 finds media parameters not allowed to be used within an IMS session (based on P‑CSCF local policies, or if available bandwidth authorization limitation information coming from the PCRF/PCF), it rejects the session modification attempt. This rejection shall contain sufficient information for the originating UE to re-attempt session modification with media parameters that are allowed by local policy of P‑CSCF#2's network according to the procedures specified in IETF RFC 3261 [12]. In this flow described in Figure 5.32 above the P‑CSCF#2 allows the initial session modification attempt to continue.\nNOTE 2:\tIf session modification request indicates no requirements for resource reservation or that the required resources are already available on the originating side, the P‑CSCF#2 can send updated session information to PCRF/PCF whenever SDP offer is contained in the session establishment request, as in such cases no SDP answer is received before the PCRF/PCF is requested to authorize the required QoS resources. Otherwise, whether the P‑CSCF interacts with PCRF/PCF in this step is based on operator policy.\n10.\tP‑CSCF#2 forwards the INVITE message to UE#2.\n11.\tUE#2 determines the complete set of codecs that it is capable of supporting for this session. It determines the intersection with those appearing in the SDP in the INVITE message. For each media flow that is not supported, UE#2 inserts a SDP entry for media (m= line) with port=0. For each media flow that is supported, UE#2 inserts a SDP entry with an assigned port and with the codecs in common with those in the SDP from UE#1.\n12.\tUE#2 returns the SDP listing common media flows and codecs to P‑CSCF#2. It may additionally provide more codecs than originally offered and then the offered set need to be renegotiated.\n13.\tP‑CSCF#2 increases the authorization for the QoS resources, if needed, for the remaining media flows and codec choices.\nNOTE 3:\tP‑CSCF can additionally authorize the resources in step 9.\n14.\tP‑CSCF#2 forwards the SDP response to S‑CSCF#2 toward the originating end along the signalling path.\n15.\tP‑CSCF#1 increases the authorization for the QoS resources, if needed, for the remaining media flows and codec choices.\n16.\tP‑CSCF#1 forwards the SDP response to UE#1.\n17.\tUE#1 determines which media flows should be used for this session, and which codecs should be used for each of those media flows. If there was more than one media flow, or if there was more than one choice of codec for a media flow, then UE#1 must include an SDP in the response message by including SDP to UE#2.\n18.\tUE#1 sends the offered SDP message to UE#2, including the SDP from step #17 if needed.\n19.\tUE#1 and UE#2 reserve the resources needed for the added or changed media flows. If the reservation is successfully completed by UE#1, it stops transmitting any deleted media streams. If UE#1 has sent a new media offer in step 18, it would for example wait for the response in step 20 prior to reserving resources.\n20.\tIf UE#1 has sent an updated offer of SDP in step 18, then UE#2 responds to the offer and P‑CSCF#1 authorizes the offered SDP sent by UE#2.\n21.\tUE#1 sends the Resource Reservation Successful message with final SDP to UE#2, via the signalling path through the CSCFs.\n22.\tUE#2 stops sending the media streams to be deleted, and initialises its media receivers for the new codec.\n23.\tUE#2 sends the 200-OK final response to UE#1, along the signalling path.\n24.\tUE#1 starts sending media using the new codecs. UE#1 also releases any excess resources no longer needed.\n25.\tUE#1 sends the SIP final acknowledgement, ACK, to UE#2 along the signalling path.\n26.\tUE#2 starts sending media using the new codecs. UE#2 also releases any excess resources no longer needed.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.32"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.3.4",
      "section_id": "5.11.3.4",
      "section_title": "Sample MM session flow - addition of another media",
      "content": "For this end-to-end session flow, we assume the originator is a UE located within the service area of the network operator to whom the UE is subscribed. The UE has already established an IM CN session and is generating an invite to add another media (e.g. video to a voice call) to the already established session. Note that the invite to add media to an existing session could be originated by either end. The invite, and subsequent flows, are assumed to follow the path determined when the initial session was established. Any I‑CSCFs that were included in the initial session would be included in this session.\nThe originating party addresses a destination that is a subscriber of the same network operator.\nThe destination party is a UE located within the service area of the network operator to which it is subscribed.\nThe flow presented here assumes that Policy and Charging Control is in use.\nFigure 5.33: Multimedia session flow - addition of another media\nStep-by-step processing of this end-to-end session flow is as follows:\n1.\tUE#1 sends a SIP INVITE request, containing new SDP for the new media and including the original SDP, to P‑CSCF#1, which was obtained from the CSCF discovery procedures.\n2.\tP‑CSCF#1 forwards the INVITE to the next hop name/address, as determined from the registration procedures. In this case the next hop is S‑CSCF#1 within the same operator's network.\n3.\tS‑CSCF#1 validates the service profile, and invokes whatever service logic is appropriate for this session attempt.\n4.\tS‑CSCF#1 recognises that this invite applies to an existing session. It therefore forwards the INVITE along the existing path to S‑CSCF#2.\n5.\tS‑CSCF#2 validates the service profile, and invokes whatever service logic is appropriate for this session attempt.\n6.\tS‑CSCF#2 remembers (from the registration procedure) the next hop CSCF for this UE. It forwards the INVITE to P‑CSCF#2 in the home network.\n7.\tP‑CSCF#2 remembers (from the registration procedure) the address of UE#2 and forwards the INVITE to UE#2.\nNOTE 1:\tIf session modification request indicates no requirements for resource reservation or that the required resources are already available on the originating side, the P‑CSCF#2 can send updated session information to PCRF/PCF whenever SDP offer is contained in the session establishment request, as in such cases no SDP answer is received before the PCRF/PCF is requested to authorize the required QoS resources. Otherwise, whether the P‑CSCF interacts with PCRF/PCF in this step is based on operator policy.\n8.\tUE#2 returns the media stream capabilities of the destination to the session originator, along the signalling path established by the INVITE message.\n9.\tP‑CSCF#2 authorizes the QoS resources required for this additional media.\nNOTE 2:\tP‑CSCF can additionally authorize the resources in step 7.\n10.\tP‑CSCF#2 forwards the SDP to S‑CSCF#2.\n11.\tS‑CSCF#2 forwards the SDP to S‑CSCF#1.\n12.\tS‑CSCF#1 forwards the SDP message to P‑CSCF#1.\n13.\tP‑CSCF#1 authorizes the additional resources necessary for this new media.\n14.\tP‑CSCF#1 forwards the SDP message to the originating endpoint, UE#1.\n15-19.\tThe originator decides the offered set of media streams for this media addition, and sends the offered SDP to P‑CSCF#1.\n20.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. UE#2 initiates the resource reservation procedures for the resources necessary for this additional media as shown in figure 5.33. Otherwise, the IP‑CAN initiates the reservation of required resources after step 9.\n21.\tDepending on the bearer establishment mode selected for the IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. After determining the offered set of media streams for this additional media, in step #15 above, UE#1 initiates the reservation procedures for the additional resources needed for this new media as shown in figure 5.33. Otherwise, the IP‑CAN#1 initiates the reservation of required resources after step 13.\n22-25.\tWhen the terminating side has successfully reserved the needed resources, it sends the \"reservation successful\" message to UE#1 along the signalling path established by the INVITE message. The message is sent first to P‑CSCF#1.\n25a.\tP‑CSCF#1 authorizes any additional media for the proposed SDP.\n26.\tP‑CSCF#1 forwards the message to UE#1.\n27-31.\tUE#1 sends the final agreed SDP to UE#2 via the established path.\n32-35.\tUE#2 responds to the offered final media.\n35a.\tP‑CSCF#1 authorizes the media agreed.\n36.\tThe response is forwarded to UE#1.\n37.\tUE#2 may optionally delay the session establishment in order to alert the user to the incoming additional media.\n38.\tIf UE#2 performs alerting, it sends a ringing indication to the originator via the signalling path. The message is sent first to P‑CSCF#2.\n39.\tP‑CSCF#2 forwards the ringing message to S‑CSCF#2.S‑CSCF#2 invokes whatever service logic is appropriate for this ringing flow.\n40.\tS‑CSCF#2 forwards the message to S‑CSCF#1.\n41.\tS‑CSCF#1 forwards the message to P‑CSCF#1.\n42.\tP‑CSCF#1 forwards the message to UE#1.\n43.\tUE#1 indicates to the originator that the media addition is being delayed due to alerting. Typically this involves playing a ringback sequence.\n44.\tWhen the destination party accepts the additional media, UE#2 sends a SIP 200-OK final response along the signalling path back to the originator. The message is sent first to P‑CSCF#2.\n44a.\tAfter sending the 200-OK, UE#2 may initiate the new media flow(s).\n45.\tP‑CSCF#2 enables the media flows authorized for this additional media.\n46.\tP‑CSCF#2 forwards the final response to S‑CSCF#2.\n47.\tS‑CSCF#2 forwards the final response to S‑CSCF#1.\n48.\tS‑CSCF#1 forwards the final response to P‑CSCF#1.\n49.\tP‑CSCF#1 enables the media flows authorized for this additional media.\n50.\tP‑CSCF#1 forwards the final response to UE#1.\n51.\tUE#1 starts the media flow(s) for this additional media.\n52.\tUE#1 responds to the final response with a SIP ACK message, which is passed to the destination via the signalling path. The message is sent first to P‑CSCF#1.\n53.\tP‑CSCF#1 forwards the ACK to S‑CSCF#1\n54.\tS‑CSCF#1 forwards the ACK to S‑CSCF#2.\n55.\tS‑CSCF#2 forwards the ACK to P‑CSCF#2.\n56.\tP‑CSCF#2 forwards the ACK to UE#2.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.33"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.4.0",
      "section_id": "5.11.4.0",
      "section_title": "General",
      "content": "Identity is composed of a Public User Identity and an optional display name:\n-\tThe Public User Identity is used by any user for requesting communications to other users (see clause 4.3.3.2).\n-\tThe display name is the user's name if available, an indication of privacy or unavailability otherwise. The display name is a text string which may identify the subscriber, the user or the terminal.\nThis clause gives information flows for the procedures for providing the authenticated Public User Identity and the optional display Name information of the originating party to the terminating party. It also describes the mechanisms for blocking the display of Public User Identity and optional display name if requested by the originating party.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.3.3.2"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.4.1",
      "section_id": "5.11.4.1",
      "section_title": "Procedures for providing the authenticated identity of the originating party",
      "content": "Authentication of the subscriber is performed during the registration procedures, as described in clause 5.2.2.3. As a result of the registration procedures, one or several Public User Identity(ies) of the originating party is/are stored in P‑CSCF#1. As part of this procedure, the display name associated with each Public User Identity, if provided by the HSS, is also returned via the S‑CSCF and stored in the P‑CSCF#1. This is shown in the sub-procedure represented in the following information flow in step 1.\nWhen UE#1 attempts to initiate a new session, the UE shall include one of the Public User Identities the UE received during the SIP registration in the INVITE request. The P‑CSCF#1 ensures that the INVITE request includes an authenticated Public User Identity, including the associated display name if provided by the S‑CSCF during the registration procedures, before forwarding the INVITE request to the S‑CSCF#1.\nIn the following call flow, it is assumed that no privacy has been required by UE#1.If the Public User Identity supplied by UE#1 in the INVITE request is incorrect, or if the UE did not provide a public identify, then the P‑CSCF may reject the request, or may overwrite with the correct URI, including the associated display name if provided by the S‑CSCF during the registration procedures.\nFigure 5.34: Providing the authenticated Identity of the originating party\nThe detailed procedure is as follows:\n1.\tRegistration and authentication of UE#1 is performed. One or more authenticated identities for UE#1, including display names if provided, are stored in the P‑CSCF#1 and the UE.\n2.\tUE#1 initiates a new multi-media session, by sending an INVITE request to P‑CSCF#1. This INVITE request includes a Public User Identity, and may include a display name that may identify the specific person using the UE.\n3.\tP‑CSCF#1 checks the Public User Identity of the originating party, and replaces it (or rejects the request) if it is incorrect. If provided during registration procedures via the S‑CSCF, the P‑CSCF#1 ensures that the display name associated with the verified Public User Identity is present before forwarding the INVITE request.\n4.\tP‑CSCF#1 forwards the INVITE request, with the verified Public User Identity and display name of the originating party if present, to S‑CSCF#1.\n5.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session set up attempt to check in particular that no identity restriction is active.\n6.\tS‑CSCF#1 forwards the INVITE request, with verified Public User Identity and display name of the originating party if present, to S‑CSCF#2.\n7.\tS‑CSCF#2 stores the Public User Identity and associated information.\n8.\tS‑CSCF#2 forwards the INVITE request to P‑CSCF#2.\n9.\tP‑CSCF#2 forwards the INVITE request to UE#2.\n10.\tUE#2 displays the Public User Identity and the display name information (i.e. user-name if available, indication of privacy or unavailability otherwise) to the terminating party.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.2.2.3",
        "figure_5.34"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.4.2",
      "section_id": "5.11.4.2",
      "section_title": "Procedures for blocking the identity of the originating party",
      "content": "Regulatory agencies, as well as subscribers, may require the ability of an originating party to block the display of their identity either permanently or on a session by session basis. This is a function performed by the destination P‑CSCF. In this way, the terminating party is still able to do a session-return, session-trace, transfer, or any other supplementary service.\nIn this call flow, it is assumed that privacy has been required by UE#1 on Public User Identity (i.e. 'id' privacy).\nFigure 5.35: Blocking the identity of the originating party\nThe detailed procedure is as follows:\n1.\tUE#1 initiates a new multi-media session, by sending an INVITE request to P‑CSCF#1. This INVITE request includes Public User Identity, and may include a display name that may identify the specific person using the UE. Also included in this INVITE message is an indication that the identity of the originating party shall not be revealed to the destination.\n2.\tP‑CSCF#1 checks the Public User Identity of the originating party, and replaces it (or rejects the request) if it is incorrect. If provided during registration procedures, the P‑CSCF#1 ensures that the display name associated with the Public User Identity is present before forwarding the INVITE request.\n3.\tP‑CSCF#1 forwards the INVITE request, with the verified Public User Identity and display name, to S‑CSCF#1.\n4.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session set up attempt. Based on the subscriber's profile, S‑CSCF#1 may insert an indication in the INVITE message that the identity of the originating party shall not be revealed to the terminating party. S‑CSCF#1 may insert an indication to block the IP address of UE#1 too and may remove other information from the messaging which may identify the caller to the terminating party.\n5. S‑CSCF#1 forwards the INVITE request, with verified Public User Identity, and with user-name of the originating party if present, to S‑CSCF#2.\n6.\tIf the terminating party has an override functionality in S‑CSCF#2/Application Server in the terminating network the S‑CSCF#2/Application Server removes the indication of privacy from the message.\n7.\tS‑CSCF#2 forwards the INVITE request to P‑CSCF#2.\n8.\tIf privacy of the user identity is required, P‑CSCF#2 removes the Public User Identity, including the display name if present, from the message.\n9.\tP‑CSCF#2 forwards the INVITE request to UE#2.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.35"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.4.3",
      "section_id": "5.11.4.3",
      "section_title": "Procedures for providing the authenticated identity of the originating party (PSTN origination)",
      "content": "For calls originating from the PSTN, the MGCF extracts information received from the PSTN and inserts an asserted identity into the SIP message. If the incoming information includes the calling name, or the MGCF can obtain the calling name, the MGCF may insert the information into the display name portion of the asserted identity.\nThe MGCF must propagate the privacy indicators received from the PSTN in the SIP message.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.4.4",
      "section_id": "5.11.4.4",
      "section_title": "Procedures for providing the authenticated identity of the originating party (PSTN termination)",
      "content": "For calls terminating to the PSTN, the MGCF extracts information received in the SIP message and inserts the information into the PSTN signalling. This information must include the privacy setting and may include the display name.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.5.0",
      "section_id": "5.11.5.0",
      "section_title": "General",
      "content": "This clause gives information flows for the procedures for performing session redirection. The decision to redirect a session to a different destination may be made for different reasons by a number of different functional elements, and at different points in the establishment of the session.\nThree cases of session redirection prior to bearer establishment are presented, and one case of session redirection after bearer establishment.\nThese cases enable the typical services of \"Session Forward Unconditional\", \"Session Forward Busy\", \"Session Forward Variable\", \"Selective Session Forwarding\", and \"Session Forward No Answer\", though it is important to recognise that the implementation is significantly different from the counterparts in the CS domain.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.5.1",
      "section_id": "5.11.5.1",
      "section_title": "Session Redirection initiated by S‑CSCF to IMS",
      "content": "One of the functional elements in a basic session flow that may initiate a redirection is the S‑CSCF of the destination user. The user profile information obtained from the HSS by the 'Cx-pull' during registration may contain complex logic and triggers causing session redirection. S‑CSCF#2 sends the SIP INVITE request to the I‑CSCF for the new destination (I‑CSCF#F in the diagram), who forwards it to S‑CSCF#F, who forwards it to the new destination.\nIn cases when the destination user is not currently registered in the IM CN subsystem, the I‑CSCF may assign a temporary S‑CSCF to invoke the service logic on behalf of the intended destination. This temporary S‑CSCF takes the role of S‑CSCF#2 in the following information flow.\nThe service implemented by this information flow is typically \"Session Forward Unconditional\", \"Session Forward Variable\" or \"Selective Session Forwarding\". S‑CSCF#2 may also make use of knowledge of current sessions in progress at the UE, and implement \"Session Forwarding Busy\" in this way.\nThis is shown in the following information flow:\nFigure 5.36: Session redirection initiated by S‑CSCF to IMS\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the destination subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt. As a result of this service control logic, S‑CSCF#2 determines that the session should be redirected to a new destination URI within the IP Multimedia Subsystem. Based on operator policy and the user profile, S‑CSCF#2 may restrict the media streams allowed in the redirected session.\n8.\tS‑CSCF#2 sends a SIP INVITE request to an I‑CSCF (I‑CSCF#F) for the network operator to whom the forwarded destination subscribes.\n9.\tI‑CSCF#F queries the HSS (HSS#F) for current location information of the destination user.\n10.\tHSS#F responds with the address of the current Serving CSCF (S‑CSCF#F) for the terminating user.\n11.\tI‑CSCF forwards the INVITE request to S‑CSCF#F, who will handle the session termination.\n12.\tS‑CSCF#F invokes whatever service logic is appropriate for this session setup attempt\n13.\tS‑CSCF#F forwards the INVITE toward the destination UE, according to the procedures of the terminating flow.\n14-19.\tThe destination UE responds with the SDP message, and the session establishment proceeds normally.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.36"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.5.2",
      "section_id": "5.11.5.2",
      "section_title": "Session Redirection to PSTN Termination (S‑CSCF #2 forwards INVITE)",
      "content": "The S‑CSCF of the destination user (S‑CSCF#2) may determine that the session is to be redirected to a PSTN Termination; e.g. CS-domain endpoint, or to the PSTN. For session redirection to PSTN termination where the S‑CSCF of the called party (S‑CSCF#2) wishes to remain in the path of SIP signalling, the S‑CSCF forwards the INVITE to a BGCF. Then the BGCF (in the local network or in another network) will forward the INVITE to a MGCF, which will forward towards the destination according to the termination flow.\nIn cases when the destination user is not currently registered in the IM CN subsystem, the I‑CSCF may assign a temporary S‑CSCF to invoke the service logic on behalf of the intended destination. This temporary S‑CSCF takes the role of S‑CSCF#2 in the following information flow.\nHandling of redirection to a PSTN Termination where the S‑CSCF#2 forwards the INVITE is shown in the figure 5.37:\nFigure 5.37: Session redirection to PSTN Termination (S‑CSCF #2 forwards INVITE)\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE #1 to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 performs whatever service control logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt. As a result of this service control logic, S‑CSCF#2 determines that the session should be redirected to a PSTN termination. S‑CSCF#2 determines that it wishes to remain in the path of the SIP signalling.\n8.\tS‑CSCF#2 forwards the INVITE using the Serving to Serving procedures S-S#3 or S-S#4. The PSTN terminating flows are then followed.\n9-12.\tThe destination responds with the SDP message, and the session establishment proceeds normally.\n5.11.5.2a\tSession Redirection to PSTN Termination (REDIRECT to originating UE#1)\nThe S‑CSCF of the destination user (S‑CSCF#2) may determine that the session is to be redirected to a PSTN Termination; e.g. CS-domain endpoint, or to the PSTN. For session redirection to PSTN termination where the S‑CSCF of the called party (S‑CSCF#2) wishes to use the SIP REDIRECT method, the S‑CSCF#2 will pass the new destination information (the PSTN Termination information) to the originator. The originator can then initiate a new session to the redirected to destination denoted by S‑CSCF#2. The originator may be a UE as shown in the example flow in figure 5.37a, or it may be any other type of originating entity as defined in clause 5.4a. The endpoint to which the session is redirected may be the PSTN as shown in figure 5.37a, or it may be any other type of terminating entity as defined in clause 5.4a. The originator may alternately receive a redirect from a non-IMS network SIP client. Only the scenario in which a call from a UE is redirected by S‑CSCF service logic to a PSTN endpoint is shown.\nHandling of redirection to a PSTN Termination where the S‑CSCF#2 REDIRECTS to the originating UE#1 is shown in the figure 5.37a:\nFigure 5.37a: Session redirection to PSTN Termination (REDIRECT to originating UE#1)\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE#1 to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt. As a result of this service control logic, S‑CSCF#2 determines that the session should be redirected to a PSTN termination.\nS‑CSCF#2 determines that it wishes to use the SIP REDIRECT method to pass the redirection destination information (the 'redirected-to PSTN Termination' information) to the originator (UE#1).\n8.\tS‑CSCF#2 sends a SIP Redirect response to I‑CSCF with the redirection destination.\n9.\tI‑CSCF sends a Redirect response to S‑CSCF#1, containing the redirection destination.\n10.\tS‑CSCF#2 forwards the Redirect response to UE#1, containing the redirection destination\n11.\tUE#1 initiates a session to the 'redirected-to PSTN Termination' according to the mobile origination procedures supported in the UE (e.g. CS, IMS).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "figure_5.37"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.5.3",
      "section_id": "5.11.5.3",
      "section_title": "Session Redirection initiated by S‑CSCF to general endpoint (REDIRECT to originating UE#1)",
      "content": "The S‑CSCF in the scenario above may determine that the session is to be redirected to an endpoint outside the IP MultiMedia System and outside the CS-domain. Examples of these destinations include web pages, email addresses, etc. It recognizes this situation by the redirected URI being other than a sip: URI or tel: URL.\nIn cases when the destination subscriber is not currently registered in the IM CN subsystem, the I‑CSCF may assign a temporary S‑CSCF to invoke the service logic on behalf of the intended destination. This temporary S‑CSCF takes the role of S‑CSCF#2 in the following information flow. For session redirection to a general endpoint where the S‑CSCF of the called party (S‑CSCF#2) wishes to use the SIP REDIRECT method, the S‑CSCF#2 will pass the new destination information to the originator. As a result the originator should initiate a new session to the redirected-to destination provided by S‑CSCF#2. The originator may be a UE as shown in the example flow in figure 5.38, an Application Server or a non-IMS network SIP client. The originator may also receive a redirect from a non-IMS network SIP client. Only the scenario in which the originating UE receives a redirect based on S‑CSCF service logic is shown.\nHandling of redirection to a general URI is shown in the following information flow:\nFigure 5.38: Session redirection initiated by S‑CSCF to general endpoint\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt. As a result of this service control logic, S‑CSCF#2 determines that the session should be redirected to a new destination URI outside the IMS and outside the CS domain, i.e. other than a sip: URI or tel: URL.\n8.\tS‑CSCF#2 sends a SIP Redirect response back to I‑CSCF, with redirection destination being the general URI.\n9.\tI‑CSCF sends a Redirect response back to S‑CSCF#1, containing the redirection destination.\n10.\tS‑CSCF#1 forwards the Redirect response back to UE#1.\n11.\tUE#1 initiates the session to the indicated destination.",
      "chunk_type": "definition",
      "cross_references": [
        "figure_5.38"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.5.4",
      "section_id": "5.11.5.4",
      "section_title": "Session Redirection initiated by P‑CSCF",
      "content": "One of the functional elements in a basic session flow that may initiate a redirection is the P‑CSCF of the destination user. In handling of an incoming session setup attempt, the P‑CSCF normally sends the INVITE request to the destination UE, and retransmits it as necessary until obtaining an acknowledgement indicating reception by the UE.\nIn cases when the destination user is not currently reachable in the IM CN subsystem (due to such factors as roaming outside the service area or loss of battery, but the registration has not yet expired), the P‑CSCF may initiate a redirection of the session. The P‑CSCF informs the S‑CSCF of this redirection, without specifying the new location; S‑CSCF determines the new destination and performs according to clauses 5.11.5.1, 5.11.5.2, or 5.11.5.3 above, based on the type of destination.\nThis is shown in the following information flow:\nFigure 5.39: Session redirection initiated by P‑CSCF\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt.\n8.\tS‑CSCF#2 forwards the INVITE request to P‑CSCF#2.\n9.\tP‑CSCF#2 forwards the INVITE request to UE#2.\n10.\tTimeout expires in P‑CSCF waiting for a response from UE#2. P‑CSCF therefore assumes UE#2 is unreachable.\n11.\tP‑CSCF#2 generates an Unavailable response, without including a new destination, and sends the message to S‑CSCF#2.\n12.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session redirection. If the user does not subscribe to session redirection service, or did not supply a forwarding destination, S‑CSCF#2 may terminate the session setup attempt with a failure response. Otherwise, S‑CSCF#2 supplies a new destination URI, which may be a phone number, an email address, a web page, or anything else that can be expressed as a URI. Processing continues according to clauses 5.11.5.1, 5.11.5.2, or 5.11.5.3 above, based on the type of destination URI.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.39"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.5.5",
      "section_id": "5.11.5.5",
      "section_title": "Session Redirection initiated by UE",
      "content": "The next functional element in a basic session flow that may initiate a redirection is the UE of the destination user. The UE may implement customer-specific feature processing, and base its decision to redirect this session on such things as identity of caller, current sessions in progress, other applications currently being accessed, etc. UE sends the SIP Redirect response to its P‑CSCF, who forwards back along the signalling path to S‑CSCF#1, who initiates a session to the new destination.\nThe service implemented by this information flow is typically \"Session Forward Busy\", \"Session Forward Variable\" or \"Selective Session Forwarding\".\nThis is shown in the following information flow:\nFigure 5.40: Session redirection initiated by UE\nStep-by-step processing is as follows:\n1.\tThe SIP INVITE request is sent from the UE to S‑CSCF#1 by the procedures of the originating flow.\n2.\tS‑CSCF#1 invokes whatever service logic is appropriate for this session setup attempt.\n3.\tS‑CSCF#1 performs an analysis of the destination address, and determines the network operator to whom the subscriber belongs. The INVITE message is sent to an I‑CSCF for that operator.\n4.\tI‑CSCF queries the HSS for current location information of the destination user.\n5.\tHSS responds with the address of the current Serving CSCF (S‑CSCF#2) for the terminating user.\n6.\tI‑CSCF forwards the INVITE request to S‑CSCF#2, who will handle the session termination.\n7.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session setup attempt.\n8.\tS‑CSCF#2 forwards the INVITE request to P‑CSCF#2.\n9.\tP‑CSCF#2 forwards the INVITE request to UE#2.\n10.\tUE#2 determines that this session should be redirected, and optionally supplies the new destination URI. This new destination URI may be a phone number, an email address, a web page, or anything else that can be expressed as a URI. The Redirect response is sent to P‑CSCF#2.\n11.\tP‑CSCF#2 forwards the Redirect response to S‑CSCF#2.\n12.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session redirection. If UE#2 does not subscribe to session redirection service, or did not supply a new destination URI, S‑CSCF#2 may supply one or may terminate the session setup attempt with a failure response. The new destination URI may be a phone number, an email address, a web page, or anything else that can be expressed as a URI. The procedures of clause 5.11.5.1, 5.11.5.2, or 5.11.5.3 given above are followed, based on the type of URI.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.11.5.1",
        "figure_5.40"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.5.6",
      "section_id": "5.11.5.6",
      "section_title": "Session Redirection initiated by originating UE#1 after Bearer Establishment (REDIRECT to originating UE#1)",
      "content": "The UE of the destination user may request the session be redirected after a customer-specified ringing interval. The UE may also implement customer-specific feature processing, and base its decision to redirect this session on such things as identity of caller, current sessions in progress, other applications currently being accessed, etc. UE sends the SIP Redirect response to its P‑CSCF, who forwards back along the signalling path to the originating endpoint, who initiates a session to the new destination.\nThe service implemented by this information flow is typically \"Session Forward No Answer\".\nThe originating end point may be a UE as shown in the example flow in figure 5.41 or it may be any other type of originating entity as defined in clause 5.4a. Redirect to another IMS endpoint (e.g. a sip: URI) is shown in the figure. The redirecting endpoint may be a UE as shown or an Application Server or a non-IMS network SIP client. Further, the endpoint to which the session is redirected may be a UE as shown in figure 5.41, or it may be any other type of terminating entity as defined in clause 5.4a. Only the scenario in which a call from the first UE is redirected by a second UE to a third UE is shown.\nThe flow presented here assumes that Policy and Charging Control is in use.\nFigure 5.41: Session redirection after bearer establishment\nStep-by-step processing is as follows:\n1-10.\tNormal handling of a basic session establishment, up through establishment of the bearer channel and alerting of the destination user or by a previous session redirection after bearer establishment procedure.\n11.\tBased on a timeout or other indications, UE#2 decides the current session should be redirected to a new destination URI. This new destination URI may be a phone number, an email address, a web page, or anything else that can be expressed as a URI. The Redirect response is sent to P‑CSCF#2.\n12.\tP‑CSCF#2 shall revoke any authorization for QoS for the current session.\n13.\tP‑CSCF#2 forwards the Redirect response to S‑CSCF#2.\n14.\tS‑CSCF#2 invokes whatever service logic is appropriate for this session redirection. If UE#2 does not subscribe to session redirection service, or did not supply a new destination URI, S‑CSCF#2 service logic may supply one or may terminate the session setup attempt with a failure response. The new destination URI may be a phone number, an email address, a web page, or anything else that can be expressed as a URI. If S‑CSCF#2 service logic requires that it remain on the path for the redirected request, the service logic generates a private URI, addressed to itself, as the new destination.\n15.\tS‑CSCF#2 sends a SIP Redirect response back to I‑CSCF, containing the new destination URI.\n16.\tI‑CSCF sends a Redirect response back to S‑CSCF#1, containing the new destination.\n17.\tS‑CSCF#1 service logic may check the number of redirections that have occurred for this session setup attempt, and if excessive, abort the session. If S‑CSCF#1 service logic requires that UE#1 not know the new destination URI, the service logic stores the new destination information, generates a private URI addressed to itself pointing to the stored information, and generates a modified Redirect response with the private URI.\n18.\tS‑CSCF#1 sends the Redirect response to P‑CSCF#1.\n19.\tP‑CSCF#1 revokes any authorization for QoS for the current session and sends the Redirect response to UE#1.\n20.\tUE#1 initiates a new INVITE request to the address provided in the Redirect response. The new INVITE request is sent to P‑CSCF#1.\n21.\tP‑CSCF#1 forwards the INVITE request to S‑CSCF#1.\n22.\tS‑CSCF#1 invokes whatever service logic is appropriate for this new session setup attempt. The service logic may retrieve destination information if saved in step #17.\n23.\tS‑CSCF#1 determines the network operator of the new destination address. If the service logic in step #14 did not provide its private URI as a new destination, the procedure continues with step #26, bypassing steps #24 and #25. If the service logic in step #14 did provide a private URI as a new destination, the INVITE message is sent to I‑CSCF#2, the I‑CSCF for S‑CSCF#2.\n24.\tI‑CSCF forwards the INVITE to S‑CSCF#2.\n25.\tS‑CSCF#2 decodes the private URI, determines the network operator of the new destination, and sends the INVITE request to the I‑CSCF for that network operator.\n26-30.\tThe remainder of this session completes as normal.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "figure_5.41"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.6.0",
      "section_id": "5.11.6.0",
      "section_title": "General",
      "content": "This clause gives information flows for the procedures for performing session transfers. This is presented in two steps: first a basic primitive that can be used by endpoints to cause a multi-media session to be transferred, and second the procedures by which this primitive can be used to implement some well-known session-transfer services.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.6.1",
      "section_id": "5.11.6.1",
      "section_title": "Refer operation",
      "content": "The refer primitive is an information flow indicating a \"Refer\" operation, which includes a component element \"Refer-To\" and a component element \"Referred-By\". The end point receiving a referral may be UE#1 as shown in the example flow in figure 5.42 or it may be any other type of originating entity as defined in clause 5.4a. The referring endpoint may be either UE#2 as shown, an Application Server or a non-IMS network SIP client. The referred-to destination may be UE#F as shown in figure 5.42 or it may be any other type of terminating entity as defined in clause 5.4a. Only the scenario in which a call from the first UE is referred by a second UE to a third UE is shown.\nAn information flow illustrating this is as follows:\nFigure 5.42: Refer operation\nStep-by-step description of the information flow:\n1.\tA multi-media session is assumed to already exist between UE#1 and UE#2, established either as a basic session or by one of the supplemental services described in this clause.\n2.\tUE#2 sends the Refer command to P‑CSCF#2, containing \"Refer-To\" UE#F and \"Referred-By\" UE#2. If UE#2 knows the GRUU of UE#F and desires to reach a particular instance of UE#F, the \"Refer-To\" contains the GRUU of UE#F otherwise the \"Refer-To\" contains the Public User Identity of UE#F.\n3.\tP‑CSCF#2 forwards the message to S‑CSCF#2.\n4.\tS‑CSCF#2 invokes whatever service logic is appropriate for this request. If UE#2 does not subscribe to a transfer service, service logic may reject the request. If S‑CSCF#2 service logic requires that it remain on the path for the subsequent request, the service logic generates a private URI, addressed to itself, the \"Refer-To\" value in the request with the private URI.\n5.\tS‑CSCF#2 forwards the message to S‑CSCF#1.\n6.\tS‑CSCF#1 invokes whatever service logic is appropriate for this request. To hide the identities of UE#2 and UE#F, S‑CSCF#1 service logic stores the \"Refer-To\" and \"Referred-By\" information and replaces them with private URIs.\n7.\tS‑CSCF#1 forwards the message to P‑CSCF#1.\n8.\tP‑CSCF#1 forwards the message to UE#1.\n9.\tUE#1 initiates a new multi-media session to the destination given by the \"Refer-To\", which may either be a URI for UE#F, a private URI pointing to S‑CSCF#2, or a private URI pointing to S‑CSCF#1.\n10.\tP‑CSCF#1 forwards the INVITE request to S‑CSCF#1.\n11.\tS‑CSCF#1 retrieves the destination information for the new session, and invokes whatever service logic is appropriate for this new session.\n12.\tS‑CSCF#1 determines the network operator addressed by the destination URI, and forwards the INVITE to either S‑CSCF#F or S‑CSCF#2 (actually I‑CSCF#F or I‑CSCF#2, the public entry points for S‑CSCF#F and S‑CSCF#2, respectively). If S‑CSCF#1 forwards the INVITE to S‑CSCF#F, the procedure continues with step #14, bypassing step #13.\n13.\tS‑CSCF#2 decodes the private URI destination, and determines the final destination of the new session. It determines the network operator addressed by the destination URI. The request is then forwarded onward to S‑CSCF#F as in a normal session establishment.\n14.\tS‑CSCF#F invokes whatever service logic is appropriate for this new session, and forwards the request to P‑CSCF#F.\n15.\tP‑CSCF#F forwards the request to UE#F.\n16-21.\tThe normal session establishment continues through bearer establishment, optional alerting, and reaches the point when the new session is accepted by UE#F. UE#F then sends the 200-OK final response to P‑CSCF#F, which is forwarded through S‑CSCF#F, S‑CSCF#2 (optionally), S‑CSCF#1, P‑CSCF#1, to UE#1. At this point a new session is successfully established between UE#1 and UE#F.\n22-26.\tThe Refer request was successful, and UE#1 sends a 200-OK final response to UE#2. This response is sent through P‑CSCF#1, S‑CSCF#1, S‑CSCF#2, P‑CSCF#2, and to UE#2.\n27-31.\tUE#2 clears the original session with UE#1 by sending the BYE message. This message is routed through P‑CSCF#2, S‑CSCF#2, S‑CSCF#1, P‑CSCF#1, to UE#1.\n32-36.\tUE#1 acknowledges the BYE and terminates the original session. It responds with the 200-OK response, routed through P‑CSCF#1, S‑CSCF#1, S‑CSCF#2, P‑CSCF#2, to UE#2.\nNOTE:\tThe last BYE message to clear the original session can be issued either by UE#1 or by UE#2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "figure_5.42"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.11.6.2.0",
      "section_id": "5.11.6.2.0",
      "section_title": "General",
      "content": "This clause shows how the Refer primitive given above can be used to provide common session-transfer services.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.6.2.1",
      "section_id": "5.11.6.2.1",
      "section_title": "Blind Transfer and Assured Transfer",
      "content": "A Blind Transfer starts with an existing session, established between the Initiator (I) and the Recipient (R). In a typical case, this session was actually initiated by R. In the end it is desired that the Recipient has a session with the Target (T).\nFrom the starting configuration, shown in the leftmost diagram, I sends a Refer message to R, who then initiates a session with the Target (T), as shown in the middle diagram. Immediately after sending the Refer message to R, I issues the BYE message to terminate its connection with R. The end configuration is shown in the rightmost diagram.\nAn Assured Transfer is identical to the above, except that I waits until the Refer successfully completes before issuing the BYE message to terminate its connection with R. If the new session from R to T were to fail, R would still have a session with I.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.6.2.2",
      "section_id": "5.11.6.2.2",
      "section_title": "Consultative Transfer",
      "content": "A Consultative Transfer again starts with an existing session, established from the Initiator (I) to the Recipient (R). The Initiator first consults with the Target (T), then decides to transfer the original session to T.\nFrom the starting configuration, as shown in the leftmost diagram in the previous clause, I places the session with R on hold and establishes a new session with T. This is shown in the leftmost diagram below. I then sends a Refer message to T, causing T to establish a session with R. This is shown in the second diagram. When the Refer operation completes, I clears its two active sessions, first with R (leaving the configuration as shown in the third diagram) then with T. The end configuration is shown in the rightmost diagram.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.11.6.2.3",
      "section_id": "5.11.6.2.3",
      "section_title": "Three-way Session",
      "content": "A three-way session starts with an existing session, between the Initiator (I) and party (A). The initiator places this session on hold, and establishes a second session with party (B). The initiator then decides to create an ad-hoc conference of all three parties.\nFrom the point where the initiator decides to create the ad-hoc conference, shown in the leftmost diagram below, the initiator establishes another session with a third-party conference bridge service. This is shown in the centre diagram. The initiator then transfers both of the existing sessions, I->A and I->B, to the bridge, ending in the configuration shown in the rightmost diagram.\nThe conference bridge service is in control of the termination sequence. On termination of one of the three sessions, it may either terminate the other two sessions by use of the session clearing procedures of clause 5.11, or may utilize the procedures of clause 5.11.6.2.1 above to transfer one of the remaining endpoints to the other, resulting in a simple two-party session.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.11",
        "clause_5.11.6.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.12.0",
      "section_id": "5.12.0",
      "section_title": "General",
      "content": "This clause describes information flows for the procedures of Mobile Terminating call flows for unregistered IMS Public User Identities. The detection of an unregistered Public User Identity is done in HSS and if this Public User Identity has services related to unregistered state, a S‑CSCF is selected for the unregistered Public User Identity. S‑CSCF performs whatever further actions are appropriate for the call attempt to the unregistered IMS Public User Identity.\nTwo basic examples for \"services related to unregistered\" are call redirection to CS domain and voice mailbox service. Call redirection to CS domain is supported to cover the cases when the UE is not registered in IMS but can be reached via the CS domain. Then, a temporary S‑CSCF is selected and performs whatever further actions are appropriate for the call attempt.\nThe principle established in clause 4.3.3.4, where the Public User Identities for the same profile are allocated to the same S‑CSCF, is followed.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.3.3.4"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.12.1",
      "section_id": "5.12.1",
      "section_title": "Mobile Terminating call procedures to unregistered Public User Identity that has services related to unregistered state",
      "content": "In Figure 5.43 below the Public User Identity is unregistered for IMS and the Public User Identity has services related to unregistered state. In this case, the HSS responds back to I‑CSCF with an indication that I‑CSCF should select S‑CSCF for this MT call to the unregistered Public User Identity of the user or provide the I‑CSCF with the previously allocated S‑CSCF name. Before S‑CSCF selection, I‑CSCF shall query HSS for the information related to the required S‑CSCF capabilities. I‑CSCF selects a S‑CSCF to invoke service logic and I‑CSCF routes the call further to the selected destination. If the S‑CSCF does not have the relevant information from the user profile then the S‑CSCF shall download the relevant information from HSS before it invokes service logic and any further actions in the call attempt. The service implemented by this information flow could be e.g. \"Call Forward Unconditional\".\nThis is shown by the information flow in Figure 5.43:\nFigure 5.43: Mobile Terminating call procedures to unregistered IMS Public User Identity that has services related to unregistered state\n1.\tI‑CSCF receives an INVITE message.\n2.\tI‑CSCF queries the HSS for current location information.\n3.\tHSS either responds with the required S‑CSCF capabilities which I‑CSCF should use as an input to select a S‑CSCF for the unregistered Public User Identity of the user or provides the I‑CSCF with the previously allocated S‑CSCF name for that user.\n4.\tIf the I‑CSCF has not been provided with the location of the S‑CSCF, the I‑CSCF selects an S‑CSCF for the unregistered Public User Identity of the user.\n5.\tI‑CSCF forwards the INVITE request to the S‑CSCF.\n6.\tThe S‑CSCF sends Cx-Put/Cx-Pull (Public User Identity, S‑CSCF name) to the HSS. When multiple and separately addressable HSSs have been deployed by the network operator, then the S‑CSCF needs to query the SLF to resolve the HSS. The HSS stores the S‑CSCF name for unregistered Public User Identities of that user. This will result in all terminating traffic for unregistered Public User Identities of that user being routed to this particular S‑CSCF until the registration period expires or the user attaches the Public User Identity to the network. Note: Optionally the S‑CSCF can omit the Cx-Put/Cx-Pull request if it has the relevant information from the user profile.\n7.\tThe HSS shall stores the S‑CSCF name for that user and return the information flow Cx-Put Resp/Cx-Pull Resp (user information) to the S‑CSCF. The S‑CSCF shall store it for that indicated Public User Identity.\n8.\tS‑CSCF invokes whatever service logic is appropriate for this call attempt.\n9.\tS‑CSCF performs whatever further actions are appropriate for this call attempt (in the case where the S‑CSCF decides to redirect the session towards CS domain, the Mobile Termination Procedure MT#3 (clause 5.7.2a) applies).\nThe S‑CSCF may deregister the Public User Identity at any time (e.g. according to operator network engineering requirements) by issuing a Cx-Put2 (Public User Identity, clear S‑CSCF name) clearing the S‑CSCF name stored in the HSS. If S‑CSCF name stored by the HSS does not match the name of the S‑CSCF that originated the Cx-Put2 then the HSS will acknowledge the clearing request but take no further action.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.7.2",
        "figure_5.43"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.12.2",
      "section_id": "5.12.2",
      "section_title": "Mobile Terminating call procedures to unregistered Public User Identity that has no services related to unregistered state",
      "content": "In the example information flow the Public User Identity of the user is unregistered and the Public User Identity has no services related to unregistered state.\nThis is shown in the following information flow (figure 5.44):\nFigure 5.44: Mobile Terminating call procedures to unregistered Public User Identity that has no services related to unregistered state\n1.\tI‑CSCF receives an INVITE message.\n2.\tI‑CSCF queries the HSS for current location information.\n3.\tHSS responds with an indication that the Public User Identity is unregistered, but no services are related to unregistered state.\n4.\tI‑CSCF responds to the origin of the request that the user is not reachable at the moment.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.44"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.13",
      "section_id": "5.13",
      "section_title": "IMS Emergency Sessions",
      "content": "Emergency sessions via IMS are specified in TS 23.167 [58].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.14.0",
      "section_id": "5.14.0",
      "section_title": "General",
      "content": "The MRFC/MRFP are resources of the IMS that provide support for bearer related services such as for example multi-party sessions, announcements to a user or bearer transcoding. This clause describes how the resources of the MRFC/MRFP are used.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.14.1",
      "section_id": "5.14.1",
      "section_title": "Interactions between the UE and the MRFC",
      "content": "In some cases an operator may wish to make an MRFC available directly to a UE, for example to support ad-hoc multi-party sessions to be initiated by the UE. In this case, the operator advertises the name of one or more MRFCs and a UE will invite an MRFC to a session. The session invitation would need to contain additional information indicating the specific capabilities (e.g. multi-party) desired. A conference ID would be assigned by the MRFC and returned to the UE. This would then be used by the UE in subsequent interactions with the MRFC and other UEs participating in the session.\nThere are two approaches to invite new participants to the multiparty session. In the first, a UE directs other UEs to join the multiparty session based on the use of the SIP REFER method. This allows session invitations with consultation. In the second method, the MRFC uses information received from a UE e.g. within a list of session participants to invite other UEs to the multiparty session. This allows session invitations without consultation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.14.2",
      "section_id": "5.14.2",
      "section_title": "Service control based interactions between the MRFC and the AS",
      "content": "The MRFC/MRFP resources may also be used, based on service control in an IMS, for services such as multiparty sessions, announcements or transcoding. In this case an Application Server interacts with an MRFC. Session control messages are exchanged between the AS and the MRFC.\nThere are two approaches for the AS to control the sessions. In the first, the AS uses 3rd party call control. The second approach uses the SIP REFER method.\nIn either case, the appropriate service in the AS would be triggered by a UE initiated SIP message containing information indicating the specific capabilities desired. This session invitation would also carry additional information indicating the specific capabilities (e.g. multi-party). A conference ID would be assigned by the MRFC and would be used by the AS in subsequent interactions with the MRFC in INVITE messages connecting other endpoints.\n3rd party call control can also be used to invoke announcement and transcoding services. That is, the AS will send an INVITE to the MRFC with an indication of the capability being requested and with additional information related to the specific service such as identification of the announcement to be played or identification of the specific transcoding requirements.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.14.3",
      "section_id": "5.14.3",
      "section_title": "Interactions for services using both the Ut interface and MRFC capabilities",
      "content": "Network services hosted on an AS and configurable by the user via the Ut interface may also use the capabilities provided by the MRFC. For this case, the AS either supports MRFC capabilities, or communicates with an MRFC.\nCommunications across the Ut interface between the UE and the AS allow the UE to securely manage and configure data for such services (e.g. conference type services). Means for the AS to propagate this management and configuration information to the MRFC is not standardized in this Release.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.14.4",
      "section_id": "5.14.4",
      "section_title": "Transcoding services involving the MRFC/MRFP",
      "content": "Network services involving MRFC and MRFP are not limited to conferencing and announcements, but also involve transcoding support for interworking between IMSs or inter-domain sessions, and intra-domain sessions between access technologies supported in an IMS (e.g. wireline wireless interworking, or interworking with non-3GPP wireless technologies).\nThe MRFC and MRFP act as transcoding entity in an IMS solving media encoding mismatches due to codec selection between operator networks, as well as to deal with encoding formats in a converged service environment. Service requests sent to the MRFC shall contain sufficient information to associate the systems that require media transcoding, and also for reservation of resources required at the MRFP. The MRFC shall always grant the requests from the control plane, unless there is a lack of resources. Media transcoding support based on MRFC/MRFP shall support the offer/answer procedure as defined in IETF RFC 3264 [72].\nAdditional description of transcoding support involving the MRFC/MRFP is provided in Annex P.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.15.0",
      "section_id": "5.15.0",
      "section_title": "General",
      "content": "This clause describes information flows Mobile Terminating procedure for an unknown user. The unknown user cases include those where session requests are made towards Public User Identities that are incorrect, un-issued or have been cancelled/deleted. The determination of unknown user is carried out in the HSS and/or the SLF (for networks that require SLF functionality). The information flows of figures 5.45 and 5.46 illustrate how SIP messages can be used to inform the requesting party that the requested user is not known within the network.\nIn the case where the destination Public User Identity is an E.164 number in the SIP URI with user=phone parameter format, the I‑CSCF shall first translate it into the Tel: URI format per IETF RFC 3966 [15] prior to sending to the HSS a Cx_LocQuery (or to the SLF a DX_SLF_QUERY). If a failure occurs under these circumstances, the Mobile Terminating user is not an IMS user of this network. In this case, the I‑CSCF may invoke the portion of transit functionality that translates the E.164 address contained in the Request‑URI of the Tel: URI format to a routable SIP URI, or BGCF for further routing as described in clause 5.19.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.19"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.15.1",
      "section_id": "5.15.1",
      "section_title": "Unknown user determined in the HSS.",
      "content": "In Figure 5.45 the unknown status of the requested party is determined in the HSS. The I‑CSCF requests information on the user to be reached and the HSS responds back to the I‑CSCF with an indication that the user is unknown. The I‑CSCF uses the indication that the user is unknown returned from the HSS to formulate the correct SIP message back towards the originating party to inform them that the user is unknown. The case where the SLF determines unknown status is in clause 5.15.2. The flows of figure 5.45 could include SLF determination of the HSS, however these are not shown for clarity.\nFigure 5.45: HSS determination of unknown user\n1)\tI‑CSCF receives an INVITE.\n2)\tI‑CSCF queries the HSS for current location information.\n3)\tHSS responds with an indication that the user is unknown.\n4)\tThe I‑CSCF responds to the origin of the request that the user is unknown.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.15.2",
        "figure_5.45"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.15.2",
      "section_id": "5.15.2",
      "section_title": "Unknown user determined in the SLF",
      "content": "In Figure 5.46 the unknown status of the requested party is determined in the SLF. The I‑CSCF requests information on the user to be reached and the SLF responds back to the I‑CSCF with an indication that the user is unknown. The I‑CSCF uses the indication that the user is unknown returned from the SLF to formulate the correct SIP message back towards the originating party to inform them that the user is unknown.\nFigure 5.46: SLF determination of unknown user\n1)\tThe ICSCF receives an INVITE request and now has to query for the location of the user's subscription data.\n2)\tThe I‑CSCF sends a DX_SLF_QUERY to the SLF and includes as parameter the user identity which is stated in the INVITE request.\n3)\tThe SLF looks up its database for the queried user identity.\n4)\tThe SLF answers with an indication that the user is unknown.\n5)\tThe I‑CSCF responds to the origin of the request that the user is unknown.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.46"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.0",
      "section_id": "5.16.0",
      "section_title": "General",
      "content": "This clause describes architectural concepts and procedures for providing Messaging in the IM CN Subsystem. The service enablers for Messaging and possible reuse of IMS service enablers within this context as well security and charging expectations, addressing, privacy, content handling and limitations, filtering, media types and message lengths, etc. are to be further studied.\nAny ISIM or, for UEs supporting only non-3GPP accesses and containing IMC, any IMC related architectural requirements would be studied as part of overall IMS Messaging.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.16.1.0",
      "section_id": "5.16.1.0",
      "section_title": "General",
      "content": "This clause describes architectural concepts and procedures for fulfilling the requirements for Immediate Messaging described in TS 22.340 [29a].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_22.340"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.1.1.0",
      "section_id": "5.16.1.1.0",
      "section_title": "General",
      "content": "IMS users shall be able to exchange immediate messages with each other by using the procedure described in this clause. This procedure shall allow the exchange of any type of multimedia content (subject to possible restrictions based on operator policy and user preferences/intent), for example but not limited to:\n-\tPictures, video clips, sound clips with a format defined in the respective access specific annex.\nIf the message size exceeds the size limit for MESSAGE requests, the UE shall use alternative means to deliver the content of the Immediate Message. Session based messaging specified in clause 5.16.2 provides such means.IETF RFC 3428 [43] presents guidelines for the selection of transport mechanism for an Immediate Message. The message size limitations described above are meant to be applicable for Immediate Messages sent over end-to-end congestion safe transport, i.e. are not necessarily equal to the limitations specified for MESSAGE over congestion-unsafe transport by IETF RFC 3428 [43].\nNOTE:\tThe actual size limit is part of stage-3 design.\nIf the size limit for a terminating MESSAGE request is exceeded, the network may refuse the request or respond to the sender with an indication that the size of the message is too large.\nThe sender UE can include an indication in the message regarding the length of time the message will be considered valid.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.16.2"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.1.1.1",
      "section_id": "5.16.1.1.1",
      "section_title": "Immediate messaging procedure to registered Public User Identity",
      "content": "Figure 5.47: Immediate Messaging procedure to registered Public User Identity\n1.\tUE#1 generates the multimedia content intended to be sent to UE#2.\n2.\tUE#1 sends the MESSAGE request to P‑CSCF#1 that includes the multimedia content in the message body.\n3.\tP‑CSCF#1 forwards the MESSAGE request to S‑CSCF#1 along the path determined upon UE#1's most recent registration procedure.\n4.\tBased on operator policy S‑CSCF#1 may reject the MESSAGE request with an appropriate response, e.g. if content length or content type of the MESSAGE are not acceptable. S‑CSCF#1 invokes whatever service control logic is appropriate for this MESSAGE request. This may include routing the MESSAGE request to an Application Server, which processes the request further on.\n5.\tS-CSC#1 forwards the MESSAGE request to I‑CSCF#2.\n6.\tI‑CSCF#2 performs Location Query procedure with the HSS to acquire the S‑CSCF address of the destination user (S‑CSCF#2).\n7.\tI‑CSCF#2 forwards the MESSAGE request to S‑CSCF#2.\n8.\tBased on operator policy S‑CSCF#2 may reject the MESSAGE request with an appropriate response, e.g. if content length or content type of the MESSAGE are not acceptable. S‑CSCF#2 invokes whatever service control logic is appropriate for this MESSAGE request. This may include routing the MESSAGE request to an Application Server, which processes the request further on.For example, the UE#2 may have a service activated that blocks the delivery of incoming messages that fulfil criteria set by the user. The AS may then respond to the MESSAGE request with an appropriate error response.\n9.\tS‑CSCF#2 forwards the MESSAGE request to P‑CSCF#2 along the path determined upon UE#2's most recent registration procedure.\n10.\tP‑CSCF#2 forwards the MESSAGE request to UE#2. After receiving the MESSAGE UE#2 renders the multimedia content to the user.\n11–16.\tUE#2 acknowledges the MESSAGE request with a response that indicates that the destination entity has received the MESSAGE request. The response traverses the transaction path back to UE#1.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.47"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.1.1.2",
      "section_id": "5.16.1.1.2",
      "section_title": "Immediate messaging procedure to unregistered Public User Identity",
      "content": "Figure 5.48: Immediate messaging to unregistered Public User Identity, service control invoked\n1-5.\tThe same actions apply as for when the Public User Identity is registered, see step 1-5 in clause 5.16.1.1.1.\n6.\tI‑CSCF#2 interacts with the HSS as per the terminating procedures defined for unregistered Public User Identities in clause 5.12.1. If the Public User Identity has no services related to unregistered state activated the interaction with HSS would be as per the procedure defined in clause 5.12.2.\n7.\tI‑CSCF#2 forwards the MESSAGE request to S‑CSCF#2.\n8.\tBased on operator policy S‑CSCF#2 may reject the MESSAGE request with an appropriate response, e.g. if content length or content type of the MESSAGE are not acceptable or the UE#2 does not have a service activated that temporarily hold the MESSAGE request in the network.\nS‑CSCF#2 invokes whatever service control logic appropriate for this MESSAGE request. This may include routing the MESSAGE request to an Application Server, which processes the request further on.\nFor example, the UE#2 may have a service activated that allows delivery of any pending MESSAGE request. The AS may then hold the MESSAGE request and deliver the MESSAGE request when the UE#2 becomes reachable. In this case, depending on user settings UE#2 controls the delivery of the pending MESSAGEs.\n9-12.\tThe MESSAGE request is acknowledged with an appropriate acknowledgement response. The acknowledgement response traverses the transaction path back to UE#1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.16.1.1.1",
        "clause_5.12.1",
        "clause_5.12.2",
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.1.2",
      "section_id": "5.16.1.2",
      "section_title": "Immediate messages with multiple recipients",
      "content": "IMS users shall be able to send a single immediate message to multiple recipients, as specified in TS 22.340 [29a]. The following means are supported to achieve this:\n-\tA PSI identifying a new group is created in the appropriate Application Server, and members are added to this group (e.g. by the user via the Ut interface or by the operator via O&M mechanisms). Immediate messages addressed to this PSI will be routed to the AS hosting the PSI, and this AS shall create and send immediate messages addressed to a group member of the group identified by the PSI.\n-\tThe user can send an immediate message by indicating the individual addresses (Public User Identities for IMS recipients) of the intended recipients as part of the immediate message. The AS of the user shall then create and send immediate messages addressed to each one of the intended recipients.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_22.340"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.0",
      "section_id": "5.16.2.0",
      "section_title": "General",
      "content": "This clause describes architectural concepts and procedures for fulfilling the requirements for Session-based Messaging described in TS 22.340 [29a].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_22.340"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.1",
      "section_id": "5.16.2.1",
      "section_title": "Architectural principles",
      "content": "Session-based IMS messaging communications shall as much as possible use the same basic IMS session delivery mechanisms (e.g. routing, security, service control) as defined in clause 4 and 5 of this document. For session based messaging the session shall include a messaging media component, other media components may also be included.\nAs the messaging media component usually does not require QoS beyond best-effort, use of the preconditions mechanism as defined in IETF RFC 3312 [41] is not required for session based messaging establishment that only includes a messaging media component.\nNOTE:\tPre-conditions mechanism may still be required for session establishment with additional media components that require the establishment of additional IP‑CAN bearers.\nOnce the session containing a messaging media component is established, messages in the session are transported between the session participants as per the parameters defined in the messaging media component part of the session description (SDP).\nThe invited UE shall host the message session (accept a connection for the message session from the other endpoint). In order to host the message session the UE needs an appropriate IP‑CAN bearer, on which it can accept the connection for the message media component. This IP‑CAN bearer may be e.g. a general purpose bearer available prior to starting the session initiation or a dedicated bearer that is established during session establishment. Messages within a message session should be transported over a connection-oriented reliable transport protocol. Message sessions may be either established end to end between two UEs or may involve one or more intermediate nodes (e.g. a chat server for multi party chat or an Application Server to perform per message charging).\nFor addressing chat-group-type session based messaging the concept of Public Service Identities is used.\nSession based messaging is available for users that are registered in the IMS.\nThe session based messaging shall be able to provide the following functionality:\n-\tPer-message-based charging, as well as content- and size-based charging.\n-\tOperator-controlled policy to be set on the size and content of the messages.\n-\tSupport for indication of maximum message content size that a UA will accept to be received.\n-\tSupport for a messaging media component as part of a session where other media components are also included.\n-\tSupport for messaging-only sessions.\nIf charging mechanisms like charging based on the message content, message type or number of sent and/or received messages (see TS 22.340 [29a]) are required, then an intermediate node (messaging AS) shall be involved, which is able to inspect the SIP signalling as well as the exchanged messages and their content. Such an intermediate node may also provide support for time- and/or volume based charging.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4",
        "ts_22.340"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.0",
      "section_id": "5.16.2.2.0",
      "section_title": "General",
      "content": "IMS users shall be able to exchange session-based messages with each other by using the procedures described in this clause. These procedures shall allow the exchange of any type of multimedia content (subject to possible restrictions based on operator policy and user preferences/intent), for example but not limited to:\n-\tPictures, video clips, sound clips with a format defined in the respective access specific documents.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.1",
      "section_id": "5.16.2.2.1",
      "section_title": "Session based messaging procedure to registered Public User Identity",
      "content": "The following procedure shows the establishment of a message session between two registered UEs where the UEs are able to exchange messages end-to-end. The signalling flow is based on the general flow shown in clause 5.7a of this specification.\nFigure 5.48a: Message session establishment\n1-30.\tThese steps are identical to the steps 1 to 30 in the flow of clause 5.7a. After that the message session is established. For session based messaging the SDP offer in the first INVITE request may indicate the maximum message size UE#1 accepts to receive and the 200 OK (Offer response) to the INVITE request may indicate the maximum message size UE#2 accepts to receive.\n31.\tUE#1 establishes a reliable end-to-end connection with UE#2 to exchange the message media.\n32.\tUE#1 generates the message content and sends it to UE#2 using the established message connection.\n33.\tUE#2 acknowledges the message with a response that indicates that UE#2 has received the message. The response traverses back to UE#1. After receiving the message UE#2 renders the multimedia content to the user.\nFurther messages may be exchanged in either direction between UE#1 and UE#2 using the established connection. The size of the messages exchanged within the session shall be within the size limits indicated by UE#1 and UE#2 respectively.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.7",
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.2",
      "section_id": "5.16.2.2.2",
      "section_title": "Session based messaging procedure using multiple UEs",
      "content": "Session based messaging between more than two UEs require the establishment of a session based messaging conference.\nWithin session based messaging conferences including multiple UEs (e.g. multiparty chat conferences) an MRFC/MRFP or an IMS AS shall be used to control the media resources.\nWhen MRFC/MRFP are used, then conferencing principles are used to provide the chat service:\n-\tMRFP must be able to establish message connections with all involved parties.\n-\tMRFC/MRFP must be able to receive messages from conference participants and to distribute messages to all or some of the participants.\n-\tIn order to enable the UE managing information related to the session based messaging conference the MRFC may be co-located with an IMS AS.\n-\tMRFC/MRFP roles and interactions with an AS are described in more detail in clauses 4.7, 5.14.1 and 5.14.2.\n-\tThe interface for session based messaging between MRFC and MRFP is not standardised in this release. When an AS is used, then the IMS service control architecture is used to provide the chat service. Both signalling and user plane are then supported by the AS. For more details, see clause 4.2.\nThe following flow shows the originating session based messaging set up using an intermediate server for a chat service. In this case the intermediate chat server is addressed by the UE#1 using a PSI. It is assumed that UE#1 is the first UE entering the chat session.\nNOTE:\tInteractions between MRFC and MRFP are not shown in the flows below since these interactions are not standardized. An optional ringing response from MRFC/AS to the UE is not shown in the following procedure.\nFigure 5.48b: Session based messaging using a chat server\n1.\tUE #1 sends the SIP INVITE request addressed to a conferencing or chat PSI to the P‑CSCF. The SDP offer indicates that UE#1 wants to establish a message session and contains all necessary information to do that. The SDP offer may indicate the maximum message size UE#1 accepts to receive.\n2.\tP‑CSCF forwards the INVITE request to the S‑CSCF.\n3.\tS‑CSCF may invoke service control logic for UE#1.\n4.\tS‑CSCF forwards the INVITE request to the MRFC/AS.\n5. 6. and 8.\tMRFC/AS acknowledges the INVITE with a 200 OK, which traverses back to UE#1. The 200 OK (Offer response) may indicate the maximum message size the host of the PSI accepts to receive.\n7.\tBased on operator policy P‑CSCF may instruct PCRF/PCF to authorize the resources necessary for this session.\n9.-11.\tUE#1 acknowledges the establishment of the messaging session with an ACK towards MRFC/AS.\n12.\tUE#1 establishes a reliable end-to-end connection with MRFP/AS to exchange the message media.\n13.\tUE#1 sends a message towards MRFP/AS.\n14.\tMRFP/AS acknowledges the message.\nA1.\tAnother UE (UE#2) sends an INVITE request addressed to the same conferencing or chat PSI. The initial SDP indicates that the UE wants to establish a message session and contains all necessary information to do that.\nA2.\tMRFC/AS acknowledges the INVITE request with a 200 OK.\nA3.\tUE#2 acknowledges the 200 OK with an ACK.\nA4.\tUE#2 establishes a reliable end-to-end connection with MRFP/AS to exchange the message media.\nA5.\tMRFP/AS forwards the message to all recipients, e.g. all participants in the chat room.\nA6. The recipients acknowledge the message towards MRFP/AS.\nB1. and C1.\tFurther INVITE requests from new possible participants may arrive at any time.\nFurther messages may be exchanged in either direction between the participating UEs using the established connection via the MRFC/MRFP or AS. The size of the messages exchanged within the session shall be within the size limits indicated by UE#1 and the host of the PSI respectively.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.2",
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.3",
      "section_id": "5.16.2.2.3",
      "section_title": "Session based messaging procedure with an intermediate node",
      "content": "The following procedure shows the originating session based messaging involving an intermediate node. An optional ringing response from AS to the UE or vice versa is not shown in the following procedure.\nFigure 5.48c: Session based messaging with an intermediate node\n1.\tUE#1 sends the SIP INVITE request addressed to UE#2, containing an initial SDP, to the P‑CSCF. The SDP offer may indicate the maximum message size UE#1 accepts to receive.\n2.\tThe P‑CSCF forwards the INVITE request to the S‑CSCF along the path determined upon UE#1's most recent registration procedure.\n3.\tBased on operator policy the S‑CSCF may reject the INVITE request with an appropriate response. S‑CSCF may invoke whatever service control logic is appropriate for this INVITE request. In this case the Filter Criteria trigger the INVITE request to be routed to an Application Server that acts as an intermediate node for the message session.\n4.\tThe S‑CSCF forwards the INVITE request to the AS. The AS may modify the content of the SDP (such as IP address/port numbers). Based on operator policy the AS may either reject the session set-up or decrease the maximum message size indication.\n5.\tThe AS sends the INVITE request to the S‑CSCF.\n6.\tThe S‑CSCF forwards the INVITE request to the destination network. The destination network will perform the terminating procedure.\n7–8.\tUE#2 or AS in the terminating network accepts the INVITE request with a 200 OK response. The 200 OK response is forwarded by the S‑CSCF to the AS. The 200 OK (Offer response) may indicate the maximum message size UE#2 accepts to receive, possibly decreased by the AS.\n9‑10.\tThe AS acknowledges the 200 OK response from the terminating network with an ACK, which traverses back to UE#2 or AS in the terminating network via the S‑CSCF.\n11.\tThe AS initiates the establishment of a reliable end-to-end connection with UE#2 or the AS in the terminating network to exchange the message media. This step can take place in parallel with step 12.\n12, 13 and 15.\tThe AS accepts the message session with a 200 OK response. The 200 OK response traverses back to UE#1.\n14.\tBased on operator policy P‑CSCF may instruct PCRF/PCF to authorize the resources necessary for this session.\n16‑18.\tUE#1 acknowledges the 200 OK with an ACK, which traverses back to the AS.\n19. UE#1 establishes a reliable end-to-end connection with the AS to exchange the message media.\n20.\tUE#1 generates the message content and sends it to the AS using the established message connection.\n21.\tThe AS forwards the message content using the established message connection with the terminating network.\n22.\tUE#2 or AS in the terminating network acknowledges the message with a response that indicates the reception of the message. The response traverses back to the AS.\n23.\tThe AS forwards the message response back to UE#1.\nFurther messages may be exchanged in either direction between UE#1 and the terminating network using the established message connection via the AS. The size of the messages exchanged within the session shall be within the size limits indicated by UE#1 and UE#2 respectively, possibly decreased by the AS.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.4",
      "section_id": "5.16.2.2.4",
      "section_title": "Session based messaging release procedure",
      "content": "The following procedure shows the release of a message session, which was established between two UEs. It is assumed that UE#1 is the session host.\nFigure 5.48d: Message session release procedure\n1–6.\tUE#1 indicates its intent to terminate the message session by sending a BYE request to UE#2. UE#1 stops sending messages and tears down the message connection on the transport level and destroy local state for the message session. The UE#1 may use the IP‑CAN bearer for some other services; hence it keeps the bearer activated.\n7-8.\tUE#2 agrees to end the session and tear down the message connection on the transport level and destroy local state for the message session. The UE#2 may use the IP‑CAN bearer for some other services; hence it keeps the bearer activated.\n9-13.\tUE#2 acknowledges the BYE request by sending a 200 OK to UE#1, which traverses back the signalling path.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.16.2.2.5",
      "section_id": "5.16.2.2.5",
      "section_title": "Session based messaging release procedure with an intermediate node",
      "content": "The following procedure shows the release of a message session, which was established between two UEs via an intermediate node. It is assumed that UE#1 is the session host.\nFigure 5.48e: Message session release procedure with intermediate node\n1–4.\tUE#1 indicates its intent to terminate the message session by sending a BYE request to UE#2, via the AS. UE#1 stops sending messages and tears down the message connection on the transport level and destroy local state for the message session. The UE#1 may use the IP‑CAN bearer for some other services; hence it keeps the bearer activated.\n5.\tThe AS forwards the BYE request to the UE#2.\n6-9.\tThe AS tears down the message connection on the transport level and destroys local state for the message session. The AS acknowledges the BYE request by sending a 200 OK to UE#1, which traverses back the signalling path\n10.\tThe AS receives the acknowledgement from UE#2 to end the session.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.48"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.17",
      "section_id": "5.17",
      "section_title": "Refreshing sessions",
      "content": "The active sessions in stateful network elements (e.g. CSCFs, ASs) may need to be refreshed periodically. This allows these stateful elements to detect and free resources that are being used by hanging sessions.\nThis SIP‑level session refreshing mechanism is to be used to allow removing session state from the stateful elements of the session path upon unexpected error situations (e.g. loss of radio coverage, crash of application in the UE, etc…). The refreshing period is typically in the range of several tens of minutes / hours. The mechanism is intended as a complementary mechanism for the \"Network initiated session release\" described in clause 5.10.3. Whether the session refresh mechanism is used for a particular session is negotiated between the endpoints of the session upon session initiation.\nIMS entities acting as User Agents as defined in IETF RFC 3261 [12] should support the refresh mechanism of SIP sessions. This includes support for the negotiation of the session refresh details upon session initiation, and the initiation of session refresh requests.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.10.3"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.19.1",
      "section_id": "5.19.1",
      "section_title": "General",
      "content": "This clause presents some high level flows to describe the procedures for supporting IMS transit network scenarios.\nThe IMS Transit Functions perform an analysis of the destination address, and determine where to route the session. The session may be routed directly to an MGCF, BGCF, or to another IMS entity in the same network, to another IMS network, or to a CS domain or PSTN. The address analysis may use public (e.g. DNS, ENUM) and/or private database lookups, and/or locally configured data. As described in clause 4.15 there are various transit configurations possible that may be supported.\nFor the case where an operator is providing transit functions for other operators and/or enterprise networks, the configuration is as shown in Figure 5.49. The configuration in Figure 5.49 is also intended to cover scenarios where an operator routes traffic from other IMS- or SIP-networks to CS domain or PSTN customers through the IMS transit network. In this case the terminating network as shown in the figure indicates the operator's CS domain or PSTN.\nFigure 5.49: IMS transit network\nFor the transit operator in Figure 5.49, ISUP messages that arrive at a configured MGCF, are translated into SIP, and are passed to the IMS Transit Functions. SIP messages may arrive directly at the configured entity supporting the transit functions or first pass through an IBCF before arriving at the IMS Transit Functions. The IMS Transit Functions determine whether to route directly to an MGCF, BGCF, or to another IP entity on the path (e.g. an IBCF). In this transit operator configuration, the IMS Transit Functions might reside in a stand-alone entity or might be combined with the functionality of an MGCF, a BGCF, an I‑CSCF, an S‑CSCF or an IBCF. When residing in a stand-alone entity the IMS Transit Functions shall be able to generate CDRs.\nFor the case where the operator is the terminating network operator handling a terminating service for its own customers, the configuration and operation may be more complex as shown in figure 5.50.\nNOTE 1:\tIn the case of Fixed Broadband Access to IMS the term \"CS domain\" in the following text and in figure 5.50 may be replaced by the term \"PSTN\".\nFigure 5.50: Terminating IMS network with transit support, Transit Functions first\nFor the operator in figure 5.50, ISUP messages arriving at an MGCF may be destined for an IMS or a CS domain customer (see clause 4.15). The ISUP messages are translated into SIP.\nThe operator can choose whether to route all traffic through the IMS Transit Functions, which subsequently route to the I‑CSCF for IMS terminating call scenarios or to an MGCF for the case of CS domain subscribers as described above. This is depicted in figure 5.50. In this case, there may be an additional delay for terminating sessions destined for IMS subscribers.\nNOTE 2:\tIn this case, the IMS Transit Functions perform selection of the appropriate domain to terminate the call to, followed by routing to the CS domain (for CS domain destined traffic).\nAs an alternative, the operator may choose to route all traffic to the I‑CSCF directly and then identify those sessions that are not destined to IMS subscribers based on an HSS query. Based on the response from the HSS, sessions are either routed to an S‑CSCF or to the CS domain (optionally via Transit Functions). In this case there may be an additional delay for terminating sessions destined for the CS domain subscribers.\nNOTE 3:\tIf in this case, the I‑CSCF becomes aware that the call is not destined to an IMS subscriber and forwards it to the Transit Function for further routing, then the Transit Functions only perform routing to the CS domain.\nIt is the operator's choice to determine which way to route the SIP messages, first through IMS Transit Functions or first to an I‑CSCF. This may depend on whether the majority of the sessions that enter the IMS network, are destined to IMS or CS domain subscribers.\nNOTE 4:\tIn either configuration of the terminating network scenario, once it is determined that the call is not destined for an IMS subscriber, it is necessary to verify that the call is destined for a CS domain subscriber rather than to a ported number or to a wrong number. At which stage of the session establishment this decision is made is FFS.\nIn the terminating network configuration shown in figure 5.50, the IMS Transit Functions might reside in a stand-alone entity or might be combined with the functionality of an MGCF, a BGCF, an I‑CSCF, an S‑CSCF, or an IBCF. When residing in a stand-alone entity the IMS Transit Functions shall be able to generate CDRs.\nFor the case where an IMS network serves as a transit network and as a terminating network (depending on the destination of the session), the configuration and operation resembles that of the previous case as shown in figure 5.50a and figure 5.50b.\nFigure 5.50a: Terminating/Transit IMS network, Transit Functions first\nFigure 5.50b: Terminating/Transit IMS network, I-CSCF first\nFor the operator in figure 5.50a and figure 5.50b, ISUP messages arriving at an MGCF may be destined for the own IMS network of for a succeeding network. The ISUP messages are translated into SIP. This is not depicted in figure 5.50a and figure 5.50b.\nThe operator can choose whether to route all traffic through the IMS Transit Functions, which subsequently route to the I‑CSCF for sessions destined for subscribers of the own IMS network, to the own CS domain for sessions destined to subscribers of the own CS domain, or to a succeeding network for sessions not destined for subscribers of the own IMS network or the own CS domain. This is depicted in figure 5.50a. In this case there may be an additional delay for sessions destined to subscribers of the own network.\nNOTE 5:\tIn this case, the Transit Functions perform selection of the appropriate domain to terminate the call to, for subscribers of the own network, followed by routing to another network (if the session is not destined to the own network).\nAs an alternative, the operator may choose to route all traffic to the I‑CSCF directly and then identify those sessions that are not destined to IMS subscribers of the own IMS network based on an HSS query. Based on the response from the HSS, sessions are either routed to an S‑CSCF of the own IMS network or to Transit Functions. The Transit Functions subsequently route the session to either the CS domain of the own network or to a succeeding network. This is depicted in figure 5.50b. In this case there may be an additional delay for sessions not destined to subscribers of the own IMS network.\nIt is the operator's choice to determine which way to route the SIP messages, first through IMS Transit Functions or first to an I‑CSCF. This may depend on whether the majority of the sessions that enter the IMS network, are destined to subscribers of the own IMS network or not. This operator's choice may be implemented as a functionality of an entry functions such as an IBCF.\nIn the terminating/transit network configuration shown in figure 5.50a and figure 5.50b, the IMS Transit Functions might reside in a stand-alone entity or might be combined with the functionality of an MGCF, a BGCF, an I‑CSCF, an S‑CSCF, or an IBCF. When residing in a stand-alone entity the IMS Transit Functions shall be able to generate CDRs.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.15",
        "figure_5.49",
        "figure_5.50"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.19.2",
      "section_id": "5.19.2",
      "section_title": "Providing IMS application services in transit network scenarios",
      "content": "This clause provides an overview of how IMS application services in transit network scenarios are provided.\nFigure 5.50c: IMS application services in transit network\nThe procedure for IMS application services in transit network is as follows:\n1.\tThe Transit function receives an incoming request from a preceding network.\n2.\tBased on local configured Transit invocation criteria, the Transit function determines whether one or more services are to be performed.\nIf the preceding network is the served network, for which special services are invoked, the invocation criteria will trigger and invoke the related services based on the origination of the request.\nIf the succeeding network is the served network, for which special services are invoked, the invocation criteria will trigger and invoke the related services based on the termination point of the request.\nThe related service(s) are invoked.\n3.\tThe Transit function performs the transit routing according to clause 5.19.1 and forwards the Session Request towards the succeeding network.\nNOTE:\tAn AS that acts as a B2BUA can decide to not route back the call to the transit function. In this case, it will use the terminating UA mode of operation for request from the Transit function. It can apply originating UA procedures according to TS 23.218 [71].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.19.1",
        "figure_5.50",
        "ts_23.218"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.20.1.1",
      "section_id": "5.20.1.1",
      "section_title": "Obtaining a GRUU during registration",
      "content": "A UE shall indicate its support for the GRUU mechanism in the registration request and retain the GRUU set (P‑GRUU and T‑GRUU) in the registration response. The UE may retain some or all of the previous T‑GRUUs obtained during the initial registration or previous re-registrations along with the new T‑GRUU or the UE may replace some or all of the previous T‑GRUUs with the new T‑GRUU. The UE shall generate an instance identifier that is a unique identifier for that UE. The UE shall include an instance identifier in all registration requests. Instance identifiers shall conform to the mandatory requirements for instance identifiers specified in RFC 5627 [49] and RFC 5626 [48].\nIf the registered Public User Identity is part of an implicit registration set, the UE shall obtain and retain the GRUU sets for each implicitly registered SIP URI sent by the S‑CSCF in accordance to RFC 5628 [50].",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.1.2",
      "section_id": "5.20.1.2",
      "section_title": "Using a GRUU",
      "content": "When sending SIP requests from an explicitly or implicitly registered Public User Identity for which a UE obtained P‑GRUU and at least one T‑GRUU, the UE should use the corresponding retained P‑GRUU or a T‑GRUU as a Contact address.\nWhen responding to SIP requests where the identification of the called party is a registered Public User Identity for which a UE obtained a GRUU, the UE shall use the corresponding retained P‑GRUU or T‑GRUU as the Contact address when addressing that UE.\nIf the UE has obtained GRUUs for its Public User Identity being used in a request or response and the user does not require privacy the UE should use the P‑GRUU as the Contact address.\nA UE may learn a GRUU of another UE using mechanisms that are outside the scope of this specification, (e.g. a UE may learn a GRUU from the contact header of a request, from presence information, or by other mechanisms).\nIf a UE that receives a notification from the S‑CSCF indicating that an implicit registration has occurred for a contact the UE has registered, then the UE shall retain the GRUUs included in the notification for future use.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.1.3",
      "section_id": "5.20.1.3",
      "section_title": "Using a GRUU while requesting Privacy",
      "content": "When a UE sends a request or response containing a GRUU, and it wishes to block the delivery of its Public User Identity to an untrusted destination, the UE shall use a T-GRUU as the Contact address.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.2.1",
      "section_id": "5.20.2.1",
      "section_title": "Allocating a GRUU during registration",
      "content": "The S‑CSCF, when receiving a registration request from a UE that includes an instance id, shall allocate a GRUU set. If the UE indicates support of GRUU in the REGISTER request, then the S‑CSCF shall return the GRUU set in the registration response and associate that GRUU set with the registered contact information for that UE.\nNOTE:\tAs long as the instance id provided in the register request is the same, the resulting P‑GRUU in the GRUU set will always be the same for a given Public User Identity. The T‑GRUU will be different from those returned during previous re-registrations. All T‑GRUUs that are allocated continue to remain valid until that UE Instance ID and Public User Identity pair are deregistered.\nIf there are implicitly registered Public User Identities, the S‑CSCF shall generate a GRUU set for each implicitly registered Public User Identity and include the corresponding GRUU set with the notification of each implicitly registered Public User Identity",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.2.2",
      "section_id": "5.20.2.2",
      "section_title": "Using a GRUU",
      "content": "The filter criteria in the service profile may check for the presence of a GRUU in the Request URI or related parameters of a request.\nFor originations, the S‑CSCF shall validate the GRUU conveyed in the contact header of the SIP request and pass the SIP request with the validated GRUU to Application Servers based on the filter criteria.\nFor terminations, the S‑CSCF may validate the GRUU conveyed in the Request URI header of the SIP request and pass the SIP request with the validated GRUU to Application Servers based on filter criteria.\nApplication servers may then apply services to the GRUU.\nIf the SIP message is destined to a GRUU, then the S‑CSCF shall associate the request with the corresponding Public User Identity. The S‑CSCF will not fork this request, but will direct the call to the identified instance.\nS‑CSCF shall provide an indication to UE that the SIP request was targeted to a GRUU.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.3",
      "section_id": "5.20.3",
      "section_title": "Interrogating‑CSCF",
      "content": "When routing requests addressed to a GRUU to the terminating S‑CSCF, the I‑CSCF uses the contents of the Request URI when querying the HSS. Requests routed to the terminating S‑CSCF are addressed to the GRUU.\n5.20.3a\tHSS\nThe HSS shall remove the P‑GRUU as part of the canonicalization process of SIP URIs, to obtain the Public User Identity for identity look-up as it is defined in TS 29.228 [30].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.20.4.1",
      "section_id": "5.20.4.1",
      "section_title": "Using a GRUU",
      "content": "It shall be possible for other IMS elements other than UEs, that act as UAs (e.g. MGCF, Application Server) to use a GRUU referring to itself when inserting a contact address in a SIP message. The MGCF and MRF are not required to store GRUUs beyond a session. If the incoming contact address that is being replaced by the B2BUA functionality contains a GRUU, then the replacement URI in the outgoing SIP message should also contain a GRUU.\nIf an element so uses a GRUU, it shall handle requests received outside of the session in which the contact was provided.\nRouting procedures amongst IMS elements other than UEs that act as UAs are unchanged when GRUUs are in use.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.20.4.2",
      "section_id": "5.20.4.2",
      "section_title": "Assigning a GRUU",
      "content": "The GRUUs shall either be provisioned by the operator or obtained by any other mechanism. The GRUU shall remain valid for the time period in which features addressed to this URI remains meaningful.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.228_5.21",
      "section_id": "5.21",
      "section_title": "IMS Multimedia Priority Services Procedures",
      "content": "The IMS Multimedia Priority Service provides Service Users access to IMS services in a prioritised manner.\nThe P-CSCF shall control the priority of IMS based MPS sessions, using PCC procedures. The P-CSCF shall permit any authorised Service User to originate an IMS based MPS session. The detection of MPS sessions is handled by the P-CSCF at the originating network.\nPCC shall always be enabled in a network supporting IMS Multimedia Priority Services.\nHSS shall store IMS Priority Indication and Priority Level as part of the subscription information.\nThe P-CSCF at the originating end shall determine whether the INVITE message requires priority handling based on user profile stored during the registration procedure and/or MPS code/identifier provided by the INVITE message. If the session is determined to require priority handling, then the P-CSCF inserts/replaces the MPS priority indication in the INVITE and, if the Service User's priority level is known, may include it and forwards the INVITE to the S-CSCF. If the Service User's priority level is not known, the P-CSCF includes the priority indication without the Service User's priority level. The S-CSCF routes (using initial Filter Criteria set for the MPS code/identifier) the INVITE to the AS for authentication/authorization for MPS (if needed), and the AS adds the Service User's priority level if it is not in the INVITE already. The AS or the S-CSCF may assert the authorization for priority in the INVITE. The AS then forwards the INVITE (with MPS priority indication and the Service User's priority level) to the next entity in the network via the S-CSCF as part of the normal IMS routing. All subsequent SIP messages carry both MPS priority indication and the Service User's priority level.\nNOTE 1:\tOnly one entity is configured to perform assertion of the authorization for priority of a request.\nWhen the P-CSCF at the originating end determines that priority handling is required, the P-CSCF shall derive session information and interact with the PCRF/PCF providing the session information. The derived session information shall indicate the priority of the MPS session, which depends if the Service User's priority level is known at this stage. The PCC interaction between the P-CSCF and the PCRF/PCF is described in TS 23.203 [54] and TS 23.503 [95].\nThe P-CSCF at the terminating end shall determine whether the INVITE message requires priority handling based on MPS priority indication and the originating Service User's priority level received from the originating network. If priority handling is required, P-CSCF shall derive the session information based on the Service User's priority level to indicate the priority of the MPS session and interact with the PCRF/PCF providing the session information.\nThe P-CSCF shall adjust the priority treatment of transactions or dialogs according to the most recently received authorized MPS priority indication.\nWhen the terminating user is a Service User, while the session request is from a normal user, the IMS signalling bearer may be given priority treatment when operator policy and MPS (IMS) priority subscription indicates so. For a Service User originating a non-priority session, the IMS signalling bearer may be given priority treatment when operator policy and MPS (IMS) priority subscription indicates so. For IMS media, priority treatment is not required in these cases.\nIf so configured by the operator, a P-CSCF or an IBCF shall prohibit the negotiation of ECN during SDP offer/answer exchanges and shall not invoke ECN (as described in clause 4.22) for IMS based MPS sessions.\nNOTE 2:\tDisabling ECN in an IBCF does not prevent a P-CSCF (IMS ALG), subject to roaming agreement, from applying ECN over the access network between a UE and the P-CSCF (IMS ALG) / IMS AGW.\nA conferencing AS, if enabled by local policy, shall permit an authorized host with an MPS (IMS) priority subscription (i.e. the Service User that established the conference) to request an upgrade of the host itself, specific participants, or all participants including the host in the conference, whether participants have an MPS subscription or not. Once the conference has been upgraded, the AS will upgrade new participants to MPS without explicit host invocation. For MPS conferencing sessions, upon request from a host to upgrade an existing conference, the AS shall first authenticate/authorize the host for MPS.\nNOTE 3:\tThe procedure for the AS to authorize the host for MPS is either based on internal AS information or via access to an MPS database or HSS; and is left to operator implementation. The procedure used by the host to initiate the upgrade request is out of scope.\nNOTE 4:\tThe AS decides on the MPS priority level to use for participant UEs in the conference for the purpose of the upgrade.\nThe session upgrade of UE conference participants is based on existing IMS routing procedures, including interaction between the P-CSCF and PCRF/PCF for that purpose.\nFor E-UTRAN access, priority support for EPS bearer is described in TS 23.401 [70].\nFor 5GS, support Multimedia Priority Service is described in TS 23.501 [93].",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.22",
        "ts_23.203",
        "ts_23.503",
        "ts_23.401",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.22.1",
      "section_id": "5.22.1",
      "section_title": "Next-hop monitoring of overload",
      "content": "The following figure depicts an example information flow for the overload control mechanism based on feedback.\nFigure 5.22.1-1: Information flow for Overload Control with next-hop monitoring\n1.\tDuring a past INVITE, the SIP IMS entity 1 obtained a percentage by which the load forwarded to SIP IMS entity 2 should be reduced.\n2.\tDuring a past INVITE, the SIP IMS entity 1 obtained a percentage by which the load forwarded to SIP IMS entity 3 should be reduced.\n3.\tIncoming INVITE from Originating side (network or UE). The SIP IMS entity 1 determines that the INVITE has to be forwarded via SIP IMS entity 2.\n4.\tWith the information obtained in step 1, the SIP IMS entity 1 either:\n5a.\trefuses the INVITE request because of overload situation, or\n5b.\tforwards the INVITE to SIP IMS entity 2 (5b1). The Reply to the INVITE (5b2) can contain updated overload control information.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.22.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.228_5.22.2",
      "section_id": "5.22.2",
      "section_title": "Filter based Overload Control",
      "content": "The following figure depicts an example information flow for the filter based overload control mechanism.\nNOTE:\tThe applicability of the filter based overload control mechanism is not restricted to the IMS entities mentioned on this figure.\nFigure 5.22.2-1 Information flow for AS Overload Control using a filter based mechanism\n1.\tUpon initialization or restart, AS/S-CSCF subscribes to overload event notification of AS-1 and receives overload control filters (1c).\n2.\tUpon initialization or restart AS/S-CSCF subscribes to overload event notification of AS-2 and receives overload control filters (2c)\n3.\tAn INVITE comes to AS/S-CSCF.\n4-5.\tThe AS/S-CSCF determines where to forward the message (AS-1 in this example), then evaluates whether the contents of the INVITE matches the filters received from AS-1:\n-\tIf the request does not match any filter, the AS/S-CSCF forwards it to AS-1 (5b1);\n-\tOtherwise, depending on the throttling algorithm, the AS/S-CSCF either:\n-\trefuses the INVITE request because of the overload situation (5a), or\n-\tforwards the INVITE to AS-1 (5b1).\nAnnex A (informative):Information flow template\nThis clause describes the template used in developing information flow (IF) procedures.\nX.Y.Z\t\"Name of procedure (e.g. Terminal location registration)\"\nIn this clause, provide a brief prose description of the service or network capability. The \"X.Y.Z.\" refers to the clause heading number.\nFigure A.1: Information Flow Template\nThis clause consists of subparagraphs each dedicated to one information flow of the IF diagram. For each information flow, a detailed description is provided on the information flow name, certain information elements (IEs) within the information flow, whether the IE is mandatory or optional (M/O), in the sequence as shown in the IF diagram. FE actions (FEA) are also provided in this clause. This clause format is proposed as follows:\n1.\tInitial information flow: One should normally describe the initiating FE Action (FEA) leading to the first flow. Any information that is specifically required to support the operation should be mentioned (e.g. this flow conveys the user identity to the HSS).\n2.\tEach paragraph should contain a brief description of the flow and any specific start and end FEAs. When information to be conveyed is optional, the conditions for its inclusion should be specified and the response to its presence when received should also be specified (e.g. Include IP Address when condition xyz occurs). For an information flow that is required, the description should indicate whether a response is required based on successful outcome to the received IF, failed outcome, both or neither. e.g. \"Response is required indicating Success or Failure\".\n3.\tFlows may occur in either direction but not both at the same time. To indicate a shorthand for multiple flows, use a procedure box as in flow 5 or 6.\n4.\tFlows that are an optional part of the procedure should be shown as dotted arrows as in flow 4. These may appear in either direction.\n5.\tA set of flows, representing a common procedure, is shown by a box. The procedure should be numbered and named with a name that corresponds to the procedure as described elsewhere. The location of the box on an entity represents the start of the common procedure regardless of the number of the entities involved in the procedure.\n6.\tAn optional set of flows is represented as a dashed box. Otherwise the use is the same as in flow 5.\n7.\tA small number of alternative flows may be shown within a dashed box. The alternatives are shown by a letter immediately following the flow number, e.g. 7a, 7b, 7c, etc. Where a single alternative results in multiple flows, they must be shown with an indication of the proper sequence, e.g. 7b1, 7b2. The subparagraph describing the information flow must describe the decision process taken in choice of alternatives.\n7a.\tAlternative (a) is described. If alternative (a) is a single information flow, the contents and purpose of that information flow is included here.\n7b.\tAlternative (b) is described.\n7b1.\tThe first information flow of alternative (b) is described\n7b2.\tThe second information flow of alternative (b) is described. Etc.\n8.\tThe final flow in a procedure may provide additional information regarding other procedures that might follow it but such information is not required.\nThe general characteristics of the information flow template are as follows:\n-\tAll relevant functional entities are contained in the flow diagram. Only relevant entities need be shown.\n-\tWhen an element occurs only in an information flows for which several alternatives exist, the description box for the functional entity and the vertical line shall be dashed lines.\n-\tThe specific network affiliation of functional entities may be shown using a labelled bracket over the specific entities as shown in the figure (e.g. Home Network). Such labelling is not required unless the flow would not be clear without it.\n-\tThe number associated with each flow provides a \"handle\" to the functional entity action (FEA) executed by the FE receiving the flow. This number is known only within the scope of the specific information flow diagram. The description of this functional entity action (FEA) immediately follows the information flow description.\n-\tCommon Procedures described elsewhere can be used in the information flows in order to simplify the diagram. These may be either required or optional.\n-\tEach common procedure is treated as a single action and therefore is given a unique number.\n-\tAn optional flows (flows 4 and 6) are indicated by a dashed arrow or box.\n-\tCo-ordinated flows or flows that illustrate parallel actions are indicated by the flow text description. For example one might see a description such as: \"flows 5 and 6 may be initiated any time after flow 3\".\n-\tSequential operation is assumed unless indicated otherwise.\nAnnex B (informative):Void\nAnnex C (informative):Void\nAnnex D (informative):Void\nAnnex E (normative):IP-Connectivity Access Network specific concepts when using GPRS and/or EPS to access IMS\nE.0\tGeneral\nThis clause describes the main IP-Connectivity Access Network specific concepts that are used for the provisioning of IMS services over GPRS and EPS system using GERAN and/or UTRAN radio access and/or E-UTRAN (using EPC only).\nWhen using GPRS-access, the IP-Connectivity Access Network bearers are provided by PDP Context(s).\nWhen using EPS the SGSN is responsible for mapping PDP Context(s) to EPS bearers, i.e. the UE (using GERAN/UTRAN) is using PDP Context(s) whereas EPS bearers are used from the SGSN towards the S‑GW/P‑GW. However, throughout this annex PDP context(s) are used when referring to an IP‑CAN bearer for GPRS networks and when a UE is connected to EPS via GERAN/UTRAN access.\nWhen GGSN/P‑GW is shown, it represents either a GGSN or a P‑GW for a specific UE connection towards a PDN.\nE.1\tMobility related concepts\nE.1.0\tGeneral\nThe Mobility related procedures for GPRS and EPS are described in TS 23.060 [23] and TS 23.401 [70] respectively and the IP address management principles are described in TS 23.221 [7]. As specified by the GPRS/EPS procedures, the UE shall acquire the necessary IP address(es) as part of the PDP Context activation procedures for GERAN/UTRAN access and Attach (or PDN connectivity)/EPS bearer activation procedure(s) for E-UTRAN.\nIf the UE changes its IP address due to changes triggered by the GPRS/EPS procedures or according to TS 23.221 [7], then the UE shall re- register in the IMS.\nIf the UE acquires an additional IP address, then the UE may perform an IMS registration using this additional IP address as the contact address. If IMS registration is performed, this IMS registration may co-exist with the previous IMS registration from this UE and the UE shall be notified that this IMS registration results in multiple simultaneous registrations.\nNOTE:\tThe UE can acquire an additional IP address that can be used for registration to the IMS only outside of the EPS.\nWhen a routeing area update or tracking area update is not performed due to the Idle mode Signalling Reduction feature being active (see TS 23.401 [70] for more information), then the UE shall also not perform an IMS re registration because of such routeing area and tracking area change.\nSimilarly, the UE shall not perform an IMS re registration because the UE has moved between GERAN and UTRAN cells that share the same RAI.\nWhen the PLMN changes, and the attempt to perform an inter-PLMN routeing area update or tracking area update is unsuccessful, then the UE should attempt to re-attach to the network using GPRS/EPS procedures and register for IMS services. Typically this will involve a different GGSN/P‑GW.\nIn Dual Connectivity with EPC case, the UE shall use the access network information based on the primary cell of the Master RAN node that is serving the UE for network location information when the UE interacts with IMS, regardless whether the IMS traffic is routed via the Master RAN node or the Secondary RAN node or both.\nE.1.1\tProcedures for P‑CSCF discovery\nE.1.1.0\tGeneral\nThis clause describes the P‑CSCF discovery procedures applicable for GERAN/UTRAN access. All the procedures described in clause 5.1.1 apply with the following additions:\nP‑CSCF discovery shall take place after GPRS/EPS attach and after or as part of a successful activation of a PDP context (in the case of GERAN/UTRAN access) and EPS bearer (in the case of E-UTRAN access) for IMS signalling using the following mechanisms:\na.\tFor GERAN/UTRAN access: Transfer a Proxy‑CSCF address within the PDP Context Activation signalling to the UE, as described in clause E.1.1.1. The UE shall request the P‑CSCF address(es) when activating the PDP context. The GGSN/P‑GW shall send the P‑CSCF address(es) to the UE when accepting the PDP context activation. Both the P‑CSCF address(es) request and the P‑CSCF address(es) shall be sent transparently through the SGSN/S‑GW for GERAN/UTRAN.\nb.\tFor E-UTRAN access: Transfer a P‑CSCF address within the EPS Attach or PDN Connectivity Procedures to the UE, as described in clause E.1.1.1. The UE shall request the P‑CSCF address(es) in the EPS Attach or PDN Connectivity request. The P‑GW shall send the P‑CSCF address(es) to the UE when accepting the EPS Default bearer activation. Both the P‑CSCF address(es) request and the P‑CSCF address(es) shall be sent transparently through the intermediate network entities (e.g. MME/S‑GW).\nWhen using DHCP/DNS procedure for P‑CSCF discovery (according to the mechanisms described in clause 5.1.1.1) with GPRS/EPS, the GGSN/P‑GW acts as DHCP Relay agent relaying DHCP messages between UE and the DHCP server.\nE.1.1.1\tGPRS/EPS procedure for P‑CSCF discovery\nThis alternative shall be used for UE(s) not supporting DHCP. This may also be used for UE(s) supporting DHCP.\nFigure E.1: P‑CSCF discovery using PDP Context Activation signalling\n1.\tThe UE requests establishment of a PDP context according to clause 4.2.6 (QoS requirements for IM CN subsystem signalling). The UE indicates that it requests a P‑CSCF IP address(es). The indication is forwarded transparently by the SGSN to the GGSN in the Create PDP Context Request or to the S‑GW/P‑GW in the Create Default Bearer Request.\n2.\tThe GGSN/P‑GW gets the IP address(es) of the P‑CSCF(s). The mechanism to do this is a matter of internal configuration and is an implementation choice.\n3.\tIf requested by the UE, the GGSN/P‑GW includes the IP address(es) of the P‑CSCF(s) in the Create PDP Context Response or in the Create Default bearer response. The P‑CSCF address(es) is forwarded transparently by the SGSN to the UE.\nAfter reception of the IP address of a P‑CSCF the UE may initiate communication towards the IM CN Subsystem.\nNOTE:\tThis request of a P‑CSCF IP address(es) and response is not transparent for pre-R5 SGSN when using the Secondary PDP Context Activation Procedure as defined in TS 23.060 [23].\nE-UTRAN access only:\nThe procedure for E-UTRAN access applies to both Initial E-UTRAN Attach and PDN Connectivity Request.\nFigure E.2: P‑CSCF discovery using EPS bearer activation signalling\n1.\tDuring Initial Attach/PDN Connection Request, the UE indicates that it requests a P‑CSCF IP address(es).\n2.\tThe MME sends a Create Default Bearer Request to the S‑GW.\n3.\tThe S‑GW forwards the request to the P‑GW and the P‑GW gets the IP address(es) of the P‑CSCF(s). The mechanism to do this is a matter of internal configuration and is an implementation choice.\n4.\tIf requested by the UE, the P‑GW includes the IP address(es) of the P‑CSCF(s) in the Create Default Bearer Response.\n5.\tThe S‑GW forwards the response to the MME\n6.\tCompletion of procedures, as described in TS 23.401 [70].\nAfter reception of the IP address of a P‑CSCF the UE may initiate communication towards the IM CN Subsystem.\nE.1.2\tSupport for Enhanced Coverage for data centric UEs\nSupport for Enhanced Coverage (CE) for data centric UE is specified in TS 23.401 [70].\nIf the UE's usage setting is set to \"data centric\" as defined in TS 23.221 [7] and it is operating in CE mode B then IMS PS voice/video services are not to be used in this IP-CAN.\nIf the UE's usage setting is set to \"data centric\" and it is operating in CE mode B, then the UE shall reject any SIP invite for IMS PS voice/video services as per the existing IMS procedures. In addition, the UE may deregister from IMS PS voice/video services.\nWhen the UE determines that the radio conditions are suitable for IMS PS voice/video services (e.g. UE is in normal coverage or in CE mode A) then UE may (re-)register for IMS PS voice/video services.\nNOTE:\tHow UE determines that the radio conditions are suitable for voice/video services is left up to the UE implementation.\nE.2\tQoS related concepts\nE.2.1\tApplication Level Signalling for IMS\nE.2.1.0\tGeneral\nWhen the UE uses GERAN/UTRAN-access for IMS services, it shall be able to establish a dedicated signalling PDP-Context for IM CN Subsystem related signalling or utilize a general-purpose PDP context for IM Subsystem signalling traffic.\nWhen the UE uses E-UTRAN access for IMS services, it shall be able to request establishment of a default or dedicated EPS bearer for IM CN Subsystem related signalling.\nE.2.1.1\tQoS Requirements for Application Level Signalling\nIt shall be possible to request prioritised handling over the GERAN/UTRAN radio for IM CN Subsystem related signalling by including the Signalling Indication in the QoS IE of the PDP Context to be used for this traffic as described in clause E.2.1a.1.\nIt shall be possible to request prioritised handling over the E-UTRAN radio for IM CN Subsystem related signalling by including the appropriate QCI value for signalling traffic as specified in TS 23.203 [54], clause 6.1.7, Standardized QCI Characteristics, Table 6.1.7.\nE.2.1.2\tRequirements for IM CN subsystem signalling flag\nThe IM CN Subsystem Signalling flag is used to indicate the dedicated signalling PDP context for IMS signalling. If the network operator does not support a dedicated signalling PDP context or the UE does not include the IM CN Subsystem Signalling flag, the network will consider the PDP context as a general purpose PDP context.\nThe IM CN Subsystem Signalling flag is used to indicate EPS bearer dedicated for IMS signalling. If the network operator does not support a dedicated signalling EPS bearer or the UE does not include the IM CN Subsystem Signalling flag, the network will consider the EPS bearer as a default or dedicated bearer according to TS 23.401 [70].\nA PDP context/EPS bearer dedicated for IM CN Subsystem signalling provides dedicated IP-Connectivity Access Network bearers for IM CN subsystem signalling traffic, hence architectural requirements described in clause 4.2.6 for the usage of dedicated bearer resources shall be applied. The UE is not trusted to implement these restrictions, therefore the restrictions are enforced in the GGSN/P‑GW by the operator of the GGSN/P‑GW.\nIf the PDP context request/EPS bearer is initiated by the IP‑CAN, then the GGSN/P‑GW may provide a set of UL filters for the PDP context/EPS bearer used for IM CN Subsystem Signalling. The UL filters provide the UE with the rules and restrictions applied by the GGSN/P‑GW for the dedicated IM CN Subsystem signalling IP‑CAN bearer. The GGSN/P‑GW may in addition provide the IM CN subsystem signalling flag to explicitly indicate to the UE the intention of using the PDP context/EPS bearer for IM CN Subsystem related signalling.\nPolicy and Charging Control functionality can be used to provide additional charging capabilities for dedicated signalling PDP context/EPS bearer dedicated to be used for IMS signalling (as well as for a general-purpose PDP context) as described in clause 4.2.6.\nWhether the network is configured to support IM CN signalling flag or Policy and Charging Control functionality or both, is dependent on the operator configuration policy.\nThe requirements described above also apply in the case of E-UTRAN access and for GERAN/UTRAN access using EPS supporting dedicated bearer for IM CN Subsystem Signalling traffic and where appropriate filters are configured in the P‑GW and PCRF as applicable.\nE.2.1.3\tApplication Level Signalling support for IMS services\nIn order to receive different level of support for application level signalling in a PDP context/EPS bearer, the UE may choose one of the following options:\n-\tInclude both the IM CN Subsystem Signalling Flag in the PCO IE and the Signalling Indication in the QoS. This indicates to the network (radio & core) the requirement of using the PDP context/EPS bearer for application level signalling after it has been negotiated with the networks, to provide prioritised handling over the radio interface (as described in clause E.2.1.1), with rules and restrictions applied in the network (as described in clause E.2.1.2).\n-\tFor GERAN/UTRAN access the UE includes the IM CN Subsystem Signalling Flag in the PCO IE and the Signalling Indication in the QoS IE in the PDP context activation or the Secondary PDP context activation procedure.\n-\tFor E-UTRAN access the UE includes both the IM CN Signalling Flag in the PCO IE and the appropriate QCI value for signalling traffic in the UE Requested Bearer resource Modification procedure.\nNOTE 1:\tWhen the UE Requested Bearer Resource Modification procedure is used the IM CN Subsystem Signalling Flag in the PCO IE should be sufficient to trigger the network to provide UL packet filters to the UE, i.e. the UE is not required to provide any meaningful filter information related to the IMS signalling.\n-\tInclude the IM CN Subsystem Signalling Flag in the PCO IE in the PDP context activation or the Secondary PDP context activation procedure for GERAN/UTRAN access and for E-UTRAN access in the Attach, PDN Connectivity request or the UE requested bearer resource modification procedure. This indicates to the GPRS/EPS network the requirement of using PDP context/EPS bearer for application level signalling with restricted handling as described in clause E.2.1.2, after it has been negotiated with the networks.\nNOTE 2:\tIf the PDN connection is not limited to IMS based services only and the Default EPS bearer is used to support application level signalling for IMS, the UE request for establishment of a general purpose EPS bearer (i.e. a Dedicated non-GBR EPS bearer with a filter set appropriately for a general purpose EPS bearer) might be rejected by the network.\n-\tUtilize a general purpose PDP Context/default EPS bearer with a negotiated QoS profile (this includes the possibility of having the Signalling Indication in the QoS IE for GERAN/UTRAN and the QCI for E-UTRAN.\nIn the case of E-UTRAN access, when referring to the appropriate QCI for the signalling traffic, the functions described above are fulfilled as specified in TS 23.203 [54] using EPS bearers.\nThe IM CN Subsystem signalling flag is used to reference rules and restrictions on the PDP context/EPS bearer used for application level signalling, as described in clause E.2.2.\nThe Signalling Indication in the QoS IE or the appropriate QCI for signalling traffic provides prioritised handling over the radio interface. The Signalling Indication in the QoS IE is detailed in TS 23.107 [55] and clause E.2.1a.1 and the appropriate QCI for signalling traffic is detailed in TS 23.203 [54].\nDepending on the operator's policy, one or more of the above combinations may be allowed in the GPRS/EPS network.\nE.2.1a\tPDP context/EPS Bearer procedures for IMS\nE.2.1a.1\tEstablishing PDP Context/EPS bearer for IM CN Subsystem Related Signalling\nIt shall be possible for the UE to convey to the network the intention of using the PDP context/EPS bearer for IM Subsystem related signalling. For this purpose it uses the mechanism described in this clause and Application Level Signalling in clauses E.2.1.1, E.2.1.2 & E.2.1.3.\nWhen the bearer establishment is controlled or a bearer establishment is requested (in the case of EPS) by the UE, in order to establish a PDP context/EPS bearer for IM CN Subsystem related signalling, the UE shall be able to include the IM CN subsystem signalling flag in the PDP context activation/UE Requested Bearer Resource Modification procedure. This indicates to the network the intention of using the PDP context/EPS bearer for IM CN Subsystem related signalling.\nFor GERAN/UTRAN access:\nTo establish a PDP context for IM CN Subsystem related signalling with prioritised handling over the radio interface, the UE shall be able to set the Signalling Indication in the QoS IE in the PDP context activation procedure and the Secondary PDP context activation procedure. The Signalling indication in the QoS IE indicates to the radio and core networks the requirement for enhanced handling over the radio interface, once it has been negotiated with the networks.\nA request for a general purpose PDP context having the \"signalling indication\" within the QoS IE may be accepted or downgraded according to operator policy configured at the GGSN using the usual QoS negotiation mechanisms described in TS 23.060 [23]. It shall not be possible to modify a general purpose PDP context into a dedicated PDP context for IM CN Subsystem related signalling and vice versa.\nFor E-UTRAN access:\nThe (default or dedicated) EPS bearer for IMS signalling may be established from network side at Attach/UE Requested PDN connectivity Request time, in which case the appropriate QCI for signalling traffic and the packet filters will provide the necessary QoS and any restrictions applicable on packets sent over this EPS bearer.\nA request for an EPS bearer having the appropriate QCI for signalling traffic according to TS 23.203 [54], may be either accepted or rejected according to operator policy configured at the P‑GW i.e. there is no QoS negotiation mechanism used in EPS.\nIn order to establish a Dedicated EPS bearer for IM CN Subsystem related signalling, the UE shall be able to request the appropriate QCI for signalling traffic as specified in TS 23.203 [54] in the UE Requested Bearer Resource Modification procedure. This indicates to the radio and core network the requirement for enhanced handling over the radio interface, once it has been accepted by the network. It shall not be possible to modify an existing EPS bearer in order to convert it to be dedicated for IM CN Subsystem related signalling and vice versa.\nFor all 3GPP accesses:\nThe IM CN Signalling Flag in the PCO IE is used to reference rules and restrictions on the PDP context/EPS bearer used for application level signalling, as described in clause 4.2.6. Based on operator policy the \"Signalling Indication\" in the QoS IE or the appropriate QCI for signalling traffic may be allowed only if the \"IM CN Subsystem Signalling\" flag is present in the PCO IE.\nThe IM CN subsystem signalling flag and the Signalling Indication in the QoS IE or the appropriate QCI for signalling traffic may be used independently of each other.\nE.2.1a.2\tDeletion of PDP Context/EPS bearer used to transport IMS SIP signalling\nIf the GPRS subsystem deletes the PDP Context used to transport IMS SIP signalling, then according to clause 5.10.3.0 the UE or GGSN shall initiate a procedure to re-establish (or modify where possible) a PDP Context for IMS signalling transport. If there are any IMS related PDP contexts active, the re-establishment of the PDP context to transport IMS signalling shall be performed by using the Secondary PDP Context Activation Procedure (or the Network Requested Secondary PDP Context Activation Procedure if initiated by the GGSN) as defined in TS 23.060 [23].\nIf the EPC system deletes the Dedicated EPS bearer used to transport IMS SIP signalling, then according to clause 5.10.3.0 the UE or PDN Gateway shall initiate a procedure to re-establish (or modify where possible) an EPS bearer for IMS signalling transport. If there are any IMS related EPS bearers active, the re-establishment of the EPS bearer to transport IMS signalling shall be performed by the UE using the UE Requested Bearer Resource Modification procedure or the PDN Gateway using the Dedicated bearer activation procedure as defined in TS 23.401 [70].\nThe failure in re-establishing the ability to communicate towards the UE results also in the P‑CSCF/PCRF being informed that the IMS SIP signalling transport to the UE is no longer possible which shall lead to a network initiated session release (initiated by the P‑CSCF) as described in clause 5.10.3.1 if any IMS related session is still ongoing for that UE. Additionally, the P‑CSCF shall reject subsequent incoming session requests towards the remote endpoint indicating that the user is not reachable, until either:\n-\tthe registration timer expires in P‑CSCF and the user is de-registered from IMS;\n-\ta new Register message from the UE is received providing an indication to the P‑CSCF that the PDP Context/EPS bearer used for IMS SIP Signalling transport for that user has become available again and session requests can be handled again.\nE.2.2\tThe QoS requirements for an IM CN subsystem session\nE.2.2.0\tGeneral\nThe selection, deployment, initiation and termination of QoS signalling and resource allocation shall consider:\n-\tthe general requirements described in clause 4.2.5.\nfor E-UTRAN access, the QoS handling is described in TS 23.401 [70], TS 23.203 [54].\n-\tfor GERAN/UTRAN access, the requirements described in this clause so as to guarantee the QoS requirement associated with an IM CN subsystem session for IMS services.\n1.\tQoS Signalling at Different Bearer Service Control Levels\nDuring the session set-up in a IM CN subsystem, at least two levels of QoS signalling/negotiation and resource allocation should be included in selecting and setting up an appropriate bearer for the session:\na.\tThe QoS signalling/negotiation and resource allocation at the IP Bearer Service (BS) Level:\nThe QoS signalling and control at IP BS level is to pass and map the QoS requirements at the IP Multimedia application level to the UMTS BS level and performs any required end-to-end QoS signalling by inter-working with the external network. The IP BS Manager at the UE and the GGSN is the functional entity to process the QoS signalling at the IP BS level.\nb.\tThe QoS signalling/negotiation and resource allocation at the UMTS Bearer Service Level:\nThe QoS signalling at the UMTS BS Level is to deliver the QoS requirements from the UE (received from the GGSN in the case of IP‑CAN Bearer Control) to the RAN, the CN, and the IP BS manager, where appropriate QoS negotiation and resource allocation are activated accordingly. When UMTS QoS negotiation mechanisms are used to negotiate end-to-end QoS, the translation function in the GGSN shall co-ordinate resource allocation between UMTS BS Manager and the IP BS Manager.\nInteractions (QoS class selection, mapping, translation as well as reporting of resource allocation) between the QoS signalling/control at the IP BS Level and the UMTS BS Level take place at the UE and the GGSN which also serve as the interaction points between the IM CN subsystem session control and the UMTS Bearer QoS control.\nUMTS specific QoS signalling, negotiation and resource allocation mechanisms (e.g. RAB QoS negotiation and PDP Context set-up) shall be used at the UMTS BS Level. Other QoS signalling mechanisms such as RSVP at the IP BS Level shall only be used at the IP BS Level.\nIt shall be possible to negotiate a single resource allocation at the UMTS Bearer Service Level and utilise it for multiple sessions at the IP Bearer Service Level.\nE.2.2.1\tRelation of IMS media components and PDP contexts/EPS bearers carrying IMS media\nAll associated media flows (such as e.g. RTP / RTCP flows) used by the UE to support a single media component are assumed to be carried within the same PDP context/EPS bearer.\nE.2.3\tInteraction between GPRS/EPS QoS and session signalling\nE.2.3.0\tGeneral\nThe generic mechanisms for interaction between QoS and session signalling are described in clause 5.4.7, the mechanisms described there are applicable to GERAN/UTRAN/E-UTRAN-accesses as well.\nThis clause describes the GERAN/UTRAN/E-UTRAN-access-specific concepts.\nAt PDP context/EPS bearer setup the user shall have access to either GPRS/EPS without Policy and Charging Control, or GPRS/EPS with Policy and Charging Control. The GGSN/P‑GW shall determine the need for Policy and Charging Control, possibly based on provisioning and/or based on the APN of the PDN connection.\nFor the GPRS/EPS without Policy and Charging Control case, the bearer is established according to the user's subscription, local operator's IP bearer resource based policy, local operator's admission control function and GPRS/EPS roaming agreements.\nFor the GPRS/EPS with Policy and Charging Control case, policy decisions (e.g. authorization and control) are also applied to the bearer.\nThe GGSN/P‑GW contains a Policy and Charging Enforcement Function (PCEF).\nE.2.3.1\tResource Reservation with Policy and Charging Control\nDepending on the Bearer Control Mode, as defined in TS 23.060 [23], selected for the GPRS IP‑CAN session, resource reservation shall be initiated either by the UE or by the IP‑CAN itself. IMS media which require resource reservation is always mapped to a dedicated bearer, i.e. a dedicated EPS bearer or a PDP context activated using the Secondary PDP Context Activation Procedure. For IP‑CAN initiated resource reservation, the PCRF has the responsibility to ensure that a dedicated bearer is used for media which require resource reservation.\nFor GERAN/UTRAN the UE initiates the activation or the modification of an existing PDP Context for the media parameters negotiated over SDP using the procedures for Secondary PDP-Context Activation and MS-Initiated PDP Context Modification respectively as defined in TS 23.060 [23] subject to policy control.\nOtherwise, the GGSN/P‑GW within the GPRS IP‑CAN initiates the activation or the modification of an existing PDP Context for the media parameters negotiated over SDP using the procedures for Network Requested Secondary PDP Context Activation and GGSN/P‑GW-Initiated PDP Context Modification respectively as defined in TS 23.060 [23].\nFor E-UTRAN, the UE initiates the resource reservation request for the media parameters negotiated over SDP using procedure UE Requested Bearer Resource Modification procedure as defined in TS 23.401 [70] subject to policy control.\nOtherwise, the P‑GW within the EPS IP‑CAN initiates the activation or the modification of an existing Dedicated EPS bearer for the media parameters negotiated over SDP using the procedures for Dedicated bearer activation and PDN GW initiated bearer modification with or without bearer QoS update as specified in TS 23.401 [70].\nThe request for GPRS/EPS QoS resources may be signalled independently from the request for IP QoS resources by the UE. At the GPRS/EPS BS Level, the PDP Context activation / UE Requested Bearer Resource Modification shall be used by the UE for QoS signalling. At the IP BS Level, RSVP may be used for QoS signalling.\nE.2.4\tNetwork initiated session release - P‑CSCF initiated\nE.2.4.0\tGeneral\nIn the event of loss of coverage for GERAN/UTRAN access, TS 23.060 [23] defines the Iu or RAB Release procedures. In the case of PDP context/EPS bearer with streaming or conversational class the maximum bitrate of the GTP tunnel between SGSN and GGSN or between SGSN and S‑GW/P‑GW is modified to 0 kbit/s in up- and downlink direction. This is indicated to the P‑CSCF/PCRF by performing an IP‑CAN session modification procedure (see TS 23.203 [54]) as shown in Figure E.3. This procedure also applies to PDP Contexts/EPS bearer used for IMS SIP Signalling transport. For loss of coverage in the case of other PDP contexts/EPS bearer (background or interactive traffic class), the PDP context/EPS bearer is preserved with no modifications and therefore no indication to the P‑CSCF/PCRF.\nIn the event of loss of coverage for E-UTRAN access, TS 23.401 [70] defines the S1 release Procedure. This procedure releases the EPS bearers. This is indicated to the P‑CSCF/PCRF by performing an IP‑CAN session modification procedure (see TS 23.203 [54]) as shown in figure E.3. The UE will become aware of the release of the GBR bearer the next time it accesses the E-UTRAN network via the procedures as described in the clauses 5.3.3 and 5.3.4 of TS 23.401 [70].\nE.2.4.1\tNetwork initiated session release - P‑CSCF initiated after loss of radio coverage\nFigure E.3: Network initiated session release - P‑CSCF initiated after loss of radio coverage\n1.\tIn the case of GERAN/UTRAN access, in the event of loss of radio coverage for a PDP context with streaming or conversational class the maximum bitrate of the GTP tunnel between SGSN and GGSN and between SGSN and S‑GW /P‑GW is modified to 0 kbit/s in up- and downlink direction. The P‑CSCF/PCRF receives an indication of PDP context/EPS bearer modification or EPS bearer removal. This also applies to PDP Contexts/EPS bearer used for IMS SIP Signalling transport.\nIn the case of E-UTRAN access, loss of radio coverage causes the GBR bearers to be released in the network and P‑CSCF/PCRF is notified appropriately.\n2.\tIt is optional for the P‑CSCF/PCRF to deactivate the affected bearer and additional IP bearers (e.g. an IP bearer for chat could still be allowed). If the P‑CSCF decides to terminate the session then the P‑CSCF/PCRF removes the authorization for resources that had previously been issued for this endpoint for this session (see TS 23.203 [54]).\n3.\tThe P‑CSCF decides on the termination of the session. In the event of the notification that the signalling transport to the UE is no longer possible, the P‑CSCF shall terminate any ongoing session with that specific UE. If the P‑CSCF decides to terminate the session then the P‑CSCF/PCRF removes the authorization for resources that had previously been issued for this endpoint for this session. (see TS 23.203 [54]).\nThe following steps are only performed if the P‑CSCF/PCRF has decided to terminate the session.\nWhen receiving an indication that bearer resources are not available for a voice media negotiated in a multimedia session that is in pre-alerting phase e.g. due to weak E-UTRAN coverage, the P-CSCF performs the procedures according to clause 6.2.1.3a or clause 6.2.2.3a in TS 23.237 [67].\n4.\tThe P‑CSCF generates a Hangup (Bye message in SIP) to the S‑CSCF of the releasing party.\n5.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n6.\tThe S‑CSCF of the releasing party forwards the Hangup to the S‑CSCF of the other party.\n7.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session.\n8.\tThe S‑CSCF of the other party forwards the Hangup on to the P‑CSCF.\n9.\tThe P‑CSCF/PCRF removes the authorization for resources that had previously been issued for this endpoint for this session. This step also results in a release indication to the GPRS/EPS system to confirm that the IP bearers associated with the session have been deleted for UE#2.\n10.\tThe P‑CSCF forwards the Hangup on to the UE.\n11.\tThe UE responds with an acknowledgement, the SIP OK message (number 200), which is sent back to the P‑CSCF.\n12.\tThe IP network resources that had been reserved for the message receive path to the UE for this session are now released. Depending on the Bearer Control Mode selected for the IP‑CAN session, the release of previously reserved resources shall be initiated either by the UE or by the IP‑CAN itself. The UE initiates the release of the IP‑CAN bearer resources as shown in figure E.3. Steps 12 and 13 may be done in parallel with step 11. Otherwise, the GGSN/P‑GW within the GPRS/EPS IP‑CAN initiates the release of the bearer PDP context/EPS bearer deactivation after step 9 instead.\n13.\tThe GPRS/EPS system releases the PDP context/EPS bearer. The IP network resources that had been reserved for the message receive path to the UE for this session are now released. This is initiated from the GGSN/P‑GW. If RSVP was used to allocated resources, then the appropriate release messages for that protocol would invoked here.\n14.\tThe SIP OK message is sent to the S‑CSCF.\n15.\tThe S‑CSCF of the other party forwards the OK to the S‑CSCF of the releasing party.\n16.\tThe S‑CSCF of the releasing party forwards the OK to the P‑CSCF of the releasing party.\nE.3\tAddress and identity management concepts\nE.3.1\tDeriving IMS identifiers from the USIM\nIf the UICC does not contain an ISIM application, then:\nThe Private User Identity shall be derived from the USIM's IMSI, which allows for uniquely identifying the user within the 3GPP operator's network. The format of the Private User Identity derived from the IMSI is specified in TS 23.003 [24].\n-\tA Temporary Public User Identity shall be derived from the USIM's IMSI, and shall be used in SIP registration procedures. The format of the Temporary Public User Identity is specified in TS 23.003 [24].\nIt is strongly recommended that the Temporary Public User Identity is set to barred for SIP non-registration procedures. The following applies if the Temporary Public User Identity is barred:\n-\tA Temporary Public User Identity shall not be displayed to the user and shall not be used for public usage such as displaying on a business card.\n-\tThe Temporary Public User Identity shall only be used during the SIP initial registration, re-registration and mobile initiated de-registration procedures.\n-\tThe implicitly registered Public User Identities shall be used for session handling, in non-registration SIP messages and may be used at subsequent SIP registration procedures.\n-\tA Temporary Public User Identity shall only be available to the CSCF and HSS nodes.\nNOTE:\tIf a Temporary Public User Identity is used, the user can not initiate any sessions until the implicitly registered public identities are available in the UE.\nIn order to support a pre-Rel‑5 UICC accessing IMS services, a Temporary Public User Identity is generated using an appropriate identity related to the subscriber's subscription (e.g. in 3GPP it shall use the IMSI).\nWhen a Temporary Public User Identity has been used to register an IMS user, the implicit registration will ensure that the UE, P‑CSCF & S‑CSCF have Public User Identity(s) for all IMS procedures after the initial registration has been completed.\nE.4\tVoid\nE.5\tIP version interworking in IMS\nA PDP context & its associated additional PDP contexts (i.e. PDP contexts associated to the same IP address/prefix) support either PDP type IPv4 or IPv6 or IPv4v6. For communication with the IMS, the UE establishes an IPv4 PDN connection or an IPv6 PDN connection or an IPv4IPv6 PDN connection via PDP contexts/EPS bearers. Termination of this PDP context/EPS bearer will normally trigger de-registration of IMS application first. Hence, the PDP context/EPS bearer that has been established for IMS communication must be retained for the UE to establish a SIP session via the IMS with an IPv4 SIP client.\nAs such, any interworking on IP version on the application level (i.e. IMS & SIP) need to work with the architecture requirement from GPRS/EPS of maintaining the IP connectivity over GPRS/EPS by maintaining the PDP contexts/EPS bearers.\nFor IMS perspective, a user may be connected either to a home GGSN/P‑GW or a visited GGSN/P‑GW depending on the configuration as specified in TS 23.221 [7].\nE.6\tUsage of NAT in GPRS/EPS\nThere should be no NAT (or its existence should be kept transparent towards the UE) located between the GGSN/P‑GW and the P‑CSCF, which is possible as they are either located within the same private network and share same address space, or both the UE and the P‑CSCF are assigned globally unique IP addresses (see Annex M).\nNOTE:\tIf the UE discover a NAT between the UE and the P‑CSCF, the UE might send frequent keep-alive messages and that may drain the UE battery.\nE.7\tRetrieval of Network Provided Location Information in GPRS/EPS\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements (e.g. data retention, lawful interception) and/or in order to enable certain types of added value services based on the user's location.\nDepending on usage scenario, the following mechanisms are defined and can be used to retrieve the user location and/or UE Time Zone information from the access network when using GPRS and/or EPS to access IMS:\n-\tThe P‑CSCF can retrieve the user location and/or UE Time Zone information using PCC mechanisms as specified in TS 23.203 [54] and in TS 29.214 [11]. Operator policy determines whether to provide the user location and/or UE Time Zone information from the access network in the INVITE request, a MESSAGE request, or within a subsequent message of the dialog.\n-\tWhen the user location and/or UE Time Zone information is required from the access network but not already available (e.g. when required in an INVITE request, when it is needed prior to session delivery, or when call is broken out to a MGCF), an IMS AS can trigger the retrieval of the user location and/or UE Time Zone information from the SGSN/MME via the HSS as specified in TS 29.328 [79] and as described in clause 4.2.4a.\nOperator policies at P-CSCF and IMS AS need to be coordinated in order to ensure that the appropriate method to retrieve the user location and/or UE Time Zone information is used for specific scenarios according to operator's preferences. The IMS entity that retrieves the user location and/or UE Time Zone information shall have the capability to further distribute the information to other IMS entities once it has been retrieved. User location and/or UE Time Zone information provided in the signalling by the network shall be possible to distinguish from user location information provided by the UE. The transfer of the user location and/or UE Time Zone information within IMS signalling shall not affect the transfer of any UE provided user location information. Information flows on how user location and/or UE Time Zone information can be further distributed within IMS depending on the alternative mechanism used can be found in Annex R.\nThe level of granularity of user location information may be changed at network/trust boundaries. Thus, the level of user location information granularity that can be retrieved by an IMS AS via the HSS-based procedures in roaming scenarios depends on inter-operator agreement, and needs to be aligned with policies in the P-CSCF.\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements for SMS over IP. The P-CSCF applies the above mechanisms upon reception of a MESSAGE including the distribution of received information to other IMS entities.\nE.8\tGeographical Identifier\nThe Geographical Identifier identifies a geographical area within a country or territory. It may be described in a geospatial manner (e.g. geodetic coordinates) within a country or territory or as civic user location information (e.g. a postcode, area code, etc.), or use an operator-specific format. It is assumed that a given cell cannot belong to more than one area identified by a Geographical Identifier.\nA network which requires the Geographical Identifier to be generated in the IMS may implement a mapping table between an (E)CGI (received as part of Access Network Information) and a Geographical Identifier. The P-CSCF or an IMS AS may then, based on operator policy, use this mapping table to convert the user location into a Geographical Identifier, and insert the Geographical Identifier in the SIP signalling, thus enabling routing decision in downstream IMS entities or interconnected network.\nE.9\tSupport for Paging policy differentiation for IMS services\nAs a network configuration option, where P-CSCF and P‑GW are located in the same PLMN, it shall be possible for the P-CSCF for terminating signalling to identify conversational voice as defined in IMS multimedia telephony service, TS 22.173 [53].\nNOTE 1:\tThis feature may be extended for other IMS services if so desired as long as the same principles are reused.\nP-CSCF may support Paging Policy Differentiation (as defined in TS 23.401 [70]) for a specific IMS service by marking packet(s) to be send towards the UE related to that IMS service. For such an IMS service, a specific DSCP (IPv4) value and/or a specific Traffic Class (IPv6) value are assigned by local configuration in the P-CSCF.\nNOTE 2:\tThe packet marking used for Paging Policy Differentiation can also be used for determination of the Paging Cause, for the Multi-USIM UE support, by the relevant EPS node.\nWhen Paging Policy Differentiation is deployed in a PLMN, all P-CSCF entities of that PLMN shall homogeneously support it and shall be configured with the same policy for setting the specific DSCP (IPv4) and/or Traffic Class (IPv6) values used by P-CSCF for that feature.\nNOTE 3:\tIt is assumed that the DSCP / Traffic Class header is not rewritten by intermediate routers between the P-CSCF and the P‑GW.\nE.10\tSupport of RAN Assisted Codec Adaptation\nRAN assisted codec adaptation is a functionality that assists codec rate adaptation for Multimedia Telephony based on access network bitrate recommendation (ANBR) messages that the UE receives in the access stratum of the 3GPP access network (E-UTRA RAT). The functionality is defined in TS 26.114 [76] and affects the following system entities: UE, RAN, P-CSCF and PCRF/PCF.\nDuring SIP registration or emergency registration if the network supports ANBR as specified in TS 26.114 [76] and RAN-assisted codec adaptation as specified in TS 36.300 [99] and TS 36.321 [100], the P-CSCF indicates 'anbr' support to the UE.\nNOTE:\tWhen IMS services are provided in deployments with home routed traffic a supporting P-CSCF does not indicate its capability to handle the 'anbr' SDP attribute unless it is configured to know that the roaming partner supports RAN assisted codec adaptation with access network bitrate recommendation.\nAs specified in TS 26.114 [76]:\n-\tsupport for RAN assisted codec adaptation can be used only if it is supported end-to-end.\n-\tsupport for RAN assisted codec adaptation is assumed to be homogeneous in a PLMN i.e. all affected system entities in a PLMN including equivalent PLMNs need to support it. RAN support is required on E-UTRA.\n-\tthe UE includes the 'anbr' attribute in the SDP offer only if the P-CSCF has indicated its ability to handle it.\n-\tthe P-CSCF forwards the 'anbr' attribute if it has received it in the SDP offer from the UE.\n-\twhen the 'anbr' attribute is successfully negotiated end-to-end, the PCRF/PCF uses MBR>GBR setting for the corresponding IP-CAN bearer relying on RAN assisted codec adaptation.\nA UE supporting Multimedia Telephony and RAN assisted codec adaptation shall support the procedures described in TS 26.114 [76].\nAnnex F (informative):Routing subsequent requests through the S‑CSCF\nThis annex provides some background information related to clause 5.4.5.3.\nThe S‑CSCF is the focal point of home control. It guarantees operator control over sessions. Therefore IMS has been designed to guarantee that all initial session signalling requests goes through the Home S‑CSCF on both terminating and originating side. A number of tasks performed by the S‑CSCF are performed either at registration time or immediately during session set-up, e.g. evaluation of initial filter criteria. However, there are tasks of the S‑CSCF, which require the presence of the S‑CSCF in the signalling path afterwards:\n-\tMedia parameter control: If the S‑CSCF finds media parameters that local policy or the user's subscriber profile does not allow to be used within an IMS session, it informs the originator. This requires record-routing in the S‑CSCF. For example, change of media parameters using UPDATE would by-pass a S‑CSCF, which does not record-route.\n-\tCDR generation: The S‑CSCF generates CDRs, which are used for offline charging and for statistical purposes. A S‑CSCF, which does not record-route, would not even be aware of session termination. If the CDRs at the S‑CSCF are needed, then the S‑CSCF must record-route.\n-\tNetwork initiated session release: The S‑CSCF may generate a network-initiated session release, e.g. for administrative reasons. For that purpose a S‑CSCF needs to be aware of ongoing sessions. In particular it must be aware of hard state dialogs that are required to be terminated by an explicit SIP request.\n-\tIf a UE registered to the S‑CSCF uses a Globally Routable User Agent URI (GRUU) assigned by the S‑CSCF as a contact address when establishing a dialog, then the S‑CSCF needs to remain in the signalling path in order to translate mid-dialog requests addressed to that contact address.\nThe above criteria are particularly important for \"multimedia telephony\" type peer-to-peer communication.\n-\tMedia parameter control guarantees that the user does not use services he or she did not pay for.\n-\tFor telephony type services the session charging component is the most important one.\n-\tIf a subscriber is administratively blocked, the network shall have the possibility to terminate ongoing communication.\nMore generally, all the tasks are needed; thus they need to be provided elsewhere if the S‑CSCF does not record-route.\nOn the other hand there are client-server based services, which may be offered by the home operator. An example of such service available today where the no record route principle is applied, is Presence, where notifications need not go through the S‑CSCF. Another example could be where the UE initiates a session to an Application Server (AS) in the home operator's domain, e.g. video download. In such cases:\n-\tThe server implementation (or the server's knowledge of user subscription data) may limit the allowed media parameters.\n-\tCharging will be mostly event-based charging (content charging) and depends on the information provided from the AS.\n-\tThe AS can terminate sessions. And the dialogs may be soft state dialogs, which are not required to be terminated by an explicit SIP request (e.g. SUBSCRIBE dialogs).However not in all cases the AS would receive the necessary information, which usually triggers session release (e.g. for administrative reasons).\nThus, for some client-server based services, it might not be necessary to keep the S‑CSCF in the path. It may be desirable for an operator to avoid the load in the S‑CSCF and control the service from the AS. For such services \"no record-routing in S‑CSCF\" may be configured together with the initial filter criteria, as defined in clause 5.4.5.3.\nAnnex G (normative):Reference Architecture and procedures when the NAT is invoked between the UE and the IMS domain\nG.1\tGeneral\nThis clause specifies concepts of IMS service provisioning for the following scenarios:\n1.\tWhen a device or devices that perform address and/or port translation are located between the UE and the P‑CSCF performing translation both of signalling and media packets.\n2.\tWhen IP address and/or port translation is needed between the IP‑CAN and the IMS domain (e.g. different IP versions) on the media path only. This scenario covers the case when a device or devices that perform address and/or port translation are located on the media path only.\nThe IP address and/or port translation device can be a NAT or a NAPT as defined in IETF RFC 2663 [34]. Another type of translation is NA(P)T‑PT as specified in IETF RFC 2766 [33]. In the rest of this clause NAT will be used for all of the devices that perform one or more of NA(P)T and NA(P)T‑PT functions.\nNote that the procedures of this Annex shall only be applied when they are necessary. If the terminal and/or the access network provide a transparent way of NAT traversal or no IP address translation is needed between the IP‑CAN and the IMS domain on the media path then the function as defined in this Annex shall not be invoked.\nIt is expected the NAT traversal methods of this Annex will co-exist. UE may support one or more of these methods. It shall be possible for an operator to use one or more of NAT traversal methods in its IMS domain. The selection of the method for a particular case shall depend on the UE's capabilities, the capabilities of the network and policies of the operator.\nWhere possible, usage of these procedures shall not adversely impact usage of power saving modes in the UEs, i.e. when the NAT is integrated with the IMS Access Gate way which is under operator control, the reserved temporary addresses and port (binding) should be retained without requiring keep-alive messages from the UE. If the access type to IMS is GPRS, then the UE is not required to initiate any keep-alive messages, see clause E.6 for more information.\nNOTE:\tA solution to allow power saving modes when non-operator controlled NATs are used is not defined in this version of the specification.\nG.1.1\tGeneral requirements\nThe following list contains requirements that a NAT Traversal solution should satisfy:\n-\tSupport multiple UEs (on one or more devices) behind a single NAT;\n-\tSupport both inbound and outbound requests to and from UEs through one or more NAT device(s);\n-\tSupport the traversal of NATs between the UE and the IMS CN;\n-\tSupport uni-directional and bi-directional media flows;\n-\tMinimize additional session setup delay.\nG.2\tReference models\nThis clause describes various reference models which can be used for NAT traversal.\nG.2.1\tIMS-ALG and IMS Access Gateway model\nFigure G.1 presents the general reference model for IMS access when both the signalling and media traverses NAT devices. Figure G.2 presents the general reference model when IP address translation is needed between the IP‑CAN and the IMS domain. The IMS network architecture is the same for both cases. The NAT integrated with the IMS Access Gateway is under operator control in this reference model.\nFigure G.1: Reference model for IMS access when both the signalling and media traverses NAT\nFigure G.2: Reference model for IMS access when NAT is needed between the IP‑CAN and the IMS domain\nG.2.2\tICE and Outbound reference model\nFigure G.2a presents the general reference model for IMS access when both the signalling and media traverses NAT devices. Functional elements with dashed lines represent optional functionality. The transport of the Gm signalling is also subject to the policy enforcement.\nFigure G.2a: Reference model for ICE and Outbound Methodology\nThe STUN Function shown within the P‑CSCF is a limited STUN Server for supporting STUN keep-alive messages as described in clause G.5.3.2.\nFor deployments where the IMS Access gateway (or other media manipulating functional entities, such as a MRFP, are used (see clause G.2.1), such functional entities shall be placed on the network side of the STUN server and STUN relay server (i.e. not between the UE and the STUN server or STUN relay server) as shown in figure G.2a. Otherwise they will prevent STUN messages from reaching the STUN Relay/Server outside of a session.\nG.3\tNetwork elements for employing the IMS-ALG and IMS Access Gateway\nG.3.1\tRequired functions of the P‑CSCF\nWhen supporting IMS communication for a UE residing behind a NAT or when IP address translation is needed between the IP‑CAN and the IMS domain on the media path only, the P‑CSCF may include the IMS-ALG function that is defined in Annex I of this specification. The following functions shall be performed in the P‑CSCF:\n1)\tThe P‑CSCF shall be able to recognize that the UE is behind a NAT device or IP address translation is needed between the IP‑CAN and the IMS domain on the media path only.\n2)\tThe IMS-ALG function in the P‑CSCF shall control the IMS Access Gateway, e.g. request transport addresses (IP addresses and port numbers) from the IMS Access Gateway, and shall perform the necessary changes of the SDP parameters.\n3)\tThe IMS-ALG function in the P‑CSCF shall perform the necessary changes of headers in SIP messages.\n4)\tThe IMS-ALG function in the P‑CSCF shall be able to support scenarios where IMS CN domain and IP‑CAN use the same IP version and where they use different IP versions.\n5)\tThe IMS-ALG function in the P-CSCF shall be able to request opening and closing of gates on the IMS Access Gateway.\n6)\tThe IMS-ALG function in the P-CSCF may configure the IMS Access Gateway to police the remote source address/port of the associated media flow(s).\n7)\tThe IMS-ALG function in the P-CSCF may configure the IMS Access Gateway to police the bandwidth/data rate of the associated media flow(s) (see TS 23.333 [73]).\n8)\tThe IMS-ALG may configure the IMS Access Gateway to set the differentiated service code point for egress packets to an explicit value or alternately to allow the differentiated service code point of the ingress packet to be copied into the corresponding egress packet. An IMS Access Gateway can also support differentiated service code point marking based on local configuration.\n9)\tThe IMS-ALG may request an IMS Access Gateway to detect and report inactive media flows.\nG.3.2\tRequired functions of the IMS Access Gateway\nThe required functions of the IMS Access Gateway for NAT translation are the following:\n1)\tIt allocates and releases transport addresses according to the requests coming from the IMS-ALG function of the P‑CSCF.\n2)\tIt ensures proper forwarding of media packets coming from or going to the UE.\n3)\tIt shall support the scenarios where IMS CN domain and IP‑CAN use the same IP version and where they use different IP versions.\n4)\tIt shall support opening and closing of gates, under control of the IMS-ALG.\n5)\tIt shall support policing of the remote source address/port and bandwidth/data rate of media flows, as configured by the IMS-ALG.\n6)\tIt shall support the setting of the differentiated service code point for egress packets as configured by the IMS-ALG or else based on local configuration.\n7)\tIt may support detection and reporting of inactive media flows.\n8)\tIt shall support remote NAT traversal.\nG.3.3\tIq reference point\nThe Iq reference point is between the P‑CSCF and the IMS Access Gateway. It conveys the information necessary for the IMS-ALG to activate the procedures defined in clause G.3.2. Those procedures are further detailed in TS 23.334 [74].\nG.4\tProcedures for employing the IMS-ALG and IMS Access Gateway\nG.4.1\tGeneral\nThe procedures described in this clause are applied in addition to the procedures of the P‑CSCF described in the other clauses of this specification.\nG.4.2\tNAT detection in P‑CSCF\nWhen supporting the IMS-ALG function, the P‑CSCF, based on information received in a SIP request message (e.g. a REGISTER request), shall detect if there is NAT between the UE and itself and shall make a decision if IMS-ALG function shall be invoked for the session of subscriber. In addition to when a NAT is detected between the UE and the P‑CSCF, the IMS-ALG function may be invoked for other reasons (e.g. UEs using IP address from a Private IP address range).\nG.4.3\tSession establishment procedure\nThis procedure is applied when P‑CSCF invokes the IMS-ALG function for a session. This can happen at terminating side if the called party is behind a NAT or at the originating side if the session initiator is behind a NAT. Both cases are handled in the P‑CSCF and the IMS Access Gateway as described in this clause.\nFigure G.3: Session establishment procedure with NAT traversal\nNOTE 1:\tIn figure G.3 if UE_A belongs to the P‑CSCF (originating case) then there will be IMS elements, i.e. CSCFs, between the P‑CSCF and UE_B. If UE_B belongs to the P‑CSCF (terminating case) then there will be IMS elements, i.e. CSCFs, between the P‑CSCF and UE_A.\nNOTE 2:\tThe Transport address refers to both the IP address and Ports (see definition in clause 3.1).\n1)\tThe P‑CSCF receives a SIP message with an SDP offer from UE_A and decides to invoke the IMS-ALG function for this session. The session can either an originating or a terminating session. The SDP offer contains the transport address(es) of UE_A where the media flow(s) should be sent.\n2)\tThe P‑CSCF requests a transport address for each media flow from the IMS Access Gateway. Each request contains sufficient information to determine the side of the IMS access gateway that the transport request is being requested for. (e.g. local or remote side with respect to UE_A).\n3)\tThe IMS Access Gateway reserves one of its transport addresses for the given side of the media flow and this transport address is sent back to the P‑CSCF. The IMS Access Gateway shall keep the reserved temporary transport address (binding) until the session is released.\n4)\tThe P‑CSCF changes the original transport address(es) of the SDP offer to the transport address(es) received from the IMS Access Gateway.\n5)\tThe P‑CSCF forwards the SIP message with the modified SDP offer according to the normal routing procedures.\n6)\tUE_B sends back a SIP message with an SDP answer, which is forwarded to the P‑CSCF according to the normal SIP message routing procedures.\n7)\tThe P‑CSCF requests a transport address for each media flow in the routing domain of its own IMS network from the IMS Access Gateway. The request contains sufficient information to correlate to the transport address request performed in step 2.\nNOTE:\tIf some of the offered media flows are rejected in the answer, then the P‑CSCF shall indicate this to the IMS Access Gateway. The IMS Access Gateway can release the resources (e.g. the transport address) reserved for that media flow. The P‑CSCF may indicate directly to release the resources.\n8)\tThe IMS Access Gateway reserves one of its transport addresses for the given side of the media flow and this transport address is sent back to the P‑CSCF.\n9)\tThe P‑CSCF changes the original transport address(es) of the SDP answer to the transport address(es) received from the IMS Access Gateway.\n10)\tThe P‑CSCF forwards the SIP message with the modified SDP answer according to the normal SIP message routing procedures.\nG.4.4\tSession release procedure\nThis procedure is applied when a session has to be released, for which the IMS-ALG function is invoked.\nFigure G.4: Session release procedure with NAT traversal\n1)\tThe P‑CSCF receives a trigger to release a session, for which the IMS-ALG function is invoked.\n2)\tThe P‑CSCF sends an indication to the IMS Access Gateway for each media flow of the session that the resources allocated during the session establishment procedures are to be released.\n3)\tThe IMS Access Gateway releases its resources allocated for the given media flows.\nG.4.5\tSession modification\nA session modification can cause the creation, and/or modification, and/or release of media flows.\nWhen a new media flow is created the procedure used during session establishment shall be applied.\nWhen an existing media flow is released the procedure for session termination shall be applied for the particular media flow.\nWhen an existing media flow is modified, this may lead to a modification of the media flow directly, or to the establishment of a new media flow and release of the existing one.\nG.4.6\tMedia forwarding in the IMS Access Gateway\nThis clause presents the media forwarding performed by the IMS Access Gateway. The behaviour presented in this clause is valid in both directions.\nFigure G.5: Packet forwarding in the IMS Access Gateway\n1)\tUE_A sends a media packet to the transport address of the IMS Access Gateway that was received during the session establishment/modification.\n2)\tAfter receiving the media packet the IMS Access Gateway recognizes the media flow based on the transport address where the packet arrived at. The IMS Access Gateway changes the source transport address to its own transport address that was given to the UE_B as the destination transport address during session establishment/modification and the destination transport address to the transport address of UE_B.\nThe IMS Access Gateway can learn the transport addresses where the inbound (i.e. towards the UE) media packets shall be forwarded to in two ways, depending on whether there is a NAT device in the path or not. In absence of a NAT device in the path, it is the P‑CSCF that signals the destination transport address for the inbound media flows. In presence of NAT device in the path, it is the IMS Access Gateway that may, upon being informed that there is a NAT in the network, determine the destination transport address of the inbound media flow based on previously received media packets in the opposite direction.\nBeyond the changes of transport addresses the IMS Access Gateway shall perform the other necessary changes in the IP header as it is specified in the NAT related IETF specifications, IETF RFC 2766 [33] and IETF RFC 2663 [34].\nNOTE 1:\tIf the IMS Access Gateway does not know the transport address where a packet shall be forwarded, i.e. no packet of the other direction of the media flow has been received, then it can store or drop the packet.\nNOTE 2:\tIf this is not the first packet then the IMS Access Gateway can check the source transport address. If it is not the same as the transport address previously used for this media flow in this direction then the media packet may be a fraud one and should be dropped.\nNOTE 3:\tThis solution (i.e. when the IMS Access Gateway determine the destination transport address on its own) assumes that the UE supports \"symmetric media\" i.e. it supports receiving media packets at the same address and port as it uses for sending.\n3)\tThe IMS Access Gateway routes the media packet towards UE_B.\nG.5\tNetwork elements for employing NAT Traversal for ICE and Outbound\nG.5.1\tGeneral requirements\nIn addition to the general requirements outline in clause G.1.1, the following NAT traversal solution also addresses the following additional requirements:\n-\tDoes not require the network to be aware of the presence of a NAT;\n-\tAvoid unnecessarily long media paths due to media pinning;\n-\tIt shall be possible to establish communication towards a remote UE that does not support of the functionality listed in G.5;\n-\tMinimize the impacts on Policy and Charging Control functionality.\nG.5.2\tICE\nG.5.2.1\tOverview\nThe Interactive Connectivity Establishment (ICE) described in IETF RFC 5245 [45] defines a methodology for media traversal of NAT devices.\nHowever, ICE is not a complete solution in of itself as ICE only addresses address advertisement and NAT binding maintenance. ICE does not address RTP and RTCP port symmetry requirements or non-sequential RTP and RTCP port assignment. A complete UE managed NAT traversal solution shall take into account each of these issues.\nG.5.2.2\tRequired functions of the UE\nWhen supporting ICE, the UE is responsible for managing the overall NAT traversal process and for invoking the various protocol mechanisms to implement the NAT traversal approach. As such, the following functions shall be performed by the UE:\n-\tSTUN relay server and STUN server discovery;\nNOTE:\tA configuration mechanism can be used to provision STUN server and STUN relay server addresses in the UE.\n-\tTransmission of media packets from the same port on which it expects to receive media packets;\n-\tRTCP port advertisement.\n-\tICE functionality which includes:\n-\tMaintaining of NAT bindings to insure inbound media packets are allowed to traverse the NAT device.\n-\tAddress advertisement, which consists of the following operations:\n-\tGathering candidate addresses for media communications;\n-\tAdvertising the candidate addresses in a special SDP attribute (a=candidate) along with the active transport address in the m/c lines of the SDP.\n-\tPerform connectivity checks on the candidate addresses in order to select a suitable address for communications.\nDepending on the results of the connectivity checks, one of the candidate addresses may be promoted to become the active transport address.\nDepending on the active transport address, provide additional information in the session description to insure that correct policy and charging functionality can be applied on relayed media packets.\nGiven the desire to minimize session establishment delays during connectivity checks, the UE shall advertise its active address in the SDP offer or answer in the following order based on their availability:\n1.\tSTUN relay server assigned address;\n2.\tSTUN derived address;\n3.\tLocally assigned address.\nG.5.2.3\tRequired functions of the STUN relay server\nThe STUN relay server and associated signalling requirements are documented in IETF RFC 5766 [46] and its use is detailed in IETF RFC 5245 [45]. No additional requirements are placed on this server.\nNOTE:\tWhile it is not required that a STUN relay server be deployed in the network, a STUN Relay server would allow for media exchange in the presence of all NAT types.\nG.5.2.4\tRequired functions of the STUN server\nThe STUN server and associated signalling requirements are documented in RFC 5389 [47] and its use is detailed in IETF RFC 5245 [45]. No additional requirements are placed on this server.\nNOTE:\tWhile it is not required that STUN servers be deployed in the network, a STUN server would allow for UEs to discover the WAN facing transport address of the NAT. Such discovery may minimize the need for STUN Relay server resources by allowing UEs to directly exchange media in the presence of the majority of NAT types.\nG.5.3\tOutbound\nG.5.3.1\tOverview\nRFC 5626 [48] \"Managing Client-Initiated Connections in the Session Initiation Protocol\" (Outbound) defines a methodology for signalling traversal of NAT devices. This methodology involves the establishment of flows to allow for the routing of inbound dialog initiating requests and the maintenance of the flow through keep-alive messages. Outbound does not however address inbound response routing or inbound mid-dialog requests. A complete UE managed NAT traversal solution shall take into account each of these issues.\nThis clause is restricted to the use of Outbound in the context of SIP NAT traversal and not to the usage of Outbound for multiple registration support.\nNOTE:\tICE and Outbound are not dependent on each other, and can be deployed separately or together. The STUN keep-alive function, for SIP signalling, can also be implemented as a standalone function, without ICE or Outbound.\nG.5.3.2\tRequired functions of the P‑CSCF\nWhen supporting Outbound, the P‑CSCF's primary role in NAT traversal is to ensure that requests and responses occur across a flow for which there is an existing NAT binding. The P‑CSCF shall ensure that inbound dialog initiating requests can be forwarded to the UE on a flow for which there is an existing NAT binding.\nThe P‑CSCF shall ensure that all responses to the UE including those from mid-dialog requests are sent to the same source IP address and port which the request was received from.\nThe P‑CSCF shall also implement a limited STUN server functionality to support the STUN keep-alive usage as defined in RFC 5389 [47] which is used by the UE to maintain the NAT bindings.\nNOTE:\tThe STUN server implementation on the P‑CSCF need only support the STUN functionality required for the STUN binding request operation.\nAdditionally the P‑CSCF shall transmit signalling packets from the same port on which it expects to receive signalling packets.\nG.5.3.3\tRequired functions of the S‑CSCF\nWhen supporting Outbound, the S‑CSCF should be responsible for indicating to the UE that Outbound procedures are supported.\nG.5.3.4\tRequired functions of the UE\nWhen supporting Outbound, the UE is responsible for managing the overall NAT traversal process and for invoking the various protocol mechanisms to implement the NAT traversal approach. As such, the following functions shall be performed by the UE:\n-\tMaintaining of NAT bindings between the UE and the P‑CSCF through the use of a keep-alive mechanism to insure inbound signalling packets are allowed to traverse the NAT device.\nNOTE:\tSolutions to determine the frequency of the keep-alive are not defined in this version of the specification. A configuration mechanism can be used in place of a dynamic discovery process.\n-\tTransmission of signalling packets from the same port on which it expects to receive signalling packets;\n-\tEstablishment of signalling flows to its assigned P‑CSCF(s) during registration.\nNOTE 1:\tThe UE can determine that STUN based keep-alive can be used towards the P‑CSCF based on the presence of the STUN keep-alive parameter from the P‑CSCF SIP URI received during P‑CSCF discovery.\nNOTE 2:\tIf a UE supports only STUN keep-alives, but not Outbound, it does not need to determine Outbound support, and it does not need to register flows as defined by Outbound. It only sends STUN requests to the P‑CSCF to keep NAT bindings open.\nG.6\tProcedures for employing ICE and Outbound\nThe procedures described in the following clauses are applied in addition to the procedures of the UE and P‑CSCF described in other clauses of this specification.\nG.6.1\tFlow establishment procedures\nThis procedure is initiated by the UE at network registration time, and allows for the establishment of a flow between a UE and its assigned P‑CSCF. This flow can then be used by the P‑CSCF to allow an initial inbound request to traverse the NAT.\nFigure G.7: Flow Establishment Procedures for Outbound\n1.\tUE-A initiates network registration by sending a registration request to its assigned P‑CSCF.\n2.\tUpon receipt of a registration request, the P‑CSCF stores received transport header. This includes information to identify the flow between P‑CSCF and UE.\n3.\tThe P‑CSCF then sends the registration request to the assigned S‑CSCF after adding information identifying the serving P‑CSCF to the registration request.\n4.\tThe S‑CSCF stores the information identifying the serving P‑CSCF and returns a registration response.\n5.\tUpon receipt of the registration responses from the S‑CSCF, the P‑CSCF forwards the registration response to UE-A using the stored transport address information from the registration request.\n6.\tUE-A sends a Keep-Alive request to its assigned P‑CSCF using the same transport address information (source and destination) which was used for the registration request. This Keep-Alive ensures that a NAT binding exists between UE-A and the P‑CSCF allowing for inbound session requests from the P‑CSCF to UE-A.\n7.\tThe P‑CSCF responds with a Keep-Alive response which also reflects the received source transport address information. Inclusion of such information allows UE-A to determine if the NAT has rebooted and assigned a new binding and take appropriate action.\nG.6.2\tSession establishment procedures\nThe following procedure illustrates the session establishment procedures when both UEs support the ICE methodology. These procedures apply to both the terminating and originating side of the session regardless of whether the UE is behind a NAT.\nIn the following figure the STUN element represents both a STUN server and STUN Relay server as a single logical element. It would be equally valid if these functions we represented in separate logical elements. The procedures are unaffected by the grouping. Further, this call flow represents a simplified view to illustrate the NAT traversal procedures only. Other network elements not show may be involved in the session establishment process.\nFigure G.8: Session Establishment procedure for NAT Traversal using ICE and Outbound\n1.\tUE-A begins candidate transport address collection by performing a request for a transport address for each media flow from the STUN server.\n2.\tThe STUN server reserves one of its transport addresses for each media flow and sends the reserved transport address information back to the UE. The STUN server also reflects the source transport address of the original request for a transport address.\nIf the UE fails to identify STUN servers it concludes that ICE and Outbound procedures are not supported by the network and defaults to operation using the procedures described in clause G.4.\n3-4.\tUE-A repeats the procedures for requesting a transport address for each RTCP flow. These steps may be executed in parallel with steps 1. – 2. or in series.\n5.\tWith its three candidates (locally assigned, server reflected and relay) UE-A forms an offer and forwards to its assigned P‑CSCF. The UE includes the SP cand-type, SP rel-addr and SP rel-port in the candidate attribute as defined in IETF RFC 5245 [45].\n6.\tTo ensure subsequent responses to the offer are allowed through the NAT, the P‑CSCF stores the transport address information received in the transport header of the offer.\n7.\tThe P‑CSCF forwards the Offer to UE-B using one of the previously established flows.\n8-11.\tUE-B performs the candidate gathering procedures as outlined in steps 1. – 4. above.\n12.\tWith its three candidates (locally assigned, server reflected and relay) UE-B forms an answer and forwards to its assigned P‑CSCF.\n13.\tThe P‑CSCF for UE-A forwards the Answer to UE-A based on the previously stored transport address information. Media can being to flow at this point using the default transport addresses (recommended to be the STUN Relay provided address).\n14.\tBoth UE-A and UE-B perform connectivity tests on each received transport address to determine which of the received transport addresses are actually reachable.\n15.\tAfter the connectivity tests are concluded UE-A sends an updated SDP Offer indicating the agreed to transport address.\n16.\tThe P‑CSCF forwards the Offer according to normal routing procedures.\n17.\tUE-B sends an Answer indicating the agreed to transport address.\n18.\tThe P‑CSCF forwards the Answer according to normal routing procedures. Media can begin flowing using the newly identified addresses.\n19-21.\tSTUN Relay allocated transport addresses are released by the UE once a more efficient address has been identified and the session updated.\nG.6.3\tSession release procedures\nThis procedure is applied to by the UE if the IMS-ALG function is not supported by the network, but the network does support ICE and Outbound procedures. Normal session release procedures are followed with the following exception. If a STUN Relay allocated transport address was used for the session, it shall be released by the UE for which the transport address was allocated.\nIn the following figure the STUN element represents both a STUN server and STUN Relay server as a single logical element. It would be equally valid if these functions we represented in separate logical elements. The procedures are unaffected by the grouping.\nFigure G.9: Session Release Procedure with STUN Relay Resources\n1.\tUE-A receives a trigger to release the session for which STUN Relay resources were allocated.\n2.\tUE-A sends an indication to the STUN Relay server to release resources allowed for RTP.\n3.\tThe STUN Relay server releases the allocated resources and returns a response.\n4.\tUE-A sends an indication to the STUN Relay server to release resources allowed for RTCP.\n5.\tThe STUN Relay server releases the allocated resources and returns a response.\nG.6.4\tSession modification procedures\nA session modification can cause the creation, and/or modification, and/or release of media flows.\nThis procedure is applied to by the UE if the IMS-ALG function is not supported by the network, but the network does support ICE and Outbound procedures. When a new media flow is created the procedure used during session establishment for updating the transport addresses (steps 15-17. of the session establishment procedures) shall be applied.\nWhen an existing media flow is released the procedure for session termination shall be applied for the particular media flow.\nWhen an existing media flow is modified, this may lead to a modification of the media flow directly, or to the establishment of a new media flow and release of the existing one.\nG.6.5\tPolicy and Charging Control procedures\nWhen PCC is to be employed for a session, the P‑CSCF is responsible for providing the PCRF/PCF with IMS media flow information related to the service. If the UE has indicated that the active transport address corresponds to a relayed address, the P‑CSCF shall be responsible for using the additional information provided by the UE to convert the media flows derived from the SDP into flow descriptions which will traverse the Policy and Charging Enforcement Point.\nThe deployment of STUN relay servers requires that the UE be able to communicate with such servers prior to session establishment. The PCC for the IP‑CAN must be set up to allow communication with the STUN relay server prior to IMS session establishment. This may impact gating control in some IP‑CANs which do not support a default or best effort flow which can be used to communicate with the STUN relay server prior to session establishment.\nNOTE 1:\tPredefined PCC rules can be created to allow the UE to communicate with the STUN relay much in the same way the UE is allowed to communicate with the IMS network for session management.\nNOTE 2:\tGiven that a STUN relay is a forwarding server under the direction of the UE, necessary precaution needs to be taken by the operator in how it chooses to craft these rules. It is recommended that such predefined rules only guarantee the minimal amount of bandwidth necessary to accomplish the necessary UE to STUN relay communication. Such an approach helps reduce the resources required to support NAT traversal mechanisms. Finally, such an approach allows the preconfigured rule to be over-ridden by dynamic rules which allow for the necessary bandwidth needed by the session.\nNOTE 3:\tThe dynamic PCC rule will need to differentiate between different media traffic between UE and STUN relay (e.g. voice vs. video), which can be identified by the different ports assigned by the residential NAT. Session bindings need to take into account that the relevant Terminal IP address may be contained within the ICE candidates contained in the session description, rather than in the normal media description.\nG.6.6\tDetection of NAT Traversal support\nThe UE shall be able to determine whether the IMS CN supports the Outbound procedures by the capabilities indicated in the registration response to the UE. If the indication of the capability is present, the UE knows that the IMS CN supports Outbound and the associated procedures.\nNOTE:\tA configuration mechanism can be used to provision STUN server and STUN relay server addresses in the UE.\nG.6.7\tProcedures at other IMS entities processing SDP\nIMS entities processing SDP, such as the P‑CSCF, IBCF or MRFs, may or may not be updated to understand the \"candidate alternative addresses\" that are part of the ICE procedures, IETF RFC 5245 [45]. IMS entities processing SDP that do not understand the ICE procedures will, in accordance with there compatibility procedures, ignore the \"alternative addresses\", and media entities, such as the IMS Access Gateway, PCEF, MRFP and TrGW, controlled by the IMS entities processing SDP will not pass connectivity check requests and media on those addresses. IMS entities processing SDP which behave as B2BUAs may or may not pass on the alternative address in accordance with their own compatibility procedures.\nAnnex H (informative):Example HSS deployment\nThis clause describes possible deployment scenarios for the HSS when it operates as an IMS only database.\nThe following depicts the HSS functionality as described in TS 23.002 [1] repeated here for clarity; note that the functional description in TS 23.002 [1] shall always be considered as the most updated version, if it is different than the version shown here. 3GPP HSS contains functions also known as HLR and AuC, which are needed for 3GPP GPRS and CS domain access authentication and authorization and overall subscription handling as well as service data management.\nFigure H.1: HSS functional decomposition\nIn cases where the HSS would operate as an IMS only entity, the functions and interfaces specific to IMS operations would be applicable. These include support of functionalities such as identification handling, service provisioning support, call/session establishment support, application services support, IMS access authentication and authorization provided by the interfaces Cx, Sh and Si (if applicable to interwork with CAMEL) and any additional subscription and configuration handling for IMS users. This type of configuration of the HSS would be used for access to the IMS as defined by, for example, TISPAN NGN.\nAnnex I (normative):Border Control Functions\nI.1\tGeneral\nThis annex describes a collection of functions that can be performed on interconnection boundaries between two IM CN subsystem networks or between an IM CN subsystem network and other SIP based multimedia network, based on operator configuration.\nI.2\tOverall architecture\nFigure I.1 presents a high-level architecture diagram showing how Border Control Functions fit into the IMS architecture.\nFigure I.1: Border Control Functions\nThe Mx reference point allows S‑CSCF/I‑CSCF/P‑CSCF/MSC Server enhanced for ICS or MSC Server enhanced for SRVCC to communicate with an IBCF in order to provide border control functions. The functionality of the reference point is specified in TS 24.229 [10a].\nThe Mm reference point allows IBCF to be the entry / exit point towards other IM Core Network Subsystems and provide border control functions. The Ici reference point allows IBCF to be the entry / exit point towards other SIP networks and provide border control functions. The functionality of the reference points are specified in TS 24.229 [10a].\nThe Ix reference point allows the IBCF to control the TrGW. The functionality of Ix is defined in TS 29.162 [75].\nI.3\tBorder Control Functions\nI.3.1\tIP version interworking\nThe IP version interworking should not adversely affect IMS sessions that do not require IP version interworking.The network shall, at a minimum, support mechanisms that support IP version interworking for UEs, which comply with previous release of specifications. In addition, any impacts due to specific properties of the IP‑CAN shall be taken care of by the IP‑CAN itself without affecting the IMS. One possible architecture scenario can be based on the principle defined in TS 23.221 [7] using gateways.\nThe IMS ALG provides the necessary application function for SIP/SDP protocol stack in order to establish communication between IPv6 and IPv4 SIP applications.\nThe IMS ALG receives an incoming SIP message from CSCF nodes or from an external IPv4 SIP network. It then changes the appropriate SIP/SDP parameters, translating the IPv6 addresses to IPv4 addresses and vice versa. The IMS ALG needs to modify the SIP message bodies and headers that have IP address association indicated. The IMS ALG will request NA(P)T-PT to provide the bindings data between the different IP addresses (IPv6 to IPv4 and vice versa) upon session initiation, and will release the bindings at session release.\nI.3.1.1\tOriginating Session Flows towards IPv4 SIP network\nThe following example session flow shows a scenario where the S‑CSCF is responsible for inserting the IMS-ALG in the session path. No I‑CSCF node shown in this scenario, if configuration requires presence of an I‑CSCF then it would have been collocated with the IMS-ALG.\nFigure I.2: Originating IMS session towards an IPv4 end point\n1.\tUE (A) initiates an IMS session towards User B, via the session path for IMS and the session is analysed at the S‑CSCF of UE (A).\n2.\tS‑CSCF for user A determines via DNS (or other mechanism) that the User B's domain cannot be communicated via IPv6 but can be via IPv4.\n2a.\tS‑CSCF forwards the request to IMS-ALG.\n3.\tThe IMS-ALG then acquires the necessary resources from the TrGW such as the IPv4 address and ports on behalf of user A so that User A can communicate with user B transparently.\n4.\tThe IMS-ALG continues IMS signalling towards User B network where User A's IPv6 address/port information is replaced by IPv4 information.\n5.\tWhen User (B) responds to the session initiation requests, the IMS-ALG will replace the IPv4 address/port information of User (B) with its own IPv6 information for signalling and with TrGW IPv6 information for the media path as the contact information of User (B) and forward the request to S‑CSCF of UE (A). Session signalling path is then established between the UE and the S‑CSCF, the S‑CSCF and the IMS-ALG, the IMS-ALG and the external network for User B.\n6.\tThe media path is established between the UE (A) and the TrGW, via the IP‑CAN, and then between the TrGW and user B.\nAt session release, the IP address/Port information will be released for reuse by other sessions.\nI.3.1.2\tTerminating Session Flows from IPv4 SIP network\nThe following session flow shows an example of a terminating session from an IPv4 SIP client towards an IPv6 IMS client. In order for the IPv6 IMS client to be reachable by the IPv4 network, it is assumed that the IPv4 network discovers (via mechanism such as DNS query) the IMS-ALG as the entry point to the IPv6 IMS network.\nFigure I.3: Terminating IPv4 SIP session towards an IPv6 IMS user\n1.\tIn the IMS-ALG, a terminating session is received. IMS-ALG determines either via DNS query or via pre-configuration the appropriate I‑CSCF for the user (B) in the IMS network.\n2.\tIMS-ALG also communicates with TrGW to get the mapping of IPv6 address and ports on behalf of user (A) and replaces the User (A) information in the incoming SIP message and forwards the message towards S‑CSCF. From S‑CSCF point of view, it continues setting up the IMS session like any other IMS sessions.\n3.\tThe incoming session arrives in the S‑CSCF for the user (B).\n4.\tSession set up continues as usual in the IMS domain towards user (B).\n5.\tWhen UE (B) responds to the session initiation requests, the IMS-ALG will replace the IPv6 address/port information of User (B) with its own IPv4 information for signalling and with TrGW IPv4 information for the media path as contact information of UE (B) and forward the request towards the network of User (A). Session signalling path is established between User (B) and S‑CSCF, S‑CSCF and I‑CSCF/IMS-ALG and IMS-ALG and the external User (A)'s network.\n6.\tMedia path is established between UE (B) and the TrGW, via the IP‑CAN, and then between the TrGW and User (A).\nAt session release, the IP address/Port information will be released for reuse by other sessions.\nI.3.2\tConfiguration independence between operator networks\nThe THIG functionality may be used to hide the network topology from other operators. It shall be possible to restrict the following information from being passed outside of an operator's network: addresses of operator network entities.\nNOTE:\tThe THIG functionality was not intended to be invoked in IMS roaming scenarios when the P‑CSCF and IBCF are both located in the visited network as information available in certain SIP headers may be used by the home network for further processing of signalling messages.\nThe specific mechanism chosen needs to take into account the following separate aspects:\nNetwork management: In the case that network details (i.e. S‑CSCF addresses) are visible by other external network elements, any (temporary or permanent) changes to the network topology need to be propagated to network elements outside of the operator's network. This is highly undesirable from a network management perspective.\nNetwork scalability: Establishing security associations on a pair-wise basis among all CSCFs is likely to be unscalable. The security associations shall be independent of the number of network elements.\nCompetitively aspects: The operational details of an operator's network are sensitive business information that operators are reluctant to share with their competitors. While there may be situations (partnerships or other business relations) where the sharing of such information is appropriate, the possibility should exist for an operator to determine whether or not the internals of its network need to be hidden.\nSecurity aspects: Network element hiding may help to reduce the vulnerability of the overall system to external attacks (e.g. denial of service attacks). Further work is needed in this area.\nNOTE:\tThe encryption mechanism for implementing network configuration hiding is specified in TS 33.203 [19].\nI.3.3\tTranscoding Support for Interworking\nI.3.3.1\tGeneral\nThe IBCF/TrGw provides the necessary function for codec transcoding, when required by interworking agreement and session information, in order to establish communication between end points belonging to different IMS domains. These transcoding procedures are applicable to both the originating and the terminating side of the session or (in inter-network scenarios) in a transit network\nTranscoding shall only be performed in the case where a common codec cannot be negotiated between the two UEs.\nMedia transcoding services can be triggered proactively (before the session request is sent to the called UE) or reactively (after the session request has been sent to, and rejected by, the called UE).\nThe IBCF may allocate a TrGW before sending the SDP Offer to the terminating UE or it may allocate the TrGW upon receiving the SDP answer. The protocol solutions should ensure that the called party is not alerted until resources for transcoding are seized and user plane connection towards the calling party is established to avoid ghost ringing or voice clipping.\nNOTE:\tThe proactive transcoding example flows illustrates only the allocation of the TrGW before sending the SDP offer.\nIf the IBCF is configured per local policy to use proactive transcoding, the IBCF shall add codecs to the offer. When inserting additional codec(s), the network should be able to indicate the preferred codec order.\nIf the IBCF is configured per local policy to use reactive transcoding, the IBCF shall first determine the codecs supported by the calling and called UEs so that insertion of the TrGW is performed when necessary, if not required for any other interconnect function. This means that the IBCF shall trigger a new offer/answer to the terminating UE, based on the initial offer from the originating UE but including additional codecs supported by the TrGW in the same manner as for the proactive support.\nI.3.3.2\tSession Flows\nI.3.3.2.1\tProactive transcoding support\nThe following example session flow shows a proactive transcoding support scenario where an IBCF acting as an exit point allocates a TrGW prior to signalling towards the entry point of the other operator's network. The IBCF inserts additional codecs in the SIP signalling. The calling UE capabilities are contained in the SDP offer. Based on the interworking agreement between IM CN subsystems, terminating IBCFs acting as the network entry points may also insert additional codecs in the SIP signalling.\nThe IBCF and TrGW in Figure I.4 below may be located in the originating network (the IBCF acts as an exit point), or in the terminating network (the IBCF acts as an entry point). There can also be additional IBCF's and TrGW's (not shown) in the case of scenarios involving transit networks.\nFigure I.4: Proactive transcoding invocation\n1.\tUE (A) initiates an IMS session towards User B, via the session path for IMS and the session is analysed at the IMS network of UE (A).\n2.\tThe IMS network of UE (A) determines that the User B's domain need be communicated via IBCF and forwards the request to the IBCF.\n3.\tThe IBCF checks the SIP message and decides whether additional codec(s) need be inserted into SIP message based on the session information (such as ICSI , SDP) and interworking agreement. When inserting additional codec(s), the network should be able to indicate the preferred codec order. A TrGW is allocated.\n4.\tThe IBCF generates a new SIP message towards User B network based on the received SIP message where additional codec(s) have been added and where the transport address and port information has been altered to indicate the addresses associated by the TrGW.\n5.\tUser (B) selects a codec from the offer modified by IBCF, and responds with an SDP answer.\n6.\tWhen receiving the SDP answer, if the IBCF invoked the TrGW in step 3, it now configures the TrGW with address and port towards UE (B). The IBCF checks if the agreed codec belongs to the original offer it received in step 3 or it is one of the codecs that was added by IBCF. If the agreed codec was added by the IBCF, the IBCF configures the TrGW to enable the transcoding functionality. Otherwise, the IBCF will not invoke the transcoding function.\nNOTE 1:\tIf the IBCF forwards an SDP offer without allocating a TrGW and changing the connection information, and the subsequent SDP answer indicates selection of a transcoding option associated with the TrGW, then the IBCF needs to allocate a TrGW and initiate another SDP offer/answer transaction to forward the TrGW connection information. If the IBCF forwards an SDP offer with connection information for its TrGW, and the subsequent SDP answer indicates the use of an original codec (transcoding is not needed), then the IBCF can initiate another SDP offer/answer transaction to forward the original connection information, and de-allocate the TrGW. The details are not shown.\n7.\tThe IBCF generates a new response message back to UE (A) based on the received response message where the codec received from peer side has been replaced with the selected codec.\nNOTE 2:\tOn the new response message the selected codec will based on the SDP offer received by IBCF on step 3.\n8.\tSession signalling path is established between User (A) and IBCF, IBCF and User (B).\n9.\tThe media path is established between the UE (A) and the TrGW, and then between the TrGW and user B.\nAt session release, the codec transcoding resource will be released.\nI.3.3.2.2\tReactive transcoding support\nThe following example session flow shows a reactive transcoding scenario where IBCF located at the network exit point first determines if a session can be established without addition of transcoding options and, will insert additional codecs in the SIP signalling only after failure to establish a session due to lack of a common codec. Based on the interworking agreement between IM CN subsystems the terminating IBCF may also perform this function.\nNOTE 1:\tIn the event a session is being forked in the terminating network, the reactive transcoding will only be performed if all UEs receiving the forked request initially reject the session for any reason, e.g. due to lack of support for the offered codecs.\nFigure I.5: Reactive transcoding invocation\n1.\tUE (A) initiates an IMS session towards User B, and the session is analysed at the IBCF. The SDP offer is forwarded toward User B without the proactive addition of transcoding options.\n2.\tA subsequent entity in the signalling path determines that it does not support any codec in the SDP offer and answers with an appropriate error response. This response may include a list of supported codecs.\nNOTE 2:\tThe subsequent entity in the signalling path can be a network entity in a transit network, in the terminating network, or UE (B).\n3.\tBased on the response, the IBCF detects the need for reactive transcoding invocation.\n4.\tThe IBCF instructs the TrGW to allocate media processing resources for the session, allocate appropriate transcoding resources for the session and bridge the media flows between the calling and called party endpoints.\n5.\tBased on the response from the TrGW, the IBCF creates a new SDP offer that contains the codec and transport address information received from the TrGW. If no information about supported codecs was available from the error response, the IBCF may offer all codecs supported by the transcoding device. The IBCF sends this SDP offer towards UE (B).\n6.\tUE (B) selects a codec and acknowledges the SDP offer with an SDP answer.\n7.\tUpon receipt of the SDP answer, the IBCF updates the TrGW with the information from the SDP answer.\n8.\tThe IBCF prepares an SDP answer to the SDP offer in step 1, including the selected codec and transport address information for the originating side of the TrGW. The session between the end-points is now established with the media flow traversing the transcoding device.\nAt session release, the codec transcoding resource will be released.\nAnnex J (informative):Dynamic User Allocation to the Application Servers\nJ.1\tGeneral\nThe complexity of operating a network increases with the number of supported subscribers, and one contributor will be the management of allocating subscribers to the application servers for the same set of services, where there is a requirement for a user to be assigned to an application servers longer than the duration of one session. This would occur when there is data which is to be retained together with the processing resources longer than a single session.\nPossible solutions described below do not require impacts on the stage 3 specifications.\nJ.2\tRepresentative AS\nJ.2.1\tConcept of Representative AS\nThe Representative AS is the application server which allocates the user to the application servers and keeps the user allocation information and relevant data for the service during the duration of a session or longer than that. The incoming call for the service is received and forwarded to the allocated application server by the Representative AS.\nThe following points are considered as requirements for the dynamic user allocation procedures using the representative AS.\n-\tThe representative AS for each service is the initial contact point for all signalling. This can include ISC; and for example, Ut; and others signalling that may or may not be defined in 3GPP.\n-\tFor the ISC, the representative AS is included in every message which opens a new dialogue. It is not included after the initial transaction.\n-\tFor example, when the AS is to be invoked by evaluating the iFC at the S‑CSCF, the address in the iFC is the address of the Representative AS.\nThe following figure shows an example service deployment for three different services using the representative AS.\nFigure J.2.1: Dynamic User Allocation using Representative AS\nJ.2.2\tProcedures related to Representative AS\nFigure J.2.2: Bypassing Representative AS procedure\nProcedure is as follows:\n1.\tThe initial SIP INVITE request is sent to S‑CSCF to create a new dialogue.\n2.\tThe SIP INVITE request is forwarded to the Representative AS according to the service logic, e.g. iFC evaluation at the S‑CSCF.\n3.\tThe Representative AS retrieves the user allocation information and forwards the SIP INVITE request to the AS#1 according to the allocation information. If there is no allocated AS for the user, the Representative AS allocates one.\n4.\tThe SIP INVITE request is forwarded to the AS#1. Note that the Representative AS does not record-route itself.\n5-7. The SIP INVITE request is processed and results in the 200 OK response.\n8.\tThe subsequent SIP INVITE request in the same dialog is sent to the S‑CSCF.\n9.\tThe SIP INVITE request is forwarded directly to the AS#1 according to the Route information in the request message.\n10-11.\tThe SIP INVITE request is processed and results in the 200 OK response.\nJ.3\tDynamic assignment of AS by S‑CSCF caching\nJ.3.1\tConcept of Dynamic assignment of AS by S‑CSCF caching\nThe proposed solution \"Dynamic assignment of AS by S‑CSCF caching\" is based on standard SIP session control combined with a new S‑CSCF caching functionality. This solution is re-using the DNS (IETF RFC 1035) mechanism, and supports only the ISC interface.\nJ.3.2\tProcedures related to Dynamic assignment of AS by S‑CSCF caching\nFigure J.3.2.1 shows the procedure for allocating an AS by the first request of a service to an IMS registered user:\nFigure J.3.2.1: Assignment of AS via DNS query during first service request\n1.\tAfter IMS registration a user sends an initial request to the S‑CSCF for requesting a service (served by an AS).\n2.\tThe S‑CSCF performs the DNS query on the server name and resolves one (or a prioritised list) of the IP address(es), which represents a physical or logical AS.\n3.\tThe S‑CSCF caches the IP address of the assigned AS and stores it during the IMS registration period of the user.\n4.\tThe S‑CSCF routes the request to the assigned AS. (Depending on the service the AS could read/write/store user data, e.g. using Sh interface).\nFigure J.3.2.2 shows how subsequent service requests are routed directly to the assigned AS during the registration period of the IMS user:\nFigure J.3.2.2: S‑CSCF has stored assigned AS for following service requests\n5.\tThe IMS user requests the service again and sends an initial request to the S‑CSCF.\n6.\tThe S‑CSCF has stored the IP Address (or a prioritised list) of the assigned AS. There is no longer need to perform a DNS query.\n7.\tThe S‑CSCF routes the request to the assigned AS. (Depending on the service the AS can reuse prior stored user data).\nThe AS pre-assignment and storage could be also done after downloading the service profile during the user registration procedure.\nAnnex K (normative):Inter-IMS Network to Network Interface between two IM CN subsystem networks\nK.1\tGeneral\nThis annex describes the Inter-IMS Network to Network Interface which is used to interconnect two IM CN subsystem networks.\nK.2\tOverall architecture\nFigure K.1 illustrates an high-level architecture diagram showing the Inter-IMS Network to Network Interface (II-NNI) between two IM CN subsystem networks.\nFigure K.1: Inter-IMS Network to Network Interface between two IM CN subsystem networks\nThe protocols over the two reference points Ici and Izi make up the Inter-IMS Network to Network Interface.\nThe Ici reference point allows IBCFs to communicate with each other in order to provide the communication and forwarding of SIP signalling messaging between IM CN subsystem networks. The Izi reference point allows TrGWs to forward media streams between IM CN subsystem networks.\nNOTE:\tWhenever the Inter-IMS Network to Network Interface is used to interconnect two IM CN subsystem networks belonging to different security domains security procedures applies as described in TS 33.210 [20].\nAnnex L (normative):Aspects for use of Common IMS in 3GPP2 systems\nL.1\tGeneral\nThis clause describes the main concepts that are used when providing IMS services using 3GPP2 IP‑CAN as defined in 3GPP2 X.S0011 [60] or using 3GPP2 radio access with CDMA 1X as defined in 3GPP2 C.S0001-D [61] and/or HRPD as defined in 3GPP2 C.S0024-A [62] and/or UMB as defined in 3GPP2 C.S0084-000 [63] radio access.\nL.2\tDefinitions\nL.2.1\tHSS\nFor 3GPP2 systems, the term \"HSS\" is used to represent the Home AAA entity plus the Databases to which it interfaces. The HSS in 3GPP2 systems does not include the HLR functionality. Figure x shows the HSS in 3GPP2 systems.\nFigure L.1: HSS in 3GPP2\nL.3\tMobility related concepts when using 3GPP2 Packet Data Subsystem\nL.3.1\tGeneral\nThe Mobility related procedures for 3GPP2 systems are described in 3GPP2 X.S0011 [60] and the IP address management principles are described in 3GPP2 X.S0011 [60]. As specified by these procedures, the UE acquires the necessary IP address(es) to access IM CN system.\nThe restriction on using a single IP address for IMS Local Breakout functionality as defined in clause 5.1.0 does not apply to 3GPP2 based systems.\nL.3.2\tProcedures for P‑CSCF discovery\nThis clause describes the P‑CSCF discovery procedures applicable for 3GPP2 systems. These procedures follow the generic mechanisms described in clause 5.1.1 with the following exception:\n-\tDiscovery of P‑CSCF as part of establishment of connectivity towards the 3GPP2 IP‑CAN is not supported.\nL.4\tQoS related concepts when using 3GPP2 Packet Data Subsystem\nThe QoS procedures follow the generic requirements described in clause 4.2.5 with the following modification to bullet 6.e in clause 4.2.5:\n-\tThe initiation of any required end-to-end QoS signalling, negotiation and resource allocation processes at different network segments may take place before or after the initiation and delivery of a session set-up request.\nL.5\tIP version support in IMS when using 3GPP2 Packet Data Subsystem\nThe UE shall support IPv4 only or both IPv4 and IPv6.\nL.6\tAddress and identity management concepts\nL.6.1\tDeriving IMS identifiers\nISIM is the primary source for IMS identity information. If an ISIM is not present, the UE shall use the IMS credentials stored in the IMC to access IMS.\nIf no IMS credentials are stored in the IMC, then temporary credentials shall be derived as follows:\n-\ta Temporary Private User Identity shall be derived from the Mobile Station ID (IMSI, MIN or IRM), which allows for uniquely identifying the user within the operator's network;\n-\ta Temporary Public User Identity shall be derived from the MSID, and shall be used in SIP registration procedures. The Temporary Public User Identity shall take the form of a SIP URI (as defined in RFC 3261 [12] and RFC 3986 [13]).\nIt is strongly recommended that the Temporary Public User Identity is set to barred for SIP non-registration procedures. The following applies if the Temporary Public User Identity is barred:\n-\tA Temporary Public User Identity shall not be displayed to the user and shall not be used for public usage such as displaying on a business card.\n-\tThe Temporary Public User Identity shall only be used during the SIP initial registration, re-registration and mobile initiated de-registration procedures.\n-\tThe implicitly registered Public User Identities shall be used for session handling, in non-registration SIP messages and may be used at subsequent SIP registration procedures.\n-\tA Temporary Public User Identity shall only be available to the CSCF and HSS nodes.\nNOTE:\tIf a Temporary Public Identity is used, the user can not initiate any sessions until the implicitly registered public identities are available in the UE.\nWhen a Temporary Public Identity has been used to register an IMS user, the implicit registration will ensure that the UE, P‑CSCF & S‑CSCF have Public User Identity(s) for all IMS procedures after the initial registration has been completed.\nL.7\tRelationship to 3GPP Generic User Profile (GUP)\n3GPP GUP is not applicable to 3GPP2 systems.\nAnnex M (informative):IMS Local Breakout\nM.1\tP‑CSCF located in visited network\nM.1.1\tDescription\nM.1.1.0\tGeneral\nThe architectures and flows in this clause are only showing EPS and 5GS. The principles shown are also applicable for GPRS Core Network.\nFor 5GS, there is no support for roaming interface between vPCF and hPCF in this Release of the specification.\nM.1.1.1\tArchitecture\nThe architecture for this scenario is shown in figure M.1.1.1.\nFigure M.1.1.1: EPS/5GS architecture for IMS Local Breakout with P‑CSCF located in visited network\nOptionally IBCF and TrGW may be present in the HPLMN and VPLMN according to II‑NNI reference architecture (see Annex K), and thus there will be an Ici reference point between the IBCFs and an Izi reference point between the TrGWs.\nM.1.1.2\tFlow for originating session\nThe information flows for originating session for this scenario is illustrated in figure M.1.1.2.\nFigure M.1.1.2: Example scenario with P‑CSCF located in visited network and IBCF and TrGW in home network\n1.\tThe UE obtains an IP address from the EPS/5GS in the visited network according to the procedures specified by TS 23.401 [70] / TS 23.502 [94].\n2.\tThe EPS/5GS obtains default PCC rules and associates it with this IP‑CAN. The V‑PCRF/vPCF and H‑PCRF (in the case of S9 in EPS) provides these rules according to TS 23.203 [54] / TS 23.503 [95].\n3.\tUsing the IP address obtained in step 1, the UE performs IMS registration. This SIP message is routed by the EPS/5GS in the visited network through the P‑CSCF in the visited network, which was discovered according to the procedures in Annex E/Annex Y, to the S‑CSCF in the home network, via IBCFs also in the visited and home network if deployed.\n4.\tUsing the IP address obtained in step 1 in the SDP, the UE initiates a SIP session. The INVITE request is routed by the EPS/5GS in the visited network through the P‑CSCF to the IBCF in the home network.\n5.\tIf the IBCF decides to route media to home based on operator policy, it then allocates resources in TrGW and alters the offered SDP accordingly.\nNOTE 1:\tPer operator policy, the IBCF may have other reasons than only address translation to route media home.\n6.\tIBCF sends the INVITE further to the S‑CSCF, and S‑CSCF continues the session towards the far-end.\n7\tThe 200 OK received from the far-end is sent by the S‑CSCF to the IBCF. If a TrGW was allocated in step 5, then IBCF changes the SDP answer accordingly.\nNOTE 2:\tStep 7a) If the IBCF decides to anchor the call when it has received SDP answer (e.g. because the MRFP needs to be involved in the user plane or because of other reasons), then step 5 in the procedure starts again, and it re-INVITEs the far-end.\n8.\tThe 200 OK is sent further on to the P‑CSCF and via EPS/5GS in the visited network towards the UE.\n9.\tThe P‑CSCF in the visited network also provides the session information to the V‑PCRF/vPCF in the visited network.\n10.\tThe H‑PCRF in the home network provides PCC rules to the V‑PCRF in the visited network when S9 is supported. The V‑PCRF/vPCF in the visited network provisions PCC rules in the EPS/5GS in the visited network\n11.\tMedia exchanged between the UE and the far end is now routed either between the 5GS in the visited network and the far end, thus achieving local breakout mode of operation; or between the EPS/5GS in the visited network via the TrGW in the home network if IBCF was deployed.\nNOTE 3:\tPer operator policy, the IBCF can route media home due to other reasons than stated in this specification, thus also giving the possibility to get home routed mode of operation.\nM.2\tP‑CSCF located in home network\nM.2.1\tDescription\nM.2.1.0\tGeneral\nThe architectures and flows in this clause are only showing EPS and 5GS. The principles shown are also applicable for GPRS Core Network.\nThis scenario assumes that both IMS signalling and IMS media traffic are anchored in EPS/5GS in the Visited network. UE performs a P‑CSCF discovery according to clause 5.1.1.0.\nM.2.1.1\tArchitecture\nThe Local Breakout architecture for P‑CSCF at home is shown in figure M.2.1.1.\nFigure M.2.1.1-1: EPS/5GS architecture for IMS Local breakout with P‑CSCF located in home network\nM.2.1.2\tFlow for originating session\nThe information flows for originating session for this scenario is illustrated in figure M.2.1.2.\nFigure M.2.1.2: Example scenario with P‑CSCF located in home network\n1\tThe UE obtains an IP address from the EPS/5GS in the visited network, according to the IP Connectivity Access Network procedures specified by TS 23.401 [70] /TS 23.502 [94].\n2\tThe serving EPS/5GS (in visited network) obtains default PCC rules, and associates it with this IP‑CAN. The V‑PCRF/vPCF and H‑PCRF (in the case S9 in EPS is available) provides these rules according to TS 23.203 [54] / TS 23.503 [95].\n3\tUsing the IP address obtained in step 1, the UE performs IMS registration. This SIP message is IP-routed by the EPS/5GS, in the visited network, to the P‑CSCF in the home network, which was discovered according to the procedures in clause 5.1.1. When P‑CSCF receives the REGISTER message, it optionally interacts with H‑PCRF/vPCF to subscribe to signalling bearer state changes.\n4\tUsing the IP address obtained in step 1 in the SDP, the UE initiates a SIP session. The INVITE request is routed from the EPS/5GS in the visited network, via the visited PDN to the P‑CSCF in the home network.\n5\tIf the P‑CSCF decides to route media to home e.g. due to the need for address translation or due to other reasons, it then allocates resources in IMS AGW and alters the offered SDP accordingly.\nNOTE 1:\tPer operator policy, the P‑CSCF may have other reasons to route media to the home PLMN.\n6.\tINVITE proceeds from P‑CSCF to S‑CSCF and onwards.\n7.\t200 OK is received from the far end by the P‑CSCF. If an IMS-AGW was allocated in step 5, the P‑CSCF changes the SDP answer accordingly.\nNOTE 2:\tIn step 7a) if the P‑CSCF decides to route media home when it receives the SDP answer, then step 5 in the procedures starts again, and it re-INVITEs the far end.\n8.\tThe P‑CSCF provides the session information to the H‑PCRF/hPCRF in the home network.\n9.\tThe 200 OK received from the far-end is sent by the P‑CSCF through the EPS/5GS in the visited network towards the UE.\n10-11.\tBased on the IP address included in the session information, the H-PCRF in the home network provides the PCC rules to the V‑PCRF in the visited network when S9 is available. The V‑PCRF/vPCF in the visited network provisions PCC rules in the EPS/5GS in the visited network.\n12.\tMedia exchanged between the UE and the far end is now routed either between the EPS/5GS in the visited network and the far end, thus achieving local breakout mode of operation; or between the EPS/5GS in the visited network via the IMS AGW in the home network if step 5 or step 7a happened.\nNOTE 3:\tPer operator policy, the P‑CSCF may route media home due to other reasons than stated in this specification, thus also giving the possibility to get home routed mode of operation.\nM.2.2\tAddress assignment\nHome domain and visiting domains can not be managed to share the same private IPv4 address space, and furthermore Rx and N5 do not support globally unique addresses (realm information is not supported) which would be needed to handle overlapping private IPv4 address spaces. Therefore, both the address assigned to the UE and the address of the P‑CSCF must be globally unique IP addresses.\nIf the visited operator cannot assign a globally routable IPv4 address to an individual UE, then an IPv6 address will be assigned, if the UE supports IPv6.\nM.2.3\tIPv4 - IPv6 interworking\nIn a dual-stack IMS environment, an SDP offer to an UE with a single IP address may offer a media bearer over the IP version not supported by the UE. For such a call to succeed, a NAPT‑PT capable media relay is needed to be inserted in the media path. The alternatives for this are: to deploy either IMS‑AGWs either in home or visited network; or TURN servers in visited network.\nTo use IMS‑AGWs in the home network is the way the home operator is able to control whether the IMS user plane traffic shall be routed home or not in this scenario. Thus, it is possible to do NAPT‑PT, but it will be done in the home network, which means all traffic that needs interworking will be home routed.\nTo use TURN servers requires all IPv6 terminals to support TURN IPv4 - IPv6 interworking, and that the visited network supports TURN IPv4 - IPv6 interworking.\nNOTE 1:\tSince IPv4 - IPv6 interworking must be done on IPv6 side, IPv6 originating sessions to IPv4 UEs may need an extra INVITE because first INVITE may fail.\nNOTE 2:\tAn IP type PDU session for a 5GS UE will have either an IPv4 or an IPv6 address, see Annex Y.\nM.2.4\tNAT traversal\nAlthough this scenario assumes globally routable IP addresses, there is still a possibility that end users may use residential NAT/firewalls before connecting to EPS.\nAnnex G describes two methods how NAT/FW may be supported, if the UE accesses IMS using an IP address of a local private network.\nM.3\tP-CSCF located in visited network and with VPLMN loopback possibility\nM.3.1\tDescription\nM.3.1.1\tGeneral\nThe architecture and flows in this clause are assuming local breakout with P-CSCF in VPLMN, for further info about local breakout see clause M.1.\nM.3.1.2\tArchitecture\nThe architecture for this scenario is shown in figure M.3.1.2. The Transit and Roaming Function and the related requirements are defined in clause 4.15a.\nFigure M.3.1.2: Overall architecture for IMS Local Breakout with P-CSCF located in visited network and with VPLMN loopback possibility\nM.3.1.3\tFlow for originating session with VPLMN routing\nThe information flows for originating session with VPLMN routing for this scenario is illustrated in figure M.3.1.3.\nFigure M.3.1.3: Example scenario with P‑CSCF located in visited network and with VPLMN routing\n1.\tThe roaming UE sends an INVITE request to the P-CSCF.\n2.\tP-CSCF forwards the INVITE request to the visited IBCF. Based on operator policy, the P-CSCF adds a reference to the preferred Transit and Roaming Function.\n3.\tThis first IBCF in the VPLMN allocates a TrGW for the media and follows standard OMR procedures when forwarding the INVITE request to allow this TrGW to be bypassed if the INVITE request later returns to the VPLMN and no other intermediate nodes anchor the media before the request returns.\n4-5.\tThe intermediate network and the first IBCF in the HPLMN forward the INVITE request to the S-CSCF. Nodes in the intermediate network and the first IBCF in the HPLMN support OMR and allow their TrGWs to be bypassed.\n6.\tThe S-CSCF performs service invocation.\n7.\tThe S-CSCF performs routing decision, and based on local policy and on the facts that the UE is roaming, a roaming agreement for VPLNM call routing is in place, and home routing is not required, the S-CSCF decides to route back to the VPLMN for call routing. A loopback indicator is included in the INVITE request to inform the VPLMN that this request is being routed back to the VPLMN for call routing. The S-CSCF can also forward UE location information to the VPLMN. If a reference to the preferred Transit and Roaming Function is available in the request, the S-CSCF uses this information to route the session back to the VPLMN. If a reference to the preferred Transit and Roaming Function is not available, the S-CSCF uses a default derived address to the Transit and Roaming Function to route the session back to the VPLMN.\nIf local policy requires access to BGCF routing data to make the loopback decision for a particular SIP request, then the loopback decision can be performed in the BGCF.\n8-9.\tThe IBCF in the HPLMN and the intermediate network forward the SIP request towards the indicated Transit and Roaming Function in the VPLMN. Functions in the intermediate network support OMR and allow their TrGWs (if any) to be bypassed.\n10.\tThe IBCF in the VPLMN receives the SIP request, notes that the SDP includes an alternative media address within the VPLMN that allows bypass of allocated TrGWs, applies OMR to remove any TrGWs allocated between the VPLMN and HPLMN, and forwards the request to the indicated Transit and Roaming Function.\n11.\tBased on the loopback indicator, the Transit and Roaming Function detects that this is a loopback request. The Transit and Roaming Function routes the request toward the destination network based on available SIP URI, ENUM lookup, or BGCF routing. The Transit and Roaming Function can use information such as originating UE location to select a nearby egress point for media anchoring.\n12.\tIf the called party is determined to be available in IMS, the call is routed towards the remote end through an IBCF. If the called party is determined to be available in CS, the call is broken out to CS through an MGCF. If the called party is determined to be available in VPLMN, the call is routed to the I-CSCF. The called party information is included in the Request URI when forwarding the request to the next hop.\nWhen forwarding to an IBCF, the Transit and Roaming Function ensures by means of signalling that media is anchored in the VPLMN.\nNOTE 1:\tIf the called user is an IMS user of the VPLMN then the call will be routed directly to the terminating side, (i.e. I-CSCF of the VPLMN) without traversing an MGCF/IBCF.\n13.\tThe MGCF/IBCF performs normal call routing procedures to route towards the remote network/end.\nNOTE 2:\tThe call will be anchored in the VPLMN (outgoing IBCF), and OMR is not provided towards the terminating side.\n14.\tThe session establishment is completed.\nNOTE 3:\tDuring subsequent session establishment signalling, OMR information passed back through the IBCFs and intermediate networks between the VPLMN and HPLMN cause them to release any allocated TrGWs.\nM.3.1.4\tFlow for originating session with Home routing\nThe information flows for originating session with the possibility for VPLMN routing, but where the HPLMN decides to perform home routing is illustrated in figure M.3.1.4.\nFigure M.3.1.4: Example scenario with P‑CSCF located in visited network and with home routing\n1-6. These steps are done according to clause M.3.1.3.\n7.\tThe S-CSCF performs routing decision, and based on the facts that the UE is roaming, and home routing is required, the S-CSCF decides to route the INVITE request directly from the home network towards the terminating side. If local policy requires access to BGCF routing data to make the routing decision for a particular SIP request, then the routing decision can be performed in the BGCF. When forwarding, the S‑CSCF/BGCF ensures by means of signalling that media is anchored in the HPLMN.\nNOTE:\tThe S-CSCF decides whether to perform home routing based on local policy or based on knowledge that the VPLMN does not support the loopback procedure.\n8.\tThe session establishment is completed.\nM.3.2\tInteraction with SRVCC and ICS\nThe IMS roaming with local breakout and possibility for loopback also applies for ICS and SRVCC as follows:\n-\tFor an originating session for PS to CS SRVCC or vSRVCC that uses ATCF enhancements, the ATCF is in the signalling path between the P-CSCF and IBCF in the VPLMN (i.e. at step 2 in clause M.3.1.3).\n-\tFor an originating sessions that uses CS media with MSC Server enhanced for ICS, the UE initiates a CS call setup towards the MSC Server enhanced for ICS, and the MSC Server enhanced for ICS will initiate the call setup towards IMS analogous to the INVITE request from P-CSCF (i.e. at step 2 in clause M.3.1.3). As for the P-CSCF, the MSC Server enhanced for ICS may provide a reference to the preferred Transit and Roaming Function:\nAnnex N (normative):Aspects for use of Common IMS in Fixed xDSL, Fiber and Ethernet based systems\nN.1\tOrigination procedures\nN.1.1\t(FO#1) Fixed xDSL origination, home\nThis origination procedure applies to users located in their home service area. As in clause 5.6.2, the UE is located in the home network, but is using an xDSL IP‑CAN to access the IM CN Subsystem.\nNOTE:\tThe below flows are example flows. The detailed stage 2 description of the RACS information flows can be found in ETSI ES 282 003 [78].\nFigure N.1.1: Fixed xDSL originating - home (example flow)\nProcedure F0#1 is as follows:\n1.\tUE sends the SIP INVITE request, containing an initial SDP, to the P‑CSCF address determined with P‑CSCF discovery mechanism. The initial SDP may represent one or more media for a multi-media session.\n2.\tA connection is reserved in the C‑BGF with optional NAT binding list retrieval.\n3.\tP‑CSCF remembers (from the registration procedure) the next hop CSCF for this UE. In this case it forwards the INVITE to the S‑CSCF in the home network.\n4.\tS‑CSCF validates the service profile, and invokes any origination service logic required for this user. This includes authorization of the requested SDP based on the user's subscription for multi-media services.\n5.\tS‑CSCF forwards the request, as specified by the S-S procedures. In addition, subject to operator policy, the S‑CSCF may insert in the request a reference location of the user, when network-provided location information is not already present. The reference location (e.g. line identification) is determined by the operator as part of the user profile and may be received from the HSS at registration.\n6.\tThe media stream capabilities of the destination are returned along the signalling path, per the S-S procedures.\n7-9.\tS‑CSCF forwards the Offer Response message to the P‑CSCF which triggers RACS. RACS performs admission control based on the Offer and Answer parameters.RACS configures the connections in the C‑BGF based on the SDP answer and optionally requests a NAT binding list.\n10.\tUE decides the offered set of media streams for this session, confirms receipt of the Offer Response and sends the Response Confirmation to P‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response received in step 9 or a subset. If new media are defined by this SDP, a new connection configuration shall be performed following step 2. The originating UE is free to continue to offer new media in this request or in subsequent requests using the Update method. Each offer/answer exchange will cause the P‑CSCF to repeat the RACS interactions again.\n11.\tP‑CSCF forwards this message to S‑CSCF\n12.\tS‑CSCF forwards this message to the terminating endpoint, as per the S-S procedure.\n13.\tThe terminating end point responds to the originating end with an acknowledgement. If Optional SDP is contained in the Response Confirmation, the Confirmation Acknowledge will also contain an SDP response. If the SDP has changed, the admission control and configure connection flows are repeated.\n14-15.\tS‑CSCF and P‑CSCF forward the answered media towards the UE.\n16-18.\tThe destination UE may optionally perform alerting. If so, it signals this to the originating party by a provisional response indicating Ringing. This message is sent to S‑CSCF per the S-S procedure. It is sent from there toward the originating end along the signalling path. UE indicates to the originating user that the destination is ringing.\n19-20.\tWhen the destination party answers, the terminating endpoint sends a SIP 200-OK final response along the signalling path to the originating endpoint, as specified by the termination procedures and the S-S procedures.\n21.\tP‑CSCF performs the approval of QoS Commit procedure which triggers the Open Gates procedures if required.\n22.\tP‑CSCF passes the 200-OK response back to UE.\n23.\tUE starts the media flow(s) for this session.\n24-26.\tUE responds to the 200 OK with an ACK message which is sent to P‑CSCF and passed along the signalling path to the terminating endpoint.\nN.2\tTermination procedures\nN.2.1\t(FT#1) Fixed xDSL termination, home\nNOTE:\tThe below flows are example flows. The detailed stage 2 description of the RACS information flows can be found in ETSI ES 282 003 [78].\nThis termination procedure applies to users located in their home service area. As in clause 5.7.2, the UE is located in the home network, but has registered to the IM CN Subsystem via an xDSL IP‑CAN.\nFigure N.2.1: Fixed xDSL terminating - home (example flow)\nProcedure FT#1 is as follows:\n1.\tUE#1 sends the SIP INVITE request, containing an initial SDP, via one of the origination procedures and the S‑S procedures, to the S‑CSCF for the terminating UE.\n2.\tS‑CSCF validates the service profile, and invokes any termination service logic required. This includes authorization of the requested SDP based on the user's subscription for multi-media services.\n3.\tS‑CSCF remembers (from the registration procedure) the P‑CSCF address for this UE. The S‑CSCF forwards the INVITE to the P‑CSCF, which in this case is located in the home network.\n4.\tThe P‑CSCF triggers RACS which reserves a connection in C‑BGF with optional NAT binding retrieval.\n5.\tP‑CSCF remembers (from the registration procedure) the UE address, and forwards the INVITE to the UE.\n6.\tUE determines the subset of the media flows proposed by the originating endpoint that it is capable and willing to support, and responds with an Offer Response message back to the originator. The SDP may represent one or more media for a multi-media session. This response is sent to the P‑CSCF.\n7.\tP‑CSCF triggers RACS to perform admission control based on Offer and Answer parameters.RACS configures the connection in the C‑BGF based on SDP answer with optional NAT binding retrieval.\n8.\tP‑CSCF forwards the Offer Response message to S‑CSCF.\n9.\tS‑CSCF forwards the Offer Response message to the originator, per the S‑S procedure.\n10-15.\tThe originating endpoint sends a Response Confirmation via the S‑S procedure, to the terminating S‑CSCF. The Response Confirmation may also contain SDP. This may be the same SDP as in the Offer Response sent in step 19 or a subset. If new media are defined by this SDP, a new interaction with the RACS (as in steps 4‑8) will be done by the P‑CSCF. The originating UE is free to continue to offer new media in this request or in a subsequent request using the Update method. Each offer/answer exchange will cause the P‑CSCF to repeat the RACS interactions (steps 4-8) again.\n16-18.\tUE may alert the user and wait for an indication from the user before completing the session. If so, it indicates this to the originating party by a provisional response indicating Ringing. This message is sent to P‑CSCF and along the signalling path to the originating endpoint.\n19.\tWhen the destination party answers, UE sends a SIP 200 OK final response to P‑CSCF.\n20.\tP‑CSCF indicates that the resources reserved for this session should now be committed.\n21-22.\tP‑CSCF forwards the 200 OK to S‑CSCF, following the signalling path.\n23-25.\tThe session originator responds to the 200 OK by sending the ACK message to S‑CSCF via the S‑S procedure and it is forwarded to the terminating end along the signalling path.\nN.3\tGeographical Identifier\nFor fixed xDSL, Fiber or Ethernet access, Geographical Identifier may be used within the IMS as described in clause E.8.\nAnnex P (informative):Transcoding Support involving the MRFC/MRFP\nP.1\tGeneral\nP.1.1\tScope\nThis clause describes media transcoding services involving the MRFC/MRCP applicable in the following cases:\n-\tbetween two IMSs;\n-\tbetween an IMS and other SIP based multimedia network; and\n-\tinternal to an IMS servicing media endpoints with different media encoding requirements. This can arise due to support of different access technologies (e.g. wireline-wireless interworking, or support of non-3GPP wireless technologies), or from divergence in supported or allowed media encoding formats (e.g. configuration of devices to only allow certain codecs).\nThe MRFC and MRFP act as transcoding entity in an IMS solving media encoding mismatches due to codec selection between operator networks, as well as to deal with encoding formats in a converged service environment.\nP.1.2\tDescription\nApplication Servers can invoke the MRFC for the purpose of media transcoding between UEs that have no supported codec in common. The MRFC controls functionality in the MRFP to perform media plane transcoding.\nThe decision to perform media transcoding requires knowledge of the codecs supported by the calling and called UEs. Media transcoding services can be triggered proactively (before the session request is sent to the called UE) or reactively (after the session request has been sent to, and rejected by, the called UE). Proactive transcoding invocation requires prior knowledge of the codecs supported by the UE at which the called party is registered. In the case of reactive transcoding the list of codecs supported by the called UE is carried in the SIP response message.\nNOTE:\tCalling and called UEs can be in an IMS or in a CS network. SIP requests are sent by either the called UE or a network entity acting on behalf of the calling UE. SIP requests are answered by either the called UE or a network entity acting on behalf of the called UE.\nP.1.3\tSession flows\nP.1.3.1\tGeneral\nThe following use cases illustrate session procedures involving the MRFC required to support transcoding between UEs due to error cases or incompatible terminal equipment. In addition, transcoding procedures are applicable to both the originating and the terminating side of the session or even (in inter-network scenarios) in a transit network, and are subject to bilateral agreements and operator configuration. A media transcoding session refers to a SIP session between an entity in the IMS control plane (hereafter referred to as the \"invoking function\") and the MRFC/MRFP as actual transcoding device, setup for the purpose to mediate between calling and called UEs. The SIP session between the invoking function and the MRFC is used to reserve resources at the transcoding unit, in this case the MRFP, and to exchange transport address and port information. The session flows described here have been simplified by abbreviating the message exchange, e.g. by eliminating 100 trying messages. Similar session flows are available in Annex B of TS 23.218 [71].\nP.1.3.2\tProactive transcoding invocation\nAs noted above, proactive transcoding invocation requires prior knowledge of the codecs supported by the UE at which the called party is registered. At session initiation the calling UE capabilities are contained in the SDP offer, while called UE capabilities can be either preconfigured or known by other means in the network (e.g. if the control plane entity responsible for detecting the need of transcoding previously learned the codecs supported by the UE that is now called by monitoring session requests initiated by it).\nThe following session flow illustrates proactive media transcoding:\nFigure P.1.3.2-1: Proactive transcoding triggering logic\n1.\tCalling UE sends a SIP request targeted at an address registered at the called UE, including an SDP offer containing codec(s) and the IP address and TCP or UDP port number at which the calling UE wishes to receive media.\n2.\tThe SIP request is received by an IMS control plane entity responsible for detecting the need of proactive transcoding invocation. If the SDP offer does not include any codec supported by the called UE, then the invoking function is triggered to set up a SIP session with the MRFC, providing codecs and transport parameters to initiate a transcoding session.\nNOTE 1:\tIf the codec(s) supported by the called UE are not known, or the SDP includes one of the codec(s) supported by the called UE, the SIP request is forwarded to the called UE without manipulation. This step is not illustrated in the figure.\n3.\tThe invoking function instructs the MRFC to:\n-\tallocate media processing resources from an MRFP entity under the MRFC's control, configured with the address and port at which the calling UE wishes to receive media, using a codec (say, codec-A) previously included by the calling UE in the SDP offer and hence known to be supported;\n-\tallocate media processing resources from the same MRFP entity to the called UE, using a codec (say, codec-B) known to be supported by the called UE; and\n-\tcause the MRFP entity to bridge those two media flows, such that media received on one will be converted to the format of and transmitted on the other.\nThe MRFC accepts the transcoding request and contacts an MRFP to allocate the requested resources. The MRFP responds with the IP address and port number associated with each requested codec. The MRFC returns this information to the invoking function.\n4.\tThe invoking function updates the SIP request received in step 1 by appending codec-B to the list of codecs in the SDP offer (after all codecs that were previously in the offer), and altering the transport address and port information to indicate the addresses associated by the MRFP with its resources of type codec-B.\n5.\tCalled UE acknowledges the SDP offer and makes a codec selection (codec-B), providing also its actual IP address/port number information in the SDP answer.\n6.\tUpon receipt of the answer from the called UE, the invoking function updates the session with the MRFC (providing the codec selected and the address /port information from the SDP answer). The MRFC processes the received information to configure the transcoding unit with the codec, the destination address and port towards the called UE.\n7.\tThe invoking function modifies the SDP answer to reference codec-A, and the transport address and port information to indicate the addresses associated by the MRFP with its resources of type codec-A. The invoking function forwards the SIP message containing the SDP answer to the calling UE.\nNOTE 2:\tIf the invoking function determines that the called UE has selected a codec from the original SDP offer, it will inform the MRFC to release the transcoding resources allocated in step 3, send a new SIP request to the called UE to change the transport address and port information to those of the calling UE, and forward the unmodified SDP answer to the calling UE. These steps are not illustrated in the figure.\nP.1.3.3\tReactive transcoding invocation\nReactive invocation of media transcoding is useful in the case that the calling and called UE support no common codec, and for whatever reason transcoding is not proactively invoked. In this case the SDP offer received by the called UE contains no codecs that the called UE supports. The called UE will answer with an appropriate SIP error response, which can include information about actually supported codecs. Transcoding invoked in response to receipt of such an error response is termed Reactive.\nThe following example session flow describes reactive invocation of media transcoding:\nFigure P.1.3.3-1: Reactive transcoding triggering logic\n1.\tCalling UE sends a SIP request, including an SDP offer containing codec(s) and the IP address and TCP or UDP port number at which calling UE wishes to receive media. For some reason, e.g. because proactive invocation of media transcoding is not supported in the terminating network, transcoding is not proactively invoked.\n2.\tThe called UE or a terminating network entity (such as MGCF) determines that it does not support any codec in the SDP offer and answers with an appropriate error response. This response can include a list of codecs that the called UE can support.\n3.\tBased on the response from called UE indicating that it does not support the offered codecs, an IMS control plane entity responsible for detecting the need of reactive transcoding invocation triggers the invoking function to set up a SIP session with the MRFC, providing codecs and transport parameters to initiate a transcoding session.\n4.\tThe invoking function instructs the MRFC to:\n-\tallocate media processing resources from an MRFP entity under the MRFC's control, configured with the address and port at which the calling UE wishes to receive media, using a codec (say, codec-A) previously included by calling UE in the SDP offer hence known to be supported by calling UE;\n-\tallocate media processing resources from the same MRFP entity to called UE, using a codec (say, codec-B) known to be supported by called UE; and\n-\tcause the MRFP entity to bridge those two media flows, such that media received on one will be converted to the format of and transmitted on the other.\nThe MRFC accepts the transcoding request and contacts an MRFP to allocate the requested resources. The MRFP responds with the IP address and port number associated with each requested codec. The MRFC returns this information to the invoking function.\n5.\tBased on the information received from the MRFC, the invoking function creates a new SDP offer that contains the information provided by the MRFC (codec and transport addresses). If no information about supported codecs was available from the error response, the invoking function offers all codecs supported by the transcoding device. It sends this offer to the called UE.\n6.\tCalled UE acknowledges the SDP offer and makes a codec selection, providing in the SDP answer the IP address and TCP or UDP port at which it wants to receive media.\n7.\tUpon receipt of the answer from the called UE, the invoking function updates the session with the MRFC (providing the codec selected and the address /port information from the SDP answer). The MRFC processes the received information to configure the transcoding unit with the codec, the destination address and port towards the called UE.\n8.\tThe invoking function modifies the SDP answer received from the called UE such that it refers to codec-A and the MRFP address and port number associated with it in step 4, and sends this message to the calling UE. The session between the end points is now established with the media flow traversing the transcoding device.\nAnnex Q (normative):Optimal media routing\nQ.1\tGeneral\nThe purpose of optimal media routing (OMR) is to identify and remove unnecessary media functions from the media path for each media stream associated with a session.\nThe IP Multimedia Subsystem has the option to deploy media functions such as TrGWs on the media path associated with each media stream associated with a session. These media functions can perform only transport level functions such as firewall or NAT, or can also perform application level functions such as transcoding or conferencing. These media functions are typically allocated proactively during SDP offer/answer signalling within a session since it is unknown which of the functions are actually needed for a media stream until the SDP offer/answer signalling completes. For example, a transcoder can be allocated during session establishment but whether transcoding is needed is determined once the SDP offer reaches the far endpoint. In another example, the IBCFs at the boundary of a network allocate TrGWs to protect media functions within the network or to provide address translation to the private address space used within the network, however it might be determined later during session establishment that no media resources are needed within the network, thus making the TrGWs unnecessary.\nAny SIP signalling entity within the IMS network that allocates, to a session flow, a media function that might later be determined to be unnecessary may implement the procedures in this Annex to assist in the removal of unnecessary media functions. In particular, any entity with an IMS-ALG may implement the OMR algorithm. This includes the IBCF (see Annex I) and P-CSCF (see Annex G). Any AS performing as a B2BUA controlling media resources may also implement the OMR procedures. Annex Q shows every controlling OMR entity as an IMS-ALG and every controlled media resources as a TrGW, but other options are possible. An MGCF or AS performing as UA may also implement OMR procedures to assist in the removal of unnecessary media functions in some cases. MGCF and AS procedures can be derived from the procedures in this annex by collocating an IMS-ALG with the MGCF or AS.\nThe OMR procedures identify and name the IP address realm used for each media path segment among UAs and TrGWs. The terms IP realm and realm are equivalent to the term IP address realm in this annex. An IP realm name is associated with each set of IP endpoints that are mutually reachable via IP routing and without address translation. Endpoints in different IP realms usually require allocation of a TrGW between those IP realms for connectivity and possibly for NAT.\nWhen endpoints in different IP realms are mutually reachable without allocation of a TrGW, then OMR procedures may use provisioned information about such connected IP realms to determine possible optimal media paths through these connected realms.\nNOTE:\tConnected IP realms are particularly useful when there are bilateral IP transport connections between operator networks, e.g. using IP tunnels via IP transport networks. In this case, each operator network can manage its own IP realm for inter-operator interconnection and provision the names of connected IP realms. Without the concept of connected IP realms, each bilateral connection (e.g. IP tunnel) in this example would need to be defined as its own IP realm.\nIMS-ALGs implementing OMR shall include information in forwarded SDP regarding IP realm, codec and IP connectivity information for TrGWs on the media path to assist in bypassing unnecessary TrGWs. A TrGW can be bypassed when it is not required to transcode, when it is unnecessary to protect a network resource, and when a successive TrGW on the path is reachable by a previous TrGW on the path via a common IP realm.\nThe OMR procedures have the following additional characteristics:\n-\tThey build on the ALG NAT traversal model that is an alternative to the ICE NAT traversal model.\n-\tThey usually complete within a single end-to-end SDP offer/answer transaction. Some transcoding scenarios require additional signalling to complete optimisation.\n-\tThey apply independently to each media stream established by an SDP offer/answer transaction.\n-\tThey apply to media streams established between any types of endpoints (e.g. UEs, media servers, media gateways).\n-\tThey apply to media streams established using SIP 3pcc procedures. OMR applies to the endpoints of an SDP offer/answer transaction and not necessarily to the endpoints of a SIP dialog.\n-\tThey apply separately to each dialog when forking occurs. An IMS-ALG shall delay the release of a TrGW for OMR until it is clear that no forked dialog needs the TrGW.\n-\tFor early media negotiated with the same SDP as normal media, the OMR procedures have no direct impact on early media handling since path modifications are in place as soon as the SDP offer/answer transaction completes. An IMS-ALG can anchor in place any TrGW needed for blocking of unauthorized early media by removing OMR SDP extension attributes as necessary. For separate early-session disposition SDP the OMR algorithm shall not be applied.\n-\tThey do not require endpoints to support new procedures, although some additional optimisations are possible in some special cases.\nQ.2\tProcedures and flows\nQ.2.1\tSDP extension\nEach OMR-capable entity on the signalling path of an SDP offer/answer transaction shall be able to manipulate an SDP offer to describe the following information about the IP realm associated with each known media path segment for each media line:\n-\ta unique name for the IP realm on the subsequent media path segment,\n-\tthe position of the IP realm instance in the media path,\n-\tconnection/port data for the corresponding media resource in the IP realm on the subsequent media path segment,\n-\tsufficient information to reconstruct the codec list for the previous media path segment if the codec list has changed (e.g. to offer transcoding options).\nEach instance of such information is called an IP realm instance. Each IP realm instance associated with a media line in an SDP offer is a visited realm instance. If a signalling entity on the path controls a media resource with connection to an alternate IP realm not already associated with a media line, the SDP may also include the same information about the alternate IP realm, called a secondary realm instance.\nAn OMR-capable entity that forwards an SDP offer with OMR specific attributes for a media line shall ensure that the forwarded SDP offer includes a visited realm instance that matches the connection information for the media line in the forwarded SDP offer. This SDP offer shall also include information that makes it possible for a subsequent OMR-capable entity to detect if an intermediate entity has changed any codec information for the media line without also changing the connection and port information for the media line.\nTo bypass one or more previous TrGWs for a media line, an IMS-ALG shall include an IP realm instance with valid connection information for the earliest acceptable IP realm in the forwarded SDP answer. It shall be possible to identify the visited or secondary realm instance from the SDP offer that corresponds to the IP realm instance in the SDP answer.\nGlobally reachable IPv6 addresses shall be associated with a reserved realm name to assure that networks are not artificially isolated. Globally reachable IPv4 addresses shall be associated with another reserved realm name. Networks with private or restricted reachability shall have unique realm names.\nQ.2.2\tGeneral IMS-ALG procedures\nIMS-ALGs supporting OMR shall be able to support the call flows in clauses Q.2.4 and Q.2.5 according to local policy. These call flows describe the simplest scenarios and should be treated as examples. It shall be possible to support the addition of IMS-ALGs and TrGWs in any flow between any of the entities shown whenever such additions are reasonable. It shall be possible to support any interconnection of these flows whenever it is reasonable to do so. Additional information can be present in the forwarded SDP messages to support these more complex scenarios.\nThe following high level procedures apply to all of the scenarios.\nUpon receiving an initial SDP offer, the IMS-ALG in the signalling path shall perform the following for each media line:\n-\tIf the SDP offer includes realm instance information for the media line, and the latest visited realm instance is not for the connection information in the incoming SDP offer, then the IMS-ALG shall remove all OMR specific SDP attributes from the SDP offer.\nNOTE:\tA non-OMR-capable IMS-ALG might have inserted a TrGW without removing unrecognized OMR specific SDP attributes.\n-\tIf the SDP offer includes realm instance information that corresponds to the connection information in the incoming SDP offer, then the IMS-ALG shall attempt to verify that no intermediate entity has changed the codec information in the SDP offer since it was generated by the previous OMR-capable entity. If the IMS-ALG cannot verify that the codec information is unchanged, it shall remove all OMR specific SDP attributes from the SDP offer.\n-\tDetermine according to local policy if a TrGW is required in the user plane path for a purpose unrelated to transcoding or NAT, e.g. lawful intercept. Visited realm and secondary realm instances for previous user plane segments shall be removed to prevent subsequent signalling entities from bypassing the media resource.\n-\tBased on the outgoing IP realm, IP realm accessibility from controlled TrGWs, and information from visited realm and secondary realm instances in the received SDP offer, the IMS-ALG shall determine whether to allocate a TrGW and whether one or more previous TrGWs can be bypassed. If transcoding is also supported, the IMS-ALG may also consider whether to modify the codec set, move the transcoding point, and which transcoding procedure to apply, if any.\n-\tAllocate a TrGW and transcoder as necessary. If the IMS-ALG allocates a transcoder, it shall include information about the transcoding options in the visited realm instance for the outgoing realm.\n-\tOptionally allocate one or more secondary TrGWs according to local policy.\n-\tForward the SDP offer after modifying the connection, port, codec, visited realm instances, and secondary realm instances as appropriate. If the IMS-ALG added a TrGW it shall:\n-\tAdd a visited realm instance with the connection/port and IP realm on the the previous media path segment if no visited realm instances have been received and local policy allows potential bypass of the TrGW by subsequent entities.\n-\tAdd a visited realm instance with the connection/port and IP realm on the the subsequent media path segment.\nUpon receiving an initial SDP answer, the IMS-ALG in the signalling path shall perform the following for each media line:\n-\tBased on the selected codec, connection information and IP realm instances in the SDP answer, and information from the received SDP offer, the IMS-ALG shall determine whether to deallocate any TrGW(s) and whether a second SDP offer/answer transaction is needed to send updated connection information towards the SDP answerer.\n-\tInitiate and complete the second SDP offer/answer transaction if required.\n-\tDetermine how to modify the forwarded SDP answer to signal the bypass of previous TrGWs/transcoders, if any.\n-\tDeallocate any unused TrGW/transcoder as necessary.\n-\tForward the modified SDP answer to signal other TrGW bypass decisions.\nThe end-to-end user plane path selected via the OMR procedures during the initial SDP offer-answer exchange should not be modified by subsequent SDP offer-answer exchanges, unless the new SDP offer-answer exchanges requires a new media path (e.g. transcoding, adding media, playing announcements).\nNOTE:\tIf the media path is changed, there is a risk of speech gaps and/or media drops during the media path switch.\nQ.2.3\tCommon flows\nQ.2.3.1\tIMS-ALG allocates a TrGW\nWhen an IMS-ALG allocates a TrGW during forwarding of an SDP offer without performing any media optimisations and is not bypassed during subsequent processing of the SDP answer, OMR has no impact on the standard call flow except for the addition of some SDP extension information to the SDP messages.\nIf an IMS-ALG does not support OMR then it will treat all OMR extension attributes as unrecognized SDP information.\nIf an IMS-ALG that does not support OMR inserts a TrGW in the media path and removes unrecognized OMR attributes from the SDP before forwarding, then the IMS-ALG will remove any OMR extension attributes from the forwarded SDP, thus effectively anchoring its TrGW in the media path and preventing further optimisation of the user plane segment prior to this point.\nIf an IMS-ALG that does not support OMR inserts a TrGW in the path without removing unrecognized OMR attributes, then the subsequent OMR-capable entity in the signalling path shall remove OMR extension attributes from the SDP offer before handling.\nQ.2.3.2\tIMS-ALG does not allocate a TrGW\nWhen an IMS-ALG does not allocate a TrGW during forwarding of an SDP offer and does not perform any media optimisations during processing of either the SDP offer or SDP answer, it transparently passes any SDP extensions for OMR in forwarded SDP messages. OMR has no impact on the standard call flow except for the addition of some SDP extension information to the SDP messages.\nIf an IMS-ALG that does not support OMR and does not allocate a TrGW upon receipt of an SDP offer transparently forwards the SDP offer, including unrecognized SDP attributes related to OMR, then it is possible for other OMR-compliant IMS-ALGs to perform user plane optimisations.\nIf an IMS-ALG that does not support OMR and does not allocate a TrGW upon receipt of an SDP offer removes unrecognized SDP attributes from the forwarded SDP offer, then further optimisation of the user plane segment prior to this point is not possible.\nQ.2.3.3\tIMS-ALG bypasses its TrGW and one or more prior TrGWs\nFigure Q.1 applies when an IMS-ALG (IMS-ALG2) recognizes that it can avoid allocating a TrGW because an address for the outgoing IP realm is already available from a previous user plane segment. Thus it can bypass its own TrGW and one or more prior TrGWs. A common application of this scenario is when realm R1 is the internet and realm R2 is a private network isolated by the two IMS-ALGs. If no media resources are required within the network of realm R2 then there is no need to allocate TrGWs. IMS-ALG1 must initially allocate a TrGW since it does not know the ultimate destination of the SDP offer.\nNOTE:\tRealm instances shown in italics in this and subsequent figures indicate their optionality. For example, an SDP offer from a UE will contain no realm instances.\nFigure Q.1: IMS-ALG bypasses its TrGW and one or more prior TrGWs\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1. If realm instances are included in the received SDP offer, the IMS-ALG1 (and subsequent IMS-ALGs) verify that intermediate signalling entities have not modified the SDP.\n2.\tIMS-ALG1 allocates TrGW1 to provide a NAT between R1 and R2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both the incoming and outgoing realms. IMS-ALG1 creates a new visited realm instance for the incoming realm if it was not present in the received SDP offer.\n4.\tSince an IP address already exists within a visited realm instance for the outgoing realm R1, the IMS-ALG2 can avoid allocating a TrGW and can bypass a previous TrGW1.\n5.\tIMS-ALG2 forwards connection information from the SDP offer in step 1 (IP1), which is valid in the outgoing realm R1. The forwarded SDP offer retains those IP realm instances that remain connected to the media path.\n6.\tIMS-ALG2 receives an SDP answer with valid connection information (IP3) in realm R1.\n7.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the connection information from the SDP answer in step 6. The IP realm instance in the SDP answer identifies a corresponding realm instance from the SDP offer associated with the same IP realm, thus uniquely identifying the TrGWs to be bypassed. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n8.\tIMS-ALG1 de-allocates TrGW1 since there is no valid connection information available in the SDP answer for realm R2.\n9.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP realm instance received in step 7.\n10.\tA user plane connection is now established in realm R1 without the need to allocate any additional TrGWs.\nQ.2.3.4\tIMS-ALG bypasses its TrGW using secondary realm from prior IMS-ALG\nFigure Q.2 applies when an IMS-ALG (IMS-ALG2) recognizes that it can avoid allocating a TrGW by using a secondary realm instance from a prior IMS-ALG.\nFigure Q.2: IMS-ALG bypasses its TrGW using secondary realm from prior IMS-ALG\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1.\n2.\tIMS-ALG1 allocates TrGW1 to provide a NAT between R1 and R2. IMS-ALG1 also allocates TrGW2 to provide a NAT between R1 and alternate realm R3.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx, visited realm instances for both the incoming and outgoing realms R1 and R2, and a secondary realm instance for realm R3.\n4.\tSince an IP address already exists within a secondary realm instance for the outgoing realm R3, the IMS-ALG2 can avoid allocating a TrGW.\n5.\tIMS-ALG2 forwards the SDP offer with connection information from the secondary realm instance received in step 3 (IP3), which is valid in the outgoing realm R3. The forwarded SDP offer retains those IP realm instances that remain connected to the media path.\n6.\tIMS-ALG2 receives an SDP answer with valid connection information (IP4) in realm R3.\n7.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the connection information from the SDP answer in step 6. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n8.\tIMS-ALG1 de-allocates TrGW1 since there is no valid connection information available in the SDP answer for realm R2. IMS-ALG1 retains TrGW2 to maintain the user plane connection via R3.\n9.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP address of the TrGW2 in realm R1.\n10.\tA user plane connection is now established with one segment in realm R1 and a second segment in realm R3, mediated by TrGW2.\nQ.2.3.5\tIMS-ALG bypasses one or more prior TrGWs using a secondary realm\nFigure Q.3 applies when an IMS-ALG (IMS-ALG2) determines that it must allocate a TrGW under its control but can bypass previously allocated TrGWs by allocating a TrGW with access to an alternate realm (not the incoming one) associated with an earlier user plane segment.\nFigure Q.3: IMS-ALG bypasses one or more prior TrGWs using a secondary realm\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1.\n2.\tIMS-ALG1 allocates TrGW1 to provide a NAT between R1 and R2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both the incoming and outgoing realms.\n4.\tIf IMS-ALG2 controls a TrGW (TrGW2) with access to realm R1, then IMS-ALG2 can use the visited realm instance for R1 to establish the incoming user plane segment, rather than using the connection information for TrGW1 from the received SDP offer in step 3. IMS-ALG2 allocates TrGW2 to provide a NAT between alternate realm R1 and realm R3.\n5.\tIMS-ALG2 forwards the SDP offer with connection information for TrGW2 in realm R3 along with IP realm instances Rx and the visited realm instances for R1 and R3.\n6.\tIMS-ALG2 receives an SDP answer with valid connection information (IP4) in realm R3.\n7.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the TrGW2 address in realm R1. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n8.\tIMS-ALG1 de-allocates TrGW1 since there is no valid connection information available in the SDP answer for realm R2.\n9.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP address of the TrGW2 in realm R1.\n10.\tA user plane connection is now established with one segment in realm R1 and a second segment in realm R3, mediated by TrGW2.\nQ.2.3.6\tIMS-ALG bypasses TrGWs performing NAT traversal\nFigure Q.4 applies when an IMS-ALG (IMS-ALG2) that is performing NAT traversal for a terminating UA recognizes that the offering UA is in the same private realm behind a NAT, so that all TrGWs can be bypassed and a direct user plane connection established between the endpoints.\nFigure Q.4: IMS-ALG bypasses TrGWs performing NAT traversal\n1.\tIMS-ALG1 receives an SDP offer from UA1 in private realm R1 behind a NAT.\n2.\tIMS-ALG1 allocates TrGW1 to provide NAT traversal between private realm R1 and realm R2. TrGW1 can only be bypassed if the answering UA2 is in the same private realm R1.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with visited realm instances for the private realm R1 for UA1, and the outgoing realm R2.\n4.\tSince an IP address already exists within the visited realm instance for the private realm R1 for UA2, the IMS-ALG2 can avoid allocating a TrGW and can bypass a previous TrGW1.\n5.\tIMS-ALG2 forwards connection information from the SDP offer in step 1 (IP1), which is valid in the outgoing private realm R1 behind the NAT.\n6.\tIMS-ALG2 receives an SDP answer with valid connection information (IP3) in realm R1.\n7.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the connection information from the SDP answer in step 6. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n8.\tIMS-ALG1 de-allocates TrGW1 since there is no valid connection information available in the SDP answer for realm R2.\n9.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP realm instance received in step 7.\n10.\tA user plane connection is now established in realm R1 without the need to allocate any TrGWs.\nQ.2.5\tFlows with transcoding\nQ.2.5.1\tProactive transcoding where transcoding is required\nWhen an IMS-ALG supporting OMR allocates a TrGW during forwarding of the SDP offer for proactive transcoding with resource reservation, if subsequent IMS-ALGs do not replace the transcoder and the answering side signals in the SDP answer that transcoding is required, then the IMS-ALG retains the TrGW for transcoding and anchors it in the user plane path. The call flow is the same as the usual call flow for TrGW insertion except for the addition of some SDP extension information to the SDP messages.\nQ.2.5.2\tProactive transcoding where transcoding not required\nFigure Q.5 applies when IMS-ALG1 allocates a TrGW during forwarding of the SDP offer for proactive transcoding with resource reservation, IMS-ALG1 is the last signalling entity on the path before UA2, and UA2 signals in the SDP answer that transcoding is not required. UA2 ignores unrecognized OMR extension attributes.\nA second SDP offer/answer transaction is required to remove the transcoder from the path.\nAs an alternative to the procedure shown, the IMS-ALG1 may forward connection information for a prior user plane segment without transcoding options while including an IP realm instance for the transcoding TrGW. This alternative avoids a second SDP offer/answer transaction if transcoding is not required, but does include a second SDP offer/answer transaction if transcoding is required.\nNOTE:\tRealm instances shown in bold in this and subsequent figures include codec change information.\nFigure Q.5: Proactive transcoding where transcoding not required\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1. The realm instances in this and other messages in the figure are shown in italics to indicate their optionality. For example, an SDP offer from a UE will contain no realm instances. If realm instances are included in the received SDP offer, the IMS-ALG1 (and subsequent IMS-ALGs) verify that intermediate signalling entities have not modified the SDP.\n2.\tIMS-ALG1 allocates TrGW1 to offer transcoding options to UA2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both its incoming and outgoing user plane segments. IMS-ALG1 creates a new visited realm instance for the incoming realm if it was not present in the received SDP offer. The visited realm instance for the outgoing side includes information about the codec changes associated with TrGW1.\n4.\tUA2 selects one of the original codecs, i.e. transcoding is not needed. In response to the SDP offer, UA2 sends an SDP answer to IMS-ALG1 with connection information for its address in realm R1.\n5.\tIMS-ALG1 determines that the transcoder is not needed and forwards a second SDP offer to UA2 with connection information from a prior realm. This SDP offer includes those IP realm instances that remain options without transcoding.\n6.\tUA2 updates its remote connection information and responds with a new SDP answer.\n7.\tIMS-ALG1 de-allocates TrGW1.\n8.\tIMS-ALG1 forwards the SDP answer with connection information for UA2 in realm R1.\n9.\tA user plane connection is now established in realm R1 without use of any TrGWs.\nQ.2.5.3\tIMS-ALG bypasses prior unrequired proactive transcoder\nFigure Q.6 applies when IMS-ALG1 allocates a TrGW during forwarding of the SDP offer for proactive transcoding with resource reservation, another IMS-ALG (IMS-ALG2) is the last signalling entity on the path before UA2, IMS-ALG2 must allocate a TrGW to provide NAT, and UA2 signals in the SDP answer that transcoding is not required. There may be additional IMS-ALGs between IMS-ALG1 and IMS-ALG2.\nThis scenario avoids the need for a second SDP offer/answer transaction as required in clause Q.2.5.3 and clause Q.2.5.5. IMS-ALG2 signals to IMS-ALG1 in the SDP answer to bypass the transcoder.\nFigure Q.6: IMS-ALG bypasses prior unrequired proactive transcoder\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1.\n2.\tIMS-ALG1 allocates TrGW1 to offer transcoding options to UA2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both its incoming and outgoing user plane segments. The visited realm instance for the outgoing side includes information about the codec changes associated with TrGW1.\n4.\tIMS-ALG2 allocates TrGW2 to provide a NAT between R1 and R2.\n5.\tIMS-ALG2 forwards the SDP offer with connection information for TrGW2 in realm R2 along with IP realm instances for prior user plane segments.\n6.\tUA2 selects one of the original codecs, i.e. transcoding is not needed. In response to the SDP offer, UA2 sends an SDP answer to IMS-ALG2 with connection information for its address in realm R2.\n7.\tIMS-ALG2 determines that transcoding is not necessary.\n8.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the TrGW2 address in realm R1. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n9.\tIMS-ALG1 de-allocates transcoder TrGW1 since there is no valid connection information available in the SDP answer.\n10.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP address of the TrGW2 in realm R1.\n11.\tA user plane connection is now established with one segment in realm R1 and a second segment in realm R2, mediated by TrGW2.\nQ.2.5.4\tIMS-ALG bypasses its TrGW and prior unrequired proactive transcoder\nFigure Q.7 applies when IMS-ALG1 allocates a TrGW during forwarding of the SDP offer for proactive transcoding with resource reservation, another IMS-ALG (IMS-ALG2) is the last signalling entity on the path before UA2, IMS-ALG2 does not need to allocate a TrGW to provide NAT, and UA2 signals in the SDP answer that transcoding is not required. There may be additional IMS-ALGs between IMS-ALG1 and IMS-ALG2.\nA second SDP offer/answer transaction is required to remove the transcoder from the path. The scenario allows IMS-ALG2 to initiate the second SDP offer/answer transaction rather than requiring IMS-ALG1 to do this, thus saving some messaging.\nAs an alternative to the procedure shown, the IMS-ALG1 may forward connection information for a prior user plane segment without transcoding options while including an IP realm instance for the transcoding TrGW. This alternative avoids a second SDP offer/answer transaction if transcoding is not required, but does include a second SDP offer/answer transaction if transcoding is required.\nFigure Q.7: IMS-ALG bypasses its TrGW and prior unrequired proactive transcoder\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1.\n2.\tIMS-ALG1 allocates TrGW1 to offer transcoding options to UA2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both its incoming and outgoing user plane segments. The visited realm instance for the outgoing side includes information about the codec changes associated with TrGW1.\n4.\tIMS-ALG2 does not allocate a TrGW since its incoming and outgoing realms are compatible.\n5.\tIMS-ALG2 forwards the SDP offer with no changes.\n6.\tUA2 selects one of the original codecs, i.e. transcoding is not needed. In response to the SDP offer, UA2 sends an SDP answer to IMS-ALG2 with connection information for its address in realm R1.\n7.\tIMS-ALG2 determines that transcoding is not necessary and sends a second SDP offer with the connection information from the visited realm instance for a prior user plane segment. This SDP offer includes those IP realm instances that remain options without transcoding.\n8.\tUA2 updates its remote connection information and responds with a new SDP answer.\n9.\tIMS-ALG2 determines that the prior transcoder is to be bypassed.\n10.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the UA2 address in realm R1. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n11.\tIMS-ALG1 de-allocates transcoder TrGW1 since there is no valid connection information available in the SDP answer.\n12.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP address of UA2 in realm R1.\n13.\tA user plane connection is now established in realm R1.\nQ.2.5.5\tIMS-ALG replaces prior proactive transcoder\nFigure Q.8 applies when IMS-ALG1 allocates a TrGW during forwarding of the SDP offer for proactive transcoding with resource reservation, and a later IMS-ALG (IMS-ALG2) chooses to bypass the transcoding offered by IMS-ALG1 and optionally offer its own transcoding options. There may be additional IMS-ALGs between IMS-ALG1 and IMS-ALG2.\nThe flow assumes that TrGW2 must remain to providing transcoding or NAT. The call flow variant if TrGW2 is not needed can be derived by combining this flow with one of the other transcoding flows.\nAn IMS-ALG may remove codec options, or re-instate codec options removed by a previous IMS-ALG by bypassing that IMS-ALG's TrGW if allocated. The call flow continues to apply except that TrGW allocation is optional.\nFigure Q.8: IMS-ALG replaces prior proactive transcoder\n1.\tIMS-ALG1 receives an SDP offer from realm R1. The SDP offer can include IP realm instances Rx associated with prior user plane segments and can include a visited realm instance for incoming realm R1.\n2.\tIMS-ALG1 allocates TrGW1 to offer transcoding options to UA2.\n3.\tIMS-ALG1 forwards connection information for TrGW1 in the SDP offer along with prior IP realm instance information Rx and visited realm instances for both its incoming and outgoing user plane segments. The visited realm instance for the outgoing side includes information about the codec changes associated with TrGW1.\n4.\tIMS-ALG2 bypasses the prior transcoder and allocates TrGW2 to provide alternate transcoding options to UA2.\n5.\tIMS-ALG2 forwards the SDP offer with connection information for TrGW2 in realm R2 along with IP realm instances associated with all user plane segments. The forwarded SDP offer includes information about all potential transcoders so that a subsequent entity has the option to choose the earlier one if appropriate.\n6.\tIMS-ALG2 receives an SDP answer with connection information for a valid address in realm R2.\n7.\tIMS-ALG2 forwards the SDP answer to IMS-ALG1 after including an IP realm instance for the TrGW2 address in realm R1. The connection information in the forwarded SDP answer cannot be used by the receiving IMS-ALG to establish this segment of the media path.\n8.\tIMS-ALG1 de-allocates transcoder TrGW1 since there is no valid connection information available in the SDP answer.\n9.\tIMS-ALG1 forwards the SDP answer after modifying the connection information to correspond to the IP address of the TrGW2 in realm R1.\n10.\tA user plane connection is now established with one segment in realm R1 and a second segment in realm R2, mediated by TrGW2.\nQ.2.5.6\tProactive transcoding without resource reservation\nAn IMS-ALG performing proactive transcoding without resource reservation provides an indication in the forwarded SDP that an address is unavailable if transcoding is selected. Subsequent IMS-ALGs can replace this transcoder when forwarding the SDP offer according to the procedure in clause Q.2.5.6, but cannot insert a transcoding TrGW on behalf of the IMS-ALG performing proactive transcoding if needed. Thus the procedures in clause Q.2.5.4 and clause Q.2.5.5 do not apply. If transcoding is required, the IMS-ALG performs a procedure very similar to clause Q.2.5.3 to allocate the transcoding TrGW and signal its address to the answering side.\nQ.2.5.7\tReactive transcoding\nAn IMS-ALG performing reactive transcoding follows all OMR procedures when forwarding the initial SDP offer but does not allocate a transcoder. If the initial SDP offer is rejected due to lack of support for an offered codec, the IMS-ALG performing reactive transcoding will restart the OMR procedure with the answering side after allocating and anchoring a TrGW with transcoding. The IMS-ALG removes all prior visited realm and secondary realm instances from the SDP offer before forwarding.\nQ.3\tCharging\nCharging records shall include sufficient information to capture the allocation and/or bypass of TrGWs in the media path of an IMS session. If required by local configuration, charging records shall indicate whether the resulting user plane connection on either the incoming or outgoing leg of the IMS session traverses an IP realm different from its default IP realm (the IP realm traversed without OMR). If required by local configuration, charging records shall indicate whether a transcoder is inserted by the IMS-ALG.\nAnnex R (informative):Distribution of Network Provided Location Information within IMS\nR.1\tGeneral\nThis annex describes how the user location and/or UE Time Zone information can be further distributed to IMS entities once it has been retrieved by either P-CSCF or an IMS AS. The exact mechanism for how the user location and/or UE Time Zone information are obtained is not described in this annex.\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements (e.g. data retention, lawful interception) and/or in order to enable certain types of added value services based on the user's location.\nTo simplify the information flows, the IMS AS shown in the figures can represent several AS's. The CSCF represents the I-CSCF and/or the S-CSCF.\nFor the P-CSCF case in the originating side, the P-CSCF can, depending on operator policy, retrieve the user location and/or UE Time Zone information either before sending the INVITE towards the terminating side or upon reception of the SDP answer from the terminating side.\nThe transfer of the user location and/or UE Time Zone information within IMS signalling does not affect the transfer of any UE provided user location information. User location and/or UE Time Zone information provided in the signalling by the network will be distinguished from user location information provided by the UE.\nR.2\tSession Establishment/Modification at Mobile Origination - Location Info in Request\nThis information flow shows the procedure when operator policy requires the the user location and/or UE Time Zone information to be included within IMS session establishment/modification signalling before sending the INVITE towards the terminating side.\nFigure R.2 -1: Mobile origination (user location and/or UE Time Zone information included within INVITE)\n1.\tThe UE sends a SIP INVITE request. It can contain user location information provided by the UE.\n2.\tThe P-CSCF obtains the user location and/or UE Time Zone information from the access network.\n3.\tThe P-CSCF includes the user location and/or UE Time Zone information obtained from the access network and sends the INVITE towards the next hop together with the user location information provided by the UE.\n4.\tIf an AS is to be invoked for this session, the S-CSCF (or I-CSCF) sends the INVITE towards the AS, including the user location and/or UE Time Zone information (assuming the AS is in the same trust domain).\n5.\tThe AS sends the INVITE towards the S-CSCF, still containing the user location and/or UE Time Zone information.\n6.\tThe S-CSCF routes the INVITE towards the terminating side. The user location and/or UE Time Zone information may be removed or modified (e.g. to change location granularity to just indicate the serving PLMN) before routing outside the trust domain.\nR.3\tSession Establishment/Modification at Mobile Origination - Location Info in Response\nFigure R.3-1: Mobile origination (user location and/or UE Time Zone information included within Response Confirmation)\n1.\tThe UE sends a SIP INVITE request. It can contain user location information provided by the UE.\n2a.\tOptionally, the P-CSCF may start procedures to obtain the user location and/or UE Time Zone information from the access network at reception of SDP Offer in parallel with steps 2b to 7.\n2b.\tThe P-CSCF sends the INVITE towards the next hop.\n3.\tIf an AS is to be invoked for this session the S-CSCF (or I-CSCF) sends the INVITE towards the AS.\n4.\tThe AS sends the INVITE towards the S-CSCF.\n5.\tThe S-CSCF routes the INVITE towards the terminating side.\n6a.\tThe P-CSCF receives an SDP answer sent by the terminating side.\n6b.\tIf the P-CSCF did not initiate procedures to obtain the user location and/or UE Time Zone information from the access network at step 2a, it will initiate them. This step will be executed together with Authorization of QoS resources.\n6c.\tThe P-CSCF forwards the SDP answer to the UE.\n7.\tThe UE provides a response confirmation towards the P-CSCF.\n8.\tThe P-CSCF inserts the user location and/or UE Time Zone information provided by the access network in the response confirmation, and this is routed towards the terminating side in steps 9 - 11. The user location and/or UE Time Zone information may be removed or modified (e.g. to change location granularity to just indicate the serving PLMN) before routing outside the trust domain.\nR.4\tSession Establishment/Modification at Mobile Termination\nThis information flow shows the procedure when operator policy requires the user location and/or UE Time Zone information from the access network to be included within IMS session establishment/modification signalling before sending the response towards the originating side.\nFigure R.4-1: Mobile termination\n1.\tThe CSCF receives an incoming INVITE.\n2.\tThe CSCF send the INVITE to the P-CSCF.\n3.\tThe P-CSCF sends the INVITE to the UE.\n4.\tThe UE sends a response to the INVITE (the response can be either a provisional or final response). This can contain user location information provided by the UE.\n5.\tThe P-CSCF invokes procedures to obtain user location and/or UE Time Zone information from the access network. This step will be executed together with Authorization of QoS resources. In some scenarios, it might be possible to obtain or at least initiate the fetching of user location and/or UE Time Zone information already at step 3.\n6.\tThe P-CSCF adds the user location and/or UE Time Zone information obtained from the access network and sends the response towards the next CSCF, together with the user location information provided by the UE (if available).\n7-9. The response is routed towards the originating party. The user location and/or UE Time Zone information may be removed or modified (e.g. to change location granularity to just indicate the serving PLMN) before routing outside the trust domain.\nR.5\tSession Establishment/Modification - Location Information Distributed by IMS AS\nThe call flow in this clause describes the procedures to distribute user location and/or UE Time Zone information provided by the network within IMS session establishment/modification signalling when the retrieval of user location and/or UE Time Zone information is performed by an IMS AS.\nFigure R.5-1: User location and/or UE Time Zone information Distribution by an IMS AS\nTerminating Side:\n1.\tA SIP INVITE request is received bv an AS.\n2.\tThe INVITE is processed by the AS and returned to the S-CSCF.\nNOTE 1:\tIf the AS requires user location and/or UE Time Zone information for the service execution as such, the user location and/or UE Time Zone information can be fetched prior sending the INVITE to the next hop.\n3.\tThe SDP Answer is received by the AS.\n4.\tThe AS retrieves user location and/or UE Time Zone information from the access network via the HSS.\nThe HSS retrieves the requested information from the Access Network\nThe HSS/UDM may not be aware whether the UE is currently camping on 3GPP or Non 3GPP access and may need to request Location Information from the AMF, the MME, the SGSN and from the TWAN (via the AAA server in this last case).\nThe HSS provides the AS with the requested information. When the HSS has received multiple user location (from multiple access: 3GPP and non 3GPP), the HSS provides the AS with the most recent user location.\n5.\tThe AS includes the user location and/or UE Time Zone information obtained from the access network via the HSS and sends the SDP answer towards the S-CSCF.\nNOTE 2:\tThe S-CSCF may further distribute user location and/or UE Time Zone information to other ASs within the trust domain.\nOriginating Side:\n6.\tA SIP INVITE request is received by an AS.\n7.\tThe AS retrieves user location and/or UE Time Zone information from the access network via the HSS. The same procedures as described in steps 4a and 4b above apply.\n8.\tThe AS includes the user location and/or UE Time Zone information obtained from the access network via the HSS and sends the INVITE towards the S-CSCF.\nNOTE 3:\tThe S-CSCF can further distribute user location and/or UE Time Zone information to other ASs within the trust domain. The S-CSCF does not distribute the user location and/or UE Time Zone information to the P-CSCF.\nR.6\tSession Release\nThe call flows in this clause present the mobile or network initiated IMS session release for both the Mobile Originating (MO) side and the Mobile Terminating (MT) side valid when either P-CSCF or an IMS AS retrieve user location and/or UE Time Zone information from the access network.\nFigure R.6-1: IMS Session Release\nTerminating Side:\n1.\tA session release message which terminates the dialog, e.g. BYE, is received by the P-CSCF/IMS AS.\n2.\tThe P-CSCF/IMS AS invokes procedures to obtain the user location and/or UE Time Zone information from the access network. In the P-CSCF, this step will be executed together with the procedure to release corresponding QoS resources in the IP-CAN.\n3.\tThe P-CSCF/IMS AS forwards the BYE message to the UE or the S-CSCF respectively.\n4.\tThe UE/S-CSCF provides a response to the P-CSCF/IMS AS.\n5.\tThe P-CSCF/IMS AS inserts the user location and/or UE Time Zone information in the response confirmation, and this is routed towards IMS Core.\nOriginating Side:\n6.\tA session release message which terminates the dialog, e.g. BYE, is received by the P-CSCF/IMS AS.\n7.\tThe P-CSCF/IMS AS invokes procedures to obtain the user location and/or UE Time Zone information from the access network. In the P-CSCF, this step will be executed together with the procedure to release corresponding QoS resources in the IP-CAN.\n8.\tThe P-CSCF/IMS AS forwards the BYE message within IMS Core containing the user location and/or UE Time Zone information together with the user location information provided by the UE. The user location and/or UE Time Zone information may be removed or modified (e.g. to change location granularity to just indicate the serving PLMN) if routing outside the trust domain is needed.\n9-10.\tThe Session Release procedure is completed.\nAnnex S (normative):Business Trunking\nS.1\tGeneral\nThis annex describes the IMS architecture and procedures for support of IP‑PBX business trunking.\nTwo different modes of operation are supported\n-\tRegistration mode, or\n-\tStatic mode.\nIn both modes, the IP‑PBX can be provisioned as a subscriber in the HSS.\nIn registration mode, the IP‑PBX registers to and receives service from the IMS network as specified in TS 24.525 [81].\nThe architecture and procedures for an IP- PBX using static mode is described in clause S.2.\nS.2\tIP‑PBXs using static mode Business Trunking\nS.2.1\tHigh level architecture\nThe support for business trunking in static mode is provided by either an IBCF or a P‑CSCF.\nThe architecture for support of IP‑PBX in static mode of operation is shown in Figure S.2-1.\nNOTE:\tThe IP‑PBX can not register when using the static mode.\nFigure S.2-1: High level Static mode business trunking Architecture\nThe IP‑PBX identity assertion and the routing of terminating sessions are performed by Application Server(s), which may or may not also host a business trunking application. The architecture for support of IP‑PBX in static mode of operation shown in Figure S.2-1 allows for two different deployment alternatives.\n-\tThe Application Server(s) hosting these functionalities are invoked by the S-CSCF based on Initial Filter Criteria contained in the unregister part of the IP‑PBX's subscriber profile, retrieved from the HSS.\n-\tAs according to clause 4.15 and TS 24.525 [81], this deployment relies on the Transit function with Application Server(s) hosting these functionalities are invoked by the Transit Function based on transit invocation criteria, which need to be provisioned in the Transit Function.\nIn both cases, the AS performing the routing of terminating sessions needs to be the last AS invoked for terminating sessions.\nBoth deployment options can simultaneously be used in in an IMS Network, although it requires that the enterprise user identities allocated in the different deployments are not overlapping.\nS.2.2\tHigh level Flows\nS.2.2.1\tGeneral\nBefore any originating or terminating procedures can take place between the IP‑PBX and the P‑CSCF or between the IP‑PBX and the IBCF of the IMS network, security and authentication between the IP‑PBX and IMS is done using the TLS procedures according to TS 33.310 [5], using certificates. The certificates are provided by a trusted root. The P‑CSCF or the IBCF is provisioned with its own certificate, and will receive the IP‑PBX certificate during the TLS handshake.\nIn configurations where there is a NAT between the IP‑PBX and the IMS, the TLS connection needs to be initiated and maintained by the IP‑PBX.\nIf the network between the PBX and the IBCF complies with the peering based interconnect procedures according to TS 24.525 [81], the IBCF may deploy the Gq' interface. The Gq' interface and its interactions are not depicted in these flows.\nS.2.2.2\tOriginating procedures\nS.2.2.2.1\tOriginating procedures using the S-CSCF\nThis clause depicts originating procedures for IP‑PBXs using static mode business trunking when the IP‑PBX is provisioned as a subscriber in HSS and served via the S‑CSCF.\nFigure S.2-1: Originating procedures for IP‑PBXs using static mode business trunking and served by the S‑CSCF\nThe following steps are performed:\n1.\tAn enterprise user within the IP‑PBX tries to establish a call. The IP‑PBX sends an INVITE towards IMS via the P‑CSCF or via the IBCF (contact point for the IP‑PBX). If no security association exists between the P‑CSCF/IBCF and the IP‑PBX, TLS will be initiated as a result of trying to send the INVITE. Once the TLS session is setup (using the certificates), the INVITE will be sent over the secure connection. The INVITE is assumed to include a calling party identity.\n2.\tThe P‑CSCF/IBCF may apply general screening rules to the request and adds a P-Served-User-Identity to the INVITE with the identity of the PBX (SIP URI identifying the domain of the PBX retrieved from the certificate). Additionally, the P‑CSCF/IBCF adds the orig parameter to the INVITE to indicate that this is an origination request. The P‑CSCF/IBCF forwards the INVITE to the I‑CSCF.\n3.\tThe I‑CSCF performs the normal (originating request) user location request towards HSS to find an S‑CSCF to serve the IP‑PBX. If there is no subscription in the HSS, the I‑CSCF forwards the request to a Transit Function (and routing may continue as described in step 4 of clause S.2.2.2.2); otherwise, the following steps are performed.\n4.\tThe I-CSCF forwards the request to the S‑CSCF.\n5.\tWhen the S‑CSCF does not have the IP‑PBX's subscriber profile, the S‑CSCF contacts HSS to download the subscriber information for the unregistered IP‑PBX.\nNOTE:\tThe load on the Cx interface due to the downloading of unregistered IP‑PBXs subscriber profiles is dependent on the timer in the S-CSCF defining the duration the profile is kept for unregistered users. By increasing this timer, this load can be lowered.\n6.\tThe S‑CSCF performs normal (unregistered) originating service invocation for the incoming request.\n7.\tThe S‑CSCF forwards the request to the AS hosting the IP‑PBX identity assertion. Based on the P-Served-User-Identity, this AS identifies the IP‑PBX and inserts a P-Asserted-Identity identifying the enterprise user. Other Application Servers may be triggered based on iFC and may, based on the P-Asserted-Identity, perform any enterprise specific actions if required.\n8.\tEach of the triggered ASs may optionally query HSS for any subscriber information if required using the Sh interface.\n9.\tThe INVITE is forwarded to S‑CSCF for further onward routing towards the remote side.\n10.\tThe S‑CSCF performs onward routing towards the remote side.\n11.\tThe session setup is completed.\nS.2.2.2.2\tOriginating procedures using the Transit Function\nThis clause depicts the originating procedures for IP‑PBXs using static mode business trunking as described in TS 24.525 [81] when the IP‑PBX is not provisioned as a subscriber in HSS and served via the Transit Function.\nFigure S.2-2: Originating procedures for IP‑PBXs using static mode business trunking and served by the Transit Function\nThe following steps are performed:\n1.\tAn enterprise user within the IP‑PBX tries to establish a call. The IP‑PBX sends an INVITE towards IMS via the IBCF (contact point for the IP‑PBX). If no security association exists between the IBCF and IP‑PBX, TLS will be initiated as a result of trying to send the INVITE. Once the TLS session is setup (using the certificates), the INVITE will be sent over the secure connection. The INVITE is assumed to include a calling party identity.\n2a.\tThe IBCF may apply general screening rules to the request, and adds a P-Served-User-Identity to the INVITE with the identity of the IP‑PBX (SIP URI identifying the domain of the IP‑PBX retrieved from the certificate). Additionally, the IBCF adds the orig parameter to the INVITE to indicate that this is an origination request. The IBCF sends the INVITE to the I‑CSCF).\n2b.\tThe IBCF performs the same actions as in step 2a. but sends the INVITE directly to the Transit Function instead of the I‑CSCF. (The next step is step 5).\n3.\tThe I‑CSCF performs the normal (originating request) user location request towards HSS to find the served user, but as it is not provisioned in HSS, \"user not found\" is returned.\n4.\tThe I‑CSCF sends the INVITE to the Transit Function.\n5.\tThe Transit Function is configured with a set of Transit invocation criteria that are triggered to find a correct AS to route to. As this is an origination case (as indicated by the orig parameter), the P-Served-User-Identity is used to identify the IP‑PBX.\n6.\tThe Transit Function forwards the request to the AS hosting the IP‑PBX identity assertion. Based on the P-Served-User-Identity, this AS identifies the IP‑PBX, verifies that this IP‑PBX is a valid user and inserts a P-Asserted-Identity identifying the enterprise user. Other ASs may be triggered based on iFC and may, based on the P-Asserted-Identity, apply any enterprise specific actions if required.\n7.\tThe INVITE is forwarded for further onward routing towards the remote side.\n8.\tTransit Function performs onward routing towards the remote side.\n9.\tThe session setup is completed.\nS.2.2.3\tTerminating Procedures\nS.2.2.3.1\tTerminating procedures using the S‑CSCF\nThis clause depicts terminating procedures for IP‑PBXs using static mode business trunking when the IP‑PBX is provisioned as a subscriber in HSS and served via the S‑CSCF.\nFigure S.2-3: Terminating procedures for IP‑PBXs using static mode business trunking and served by the S‑CSCF\nThe following steps are performed:\n1.\tAn INVITE is sent from the remote side towards the I‑CSCF with a Request-URI which belongs to a particular enterprise user of a served IP‑PBX.\n2.\tThe I‑CSCF performs the normal user location request towards HSS to find an S‑CSCF to serve the IP‑PBX.\n3.\tThe I‑CSCF forwards the request to the S‑CSCF.\n4.\tWhen the S-CSCF does not have the IP‑PBX's subscriber profile, the S‑CSCF contacts HSS to download the subscriber information for the unregistered IP‑PBX.\nNOTE 1:\tThe load on the Cx interface due to the downloading of unregistered IP‑PBXs subscriber profiles is dependent on the timer in the S‑CSCF defining the duration the profile is kept for unregistered users. By increasing this timer, this load can be lowered.\n5.\tThe S‑CSCF performs normal (unregistered) terminating service invocation for the incoming request.\n6.\tThe S‑CSCF forwards the request to the ASs to be triggered per iFC. Each of these ASs may identify the IP‑PBX the enterprise user belongs to and perform any enterprise specific actions if required.\n7.\tEach of the triggered ASs may optionally query HSS for any subscriber information if required using the Sh interface.\n8.\tThe IP‑PBX routing functionality (hosted by the last AS in the iFC chain) identifies the particular IP‑PBX the enterprise user belongs to, and also the P‑CSCF(s) or the IBCF(s) serving the IP‑PBX, and forwards the INVITE toward the IP‑PBX (by creating a route to the IP‑PBX, adding the S‑CSCF, the P‑CSCF/IBCF, and the IP‑PBX in the Route header fields).\nNOTE 2:\tInserting the route to the IP‑PBX in Route header fields will not allow to trigger any AS after the IP‑PBX routing functionality. Similar to the T-ADS functionality, the IP‑PBX routing functionality has to be last in the chain of iFCs.\n9.\tThe INVITE is forwarded using the route information to the P‑CSCF or the IBCF.\n10.\tThe P‑CSCF/IBCF will forward the INVITE to the IP‑PBX using the route information provided by the IP‑PBX routing functionality. If no security association exist between the P‑CSCF/IBCF and the IP‑PBX (and TLS is used), TLS will be initiated as a result of trying to send the INVITE. Once the TLS session is setup (using the certificates) the INVITE will be sent over the secure connection.\n11.\tThe session setup is completed.\nS.2.2.3.2\tTerminating procedures using the Transit Function\nThis clause depicts the terminating procedures for IP‑PBXs using static mode business trunking as described in TS 24.525 [81] when the IP‑PBX is not provisioned as a subscriber in HSS and served via the Transit Function.\nFigure S.2-4: Terminating procedures for IP‑PBXs using static mode business trunking and served by the Transit Function\nThe following steps are performed:\n1.\tAn INVITE is sent from the remote side via an incoming IBCF towards the Transit Function with a Request-URI targeting an enterprise user allocated to a particular IP‑PBX.\nNOTE:\tThe INVITE from the IBCF can be sent via an I‑CSCF before it ends up in the Transit Function. In such case, the I‑CSCF will detect that this is not a provisioned user, and therefore decide to route to the Transit Function.\n2.\tThe Transit Function will based on the Request-URI determine that the served user is belonging to an IP‑PBX and corresponding transit invocation criteria that are used to identify the ASs to be triggered, including the AS hosting the IP‑PBX routing functionality, which is the last AS to be triggered.\n3.\tThe Transit Function forwards the request to the required ASs. Each of these ASs may identify the IP‑PBX the enterprise user belongs to and perform any enterprise specific actions if required.\n4.\tThe IP‑PBX routing functionality (hosted by the last AS in the chain) identifies the particular IP‑PBX the enterprise user belongs to, and optionally also the IBCF(s) serving the IP‑PBX, and forwards the INVITE toward the IP‑PBX by creating a route to the IP‑PBX, adding the Transit Function, the IBCF, and the IP‑PBX in the Route header fields.\n5.\tThe INVITE is forwarded using the route information to the IBCF.\n6.\tThe IBCF will forward the INVITE to the IP‑PBX using the route information provided by the AS. If no security association exist between the IBCF and the IP‑PBX (and TLS is used), TLS will be initiated as a result of trying to send the INVITE. Once the TLS session is setup (using the certificates) the INVITE will be sent over the secure connection.\n7.\tThe session setup is completed.\nAnnex T (normative):IP-Connectivity Access Network specific concepts when using Trusted WLAN (TWAN) to access IMS\nT.0\tGeneral\nThis clause describes the main IP-Connectivity Access Network specific concepts that are used for the provisioning of IMS services over a Trusted WLAN (TWAN) access to EPC.\nAs IMS is accessed over EPC, most of the features defined in clause E for the case of EPC (and PDN connections/EPS bearers) apply in the case of a TWAN access, e.g. a P‑GW is used as an IP anchor point and IP-Connectivity Access Network bearers are provided by PDN connections and bearers.\nFollowing specific considerations apply to the case of a TWAN access:\n-\tThe Mobility related procedures for EPS and TWAN access are described in TS 23.402 [82]\n-\tTWAG/TWAP (refer to clause 16 of TS 23.402 [82]) are used to interface the access network and to control relevant PDN connectivity (over S2a) towards a P-GW.\n-\tFor a TWAN access, the way the notification of the loss of IP-CAN session for an UE is triggered within a TWAN is out of scope of 3GPP specifications.\nT.1\tRetrieval of Network Provided Location Information in TWAN access\nFor a TWAN access, Access Network Information may be reported to the IMS as described in clause E.7 for the case of a GPRS/EPS access, with following exceptions:\n-\tThe Access Network Information being reported to the P-CSCF is defined in clause 16 of TS 23.402 [82].\nA Geographical Identifier may be generated by the P-CSCF or an IMS AS based on the retrieved Access Network Information, as specified in clause E.8.\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements for SMS over IP. The P-CSCF applies the above mechanisms upon reception of a MESSAGE including the distribution of received information to other IMS entities.\nAnnex U (normative):WebRTC access to IMS - network-based architecture\nU.1\tOverview\nU.1.0\tGeneral\nWeb Real-Time Communication (WebRTC) is specified in IETF RFC 8825 [84] and WebRTC 1.0 [85]. This Annex specifies a network-based architecture for the support of WebRTC client's access to IMS. Any requirements for specific audio and video codecs from IETF RFC 8825 [84] (directly and indirectly referenced) do not apply for WebRTC access to IMS; the codecs that shall be supported for WebRTC access to IMS are described in TS 26.114 [76].\nNOTE:\tThe UE can also perform WebRTC access to IMS by implementation specific means in the UE in which it exposes a standard Gm interface towards IMS.\nU.1.1\tAssumptions\n-\tThis Release specifies an option to use a signalling interface from the UE to the network based on SIP over WebSocket (RFC 7118 [89]), which is used as the information model which may be used by other options. Options other than SIP over WebSocket, such as XMPP or other application protocols over WebSocket, a RESTful based interface, etc. are allowed but not described. Alternative message body formats such as JSON and alternative transport protocols are also not precluded. Any enhancements required to accommodate an unspecified signalling interface are considered compliant to the Release as long as other defined interfaces in the architecture are not impacted.\n-\tSDP offer/answer exchange is the mechanism used for media plane feature negotiation.\n-\tThe architecture does not support media multiplexing that is defined for WebRTC clients. A WebRTC IMS Client (WIC) accessing IMS services should not allow usage of media multiplexing in the browser.\n-\tIf an SDP offer with media multiplexing is sent to the network the part of the SDP offer associated with media multiplexing shall be removed at the entry of the IMS network.\n-\tWebRTC specific media plane extensions will be handled at the access edge and will not be propagated to other IMS functions.\n-\tFor network based interworking between WebRTC and IMS, in the case of 3GPP and EPC access from a WebRTC client:\n-\tUse of available techniques to select preferred access technologies and APNs/DNNs, and to provide IP address continuity, are allowed but not described.\n-\tWhen the WebRTC client is served by an IP-CAN that supports PCC, it is possible to request QoS within the IP-CAN for WebRTC media.\nNOTE:\tTo ensure full end to end QoS support, proper IP forwarding policies can be set in the path between the P‑GW and the Functions supporting media interworking to the IMS.\n-\tQoS can be provided in configurations where the IMS can identify the transport (TCP-UDP/IP) addresses handled by the PCEF and where based on this information PCC functions can identify the UE media flows to prioritize.\n-\tThe eP-CSCF is located in the Home IMS domain of the IMS Public User Identity being registered via the eP-CSCF.\n-\tThe WIC may have no way to access the content of an ISIM/USIM on the UE\nU.1.2\tArchitecture and reference model\nFigure U.1.2-1 shows the WebRTC IMS architecture. The WWSF (WebRTC Web Server Function) is located either within the operator network or within a third party network and is the web server contacted by the user agent (generally after clicking on a link or entering a URL into the browser). The P-CSCF enhanced for WebRTC (eP‑CSCF) is the endpoint for the signalling connection from the client and is located in the operator network.\nNOTE 1:\tThe presence of dashed elements in the figure depends on the configuration.\nPCC functional elements are present only for EPC access with QoS.\nThe corresponding PCC elements for fixed access are also optionally supported but not shown.\nThe NAT in figure U.1.2-1 is meant for non-cellular access to IMS.\nFigure U.1.2-1: WebRTC IMS architecture and reference model\nNOTE 2:\tW3 corresponds to the output of the IETF RTCWEB discussions.\nNOTE 3:\tThe enhanced network entities, such as the eP-CSCF, might be decomposed into multiple network elements (e.g. P-CSCF and WebRTC Signalling Function) in future Releases to address additional use cases and configurations.\nNOTE 4:\tThe W5 reference point is an optional signalling interface between the WAF and the eP-CSCF. The W5 reference point is not specified and is implementation specific.\nU.1.3\tFunctional entities\nU.1.3.1\tWIC (WebRTC IMS Client)\nA WebRTC IMS Client (WIC) is an application using the WebRTC extensions specified in WebRTC 1.0 [85] except for those extensions specifically exempted by 3GPP specifications (e.g. TS 26.114 [76]) and providing access to IMS by interoperating with the WebRTC IMS access architecture defined in this Annex.\nAny IP access network with access to the internet may be used by a WIC; nevertheless WebRTC traffic is subject to the QoS and reachability limitations of this access network.\nU.1.3.2\tWWSF (WebRTC Web Server Function)\nThe WebRTC Web Server Function (WWSF) is the initial point of contact in the Web that controls access to the IMS communications services for the user. The WWSF has the following characteristics and functions:\n-\tThe WWSF is located either in the operator network or a third party network\n-\tThe WWSF provides the Web page presenting the user interface to the user for IMS access.\n-\tThe WWSF provides the JS WIC application for downloading to the browser on the UE.\n-\tThe WWSF manages the allocation of authorized IMS identities to WICs. The JS application downloaded from the WWSF controls which authentication method applies.\nNOTE 1:\tThe WWSF represents a collection of functions that might be further split across servers or networks, so long as they behave in the aggregate as described in this Annex U.\nNOTE 2:\tThe WWSF can include WAF functionality in the case WWSF and WAF are in the same domain.\nU.1.3.3\teP-CSCF (P-CSCF enhanced for WebRTC)\nThe P-CSCF enhanced for WebRTC (eP-CSCF) is a P-CSCF including the IMS-ALG functionality and with the following additional functions:\n-\tThe eP-CSCF shall support at least one WebRTC IMS client-to-network signalling protocol, e.g. SIP over WebSocket, REST/HTTP based interface, XMPP over WebSocket, etc.\nNOTE 1:\tOther application protocols, alternative message body formats such as JSON and alternatives to WebSocket transport are also not precluded.\n-\tThe eP-CSCF provides interworking between W2 and Mw.\n-\tThe eP-CSCF verifies that the UE is executing a WIC from an authorized WWSF.\n-\tIn the case of WIC registration of individual Public User Identity using IMS Authentication, the eP-CSCF shall relay the IMS authentication and registration information between W2 and Mw.\n-\tOtherwise, i.e. for users authorized by the WWSF or WAF:\n-\tThe eP-CSCF shall verify any UE authorization information received from the WIC;\n-\tThe eP-CSCF shall verify that the WWSF is authorized to allocate IMS identities;\nNOTE 2:\tFor this purpose the eP-CSCF can identify an existing trust relationship between the eP-CSCF and the WWSF or WAF.\n-\tThe eP-CSCF shall perform Trusted Node Authentication (TNA) in IMS, as defined in TS 33.203 [19].\n-\tThe eP-CSCF shall control the media plane interworking functions provided by the eIMS-AGW, including those additional media plane functions specific to WebRTC.\n-\tThe eP-CSCF shall ensure via signalling that RTP streams are not multiplexed (\"bundled\") onto the same port.\n-\tThe eP-CSCF shall negotiate via signalling whether RTP and RTCP flows of an RTP stream are multiplexed onto the same port and shall configure the eIMS-AGW to (de)multiplex such flows if entities anchoring the session media path in the IMS domain do not support that capability.\n-\tThe eP-CSCF is located in the domain of the operator that provides the WWSF or with which the WWSF has a service level agreement.\nU.1.3.4\teIMS-AGW (IMS Access GateWay enhanced for WebRTC)\nThe IMS-AGW enhanced for WebRTC (eIMS-AGW) is a standard IMS-AGW with the following additional mandatory characteristics and functions:\n-\tThe eIMS-AGW shall support the media plane interworking extensions as needed for WICs.\n-\tThe eIMS-AGW shall reside in the same network as the eP-CSCF.\n-\tThe eIMS-AGW shall support media security of type \"e2ae\" (as specified in TS 33.328 [83]) for media protocols specific to WebRTC, including media consent, and DTLS-SRTP as key exchange mechanism for media components using SRTP.\n-\tThe eIMS-AGW shall provide NAT traversal support including ICE\n-\tThe eIMS-AGW may be used to perform any transcoding needed for audio and video codecs supported by the browser.\n-\tWhen GTT service is required, the eIMS-AGW shall perform transport level interworking between T.140 [87] over Data Channels and other T.140 transport options supported by IMS.\n-\tWhen MSRP is transported over the data channel, the eIMS-AGW shall act as an MSRP B2BUA between MSRP over Data Channels and the other MSRP transport options supported by IMS.\nNOTE:\tIf CEMA extensions for transport-level interworking for MSRP are supported in IMS, the eIMS-AGW will also support this option.\n-\tWhen BFCP service is required for conference floor control and BFCP is transported over Data Channels, the eIMS-AGW shall perform transport level interworking between BFCP over Data Channels and other BFCP transport options supported by IMS.\n-\tThe eIMS-AGW shall support the media plane optimization for WICs.\n-\tThe eIMS-AGW shall support that RTP and RTCP flows of an RTP stream between WIC and eIMS-AGW are multiplexed onto the same port, and shall support de-multiplexing such RTP and RTCP flows toward the core network.\nU.1.3.5\tWAF (WebRTC Authorisation Function)\nThe WebRTC Authorisation Function (WAF) has the following characteristics and functions:\n-\tThe WAF shall issue the authorisation token to WWSF.\n-\tThe WAF may either authenticate the user itself as part of the token issuance process, or it trusts the user identity provided by the WWSF.\n-\tThe WAF may either reside in the operator domain or the third party domain.\nThe WAF is not used in the case of IMS registration scenario using IMS Authentication, described in clause U.2.1.1.\nNOTE:\tThe WWSF can include WAF functionality in the case WWSF and WAF are in the same domain.\nU.1.4\tReference points\nU.1.4.1\tW1 (UE to WWSF)\nThe W1 reference point is between the UE and the WWSF. The HTTPS protocol is normally used to access the web page providing the User Interface for the WIC and to download the WIC JS application to the browser.\nU.1.4.2\tW2 (UE to eP-CSCF)\nThe W2 reference point is the signalling interface between the UE and the eP-CSCF. SIP over secure WebSocket is a non-mandatory option for W2 in Release 12, where the SIP/SDP procedures are based on Gm with enhancements to support extensions defined for WIC, and secure WebSocket is the supported transport protocol. Other protocols are allowed on W2 for WebRTC access but are not described in this document.\nU.1.4.3\tIq (eP-CSCF to eIMS-AGW)\nThe Iq reference point is between the eP-CSCF and eIMS-AGW and is enhanced to control the additional bearer plane functions specific to WIC.\nU.1.4.4\tW3 (UE to eIMS-AGW)\nThe W3 reference point is between the UE and eIMS-AGW. W3 carries the user plane between the UE and the network (see clause U.1.5).\nU.1.4.5\tW4 (WWSF to WAF)\nThe W4 reference point is the signalling interface between the WWSF and the WAF. The WWSF obtains an authorisation token from the WAF from which the user's identities, identities of WWSF and WAF, and a lifetime may be derived in the case of IMS registration scenarios based on web authentication and assignment from a pool of user identities.\nU.1.5\tMedia plane protocol architecture\nU.1.5.0\tGeneral\nThe IMS AGW enhanced for WebRTC (eIMS-AGW) is the media plane interworking element with the functions described in clause U.1.3.4.\nNOTE:\tIn this clause, the figures describe the end to end scenario where \"the peer\" corresponds to a remote IMS terminal. In this case, when e2ae security is needed, TS 33.328 [83] shall govern the interaction between \"the peer\" and the IMS-AGW that serves it. Other scenarios with other kind of peers (e.g. the peer is another webRTC terminal) are possible but not represented.\nU.1.5.1\tProtocol architecture for MSRP\nFigure U.1.5.1-1 shows the protocol architecture for support of MSRP, when transported over the data channel, from a WebRTC IMS client (WIC).\nWhen MSRP is transported over the data channel, the eIMS-AGW shall provide either a transport relay function from Data Channel to TCP or an MSRP B2BUA to allow interoperation with existing MSRP peer endpoints.\nUDP transport of DTLS shall be supported and TCP transport of DTLS may be supported to enable traversal of UDP-blocking NATs/firewalls.\nFigure U.1.5.1-1: Protocol architecture for MSRP\nFigure U.1.5.1-2: Protocol architecture for MSRP acting as transport relay function\nU.1.5.2\tProtocol architecture for BFCP\nFigure U.1.5.2-1 shows the protocol architecture for support of BFCP, when transported over the data channel for conference floor control, from a WebRTC IMS client (WIC).\nWhen BFCP service is required for conference floor control and BFCP is transported over Data Channels, the eIMS-AGW shall provide a transport relay function from Data Channel to TCP to allow interoperation with existing BFCP peer endpoints.\nUDP transport of DTLS shall be supported and TCP transport of DTLS may be supported to enable traversal of UDP-blocking NATs/firewalls.\nFigure U.1.5.2-1: Protocol architecture for BFCP\nU.1.5.3\tProtocol architecture for T.140\nFigure U.1.5.3-1 shows the protocol architecture for support of T.140 from a WebRTC IMS client (WIC).\nThe eIMS-AGW shall provide a transport relay function from Data Channel to RTP to allow interoperation with existing T.140 peer endpoints.\nUDP transport of DTLS shall be supported and TCP transport of DTLS may be supported to enable traversal of UDP-blocking NATs/firewalls.\nFigure U.1.5.3-1: Protocol architecture for T.140\nU.1.5.4\tProtocol architecture for Voice and Video\nFigure U.1.5.4-1 shows the protocol architecture for support of Voice and Video from a WebRTC IMS client (WIC). Transcoding (i.e. allowing codec1 to be different from codec2) is optional. SRTP between the UE and the eIMS-AGW relies on keying material negotiated via DTLS.\nNOTE 1:\tTranscoding at the eIMS-AGW may apply to none, one or both of the voice and video components\nFigure U.1.5.4-1: Protocol architecture for Voice and Video\nNOTE 2:\tRFC 4571 [90] framing is used for RTP streams transferred over TCP. RTP over TCP may be used when NATs/Firewalls perform UDP blocking.\nU.2\tProcedures\nU.2.0\tWWSF discovery\nThe URI to a WWSF for WebRTC access to IMS may be configured in the UICC.\nPrior to performing registration, a UE may use the following mechanism to determine the URI of the WWSF:\n-\tIf the UICC contains a URI to a WWSF for WebRTC access to IMS, then the UE uses this URI for registration.\n-\tOtherwise, the UE derives the URI to WWSF from the home domain name as specified in TS 23.003 [24].\nAlternatively, the URI to a WWSF may be obtained by means outside the 3GPP scope.\nU.2.1\tRegistration\nU.2.1.1\tIntroduction\nThe WebRTC IMS architecture supports the following different IMS registration scenarios that may differ in the authentication method, and ownership of the WWSF (i.e. operator network or third party):\n-\t\"WIC registration of individual Public User Identity using IMS authentication\": The user has a subscription with an individual Public User Identity and an IMS authentication mechanism as specified in TS 33.203 [19] is used to authenticate with IMS. Clause U.2.1.2 provides detailed procedures for this scenario.\n-\t\"WIC registration of individual Public User Identity based on web authentication\": The user has an IMS subscription. The WWSF or WAF authenticates the user using a web identity and authentication scheme. The WWSF determines IMS identities for the user (e.g. based on the user's web identity via database lookup or other translation means). An individual registration is handled by the S-CSCF per WIC registration. Clause U.2.1.3 provides detailed procedures for this scenario.\n-\t\"WIC registration of individual Public User Identity from a pool of Public User Identities\": The WWSF is typically located in a third party network and has a business arrangement with the IMS operator. The WWSF or WAF authenticates the user using a web identity and authentication scheme, or authorizes the WIC without authenticating the user. The WWSF assigns IMS identities to the user from within a pool allocated by the operator. An individual registration is handled by the S-CSCF per WIC registration. Clause U.2.1.4 provides detailed procedures for this scenario.\nU.2.1.2\tWIC registration of individual Public User Identity using IMS authentication\nThe WIC obtains information needed for IMS registration (e.g. Private User Identity and Public User Identity) via unspecified means. For example, some of this information might be stored in cookies or local browser storage after visiting a secure web site provided by the IMS operator.\nFigure U.2.1.2-1 shows a registration call flow where IMS authentication is used to register the WIC.\nFigure U.2.1.2-1: WIC registration of individual Public User Identity using IMS authentication\n1.\tThe WIC initiates an HTTPS connection to the WWSF. The TLS connection provides one-way authentication of the server based on the server certificate. The browser downloads and initializes the WIC from the WWSF.\n2.\tThe WIC opens a WSS (secure WebSocket) connection using cross-origin mechanism to the eP-CSCF. Standard cross-origin resource sharing procedures are used to ensure that the WIC originated from a WWSF authorized to access this eP-CSCF.\n3-6.\tThe WIC initiates a registration transaction with IMS via the eP-CSCF by sending a REGISTER request to the eP-CSCF via the WSS (secure Web Socket) connection. The REGISTER request includes IMS Authentication parameters, Private User Identity, Public User Identity and other information as needed for proper IMS registration. This request is translated into an IMS registration process by the eP‑CSCF. This process leverages user credentials in HSS.\nU.2.1.3\tWIC registration of individual Public User Identity based on web authentication\nFigure U.2.1.3-1 shows a registration call flow where the WIC registers with IMS based on web authentication with the WWSF.\nFigure U.2.1.3-1: WIC registration of individual Public User Identity based on web authentication\n1.\tThe WIC initiates an HTTPS connection to the WWSF. The TLS connection provides one-way authentication of the server based on the server certificate. The browser downloads and initializes the WIC from the WWSF. The WWSF or WAF authenticates the user using a common web authentication procedure. The WWSF determines the Private User Identity and Public User Identity for the WIC and returns the security token which is issued by the WAF to the WIC. The IMS identities may be provided to the WIC in addition to the security token.\n2.\tThe WIC opens a WSS (secure WebSocket) connection using cross-origin mechanism to the eP-CSCF. Standard cross-origin resource sharing procedures are used to ensure that the WIC originated from a WWSF authorized to access this eP-CSCF.\n3.\tThe WIC sends a REGISTER request to the eP-CSCF via the WSS (secure Web Socket) connection. The request includes the security token received from the WWSF. If the WIC received the IMS identities in step 1, the request shall include the IMS identities.\n4.\tThe eP-CSCF validates the contents of the security token and obtains the IMS identities being registered. The eP-CSCF then forwards the authorized REGISTER request to IMS to initiate authentication-less IMS registration using TNA (see TS 33.203 [19], Annex U) procedures, with an indication that the authentication has already been carried out.\n5.\tThe S-CSCF responds with a 200 OK message are accepted.\n6.\tThe eP-CSCF sends the OK response back to the WIC.\nAs the security token may be associated with a lifetime, the WIC may need to periodically refresh its registration. This registration refresh process entails all steps above with following exceptions:\n-\tFor Step 1, the opening of the TLS connection, the downloading of the WIC and the web authentication of the user using the WIC may not be needed.\n-\tStep 2 may not be needed.\nU.2.1.4\tWIC registration of individual Public User Identity from a pool of Public User Identities\nThe WWSF is provided with a pool of IMS subscriptions, each associated to a single Private User Identity and one or more Public User Identities as specified in clause 4.3.3.4. The WWSF can assign individual Public and Private User Identities from this pool. The WWSF may be located in a third party network and have a business arrangement with the IMS operator.\nFor pool management, the IMS operator may also provide the WWSF with an unbounded number of Private User Identities/Public User Identities associations to be allocated to WIC users, where each user may use multiple WICs sharing the same Public User Identity and each WIC being assigned a different Private User Identity.\nNOTE:\tHow the HSS handles and manages the unbounded users is implementation specific.\nThe registration call flow for a WIC being assigned an individual Public User Identity from a pool of Public User Identities assigned to the WWSF is the same registration call flow defined in Figure U.2.1.3-1 with following differences:\n-\tIn step 1, the WWSF or WAF may decide not to authenticate the user. Unauthenticated users are anonymous to the third party but may still be authorized for IMS service.\n-\tThe lifetime of the security should be coordinated between the IMS provider and the WWSF provider; otherwise, the WWSF cannot know when a Public User Identity Private User Identity association from its pool can be re-assigned to another user.\n-\tAlternatively, as an implementation specific option, eP-CSCF may indicate to the WWSF when a certain Public User Identity can be re-assigned.\nU.2.2\tSession management related procedures\nOrigination and termination and Session release procedures for WebRTC IMS clients follow standard IMS procedures in the core network (see clauses 5.6 and 5.7 and 5.10) with the exception that routing of all messages between the WIC and S-CSCF traverse the eP-CSCF (rather than P-CSCF) and that parameters of Iq procedures take into account the WebRTC-specific extensions used by the WIC to send and receive media.\nU.2.3\tDe-Registration procedures\nDe-registration procedure for WebRTC IMS clients follows standard IMS procedures in the core network (see clause 5.3) with the exception that routing of all messages between the WIC and S-CSCF traverse the eP-CSCF (rather than P-CSCF).\nU.2.4\tMedia plane Optimization\nThe IMS operator is able to convey the audio and chat session without bearer level protocol conversion when session is between WebRTC clients.\nWhen both ends are WebRTC client, the eIMS-AGWs remain allocated but media plane interworking is disabled, except when LI is needed. When media plane optimization is enabled, the eIMS-AGW forwards all protocol layers either including DTLS, or on top of DTLS transparently (see clause U.1.5).\nNOTE:\tTerminating the DTLS protocol layer for all calls can improve the transparency of LI.\nWhen LI is performed, media plane interworking is performed according to TS 33.328 [83].\nFigure U.2.4-1 shows a call flow diagram establishing the e2ae communication between WebRTC clients through the IMS network. I/S-CSCFs are not shown for brevity.\nFigure U.2.4-1: Media plane Optimization\n1.\tWebRTC client (WIC-1) initiates a call, creating a Session Description Protocol (SDP) offer and sends it to the originating side eP-CSCF. The SDP offer may contain SRTP, ICE and Data Channel information. The WIC-1 IP address is IP1.\n2.\tThe eP-CSCF-1 receives the SDP offer from WIC-1. The eP-CSCF-1 allocates eIMS-AGW1 and configures it to terminate ICE procedures and provide interworking (e.g. transcoding, or transport interworking between a Data Channel and transport outside a Data Channel). eIMS-AGW1 allocates address IP2. It also requests the media gateway to provide a transport port suitable for a transparent forwarding of the media. IMS-AGW1 allocates port P2t for that purpose. Depending on configuration, it either configures the IMS-AGW1to terminate or to transparently forward the DTLS layer for transparent media. The eP-CSCF-1 shall not apply OMR procedures according to Annex Q.\n3.\tThe eP-CSCF-1 describes the new media2 that result from the interworking and inserts the address IP2 at the eIMS-AGW1 in the SDP offer connection line it sends. Within the SDP offer, the eP-CSCF-1 also indicates that the media1 targeted for transparent forwarding (those media are called \"transparent media\" in what follows) can be selected instead and also encapsulates in SDP attribute(s) information about those transparent media (SDP attributes, SDP media line including transport protocol and port P2t, Data Channel related information, but no ICE related information. A DTLS fingerprint is included, and depending on configuration, it either contains the fingerprint received from the WIC-1 or a fingerprint allocated by eIMS-AGW1). To enable the check in step 6 wether intermediates which do not support switching to the encapsulated media are inserted into the media path, the eP-CSCF-1 also encapsulates the address IP2.\n4.\tA possible intermediate (e.g. IBCF with attached TrGW or MTFC with attached MRFP) may also insert a media gateway into the user plane. Such an intermediate may optionally also support switching to the transparent media; this is required to allow the transparent media to be selected when its media gateway is present in the media path. Intermediates which do not support switching to the transparent media will be detected and will cause media 2 to be selected in step 6.\nThe possible intermediate can also apply OMR procedures according to Annex Q to offer that its media gateway is bypassed by an optimised media path.\n5\tThe intermediate replaces the transport address within the connection line in the SDP offer with the address IP3 allocated at its media gateway. If the intermediate supports switching to the transparent media, it also modifies the transparent media information encapsulated in SDP attribute(s) by replacing the encapsulated transport address with IP3 and the port information with P3t.\n6.\teP-CSCF-2 allocates eIMS-AGW2. It compares the transport address in the SDP connection line with the transport address in the transparent media information encapsulated in SDP attribute(s). Because both addresses match, the eP-CSCF-2 takes the transparent media information into consideration. Otherwise it shall ignore the transparent media information. The eP-CSCF-2 shall not apply OMR procedures according to Annex Q and shall discard any received OMR related information. Because eP-CSCF2 knows that the served WIC-2 is a WIC, it decides that the transparent media information is appropriate and configures the eIMS-AGW2 to transparently forward those media; depending on configuration, eP-CSCF2 either configures the eIMS-AGW2 either transparently forward the DTLS layer or to terminate it, and it either forwards the fingerprint received as part of the transparent media information or a fingerprint allocated by eIMS-AGW2.\n7.\tThe eP-CSCF-2 forwards SDP offer with the transparent media1 and the transport address IP4 allocated at eIMS-AGW2 to WIC-2.\n8.\tWIC2 selects media3 from the offered media1 and sends the selected media3 in the SDP answer to the eP-CSCF-2.\n9.\tThe eP-CSCF-2 forwards the SDP answer including connection information for eIMS-AGW2 and the unmodified media3, and includes an indication that the transparent media have been selected. Depending on configuration, it either forwards the fingerprint received from WIC2 or a fingerprint allocated by eIMS-AGW2.\n10.\tThe possible intermediate reconfigures its MGW to transparently pass media3.\n11.\tThe intermediate forwards the SDP answer with unmodified media3 and indication that the transparent media have been selected and includes address information IP7 of the controlled MGW.\n12.\tAccording to received SDP answer, the eP-CSCF-1 knows that there is no bearer level protocol conversion. So eP-CSCF-1 deactivates media plane interworking in eIMS-AGW1.\n13.\tThe eP-CSCF-1 forwards the SDP answer to WIC-1. Depending on configuration, it either forwards the fingerprint received in step 12 or a fingerprint allocated by eIMS-AGW1.\nAnnex V (normative):IP-Connectivity Access Network specific concepts when using Untrusted WLAN to access IMS\nV.1\tGeneral\nThis clause describes the main IP-Connectivity Access Network specific concepts that are used for the provisioning of IMS services over untrusted WLAN access to EPC.\nFollowing specific considerations apply to the case of untrusted WLAN access:\n-\tThe Mobility related procedures for untrusted WLAN access to EPC are described in TS 23.402 [82].\n-\tFor untrusted WLAN access, ePDG is used to interface the access network and to control relevant PDN connectivity (over S2b) towards a P-GW.\n-\tFor untrusted WLAN access, the way the notification of the loss of IP-CAN session for a UE is triggered within an untrusted WLAN is out of scope of 3GPP specifications.\n-\tFor untrusted WLAN access, the Reporting of User location information (i.e. UE local IP address and Network Provided WLAN Location Information) in the EPS is defined in clauses 4.5.7.2.8, 7.4.3.1, 7.9.2, 7.10 and 7.11.14 of TS 23.402 [82] and the related PCC Access Network Information reporting procedure is defined in clause H.4 of TS 23.203 [54]. Information flows on how user location information can be further distributed within IMS can be found in Annex R.\n-\tIn order to fulfil regulatory requirements, IMS requires in addition to the UE local IP address, the identity of the ePDG to which the UE is connected, and the UE source port (TCP port or UDP port) used by the UE to establish the IKEv2 tunnel with the ePDG.\nNOTE 1:\tThe identity of the ePDG is the IP address used in IKEv2 tunnel.\nNOTE 2:\tThe P-CSCF has to subscribe to the IP-CAN type changes with PCRF to be notified when IP-CAN type changes to non 3GPP and the ePDG IP address (and other information) is than provided to the P-CSCF.\nV.2\tUE Provided Access Information in Untrusted WLAN access\nA UE accessing IMS via untrusted WLAN shall support the following:\n-\tIf available, provide the identity of the WLAN AP the UE is currently associated with, and used for IMS signalling at IMS registration, IMS emergency registration, IMS session initiation, SMS over IP, and in any procedure defined in TS 24.229 [10a], where access network information is provided.\n-\tIf available, provide geographical location coordinates during IMS emergency session setup.\n-\tProvide the cell information (cell-ID) for the most recent seen cell at IMS registration, IMS emergency registration, IMS emergency session initiation, and in any procedure defined in TS 24.229 [10a] where access network information is provided. The cell-ID access information shall include additional information describing when the information about the cell-ID was collected and that can be used to calculate the \"age\" of the information. The information about the cell-ID shall be included in an appropriate field of the SIP request that is distinguished from the information about the access network currently used to transport SIP signalling (i.e. Untrusted WLAN).\nNOTE:\tOperator specific local control policies may be applied and which can result in a registration being accepted, rejected, and/or may also result in additional implementation specific actions. Any node that participates in the registration process (e.g. P-CSCF, HSS) may apply these local control policies.\nAnnex W (normative):Support of IMS Services for roaming users in deployments without IMS-level roaming interfaces\nW.1\tGeneral\nThis clause describes the functions that are used to support IMS services for roaming users in deployments without IMS-level roaming interfaces. This annex is applicable to UEs connected to EPS and 5GS. In this roaming model the mobility anchor (i.e. PGW or UPF) is located in the home PLMN and therefore UE IMS signalling and user plane traffic are routed to home PLMN. It is assumed that confidentiality protection is not used in HPLMN and VPLMN for IMS media plane traffic.\nFor the LBO roaming model where P-CSCF is in VPLMN, see Annex M.\nW.2\tArchitecture\nW.2.1\tEPS\nThe architecture to support IMS services for roaming users, including Voice over IMS, in deployments without IMS-level roaming interfaces is shown in figure W.2-1\nThe following architecture requirements apply:\n-\tP-CSCF (at HPLMN) identifies the serving network (VPLMN) where the UE is located using the procedure defined in clause W.3.\nFigure W.2-1: architecture IMS architecture\nW.2.2\t5GS\nSee clause Y.9.2.\nW.3\tVoid\nW.4\tProcedures related to PLMN ID change\nW.4.1\tSubscription to changes of PLMN ID at IMS Initial Registration\nIn deployments without IMS-level roaming interfaces, the home network determines the serving PLMN of the UE using procedure defined in TS 23.203 [54], TS 23.503 [95] or TS 29.214 [11], where the P-CSCF requests the PCRF/PCF to report the PLMN identifier where the UE is currently located. The received PLMN ID information is then forwarded in the SIP REGISTER request.\nThis procedure shall be applied by the P-CSCF at initial UE IMS registration.\nThe below procedure relates to EPS, the corresponding procedure for 5GS is defined in Annex Y.\nFigure W.4.1-1: Subscription by P-CSCF to changes in PLMN ID during initial IMS Registration\n1.\tThe UE sends a SIP REGISTER request to the P-CSCF.\n2.\tIf this is the initial IMS registration then the P-CSCF subscribes to the PCRF/PCF to be notified of the PLMN ID where the UE is currently attached. The subscription to PLMN changes is active as long as the UE is IMS registered.\n3. The PCRF/PCF forwards the PLMN ID to the P-CSCF. The P-CSCF stores the PLMN ID.\n4.\tThe P-CSCF includes the received PLMN ID in the SIP REGISTER request before forwarding the request to the I-CSCF.\n5.\tNormal IMS registration procedure is then completed.\nW.4.2\tUE is not active in an IMS voice session\nThe following procedure shall be applied by IMS at reception of PLMN change when the UE is not active in an IMS voice call, and when the PDN connection/PDU session is kept at PLMN change.\nNOTE 1:\tThis clause assumes that the UE has not established an IMS session for other services. Additional functionality covering non-voice IMS sessions is up to future enhancements.\nFigure W.4.2-1: Procedure for PLMN change\n1.\tEPC/5GC detects PLMN change.\n2.\tH-PCRF/PCF notifies P-CSCF that PLMN change has occurred and indicates the new PLMN ID.\n3.\tP-CSCF sends SIP MESSAGE with new PLMN ID to S-CSCF.\n4.\tBased on regulatory requirements (see NOTE 2), S-CSCF sends SIP NOTIFY with re-authentication request to the UE.\nNOTE 2:\tRegulatory requirements in the country of the new PLMN could require the possibility to get access to IMS signalling information. If the source PLMN uses encryption for IMS signalling, the Re-Registration procedure can trigger the HPLMN to change encryption to use null encryption which would enable the new PLMN to get access to future IMS signalling information. Also, the Re-registration can trigger to turn on encryption in the new PLMN if the HPLMN requires it.\n5.\tUE initiates re-registration procedure. During the re-registration procedure, the P-CSCF may update the SIP signalling encryption depending on roaming agreements, e.g. moving from HPLMN to VPLMN can result in turning off IMS encryption while retaining integrity protection of IMS signalling.\nW.4.3\tUE is active in an IMS voice session\nThe following procedure shall be applied by IMS at reception of PLMN change when the UE is active in an IMS voice call, and when the PDN connection/PDU session is kept at PLMN change.\nFigure W.4.3-1: PLMN change detected by EPC/5GC\n0.\tUE is active in an IMS voice call.\n1.\tEPC/5GC detects PLMN change.\n2.\tH-PCRF/PCF notifies the P-CSCF that PLMN change has occurred and indicates the new PLMN ID.\n3.\tP-CSCF sends SIP MESSAGE with the new PLMN ID to the S-CSCF.\n3a.\tP-CSCF sends SIP MESSAGE with new PLMN ID to the TAS so that the TAS may update any charging records with the new PLMN ID.\n4.\tBased on regulatory requirements (see NOTE 1), S-CSCF sends SIP NOTIFY with re-authentication request to the UE.\n5.\tUE initiates re-registration procedure. During the re-registration procedure, the P-CSCF may update the SIP signalling encryption depending on roaming agreements, e.g. moving from HPLMN to VPLMN can result in turning off IMS encryption while retaining integrity protection of IMS signalling.\n6.\tOnce the re-registration procedure is completed and based on regulatory requirements (see NOTE), the P-CSCF may send a SIP MESSAGE to the TAS indicating that TAS should send a re-INVITE request to the UE.\n7.\tTAS sends SIP Re-INVITE to UE including, subject to the privacy settings associated with the original call, call related information (e.g. calling and called party information, indication whether UE was calling party or called party in the call, redirecting party information (if present), media endpoints and used codecs). Codec endpoints are translated in the P-CSCF if needed. The UE should not reveal this information to the user.\n8.\tUE sends SIP 200 OK to TAS.\nNOTE:\tWhether the P-CSCF executes step 4 and/or step 6 depends on regulatory requirements of the new PLMN. Regulatory requirements in the country of the new PLMN could require the possibility to get access to IMS signalling information. If the source PLMN uses encryption for IMS signalling, the IMS Re-Registration procedure can trigger the HPLMN to change encryption to use null encryption which would enable the new PLMN to get access to future IMS signalling information. Also, the IMS Re-registration can trigger to turn on encryption in the new PLMN if required by the HPLMN. Sending SIP Re-Invite request to the UE enables the new PLMN to get access to call related information.\nAnnex X (normative):IMS 3GPP PS Data Off Service Accessibility\nX.1\tGeneral\n3GPP PS Data Off is an optional feature. When activated by the user and when the network supports the feature, this feature allows control of the IMS services and more broadly SIP based services using the IMS framework that the user is allowed to access, for both originating and terminating sessions.\nThe list of 3GPP PS Data Off Exempted Services is configured by the HPLMN in the UE and in the network for enforcement. The list of SIP based service can include any one or any combination of the following services:\n-\tMMTel Voice;\n-\tSMS over IMS;\n-\tMMTel Video;\n-\tUSSI;\n-\tParticular IMS Services not defined by 3GPP, where each such IMS service is identified by an IMS communication service identifier.\nX.2\tUE Behaviour\nX.2.1\tUE 3GPP PS Data Off Status Reporting\nThe UE shall include an indication that depicts the 3GPP PS Data Off status (active/inactive) at initial IMS registration, and subsequent to that, any time the end user changes the 3GPP PS Data Off status in a (re-)REGISTER request. In all these registration requests the UE shall register the SIP based services that are configured in the UE.\nNOTE:\tWhen the 3GPP PS Data Off status is reported, the configured SIP based services in UE are registered as defined in clause B.3.1.0 of TS 24.229 [10a].\nThe UE and the network shall ensure that the proper services are enforced in accordance with the 3GPP PS Data Off status.\nX.2.2\tUE Provisioning\nThe UE may be provisoned by HPLMN with up to two enumerated lists of SIP-based services that are 3GPP PS Data Off exempted either via Device Management or in the UICC, one list is valid for the UEs camping in the home PLMN and the other list is valid for any VPLMN the UE is roaming in. When the UE is configured only with a single list, without an indication to which PLMNs the list is applicable, then this list is valid for the home PLMN and any PLMN the UE is roaming in.\nA UE provisioned with an updated list shall enforce the updated list immediately.\nX.2.3\tUE Enforcement of 3GPP SIP-Based 3GPP PS Data Off Exempt Services\nWhen the UE changes its 3GPP PS Data Off status from inactive to active, the UE shall ensure that only the 3GPP PS Data Off Exempted Services in the provisioned list are allowed to be transported, and the corresponding IP uplink packets shall be sent accordingly as follows:\n-\tThe UE shall prevent sending of UE-originating SIP requests which are for services other than the 3GPP PS Data Off Exempted Services configured in the UE via device management or in the UICC.\n-\tThe UE shall prevent sending of SDP offers and SDP answers with media streams for the media types other than those related to the 3GPP PS Data Off Exempted Services configured via device management or in the UICC.\n-\tA UE shall immediately stop sending any media packets and shall terminate all ongoing sessions for all SIP-based services that are not 3GPP PS Data Off Exempt.\n-\tA UE provisioned with an updated list shall enforce the updated list immediately. To that effect, the UE shall immediately stop sending any media packets and terminate all ongoing SIP-based sessions handling the 3GPP PS Data Off Exempt Service(s) removed from the list.\nX.3\tNetwork Behaviour\nX.3.1\tNetwork Update to 3GPP PS Data Off Exempted Services\nThe HPLMN network shall provision in the UE either via Device Management or in the UICC the lists of 3GPP PS Data Off Exempt Services. Up to two lists are provisioned in the UE for that purpose: one list is used when the UE is at home, while the second list is used when the UE is roaming in any visited PLMN.\nThe information shall be provisioned in the UE prior to enabling the 3GPP PS Data Off Service. Any change to either one or both lists shall immediately be sent to the UE for enforcement.\nX.3.2\tNetwork Enforcement of SIP-Based 3GPP PS Data Off Exempted Services\nApplication Servers implementing the SIP-based services shall enforce the SIP based 3GPP PS Data Off Exempted services for all UEs.\nEach Application Server shall be configured with up to two lists of 3GPP PS Data Off Exempt Services, one list for non-roaming users, and the other list for users roaming in the various VPLMNs with whom roaming agreements exist.\nThe AS shall become aware of the UE 3GPP Data Off status (active/inactive) at IMS (re-)Registration through third party registration. If the UE has changed its 3GPP PS Data Off status from inactive to active, the AS shall ensure that only SIP-based services which are part of the SIP-based 3GPP PS Data Off Exempt Services are permitted.\nIf the UE has changed its 3GPP PS Data Off status from active to inactive, the AS shall also let through the terminating requests to the UE for services that were not Data Off exempt.\nNOTE 1:\tThe AS could be implemented in an existing AS e.g. SCC AS or distributed across other AS's.\nNOTE 2:\tThe operator needs to ensure coordinated lists of 3GPP Data Off Exempt services provisioned in the UE and configured the network.\nAnnex Y (normative):IP-Connectivity Access Network specific concepts when using 5GS to access IMS\nY.0\tGeneral\nThis clause describes the main IP-Connectivity Access Network specific concepts that are used for the provisioning of IMS services over 5GS.\nHSS is used to store IMS related subscription and context as shown in the Figure 4.0 \"Reference Architecture\" specified in clause 4.0. For 5GS, HSS functionality for IMS shall continue to be as standalone regardless if it is co-located or implemented as part of the UDM. When the HSS and UDM are deployed as separate network functions, their interaction is defined by TS 23.632 [97] and TS 29.563 [98], or it may be implementation specific. A single IMS subscription profile is used regardless of UE accessing IMS via different IP-CANs.\nFigure Y.0-1: UDM and HSS collocated or HSS as part of UDM\nNOTE:\tThe HSS shown in Figure Y.0-1 is only considering the functionality required for IMS.\nFrom IMS perspective, either the N5 interface as specified in TS 23.503 [95] or the Rx interface as specified in TS 23.203 [54] are used between the P‑CSCF and the Policy Control Function (PCF).\nNOTE:\tIn PLMNs where both Rx and N5 are used it is implementation specific how the P-CSCF determins the applicable interface/protocol used for a particular interaction with the PCF/PCRF - e.g. Separate P-CSCF's used for Rx and N5, local routing configuration in the P-CSCF.\nIn 5G System the Gm reference point defined in clause 4.0 and clause 4.4 is supported for the communication between UE and IMS, e.g. related to registration and session control. Therefore, the same interface is used, i.e. Gm, from P-CSCF perspective towards the UE, when UE is in 5G System or any other IP-CAN.\nY.1\tMobility related concepts\nY.1.0\tGeneral\nTo support IMS, the UE shall establish a PDU session with PDU session type set to IP for the corresponding DNN (see TS 23.501 [93], clause 5.6.1), and acquire an IP address according to TS 23.501 [93], clause 5.8.2.2. If IMS Multimedia Telephony Service as specified in TS 22.173 [53] is to be used within the PDU session, SSC mode 1 shall be set for the PDU session. In this release of the specification, it is assumed that single PDU session with multiple PDU session anchors defined in TS 23.501 [93] clause 5.6.4 is not applicable for PDU sessions dedicated to IMS.\nNOTE 1:\tIn the case of Dual Registration as defined in TS 23.501 [93], the UE will register (and if needed re-register) in IMS with the IP address of the IMS PDU session when the IMS PDU session is transferred between 5GS and EPS.\nIf the UE changes its IP address due to changes triggered by the 5GS procedures or due to, for example, PLMN change, then the UE shall re- register in the IMS.\nIf the UE acquires an additional IP address, then the UE may perform an IMS registration using this additional IP address as the contact address. If IMS registration is performed, this IMS registration may co-exist with the previous IMS registration from this UE and the UE shall be notified that this IMS registration results in multiple simultaneous registrations.\nNOTE 2:\tIn this Release of the specification, the UE can acquire an additional IP address that can be used for registration to the IMS only outside of the 5G System.\nIn Dual Connectivity with 5GC case, the UE shall use the access network information based on the primary cell of the Master RAN node that is serving the UE for network location information when the UE interacts with IMS, regardless whether the IMS traffic is routed via the Master RAN node or the Secondary RAN node or both.\nY.1.1\tProcedures for P‑CSCF discovery\nAll the procedures described in clause 5.1.1 apply with the following additions:\n-\tFor the option where P-CSCF discovery is part of the IP-CAN connectivity establishment the following applies:\n-\tP‑CSCF discovery shall take place during the PDU session establishment procedure see TS 23.502 [94], clause 4.3.2.\nIn addition to the procedures in clause 5.1.1, the SMF may determine the P-CSCF using service-based discovery methods (using the NRF), as described in TS 23.501 [93] clause 5.16.3.\nY.2\tQoS related concepts\nY.2.1\tApplication Level Signalling for IMS\nY.2.1.0\tGeneral\nWhen the UE uses 5GS-access for IMS services, it shall be possible to establish at least one QoS flow identified by a QFI for IMS signalling.\nY.2.1.1\tQoS Requirements for Application Level Signalling\nIt shall be possible to request prioritised handling over the 5GS system for IMS signalling by applying the appropriate 5QI for the established QoS flow for the IMS signalling, see TS 23.501 [93], clause 5.7.\nY.2.1.2\tVoid\nY.2.2\tThe QoS requirements for an IMS session\nY.2.2.0\tGeneral\nThe selection, deployment, initiation, and termination of QoS signalling and resource allocation shall consider:\n-\tThe general requirements described in clause 4.2.5.\n-\tThe QoS handling is described in TS 23.501 [93], TS 23.502 [94] and TS 23.203 [54] and TS 23.503 [95].\nY.2.2.1\tRelation of IMS media components and 5GS QoS flows carrying IMS media\nAll associated media flows (such as e.g. RTP / RTCP flows) used by the UE to support a single media component are assumed to be carried within the same 5GS QoS flow.\nY.2.3\tInteraction between 5GS QoS and session signalling\nY.2.3.0\tGeneral\nThe generic mechanisms for interaction between QoS and session signalling are described in clause 5.4.7. The mechanisms described there and the related procedures througout the present specification are applicable to 5GS-accesses as well with the following clarifications:\n-\tAn IP-CAN bearer in this specification shall be interpreted as a 5GS QoS flow.\n-\tAn IP-CAN session in this specification shall be interpreted as a 5GS PDU session of type IP.\n-\tThe negotiation of the bearer establishment mode does not apply for the 5GS.\n-\tThe PCEF corresponds to the combination of SMF and UPF.\nY.2.3.1\tResource Reservation with PCF\nThe UE or 5GC can initiate the resource reservation request for the media parameters negotiated over SDP using PDU session modification procedure, see TS 23.502 [94], clause 4.3.3. However, for IMS. the network shall initiate the establishment, modification and termination of 5GS QoS flows triggered by negotiated SDP.\nY.2.4\tNetwork initiated session release - P-CSCF initiated\nY.2.4.0\tGeneral\nIn the event of loss of coverage for 5GS radio access, TS 23.502 [94], clause 4.2.6, defines the N2 release procedure. This procedure releases the QoS flows. This is indicated to the P‑CSCF as shown in figure Y.3.\nY.2.4.1\tNetwork initiated session release - P-CSCF initiated\nCovers radio coverage loss and that GFBR cannot be maintained by the radio access.\nFigure Y.3: Network initiated session release - P‑CSCF initiated after loss of radio coverage\n1.\tIn the case of loss of radio coverage or that GFBR cannot be retained in NG-RAN, the 5GC may release the related GBR QoS flow and PCF and P-CSCF are notified appropriately.\n2.\tThe P‑CSCF decides on the termination of the IMS session. In the event of the notification that the signalling transport to the UE is no longer possible, the P‑CSCF shall terminate any ongoing IMS session with that specific UE. If the P‑CSCF decides to terminate the IMS session, it indicates this to PCF, which removes the authorization for resources that had previously been issued for this endpoint for this session. (see TS 23.503 [95]).\nThe following steps are only performed in the case the P‑CSCF has decided to terminate the session.\n3.\tThe P‑CSCF generates a Release (Bye message in SIP) to the S‑CSCF of the releasing party.\n4.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session. The S‑CSCF of the releasing party forwards the Release to the S‑CSCF of the other party.\n5.\tThe S‑CSCF invokes whatever service logic procedures are appropriate for this ending session. The S‑CSCF of the other party forwards the Release on to the P‑CSCF.\n6.\tThe P‑CSCF of the other party removes the authorization for resources if they have previously been issued for this endpoint for this session. The P‑CSCF forwards the Release to the UE.\n7.\tThe UE of the other party responds with a SIP OK to the P‑CSCF\n8.\tDepending on the Bearer Control Mode selected for the IP‑CAN session, the release of previously reserved resources shall be initiated either by the UE or by the IP‑CAN itself. The SIP OK message is sent to the S‑CSCF of the other party.\n9.\tThe S‑CSCF of the other party forwards the OK to the S‑CSCF of the releasing party.\n10.\tThe S‑CSCF of the releasing party forwards the OK to the P‑CSCF of the releasing party.\nY.3\tAddress and identity management concepts\nY.3.1\tDeriving IMS identifiers from the USIM\nIf the UICC does not contain an ISIM application, and the permanent user identity is IMSI then clause E.3.1 applies.\nY.4\tIP version interworking in IMS\nA PDU session is associated with either an IPv4 or an IPv6 address. For communication with the IMS, the UE shall acquire an IP address according to TS 23.501 [93], clause 5.8.1.1 for the PDU session. The IP address will be either an IPv4 address or and IPv6 address. Hence, a UE will register to the IMS with either an IPv4 or an IPv6 address. Here the P-CSCF and IMS-AGW may support both IP versions and/or may do interworking depending IP version used within the IMS. If the P-CSCF and IMS-AGW do not support both versions, then network design is expected to ensure that IP address incompatibility does not occur.\nY.5\tUsage of NAT in 5GS\nThere should be no NAT (or its existence should be kept transparent towards the UE) located between the UPF and the P‑CSCF, which is possible as they are either located within the same private network and share same address space, or both the UE and the P‑CSCF are assigned globally unique IP addresses (see Annex M).\nNOTE:\tIf the UE discover a NAT between the UE and the P‑CSCF, the UE might send frequent keep-alive messages and that may drain the UE battery.\nY.6\tRetrieval of Network Provided Location Information in 5GS\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements (e.g. data retention, lawful interception) and/or in order to enable certain types of added value services based on the user's location.\nDepending on usage scenario, the following mechanisms are defined and can be used to retrieve the user location and/or UE Time Zone information from the access network when using 5GS to access IMS:\n-\tThe P‑CSCF can retrieve the user location and/or UE Time Zone information using PCC mechanisms as specified in TS 23.203 [54] / TS 23.503 [95] and in TS 29.214 [11]. Operator policy determines whether to provide the user location and/or UE Time Zone information from the access network in the INVITE request, a MESSAGE request, or within a subsequent message of the dialog.\n-\tWhen the user location and/or UE Time Zone information is required from the access network but not already available (e.g. when required in an INVITE request, when it is needed prior to session delivery, or when call is broken out to a MGCF), an IMS AS can trigger the retrieval of the user location and/or UE Time Zone information from the AMF via the HSS/UDM as specified in TS 29.328 [79] and as described in clause 4.2.4a.\nInformation flows on how user location and/or UE Time Zone information can be further distributed within IMS depending on the alternative mechanism used can be found in, Annex R, where the terms HSS and HSS/UDM shall be understood as in clause Y.0.\nThe level of granularity of user location information may be changed at network/trust boundaries. Thus, the level of user location information granularity that can be retrieved by an IMS AS via the HSS/UDM-based procedures in roaming scenarios depends on inter-operator agreement, and needs to be aligned with policies in the P-CSCF.\nInformation related to the location of the user provided by the access network may be required in IMS in order to comply with regulatory requirements for SMS over IP. The P-CSCF applies the above mechanisms upon reception of a MESSAGE including the distribution of received information to other IMS entities.\nY.7\tGeographical Identifier\nA network which requires the Geographical Identifier to be generated in the IMS may implement a mapping table between a NG-RAN cell identifier received as part of Access Network Information and a Geographical Identifier. The P-CSCF or an IMS AS may then, based on operator policy, use this mapping table to convert the user location into a Geographical Identifier, and insert the Geographical Identifier in the SIP signalling, thus enabling routing decision in downstream IMS entities or interconnected network.\nIn the case that a given cell belongs to more than one area identified by a Geographical Identifier, based on operator policy, the P-CSCF or an IMS AS may use the UE mobility analytics provided by NWDAF as specified in TS 23.288 [103].\nY.8\tSupport for Paging policy differentiation for IMS services\nP-CSCF may support Paging Policy Differentiation (as defined in TS 23.501 [93]) for a specific IMS service by marking packet(s) to be send towards the UE related to that IMS service. For such an IMS service, a specific DSCP (IPv4) value and/or a specific Traffic Class (IPv6) value are assigned by local configuration in the P-CSCF.\nNOTE 1:\tThe packet marking used for Paging Policy Differentiation can also be used for determination of the Paging Cause, for the Multi-USIM UE support, by the relevant 5GS node.\nWhen Paging Policy Differentiation is deployed in a PLMN, all P-CSCF entities of that PLMN shall homogeneously support it and shall be configured with the same policy for setting the specific DSCP (IPv4) and/or Traffic Class (IPv6) values used by P-CSCF for that feature.\nNOTE 2:\tIt is assumed that the DSCP / Traffic Class header is not rewritten by intermediate routers between the P-CSCF and the UPF.\nY.9\tSupport of IMS Services for roaming users\nY.9.1\tGeneral\nThis clause describes support for IMS services for roaming users using IMS level roaming interfaces or without IMS level roaming interfaces.\nY.9.2\tArchitecture without IMS-level roaming interfaces\nThis clause describes the functions that are used to support IMS services for roaming users in deployments without IMS-level roaming interfaces. In this roaming model the UPF holding the UE's IP point of presence is located in the home PLMN and therefore UE IMS signalling and user plane are routed to home PLMN.\nThe architecture to support IMS services for roaming users, including Voice over IMS in deployments without IMS-level roaming interfaces is shown in figure Y.9.2-1.\nThe following architecture requirements apply:\n-\tP-CSCF (in HPLMN) identifies the serving network (VPLMN) where the UE is located using the procedure defined in clause Y.9.3.\nFigure Y.9.2-1: IMS traffic home routed\nY.9.3\tArchitecture with IMS-level roaming interfaces\nFor IMS services with roaming level interfaces the P-CSCF and UPF are located in VPLMN (local breakout), see clauses 4.2.3 and M.1. For roaming architecture for voice over IMS with local breakout see clause 4.15a. For information on how to apply the loopback possibility in clause 4.15a, see clause M.3.\nY.9.4\tSubscription to changes in PLMN ID at IMS Initial Registration\nIn IMS local breakout where P-CSCF is located in VPLMN (see Annex M.1 and Annex M.3), the home network determines the serving PLMN of the UE from the location of the P-CSCF during initial IMS Registration, using the P‑CSCF network identifier.\nIn deployments without IMS-level roaming interfaces, the home network determines the serving PLMN of the UE using procedure defined in TS 23.503 [95], where P-CSCF requests the PCF to report the PLMN identifier where the UE is currently located. The received PLMN ID information is then forwarded in the SIP REGISTER request.\nThis procedure shall be applied by the P-CSCF at initial UE IMS registration.\nFigure Y.9.4-1: Subscription by P-CSCF to changes in PLMN ID during initial IMS Registration\n1.\tThe UE sends a SIP REGISTER request to the P-CSCF.\n2.\tIf this is initial IMS registration then the P-CSCF subscribes to the PCF to be notified of the PLMN ID where the UE is currently attached. The subscription to PLMN changes is active as long as the UE is IMS registered.\nNOTE:\tP-CSCF cancels the subscription to PLMN changes at the PCF when the UE is IMS de-registered.\n3.\tThe PCF forwards the PLMN ID to the P-CSCF. The P-CSCF stores the PLMN ID.\n4.\tThe P-CSCF includes the received PLMN ID in the SIP REGISTER request before forwarding the request to the I-CSCF.\n5.\tNormal IMS registration procedure is then completed.\nY.10\tSupport of RAN Assisted Codec Adaptation\nRAN assisted codec adaptation is supported as described in clause E.10 with the addition that RAN assisted codec adaptation needs to be supported on NR RAT as specified in TS 38.300 [101] and TS 38.321 [102], in addition to E-UTRA RAT.\nY.11\tVoid\nY.12\tP-CSCF Registration in NRF\nIn order to support service based SMF discovery of the P-CSCF using the NRF (as described in TS 23.501 [93] clause 5.16.3) the P-CSCF's in a network will need to register with an applicable NRF. When a network uses other P-CSCF discovery methods (as described in clause 5.1.1) the P-CSCF does not need to register with the NRF. Local configuration of the P-CSCF is used to determine if the P-CSCF shall perform registration with the NRF.\nWhen the P-CSCF is configured to support SMF discovery of the P-CSCF, P-CSCF shall register in NRF their capabilities using the Nnrf_NFManagement_NFRegister Request message. The NF profile of the P-CSCF registered in NRF shall include the IP address and may include an FQDN if available. The same applies to the Nnrf_NFManagement_NFUpdate Request.\nBased on the same configuration, a P-CSCF taken out of service will deregister itself using the Nnrf_NFManagement_NFDeregister Request.\nY.13\tSubscription to EPS Fallback Event\nBased on local configuration in the case of an originating or a terminating session, the P-CSCF may subscribe to the PCF for notification for the EPS Fallback event using existing procedures defined in TS 23.503 [95].\nIf the PCF reports that an EPS fallback occurred, based on local configuration, the P-CSCF may include this information in outgoing SIP messages towards other IMS nodes.\nAnnex Z (normative):Support of IMS-based Restricted Local Operator Services (RLOS)\nZ.1\tGeneral\nThis clause describes the required functions to support IMS-based restricted local operator services (RLOS). RLOS services are operator owned services that are offered to the following categories of subscribers:\n-\tRoaming users who are subscribers of other operators with whom the local operator has no roaming agreement, or the local operator cannot communicate with their network.\n-\tRoaming users who are subscribers of other operators with whom the local operator has roaming agreements for IMS services and for Restricted Operator Local Services.\n-\tOperator own subscribers who roamed in cells with restricted services. These subscribers may or may not have been successfully authenticated prior to roaming in cells with restricted services.\nNOTE:\tOperator restricted services can also be offered to the local operator own subscribers roaming in unrestricted areas, however this is out of scope.\nRLOS is used only for originating services.\nIn this version of the specification, RLOS is only defined for users connected to IMS over EPS (see TS 23.401 [70]);\nZ.2\tArchitecture\nSupport for RLOS requires additional functionalities in the P-CSCF, I- CSCF, and S-CSCF as will be depicted below. The additional functionality can be built on the existing functionality to support RLOS and non-RLOS IMS services. Optionally, dedicated IMS nodes (P/I/S-CSCFs) supporting only RLOS can be deployed.\nNOTE:\tArchitecture for roaming scenarios without IMS-level roaming agreement (as defined in Annex W) does not apply to RLOS users accessing IMS.\nZ.3\tIMS Registration to access RLOS\nZ.3.1\tRLOS IMS Registration for Roaming users (no roaming Agreements with home network)\nFigure Z.3.1-1: RLOS IMS Registration procedures for roaming users without roaming agreements with their home network\n1.\tAfter the UE has obtained IP connectivity (as defined in TS 23.401 [70] for RLOS users), it performs regular IMS registration and includes an indication that this is an RLOS related IMS registration in the Register information.\n2.\tThe P‑CSCF is a P-CSCF that supports RLOS, and upon receipt of the Register information, optionally, and based on operator policy performs the security checks in clause Z.3.3. Based on the subscriber being a roaming user without roaming agreement with his home network, and the RLOS indication in the Register information, the P-CSCF shall send the Register information to the S-CSCF configured in the P-CSCF to handle RLOS users.\nNOTE:\tThe P-CSCF ID for handling RLOS would have been sent to the UE during the Attach procedure which included an explicit indication to access RLOS.\nSteps 3-8 apply if the S-CSCF has responded with 420 response.\n3.\tUpon receipt of the Register information, the S-CSCF, based on the RLOS indication and the subscriber being a roaming user without roaming agreement with his home network and depending on the network configuration, and if the network supports GIBA, sends back a 420 response with sec-agree value listed in the unsupported header field.\n4.\tThe P-CSCF forwards the 420 response to the UE.\n5.\tThe UE initiates a new Register request and does not include the Authorization header field.\n6.\tThe P-CSCF optionally performs the RLOS APN verification in clause Z.3.3, then sends the Register information to the S-CSCF allocated to the UE.\n7.\tUpon receipt of the Register information, the S-CSCF shall accept the Registration, creates a temporary record for the unauthenticated UE with a default service profile and responds with a 200 OK.\n8.\tThe P-CSCF sends the 200 OK to the UE.\nSteps 9-10 apply if the S-CSCF has responded with 403 response.\n9.\tUpon receipt of the Register information, the S-CSCF, based on the RLOS indication and the subscriber being a roaming user without roaming agreement with his home network and depending on the network configuration as well as operator configuration (no support for GIBA), responds with a 403 response. The S-CSCF creates a temporary registration record for the unauthenticated UEs with a default service profile.\n10.\tThe P-CSCF sends the 403 response to the UE. The P-CSCF creates a temporary registration record for the unauthenticated UE given that the subscriber is a roaming user without roaming agreement with his home network. The UE is allowed to initiate an IMS session.\nZ.3.2\tRLOS IMS Registration for Operator own subscribers and Roaming users with roaming agreements with their home network\nOperator own subscribers, and/or roaming users with IMS services and Restricted Local Operator Services roaming agreement with their home network, shall perform a new IMS registration, as specified below, to access IMS-based Restricted Local Operator Services upon roaming in cells with restricted services. The UE shall also delete any valid IMS registration performed by the UE prior to roaming in cells with restricted services.\nZ.3.2.1\tUnsuccessful IMS Registration\nFigure Z.3.2.1-1: Unsuccessful RLOS IMS Registration procedure\n1.\tAfter the UE has obtained IP connectivity (as defined in TS 23.401 [70] for RLOS users), it performs regular IMS registration and includes an indication that this is an RLOS IMS related registration in the Register information.\n2.\tThe P-CSCF is a P-CSCF that supports RLOS, and upon receipt of the Register information optionally, and based on operator policy, performs the RLOS APN verification in clause Z.3.3. The P-CSCF based on the RLOS indication and the subscriber being its own subscriber sends the Register information to the I-CSCF.\nNOTE 1:\tThe P-CSCF ID for handling RLOS would have been sent to the UE during the Attach procedure which included an explicit indication to access RLOS.\n3.\tThe I-CSCF queries HSS for the subscriber S-CSCF. If the I-CSCF determines based on configuration that the received S-CSCF does not support RLOS and since this is an RLOS related registration, the I-CSCF queries HSS again for required S-CSCF capabilities in the user profile. The I-CSCF shall use the returned S-CSCF capability information and in addition configured information about S-CSCF support for RLOS to select a S-CSCF.\nNOTE 2:\tThe S-CSCF allocated to a subscriber may be from an old registration that did not expire and is not deleted, or for an RLOS related registration. The S-CSCF support of RLOS is preconfigured in the I-CSCF rather than a capability stored in the user profile within the HSS as otherwise RLOS support would be a requirement for the S-CSCF selection even if the registration is not for RLOS.\n4.\tThe I-CSCF sends the Register information to the selected S-CSCF.\n5.\tThe S-CSCF fetches the authentication information from HSS.\n6.\tThe S-CSCF challenges the UE by sending a 401 response.\n7.\tThe I-CSCF forwards the 401 response to the P-CSCF.\n8.\tThe P-CSCF forwards the 401 response to the UE.\n9.\tThe UE sends a new Register request to the P-CSCF including the authentication information.\n10.\tThe P-CSCF optionally and based on operator policy, performs the RLOS APN verification in clause Z.3.3, then sends the Register information to the I-CSCF.\n11.\tThe I-CSCF queries HSS for the subscriber S-CSCF and receives the S-CSCF name allocated to the UE. If the I-CSCF determines based on configuration that the received S-CSCF does not support RLOS and since this is an RLOS related registration, the I-CSCF queries HSS again for required S-CSCF capabilities in the user profile. The I-CSCF shall use the returned S-CSCF capability information and in addition configured information about S-CSCF support for RLOS to select a S-CFCF.\n12.\tThe I-CSCF sends the Register information to the selected S-CSCF.\n13.\tThe S-CSCF validates the UE received authentication information but failed to successfully authenticate the UE. Since this is an RLOS related IMS registration, the S-CSCF creates a temporary \"unauthenticated subscriber\" registration record for the UE with a default service profile and responds with a 403 response.\n14.\tThe I-CSCF sends the 403 response to the P-CSCF.\n15.\tThe P-CSCF sends the 403 response to the UE, and creates a temporary \"unauthenticated subscriber\" registration record for the UE.\nZ.3.2.2\tSuccessful IMS Registration\nA successful IMS registration is identical to the failed one with following exceptions:\n-\tThe S-CSCF successfully authenticates the UE in step 12.\n-\tThe S-CSCF tags the UE registration record as being successfully RLOS registered.\n-\tThe S-CSCF updates HSS with the S-CSCF name being allocated to the UE, downloads the UE profile from HSS, and stores it. This step is not performed in the previous case.\n-\tThe P-CSCF tags the UE registration record as being successfully RLOS registered.\nZ.3.3\tRLOS APN Verification\nThe P-CSCF may be configured with a range of IP addresses dedicated to UEs requesting access to RLOS. These addresses, if configured, shall be checked against the contact information received by the P-CSCF Register information at IMS registration.\nFurthermore, the P-CSCF shall validate that an incoming IMS registration did indeed use the APN dedicated to RLOS by the access network. To that effect, the P-CSCF shall indicate to the PCRF that the UE requests access to RLOS. The PCRF shall then validate whether the UE uses the APN dedicated to RLOS and otherwise reject the related Rx session with the indication that the UE is not using the APN dedicated to RLOS. Upon reception of such an indication from the PCRF, the P-CSCF shall reject the IMS registration.\nZ.4\tIMS-based RLOS Session Initiation\nClause 5.6.2 applies with the following additional requirements:\n-\tThe UE shall include an RLOS indication in all originating sessions. The P-CSCF shall reject an originating session without such an indication.\n-\tThe S-CSCF shall include the RLOS indication in its charging data related to an IMS session.\n-\tThe S-CSCF shall forward the session initiation request to the Telephony Application Server. The Telephony Application Server shall bypass originating services for all successfully authenticated UEs. The Telephony Application Server, based on operator policy, may be configured with different policies (e.g. set of destinations) for all of the above registration cases. The Telephony Application Server shall enforce these policies.\n-\tThe S-CSCF shall include the RLOS indication in its charging data related to an IMS session.\n-\tThe registered identity shall be used as the asserted identity.\nAnnex AA (normative):Support of SBA in IMS\nAA.1\tGeneral\nAA.1.0\tOverview\nThis Annex AA describes support for SBA for IMS nodes. This Annex is intended to be used in conjunction with 5GC.\nAA.1.1\tArchitectural Support\nFigure AA.1.1-1 shows the architecture to support SBA interactions between IMS entities.\nFigure AA.1.1-1: System Architecture to support SBA in IMS\nNOTE 1:\tThe DCSF and MRF supports NF registration and discovery, but they do not provide services in this release of the specification.\nNOTE 2:\tNimsas services are defined in the context of IMS Data Channel, see clause AA.2.4.\nFigure AA.1.1-2 shows the architecture using the reference point representation.\nFigure AA.1.1-2: System Architecture to support SBA in IMS in reference point representation\nNOTE 3:\tIn this Release of the specification the SBI capable IMS AS supporting data channel services is collocated with the TAS.\nAA.1.2\tReference point to support SBA in IMS\nFollowing reference points are realized by service-based interfaces in IMS:\nN5:\tReference point between the PCF and an AF.\nNOTE:\tP-CSCF acts as an AF from PCF point of view. N5 Reference point is defined in TS 23.501 [93].\nN70:\tReference point between an SBI capable I/S-CSCF and an SBI capable HSS.\nN71:\tReference point between an SBI capable IMS AS and an SBI capable HSS.\nDC1:\tReference point between an SBI capable IMS AS and DCSF.\nDC2:\tReference point between an SBI capable IMS AS and MF.\nN72:\tReference point between DCSF and an SBI capable HSS.\nAA.1.3\tService based interface to support SBA in IMS\nNpcf:\tService-based interface exhibited by PCF.\nNhss:\tService-based interface exhibited by an SBI capable HSS.\nThese SBI services provide equivalent functionality to the Diameter Rx and Cx/Sh reference points.\nNimsas:\tService-based interface exhibited by an SBI capable IMS AS.\nNmf:\tService-based interface exhibited by MF.\nThese SBI services provide functionality to support data channel management and media handling in IMS network.\nTo support co-existence of IMS nodes supporting SBA services and IMS nodes not supporting SBA services SBI enabled IMS nodes may support both SBI and non-SBI interfaces.\nNOTE:\tNnrf may assist other IMS nodes to use NRF to perform registration, discovery, or selection, as described in clause AA.4.\nAA.2\tIMS SBA Services\nAA.2.1\tHSS Services\nAA.2.1.1\tGeneral\nThe following table shows the services exposed by an SBI capable HSS.\nTable AA.2.1.1-1: IMS Services provided by an SBI capable HSS\nService\nService Operations\nOperation Semantics\nExample Consumer(s)\nimsSubscriber Data\nGet\nRequest/Response\nS-CSCF, I-CSCF, AS, DCSF\nManagement (_ImsSDM)\nSubscribe\nSubscribe/Notify\nS-CSCF, AS\nUnsubscribe\nSubscribe/Notify\nS-CSCF, AS\nNotification\nSubscribe/Notify\nS-CSCF, AS\nUpdate\nRequest/Response\nAS, DCSF\nimsUE Context\nRegistration\nRequest/Response\nS-CSCF\nManagement\nDeregistrationNotification\nSubscribe/Notify\nS-CSCF\n(_ImsUECM)\nDeregistration\nRequest/Response\nS-CSCF\nAuthorize\nRequest/Response\nI-CSCF\nUpdate\nRequest/Response\nS-CSCF\nRestorationInfoGet\nRequest/Response\nS-CSCF\nRestorationInfoUpdate\nRequest/Response\nS-CSCF\nImsUE Authentication\nGet\nRequest/Response\nS-CSCF\nAA.2.1.2\tNhss_ImsUEContextManagement (ImsUECM) service\nAA.2.1.2.1\tNhss_ImsUECM_Registration service operation\nService operation name: Nhss_ImsUECM_Registration\nDescription: This service operation registers the serving S-CSCF assigned to an IMS User. If authentication is not to be performed, this operation also sets the registration state. The S-CSCF is implicitly subscribed to be notified when it is deregistered in HSS. This notification is done by means of Nhss_ImsUECM_DeregistrationNotification operation.\nInputs, Required: Public Identity, S-CSCF name, Registration Type (e.g. Initial Registration, Unregistered).\nInputs, Optional: Private Identity.\nOutputs, Required: Result indication.\nOutputs, Optional: List of registered Private Identities sharing the same Public Identity which is being registered, S-CSCF Restoration indication.\nAA.2.1.2.2\tNhss_ImsUECM_Deregistration service operation\nService operation name: Nhss_ImsUECM_Deregistration\nDescription: This service operation deregisters the S-CSCF allocated to a public identity.\nInputs, Required: S-CSCF name, Deregistration Type.\nInputs, Optional: User Identity (Private Identity and/or Public Identity), P-CSCF Restoration indication, Session Priority.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nAA.2.1.2.3\tNhss_ImsUECM_DeregistrationNotification service operation\nService operation name: Nhss_ImsUECM_DeregistrationNotification\nDescription: This service operation enables HSS to inform a S-CSCF which has previously registered in HSS of a Public Identity deregistration. This notification corresponds to an implicit subscription.\nInputs, Required: Private Identity, Reason for Deregistration.\nInputs, Optional: Public Identity, Associated Private Identities.\nOutputs, Required: Result indication.\nOutputs, Optional: Associated Private Identities, Identities with Emergency Registration.\nAA.2.1.2.4\tNhss_ImsUECM_Authorize service operation\nService operation name: Nhss_ImsUECM_Authorize\nDescription: This service operation is used by the I-CSCF to request authorization from HSS for:\n-\tThe registration of a Public Identity by a UE in a P‑CSCF network identifier according to the IMS User's subscription and operator limitations/restrictions.\n-\tThe reception of a terminating request based on the user state and IMS user's subscription (e.g. IMS User's barring status).\nIf the IMS User is authorized, the HSS may provide the address of the S-CSCF assigned to the Public Identity if any.\nAdditionally, this service operation is used to authorize in HSS a S-CSCF reselection (e.g. after I-CSCF detection if a S-CSCF failure).\nInputs, Required: Public Identity, Authorization Type.\nInputs, Optional: Private User Identity, P‑CSCF network identifier.\nOutputs, Required: Result indication.\nOutputs, Optional: S-CSCF name.\nAA.2.1.2.5\tNhss_ImsUECM_Update service operation\nService operation name: Nhss_ImsUECM_Update\nDescription: This service operation updates the registration state of a Public Identity or Private Identity in HSS i.e. to update the registration state from Not Registered or Unregistered to Registered state.\nNOTE:\tThis operation is used by S-CSCF after successful authentication to set the registration state (if not already set).\nInputs, Required: Public Identity, S-CSCF name.\nInputs, Optional: Private Identity.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nAA.2.1.2.6\tNhss_ImsUECM_RestorationInfoGet service operation\nService operation name: Nhss_ImsUECM_RestorationInfoGet\nDescription: This service operation is used between the S-CSCF and the HSS to retrieve information from HSS to support the S-CSCF procedures.\nInputs, Required: Public Identity.\nInputs, Optional: Private Identity.\nOutputs, Required: Result Indication.\nOutputs, Optional: Restoration data.\nAA.2.1.2.7\tNhss_ImsUECM_RestorationInfoUpdate service operation\nService operation name: Nhss_ImsUECM_RestorationInfoUpdate\nDescription: This service operation is used between the S-CSCF and the HSS to update information in HSS to support the S-CSCF Restoration procedures.\nInputs, Required: Private Identity, Public Identity, Restoration data.\nInputs, Optional: None.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nAA.2.1.3\tNhss_ImsSubscriberDataManagement (ImsSDM) service\nAA.2.1.3.1\tGeneral\nIMS Subscriber data types used in the Nhss_ImsSDM Service are defined in Table AA.2.1.3.1-1 below.\nNOTE:\tIMS Subscriber data is terminology only used in Annex AA. It includes IMS subscription data and other data related to the subscriber, e.g. network functionality entity address, location information or T-ADS information.\nTable AA.2.1.3.1-1: IMS Subscriber data types\nIMS Subscriber data\nDescription\nService Profile Data\nThis may include e.g. service parameters, the S-CSCF allocated to a public identity or the list of S-CSCFs and their capabilities, Application Server address, triggers, information on subscribed media, profile parameters (e.g. barring indicator, etc.) as defined in TS 29.228 [30].\nService Profile Data is consumed by CSCF.\nRepository Data\nData that is understood syntactically but not semantically by the HSS (unstructured Data). It is data that an AS or DCSF may store in the HSS to support its service logic. One example is data that an AS or DCSF stores in the HSS, using it as a repository.\nService Indication identifies the set of service related transparent data associated to a Public Identity.\nRepository Data is consumed by IMS-AS and DCSF.\nNon-Transparent Data\nData that is understood both syntactically and semantically by the HSS e.g. location information. Non-Transparent Data is structured using data references as defined in TS 29.328 [79].\nNon-Transparent Data is consumed by IMS-AS.\nAt least a mandatory key is required for each IMS Subscriber Data Type to identify the corresponding data as defined in Table AA.2.1.3.1-2 below.\nTable AA.2.1.3.1-2: IMS Subscriber data types keys\nIMS Subscriber Data Types\nData Key\nData Sub Key\nService Profile Data\nPublic Identity\nRepository Data\nPublic Identity\nService Indication\nNon-Transparent Data\nSee NOTE 1\nNOTE 1:\tTS 29.328 [79] defines the data keys/subkeys required by each data reference.\nAA.2.1.3.2\tNhss_ImsSDM_Get service operation\nService operation name: Nhss_ImsSDM_Get\nDescription: This service operation enables the NF consumer to fetch the service profile data, repository data, and non-transparent data references for an IMS User.\nThe HSS shall check that the requested NF consumer is authorized to fetch the requested data. In the case that the requested data is Repository data, the HSS may also authorize based on service indication.\nInputs, Required: NF Type, IMS Subscriber data type(s), Key for each IMS Subscriber data type(s).\nInputs, Optional: Application Service Identity.\nOutputs, Required: Result indication.\nOutputs, Optional: Requested Data.\nAA.2.1.3.3\tNhss_ImsSDM_Subscribe service operation\nService operation name: Nhss_ImsSDM_Subscribe\nDescription: The NF consumer subscribes for updates to requested data. HSS shall check that the requested NF consumer is authorized to subscribe to requested updates.\nInputs, Required: NF Type, IMS Subscriber data type(s), Key for each IMS Subscriber data type(s).\nInputs, Optional: Application Server Identity.\nOutputs, Required: When the subscription is accepted: Subscription Correlation ID.\nOutputs, Optional: None.\nAA.2.1.3.4\tNhss_ImsSDM_Unsubscribe service operation\nService operation name: Nhss_ImsSDM_Unsubscribe\nDescription: The NF consumer unsubscribes for updates to Requested data.\nInputs, Required: Subscription Correlation ID.\nInputs, Optional: None.\nOutputs, Required: Result.\nOutputs, Optional: None.\nAA.2.1.3.5\tNhss_ImsSDM_Notification service operation\nService operation name: Nhss_ImsSDM_Notification\nDescription: This service operation enables HSS to notify a NF of any changes to what the NF subscribed to.\nInputs, Required: IMS Subscriber data type(s), Key for each IMS Subscriber data type(s).\nInputs, Optional: None.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nAA.2.1.3.6\tNhss_ImsSDM_Update service operation\nService operation name: Nhss_ImsSDM_Update\nDescription: The NF consumer updates HSS subscription data if authorized to do so.\nInputs, Required: NF Type, IMS Subscriber data type(s), Key for each IMS Subscriber data type(s).\nInputs, Optional: Application Service Identity.\nOutputs, Required: Result.\nOutputs, Optional: None.\nAA.2.1.4\tNhss_ImsUEAuthentication service\nAA.2.1.4.1\tNhss_ImsUEAuthenticate_Get service operation\nService operation name: Nhss_ImsUEAuthenticate_Get\nDescription: This service operation is used between the S-CSCF and the HSS to exchange information to support the authentication between the end user and the home IMS network.\nInputs, Required: Private User Identity, Public User Identity, Authentication Data (Authentication Scheme).\nInputs, Optional: Authentication Data (Authentication Context, Authorization Information).\nOutputs, Required: Result Indication.\nOutputs, Optional: User Identity, Authentication Data (e.g. AV).\nAA.2.2\tMapping of Cx and Sh operations and terminology to HSS SBI services\nAA.2.2.1\tGeneral\nThis clause gives mappings from Cx and Sh operations to HSS SBI services and service operations.\nAA.2.2.2\tMapping of Cx messages to HSS SBI services\nThe following table defines the mapping between stage 2 Cx messages and HSS SBI services and service operations:\nTable AA.2.2.2-1: Cx messages to HSS SBI services and service operations mapping\nCx message\nSource\nDestination\nHSS SBI service operation name\nCx-Query\nI-CSCF\nHSS\nNhss_ImsUECM_Authorize\nCx-Select-Pull\nI-CSCF\nHSS\nNhss_ImsSDM_Get (see NOTE 1)\nCx-Put\nS-CSCF\nHSS\nNhss_ImsUECM_Registration (see NOTE 2)\nNhss_ImsUECM_Deregistration (see NOTE 3)\nNhss_ImsUECM_Update (see NOTE 4)\nNhss_ImsUECM_RestorationInfoUpdate (see NOTE 5)\nCx-Pull\nS-CSCF\nHSS\nNhss_ImsSDM_Get (see NOTE 6)\nNhss_ImsSDM_Subscribe (see NOTE 6)\nNhss_ImsSDM_Unsubscribe\nNhss_ImsUECM_RestorationInfoGet (see NOTE 7)\nCx-Location-Query\nI-CSCF\nHSS\nNhss_ImsUECM_Authorize\nNhss_ImsSDM_Get (see NOTE 8)\nCx-AuthDataReq\nS-CSCF\nHSS\nNhss_ImsUECM_Registration (see NOTE 9)\nNhss_ImsUEAuthenticate_Get\nCx-Deregister\nHSS\nS-CSCF\nNhss_ImsUECM_DeregistrationNotification\nCx-Update_Subscr_Data\nHSS\nS-CSCF\nNhss_ImsSDM_Notification\nNOTE 1:\tCorresponds to Cx-Select-Pull for the requests of S-CSCF capabilities from I-CSCF to the HSS.\nNOTE 2:\tCorresponds to Cx-Put for Registration of S-CSCF in HSS during Registration/Re-registration and Unregistered cases.\nNOTE 3:\tCorresponds to Cx-Put for de-registration of S-CSCF in HSS.\nNOTE 4:\tCorresponds to Cx-Put message for updating the registration state of Public Identity in HSS.\nNOTE 5:\tCorresponds to Cx-Put message for storing S-CSCF Restoration data during IMS registration procedures.\nNOTE 6:\tCorresponds to Cx-Pull when S-CSCF needs to fetch and subscribe to notification of changes in IMS User's Service Profile Data.\nNOTE 7:\tCorresponds to Cx-Pull for retrieval of S-CSCF Restoration data from HSS.\nNOTE 8:\tCorresponds to Cx-Location-Query for the requests of S-CSCF capabilities from I-CSCF to the HSS.\nNOTE 9:\tCorresponds to Cx-Put for the assignment of a S-CSCF during execution of the authentication of the IMS User.\nAA.2.2.3\tMapping of Sh messages to HSS SBI services\nThe following table defines the mapping between stage 2 Sh messages and HSS SBI services and service operations:\nTable AA.2.2.3-1: Sh messages to HSS SBI services and service operations mapping\nSh message\nSource\nDestination\nHSS SBI service operation name\nSh-Pull\nAS\nHSS\nNhss_ImsSDM_Get\nSh-Update\nAS\nHSS\nNhss_ImsSDM_Update\nSh-Subs-Notif\nAS\nHSS\nNhss_ImsSDM_Subscribe\nNhss_ImsSDM_Unsubscribe\nNhss_ImsSDM_Get\nSh-Notif\nHSS\nAS\nNhss_ImsSDM_Notification\nAA.2.3\tVoid\nAA.2.4\tIMS AS Services\nAA.2.4.1\tGeneral\nThe following table shows the IMS AS Services and IMS AS Service Operations.\nTable AA.2.4.1-1: NF services provided by the IMS AS\nService Name\nService Operations\nOperation Semantics\nExample Consumer(s)\nNimsas_SessionEventControl\nSubscribe\nSubscribe/Notify\nDCSF\nNotify\nSubscribe/Notify\nDCSF\nNimsas_MediaControl\nMediaInstruction\nRequest/Response\nDCSF\nNOTE:\tIn this release the IMS AS services is introduced to support Data Channel services in IMS further described in Annex AC.\nAA.2.4.2\tNimsas_SessionEventControl\nAA.2.4.2.1\tGeneral\nService description: This service enables the consumer to be notified about session events when served IMS subscribers take part in IMS sessions.\nThe following operations are available for this service:\n-\tExplicit subscription to receive session events. This is not specified in this Release.\n-\tNotifying IMS session control events of a specific IMS subscriber to NFs, e.g. DCSF, based on local configuration in the IMS AS.\nIMS AS processing of the session event is paused until the consumer acknowledges reception of the session event notification. The consumer is given the possibility to apply session media control and policies by invoking the Nimsas_MediaControl service before giving IMS AS a session event notification acknowledgement.\nIf the consumer does not apply media control/policies to a session event, IMS AS continues processing and forwards the event as is (including the media state) to calling/called party.\nAA.2.4.2.2\tNimsas_SessionEventControl_Notify service operation\nService operation name: Nimsas_SessionEventControl_Notify\nDescription: This service operation enables IMS AS to notify consumers of session events related to a specific served IMS subscriber requesting use of IMS data channel media.\nInputs, Required: Session ID, Event ID,\nSession ID is the identity of the IMS session for which the event relates to.\nEvent ID is the event triggered within the IMS session.\nInputs, Optional: Calling ID, Called ID, Session case, Event initiator, Media info list.\nCalling ID is the public identity of the calling IMS subscriber. Called ID is the public identity of the called IMS Subscriber. Session case indicates if this is an originating or terminating IMS session. Event initiator indicates initiator of the event, i.e. 'served IMS subscriber' vs 'remote IMS subscriber'. Media info list includes for each media in the list:\n-\tmedia ID: uniquely identifies this media item within the list. The identity is allocated by IMS AS,\n-\tmedia specification: This depends on media type including relevant media attributes of interest to the consumer. The media specification includes the following media description attributes:\n-\tMedia Type: DC, Audio, or Video.\nWhen the media type is \"DC\", the elements below are derived from the SDP received by the IMS AS in an SIP INVITE or a re-INVITE related to an IMS Data Channel and the corresponding DTLS connection.\n-\tData Channel Mapping and Configuration Information: This attribute is applicable to Data Channel and includes relevant configuration Information, including the stream ID and application binding information of the Data Channel.\n-\tMaximum Message Size: This attribute defines the maximum size to be expected.\n-\tData Channel Port: This attribute identifies the port for the Data Channel.\n-\tSecurity Setup: This attribute identifies the security set up of the DTLS connection.\n-\tSecurity Certificate Fingerprint: This attribute identifies the security certificate fingerprint.\n-\tSecurity Transport Identity: This attribute identifies transport layer identity.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nThe table below presents supported EventIDs and related parameters.\nTable AA.2.4.2.2-1: List of events and Related Optional parameters\nEventID\nParameters\nSessionEstablishmentRequestEvent\nCalling ID, Called ID, Session case, Event initiator, Media info list\nSessionEstablishmentProgressEvent\nMedia info list\nSessionEstablishmentAlertingEvent\nMedia info list\nSessionEstablishmentSuccessEvent\nMedia info list\nSessionEstablishmentFailureEvent\nMediaChangeRequestEvent.\nEvent initiator, Media info list, Calling ID, Called ID, Session case\nMediaChangeSuccessEvent\nMedia info list\nMediaChangeFailureEvent\nMedia info list\nSessionTerminationEvent\nSession case\nAA.2.4.3\tNimsas_MediaControl Service\nAA.2.4.3.1\tGeneral\nService description: This service enables the consumer to control IMS AS handling of media flow within an IMS session. The service can be used by the consumer after receiving and before responding to a Nimsas_SessionEventControl_Notify request.\nAA.2.4.3.2\tNimsas_MediaControl_MediaInstruction service operation\nService operation name: Nimsas_MediaControl_MediaInstruction\nDescription: This operation provides instructions to the IMS AS for all media flows a consumer wants to control based on its policies for the received IMS session event, and that may require resource reservation in media resource e.g. MF.\nFor the case when a specific media flow needs to be terminated in MF media resource (i.e. termination of a Data Channel media descriptor offered by one of the IMS subscribers) or originated by the MF (i.e. origination of a data channel media descriptor to be offered towards one of the IMS subscribers), the consumer must provide a complete MF media specification including information required by MF to know how to terminate or originate the media flow.\nInputs, Required: Session ID, Media instruction set\nSession ID specifies the IMS session for which the MediaInstruction operation applies.\nMedia instruction set includes a set of instructions for each media flow to control. Each instruction includes:\n-\tmedia ID: used by the producer (IMS AS) and the consumer for referencing purposes. The consumer reuses the media ID it received from the IMS AS for referencing the same media. This field will be null for instructions related to originating new media.\n-\tMedia resource capability: Identify the Media Resource capabilities the Media instruction is intended for (e.g. DC, AR).\n-\tMedia instruction: includes instructions to the producer (IMS AS) for handling the media. The following instructions are supported:\n-\t\"TerminateMedia\": Terminate the offered media descriptor of the UE in the mediaResource, i.e. this media descriptor will not be exposed to the other UE.\n-\t\"OriginateMedia\": Originate and offer a media descriptor from the mediaResource to the UE. The media ID representing the new media flow will be provided by the IMS AS in the response.\n-\t\"TerminateAndOriginateMedia\": Terminate the offered media flow in the mediaResource from the UE and originate the same media flow from the mediaResource to the other UE, i.e. the offered media descriptor of the originating UE will be replaced by the mediaResource provided media descriptor, which is sent towards the other UE.\n-\t\"UpdateMedia\": Update a media flow of the mediaResource previously allocated by the instructions \"TerminateMedia\", \"OriginateMedia\" and \"TerminateAndOriginateMedia\"\n-\t\"DeleteMedia\": Delete a media flow of the mediaResource previously allocated by the instructions \"TerminateMedia\", \"OriginateMedia\" and \"TerminateAndOriginateMedia\".\n-\t\"RejectMedia\": Remove an offered media flow, i.e. the offered media descriptor will be removed both from the offer sent to the remote UE and from the answer returned to the initiator of the offer.\n-\tDC Media Specification: Description of additional media specification information needed for data channel media stream from application layer, which includes:\n-\tMedia proxy configuration (HTTP or UDP) applicable to the media flow.\n-\tMDC1/MDC2 media endpoint address of the application layer.\n-\tReplacement HTTP URL per stream ID allocated by the application layer representing the application list (e.g. graphical user interface) provided to the IMS subscriber via the MDC1 interface.\n-\tData Channel Mapping and Configuration information when originating/terminating data channel media flows on the Mb interface.\n-\tAR Media Specification: Description of additional media specification information needed for AR communication services from application layer, which includes:\n-\tMedia Processing Specification: It specifies the how the media stream should be processed.\nNOTE:\tDC Media Specification and AR Media Specification are optional depending on the scenario and media type.\nInputs, Conditional: None.\nInputs, Optional: None.\nOutputs, Required: operation result indication.\nOutputs, Optional: media resource information set:\nThis set includes entries corresponding to each instruction in the received media instruction set. Each entry in the set includes the media ID (same as received or new for new media) and includes the media type according to SDP. Each entry may optionally contain DC Media Specification and/or AR Media Specification. The DC Media Specification shall exist only with media type \"DC\" and contains additional media resource information, e.g. allocated media address for MDC2 interface when an offer must be provided to Data Channel Application Server. The AR Media Specification contains media processing instruction for MF on how to process the media.\nAA.2.5\tMF Services\nAA.2.5.1\tGeneral\nThe following table illustrates the MF Services and Service Operations.\nTable AA.2.5.1-1: NF services provided by the MF\nNF service\nService Operations\nOperation Semantics\nExample Consumer(s)\nNmf_MediaResourceManagement (MRM)\nCreate\nRequest/Response\nIMS AS\nUpdate\nRequest/Response\nIMS AS\nDelete\nRequest/Response\nIMS AS\nAA.2.5.2\tNmf_MediaResourceManagement (MRM) service\nAA.2.5.2.1\tGeneral\nService description: This service enables the consumer to create, update and delete media resources related to IMS Data Channel.\nThe media resource represents a media context including one or multiple media terminations. A media termination includes media resources for one or multiple media streams on the Mb interface.\nEach media resource context is identified by a Media Resource Context ID.\nEach media termination is identified by a Termination ID.\nEach media stream is identified by a Media ID and specified by a media descriptor.\nNOTE:\tTermination is a concept widely used in media protocols like H.248. When a media stream, e.g. application data channel, pass through the MF, there is one termination for the input stream and one termination for the output stream. In this case, the two terminations can use the same media ID.\nFigure AA.2.5.2.1-1illustrates the above. The Figure shows a media Context whose ID is AX, and two media terminations whose IDs are AB and XY. Media Termination AB anchors two media streams; 1 and 3. Media termination XY anchors media streams 2 and 3.\nFigure AA.2.5.2.1-1: Media Context Resource Example\nAA.2.5.2.2\tNmf_MRM_Create service operation\nService operation name: Nmf_MRM_Create\nDescription: The consumer NF requests the MF to create a media context including one or multiple media terminations and reserve media resources for anchoring one or multiple media streams of Mb interface in each termination. The consumer NF may also include media application function specification information requested by the application layer, e.g. DCSF, to be applied on the media stream by the MF.\nInputs, Required: List of Media Termination Descriptors.\nEach Media Termination Descriptor of the list includes:\n-\tTermination ID: A unique identity of the termination within the media context resource. The identity is allocated by the producer and must be set to value 'null' by the consumer when adding a termination to a context.\n-\tList of Media Stream Descriptors belonging to the Termination.\nEach Media Stream Descriptor of the list includes:\n-\tMedia ID: A unique identity of the media stream within the media context instance. The MediaID value is set by the consumer.\nNOTE 1:\tDifferent Termination IDs associated with the same Media ID represent the media stream flow for data forwarding.\n-\tRemote Mb Specification: Media Specification specifying SDP parameters of a remote media endpoint e.g. media stream IP address and ports allocated at the remote UE.\nNOTE 2:\tIn the case of reserving termination media resource before receiving media negotiation information from the UE, Remote Mb Specification should be set to Null.\n-\tMedia Function Specifications: Specification of the media function to be applied to the media stream as requested by the application layer, which includes:\n-\tMedia Function Type: The value is set based on the type of the media function required, e.g. \"DC media function type or AR media function type.\n-\tMedia Function Description: Application specific media function description specifying how the media function shall handle and process the media stream. Data content depends on type of media function.\nIf the Media Function Type is \"DC Media Function\", then the Media Function Description incudes:\n-\tMedia proxy configuration (HTTP or UDP) applicable to the media flow.\n-\tRemote MDC1/MDC2 media endpoint address.\n-\tReplacement HTTP URL per Stream ID allocated by the application layer representing the application list (e.g. graphical user interface) provided to the IMS subscriber via the MDC1 interface.\n-\tData Channel Mapping and Configuration information when originating/terminating data channel media flows on the Mb interface.\n-\tMaximum Message Size: This attribute defines the maximum size to be expected.\n-\tData Channel Port: This attribute identifies the port for the Data Channel.\n-\tSecurity Setup: This attribute identifies the security setp up of the DTLS connection.\n-\tSecurity Certificate Fingerprint: This attribute identifies the security certificate fingerprint.\n-\tSecurity Transport Identity: This attribute identifies transport layer identity\nNOTE 3:\tSome of the above attributes are optional depending on the scenario and proxy configuration.\nIf the Media Function Type is \"AR Media Function\", then the Media Function Description includes:\n-\tAR Media Specification: Description of additional media specification information needed for AR communication services from application layer, which includes:\n-\tMedia Processing Specification: It specifies the how the media stream should be processed.\nNOTE 4:\tThe detail of Media Processing Specification is defined by SA4 and needs to be further aligned.\nInputs, Optional: None.\nOutputs, Required: Result indication for the entire list, Media Resource Context ID, List of allocated Media Termination Descriptor Resource information. For each Media Termination Descriptor; the Termination ID, and the list of media stream descriptors corresponding to the input list of media stream descriptor:\nMedia Resource Context ID uniquely identifies the media resources created by the MF. This identity shall be used as reference when updating or deleting the created media resource.\nList of allocated Media Termination Descriptor Resource information includes one or multiple Media Termination Descriptor Resources allocated. The list will include same number of terminations, in the same order as provided in the request. Each Media Termination Descriptor Resource includes:\n-\tTermination ID: Unique identity allocated by the consumer. The identity shall be used when updating/deleting the Media Termination.\n-\tList of Media Stream Descriptor Resource information elements allocated within the media termination. The list will include same number of media streams, in the same order as provided in the request.\nMedia Stream Descriptor Resource information includes:\n-\tMedia ID: Unique identity of the media stream within the media context instance allocated by the consumer. This is identical to the Media ID used in the input.\n-\tLocal Mb Specification: Media specification specifying SDP parameters representing the media endpoint of the provider e.g. media stream IP address and port.\n-\tMedia Application Function Output Description: Optional media application function description including information required by the application layer. The Media Application Function Output Description shall be relayed to the DCSF by the consumer NF. Data content depends on type of media function. If the Media type is \"DC media function\", the Media Application Function Output Description includes:\n-\tMDC1/MDC2 media point information (IP address/port number, etc.) which shall be relayed to the DCSF by the consumer NF.\nOutputs, Optional: None.\nAA.2.5.2.3\tNmf_MRM_Update service operation\nService operation name: Nmf_MRM_Update\nDescription: The consumer NF requests the MF to update one or multiple media resources within a specific media resource context. Terminations and/or Media Streams can be added, modified, or deleted within an Update request.\nInputs, Required: Media Resource Context ID, List of Media Termination Descriptors to be updated.\nMedia Resource Context ID specifies the media context resource to be updated.\nList of Media Termination Descriptors includes one or multiple media terminations impacted by the update request. Each Media Termination Descriptor includes:\n-\tTermination ID: A unique identity of the termination within the media context resource. The identity is allocated by the consumer and must be set to value 'null' when adding a termination to a context.\n-\tList of Media Stream Descriptors belonging to the Termination. The complete set of Media Stream Descriptors of a Media Termination must be specified in case a Media Termination is either added or modified. The consumer NF can remove media streams from a Media Termination by omitting the media stream from the list. The list will be set to 'null' when deleting a Media Termination. The detail of this list is identical to the input information in the Nmf_MRM_Create service.\nInputs, Optional: None.\nOutputs, Required: Result indication, List of Media Termination Descriptor Resource information.\nList of Media Termination Descriptor Resource information includes one or multiple Media Stream Termination Descriptor Resources allocated. The list will include same number of terminations, in the same order as provided in the request. Each Media Termination Descriptor Resource information includes:\n-\tTermination ID: A unique identity of the termination within the media context resource. The identity is allocated by the consumer.\n-\tList of Media Stream Descriptor Resource information elements allocated/updated within the media termination. The list will include same number of media streams, in the same order as provided in the request. The list will be set to 'null' when deleting a Media Termination. The detail of this list is identical to the output information in the Nmf_MRM_Create service.\nOutputs, Optional: None.\nAA.2.5.2.4\tNmf_MRM_Delete service operation\nService operation name: Nmf_MRM_Delete\nDescription: The consumer NF requests the MF to delete a specific media context resource including all existing terminations and media streams.\nInputs, Required: Media Context Resource ID.\nMedia Context Resource ID specifies the media context resource to be deleted.\nInputs, Optional: None.\nOutputs, Required: Result indication.\nOutputs, Optional: None.\nAA.3\tSBI Capable HSS Discovery and Selection\nAA.3.1\tGeneral\nAn SBI capable IMS entity (e.g. I-CSCF, S-CSCF, IMS AS or DCSF) performs HSS discovery to discover an HSS that manages the user subscriptions.\nThe SBI capable IMS entity shall utilize the NRF to discover the SBI capable HSS instance(s) unless the information about SBI capable HSS instances is available by other means, e.g. locally configured on the SBI capable IMS entity. The HSS selection function in SBI capable IMS entities selects an SBI capable HSS instance based on the available SBI capable HSS instances (obtained from the NRF or locally configured).\nAn SBI capable IMS entity always selects an HSS within its own PLMN. The HSS selection should consider one of the following factors when available to the SBI capable IMS entity:\n1.\tHSS Group ID of the IMS identity (IMPI or IMPU, or PSI).\n2.\tIMS private identity (IMPI); e.g. the SBI capable IMS entity selects an SBI capable HSS instance based on the IMPI set the UE's IMPI belongs to, configured locally or based on the results of a discovery procedure with NRF using the UE's IMPI as input for HSS discovery.\n3.\tIMS public identity (IMPU); e.g. the SBI capable IMS entity selects an SBI capable HSS instance based on the IMPU set the UE's IMPU belongs to, configured locally or based on the results of a discovery procedure with NRF using the UE's IMPU as input for HSS discovery.\n4.\tPublic Service Identity (PSI); e.g. the SBI capable IMS entity selects an SBI capable HSS instance based on the PSI set the received PSI belongs to, configured locally or based on the results of a discovery procedure with NRF using the received PSI as input for HSS discovery.\n5.\tMSISDN; e.g. the SBI capable IMS entity selects an SBI capable HSS instance based on the MSISDN set the UE's MSISDN belongs to, configured locally or based on the results of a discovery procedure with NRF using the MSISDN as input for HSS discovery.\nUnless the information about the interface type to be used towards HSS is locally configured on the SBI capable IMS entity, an SBI capable IMS entity can also use the NRF to decide the type of interface (SBI vs diameter) to be used towards HSS.\nThe following clause describes the procedure for HSS registration in NRF, SBI capable HSS discovery and interface type selection via NRF.\nAA.3.2\tHSS Registration in NRF\nAn SBI capable HSS registers in the NRF using the Nnrf_NFManagement_NFRegister Request message as defined in TS 23.502 [94]. The NF profile of the HSS registered in NRF includes necessary information for an SBI capable IMS entity to send SBI service requests to the selected SBI capable HSS service instance.\nDifferent SBI capable HSS instances managing different sets of IMPIs/IMPUs may be deployed in a given PLMN. In this case, the SBI capable HSS instances register in NRF using either different ranges of IMPIs/IMPUs and/or HSS Group IDs.\nNOTE:\tIn deployments where simple IMPU and IMPI ranges are not suitable to describe the IMPU/IMPI sets served by HSS instances, it is expected the HSS instances only register HSS Group IDs.\nAA.3.3\tHSS Discovery and Selection via NRF\nAA.3.3.1\tGeneral\nDuring the IMS procedure, an SBI capable IMS entity sends a Nnrf_NFDiscovery_Request to NRF as defined in TS 23.502 [94] to discover SBI capable HSS instances within a given PLMN. The SBI capable IMS entity may store all returned SBI capable HSS instances and their NF profiles for subsequent use, including, if applicable, supported IMPIs/IMPUs ranges, and/or HSS Group IDs. If no SBI capable HSS instance is available in the PLMN, then the NRF replies to the SBI capable IMS entity with no information. In this case, the SBI capable IMS may then attempt to communicate with the HSS using non-SBA protocols.\nNOTE:\tThe SBI enabled IMS entity can also perform HSS discovery prior to receiving an IMS request without any public identity information.\nWhen an SBI capable IMS entity receives an NRF response that HSS supports SBI and stores the information received from the HSS, it shall make use of Nnrf_NFStatusSubscribe/Unsubscribe service operations with NRF as defined in TS 23.502 [94] to receive Nnrf_NFStatusNotify service operation for updates to the NF profiles of SBI capable HSS instances registered in NRF.\nAA.3.3.2\tHSS Discovery\nThe call flow in Figure AA.3.3.2-1 illustrates the steps to locate the HSS instance for an IMS public identity.\nFigure AA.3.3.2-1: HSS discovery and selection\nSteps 1 - 2 may be performed, any time after power up, e.g. in the scenario where only a single HSS instance or HSS group is deployed, and in the scenario where an operator has IMPI/IMPU ranges that are registered in NRF as described in clause AA.3.2. In this case there is no need for any IMPU to perform the 2 steps.\n1.\tAn SBI capable IMS entity may discover the SBI capable HSS instances available in the PLMN via Nnrf_NFDiscovery_Request.\n2.\tThe NRF provides the SBI capable IMS entity with the HSS instances and/or any HSS Group IDs registered in the PLMN. If no SBI capable HSS instance and/or any HSS Group ID is available in the PLMN, then the NRF will reply to the SBI capable IMS entity with no information about available SBI capable HSS instances.\n3.\tThe SBI capable IMS entity receives an IMS procedure related to a given IMS user (IMPI or IMPU depending on the procedure).\nSteps 4 - 6 may be performed, e.g. if the SBI capable IMS entity did not retrieve and store information about HSS instances and/or HSS Group IDs registered in the PLMN at an earlier stage (performed steps 1-2).\n4.\tAn SBI capable IMS entity may discover the SBI capable HSS instances available in the PLMN via Nnrf_NFDiscovery_Request.\n5.\tThe NRF provides the SBI capable IMS entity with the HSS instances and/or any HSS Group IDs registered in the PLMN. If no SBI capable HSS instance and/or any HSS Group ID is available in the PLMN, then the NRF will reply to the SBI capable IMS entity with no information about available SBI capable HSS instances.\n6.\tThe SBI capable IMS entity stores the result of the NRF discovery, if any is received. The IMS capable entity may store the received response for future use, otherwise the IMS entity must perform the query in response to each IMS request it receives.\nIf the SBI capable IMS entity received no results at all, the procedure is exited, and the SBI capable IMS entity may use Diameter interfaces to interact with an HSS.\nNOTE 1:\tThe SBI capable IMS entity can request the NRF to be notified of updates in the SBI capable HSS instances/ HSS Group IDs registered in NRF by using a Nnrf_NFManagement_NFStatusSubscribe service operation.\nSteps 7 - 10 are performed only if the SBI capable IMS entity cannot locate an HSS instance corresponding to the IMS public identity based on stored information.\n7.\tThe SBI capable IMS entity sends to NRF an Nnrf_NFDiscovery_Request with the IMS public identity received in step 3.\n8.\tNRF may query the UDR, via the Nudr_GroupIDmap service, for the HSS Group ID corresponding to the IMS public identity.\n9.\tIf requested the UDR returns the HSS-IMS Group ID to NRF.\n10.\tNRF locates HSS instance(s) corresponding to the HSS Group ID. NRF returns and provides and them to the SBI capable IMS entity the HSS instance(s) profile which includes the HSS Group ID.\nNOTE:\tIn indirect communication with delegated discovery as specified in TS 23.501 [93], the SBI capable IMS entity does not interact directly with the NRF. In this case, the SBI capable IMS entity is not informed about the HSS Group ID the IMS identity belongs to.\n11.\tThe SBI capable IMS entity selects the HSS instance.\n12.\tThe SBI capable IMS entity can then start interaction with the selected HSS instance.\nAA.3.3.3\tHandling of HSS Group ID in IMS Procedures\nThe HSS group ID may be transported in SIP signalling related to the following procedures:\n-\tInitial IMS Registration procedure.\n-\tIMS Terminating session establishment procedure.\n-\tIMS Originating session establishment procedure.\nAn SBI enabled I-CSCF receiving an HSS Group ID during the NRF-based HSS discovery procedure should include the HSS Group ID for transportation to the next hop in subsequent SIP signalling related to the above procedures.\nIn addition, every IMS node receiving an HSS Group ID in SIP signalling (e.g. S-CSCF and IMS AS) should store it as part of the UE information, and should use the received HSS Group ID to select an SBI capable HSS. Additionally, an IMS node receiving an HSS Group ID in SIP signalling should include it in subsequent SIP signalling related to the above procedures.\nThe HSS Group ID in SIP signalling is specific to the UE served by this IMS and shall not be sent to any other party involved in the session/communication (e.g. to the terminating side and/or outside the HPLMN).\nAA.4\tNRF based Discovery and Selection for other IMS nodes\nAA.4.1\tService Based MRF Discovery and Selection\nAA.4.1.1\tGeneral\nWhile no SBI procedures are defined for MRF (and hence MRFC and MRFP), it is possible to utilize NRF to discover and select the MRF. In networks where MRFC and MRFP are co-located it is only necessary to indicate that the service function is MRF, in networks where separated MRFC and MRFP are deployed the network function discovering the MRF (or MRFC) may not know the network topology, and thus the service function descriptor is always set to MRF (even when registering/discovering an MRFC).\nThe MRFP service descriptor is only used by the MRFC when separate MRFC and MRFP are deployed, and the MRFC is configured to use the NRF to discover a suitable of MRFP.\nNOTE:\tIn many implementations where the MRFC and MRFP are separate entities the MRFP resource is directly linked to the MRFC and thus SBI discovery mechanisms are not necessary.\nWhen an SBI capable IMS entity selects a MRF it shall use the IMS media service list to ensure that the selected MRF supports the required media capabilities for the application. The SBI capable IMS entity may utilize other available information to assist in selecting the MRF based on implementation criteria (e.g. proximity of the UE to MRF to minimize transmission delays).\nA SBI capable IMS entity always selects an MRF (or MRFC within its own PLMN.\nAA.4.1.2\tMRF Registration\nIf an MRF has been configured to support NRF based discovery or selection it shall register with the NRF using the Nnrf_NFManagement_NFRegister Request message as defined in TS 23.502 [94].\nThe NF profile for the MRF includes all common information for SBI capable IMS entities plus a text-based list of IMS media services offered by the MRF (e.g. \"video transcoding\", \"data channel services\", \"voice conferencing\", \"in-call announcements\").\nNOTE:\tThe list of media services is implementation specific, with each potential service in the list defined and configured by the IMS service provider (and thus not specified by 3GPP). Individual entries in the list need to be configured to exactly correspond to the discovery requests made by the AS or other SBA entities.\nThe MRF registration may include other optional information pertaining to the implementation (e.g.NF location to support routing media to the nearest MRF).\nIn the case when the MRFC and MRFP are separate entities, the MRFC identifies itself using the MRF service descriptor during SBA interactions.\nIn cases where the MRFP is a separate entity to the MRFC, it may be necessary for the MRFP to perform registration with the NRF (unless local configuration is used). In such cases the MRFP registers with the NRF using a NF profile that also includes a similar list of media services and uses the NF identifier \"MRFP\".\nAA.4.1.3\tMRF Discovery and Selection\nDuring the IMS procedure, an SBI capable IMS entity sends a Nnrf_NFDiscovery_Request to NRF as defined in TS 23.502 [94] to discover applicable MRF instances within a given PLMN. The SBI capable entity may include a list of the service or services it is requesting to use, in which case the NRF will respond with the MRF (s) that support all the services listed.\nWhen separate MRFC and MRFP (or a mix of MRF, MRFC, MRFP) are deployed in a network - the entity performing discovery of the MRFC may not know the network topology, and thus the discovery request sent by the SBI entity uses the MRF service descriptor, even if the resulting node is an MRFC.\nIf necessary when there is no direct linkage between an MRFC and MRFP, then discovery and selection of the MRFP may be needed after the MRFC discovery; in such a case the MRFC may perform SBI discovery of the MRFP using the NRF, in such a case the requested service descriptor is MRFP. Only an MRFC may discover the MRFP in this manner.\nAnnex AB (informative):Support of IMS in SNPN\nAB.1\tIMS in SNPN\nAB.1.0\tGeneral\nAnnex AB describes deployment options for SNPNs to enable access to IMS services for SNPN subscribers. Two potential deployment options are described below.\nFor the purpose of this Annex, an IMS Subscription Holder (ISH) identifies the administrative domain holding the IMS subscription for a UE subscribed to receive IMS services.\nThe ISH can be the same or independent from the SNPN domain which deploys the 5GS. In the case the ISH is different from the administrative domain of the SNPN, the UE needs to have two separate subscriptions, one for accessing the 5GS of the SNPN (provided by the SNPN or Credentials Holder (CH) as defined in TS 23.501 [93]) and one for accessing IMS services provided by the ISH. The UE needs to be successfully authenticated in each domain, using the appropriate subscription, before able to receive IMS services.\nAB.1.1\tSNPN deployed IMS\nIn this option, the SNPN deploys its own IMS used by subscribers with a SNPN 5GS subscription. The SNPN and the ISH belong to the same administrative domain. In this deployment scenario, either USIM/ISIM or IMC is used to authenticate and authorize a UE for accessing IMS services.\nAB.1.2\tIMS services provided by independent IMS provider\nAB.1.2.1\tGeneral\nThis option is applicable to SNPNs not providing own IMS services. It enables the SNPN to use IMS services from an independent IMS provider, e.g. PLMN or another entity, which is the ISH, providing IMS services for SNPN subscribers.\nIt is assumed that the SNPN has an agreement with the ISH. This agreement describes e.g. P-CSCF address provisioning and security aspects for all standardized reference points that are implemented between both administrative domains.\nIn this deployment option either IMC or USIM/ISIM credentials are used to authenticate and authorize a UE for IMS services.\nNOTE 1:\tThe provisioning of IMC is out of scope of 3GPP.\nThe UE holds an association between an SNPN subscription and the corresponding IMS subscription to ensure proper credentials are used to access SNPN and IMS services in this deployment option. The mechanism how this association is stored in the UE is out of scope of 3GPP.\nA potential architecture for this deployment option is depicted in Figure AB.1.2-1.\nNOTE 2:\tPotential usage of reference points as shown in Figure AB.1.2-1, e.g. NU1, is up to deployment.\nNOTE 3:\tIt is assumed that there is no NAT device located between the UPF and the P‑CSCF. This can be enabled e.g. by deploying the N6 reference point in a private IP network where both the UPF on the SNPN side and the P-CSCF and IMS-AGW on the ISH side share the same address space. Subject to the agreement between SNPN and ISH, in some deployments the P-CSCF and IMS-AGW of the ISH can also be deployed on the SNPN premises.\nNOTE 4:\tSEPPs are not shown in the figure.\nFigure AB.1.2.1-1: Potential deployment architecture for IMS services in SNPN provided by independent IMS provider\nAB.1.2.2\tSupport for Emergency Services\nSupport for Emergency Services requires that the SNPN, based on an agreement with the ISH, broadcasts IMS Emergency Services support as described in TS 23.501 [93].\nAB.1.2.3\tSNPN Support for Multiple Independent IMS Providers\nIn order for an SNPN to enable IMS services to be provided via multiple independent ISH, it is required that for every SNPN subscriber, the IMS DNN stored in UDM of the SNPN contains the information, which is used to identify the corresponding ISH, e.g. ISH domain name is encoded as part of IMS DNN. At PDU session setup, the SMF selects the P-CSCF of the ISH based on clause 5.16.3.11 and clause 5.16.3.4 of TS 23.501 [93].\nThe CH and SNPN need to agree that the AMF in SNPN that receives the subscription information that includes the IMS DNN and contains information to identify the corresponding ISH, is able to determine the ISH and therefore derive correctly the IMS voice over PS Session Supported Indication as defined in clause 5.16.3.2 of TS 23.501 [93].\nAnnex AC (normative):Support of Data Channel services in IMS\nAC.1\tGeneral\nThis annex describes IMS architecture enhancements to support data channel services.\nData channels are always established in the context of an IMS MMTel session.\nService based interfaces applicable to data channel services are specified in clauses AA.2.4 and AA.2.5.\nThe architecture in this annex supports separation of signalling function and media function supporting data channel services. A network function for data channel management signalling, Data Channel Signalling Function (DCSF), is specified. The network function to handle data channel media can be provided by introducing a new network function called Media Function (MF), which interacts with the IMS AS via the service-based interface DC2. MF provides media capabilities in support of IMS DC and Augmented Reality.\nNOTE:\tIn this Release of the specification the IMS AS supporting data channel services is collocated with the TAS.\nIn this Release of the specification IMS Data Channel is supported in the case of non-roaming and home routed roaming scenarios.\nMultiplexing of multiple IMS Data Channel streams with different endpoints onto a single SCTP association is not supported in this Release of the specification.\nAC.2\tArchitecture and functions\nAC.2.1\tArchitecture\nFigure AC.2.1-1 shows the data channel architecture when using the service-based DC media function.\nFigure AC.2.1-1: Architecture option of IMS supporting DC usage with MF\nNOTE 1:\tMDC2 may connect different IMS security domains.\nNOTE 2:\tDC5 reference point is not specified in 3GPP.\nNOTE 3:\tMDC1, MDC2 and MDC3 reference points are not specified in 3GPP.\nNOTE 4:\tDC3 and DC4 reference points are not specified in this Release.\nNOTE 5:\tEnhancements to the N33 reference point for support of data channel services are not specified in this Release.\nAC.2.2\tFunctional entities\nAC.2.2.1\tData Channel Signalling Function (DCSF)\nThe DCSF is the signalling control function that provides data channel control logic. The DCSF is not involved in SIP signalling. The DCSF supports the following functionalities:\n-\tThe DCSF receives event reports from the IMS AS and decides whether data channel service is allowed to be provided during the IMS session.\n-\tThe DCSF manages bootstrap data channel and (if applicable) application data channel resources at the MF via the IMS AS.\n-\tThe DCSF supports HTTP web server functionality to download data channel applications (bootstrapping) via MF to the UE based on UE subscription.\n-\tThe DCSF downloads data channel applications from the Data Channel Application Repository.\nNOTE 1:\tThe detailed procedures to download data channel applications to the UE are out of scope of this specification.\n-\tThe DCSF interacts with NEF for data channel capability exposure via DC3.\nNOTE 2:\tInteraction with NEF is not specified in this release of the specification.\n-\tThe DCSF interacts with the DC Application Server for DC resource control via DC4/DC3/N33 and for traffic forwarding via MDC3.\nNOTE 3:\tInteraction with the DC Application Server for resource control is not specified in this release of the specification.\n-\tThe DCSF interacts with HSS for retrieving and storing DCSF service specific data via N72/Sc.\nAC.2.2.2\tData Channel Application Repository (DCAR)\nThe Data Channel Application Repository stores the verified data channel applications which are retrieved by the DCSF when required.\nAC.2.2.3\tData Channel Media Function (MF)\nThe MF provides the media resource management and forwarding of data channel media traffic. The MF provides the following functionalities:\n-\tThe MF manages the data channel media resources (bootstrap and application data channel resources, if applicable) under the control of the IMS AS.\n-\tThe MF terminates the bootstrap data channel from the UE and forward HTTP traffic between the UE and DCSF via MDC1.\n-\tThe MF may anchor the application data channel in P2P scenarios, if required, and forward application data traffic from/to the UEs.\n-\tThe MF relay traffic on the A2P/P2A application data channels between the UE and the DC Application Server via MDC2.\nAC.2.2.4\tIMS AS\nThe IMS AS is enhanced to support the following functionalities:\n-\tThe IMS AS interacts with the DCSF via DC1 for event notifications.\n-\tThe IMS AS receives the data channel control instructions from the DCSF and accordingly interacts with the MF via DC2 for data channel media resource management.\n-\tThe IMS AS interacts with HSS for retrieving and storing DC enhanced IMS AS service specific data via N71/Sh.\nAC.2.2.5\tS-CSCF\nIn addition to the functions defined in clause 4.6.3, the S-CSCF is enhanced to support the following functionalities:\n-\tThe S-CSCF includes a Feature-Caps header field indicating its data channel capability in the 200 OK response to the initial and any subsequent REGISTER request from UE.\nAC.2.2.6\tHSS\nIn order to support data channel service, the HSS is additionally enhanced with the following functionalities:\n-\tThe HSS stores IMS Data Channel subscription data as transparent data.\n-\tThe HSS interacts with DCSF during service data retrieval by DCSF via N72/Sc.\n-\tThe HSS interacts with IMS AS during service data retrieval by IMS AS via N71/Sh.\nAC.2.3\tReference points\nThe following reference points are defined to support data channel service in IMS:\n-\tDC1:\tReference point between the DCSF and the IMS AS.\n-\tDC2:\tReference point between the IMS AS and MF.\n-\tDC3:\tReference point between the DCSF and NEF.\n-\tDC4:\tReference point between the DCSF and DC Application Server.\n-\tDC5:\tReference point between the DCSF and DCAR.\n-\tN72/Sc:\tReference point between the DCSF and HSS.\nThe following reference points are updated to support data channel signalling control in IMS:\n-\tN70/Cx/Dx:\tReference point between the CSCF and HSS.\n-\tN71/Sh:\tReference point between the IMS AS and HSS.\nThe following reference points are defined for data channel media handling:\n-\tMDC1:\tReference point for transport of data channel media between data channel media function MF and DCSF.\n-\tMDC2:\tReference point for transport of data channel media between data channel media function MF and DC Application Server.\n-\tMDC3:\tReference point for transport of data channel media between DCSF and DC Application Server.\nAC.3\tIMS Data Channel Service Subscription\nService subscription for IMS Data Channel shall be an extension to the MMTEL related service profile in HSS. The Data Channel subscription data shall be used by the IMS AS and S-CSCF during IMS registration, session initiation or update to authorize subscribers to use the DC service.\nIMS AS Service specific data is enhanced with DC specific service data, optionally stored in HSS (e.g. as repository data) and retrieved by IMS AS using N71/Sh interface.\nDCSF service specific data used by DCSF for data channel management, may be stored (e.g. as repository data) and retrieved from HSS using the N72/Sc interface. DCSF service specific data are out of scope of 3GPP.\nAC.4\tIMS DC Channel Setup\nThe following principles apply when an IMS Data Channel is established: -\n-\tUE can establish an IMS Data Channel simultaneously while establishing an IMS audio/video session or upgrade an ongoing IMS audio/video session through a re-INVITE to an IMS Data Channel session.\nNOTE:\tAn IMS Data Channel established simultaneously with an IMS audio/video session can have impact to the IMS session setup time.\n-\tThe UE may be configured by the HPLMN either via Device Management or in the UICC whether and when to initiate a DC establishment request. If the UE is not configured by the HPLMN, it is left for UE implementation whether and when to initiate the DC establishment request. The UE shall not initiate a DC establishment request if the network has not indicated support for IMS DC service during IMS registration or if the UE is configured to not establish an IMS Data Channel.\n-\tIf a UE that has not subscribed to IMS Data Channel establishes an IMS Data Channel simultaneously with an IMS audio/video IMS session, the IMS AS shall discard the Data Channel request and proceed with the audio/video IMS session establishment.\n-\tThe DCSF provides stream ID and a corresponding URL to the MF via the IMS AS during data channel media resource reservation for the bootstrap data channel that enables downloading a subscriber specific graphical user interface to the UE via the bootstrap data channel. The stream ID is optional. Once the MF, acting as HTTP proxy, receive a HTTP GET Request containing the root (\"/\") URL through the bootstrap data channel, the MF replaces the root (\"/\") URL in the HTTP GET Request with the subscriber specific URL corresponding to the stream ID (if available) of the bootstrap data channel and forward the request to the DCSF for downloading the subscriber specific graphical user interface to the UE. The MF retrieves the stream ID of the bootstrap data channel from the transport layer of the data channel connection. The UE shall maintain the HTTP session state when interacting with the MF.\nAC.5\tBinding of DC Application with the related DC\nInformation for the binding of DC Application with the related DC is required to support multiple, simultaneous DC applications in a UE.\nThe binding information is maintained by the HPLMN or retrieved from DC application provider when a DC Application is uploaded to DCSF. DCSF may be configured with a DC application profile associated with the binding information, which indicates the DC control policy (e.g. whether the Application DC establishment follows the P2P, P2A/A2P or P2A2P procedure). The UE receives the binding information of a DC application via the Bootstrap DC, e.g. when the DC application is downloaded to the UE.\nWhen the UE is establishing an IMS Application DC as defined in clause AC.7.2, the binding information is provided by the UE in the attribute of the SDP offer as specified in clause 6.2.13 of TS 26.114 [76]. The IMS AS provides the binding information to the DCSF. The DCSF may use the binding information for controlling the Application DC setup.\nAC.6\tData Channel Media Setup\nMF provides media anchoring when needed for the IMS Bootstrap Data Channel, and the IMS Application Data Channel. To that effect, they support the following capabilities:\n-\tHTTP Proxy: In this configuration, MF supports terminating DTLS with HTTP traffic being transparent to MF. When acting as HTTP Proxy, MF reserves media resources on both the UE side and on the MDC1/MDC2 side allowing to send HTTP traffic to the DC Application Server. This mode is deployed both for Bootstrap Data Channel, and HTTP Application Data Channels. Figure AC.6-1 illustrates the protocol stack for the HTTP proxy configuration mode for the Bootstrap Data Channel case.\nWhen used with HTTP Application Data Channel, the downloaded Data Channel application will in this case communicate with the DC Application Server, using basic HTTP, within the same bootstrap SCTP association as in which this application was downloaded. UDP, TCP and SCTP should be supported as the transport layer protocols for MDC2.\nFigure AC.6-1: MF \"HTTP Proxy\" Media Configurations\n-\tUDP Proxy: In this configuration, MF transparently proxies HTTP traffic to its target. When acting as UDP Proxy, the media resources reserved by MF contain MF connection information (e.g. IP addresses and port numbers). This mode is deployed only for Application Data Channels. Figure AC.6-2 illustrates the protocol stack for the UDP proxy configuration mode for the Application Data Channel case, providing a Person2Application/Application2Person/Person2Person Data Channel Application.\nFigure AC.6-2: MF \"UDP Proxy\" Media Configurations\nAC.7\tData Channel Procedures\nAC.7.0\tIMS DC capability negotiation\nThe IMS network and the UE need to mutually negotiate the capability of supporting IMS data channel when a UE supporting IMS data channel registers to IMS network.\nIMS data channel capability negotiation includes two aspects:\n-\tThe network discovers the data channel capability of the UE.\n-\tThe UE discovers the data channel capability of the network.\nWhen the UE supporting IMS data channel registers on the IMS network and the UE is allowed to use IMS data channel as specified in clause AC.4, it includes the media feature tag as specified in TS 26.114 [76] in the Contact header field of the initial REGISTER request and any subsequent REGISTER request to allow the home IMS network to discover its IMS data channel capability.\nIf the IMS network supports IMS data channel, the S-CSCF includes a Feature-Caps header field indicating its data channel capability in the 200 OK response to the initial and any subsequent REGISTER request as specified in clause 9.2 of TS 24.186 [105], which is used by the UE to discover the IMS data channel capability of its home IMS network.\nThe UE may receive a Feature-Caps header field indicating its data channel capability in the 200 OK response to a subsequent REGISTER request when the network starts supporting IMS data channel after successful initial registration of the UE.\nWhen the UE supporting IMS data channel initiates an IMS session, and if the UE is allowed to use IMS data channel as specified in clause AC.4, it includes the media feature tag as specified in TS 26.114 [76] in the Contact header field of the initial INVITE or any re-INVITE request message, regardless of data channel media being part of the SDP or not.\nThe UE shall not include the media feature tag as specified in TS 26.114 [76] in the Contact header field and data channel media description in the SDP offer of the initial INVITE request or any subsequent re-INVITE request message, if the S-CSCF has not included the data channel capability indication in the Feature-Caps header field in the 200 OK response either to the initial REGISTER or a subsequent REGISTER request message.\nIf the UE is not configured whether to use IMS data channel, it is up to UE implementation whether or not to include the media feature tag in the Contact header field.\nAC.7.1\tBootstrap Data Channel Setup Signalling procedure\nFigure AC.7.1-1depicts a signalling flow diagram for establishing a bootstrap data channel in a person-to-person use case. The MF anchors the bootstrap data channel, and the originating network is offering a bootstrap data channel to the remote peer as well for application download.\nNOTE 1:\tSome SIP signalling not relevant for the procedure, is not shown in the call flow below.\nFigure AC.7.1-1: Bootstrap Data Channel set up Signalling Procedure\nThe steps in the call flow are as follows:\n1.\tUE#1 sends the SIP INVITE request with an initial SDP to the IMS AS, through P-CSCF and S-CSCF in the originating network. The initial SDP contains offers for the bootstrap data channel establishment request with bootstrap DC stream ID. In this example procedure, the SDP contains both bootstrap data channel offers for originating side and terminating side.\nNOTE 2:\tThis SIP INVITE can also be a SIP re-INVITE performed after the initial IMS audio session is setup. The SIP re-INVITE can be initiated either from UE#1 or UE#2.\n2.\tIMS AS validates user subscription data to determine whether the data channel call request should be notified to DCSF.\nIf the IMS AS determined, based on the user profile, that data channel call request needs to be notified to DCSF, the IMS AS selects a DCSF for this user based on local configuration or discovery and selection of a DCSF instance via NRF.\nIf the IMS AS determined, based on the user profile, that the data channel call request need not to be notified to DCSF, or DCSF decides that DC request is not allowed, the IMS AS proceeds with normal IMS procedures to setup the MMTel session without performing Data Channel bootstrapping, by deleting DC related media information and sending the updated SIP INVITE to the originating S-CSCF.\n3.\tIMS AS notifies the DCSF of the DC call event by sending Nimsas_SessionEventControl_Notify (SessionEstablishmentRequestEvent, Session ID, Calling ID, Called ID, Session Case, Event initiator, Media InfoList, DC Stream ID) request to the DCSF.\n4.\tAfter receiving the DC control request, the DCSF determines the policy about how to process the bootstrap data channel establishment request based on the related parameters in the Data Channel control request (e.g. CallingID, CalledID, DC Stream ID) and/or DCSF service specific policy.\n5.\tSince the SessionEstablishmentRequestEvent indicates that served user is offered local bootstrap media, DCSF, based on its policies reserves originating side MDC1 media information, as well as the terminating side MDC1 remote bootstrap media (targeting remote UE), which are used to receive UE request for application downloading from MF.\n6.\tDCSF invokes the Nimsas_MediaControl_MediaInstruction (Session ID, Media Instruction Set) operation based on its policies instructing the IMS AS how to set up bootstrap data channel with MF both for originating and terminating side. The MediaInstructionSet provided by the DSCF, includes its MDC1 media endpoint addresses created in step 5, DC Stream ID, and the replacement HTTP URL representing the application list offered via the MDC1 interface.\nIn this scenario, the DCSF instructs the IMS AS to terminate bootstrap data channel establishment request on originating MF, and initiate remote bootstrap data channel establishment request(targeting remote UE) as well as forwarding remote bootstrap data channel establishment request of served user (targeting remote DCSF) towards terminating network.\n7.\tThe IMS AS selects a MF based on local configuration or discovers and selects a MF instance supporting DC media function via NRF.\n8.\tIMS AS invokes Nmf_MRM_Create(List of Media Termination Descriptors) service operation to instruct MF to allocate required data channel media resources. IMS AS request creation of two different Media Terminations, one representing the local bootstrap media to be terminated and the other representing the remote bootstrap media to be offered to remote UE. Each Media Termination includes information required to allocate resources in both Mb and the MDC1 interfaces. The MF responds with the negotiated data channel media resource information to IMS AS.\nNOTE 3:\tThe MF media resource allocation in step 8 could be done with one or multiple service invocations.\n9.\tIMS AS responds to the MediaInstruction request received in step 6. The response may include the atomic success result of operation and also includes negotiated data channel media resource information for MDC1.\n10.\tThe DCSF stores the media resource information and responds to the Notify Request received in step 3.\n11-13.\tIMS AS sends the INVITE which includes the updated SDP offer adding media information of MF via the originating S-CSCF to remote network side and UE#2. In this scenario, the SDP offer for bootstrap data channel to UE#2 is included.\n14.\tUE#2 and terminating network returns an 18X response with the SDP answer to bootstrap data channel to originating network. According to the received SDP answer, IMS AS may notify the DCSF using Nimsas_SessionEventControl_Notify, and then instruct MF to update data channel media resource information for UE#2.\n15-16:\tUE#2 and terminating network returns a 200 OK response.\n17.\tThe IMS AS notifies the successful session establishment event, Nimsas_SessionEventControl Notify (SessionEstablishmentSuccessEvent, Session ID, Media Info List) to DCSF.\n18.\tThe DCSF responds to the Nimsas notification request.\n19.\t200 OK forwarded to UE#1 which indicates the bootstrap data channel has been established.\n20.\tThe originating network P-CSCF executes QoS procedure for bootstrap data channel as specified in TS 23.203 [54] and TS 23.503 [95].\n21-24:\tThe bootstrap data channels have been established between originating MF and UE#1/UE#2. The UEs send application request messages to MF to request a data channel application or an application list if multiple DC applications are available, via the established bootstrap data channel with its data channel capabilities. The MF replaces the root URL with the replacement URL received in steps 8 and forwards the message to received media point of DCSF. The DCSF provides the application list and proper data channel applications further to UE#1 and UE#2 based on their data channel capabilities and their choices through MF.\nThe bootstrap data channels have also been established between terminating MF and UE#1/UE#2. The data channel application is requested and downloaded to UE#1 and UE#2 from terminating DCSF.\nEither UE in the IMS session may attempt to select an application from either its local or remote DCSF. Depending on a local policy in DCSF, the DCSF may decline the application selection from the remote UE, unless the application has been selected by the peer UE first.\nNOTE 4:\tHow the DCSF declines the application selection is out of scope of 3GPP.\nNOTE 5:\tIt is assumed that user of the remote UE is informed about the chosen application of the peer user together with a choice to accept or reject that request.\nSteps 20-24 may be executed after step 14, if the SDP answer in 200 OK to the PRACK and UPDATE messages contain the information required to establish bootstrap data channels.\nNOTE 6:\tIMS-AGW needs to allow the establishment of bootstrap data channels based on the information in the 200 OK to PRACK and UPDATE messages.\n25.\tSubsequent procedures continue.\nNOTE 7:\tIn the DC application list, the DCSF may provide DC applications supported by both UEs, or only supported by the UE who sends the application request message. The details of how to provide the application list to the UE and how to use it by the UE are not defined in this specification.\nAC.7.2\tApplication Data Channel Setup Signalling Procedure\nAC.7.2.1\tPerson to Person (P2P) Application Data Channel Setup\nFigure AC.7.2.1-1 depicts a signalling flow diagram for establishing an application data channel in a person-to-person use case. In this scenario, the MF is not used to anchor the Application data channel.\nIn the call flow the UEs have already established an IMS audio session, and the originating UE is updating the IMS audio/video session to an IMS data channel session.\nFigure AC.7.2.1-1: Person-to-Person Application Data Channel set up Signalling Procedure\nThe steps in the call flow are as follows:\n0.\tIMS session and bootstrap data channel have been established as described in Figure AC.7.1-1. Each UE (UE#1 and UE#2) may have bootstrap data channels established with both originating MF and terminating MF. Selected data channel application has been downloaded to UE#1 and possibly UE#2.\n1.\tUE#1 initiates a Person-to-Person Application Data Channel for the selected application. The UE#1 sends the SIP reINVITE request with an updated SDP to IMS AS, through originating network P-CSCF and S-CSCF. The updated SDP contains the bootstrap data channel information, as well as the requested application data channel and the associated DC application binding information, according to clause AC.5 and TS 26.114 [76].\nNOTE 1:\tThe SIP re-INVITE can be initiated either from UE#1 or UE#2.\n2.\tThe IMS AS validates user subscription data to determine whether the media change request event should be notified to the DCSF.\n3.\tThe IMS AS notifies the DCSF, via Nimsas_SessionEventControl_Notify (MediaChangeRequest Event, Calling ID, Called ID, Session ID, Event Direction, Media Info List) of the media change request event.\n4.\tAfter receiving the session event notification, the DCSF determines the policy about how to process the application data channel establishment request based on the related parameters (i.e. associated DC application binding information) in the notification and/or DCSF service specific policy.\n5.\tThe DCSF determines that the added application data channel media descriptor of the SDP offer takes UE#2 as target endpoint and does not require anchoring on the local MF.\nNOTE 2:\tIf MF needs to anchor application data channel, DCSF would have used the Nimsas_MediaControl service operation to instruct IMS AS to allocate data channel media resources of the MF.\n6.\tDCSF responds to the notification received in step 3.\n7-8.\tIMS AS sends the re-INVITE to the originating S-CSCF and then to the terminating network side and UE#2.\n9-11.\tUE#2 and terminating network returns a 200 OK response with SDP answer for application data channel to originating network. UE#2 may need to download the corresponding DC Application signalled in the SDP offer, if not done already and associate it with the requested application DC.\nNOTE 3:\tIt is assumed that the data channel application is downloaded to the UE#2 via the established bootstrap data channel between UE#2 and the MF/DCSF when UE#1 has downloaded the application from DCSF. In a case the UE#2 does not have it available when UE#2 receives the SDP offer for the application DC, the UE#2 can attempt to download it again.\nNOTE 4:\tThe UE at the terminating side is capable to determine if to use the DC application based on the received DC application binding information.\n12.\tIMS AS notifies the DCSF of the successful data channel modification.\n13.\tDCSF responds to the notification received in step 12.\n14-15.\tThe IMS AS sends 200 OK response to the originating S-CSCF and P-CSCF.\n16.\tThe originating network P-CSCF executes QoS procedure for application data channel media based on the SDP answer information from the 200 OK response.\n17.\tP-CSCF returns the 200 OK response to UE#1.\n18.\tUE#1 sends ACK to the terminating network.\n19.\tThe application data channel between UE#1 and UE#2 is established. In this example, it is not anchored in MF.\nIf the DCSF receives a notification for a media change request event for an application request that is initiated from the remote UE, if the local policy does not allow the remote UE to use an application, the DCSF may use the Nimsas_MediaControl_MediaInstruction service operation to instruct IMS AS to reject the offered media.\nNOTE 5:\tIt is possible that the remote UE has cached the application during a previous IMS DC session.\nAC.7.2.2\tPerson-to-Application (P2A) Application Data Channel Setup\nFigure AC.7.2.2-1 depicts a signalling flow diagram for establishing an Application Data Channel in a person to application use case.\nFigure AC.7.2.2-1: Person-to-Application (P2A) Application Data Channel set up Signalling Procedure\nThe steps in the call flow are as follows:\n0-3.\tSteps 0-3 of clause AC.7.2.1 applies.\nNOTE 1:\tThe SIP re-INVITE can be initiated either from UE#1 or UE#2.\n4.\tAfter receiving the session event notification, the DCSF determines the policy about how to process the application data channel establishment request based on the related parameters (i.e. associated DC application binding information) in the notification and/or DCSF service specific policy.\n5.\tThe DCSF determines that the added Application Data Channel media of the offer takes DC Application Server as target endpoint and requires to anchor in the MF.\n6.\tThe DCSF invokes Nimsas_MediaControl service operation to instruct IMS AS to terminate the media flow of the originating UE to MF. The instruction also includes information to be consumed by the MF that the data channel media shall be relayed via the MDC2 interface.\n7.\tThe IMS AS invokes Nmf_MRM_Create(List of Media Termination Descriptors) service operation to instruct MF on application data channel establishment and data channel media resource reservation based on the DC media information received from DCSF.\n8.\tThe IMS AS notifies the MediaControl instruction control response to DCSF.\n9.\tThe DCSF stores the media resource information and sends a P2A application data channel establishment request (including the MDC2 media resource received from MF) to the DC Application Server via DC3/DC4.\n10.\tDC Application Server accepts the P2A application data channel establishment request, returning an MDC2 reserved media resource as answer and is prepared for UE#1 traffic through MDC2.\nNOTE 2:\tDetails on how DCSF communicates with the DC Application Server is out of scope of this Release.\n11.\tDCSF requests IMS AS to update the MF resource with MDC2 media endpoint information of DC Application Server.\n12.\tIMS AS updates the MF resource.\n13.\tIMS AS notifies the MediaControl instruction control response to DCSF.\n14.\tDCSF replies to the notification received in step 13.\n15-16.\tIMS AS sends the re-INVITE to remote network side and UE#2, via the originating S-CSCF, which does not include application data channel request in the SDP for the application data channel.\n17-19:\tUE#2 and terminating network returns a 200 OK response with SDP answer for audio/video.\n20.\tIMS AS notifies the DCSF about the successful result of the MediaChangeRequest event.\n21.\tDCSF replies to the notification.\n22-23.\tThe IMS AS includes SDP answer for application data channels to UE#1 in 200 OK response and sends 200 OK response to S-CSCF and P-CSCF.\n24.\tThe originating network P-CSCF executes QoS procedure for application data channel media based on the SDP answer information from the 200 OK response.\n25.\tCSCF returns the 200 OK response to UE#1.\n26.\tUE#1 send ACK to the terminating network.\n27.\tThe application data channel between UE#1 and DC Application Server is established via MF. MF forwards data channel traffic between UE#1 and DC Application Server based on MDC2 media point information received in step 9 and 12.\nAC.7.2.3\tPerson-to-Application and Application-to-Person (P2A2P) Procedure\nThis procedure enables originating and terminating UE to establish application data channels for the same application to communicate with the same Data Channel Application Server.\nThe P2A2P procedure requires the establishment of application data channels from UE#1 to MF and from UE#2 to MF. The two application data channels are associated with the same application. This enables UE#1 and UE#2 to interact with the same DC Application Server simultaneously and the DC Application Server to correlate the data exchanged with both UEs. The P2A procedures as described in clause AC.7.2 are used to establish one application data channel between UE#1 and MF and, for A2P scenario, one application data channel between UE#2 and MF. In case of two involved UEs, this enables independent communication between UE#1 and UE#2 with the DC Application Server.\nFigure AC.7.2.3-1: Symmetric Application Data Channel Establishment\n0.\tIMS session and bootstrap data channels are established. Selected data channel applications are downloaded to UE#1 and possibly UE#2 as described in Figure AC.7.1-1. Each UE (UE#1 and UE#2) may have bootstrap data channels established with both originating MF and terminating MF.\n1.\tUE#1 initiates a Person-to-Application Application Data Channel for the selected application. The UE#1 sends SIP re-INVITE request with an updated SDP to IMS AS. The updated SDP contains the bootstrap data channel, the application data channel information and associated DC application binding information, according to clause AC.5 and TS 26.114 [76].\nNOTE 1:\tThe SIP re-INVITE can be initiated either from UE#1 or UE#2.\n2.\tIMS AS validates the data channel media description information and/or user subscription data to determine whether the DCSF needs to be notified.\n3.\tIMS AS selects and notifies the DCSF about the call event and data channel establishment request.\n4.\tThe DCSF determines how to process the application data channel establishment request based on the parameters (i.e. associated DC application binding information) in the notification from IMS AS and/or DCSF service specific policy.\n5.\tDCSF determines that the added application data channel media in the SDP offer requires the DC Application Server is the endpoint for both originating and terminating UE and that the application DC must be anchored at the MF. DCSF communicates with the DC Application Server for DC resource control. Once the application data channel is established, the DC Application Server will send/receive traffic to/from UE#1 through the MDC2 interface.\nNOTE 2:\tDetails on how the DCSF communicates with the DC Application Server are out of scope of this release.\n6.\tDCSF invokes Nimsas_MediaControl service to send data channel control request to IMS AS, including information how to relay data channel media via the MDC2 interface.\n7.\tIMS AS reserves data channel media resources at the MF via DC2 based on the DC media information received from DCSF. These requests by the IMS AS, are used to create two associated resources (one for the originating UE, and one for the terminating UE) in the MF.\n8.\tIMS AS notifies the DCSF about MediaControl instruction control response.\n9.\tDCSF communicates with the DC Application Server for DC resource control and provides information on data channel media resources reserved at the MF.\n10.\tThe DCSF stores the media resource information and replies to the Nimsas notification request.\n11-12.\tIMS AS sends re-INVITE which include the SDP offer from MF for the application data channel to the originating S-CSCF and then to the remote network and UE#2.\n13-16.\tUE#2 and terminating network return 200 OK with SDP answer for audio/video and for the application data channel. The terminating network P-CSCF executes QoS procedure for application data channel media based on the SDP in the 200 OK. The UE#2 may need to download the corresponding DC Application signalled in the SDP offer, if not done already and associate it with the requested application DC.\nNOTE 3:\tIt is assumed that the data channel application is downloaded to the UE#2 via the established bootstrap data channel between UE#2 and the MF/DCSF when UE#1 has downloaded the application from DCSF. In a case the UE#2 does not have it available when UE#2 receives the SDP offer for the application DC, the UE#2 can attempt to download it again.\nNOTE 4:\tThe UE at the terminating side is capable to determine if to use the DC application based on the received DC application binding information.\n17.\tIMS AS notifies the DCSF about the successful result of the MediaChangeRequest event.\n18.\tDCSF updates media resources in the MF via IMS AS.\n19.\tDCSF replies to the notification received in step 17.\n20-21.\tThe IMS AS includes SDP answer for application data channel to UE#1 in 200 OK and sends 200 OK to S-CSCF and P-CSCF.\n22.\tThe originating network P-CSCF executes QoS procedure for application data channel media based on the SDP in the 200 OK.\n23.\tP-CSCF returns the 200 OK to UE#1.\n24.\tUE#1 sends ACK to the terminating network.\n25.\tThe application data channel between UE#1 and DC Application Server is established via MF. MF forwards data channel traffic between UE#1 and DC Application Server via MDC2.\n26.\tThe application data channel between UE#2 and DC Application Server is established via MF. MF forwards data channel traffic between UE#2 and DC Application Server via MDC2.\nIf the DCSF receives a notification for a media change request event for an application request that is initiated from the remote UE, if the local policy does not allow the remote UE to use an application, the DCSF may use the Nimsas_MediaControl_MediaInstruction service operation to instruct IMS AS to reject the offered media.\nNOTE 5:\tIt is possible that the remote UE has cached the application during a previous IMS DC session.\nAC.7.3\tVoid\nAC.7.4\tNF service registration and discovery\nIf the NRF is used for NF registration and discovery, the DCSF and the MF shall register their services at the NRF before providing services to consumers, and existing NRF based mechanism needs to be extended with DC specific profiles. according to clause 4.17.1 of TS 23.502 [94].\nAC.7.4.1\tDCSF Registration and Discovery\nThe DCSF profile includes NF type=DCSF and may include IMPU ranges for calling identities or called identities of users it serves.\nThe DCSF can update and deregister in the NRF after registration and the procedures are specified in clauses 4.17.2 and 4.17.3 of TS 23.502 [94].\nAfter registration in the NRF, the DCSF can be discovered by other consumer NFs as specified in clauses 4.17.4 and 4.17.5 of TS 23.502 [94].\nAC.7.4.2\tMF Registration and Discovery\nThe MF profile includes NF type=MF and may include MF location information to select a local MF to minimize transmission delays in the media path.\nNOTE:\tThe MF location information is operator specific.\nThe MF can update and deregister in the NRF after registration and the procedures are specified in clauses 4.17.2 and 4.17.3 of TS 23.502 [94].\nAfter registration in the NRF, the MF and its services can be discovered by other consumer NFs as specified in clauses 4.17.4 and 4.17.5 of TS 23.502 [94].\nAC.7.5\tProviding subscriber specific graphical user interface to the UE\nAccording to clause 6.2.10.1 of TS 26.114 [76], the UE can send a HTTP GET Request for the root (\"/\") URL through the bootstrap data channel which is replied with a data channel application describing the graphical user interface and the logic needed to handle any further data channel usage beyond the bootstrap data channel itself. The graphical user interface can e.g. contain a menu of applications, from which the user can choose one or several. The graphical user interface should be subscriber specific and contain only applications for which the user has subscribed to and is authorized to use. To provide the graphical user interface containing subscriber specific data channel applications via the bootstrap data channel to the UE, the DCSF, when receiving a call event notification including subscriber specific information and optionally stream ID from the IMS AS, creates the URL identifying the graphical user interface corresponding to the stream ID (if available) for this subscriber.\nNOTE:\tHow the DCSF creates the URL is implementation specific.\nAC.7.6\tTermination of IMS Data Channel\nWhen a bootstrap data channel is established successfully, the bootstrap data channel shall be kept available during the IMS MMTel session, and it shall be terminated along with the release of the call.\nThe application data channel shall be terminated along with the release of the call or be terminated by closing this application separately. In the latter case, the UE triggers a SDP negotiation to release the application data channel.\nThe termination of application data channel shall not have any impact on the audio or video within the IMS sessions.\nAC.7.7\tQoS requirement of IMS Data Channel\nThe appropriate 5QI/QCI for the QoS flows of the IMS data channel media, as defined in TS 26.114 [76], shall be applied over the 5GS system or EPS system for IMS data channel.\nAC.7.8\tVoid\nAC.8\tVoid\nAC.9\tSupport of AR Communication\nAC.9.1\tGeneral\nThis clause describes the enhancements to the IMS architecture supporting data channel services to additionally support AR services. Two modes for AR services are supported: UE centric and network centric.\nAC.9.2\tArchitecture\nFigure AC.9.2-1: Architecture to support AR communication\nTo support AR communication, the data channel architecture is enhanced as follows:\nNOTE 1:\tThe term \"AR communication\" includes many different combinations of use cases, device capabilities and AR media content for which network assisted functions can be provided.\nAR Application Server (AR AS):\n-\tThe AR Application Server is responsible for AR service control related to AR communication, including AR session media control, AR media capability negotiation with the UE.\nNOTE 2:\tThe AR Application Server is a specific DC Application Server and is out of scope of 3GPP.\nMF:\n-\tThe MF supports AR media processing. It receives and stores AR service media handling logic from the AR AS, and provides Augmented Reality MF capability based on the AR data received from UE.\nNOTE 3:\tAR data includes AR metadata and AR related media, e.g. audio, video, etc.\nIMS AS:\n-\tThe IMS AS receives the media control instructions from the DCSF and accordingly interacts with the UE for connecting the UE's audio/video media termination to the MF.\nThe following reference points are used for network assisted IMS AR related signalling.\n-\tDC4: Reference point between the AR Application Server and the DCSF for AR service handling and AR session media control. This is out of scope of this Release.\n-\tDC2: Service based reference point between the IMS AS and the MF for AR media resource management.\nThe following reference points are used for IMS AR related media.\n-\tMDC2: Reference point between the AR Application Server and the MF for transmission of application data channel traffic.\nNOTE 4:\tThe MDC2 reference point is not specified in 3GPP.\n-\tMb: Reference point used for IMS media transport and AR media transmission.\nAC.9.2.1\tUE Centric AR Communication\nFor the UE centric case, AR traffic is transparent to the IMS network and is exchanged between the two peer UEs via the deployed media functions (e.g. IMS AGW/TrGW).\nNOTE:\tThe UE can download the AR metadata from AR AS through application data channel.\nAC.9.2.2\tNetwork Centric AR Communication\nMultiple realization alternatives for network assisted AR are available depending on device capability and what requirements the AR application has on the media transport protocol used between the UE and the network assisted AR function. AR services can be delivered via the following mechanisms:\n-\tThe AR application server provides network assisted rendering by having all AR media being transported using an established application data channel between the UE and the AR application server. This scenario represents a standard P2A/A2P data channel application as per clause AC.7.2 and consequently not requiring any further description.\n-\tAn IMS Media Function (MF) having the Augmented Reality media function capability, provides required network assisted AR media processing.\nAC.9.3\tProcedures\nAC.9.3.1\tUE Centric Procedure\nFigure AC.9.3.1-1: Establishment of UE Centric AR communication session\nFigure AC.9.3.1-1 depicts a typical call flow procedure to establish a UE centric AR IMS session from UE-A perspective. The main steps in the call flow are as follows:\n1.\tUE-A initiates an IMS communication with UE-B, including establishment of bootstrap data channel.\n2.\tThe user of UE-A upgrades the IMS session with AR experience.\nUE-A initiates a re-INVITE adding media descriptors required by the AR application to be established E2E, e.g. RTP and/or application data channels. Application data channel may be anchored in the MF.\nIn this scenario, the UE performs AR media rendering based on the AR data from its local application.\nNOTE:\tIn other scenarios, the UE may acquire AR data from other sources, e.g. the peer UE, the AR AS etc.\n3.\tUE-A captures the AR data, performs AR media rendering locally and then encodes AR media e.g. audio/video media stream.\n4.\tUE-A sends the AR media to UE-B through the established media connection(s).\n5.\tUE-A receives the AR media from UE-B through established media connection(s).\n6.\tUE-A decodes the AR media and performs AR media rendering locally and displays it on its screen.\nAC.9.3.2\tNetwork Centric Procedure\nFigure AC.9.3.2-1 depicts an example for a call flow procedure to establish a network centric AR IMS session from UE-A perspective with rendering in the network for one of the UEs (UE-A) involved in AR communication. The main steps in the call flow are as follows:\nFigure AC.9.3.2-1: Establishment of Network Centric AR communication session\n1.\tThe UE-A initiates an IMS session and establishes audio and video session connections with the UE-B. The bootstrap data channel(s) are established at the same time for both the UE-A and UE-B.\nAR Media Rendering Negotiation Procedure:\n2.\tThe UE-A decides to request network media rendering based on its status such as power, signal, computing power, internal storage, etc.\n3.\tThe UE-A finishes AR media rendering negotiation with the AR AS.\nNOTE 1:\tThe media negotiation for split rendering between the UE and the network is out of scope of this Release.\nNOTE 2:\tThe negotiation procedure in steps 2, 3, and 4 is specified in TS 26.264 [104].\n4.\tIf the negotiation result is successful in step 3, the UE-A initiates new P2A application data channels, which are used for AR data transmission between the UE-A and the network. During the P2A application data channel establishment procedure, the DCSF will instruct the MF via IMS AS how to establish the data channel and corresponding media processing specification.\n5(Optional). IMS AS initiates a Media re-Negotiation request with UE-A, to connect UE-A's audio/video media stream to MF.\n6.\tIMS initiates a Media re-Negotiation request with UE-B, to connect UE-B's audio/video media stream to MF.\nThe UE-A can request to change the network rendering content if the status changed in the UE-A, such as low power, low computing power, etc.\nNetworking Centric Procedure:\n7.\tThe UE-A captures AR data and sends AR data to MF for network assisted rendering.\n8.\tBased on the AR data received from the UE-A and/or instructions received from the AR AS, the MF performs AR media rendering according to the negotiation result in step 3.\n9.\tThe MF sends the rendered audio/video media stream to the UE-B.\nAnnex AD (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2014-09\nSA#65\nSP-140430\n1073\n3\nB\nPaging Policy Differentiation over LTE for IMS Voice\n13.0.0\n2014-09\nSA#65\nSP-140431\n1084\n2\nB\nSharing Resources For Sessions on Hold\n13.0.0\n2014-12\nSA#66\nSP-140690\n1092\n1\nB\nMedia components of a session put on hold\n13.1.0\n2014-12\nSA#66\nSP-140690\n1093\n2\nB\nP-CSCF Information Reporting Shared resources\n13.1.0\n2014-12\nSA#66\nSP-140686\n1095\n1\nA\nInterface between IM-SSF and HSS\n13.1.0\n2014-12\nSA#66\nSP-140676\n1097\n1\nA\nSupport for flexible BFCP\n13.1.0\n2014-12\nSA#66\nSP-140688\n1098\n1\nF\nConfiguration for paging policy differentiation\n13.1.0\n2014-12\nSA#66\nSP-140693\n1099\n-\nB\nInsertion of GI by an AS\n13.1.0\n2015-03\nSA#67\nSP-150109\n1101\n1\nA\nT-ADS for UEs supporting access to IMS via WLAN connected to EPC using S2b or S2a\n13.2.0\n2015-03\nSA#67\nSP-150022\n1103\n1\nA\nMSRP Clarification\n13.2.0\n2015-03\nSA#67\nSP-150022\n1105\n-\nA\nBFCP Clarification\n13.2.0\n2015-06\nSA#68\nSP-150223\n1110\n-\nA\nAS allowing non-international format Request-URI when RAVEL is used\n13.3.0\n2015-06\nSA#68\nSP-150225\n1116\n1\nA\nCodecs for WebRTC\n13.3.0\n2015-06\nSA#68\nSP-150222\n1120\n-\nA\nRemoval of long expired reference to draft-kaplan-enum-sip-routing\n13.3.0\n2015-06\nSA#68\nSP-150222\n1126\n2\nA\nOMR handling of SDP offer-answer exchanges after media path has been selected\n13.3.0\n2015-06\nSA#68\nSP-150230\n1129\n2\nA\nStage 2 cleanup regarding the WIC registration with a security token\n13.3.0\n2015-06\nSA#68\nSP-150232\n1134\n3\nB\nSupporting Class of Users\n13.3.0\n2015-09\nSA#69\nSP-150494\n1135\n1\nD\nClarifying IMPU/IMPI relationship for WIC registration from a pool of Identities\n13.4.0\n2015-09\nSA#69\nSP-150503\n1136\n3\nB\nSupport for providing and distinguishing multiple UE provided access information over untusted WLAN access\n13.4.0\n2015-09\nSA#69\nSP-150500\n1139\n2\nF\nClarifications on indication of resource sharing\n13.4.0\n2015-09\nSA#69\nSP-150526\n1138\n2\nB\nSupport Minimizing bearer level protocol conversion\n13.4.0\n2016-03\nSA#71\nSP-160155\n1144\n2\nA\nReplacing Incorrect Reference for business trunking Specification TS\n13.5.0\n2016-06\nSA#72\nSP-160298\n1142\n7\nC\nPriority sharing for concurrent sessions, IMS\n13.6.0\n2016-06\nSA#72\nSP-160297\n1147\n2\nF\nNPLI for untrusted WLAN access in IMS\n13.6.0\n2016-06\nSA#72\nSP-160304\n1146\n6\nB\nSupport for Acquisition and subscription to changes in PLMN id by P-CSCF\n14.0.0\n2016-09\nSA#73\nSP-160660\n1148\n3\nB\nSupport for P-CSCF sending a response to UE or IMS network when receiving Bearer Setup Request Rejection for QCI=1\n14.1.0\n2016-09\nSA#73\nSP-160664\n1151\n2\nA\nNPLI for untrusted WLAN access in IMS for LI purposes\n14.1.0\n2016-09\nSA#73\nSP-160651\n1152\n2\nC\nHandling of Local Number Translation for roaming users in deployments without IMS-level roaming interfaces\n14.1.0\n2016-09\nSA#73\nSP-160658\n1153\n3\nB\nTCP transport for data channels towards the WIC.\n14.1.0\n2016-09\nSA#73\nSP-160658\n1154\n3\nB\nWebRTC Media plane optimization with DTLS termination.\n14.1.0\n2016-09\nSA#73\nSP-160651\n1155\n1\nF\nInter-PLMN Mobility support clarification for V8\n14.1.0\n2016-09\nSA#73\nSP-160658\n1156\n3\nB\nSupport of RTP/RTCP multiplexing for WebRTC\n14.1.0\n2016-09\nSA#73\nSP-160651\n1157\n-\nB\nMCC Implementation correction for text in clause 4.15b\n14.1.0\n2016-09\nSA#73\nSP-160658\n1159\n1\nF\nReference point clarification between IMS entities for IMS session and dialog\n14.1.0\n2016-09\nSA#73\nSP-160658\n1160\n3\nB\nControl parameter for predictable pre-emption of media flows\n14.1.0\n2016-12\nSA#74\nSP-160809\n1163\n1\nA\nEditorial change reflecting IMS being access agnostic\n14.2.0\n2016-12\nSA#74\nSP-160809\n1164\n1\nA\nEditorial changes and inclusion of Mp Reference Point and missing reference point P-CSCF - I-CSCF\n14.2.0\n2016-12\nSA#74\nSP-160826\n1166\n5\nB\nSupport for 3GPP PS Data off for SIP-Based Service\n14.2.0\n2017-03\nSA#75\nSP-170051\n1169\n1\nF\n3GPP Data Off IMS Status Reporting Correction\n14.3.0\n2017-03\nSA#75\nSP-170052\n1170\n2\nF\nAlignment with CT WG3 for support for subscription to changes to IP-CAN by P-CSCF at IMS session setup.\n14.3.0\n2017-06\nSA#76\nSP-170372\n1172\n2\nF\nAdding SIP AS as the entity to determines when resource sharing is to be performed\n14.4.0\n2017-09\nSA#77\nSP-170716\n1176\n2\nF\nSupport for Enhanced Coverage for data centric UEs\n14.5.0\n2017-09\nSA#77\nSP-170732\n1173\n1\nB\nWebRTC Web Server Function discovery\n15.0.0\n2017-09\nSA#77\nSP-170727\n1174\n4\nB\nnew annex to 23.228 for 5GS support\n15.0.0\n2017-09\nSA#77\nSP-170727\n1175\n2\nB\nAdaptation to TS 23.228 due to 5GS\n15.0.0\n2017-09\nSA#77\nSP-170729\n1177\n2\nC\nIMS support to 3GPP PS Data Off Phase 2\n15.0.0\n2017-12\nSA#78\nSP-170919\n1179\n1\nF\nImprovements to TS 23.228 Annex M to reflect 5GS\n15.1.0\n2017-12\nSA#78\nSP-170919\n1180\n1\nF\nImprovements to TS 23.228 Annex Y\n15.1.0\n2017-12\nSA#78\nSP-170921\n1183\n-\nC\nClarification on UE behavior when receiving single list of Exempt Services - TS 23.228\n15.1.0\n2017-12\nSA#78\nSP-170924\n1184\n2\nB\nSupport for identity attestation and verification\n15.1.0\n2017-12\nSA#78\nSP-170915\n1186\n2\nA\nModification on PS Data Off support in IMS Client - TS 23.228\n15.1.0\n2018-03\nSA#79\nSP-180094\n1187\n1\nF\nClarification on additional IP address\n15.2.0\n2018-03\nSA#79\nSP-180090\n1188\n2\nF\nIMS registration procedures for UE in Dual Registration mode\n15.2.0\n2018-09\nSA#81\nSP-180712\n1191\n1\nF\nClarification on access network information during IMS call in 5G dual connectivity scenario\n15.3.0\n2019-03\nSA#83\nSP-190156\n1196\n1\nF\nClause W.2 on \"Architecture without IMS-level roaming interfaces\" to refer to clause Y.9.2 that defines it for the 5GS case.\n15.4.0\n2019-03\nSA#83\nSP-190163\n1193\n4\nB\nSupport for RLOS in IMS\n16.0.0\n2019-03\nSA#83\nSP-190175\n1194\n1\nB\nSupport for RAN Assisted Codec Adaptation\n16.0.0\n2019-06\nSA#84\nSP-190419\n1199\n1\nB\neIMS P-CSCF use of NRF\n16.1.0\n2019-06\nSA#84\nSP-190419\n1200\n3\nB\nSBA HSS Services for IMS\n16.1.0\n2019-06\nSA#84\nSP-190419\n1201\n3\nB\nHSS Discovery and Interface Type Selection\n16.1.0\n2019-06\nSA#84\nSP-190419\n1202\n1\nB\nAllowing SMF to perform P-CSCF Discovery using NRF\n16.1.0\n2019-06\nSA#84\nSP-190419\n1203\n3\nB\nAllowing IMS to use N5 interface to interact with PCF\n16.1.0\n2019-06\nSA#84\nSP-190419\n1204\n-\nB\nAdditional corrections for allowing IMS to use N5 interface to interact with PCF\n16.1.0\n2019-06\nSA#84\nSP-190419\n1205\n2\nF\nBearer establishment mode negotiation not applicable in 5GC\n16.1.0\n2019-06\nSA#84\nSP-190426\n1206\n1\nB\nIntroduction of UDICOM\n16.1.0\n2019-06\nSA#84\nSP-190406\n1208\n2\nF\nCorrection to Support for RAN Assisted Codec Adaptation\n16.1.0\n2019-09\nSA#85\nSP-190611\n1211\n5\nF\nUpdate of SBA HSS Services for IMS\n16.2.0\n2019-09\nSA#85\nSP-190611\n1212\n3\nF\nClarification for HSS Discovery and Interface Type Selection\n16.2.0\n2019-09\nSA#85\nSP-190611\n1218\n-\nF\nResolve EN on networks with both Rx and N5 support\n16.2.0\n2019-09\nSA#85\nSP-190611\n1219\n2\nF\nUpdate P-CSCF Registration with NRF\n16.2.0\n2019-12\nSA#86\nSP-191087\n1222\n1\nF\nFixing incorrectly implemented 23.228 CR1193\n16.3.0\n2019-12\nSA#86\nSP-191078\n1223\n1\nF\nHSS Service Name correction\n16.3.0\n2019-12\nSA#86\nSP-191078\n1225\n2\nF\nCorrection on HSS service Nhss_imsSubscriberDataManagement\n16.3.0\n2019-12\nSA#86\nSP-191078\n1226\n-\nF\nUDR service for mapping IMS Public Identity to HSS Group ID for HSS selection\n16.3.0\n2019-12\nSA#86\nSP-191087\n1228\n-\nF\nCorrections to S-CSCF discovery during RLOS IMS registration\n16.3.0\n2020-03\nSA#87E\nSP-200080\n1231\n2\nF\nEPS Fallback event transporting within IMS\n16.4.0\n2020-09\nSA#89E\nSP-200678\n1234\n1\nF\nHSS Selection Update\n16.5.0\n2020-09\nSA#89E\nSP-200678\n1235\n-\nF\nError correction for imsSubscriber Data Management Service and acquistion of an 5GS IP address for\n16.5.0\n2020-12\nSA#90E\nSP-200956\n1236\n-\nF\nCorrection to HSS Discovery and Selection via NRF\n16.6.0\n2020-12\nSA#90E\nSP-200959\n1237\n1\nC\nProviding User Location during IP Messaging\n16.6.0\n2021-03\nSA#91E\nSP-210085\n1238\n1\nB\nUpgrade IMS non-MPS session to an IMS MPS session.\n17.0.0\n2021-03\nSA#91E\nSP-210088\n1240\n-\nC\nIMS signalling optimization with HSS GID\n17.0.0\n2021-03\nSA#91E\nSP-210088\n1241\n-\nB\nSupport for Attestation for IMS priority sessions\n17.0.0\n2021-03\nSA#91E\nSP-210086\n1242\n1\nB\nUse of Paging Policy Differentiation for setting the Paging Cause\n17.0.0\n2021-06\nSA#92E\nSP-210353\n1239\n2\nB\nKI#3: Support for IMC for SNPN\n17.1.0\n2021-06\nSA#92E\nSP-210353\n1243\n3\nF\nKI#3: IMS Support for SNPN\n17.1.0\n2021-09\nSA#93E\nSP-210923\n1245\n1\nF\nSNPN support for 1 to N independent IMS Providers\n17.2.0\n2021-09\nSA#93E\nSP-210923\n1246\n1\nF\nIMS Support for SNPN\n17.2.0\n2021-12\nSA#94E\nSP-211305\n1248\n1\nF\nCorrection in HSSGID procedures\n17.3.0\n2021-12\nSA#94E\nSP-211576\n1255\n-\nA\nUpdate IETF reference\n17.3.0\n2022-12\nSA#98E\nSP-221094\n1257\n6\nC\nIMS cross border mobility with Home routed IMS calls\n18.0.0\n2023-03\nSA#99\nSP-230060\n1258\nB\nSupport of PSAP resolution with NWDAF\n18.1.0\n2023-03\nSA#99\nSP-230071\n1263\n9\nB\nArchitecture of IMS supporting data channel\n18.1.0\n2023-03\nSA#99\nSP-230071\n1264\n3\nB\nIMS SBA Services\n18.1.0\n2023-03\nSA#99\nSP-230071\n1266\n2\nB\nBinding information of DC Application with DC - 23.228\n18.1.0\n2023-03\nSA#99\nSP-230071\n1267\n03\nB\nDCMF services\n18.1.0\n2023-03\nSA#99\nSP-230071\n1268\n02\nB\nIMS DC capability discovery\n18.1.0\n2023-03\nSA#99\nSP-230071\n1275\n2\nB\nIntroduce Data Channel Related Definitions\n18.1.0\n2023-06\nSA#100\nSP-230482\n1265\n2\nB\nKI#4 Describe option to support MRF registration and discovery using NRF\n18.2.0\n2023-06\nSA#100\nSP-230482\n1278\n4\nC\nClarification on IMS Data Channel Service\n18.2.0\n2023-06\nSA#100\nSP-230482\n1281\n-\nC\nUpdate to IMS AS SBA Services\n18.2.0\n2023-06\nSA#100\nSP-230482\n1284\n6\nB\nSupporting UE centric AR Telephony Communication\n18.2.0\n2023-06\nSA#100\nSP-230482\n1286\n4\nC\nUE trigger for IMS Data Channel setup\n18.2.0\n2023-06\nSA#100\nSP-230482\n1287\n1\nC\nEstablishing data channel before 200 OK\n18.2.0\n2023-06\nSA#100\nSP-230482\n1294\n1\nB\nProvide application list based on UE DC capabilities\n18.2.0\n2023-06\nSA#100\nSP-230721\n1295\n6\nC\nUpdate on the usage of DC App-ID, and P2A2P procedures\n18.2.0\n2023-06\nSA#100\nSP-230482\n1301\n5\nB\nUpdate of Bootstrap and application data channel setup procedures\n18.2.0\n2023-06\nSA#100\nSP-230482\n1302\n3\nC\nProcedures on Data Channel termination and QoS requirement\n18.2.0\n2023-06\nSA#100\nSP-230482\n1303\n4\nB\nUpdate of DCMF service to support media processing\n18.2.0\n2023-06\nSA#100\nSP-230482\n1305\n1\nB\nReference point between HSS and DCSF\n18.2.0\n2023-06\nSA#100\nSP-230482\n1307\n1\nC\nDCMF service registration and discovery\n18.2.0\n2023-06\nSA#100\nSP-230482\n1320\n2\nUsage of Mr/Cr with IMS DC\n18.2.0\n2023-06\nSA#100\nSP-230482\n1325\n-\nF\nClarification on Interfaces and Reference Points Used for DC\n18.2.0\n2023-06\nSA#100\nSP-230482\n1326\n1\nC\nRoaming support for IMS Data Channel service\n18.2.0\n2023-06\nSA#100\nSP-230482\n1328\n3\nC\nUpdate on IMS AS service to support AR communication\n18.2.0\n2023-09\nSA#101\nSP-230852\n1331\n2\nF\nUpdate to MF services\n18.3.0\n2023-09\nSA#101\nSP-230852\n1333\n2\nF\nArchitecture alignment to replace DCMF with MF\n18.3.0\n2023-09\nSA#101\nSP-230852\n1337\n2\nF\nUpdate on Nimsas_SessionEventControl_Notify Service Operation Parameters\n18.3.0\n2023-09\nSA#101\nSP-230852\n1338\n-\nF\nModification of Bootstrap Data Channel Setup Signalling Procedure\n18.3.0\n2023-09\nSA#101\nSP-230852\n1342\n-\nF\nUpdate of Nimsas_SessionEventControl_Notify for binding information\n18.3.0\n2023-09\nSA#101\nSP-230852\n1347\n2\nF\nUpdate general description of HSS service for data channel\n18.3.0\n2023-09\nSA#101\nSP-230852\n1354\n1\nF\nUpdate to data channel setup procedures\n18.3.0\n2023-09\nSA#101\nSP-230852\n1355\n-\nF\nChange media type value to DC\n18.3.0\n2023-09\nSA#101\nSP-230852\n1356\n-\nF\nRemove editor's note in clause AA.1.1\n18.3.0\n2023-09\nSA#101\nSP-230852\n1357\n2\nF\nDCM selection based on IP address and location\n18.3.0\n2023-12\nSA#102\nSP-231266\n1339\n3\nF\nUpdate on IMS Data Channel Service Subscription\n18.4.0\n2023-12\nSA#102\nSP-231266\n1362\n-\nF\nCorrection on Figure AC.7.1-1: Bootstrap Data Channel set up Signalling Procedure\n18.4.0\n2023-12\nSA#102\nSP-231266\n1363\n2\nF\nKI#2_ Update AR communicate procedure\n18.4.0\n2023-12\nSA#102\nSP-231266\n1366\n3\nF\nClarification on Function Description in AC.2.2\n18.4.0\n2023-12\nSA#102\nSP-231266\n1368\n1\nF\nCorrection of description in the Figure of the P2A2P procedure\n18.4.0\n2023-12\nSA#102\nSP-231266\n1371\n4\nF\nClarification on how to handle IMS DC capability indications\n18.4.0\n2023-12\nSA#102\nSP-231266\n1372\n2\nF\nCorrection on IMS DC event notification\n18.4.0\n2023-12\nSA#102\nSP-231266\n1374\n2\nF\nUpdate of P2A and P2A2P procedures\n18.4.0\n2023-12\nSA#102\nSP-231266\n1375\n2\nF\nIMS Data Channel establishment\n18.4.0\n2023-12\nSA#102\nSP-231266\n1376\n1\nF\n23.228 Editorial change for the DC call flow\n18.4.0\n2024-03\nSA#103\nSP-240105\n1361\n1\nClause Number Correction\n18.5.0\n2024-03\nSA#103\nSP-240105\n1382\n-\nF\nUpdate on IMS DC Capability Negotiation\n18.5.0\n2024-03\nSA#103\nSP-240105\n1383\n1\nF\nClarification on Bootstrap Data Channel Setup Signalling procedure\n18.5.0\n2024-03\nSA#103\nSP-240105\n1386\n-\nF\n23.228 Editorial change for the DC procedure\n18.5.0\n2024-03\nSA#103\nSP-240105\n1388\n1\nF\nClarification on terminating UE initiated data channel\n18.5.0\n2024-06\nSA#104\nSP-240599\n1384\n3\nF\nUpdate on UE Centric AR communication Procedure\n18.6.0\n2024-06\nSA#104\nSP-240599\n1389\n2\nF\nClarifications regarding DCMF\n18.6.0\n2024-06\nSA#104\nSP-240599\n1391\n1\nF\nClarification on DC QoS Handling in Application Data Channel Setup Procedures\n18.6.0\n2024-06\nSA#104\nSP-240599\n1395\n2\nF\nSome correction and clarification to Annex AC\n18.6.0\n2024-06\nSA#104\nSP-240599\n1397\n1\nF\nMapping of DC binding information with SDP attribute\n18.6.0\n2024-09\nSA#105\nSP-241248\n1393\n3\nF\nUpdates on IMS AS service Nimsas_SessionEventControl\n18.7.0\n2024-09\nSA#105\nSP-241248\n1443\n1\nF\nEditorial Change to Correct the Wording\n18.7.0\n2024-09\nSA#105\nSP-241248\n1444\n2\nF\nMultiplexing of IMS data channels\n18.7.0\n2024-09\nSA#105\nSP-241248\n1448\n1\nF\nRemove MRF from IMS data channel architecture\n18.7.0\n2024-12\nSA#106\nSP-241477\n1495\n2\nF\nCorrection of BDC Establishment Procedure\n18.8.0\n2025-03\nSA#107\nSP-250048\n1394\n5\nF\nCorrelating the application DC with the bootstrap DC\n18.9.0\n2025-03\nSA#107\nSP-250048\n1559\n1\nF\nClarification on ADC Setup Procedure\n18.9.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.1",
        "clause_5.1.1.1",
        "clause_4.2.6",
        "ts_23.203_clause_6.1.7",
        "clause_5.10.3.0",
        "clause_5.10.3.1",
        "clause_4.2.5",
        "clause_5.4.7",
        "clause_6.2.1.3",
        "ts_23.237_clause_6.2.2.3",
        "clause_4.2.4",
        "clause_5.4.5.3",
        "clause_3.1",
        "clause_5.1.0",
        "clause_5.1.1.0",
        "clause_4.15",
        "clause_5.6.2",
        "clause_5.7.2",
        "ts_24.525_clause_4.15",
        "ts_23.402_clause_16",
        "clause_4.3.3.4",
        "clause_5.3",
        "clause_4.0",
        "clause_4.4",
        "ts_23.501_clause_5.6.1",
        "ts_23.501_clause_5.8.2.2",
        "ts_23.501_clause_5.6.4",
        "ts_23.502_clause_4.3.2",
        "ts_23.501_clause_5.16.3",
        "ts_23.501_clause_5.7",
        "ts_23.502_clause_4.3.3",
        "ts_23.502_clause_4.2.6",
        "ts_23.501_clause_5.8.1.1",
        "clause_5.16.3.11",
        "ts_23.501_clause_5.16.3.4",
        "ts_23.501_clause_5.16.3.2",
        "clause_4.6.3",
        "ts_26.114_clause_6.2.13",
        "ts_24.186_clause_9.2",
        "ts_23.502_clause_4.17.1",
        "ts_26.114_clause_6.2.10.1",
        "table_6.1.7",
        "figure_5.22.2-1",
        "figure_4.0",
        "ts_23.060",
        "ts_23.401",
        "ts_23.221",
        "ts_23.203",
        "ts_23.107",
        "ts_23.237",
        "ts_23.003",
        "ts_29.214",
        "ts_29.328",
        "ts_22.173",
        "ts_26.114",
        "ts_36.300",
        "ts_36.321",
        "ts_23.333",
        "ts_23.334",
        "ts_23.002",
        "ts_24.229",
        "ts_29.162",
        "ts_33.203",
        "ts_33.210",
        "ts_23.502",
        "ts_23.503",
        "ts_23.218",
        "ts_24.525",
        "ts_33.310",
        "ts_23.402",
        "ts_33.328",
        "ts_23.632",
        "ts_29.563",
        "ts_23.501",
        "ts_23.288",
        "ts_38.300",
        "ts_38.321",
        "ts_29.228",
        "ts_24.186",
        "ts_26.264",
        "ts_13.5",
        "ts_23.228"
      ]
    }
  ]
}