{
  "metadata": {
    "specification_id": "ts_29.228",
    "version": "18.0.0",
    "title": "3GPP TS 29.228",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29228-i00/29228-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:19:31.800101",
    "total_chunks": 98
  },
  "chunks": [
    {
      "chunk_id": "ts_29.228_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "This 3GPP Technical Specification (TS) specifies:\n1.\tThe interactions between the HSS (Home Subscriber Server) and the CSCF (Call Session Control Functions), referred to as the Cx interface.\n2.\tThe interactions between the CSCF and the SLF (Server Locator Function), referred to as the Dx interface.\n3.\tThe interactions between the SIP Core and the SIP database, referred to as the Cx interface, for the Mission Critical Services, where this interface is named as AAA-1, as described in 3GPP TS 23.280 [30].\nNOTE:\tIn the 3GPP TS 23.280 [30] the term SIP database is used for the HSS and the term SIP Core is used for the P-CSCF, the I-CSCF and the S-CSCF when compared to this specification.\nThe IP Multimedia (IM) Subsystem stage 2 is specified in 3GPP TS 23.228 [1] and the signalling flows for the IP multimedia call control based on SIP and SDP are specified in 3GPP TS 24.228 [2].\nThis document addresses the signalling flows for Cx and Dx interfaces.\nThis document also addresses how the functionality of Px interface is accomplished.\nThe Presence Service Stage 2 description (architecture and functional solution) is specified in 3GPP TS 23.141 [10].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.280",
        "ts_23.228",
        "ts_24.228",
        "ts_23.141"
      ]
    },
    {
      "chunk_id": "ts_29.228_2",
      "section_id": "2",
      "section_title": "References",
      "content": "[1]\t3GPP TS 23.228: \"IP Multimedia (IM) Subsystem – Stage 2\".\n[2]\t3GPP TS 24.228: \"Signalling flows for the IP multimedia call control based on SIP and SDP\".\n[3]\t3GPP TS 33.203: \"Access security for IP-based services\".\n[4]\t3GPP TS 23.002: \"Network architecture\".\n[5]\t3GPP TS 29.229: \"Cx Interface based on Diameter – Protocol details\".\n[6]\t3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IP Multimedia (IM) call model\".\n[7]\tIETF RFC 2045 \"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies\".\n[8]\t3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and SDP\" – stage 3.\n[9]\tVoid.\n[10]\t3GPP TS 23.141: \"Presence Service; Architecture and Functional Description\".\n[11]\tIETF RFC 3261 \"SIP: Session Initiation Protocol\".\n[12]\tIETF RFC 4566 \"SDP: Session Description Protocol\".\n[13]\tIEEE 1003.1-2004, Part 1: Base Definitions.\n[14]\tIETF RFC 2486: \"The Network Access Identifier\".\n[15]\tIETF RFC 3966: \"The tel URI for Telephone Numbers\".\n[16]\tVoid.\n[17]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[18]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[19]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[20]\tVoid\n[21]\tIETF RFC 4005: \"Diameter Network Access Server Application\".\n[22]\tIETF RFC 4412: \"Communications Resource Priority for the Session Initiation Protocol (SIP)\".\n[23]\t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[24]\tIETF RFC 7683: \"Diameter Overload Indication Conveyance\".\n[25]\t3GPP TS 22.153: \"Multimedia Priority Service\".\n[26]\tANSI X3.4: \"Coded Character Set - 7-bit American Standard Code for Information Interchange\".\n[27]\tIETF RFC 7944: \"Diameter Routing Message Priority\".\n[28]\tVoid\n[29]\tIETF IETF RFC 8583: \"Diameter Load Information Conveyance\".\n[30]\t3GPP TS 23.280: \"Common functional architecture to support mission critical services\".\n[31]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[32]\t3GPP TS 24.323: \"3GPP IP Multimedia Subsystem (IMS) service level tracing management object (MO)\".\n[33]\tIETF RFC 7616: \"HTTP Digest Access Authentication\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.228",
        "ts_24.228",
        "ts_33.203",
        "ts_23.002",
        "ts_29.229",
        "ts_23.218",
        "ts_24.229",
        "ts_23.141",
        "ts_23.003",
        "ts_23.008",
        "ts_23.380",
        "ts_23.167",
        "ts_22.153",
        "ts_23.280",
        "ts_24.323"
      ]
    },
    {
      "chunk_id": "ts_29.228_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the following terms and definitions given in TS 23.003 [17] apply:\nDistinct Public Service Identity\nDistinct Public User Identity\nPublic Service Identity\nPublic User Identity\nWildcarded Public Service Identity\nWildcarded Public User Identity\nFor the purposes of the present document, the following terms and definitions apply.\nCommon Part (of a user profile): Contains Initial Filter Criteria instances that should be evaluated both for registered and unregistered Public User Identities, or for unregistered Public Service Identities in the S-CSCF.\nComplete user profile: Contains the Initial Filter Criteria instances of all three different user profile parts; registered part, unregistered part and common part.\nIP Multimedia session: IP Multimedia session and IP Multimedia call are treated as equivalent in this specification.\nAuthentication pending flag: A flag that indicates that the authentication of a Public User Identity - Private User Identity pair is pending and waiting for confirmation.\nCharging information: Data that is sent in the Charging-Information AVP.\nAllowed WAF and/or WWSF identities: A list of network addresses identifying WebRTC Authentication Functions (WAFs) and/or WebRTC Web Server Functions (WWSFs) allowed for a subscription.\nImplicitly registered Public User Identity set: A set of Public User Identities, which are registered and de-registered simultaneously when any of the Public User Identities belonging to that set is registered or de-registered.\nNot Registered State: Public Identity is not Registered and has no S-CSCF assigned.\nPrivate Identity: Either a Private User Identity or a Private Service Identity.\nPublic Identity: Either a Public User Identity or a Public Service Identity.\nRegistered Part (of a user profile): Contains Initial Filter Criteria instances that should be evaluated only for registered Public User Identities in the S-CSCF. iFCs from the registered part need not be evaluated when the Public Identity is unregistered.\nRegistered State: Public User Identity is Registered at the request of the user and has an S-CSCF assigned.\nS-CSCF reassignment pending flag: A flag that is handled only when IMS Restoration Procedures are supported.and that indicates that the subscription may be reassigned to a new S-CSCF (i.e. the current S-CSCF is not responding)\nUnregistered part (of a user profile): Contains Initial Filter Criteria instances that should be evaluated only for unregistered Public Identities in the S-CSCF. iFCs from the unregistered part need not be evaluated when the Public User Identity is registered.\nUnregistered State: Public Identity is not Registered but has a serving S-CSCF assigned to execute Unregistered state services as a consequence of a terminating  request, or an originating request from an AS on behalf of a user, or there is an S-CSCF keeping the user profile stored.\nUser information: The user related data that the S-CSCF requests from the HSS or HSS pushes to the S-CSCF, e.g. user profile,charging information, allowed WAF and/or WWSF identities and authentication information.\nUser profile: Data that is sent in the User-Data AVP.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.228_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the following abbreviations apply:\nAVP\tAttribute Value Pair\nC\tConditional\nCSCF\tCall Session Control Function\nDRMP\tDiameter Routing Message Priority\nDSCP\tDifferentiated Services Code Point\nGIBA\tGPRS-IMS-Bundled-Authentication\nHSS\tHome Subscriber Server\nIE\tInformation Element\nIP\tInternet Protocol\nI-CSCF\tInterrogating CSCF\nIM\tIP Multimedia\nIMS\tIP Multimedia Subsystem\nM\tMandatory\nMPS\tMultimedia Priority Service\nNASS\tNetwork Attachment SubSystem\nO\tOptional\nP-CSCF\tProxy CSCF\nSIP\tSession Initiation Protocol\nSLF\tServer Locator Function\nS-CSCF\tServing CSCF\nWAF\tWebRTC Authentication Function\nWWSF\tWebRTC Web Server Function",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_4",
      "section_id": "4",
      "section_title": "Main Concept",
      "content": "This document presents the Cx interface related functional requirements of the communicating entities.\nIt gives a functional classification of the procedures and describes the procedures and message parameters.\nError handling flows, protocol version identification, etc. procedures are also included.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_5",
      "section_id": "5",
      "section_title": "General Architecture",
      "content": "This clause further specifies the architectural assumptions associated with the Cx reference point, building on  TS 23.228 [1] and also the Px reference point building upon  TS 23.141 [10].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.228",
        "ts_23.141"
      ]
    },
    {
      "chunk_id": "ts_29.228_5.1.1",
      "section_id": "5.1.1",
      "section_title": "Functional requirements of P-CSCF",
      "content": "There is no requirement for the interaction between the P-CSCF and the HSS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_5.1.2",
      "section_id": "5.1.2",
      "section_title": "Functional requirements of I-CSCF",
      "content": "The I-CSCF communicates with the HSS over the Cx interface.\nFor functionality of the I-CSCF refer to  TS 23.002 [4].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002"
      ]
    },
    {
      "chunk_id": "ts_29.228_5.1.3",
      "section_id": "5.1.3",
      "section_title": "Functional requirements of S-CSCF",
      "content": "The S-CSCF communicates with the HSS over the Cx interface.\nFor functionality of the S-CSCF refer to  TS 23.002 [4].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002"
      ]
    },
    {
      "chunk_id": "ts_29.228_5.1.4",
      "section_id": "5.1.4",
      "section_title": "Functional requirements of HSS",
      "content": "The HSS communicates with the I-CSCF and the S-CSCF over the Cx interface.\nFor functionality of the HSS refer to  TS 23.002 [4].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002"
      ]
    },
    {
      "chunk_id": "ts_29.228_5.1.5",
      "section_id": "5.1.5",
      "section_title": "Functional classification of Cx interface procedures",
      "content": "Operations on the Cx interface are classified in functional groups:\n1.\tLocation management procedures\n-\tThe operations regarding registration and de-registration.\n-\tLocation retrieval operation.\n2.\tUser data handling procedures\n-\tThe download of user information during registration and to support recovery mechanisms.\n-\tOperations to support the updating of user data and recovery mechanisms.\n3.\tUser authentication procedures\n4.\tIMS Restoration Procedures (see  TS 23.380 [19]) to support S-CSCF service interruption",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.228_5.1.6",
      "section_id": "5.1.6",
      "section_title": "Functional Requirements of the Presentity Presence Proxy",
      "content": "The interaction between the Presentity Presence Proxy and the HSS, referred to as the Px interface, is handled using the mechanisms defined for the Cx interface.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6",
      "section_id": "6",
      "section_title": "Procedure Descriptions",
      "content": "In the tables that describe the Information Elements transported by each command, each Information Element is marked as (M) Mandatory, (C) Conditional or (O) Optional in the Category \"Cat.\" column. The application level specification overrides the ABNF defining the presence of the AVPs to be included in the Diameter commands. The category defined by the Information Element table shall always be the same, i.e. Optional; or more restrictive, i.e. Mandatory or Conditional, than the presence requirements defined by the ABNF syntax, e.g. a required AVP in the ABNF shall not be overridden by an Optional IE but an Optional AVP in the ABNF may be overridden by the Mandatory or Conditional IE Category.\n-\tA mandatory Information Element shall always be present in the command. If this Information Element is absent, an application error occurs at the receiver and an answer message shall be sent back to the originator of the request with the Result-Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP containing the missing Information Element i.e. the corresponding Diameter AVP defined by the AVP Code and the other fields set as expected for this Information Element.\n-\tA conditional Information Element (marked as (C) in the table) shall be present in the command if certain conditions are fulfilled.\n-\tIf the receiver detects that those conditions are fulfilled and the Information Element is absent, an application error occurs and an answer message shall be sent back to the originator of the request with the Result-Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP AVP containing the missing Information Element i.e. the corresponding Diameter AVP defined by the AVP Code and the other fields set as expected for this Information Element.\n-\tIf those conditions are not fulfilled, the Information Element shall be absent. If however this Information Element appears in the message, it shall not cause an application error and it may be ignored by the receiver if this is not explicitly defined as an error case. Otherwise, an application error occurs at the receiver and an answer message with the Result-Code set to DIAMETER_AVP_NOT_ALLOWED shall be sent back to the originator of the request. A Failed-AVP AVP containing a copy of the corresponding Diameter AVP shall be included in this message.\n-\tAn optional Information Element (marked as (O) in the table) may be present or absent in the command, at the discretion of the application at the sending entity. Absence or presence of this Information Element shall not cause an application error and may be ignored by the receiver.\nWhen a procedure is required to determine whether two S-CSCF names are equal, the rules for SIP URI comparison specified in RFC 3261 clause 19.1.4 shall apply.\nWhen a procedure is required to determine the Public Identity used for an identity lookup in HSS and SLF, the HSS and SLF shall use the Public Identity from the SIP URI or Tel URI as contained in the Public-Identity AVP that is in canonical form as described by  TS 23.003 [17].\nUnknown permanent failure error codes shall be treated in the same way as DIAMETER_UNABLE_TO_COMPLY. For unknown transient failure error codes the request may be repeated, or handled in the same way as DIAMETER_UNABLE_TO_COMPLY.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_19.1.4",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.1",
      "section_id": "6.1.1",
      "section_title": "User registration status query",
      "content": "This procedure is used between the I-CSCF and the HSS during SIP registrations. The procedure is invoked by the I-CSCF, corresponds to the combination of the functional level operations Cx-Query and Cx-Select-Pull (see  TS 23.228 [1]) and is used:\n-\tTo authorize the registration of the distinct Public User Identity, checking multimedia subsystem access permissions and roaming agreements.\n-\tTo perform a first security check, determining whether the distinct Public User Identity in the message is associated with the Private User Identity sent in the message.\n-\tTo obtain either the S-CSCF where the distinct Public User Identity is registered or unregistered (i.e. registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored), or the list of capabilities that the S-CSCF has to support.\nThis procedure is mapped to the commands User-Authorization-Request/Answer in the Diameter application specified in  TS 29.229 [5]. Tables 6.1.1.1 and 6.1.1.2 detail the involved information elements.\nTable 6.1.1.1: User registration status query\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPublic User Identity\n(See 7.2)\nPublic-Identity\nM\nPublic User Identity to be registered\nVisited Network Identifier\n(See 7.1)\nVisited-Network-Identifier\nM\nIdentifier that allows the home network to identify the visited network\nType of Authorization\n(See 7.14)\nUser-Authorization-Type\nC\nType of authorization requested by the I-CSCF.\nIf the request corresponds to a de-registration, i.e. Expires field or expires parameter in Contact field in the REGISTER method is equal to zero, this AVP shall be present in the command and the value shall be set to DE-REGISTRATION.\nIf the request corresponds to an initial registration or a re-registration, i.e. Expires field or expires parameter in Contact field in the REGISTER method is not equal to zero then this AVP may be absent from the command. If present its value shall be set to REGISTRATION.\nIf the request corresponds to an initial registration or a re-registration or a de-registration and the I-CSCF explicitly queries the S-CSCF capabilities, then this AVP shall be present in the command and the value shall be set to REGISTRATION_AND_CAPABILITIES. The I-CSCF shall use this value when the S-CSCF currently assigned to the Public User Identity in the HSS, cannot be contacted and a new S-CSCF needs to be selected. The I-CSCF shall also use this value for RLOS related registrations when the S-CSCF currently assigned to the Public User Identity in the HSS does not support RLOS (see 3GPP TS 23.228 [1] annex Z) and a new S-CSCF (supporting RLOS) needs to be selected. RLOS support of the different S-CSCFs shall be locally configured in the I-CSCF, and this capability is independent on the subscribed capabilities received from HSS.\nPrivate User Identity\n(See 7.3)\nUser-Name\nM\nPrivate User Identity\nRouting Information (See 7.13)\nDestination-Host, Destination-Realm\nC\nIf the I-CSCF knows HSS name Destination-Host AVP shall be present in the command. Otherwise, only Destination-Realm AVP shall be present and the command shall be routed to the next Diameter node, e.g. SLF, based on the Diameter routing table in the I-CSCF.\nUAR Flags\n(See 7.19)\nUAR-Flags\nO\nThis Information Element contains a set of indications. See 7.19 for the content of the information element.\nTable 6.1.1.2: User registration status response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\n(See 7.6)\nResult-Code / Experimental-Result\nM\nResult of the operation.\nResult-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nS-CSCF capabilities\n(See 7.5)\nServer-Capabilities\nO\nRequired capabilities of the S-CSCF to be assigned to the IMS Subscription.\nS-CSCF Name\n(See 7.4)\nServer-Name\nC\nName of the assigned S‑CSCF.",
      "chunk_type": "general",
      "cross_references": [
        "table_6.1.1.1",
        "table_6.1.1.2",
        "ts_23.228",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.1.1",
      "section_id": "6.1.1.1",
      "section_title": "Detailed behaviour",
      "content": "The HSS shall, in the following order (if there is an error in any of the following steps the HSS shall stop processing and return the corresponding error code, see  TS 29.229 [5]):\n0.\tIf the HSS supports WebRTC as described in  TS 23.228 [1] clause U.2.1.4, it shall check if the Private User Identity and the Public User Identity are managed by a third party, if so the HSS continues in step 4.\nNOTE :\tHow the HSS identifies that the Private User Identity and the Public User Identity are managed by a third party for WebRTC and how the HSS identifies the corresponding user profile are implementation specific.\n1.\tCheck that the Private User Identity and the Public User Identity exists in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tCheck that the Public User Identity matches a distinct Public User Identity in the HSS. If it doesn't, the Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n3.\tCheck that the Public User Identity received in the request is associated with the Private User Identity received in the request. If not Experimental-Result-Code shall be set to DIAMETER_ERROR _IDENTITIES_DONT_MATCH.\n4.\tCheck whether the Public User Identity received in the request is barred from the establishment of multimedia sessions.\n-\tIf it is an IMS Emergency Registration (by checking the UAR Flags) or the Public User Identity received in the request is not barred, continue to step 5.\n-\tOtherwise, the HSS shall check whether there are other non-barred Public User Identities to be implicitly registered with that one.\n-\tIf so, continue to step 5.\n-\tIf not, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n5.\tCheck the User-Authorization-Type received in the request:\n-\tIf it is REGISTRATION or if User-Authorization-Type is absent from the request, the HSS shall check whether the UAR Flags indicate that this is an IMS Emergency Registration:\n-\tIf it is not, and the Public User Identity is allowed to roam in the visited network (if not Experimental-Result-Code shall be set to DIAMETER_ERROR _ROAMING_NOT_ALLOWED) and authorized to register (if not Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED) then continue to step 6.\n-\tIf it is an IMS Emergency Registration, authorization shall be granted and the HSS shall not perform any check regarding roaming. Continue to step 6.\n-\tIf it is DE_REGISTRATION, the HSS may not perform any check regarding roaming. Continue to step 6.\n-\tIf it is REGISTRATION_AND_CAPABILITIES, the HSS shall check whether the UAR Flags indicate that this is an IMS Emergency Registration:\n-\tIf it is not, and the Public User Identity is allowed to roam in the visited network (if not Experimental-Result-Code shall be set to DIAMETER_ERROR _ROAMING_NOT_ALLOWED) and authorized to register (if not Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED). The HSS may return the Server-Capabilities AVP, which enables the I-CSCF to select an S-CSCF. The returned capabilities, if any, shall satisfy all the requirements of all the service profiles associated with the IMS Subscription. If Server-Capabilities AVP is absent, it indicates to the I-CSCF that it can select any available S-CSCF. If an S-CSCF is already assigned in the HSS and IMS Restoration Procedures are supported in the HSS, the HSS shall set the S-CSCF reassignment pending flag and shall allow overwriting of the S-CSCF name in the next SAR request. Result-Code shall be set to DIAMETER_SUCCESS. The HSS shall not return any S-CSCF name. Stop processing.\n-\tIf it is an IMS Emergency Registration, authorization shall be granted and the HSS shall not perform any check regarding roaming. The HSS may return the Server-Capabilities AVP, which enables the I-CSCF to select an S-CSCF. The returned capabilities, if any, shall satisfy all the requirements of all the service profiles associated with the IMS Subscription. The Server-Capabilities AVP may be absent, to indicate to the I-CSCF that it can select any available S-CSCF. Result-Code shall be set to DIAMETER_SUCCESS. The HSS shall not return any S-CSCF name. Stop processing.\n6.\tCheck the state of the Public User Identity received in the request:\n-\tIf it is registered, the HSS shall return the stored S-CSCF name. No S-CSCF capabilities shall be present in the response. If User-Authorization-Type is equal to REGISTRATION or is absent, Experimental-Result-Code shall be set to DIAMETER_SUBSEQUENT_REGISTRATION. If User-Authorization-Type is equal to DE-REGISTRATION, Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it is unregistered (i.e. registered as a consequence of an originating or terminating request or there is an S-CSCF keeping the user profile stored) and User-Authorization-Type is equal to DE-REGISTRATION, the HSS shall return the stored S-CSCF name and the Result-Code shall be set to DIAMETER_SUCCESS. If the User-Authorization-Type is equal to REGISTRATION or is absent, then the HSS shall return the stored S-CSCF name and the Experimental-Result-Code set to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF capabilities.\n-\tIf it is not registered yet, the HSS shall check the value of User-Authorization-Type received in the request:\n-\tIf the value of User-Authorization-Type is DE_REGISTRATION and the Authentication pending flag is set, the HSS shall return the stored S-CSCF name and Experimental-Result-Code set to DIAMETER_SUCCESS. The HSS shall not return any S-CSCF capabilities. Otherwise, if Authentication pending flag is not set,  the HSS shall not return any S-CSCF name or S-CSCF capabilities. The HSS shall set the Experimental-Result-Code to DIAMETER_ERROR_IDENTITY_NOT_REGISTERED in the response.\n-\tIf the value of User-Authorization-Type is REGISTRATION or is absent, then the HSS shall check if there is at least one Public User Identity within the IMS Subscription with an S-CSCF name assigned.\n-\tIf there is at least one Public User Identity within the IMS Subscription that is registered, the HSS shall return the S-CSCF name assigned for that Public User Identity and Experimental-Result-Code set to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF capabilities.\n-\tIf there is at least one Public User Identity within the IMS Subscription that is unregistered (i.e registered as a consequence of an originating or terminating request or there is an S-CSCF keeping the user profile stored), then the HSS shall return the stored S-CSCF name and the Experimental-Result-Code set to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF capabilities.\n-\tIf there is no identity of the user within the same IMS Subscription that is registered or unregistered, the HSS shall check if there is an S-CSCF name stored for the user (e.g. the user is being authenticated by the S-CSCF as indicated by the Authentication pending flag). If it is, the HSS shall return the stored S-CSCF name and Experimental-Result-Code set to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF capabilities.\n-\tIf there is not any Public User Identity within the IMS Subscription with an S-CSCF name assigned, then the HSS may return the Server-Capabilities AVP, which enables the I-CSCF to select an S-CSCF. The returned capabilities, if any, shall satisfy all the requirements of all the service profiles associated with the IMS Subscription. The Server-Capabilities AVP may be absent, to indicate to the I-CSCF that it may select any available S-CSCF. Experimental-Result-Code shall be set to DIAMETER_FIRST_REGISTRATION. The HSS shall not return any S-CSCF name.\nIf the HSS cannot fulfil received request, e.g. due to database error, it shall set Result-Code to DIAMETER_UNABLE_TO_COMPLY. No S-CSCF name or S-CSCF capabilities shall be present in the response.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.2",
      "section_id": "6.1.2",
      "section_title": "S-CSCF registration/deregistration notification",
      "content": "This procedure is used between the S-CSCF and the HSS. The procedure is invoked by the S-CSCF, corresponds to the combination of the operations Cx-Put and Cx-Pull (see  TS 23.228 [1]) and is used:\n-\tTo assign an S-CSCF to a Public Identity, or to clear the name of the S-CSCF assigned to one or more Public Identities.\n-\tTo download from HSS the relevant user information for the S-CSCF.\n-\tTo backup and retrieve the S-CSCF Restoration Information (see  TS 23.380 [19]) in the HSS.\n-\tTo provide a P-CSCF Restoration Indication, and optionally, the address of the failed P-CSCF, to the HSS and trigger P-CSCF Restoration mechanism.\nThis procedure is mapped to the commands Server-Assignment-Request/Answer in the Diameter application specified in  TS 29.229 [5]. Tables 6.1.2.1 and 6.1.2.2 describe the involved information elements.\nTable 6.1.2.1: S-CSCF registration/deregistration notification request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPublic User Identity / Public Service Identity\n(See 7.2 and 7.2a)\nPublic-Identity\nC\nPublic Identity or list of Public Identities.\nOne and only one Public Identity shall be present if the Server-Assignment-Type is any value other than TIMEOUT_DEREGISTRATION, USER_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA, TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME, USER_DEREGISTRATION_STORE_SERVER_NAME or ADMINISTRATIVE_DEREGISTRATION.\nIf Server-Assignment-Type indicates deregistration of some type and Private Identity is not present in the request, at least one Public Identity shall be present.\nS-CSCF Name\n(See 7.4)\nServer-Name\nM\nName of the S-CSCF.\nPrivate User Identity / Private Service Identity\n(See 7.3 and 7.3a)\nUser-Name\nC\nPrivate Identity.\nIt shall be present if it is available when the S-CSCF issues the request.\nIt may be absent during the initiation of a session to an unregistered Public Identity (Server-Assignment-Type shall contain the value UNREGISTERED_USER) or after S-CSCF recovery upon originating request different than REGISTER (Server-Assignment-Type shall contain the value NO_ASSIGNMENT).\nIn case of de-registration, Server-Assignment-Type equal to TIMEOUT_DEREGISTRATION, ADMINISTRATIVE_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME if no Public-Identity AVPs are present then User-Name AVP shall be present.\nServer Assignment Type\n(See 7.8)\nServer-Assignment-Type\nM\nType of update, request or notification that the S-CSCF requests in the HSS (e.g: de-registration). See 3GPP TS 29.229 [5] for all the possible values.\nUser Data Already Available\n(See 7.16)\nUser-Data-Already-Available\nM\nThis indicates if the user profile and charging information and, if supported and present in the subscription, allowed WAF and/or WWSF identities are already available in the S-CSCF.\nIn the case where Server-Assignment-Type is not equal to NO_ASSIGNMENT, REGISTRATION, RE_REGISTRATION or UNREGISTERED_USER, the HSS shall not use User Data Already Available when processing the request.\nRouting Information (See 7.13)\nDestination-Host\nC\nIf the S-CSCF knows the HSS name, the Destination-Host AVP shall be present in the command.\nThis information is available if the request belongs to an already existing registration, e.g. in case of the re-registration, where the HSS name is stored in the S-CSCF. The HSS name is obtained from the Origin-Host AVP, which is received from the HSS, e.g. included in the MAA command.\nThis information may not be available if the command is sent as a consequence of a session termination for an unregistered Public Identity. In this case the Destination-Host AVP is not present and the command is routed to the next Diameter node, e.g. SLF, based on the Diameter routing table in the S-CSCF.\nWildcarded Public Identity (See 7.2b)\nWildcarded-Public-Identity\nO\nIf the request refers to a Wildcarded PSI or Wildcarded Public User Identity, and the Server-Asignment-Type is set to UNREGISTERED_USER, NO_ASSIGNMENT, TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME, ADMINISTRATIVE_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or TIMEOUT_DEREGISTRATION, the S-CSCF may include the corresponding Wildcarded PSI or Wildcarded Public User Identity in this information element.\nIf this element is present, it shall be used by the HSS to identify the identity affected by the request.  The terms Public Identity or Public Service Identity in the detailed behaviour refer then to the Wildcarded Public Identity.\nS-CSCF Restoration Information (See 7.21)\nSCSCF-Restoration-Info\nC\nWhen the S-CSCF supports IMS Restoration Procedures, if Server-Assignment-Type is REGISTRATION or RE_REGISTRATION, and any of the related restoration information changed compared to the previous one, the S-CSCF shall send this information element to the HSS. This information allows a later retrieval in case of an S-CSCF service interruption.\nMultiple-Registration-Indication\n(See 7.23)\nMultiple-Registration-Indication\nC\nWhen the S-CSCF supports IMS Restoration Procedures, if Server-Assignment-Type is REGISTRATION and the registration is a multiple registration and the Public User Identity is not stored as registered with the Private User Identity as in the request in the S-CSCF, the S-CSCF shall send this information element to the HSS.\nSession-Priority\n(See 7.24)\nSession-Priority\nO\nThis information element, if present, shall indicate the session's priority to the HSS.\nSAR Flags\n(See 7.28)\nSAR-Flags\nO\nThis Information Element contains a set of indications. See 7.28 for the content of the information element.\nFailed P-CSCF\nFailed-PCSCF\nO\nIf present, this Information Element shall contain the address (FQDN and/or IP addresses) of a failed P-CSCF; it shall only be included if the SAR Flags IE contains the \"P-CSCF Restoration Indication\" (see clause 7.28).\nTable 6.1.2.2: S-CSCF registration/deregistration notification response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPrivate User Identity / Private Service Identity\n(See 7.3 and 7.3a)\nUser-Name\nC\nPrivate Identity.\nIt shall be present if it is available when the HSS sends the response.\nIt may be absent in the following error case: when the Server-Assignment-Type of the request is UNREGISTERED_USER and the received Public Identity is not known by the HSS.\nRegistration result\n(See 7.6)\nResult-Code / Experimental-Result\nM\nResult of registration.\nResult-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nUser Profile\n(See 7.7)\nUser-Data\nC\nRelevant user profile.\nIt shall be present when Server-Assignment-Type in the request is equal to NO_ASSIGNMENT, REGISTRATION, RE_REGISTRATION or UNREGISTERED_USER according to the rules defined in clause 6.6.\nIf the S-CSCF receives more data than it is prepared to accept, it shall perform the de-registration of the Private Identity with Server-Assignment-Type set to DEREGISTRATION_TOO_MUCH_DATA and send back a SIP 3xx or 480 (Temporarily Unavailable) response, which shall trigger the selection of a new S-CSCF by the I-CSCF, as specified in 3GPP TS 24.229 [8].\nCharging Information (See 7.12)\nCharging-Information\nC\nAddresses of the charging functions.\nIt shall be present when the User-Data AVP is sent to the S-CSCF according to the rules defined in clause 6.6.\nWhen this parameter is included, either the Primary-Charging-Collection-Function-Name AVP or the Primary-Event-Charging-Function-Name AVP shall be included. All other elements shall be included if they are available.\nAssociated Private Identities\nAssociated-Identities\nO\nThis AVP contains all Private Identities, which belong to the same IMS subscription as the Private Identity or Public Identity received in the SAR command.\nIf the IMS subscription contains only single Private Identity this AVP shall not be present.\nLoose-Route Indication\nLoose-Route-Indication\nC\nThis AVP indicates to the S-CSCF that loose-route mechanism shall be applied to the public identities contained in the user profile received from the HSS.\nIf the loose-route mechanism is required, this AVP shall be present and set to LOOSE_ROUTE_REQUIRED.\nIf the Loose-Route mechanism is not required, this AVP may be either absent or present. If present, it shall be set to LOOSE_ROUTE_NOT_REQUIRED.\nS-CSCF Restoration Information (See 7.21)\nSCSCF-Restoration-Info\nC\nThis information shall be present if it was stored by the S-CSCF in the HSS and Server-Assignment-Type is either UNREGISTERED_USER or NO_ASSIGNMENT.\nThis information shall also be present if it was stored by the S-CSCF in the HSS and the SAR indicates it is related to a multiple registration and Server-Assignment-Type is REGISTRATION.\nThis information may be present if it was stored by the S-CSCF in the HSS and Server-Assignment-Type is either REGISTRATION or RE-REGISTRATION and there are other Private Identities different from the Private Identity received in the SAR command being registered with the Public Identity received in the SAR command.\nAssociated Registered Private Identities\n(See 7.22)\nAssociated-Registered-Identities\nC\nThis AVP contains all Private Identities that were registered with the Public Identity received in the SAR command.\nThe HSS shall send this information element if the IMS Restoration Procedures are supported and the value of Server-Assignment-Type in the request is REGISTRATION or RE_REGISTRATION and there are other Private Identities different from the Private Identity received in the SAR command being registered with the Public Identity received in the SAR command.\nOtherwise, this AVP shall not be present.\nS-CSCF Name\n(See 7.4)\nServer-Name\nC\nName of the assigned S-CSCF.\nThis AVP shall be present, if the requesting S-CSCF name is different from the previously assigned S-CSCF name stored in the HSS.\nWildcarded Public Identity (See 7.2b)\nWildcarded-Public-Identity\nC\nThis AVP shall be present if:\n-\tthe value of Server-Assignment-Type in the request was UNREGISTERED_USER or NO_ASSIGNMENT and\n-\tthe Wildcarded-Public-Identity AVP in the request was not present and\n-\tthe Public Identity in the request fell within the range of a Wildcarded Public User Identity in the HSS whose state is registered/unregistered.\nIf this element is present, it shall be used by the S-CSCF to identify the identity affected by the request.\nPriviledged-Sender Indication\n(See 7.26)\nPriviledged-Sender-Indication\nO\nThis AVP indicates if the Private User Identity shall be considered as a priviledged sender.\nIf not present, it means that the Private User Identity is not considered a priviledged sender.\nAllowed WAF and/or WWSF Identities (See 7.29)\nAllowed-WAF-WWSF-Identities\nC\nAddresses of the WAFs and/or WWSFs the subscription is allowing to use. This AVP shall be present if both\na) it is applicable for the subscription and \tb) the User-Data AVP is present.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.28",
        "clause_6.6",
        "table_6.1.2.1",
        "table_6.1.2.2",
        "ts_23.228",
        "ts_23.380",
        "ts_29.229",
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.2.1",
      "section_id": "6.1.2.1",
      "section_title": "Detailed behaviour",
      "content": "On registering/deregistering a Public Identity the S-CSCF shall inform the HSS. The same procedure is used by the S-CSCF:\n-\tto get the user information which contains the user profile, the charging information and the allowed WAF and/or WWSF Identities. The relevant user profile downloaded is described in more detailed in clauses 6.5.1 and 6.6.\n-\tto provide a P-CSCF Restoration Indication to the HSS when the S-CSCF, supporting the HSS based P-CSCF restoration mechanism described in  TS 23.380 [19], has identified a P-CSCF failure for a given UE and then triggers the P-CSCF Restoration mechanism execution for this UE.\nThe Public-Identity AVP and User-Data AVPs in this command pair shall contain only one type of identities i.e. either only Public User Identities, or only Public Service Identities. User initiated registration/deregistration procedures (i.e. server-assignment-type is set to RE_REGISTRATION, USER_DEREGISTRATION, etc.)  shall only be allowed for distinct Public User Identities.\nThe HSS holds information about the state of registration of all the identities related to an IMS Subscription. The S-CSCF uses this procedure to update such states. For Shared Public User Identities, the S-CSCF shall initiate this procedure towards the HSS for each Private User Identity undergoing a Registration or Deregistration related to the Shared Public User Identity. For implicitly registered identities, the rules defined in Clause 6.5.1 shall apply.\nWhen the request message was received because of a terminating session request, the HSS may prioritise the received request message according to priority level received within the Session-Priority AVP.\nNOTE 1:\tRefer to Annex J for HSS procedures associated with the handling of both the Session-Priority AVP and DRMP AVP received in the request message.\nThe HSS shall, in the following order (in case of an error in any of the steps the HSS shall stop processing and return the corresponding error code, see  TS 29.229 [5]):\n1.\tCheck that the Public Identity and Private Identity exist in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tThe HSS may check whether the Private and Public Identities received in the request are associated in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n3.\tIf more than one Public-Identity AVP is present and the Server-Assignment-Type is one of the values defined in Table 6.1.2.1 as applying for only one identity, then the Result Code shall be set to DIAMETER_AVP_OCCURS_TOO_MANY_TIMES and no user information shall be returned.\n4.\tThe HSS shall check the Public Identity type received in the request.\n-\tIf the identity in the request is a distinct Public User Identity, continue in step 5, otherwise the HSS shall check the server-assignment-type:\nIf  it indicates REGISTRATION, RE_REGISTRATION, USER_DEREGISTRATION, USER_DEREGISTRATION_STORE_SERVER_NAME, AUTHENTICATION_FAILURE or AUTHENTICATION_TIMEOUT, Experimental-Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.\n-\tIf the identity in the request is a Public Service Identity, then check if the PSI Activation State for that identity is active.  If not, then the response shall contain Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n5.\tCheck the Server Assignment Type value received in the request:\n-\tIf it indicates REGISTRATION or RE_REGISTRATION, the HSS shall check whether the Public Identity is assigned for the S-CSCF requesting the data.\nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF, and IMS restoration procedures are not supported or the S-CSCF reassignment pending flag is not set, the HSS shall include the name of the previously assigned S-CSCF in the response message and the Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\nIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF and IMS restoration procedures are supported, and the S-CSCF reassignment pending flag is set, the HSS shall overwrite the S-CSCF name and shall reset the S-CSCF reassignment pending flag.\nIf there is no S-CSCF assigned to the user or the requesting S-CSCF is the same as the previously assigned S-CSCF stored in the HSS, the HSS shall download the relevant user information taking into consideration the value set in the User-Data-Already-Available AVP (see clause 6.6). The Result-Code shall be set to DIAMETER_SUCCESS and the HSS shall set the registration state of the Public User Identity as registered (if not already registered). If the S-CSCF Restoration Information is included in the request and the HSS implements IMS Restoration procedures, and if it is RE_REGISTRATION, the HSS shall store this information. If the Public User Identity's authentication pending flag which is specific for the Private User Identity is set, the HSS shall clear it. If there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription. If the loose-route mechanism is required for the registered Public User Identities, the Loose-Route-Indication AVP shall be added to the answer message. If there are multiple Private User Identities being registered with the Public Identity received in the request message, and the IMS Restoration Procedures are supported in the HSS, the Associated-Registered-Identities AVP shall be added to the answer message and it shall contain all Private User Identities being registered with the Public Identity, and subject to the operator policy, the HSS may include all stored S-CSCF Restoration Information groups associated to the Private User Identities in the response.\nNOTE 2:\tIf the HSS returns all the S-CSCF Restoration Information groups in the response, the S-CSCF can ignore the Associated-Registered-Identities AVP and skip additional Server-Assignment-Request since the information is already made available.\nIf it is REGISTRATION and the HSS implements IMS Restoration procedures, if multiple registration indication is included in the request and the Public User Identity is stored as registered in the HSS, and there is restoration information related to the Private User Identity, the HSS shall not overwrite the stored S-CSCF Restoration Information, instead, it shall send the stored S-CSCF restoration information together with the user profile in the SAA. Subject to the operator policy, if there is S-CSCF Restoration Information associated with several Private User Identities, the HSS may include all the S-CSCF Restoration Information groups in the response. The Experimental-Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. Otherwise, the HSS shall store the received S-CSCF restoration information. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it indicates UNREGISTERED_USER, the following applies.\nIf the P-CSCF-Restoration-Indication is included in SAR-Flags AVP, the HSS supporting the P-CSCF-Restoration-mechanism feature shall check whether at least one of the serving node(s) for corresponding user support this feature. If none of the serving nodes support the feature, the HSS shall stop processing this request and the Result-Code shall be set to DIAMETER_ERROR_SERVING_NODE_FEATURE_UNSUPPORTED.\nThe HSS shall check whether the Public Identity is assigned for the S-CSCF requesting the data:\n-\tIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF, and IMS restoration procedures are not supported or the S-CSCF reassignment pending flag is not set and a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP, the HSS shall include the name of the previously assigned S-CSCF in the response message and the Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\n-\tIf there is already an S-CSCF assigned to the user and the requesting S-CSCF is not the same as the previously assigned S-CSCF and IMS restoration procedures are supported, and the S-CSCF reassignment pending flag is set, the HSS shall overwrite the S-CSCF name and shall reset the S-CSCF reassignment pending flag.\n-\tIf there is no S-CSCF assigned to the user or the requesting S-CSCF is the same as the previously assigned S-CSCF stored in the HSS, the HSS shall store the S-CSCF name.\nThe HSS shall check the Public Identity registration state:\n-\tIf the registration state of the Public Identity is not registered or unregistered, the HSS shall set or keep the registration state of the Public Identity as unregistered, i.e. registered as a consequence of an originating or terminating request and if a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP download the relevant user information. The Result-Code shall be set to DIAMETER_SUCCESS. If there are multiple Private User Identities associated to the Public User Identity in the HSS, the HSS shall arbitrarily select one of the Private User Identities and put it into the response message.\n-\tIf the registration state of the Public Identity is registered and IMS restoration procedures are not supported, the HSS shall set the registration state of the Public identity as unregistered, clear any S-CSCF Restoration Information associated with the Public User Identity (if any) and if a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP download the relevant user information. The Result-Code shall be set to DIAMETER_SUCCESS. If there are multiple Private User Identities associated to the Public User Identity in the HSS, the HSS shall arbitrarily select one of the Private User Identities and put it into the response message.\nNOTE 3:\tThe case where S-CSCF Restoration Information is stored in the HSS even though IMS Restoration Procedures are not supported corresponds to the situation where the HSS supports IMS Restoration Procedures but a new assigned S-CSCF does not, while the former S-CSCF supported this feature.\n-\tIf the registration state of the Public Identity is registered and IMS restoration procedures are supported and a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP, the HSS shall include in the response all S-CSCF Restoration Information related with the Public User Identity. If there is S-CSCF Restoration Information associated with several Private User Identities, the HSS shall include all the S-CSCF Restoration Information groups in the response. The Experimental-Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.\n-\tIf the registration state of the Public Identity is Registered and IMS Restoration Procedures are supported and a P-CSCF-Restoration-Indication is included in SAR-Flags AVP, the HSS shall set the registration state of the Public identity as Unregistered and clear any S-CSCF Restoration Information associated with the Public User Identity (if any). The Result-Code shall be set to DIAMETER_SUCCESS.\nIf there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription.\nIf the S-CSCF receives a wildcarded public identity from the I-CSCF, the S-CSCF shall use this wildcarded public identity to fetch the user profile (i.e. by sending a Cx-SAR including Wildcarded-Public-Identity AVP if the profile is not available) and registration information locally stored.\nIf the S-CSCF does not receive a wildcarded public identity, the S-CSCF shall not perform wildcarded public identity matching and shall use the public identity received instead to fetch the user profile (i.e. by sending a Cx-SAR without including Wildcarded-Public-Identity AVP if the profile is not available) and registration information.\nNOTE 4:\tThere may be SIP requests in which the S-CSCF does not receive information of a wildcarded public identity, e.g. originating call from an AS on behalf of a user.\nNOTE 5:\tSince a distinct public identity falling into the range of a wildcarded public identity can have a different service profile, the S-CSCF does not perform the wildcarded public identity matching against the public identity received to avoid using the wrong service profile.\nIf the Wildcarded-Public-Identity AVP is not received and if the Public Identity falls within the range of a wildcarded public identity whose registration state is registered and a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP, the HSS shall not overwrite the registration state. The Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE and the HSS shall include the Wildcarded-Public-Identity AVP in the response. Upon reception of this error, the S-CSCF should behave as if it has received a wildcarded public identity in the first place.\nIf SAR-Flags AVP includes a P-CSCF-Restoration-Indication, the HSS supporting the P-CSCF-Restoration–mechanism feature shall send a P-CSCF restoration indication to the serving nodes where the IMSI associated to the received Private Identity is registered, i.e. SGSN and/or MME, using S6a/S6d IDR/IDA or Gr ISD request/answer as described in  TS 23.380 [19] clause 5.4. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it indicates TIMEOUT_DEREGISTRATION, USER_DEREGISTRATION, DEREGISTRATION_TOO_MUCH_DATA or ADMINISTRATIVE_DEREGISTRATION, the following applies.\nIf it indicates ADMINISTRATIVE_DEREGISTRATION and if the P-CSCF-Restoration-Indication is included in SAR-Flags AVP, the HSS supporting the P-CSCF-Restoration-mechanism feature shall check whether at least one of the serving node(s) for corresponding user support this feature. If none of the serving nodes support the feature, the HSS shall stop processing this request and the Result-Code shall be set to DIAMETER_ERROR_SERVING_NODE_FEATURE_UNSUPPORTED.\nThe HSS shall check the registration state for all the Public Identities in the request.\n-\tIf a Private User Identity is present in the request, if the request did not contain Public Identities the HSS shall check the registration state of the Public Identities associated with the Private Identity identified in the request. For each Public Identity:\n-\tIf the registration state of the Public User Identity is Registered, the HSS shall check if the Public User Identity is currently registered with one or more Private User Identities.\n-\tIf the Public User Identity is currently registered with only one Private User Identity, the HSS shall set the registration state of the Public User Identity to Not Registered and clear the S-CSCF name and any S-CSCF Restoration Information associated with the Public User Identity.\n-\tIf the Public User Identity is currently registered with more than one Private User Identity, the HSS shall keep the registration state of the Public User Identity as Registered and retain the S-CSCF name associated with the Public User Identity. The HSS shall remove any S-CSCF Restoration Information associated to the registration of this Public User Identity with this Private User Identity.\n-\tIf a Private User Identity is absent in the request, if the Public User Identity is currently registered with more than one Private User Identity, the HSS shall stop processing this request and shall set the Result-Code to DIAMETER_MISSING_AVP.\n-\tif the registration state of the Public Identity is Unregistered, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity.\nIn case of ADMINISTRATIVE_DEREGISTRATION, if SAR-Flags AVP includes a P-CSCF-Restoration-Indication, the HSS or combined HSS-UDM supporting the P-CSCF-Restoration-mechanism feature shall send a P-CSCF restoration indication to the serving nodes where the IMSI associated to the received Private Identity is registered, i.e. SGSN and/or MME, using S6a/S6d IDR/IDA or Gr ISD request/answer as described in  TS 23.380 [19] clause 5.4, and SMF and/or AMF, using the Nudm_UECM_P-CSCF-RestorationNotification service operation as described in  TS 23.380 [19] clause 5.8.4.\nThe Result-Code shall be set to DIAMETER_SUCCESS\n-\tIf it indicates TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME or USER_DEREGISTRATION_STORE_SERVER_NAME the HSS decides whether to keep the S-CSCF name associated to the Private User Identity stored or not for all the Public User Identities that the S-CSCF indicated in the request. If no Public User Identity is present in the request, the Private User Identity shall be present.\n-\tIf the HSS decides to keep the S-CSCF name stored the HSS shall keep the S-CSCF name stored for all the Public User Identities associated to the Private User Identity. The Result-Code shall be set to DIAMETER_SUCCESS.\nThe HSS shall check if each Public User Identity in the request is currently registered with one or more Private User Identities. If the request did not contain Public User Identities the HSS shall check if each Public User Identity associated with the Private User Identity in the request is currently registered with one or more Private User Identities. For each Public User Identity;-\n-\tIf only one Private User Identity associated with the Public User Identity is currently registered with the Public User Identity, the HSS shall set the registration state of the Public User Identity to Unregistered and clear any S-CSCF Restoration Information associated with the Public User Identity\n-\tIf more than one Private User Identity that shares that Public User Identity is currently registered with the Public User Identity the HSS shall keep the registration state of the Public User Identity as Registered. The HSS shall remove any S-CSCF Restoration Information associated to the registration of this Public User Identity with the Private User Identity in the request.\n-\tIf the HSS decides not to keep the S-CSCF name the Experimental-Result shall be set to DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED.\nThe HSS shall check if each Public User Identity in the request is currently registered with one or more Private User Identities. If the request did not contain Public User Identities the HSS shall check if each Public User Identity associated with the Private User Identity in the request is currently registered with one or more Private User Identities. For each Public User Identity;-\n-\tIf only one Private User Identity associated with the Public User Identity is currently registered with the Public User Identity, the HSS shall set the registration state of the Public User Identity to Not Registered and clear the S-CSCF name associated with Public User Identity.\n-\tIf more than one Private User Identity that shares that Public User Identity is currently registered with the Public User Identity the HSS shall keep the registration state of the Public User Identity as Registered.\n-\tIf it indicates NO_ASSIGNMENT, the HSS checks whether the Public Identity is assigned for the S-CSCF requesting the data. If the requesting S-CSCF is not the same as the assigned S-CSCF and the S-CSCF reassignment pending flag is not set, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY, otherwise the HSS shall download the relevant user information and the Result-Code shall be set to DIAMETER_SUCCESS. If relevant S-CSCF Restoration Information is stored in the HSS and IMS Restoration Procedures are supported, it shall be added to the answer message. If there is S-CSCF Restoration Information associated with several Private User Identities, the HSS shall include all the S-CSCF Restoration Information groups in the response. If there are multiple Private User Identities, which belong to the served IMS subscription the Associated-Identities AVP should be added to the answer message and it shall contain all Private User Identities associated to the IMS subscription.\nNOTE 6:\tthe check of the S-CSCF reassignment pending flag is needed since an S-CSCF supporting restoration procedures can receive a user initiated de-registration for a Public Identity for which it does not have any registration data (see  TS 23.380 [19]). In such case, the S-CSCF indicates NO_ASSIGNMENT in Server-Assignment-Type to retrieve any possible restoration information from the HSS.\n-\tIf it indicates AUTHENTICATION_FAILURE (e.g. there is a mismatch in IP-address secure binding information) or AUTHENTICATION_TIMEOUT (e.g. no response to Digest challenge), the HSS shall keep the registration state of the Public User Identity. The HSS shall check the registration state for the Public User Identity in the request and only if the registration state of the Public User Identity is Not Registered, the HSS shall clear the S-CSCF name associated with the Public User Identity.\nIf the Public User Identity's authentication pending flag which is specific for the Private User Identity is set, the HSS shall clear it. The Result-Code shall be set to DIAMETER_SUCCESS.\nIf the HSS cannot fulfil the received request, e.g. due to database error, it shall set the Result-Code to DIAMETER_UNABLE_TO_COMPLY. The HSS shall not modify any registration state nor download any Public Identity information to the S-CSCF.\nSee clause 8.1.2 and 8.1.3 for the description of the handling of the error situations: reception of an S-CSCF name different from the one stored in the HSS and reception of a Server-Assignment-Type value not compatible with the registration state of the Public Identity.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.5.1",
        "clause_6.6",
        "ts_23.380_clause_5.4",
        "ts_23.380_clause_5.8.4",
        "clause_8.1.2",
        "table_6.1.2.1",
        "ts_23.380",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.3",
      "section_id": "6.1.3",
      "section_title": "Network initiated de-registration by the HSS, administrative",
      "content": "In case of network initiated de-registration of by the HSS, the HSS change the state of the Public Identities to Not Registered and send a notification to the S-CSCF indicating the identities that shall be de-registered. The procedure is invoked by the HSS, corresponds to the functional level operation Cx-Deregister (see  TS 23.228 [1]).\nThis procedure is mapped to the commands Registration-Termination-Request/Answer in the Diameter application specified in  TS 29.229 [5]. Tables 6.1.3.1 and 6.1.3.2 describe the involved information elements.\nTable 6.1.3.1: Network Initiated Deregistration by HSS request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPublic User Identity / Public Service Identity\n(See 7.2 and 7.2a)\nPublic-Identity\nC\nIt contains the list of Public Identities that are de-registered, in the form of SIP URL or TEL URL.\nPublic-Identity AVP shall be present if the de-registration reason code is NEW_SERVER_ASSIGNED. It may be present with the other reason codes.\nPrivate User Identity / Private Service Identity\n(See 7.3 and 7.3a)\nUser-Name\nM\nIt contains the Private Identity in the form of a NAI. The HSS shall always send a Private Identity that is known to the S-CSCF based on an earlier SAR/SAA procedure.\nReason for de-registration\n(See 7.11)\nDeregistration-Reason\nM\nThe HSS shall send to the S-CSCF a reason for the de-registration. The de-registration reason is composed of two parts: one textual message (if available) that is intended to be forwarded to the user that is de-registered, and one reason code (see 3GPP TS 29.229 [5]) that determines the behaviour of the S-CSCF\nRouting Information (See 7.13)\nDestination-Host\nM\nIt contains the name of the S-CSCF which originated the last update of the name of the multimedia server stored in the HSS for a given IMS Subscription. The address of the S-CSCF is the same as the Origin-Host AVP in the message sent from the S-CSCF.\nAssociated Private Identities\nAssociated-Identities\nO\nThis AVP contains Private Identities, which belong to the same IMS subscription as the Private Identity in the User-Name AVP and should be de-registered together with that one.\nIf the IMS subscription contains only a single Private Identity, this AVP shall not be present.\nRTR Flags\n(See 7.30)\nRTR-Flags\nO\nThis information element contains a bit mask.\nSee 7.30 for the meaning of the bits.\nTable 6.1.3.2: Network Initiated Deregistration by HSS response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\n(See 7.6)\nResult-Code / Experimental-Result\nM\nThis information element indicates the result of de-registration.\nResult-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nAssociated Private Identities\nAssociated-Identities\nC\nThis AVP shall be present if the S-CSCF de-registered more than one Private Identity with the request.  It contains all Private Identities that have been deregistered together with the one in the User-Name AVP of the request.\nIdentities with Emergency Registration\n(See 7.25)\nIdentity-with-Emergency-Registration\nC\nThis information element indicates a list of pairs of private and public user identities which have not been de-registered due to emergency registration.",
      "chunk_type": "general",
      "cross_references": [
        "table_6.1.3.1",
        "table_6.1.3.2",
        "ts_23.228",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.3.1",
      "section_id": "6.1.3.1",
      "section_title": "Detailed behaviour",
      "content": "The HSS shall de-register the affected identities and invoke this procedure to inform the S-CSCF. The S-CSCF shall remove all the information stored in the S-CSCF for the affected identities.\nThe HSS may de-register:\n-\tOne Public Identity or a list of Public Identities. HSS may include all Public User Identities associated with the User-Name AVP to the request. This option is applicable with all reason codes.\n-\tOne or more Private Identities of the IMS Subscription with all associated Public Identities. No Public-Identity AVPs shall be present in this case. This option is applicable with reason codes PERMANENT_TERMINATION, SERVER_CHANGE, and REMOVE_S-CSCF.\n-\tAll Public Service Identities that match a Wildcarded Public Service Identity.  In this case the HSS may send one of the Public Service Identities that was received in the Server Assignment Request for that Wildcarded Public Service Identity and the associated Private Service Identity.\n-\tA Wildcarded Public User Identity.  In this case the HSS shall send a distinct Public User Identity that belongs to the same implicit registration set as the Wildcarded Public User Identity and the associated Private User Identity.\nThe HSS shall send in the Deregistration-Reason AVP the reason for the de-registration, composed by a textual message (if available) aimed for the user and a reason code that determines the action the S-CSCF has to perform. The possible reason codes are:\n-\tPERMANENT_TERMINATION: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to the Public Identity and associated implicitly registered/unregistered Public Identities (if any) for the Private Identity(ies) indicated in the request (e.g. due to an IMS subscription cancellation, or modification, or a removal of IP-address secure binding information when GIBA is used). This reason also indicates that no other S-CSCF can be assigned.\nThe HSS shall check the registration state of the Public Identities. If no Public Identities are involved, the HSS shall check the registration state of the Public Identities associated with the Private User Identity identified. For each Public Identity:\n-\tIf the registration state of the Public Identity is Registered, the HSS shall check if the Public User Identity is currently registered with one or more Private User Identities.\n-\tIf the Public User Identity is currently registered with only one Private User Identity, the HSS shall check whether the Public User Identity is included in the information element Identities with Emergency Registrations returned by S-CSCF in the response.\n-\tIf included, the HSS shall keep the S-CSCF name associated with the Public User Identity and set the registration state of the Public User Identity to Unregistered.\n-\tIf not included, the HSS shall clear the S-CSCF name associated with the Public User Identity, and set the registration state of the Public User Identity to Not Registered  The S-CSCF initiates the de-registration of the Public User Identity unless it is emergency registered.\n-\tIf the Public User Identity is currently registered with more than one Private User Identity, the HSS shall keep the registration state of the Public User Identity as Registered and retain the S-CSCF name associated with the Public User Identity. The S-CSCF initiates the de-registration of the Public User Identity unless it is emergency registered.\n-\tIf the registration state of the Public Identity is Unregistered, the HSS shall check whether this Public User Identity is included in the information element Identities with Emergency Registrations returned by S-CSCF in the response.\n-\tIf included, the HSS shall keep the S-CSCF name associated with the Public User Identity.\n-\tIf not included, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity.\n-\tNEW_SERVER_ASSIGNED: The HSS indicates to the S-CSCF that a new S-CSCF has been allocated to the IMS Subscription e.g. because the previous assigned S-CSCF was unavailable during a registration procedure. The S-CSCF shall remove all information for all of the Public Identities indicated in the request.\n-\tSERVER_CHANGE: The HSS indicates to the S-CSCF that the de-registration is requested to force the selection of new S-CSCF to assign to the IMS Subscription (e.g. when the S-CSCF capabilities are changed in the HSS or when the S-CSCF indicates that it has not enough memory for the updated User Profile). The HSS shall set the registration state to \"Not Registered\" and clear the S-CSCF name for all of the Public Identities affected by the request. If the S-CSCF does not indicate in the response all the Private Identities that were in the request, the HSS shall repeat this request for each of the remaining Private Identities in the IMS Subscription that are known to the S-CSCF. The S-CSCF should start the network initiated de-registration towards the user, i.e. all registrations within the IMS Subscription are de-registered and the user is asked to re-register to all existing registrations.\n-\tREMOVE_S-CSCF: The HSS indicates to the S-CSCF that the S-CSCF will no longer be assigned to an unregistered Public Identity(ies) (i.e registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) for a given IMS Subscription.\nThe HSS shall check if an emergency registration exists in the S-CSCF, checking for each Public Identity contained in the request whether it is present in the information element Identities with Emergency Registrations returned by S-CSCF.\n-\tIf an emergency registration does not exist in S-CSCF, for each Public Identity contained within the request, the HSS shall set the registration state of the Public Identity to Not Registered and clear the S-CSCF name associated with the Public Identity. The S-CSCF shall remove all information related to the Public User Identity contained within the request.\n-\tIf an emergency registration exists in S-CSCF for one or more Public User Identities contained in the request, the S-CSCF should include the corresponding Private Identity /Public User Identity pairs in the information element Identities with Emergency Registrations in the answer. The HSS, when receiving such an answer, shall not change the registration state of the Public User Identities present in the information element Identities with Emergency Registrations and shall keep unchanged the S-CSCF name associated with these Public User Identities.\nPublic Identities which are emergency registered in the S-CSCF shall not be de-registered when a Cx-Deregistration request with a -reason code of PERMANENT_TERMINATION or REMOVE_S-CSCF is received from the HSS. In this case\n-\tif all to be de-registered identities are emergency registered, a Result-Code set to DIAMETER_UNABLE_TO_COMPLY and a list of Private / Public Identity pairs which are emergency registered shall be returned to the HSS\n-\tif a proper subset of the to be de-registered identities are emergency registered, a Result-Code of DIAMETER_LIMITED_SUCCESS and a list of Private Identity / Public Identity pairs which are emergency registered shall be returned to the HSS.\nNOTE 1:\tIf the Public Identity that is emergency registered has normal registration as well, then for the normal registration the S-CSCF will perform the detailed de-registration procedures towards the UE for each reason code as described in  TS 24.229 [8].\nNOTE 2:\tIt is assumed that Public Identities which are implicitly registered along with an emergency registration are also emergency registered.\nThe detailed de-registration procedures performed by the S-CSCF are described in  TS 24.229 [8].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.4",
      "section_id": "6.1.4",
      "section_title": "User location query",
      "content": "This procedure is used between the I-CSCF and the HSS to obtain the name of the S-CSCF assigned to a Public Identity, or the name of the AS hosting a PSI for direct routing. The procedure is invoked by the I-CSCF, is performed per Public Identity, and corresponds to the functional level operation Cx-Location-Query (see  TS 23.228 [1]).\nThis procedure is mapped to the commands Location Info Request/Answer in the Diameter application specified in  TS 29.229 [5]. Tables 6.1.4.1 and 6.1.4.2 detail the involved information elements.\nTable 6.1.4.1: User Location query\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPublic User Identity / Public Service Identity\n(See 7.2 and 7.2a)\nPublic-Identity\nM\nPublic Identity\nRouting information (See 7.13)\nDestination-Host, Destination-Realm\nC\nIf the I-CSCF knows HSS name Destination-Host AVP shall be present in the command. Otherwise, only Destination-Realm AVP shall be present and the command shall be routed to the next Diameter node, e.g. SLF, based on the Diameter routing table in the I-CSCF.\nOriginating Request\n(See 7.18)\nOriginating-Request\nO\nIt indicates that the request is related to an originating SIP message.\nType of Authorization\n(See 7.14)\nUser-Authorization-Type\nC\nThis information element shall be present and set to REGISTRATION_AND_CAPABILITIES by the I-CSCF if IMS Restoration Procedures are supported and the S-CSCF currently assigned to the Public User Identity in the HSS cannot be contacted.\nSession Priority\n(See 7.24)\nSession-Priority\nO\nThis information element, if present, shall indicate the session's priority to the HSS.\nTable 6.1.4.2: User Location response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\n(See 7.6)\nResult-Code / Experimental-Result\nM\nResult of the operation.\nResult-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nS-CSCF Name / AS name\n(See 7.4 and 7.4a)\nServer-Name\nC\nName of the assigned S-CSCF for basic IMS routing or the name of the AS for direct routing.\nS-CSCF capabilities\n(See 7.5)\nServer-Capabilities\nO\nIt contains the information to help the I-CSCF in the selection of the S-CSCF.\nWildcarded Public Identity (See 7.2b)\nWildcarded-Public-Identity\nO\nIf the requests refers to a Wildcarded PSI or Wildcarded Public User Identity (the Public Identity in the request matches a Wildcarded PSI or Wildcarded Public User Identity in the HSS), the HSS shall include the corresponding Wildcarded Public Identity in this information element.\nThe matching of distinct Public Identies takes precedence over the matching of wildcarded public identities.\nLIA Flags\n(See 7.27)\nLIA-Flags\nO\nThis information element contains a bit mask.\nSee 7.27 for the meaning of the bits.",
      "chunk_type": "general",
      "cross_references": [
        "table_6.1.4.1",
        "table_6.1.4.2",
        "ts_23.228",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.1.4.1",
      "section_id": "6.1.4.1",
      "section_title": "Detailed behaviour",
      "content": "The HSS may prioritise the received request message according to priority level received within the Session-Priority AVP.\nNOTE 1:\tRefer to Annex J for HSS procedures associated with the handling of both the Session-Priority AVP and DRMP AVP received in the request message.\nThe HSS shall, in the following order (if an error occurs in any of the ste\nThe HSS shall, in the following order (if an error occurs in any of the steps the HSS shall stop processing and return the corresponding error code, see  TS 29.229 [5]):\n1.\tCheck that the Public Identity is known. If not the Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tCheck the type of the Public Identity contained in the request:\n-\tIf this is a Public User Identity, continue to step 2a.\n-\tIf this is a Public Service Identity:\n-\tCheck if the PSI Activation State for that identity is active. If not, then the response shall contain Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n-\tCheck if the name of the AS hosting the Public Service Identity is stored in the HSS and that the request does not contain the Originating-Request AVP.\n-\tIf this is the case, if IMS Restoration Procedures are supported, the HSS shall check if User-Authorization-Type was received in the request, and if the value is REGISTRATION_AND_CAPABILITIES:\n-\tIf it is, the HSS shall reject the request with Result-Code set to DIAMETER_UNABLE_TO_COMPLY.\n-\tOtherwise, the HSS shall return the AS name and the Result-Code AVP shall be set to DIAMETER_SUCCESS. HSS may set PSI Direct Routing Indication bit in LIA-Flags AVP, then I-CSCF shall not perform IMS Restoration Procedures (see clause 4.3.3 in  TS 23.380 [19]).\n-\tOtherwise, continue to step 2a.\n2a.\tIf IMS Restoration procedures are supported, the HSS shall check if User-Authorization-Type was received in the request, and if the value is REGISTRATION_AND_CAPABILITIES:\n-\tIf it is, then the HSS may return the Server-Capabilities AVP. The returned capabilities, if any, shall satisfy all the requirements of all the service profiles associated with the IMS Subscription. If Server-Capabilities AVP is absent, it indicates to the I-CSCF that it can select any available S-CSCF. Also the HSS shall set the S-CSCF reassignment pending flag and allow overwriting of the S-CSCF name in the next SAR request, which enables the I-CSCF to select an S-CSCF. The Result-Code shall be set to DIAMETER_SUCCESS. The HSS shall not return any S-CSCF name. Stop processing.\n-\tOtherwise, continue to step 3.\n3.\tCheck the state of the Public Identity received in the request, and where necessary, check if the Public Identity has terminating services related to the unregistered state.\n-\tIf it is registered, the HSS shall return the stored S-CSCF name. The Server-Name AVP shall contain the SIP URI of the server. The Server-Capabilities AVP shall not be present. The Result-Code AVP shall be set to DIAMETER_SUCCESS.\n-\tIf it is unregistered (i.e. registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) the HSS shall return the S-CSCF name assigned for that Public Identity.  The Server-Name AVP shall contain the SIP URI of the server. The Server-Capabilities AVP shall not be present. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it is not registered, but either it has terminating services related to unregistered state or the request contains the Originating-Request AVP, the HSS shall check if there is at least one Public Identity within the IMS Subscription with an S-CSCF name assigned:\n-\tIf this is the case the HSS shall return the S-CSCF name assigned for that Public Identity. The Server-Name AVP shall contain the SIP URI of the server. The Server-Capabilities AVP shall not be present. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf there is not any S-CSCF name assigned to a Public Identity within the IMS Subscription, the HSS may return information about the required S-CSCF capabilities, which enables the I-CSCF to select an S-CSCF. The Server-Capabilities AVP may be present. The HSS shall send the same server capability set that is sent in the user registration status response during the registration. If Server-Capabilities AVP is not present, the I-CSCF shall understand that any S-CSCF is suitable for the IMS Subscription. The Server-Name AVP shall not be present. The Experimental-Result-Code shall be set to DIAMETER_UNREGISTERED_SERVICE.\n-\tIf it is not registered or unregistered, and the Public Identity has no terminating services related to the unregistered state and the request does not contain the Originating-Request AVP, the response shall contain Experimental-Result-Code set to DIAMETER_ERROR_IDENTITY_NOT_REGISTERED.\nIf the HSS cannot fulfil the received request, e.g. due to database error, it shall set Result-Code to DIAMETER_UNABLE_TO_COMPLY. No S-CSCF name or S-CSCF capabilities shall be present in the response.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.380_clause_4.3.3",
        "ts_29.229",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.2.1",
      "section_id": "6.2.1",
      "section_title": "User Profile download",
      "content": "As part of the registration procedure ( TS 23.228 [1]) S-CSCF obtains user data and service related information by means of the Cx-Put Resp operation (see 6.1.2).",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.2.2",
      "section_id": "6.2.2",
      "section_title": "HSS initiated update of User Information",
      "content": "This procedure is initiated by the HSS to update at least one of the following user information in S-CSCF:\n-\tUser profile information and/or\n-\tCharging information and/or\n-\tAllowed WAF and/or WWSF Identities and/or\n-\tSIP Digest authentication information in the S-CSCF.\nThis procedure shall not be used by the HSS to add, delete, or update the value of the IMSI.\nThis procedure corresponds to the functional level operation Cx-Update_Subscr_Data (see  TS 23.228 [1]).\nThis procedure is mapped to the commands Push-Profile-Request/Answer in the Diameter application specified in  TS 29.229 [5].  Tables 6.2.2.1 and 6.2.2.2 describe the involved information elements.\nTable 6.2.2.1: User Profile Update request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPrivate User Identity / Private Service Identity\n(See 7.3 and 7.3a)\nUser-Name\nM\nPrivate Identity.\nThe HSS shall always send a Private Identity that is known to the S-CSCF based on an earlier SAR/SAA procedure.\nUser profile\n(See 7.7)\nUser-Data\nC\nUpdated user profile (see clauses 6.5.2.1 and 6.6.1), with the format defined in clause 7.7.\nIt shall be present if the user profile is changed in the HSS. If the User-Data AVP is not present, the SIP-Auth-Data-Item or Charging-Information AVP or Allowed-WAF-WWSF-Identities AVP shall be present.\nAuthentication Data (See 7.9)\nSIP-Auth-Data-Item\nC\nSIP Digest authentication information.\nIt shall be present if the used authentication scheme is SIP Digest and when password change has occurred in the HSS.\nIf the SIP-Auth-Data-Item AVP is not present, the Charging-Information or User-Data AVP or Allowed-WAF-WWSF-Identities AVP shall be present.\nSee Table 6.3.6 for the contents of this information element.\nCharging Information (See 7.12)\nCharging-Information\nC\nAddresses of the charging functions.\nIt shall be present if the charging addresses are changed in the HSS. If the Charging-Information AVP is not present, the SIP-Auth-Data-Item or User-Data AVP or Allowed-WAF-WWSF-Identities AVP shall be present.\nWhen this parameter is included, either the Primary-Charging-Collection-Function-Name AVP or the Primary-Event-Charging-Function-Name AVP shall be included. All other charging information shall be included if it is available.\nRouting Information (See 7.13)\nDestination-Host\nM\nIt contains the name of the S-CSCF which originated the last update of the name of the multimedia server stored in the HSS for a given IMS Subscription. The address of the S-CSCF is the same as the Origin-Host AVP in the message sent from the S-CSCF.\nAllowed WAF and/or WWSF Identities (See 7.29)\nAllowed-WAF-WWSF-Identities\nC\nAddresses of the WAFs and/or WWSFs the subscription is allowing to use.\nIt shall be present if the allowed WAF and/or WWSF identities are changed in the HSS.\nTable 6.2.2.2: User Profile Update response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\n(See 7.6)\nResult-Code / Experimental-Result\nM\nThis information element indicates the result of the update of User Profile in the S-CSCF.\nResult-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nExperimental-Result AVP shall be used for Cx/Dx errors. This is a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.7",
        "table_6.2.2.1",
        "table_6.3.6",
        "table_6.2.2.2",
        "ts_23.228",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.2.2.1",
      "section_id": "6.2.2.1",
      "section_title": "Detailed behaviour",
      "content": "The HSS shall make use of this procedure to update the relevant user information to the S-CSCF. See clauses 6.5.2.1 and 6.6.1 for the rules of user profile updating. See clause 6.5.2.3 for the rules of Charging Information update. See clause 6.5.2.4 for the rules of SIP Digest Authentication Data update. See clause 6.5.2.5 for the rules of Allowed WAF and/or WWSF Identities update.\nIf there are multiple registered Private User Identities associated to the Public User Identity in the HSS, the HSS shall send only single request and select arbitrarily one of the Private User Identities and put it into the request. For updates of the profile of a Wildcarded Public Identity, the HSS shall send only one single request. That request shall contain the Wildcarded Public Identity.\nThe SIP-Auth-Data-Item AVP and/or Charging-Information AVP and/or the User-Data AVP shall be present in the request.\nIf the User-Data AVP is present in the request, the S-CSCF shall overwrite, for the Public Identities indicated in the User profile included in the request, current information with the information received from the HSS, except in the error situations detailed in table 6.2.2.1.1.\nIf the Charging-Information AVP is present in the request, the S-CSCF shall replace the existing charging information with the information received from the HSS.\nThe SIP-Auth-Data-Item AVP shall be present if the command is sent in order to update SIP Digest authentication information due to a password change.\nIf the S-CSCF receives data that it can not recognise, unsupported user data in a part of the request where it may not be ignored or more data than it can accept, it shall return the corresponding error code to the HSS as indicated in table 6.2.2.1.1. The S-CSCF shall not overwrite the data that it already has to give service to the IMS Subscription. The HSS shall initiate a network-initiated de-registration procedure towards the S-CSCF with Deregistration-Reason set to SERVER_CHANGE, which will trigger the assignment of a new S-CSCF.\nIf the HSS receives DIAMETER_ERROR_USER_UNKNOWN from the S-CSCF in the Push-Profile-Answer, then the HSS shall re-send the request using another arbitrarily selected registered Private Identity (if any). If restoration procedures are not supported, the HSS shall set the unknown Private User Identity's registration status to \"not registered\"; this will allow the synchronization of the registration status in HSS and S-CSCF.\nNOTE:\tIf restoration procedures are supported, restoration procedures will ensure synchronization of the registration status in HSS and S-CSCF, i.e. the S-CSCF can either immediately retrieve the S-CSCF restoration information for the registered Public User Identity (sending SAR with Server Assignment Type set to NO_ASSIGNMENT), or wait for reception of a SIP request.\nTable 6.2.2.1.1 details the valid result codes that the S-CSCF can return in the response.\nTable 6.2.2.1.1: User information update response valid result codes\nResult-Code AVP value\nCondition\nDIAMETER_SUCCESS\nThe request succeeded.\nDIAMETER_ERROR_NOT_SUPPORTED_USER_DATA\nThe request failed. The S-CSCF informs the HSS that the received user information contained information, which was not recognised or supported by the S-CSCF due to unsupported S-CSCF capabilities.\nDIAMETER_ERROR_USER_UNKNOWN\nThe request failed because the Private Identity is not found in S-CSCF.\nDIAMETER_ERROR_TOO_MUCH_DATA\nThe request failed. The S-CSCF informs to the HSS that it tried to push too much data into the S-CSCF.\nDIAMETER_UNABLE_TO_COMPLY\nThe request failed.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.5.2.3",
        "clause_6.5.2.4",
        "clause_6.5.2.5",
        "table_6.2.2.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.3",
      "section_id": "6.3",
      "section_title": "Authentication procedures",
      "content": "This procedure is used between the S-CSCF and the HSS to exchange information to support the authentication between the end user and the home IMS network. The procedure is invoked by the S-CSCF, corresponds to the combination of the operations Cx-AV-Req and Cx-AV-Req-Resp (see  TS 33.203 [3]) and is used:\n-\tTo retrieve authentication vectors from the HSS.\n-\tTo resolve synchronization failures between the sequence numbers in the UE and the HSS for authentication schemes that support this capability (e.g. IMS-AKA).\n-\tTo promote the result of the NASS-level authentication to the IMS level.\n-\tTo retrieve the IP-address secure binding information for GPRS-IMS-Bundled Authentication (GIBA) from the HSS.\nThis procedure is mapped to the commands Multimedia-Auth-Request/Answer in the Diameter application specified in  TS 29.229 [5]. Tables 6.3.1 through 6.3.7 detail the involved information elements.\nTable 6.3.1: Authentication Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPublic User Identity\n(See 7.2)\nPublic-Identity\nM\nThis information element contains the Distinct Public User Identity of the user\nPrivate User Identity\n(See 7.3)\nUser-Name\nM\nThis information element contains the Private User Identity\nNumber Authentication Items\n(See 7.10)\nSIP-Number-Auth-Items\nM\nThis information element indicates the number of authentication vectors requested. Certain authentication schemes do not support more than one set of authentication vectors (e.g. SIP Digest, GIBA).\nAuthentication Data\n(See 7.9)\nSIP-Auth-Data-Item\nM\nSee Table 6.3.2 for the contents of this information element.\nS-CSCF Name\n(See 7.4)\nServer-Name\nM\nThis information element contains the name (SIP URL) of the S-CSCF.\nRouting Information (See 7.13)\nDestination-Host\nC\nIf the S-CSCF knows the HSS name this AVP shall be present.\nThis information is available if the MAR belongs to an already existing registration, e.g. in case of the re-registration, where the HSS name is stored in the S-CSCF. The HSS name is obtained from the Origin-Host AVP, which is received from the HSS, e.g. included in the MAA command.\nThis information may not be available if the command is sent in case of the initial registration. In this case the Destination-Host AVP is not present and the command is routed to the next Diameter node, e.g. SLF, based on the Diameter routing table in the client.\nTable 6.3.2: Authentication Data content in Authentication Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nAuthentication Scheme\n(See 7.9.2)\nSIP-Authentication-Scheme\nM\nThis information element indicates the authentication scheme.\nSee 3GPP TS 29.229 [5] for a list of values\nAuthentication Context\n(See 7.9.7)\nSIP-Authentication-Context\nC\nThis information element shall contain authentication-related information relevant for performing the authentication.\nIt shall be absent for IMS-AKA authentication schemes.\nAuthorization Information\n(See 7.9.4)\nSIP-Authorization\nC\nThis information element shall only be present for a request due to an IMS-AKA synchronization failure.\nIf present, only IMS-AKA authentication schemes are allowed.\nTable 6.3.3: Void\nTable 6.3.4: Authentication Request Response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\n(See 7.2)\nPublic-Identity\nC\nPublic User Identity. It shall be present when the result is DIAMETER_SUCCESS.\nPrivate User Identity\n(See 7.3)\nUser-Name\nC\nPrivate User Identity. It shall be present when the result is DIAMETER_SUCCESS.\nNumber Authentication Items\n(See 7.10)\nSIP-Number-Auth-Items\nC\nThis information element indicates the number of authentication vectors delivered in the Authentication Data information element.\nIt shall be present when the result is DIAMETER_SUCCESS.\nFor SIP Digest, NASS Bundled authentication and GIBA this AVP shall be set to a value of 1.\nAuthentication Data\n(See 7.9)\nSIP-Auth-Data-Item\nC\nIf the SIP-Number-Auth-Items AVP is equal to zero or it is not present, then this information element shall not be present.\nSee Table 6.3.5 for the contents of this information element.\nResult\n(See 7.6)\nResult-Code / Experimental-Result\nM\nThis information element indicates the result of the operation.\nIt shall be mapped to Result-Code AVP for errors defined in the Diameter base protocol (see IETF RFC 6733 [31]).\nIt shall be mapped to Experimental-Result AVP for Cx/Dx errors.\nThis information element is mapped to a grouped AVP which contains the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nTable 6.3.5: Authentication Data information element content in Authentication Request Response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nItem Number\n(See 7.9.1)\nSIP-Item-Number\nC\nThis information element shall only be present for IMS-AKA authentication schemes.\nThis information element shall be present when there are multiple occurrences of the Authentication Data information element in the Authentication Request Response, and the order in which they should be processed is significant.\nIn this scenario, Authentication Data information elements with a low Item Number information element value should be processed before Authentication Data information elements with a high Item Number information element value.\nAuthentication Scheme\n(See 7.9.2)\nSIP-Authentication-Scheme\nM\nThis information element indicates the authentication scheme.\nAuthentication Information\n(See 7.9.3)\nSIP-Authenticate\nC\nThis information element shall only be present for IMS-AKA authentication schemes.\nAuthorization Information\n(See 7.9.4)\nSIP-Authorization\nC\nThis information element shall only be present for IMS-AKA authentication schemes.\nConfidentiality Key\n(See 7.9.5)\nConfidentiality-Key\nC\nThis information element shall be present for IMS AKA authentication schemes.\nIt shall contain the confidentiality key.\nIntegrity Key\n(See 7.9.6)\nIntegrity-Key\nC\nThis information element shall only be present for IMS-AKA authentication schemes.\nThis information element shall contain the integrity key.\nDigest Authenticate\n(See 7.9.8)\nSIP-Digest-Authenticate\nC\nThis information element shall only be present for SIP Digest authentication scheme.\nSee Table 6.3.7 for contents of this grouped AVP.\nLine Identifier\n(See 7.9.9)\nLine-Identifier\nC\nThis information element shall only be present for NASS Bundled authentication scheme.\nThis information element contains fixed broadband access line identifier associated to the user. This information element can be repeated.\nFramed IP Address\n(See 7.9.10)\nFramed-IP-Address\nC\nThis information element shall only be present for GPRS-IMS-Bundled authentication scheme.\nIf the IP Address of the User is an IPv4 address, this AVP shall be included.\nFramed IPv6 Prefix\n(See 7.9.11)\nFramed-IPv6-Prefix\nC\nThis information element shall only be present for GPRS-IMS-Bundled authentication scheme.\nIf the IP Address of the User is an IPv6 address, this AVP shall be included.\nFramed Interface Id\n(See 7.9.12)\nFramed-Interface-Id\nC\nThis information element shall only be present for GPRS-IMS-Bundled authentication scheme.\nIf and only if the IP Address of the User is an IPv6 address and the Framed-IPv6-Prefix AVP alone is not unique for the user this AVP shall be included.\nTable 6.3.6: Void\nTable 6.3.7: Digest Authenticate information element content – Response for SIP Digest\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nDigest Realm\n(See 7.9.8.1)\nDigest-Realm\nM\nThis information element corresponds to the Realm parameter as defined in IETF RFC 7616 [33].\nDigest Algorithm\n(See 7.9.8.3)\nDigest-Algorithm\nO\nThis information element contains the algorithm as defined in IETF RFC 7616 [33].\nIf this information element is present, it shall contain \"MD5\".\nIf neither the Digest Algorithm information element nor the Alternate Digest Algorithm information element are present, then the value \"MD5\" is assumed.\n(NOTE 1)\nDigest QoP\n(See 7.9.8.4)\nDigest-QoP\nM\nThis information element contains the QoP as defined in IETF RFC 7616 [33]. This information element shall be set to a value of \"auth\" by the HSS.\nDigest HA1\n(See 7.9.8.5)\nDigest-HA1\nM\nThis information element contains the H(A1) for algorithm \"MD5\" as defined in IETF RFC 7616 [33].\n(NOTE 1)\nAlternate Digest Algorithm\n(See 7.9.8.6)\nAlternate-Digest-Algorithm\nO\nThis information element contains the algorithm as defined in IETF RFC 7616 [33].\n(NOTE 2)\nAlternate Digest HA1\n(See 7.9.8.6)\nAlternate-Digest-HA1\nO\nThis information element contains the H(A1), as defined in IETF RFC 7616 [33].\n(NOTE 2)\nNOTE 1:\tThe MD5 algorithm is only supported for backward compatibility and may only be provided within the Digest Algorithm information element.\nNOTE 2:\tIf the Alternate Digest HA1 information element is present, the Digest HA1 information element shall also be present and the Digest HA1 information element shall contain the MD5 hash. The algorithm of the Alternate Digest HA1 information element shall be determined by the Alternate Digest Algorithm information element.\nTable 6.3.8: Void\nTable 6.3.9: Void",
      "chunk_type": "procedure",
      "cross_references": [
        "table_6.3.1",
        "table_6.3.2",
        "table_6.3.3",
        "table_6.3.4",
        "table_6.3.5",
        "table_6.3.7",
        "table_6.3.6",
        "table_6.3.8",
        "table_6.3.9",
        "ts_33.203",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.3.1",
      "section_id": "6.3.1",
      "section_title": "Detailed behaviour",
      "content": "The HSS shall, in the following order (in case of an error in any of the steps the HSS shall stop processing and return the corresponding error code, see  TS 29.229 [5]):\n1.\tCheck that the Private User Identity and the Public User Identity exist in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tCheck that the Public User Identity matches a distinct Public User Identity in the HSS. If it doesn't, the Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n3.\tCheck whether the Private and Public User Identities in the request are associated in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.\n4.\tCheck the authentication scheme indicated in the request, and\n-\tif it is \"Unknown\", check the authentication scheme stored in HSS. If it is neither NASS-Bundled authentication nor SIP Digest authentication, Experimental-Result-Code shall be set to DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED.\n-\tif not, check that the authentication scheme indicated in the request is supported. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED.\nThis step is only applicable for IMS-AKA authentication. If the request indicates there is a synchronization failure, the HSS shall compare the S-CSCF name received in the request to the S-CSCF name stored in the HSS:\n-\tIf they are identical the HSS shall process AUTS as described in  TS 33.203 [3] and return the requested authentication information. The Result-Code shall be set to DIAMETER_SUCCESS.\n5.\tCheck the registration status of the Public User Identity received in the request:\n-\tIf it is registered, the HSS shall compare the S-CSCF name received in the request to the S-CSCF name stored in the HSS:\n-\tIf they are different, the HSS shall overwrite the S-CSCF name. If IMS restoration procedures are supported and the S-CSCF reassignment pending flag is set, the HSS shall reset the flag and keep the S-CSCF restoration information associated with the Public User Identity. The HSS shall download SIP-Auth-Data-Item stored up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. If authentication scheme is neither NASS-Bundled nor GIBA, the HSS shall set the Public User Identity's authentication pending flag which is specific to the Private User Identity received in the request. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf they are identical, the HSS shall download SIP-Auth-Data-Item stored up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf it is unregistered (i.e. registered as a consequence of an originating or terminating request or there is an S-CSCF keeping the user profile stored) or not registered, the HSS shall compare the S-CSCF name received in the request to the S-CSCF name stored in the HSS:\n-\tIf they are different or if there is no S-CSCF name stored in the HSS for any Public User Identity of the IMS subscription, the HSS shall store the S-CSCF name. The HSS shall download SIP-Auth-Data-Item stored up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. If authentication scheme is neither NASS-Bundled nor GIBA, the HSS shall set the Public User Identity's authentication pending flag which is specific to the Private User Identity which was received in the request. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf they are identical, the HSS shall download SIP-Auth-Data-Item stored up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. If authentication scheme is neither NASS-Bundled nor GIBA, the HSS shall set the Public User Identity's authentication pending flag which is specific to the Private User Identity that was received in the request. The Result-Code shall be set to DIAMETER_SUCCESS.\nExceptions to the cases specified here shall be treated by HSS as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY. No authentication information shall be returned.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229",
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.4",
      "section_id": "6.4",
      "section_title": "User identity to HSS resolution",
      "content": "The User identity to HSS resolution mechanism enables the I-CSCF and the S-CSCF to find the identity of the HSS, that holds the subscriber data for a given Public Identity when multiple and separately addressable HSSs have been deployed by the network operator. The resolution mechanism is not required in networks that utilise a single HSS. An example for a single HSS solution is server farm architecture.\nThe resolution mechanism described in  TS 23.228 [1] shall use a Subscription Locator Function (SLF) or a Diameter Proxy Agent.\nThe I-CSCF and the S-CSCF accesses the SLF via the Dx interface. The Dx interface shall always be used in conjunction with the Cx interface. The Dx interface shall be based on the Diameter base protocol as specified in IETF RFC 6733 [31]. The SLF functionality shall use the routing mechanism provided by an enhanced Diameter redirect agent.\nThe SLF or the Diameter Proxy Agent shall be able to determine the HSS identity.\nTo get the HSS identity the I-CSCF and the S-CSCF shall send the Cx request normally destined to the HSS to a pre-configured Diameter address/name.\n-\tIf this Cx Request is received by an SLF (acting as a Diameter redirect agent), the SLF shall determine the HSS identity and sends to the I-CSCF or S-CSCF a notification of redirection towards the HSS identity, in response to the Cx request. Multiple HSS identities may be included in the response, as specified in IETF RFC 6733 [31]. In such a case, the I-CSCF or the S-CSCF shall send the Cx Request to the first HSS identity in the ordered list received in the Cx Response from the SLF. If the I-CSCF or S-CSCF does not receive a successful response to the Cx Request, the I-CSCF or S-CSCF shall send a Cx Request to the next HSS identity in the ordered list. This procedure shall be repeated until a successful response from an HSS is received.\n-\tIf this Cx Request is received by the Diameter Proxy Agent, the Diameter Proxy Agent shall determine the HSS identity based on the provided user identity and - if the Diameter load control mechanism is supported (see IETF IETF RFC 8583 [29]) - optionally also based on previously received load values from Load AVPs of type HOST. The Diameter Proxy Agent shall then forward the Cx request directly to the determined HSS. The I-CSCF and S-CSCF shall determine the HSS identity from the response to the Cx request received from the HSS.\nWhile the I-CSCF is stateless, the S-CSCF shall store the HSS identity/name/Realm, as specified in  TS 23.228 [1] and shall use it in further Cx requests associated to the same IMS Public Identity.\nIn networks where the use of the user identity to HSS resolution mechanism is required, each I-CSCF and S-CSCF shall be configured with the address/name of the SLF or the Diameter Proxy Agent to enable use of these resolution mechanisms.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.5",
      "section_id": "6.5",
      "section_title": "Implicit registration",
      "content": "Implicit registration is the mechanism by which a user is allowed to register simultaneously more than one of his/her Public User Identities. The HSS knows the identities that are to be implicitly registered when it receives the indication of the registration of an individual identity.\nWhat follows is an extension of the affected basic procedures.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1",
      "section_id": "6.5.1",
      "section_title": "S-CSCF initiated procedures",
      "content": "The result of the S-CSCF initiated procedures affects all the Public User Identities that are configured in the HSS to be in the same implicitly registered Public User Identity set with the targeted individual Public User Identity. Where the S-CSCF initiated procedure affects the Registration state of the targeted Public User Identity, the Registration states of the Public User Identities in the associated implicitly registered Public User Identity set are affected in the same way.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1.1",
      "section_id": "6.5.1.1",
      "section_title": "Registration",
      "content": "The notification of a registration of a Public User Identity implies the registration of the corresponding implicitly registered Public User Identity set. The user information downloaded in the response contains the Public User Identities of the implicitly registered Public User Identity set with the associated service profiles. This allows the S-CSCF to know which Public User Identities belong to the implicitly registered Public User Identity set. The S-CSCF shall take from the set of implicitly registered Public User Identities the first identity which is not barred, and use this as the default Public User Identity. The default Public User Identity shall be a distinct Public User Identity.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1.2",
      "section_id": "6.5.1.2",
      "section_title": "De-registration",
      "content": "The de-registration of a Public User Identity implies the de-registration of the corresponding implicitly registered Public User Identity set, both in the HSS and in the S-CSCF. The S-CSCF shall include in the request a single Public User Identity to deregister all the Public User Identities that belong to the corresponding implicitly registered Public User Identity set.\nThe de-registration of a Private User Identity implies the de-registration of all the corresponding Public User Identities, both in the HSS and in the S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1.3",
      "section_id": "6.5.1.3",
      "section_title": "Authentication",
      "content": "Setting the authentication pending flag for a Public User Identity implies setting the authentication pending flag for each corresponding implicitly registered Public User Identity in the HSS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1.4",
      "section_id": "6.5.1.4",
      "section_title": "Downloading the user profile",
      "content": "If the S-CSCF requests to download a user profile from HSS, the user profile in the response shall contain the Public User Identities of the corresponding implicitly registered Public User Identity set with the associated service profiles.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.1.5",
      "section_id": "6.5.1.5",
      "section_title": "Initiation of a session to a non-registered user",
      "content": "The change of a Public User Identity to the Unregistered state due to the initiation of a session from/to a Public Identity that was in Not Registered state and the opposite change from Unregistered state to Not Registered state implies the same change for all the Public User Identities in the same Implicit Registration Set.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.2.1",
      "section_id": "6.5.2.1",
      "section_title": "Update of User Profile",
      "content": "A request sent by the HSS to update the user profile shall include only the Public User Identities of the implicitly registered Public User Identity set, with the associated service profiles (even if not updated). If other Public User Identities not associated with the implicitly registered Public User Identity set are affected, they shall be downloaded in separate commands.\nThis procedure shall be used by the HSS to add a newly provisioned or Not Registered Public User Identity or Identities to an existing implicitly registered Public User Identity set that is in the state Registered or Unregistered. The added Public User Identity gets the registration state of the set it is added to.\nThe HSS shall use this procedure if a Public User Identity or Identities are removed from the implicitly registered Public User Identity set that is in a state Registered or Unregistered. In practise, this is done by sending a PPR for the set without the removed identities. The S-CSCF shall remove all information stored in the S-CSCF for the removed identities.\nThe HSS shall not use this procedure if there is no Public User Identities left in the implicitly registered Public User Identity set after the removal. In that case HSS shall use the RTR command instead.\nThe HSS shall not use this procedure to change the default Public User Identity of the implicitly registered Public User Identity set that is in a state Registered. In that case the HSS shall use the RTR command to de-register the Public User Identity set.\nWhen a change of the Reference Location Information occurs (e.g.. a change of authorization), the HSS may use a network initiated de-registration instead of this procedure, and may indicate to the S-CSCF that the de-registration is sent due to change of Reference Location Information.\nMoving of a Public User Identity or Identities from one implicitly registered Public User Identity set to another set shall be done in two steps: First the identity or identities are removed from the \"old\" set as described above, then the identity or identities are added to the \"new\" set as described above.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.2.2",
      "section_id": "6.5.2.2",
      "section_title": "De-registration",
      "content": "A request sent by the HSS to de-register any of the identities included in an implicitly registered Public User Identity set shall affect all the Public User Identities of the deregistered set.\nThe de-registration of a Private User Identity implies the de-registration of all the corresponding Public User Identities, both in the HSS and in the S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.2.3",
      "section_id": "6.5.2.3",
      "section_title": "Update of the Charging information",
      "content": "A request sent by the HSS to update the charging information shall include the Private User Identity for whom the charging information changed.\nIf corresponding Public Identity is registered or unregistered (i.e. registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) and charging information is changed, the HSS should immediately push this information to the S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.2.4",
      "section_id": "6.5.2.4",
      "section_title": "Update of the SIP Digest Authentication Data",
      "content": "A request sent by the HSS to update the authentication data shall include the Private User Identity for whom the authentication data changed.\nIf corresponding Public Identity is registered and authentication data is changed, the HSS should immediately push this information to the S-CSCF.\nIf corresponding Public Identity is either not registered or unregistered (i.e. registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored), authentication pending flag is set and authentication data is changed, the HSS should immediately push this information to the S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.5.2.5",
      "section_id": "6.5.2.5",
      "section_title": "Update of the Allowed WAF and/or WWSF Identities",
      "content": "A request sent by the HSS to update the WAF and/or WWSF identities allowed for the subscription shall include the Private User Identity for whom this information changed.\nIf corresponding Public Identity is registered and allowed WAF and/or WWSF identities are changed, the HSS should immediately push this information to the S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.6",
      "section_id": "6.6",
      "section_title": "Download of the Relevant User Profile and Charging Information and Allowed WAF and/or WWSF Identities",
      "content": "The download of the relevant user profile, charging information and, if supported and part of subscription, allowed WAF and/or WWSF identities from the HSS to the S-CSCF depends on whether the user profile,  charging information and, if supported and part of subscription, allowed WAF and/or WWSF identities are already stored in the S-CSCF. If the SiFC feature is supported by the HSS and S-CSCF, the HSS shall download the identifiers of the shared iFC sets. If either the HSS or the S-CSCF does not support the SiFC feature, the HSS shall download the complete iFCs, and SiFC identifiers shall not be downloaded by the HSS. The SiFC feature is defined in  TS 29.229 [5].\nIf User-Data-Already-Available is set to USER_DATA_NOT_AVAILABLE the HSS shall download the requested user profile, charging information and, if supported and part of subscription, allowed WAF and/or WWSF identities. If the Public User Identity in the request is included in an implicitly registered Public User Identity set, the HSS shall include in the response the service profiles associated with all Public User Identities within the implicitly registered Public User Identity set to which the received Public User Identity belongs.\nIf User-Data-Already-Available is set to USER_DATA_ALREADY_AVAILABLE, the HSS should not return any user profile or charging information data or allowed WAF and/or WWSF identities. The HSS may override User-Data-Already-Available set to USER_DATA_ALREADY_AVAILABLE and download the user profile, charging information and, if supported and part of subscription, allowed WAF and/or WWSF identities.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_6.6.1",
      "section_id": "6.6.1",
      "section_title": "HSS initiated update of User Profile",
      "content": "The request to update the user profile in the S-CSCF includes only the Public User Identities of the implicitly registered Public User Identity set with the associated service profiles. See 6.5.2.1.\nIf the Public Identity is registered or unregistered (i.e. registered as a consequence of an originating or terminating request or there is a S-CSCF keeping the user profile stored) and there are changes in the user profile, the HSS should immediately push the complete user profile to the S-CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.6.2",
      "section_id": "6.6.2",
      "section_title": "S-CSCF operation",
      "content": "At deregistration of a Public User Identity, the S-CSCF shall store the user information if it sends Server-Assignment-Request command including Server-Assignment-Type AVP set to value USER_DEREGISTRATION_STORE_SERVER_NAME or TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME and the HSS responds with DIAMETER_SUCCESS. Otherwise the S-CSCF shall not keep user information.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_6.7",
      "section_id": "6.7",
      "section_title": "S-CSCF Assignment",
      "content": "The list of mandatory and optional capabilities received by an I-CSCF from the HSS allows operators to distribute users between S-CSCFs, depending on the different capabilities (e.g. features, role, geographical location) that each S-CSCF may have. Alternatively, an operator has the possibility to steer users to certain S-CSCFs.\nThe operator shall define (possibly based on the functionality offered by each S-CSCF installed in the network) the exact meaning of the S-CSCF mandatory and optional capabilities available in his network. It is an operator task to allocate a unique value to represent a single capability (e.g. support of \"wildcarded PSI\") or a set of capabilities (e.g. support of \"alias\" and \"Shared IFC sets\" and \"wildcarded PSI\") and to use these values to identify capabilities that are mandatory and/or optional to support for a given subscription. It is a configuration task for the operator to ensure that the I-CSCF has a correct record of the capabily values received from the HSS for each S-CSCF available in his network. The I-CSCF and the HSS do not need to know the semantic of these values. This semantic is exclusively an operator issue.\nAs a first choice, the I-CSCF shall select an S-CSCF that has all the mandatory and optional capabilities for the user. Only if that is not possible shall the I-CSCF apply a 'best-fit' algorithm. If more than one S-CSCF is identified that supports all mandatory capabilities the I-CSCF may then consider optional capabilities in selecting a specific S-CSCF. The 'best-fit' algorithm is implementation dependent and out of the scope of this specification.\nIt is the responsibility of the operator to ensure that there are S-CSCFs which have mandatory capabilities indicated by the HSS for any given user. However, configuration errors may occur. If such errors occur and they prevent the I-CSCF from selecting an S-CSCF which meets the mandatory capabilities indicated by the HSS, the I-CSCF shall inform the operator via the O&M subsystem.\nAs an alternative to selecting an S-CSCF based on the list of capabilities received from the HSS, it is possible to steer users to certain S-CSCFs. To do this, the operator may include one or more S-CSCF names as part of the capabilities of the user profile. The reason for the selection (e.g. all the users belonging to the same company/group could be in the same S-CSCF to implement a VPN service) and the method of selection are operator issues and out of the scope of this specification. If this alternative is chosen, the HSS shall include Server-Name AVPs in the Server-Capabilities AVP and should not include Mandatory-Capability AVPs or Optional-Capability AVPs in the Server-Capabilities AVP, and the I-CSCF when receiving Server-Name AVPs within the Server-Capabilities AVP shall discard any Mandatory-Capability AVP and any Optional-Capability AVP received within the Server-Capabilities AVP.\nThe following table is a guideline for operators that records S-CSCF capabilities that need to be supported by an S-CSCF in order to serve a user or a service (identified by a Public User Identity or Public Service Identity), that cannot be served by an S-CSCF which is only compliant to a previous 3GPP release.\nTable 6.7: Guidelines for S-CSCF Capabilities\nCapability\nMandatory or Optional (NOTE 1)\nDescription\nSupport of \"Wildcarded PSI\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of Wildcarded PSIs.\nSupport of \"OrigUnreg SPT\"\nM\nThis capability indicates that the assigned S-CSCF shall be able to process iFCs with a Session Case \"Originating_Unregistered\" received from the HSS in the user profile.\nSupport of \"OrigCDIV SPT\"\nM\nThis capability indicates that the assigned S-CSCF shall be able to process iFCs with a Session Case \"Originating_CDIV\" received from the HSS in the user profile.\nSupport of \"Shared iFC sets\"\nO\nThis capability indicates that the assigned S-CSCF may support the \"SiFC\" feature defined in the 3GPP TS 29.229 [5].\nSupport of \"Display Name\"\nO\nThis capability indicates that the assigned S-CSCF may support the handling of \"Display Name\". The behaviour of the S-CSCF related to this missing data is the same as if the HSS did not send the Display Name.\nSupport of \"Alias\"\nO\nThis capability indicates that the assigned S-CSCF may support the \"AliasInd\" feature defined in 3GPP TS 29.229 [5].\nSupport of  \"SIP Digest Authentication\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of SIP Digest Authentication.\nSupport of  \"NASS Bundled Authentication\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of NASS Bundled Authentication.\nSupport of  \"Wildcarded IMPUs\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of Wildcarded Public User Identities.\nSupport of \"Loose-Route \"\nM\nThis capability indicates that the assigned S-CSCF shall support the loose-route mechanism.\nSupport of \"Service Level Trace\"\nM\nThis capability indicates that the assigned S-CSCF shall support the Service Level Trace mechanism.\nSupport of \"Priority Service\"\nM\nThis capability indicates that the S-CSCF shall support a network default pre-configured namespace (e.g. \"wps\") and the associated Service Priority Level. See IETF RFC 4412 [22] and 3GPP TS 24.229 [8].\nSupport of \"Extended Priority \"\n(NOTE 2)\nM\nThis capability indicates that the S-CSCF shall support the Priority Namespaces and their associated Priority Levels. See IETF RFC 4412 [22] and 3GPP TS 24.229 [8].\nSupport of \"Early IMS Security\"\nM\nThis capability indicates that the assigned S-CSCF shall support  GIBA.\nSupport of \"Reference Location\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of reference location as defined in 3GPP TS 23.167 [23].\nSupport of \"Priviledged-Sender\"\nM\nThis capability indicates that the S-CSCF shall support priviledged sender. See 3GPP TS 24.229 [8].\nSupport of \"IMSI\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of the IMSI.\nSupport of \"Maximum Number of allowed simultaneous registrations\"\nM\nThis capability indicates that the assigned S-CSCF shall support the handling of maximum number of allowed simultaneous registrations per user as received from the HSS.\nNOTE 1:\tMandatory (M) corresponds to a Mandatory Capability that shall be supported by the assigned S-CSCF for a given user. The I-CSCF shall not select an S-CSCF that does not meet a mandatory capability. The selection of a S-CSCF not supporting this capability would lead to an unspecified network behaviour.\nOptional (O) corresponds to an Optional Capability that may be supported by the assigned S-CSCF for a given user. The selection of a S-CSCF that would not support this capability will not significantly affect the network behaviour.\nNOTE 2:\tSupport of \"Extended Priority \" is backward compatible with continued support of the \"Priority Service\".",
      "chunk_type": "general",
      "cross_references": [
        "table_6.7",
        "ts_29.229",
        "ts_24.229",
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.1",
      "section_id": "7.1",
      "section_title": "Visited Network Identifier",
      "content": "This information element contains the domain name of the visited network.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.2",
      "section_id": "7.2",
      "section_title": "Public User Identity",
      "content": "This information element contains the Public User Identity. For definition of a Public User Identity, see  TS 23.003 [17].\nWhen GPRS-IMS-Bundled Authentication (GIBA) is used, a Temporary Public User Identity is derived from the IMSI used for bearer network access according to the rules in  TS 23.003 [17].\n7.2a\tPublic Service Identity\nThis information element contains a Public Service Identity (PSI) that is hosted by an application server. For definition of a PSI, see  TS 23.003 [17].\n7.2b\tWildcarded Public Identity\nThis information element contains a Wildcarded PSI that is hosted by an application server or a Wildcarded Public User Identity. For definition of a Wildcarded PSI and a Wildcarded Public User Identity, see  TS 23.003 [17].\n7.2c\tVoid",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.3",
      "section_id": "7.3",
      "section_title": "Private User Identity",
      "content": "This information element contains the Private User Identity. For definition of a Private User Identity, see  TS 23.003 [17].\nWhen GPRS-IMS-Bundled Authentication (GIBA) is used, the Private User Identity is derived from the IMSI as specified in  TS 33.203 [3].\n7.3a\tPrivate Service Identity\nThis information element contains the Private Service Identity. For definition of a Private Service Identity, see  TS 23.003 [17].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003",
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.4",
      "section_id": "7.4",
      "section_title": "S-CSCF Name",
      "content": "This information element contains the S-CSCF Name of the S-CSCF assigned to an IMS Subscription. For definition of a S-CSCF Name, see  TS 23.008 [18].\n7.4a\tAS Name\nThis information element contains the AS Name of the AS hosting a Public Service Identity. For definition of AS Name, see  TS 23.008 [18].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.008"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.5",
      "section_id": "7.5",
      "section_title": "S-CSCF Capabilities",
      "content": "This information element carries information to assist the I-CSCF during the process of selecting an S-CSCF for a certain IMS Subscription.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.6",
      "section_id": "7.6",
      "section_title": "Result",
      "content": "This information element contains result of an operation. See  TS 29.229 [5] for the possible values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.7",
      "section_id": "7.7",
      "section_title": "User Profile",
      "content": "This information element contains the user profile in XML format. The user profile XML shall be valid against the user profile XML schema defined in Annex E.\nAnnex B specifies the UML logical model of the user profile downloaded via the Cx interface.\nAnnex D contains and informative, high level representation, of the wire representation of user profile data.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.8",
      "section_id": "7.8",
      "section_title": "Server Assignment Type",
      "content": "Indicates the type of server assignment. See  TS 29.229 [5] for the list of existing values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9",
      "section_id": "7.9",
      "section_title": "Authentication Data",
      "content": "This information element is composed of the following sub-elements.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.9.1",
      "section_id": "7.9.1",
      "section_title": "Item Number",
      "content": "This information element indicates the order in which the authentication vectors are to be consumed. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.2",
      "section_id": "7.9.2",
      "section_title": "Authentication Scheme",
      "content": "This information element contains the authentication scheme, which is used to encode the authentication parameters. See  TS 29.229 [5] for a list of values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.3",
      "section_id": "7.9.3",
      "section_title": "Authentication Information",
      "content": "This information element is used to convey the challenge and authentication token used during the authentication procedure, see  TS 33.203 [3] for more information. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.4",
      "section_id": "7.9.4",
      "section_title": "Authorization Information",
      "content": "This information element is used, in an authentication request, to indicate a failure of synchronization. In a response, it is used to convey the expected response to the challenge used to authenticate the user, see  TS 33.203 [3] for more information. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.5",
      "section_id": "7.9.5",
      "section_title": "Confidentiality Key",
      "content": "This information element contains the confidentiality key, see  TS 33.203 [3] for more information. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.6",
      "section_id": "7.9.6",
      "section_title": "Integrity Key",
      "content": "This information element contains the integrity key, see  TS 33.203 [3] for more information. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.7",
      "section_id": "7.9.7",
      "section_title": "Authentication Context",
      "content": "his information element contains authentication-related information relevant for performing the authentication but that is not part of the SIP authentication headers. Some mechanisms (e.g. PGP, digest with quality of protection set to \"auth-int\" defined in IETF RFC 7616 [33], digest with predictive nonces or sip access digest) request that part or the whole SIP request (e.g. the SIP method) is passed to the entity performing the authentication. In such cases the SIPAuthentication-Context AVP shall be carrying such information.\nSee TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8",
      "section_id": "7.9.8",
      "section_title": "Digest Authenticate",
      "content": "This information element is composed of the following sub-elements.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.9.8.1",
      "section_id": "7.9.8.1",
      "section_title": "Digest Realm",
      "content": "This information element is part of the Digest authentication challenge, and corresponds to the Realm parameter as defined in IETF RFC 3261 [11]. This information element is used to convey the Realm to the S-CSCF during the SIP Digest authentication procedure. See  TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8.3",
      "section_id": "7.9.8.3",
      "section_title": "Digest Algorithm",
      "content": "This information element is part of the Digest authentication challenge, defined in IETF RFC 7616 [33]. See TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8.4",
      "section_id": "7.9.8.4",
      "section_title": "Digest QoP",
      "content": "This information element is part of the Digest authentication challenge, defined in IETF RFC 7616 [33]. It provides the Quality of Protection indication and has an effect on the digest computation. See TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8.5",
      "section_id": "7.9.8.5",
      "section_title": "Digest HA1",
      "content": "This information element is part of the Digest authentication challenge, defined in IETF RFC 7616 [33]. See TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8.6",
      "section_id": "7.9.8.6",
      "section_title": "Alternate Digest Algorithm",
      "content": "This information element is part of the Digest authentication challenge, defined in IETF RFC 7616 [33]. See TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.8.7",
      "section_id": "7.9.8.7",
      "section_title": "Alternate Digest HA1",
      "content": "This information element is part of the Digest authentication challenge, defined in IETF RFC 7616 [33]. See TS 29.229 [5] for coding details.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.9",
      "section_id": "7.9.9",
      "section_title": "Line Identifier",
      "content": "This information element contains the line identifier of the user's network termination. See  TS 29.229 [5] for coding details.",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.10",
      "section_id": "7.9.10",
      "section_title": "Framed IP Address",
      "content": "See  TS 29.229 [5] for more information.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.11",
      "section_id": "7.9.11",
      "section_title": "Framed IPv6 Prefix",
      "content": "See  TS 29.229 [5] for more information.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.9.12",
      "section_id": "7.9.12",
      "section_title": "Framed Interface Id",
      "content": "See  TS 29.229 [5] for more information.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.10",
      "section_id": "7.10",
      "section_title": "Number Authentication Items",
      "content": "This information element contains the number of authentication vectors requested or delivered.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.11",
      "section_id": "7.11",
      "section_title": "Reason for de-registration",
      "content": "This information element contains the reason for a de-registration procedure.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.12",
      "section_id": "7.12",
      "section_title": "Charging information",
      "content": "Addresses of the charging functions. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.13",
      "section_id": "7.13",
      "section_title": "Routing information",
      "content": "Information to route requests.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.14",
      "section_id": "7.14",
      "section_title": "Type of authorization",
      "content": "Type of authorization requested by the I-CSCF. See  TS 29.229 [5] for a list of values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.15",
      "section_id": "7.15",
      "section_title": "Void",
      "content": "Void",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.16",
      "section_id": "7.16",
      "section_title": "User Data Already Available",
      "content": "This information element indicates to the HSS if the user profile is already available in the S-CSCF. See  TS 29.229 [5] for a list of values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.17",
      "section_id": "7.17",
      "section_title": "Associated Private Identities",
      "content": "This information element indicates to the S-CSCF the Private Identities, which belong to the same IMS Subscription as the Private Identity received in the request command. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.18",
      "section_id": "7.18",
      "section_title": "Originating-Request",
      "content": "This information element indicates to the HSS that the request is related to an originating SIP message. See 3GPP 29.229 [5].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.19",
      "section_id": "7.19",
      "section_title": "User Authorization Request Flags",
      "content": "This information element carries the following indication (see 3GPP 29.229 [5] for coding details):\n- IMS Emergency Registration.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.20",
      "section_id": "7.20",
      "section_title": "Loose-Route Indication",
      "content": "This information element indicates to the S-CSCF that the loose-route mechanism shall be applied to the public identities contained in the user profile received from the HSS. See  TS 29.229 [5]. This information is static data for the duration of the subscription or the validity of the IMS identity. Modification of this data result in Network Initiated Deregistration (SERVER_CHANGE); see clause 6.1.3.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.1.3.1",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.21",
      "section_id": "7.21",
      "section_title": "S-CSCF Restoration Information",
      "content": "This information element contains information for the S-CSCF to handle traffic for a registered user. It is associated with the Private User Identity and the Implicit Registration Set that is affected by the SAR request. See  TS 29.229 [5] for the contents of this information element.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.22",
      "section_id": "7.22",
      "section_title": "Associated Registered Private Identities",
      "content": "This information element indicates to the S-CSCF the Registered Private Identities, which were registered with the Public Identity received in the request command. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.23",
      "section_id": "7.23",
      "section_title": "Multiple Registration Indication",
      "content": "This information element indicates to the HSS that this is related to a multiple registration. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.24",
      "section_id": "7.24",
      "section_title": "Session-Priority",
      "content": "This information element indicates the session's priority level to the HSS. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.25",
      "section_id": "7.25",
      "section_title": "Identities with Emergency Registration",
      "content": "This information element indicates to the HSS a list of pairs of Private / Public Identities that are emergency registered. See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.26",
      "section_id": "7.26",
      "section_title": "Priviledged-Sender Indication",
      "content": "This information element indicates to the S-CSCF that the Private User Identity shall be considered as a priviledged sender, as described in  TS 24.229 [8].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.27",
      "section_id": "7.27",
      "section_title": "LIA Flags",
      "content": "This information element carries the following indications. See  TS 29.229 [5] for coding details.\n-\tPSI Direct Routing Indication",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.28",
      "section_id": "7.28",
      "section_title": "Server Assignment Request Flags",
      "content": "This information element carries the following indication (see 3GPP 29.229 [5] for coding details):\n- P-CSCF Restoration Indication",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_7.29",
      "section_id": "7.29",
      "section_title": "Allowed WAF and/or WWSF Identities",
      "content": "Addresses of the WebRTC Authentication Functions and/or WebRTC Web Server Functions allowed for a subscription. See  TS 33.203 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.30",
      "section_id": "7.30",
      "section_title": "RTR Flags",
      "content": "This information element carries the following indications. See  TS 29.229 [5] for coding details.\n-\tReference Location Information change",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_7.31",
      "section_id": "7.31",
      "section_title": "Failed-PCSCF",
      "content": "This information element indicates to the HSS the address of a failed P-CSCF, as detected by the S-CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_8.1",
      "section_id": "8.1",
      "section_title": "Registration error cases",
      "content": "This clause describes the handling of error cases, which can occur during the registration process. If the new and previously assigned S-CSCF names sent in the Multimedia-Auth-Request command are different and the Multimedia-Auth-Request is not indicating synchronisation failure (i.e. the request does not contain auts parameter), then the HSS shall overwrite the S-CSCF name.\nIf the new and previously assigned S-CSCF names sent in a command other than the Multimedia-Auth-Request command are different and the S-CSCF reassignment pending flag is not set, then the HSS shall not overwrite the S-CSCF name; instead it shall send a response to the S-CSCF indicating an error.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_8.1.1",
      "section_id": "8.1.1",
      "section_title": "Cancellation of the old S-CSCF",
      "content": "It is possible that in certain situations the HSS receives a Multimedia-Auth-Request (MAR) command including a S-CSCF name, which is not the same as the previously assigned S-CSCF for the user. This can happen e.g. in case the new S-CSCF is selected due to a failure in the re-registration if the previously assigned S-CSCF does not respond to REGISTER message sent from the I-CSCF after a timeout.\nIn this case, the new S-CSCF is assigned for the user and if registrations in the previously assigned S-CSCF exist for the user, these registrations in the old S-CSCF are handled locally in the old S-CSCF, e.g. re-registration timers in the old S-CSCF shall cancel the registrations.\nAdditionally, the HSS should de-register the registrations in the old S-CSCF by using the Registration-Termination-Request command. In this case, the HSS shall first check whether the deregistration is really required by comparing the Diameter client address of the newly assigned S-CSCF received in the MAR command to the Diameter client address stored in the HSS. If the Diameter client addresses match, the deregistration shall not be initiated. Otherwise the deregistration should be initiated for all the registered Public User Identities for the corresponding IMS Subscription. HSS shall check whether IMS Restoration Procedures are supported to perform deregistration:\n-\tIf supported, Registration-Termination-Request shall be sent for all Public User Identities (with their associated Private User Identities), with Deregistration-Reason AVP value set to NEW_SERVER_ASSIGNED.\n-\tOtherwise, Registration-Termination-Request  shall be sent with different Deregistration-Reason AVP values,  in the following order:\n1.\tDeregistration-Reason AVP value set to NEW_SERVER_ASSIGNED, for the Public User Identity (with its associated Private User Identity), which is registered in the new S-CSCF.\n2.\tDeregistration-Reason AVP value set to SERVER_CHANGE, for the user Public User Identities (with their associated Private User Identities), which are not yet registered in the new S-CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_8.1.2",
      "section_id": "8.1.2",
      "section_title": "Error in S-CSCF name",
      "content": "If the S-CSCF name sent in the Server-Assignment-Request command and the previously assigned S-CSCF name stored in the HSS are different and the S-CSCF reassignment pending flag is not set, then the HSS shall not overwrite the S-CSCF name. If the Server Assignment Type indicates NO_ASSIGNMENT, the HSS shall send a response to the S-CSCF with Result-Code value set to DIAMETER_UNABLE_TO_COMPLY. For all other Server Assignment Types, the HSS shall send a response to the S-CSCF with Experimental-Result-Code value set to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\nIf the S-CSCF name sent in the Server-Assignment-Request command and the previously assigned S-CSCF name stored in the HSS are different and IMS Restoration Procedures are supported and the S-CSCF reassignment pending flag is set, then the HSS shall allow overwriting of the S-CSCF name and proceed with the processing of the SAR command as defined in clause 6.1.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.228_8.1.3",
      "section_id": "8.1.3",
      "section_title": "Error in S-CSCF assignment type",
      "content": "If the Server-Assignment-Type in the Server-Assignment-Request command sent by the S-CSCF to the HSS is not allowed (i.e if the Server-Assignment-Type is not applicable based on the user state or it is not applicable based on the user identity type), the HSS shall send a response to the S-CSCF with the Experimental-Result-Code value set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.228_9",
      "section_id": "9",
      "section_title": "Protocol version identification",
      "content": "See  TS 29.229 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.228_10",
      "section_id": "10",
      "section_title": "Operational Aspects",
      "content": "See  TS 29.229 [5].\nAnnex A (normative):Mapping of Cx operations and terminology to Diameter\nA.1\tIntroduction\nThis appendix gives mappings from Cx to Diameter protocol elements. Diameter protocol elements are defined in  TS 29.229 [5].\nA.2\tCx message to Diameter command mapping\nThe following table defines the mapping between stage 2 operations and Diameter commands:\nTable A.2.1: Cx message to Diameter command mapping\nCx message\nSource\nDestination\nCommand-Name\nAbbreviation\nCx-Query + Cx-Select-Pull\nI-CSCF\nHSS\nUser-Authorization-Request\nUAR\nCx-Query Resp + Cx-Select-Pull Resp\nHSS\nI-CSCF\nUser-Authorization-Answer\nUAA\nCx-Put + Cx-Pull\nS-CSCF\nHSS\nServer-Assignment-Request\nSAR\nCx-Put Resp + Cx-Pull Resp\nHSS\nS-CSCF\nServer-Assignment-Answer\nSAA\nCx-Location-Query\nI-CSCF\nHSS\nLocation-Info-Request\nLIR\nCx-Location-Query Resp\nHSS\nI-CSCF\nLocation-Info-Answer\nLIA\nCx-AuthDataReq\nS-CSCF\nHSS\nMultimedia-Authentication-Request\nMAR\nCx-AuthDataResp\nHSS\nS-CSCF\nMultimedia-Authentication-Answer\nMAA\nCx-Deregister\nHSS\nS-CSCF\nRegistration-Termination-Request\nRTR\nCx-Deregister Resp\nS-CSCF\nHSS\nRegistration-Termination-Answer\nRTA\nCx-Update_Subscr_Data\nHSS\nS-CSCF\nPush-Profile-Request\nPPR\nCx-Update_Subscr_Data Resp\nS-CSCF\nHSS\nPush-Profile-Answer\nPPA\nA.3\tCx message parameters to Diameter AVP mapping\nThe following table gives an overview about the mapping:\nTable A.3.1: Cx message parameters to Diameter AVP mapping\nCx parameter\nAVP Name\nVisited Network Identifier\nVisited-Network-Identifier\nPublic Identity\nPublic-Identity\nPrivate Identity\nUser-Name\nS-CSCF Name\nServer-Name\nAS Name\nS-CSCF capabilities\nServer-Capabilities\nResult\nResult-Code\nExperimental-Result-Code\nUser profile\nUser-Data\nServer Assignment Type\nServer-Assignment-Type\nAuthentication data\nSIP-Auth-Data-Item\nItem Number\nSIP-Item-Number\nAuthentication Scheme\nSIP-Authentication-Scheme\nAuthentication Information\nSIP-Authenticate\nAuthorization Information\nSIP-Authorization\nConfidentiality Key\nConfidentiality-Key\nIntegrity Key\nIntegrity-Key\nNumber Authentication Items\nSIP-Number-Auth-Items\nReason for de-registration\nDeregistration-Reason\nCharging Information\nCharging-Information\nRouting Information\nDestination-Host\nType of Authorization\nAuthorization-Type\nAssociated Private Identities\nAssociated-Identities\nDigest Authenticate\nSIP-Digest-Authenticate\nDigest Realm\nDigest-Realm\nDigest Algorithm\nDigest-Algorithm\nDigest QoP\nDigest-QoP\nDigest HA1\nDigest-HA1\nAlternate Digest Algorithm\nAlternate-Digest-Algorithm\nAlternate Digest HA1\nAlternate-Digest-HA1\nLine Identifier\nLine-Identifier\nWildcarded Public Identity\nWildcarded-Public Identity\nLoose-Route Indication\nLoose-Route-Indication\nS-CSCF Restoration Information\nSCSCF-Restoration-Info\nMultiple Registration Indication\nMultiple-Registration-Indication\nPriviledged-Sender Indication\nPriviledged-Sender-Indication\nLIA Flags\nLIA-Flags\nAllowed WAF and/or WWSF Identities\nAllowed-WAF-WWSF-Identities\nA.4\tMessage flows\nThe following message flows give examples regarding which Diameter messages shall be sent in scenarios described in  TS 23.228 [1].\nA.4.1\tRegistration– user not registered\nFigure A.4.1.1: Registration – user not registered\nA.4.2\tRegistration – user currently registered\nFigure A.4.2.1: Re-registration\nA.4.3\tUE initiated de-registration\nFigure A.4.3.1: UE initiated de-registration\nA.4.4\tNetwork initiated de-registration\nA.4.4.1\tRegistration timeout\nFigure A.4.4.1.1: Network initiated de-registration – registration timeout\nA.4.4.2\tAdministrative de-registration\nFigure A.4.4.2.1: Network initiated de-registration – administrative de-registration\nA.4.4.3\tDe-registration initiated by service platform\nFigure A.4.4.3.1: Network initiated de-registration – initiated by service platform\nA.4.5\tUE Terminating SIP session set-up\nFigure A.4.5.1: UE Terminating SIP session set-up\nA.4.6\tInitiation of a session to a non-registered user\nFigure A.4.6.1: Initiation of a session to a non-registered user\nA.4.6a\tAS originating session on behalf of a non-registered user\nFigure A.4.6a.1: AS originating session on behalf of a non-registered user\nA.4.7\tUser Profile update\nFigure A.4.7.1: User profile update\nAnnex B (informative):User profile UML model\nThe purpose of this UML model is to define in an abstract level the structure of the user profile downloaded over the Cx interface and describe the purpose of the different information classes included in the user profile.\nB.1\tGeneral description\nThe following picture gives an outline of the UML model of the user profile, which is downloaded from HSS to S-CSCF:\nFigure B.1.1: User Profile\nIMS Subscription class contains as a parameter the private user identity of the user in NAI format and the IMSI of the user, if available, as defined in  TS 23.003 [17].\nEach instance of the IMS Subscription class contains zero or one instance of the class Reference Location Information.\nThe class Reference Location Information contains zero or one attribute AccessType, zero or one attribute AccessInfo, and zero or one attribute AccessValue.\nThe attribute AccessType indicates the type of access for which the reference location of the user is defined (e.g. ADSL). The attribute AccessInfo indicates the type of the access information defined for the reference location of the user (e.g. dsl-location). The attribute AccessValue contains the location information (e.g. line identifier in fixed access networks) as configured by the operator.\nEach instance of the IMS Subscription class contains one or several instances of the class Service Profile.\nB.2\tService profile\nThe following picture gives an outline of the UML model of the Service Profile class:\nFigure B.2.1: Service Profile\nEach instance of the Service Profile class consists of the following classes:\n-\tOne or several instances of the Public-Identity class. PublicIdentity class contains the Public Identities associated with that service profile. The information in the CoreNetworkServicesAuthorization and InitialFilterCriteria classes apply to all PublicIdentification class instances, which are included in one ServiceProfile class.\n-\tAn optional instance of the CoreNetworkServicesAuthorization class. If no instance of the CoreNetworkServicesAuthorization class is present, no filtering related to subscribed media or restriction on IMS Communication Service Identifiers applies in the S-CSCF.\n-\tZero or several instances of the InitialFilterCriteria class.\nEach instance of the Service Profile class contains the following attributes:\n-\tZero or more instances of the attribute SharedIFCSetID. A SharedIFCSetID attribute points to a set of Initial Filter Criteria locally administered and stored at the S-CSCF. Shared iFC Sets may be shared by several Service Profiles.\nB.2.1\tPublic Identification\nThe following picture gives an outline of the UML model of Public Identification class:\nFigure B.2.1.1: Public Identification\nThe attribute BarringIndication is of type Boolean. If it is absent, or if it is present and set to FALSE, the S-CSCF shall not restrict the use of that public user identity in any IMS communications. If it is present and set to TRUE, the S-CSCF shall prevent that public identity from being used in any IMS communication except registrations and re-registrations, as specified in  TS 24.229 [8].\nPublic Identification class can contain an Identity attribute. The attribute IdentityType indicates the type of identity contained in each case. It could be either:\n-\tA distinct Public User Identity\n-\tA distinct Public Service Identity\n-\tA Wildcarded Public Service Identity\n-\tA non distinct Public User Identity, i.e. not explicitly provisioned in HSS.\n-\tA Wildcarded Public User Identity\nIf the identity type is not present, it is assumed to be a distinct Public User Identity.\nThe attribute WildcardedPSI may be present  (when IdentityType is WildcardedPSI) and contains the Wildcarded Public Service Identity that matched the Public Service Identity.  This Wildcarded Public Service identity shall be sent as stored in the HSS, that is, including the delimiter described in  TS 23.003 [17].\nThe attribute DisplayName allows a name to be associated with a Public Identity.\nThe attribute AliasIdentityGroupID indicates the Alias Public User Identity Set to which the Public User Identity belongs. If the \"AliasInd\" feature is supported, all Public User Identities shall have an AliasIdentityGroupID allocated. Within an IMS subscription Public User Identities that have the same AliasIdentityGroupID allocated shall be in the same implicit registration sets, and shall share their service profile and the same service data for each and every service, and shall be regarded as aliases of each other, as defined in the TS 23.008 [18]. If the \"AliasInd\" feature is not supported, all Public User Identities within an IMS subscription that are within the same implicit registration set and share their service profile shall be regarded aliases of each other.\nThe attribute WildcardedIMPU shall be present when IdentityType is a non distinct IMPU or it may be optionally present when IdentityType is a Wildcarded IMPU. It contains the Wildcarded Public User Identity that matched the Public User Identity. This Wildcarded Public User identity shall be sent as stored in the HSS, that is, including the delimiter described in  TS 23.003 [17].\nThe attribute ServiceLevelTraceInfo provides the Service Level Tracing Information that is related to the Public User Identity.  If the ServiceLevelTraceInfo is present, service level tracing shall be enabled in the S-CSCF for the related Public User Identity according to the configuration data received.  If the ServiceLevelTraceInfo is not present, service level tracing is disabled in the S-CSCF for the related Public User Identity.\nThe attribute ServicePriorityLevel provides the Priority Level allowed for the Public User Identity, which can be used by the S-CSCF and other network elements for Priority Service.\nThe attribute PriorityNamespace provides the Namespace as specified in IETF RFC 4412 [22] and to which the Extended Priority refers.\nThe attribute PriorityLevel provides the Priority Level allowed for the Public User Identity, for the Extended Priority. Its value depends on the PriorityNamespace.\nThe attribute MaxNumOfAllowedSimultRegs provides the maximum number of allowed simultaneous registrations for the Public User Identity.\nB.2.1A\tCore Network Service Authorization\nThe following picture gives an outline of the UML model of Core Network Service Authorization class:\nFigure B.2.1A.1: Core Network Service Authorization\nEach instance of the Core Network Service Authorization class contains zero or one instance of the class Subscribed Media Profile Id. If no instance of the class Subscribed Media Profile Id is present, no filtering related to subscribed media applies in S-CSCF. The Subscribed Media Profile Id is of type Integer and identifies a media profile in the S-CSCF for the authorization of media parameters.\nEach instance of the Core Network Service Authorization class contains zero or one instance of the class List of Service Ids. If no instance of the class List of Service Ids is present, no restriction on IMS Communication Service Identifiers related applies in S-CSCF. Each instance of the class List of Service Ids contains zero or more instances of the class Service Id. The Service Id is of type String and identifies an IMS Communication Service Identifier that the subscriber is authorized to use.\nB.2.2\tInitial Filter Criteria\nThe following picture gives an outline of the UML model of Initial Filter Criteria class:\nFigure B.2.2.1.1: Initial Filter Criteria\nEach instance of the InitialFilterCriteria class includes the following attributes:\n-\tOne instance of Priority attribute that indicates the priority of the Filter Criteria. The higher the Priority Number the lower the priority of the Filter Criteria is; i.e., a Filter Criteria with a higher value of Priority Number shall be assessed after the Filter Criteria with a smaller Priority Number have been assessed. The same priority shall not be assigned to more than one initial Filter Criterion.\n-\tAn optional instance of ProfilePartIndicator attribute that is an enumerated type, with possible values \"REGISTERED and UNREGISTERED, indicating if the iFC is a part of the registered or unregistered user profile. If ProfilePartIndicator is missing from the iFC, the iFC is considered to be relevant to both the registered and unregistered parts of the user profile, i.e. belongs to the common part of the user profile.\nEach instance of the InitialFilterCriteria class consists of the following classes:\n-\tAn optional instance of TriggerPoint class that describes the trigger points that should be checked in order to find out if the indicated Application Server should be contacted or not. Each TriggerPoint is a boolean expression in Conjunctive or Disjunctive Normal form (CNF of DNF). The absence of Trigger Point instance will indicate an unconditional triggering to Application Server.\nThe attribute ConditionTypeCNF attribute defines how the set of SPTs are expressed, i.e. either an Ored set of ANDed sets of SPT statements or an ANDed set of Ored sets of statements. Individual SPT statements can also be negated. These combinations are termed, respectively, Disjunctive Normal Form (DNF) and Conjunctive Normal Form (CNF) for the SPT (see Annex C). Both DNF and CNF forms can be used. ConditionTypeCNF is a boolean that is TRUE when the Trigger Point associated with the FilterCriteria is a boolean expression in Conjunctive Normal Form (CNF) and FALSE if the Trigger Point is expressed in Disjunctive Normal Form (DNF) (see Annex C).\nEach TriggerPoint class is composed by 1 to n instances of the SPT (ServicePointTrigger) class.\n-\tOne instance of ApplicationServer class that defines the application server, which is contacted, if the trigger points are met.\nEach instance of the ApplicationServer class includes following attributes:\n-\tOne instance of ServerName attribute that is the SIP URL of the application server to contact.\n-\tAn optional instance of DefaultHandling attribute that determines whether the dialog should be released if the Application Server could not be reached or not; it is of type enumerated and can take the values: SESSION_CONTINUED or SESSION_TERMINATED.\n-\tOne optional instance of the ServiceInfo attribute. The ServiceInfo attribute allows to download to S-CSCF information that is to be transferred transparently to an Application Server when the trigger points of a filter criterion are satisfied. ServiceInfo is a string conveying that information. See  TS 23.218 [6] for a description of the use of this information element.\nEach instance of the ApplicationServer class includes following classes:\n-\tOne optional instance of the IncludeRegisterRequest class that indicates to the S-CSCF that the incoming SIP REGISTER request is to be transferred to an Application Server when the trigger points of a filter criterion are satisfied. See  TS 23.218 [6] for a description of the use of this information element.\n-\tOne optional instance of the IncludeRegisterResponse class that indicates to the S-CSCF that the final SIP response to the incoming SIP REGISTER request is to be transferred to an Application Server when the trigger points of a filter criterion are satisfied. See  TS 23.218 [6] for a description of the use of this information element.\nB.2.3\tService Point Trigger\nThe following picture gives an outline of the UML model of Service Point Trigger class:\nFigure B.2.3.1: Service Point Trigger\nThe attribute Group of the class Service Point Trigger allows the grouping of SPTs that will configure the sub-expressions inside a CNF or DNF expression. For instance, in the following CNF expression (A+B).(C+D), A+B and C+D would correspond to different groups.\nIn CNF, the attribute Group identifies the ORed sets of SPT instances. If the SPT belongs to different ORed sets, SPT can have more than one Group values assigned. At least one Group must be assigned for each SPT.\nIn DNF, the attribute Group identifies the ANDed sets of SPT instances. If the SPT belongs to different ANDed sets, SPT can have more than one Group values assigned. At least one Group must be assigned for each SPI.\nThe attribute ConditionNegated of the class Service Point Trigger defines whether the individual SPT instance is negated (i.e. NOT logical expression).\nNOTE:\tThe operator should be aware that a negated Session Case implies that all other available session cases are set. The list of session cases depends on the release and can even be increased in the future, then a negated Session Case may end up triggering ASs unexpectedly (e.g. NOT ORIGINATED_REGISTERED may trigger only TERMINATING_UNREGISTERED and TERMINATING_REGISTERED, or as well ORIGINATING_UNREGISTERED and ORIGINATING_CDIV).\nThe attribute RegistrationType of the class Service Point Trigger is relevant only to the SIP Method SPT with a value of \"REGISTER\" and its' support is optional in the HSS and in the S-CSCF. The RegistrationType may contain a list of values that define whether the SPT matches to REGISTER messages that are related to initial registrations, re-registrations, and/or de-registrations. If RegistrationTypes are given, the SIP Method SPT with a value of \"REGISTER\" shall match if any of the RegistrationTypes match and the S-CSCF supports the RegistrationType attribute. If the SIP Method SPT contains value \"REGISTER\", and no RegistrationType is given, or if the S-CSCF does not support the RegistrationType attribute, the SIP Method SPT matches to all REGISTER messages. The attribute RegistrationType may be discarded if it is present in an SPT other than SIP Method with value \"REGISTER\".\nRequest-URI class defines SPT for the Request-URI. Request-URI contains attribute RequestURI.\nSIP Method class defines SPT for the SIP method. SIP Method contains attribute Method which holds the name of any SIP method.\nSIP Header class defines SPT for the presence or absence of any SIP header or for the content of any SIP header. SIP Header contains attribute Header which identifies the SIP Header, which is the SPT, and the Content attribute defines the value of the SIP Header if required.\nThe absence of the Content attribute and ConditionNegated = TRUE indicates that the SPT is the absence of a determined SIP header.\nSession Case class represents an enumerated type, with possible values \"Originating\", \"Terminating_Registered\", \"Terminating_Unregistered\", \"Originating_Unregistered\", \"Originating_CDIV\" indicating whether the filter should be used by the S-CSCF handling the Originating, Terminating for a registered end user, Terminating for an unregistered end user, Originating for an unregistered end user, or Originating after Call Diversion services.\nSession Description Information class defines SPT for the content of any SDP field within the body of a SIP Method. The Line attribute identifies the line inside the session description. Content is a string defining the content of the line identified by Line.\nAnnex C (informative):Conjunctive and Disjunctive Normal Form\nA Trigger Point expression is constructed out of atomic expressions (i.e. Service Point Trigger) linked by Boolean operators AND, OR and NOT. Any logical expression constructed in that way can be transformed to forms called Conjunctive Normal Form (CNF) and Disjunctive Normal Form (DNF).\nA Boolean expression is said to be in Conjunctive Normal Form if it is expressed as a conjunction of disjunctions of literals (positive or negative atoms), i.e. as an AND of clauses, each of which is the OR of one of more atomic expressions.\nTaking as an example the following trigger:\nMethod = \"INVITE\" OR Method = \"MESSAGE\" OR (Method=\"SUBSCRIBE\" AND NOT Header = \"from\" Content = \"joe\")\nThe trigger can be split into the following atomic expressions:\nMethod=\"INVITE\"\nMethod=\"MESSAGE\"\nMethod=\"SUBSCRIBE\"\nNOT header=\"from\" Content =\"joe\"\nGrouping the atomic expressions, the CNF expression equivalent to the previous example looks like:\n(Method=\"INVITE\" OR Method = \"MESSAGE\" OR Method=\"SUBSCRIBE\") AND (Method=\"INVITE\" OR Method = \"MESSAGE\" OR (NOT Header = \"from\" Content = \"joe\"))\nThis result in two \"OR\" groups linked by \"AND\" (CNF):\n(Method=\"INVITE\" OR Method = \"MESSAGE\" OR Method=\"SUBSCRIBE\")\n(Method=\"INVITE\" OR Method = \"MESSAGE\" OR (NOT Header = \"from\" Content = \"joe\"))\nThe XML representation of the trigger is:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<IMSSubscription xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"CxDataType.xsd\">\n<PrivateID>IMPI1@homedomain.com</PrivateID>\n<ServiceProfile>\n<PublicIdentity>\n<BarringIndication>1</BarringIndication>\n<Identity> sip:IMPU1@homedomain.com </Identity>\n</PublicIdentity>\n<PublicIdentity>\n<Identity> sip:IMPU2@homedomain.com </Identity>\n</PublicIdentity>\n<InitialFilterCriteria>\n<Priority>0</Priority>\n<TriggerPoint>\n<ConditionTypeCNF>1</ConditionTypeCNF>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>0</Group>\n<Method>INVITE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>0</Group>\n<Method>MESSAGE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>0</Group>\n<Method>SUBSCRIBE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>1</Group>\n<Method>INVITE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>1</Group>\n<Method>MESSAGE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>1</ConditionNegated>\n<Group>1</Group>\n<SIPHeader>\n<Header>From</Header>\n<Content>\"joe\"</Content>\n</SIPHeader>\n</SPT>\n</TriggerPoint>\n<ApplicationServer>\n<ServerName>sip:AS1@homedomain.com</ServerName>\n<DefaultHandling>0</DefaultHandling>\n</ApplicationServer>\n</InitialFilterCriteria>\n</ServiceProfile>\n</IMSSubscription>\nA Boolean expression is said to be in Disjunctive Normal Form if it is expressed as a disjunction of conjunctions of literals (positive or negative atoms), i.e. as an OR of clauses, each of which is the AND of one of more atomic expressions.\nThe previous example is already in DNF, composed by the following groups:\nMethod=\"INVITE\"\nMethod=\"MESSAGE\"\nMethod=\"SUBSCRIBE\" AND (NOT header=\"from\" Content =\"joe\")\nThe XML representation of the trigger is:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<IMSSubscription xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"CxDataType.xsd\">\n<PrivateID>IMPI1@homedomain.com</PrivateID>\n<ServiceProfile>\n<PublicIdentity>\n<BarringIndication>1</BarringIndication>\n<Identity> sip:IMPU1@homedomain.com </Identity>\n</PublicIdentity>\n<PublicIdentity>\n<Identity> sip:IMPU2@homedomain.com </Identity>\n</PublicIdentity>\n<InitialFilterCriteria>\n<Priority>0</Priority>\n<TriggerPoint>\n<ConditionTypeCNF>0</ConditionTypeCNF>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>0</Group>\n<Method>INVITE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>1</Group>\n<Method>MESSAGE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>0</ConditionNegated>\n<Group>2</Group>\n<Method>SUBSCRIBE</Method>\n</SPT>\n<SPT>\n<ConditionNegated>1</ConditionNegated>\n<Group>2</Group>\n<SIPHeader>\n<Header>From</Header>\n<Content>\"joe\"</Content>\n</SIPHeader>\n</SPT>\n</TriggerPoint>\n<ApplicationServer>\n<ServerName>sip:AS1@homedomain.com</ServerName>\n<DefaultHandling index=\"0\">0</DefaultHandling>\n</ApplicationServer>\n</InitialFilterCriteria>\n</ServiceProfile>\n</IMSSubscription>\nAnnex D (informative):High-level format for the User Profile\nThe way the information shall be transferred through the Cx interface can be seen from a high-level point of view in the following picture:\nFigure D.1: Example of in-line format of user profile\nIf more than one service profile is created, for example to assign a different set of filters to public identifiers 1 and 2 and public identity 3, the information shall be packaged in the following way:\nFigure D.2: Example of in-line format of user profile\nAnnex E (normative):XML schema for the Cx interface user profile\nThe file CxDataType_Rel11.xsd, attached to this specification, contains the XML schema for the user profile that is sent over the Cx interface. The user profile XML schema defines that are used in the user profile XML. The data that is allowed to be sent in the user profile may vary depending on the features supported by the Diameter end points, see  TS 29.229 [5]. The user profile XML schema file is intended to be used by an XML parser. The version of the Cx application sending the user profile XML shall be the same as the version of the sent user profile XML and thus it implies the version of the user profile XML schema to be used to validate it.\nTable E.1 describes the data types and the dependencies among them that configure the user profile XML schema.\nTable E.1: XML schema for the Cx interface user profile: simple data types\nData type\nTag\nBase type\nComments\ntPriority\nPriority\ninteger\n>= 0\ntProfilePartIndicator\nProfilePartIndicator\nenumerated\nPossible values:\n0 (REGISTERED)\n1 (UNREGISTERED)\ntSharedIFCSetID\nSharedIFCSetID\ninteger\n>= 0\ntGroupID\nGroup\ninteger\n>= 0\ntRegistrationType\nRegistrationType\nenumerated\nPossible values:\n0 (INITIAL_REGISTRATION)\n1 (RE-REGISTRATION)\n2 (DE-REGISTRATION)\ntDefaultHandling\nDefaultHandling\nenumerated\nPossible values:\n0 (SESSION_CONTINUED)\n1 (SESSION_TERMINATED)\ntDirectionOfRequest\nSessionCase\nenumerated\nPossible values:\n0 (ORIGINATING_REGISTERED)\n1 TERMINATING_REGISTERED\n2 (TERMINATING_UNREGISTERED)\n3 (ORIGINATING_UNREGISTERED)\n4 (ORIGINATING_CDIV)\ntPrivateID\nPrivateID\nanyURI\nSyntax described in IETF RFC 2486 [14]\ntSIP_URL\nIdentity\nanyURI\nSyntax described in IETF RFC 3261 [11] or 3GPP TS 23003 (See Note 1)\ntTEL_URL\nIdentity\nanyURI\nSyntax described in IETF RFC 3966 [15] or 3GPP TS 23003 (See Note 1)\ntIdentity\nIdentity\n(union)\nUnion of tSIP_URL, and tTEL_URL\ntIdentityType\nIdentityType\nenumerated\nPossible values:\n0 (DISTINCT PUBLIC_USER_IDENTITY)\n1 (DISTINCT_PSI)\n2 (WILDCARDED_PSI) (See Note 2)\n3 (NON_DISTINCT_IMPU) (See Note 3)\n4 (WILDCARDED_IMPU) (See Note 4)\ntServiceInfo\nServiceInfo\nstring\ntString\nRequestURI, Method, Header, Content, Line, AccessType, AccessInfo, AccessValue\nstring\ntBool\nConditionTypeCNF, ConditionNegated, BarringIndication\nboolean\nPossible values:\n0 (false)\n1 (true)\ntSubscribedMediaProfileId\nSubscribedMediaProfileId\ninteger\n>=0\ntDisplayName\nDisplayName\nstring\ntAliasIdentityGroupID\nAliasIdentityGroupID\nstring\ntServiceLevelTraceInfo\nServiceLevelTraceInfo\nstring\nSyntax described in 3GPP TS 24.323 [32]\ntServicePriorityLevel\nServicePriorityLevel\nenumerated\nPossible values:\n0 (Highest priority)\n1\n2\n3\n4 (Lowest priority)\ntPriorityNamespace\nPriorityNamespace\nstring\nPossible values are those of the namespaces that are defined in IETF RFC 4412 [22] or defined according to the IANA registration procedure described in IETF RFC 4412 [22] for Resource-Priority Namespaces.\ntPriorityLevel\nPriorityLevel\nstring\nPossible values depend on the PriorityNamespace and are specified with the associated namespace that is defined in IETF RFC 4412 [22] or defined according to the IANA registration procedure described in IETF RFC 4412 [22] for Resource-Priority Namespaces\ntIMSI\nIMSI\nstring\nSyntax described in 3GPP TS 23.003 [17]. ASCII encoded according to ANSI X3.4 [26].\ntMaxNumOfAllowedSimultRegistrations\nMaxNumOfAllowedSimultRegistrations\ninteger\n>= 1\nNOTE 1:\tOnly when the \"Identity\" tag is a Wildcarded Identity the syntax is described in  1 23.003 [17]. It applies to both WILDCARDED_IMPU and WILDCARDED_PSI.\nNOTE 2:\tWildcarded PSI could optionally be included as well in tPublicIdentityExtension.\nNOTE 3:\tThe IMPU is not explicitly provisioned in HSS. In this case, corresponding Wildcarded IMPU is included in tPublicIdentityExtension3.\nNOTE 4:\tWILDCARDED_IMPU indicates that the content of the identity in the \"Identity\" tag is a Wildcarded Public User Identity. In this case, Wildcarded IMPU could optionally be included as well in tPublicIdentityExtension3.\nTable E.2: XML schema for the Cx interface user profile: complex data types\nData type\nTag\nCompound of\nTag\nType\nCardinality\ntIMSSubscription\nIMSSubscription\nPrivateID\ntPrivateID\n1\nServiceProfile\ntServiceProfile\n(1 to n)\nExtension\ntIMSSubscriptionExtension\n(0 to 1)\ntIMSSubscriptionExtension\nExtension\nIMSI\ntIMSI\n(0 to 1)\nExtension\ntIMSSubscriptionExtension2\n(0 to 1)\ntIMSSubscriptionExtension2\nExtension\nReferenceLocationInformation\ntReferenceLocationInformation\n(0 to n) (NOTE 5)\ntReferenceLocationInformation\nReferenceLocationInformation\nAccessType\ntString (NOTE 4)\n(0 to 1)\nAccessInfo\ntString (NOTE 4)\n(0 to 1)\nAccessValue\ntString (NOTE 4)\n(0 to 1)\ntServiceProfile\nServiceProfile\nPublicIdentity\ntPublicIdentity\n(1 to n\nCoreNetworkServicesAuthorization\nCoreNetworkServicesAuthorization\n(0 to 1\nInitialFilterCriteria\ntInitialFilterCriteria\n(0 to n)\nExtension\ntServiceProfileExtension\n(0 to 1)\ntServiceProfileExtension\nExtension\nSharedIFCSetID\ntSharedIFCSetID\n(0 to n)\ntCoreNetworkServicesAuthorization\nCoreNetworkServicesAuthorization\nSubscribedMediaProfileId\ntSubscribedMediaProfileId\n(0 to 1)\nExtension\ntCNServicesAuthorizationExtension\n(0 to 1)\ntPublicIdentity\nPublicIdentity\nBarringIndication\ntBool\n(0 to 1)\nIdentity\ntIdentity\n1\nExtension\ntPublicIdentityExtension\n(0 to 1)\ntInitialFilterCriteria\nInitialFilterCriteria\nPriority\ntPriority\n1\nTriggerPoint\ntTrigger\n(0 to 1)\nApplicationServer\ntApplicationServer\n1\nProfilePartIndicator\ntProfilePartIndicator\n(0 to 1)\ntTrigger\nTriggerPoint\nConditionTypeCNF\ntBool\n1\nSPT\ntSePoTri\n(1 to n)\ntSePoTri\nSPT\nConditionNegated\ntBool\n(0 to 1)\nGroup\ntGroupID\n(1 to n\nChoice of\nRequestURI\ntString\n1\nMethod\ntString\n1\nSIPHeader\ntHeader\n1\nSessionCase\ntDirectionOfRequest\n1\nSessionDescription\ntSessionDescription\n1\nExtension\ntSePoTriExtension\n(0 to 1)\ntSePoTriExtension\nExtension\nRegistrationType\ntRegistrationType\n(0 to 2)\ntHeader\nSIPHeader\nHeader\ntString\n1\nContent\ntString\n(0 to 1)\ntSessionDescription\nSessionDescription\nLine\ntString\n1\nContent\ntString\n(0 to 1)\ntApplicationServer\nApplicationServer\nServerName\ntSIP_URL\n1\nDefaultHandling\ntDefaultHandling\n(0 to 1)\nServiceInfo\ntServiceInfo\n(0 to 1)\nExtension\ntApplicationServerExtension\n(0 to 1)\ntApplicationServerExtension\nExtension\nIncludeRegisterRequest\ntIncludeRegisterRequest\n(0 to 1)\nIncludeRegisterResponse\ntIncludeRegisterResponse\n(0 to 1)\ntIncludeRegisterRequest\nIncludeRegisterRequest\n(NOTE 2)\n(NOTE 2)\n(0 to 1)\ntIncludeRegisterResponse\ntIncludeRegisterResponse\n(NOTE 2)\n(NOTE 2)\n(0 to 1)\ntPublicIdentityExtension\nExtension\nIdentityType\ntIdentityType\n(0 to 1)\nWildcardedPSI\nanyURI (NOTE 3)\n(0 to 1)\nExtension\ntPublicIdentityExtension2\n(0 to 1)\ntPublicIdentityExtension2\nExtension\nDisplayName\ntDisplayName\n(0 to 1)\nAliasIdentityGroupID\ntAliasIdentityGroupID\n(0 to 1)\nExtension\ntPublicIdentityExtension3\n(0 to 1)\ntPublicIdentityExtension3\nExtension\nWildcardedIMPU\nanyURI (NOTE 3)\n(0 to 1)\nServiceLevelTraceInfo\ntServiceLevelTraceInfo\n(0 to 1)\nServicePriorityLevel\nServicePriorityLevel\n(0 to 1)\nExtension\ntPublicIdentityExtension4\n(0 to 1)\ntPublicIdentityExtension4\nExtension\nExtendedPriority\ntExtendedPriority\n(0 to n)\nExtension\ntPublicIdentityExtension5\n(0 to 1)\ntPublicIdentityExtension5\nExtension\nMaxNumOfAllowedSimultRegistrations\ntMaxNumOfAllowedSimultRegistrations\n(0 to 1)\ntExtendedPriority\nExtendedPriority\nPriorityNamespace\ntPriorityNamespace\n1\nPriorityLevel\ntPriorityLevel\n1\ntCNServicesAuthorizationExtension\nExtension\nListOfServiceIds\ntListOfServiceIds\n(0 to 1)\ntListOfServiceIds\nListOfServiceIds\nServiceId\ntString\n(0 to n)\nNOTE 1:\t\"n\" shall be interpreted as non-bounded.\nNOTE 2:\tempty cells shall be interpreted as complex XML elements without defined content.\nNOTE 3:\tthe syntax of Wildcarded Public User Identity and Wildcarded Service Identity shall be as described in 3GPP TS 23.003 [17].\nNOTE 4:\tthe syntax of AccessType, AccessInfo and AccessValue is as described in 3GPP TS 24.229 [8] for P-Access-Network-Info header fields: AccessType corresponds to the \"access-type\" field whereas AccessInfo and AccessValue correspond to the type and associated value defined for the \"access-info\" field.\nNOTE 5:\tthe HSS shall not send more than one instance of ReferenceLocationInformation and if the S-CSCF receives more than one instance of ReferenceLocationInformation it may arbitrarily pick one for further processing.\nAnnex F (normative):Definition of parameters for service point trigger matching\nTable F.1 defines the parameters that are transported in the user profile XML.\nTable F.1: Definition of parameters in the user profile XML\nTag\nDescription\nRequestURI\nRequestURI tag shall include a regular expression in a form of Extended Regular Expressions (ERE) as defined in clause 9 in IEEE 1003.1-2004 Part 1 [13]. For SIP URI, the regular expression shall be matched against the hostport of the SIP-URI. For definition of SIP-URI and hostport, see IETF RFC 3261 [11]. For Tel URI, the regular expression shall be matched against the telephone-subscriber of the telephone-uri. For definition of telephone-subscriber and telephone-uri, see IETF RFC 3966 [15].\nSIPHeader\nA SIP Header SPT shall be evaluated separately against each header instance within the SIP message. The SIP Header SPT matches if at least one header occurrence matches the SPT.\nHeader (of SIPHeader)\nHeader tag shall include a regular expression in a form of Extended Regular Expressions (ERE) as defined in clause 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be matched against the header-name of the SIP header. For definition of header and header-name, see IETF RFC 3261 [11]. Before matching the header-name to the pattern, all SWSs shall be removed from the header-name and all LWSs in the header-name shall be reduced to a single white space character (SP). For definition of SWS and LWS, see IETF RFC 3261 [11].\nContent (of SIPHeader)\nContent tag shall include a regular expression in a form of Extended Regular Expressions (ERE) as defined in clause 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be matched against the header-value of the SIP header. For definition of header and header-value, see IETF RFC 3261 [11]. If the SIP header contains several header-values in a comma-separated list, each of the header-value shall be matched against the pattern for the Content separately. Before matching the header-value to the pattern, all SWSs shall be removed from the header-value and all LWSs in the header-value shall be reduced to a single white space character (SP). For definition of SWS and LWS, see IETF RFC 3261 [11].\nSessionDescription\nA Session Description SPT shall be evaluated separately against each SDP field instance within the SIP message. The Session Description SPT matches if at least one field occurrence matches the SPT.\nLine (of SessionDescription)\nLine tag shall include a regular expression in a form of Extended Regular Expressions (ERE) as defined in clause 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be matched against the type of the field inside the session description. For definition of type, see clause 6 in IETF RFC 4566 [12].\nContent (of SessionDescription)\nContent tag shall include a regular expression in a form of Extended Regular Expressions (ERE) as defined in clause 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be matched against the value of the field inside the session description. For definition of value, see clause 6 in IETF RFC 4566 [12].\nAnnex G (normative):Emergency registrations\nS-CSCF and HSS shall handle emergency registrations as normal registrations with the following considerations:\n-\tUpon emergency registration, following cases apply:\n-\tIf a normal registration for the same user does not exist, the S-CSCF shall download corresponding user profile from HSS, ensure that the HSS allocates S-CSCF name to this subscriber and the registration status is set to UNREGISTERED.\n-\tOtherwise, the S-CSCF shall ensure that the registration status of the user is not changed in the HSS.\n-\tUpon deregistration or expiration of the last normal session, if an emergency registration is still active for this subscriber, the S-CSCF shall ensure that the HSS keeps S-CSCF name allocated to this subscriber and the registration status is set to UNREGISTERED.\n-\tUpon expiration of an emergency registration, the S-CSCF shall ensure the registration status of the user is not changed in the HSS if there are other normal registrations of the user. Otherwise, the S-CSCF may send SAR to the HSS to remove its name and set the registration status of the user to NOT REGISTERED.\n-\tIMS Restoration procedures do not apply for IMS emergency sessions.\nAnnex H (normative):Diameter overload control mechanism\nH.1\tGeneral\nDiameter overload control mechanism is an optional feature.\nIETF RFC 7683 [24] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\nIt is recommended to make use of IETF RFC 7683 [24] on the Cx interface where, when applied, the I/S-CSCF shall behave as reacting nodes and the HSS as a reporting node.\nDepending on regional/national requirements and network operator policy, priority traffic (e.g. MPS as described in  TS 22.153 [25]) shall be exempted from throttling due to Diameter overload control up to the point where requested traffic reduction cannot be achieved without throttling the priority traffic.\nH.2\tHSS behaviour\nThe HSS requests traffic reduction from the I/S-CSCF when the HSS is in an overload situation, including OC-OLR AVP in answer commands as described in IETF RFC 7683 [24].\nThe HSS identifies that it is in an overload situation by implementation specific means. For example, the HSS may take into account the traffic over the Cx interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources, etc.\nThe HSS determines the specific contents of OC-OLR AVP in overload reports and the HSS decides when to send OC-OLR AVPs by implementation specific means.\nH.3\tI/S-CSCF behaviour\nThe I/S-CSCF applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [24].\nThe I/S-CSCF achieves requested traffic reduction by implementation specific means. For example, the I/S-CSCF may implement message throttling with prioritization or a message retaining mechanism for operations that can be postponed.\nDiameter requests related to priority traffic (e.g. MPS) and emergency, detected via the presence of priority information (e.g., Resource-Priority header field for MPS) in SIP messages as described in  TS 24.229 [8], have the highest priority. Depending on regional/national regulatory and operator policies, these Diameter requests shall be the last to be throttled, when the I/S-CSCF has to apply traffic reduction. Relative priority amongst various priority traffic (e.g. MPS) and emergency traffic is subject to regional/national regulatory and operator policies.\nAnnex I (Informative):Diameter overload node behaviour\nI.1\tMessage prioritization\nThis clause describes possible behaviours of the I/S-CSCF regarding message prioritisation in an informative purpose.\nThe I/S-CSCF may take the following into account when making throttling decisions:\n-\tIdentification of the procedures that can be deferred (e.g. Deregistration Request), so to avoid to drop non deferrable procedures;\n-\tPrioritisation of certain types of request (e.g. between MAR and SAR for S-CSCF, and between LIR and UAR for I-CSCF) according to the context of their use, in particular:\n-\tHigher prioritisation of SAR commands for S-CSCF that are related to a registered user for a service, so to avoid the interruption of the registered service for the user;\n-\tHigher prioritisation of LIR commands for I-CSCF that are related to a requested service different from registration or deregistration, so to get more originating or terminating services provided to the user;\n-\tSkipping of optional authentication.\n-\tPriority level of a priority user (e.g., MPS user).\nAnnex J (normative):Diameter message priority mechanism\nJ.1\tGeneral\nIETF RFC 7944 [27] specifies a Diameter message priority mechanism that allows Diameter nodes to indicate the relative priority of Diameter messages. With this information, other Diameter nodes may leverage the relative priority of Diameter messages into routing, resource allocation, set the DSCP marking for transport of the associated Diameter message, and also abatement decisions when overload control is applied.\nJ.2\tCx/Dx interfaces\nJ.2.1\tGeneral\nThe Diameter message priority mechanism is an optional feature.\nIt is recommended to make use of IETF RFC 7944 [27] over the Cx/Dx interfaces of an operator network when the overload control defined in Annex H is applied on these Cx/Dx interfaces.\nJ.2.2\tS-CSCF/I-CSCF behaviour\nWhen the S-CSCF/I-CSCF supports the Diameter message priority mechanism, the S-CSCF/I-CSCF shall comply with IETF RFC 7944 [27].\nThe S-CSCF/I-CSCF sending a request shall determine the required priority according to its policies. When priority is required, the S-CSCF/I-CSCF shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to the required priority level.\nWhen the S-CSCF/I-CSCF receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen the S-CSCF/I-CSCF receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\tthe S-CSCF/I-CSCF supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the S-CSCF/I-CSCF shall set the DSCP marking for transport of the request or response according to the required priority level.\nDiameter requests related to priority traffic (e.g. MPS as identified by the S-CSCF/I-CSCF through SIP procedures, emergency) shall contain a DRMP AVP with a high priority of which the level value is operator dependent.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\nJ.2.3\tHSS/SLF behaviour\nWhen the HSS/SLF supports the Diameter message priority mechanism, the HSS/SLF shall comply with IETF RFC 7944 [27].\nThe HSS/SLF sending a request shall determine the required priority according to its policies. When priority is required, the HSS/SLF shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to the required priority level.\nWhen the HSS/SLF receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen the HSS/SLF receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\tthe HSS/SLF supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the HSS/SLF shall set the DSCP marking for transport of the request or response according to the required priority level.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\nJ.2.4\tInteractions\nIf the HSS supporting the Diameter message priority mechanism receives the request message containing both the Session-Priority AVP and DRMP AVP, the HSS shall prioritize the request according to priority level received within the DRMP AVP.\nAnnex K (normative):Diameter load control mechanism\nK.1\tGeneral\nThe Diameter load control mechanism is an optional feature.\nIt is recommended to make use of IETF IETF RFC 8583 [29] on the Cx interface where, when applied, the I-CSCF and the S-CSCF shall behave as reacting nodes and the HSS as a reporting node.\nK.2\tHSS behaviour\nThe HSS may report its current load by including a Load AVP of type HOST in answer commands as described in IETF IETF RFC 8583 [29].\nThe HSS calculates its current load by implementation specific means. For example, the HSS may take into account the traffic over the Cx interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe HSS determines when to send Load AVPs of type HOST by implementation specific means.\nK.3\tI-CSCF/S-CSCF behaviour\nWhen performing next hop Diameter Agent selection for requests that are routed based on realm, the I-CSCF/S-CSCF may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF IETF RFC 8583 [29].\nAnnex L (informative):Change history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nCat\nSubject/Comment\nNew\nJun 2002\nCN#16\nNP-020264\nVersion 2.0.0 approved at CN#16\n5.0.0\nSep 2002\nCN#17\nNP-020449\n001\n2\nClarification of implicit registration\n5.1.0\nSep 2002\nCN#17\nNP-020449\n002\n1\nClarification of user registration status query\n5.1.0\nSep 2002\nCN#17\nNP-020449\n003\n1\nClarification of HSS initiated update of user profile\n5.1.0\nSep 2002\nCN#17\nNP-020449\n004\n2\nClarification of MAR command\n5.1.0\nSep 2002\nCN#17\nNP-020449\n005\n1\nConditionality of the SIP-Auth-Data-Item in MAA command\n5.1.0\nDec 2002\nCN#18\nNP-020587\n008\n2\nRejection of registration of a Temporary Public Identity without active implicit registration\n5.2.0\nDec 2002\nCN#18\nNP-020587\n010\n-\nRemoval of upper bounds in Cx i/f user profile\n5.2.0\nDec 2002\nCN#18\nNP-020587\n011\n-\nS-CSCF Assignment\n5.2.0\nDec 2002\nCN#18\nNP-020587\n012\n-\nNAS-Session-Key AVPs in MAA command\n5.2.0\nDec 2002\nCN#18\nNP-020587\n013\n1\nCorrection to detailed behaviour of user registration status query\n5.2.0\nDec 2002\nCN#18\nNP-020587\n014\n1\nRemoving the DDF dependencies from Cx interface\n5.2.0\nDec 2002\nCN#18\nNP-020587\n015\n1\nClarification of SERVER_CHANGE de-registration reason code\n5.2.0\nDec 2002\nCN#18\nNP-020589\n016\n1\nClarification of User-Authorization-Type AVP usage within the UAR\n5.2.0\nDec 2002\nCN#18\nNP-020587\n017\n1\nCorrection to HSS initiated update of user profile\n5.2.0\nDec 2002\nCN#18\nNP-020588\n019\n-\nCorrection in charging information\n5.2.0\nDec 2002\nCN#18\nNP-020590\n020\n1\nError handling in S-CSCF when receiving too much data\n5.2.0\nDec 2002\nCN#18\nNP-020587\n021\n1\nRe-allocation of S-CSCF\n5.2.0\nDec 2002\nCN#18\nNP-020591\n022\n-\nCorrection of the SPI\n5.2.0\nMar 2003\nCN#19\nNP-030101\n025\n1\nClarification of service profile download at service profile modification\n5.3.0\nMar 2003\nCN#19\nNP-030101\n028\n-\nFilter ID field removal in InitialFilterCriteria class\n5.3.0\nMar 2003\nCN#19\nNP-030101\n030\n1\nClarification of IMPU barring handling\n5.3.0\nMar 2003\nCN#19\nNP-030101\n032\n1\nThe default public user identity in the Server-Assignment-Answer\n5.3.0\nMar 2003\nCN#19\nNP-030101\n034\n2\nCorrections to service profile\n5.3.0\nMar 2003\nCN#19\nNP-030101\n037\n3\nHandling of non supported data in the S-CSCF when the profile is being updated\n5.3.0\nMar 2003\nCN#19\nNP-030101\n024\n1\nClarification of the HSS behaviour in REGISTRATION and DE_REGISTRATION procedures at IMPU checking time.\n5.3.0\nMar 2003\nCN#19\nNP-030101\n027\n-\nDeletion of Annex F\n5.3.0\nMar 2003\nCN#19\nNP-030101\n029\n-\nClarification of User-Authorization-Type AVP usage within UAR\n5.3.0\nMar 2003\nCN#19\nNP-030101\n031\n1\nUpdate TS 29.228 after Diameter has become RFC\n5.3.0\nMar 2003\nCN#19\nNP-030101\n033\n1\nReplacement of the NAS-Session-Key AVP\n5.3.0\nMar 2003\nCN#19\nNP-030101\n035\n2\nClarification on Re-allocation of S-CSCF\n5.3.0\nMar 2003\nCN#19\nNP-030101\n038\n1\nChange of SPI to SPT\n5.3.0\nMar 2003\nCN#19\nNP-030101\n040\n1\nDefinition of the Subscribed Media Profile Identifier\n5.3.0\nMar 2003\nCN#19\nNP-030101\n026\n-\nError in definition of Service Point of Interest class\n5.3.0\nJun 2003\nCN#20\nNP-030215\n043\n-\nCorrect use of the Result-Code AVP\n5.4.0\nJun 2003\nCN#20\nNP-030215\n044\n1\nConditionality of User-Name AVP in Server-Assignment-Answer\n5.4.0\nJun 2003\nCN#20\nNP-030215\n045\n2\nCorrections to the base 64 encoding examples\n5.4.0\nJun 2003\nCN#20\nNP-030215\n046\n1\nDeregistration of implicitly registered public user identities\n5.4.0\nJun 2003\nCN#20\nNP-030215\n047\n-\nClarification on the Server-Assignment-Type NO_ASSIGNMENT\n5.4.0\nJun 2003\nCN#20\nNP-030215\n048\n1\nIncorrect use of result-code\n5.4.0\nJun 2003\nCN#20\nNP-030215\n049\n1\nMisalignment in the Public-User-Identity IE\n5.4.0\nJun 2003\nCN#20\nNP-030215\n050\n1\nDuplicated Destination-Host AVP within MAR command code\n5.4.0\nSep 2003\nCN#21\nNP-030383\n042\n3\nError in S-CSCF Assignment Type\n5.5.0\nSep 2003\nCN#21\nNP-030383\n051\n2\nMistakes in the XML schema of 29.228-540\n5.5.0\nSep 2003\nCN#21\nNP-030383\n055\n1\nExtensibility of the public identity structure in the XML schema\n5.5.0\nSep 2003\nCN#21\nNP-030394\n041\n2\nIntroduction of Presence Stage 3 (Px) to the Cx interface\n6.0.0\nSep 2003\nCN#21\nNP-030394\n052\n-\nSharing public identities across multiple UEs\n6.0.0\nDec 2003\nCN#22\nNP-030585\n057\n3\nConditions for inclusion of Charging Information\n6.1.0\nDec 2003\nCN#22\nNP-030500\n060\n1\nMAR in synchronisation failure case\n6.1.0\nDec 2003\nCN#22\nNP-030500\n061\n1\nThe S-CSCF name needs to be checked always in MAR\n6.1.0\nDec 2003\nCN#22\nNP-030500\n063\n-\nConditional AVPs in answer commands\n6.1.0\nDec 2003\nCN#22\nNP-030500\n065\n1\nServer-Assignment-Request\n6.1.0\nDec 2003\nCN#22\nNP-030500\n067\n-\nDetermination of User-Authorization-Type AVP based on registration expiration\n6.1.0\nDec 2003\nCN#22\nNP-030500\n069\n2\nNot registered state after deregistration with S-CSCF deleted at the HSS\n6.1.0\nDec 2003\nCN#22\nNP-030500\n071\n-\nThe extensibility of the XML schema\n6.1.0\nDec 2003\nCN#22\n-\nReference [9] updated\n6.1.0\nMar 2004\nCN#23\nNP-040046\n077\n1\nClarification on S-CSCF-Name comparison\n6.2.0\nMar 2004\nCN#23\nNP-040055\n081\n-\nError for missing identification in SAR command\n6.2.0\nMar 2004\nCN#23\nNP-040046\n085\n1\nConditions for inclusion of Public Identity in SAR\n6.2.0\nMar 2004\nCN#23\nNP-040046\n087\n1\nCorrection to sending the Charging-Information AVP\n6.2.0\nMar 2004\nCN#23\nNP-040046\n089\n-\nCorrection to User-Authorization-Answer\n6.2.0\nMar 2004\nCN#23\nNP-040046\n091\n-\nDefault handling of error cases during IMS registration\n6.2.0\nJun 2004\nCN#24\nNP-040215\n097\n2\nUpdate of the charging addresses from HSS\n6.3.0\nJun 2004\nCN#24\nNP-040215\n095\n1\nContent of the User Profile\n6.3.0\nJun 2004\nCN#24\nNP-040215\n099\n-\nCorrection of SessionCase attribute ambiguity\n6.3.0\nSep 2004\nCN#25\nNP-040416\n109\n1\nLIR and services related to unregistered state\n6.4.0\nSep 2004\nCN#25\nNP-040401\n121\n2\nTriggering initial REGISTER messages\n6.4.0\nSep 2004\nCN#25\nNP-040401\n118\n1\nXML versioning\n6.4.0\nSep 2004\nCN#25\nNP-040401\n122\n1\nOptimization of User Profile Download\n6.4.0\nSep 2004\nCN#25\nNP-040396\n124\n2\nSimplification of the User Profile Split concept\n6.4.0\nSep 2004\nCN#25\nNP-040416\n120\n3\nUse of regular expressions\n6.4.0\nDec 2004\nCN#26\nNP-040523\n138\n1\nHSS initiated deregistration with \"not registered\" registration state\n6.5.0\nDec 2004\nCN#26\nNP-040530\n140\n1\nHSS initiated deregistration with user profile removal for permanent termination\n6.5.0\nDec 2004\nCN#26\nNP-040523\n142\n2\nHSS initiated deregistration using the network initiated de-registration procedure\n6.5.0\nDec 2004\nCN#26\nNP-040530\n146\n1\nClarification of R6 authentication scheme\n6.5.0\nDec 2004\nCN#26\nNP-040523\n150\n-\nRegular Expressions\n6.5.0\nDec 2004\nCN#26\nNP-040530\n155\n-\nCorrection to XML Root Element\n6.5.0\nDec 2004\nCN#26\nNP-040530\n156\n1\nModification of User-Data-Already-Available in SAR command.\n6.5.0\nDec 2004\nCN#26\nNP-040523\n159\n2\nHandling of Information Element marked as (M), (C) or (O)\n6.5.0\nMar 2005\nCN#27\nNP-050030\n166\n-\nAvoiding undesired deregistration\n6.6.0\nMar 2005\nCN#27\nNP-050030\n168\n1\nCorrection to authentication procedures in not registered case\n6.6.0\nMar 2005\nCN#27\nNP-050037\n170\n3\nClarification of behaviour for Shared Public User Identities\n6.6.0\nMar 2005\nCN#27\nNP-050037\n172\n-\nDistribution of Cipher Key and Integrity Key\n6.6.0\nApr 2005\nEditorial correction on figure figure A.4.1.1 and on clauses: 6.1.4.1, 6.2.2, B.2.1 and 6.2.1.1\n6.6.1\nJun 2005\nCT#28\nCP-050086\n181\n-\nTEL-URI reference correction\n6.7.0\nJun 2005\nCT#28\nCP-050086\n183\n-\nClarification on Server Capabilities\n6.7.0\nJun 2005\nCT#28\nCP-050086\n185\n-\nIncorrect Implementation of CR172\n6.7.0\nJun 2005\nCT#28\nCP-050081\n188\n1\nClarification of the content of SIP-Authentication-Context\n6.7.0\nJun 2005\nCT#28\nCP-050086\n192\n-\nSyntax correction for XML\n6.7.0\nSep 2005\nCT#29\nCP-050422\n196\n-\nAuthentication Registration with synchronization failure, Data requested from HSS\n6.8.0\nSep 2005\nCT#29\nCP-050296\n200\nCorrection to XML Schema for SharedIFCSet\n6.8.0\nSep 2005\nCT#29\nCP-050440\n202\n2\nPrivate identities on the Cx\n6.8.0\nSep 2005\nCT#29\nCP-050282\n204\n1\nCharging-Information correction\n6.8.0\nSep 2005\nCT#29\nCP-050296\n207\n1\nCorrections to UAR and LIR for shared public identities\n6.8.0\nSep 2005\nCT#29\nCP-050422\n208\n1\nBehaviour of the Implicit Registration Set for the Unregistered state\n6.8.0\nSep 2005\nCT#29\nCP-050296\n210\n-\nChange of stage 2 reference from Release 5 to Release 6\n6.8.0\nSep 2005\nCT#29\nCP-050294\n211\n-\nPSI Activation\n6.8.0\nSep 2005\nCT#29\nCP-050271\n213\n2\nRemoval of redundant restrictions for one Public User Identity in SAR\n6.8.0\nSep 2005\nCT#29\nCP-050296\n216\n-\nError code clean up\n6.8.0\nSep 2005\nCT#29\nCP-050296\n217\n1\nClarification of User Profile update\n6.8.0\nDec 2005\nCT#30\nCP-050604\n198\n5\nXML syntax correction\n6.9.0\nDec 2005\nCT#30\nCP-050611\n220\n1\nPSI impacts on the Cx Interface\n6.9.0\nDec 2005\nCT#30\nCP-050611\n221\n3\nRouting for PSIs Matching a Wildcarded PSI\n6.9.0\nDec 2005\nCT#30\nCP-050611\n222\n2\nRemoval of overhead in Private Identities handling in RTR\n6.9.0\nDec 2005\nCT#30\nCP-050605\n229\n2\nUse-Data description corrections\n6.9.0\nDec 2005\nCT#30\nCP-050605\n232\n2\nS-CSCF assignment checking for notregistered state\n6.9.0\nDec 2005\nCT#30\nCP-050605\n236\n4\nRTR correction\n6.9.0\nDec 2005\nCT#30\nCP-050605\n238\n1\nPPR correction\n6.9.0\nDec 2005\nCT#30\nCP-050611\n239\n1\nPrivate User Id in RTR\n6.9.0\nDec 2005\nCT#30\nCP-050611\n246\n1\nServer capabilities associations with features\n6.9.0\nDec 2005\nCT#30\nRel-7 version was created because of ETSI TISPAN references.\n7.0.0\nMar 2006\nCT#31\nCP-060084\n0243\n1\nSPT for mobile orig unregistered\n7.1.0\nMar 2006\nCT#31\nCP-060159\n0247\n2\nRemoval of the terms Mobile Originated and Mobile Terminated\n7.1.0\nMar 2006\nCT#31\nCP-060154\n0254\n-\nAlignment of Annex E with .xsd file\n7.1.0\nMar 2006\nCT#31\nCP-060154\n0256\n-\nIncorrect implementation of CR 0198\n7.1.0\nMar 2006\nCT#31\nCP-060065\n0260\n2\nHandling of unknown errors\n7.1.0\nMar 2006\nCT#31\nCP-060154\n0263\n2\nPrivate User ID in PPR and RTR\n7.1.0\nMar 2006\nCT#31\nCP-060065\n0269\n-\nMessage flow correction\n7.1.0\nMar 2006\nCT#31\nCP-060065\n0274\n-\nDefault public-id and PPR\n7.1.0\nJun 2006\nCT#32\nCP-060302\n0285\n-\nS-CSCF reselection removal\n7.2.0\nJun 2006\nCT#32\nCP-060308\n0290\n3\nCorrection of the normative text in the table 6.7\n7.2.0\nJun 2006\nCT#32\nCP-060308\n0292\n2\nUsing SiFC feature to define optional S-CSCF capabilities\n7.2.0\nSep 2006\nCT#33\nCP-060308\n0296\n-\nS-CSCF assignment correction\n7.3.0\nSep 2006\nCT#33\nCP-060405\n0299\n-\nDefault Public User ID either SIP URI or tel URI\n7.3.0\nSep 2006\nCT#33\nCP-060399\n0304\n1\nBarring Indication for public user identity\n7.3.0\nSep 2006\nCT#33\nCP-060417\n0306\n2\nDeletion of description about Authentication-Data-Item\n7.3.0\nSep 2006\nCT#33\nCP-060399\n0313\n1\nRegistration message flow correction\n7.3.0\nSep 2006\nCT#33\nCP-060417\n0314\n4\nAS originating requests on behalf of a user\n7.3.0\nSep 2006\nCT#33\nCP-060416\n0317\n2\nAllowing a Display Name to be associated with a Public Identity.\n7.3.0\nSep 2006\nCT#33\nCP-060417\n0320\n-\nUpdate of the Table 6.7 \"Guidelines for S-CSCF Capabilities\"\n7.3.0\nDec 2006\nCT#34\nCP-060553\n0325\n1\nSDP reference correction\n7.4.0\nDec 2006\nCT#34\nCP-060566\n0326\n1\nNew message flow about AS originating session\n7.4.0\nDec 2006\nCT#34\nCP-060566\n0327\n1\nCorrection of Private Identity description in SAR\n7.4.0\nDec 2006\nCT#34\nCP-060566\n0330\n3\nCorrection of error code in SAA\n7.4.0\nDec 2006\nCT#34\nCP-060566\n0332\n1\nClarification on use of Authentication pending flag\n7.4.0\nDec 2006\nCT#34\nCP-060566\n0336\n3\nOptimization of handling of Wildcarded PSIs\n7.4.0\nDec 2006\nCT#34\nCP-060555\n0338\n1\nWildcarded PSI as key in PPR\n7.4.0\nDec 2006\nCT#34\nCP-060553\n0342\n1\nCorrection of the HSS behaviour in UAR/UAA command pair\n7.4.0\nDec 2006\nCT#34\nCP-060735\n0343\n3\nClarification regarding URI canonicalization – 29.228\n7.4.0\nMar 2007\nCT#35\nCP-070020\n0346\n3\nClarification of the server name in LIA\n7.5.0\nMar 2007\nCT#35\nCP-070020\n0350\n3\nUser profile data synchronisation\n7.5.0\nMar 2007\nCT#35\nCP-070020\n0352\n-\nSAA result code correction\n7.5.0\nMar 2007\nCT#35\nCP-070019\n0353\n2\nRemoval of roaming restrictions for Emergency Registrations\n7.5.0\nMar 2007\nCT#35\nCP-070020\n0354\n-\nDefinition and use of the Wildcarded PSI information element\n7.5.0\nJun 2007\nCT#36\nCP-070309\n0358\n1\nRemoval of editor's note on IMS Recovery Procedures\n7.6.0\nJun 2007\nCT#36\nCP-070479\n0359\n2\nImpacts of the IMS Communication Service Identifier\n7.6.0\nJun 2007\nCT#36\nCP-070309\n0361\n2\nClarification on LIA\n7.6.0\nJun 2007\nCT#36\nCP-070309\n0365\n1\nAdding User-Authorization-Type is absent condition to UAR Detailed behaviour\n7.6.0\nJun 2007\nCT#36\nCP-070312\n0367\n-\nModification to the tag RegistrationtType to RegistrationType in the Annex E\n7.6.0\nSep 2007\nCT#37\nCP-070520\n0374\n1\nAuthentication failure and timeout handling\n7.7.0\nSep 2007\nCT#37\nCP-070522\n0378\n-\nIncorrect implemented CR 120r3\n7.7.0\nSep 2007\nCT#37\nCP-070527\n0379\n-\nUser Data Already Available\n7.7.0\nNov 2007\nCT#38\nCP-070743\n0388\n1\nHandling of USER_UNKNOWN and NOT_SUPPORTED_USER_DATA error in PPA\n7.8.0\nNov 2007\nCT#38\nCP-070744\n0392\n2\nAlias\n7.8.0\nNov 2007\nCT#38\nCP-070755\n0376\n6\nUpdates to 29.228 for Digest on the Cx Interface\n8.0.0\nMar 2008\nCT#39\nCP-080019\n0393\n1\nIMS Restoration after an S-CSCF failure\n8.1.0\nMar 2008\nCT#39\nCP-080022\n0395\n2\nUpdate for Supporting NASS-Bundled-Authentication\n8.1.0\nMar 2008\nCT#39\nCP-080019\n0398\n-\nSIP Digest password push\n8.1.0\nMar 2008\nCT#39\nCP-080019\n0400\n1\nWildcarded Public User Identities\n8.1.0\nJun 2008\nCT#40\nCP-080261\n0399\n3\nOriginating services after call forwarding\n8.2.0\nJun 2008\nCT#40\nCP-080261\n0406\nXML example\n8.2.0\nJun 2008\nCT#40\nCP-080267\n0408\nEmergency Registration for REGISTRATION_AND_CAPABILITIES\n8.2.0\nJun 2008\nCT#40\nCP-080267\n0410\nRemoval of restriction for barred user at Emergency Registrations\n8.2.0\nSep 2008\nCT#41\nCP-080456\n0413\n2\nEmergency Public User Identity removal\n8.3.0\nSep 2008\nCT#41\nCP-080460\n0420\n1\nSupport of \"Loose-Route\" indication from HSS\n8.3.0\nSep 2008\nCT#41\nCP-080463\n0421\nCx Impacts of IMS Restoration Procedures\n8.3.0\nSep 2008\nCT#41\nCP-080460\n0423\n2\nFilter Criteria enhancement for 3rd party REGISTER\n8.3.0\nSep 2008\nCT#41\nCP-080463\n0425\n1\nAddition of Registered Private Identities in SAA\n8.3.0\nSep 2008\nCT#41\nCP-080460\n0426\n1\nAdd Assigned S-CSCF name to SAA\n8.3.0\nDec 2008\nCT#42\nCP-080698\n0427\n2\nService Restoration for Registered IMPU\n8.4.0\nDec 2008\nCT#42\nCP-080707\n0431\n2\nSupport for IMS Service Level Trace\n8.4.0\nDec 2008\nCT#42\nCP-080708\n0432\nRemoval of Digest Domain\n8.4.0\nDec 2008\nCT#42\nCP-080696\n0433\n3\nDiameter Proxy Agent - an alternative User Identity to HSS resolution mechanism\n8.4.0\nDec 2008\nCT#42\nCP-080708\n0434\n2\nS-CSCF and AS procedures with Enhanced Filter Criteria\n8.4.0\nMar 2009\nCT#43\nCP-090023\n0435\n1\nPriority Service\n8.5.0\nMar 2009\nCT#43\nCP-090026\n0436\n1\nMultiple Registrations in Registration\n8.5.0\nMar 2009\nCT#43\nCP-090036\n0440\n2\nHSS Addresses\n8.5.0\nMar 2009\nCT#43\nCP-090025\n0441\n1\nLoose Route Indication\n8.5.0\nMar 2009\nCT#43\nCP-090028\n0442\n2\nSupport for GPRS IMS Bundled Authentication (GIBA) in Cx\n8.5.0\nSep 2009\nCT#45\nCP-090728\n0447\n1\nIncorrect CR implementation\n8.6.0\nDec 2009\nCT#46\n0452\n1\nUnregistered user clarification\n8.7.0\nDec 2009\nCT#46\n0456\n2\nSession-Priority AVP\n8.7.0\nDec 2009\nCT#46\n0457\n2\nHSS behaviour after PPA with unknown user\n8.7.0\nDec 2009\nCT#46\n0458\n1\nCheck of the S-CSCF Name\n8.7.0\nDec 2009\nCT#46\n0460\nIMPI must be sent in SAR for UE initiated requests\n8.7.0\nDec 2009\nCT#46\nUpgraded unchanged from Rel-8\n9.0.0\nMar 2010\nCT#47\nCP-100033\n0462\nDefault IMPU\n9.1.0\nMar 2010\nCT#47\nCP-100031\n0468\n1\nWildcarded Public Identity\n9.1.0\nMar 2010\nCT#47\nCP-100033\n0470\n1\nPriority service attribute\n9.1.0\nMar 2010\nCT#47\nCP-100033\n0474\n1\nUser-Auth-Type not checked\n9.1.0\nMar 2010\nCT#47\nCP-100033\n0476\n1\nGIBA is not allowed when auth. Scheme is Unknown\n9.1.0\nMar 2010\nCT#47\nCP-100042\n0477\n2\nClarification on the use of User-Data-Already-Available\n9.1.0\nMar 2010\nCT#47\nCP-100015\n0482\nServer Capabilities\n9.1.0\nMar 2010\nCT#47\nCP-100031\n0466\nRTR for wildcarded public user identity\n9.1.0\nMay 2010\nXml-file corrected\n9.1.1\nJun 2010\nCT#48\nCP-100412\n0484\n3\nTable not aligned with XML schema for wildcarded identities\n9.2.0\nJun 2010\nCT#48\nCP-100412\n0487\n3\nSAR with NO_ASSIGNMENT correction\n9.2.0\nJun 2010\nCT#48\nCP-100412\n0489\n2\nUpdate of IETF Reference\n9.2.0\nSep 2010\nCT#49\nCP-100447\n0493\n2\nWildcarded Identities handling\n9.3.0\nSep 2010\nCT#49\nCP-100447\n0495\nWrong order in table for XML schema\n9.3.0\nSep 2010\nCT#49\nCP-100447\n0497\n2\nCx-MAR handling correction in restoration procedures\n9.3.0\nSep 2010\nCT#49\nCP-100447\n500\n1\nAmbiguity of Presence Conditions of IEs and AVP ABNF\n9.3.0\nSep 2010\nCT#49\nCP-100447\n507\nCorrection for de-registration procedure at restoration\n9.3.0\nSep 2010\nCT#49\nCP-100447\n504\n2\nMandatory and optional capabilities handling\n9.3.0\nDec 2010\nCT#50\nCP-100668\n0519\nCoding of SIP-Authorization AVP and SIP-Authenticate AVP\n9.4.0\nDec 2010\nCT#50\nCP-100697\n0509\n1\nClarification on Alias\n10.0.0\nMar 2011\nCT#51\nCP-110044\n0521\n-\nOriginating_CDIV Session Case including in XML\n10.1.0\nMar 2011\nCT#51\nCP-110060\n0515\n5\nMPS over Cx\n10.1.0\nJun 2011\nCT#52\nCP-110349\n0529\n2\nHandling of RTR for Emergency Registration\n10.2.0\nJun 2011\nCT#52\nCP-110356\n0532\n1\nEmergency Restoration\n10.2.0\nJun 2011\nCT#52\nCP-110356\n0535\n-\nIncorrect Use of Result-Code AVP\n10.2.0\nJun 2011\nCT#52\nCP-110356\n0538\n1\nError in assignment type for backward compatibility scenarios\n10.2.0\nJun 2011\nCT#52\nCP-110383\n0520\n4\nReference Location over Cx interface\n11.0.0\nSep 2011\nCT#53\nCP-110566\n0542\nPriviledged sender\n11.1.0\nSep 2011\nCT#53\nCP-110566\n0546\n1\nPublic Identity in canonical form\n11.1.0\nDec 2011\nCT#54\nCP-110781\n0552\n1\nIdentity in the service profile\n11.2.0\nDec 2011\nCT#54\nCP-110781\n0557\n2\nProviding the IMSI to the S-CSCF\n11.2.0\nDec 2011\nCT#54\nCP-110809\n0553\n1\nBehaviour of HSS not supported IMS Restoration Procedures to LIR\n11.2.0\nMar 2012\nCT#55\nCP-120014\n0562\n1\nServer-Capability AVP in LIA and UAA\n11.3.0\nMar 2012\nCT#55\nCP-120014\n0566\n1\nUpdate of charging information and authentication data\n11.3.0\nJun 2012\nCT#56\nCP-120245\n0558\n2\nMaximum Number of simultaneous registrations\n11.4.0\nSep 2012\nCT#57\nCP-120439\n0576\n1\nEmergency registrations do not affect registration status\n11.5.0\nSep 2012\nCT#57\nCP-120456\n0577\n1\nAdd RequestURI parameter to SPT matching\n11.5.0\nNov 2012\nThe specification version number in the header corrected\n11.5.1\nDec 2012\nCT#58\nCP-120743\n0578\n-\nExperimental-Result-Code correction\n11.6.0\nDec 2012\nCT#58\nCP-120743\n0582\n3\nPSI direct routing with restoration procedures\n11.6.0\nDec 2012\nCT#58\nCP-120743\n0583\n-\nNegated Session Case\n11.6.0\nMar 2013\nCT#59\nCP-130011\n0593\n1\nIdentities with emergency registration in RTR\n11.7.0\nMar 2013\nCT#59\nCP-130020\n0599\n1\nClarification on Reference Location information\n11.7.0\nJun 2013\nCT#60\nCP-130374\n0600\n1\nAbsent User-Name after S-CSCF recovery\n11.8.0\nSep 2013\nCT#61\nCP-130439\n0606\n2\nCancellation of the old S-CSCF for IMS Subscription and IMS Restoration Procedures\n11.9.0\nSep 2013\nCT#61\nCP-13046clause\n0601\n-\nCorrection on Emergency Registration\n12.0.0\nDec 2013\nCT#62\nCP-130627\n0607\n5\nCx Charging Information Download\n12.1.0\nJun 2014\nCT#64\nCP-140237\n0609\n2\nWildcarded Public Identity in SAA\n12.2.0\nJun 2014\nCT#64\nCP-140243\n0611\n2\nDiameter Overload Control Over Cx\n12.2.0\nSep 2014\nCT#65\nCP-140506\n0624\n2\nP-CSCF Restoration indication\n12.3.0\nSep 2014\nCT#65\nCP-140515\n0626\n-\nClarification on REGISTRATION_AND_CAPABILITIES for De-registration\n12.3.0\nSep 2014\nCT#65\nCP-140515\n0627\n-\nClarification on Unregistered User\n12.3.0\nDec 2014\nCT#66\nCP-140794\n0628\n2\nHSS behaviour when P-CSCF Restoration indication is received\n12.4.0\nDec 2014\nCT#66\nCP-140790\n0630\n1\nPriority Consideration for Diameter Overload Control\n12.4.0\nDec 2014\nCT#66\nCP-140777\n0632\n1\nAddition of IMS-AKA based on HTTP Digest AKAv2 for WebRTC\n12.4.0\nMar 2015\nCT#67\nCP-150023\n0639\n1\nIMSI Encoding over Cx\n12.5.0\nJun 2015\nCT#68\nCP-150251\n0633\n4\nRTR handling when emergency registration\n12.6.0\nJun 2015\nCT#68\nCP-150251\n0642\n1\n\"Digest-AKAv1-MD5\" is used as well for other Digest-AKA versions\n12.6.0\nJun 2015\nCT#68\nCP-150251\n0643\nConfidentiality-key is mandatory\n12.6.0\nJun 2015\nCT#68\nCP-150261\n0640\n-\nADMINISTRATIVE_DEREGISTRATION with P-CSCF-Restoration-Indication\n12.6.0\nJuly 2016\nCorrection of typo in previous line of history table.\n12.6.1\nSep 2015\nCT#69\nCP-150428\n0647\n1\nAuthentication tables and IE clarifications in MAR/MAA\n12.7.0\nSep 2015\nCT#69\nCP-150428\n0649\n-\nWrong CR update\n12.7.0\nSep 2015\nCT#69\nCP-150432\n0644\n1\nS-CSCF Restoration Information deletion with SAT=UNREGISTERED_USER\n12.7.0\nSep 2015\nCT#69\nCP-150436\n0645\n-\nP-CSCF Restoration when IMS Restoration is supported\n12.7.0\nDec 2015\nCT#70\nCP-150754\n0653\n2\nAllowed WAF and/or WWSF Identities\n12.8.0\nDec 2015\nCT#70\nCP-150750\n0654\n1\nAuthentication Information IE clarification\n12.8.0\nDec 2015\nCT#70\nCP-150749\n0655\n1\nDe-registration without IMPI\n12.8.0\nDec 2015\nCT#70\nCP-150749\n0656\n1\nIMSI change\n12.8.0\nDec 2015\nCT#70\nCP-150759\n0658\n1\nUpdate reference to DOIC new IETF RFC\n12.8.0\nDec 2015\nCT#70\nCP-150775\n0652\n4\nHSS supports IMS subscriptions corresponding to users managed by third parties\n13.0.0\nDec 2015\nCT#70\nCP-150768\n0659\n4\nDRMP AVP Procedures over Cx/Dx\n13.0.0\nMar 2016\nCT#71\nCP-160031\n0661\n6\nIntroduction of AAA-1 interface\n13.1.0\nMar 2016\nCT#71\nCP-160046\n0662\n-\nDe-registration of emergency registration correction\n13.1.0\nJun 2016\nCT#72\nCP-160215\n0665\n1\nDiameter requests for priority traffic during overload control mechanism\n13.2.0\n07-2016\nCorrection to spec version number on cover page\n13.2.1\n09-2016\nCT#73\nCP-160431\n0666\n1\nS-CSCF Restoration during Registration enhancement\n14.0.0\n2016-12\nCT#74\nCP-160646\n0673\n2\nReference Location\n14.1.0\n2016-12\nCT#74\nCP-160672\n0674\n1\nService Profile and iFC alignment between XML and text/UML\n14.1.0\n2016-12\nCT#74\nCP-160681\n0675\n1\nLoad Control\n14.1.0\n2016-12\nCT#74\nCP-160664\n0677\n-\nCorrection to change IETF drmp draft version to official RFC 7944\n14.1.0\n2017-03\nCT#75\nCP-170045\n0678\n-\nMission Critical Services\n14.2.0\n2017-03\nCT#75\nCP-170048\n0679\n1\nUpdate of reference for the Diameter base protocol\n14.2.0\n2017-06\nCT#76\nCP-171034\n0680\n1\nIMS Trace (ISAT) Reference Updates\n14.3.0\n2017-06\nCT#76\nCP-171018\n0684\n1\nSupport for signaling transport level packet marking\n14.3.0\n2017-09\nCT#77\nCP-172012\n0686\n-\nCorrection of DRMP Procedures\n14.4.0\n2017-12\nCT#78\nCP-173011\n0687\n1\nCx Subscriber Deregistration Reason\n14.5.0\n2018-06\nCT#80\nCP-181121\n0688\n1\nChange of Reference Location Information\n15.0.0\n2018-09\nCT#81\nCP-182069\n0689\n-\nP-CSCF restoration for 5GC\n15.1.0\n2019-03\nCT#83\nCP-190035\n0690\n1\nReference Location Information change\n15.2.0\n2019-09\nCT#85\nCP-192094\n0693\n2\ndraft-ietf-dime-load published as RFC 8583\n15.3.0\n2019-09\nCT#85\nCP-192150\n0691\n1\nWildcarded Public Identity in SAA\n16.0.0\n2019-12\nCT#86\nCP-193047\n0694\n-\nRLOS related registrations\n16.1.0\n2021-12\nCT#94e\nCP-213104\n0696\n-\nB\nUpdate of SIP Digest Access Authentication\n17.0.0\n2022-03\nCT#95e\nCP-220052\n0699\n1\nB\nSupport of the hash value for alternate SIP Digest algorithm\n17.1.0\n2022-03\nCT#95e\nCP-220054\n0697\n-\nB\nFailed P-CSCF\n17.1.0\n2024-03\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_9",
        "clause_6",
        "clause_0601",
        "table_6.7",
        "ts_29.229",
        "ts_23.228",
        "ts_23.003",
        "ts_24.229",
        "ts_23.008",
        "ts_23.218",
        "ts_24.323",
        "ts_22.153",
        "ts_29.228",
        "ts_6.9",
        "ts_7.1",
        "ts_8.7",
        "ts_11.7"
      ]
    }
  ]
}