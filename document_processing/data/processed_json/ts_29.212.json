{
  "metadata": {
    "specification_id": "ts_29.212",
    "version": "18.2.0",
    "title": "3GPP TS 29.212",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29212-i20/29212-i20.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:07:02.499741",
    "total_chunks": 242
  },
  "chunks": [
    {
      "chunk_id": "ts_29.212_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document provides the stage 3 specification of the Gx, Gxx and Sd reference points for the present release. The present document also provides the Diameter variant of St reference point for the present release. The functional requirements and the stage 2 specifications of the Gx, Gxx, Sd and St reference points are contained in 3GPP TS 23.203 [7]. The Gx reference point lies between the Policy and Charging Rule Function and the Policy and Charging Enforcement Function. The Gxx reference point lies between the Policy and Charging Rule Function and the Bearer Binding and Event Reporting Function. The Sd reference point lies between the Policy and Charging Rule Function and the Traffic Detection Function. The St reference point lies between the Policy and Charging Rule Function and the Traffic Steering Support Function.\nWhenever it is possible the present document specifies the requirements for the protocol by reference to specifications produced by the IETF within the scope of Diameter. Where this is not possible, extensions to Diameter are defined within the present document.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_29.212_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication and/or edition number or version number) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 29.210: \"Charging Rule Provisioning over Gx Interface\".\n[3]\tVoid.\n[4]\tVoid.\n[5]\tIETF RFC 3588: \"Diameter Base Protocol\".\n[6]\tVoid.\n[7]\t3GPP TS 23.203: \"Policy Control and Charging architecture\".\n[8]\t3GPP TS 29.213: \"Policy and charging control signalling flows and Quality of Service (QoS) parameter mapping\".\n[9]\tVoid.\n[10]\t3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".\n[11]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[12]\tIETF RFC 4005: \"Diameter Network Access Server Application\".\n[13]\t3GPP TS 24.008: \"Mobile radio interface Layer 3 specification\".\n[14]\t3GPP TS 29.229: \"Cx and Dx interfaces based on Diameter protocol; Protocol details\".\n[15]\tIETF RFC 3162: \"Radius and Ipv6\".\n[16]\t3GPP TS 32.295: \"Telecommunication management; Charging management; Charging Data Record (CDR) transfer\".\n[17]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[18]\t3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunnelling Protocol (GTP) across the Gn and Gp interface\".\n[19]\t3GPP TS 32.299: \"Telecommunication management; Charging management; Diameter charging applications \".\n[20]\t3GPP2 X.S0011-E: \"cdma2000 Wireless IP Network Standard\".\n[21]\t3GPP TS 32.240: \"Telecommunication management; Charging management; Charging architecture and principles\".\n[22]\t3GPP TS 29.274: \"3GPP Evolved Packet System. Evolved GPRS Tunnelling Protocol for EPS (GTPv2)\".\n[23]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[24]\t3GPP2 X.S0057-B: \"E-UTRAN – eHRPD Connectivity and Interworking: Core Network Aspects\".\n[25]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[26]\t3GPP TS 29.272: \"3GPP Evolved Packet System. Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol\".\n[27]\t3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment trace; Trace control and configuration management\".\n[28]\t3GPP TS 29.275: \"Proxy Mobile Ipv6 (PMIPv6) based Mobility and Tunnelling Protocols; Stage 3\".\n[29]\t3GPP TS 43.318: \"Generic access to the A/Gb interface; Stage 2\".\n[30]\t3GPP2 X.S0062-0: \"PCC for cdma2000 1x and HRPD Networks \".\n[31]\t3GPP TS 23.228: \"IP multimedia subsystem; Stage 2\".\n[32]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access.\n[33]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[34]\tVoid.\n[35]\t3GPP TS 23.261: \"IP flow mobility and seamless Wireless Local Area Network (WLAN) offload; Stage 2\".\n[36]\tIETF RFC 3046: \"DHCP Relay Agent Information Option\".\n[37]\tETSI TS 283 034 v2.2.0: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Network Attachment Sub-System (NASS); e4 interface based on the DIAMETER protocol\".\n[38]\tVoid.\n[39]\tVoid.\n[40]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".\n[41]\t3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".\n[42]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet\".\n[43]\t3GPP TS 23.007: \"Restoration Procedures\".\n[44]\tBroadband Forum TR-134: \"Policy Control Framework \".\n[45]\tBroadband Forum TR-124 Issue 3: \"Functional Requirements for Broadband Residential Gateway Devices \".\n[46]\tBroadband Forum TR-146: \"Internet Protocol (IP) Sessions\".\n[47]\tBroadband Forum TR-300: \"Nodal Requirements for Converged Policy Management\".\n[48]\t3GPP TS 29.273: \"3GPP EPS AAA interfaces\".\n[49]\tIETF RFC 7683: \"Diameter Overload Indication Conveyance\".\n[50]\t3GPP TS 23.468: \"Group Services and System Aspects; Group Communication System Enablers for LTE (GCSE LTE)\".\n[51]\t3GPP TS 23.161: \"Network-based IP flow mobility and Wireless Local Area Network (WLAN) offload; Stage 2\".\n[52]\t3GPP TS 29.155: \"Traffic Steering Control; Representational State Transfer (REST) over St reference point\".\n[53]\tIETF RFC 7944: \"Diameter Routing Message Priority\".\n[54]\tIETF RFC 5719: \"Updated IANA Considerations for Diameter Command Code Allocations\".\n[55]\tIETF RFC 2234: \"Augmented BNF for syntax specifications\".\n[56]\t3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".\n[57]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[58]\tIETF RFC 3948: \" UDP Encapsulation of IPsec ESP Packets\".\n[59]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks; stage 3\".\n[60]\tIETF RFC 8583: \"Diameter Load Information Conveyance\".\n[61]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[62]\t3GPP TS 29.251: \"Gw and Gwn reference points for sponsored data connectivity; stage 3\".\n[63]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane of EPC Nodes; Stage 3\".\n[64]\t3GPP TS 22.101: \"Service aspects; Service principles\".\n[65]\t3GPP TS 23.221: \"Architectural requirements\".\n[66]\tIETF RFC 8506: \"Diameter Credit Control Application\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_29.210",
        "ts_23.203",
        "ts_29.213",
        "ts_29.214",
        "ts_29.061",
        "ts_24.008",
        "ts_29.229",
        "ts_32.295",
        "ts_23.060",
        "ts_29.060",
        "ts_32.299",
        "ts_32.240",
        "ts_29.274",
        "ts_23.402",
        "ts_23.003",
        "ts_29.272",
        "ts_32.422",
        "ts_29.275",
        "ts_43.318",
        "ts_23.228",
        "ts_23.401",
        "ts_23.380",
        "ts_23.261",
        "ts_23.216",
        "ts_23.107",
        "ts_24.301",
        "ts_23.007",
        "ts_29.273",
        "ts_23.468",
        "ts_23.161",
        "ts_29.155",
        "ts_23.303",
        "ts_26.114",
        "ts_24.302",
        "ts_29.251",
        "ts_29.244",
        "ts_22.101",
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_29.212_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply:\nApplication detection filter: A logic used to detect packets generated by an application based on extended inspection of these packets, e.g., header and/or payload information, as well as dynamics of packet flows. The logic is entirely internal to a TDF or a PCEF enhanced with ADC, and is out of scope of this specification.\nApplication identifier: An identifier, referring to a specific application detection filter.\nADC decision: A decision consists of references to ADC rules, associated enforcement actions (for dynamic ADC rules) and TDF session attributes and is provided by the PCRF to the TDF for application detection and control.\nADC rule: A set of information enabling the detection of application traffic and associated enforcement actions. ADC rules are directly provisioned into the TDF and referenced by the PCRF.\nBit rate: The number of bits (denoted in units of bits, kbits, etc.) that are conveyed or processed per unit of time. The bit rate in bit/s can be abbreviated with bps. This specification uses SI (International System of Units) prefixes as unit prefixes, which strictly refer to the power of 10, and shall not be used for the power of 2. For example, 1 kbit/s represents 1000 bit/s or 1 Mbit/s represents 1000 kbit/s and so on.\nDetected application traffic: An aggregate set of packet flows that are generated by a given application and detected by an application detection filter.\nIP-CAN bearer: IP transmission path of defined capacity, delay and bit error rate, etc.See 3GPP TR 21.905 [1] for the definition of bearer.\nIP-CAN session: association between a UE and an IP network.The association is identified by one or more UE Ipv4 addresses/ and/or Ipv6 prefix together with a UE identity information, if available, and a PDN represented by a PDN ID (e.g. an APN). An IP-CAN session incorporates one or more IP-CAN bearers. Support for multiple IP-CAN bearers per IP-CAN session is IP-CAN specific. An IP-CAN session exists as long as the related UE Ipv4 address and/or Ipv6 prefix are assigned and announced to the IP network.\nIP flow: unidirectional flow of IP packets with the same source IP address and port number and the same destination IP address and port number and the same transport protocol.Port numbers are only applicable if used by the transport protocol.\nIP Flow mapping: IP flow mapping is used in Network-initiated NBIFOM mode when the UE wants to request the network to apply specific mapping of IP flows to 3GPP access or WLAN access. It applies to the same parameters as the NBIFOM routing rule.\nGateway Control Session: An association between a BBERF and a PCRF (when GTP is not used in the EPC), used for transferring access specific parameters, BBERF events and QoS rules between the PCRF and BBERF. In the context of this specification this is implemented by use of the Gxx procedures.\nGC1 signalling: Signalling between the GCS AS and the application client on the UE over the GC1 reference point as defined in 3GPP TS 23.468 [50].\nMonitoring key: Identifies a usage monitoring control instance.\nMulti-access IP-CAN session: An IP-CAN session whose traffic can be routed over either a 3GPP access or a WLAN access or both. Each IP flow is routed at any single time only over one access.\nTDF session: An association between an IP-CAN session and the assigned TDF for the purpose of application detection and control by the PCRF. The association is identified by one UE Ipv4 address and/or Ipv6 prefix together with optionally a PDN represented by a PDN ID and a set of ADC rules to be applied by the TDF.\nUsage monitoring control instance: the monitoring and reporting of the usage threshold for input, output or total data volume or time of usage for the IP-CAN session/TDF session or the service data flows/application's traffic associated with the same monitoring key.\nPresence Reporting Area: An area defined within 3GPP Packet Domain for the purposes of reporting of UE presence within that area due to policy control and/or charging reasons. There are two types of Presence Reporting Area: \"UE-dedicated Presence Reporting Area\", and \"Core Network pre-configured Presence Reporting Area\".\nPacket Flow Description (PFD): A set of information enabling the detection of application traffic provided by a 3rd party service provider (from 3GPP TS 23.203 [7]).\nRAN rules: In this specification, RAN rules refers to the set of RAN assistance parameter and RAN steering command handling for the steering of traffic between E-UTRAN or UTRAN and WLAN associated with RAN-controlled LTE-WLAN interworking or RAN-assisted WLAN interworking.\nRAN user plane congestion: RAN user plane congestion occurs when the demand for RAN resources exceeds the available RAN capacity to deliver the user data for a prolonged period of time.\nRestricted local operator services: communication services provided by an operator that involve either automated or human assistance (e.g. credit card billing, directory assistance, customer care) for which successful authentication is not necessary.\nService data flow: An aggregate set of packet flows carried through the PCEF that matches a service data flow template (from 3GPP TS 23.203 [7]).\nService data flow filter: a set of packet flow header parameter values/ranges used to identify one or more of the packet flows (from 3GPP TS 23.203 [7]).\nService data flow template: The set of service data flow filters in a PCC rule or an application identifier in a PCC rule referring to an application detection filter, required for defining a service data flow (from 3GPP TS 23.203 [7]).\n(S)Gi-LAN: The network infrastructure connected to the 3GPP network over the SGi or Gi reference point that provides various IP-based services.\n(S)Gi-LAN service function: A function located in the (S)Gi-LAN that provides value-added IP-based services e.g. NAT, anti-malware, parental control, DDoS protection.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905",
        "ts_23.468",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_29.212_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purpose of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply:\nADC\tApplication Detection and Control\nAF\tApplication Function\nAMBR\tAggregate Maximum Bit Rate\nBBERF\tBearer Binding and Event Reporting Function\nCCA\tCredit-Control-Answer (CC-Answer)\nCCR\tCredit-Control-Request (CC-Request)\nCHEM\tCoverage and Handoff Enhancements using Multimedia error robustness feature\nCSG\tClosed Subscriber Group\nCSG-ID\tClosed Subscriber Group Identity\nDCC\tDiameter Credit Control\nDTS\tData Transport Service\nDRMP\tDiameter Routing Message Priority\nGBR\tGuaranteed Bit Rate\nGCS\tGroup Communication Service\nGCS AS\tGroup Communication Service Application Server\nGEO\tGeosynchronous Orbit\nLEO\tLow Earth Orbit\nMEO\tMedium Earth Orbit\nMPS\tMultimedia Priority Service\nNBIFOM\tNetwork-based IP flow mobility\nNB-IoT\tNarrowband IoT\nOCS\tOnline charging system\nOFCS\tOffline charging system\nPCEF\tPolicy and Charging Enforcement Function\nPCRF\tPolicy and Charging Rule Function\nPFD\tPacket Flow Description\nPFDF\tPacket Flow Description Function\nPRA\tPresence Reporting Area\nRAA\tRe-Auth-Answer (RA-Answer)\nRAB\tRadio Access Bearer\nRAR\tRe-Auth-Request (RA-Request)\nRCAF\tRAN Congestion Awareness Function\nRLOS\tRestricted Local Operator Services\nRUCI\tRAN User Plane Congestion Information\nSCEF\tService Capability Exposure Function\nSUPL\tSecure User Plane for Location\nTDF\tTraffic Detection Function\nTSA\tTDF-Session-Answer\nTSR\tTDF-Session-Request\nTSSF\tTraffic Steering Support Function\nUDC\tUser Data Convergence\nUDR\tUser Data Repository\nWB-E-UTRAN\tWide Band E-UTRAN",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.1",
      "section_id": "4.1",
      "section_title": "Overview",
      "content": "The Gx reference point is located between the Policy and Charging Rules Function (PCRF) and the Policy and Charging Enforcement Function (PCEF). The Gx reference point is used for provisioning and removal of PCC rules from the PCRF to the PCEF and the transmission of traffic plane events from the PCEF to the PCRF. The Gx reference point can be used for charging control, policy control or both by applying AVPs relevant to the application. The Gx reference point can also be used for application's traffic detection and control.\nThe stage 2 level requirements for the Gx reference point are defined in 3GPP TS 23.203 [7].\nSignalling flows related to the both Rx and Gx interfaces are specified in 3GPP TS 29.213 [8].\nThe definition of case 1, case 2a and case 2b is specified in clause 4.0 in 3GPP TS 29.213 [8].\nRefer to Annex G of 3GPP TS 29.213 [8] for Diameter overload control procedures over the Gx interface.\nRefer to Annex J of 3GPP TS 29.213 [8] for Diameter message priority mechanism procedures over the Gx interface.\nRefer to Annex K of 3GPP TS 29.213 [8] for Diameter load control procedures over the Gx interface.\nThe PCEF is considered as monolithic entity in the present specification, but can be decomposed into a User Plane Function and a Control Plane Function connected via the Sx reference point. The Sx reference point and interactions between the Gx and Sx reference points are not considered in the present specification, but are specified in 3GPP TS 29.244 [63].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.213_clause_4.0",
        "ts_23.203",
        "ts_29.213",
        "ts_29.244"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.2",
      "section_id": "4.2",
      "section_title": "Gx Reference model",
      "content": "The Gx reference point is defined between the PCRF and the PCEF. The relationships between the different functional entities involved are depicted in figure 4.2.1. The overall PCC architecture is depicted in subclause 3a of 3GPP TS 29.213 [8].\nFigure 4.2.1: Gx reference model\nNOTE 1:\tThe PCEF may support Application Detection and Control feature.\nNOTE 2:\tPCEF is located in the Gateway node implementing the IP access to the PDN. Refer to Annexes of TS 23.203 [7] for application to specific IP-CAN types.\nNOTE 3:\tThe PCEF can be decomposed into a User Plane Function and a Control Plane Function connected via the Sx reference point specified in 3GPP TS 29.244 [63]. If the PCEF is decomposed, the Gx reference point terminates in the Control Plane Function.\nFigure 4.2.2: Void",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.213_clause_3",
        "figure_4.2.1",
        "ts_29.213_figure_4.2.1",
        "figure_4.2.2",
        "ts_29.213",
        "ts_23.203",
        "ts_29.244"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.3.1",
      "section_id": "4.3.1",
      "section_title": "PCC Rule Definition",
      "content": "The purpose of the PCC rule is to:\n-\tDetect a packet belonging to a service data flow.\n-\tThe service data flow templates within the PCC rule are used for the selection of downlink IP CAN bearers.\n-\tThe service data flow filters within the PCC rule are used for the enforcement that uplink IP flows are transported in the correct IP CAN bearer.\nNOTE 1:\tFor aPCC rule that contains an application identifier referencing an application detection filter, the PCRF can inspect traffic on multiple bearers in the uplink direction. Such detected traffic counts as detection by that PCC rule.\n-\tIdentify the service the service data flow contributes to.\n-\tProvide applicable charging parameters for a service data flow.\n-\tProvide policy control for a service data flow.\nThe PCEF shall check each received packet against the service data flow filters of each PCC rule in the order of the precedence of the PCC rules. When a packet matches a service data flow filter, the packet matching process for that packet is completed, and the corresponding PCC rule shall be applied. For PCC rules that contain an application identifier referencing an application detection filter, the precedence is only relevant for the rule enforcement, i.e. when the detected application packet matches multiple PCC rules, only the enforcement, reporting of application starts and stops, usage monitoring, and charging actions of the PCC rule with the highest precedence shall be applied.\nThere are two different types of PCC rules as defined in 3GPP TS 23.203 [7]:\n-\tDynamic PCC rules. Dynamically provisioned by the PCRF to the PCEF via the Gx interface. These PCC rules may be either predefined or dynamically generated in the PCRF. Dynamic PCC rules can be installed, modified and removed at any time.\n-\tPredefined PCC rules. Preconfigured in the PCEF. Predefined PCC rules can be activated or deactivated by the PCRF at any time. Predefined PCC rules within the PCEF may be grouped allowing the PCRF to dynamically activate a set of PCC rules over the Gx reference point.\nNOTE 2:\tThe operator can define a predefined PCC rule, to be activated by the PCEF. Such a predefined rule is not explicitly known in the PCRF.\nA PCC rule consists of:\n-\ta rule name;\n-\tservice identifier;\n-\tservice data flow filter(s);\n-\tapplication identifier;\n-\tprecedence;\n-\tgate status;\n-\tQoS parameters;\n-\tindication for PS to CS session continuity;\n-\tcharging key (i.e. rating group);\n-\tother charging parameters;\n-\tmonitoring key;\n-\tsponsor identity;\n-\tapplication service provider identity;\n-\tindication of access network information reporting;\n-\tredirect.\n-\ttraffic steering policy identifier(s).\nThe rule name shall be used to reference a PCC rule in the communication between the PCEF and the PCRF.\nThe service identifier shall be used to identify the service or the service component the service data flow relates to.\nThe service data flow filter(s) or the application detection filter shall be used to select the traffic for which the rule applies. Either service data flow filter(s) or application identifier shall exist in a PCC rule. It shall be possible to define wildcarded service data flow filter(s), both for the dynamic and predefined PCC rules.\nThe application identifier shall be used to reference an application detection filter, which is predefined in the PCEF. The same application identifier value can occur in more than one PCC rule. If so, the PCRF shall ensure that there is at most one PCC rule active per application identifier value and IP CAN session at any time.\nNOTE 3:\tThe application identifier can only be used for PCEF enhanced with ADC. The same application identifier value could be used for a dynamic PCC rule and a pre-defined PCC rule or for multiple pre-defined PCC rules.\nNOTE 4:\tThe configuration of the application detection filter in the PCEF can include the set of information required for encrypted detection as defined in Annex X of 3GPP TS 23.203 [7].\nThe gate status indicates whether the service data flow may pass (gate is open) or shall be discarded (gate is closed) in uplink and/or in downlink direction.\nThe QoS information includes the QoS class identifier (authorized QoS class for the service data flow), the Allocation and Retention Priority (ARP) and authorized bitrates for uplink and downlink.\nThe PS to CS session continuity indicates that the service data flow may be handed over to the CS domain as defined in 3GPP TS 23.216 [40].\nThe charging parameters define whether online and offline charging interfaces are used, what is to be metered in offline charging, on what level the PCEF shall report the usage related to the rule, etc.\nFor different PCC rules with overlapping service data flow filter, the precedence of the rule determines which of these rules is applicable. For PCC rules with application detection filter, the precedence of the rule is only relevant for the enforcement or charging of the detected application.When a dynamic PCC rule and a predefined PCC rule have the same precedence, the dynamic PCC rule takes precedence. For dynamic PCC rules that contain an application identifier, the precedence shall be either preconfigured at the PCEF or provided dynamically by the PCRF within the PCC Rules.\nNOTE 5:\tWhether precedence for dynamic PCC rules that contain an application identifier is preconfigured in PCEF or provided in the PCC rule from the PCRF depends on network configuration.\nPCC rule also includes Application Function record information for enabling charging correlation between the application and bearer layer if the AF has provided this information via the Rx interface. For IMS this includes the IMS Charging Identifier (ICID) and flow identifiers.\nThe monitoring key for a PCC rule identifies a monitoring control instance that shall be used for usage monitoring control of the service data flows controlled by the predefined PCC rule or dynamic PCC rule.\nIf sponsored data connectivity is supported, the sponsor identity for a PCC rule identifies the 3rd party organization (the sponsor) willing to pay for the operator's charge for connectivity required to deliver a service to the end user.\nIf sponsored data connectivity is supported, the application service provider identity for a PCC rule identifies the 3rd party organization (the ASP) that is delivering the service to the end user.\nIf Access Network Information Reporting is supported, the value of Required-Access-Info AVP for a PCC rule identifies the Access Network Information parameters requested by the AF.\nThe redirect indicates whether the uplink part of the detected application traffic shall be redirected to a controlled address. The target redirect address may also be included.\nNOTE 6:\tThe redirect is applicable when application identifier exists in the PCC rule.\nThe traffic steering policy identifier(s) is a reference to a pre-configured traffic steering policy at the PCEF as defined in clause 4.4.2.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.4.2",
        "ts_23.203",
        "ts_23.216"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.3.2",
      "section_id": "4.3.2",
      "section_title": "Operations on PCC Rules",
      "content": "For dynamic PCC rules, the following operations are available:\nInstallation: to provision a PCC rules that has not been already provisioned.\nModification: to modify a PCC rule already installed.\nRemoval: to remove a PCC rule already installed.\nFor predefined PCC rules, the following operations are available:\nActivation: to allow the PCC rule being active.\nDeactivation: to disallow the PCC rule.\nThe procedures to perform these operations are further described in clause 4.5.2.0.\n4.3a\tIP flow mobility routing rules\n4.3a.0\tGeneral\nThe clause 4.3a refers to S2c-based IP flow mobility as described in 3GPP TS 23.261 [35].\n4.3a.1\tFunctional entities\nThe PCEF shall provide IP flow mobility routing rules and report IP flow mobility routing rules related events to the PCRF via the Gx reference point.\nThe PCRF shall select either the PCEF or any applicable BBERF as the bearer binding function for each service data flow based on the Routing Address included in the IP flow mobility routing rules received from the PCEF.\n4.3a.2\tIP flow mobility routing rule definition\nThe IP flow mobility routing rule is used by the PCRF to select the applicable BBF (BBERF or PCEF) for a service data flow in flow mobility scenarios and in turn provision QoS rules related to the service data flow to the selected BBERF.\nThe PCRF shall evaluate the service data flow filters against the routing filter contained in the IP flow mobility routing rule in the order of the precedence of the IP flow mobility routing rules. When a routing filter matches the service data flow filter, the routing address contained in the matching IP flow mobility routing rule shall be applied to the service data flow.\nAn IP flow mobility routing rule consists of:\n-\ta rule identifier;\n-\trouting filter(s);\n-\tprecedence;\n-\trouting address;\nThe rule identifier is assigned by the PCEF and shall be unique within an IP-CAN session. It is used to reference an IP flow mobility routing rule in the communication between the PCEF and the PCRF.\nThe IP flow mobility routing rule shall comprise one or more routing filters, containing information for matching service data flows. A default packet filter is specified by using wild card filters. The default packet filter is used to indicate the default route for service data flows without explicit route assignment. An IP flow mobility routing rule containing a default packet filter shall not contain any other packet filters.\nThe precedence defines in what order the IP flow mobility routing rules are used by the PCRF to determine where to route a service data flow. The precedence of the IP flow mobility routing rules not containing the default packet filter is derived from the priority assigned to the routing filters included in the Binding Update as specified in 3GPP TS 23.261 [35]. The PCEF shall assign the lowest evaluation precedence to the IP flow mobility routing rule containing the default packet filter.\nThe routing address identifies the IP address and thus the BBF to be used for all service data flows matching the routing filters contained in IP flow mobility routing rules. The routing address can be equal to a care-of address or to the home address of the UE. In case 1 and case 2b the routing address contains the home address and in case 2a the routing address contains the care-of address.\nNOTE:\tIP flow mobility routing rules can be defined in case 1 only for 3GPP access where GTP-based S5/S8 are employed or case 2b only for PMIP-based 3GPP accesses.\n4.3a.3\tOperations on Routing rules\nIf IP flow mobility is supported as specified in 3GPP TS 23.261 [35], the PCEF shall derive IP flow mobility routing rules based on the IP flow mobility binding information provided by the UE. The rule contains information required by the PCRF to install the PCC/QoS rules for a service data flow at the correct BBF in flow mobility scenarios.\nFor IP flow mobility routing rules, the following operations are available:\n-\tInstallation:\tthe PCEF provides a new IP flow mobility routing rule to the PCRF.\n-\tModification:\tthe PCEF modifies an existing IP flow mobility routing rule already installed at the PCRF.\n-\tRemoval:\tthe PCEF removes an IP flow mobility routing rule already installed at the PCRF.\nThe procedures to perform these operations are further described in clause 4.3a.4.\n4.3a.4\tPCC procedures for IP flow mobility routing rule over Gx reference point\n4.3a.4.1\tProvisioning of IP flow mobility routing rules\nWhen provisioning IP flow mobility routing rules, the PCEF executes the same procedure as for a Request for PCC Rules as described in clause 4.5.1.\nThe PCEF may install IP flow mobility routing rules at IP-CAN session establishment.\nNOTE:\tPCEF installs IP flow mobility routing rules at IP-CAN session establishment only in case 2a.\nIf the PCEF installs IP flow mobility routing rules at IP-CAN session establishment:\n-\tIn addition to the parameters defined in clause 4.5.1, the PCEF shall also include in the CC-Request, IP flow mobility routing rules within the Routing-Rule-Install AVP with one ore more Routing-Rule-Definition AVPs.\n-\tthe PCEF shall include a default route within the Routing-Rule-Definition AVP by including wildcarded filters within Routing-Filter AVP.\nThe PCEF may install, modify, and remove IP flow mobility routing rules at IP-CAN session modification.\n-\tIn such a case in addition to the parameters defined in clause 4.5.1, for IP flow mobility routing rule installation and modification, the PCEF shall include in the CC-Request the Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVPs containing the new and updated IP flow mobility routing rules.\n-\tFor IP flow mobility routing rule removal, the PCEF shall include the Routing-Rule-Remove AVP with the Routing-Rule-Identifier of the rules to be removed.\n-\tThe PCEF shall also include the Event-Trigger AVP set to ROUTING_RULE_CHANGE.\nAt IP-CAN session termination as described in 4.5.7, the PCRF removes instantly all IP flow mobility routing rules related to the terminated IP-CAN session.\nTo install a new or modify an already installed IP flow mobility routing rule, the Routing-Rule-Definition AVP shall be used. If an IP flow mobility routing rule with the same rule identifier, as supplied in the Routing-Rule-Identifier AVP within the Routing-Rule-Definition AVP, already exists at the PCRF, the new IP flow mobility routing rule shall update the currently installed rule. If the existing IP flow mobility routing rule already has attributes also included in the new IP flow mobility routing rule definition, the existing attributes shall be overwritten. Any attribute in the existing IP flow mobility routing rule not included in the new IP flow mobility routing rule definition shall remain valid.\n4.3b\tVoid\n4.3c\tNBIFOM routing rules\n4.3c.1\tGeneral\nClause 4.3c refers to NBIFOM as described in 3GPP TS 23.161 [51].\n4.3c.2\tNBIFOM routing rule definition\nThe NBIFOM routing rule is used by the PCRF to identify the applicable access type for a service data flow as provided by the UE and in turn provide PCC Rules related to the service data flow indicating the applicable access.\nNOTE 1:\tThe PCEF derives the NBIFOM routing rules based on the NBIFOM routing rules created/replaced/deleted by the UE in the UE-initiated NBIFOM mode or when the UE requests the IP flow mapping in the Network-initiated NBIFOM mode as defined in 3GPP TS 29.274 [22].\nAn NBIFOM routing rule consists of:\n-\ta rule identifier;\n-\trouting filter;\n-\tprecedence;\n-\trouting access information;\nThe rule identifier is assigned by the PCEF or the PCRF and shall be unique within an IP-CAN session. It is used to reference an NBIFOM routing rule in the communication between the PCEF and the PCRF. The PCEF shall keep the mapping between rule identifier of NBIFOM routing rule used over Gx interface  and the rule identifier of NBIFOM routing rule carried in the GTP signalling as defined in 3GPP TS 29.274 [22].\nNOTE 2:\tIn the UE-initiated IP flow mobility procedure, for creating a new NBIFOM routing rule, the rule identifier used in communication with UE is assigned and provided by the UE. In the UE requested IP Flow Mapping procedure, for creating a new NBIFOM routing rule, no rule identifier is assigned and provided by the UE, in this case the rule identifier to be used in communication with the UE is assigned by the PCEF. In both cases, the routing rule identifier to be used in communication with the PCRF is assigned by the PCEF.\nNOTE 3:\tFor Network-initiated NBIFOM mode the PCRF  assigns and includes the NBIFOM routing rule identifier to be used in Gx to every packet filter, in the Routing-Rule-Identifier AVP within the Flow-Information AVP of the PCC rule. The PCEF includes the routing rule identifier in a new NBIFOM routing rule if the UE initiates an IP flow mapping request for the packet filter.\nThe NBIFOM routing rule shall comprise of one routing filter, containing information for matching a service data flow. The routing filter of the NBIFOM routing rule is derived from the routing filter included in the routing rule carried in the GTP signalling as defined in 3GPP TS 29.274 [22].\nNOTE 4:\tThere is a one to one mapping between NBIFOM routing rules in GTP and NBIFOM routing rules in Gx.\nThe precedence defines in what order the NBIFOM routing rules are used by the PCRF to determine where the PCEF routes a service data flow. The precedence of the NBIFOM routing rule is derived from the priority assigned to the routing rule included in the GTP signalling defined in 3GPP TS 29.274 [22].\nThe routing access information identifies the access type that is to be used for the transfer of traffic determined by the UE. The routing access information shall be equal to 3GPP-EPS or Non-3GPP-EPS in this release.\n4.3c.3\tOperations on NBIFOM Routing rules\nIf NBIFOM is supported as specified in 3GPP TS 23.161 [51], the PCEF shall derive NBIFOM routing rules based on the NBIFOM routing rules or the IP flow mapping provided by the UE. The rule contains information required by the PCRF to determine the access type that is to be used for the transfer of traffic in NBIFOM scenarios.\nFor NBIFOM routing rules, the following operations are available:\n-\tInstallation:\tthe PCEF provides a new NBIFOM routing rule to the PCRF.\n-\tModification:\tthe PCEF modifies an existing NBIFOM routing rule already installed at the PCRF.\n-\tRemoval:\tthe PCEF removes an NBIFOM routing rule already installed at the PCRF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.2.0",
        "clause_4.3",
        "clause_4.5.1",
        "ts_23.261",
        "ts_23.161",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.4.1",
      "section_id": "4.4.1",
      "section_title": "PCRF",
      "content": "The PCRF (Policy Control and Charging Rules Function) is a functional element that encompasses policy control decision and flow based charging control functionalities. These 2 functionalities are the heritage of the release 6 logical entities PDF and CRF respectively. The PCRF provides network control regarding the service data flow detection, gating, QoS and flow based charging (except credit management) towards the PCEF. The PCRF receives session and media related information from the AF and informs AF of traffic plane events.\nThe PCRF shall provision PCC Rules to the PCEF via the Gx reference point. Particularities for the Gxx reference point are specified in clause 4a.4.1. Particularities for the Sd reference point are specified in clause 4b.4.1.\nIf IP flow mobility applies, the PCRF shall, based on IP flow mobility routing rules received from the PCEF, provide the authorized PCC/QoS rules to the applicable BBF.\nIf NBIFOM applies, the PCRF takes the decisions as described in subclause 4.5.25.1.1.\nThe PCRF PCC Rule decisions may be based on one or more of the following:\n-\tInformation obtained from the AF via the Rx reference point, e.g. the session, media and subscriber related information.\n-\tInformation obtained from the PCEF via the Gx reference point, e.g. IP-CAN bearer attributes, request type, subscriber related information, IP flow mobility routing rules (if IP flow mobility is supported), NBIFOM routing rule and change of usability of an access (if NBIFOM is supported), detected application's traffic information (if the PCEF supports Application Detection and Control feature) and 3GPP PS Data Off status (if the PCEF supports 3GPP PS Data Off feature).\n-\tInformation obtained from the SPR via the Sp reference point, e.g. subscriber and service related data.\n-\tInformation obtained from the TDF via the Sd reference point, e.g. report on application's traffic detection start/stop.\nNOTE 1:\tThe details associated with the Sp reference point are not specified in this Release. The SPR's relation to existing subscriber databases is not specified in this Release.\n-\tInformation obtained from the BBERF via the Gxx reference point.\n-\tOwn PCRF pre-configured information.\nIf the information from the PCEF contains traffic mapping information not matching any service data flow filter known to the PCRF, and the PCRF allows the UE to request enhanced QoS for services not known to the PCRF, the PCRF shall add this traffic mapping information as service data flow filters to the corresponding authorized PCC Rule. The PCRF may wildcard missing filter parameters, e.g. missing uplink TFT address and port information in case of GPRS.\nThe PCRF shall report events to the AF via the Rx reference point.\nThe PCRF shall inform the PCEF through the use of PCC rules on the treatment of each service data flow that is under PCC control, in accordance with the PCRF policy decisions.\nThe PCRF shall be able to select the bearer control mode that will apply for the IP-CAN session and provide it to the PCEF via the Gx reference point.\nUpon subscription to loss of AF signalling bearer notifications by the AF, the PCRF shall request the PCEF to notify the PCRF of the loss of resources associated to the PCC Rules corresponding with AF Signalling IP Flows, if this has not been requested previously.\nIf permitted by the subscriber's profile configuration received from the SPR, the PCRF may invoke the application's traffic detection and control at the PCEF supporting Application Detection and Control feature, by providing the corresponding PCC Rules.\nThe PCRF may use one or more pieces of information defined in the clause as input for the selection of traffic steering policies used to control the steering of the subscriber's traffic to appropriate (S)Gi-LAN service functions.\nNOTE 2:\tIn order to allow the PCRF to select and provision an application based traffic steering policy, the reporting of detected applications to the PCRF or any other information defined in this clause can be used.\nIf 3GPP PS Data Off applies, the PCRF shall behave as described in subclause 4.5.29.\nIf UE-Status-Change applies, the PCRF shall behave as described in subclause 4.5.32.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4",
        "clause_4.5.25.1.1",
        "clause_4.5.29",
        "clause_4.5.32"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.4.2",
      "section_id": "4.4.2",
      "section_title": "PCEF",
      "content": "The PCEF (Policy and Charging Enforcement Function) is the functional element that encompasses policy enforcement and flow based charging functionalities. These 2 functionalities are the heritage of the release 6 logical entities PEP and TPF respectively. This functional entity is located at the Gateway (e.g. GGSN in the GPRS case, P-GW in the EPS case and PDG in the WLAN case). It provides control over the user plane traffic handling at the Gateway and its QoS, and provides service data flow detection and counting as well as online and offline charging interactions.\nFor a service data flow that is under policy control the PCEF shall allow the service data flow to pass through the Gateway if and only if the corresponding gate is open.\nFor a service data flow that is under charging control the PCEF shall allow the service data flow to pass through the Gateway if and only if there is a corresponding active PCC rule and, for online charging, the OCS has authorized the applicable credit with that Charging key. The PCEF may let a service data flow pass through the Gateway during the course of the credit re-authorization procedure.\nIf requested by the PCRF, the PCEF shall report to the PCRF when the status of the related service data flow changes. This procedure can be used to monitor an IP-CAN bearer dedicated for AF signalling traffic.\nIn case the SDF is tunnelled at the BBERF, the PCEF shall inform the PCRF about the mobility protocol tunnelling header of the service data flows at IP-CAN session establishment or IP-CAN session modification when the tunnelling header information is changed.\nIf requested by PCRF, a PCEF, which supports Application Detection and Control feature, shall:\n-\tPerform application's traffic detection and control.\n-\tReport the detected application's traffic start/stop events to the PCRF along with TDF application instance identifier and service data flow descriptions when service data flow descriptions are deducible.\nNOTE:\tThe application detection filter can be pre-configured and/or extended with the PFDs by the PFDF as described in 3GPP TS 23.203 [7] and 3GPP TS 29.251 [62].\nA PCEF shall ensure that an IP packet, which is discarded at the PCEF as a result of PCC rule enforcement, is neither reported for offline charging nor cause credit consumption for online charging.\nIf requested by the PCRF, a PCEF, which supports policy provisioning and enforcement of authorized QoS for service data flows that share resources, shall:\n-\tFor PCC rules bound to the same bearer perform resource sharing among PCC rules marked for resource sharing.\nWhen the PCRF provides a traffic steering policy identifier(s) in a PCC rule, the PCEF shall behave as specified in clause 6.2.2.6 of 3GPP TS 23.203 [7].\nIf NBIFOM applies, the PCEF takes the actions as described in subclause 4.5.25.1.2.\nIf 3GPP PS Data Off applies, the PCEF shall behave as described in subclause 4.5.29.\nIf UE-Status-Change applies, the PCEF shall behave as described in subclause 4.5.32.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.203_clause_6.2.2.6",
        "clause_4.5.25.1.2",
        "clause_4.5.29",
        "clause_4.5.32",
        "ts_23.203",
        "ts_29.251"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.1",
      "section_id": "4.5.1",
      "section_title": "Request for PCC rules",
      "content": "The PCEF shall indicate, via the Gx reference point, a request for PCC rules in the following instances.\n1)\tAt IP-CAN session establishment:\nIf the PCEF is being requested via IP-CAN specific signaling not to establish the Gx session, the PCEF shall not establish the Gx session.\nNOTE 1:\tThe decision to not establish the Gx session applies for the life time of the IP-CAN session.\nNOTE 2:\tThe indicator to not establish the Gx session is configured in the HSS. It is delivered to the PCEF within the Charging Characteristics. The indicator is operator specific, therefore it can only be used in non-roaming and home routed roaming cases.\n-\tOtherwise, the PCEF shall send a CC-Request with CC-Request-Type AVP set to the value \"INITIAL_REQUEST\". The PCEF shall supply user identification within the Subscription-Id AVP and other attributes to allow the PCRF to identify the rules to be applied. The PCEF shall also provide IMEI(SV) (if available) within the User-Equipment-Info AVP or the User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported, to the PCRF. The other attributes shall include the type of IP-CAN within the IP-CAN-Type AVP, the type of the radio access technology, if available, within the RAT-Type AVP, the PDN information, if available, within the Called-Station-Id AVP, the PDN connection identifier, if available, within the PDN-Connection-ID AVP, the UE Ipv4 address within the Framed-IP-Address and/or the UE Ipv6 prefix within the Framed-Ipv6-Prefix AVP and the UE time zone information within 3GPP-MS-TimeZone AVP, if available. The PCEF may also include the Access‑Network-Charging-Address and Access‑Network-Charging-Identifier-Gx AVPs, the SGSN address within either 3GPP-SGSN-Address AVP or 3GPP-SGSN-Ipv6-Address AVP, the user location information within 3GPP-User-Location-Info, the Routing Area Identity within RAI AVP, the PLMN id within the 3GPP-SGSN-MCC-MNC AVP, other user equipment information (if IMEI(SV) not available) within User-Equipment-Info AVP or User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported, AN-Trusted AVP if available and the charging characteristics within 3GPP-Charging-Characteristics AVP in the CC-Request. Furthermore, if applicable for the IP-CAN type, the PCEF may indicate the support of network-initiated bearer request procedures by supplying the Network-Request-Support AVP. The PCEF shall also include the APN-AMBR if available using the APN-Aggregate-Max-Bitrate-DL/UL AVPs or both the APN-Aggregate-Max-Bitrate-DL/UL AVPs and the Extended-APN-AMBR-DL/UL AVPs(as specified in subclause 4.5.30).\nIf available, the PCEF shall also provide an indication if the default bearer is requested to be used for IMS signalling using the Bearer-Usage AVP. If UE provides information of IP flow mobility change, the PCEF includes IP flow mobility routing rules as defined in clause 4.3a.4. The PCEF may provide TDF-Information AVP, if available. The PCEF, based on its local configuration, may additionally provide its control plane address(es) within 3GPP-GGSN-Address AVP and/or 3GPP-GGSN-Ipv6-Address AVP, 3GPP-Selection-Mode AVP indicating how the APN was selected, Dynamic-Address-Flag AVP and Dynamic-Address-Flag-Extension AVP defining whether IP address(es) where statically or dynamically allocated and PDN-Connection-Charging-ID AVP containing the charging identifier to identify different records belonging to the same PDN connection. When the PCEF supports the detection and handling of the late arriving requests, the PCEF shall also include the origination time stamp (if available) within the Origination-Time-Stamp AVP and the Maximum Wait Time (if available) within the Maximum-Wait-Time AVP as specified in subclause 4.5.26.\nFor IP-CAN types that support multiple IP-CAN bearers, the PCEF may provide the Default-EPS-Bearer-QoS AVP including the ARP and QCI values corresponding to the Default EPS Bearer QoS.\nFor 3GPP-EPS and 3GPP2 accesses, the PCEF shall provide the IP address(es) (Ipv4 or Ipv6, if available) of the SGW/AGW within the AN-GW-Address AVP.\nFor xDSL IP-CAN Type the PCEF may provide the Subscription-Id AVP and shall not provide the RAT Type AVP, The Logical-Access-ID AVP and the Physical-Access-ID AVP shall be provided.\n2)\tAt IP-CAN session modification:\n-\tIP-CAN session modification with PCEF-requested rules can occur for various reasons, e.g. when:\n-\ta request to establish or terminate an IP-CAN bearer occurs;\n-\ta request for resource modification occurs;\n-\tan Event trigger is met.\nThe PCEF shall send a CC-Request with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\". The PCEF may include the Access‑Network-Charging-Address and Access‑Network-Charging-Identifier-Gx AVPs in the CC-Request. For an IP-CAN Session modification where an existing IP-CAN Bearer is modified, the PCEF shall supply within the PCC rule request the specific event which caused the IP-CAN session modification (within the Event-Trigger AVP) and any related data affected by the IP-CAN session modification. Any change in PCC rule status shall be supplied to PCRF within the Charging-Rule-Report AVP. If UE provides information of IP flow mobility change, the PCEF includes IP flow mobility routing rules to the PCRF as specified in clause 4.3a.4.\nIn the case that the UE initiates a resource modification procedure, the PCEF shall include within the CC-Request the Event-Trigger AVP set to RESOURCE_MODIFICATION_REQUEST and shall include the Packet-Filter-Operation AVP set as follows, with the amendments as specified in Annex A and Annex B:\n-\tWhen the UE requests to add filters without any link to existing bearer or existing packet filter, the PCEF shall set the Packet-Filter-Operation AVP to \"ADDITION\", and shall include:\n-\ta Packet-Filter-Information AVP for each packet filter requested for addition;\n-\tthe QoS-Information AVP to indicate the requested QoS for the new packet filters.\n-\tWhen the UE requests to add filters, including a link to an existing packet filter, the PCEF shall set the Packet-Filter-Operation AVP to \"ADDITION\", and shall include:\n-\ta Packet-Filter-Information AVP for each packet filter requested for addition; and\n-\tone Packet-Filter-Information AVP with only the Packet-Filter-Identifier AVP, set to the value for the linked existing filter; and\n-\tthe QoS-Information AVP to indicate the requested QoS for the new packet filters and the PCC rule containing the linked packet filter.\n-\tWhen the UE requests to modify existing packet filter the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\", and shall include:\n-\ta Packet-Filter-Information AVP, including its Packet-Filter-Identifier AVP value, for each modified packet filter; and\n-\tif the UE request includes modified QoS information the PCEF shall also include the QoS-Information AVP to indicate the updated QoS for the affected PCC rule(s).\n-\tWhen the UE requests to modify the QoS associated with existing packet filter(s), without modifying the filter(s), the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\", and shall include:\n-\tone Packet-Filter-Information AVP with only the Packet-Filter-Identifier AVP, set to the value for each of the affected packet filter(s); and\n-\tthe QoS-Information AVP to indicate the updated QoS for the affected PCC rule(s).\n-\tWhen the UE requests to delete existing packet filter the PCEF shall set the Packet-Filter-Operation AVP to \"DELETION\", and shall include:\n-\ta Packet-Filter-Information AVP for each packet filter deleted by the UE. Each Packet-Filter-Information AVP shall include a packet filter identifier as provided by the PCRF in the PCC rule within the Packet-Filter-Identifier AVP identifying the previously requested packet filter being deleted; and\n-\tthe QoS-Information AVP to indicate the updated QoS for the affected PCC rule(s).\nThe PCEF shall calculate the requested GBR, for a GBR QCI, as the sum of the previously authorized GBR for the set of affected PCC rules, containing one or more affected packet filter, adjusted with the difference between the requested GBR for the bearer and previously negotiated GBR for the bearer. For the UE request to add filters, without providing any link to an existing filter, the GBR as requested by the UE for those filters shall be used.\nIf the request covers all the PCC rules with a bearer binding to the same bearer, then the PCEF may request a change to the QCI for existing packet filters.\nA PCC rule is affected if one or more previously assigned packet filter identifiers for filters within the rule are included with the Packet-Filter-Identifier AVP within the request.\nFor the purpose of adding or modifying a packet filter, the Packet-Filter-Information AVP shall include the packet filter precedence information within the Precedence AVP and the Packet-Filter-Content, ToS-Traffic-Class, Security-Parameter-Index, Flow-Label and Flow-Direction AVPs set to the value(s) describing the packet filter provided by the UE.\nPCC rules can also be requested as a consequence of a failure in the PCC rule installation/activation or enforcement without requiring an Event-Trigger. See clause 4.5.12.\nNOTE 3:\tThe UE signalling with the network is governed by the applicable NAS signalling TS. The NAS 3GPP TS for a specific access may restrict the UE possibilities to make requests compared to what is stated above.\nIf the PCRF is, due to incomplete, erroneous or missing information (e.g. QoS, SGSN address, RAT type, TFT, subscriber information) not able to provision a policy decision as response to the request for PCC rules by the PCEF, the PCRF may reject the request using a CC Answer with the Gx experimental result code DIAMETER_ERROR_INITIAL_PARAMETERS (5140). If the PCEF receives a CC Answer with this code, the PCEF shall reject the IP-CAN session establishment or modification that initiated the CC Request.\nIf the PCRF detects that the packet filters in the request for new PCC rules received from the PCEF is covered by the packet filters of outstanding PCC rules that the PCRF is provisioning to the PCEF, the PCRF may reject the request using a CC-Answer with the Gx experimental result code DIAMETER_ERROR_CONFLICTING_REQUEST (5147). If the PCEF receives a CC-Answer with this code, the PCEF shall reject the IP-CAN session modification that initiated the CC-Request.\nIf the PCRF does not accept one or more of the traffic mapping filters provided by the PCEF in a CC Request (e.g. because the PCRF does not allow the UE to request enhanced QoS for services not known to the PCRF), the PCRF shall reject the request using a CC Answer with the Gx experimental result code DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED (5144). If the PCEF receives a CC Answer with this code, the PCEF shall reject the IP-CAN session establishment or modification that initiated the CC Request.\nThe PCRF shall not combine a rejection with provisioning of PCC rule operations in the same CC Answer.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.30",
        "clause_4.3",
        "clause_4.5.26",
        "clause_4.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.0",
      "section_id": "4.5.2.0",
      "section_title": "Overview",
      "content": "The PCRF shall indicate, via the Gx reference point, PCC rules to be applied at the PCEF. This may be using one of the following procedures:\n-\tPULL procedure (Provisioning solicited by the PCEF): In response to a request for PCC rules being made by the PCEF, as described in the preceding section, the PCRF shall provision PCC rules in the CC-Answer; or\n-\tPUSH procedure (Unsolicited provisioning): The PCRF may decide to provision PCC rules without obtaining a request from the PCEF, e.g. in response to information provided to the PCRF via the Rx reference point, or in response to an internal trigger within the PCRF. To provision PCC rules without a request from the PCEF, the PCRF shall include these PCC rules in an RA-Request message. No CCR/CCA messages are triggered by this RA-Request. The PCRF should NOT send a new RA-Request command to the PCEF until the previous RA-Request has been acknowledged for the same IP-CAN session.\nFor each request from the PCEF or upon the unsolicited provision the PCRF shall provision zero or more PCC rules. The PCRF may perform an operation on a single PCC rule by one of the following means:\n-\tTo activate or deactivate a PCC rule that is predefined at the PCEF, the PCRF shall provision a reference to this PCC rule within a Charging-Rule-Name AVP and indicate the required action by choosing either the Charging-Rule-Install AVP or the Charging-Rule-Remove AVP.\n-\tTo install or modify a PCRF-provisioned PCC rule, the PCRF shall provision a corresponding Charging-Rule-Definition AVP within a Charging-Rule-Install AVP.\n-\tTo remove a PCC rule which has previously been provisioned by the PCRF, the PCRF shall provision the name of this PCC rule as value of a Charging-Rule-Name AVP within a Charging-Rule-Remove AVP.\n-\tIf, for certain accesses, the PCRF performs the bearer binding, the PCRF may move previously installed or activated PCC rules from one IP CAN bearer to another IP CAN bearer. See annex A for further details.\nAs an alternative to providing a single PCC rule, the PCRF may provide a Charging-Rule-Base-Name AVP within a Charging-Rule-Install AVP or the Charging-Rule-Remove AVP as a reference to a group of PCC rules predefined at the PCEF. With a Charging-Rule-Install AVP, a predefined group of PCC rules is activated. With a Charging-Rule-Remove AVP, a predefined group of PCC rules is deactivated.\nThe PCRF may combine multiple of the above PCC rule operations in a single command.\nWhen the UE initiates a resource modification procedure, the PCRF shall provision PCC rule(s) that are only related to the UE's resource modification in the corresponding CCA command.\nTo activate a predefined PCC rule at the PCEF, the rule name within a Charging-Rule-Name AVP shall be supplied within a Charging-Rule-Install AVP as a reference to the predefined rule. To activate a group of predefined PCC rules within the PCEF (e.g. gold users or gaming services) a Charging-Rule-Base-Name AVP shall be supplied within a Charging-Rule-Install AVP as a reference to the group of predefined PCC rules.\nTo install a new or modify an already installed PCRF defined PCC rule, the Charging-Rule-Definition AVP shall be used. If a PCC rule with the same rule name, as supplied in the Charging-Rule-Name AVP within the Charging-Rule-Definition AVP, already exists at the PCEF, the new PCC rule shall update the currently installed rule. If the existing PCC rule already has attributes also included in the new PCC rule definition, the existing attributes shall be overwritten. Any attribute in the existing PCC rule not included in the new PCC rule definition shall remain valid.\nIf no PCC rule(s) with uplink packet filters that are provided to the UE are bound to a bearer which requires traffic mapping information (according to the rules as defined in 3GPP TS 23.060 [17]), the PCEF shall derive traffic mapping information based on implementation specific logic (e.g. traffic mapping information that effectively disallows any useful packet flows in uplink direction as described in clause 15.3.3.4 of 3GPP TS 23.060 [17]) and shall provide it to the UE.\nNOTE 1:\tFor GPRS and EPS, the state of TFT packet filters, as defined in 3GPP TS 23.060 [17], for an IP-CAN session requires that there is at most one bearer with no traffic mapping information TFT packet filter for the uplink direction.\nNOTE 2:\tFor a default bearer, the PCEF will not add traffic mapping information that effectively disallows any useful packet flows in uplink direction on its own.\nUpon installation or activation of a PCC rule, the PCEF shall then perform the bearer binding according to clause 5.4 in 3GPP TS 29.213 [8] and use the select IP CAN bearer for the new PCC rule.\nUpon the same modification of the QCI and/or ARP of all the PCC rules bound to the same bearer, the PCEF should modify the QCI and/or ARP for that bearer.\nProvisioning of predefined PCC rules upon invocation/revocation of an MPS service shall be done according to clause 5.3 in 3GPP TS 29.213 [8].\nFurther details of the binding mechanism can be found in 3GPP TS 29.213 [8].\nFor deactivating single predefined or removing PCRF-provided PCC rules, the Charging-Rule-Name AVP shall be supplied within a Charging-Rule-Remove AVP. For deactivating a group of predefined PCC rules, the Charging-Rule-Base-Name AVP shall be supplied within a Charging-Rule-Remove AVP.\nNOTE 3:\tWhen deactivating a predefined PCC rule that is activated in more than one IP-CAN bearers, the predefined PCC rule is deactivated simultaneously in all the IP-CAN bearers where it was previously activated.\nThe PCRF may request the PCEF to confirm that the resources associated to a PCC rule are successfully allocated. To do so the PCRF shall provide the Event-Trigger AVP with the value SUCCESSFUL_RESOURCE_ALLOCATION (22) if the event trigger is not previously set. In addition the PCRF shall install the rules that need resource allocation confirmation by including the Resource-Allocation-Notification AVP with the value ENABLE_NOTIFICATION (0) within the corresponding Charging-Rule-Install AVP. If a Charging-Rule-Install AVP does not include the Resource-Allocation-Notification AVP, the resource allocation shall not be notified by the PCEF even if this AVP was present in previous installations of the same rule.\nNOTE 4: The PCEF reporting the successful installation of PCC rules using RAA command means that the PCC rules are installed but the bearer binding or QoS resource reservation may not yet be completed, see 3GPP TS 29.213 [8].\nIf Enh-RAN-NAS-Cause feature is supported, the PCRF may request the PCEF to report the outcome of the release of resources related to a PCC rule. To do so the PCRF shall provide the Event-Trigger AVP with the value RESOURCE_RELEASE (53) if the event trigger is not previously set. In addition the PCRF shall provide the Resource-Release-Notification AVP with the value ENABLE_NOTIFICATION (0) with the corresponding Charging-Rule-Remove AVP. If a Charging-Rule-Remove AVP does not include the Resource-Release-Notification AVP, the outcome of the resource release shall not be notified by the PCEF. The PCRF shall maintain the PCC rules for which release confirmation is required until the PCEF notifies about the resource release outcome.\nIf the provisioning of PCC rules fails, the PCEF informs the PCRF as described in clause 4.5.12 PCC Rule Error Handling. Depending on the cause, the PCRF may decide if re-installation, modification, removal of PCC rules or any other action applies.\nIf the PCRF is unable to create a PCC rule for the response to the CC Request by the PCEF, the PCRF may reject the request as described in clause 4.5.1.\nIf the PCRF receives a request for PCC rules for an IP-CAN session from the PCEF, or a request for QoS rules for a gateway control session from the BBERF, while no suitable authorized PCC rules are configured in the PCRF or can be derived from service information provisioned by an AF, the PCRF shall check the set of services the user is allowed to access.\nIf the user is not allowed to access AF session based services, the PCRF shall check whether the user is allowed to request resources for services not known to the PCRF and whether the requested QoS and/or packet filters can be authorized. If this is the case, the PCRF shall provide a PCC rule to authorize the UE requested QoS and packet filters that were received as part of the request for PCC/QoS rules. The service data flow description shall be derived from the packet filter information. If the user is not allowed to request resources for services not known to the PCRF, the PCRF shall reject the request.\nIf the user is allowed to access AF session based services, the PCRF may, depending e.g. on the user's subscription details or operator policy, authorise the requested QoS for a timer supervised grace period (the timer started by the PCRF either by the request from the PCEF or from the BBERF) to wait for AF service information. If an AF session bound to the same IP-CAN session is ongoing and only preliminary service information was received within this AF session, the PCRF shall base the authorization of the requested QoS on the preliminary service information.\nNOTE 5:\tThis scenario can for instance be encountered for a UE terminated IMS session establishment or modification with UE initiated resource reservation, refer to 3GPP TS 29.214 [10]. If the PCRF does not authorize a request for PCC/QoS rules in this scenario, the IMS session setup can fail.\nNOTE 6:\tDuring the grace period, the QoS and packet filters requested by the UE need to be authorized even if the user is not allowed to request for resources for services not known to the PCRF or if the requested QCI is not allowed for services not known to the PCRF as it is not clear at this point in time whether the UE resource request belongs to an AF session or to a service not known to the PCRF.\nIf the preliminary service information is insufficient to construct appropriate PCC rules or no preliminary service information is available, the PCRF shall provide preliminary PCC rules to authorize the UE requested QoS and packet filters. Therefore, the preliminary PCC rules shall contain wildcarded flow description or flow description derived from possible packet filters received as part of the request for PCC/QoS rules. The PCRF may apply a dedicated charging key value to indicate to the charging subsystem that the charging key is preliminary and may be corrected later on.\nNOTE 7:\tWith the dedicated charging key, the PCRF instructs the charging subsystem to recalculate the applicable charge for the time when the dedicated charging key value was applied once the dedicated charging key value is replaced with some other value in a new provisioning of PCC rules. For example, if online charging applies, Session Charging with Unit Reservation (SCUR) can be used .When the charging key changes, the PCEF will return initially reserved credit units and the OCS then can recalculate the consumed credit units applying the rate derived from the new other charging key value and update the user's credit accordingly.\nNOTE 8:\tA preliminary PCC rule is a normal PCC rule containing preliminary information.\nIf the PCRF receives AF service information while the timer-supervised grace period is running, the PCRF shall stop the timer and may derive authorized PCC rules from this service information and update or replace the preliminary PCC rules that were previously provided for the UE requested QoS and packet filters, for instance by choosing service specific QoS parameters and charging keys.\nNOTE 9:\tThe dedicated preliminary charging key value that was previously provided by the PCRF instructs the charging subsystem to recalculate the applicable charge when the new service specific charging key is provided. The recalculation covers the time when the previous dedicated charging key value was active. The new service specific charging key is applied from that time onwards.\nIf the timer expires and the PCRF has not received any AF service information, the PCRF should apply the policy for services not known to the PCRF and may downgrade or revoke the authorization for the preliminary PCC/QoS rules (previously provided for the UE requested QoS and packet filters) in accordance with the policy for services not known to the PCRF. The PCRF should adjust the charging keys within the PCC rules and should downgrade the authorized QoS to the allowed value for the services not known to the PCRF, if required.\nFor the case where the BBERF requests QoS rules from the PCRF, the PCRF derives the QoS rules from the PCC rules and provisions the QoS rules to the BBERF according to clause 4a.5.2.\nIf the IP flow mobility is supported and the tariff depends on what access network is in use for the service data flow, then the PCRF may set the charging key of the PCC rule in accordance with the access network in use.\nIf the PCRF retrieves the corresponding transfer policy from the SPR based on the Reference Id provided by the AF, the PCRF shall take the transfer policy as input for policy decisions (e.g. setting the charging key equal to the charging key of the transfer policy, rule activation/deactivation time according to the time window).\nIf the PCRF receives IMS service information (e.g. codec data or CHEM proposed packet loss rate) over the Rx interface and the QoS mapping procedures defined in 3GPP TS 29.213 [8] subclause 6.3 for the received service information result in a QCI of 1 associated with the corresponding flows, then if the RAN-Support-Info feature is supported and if local policy allows, the PCRF shall, for those flows associated with QCI of 1, send the downlink maximum packet loss rate (i.e. the Max-PLR-DL AVP) and/or the uplink maximum packet loss rate (i.e. the Max-PLR-UL AVP) within the Charging-Rule-Definition AVP to the PCEF.\nNOTE 10:\tWhen the PCRF receives IMS service information over Rx interface with CHEM proposed packet loss rate, the PCRF sets the downlink and uplink maximum packet loss rates to the received values. Otherwise, based on local configuration, the PCRF sets the downlink and uplink maximum packet loss rates corresponding to either the most robust codec mode or the least robust codec mode of the negotiated set in each direction.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.060_clause_15.3.3.4",
        "ts_29.213_clause_5.4",
        "ts_29.213_clause_5.3",
        "clause_4.5.12",
        "clause_4.5.1",
        "clause_4",
        "ts_29.213_clause_6.3",
        "ts_23.060",
        "ts_29.213",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.1",
      "section_id": "4.5.2.1",
      "section_title": "Selecting a PCC rule for Uplink IP packets",
      "content": "If PCC is enabled, the PCEF shall select the applicable PCC rule for each received uplink IP packet within an IP CAN bearer by evaluating the packet against uplink service data flow template of PCRF-provided or predefined active PCC rules assigned to this IP CAN bearer.\nPCC rules shall be assigned to an IP CAN bearer via bearer binding; PCC Rules that contain an application identifier may be assigned to other bearer(s) with non-GBR QCI (e.g. the default bearer) in addition to the bearer where the PCC rule is bound to.\nNOTE 1:\tThe PCEF uses implementation specific logic to assign PCC Rules that contain an application identifier to additional bearer(s) for uplink bearer binding verification, i.e. to determine for what bearers the uplink service data flow detection applies. When PCC rules with application detection filters cannot be used to generate traffic mapping information for the UE, the application detection may need to inspect traffic on multiple bearers. The uplink traffic will get the QoS of the bearer carrying the traffic. The QCI of the bearer may therefore be different than the QCI of the PCC rule detecting the service data flow. The charging and other enforcement functions performed by the PCEF will still be carried out based on parameters of the PCC rule detecting the service data flow. In case the PCC rule contains a GBR QCI, the GBR resource reservation will only apply on the bearer where the PCC rule is bound to. The PCRF can prevent that uplink GBR resources are reserved by providing an uplink GBR value of zero in the PCC rule.\nFor PCC rules that contain service data flow filters, the evaluation of packets against the service data flow templates shall be done in the order of the precedence of the PCC rules. When a packet matches a service data flow template, the packet matching process for that packet is completed, and the PCC rule for that filter shall be applied.\nFor PCC rules that contain an application identifier (i.e. that refer to an application detection filter), the order and the details of the application detection are implementation specific. Once an application has been detected, the PCC rule shall however be applied under consideration of the PCC rule precedence, i.e. when multiple PCC rules overlap (regardless of whether they contain service data flow filters or an application identifier), only the PCC rule with the highest precedence shall be applied and the packet matching process for that packet is completed.\nWhen a PCRF-provided PCC rule and a predefined PCC rule have the same precedence, the uplink service data flow templates of the PCRF-provided PCC rule shall be applied.\nUplink IP packets which do not match any PCC rule assigned to the corresponding IP CAN bearer shall be silently discarded.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.2.2",
      "section_id": "4.5.2.2",
      "section_title": "Selecting a PCC rule and IP CAN Bearer for Downlink IP packets",
      "content": "If PCC is enabled, the PCEF shall select a PCC rule for each received downlink IP packet within an IP CAN session by evaluating the packet against downlink service data flow templates of PCRF-provided or predefined active PCC rules of all IP CAN bearers of the IP CAN session.\nIn case tunnelling from the TDF is used, the downlink packets marked with the corresponding DL DSCP value carried in the inner IP header, as specified in clause 4b.5.14, shall be evaluated against downlink service data flow templates of PCRF-provided or predefined active PCC rules of all IP‑CAN bearers of the IP‑CAN session.\nFor PCC rules that contain service data flow filters, the evaluation of packets against the service data flow templates shall be done in the order of the precedence of the PCC rules. When a packet matches a service data flow template, the packet matching process for that packet is completed, and the PCC rule for that template shall be applied.\nFor PCC rules that contain an application identifier (i.e. that refer to an application detection filter), the order and the details of the application detection are implementation specific. Once an application has been detected, the PCC rule shall however be applied under consideration of the PCC rule precedence, i.e. when multiple PCC rules overlap (regardless of whether they contain service data flow filters or an application identifier), only the PCC rule with the highest precedence shall be applied and the packet matching process for that packet is completed.\nWhen a PCRF-provided PCC rule and a predefined PCC rule have the same precedence, the downlink service data flow template of the PCRF-provided PCC rule shall be applied.\nThe Downlink IP Packet shall be transported within the IP CAN bearer where the selected PCC rule is mapped.\nDownlink IP packets which do not match any PCC rule of the IP CAN session shall be silently discarded.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.3",
      "section_id": "4.5.2.3",
      "section_title": "Gate function",
      "content": "The Gate Function represents a user plane function enabling or disabling the forwarding of IP packets belonging to a service data flow. A gate is described within a PCC rule. If the PCC rule contains Flow-Information AVP(s) applicable for uplink IP flows, it shall describe a gate for the corresponding uplink IP flows. If the PCC rule contains Flow-Information AVP(s) applicable for downlink IP flows, it shall describe a gate for the corresponding downlink IP flows. If the PCC rule contains the application identifier, it shall describe a gate for the corresponding detected application traffic. The Flow-Status AVP of the PCC rule shall describe if the possible uplink and possible downlink gate is opened or closed.\nThe commands to open or close the gate shall lead to the enabling or disabling of the passage for corresponding IP packets. If the gate is closed all packets of the related IP flows shall be dropped. If the gate is opened the packets of the related IP flows are allowed to be forwarded.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.2.4",
      "section_id": "4.5.2.4",
      "section_title": "Policy enforcement for \"Authorized QoS\" per PCC Rule",
      "content": "The PCRF can provide the authorized QoS for a PCC rule to the PCEF. The Provisioning of authorized QoS per PCC Rule shall be performed using the PCC rule provisioning procedure. For a PCRF-provided PCC rule, the \"Authorized QoS\" shall be encoded using a QoS-Information AVP within the Charging-Rule-Definition AVP of the PCC rule. If \"Authorized QoS\" is provided for a PCC rule, the PCEF shall enforce the corresponding policy.\nThe PCRF may indicate that the PCEF may apply resource sharing for one or more PCC rules with a GBR QCI.\nSee also clause 4.5.5.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.5"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.5",
      "section_id": "4.5.2.5",
      "section_title": "Usage Monitoring Control",
      "content": "Usage monitoring may be performed for service data flows associated with one or more PCC rules.\nThe provisioning of usage monitoring control per PCC rule shall be performed using the PCC rule provisioning procedure. For a PCRF-provided PCC rule, the monitoring key shall be set using the Monitoring-Key AVP within the Charging-Rule-Definition AVP of the PCC rule. For a predefined PCC rule, the monitoring key shall be included in the rule definition at the PCEF. Usage monitoring shall be activated both for service data flows associated with predefined PCC rules and dynamic PCC rules, including rules with deferred activation and/or deactivation times while those rules are active.\nNOTE:\tIt is recommended that the same traffic is not monitored by both PCC rules in the PCEF and ADC rules in the TDF with active usage monitoring at the same time. This avoids double counting.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.2.6",
      "section_id": "4.5.2.6",
      "section_title": "Redirect function",
      "content": "The PCRF may provide the redirect instruction for a dynamic PCC rule to the PCEF enhanced with ADC. The Provisioning shall be performed using the PCC rule provisioning procedure. The redirect instruction shall be encoded using a Redirect-Information AVP within the Charging-Rule-Definition AVP of the dynamic PCC rule. If a dynamic PCC rule includes flow informations for UE IPv4 address and IPv6 prefix address related to the same application identifier and if ADC-Add-Redirection feature is supported, two Redirect-Information AVPs may be provided simultaneously as the redirect instruction for dual stack UE addresses.\nFor a dynamic PCC rule, the redirect address may be provided as part of the dynamic PCC rule or may be preconfigured in the PCEF. A redirect destination provided within the Redirect-Server-Address AVP in a dynamic PCC Rule shall override the redirect destination preconfigured in the PCEF for this PCC rule.\nNOTE:\tThe PCEF uses the preconfigured redirection address only if it can be applied to the application traffic being detected, e.g. the redirection destination address could be preconfigured on a per application identifier basis.\nIf Redirect-Information AVP is provided for a dynamic PCC rule, the PCEF shall implement the redirection for the detected application's uplink traffic. If the Redirect-Server-Address AVP is provided within the Redirect-Information AVP and the Redirect-Support AVP is not set to REDIRECTION_DISABLED, the PCEF shall redirect the detected application's uplink traffic to this address. In this case, the redirect address type (e.g. Ipv4, Ipv6 or URL) shall be defined by the Redirect-Address-Type AVP. If the Redirect-Server-Address AVP is not provided, the redirection address preconfigured in the PCEF shall be used instead. If the Redirect-Server-Address AVP is not provided and the redirection address is not preconfigured in the PCEF for this PCC rule, the PCEF shall perform PCC Rule Error Handling as specified in clause 4.5.12.\nWhen the PCRF wants to disable the redirect function for an already installed PCC Rule, the PCRF shall update the PCC rule including the Redirect-Information AVP with Redirect-Support AVP set to REDIRECTION_DISABLED.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.7",
      "section_id": "4.5.2.7",
      "section_title": "Support for DSCP marking of downlink packets at the TDF",
      "content": "In order to support policy and charging control in the downlink direction by the PCEF for an application detected and marked by the TDF as specified in clause 4b.5.14, the PCRF may either install a corresponding dynamic PCC Rule or activate a pre-defined PCC rule, which identifies traffic based on the corresponding DSCP value (provided by the ToS-Traffic Class AVP within the Flow-Information AVP).\nNOTE:\tThis solution is particularly useful for QoS enforcement in the downlink direction procedures performed by the PCEF. The TDF may still perform application detection and control as per received ADC Rules, including application detection reporting to the PCRF, enforcement control, usage monitoring control and charging, while applying DSCP marking. The PCEF may also perform then policy and charging control in the downlink direction.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.2.8",
      "section_id": "4.5.2.8",
      "section_title": "Traffic Steering Control support",
      "content": "This procedure takes place if the TSC feature as defined in subclause 5.4.1 is supported.\nThe PCRF may instruct the PCEF to apply a traffic steering control which consists of applying a specific (S)Gi-LAN traffic steering policy for the traffic detected based on application level information or service data flow level information. The PCRF achieves this by providing the Charging-Rule-Definition AVP within the Charging-Rule-Install AVP (s) with the corresponding parameters as follows:\n-\teither the application to be detected is identified by the TDF-Application-Identifier AVP or\n-\tthe service data flow to be detected is identified by the Flow-Information AVP(s)\n-\tand the traffic steering policy identifier(s) within the Traffic-Steering-Policy-Identifier-DL AVP and/or Traffic-Steering-Policy-Identifier-UL AVP.\nThe PCRF may also provision the traffic steering control information by activating the pre-defined PCC rule(s) in the PCEF.\nWhen a combination of PCEF with traffic steering control feature and TSSF is deployed, the PCEF shall behave as specified in subclause 6.1.17 of 3GPP TS 23.203 [7]. In this case, the PCRF shall include the packet marking information within the Traffic-Steering-Policy-Identifier-DL AVP and/or Traffic-Steering-Policy-Identifier-UL AVP included within the Charging-Rule-Definition AVP. The PCRF shall ensure that the value included in these AVP(s) is aligned with the traffic detection information provided over the St reference point. That is, it shall ensure that the value is the same as the applicable value provided as part of the service data flow information or as the value(s) configured in the TSSF referred by the application identifier. See subclause 4c.4.1 in this Technical Specification for the details in the Diameter based St reference point. See 3GPP TS 29.155 [52] for the details in the REST based St reference point.\nNOTE:\tThe PCRF and the PCEF are configured with the packet marking and forwarding mechanism to be applied in the PCEF. This information will be aligned with the information configured in the TSSF for traffic detection. The flow information provided over St reference point can be used for traffic detection at the TSSF when the PCEF is configured to do packet marking and forwarding using e.g. ToS value in the IP header. The Application Identifier provided over St reference point can be used when the PCEF is configured to do packet marking and forwarding using e.g. GRE or NSH.\nThe PCEF shall enforce the traffic steering policy as defined in subclause 4.4.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.1",
        "ts_23.203_clause_6.1.17",
        "clause_4",
        "clause_4.4.2",
        "ts_23.203",
        "ts_29.155"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.3",
      "section_id": "4.5.3",
      "section_title": "Provisioning of Event Triggers",
      "content": "The PCRF may provide one or several event triggers within one or several Event-Trigger AVP to the PCEF using the PCC rule provision procedure. Event triggers may be used to determine which IP-CAN session modification or specific event causes the PCEF to re-request PCC rules. Although event trigger reporting from PCEF to PCRF can apply for an IP CAN session or bearer depending on the particular event, provisioning of event triggers will be done at session level. The Event-Trigger AVP may be provided in combination with the initial or subsequent PCC rule provisioning.\nNOTE 1:\tThere are event triggers that will only take effect when additional information is provided. The PCRF may provide the additional information together with the event trigger or in subsequent PCC rule provisioning.The PCEF will only report those event triggers when the related data is available.\nThe PCRF may add new event triggers or remove the already provided ones at each request from the PCEF or upon the unsolicited provision from the PCRF. In order to do so, the PCRF shall provide the new complete list of applicable event triggers including the needed provisioned Event-Trigger AVPs in the CCA or RAR commands.\nThe PCRF may remove all previously provided event triggers by providing the Event-Trigger AVP set to the value NO_EVENT_TRIGGERS. When an Event-Trigger AVP is provided with this value, no other Event-Trigger AVP shall be provided in the CCA or RAR command. Upon reception of an Event-Trigger AVP with this value, the PCEF shall not inform PCRF of any event except for those events that are always reported and do not require provisioning from the PCRF.\nIf no Event-Trigger AVP is included in a CCA or RAR operation, any previously provisioned event trigger will be still applicable. Unless otherwise stated for a certain event trigger, the PCRF shall be able to modify the data related to an event trigger without providing again a previously provisioned event trigger if such event trigger is still armed.\nThere are event triggers that are required to be unconditionally reported from the PCEF to the PCRF as specified in clause 5.3.7 even though the PCRF has not provisioned them to the PCEF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.4.1",
      "section_id": "4.5.4.1",
      "section_title": "Provisioning of Charging Addresses",
      "content": "In combination with the initial PCC rule provisioning only, the PCRF may provide OFCS and/or OCS addresses within a Charging-Information AVP to the PCEF defining the offline and online charging system addresses respectively. These shall overwrite any predefined addresses at the PCEF. Both primary and secondary addresses for OFCS and/or OCS shall be provided simultaneously. Provisioning OFCS or OCS addresses without PCC rules for offline or online charged service data flows, respectively, shall not be considered as an error since such PCC rules may be provided in later provisioning.\nIf no OCS address is available at the PCEF (i.e. no predefined OCS addresses, and no OCS addresses supplied by the PCRF and/or by the Charging Characteristics), the PCEF shall use the IMSI (MNC and MCC values) of the user to construct the OCS Home network domain name as specified in 3GPP TS 23.003 [25], clause 25.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_25",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.4.2",
      "section_id": "4.5.4.2",
      "section_title": "Provisioning of Default Charging Method",
      "content": "The default charging method indicates what charging method shall be used for every PCC rule where the charging method is omitted. The PCEF may have a pre-configured Default charging method.\nUpon the initial interaction with the PCRF, the PCEF shall provide the pre-configured Default charging method if available within the Online AVP and/or Offline AVP embedded directly within the CCR command to the PCRF.\nUpon the initial interaction with the PCEF, the PCRF may provide default charging method within the Online AVP or Offline AVP embedded directly within the CCA command to the PCEF. The default charging method provided by the PCRF shall overwrite any predefined default charging method at the PCEF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.4.4",
      "section_id": "4.5.4.4",
      "section_title": "Provisioning of Access Network Charging Identifier",
      "content": "When the Access-Network-Charging-Identifier-Gx AVP is unknown for an AF session to the PCRF, the PCRF may request the PCEF to provide the Access-Network-Charging-Identifier-Gx AVP associated to dynamic PCC rules. To do so, the PCRF shall provide the Event-Trigger AVP with the value CHARGING_CORRELATION_EXCHANGE (28) if the event trigger is not previously set and the Charging-Correlation-Indicator AVP indicating CHARGING_IDENTIFIER_REQUIRED within the Charging-Rule-Install AVP.\nThe PCRF shall interpret that the Access-Network-Charging-Identifier-Gx AVP is known as follows:\n-\tFor case 1, when the Access-Network-Charging-Identifier-Gx AVP is received and includes the IP-CAN-Session-Charging-Scope AVP;\n-\tFor case 2a and case 2b when the Access-Network-Charging-Identifier-Gx AVP is received.\nIf the Event-Trigger AVP with the value CHARGING_CORRELATION_EXCHANGE (28) has been provided to the PCEF, the PCEF shall include the access network charging identifier that the PCEF has assigned for the dynamic PCC Rules within the Access-Network-Charging-Identifier-Gx where the Charging-Correlation-Indicator AVP indicated CHARGING_IDENTIFIER_REQUIRED.\nNOTE:\tThe PCRF indicates CHARGING_IDENTIFIER_REQUIRED in the Charging-Correlation-Indicator AVP for the dynamic PCC rules related to the flows for which the AF has requested a notification about Access Network Charging Information, according to 3GPP TS 29.214 [10].",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.0",
      "section_id": "4.5.5.0",
      "section_title": "Overview",
      "content": "The PCRF may provide authorized QoS to the PCEF.\nThe authorized QoS shall be provisioned within a CCA or RAR Diameter message as QoS-Information AVP. The provisioning of the authorized QoS (which is composed of QCI, ARP and bitrates) is performed from the PCRF to the PCEF. The authorized QoS can refer to a PCC rule, to an IP CAN bearer, to a QCI or to an APN.\n-\tWhen the authorized QoS applies to an IP CAN bearer, it shall be provisioned outside a Charging-Rule-Definition AVP and it shall also include the Bearer-Identifier AVP to indicate what bearer it applies to.\n-\tWhen the authorized QoS applies to a PCC rule, it shall be provisioned within the corresponding PCC rule by including the QoS-Information AVP within the Charging-Rule-Definition AVP. The QoS-Information AVP shall not contain a Bearer-Identifier AVP.\n-\tWhen the authorized QoS for a PCC rule with a GBR QCI is candidate for resource sharing an instruction on the allowed sharing may be provisioned within the Charging-Rule-Definition AVP by including Sharing-Key-UL AVP and/or Sharing-Key-DL AVP.\n-\tWhen the authorized QoS applies to QCI, authorised MBR per QCI is supplied. In such a case the authorized QoS shall be provisioned outside a Charging-Rule-Definition AVP at the command level. This case applies only for IP-CAN types that support non-GBR bearers that have a separate MBR (i.e. 3GPP-GPRS access). Its applicability is specified in annex A.\n-\tWhen the authorized QoS applies to an APN, authorised APN-Aggregate-Max-Bitrate-UL/DL AVPs or Extended-APN-AMBR-UL/DL AVPs (see subclause 4.5.30)is supplied. In such a case the authorized QoS shall be provisioned outside a Charging-Rule-Definition AVP at command level.\n-\tWhen the authorized QoS applies to the default EPS bearer it shall be provisioned within the Default-EPS-Bearer-QoS AVP.\nAuthorized QoS at IP-CAN bearer level is access specific. See Annex A for further details.\nThe authorized QoS provides appropriate values for the resources to be enforced.\nThe authorized QoS for a PCC rule is a request for allocating the corresponding resources, and the authorized QoS for a QCI is a request for an upper limit for the MBR that the PCEF assigns to non-GBR bearers with that QCI.\nThe Provisioning of authorized QoS per PCC rule is a part of PCC rule provisioning procedure.\nIf the PCEF cannot allocate any of the resources as authorized by the PCRF, the PCEF informs the PCRF and acts as described in clause 4.5.12 PCC Rule Error handling.\nThe PCEF is responsible for enforcing the policy based authorization.\nQoS authorization information may be dynamically provisioned by the PCRF or it can be a pre-defined PCC rule in the PCEF. Moreover, all the parameters of the authorized QoS can be changed, but no order is defined for QCI.\nNOTE 1:\tA change of QCIs cannot be described as an upgrade or downgrade and also no QCI can be referred to as the higher or lower.Whether the QCI is permitted to be changed or not is subject to both operator policies and normal restrictions on changing from a non-GBR QCI value to GBR QCI value on a default bearer.\nNOTE 2:\tAll attributes of the ARP QoS parameter can be changed but only the ARP priority level represents an ordered range of values. The ARP priority level attribute represents the actual priority for the service/user with the value 1 as the highest and can thus be upgraded and downgraded.\nThe PCEF shall make sure that the total QoS information of the PCC rules for one IP-CAN bearer does not exceed the authorized QoS information, i.e. the information received from the PCRF.\nIf the PCRF is unable to make a decision for the response to the CC-Request by the PCEF, the PCRF may reject the request as described in clause 4.5.1.\n4.5.5.0a\tProvisioning of authorized QoS per IP CAN bearer\nThe authorized QoS per IP-CAN bearer is used if the bearer binding is performed by the PCRF (as defined in 3GPP TS 29.213 [8]). Provisioning of authorized QoS per IP-CAN bearer is access specific. See Annex A for further details.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.5.30",
        "clause_4.5.12",
        "clause_4.5.1",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.1",
      "section_id": "4.5.5.1",
      "section_title": "Policy enforcement for authorized QoS per IP CAN bearer",
      "content": "The PCEF is responsible for enforcing the policy based authorization, i.e. to ensure that the requested QoS is in-line with the \"Authorized QoS\" per IP CAN Bearer. Policy enforcement of authorized QoS per IP-CAN bearer is access specific. See Annex A for further details.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.5.2",
      "section_id": "4.5.5.2",
      "section_title": "Policy provisioning for authorized QoS per service data flow",
      "content": "The Provisioning of authorized QoS per service data flow is a part of PCC rule provisioning procedure, as described in clause 4.5.2.0.\nThe authorized QoS per service data flow shall be provisioned within the corresponding PCC rule by including the QoS-Information AVP within the Charging-Rule-Definition AVP in the CCA or RAR commands. This QoS-Information AVP shall not contain a Bearer-Identifier AVP.\nIf the PCRF wants to ensure that a PCC Rule is always bound to the default bearer, the policy provisioning for the related authorized QoS shall be done as described in subclause 4.5.5.13.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.2.0",
        "clause_4.5.5.13"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.3",
      "section_id": "4.5.5.3",
      "section_title": "Policy enforcement for authorized QoS per service data flow",
      "content": "If an authorized QoS is defined for a PCC rule, the PCEF shall limit the data rate of the service data flow corresponding to that PCC rule not to exceed the maximum authorized bandwidth for the PCC rule by discarding packets exceeding the limit.\nNOTE 1:\tIn order to support services that generate media with variable bitrate (e.g. video), the policing function in the PCEF could need to measure the enforced MBR with a sliding window that averages over a suitable time period. For example, for MTSI media, 3GPP TS 26.114 [57] recommends a default period of 2 seconds and provides further considerations regarding suitable time periods for speech and video.\nThe PCEF shall reserve the resources necessary for the guaranteed bitrate for the PCC rule upon receipt of a PCC rule provisioning including QoS information. For GBR bearers the PCEF should set the bearer's GBR to the sum of the GBRs of all PCC rules that are active/installed and bound to that GBR bearer. For GBR bearers the PCEF should set the bearer's MBR to the sum of the MBRs of all PCC rules that are active/installed and bound to that GBR bearer.\nNOTE 2:\tSince the PCRF controls the GBR value in the PCC rule, the PCRF can prevent that uplink GBR resources are reserved by providing an uplink GBR value of zero for that PCC rule This may be useful e.g. for a PCC rule with application identifier as the uplink traffic can be received in other bearers than the one the PCC rule is bound to.\nFor non-GBR bearers, when the IP-CAN type supports non-GBR bearers that have a separate MBR (i.e. 3GPP-GPRS), the PCEF may also set the bearer's MBR to the sum of the MBRs of all PCC rules that are active and bound to that non-GBR bearer unless that sum exceeds a possibly provisioned authorized QoS per QCI for the bearer's QCI (see clause 4.5.5.6). If an authorized QoS per QCI has been provisioned for the bearer's QCI, the PCEF should set the bearer's MBR to the corresponding MBR. The access-specific BS Manager (as included in 3GPP TS 29.213 [8]) within the PCEF receives the authorised access-specific QoS information from the Translation/mapping function. Then the PCEF shall start the needed procedures to ensure that the provisioned resources are according to the authorized values. This may imply that the PCEF needs to request the establishment of new IP CAN bearer(s) or the modification of existing IP CAN bearer(s). If the enforcement is not successful, the PCEF shall inform the PCRF as described in clause 4.5.5.0.\nUpon deactivation or removal of a PCC rule, the PCEF shall free the resources reserved for that PCC rule.\nIf the PCRF has indicated that a service data flow needs to be bound to the default bearer, the policy enforcement for the authorized QoS for the corresponding service data flow shall be done according to subclause 4.5.5.13.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.5.6",
        "clause_4.5.5.0",
        "clause_4.5.5.13",
        "ts_26.114",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.4",
      "section_id": "4.5.5.4",
      "section_title": "Coordination of authorized QoS scopes in mixed mode",
      "content": "Coordination of authorized QoS scopes in mixed mode is access specific. See Annex A for further details.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.5.5",
      "section_id": "4.5.5.5",
      "section_title": "Provisioning of authorized QoS per QCI",
      "content": "When the IP-CAN type supports non-GBR bearers that have a separate MBR (i.e. 3GPP-GPRS) the PCRF may provision an authorized QoS per QCI for non-GBR bearer QCI values. The PCRF shall not provision an authorized QoS per QCI for GBR bearer QCI values.\nThe authorized QoS per QCI shall be provisioned at RAR or CCA command level using the QoS-Information AVP with the QoS-Class-Identifier AVP and the Maximum-Requested-Bandwidth-UL AVP and/or the Maximum-Requested-Bandwidth-DL AVP. The Guaranteed Bitrate values shall not be filled up. Multiple QoS-Information AVPs can be used for assigning authorized QoS for several QCIs with one command. The authorized QoS per QCI may be provisioned before or in connection with the activation of the first PCC rule with a certain QCI. The PCRF may also provision a changed authorized QoS per QCI at any time.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.5.6",
      "section_id": "4.5.5.6",
      "section_title": "Policy enforcement for authorized QoS per QCI",
      "content": "The PCEF can receive an authorized QoS per QCI for non GBR-bearer QCI values for those IP-CAN types that support non-GBR bearers that have a separate MBR (i.e. 3GPP-GPRS). It sets an upper limit for the MBR that the PCEF may assign to a non-GBR bearer with that QCI. If the PCEF receives an authorized QoS per QCI for a non-GBR bearer QCI value, it shall not set a higher MBR for that bearer than the provisioned MBR. The PCEF should assign the authorized MBR per QCI to a non-GBR bearer with that QCI to avoid frequent IP-CAN bearer modifications as PCC rules can be dynamically activated and deactivated.\nIf multiple IP-CAN bearers within the same IP-CAN session are assigned the same QCI, the authorized MBR per QCI applies independently to each of those IP-CAN bearers.\nThe access-specific BS Manager (as included in 3GPP TS 29.213 [8]) within the PCEF receives the authorized access-specific QoS information from the Translation/mapping function.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.7",
      "section_id": "4.5.5.7",
      "section_title": "Provisioning of authorized QoS per APN",
      "content": "The PCRF may provision the authorized QoS per APN as part of the IP-CAN session establishment procedure and may modify it at any time as long as there is an IP-CAN session active for that APN. The authorized QoS per APN may be modified as part of the IP-CAN session establishment or modification of any of the IP-CAN sessions active for a UE within that APN. To do so, the PCRF shall provision the authorized QoS per APN for each IP-CAN session for that APN.\nThe authorized QoS per APN, if provisioned by the PCRF, shall be provisioned at RAR or CCA command level using the QoS-Information AVP via one or both of the following mechanisms:\n-\tUnconditional APN policy info: The APN‑Aggregate‑Max‑Bitrate‑UL AVP and/or the APN‑Aggregate‑Max‑Bitrate‑DL AVP, or the Extended-APN-AMBR-UL AVP and/or the Extended-APN-AMBR-DL AVP (see subclause 4.5.30) shall be included.\n-\tConditional APN policy info: Support of ConditionalAPNPolicyInfo feature is required. While providing conditional APN policy info one or more instances of the Conditional‑APN‑Aggregate‑Max-Bitrate AVP shall be included. Each instance includes APN policy related info, i.e. the APN‑Aggregate‑Max‑Bitrate‑UL AVP and/or the APN‑Aggregate‑Max‑Bitrate‑DL AVP, or the Extended-APN-AMBR-UL AVP and/or the Extended-APN-AMBR-DL AVP (see subclause 4.5.30). Additionally, a list of the applicable RAT‑Type and/or IP‑CAN‑Type AVP(s), defining the condition for enforcing the APN policy info, shall also be included. If the PCEF receives one or more instances of the Conditional APN‑Aggregate‑Max‑Bitrate AVP(s), then it shall replace all the existing instances of Conditional‑APN‑Aggregate‑Max‑Bitrate AVP(s), i.e. received earlier for the APN of this user, with the newly received instance(s). The PCRF shall provide the QoS-Information AVP excluding the Conditional‑APN‑Aggregate‑Max‑Bitrate AVP to remove the previously provisioned conditional APN policy info. If the PCEF receives the QoS‑Information AVP without Conditional‑APN‑Aggregate‑Max‑Bitrate AVP, it shall delete the previously provisioned instance(s) of Conditional‑APN‑Aggregate‑Max‑Bitrate AVP(s).\nNOTE 1:\tThe QoS per APN limits the aggregate bit rate of all Non‑GBR bearers of the same APN, i.e. the GBR bearers are outside the scope of QoS per APN.\nIn order to provide authorized QoS per APN, the QoS-Information AVP shall not include any other AVP than the APN-Aggregate-Max-Bitrate UL AVP, the APN-Aggregate-Max-Bitrate-DL AVP, the Extended-APN-AMBR-UL AVP, the Extended-APN-AMBR-DL AVP (see subclause 4.5.30) and/or the Conditional-APN-Aggregate-Max-Bitrate AVP.\nThe PCRF may provision the authorized QoS per APN, based on information obtained from the SPR or internal policies.\nNOTE 2:\tWhen looking up policies for an APN from the SPR or internal storage, the PCRF can apply the APN matching procedures in Annex H of 3GPP TS 29.213 [8].\nFor the case that BBF is located at the PCEF, if the modification of the QoS per APN fails, the PCEF shall retain the existing QoS per APN without any modification and send to the PCRF a new CCR command with the Event Trigger set to APN‑AMBR_MODIFICATION_FAILURE providing the retained value within the APN‑Aggregate‑Max‑Bitrate‑UL AVP and/or the APN‑Aggregate‑Max‑Bitrate‑DL AVP, or the Extended-APN-AMBR-UL AVP and/or the Extended-APN-AMBR-DL AVP (see subclause 4.5.30) included in QoS-Information AVP. Additionally, the current RAT-Type and IP-CAN-Type of the UE shall be included if the failure corresponds to a conditional QoS per APN.\nNOTE 3:\tThe access network can reject the modification of the bearer if the APN‑AMBR does not comply with the roaming agreement. Refer to 3GPP TS 23.401 [32].\nFor provisioning of time conditioned authorized QoS per APN, see subclause 4.5.5.12.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30",
        "clause_4.5.5.12",
        "ts_29.213",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.8",
      "section_id": "4.5.5.8",
      "section_title": "Policy enforcement for authorized QoS per APN",
      "content": "The PCEF shall be able to enforce the AMBR per APN.\nThe PCEF may receive an authorized QoS per APN at IP-CAN session establishment and also at IP-CAN session modification. It sets an upper limit for the bandwidth usage for all the non-GBR bearers for that APN. The PCEF shall limit to that value the aggregated traffic of all SDFs of the same APN that are associated with Non-GBR QCIs.\nThe authorized QoS per APN shall be enforced by the PCEF in the following way:\n-\tUnconditional APN policy info: the PCEF enforces the APN AMBR values for every current RAT type and IP‑CAN type for which no conditional APN policy info applies.\n-\tConditional APN policy info: The PCEF enforces the APN AMBR values corresponding to the RAT‑Type and IP‑CAN‑Type matching the current RAT‑Type and IP‑CAN‑Type of the UE for the given APN.\nIf there is an Unconditional APN policy info provided or if it has been previously provisioned and there is also a Conditional APN policy info provided, then the Conditional APN policy info where the conditions specified by the Conditional APN policy info are met shall be enforced. Otherwise, the Unconditional APN policy info shall be enforced.\nIf conditions from multiple Conditional APN policy info are met at the same time then the APN policy related to the most strict matching condition is enforced, e.g. APNPolicy1 specifies IP CAN Type only and APNPolicy2 specifies IP CAN Type (with the value same as in APNPolicy1) and an RAT Type, both, then the APNPolicy2 shall be enforced when the UE's current IP CAN Type and RAT-Type matches with the condition specified by APNPolicy2.\nIf conditions from multiple APN policy info are met at the same time and all of these APN policies are equally applicable, e.g. APNPolicy1 specifies IP CAN Type only and APNPolicy2 specifies RAT-Type only and if the UE's current IP-CAN-Type matches with APNPolicy1 and the UE's current RAT-Type matches with APNPolicy2, then the PCEF should apply the APN policy with APNPolicy2.\nNOTE:\tThe scenario of multiple APN policies such that all of them are equally applicable, e.g. as mentioned above, can be prevented by ensuring a proper configuration at the PCRF.\nFor enforcement of time conditioned authorized QoS per APN, see subclause 4.5.5.12.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.9",
      "section_id": "4.5.5.9",
      "section_title": "Provisioning of authorized QoS for the Default EPS Bearer",
      "content": "The PCRF may provision the authorized QoS for the default EPS bearer. The authorized QoS may be obtained upon interaction with the SPR.\nThe default EPS bearer QoS information shall be provisioned at RAR or CCA command level using the Default-EPS-Bearer-QoS AVP including the QoS-Class-Identifier AVP and the Allocation-Retention-Priority AVP. The provided QoS-Class-Identifier AVP shall include a non-GBR corresponding value.\nFor provisioning of time conditioned authorized EPS Bearer QoS information, see subclause 4.5.5.12.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.10",
      "section_id": "4.5.5.10",
      "section_title": "Policy enforcement for authorized QoS of the Default EPS Bearer",
      "content": "The PCEF may receive the authorized QoS for the default bearer over Gx interface. The PCEF enforces it which may lead to the change of the subscribed default EPS Bearer QoS.\nIf the modification of the default EPS bearer QoS information fails, the PCEF shall retain the existing default EPS bearer QoS without any modification and send the PCRF a new CCR command and include with Event Trigger set to DEFAULT-EPS-BEARER-QOS _MODIFICATION_FAILURE providing the retained values within the Allocation-Retention-PriorityAVP and QoS-Class-Identifier AVP included in Default-EPS-Bearer-QoS AVP.\nNOTE 1:\tThe access network can reject the modification of the default bearer if the default beaer QoS does not comply with the roaming agreement. Refer to 3GPP TS 23.401 [32].\nNOTE 2:\tThe access network can reject the modification of the default bearer when the PCRF invokes/revokes the priority handling for the default bearer as defined in subclause 4.5.19.1.4.\nFor enforcement of time conditioned authorized default EPS bearer QoS information, see subclause 4.5.5.12.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.19.1.4",
        "clause_4.5.5.12",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.11",
      "section_id": "4.5.5.11",
      "section_title": "Policy provisioning and enforcement of authorized QoS for service data flows that share resources",
      "content": "If the ResShare feature is supported by both the PCEF and PCRF as described in clause 5.4.1, the PCRF may indicate that the PCEF should commonly reserve resources for a set of PCC rules. The PCEF shall then, for PCC rules bound to the same bearer and the same sharing key value , use the highest GBR value among those PCC rules as input for calculating the common GBR value when reserving bearer resources. The GBR value for each direction shall be considered separately, so that the uplink and downlink GBR values may originate from different PCC rules.\nThe PCEF may based on internal logic use the highest MBR value among the provided PCC rules indicated to share resources, when determining the MBR for the bearer. Each individual PCC rule is still subject to data rate policing based on its own MBR values.\nThe PCRF shall provide the Sharing-Key-UL AVP and/or Sharing-Key-DL AVP within the Charging-Rule-Definition AVP in order to indicate that the related PCC rule may share resources with other PCC rules bound to the same bearer. The PCEF shall apply resource sharing if at least two PCC rules bound to the same bearer share the same value in the Sharing-Key-UL AVP and/or Sharing-Key-DL AVP.\nIf Sharing-Key-UL AVP and/or Sharing-Key-DL AVP with a modified value is received in the PCEF it will replace any previously provided value for the specified PCC rule. If Sharing-Key-UL AVP and/or Sharing-Key-DL AVP is omitted, then any previous value for the omitted AVP is still valid.\nWhen modifying the value of Sharing-Key-UL AVP and/or Sharing-Key-DL AVP to a PCC rule that is subject to resource sharing the PCEF may adjust the resource sharing of the remaining PCC rules.\nNOTE 1:\tA PCC rule that is deleted is also removed from the resource sharing, while the remaining PCC rules continue their sharing relationship.\nNOTE 2:\tThe state of resource sharing ends when less than two of the PCC rules in the set remains.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.4.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.12.1",
      "section_id": "4.5.5.12.1",
      "section_title": "General",
      "content": "Up to four Conditional-Policy-Information AVPs may be provisioned by the PCRF in an RAR or CCA command to change the authorized QoS per APN (if the CondPolicyInfo feature is supported) and/or the authorized default EPS bearer QoS (if the CondPolicyInfo-DefaultQoS feature is supported) based on time conditions.\nNOTE 1:\tThe same instance of the Conditional-Policy-Information AVP can convey information related to the authorized QoS per APN and authorized default EPS bearer QoS when the same time condition applies to both.\nIf the PCRF wants to provide time conditioned APN policy info(s) and/or authorized default EPS bearer QoS, each instance of the Conditional-Policy-Information AVP shall include an Execution-Time AVP. At the time indicated in the Execution-Time AVP, the PCEF shall perform the requested change without interaction with the PCRF.\nNOTE 2:\tThe PCEF retains remaining time conditioned APN policy information that have an Execution-Time in the future.\nTo replace a set of time conditioned policy info(s), the PCRF shall include a complete set of Conditional-Policy-Information AVP(s) describing all time conditioned policy info(s) applicable from that point onward. The new set of time conditioned policy info(s) shall replace all previously provided time conditioned policies.\nTo delete the set of time conditioned policy info(s) the following procedures apply:\n-\tIf the CondPolicyInfo feature is supported, but the CondPolicyInfo-DefaultQoS feature is not supported, the PCRF shall send a command excluding the Conditional-Policy-Information AVP and including the QoS-Information AVP with new authorized APN policy info.\n-\tIf CondPolicyInfo-DefaultQoS feature is supported the PCRF shall provide a command containing the Conditional-Policy-Information AVP with no AVPs within.\nNOTE 3:\tFor services that depend on specific APN policy info and/or authorized default EPS bearer QoS (e.g. MPS session), the PCRF is responsible to ensure that no time conditioned policy info(s) interfere with the service (e.g. by removing the time conditioned APN policy info or time conditioned authorized default EPS bearer QoS before the respective change time is reached).",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.5.12.2",
      "section_id": "4.5.5.12.2",
      "section_title": "Time conditioned authorized QoS per APN",
      "content": "The PCRF shall only apply the procedures in the present subclause if the the CondPolicyInfo feature is supported.\nIf the time conditioned APN policy info includes Conditional APN policy info, then ConditionalAPNPolicyInfo feature is required to be supported in addition.\nThe procedures in subclause 4.5.5.12.1 apply with clarifications in the present subclause.\nThe Conditional-Policy-Information AVP shall include the Unconditional APN policy info and/or Conditional APN policy info as defined in subclause 4.5.5.7.\nNOTE:\tTime conditioned APN policy info for the APN-AMBR change helps reducing the signaling load over Gx. However the APN-AMBR change needs to be communicated to the UE. Consequently a simultaneous change of the APN-AMBR for many UE(s) may introduce a signaling storm in the EPC (e.g. over S5/S8/S2a/S2b). The PCRF can avoid this simultaneous change of the APN-AMBR (e.g. spread the time conditioned  change over time for many UEs).\nThe PCEF shall after applying a time conditioned instruction to change the authorized QoS per APN enforce the authorized QoS per APN as defined in subclause 4.5.5.8.\nIf the PCRF deletes time conditioned authorized QoS per APN, it shall within the same command provide a QoS-Information AVP with new authorized APN policy info.\nIf Conditional-Policy-Information AVP(s) to change the authorized QoS per APN are received by the PCEF and the earliest Execution-Time is in the past, then the PCEF shall immediately enforce the most recent time conditioned instance containing an authorized QoS per APN that is not in the future.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.5.12.1",
        "clause_4.5.5.7",
        "clause_4.5.5.8"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.12.3",
      "section_id": "4.5.5.12.3",
      "section_title": "Time conditioned authorized default EPS bearer QoS",
      "content": "The PCRF shall only apply the procedures in the present subclause if the the CondPolicyInfo-DefaultQoS feature is supported.\nThe time conditioned authorized default EPS bearer QoS is only applicable for IP CAN types where the Provisioning of authorized QoS for the Default EPS Bearer procedure in subclause 4.5.5.9 is applicable.\nThe procedures in subclause 4.5.5.12.1 apply with clarifications in the present subclause.\nThe Conditional-Policy-Information AVP shall include the default EPS bearer QoS info in the Default-EPS-bearer-QoS AVP as described in subclause 4.5.5.9.\nNOTE:\tTime conditioned default EPS bearer QoS info change helps reducing the signaling load over Gx. However the default EPS Bearer QoS info change needs to be communicated to the UE. Consequently a simultaneous change of the default EPS bearer QoS for many UE(s) may introduce a signaling storm in the EPC (e.g. over S5/S8/S2a/S2b). The PCRF can avoid this simultaneous change of the default EPS bearer QoS (e.g. spread the time conditioned  change over time for many UEs).\nThe PCEF shall after applying a time conditioned instruction to change the authorized default EPS bearer QoS enforce the authorized default EPS bearer QoS as defined in subclause 4.5.5.10. If the Rule-Bound-to-Default-Bearer feature is supported by both the PCEF and PCRF as described in clause 5.4.1, all PCC rule(s) with the Default-Bearer-Indication AVP set to BIND_TO_DEF_BEARER (0) shall remain bound to the default bearer as described in subclause 4.5.5.12. For any other PCC rule previously bound to the default bearer, PCEF shall then perform the bearer binding according to clause 5.4 in 3GPP TS 29.213 [8].\nIf the PCRF deletes time conditioned authorized default EPS bearer QoS, it shall within the same command provide a Default-EPS-Bearer-QoS AVP with new authorized default EPS bearer QoS.\nIf Conditional-Policy-Information AVP(s) to change the authorized default EPS bearer QoS are received by the PCEF and the earliest Execution-Time is in the past, then the PCEF shall immediately enforce the most recent time conditioned instance containing an authorized default EPS bearer QoS that is not in the future.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.5.9",
        "clause_4.5.5.12.1",
        "clause_4.5.5.10",
        "clause_5.4.1",
        "clause_4.5.5.12",
        "ts_29.213_clause_5.4",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.5.13",
      "section_id": "4.5.5.13",
      "section_title": "Policy provisioning and enforcement of authorized QoS for service data flows that shall be bound to the default bearer",
      "content": "If the Rule-Bound-to-Default-Bearer feature is supported by both the PCEF and PCRF as described in clause 5.4.1, the PCRF may indicate to the PCEF that a PCC rule shall be bound to the default bearer and shall remain on the default bearer. The PCEF shall then, for the indicated PCC rule bind it to the default bearer until the PCC rule is removed or until the PCRF modifies the PCC rule to set the Default-Bearer-Indication AVP to the value BIND_TO_APPLICABLE_BEARER(1). The PCEF in this second case shall evaluate the full QoS information within the QoS-Information AVP and follow normal policy enforcement procedures for authorized QoS per service data flow as descibed in subclause 4.5.5.3.\nNOTE:\tQoS-Class-Identifier AVP and Allocation-Retention-Priority AVP within QoS-Information AVP included in the PCC rule are only used by the PCEF for bearer binding purposes when the Default-Bearer-Indication AVP is not included in the PCC rule or it is set to BIND_TO_APPLICABLE_BEARER (1).\nThe PCRF shall provide the Default-Bearer-Indication AVP within the Charging-Rule-Definition AVP set to BIND_TO_DEF_BEARER (0)  in order to indicate that the related PCC rule shall be bound to the default bearer.\nIf the Default-Bearer-Indication AVP set to BIND_TO_DEF _BEARER (0) within the Charging-Rule-Definition AVP is received in the PCEF, the PCEF shall bind the related PCC rule to the default bearer. This remains valid until the PCC rule is removed or if the PCRF indicates to the PCEF that the binding to the default bearer no longer applies.The PCEF shall ignore any values included in QoS-Class-Identifier AVP and Allocation-Retention-Priority AVP within the QoS-Information AVP of the Charging-Rule-Definition AVP if the Default-Bearer-Indication AVP set to BIND_TO_DEF _BEARER (0) is included in the same Charging-Rule-Definition AVP.If the PCRF has previously indicated to the PCEF that a PCC rule shall be bound to the default bearer, to indicate that the binding to the default bearer no longer applies the PCRF shall initiate a PCC rule modification as descibed in subclause 4.5.5.2, including the Default-Bearer-Indication AVP set to BIND_TO_APPLICABLE_BEARER (1). The PCEF in this case shall evaluate the full QoS information within the QoS-Information AVP  and follow normal policy enforcement procedures for authorized QoS per service data flow as descibed in subclause 4.5.5.3.\nIf the PCRF has not previously indicated to the PCEF that a PCC rule shall be bound to the default bearer (i.e. it may be bound to another bearer) in order to indicate that the binding to the default bearer applies, the PCRF shall initiate a PCC rule modification as described in subclause 4.5.5.2, including the Default-Bearer-Indication AVP set to BIND_TO_DEF_BEARER (0). The PCEF in this case shall follow the procedures described in this subclause.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.4.1",
        "clause_4.5.5.3",
        "clause_4.5.5.2"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.6",
      "section_id": "4.5.6",
      "section_title": "Indication of IP-CAN Bearer Termination Implications",
      "content": "This procedure applies to those IP-CAN networks that support multiple bearers. This procedure applies only to dedicated bearers. For 3GPP-GPRS IP-CAN network, see annex A.\nIf the last IP CAN bearer within an IP CAN session is being terminated, the PCEF shall apply the procedures in clause 4.5.7 to indicate the IP CAN session termination.\nWhen the PCEF detects that a dedicated IP-CAN bearer could not be activated or has been terminated it shall remove the affected PCC rules and send a CCR command to the PCRF with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\", including the Charging-Rule-Report AVP specifying the affected PCC rules with the PCC-Rule-Status set to inactive and including the Rule-Failure-Code AVP assigned to the value RESOURCE_ALLOCATION_FAILURE (10).\nIf the RAN-NAS-Cause feature is supported, the PCEF shall provide the available access network information within the 3GPP-User-Location-Info AVP (if available), TWAN-Identifier (if available and Trusted-WLAN feature is supported), User-Location-Info-Time AVP (if available) and 3GPP-MS-TimeZone AVP (if available). Additionally, if the PCEF receives from the access network the RAN cause and/or the NAS cause, the TWAN cause or the untrusted WLAN cause due to bearer termination the PCEF shall provide the received cause(s) in the RAN-NAS-Release-Cause AVP included in the Charging-Rule-Report AVP.\nThis shall be done whenever one of these conditions applies:\n-\tThe PCEF is requested by the IP-CAN to initiate the deactivation of a bearer,\n-\tPCC rule(s) are removed/deactivated by the PCEF without PCRF request (e.g. due to unsuccessful reservation of resources to satisfy the bearer binding).\nNOTE:\tThe PCEF will not initiate the deactivation of the bearer upon reception of the UE-initiated resource modification procedure indicating packet filter deletion. If all the PCC rules associated to a bearer have been deleted as a consequence of the PCRF interaction, the PCEF will initiate the bearer termination procedure towards the IP-CAN network.\nSignalling flows for the IP-CAN bearer termination and details of the binding mechanism are presented in 3GPP TS 29.213 [8].",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.7",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.7",
      "section_id": "4.5.7",
      "section_title": "Indication of IP-CAN Session Termination",
      "content": "The PCEF shall contact the PCRF when the IP-CAN session is being terminated. The PCEF shall send a CC-Request with CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\".\nIf the RAN-NAS-Cause feature is supported, the PCEF shall provide the available access network information within the 3GPP-User-Location-Info AVP (if available), TWAN-Identifier (if available and Trusted-WLAN is supported), User-Location-Info-Time AVP (if available) and 3GPP-MS-TimeZone AVP (if available). Additionally, if the PCEF receives from the access network the RAN cause and/or the NAS cause, the TWAN cause or the untrusted WLAN cause due to IP-CAN session termination the PCEF shall provide the received cause(s) in the RAN-NAS-Release-Cause AVP at command level.\nIf the PCEF needs to send an IP-CAN session termination request towards a PCRF which is known to have restarted since the IP-CAN session establishment, the PCEF should not send CC-Request to inform the PCRF.\nNOTE:\tWhen a PCRF is known to have restarted, the PCC contexts and Diameter sessions affected by the failure are lost in the PCRF, the PCEF does not need to inform the PCRF for this case.\nWhen the PCRF receives the CC-Request, it shall acknowledge this message by sending a CC-Answer to the PCEF.\nNOTE:\tAccording to DCC procedures, the Diameter Credit Control session is being terminated with this message exchange.\nSignalling flows for the IP-CAN session termination are presented in 3GPP TS 29.213 [8].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.8",
      "section_id": "4.5.8",
      "section_title": "Request of IP-CAN Bearer Termination",
      "content": "This procedure applies to those IP-CAN networks that support multiple bearers. This procedure applies only to dedicated bearers. For 3GPP-GPRS IP-CAN network, see annex A.\nAs a consequence of the removal of PCC rules initiated by the PCRF, the PCEF may require the termination of an existing bearer. The PCRF may not be aware that it requests the termination of an IP-CAN bearer by removing certain PCC rules.\nThe PCRF may request the removal of the PCC rules by using the PCC rule provisioning procedures in clause 4.5.2 to remove all PCRF-provisioned PCC rules and deactivate all PCC rules predefined within the PCEF. The PCRF may either completely remove these PCC rules from the IP CAN session or reinstall them (e.g. by changing the QoS or charging information) within the IP CAN session. When all the PCC rules applied to one bearer have been deleted and/or deactivated, the PCEF will instantly start the bearer termination procedure.\nWhen Enh-RAN-NAS-Cause feature is supported, the PCRF removing PCC rules using the RAR command shall maintain locally the PCC rules that were marked as requiring release confirmation until the the PCEF reports RESOURCE_RELEASE (53) event trigger as described in subclause 5.3.7.\nNOTE:\tThis is done to allow the PCRF to notify the AF  when there is an abnormal termination of the bearer. The PCRF does not have to retry the removal of these PCC Rules.\nWhen Enh-RAN-NAS-Cause feature is supported, the PCEF shall maintain locally the PCC rules that were included in the Charging-Rule-Remove AVP with the Resource-Release-Notification AVP set to the value ENABLE_NOTIFICATION (0) until it reports RESOURCE_RELEASE (53) event trigger as described in subclause 5.3.7 upon reception of the resource release outcome from the network.\nIf the selected Bearer Control Mode (BCM) is UE-only, and the PCRF receives a trigger for the removal of all PCC rules from the AF, the following steps apply. In order to avoid race conditions, the PCRF should start a timer to wait for the UE-initiated resource release message. If a UE-initiated resource release is performed before timer expiry, the PCRF will receive an Indication of IP-CAN Bearer Termination Implications according to clause 4.5.6 and shall then not perform the removal of the PCC rules. Otherwise, if the timer expires, the PCRF shall remove/deactivate the affected PCC rules that have been previously installed/activated.\nIf the selected BCM is UE-only, and the PCRF decides to remove one or more PCC rules due to an internal trigger or trigger from the SPR, the PCRF shall instantly remove/deactivate the affected PCC rules that have been previously installed/activated.\nIf the selected BCM is UE/NW, and the PCRF removes/deactivates at the PCEF, all PCC rules bound to an IP CAN bearer (due to any trigger), the PCEF shall instantly start the procedures to terminate the related IP-CAN bearer.\nIf no more PCC rules are applied to an IP CAN bearer, the PCEF shall apply IP CAN specific procedures to terminate the IP CAN bearer, if such procedures exist for this IP CAN type.\nIf the Enh-RAN-NAS-Cause feature is supported and the bearer is terminated as a consequence of the removal of one or more PCC rules, the PCEF shall inform the PCRF about the completion of the bearer procedure  related to the removal of PCC rules that indicated resource release notification by including the Resource-Release-Notification AVP with the value ENABLE_NOTIFICATION (0) within the corresponding Charging-Rule-Remove AVP. by reporting the RESOURCE_RELEASE (53) event trigger.If the PCEF received from the access network some RAN/NAS release cause(s), TWAN release cause(s) or untrusted WLAN release cause(s), the PCEF shall also provide the received cause(s) in the Charging-Rule-Report AVP. The PCEF shall also provide the available access network information within the 3GPP-User-Location-Info AVP (if available), TWAN-Identifier (if available and Trusted-WLAN is supported), User-Location-Info-Time AVP (if available) and 3GPP-MS-TimeZone AVP (if available).",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.2",
        "clause_5.3.7",
        "clause_4.5.6"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.9",
      "section_id": "4.5.9",
      "section_title": "Request of IP-CAN Session Termination",
      "content": "The PCRF may request the IP-CAN session termination in the following instances:\n-\tIf the PCRF decides to terminate an IP CAN session due to an internal trigger or trigger from the SPR, the PCRF shall send an RAR command including the Session-Release-Cause AVP to the PCEF. The PCEF shall acknowledge the command by sending an RAA command to the PCRF.\n-\tThe PCRF may also decide to terminate an IP CAN session upon receiving CCR command with a CC-Request-Type AVP set to the value \"UPDATE_REQUEST\" from the PCEF (e.g. when usage quota reached). In that case, the PCRF shall send a CCA command including the Session-Release-Cause AVP to the PCEF.\nThe PCEF shall instantly remove/deactivate all the PCC rules that have been previously installed or activated on that IP-CAN session. The PCEF shall apply IP CAN specific procedures to terminate the IP CAN session. Furthermore, the PCEF shall apply the indication of IP CAN Session Termination procedure in clause 4.5.7.\nSee Annex A for 3GPP-GPRS access type.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.10",
      "section_id": "4.5.10",
      "section_title": "Bearer Control Mode Selection",
      "content": "The PCEF may indicate, via the Gx reference point, a request for Bearer Control Mode (BCM) selection at IP-CAN session establishment or IP-CAN session modification (e.g. as a consequence of an SGSN change). It will be done using the PCC rule request procedure.\nNOTE 1:\tFor the cases where Gxx is deployed in the network, the Bearer Control Mode selection may occur either in the Gxx reference point or Gx reference point, depending on the IP-CAN type. See access specific annexes.\nWhen applicable for the IP-CAN type, if information about the support of network-initiated procedures is available, the PCEF shall supply at IP-CAN Session Establishment, the Network-Request-Support AVP in the CC-Request with a CC-Request-Type AVP set to the value \"INITIAL_REQUEST\". At IP-CAN Session Modification, the PCEF shall supply, if available, the Network-Request-Support AVP in the CC-Request with a CC-Request-Type AVP set to the value \"UPDATE_REQUEST\". The Network-Request-Support AVP indicates the access network support of the network requested bearer control.\nThe PCRF derives the selected Bearer-Control-Mode AVP based on the received Network-Request-Support AVP, access network information, subscriber information and operator policy. If the selected bearer control mode is UE_NW, the PCRF shall decide what mode (UE or NW) shall apply for every PCC rule.\nNOTE 2:\tFor operator-controlled services, the UE and the PCRF may be provisioned with information indicating which mode is to be used.\nWhen applicable for the IP-CAN type, at IP-CAN session establishment, if the PCEF provided the Network-Request-Support AVP, the selected bearer control mode shall be provided within the Bearer-Control-Mode AVP to the PCEF using the PCC Rules provision procedure. At IP-CAN session modification, if the PCEF provided the Network-Request-Support AVP, the PCRF shall also provide the Bearer-Control-Mode AVP with the new value if the selected bearer control mode has changed. The selected value will be applicable for the whole IP-CAN session.\nWhen the bearer binding function is changed from the BBERF to the PCEF, the PCEF may indicate, via the Gx reference point, a request for Bearer Control Mode (BCM) selection at IP-CAN session modification as described above.\nNOTE 3:\tThe bearer binding function can be changed from the BBERF to the PCEF when the UE moves from a case 2a) system or a case 2b) system to a case 1) system (see 3GPP TS 29.213 [8]).",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.11",
      "section_id": "4.5.11",
      "section_title": "Provisioning of Event Report Indication",
      "content": "For the cases where Gxa and/or Gxc are deployed in the network, the PCEF may indicate the PCRF to be informed about specific changes occurred in the access network. In this case, the PCRF shall subscribe to the appropriate event triggers in the BBERF according to clause 4a.5.8. After receiving the reply of the event subscription from the BBERF, the PCRF shall send the event related information to the PCEF by using a RAR command. The Event Report concept is defined in 3GPP TS 23.203 [7] clause 3.1.\nWhen PCRF is notified that an event is triggered in the BBERF, if the PCEF has previously requested to be informed of the specific event, the PCRF shall notify the PCEF about the event occurred together with additional related information. This notification will be done by using the Event-Report-Indication AVP. There may be neither PCC Rule provisioning nor Event Trigger provisioning together with event report indication in this message.\nWhenever the PCEF subscribes to an event report indication by using the CCR command, the PCRF shall only send the corresponding currently applicable values which have been updated (e.g. 3GPP-User-Location-Info, 3GPP2-BSID, etc.) to the PCEF in the CCA if available. In this case, the Event-Trigger AVPs shall not be included.\nNOTE:\tThe PCRF can get the currently applicable values during the IP-CAN session establishment procedure or during the information reporting from the BBERF when the BBERF gets event subscription from the PCRF as defined in clause 5.3.7.\nWhen multiple BBERFs exist as in flow mobility case, the PCEF may subscribe to different event triggers at different BBERFs. In this case, the PCEF shall include the Routing-IP-Address AVP within the Event-Report-Indication AVP to identify the BBERF for which the event triggers are to be installed. If the PCEF did not include Routing-IP-Address AVP within the Event-Report-Indication AVP, then the Event-Report-Indication AVP applies to all the BBERFs and the same event triggers will be installed on all of them.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4",
        "ts_23.203_clause_3.1",
        "clause_5.3.7",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.12",
      "section_id": "4.5.12",
      "section_title": "PCC Rule Error Handling",
      "content": "If the installation/activation of one or more PCC rules fails, the PCEF shall include one or more Charging-Rule-Report AVP(s) in either a CCR or an RAA command as described below for the affected PCC rules. Within each Charging-Rule-Report AVP, the PCEF shall identify the failed PCC rule(s) by including the Charging-Rule-Name AVP(s) or Charging-Rule-Base-Name AVP(s), shall identify the failed reason code by including a Rule-Failure-Code AVP, and shall include the PCC-Rule-Status AVP as described below:\n-\tIf the installation/activation of one or more PCC rules fails using a PUSH mode (i.e., the PCRF installs/activates a rule using RAR command), the PCEF shall communicate the failure to the PCRF in the RAA response to the RAR if the validation of the PCC Rule was unsuccessful or in a CCR command if the resource allocation for the PCC Rule was unsuccessful.\n-\tIf the installation/activation of one or more PCC rules fails using a PULL mode (i.e., the PCRF installs/activates a rule using a CCA command) the PCEF shall send the PCRF a new CCR command and include the Rule-Failure-Code AVP.\nIf the installation/activation of one or more new PCC rules (i.e., rules which were not previously successfully installed) fails, the PCEF shall set the PCC-Rule-Status to INACTIVE for both the PUSH and the PULL modes.\nThe removal of a PCC rule shall not fail, even if the IP-CAN session procedures with the UE fail. The PCEF shall retain information on the removal and conduct the necessary IP-CAN session procedures with the UE when it is possible.\nIf the modification of a currently active PCC rule using PUSH mode fails, the PCEF shall retain the existing PCC rule as active without any modification unless the reason for the failure has an impact also on the existing PCC rule. The PCEF shall report the modification failure to the PCRF using the RAA command when the validation of the PCC Rule installation was unsuccessful or using the CCR command when the resource allocation for the corresponding PCC Rule was unsuccessful.\nIf the modification of a currently active PCC rule using PULL mode fails, the PCEF shall retain the existing PCC rule as active without any modification unless the reason for the failure has an impact also on the existing PCC rule. The PCEF shall report the modification failure to the PCRF using the CCR command.\nIf the RuleVersioning feature is supported and the PCRF included a Content-Version AVP as part of the Charging-Rule-Definition AVP when installing or modifying a PCC rule for both the PULL and PUSH modes, then if the resource allocation for the corresponding PCC rule was unsuccessful, the PCEF shall include the Content-Version AVP as part of the Charging-Rule-Report AVP. Depending on the value of the Rule-Failure-Code AVP, and when applicable, depending also on the value of the Content-Version AVP, for PULL and PUSH mode, the PCRF may decide whether retaining of the old PCC rule, re-installation, modification, removal of the PCC rule or any other action applies.\nIf a PCC rule was successfully installed/activated, but can no longer be enforced by the PCEF, the PCEF shall send the PCRF a new CCR command and include a Charging-Rule-Report AVP. The PCEF shall include the Rule-Failure-Code AVP within the Charging-Rule-Report AVP, and shall set the PCC-Rule-Status to INACTIVE and include the rule content version within the Content-Version AVP if it was included when the PCC rule was provisioned.\nNOTE:\tWhen the PCRF receives PCC-Rule-Status set to INACTIVE, the PCRF does not need request the PCEF to remove the inactive PCC rule.\nIf the RAN-NAS-Cause feature is supported and as part of any of the procedures described in this clause the PCEF receives from the access network some RAN/NAS release cause(s), TWAN release cause(s) or untrusted WLAN release cause(s), the PCEF shall also provide the received cause(s) in the Charging-Rule-Report AVP. If RAN-NAS-Cause feature is supported the PCEF shall provide the available access network information within the 3GPP-User-Location-Info AVP (if available), TWAN-Identifier (if available and Trusted-WLAN is supported), User-Location-Info-Time AVP (if available) and 3GPP-MS-TimeZone AVP (if available).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.13",
      "section_id": "4.5.13",
      "section_title": "Time of the day procedures",
      "content": "PCEF shall be able to perform PCC rule request as instructed by the PCRF. To do so, the PCRF shall provide the Event-Trigger AVP with the value REVALIDATION_TIMEOUT (17) if the event trigger is not previously set and in addtition the Revalidation-Time AVP when set by the PCRF. This shall cause the PCEF to trigger a PCRF interaction to request PCC rules from the PCRF for an established IP CAN session. The PCEF shall stop the timer once the PCEF triggers an REVALIDATION_TIMEOUT event. The PCEF should send the PCC rule request during a preconfigured period before the indicated revalidation time.\nNOTE 1:\tThe PCRF is expected to be prepared to provide a new policy, as desired for the revalidation time, during a preconfigured period before the revalidation time.The preconfigured periods in the PCEF and PCRF need to be aligned.\nPCRF shall be able to provide a new value for the revalidation timeout by including Revalidation-Time AVP in CCA or RAR. The PCRF may provide the Revalidation-Time AVP together with the event trigger REVALIDATION_TIMEOUT or in a subsequent PCC rule provisioning.\nPCRF shall be able to stop the revalidation timer by disabling the REVALIDATION_TIMEOUT event trigger.\nNOTE 2:\tBy disabling the REVALIDATION_TIMEOUT the revalidation time value previously provided to the PCEF is not applicable anymore.\nThe PCRF may control at what time the status of a PCC rule changes.\n1)\tIf Rule-Activation-Time is specified only and has not yet occurred, then the PCEF shall set the PCC rule inactive and make it active at that time. If Rule-Activation-Time has passed, then the PCEF shall immediately set the PCC rule active.\n2)\tIf Rule-Deactivation-Time is specified only and has not yet occurred, then the PCEF shall set the PCC rule active and make it inactive at that time. If Rule-Deactivation-Time has passed, then the PCEF shall immediately set the PCC rule inactive.\n3)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, and also when the PCC rule is provided before or at the time specified in the Rule-Deactivation-Time, the PCEF shall handle the rule as defined in 1) and then as defined in 2).\n4)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, and also when the PCC rule is provided before or at the time specified in the Rule-Activation-Time, the PCEF shall handle the rule as defined in 2) and then as defined in 1).\n5)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has already occurred for both, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, then the PCEF shall immediately set the PCC rule inactive.\n6)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has passed for both, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, then the PCEF shall immediately set the PCC rule active.\n7)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified with the same time, the PCEF shall report a PCC rule error for the concerned PCC rule, as specified in subclause 4.5.12, with the Rule-Failure-Code set the value \"SAME_TIME_ERROR\".\nPCC Rule Activation or Deactivation will not generate any CCR commands with Charging-Rule-Report since PCRF is already aware of the state of the rules.\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified in the Charging-Rule-Install then it will replace the previously set values for the specified PCC rules. If Rule-Activation-Time AVP, Rule-Deactivation-Time AVP or both AVPs are omitted, then any previous value for the omitted AVP is no longer valid.\nThe 3GPP-MS-TimeZone AVP, if available, may be used by the PCRF to derive the Rule-Activation-Time and Rule-Deactivation-Time.\nIf the PCC rule(s) that include the Rule-Activation-Time AVP are bound to a bearer that will require traffic mapping information to be sent to the UE, the PCEF shall report the failure to the PCRF by including the Charging-Rule-Report AVP with the Rule-Failure-Code set the value \"NO_BEARER_BOUND (15)\" for the affected PCC rule(s) identified by the Charing-Rule-Name AVP in either a CCR or an RAA command.\nNOTE 3:\tThis limitation prevents dependencies on the signalling of changed traffic mapping information towards the UE.\nThe PCC rules including Rule-Activation-Time and Rule-Deactivation-Time shall not be applied for changes of the QoS or service data flow filter information.\nThe PCRF may modify a currently installed PCC rule, including setting, modifying or clearing its deferred activation and/or deactivation time. When modifying a dynamic PCC rule with a prior and/or new deferred activation and/or deactivation time, the PCRF shall provide all attributes of that rule in the Charging-Rule-Definition AVP, including attributes that have not changed.\nNOTE 4:\tIn this case, the PCRF omission of an attribute that has a prior value will erase that attribute from the PCC rule.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.14",
      "section_id": "4.5.14",
      "section_title": "Trace activation/deactivation",
      "content": "Trace activation/deactivation at the P-GW takes place via the PCRF and is 3GPP-EPS access specific. See Annex B for further information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.15.1",
      "section_id": "4.5.15.1",
      "section_title": "Functional Entities",
      "content": "The PCRF shall store a configurable list of Emergency APNs that are valid for the operator to which the PCRF belongs to.\nFor emergency APNs, the IMSI may not be present. The PCEF, BBERF and PCRF shall support request for PCC/QoS Rules that do not include an IMSI.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.15.2.1",
      "section_id": "4.5.15.2.1",
      "section_title": "Request for PCC Rules for Emergency services",
      "content": "The PCEF executes the same procedure as for a Request for PCC Rules unrelated to Emergency Services described in clause 4.5.1.\nA PCEF that requests PCC Rules at IP-CAN Session Establishment shall send a CCR command with CC-Request-Type AVP set to value \"INITIAL_REQUEST\" and the Called-Station-Id AVP including the Emergency APN. The PCEF may include the IMSI within the Subscription-Id AVP and if the IMSI is not available the PCEF shall include the IMEI(SV) within the User-Equipment-Info AVP or the User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported. The PCEF may include the rest of the attributes described in clause 4.5.1. The PCEF may also include the MSISDN if available within the Subscription-Id AVP.\nAny PCEF-initiated requests for PCC Rules for an IMS Emergency service that include the \"RESOURCE_MODIFICATION_REQUEST\" Event-Trigger AVP shall be rejected by the PCRF with the error DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED.\nIf the PCRF detects that the initial or subsequent CCR command shall be rejected, it shall execute the procedure for the type of Gx experimental result code described in clause 4.5.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.15.2.2.1",
      "section_id": "4.5.15.2.2.1",
      "section_title": "Provisioning of PCC Rules at Gx session establishment",
      "content": "The PCRF shall detect that a Gx session is restricted to IMS Emergency services when a CCR command is received with a CC-Request-Type AVP set to value \"INITIAL_REQUEST\" and the Called-Station-Id AVP includes a PDN identifier that matches one of the Emergency APNs from the configurable list. The PCRF:\n-\tshall provision PCC Rules restricting the access to Emergency Services (e.g. P-CSCF(s), DHCP(s) and DNS (s) and SUPL(s) addresses) as required by local operator policies in a CCA command according to the procedures described in clause 4.5.2.\n-\tmay provision the authorized QoS that applies to the default EPS bearer within the Default-EPS-Bearer-QoS AVP in a CCA command according to the procedures described in clause 4.5.5.10 except for obtaining the authorized QoS upon interaction with the SPR. The value for the Priority-Level AVP shall be assigned as required by local operator policies (e.g. if an IMS Emergency session is prioritized the Priority-Level AVP may contain a value that is reserved for an operator domain use of IMS Emergency sessions). If the IP-CAN-Type AVP is assigned to \"3GPP-EPS\" or \"3GPP-GPRS\" the values for Pre-emption-Capability AVP and the Pre-emption-Vulnerability AVP shall be assigned as required by local operator policies.\n-\tmay provision the authorized QoS that applies to an APN in a CCA command according to the procedures described in clause 4.5.5.7.\n-\tshall always assign NW mode to the PCC Rules that are bound to an IP-CAN session restricted to Emergency services.\nWhen the PCEF detects that the provisioning of PCC Rules failed, it shall execute the procedure for the type of Gx experimental result code described in clause 4.5.2.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.2",
        "clause_4.5.5.10",
        "clause_4.5.5.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.15.2.2.2",
      "section_id": "4.5.15.2.2.2",
      "section_title": "Provisioning of PCC Rules for Emergency Services",
      "content": "When the PCRF receives IMS service information from the AF for an Emergency service and derives authorized PCC Rules from the service information, the Priority-Level AVP in the QoS information within the PCC Rule shall be assigned a priority as required by local operator policies (e.g. if an IMS Emergency session is prioritized the Priority-Level AVP may contain a value that is reserved for an operator domain use of IMS Emergency session). If the IP-CAN Type AVP is assigned to \"3GPP-EPS\" or \"3GPP-GPRS\" and the Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP were received within the Allocation-Retention-Priority AVP in the Default-EPS-Bearer-QoS AVP in the initial CCR command, the values of the Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP shall also be assigned as required by local operator policies.\nThe PCRF shall immediately initiate a PUSH procedure as described in clause 4.5.2.0 to provision PCC Rules and the procedures described in clause 4.5.5.2 to provision the authorized QoS per service data flow.\nThe provisioning of PCC Rules at the PCEF that require the establishment of a dedicated bearer for emergency services shall cancel the inactivity timer in the PCEF, if running.\nAny PCEF-initiated request for PCC Rules for an IMS Emergency service triggered by Event-Trigger AVP assigned to \"RESOURCE_MODIFICATION_REQUEST\" (i.e. UE-initiated resource reservation) shall be rejected by the PCRF with the error DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED. If the Bearer Control Mode is assigned to \"UE_ONLY\" and the PCRF receives a request for PCC Rules that are associated with an Emergency service, it shall provision PCC Rules as described in clause 4.5.2 and the authorized QoS per service data flow as described in clause 4.5.2.2.\nThe PCEF shall execute the procedures described in clause 4.5.2.0 and clause 4.5.5.3 to ensure that a new IP-CAN bearer is established for the Emergency service.\nWhen the PCEF detects that the provisioning of PCC Rules failed, it shall execute the procedure for the type of Gx experimental result code described in clause 4.5.12.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.2.0",
        "clause_4.5.5.2",
        "clause_4.5.2",
        "clause_4.5.2.2",
        "clause_4.5.5.3",
        "clause_4.5.12"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.15.2.3",
      "section_id": "4.5.15.2.3",
      "section_title": "Removal of PCC Rules for Emergency Services",
      "content": "The reception of a request to terminate an AF session for an IMS Emergency service by the PCRF triggers the removal of PCC Rules assigned to the terminated IMS Emergency Service from the PCEF by using a RAR command with Charging-Rule-Remove AVP including the removed PCC Rules.\nAt reception of a RAR that removes one or several PCC Rules from an IP-CAN Session restricted to emergency services the PCEF shall:\n-\twhen all PCC Rules bound to an IP-CAN bearer are removed, initiate an IP-CAN bearer termination procedure as defined in clause 4.5.8.\n-\twhen not all PCC Rule bound an IP-CAN bearer are removed, initiate an IP-CAN bearer modification procedure as defined in clause 4.5.2 and clause 4.5.5.1.\nIn addition, the PCEF shall initiate an inactivity timer if all PCC Rules with a QCI other than the default bearer QCI or the QCI used for IMS signalling were removed from the IP-CAN session restricted to Emergency Services. When the inactivity timer expires the PCEF shall initiate an IP-CAN session termination procedure as defined in clause 4.5.7.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.8",
        "clause_4.5.2",
        "clause_4.5.5.1",
        "clause_4.5.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.15.2.4",
      "section_id": "4.5.15.2.4",
      "section_title": "Removal of PCC Rules at Gx session termination",
      "content": "The reception of a request to terminate the IP-CAN session restricted to IMS Emergency session shall trigger the termination of the Gx session for IMS Emergency session as defined in clause 4.5.7.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.16",
      "section_id": "4.5.16",
      "section_title": "Requesting Usage Monitoring Control",
      "content": "The PCRF may indicate, via the Gx reference point, the need to apply monitoring control for the accumulated usage of network resources on an IP-CAN session basis. Usage is defined as volume or time of user plane traffic. Monitoring for traffic volume and traffic time can be performed in parallel. The data collection for usage monitoring control shall be performed per monitoring key, which may apply for a single service data flow, a set of service data flows or for all the traffic in an IP-CAN session. If the usage monitoring of an IP-CAN session level is enabled, the PCRF may request the PCEF to exclude a single service data flow or a set of service data flows from the usage monitoring of IP-CAN session level.\nIf the PCRF requests usage monitoring control and if at this time, the PCRF is not subscribed to the \"USAGE_REPORT\" Event-Trigger, the PCRF shall include the Event-Trigger AVP, set to the value \"USAGE_REPORT\", in a CC-Answer or RA-Request. The PCRF shall not remove the \"USAGE_REPORT\" Event-Trigger AVP while usage monitoring is still active in the PCEF.\nAt IP-CAN session establishment and modification, the PCRF may provide the applicable thresholds, volume threshold, time threshold or both volume threshold and time threshold, for usage monitoring control to the PCEF, together with the respective monitoring keys. To provide the initial threshold for one or more monitoring key(s), the PCRF may include the threshold in either RA-Request or in the response of a CC-Request initiated by the PCEF.\nDuring the IP-CAN session establishment, the PCRF may receive information about total allowed usage per PDN and UE from the SPR, i.e. the overall amount of allowed traffic volume and/or time of usage that are to be monitored per PDN and UE and/or total allowed usage for Monitoring key(s) per PDN and UE.\nNOTE:\tThe details associated with the Sp reference point are not specified in this Release.\nIn order to provide the applicable threshold for usage monitoring control, the PCRF shall include a Usage-Monitoring-Information AVP per monitoring key. The threshold level shall be provided in its Granted-Service-Unit AVP. Threshold levels may be defined for:\n-\tthe total volume only; or\n-\tthe uplink volume only; or\n-\tthe downlink volume only; or\n-\tthe uplink and downlink volume; or\n-\tthe time.\nThe PCRF shall provide the applicable volume threshold(s) in the CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs and/or time threshold in the CC-Time AVP of the Granted-Service-Unit AVP. The monitoring key shall be provided in the Monitoring-Key AVP. The PCRF may provide multiple usage monitoring control instances. The PCRF shall indicate if the usage monitoring instance applies to the IP-CAN session or to one or more PCC rules. For this purpose, the Usage-Monitoring-Level AVP may be provided with a value respectively set to SESSION_LEVEL or PCC_RULE_LEVEL. The PCRF may provide one usage monitoring control instance applicable at IP-CAN session level and one or more usage monitoring instances applicable at PCC Rule level. If the IP-CAN level usage monitoring is enabled and if the service data flow(s) need to be excluded from IP-CAN session level usage monitoring, the PCRF shall provide an indication of exclusion from session level monitoring associated with the respective PCC rule(s) by including the Monitoring-Flags AVP with the bit 0 set in the corresponding Charging-Rule-Install AVP when the PCRF installs or updates the PCC rule(s). If the exclusion is enabled, the PCRF may disable the exclusion again by including the Monitoring-Flags AVP with the bit 0 not set in the corresponding Charging-Rule-Install AVP.\nThe PCRF may provide a Monitoring-Time AVP to the PCEF for the monitoring keys(s) in order to receive reports for the accumulated usage before and after the monitoring time occurs within the report triggered by the events defined in 4.5.17.1-4.5.17.5. In such a case, there may be two instances of Granted-Service-Unit AVP within Usage-Monitoring-Information AVP per monitoring key. One of them indicates the threshold levels before the monitoring time occurs, and the other one, which includes Monitoring-Time AVP, indicates the subsequent threshold levels after the monitoring time occurs. The detailed functionality in such a case is defined by 4.5.17.6.\nIf the PCRF wishes to modify the threshold level for one or more monitoring keys, the PCRF shall provide the thresholds for all the different levels applicable to the corresponding monitoring key(s).\nIf the PCRF wishes to modify the monitoring key for the session level usage monitoring instance, it shall disable the existing session level monitoring usage instance following the procedures defined in 4.5.17.3 and shall provide a new session level usage monitoring instance following the procedures defined in this clause. The PCRF may enable the new session level usage monitoring instance and disable the existing session level usage monitoring instance in the same command.\nWhen the accumulated usage is reported in a CCR command, the PCRF shall indicate to the PCEF if usage monitoring shall continue for that IP-CAN session, usage monitoring key, or both as follows:\n-\tIf monitoring shall continue for specific level(s), the PCRF shall provide the new thresholds for the level(s) in the CC-Answer using the same AVP as before (CC-Total-Octets, CC-Input-Octets, CC-Output-Octets AVP or CC-Time AVP within the Granted-Service-Unit AVP);\n-\totherwise, if the PCRF wishes to stop monitoring for specific level(s) the PCRF shall not include an updated threshold in the CCA command for the stopped level(s) i.e. the corresponding CC-Total-Octets, CC-Input-Octets, CC-Output-Octets or CC-Time AVPs shall not be included within Granted-Service-Units AVP.\nIf both volume and time thresholds were provided and the threshold for one of the measurements is reached, the PCEF shall report this event to the PCRF and the accumulated usage since last report shall be reported for both measurements.\nWhen usage monitoring is enabled, the PCRF may request the PCEF to report accumulated usage for one or more enabled monitoring keys regardless if a usage threshold has been reached by sending to the PCEF, within a CC-Answer or RA-Request, the Usage-Monitoring-Information AVP with the Usage-Monitoring-Report AVP set to the value USAGE_MONITORING_REPORT_REQUIRED. The PCRF shall only require PCEF to report accumulated usage for one or more monitoring keys in a CC-Answer when the PCEF has not provided accumulated usage in the CC-Request for the same monitoring key(s).\nTo specify the usage monitoring key for which usage is requested the PCRF shall include the usage monitoring key within the Monitoring-Key AVP within the Usage-Monitoring-Information AVP. To request usage be reported for all enabled usage monitoring keys the PCRF shall omit the Monitoring-Key.\nThe PCRF shall process the usage reports and shall perform the actions as appropriate for each report.\nRefer to subclause 4.5.25.2.9 for usage monitoring control support for NBIFOM.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.25.2.9"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.17.0",
      "section_id": "4.5.17.0",
      "section_title": "General",
      "content": "When usage monitoring is enabled, the PCEF shall measure the volume and/or the time of usage of the IP-CAN session or the volume and/or the time of usage of the applicable service data flows. The PCEF shall be able to support volume and time measurements simultaneously for a given IP-CAN session or service data flows. If the PCC rule is installed or updated with the Monitoring-Flags AVP with the bit 0 set, the PCEF shall not include the corresponding service data flow in the volume and/or time measurement on IP-CAN session level.\nWhen the time based usage monitoring is supported, the PCRF may optionally indicate to the PCEF, along with other usage monitoring information provided, the Inactivity Detection Time within the Quota-Consumption-Time AVP. This value represents the time interval after which the time measurement shall stop for the Monitoring Key, if no packets are received belonging to the corresponding Monitoring Key. Time measurement shall resume again on receipt of a further packet belonging to the Monitoring Key.\nTime measurement for a Monitoring key shall also be stopped when time based usage monitoring is disabled, if this happens before the Inactivity Detection Time is reached.\nIf an Inactivity Detection Time value of zero is provided, or if no Inactivity Detection Time is present within the usage monitoring information provided by the PCRF, the time measurement shall be performed continuously from the point at the first packet is received matching the applicable Monitoring Key and until time based usage monitoring is disabled.\nThe PCEF shall report accumulated usage to the PCRF in the following conditions:\n-\twhen a usage threshold is reached;\n-\twhen all PCC rules for which usage monitoring is enabled for a particular usage monitoring key are removed or deactivated;\n-\twhen usage monitoring is explicitly disabled by the PCRF;\n-\twhen an IP-CAN session is terminated;\n-\twhen requested by the PCRF.\nTo report accumulated usage for a specific monitoring key the PCEF shall send a CC-Request with the Usage-Monitoring-Information AVP including the accumulated usage since the last report. For each of the enabled monitoring keys to be reported, the Usage-Monitoring-Information AVP shall include the monitoring key in the Monitoring-Key AVP and the accumulated volume usage in the Used-Service-Unit AVP. Accumulated volume reporting shall be done for the total volume, the uplink volume or the downlink volume as requested by the PCRF, and set in CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of Used-Service-Unit AVP respectively. Accumulated time reporting shall be set in the CC-Time AVP of Used-Service-Unit AVP. The PCEF shall continue to perform volume and/or time measurement after the report until instructed by the PCRF to stop the monitoring. If both volume and time measurements are requested by the PCRF and the threshold for one of the measurements is reached, the PCEF shall report this event to the PCRF and the accumulated usage since last report shall be reported for both measurements.\nIn case a Monitoring-Time AVP was provided by the PCRF within one instance of the Granted-Service-Unit AVP included within the Usage-Monitoring-Information AVP for the usage monitoring control request, the PCEF shall report as defined in 4.5.17.6.\nFor cases where the PCRF indicates in a CC-Answer command whether the usage monitoring shall continue as a response to the reporting of accumulated usage in a CCR command, the PCEF shall behave as follows\n-\tif the PCRF provisions an updated usage threshold in the CCA command, the monitoring continues using the updated threshold value provisioned by the PCRF;\n-\totherwise, if the PCRF does not include an updated usage threshold in the CCA command, the PCEF shall not continue usage monitoring for that IP-CAN session, usage monitoring key, or both as applicable.\nNOTE:\tWhen the PCRF indicates that usage monitoring shall not continue in the CCA, the PCEF does not report usage which has accumulated between sending the CCR and receiving the CCA.\nUpon receiving the reported usage from the PCEF, the PCRF shall deduct the value of the usage report from the total allowed usage for that IP-CAN session, usage monitoring key, or both as applicable, and the PCRF may also derive the PCC rules based on the remaining allowed usage or reported usage and provision them to the PCEF.\nAdditional procedures for each of the scenarios above are described in the following clauses of 4.5.17.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.17.1",
      "section_id": "4.5.17.1",
      "section_title": "Usage Threshold Reached",
      "content": "When usage monitoring is enabled for a particular monitoring key, the PCEF shall measure the volume and/or the time of usage of all traffic for the IP-CAN session or the corresponding service data flows and notify the PCRF when a usage threshold for that monitoring key is reached and report the accumulated usage for that monitoring key and include the \"USAGE_REPORT\" Event-Trigger in a CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" by following the procedures to report accumulated usage defined in clause 4.5.17.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.17"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.17.2",
      "section_id": "4.5.17.2",
      "section_title": "PCC Rule Removal",
      "content": "When the PCRF removes or deactivates the last PCC rule associated with a usage monitoring key in an RAR or CCA command in response to a CCR command not related to reporting usage for the same monitoring key, the PCEF shall send a new CCR command with the CC-Request-Type set to the value \"UPDATE_REQUEST\" including the Event-Trigger set to \"USAGE_REPORT\" to report accumulated usage for the usage monitoring key within the Usage-Monitoring-Information AVP using the procedures to report accumulated usage defined in clause 4.5.17.\nWhen the PCEF reports that the last PCC rule associated with a usage monitoring key is inactive, the PCEF shall report the accumulated usage for that monitoring key within the same CCR command if the Charging-Rule-Report AVP was included in a CCR command; otherwise, if the Charging-Rule-Report AVP was included in an RAA command, the PCEF shall send a new CCR command to report accumulated usage for the usage monitoring key.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.17"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.17.3",
      "section_id": "4.5.17.3",
      "section_title": "Usage Monitoring Disabled",
      "content": "Once enabled, the PCRF may explicitly disable usage monitoring as a result of receiving a CCR from the PCEF which is not related to reporting usage, other external triggers (e.g., receiving an AF request, subscriber profile update), or a PCRF internal trigger. When the PCRF disables usage monitoring, the PCEF shall report the accumulated usage which has occurred while usage monitoring was enabled since the last report.\nTo disable usage monitoring for a monitoring key, the PCRF shall send the Usage-Monitoring-Information AVP including only the applicable monitoring key within the Monitoring-Key AVP and the Usage-Monitoring-Support AVP set to USAGE_MONITORING_DISABLED.\nWhen the PCRF disables usage monitoring in a RAR or CCA command, the PCEF shall send a new CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" and the Event-Trigger AVP set to \"USAGE_REPORT\" to report accumulated usage for the disabled usage monitoring key(s).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.17.4",
      "section_id": "4.5.17.4",
      "section_title": "IP-CAN Session Termination",
      "content": "At IP-CAN session termination the PCEF shall send the accumulated usage information for all monitoring keys for which usage monitoring is enabled in the CCR command with the CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\" using the procedures to report accumulated usage defined in clause 4.5.17.\nIf all IP-CAN sessions of a user to the same APN are terminated, the PCRF may store the remaining allowed usage, i.e. the information about the remaining overall amount of resources, in the SPR.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.17"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.17.5",
      "section_id": "4.5.17.5",
      "section_title": "PCRF Requested Usage Report",
      "content": "When the PCEF receives the Usage-Monitoring-Information AVP including the Usage-Monitoring-Report AVP set to the value USAGE_MONITORING_REPORT_REQUIRED, the PCEF shall send a new CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" and the Event-Trigger AVP set to \"USAGE_REPORT\" to report accumulated usage for the monitoring key received in the Usage-Monitoring-Information AVP using the procedures to report accumulated usage defined in clause 4.5.17.1. If the volume threshold and time threshold were provided, the PCEF shall report both the volume usage and time of usage. If the Monitoring-Key AVP was omitted in the received Usage-Monitoring-Information AVP, the PCEF shall send the accumulated usage for all the monitoring keys that were enabled at the time the Usage-Monitoring-Information was received.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.17.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.17.6",
      "section_id": "4.5.17.6",
      "section_title": "Report in case of Monitoring Time provided",
      "content": "If Monitoring-Time AVP was provided within one instance of the Granted-Service-Unit AVP included within the Usage-Monitoring-Information AVP by the PCRF, and if the PCEF needs to report the accumulated usage when one of the events defined in subclauses 4.5.17.1-4.5.17.5 occurs before the monitoring time, the PCEF shall report the accumulated usage as defined in subclauses 4.5.17.1-4.5.17.5 and the PCEF shall not retain the monitoring time; otherwise,\n-\tIf two instances of the Granted-Service-Unit AVP are provided by the PCRF,then the PCEF shall, at the monitoring time, reset the usage threshold to the value of the Granted-Service-Unit AVP with the Monitoring-Time AVP.\n-\tIf only one instance of the Granted-Service-Unit AVP is provided by the PCRF, then the PCEF shall, at the monitoring time, reset the usage threshold to the remaining value of the Granted-Service-Unit AVP previously sent by the PCRF (i.e. excluding the accumulated volume or time usage).\n-\tFor both cases, the usage report from the PCEF shall include two instances of the Used-Service-Unit AVP, one of them to indicate the usage before the monitoring time and the other one accompanied by the Monitoring-Time AVP under the same Used-Service-Unit AVP to indicate the usage after the monitoring time.\nWhen the PCRF receives the accumulated usage report in a CCR command, the PCRF shall indicate to the PCEF if usage monitoring shall continue as defined in clause 4.5.16. The PCRF may provide the Monitoring-Time AVP again within one instance of the Granted-Service-Unit AVP if reports for the accumulated usage before and after the provided monitoring time are required.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.16"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.18",
      "section_id": "4.5.18",
      "section_title": "IMS Restoration Support",
      "content": "In order to support IMS Restoration procedures (refer to 3GPP TS 23.380 [33]), PCRF needs to convey the AF address to the PCEF. In order to do so, in case AF provisions information about the AF signalling flows between the UE and the AF, as defined in 3GPP TS 29.214 [10] Section 4.4.5a, the PCRF shall install the corresponding dynamic PCC rules (if not installed before) by triggering a RAR message. The PCRF shall provide the Charging-Rule-Install AVP including the Charging-Rule-Definition AVP(s). The Charging-Rule-Definition AVP shall include in the Flow-Information AVP the signalling flows between UE and the AF. The Charging-Rule-Definition AVP shall also include the AF-Signalling-Protocol AVP set to the value corresponding to the signalling protocol used between the UE and the AF.\nThe PCEF shall acknowledge the command by sending an RAA command to the PCRF and shall initiate the corresponding bearer procedure if required. The PCEF shall extract the AF address from the PCC rules and use it for the monitoring procedure as defined for the different access types. See Annex A & B.\nNOTE 1:\tThe PCEF can use the extracted AF address from the PCC rule to check if, the monitoring procedure has to be started for the corresponding AF.\nIn case AF de-provisions information about the AF signalling flows between the UE and the AF, as defined in 3GPP TS 29.214 [10] Section 4.4.5a, the PCRF shall remove the corresponding dynamic PCC rules by triggering a RAR message. The PCRF shall provide the Charging-Rule-Remove AVP including the corresponding Charging-Rule-Name AVP(s).\nThe PCEF shall acknowledge the command by sending a RAA command to the PCRF.\nNOTE 2:\tThe PCEF can use the AF address associated with the removed rule to check if it can stop monitoring the corresponding AF.\n4.5.18a\tP-CSCF Restoration Enhancement Support\nThis clause is applicable when the PCRF-based P-CSCF Restoration Enhancement, as defined in 3GPP TS 23.380 [33], is supported by both PCRF and PCEF.\nIf the PCRF receives a request for P-CSCF restoration from the P-CSCF as defined in clause 4.4.7 of 3GPP TS 29.214 [10], the PCRF shall send a Gx RAR command including the PCSCF-Restoration-Indication AVP set to value 0 (PCSCF_RESTORATION) to the PCEF for the corresponding Gx session.\nThe PCEF shall acknowledge the RAR command by sending an RAA command to the PCRF and shall initiate the corresponding bearer procedure for the IMS PDN connection as defined in 3GPP TS 23.380 [33].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.214_clause_4.4.5",
        "ts_29.214_clause_4.4.7",
        "ts_23.380",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.19.1.1",
      "section_id": "4.5.19.1.1",
      "section_title": "Provisioning of PCC Rules for Multimedia Priority Services",
      "content": "The provision of PCC Rules corresponding to both MPS and non-MPS service shall be performed as described in clause 4.5.2.0.\nWhen the PCRF derives PCC Rules corresponding to MPS service, the ARP and QCI shall be set as appropriate for the prioritized service, e.g. an IMS Multimedia Priority Service.\nWhen the PCRF derives PCC Rules corresponding to non-MPS service, the PCRF shall generate the PCC Rules as per normal procedures. At the time the Priority EPS Service is invoked (i.e.MPS EPS Priority and MPS Priority Level are set), the PCRF shall upgrade the ARP and/or change QCI also for the PCC Rules corresponding to non-MPS service. The PCRF shall change the ARP and/or QCI modified for the Priority EPS Bearer service to an appropriate value according to PCRF decision.\nWhen the MPSforDTS feature is supported, if the PCRF receives a request from the AF for the invocation/revocation of MPS for DTS (see 3GPP TS 29.214 [10]), then the PCRF shall behave according to clause 4.5.19.1.4.\nWhen the PCRF receives a CCR command with CC-Request-Type AVP set to value \"INITIAL_REQUEST\", the PCRF shall check whether any of these parameters is stored in the SPR: MPS EPS Priority, MPS Priority Level and/or IMS Signalling Priority. The PCRF shall derive the applicable PCC rules and default bearer QoS based on that information. If the IMS Signalling Priority is set and the Called-Station-Id AVP corresponds to an APN dedicated for IMS, the PCRF shall assign an ARP corresponding to MPS for the default bearer and for the PCC Rules corresponding to the IMS signalling bearer. If the Called-Station-Id AVP does not correspond to an APN dedicated for IMS, the ARP shall be derived without considering IMS Signalling Priority.\nNOTE 1:\tSubscription data for MPS is provided to PCRF through the Sp reference point.\nOnce the PCRF receives a notification of a change in MPS EPS Priority, MPS Priority Level and/or IMS Signalling Priority from the SPR, the PCRF shall make the corresponding policy decisions (i.e. ARP and/or QCI change) and, if applicable, shall initiate a RAR command to provision the modified data.\nNOTE 2:\tThe details associated with the Sp reference point are not specified in this Release. The SPR's relation to existing subscriber databases is not specified in this Release.\nNOTE 3:\tThe MPS Priority Level is one among other input data such as operator policy for the PCRF to set the ARP.\nWhenever one or more AF sessions of an MPS service are active within the same PDN connection, the PCRF shall ensure that the ARP priority level of the default bearer is at least as high as the highest ARP priority level used by any authorized PCC rules belonging to an MPS service. If the ARP pre-emption capability is enabled for any of the authorized PCC rules belonging to an MPS service, the PCRF shall also enable the ARP pre-emption capability for the default bearer.\nNOTE 4:\tThis ensures that services using dedicated bearers are not terminated because of a default bearer with a lower ARP priority level or disabled ARP pre-emption capability being dropped during mobility events.\nNOTE 5:\tThis PCRF capability does not cover interactions with services other than MPS services.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.2.0",
        "clause_4.5.19.1.4",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.19.1.2",
      "section_id": "4.5.19.1.2",
      "section_title": "Invocation/Revocation of Priority EPS Bearer Services",
      "content": "When a Priority EPS Bearer Service is invoked, the PCRF shall\n-\tDerive the corresponding PCC Rules with the ARP and QCI set as appropriate for a prioritized service.\n-\tSet the ARP of the default bearer as appropriate for a Priority EPS Bearer Service under consideration of the requirement described in clause 4.5.19.1.1.\n-\tSet the QCI of the default bearer as appropriate for the Priority EPS Bearer Service.\n-\tSet the ARP of PCC Rules installed before the activation of the Priority EPS Bearer Service to the ARP as appropriate for the Priority EPS Bearer Service under the consideration of the requirements described in clause 4.5.19.1.1.\n-\tSet the QCI of the PCC Rules installed before the activation of the Priority EPS Bearer Service to the QCI as appropriate for the Priority EPS Bearer Service if modification of the QCI of the PCC Rules is required.\nWhen a Priority EPS Bearer Service is revoked, the PCRF shall\n-\tDelete the PCC Rules corresponding to the Priority EPS Bearer Service if they were previously provided.\n-\tSet the ARP of the default bearer to the normal ARP under the consideration of the requirements described in clause 4.5.19.1.1.\n-\tSet the QCI of the default bearer as appropriate for PCRF decision.\n-\tSet the ARP of all active PCC Rules as appropriate for the PCRF under the consideration of the requirements described in clause 4.5.19.1.1.\n-\tSet the QCI to an appropriate value according to PCRF decision if modification of the QCI of PCC Rules is required.\nNOTE:\tThe activation/deactivation of a Priority EPS Bearer Service requires explicit invocation/revocation via SPR MPS user profile (MPS EPS Priority, MPS Priority Level). An AF for MPS Priority Service can also be used to provide Priority EPS Bearer Services using network-initiated resource allocation procedures (via interaction with PCC) for originating accesses.\nThe PCRF shall provision the PCEF with the applicable PCC Rules upon Priority EPS Bearer Service activation and deactivation as described in clause 4.5.2.0. The provision of the QoS information applicable for the PCC Rules shall be performed as described in clause 4.5.5.2. The provision of QoS information for the default bearer shall be performed as described in clause 4.5.5.9.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.19.1.1",
        "clause_4.5.2.0",
        "clause_4.5.5.2",
        "clause_4.5.5.9"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.19.1.3",
      "section_id": "4.5.19.1.3",
      "section_title": "Invocation/Revocation of IMS Multimedia Priority Services",
      "content": "If the PCRF receives service information including an MPS session indication and the service priority level from the P-CSCF or at reception of the indication that IMS Signalling Priority is active for the IP-CAN session, the PCRF shall under consideration of the requirements described in clause 4.5.19.1.1:\n-\tset the ARP of the default bearer as appropriate for the prioritized service;\n-\tif required, set the ARP of all PCC rules assigned to the IMS signalling bearer as appropriate for IMS Multimedia Priority Services;\n-\tderive the PCC Rules corresponding to the IMS Multimedia Priority Service and set the ARP of these PCC Rules based on the information received over Rx.\nIf the PCRF detects that the P-CSCF released all the MPS session and the IMS Signalling Priority has been deactivated for the IP-CAN session the PCRF shall under consideration of the requirements described in clause 4.5.19.1.1:\n-\tdelete the PCC Rules corresponding to the IMS Multimedia Priority Service;\n-\tset the ARP of the default bearer as appropriate for the IMS Multimedia Priority set to inactive;\n-\treplace the ARP of all PCC Rules assigned to the IMS signalling bearer as appropriate when the IMS Multimedia Priority is inactive.\nThe PCRF shall provision the PCEF with the applicable PCC Rules upon MPS session initiation and release as described in clause 4.5.2.0. The provision of the QoS information applicable for the PCC Rules shall be performed as described in clause 4.5.5.2. The provision of QoS information for the default bearer shall be performed as described in clause 4.5.5.9.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.19.1.1",
        "clause_4.5.2.0",
        "clause_4.5.5.2",
        "clause_4.5.5.9"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.19.1.4",
      "section_id": "4.5.19.1.4",
      "section_title": "Invocation/Revocation of MPS for DTS",
      "content": "When the PCRF receives from the AF an indication of invocation/revocation of MPS for DTS as specified in 3GPP TS 29.214 [10], and if the MPSforDTS feature is supported, the PCRF shall make the corresponding policy decisions (i.e. ARP and/or QCI change) and, if applicable, shall initiate a RAR command to provision the modified data.\nFor the invocation of MPS for DTS, the PCRF shall:\n-\tSet the ARP of the default bearer as appropriate for MPS for DTS.\n-\tSet the QCI of the default bearer as appropriate for MPS for DTS.\nNOTE 1:\tFor the already installed dynamic PCC rules that had the same QCI/ARP as the original default bearer, if the Rule-Bound-to-Default-Bearer feature is supported by both the PCEF and PCRF as described in clause 5.4.1, the PCRF indicates to the PCEF that the PCC rule is to be bound to the default bearer by setting the Default-Bearer-Indication AVP to BIND_TO_DEF_BEARER within the Charging-Rule-Definition AVP; otherwise the PCRF sets the ARP and QCI to the determined values for the default bearer for MPS for DTS, i.e.: the PCRF sets the ARP and QCI as appropriate for MPS for DTS.\nFor the revocation of MPS for DTS, to revert the MPS for DTS values of the default bearer, the PCRF shall set the ARP and the QCI of the default bearer as appropriate for PCRF decision.\nNOTE 2:\tFor the dynamic PCC rules that had the same QCI and ARP as the default bearer for MPS for DTS or, when the Rule-Bound-to-Default-Bearer is supported and had the Default-Bearer-Indication AVP set to BIND_TO_DEF_BEARER, the PCRF sets the ARP and the QCI to appropriate values according to PCRF decision. The provision of the QoS information applicable for the PCC Rules is performed as described in clause 4.5.5.2.\nNOTE 3:\tRevocation may require more complex logic on the part of the PCRF beyond simply restoring the prior ARP and QCI values as set prior to invocation of MPS for DTS, if these values and/or the Default-Bearer-Indication AVP were modified by another service during the time that MPS for DTS was enabled.  The corresponding logic is dependent on the identification of particular services that may be deployed and the desired interactions between MPS for DTS and any such services. These aspects are not considered in the present specification.\nThe PCRF shall provision the PCEF with the QoS information for the default bearer as described in clause 4.5.5.9.\nWhen the PCRF receives the request to report the successful outcome of the invocation/revocation of priority handling for the default bearer from the AF as specified in 3GPP TS 29.214 [10], clause 4.4.11, the PCRF shall request the PCEF using an RAR command to confirm that the resources associated to the MPS for DTS invocation/revocation are successfully allocated by setting the Event-Trigger AVP with the value SUCCESSFUL_QOS_UPDATE.\nOn receipt of the SUCCESSFUL_QOS_UPDATE value in the Event-Trigger AVP in the CCR from the PCEF, the PCRF shall inform the AF as specified in 3GPP TS 29.214 [10], clause 4.4.11. to indicate that it successfully acted upon the invocation/revocation of MPS for DTS.\nOn receipt of a failure event as described in subclause 4.5.5.10 and the PCF has received the request to report the failed outcome of the invocation/revocation of priority handling for the default bearer from the AF as specified in 3GPP TS 29.214 [10], clause 4.4.11, the PCRF shall inform the AF as specified in 3GPP TS 29.214 [10], clause 4.4.11, to indicate that the invocation/revocation of MPS for DTS failed.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.1",
        "clause_4.5.5.2",
        "clause_4.5.5.9",
        "ts_29.214_clause_4.4.11",
        "clause_4.5.5.10",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.20",
      "section_id": "4.5.20",
      "section_title": "Sponsored Data Connectivity",
      "content": "Sponsored data connectivity may be performed for service data flows associated with one or more PCC rules if the information about the sponsor, the application service provider and optionally the threshold values are provided by the AF and if the AF has not indicated to disable/not enable sponsored data connectivity as described in 3GPP TS 29.214 [10] subclauses 4.4.1 and 4.4.2.\nThe provisioning of sponsored data connectivity per PCC rule shall be performed using the PCC rule provisioning procedure. The sponsor identity shall be set using the Sponsor-Identity AVP within the Charging-Rule-Definition AVP of the PCC rule. The application service provider identity shall be set using the Application-Service-Provider-Identity AVP within the Charging-Rule-Definition AVP of the PCC rule. Sponsor-Identity AVP and Application-Service-Provider-Identity AVP shall be included if the Reporting-Level AVP is set to the value SPONSORED_CONNECTIVITY_LEVEL.\nWhen receiving the usage thresholds from the AF, the PCRF shall use the sponsor identity to generate a monitoring key and request usage monitoring control for the monitoring key by following the procedures specified in subclauses 4.5.2.5 and 4.5.16.\nWhen the AF disables sponsoring a service (See 3GPP TS 29.214 [10] subclause 4.4.2), the PCRF\n-\tmay modify the PCC rules in order to set the Reporting-Level AVP to SERVICE_IDENTIFIER_LEVEL or RATING_GROUP_LEVEL and not include the Sponsor-Identity AVP and Application-Service-Provider-Identity AVP if they were included previously.\n-\tmay modify the PCC rules to update the charging key.\nNOTE 1:\tA specific charging key can be applied to the sponsored data connectivity for online charging.\n-\tshall disable the usage monitoring for the sponsored data connectivity according to subclause 4.5.17.3 if it was enabled previously. As a result, PCRF gets the accumulated usage of the sponsored data connectivity.\nNOTE 2:\tIt depends on the implementation whether the solutions defined in Annex F can be used to disable the usage monitoring.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.214_clause_4.4.2",
        "clause_4.5.17.3",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.21",
      "section_id": "4.5.21",
      "section_title": "PCRF Failure and Restoration",
      "content": "If the PCEF needs to send an IP-CAN session modification request towards a PCRF which is known to have restarted since the IP-CAN session establishment, the PCEF should not send the IP-CAN session modification request towards a PCRF and the PCEF may tear down the associated PDN connection based on operator policy, by initiating PDN connection deactivation procedure. Emergency, RLOS and eMPS sessions should not be torn down.\nNOTE 1:\tThis mechanism enables the clean up of PDN connections affected by the PCRF failure and leads the UE to initiate a UE requested PDN connectivity procedure for the same APN.\nNOTE 2:\tThe method the PCEF uses to determine that a PCRF has restarted is not specified in this release.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.22",
      "section_id": "4.5.22",
      "section_title": "Reporting Access Network Information",
      "content": "When the NetLoc feature is supported, if the AF requests the PCRF to report the access network information and if the PCRF cannot determine that access network information cannot be provided as described in subclause 4.4.6.7 of 3GPP TS 29.214 [10], the PCRF shall provide the requested access network information indication (e.g. user location and/or user timezone information) to the PCEF as follows:\n-\tIf the PCRF is installing or modifying a PCC rule, the PCRF shall include the Required-Access-Info AVP within the Charging-Rule-Definition AVP of an appropriate installed or modified PCC rule;\n-\tOtherwise, if the PCRF is removing PCC rules based on the AF requests, the PCRF shall include the Required-Access-Info AVP within the Charging-Rule-Remove AVP associated with the corresponding PCC rules being removed.\nThe PCRF shall also provide the ACCESS_NETWORK_INFO_REPORT event trigger within Event-Trigger AVP (if this event trigger is not yet set).\nFor those PCC Rule(s) based on preliminary service information as described in 3GPP TS 29.214 [10] the PCRF may assign the QCI and ARP of the default bearer to avoid signalling to the UE. These PCC Rules shall not include the Packet-Filter-Usage AVP within the Flow-Information AVP included in the Charging-Rule-Definition AVP.\nNOTE 1:\t3GPP TS 23.203 [7] provides further information about appropriate PCC rules in subclause 6.2.1.0.\nFor those PCC Rule(s) based on AF signalling as described in 3GPP TS 29.214 [10], the PCRF may use QCI and ARP for AF signalling to avoid signalling to the UE. These PCC Rules shall not include the Packet-Filter-Usage AVP within the Flow-Information AVP included in the Charging-Rule-Definition AVP.\nNOTE 2:\tSimilarly, for predefined PCC rules based on AF signalling, these PCC Rule(s) could be defined with the QCI and ARP for AF signalling, and cannot include packet filter usage information.\nIf the ACCESS_NETWORK_INFO_REPORT event trigger is set, upon installation, modification and removal of any PCC rule(s) with the Required-Access-Info AVP in a Gx RAR command, and if the PCEF determines that the access network does not support the access network information reporting based on the currently used IP-CAN type or the RAT type and the value of AN-Trusted AVP, the PCEF shall immediately inform the PCRF by including the NetLoc-Access-Support AVP with the value of 0 (NETLOC_ACCESS_NOT_SUPPORTED) in the RAA command. Otherwise, the PCEF shall apply appropriate IP CAN specific procedures to obtain this information. When the PCEF then receives access network information through those IP CAN specific procedures, the PCEF shall provide the required access network information to the PCRF as follows:\n-\tIf the user location information was requested by the PCRF and was provided to the PCEF, the PCEF shall provide the user location information within the 3GPP-User-Location-Info AVP and the time when it was last known within User-Location-Info-Time AVP (if available).\n-\tIf the user location information was requested by the PCRF and was not provided to the PCEF, the PCEF shall provide the serving PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP.\n-\tIf the time zone was requested by the PCRF, the PCEF shall provide it within the 3GPP-MS-TimeZone AVP.\nNOTE 3:\tThe PCEF does not support time zone reporting if the access network is untrusted WLAN.\nIn addition, the PCEF shall provide the ACCESS_NETWORK_INFO_REPORT event trigger within Event-Trigger AVP. The kind of user location retrieved in the access network is defined in the corresponding annex.\nDuring bearer deactivation, when the NetLoc feature is supported, the PCEF shall provide the access network information to the PCRF by including the user location information within the 3GPP-User-Location-Info AVP (if requested by the PCRF and if provided to the PCEF), the information on when the UE was last known to be in that location within User-Location-Info-Time AVP (if user location information was requested by the PCRF and if the corresponding information was provided to the PCEF), the PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP (if the user location information was requested by the PCRF but it is not provided to the PCEF) and the timezone information within the 3GPP-MS-TimeZone AVP (if requested by the PCRF and available).\nDuring IP-CAN session termination procedure, the PCEF shall, if ACCESS_NETWORK_INFO_REPORT event trigger is set, provide the access network information to the PCRF by including the user location information within the 3GPP-User-Location-Info AVP (if it was provided to the PCEF), the information on when the UE was last known to be in that location within User-Location-Info-Time AVP (if it was provided to the PCEF), the PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP (if the user location information was not provided to the PCEF) and the timezone information within the 3GPP-MS-TimeZone AVP (if available).\nThe PCEF shall not report any subsequent access network information updates received from the IP-CAN without any previous provisioning or removal of related PCC rules unless the associated IP-CAN bearer or connection has been released.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.214_clause_4.4.6.7",
        "clause_6.2.1.0",
        "ts_29.214",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.23",
      "section_id": "4.5.23",
      "section_title": "Application Detection Information",
      "content": "The PCRF may instruct the PCEF to detect application (s) by providing the Charging-Rule-Install AVP (s) with the corresponding parameters as follows: the application to be detected is identified by the TDF-Application-Identifier AVP, which is either provided under Charging-Rule-Definition AVP for dynamic PCC Rules or pre-provisioned for the corresponding predefined PCC Rule, and in such a case only Charging-Rule-Name/Charging-Rule-Base-Name is provided. If the PCRF requires to be reported about when the application start/stop is detected, it shall also subscribe to the APPLICATION_START and APPLICATION_STOP Event-Triggers. The PCRF may also mute such a notification about a specific detected application by providing Mute-Notification AVP within the PCC Rule.\nThe PCEF applies the PCC rule to the whole IP-CAN session traffic for the application detection and control. When the start or stop of the application's traffic, identified by TDF-Application-Identifier, is detected, if PCRF has previously subscribed to the APPLICATION_START/APPLICATION_STOP Event-Triggers, unless a request to mute such a notification (Mute-Notification AVP) is part of the corresponding PCC Rule, the PCEF shall report the information regarding the detected application's traffic in the Application-Detection-Information AVP in the CCR command even if the application traffic is discarded due to enforcement actions of the PCC rule.\nThe corresponding TDF-Application-Identifier AVP shall be included under Application-Detection-Information AVP. When the Event trigger indicates APPLICATION_START, the Flow-Information AVP for the detected application may be included under Application-Detection-Information AVP, if deducible. The Flow-Information AVP, if present, shall contain the Flow-Description AVP and Flow-Direction AVP. The TDF-Application-Instance-Identifier, which is dynamically assigned by the PCEF in order to allow correlation of APPLICATION_START and APPLICATION_STOP Event-Triggers to the specific Flow-Information AVP, if service data flow descriptions are deducible, shall also be provided when the Flow-Information AVP is included. Also, the corresponding Event-Trigger (APPLICATION_START or APPLICATION_STOP) shall be provided to PCRF. When the TDF-Application-Instance-Identifier is provided along with the APPLICATION_START, it shall also be provided along with the corresponding APPLICATION_STOP. The PCRF then may make policy decisions based on the information received and send the corresponding updated PCC rules to the PCEF, and corresponding QoS rules to the BBERF, if applicable.\nWhen a PFD provisioned by the PFDF is removed/modified and the removed/modified PFD was used to detect application traffic related to an application identifier in a PCC Rule installed or activated for an IP-CAN session, if the removed/modified PFD in PCEF results in that the stop of an application or an application instance is not able to be detected, and if the PCEF has reported the application start as described in this subclause to the PCRF for the application or application instance represented by this PFD, the PCEF shall report the application stop to the PCRF for the corresponding application or the corresponding application instance.\nNOTE:\tMultiple PFDs can be associated with the application identifier. When the removed/modified PFD is the last one which is used to detect traffic identified by TDF-Application-Identifier AVP, the PCEF reports application stop.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.24",
      "section_id": "4.5.24",
      "section_title": "Group Communication Service Support",
      "content": "If the PCRF receives service information for a prioritized GC session including a GCSE session indication and service priority level from the GCSE AS as described in 3GPP TS 23.468 [50], the PCRF shall:\n-\tDerive the PCC Rules corresponding to the Group Communication Service and set the ARP (priority level, pre-emption capability and pre-emption vulnerability) of these PCC Rules based on the information received over Rx and operator policies.\n-\tEnsure that the ARP (priority level, pre-emption capability, pre-emption vulnerability) of the default bearer is assigned a prioritized value.\n-\tIf a dedicated bearer is established for GC1 signalling, ensure that the ARP (priority level, pre-emption capability, pre-emption vulnerability) in all the PCC/QoS rules that describe the GC1 signalling traffic is assigned a prioritized value.\nIf the PCRF receives a request to change the service priority level for a prioritized GC session from the GCSE AS, the PCRF shall modify the PCC Rules corresponding to the Group Communication Service in order to set the ARP (priority level, pre-emption capability and pre-emption vulnerability) of these PCC Rules based on the information received over Rx.The PCRF shall ensure that the ARP (priority level, pre-emption capability, pre-emption vulnerability) of the default bearer is assigned the appropriate prioritized value.\nIf the PCRF receives a request to terminate a prioritized GC session, the PCRF shall remove the PCC Rules corresponding to the Group Communication Service. If the PCRF detects that all prioritized GC sessions within the same IP-CAN session are released, the PCRF shall set the ARP of the default bearer as appropriate.\nThe PCRF shall provision the PCEF with the applicable PCC Rules upon GC session initiation and release as described in clause 4.5.2.0. The provision of the QoS information applicable for the PCC Rules shall be performed as described in clause 4.5.5.2. The provision of QoS information for the default bearer shall be performed as described in clause 4.5.5.9.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.2.0",
        "clause_4.5.5.2",
        "clause_4.5.5.9",
        "ts_23.468"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.1",
      "section_id": "4.5.25.1",
      "section_title": "General",
      "content": "Clause 4.5.25 refers to Network Based IP Flow Mobility as described in 3GPP TS 23.161 [51].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.5.25",
        "ts_23.161"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.1.1",
      "section_id": "4.5.25.1.1",
      "section_title": "PCRF procedures",
      "content": "The PCRF takes the following decisions:\n-\tThe PCRF shall decide whether NBIFOM applies to the IP-CAN session.\n-\tThe PCRF shall decide which NBIFOM mode applies to the IP-CAN session as defined in subcluase 5.4.4 of 3GPP TS 23.161 [51].\n-\tThe PCRF shall decide the default NBIFOM access that applies to the IP-CAN session.\n-\tIn UE-initiated mode or in network-initiated mode when UE requested IP flow mapping, the PCRF shall authorize the NBIFOM routing rules received from the PCEF based on user subscription and operator's policy and determine the allowed access type for the corresponding PCC rule(s) when the PCC rule(s) is installed.\n-\tThe PCRF shall determine the allowed access type for the PCC rule when the PCC rule is installed in the Network-initiated mode.\n-\tIn the network-initiated mode, the PCRF shall provide a NBIFOM routing rule identifier to every packet filter included in a PCC rule.\n-\tIn the UE-initiated IP flow mobility within a PDN connection procedure and UE Requested IP Flow Mapping procedure, the PCRF shall map PCC rules one to one with corresponding NBIFOM routing rules received from the PCEF.\n-\tIn network-initiated mode, the PCRF shall decide whether RAN rule handling applies to the IP-CAN session.\n-\tThe PCRF may indicate to the PCEF that one access is removed from a multiple access IP-CAN session.\n-\tThe PCRF shall ensure that there is at least one PCC Rule that can be bound to the default bearer of each access.\n-\tIn the UE-initiated NBIFOM mode, if a new PCC rule is created due to the request from the network (e.g. request from the AF or application detection information from the PCEF/TDF), the PCRF determines that the new PCC rule shall be bound to the default access for NBIFOM.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.161"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.1.2",
      "section_id": "4.5.25.1.2",
      "section_title": "PCEF procedures",
      "content": "The PCEF takes the following actions:\n-\tPCEF shall negotiate the support of NBIFOM and of the NBIFOM mode with the PCRF when the UE requests PDN connectivity over the first access.\n-\tPCEF shall negotiate the support of NBIFOM and of the default access for NBIFOM with the PCRF when the UE requests PDN connectivity over an additional access.\n-\tPCEF shall negotiate the default access for NBIFOM with the PCRF when the UE requests IP flow mobility in the UE-initiated mode.\nNOTE:\tThe negotiation of the default access in the UE-initiated IP flow mobility procedure only happens when the single connection mode is used via trusted WLAN access network.\n-\tPCEF shall derive the NBIFOM routing rules transferred via the Gx interface based on the NBIFOM routing rules or IP flow mapping carried via the GTP signalling.\n-\tFor Network-initiated mode when a new NBIFOM routing rule carried in GTP needs to be created by the PCEF due to a Network-initiated IP flow mobility within a PDN connection request, the PCEF shall keep the mapping between the NBIFOM routing rule identifier received in the PCC rule and the NBIFOM routing rule identifier used in GTP signalling.\n-\tWhen a new NBIFOM routing rule over Gx interface is created by a UE-requested IP Flow Mapping request to create a new IP flow mapping in Network-initiated mode or UE-requested IP flow mobility in UE-initiated mode, the PCEF shall assign the NBIFOM rule identifier to the new NBIFOM routing rule and keep the mapping with the routing rule identifier used in GTP signalling.\n- \tWhen a new NBIFOM routing rule over Gx interface is created by a UE-requested IP Flow Mapping request to modify an existing IP flow mapping in Network-initiated mode, the PCEF shall include the NBIFOM routing rule identifier assigned by the PCRF for the packet filter of the PCC rule corresponding to the routing rule identifier received in GTP signalling in the new NBIFOM routing rule.\n-\tIn a multi access IP-CAN session, PCEF shall associate the PCC rules to the allowed access within the IP-CAN session. The allowed access may be either explicitly included in the PCC Rule or the default NBIFOM access for the traffic on the IP-CAN session.\n-\tPCEF shall associate the PCC rules to an IP-CAN bearer within the allowed access by performing the bearer binding.\n-\tPCEF shall derive the NBIFOM routing rules transferred via the GTP signalling based on the received PCC rules from the PCRF in the Network-initiated mode.\n-\tThe PCEF may provide the user location information and RAT type for each allowed access type to the PCRF.\n-\tThe PCEF may provide the Access stratum information or access availability information received via the GTP signalling to the PCRF.\n-\tRoute the IP flow(s) by using the routing access information which is part of the NBIFOM routing rules.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.1",
      "section_id": "4.5.25.2.1",
      "section_title": "IP-CAN session establishment",
      "content": "The PCC procedures over Gx reference point defined in clause 4.5.1 shall apply. In addition, the PCEF shall inform the PCRF about the UE and network support of NBIFOM within the NBIFOM-Support AVP with the value NBIFOM_SUPPORTED (1) and the requested NBIFOM mode within the NBIFOM-Mode AVP in the CCR command when the PCEF receives both data as defined in 3GPP TS 29.274 [22].\nThe PCRF shall take a policy decision on whether NBIFOM applies to the IP-CAN session. If the PCRF determines that NBIFOM does not apply to the IP-CAN session, the PCRF shall set the NBIFOM-Support AVP to the value NBIFOM_NOT_SUPPORTED (0); otherwise, the PCRF shall set the NBIFOM-Support AVP to the value NBIFOM_SUPPORTED (1). When NBIFOM is supported, the PCRF shall select the applicable NBIFOM mode for the IP-CAN session and include the value within NBIFOM-Mode AVP.\nThe PCRF shall provide NBIFOM-Support AVP, NBIFOM-Mode AVP (if applicable) and the support of RAN rule indication within the RAN-Rule-Support AVP if the network supports the RAN rule indication in the CCA command.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.1",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.2",
      "section_id": "4.5.25.2.2",
      "section_title": "Addition of an access",
      "content": "When the PCEF receives both a handover request and an NBIFOM indication from the UE as defined in 3GPP TS 29.274 [22], the PCEF shall send a CCR command to the PCRF, to:\n-\tNotify the PCRF about the addition of an access to the IP-CAN session by including the Event-Trigger AVP set to the value ADDITION_OF_ ACCESS and the IP-CAN-Type AVP and the RAT-Type AVP set to the value of this access.\n-\tIf the UE-initiated NBIFOM mode was selected at IP-CAN session establishment the notification contains also the default NBIFOM access selected by the UE by including the type of default access within the Default-Access AVP.\n-\tNotify the PCRF with the NBIFOM routing rules if the PCEF received the NBIFOM routing rule from the UE by including the NBIFOM routing rule within the Routing-Rule-Install AVP if UE-initiated NBIFOM mode was selected at IP-CAN session establishment.\nThe PCRF shall take following policy decisions and send the CCA command to the PCEF:\n-\tThe PCRF shall reject the addition of the access if the multi-access PDN connection would correspond to an invalid combination of IP-CAN and RAT Types or is not allowed by the subscription by including the result code set to value DIAMETER_ERROR_NBIFOM_NOT_AUTHORIZED (5149).\nNOTE:\tIn this release of the specification the only allowed combination corresponds to the UE using a 3GPP access and a WLAN access.\n-\tIf the network-initiated NBIFOM mode was selected at IP-CAN session establishment, the PCRF shall indicate the default NBIFOM access to the PCEF by including the type of default access within the Default-Access AVP.\n-\tIf the UE-initiated NBIFOM mode was selected at IP-CAN session establishment, the PCRF shall verify whether the default NBIFOM access provided by the UE complies with the subscription. The PCRF shall indicate the default NBIFOM access by including the type of default access within the Default-Access AVP.\n-\tIn UE-initiated NBIFOM mode, the PCEF may notify the PCRF about the NBIFOM routing rules. The PCRF may reject NBIFOM Routing Rules received from the UE by including the Routing-Rule-Report AVP with the rejected NBIFOM routing rule identifier within the Routing-Rule-Identifier AVP and the Routing-Rule-Failure-Code AVP set to the corresponding value. Otherwise the PCRF determines the impacted PCC rules and provides or modifies these PCC rules by including the PCC rules within the Charging-Rule-Install AVP.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.3.1",
      "section_id": "4.5.25.2.3.1",
      "section_title": "UE/PCEF-initiated removal of an access",
      "content": "When the PCEF is informed of the removal of an access of a multi access IP-CAN session by the UE or if the PCEF detects a change in the support of NBIFOM due to the inter PLMN mobility as defined in 3GPP TS 29.274 [22], the PCEF shall  send the CCR command to notify the PCRF about the removal of the access by including:\n-\tthe Event-Trigger AVP set to REMOVAL_OF_ ACCESS,\n-\tIP-CAN-Type AVP set to the values of this removed access,\n-\tthe Charging-Rule-Report AVP with the Charging-Rule-Name AVPs for the affected PCC rules,\n-\tthe PCC-Rule-Status AVP set to the value ACTIVE and\n-\tthe Rule-Failure-Code AVP set to the value NO_BEARER_BOUND, when the PCEF is informed of the removal of an access of a multi access by the UE, or\n-\tthe Rule-Failure-Code AVP set to the value NO_NBIFOM_SUPPORT, when the PCEF detects a change in the support of NBIFOM due to the inter PLMN mobility.\n. When the PCRF receives the CCR command, the PCRF shall modify or remove the affected PCC rules accordingly.\nWhen the PCEF detects a change in the support of NBIFOM due to the inter PLMN mobility and the PCRF modifies the PCC rules, the PCRF shall not include any NBIFOM related AVPs.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.3.2",
      "section_id": "4.5.25.2.3.2",
      "section_title": "PCRF-initiated removal of an access",
      "content": "The PCRF may remove one access from a multi access IP-CAN session due to change of operator policy or user subscriptions. In order to do so, PCRF shall include the Removal-Of-Access AVP set to the value REMOVAL_OF_ACCESS (0) and the IP-CAN-Type AVP set to the value of removed access in the CCA or RAR command. The PCEF shall delete corresponding PCC rules automatically locally and initiate the procedure to remove one access as defined in 3GPP TS 29.274 [22].\nNOTE:\tThe PCRF can also decide to trigger the removal of an access by updating or removing all PCC rules that are bound to this access. The removal of all PCC Rules bound to an access removes the access unless there are PCC Rules not known to the PCRF defined in the PCEF for this particular access.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.4",
      "section_id": "4.5.25.2.4",
      "section_title": "Network-initiated IP flow mobility within a PDN connection (Network-initiated NBIFOM mode)",
      "content": "When a multi access IP-CAN session has been set-up in Network-initiated mode, the PCRF may at any time determine that flows should be moved from a source access to a target access. In that case, the PCRF shall send a RAR or respond with a CCA to the PCEF including Charging-Rule-Install AVP which includes the updated PCC Rules within the Charging-Rule-Definition AVP(s) with the new allowed access type within the IP-CAN-Type AVP and the PCRF shall also assign and include the NBIFOM routing rule identifier in the Routing-Rule-Identifier AVP(s) within the Flow-Information AVP(s). The PCEF shall derive the NBIFOM routing rules from the PCC rules and send them to the UE as defined 3GPP TS 29.274 [22].\nThe PCRF may also at any time determine that flows need to be created/modified/deleted. In that case, the PCRF shall send a RAR or respond with a CCA .For creation/modification the PCRF shall include within the Charging-Rule-Install AVP the allowed access type within the IP-CAN-Type AVP (if new or changed), the new/modified PCC Rules within the Charging-Rule-Definition AVP(s) and the NBIFOM routing rule identifier in the Routing-Rule-Identifier AVP within the Flow-Information AVP(s).\nNOTE 1:\tIf a PCC rule is intended to be bound to the default access, the allowed access type can be omitted when the PCC rule is installed or modified.\nThe PCEF shall derive the NBIFOM routing rules from the PCC rules and send them to the UE as defined 3GPP TS 29.274 [22] and keep the mapping between the NBIFOM routing rule identifier provided by the PCRF and the routing filter identifier of the corresponding NBIFOM routing rule in GTP.\nAdditionally, the PCEF shall perform the bearer binding in the access as indicated by the allowed access of the PCC rule.\nFor deletion the PCRF shall include the Charging-Rule-Remove AVP with the Charging-Rule-Name AVP(s) containing the identity of the PCC rule(s) to be removed.\nThe UE may reject the NBIFOM routing rule provided by the PCRF due to local radio conditions. In that case, the PCEF shall report the rejection to the PCRF by including the Charging-Rule-Report AVP with the Charging-Rule-Identifier AVP and the Rule-Failure-Code set to the value according to the cause received from the GTP as specified in 3GPP TS 29.274 [22].\nNOTE 2:\tThe UE is not allowed to request modification or deletion of  NBIFOM routing filters initiated by the network. The UE can request to modify the access type of NBIFOM routing rules initiated by the network.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.5",
      "section_id": "4.5.25.2.5",
      "section_title": "UE-initiated IP flow mobility within a PDN connection (UE-initiated NBIFOM mode)",
      "content": "When the PCEF receives a decision from the UE to create/replace/delete NBIFOM routing rules as defined in 3GPP TS 29.274 [22], the PCEF shall send a CCR command to the PCRF including the Event-Trigger AVP set to ROUTING_RULE_CHANGE. Additionally,\n-\tif the UE requested to create new NBIFOM routing rules, the PCEF shall include the Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVPs containing the new NBIFOM routing rule in the CCR command.The PCEF shall assign NBIFOM routing rule identifier value(s) for each received NBIFOM routing rule identifier in GTP and include that in the Routing-Rule-Identifier AVP(s) within the Routing-Rule-Definition AVP(s).\n- \tif the UE requested to modify existing NBIFOM routing rules, the PCEF shall include the Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVPs containing updated NBIFOM routing rule(s). The PCEF shall include the NBIFOM routing rule identifier(s) corresponding to each received  NBIFOM routing rule identifier in GTP in the Routing-Rule-IdentifierAVP(s) within the Routing-Rule-Definition AVP(s).\n-\tif the UE requested to delete existing NBIFOM routing rules, the PCEF shall include the Routing-Rule-Remove AVP(s) with the Routing-Rule-Identifier AVP(s) corresponding to each received  NBIFOM routing rule identifier in GTP.\nNOTE 1:\tIf UE initiates a resource modification procedure to add a new packet filter, modify an existing packet filter or delete an existing packet filter which has the same packet filter as the packet filter of the NBIFOM routing rule in the non-default access, the UE provides a corresponding NBIFOM routing rule in the same request, the PCEF performs the procedure as defined in subclause 4.5.1 in the same CCR command. The UE does not need to provide the NBIFOM  Routing rule in the same request if the UE wants to request the network to allocate resources for one IP flow in the default access.\n-\tif the UE requested the default NBIFOM access, the PCEF shall indicate the default NBIFOM access selected by the UE by including the type of default access within the Default-Access AVP.\nThe PCRF may reject NBIFOM routing rules received from the UE by including the Routing-Rule-Report AVP with the rejected NBIFOM routing rule identifier within the Routing-Rule-Identifier AVP and the Routing-Rule-Failure-Code AVP set to the corresponding value in the CCA command. Otherwise the PCRF shall behave as follows:\n-\tIf the PCRF receives the Event-Trigger AVP set to RESOURCE_MODIFICATION_REQUEST in the same command as the UE-initiated IP flow mobility procedure,\n-\tfor creation of an NBIFOM routing rule, the PCRF shall derive a new PCC rule as defined in sublcause 4.5.1 and determine the allowed access for the PCC rule according to the received NBIFOM rule. The PCRF shall include the Charging-Rule-Install AVP containing the allowed access type within the IP-CAN-Type AVPand the PCC rule within the Charging-Rule-Definition AVP in the CCA command,\n-\tfor modification of an NBIFOM routing rule, the PCRF shall update the PCC rule as defined in subclause 4.5.1 and determine the new allowed access type of the corresponding PCC rule according to the received NBIFOM routing rule. The PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and the PCC rule within the Charging-Rule-Definition AVP in the CCA command,or\n-\tfor deletion of an NBIFOM routing rule, the PCRF shall remove the corresponding PCC rule and include the Charging-Rule-Remove AVP with Charging-Rule-Name AVP containing the identity of the PCC rules to be removed in the CCA command.\n-\tOtherwise,\n-\tfor creation of an NBIFOM routing rule, the PCRF shall check if there is a PCC Rule with a corresponding service data flow template installed in the PCEF. If it is so, the PCRF shall determine the allowed access type for the PCC rule according to the received NBIFOM routing rule; otherwise, the PCRF shall derive a new PCC rule according to the received NBIFOM rule and local policies, i.e. it will set the service data flow filter equal to the Routing Filter, the precedence according to the precedence of received NBIFOM routing rule, QoS parameter based on the local policy and the allowed access type according to the NBIFOM routing rule. The PCRF shall include the Charging-Rule-Install AVP containing the allowed access type within the IP-CAN-Type AVP and the PCC rule within one Charging-Rule-Definition AVP in the CCA command,\n-\tfor modification of an NBIFOM routing rule, the PCRF shall determine the new allowed access type of the corresponding PCC rule according to the received NBIFOM routing rule. The PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and the PCC rule within one Charging-Rule-Definition AVP in the CCA command, and/or\n-\tfor deletion of an NBIFOM routing rule, if the PCC rule creation was triggered by this NBIFOM routing rule. the PCRF shall remove the corresponding PCC rule. The PCRF shall remove the corresponding PCC rule by including the Charging-Rule-Remove AVP with the Charging-Rule-Name AVP containing the identity of the PCC rules to be removed in the CCA command; otherwise, the PCRF shall remove only the allowed access type for this PCC Rule. The PCRF shall remove the allowed access type for the corresponding PCC rules by including the Charging-Rule-Install AVP containing one PCC rule within Charging-Rule-Definition AVP and without the IP-CAN-Type AVP.\nNOTE 2:\tIf a PCC rule is intended to be bound to the default access, the allowed access type can be omitted when the PCC rule is installed or modified.\n-\tIf the UE requested the default NBIFOM access, the PCRF shall verify whether the default NBIFOM access provided by the UE complies with the subscription. The PCRF shall indicate the default NBIFOM access by including the type of default access within the Default-Access AVP.\nThe PCEF shall respond to the UE by initiating the procedure as defined in 3GPP TS 29.274 [22] and perform the bearer binding in the access as indicated by the allowed access of the PCC rule.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.1",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.6",
      "section_id": "4.5.25.2.6",
      "section_title": "UE Requested IP Flow Mapping (Network-initiated NBIFOM mode)",
      "content": "This procedure is only used in Network-initiated NBIFOM mode when the UE wants to request the network to apply specific mappings of IP flows to an access as defined 3GPP TS 23.161 [51].\nWhen the PCEF receives a decision from the UE to create/modify/delete UE Requested IP Flow Mapping as defined in 3GPP TS 29.274 [22], the PCEF shall send a CCR command to the PCRF including the Event-Trigger AVP set to ROUTING_RULE_CHANGE. Additionally,\n-\tif the UE requested to create a new UE Requested IP Flow Mapping, the PCEF shall include the, Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVPs that containing the new and updated NBIFOM routing rule(s) in the CCR command. The PCEF shall include a new assigned NBIFOM routing rule identifier in the Routing-Rule-Identifier AVP(s) within the Routing-Rule-Definition AVP(s).\n-\tif the UE requested to modify a UE Requested IP Flow Mapping and there is corresponding NBIFOM routing rule(s) over Gx interface, the PCEF shall include the Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVP(s) containing the NBIFOM routing rule(s).The PCEF shall include NBIFOM routing rule identifier(s) corresponding to the received NBIFOM routing rule identifier(s) in GTP in the Routing-Rule-Identifier AVP(s) within the Routing-Rule-Definition AVP(s).\n-\tif the UE requested to modify a UE Requested IP Flow Mapping(s) for changing the allowed access type and there is no corresponding NBIFOM routing rule(s) over Gx interface, the PCEF shall include the Routing-Rule-Install AVP with one or more Routing-Rule-Definition AVP(s) containing the NBIFOM routing rule(s) with the IP-CAN-Type AVP containing the requested access type in the IP Flow Mapping.The PCEF shall include NBIFOM routing rule identifier(s) corresponding to the received NBIFOM routing rule identifier(s) in GTP in the Routing-Rule-Identifier AVP(s) within the Routing-Rule-Definition AVP(s).\n-\tif the UE requested to remove a UE Requested IP Flow Mapping the PCEF shall include NBIFOM routing rule identifier(s) corresponding  to the received NBIFOM routing rule identifier(s) in GTP in the Routing-Rule-Identifier AVP(s) within the Routing-Rule-Remove AVP.\nNOTE 1:\tFor the case when the PCEF receives a decision from the UE to create UE Requested IP Flow Mapping no rule identifier(s) is provided by the UE. In this case the rule identifier to be used in communication with the UE is assigned by the  PCEF.\nNOTE 2:\tIf UE initiates a resource modification procedure to add a new packet filter,modify an existing packet filter or delete an existing packet filter which has the same packet filter as the packet filter of the NBIFOM routing rule in the non-default access, the UE provides a corresponding IP flow mapping, the PCEF performs the procedure as defined in subclause 4.5.1 in the same CCR command. The UE does not need to provide the IP flow mapping in the same request if the UE wants to request the network to allocate resources for one IP flow in the default access.\nThe PCRF may reject NBIFOM routing rules received from the PCEF by including the NBIFOM-Routing-Rule-Report AVP with the rejected NBIFOM routing rule identifier within the Routing-Rule-Identifier AVP and the Routing-Rule-Failure-Code AVP set to the corresponding value in the CCA command. Otherwise the PCRF shall behave as follows:\n-\tIf the PCRF receives the Event-Trigger AVP set to RESOURCE_MODIFICATION_REQUEST in the same command as the UE-requested IP flow mapping procedure,\n-\tand if creation of a new NBIFOM routing rule with NBIFOM routing rule identifier provided by the PCEF is received, the PCRF shall derive a new PCC rule as defined in sublcause 4.5.1 and determine the allowed access for the PCC rule according to the received NBIFOM rule. The PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and the new PCC rule within the Charging-Rule-Definition AVP in the CCA command.\n-\tand if modification of an existing NBIFOM routing rule with NBIFOM routing rule identifier provided by the PCEF is received, the PCRF shall update the PCC rule as defined in subclause 4.5.1 and determine the new allowed access type of the corresponding PCC rule according to the received NBIFOM routing rule. The PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and the PCC rule within Charging-Rule-Definition AVP in the CCA command, or\n-\tif removal of NBIFOM routing rule is received for an NBIFOM routing rule with the NBIFOM routing rule identifier provided by the PCEF, the PCRF shall remove the corresponding PCC rule by including the Charging-Rule-Remove AVP with the Charging-Rule-Name AVP containing the identity of the PCC rule to be removed in the CCA command.\n-\tOtherwise,\n-\tand if creation of new NBIFOM routing rule with NBIFOM routing rule identifier provided by the PCEF is received, the PCRF shall check if there is a PCC rule with a corresponding service data flow template installed in the PCEF. If it is so, the PCRF shall determine the allowed access type for the PCC rule according to the received NBIFOM routing rule; otherwise, the PCRF shall derive a new PCC rule according to the received NBIFOM rule and local policies, i.e. it will set a service data flow filter equal to the Routing Filter, a precedence according to the precedence of NBIFOM routing rule, QoS parameter based on the local policy and the allowed access type according to the NBIFOM routing rule. The PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and new PCC rule within the Charging-Rule-Definition AVP in the CCA command.\n-\tand if creation of a new NBIFOM routing rule or modification of an existing NBIFOM routing rule with NBIFOM routing rule identifier provided by the PCRF is received, the PCRF shall check whether only one packet filter exists in the corresponding PCC rule, If so, the PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and updated PCC rule within the Charging-Rule-Definition AVP; Otherwise, the PCRF shall include one Charging-Rule-Install AVP containing the existing allowed access type within the IP-CAN-Type AVP and updated PCC rule which removes the packet filter identified by the NBIFOM routing rule identifier within the Charging-Rule-Definition AVP and one Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and the PCC rule which includes the packet filter identified by the NBIFOM routing rule identifier.\n-\tIf modification of a existing NBIFOM routing rule with NBIFOM routing rule identifier provided by the PCEF is received, the PCRF shall include the Charging-Rule-Install AVP containing the new allowed access type within the IP-CAN-Type AVP and updated PCC rule within the Charging-Rule-Definition AVP.\n-\tIf removal of an NBIFOM routing rule is received for an NBIFOM routing rule with the NBIFOM routing rule identifier provided by the PCEF, and if the PCC rule creation was triggered by this NBIFOM routing rule. the PCRF shall remove the corresponding PCC rule. The PCRF shall remove the corresponding PCC rule by including the Charging-Rule-Remove AVP with the Charging-Rule-Name AVP containing the identity of the PCC rule to be removed in the CCA command; otherwise,the PCRF shall remove only the allowed access type for this PCC Rule. The PCRF shall remove the allowed access type for the corresponding PCC rules by including the Charging-Rule-Install AVP containing the PCC rule within the Charging-Rule-Definition AVP and without the IP-CAN-Type AVP.\nNOTE 3:\tIn Network-initiated NBIFOM mode the PCRF can initiate a creation, modification and/or deletion of additional PCC rules in the same response. If the PCRF does that, the PCEF initiates additional IP-CAN specific procedures to provide the NBIFOM routing rules derived from the additional PCC rules.\nNOTE 4:\tIf a PCC rule is intended to be bound to the default access, the allowed access type can be omitted when the PCC rule is installed or modified.\nThe PCEF shall respond to the UE by initiating the procedure as defined in 3GPP TS 29.274 [22] and perform the bearer binding in the access as indicated by the allowed access of the PCC rule.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.1",
        "ts_23.161",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.7",
      "section_id": "4.5.25.2.7",
      "section_title": "An access becomes not available/available again",
      "content": "When the PCEF receives an indication that an access becomes not available as defined in 3GPP TS 29.274 [22], PCEF shall send a CCR command to the PCRF including the Event-Trigger AVP set to UNAVAILABLITY_OF_ ACCESS to the PCRF. The access type information of the unavailable access shall be provided within the IP-CAN-Type AVP and the reason causing the access to be unavailable shall be provided within the Access-Availability-Change-Reason AVP in the same CCR command. The PCRF may update or remove the PCC rule by sending a CCA command including the Charging-Rule-Install AVP with one or more Charging-Rule-Definition AVP containing the new allowed access type within the IP-CAN-Type AVP or by including the Charging-Rule-Remove AVP with one or more Charging-Rule-Name AVP(s) containing the identity of the PCC rule(s) to be removed.\nWhen the PCEF receives an indication that an access becomes available again as defined in 3GPP TS 29.274 [22], PCEF shall send a CCR command to the PCRF including the Event-Trigger AVP set to AVAILABLITY_OF_ACCESS to the PCRF. The access type information on available again access shall be provided within the IP-CAN-Type AVP and the reason causing the access to be available again shall be provided within the Access-Availability-Change-Reason AVP in the same CCR command. The PCRF may update the PCC rule and send a CCA command including the Charging-Rule-Install AVP with one or more Charging-Rule-Definition AVP contains the new allowed access type within the IP-CAN-Type AVP.\nNOTE:\tThis procedure can be triggered by the procedure \"Access becomes Unusable and Usable\" and by the procedure \"IP flow mobility triggered by Access stratum indication\" defined in 3GPP TS 23.161 [51].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274",
        "ts_23.161"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.8",
      "section_id": "4.5.25.2.8",
      "section_title": "Access Network Information Reporting",
      "content": "When the PCRF has received a request to report access network information from the AF and PCC rules related with the AF request are bound to multiple accesses, the PCRF should first select the PCC rule bound to the 3GPP access to request the access network information. If the PCRF cannot get the access network information from the 3GPP access side when the PCRF receives the NetLoc-Access-Support AVP set to the value of 0 (NETLOC_ACCESS_NOT_SUPPORTED), the PCRF may try to get the access network information from the non-3GPP side.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.9",
      "section_id": "4.5.25.2.9",
      "section_title": "Usage monitoring control",
      "content": "As described in subcause 4.5.16, during the IP-CAN session establishment, the PCRF may receive information about total allowed usage for Monitoring key(s) per PDN and UE from the SPR. In addition, if NBIFOM applies for an IP-CAN session, the PCRF may receive an individual Monitoring key per access from the SPR. The PCRF may include the corresponding monitoring key in the PCC rule and calculate the threshold per access according to the information received from the SPR.\nNOTE:\tIP-CAN session level usage monitoring is not dependent on the access used to carry a service data flow.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.25.2.10",
      "section_id": "4.5.25.2.10",
      "section_title": "UE resource request for a multi-access IP-CAN session",
      "content": "For the UE-initiated IP flow mobility in the UE-initaited NBIFOM mode, if the PCEF receives the resource request and NBIFOM routing rule for the same packet filter in the same request, the PCEF and the PCRF shall behave as defined in subclause  4.5.25.2.5.\nFor the UE-requested IP flow mapping in the network-initiated NBIFOM mode, if the PCEF receives the resource request and IP flow mapping request for the same packet filter in the same request, the PCEF and the PCRF shall behave as defined in subclause 4.5.25.2.6.If the PCEF only receives the resource request from the default access, the PCEF shall perform the UE-initiated resource modification procedure as defined in subclause 4.5.1. The PCRF shall derive a new PCC rule as defined in subclause 4.5.1 and determine the default access as the allowed access. The PCRF shall provide the PCC rule to the PCEF as defined in subclause  4.5.25.2.5 or 4.5.25.2.6.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.25.2.5",
        "clause_4.5.25.2.6",
        "clause_4.5.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.26.1",
      "section_id": "4.5.26.1",
      "section_title": "General",
      "content": "This subclause is only applicable for the IP-CAN session establishment procedure. The detection and handing of the late arriving requests are optional for the PCEF and PCRF.\nThe support of the detection and handing of the late arriving requests by PCEF and PCRF is optional. When supported, the PCEF and PCRF shall comply with the procedures specified in this subclause 4.5.26.\nThe procedure specified in subclause 4.5.26.2 can be used and supported with or without the procedure specified in subclause 4.5.26.3. The procedure specified in subclause 4.5.26.3 shall only be used and supported in conjunction with the procedure specified in subclause 4.5.26.2.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.5.26",
        "clause_4.5.26.2",
        "clause_4.5.26.3"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.26.2",
      "section_id": "4.5.26.2",
      "section_title": "Detection and handling of requests which collide with an existing session context",
      "content": "The PCEF shall send the CC-Request to the PCRF which includes the origination time stamp received from the originating entity (see subclause 13.2 of 3GPP TS 29.274 [22]), within the Origination-Time-Stamp AVP, if available.\nUpon receiving a new CC-Request colliding with an existing IP-CAN session context, for the same UE (i.e. the same Subscription-Id AVP) and the same APN (i.e. the same Called-Station-Id AVP) and from a different PCEF (i.e. different Origin-Host AVP), the PCRF shall accept the new CC-Request only if it contains a more recent timestamp within the Origination-Time-Stamp AVP than the origination timestamp stored for the existing IP-CAN session. If the PCRF detects that the timestamp within the Origination-Time-Stamp AVP included in the new CC-Request is less recent than the origination timestamp stored for the existing IP-CAN session, the PCRF shall reject the new CC-Request by setting the Experimental-Result-Code to DIAMETER_ERROR_LATE_OVERLAPPING_REQUEST.\nNOTE 1:\tWhen the PCRF accepts the new CC-Request that contains a more recent timestamp within the Origination-Time-Stamp AVP than the origination timestamp stored for the existing IP-CAN session, the PCRF locally deletes the existing IP-CAN session context.\nThe PCRF shall accept a new CC-Request which collides with an existing IP-CAN session context, for the same UE (i.e. the same Subscription-Id AVP) and the same APN (i.e. the same Called-Station-Id AVP) and from a different PCEF (i.e. different Origin-Host AVP), if the origination timestamp is not provided for at least one of the IP-CAN sessions for the same UE and the same APN.\nNOTE 2:\tIt is implementation specific how the PCRF handles the existing IP-CAN session context in this case.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274_clause_13.2",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.26.3",
      "section_id": "4.5.26.3",
      "section_title": "Detection and handling of requests which have timed out at the originating entity",
      "content": "The PCEF shall send the CC-Request to the PCRF which includes the origination time stamp and the Maximum Wait Time received from the originating entity (see subclause 13.3 of 3GPP TS 29.274 [22]) within the Origination-Time-Stamp AVP and  the Maximun-Wait-Time AVP, if available.\nUpon receiving a CC-Request which contains the origination time stamp within Origination-Time-Stamp AVP and the maximum wait time within the Maximun-Wait-Time AVP, the PCRF should check that the request has not already timed out at the originating node. The PCRF may perform additional similar check before sending the answer. The PCRF should reject the CC-Request that has timed out by setting the Experimental-Result-Code to DIAMETER_ERROR_TIMED_OUT_REQUEST.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274_clause_13.3",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.27",
      "section_id": "4.5.27",
      "section_title": "Resource reservation for services sharing priority",
      "content": "When the PCRF derives PCC Rules corresponding to a service related to an AF that has indicated that priority sharing is allowed for that service over Rx interface, it derives the corresponding PCC Rules according to current procedures as described in 3GPP TS 29.213 [8], subclause 5.3. The PCRF may additionally take the suggested pre-emption capability and vulnerability values into account if they were provided by the AF when the PCRF determines the ARP pre-emption capability and vulnerability. The ARP derived at this point and the priority sharing indicator provided over Rx reference point (see 3GPP TS 29.214 [10] for further information) related to these derived PCC Rules are stored for later use.\nFor PCC Rules related to the same IP-CAN session with the same assigned QCI and with the priority sharing indicator enabled (see 3GPP TS 29.214 [10], subclause 4.4.8), the PCRF shall rederive the ARP into a shared ARP for  these PCC Rules as follows:\n-\tThe Priority Level shall be set to the lowest value (i.e. highest priority) among the Priority Level values derived for the PCC rules that include the priority sharing indicator;\n-\tThe Pre-emption Capability shall be set to ENABLED if any of the original derived PCC Rules have the Pre-emption-Capability  value set to ENABLED.\n-\tThe Pre-emption Vulnerability shall be set to ENABLED if all the original derived PCC Rules have the Pre-emption Vulnerability value set to ENABLED.\nNOTE 1:\tHaving the same setting for the ARP parameter in the PCC Rules with the priority sharing indicator set enables the usage of the same bearer. Furthermore, a combined modification of the ARP parameter in the PCC  rules ensures that a bearer modification is triggered when a media flow with higher service priority starts.\nIf the QCI and/or ARP related to any of the PCC Rules that share priority is changed (e.g. based on local policies), the PCRF shall rederive the ARP for the impacted PCC Rules following the same procedure as defined in this subclause.\nThe PCRF shall provision the PCC Rules according to the rederived ARP information as described in subclause 4.5.2.0.\nIf the PCRF receives a report that a PCC rule provisioning or modification failed due to the resource reservation failure as defined in subclause 4.5.12 and if the PCRF supports the MCPTT-Preemption feature as defined in subclause 5.4.1 of 3GPP TS 29.214 [10], the PCRF shall check if pre-emption control based on the pre-emption control information provided by the AF as defined in subclause 4.4.8 of 3GPP TS 29.214 [10] applies.\nNOTE 2:\tThe PCRF determines that pre-emption control applies based on the presence of the Pre-emption-Control-Info AVP received over Rx reference point as defined in 3GPP TS 29.214 [10] and operator policies.\nIf pre-emption control applies, the PCRF shall check the corresponding derived PCC Rules (before applying priority sharing procedures). If the Pre-emption Capability of the derived PCC Rule is disabled the PCRF shall notify that resource allocation has failed for this PCC rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10]. Otherwise, if the Pre-emption Capability of the derived PCC Rule is enabled, the PCRF shall perform the pre-emption control as follows:\nFor all the active PCC rule(s) that applied priority sharing mechanism, the PCRF shall identify the PCC Rules that have the Pre-emption Vulnerability enabled. For those selected PCC Rule(s), the PCRF shall check the Priority Level value.\n-\tIf there is only one PCC Rule with the Priority Level value higher (i.e. lower priority) than the derived Priority Level value of new or modified PCC Rule, the PCRF shall remove this PCC rule. The PCRF shall retry the PCC rule provisioning or modification procedure for the PCC rule that failed.\n-\tOtherwise, if there are more than one PCC Rule with the Priority Level value higher (i.e. lower priority) than the derived Priority Level value of new or modified PCC Rule, the PCRF shall remove the PCC Rule with the highest Priority Level from the PCEF.  The PCRF shall retry the PCC rule provisioning or modification procedure for the PCC rule that failed; If more than one PCC Rule have the same highest Priority Level, the PCRF shall check the Pre-emption-Control-Info AVP received over Rx interface as defined in 3GPP TS 29.214 [10] and remove the PCC Rule that matches the condition.\n-\t Otherwise, if there is at least one PCC Rule with the same Priority Level value than the derived Priority Level value of new or modified PCC Rule, the PCRF shall check the Pre-emption-Control-Info AVP received over Rx interface as defined in 3GPP TS 29.214 [10] for these PCC Rules and remove the PCC Rule that matches the condition.\n-\tOtherwise, the PCRF shall notify that resource allocation has failed for this PCC rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10].\nIf there is no active PCC Rule with the Pre-emption Vulnerability enabled, the PCRF shall notify that resource allocation has failed for this PCC rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10].\nNOTE 3:\tIf the PCRF receives a report that a PCC rule provisioning or modification failed due to the resource reservation failure as defined in subclause 4.5.12 and the PCRF does not support the MCPTT-Preemption feature as defined in subclause 5.4.1 of 3GPP TS 29.214 [10], the PCRF can apply pre-emption and remove active PCC rules from the PCEF and then retry the PCC rule provisioning or modification procedure. Otherwise, the PCRF will notify it to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10]. How the PCRF applies the pre-emption depends on the implementation.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.213_clause_5.3",
        "ts_29.214_clause_4.4.8",
        "clause_4.5.2.0",
        "clause_4.5.12",
        "ts_29.214_clause_5.4.1",
        "ts_29.214_clause_4.4.1",
        "ts_29.213",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.28",
      "section_id": "4.5.28",
      "section_title": "Support for PCC rule versioning",
      "content": "The support of PCC rule versioning is optional. When the RuleVersioning feature is supported, the PCEF and PCRF shall comply with the procedures specified in this subclause.\nIf required by operator policies, the PCRF shall assign a content version for each generated PCC rule and include the version within the Content-Version AVP included within the Charging-Rule-Definition AVP. Upon each PCC rule modification, if the content version was assigned to a PCC rule, the PCRF shall assign a new content version. In this case, all the content related to that PCC rule shall be included. The content version is unique for the lifetime of the PCC rule.\nNOTE 1:\tThe PCRF will include all the content of the PCC rule in each modification of the PCC rule in order to ensure that the rule is installed with the proper information regardless of the outcome of the bearer procedure related to previous rule provisioning versions that are not reported yet.\nNOTE 1a:\tThe operation policies can take into account whether the AF provides the related content version information over Rx reference point (see subclause 4.4.9 in 3GPP TS 29.214 [10]).\nWhenever the PCEF provides a PCC rule report for rules that were provisioned with a content version, the PCEF shall include the Content-Version AVP(s) as part of the Charging-Rule-Report AVP for those corresponding PCC rules. The PCEF may include more than one Content-Version AVP for the same PCC Rule within the Charging-Rule-Report AVP (e.g. The PCEF has combined multiple PCC rule versions enforcement into one bearer operation). In this case, the PCC-Rule-Status AVP shall indicate the final status of the PCC rule.\nNOTE 2:\tThe PCRF will use the content version to identify the PCC rule version that failed or succeeded when multiple provisions of the same PCC rule occur in a short period of time. If required by the AF, the PCRF will inform the AF according to 3GPP TS 29.214 [10], subclause 4.4.9 about the failure or success for the media component version associated to the PCC rule version.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.214_clause_4.4.9",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.29",
      "section_id": "4.5.29",
      "section_title": "3GPP PS Data Off Support",
      "content": "When the 3GPP-PS-Data-Off feature is supported, the PCEF and PCRF shall comply with the procedures specified in this subclause. This feature is used to prevent downlink traffic and may prevent uplink traffic via 3GPP access except for 3GPP PS Data Off Exempt Services when activated by the user. The list of 3GPP PS Data Off Exempt Services shall be configured in the PCRF. If the network supports the multiple IP-CAN types and the user is allowed to access multiple access types, the PCRF shall subscribe the IP-CAN_CHANGE event trigger to the PCEF in order to support this feature.\nNOTE 1:\tThe PCRF can be configured with a list of 3GPP PS Data Off Exempt Services per APN. The list of 3GPP PS Data Off Exempt Services for an APN can also be empty, or can allow for any service within that APN, according to operator policy.\nNOTE 2:\tFor the PDN connection used for IMS services, the 3GPP Data Off Exempt Services are enforced in the IMS domain as specified 3GPP TS 23.228 [31]. Policies configured in the PCRF need to ensure that IMS services are allowed when the 3GPP Data Off status of the UE is set to \"activated\", e.g. by treating any service within a well-known IMS APN as 3GPP PS Data Off Exempt Services.\nIf the PCEF is informed that the 3GPP PS Data Off status of the UE is set to active for the IP-CAN session establishment, it shall set the 3GPP-PS-Data-Off-Status AVP set to ACTIVE (0) within the initial CCR command.\nIf the PCRF receives that initial CCR command with a 3GPP-PS-Data-Off-Status AVP set to ACTIVE (0) and the IP-CAN type of the IP-CAN session indicated as \"3GPP-EPS\", the PCRF shall configure the PCEF to block any downlink and optionally uplink IP flows not relating to a service within the list of 3GPP PS Data Off Exempt Services, for instance by not installing any related dynamic PCC rule(s) or by not activating related predefined PCC rule(s) such as PCC rule(s) with wild-carded service data flow filters. The PCRF may also, subject to its normal policies, provide the Charging-Rule-Install AVP to install or activate PCC rule (s) for  service(s) from the list of 3GPP PS Data Off Exempt Services.\nIf the PCEF is informed that the 3GPP PS Data Off status of the UE changes, the PCEF shall provide the 3GPP_PS_DATA_OFF_CHANGE event trigger within the Event-Trigger AVP and the 3GPP-PS-Data-Off-Status AVP set to the value indicated by the UE within a CCR command.\nUpon receipt of a CCR with the 3GPP_PS_DATA_OFF_CHANGE , the IP-CAN_CHANGE, or, (if the NBIFOM feature is supported) the ADDITION_OF_ACCESS, the REMOVAL_OF_ACCESS, the UNAVAILABLITY_OF_ACCESS, or the AVAILABLITY_OF_ACCESS value within the Event-Trigger AVP the PCRF shall determine whether the 3GPP PS Data Off handling functionality (as described below) becomes active or inactive. The 3GPP PS Data Off handling functionality is active if, and only if,\n-\tthe latest received 3GPP-PS-Data-Off-Status AVP is set to ACTIVE (0), and\nNOTE 3:\tIf the 3GPP_PS_DATA_OFF_CHANGE event trigger is received, the latest received value is the one received in the CCR command. Otherwise it corresponds to the stored value.\n-\tthe UE uses an access with IP-CAN Type set to \"3GPP-EPS\".\nNOTE 4:\tIf NBIFOM supported feature applies the UE can uses additional accesses.\nIf the PCRF determines that the 3GPP PS Data Off handling functionality becomes active, the PCRF shall configure the PCEF in such a way that (if NBIFON is active, only for the \"3GPP-EPS\" access type):\n-\tonly packets for services belonging to the list of 3GPP PS Data Off Exempt Services are forwarded; and\n-\tall other downlink packets and optionally uplink packets are discarded by modifying or removing any related dynamic PCC rule(s) or by deactivating any related predefined PCC rule(s).\nNOTE 5:\tIn order for the PCEF to prevent the services that do not belong to the list of 3GPP PS Data Off Exempted Services, if such services are controlled by dynamic PCC rules, PCRF can either close gates for the downlink and optionally the uplink direction via the Flow-Status AVP in related dynamic PCC rules or remove those dynamic PCC rules. If the services are controlled by predefined PCC rules, PCRF needs to deactivate those PCC rules. PCC rule(s) with wild-carded service data flow filters can be among the PCC rules that are modified. removed or disabled in that manner. It can then be necessary that the PCRF at the same time installs or activates PCC rules for data-off exempt services. The network configuration can ensure that at least one PCC Rule is bound to the default bearer when Data Off is activated in order to avoid a deletion of an existing PDN connection or in order to not fail a PDN connection establishment.\nWhen the PCRF receives service information from the AF while the 3GPP PS Data Off handling functionality is active, the following applies:\n-\tIf the corresponding IP-CAN session is active over only one access, the PCRF shall check whether the corresponding service is a 3GPP PS Data Off Exempt Service and permissible according to the user´s subscription and the policies of the PCRF. If so, the PCRF shall install, modify or delete corresponding PCC rules. Otherwise, the PCRF shall reject the service information from the AF.\n-\tIf the corresponding IP-CAN session is active over multiple accesses, and\n-\tthe corresponding service is a 3GPP PS Data Off Exempt Service and permissible according to the user´s subscription and the policies of the PCRF; or\n-\tthe corresponding service is no 3GPP PS Data Off Exempt Service but according to the user´s subscription and the policies of the PCRF it is permissible and will not be routed via the IP-CAN Type \"3GPP-EPS\".\n-\tthen the PCRF shall install, modify or delete corresponding PCC rules. Otherwise, the PCRF shall reject the service information from the AF.\nIf the PCRF determines that the 3GPP PS Data Off handling functionality becomes inactive, the PCRF shall perform policy control decision and perform PCC rule operations to make sure that services are allowed according to the user’s subscription and operator policy (irrespective of whether they belong to the list of 3GPP PS Data Off Exempt Services).\nNOTE 6:\tThe PCRF can then open gates via the Flow-Status AVP for active PCC associated to services not within the list 3GPP PS Data Off Exempt Services. The PCRF can also install PCC rules or activate predefined PCC rules for some services not belonging to the list 3GPP PS Data Off Exempt Services. If the PCRF activates or installs a PCC rule with wildcarded filters, it can remove or de-activate PCC rules for 3GPP PS Data Off Exempt Services that are made redundant by this PCC rule.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.5.30",
      "section_id": "4.5.30",
      "section_title": "Extended bandwidth support for EPC supporting Dual Connectivity (E-UTRAN and 5G NR)",
      "content": "When the Extended-BW-NR feature is supported, extended bandwidth AVPs representing bitrates in kbps shall be used to support bandwidth values higher than 2^32-1 bps instead of the bandwidth AVPs representing bitrates in bps.\nThat is:\n-\tExtended-Max-Requested-BW-DL/UL AVPs shall be used instead of Max-Requested-Bandwidth-DL/UL AVPs.\n-\tExtended-GBR-DL/UL AVPs shall be used instead of Guaranteed-Bitrate-DL/UL AVPs.\n-\tExtended-APN‑AMBR‑DL/UL AVPs shall be used instead of APN-Aggregate-Max-Bitrate-UL/DL AVPs.\nFor values lower or equal to 2^32-1 bps AVPs representing bitrates in bps shall be used.\nWhen the IP-CAN session is being established, if the PCEF supports the Extended-BW-NR feature and for bandwidth values higher than 2^32-1 bps, AVPs representing bitrate in bps (i.e. APN-Aggregate-Max-Bitrate-UL/DL AVPs) shall be provided with value set to 2^32-1 bps and bandwidth AVPs representing bitrate in kbps (i.e. Extended-APN-AMBR-UL/DL AVPs) shall be provided with the actual required bandwidth.\nNOTE:\tWhen the Diameter session is being established, the originator node does not know yet the features supported by the peer node.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.31",
      "section_id": "4.5.31",
      "section_title": "Policy update When UE suspends",
      "content": "When the UE-Status-Change feature is supported, the PCEF and the PCRF shall comply with the procedures specified in this subclause. During IP-CAN session establishment or modification procedure, the PCRF shall subscribe to the \"UE_STATUS_RESUME\" Event-Trigger if not subscribed yet, in a CC-Answer or RA-Request.\nWhen the PCRF sends a RAR or CCA command with policy decisions for a PDN connection maintained when the UE’s status is suspend state, the PCEF shall act as follows:\n-\tIf the policy decisions were received in a RAR command, the PCEF shall send an RAA command including,\n-\tthe Experimental-Result-Code sets to DIAMETER_UE_STATUS_SUSPEND which indicates the failure to enforce the corresponding policy decision, except if the RAR command is initiated for the PCC rule removal only.\n-\tif the policy decision includes the installation of one or more PCC rules, the Charging-Rule-Report AVP with the Rule-Failure-Code AVP sets to UE_STATUS_SUSPEND and with the PCC-Rule-Status sets to INACTIVE to indicate the failure to enforce those PCC rules.\n-\tif the policy decision includes the modification of one or more PCC rules, the Charging-Rule-Report AVP with the Rule-Failure-Code AVP sets to UE_STATUS_SUSPEND with the PCC-Rule-Status sets to ACTIVE to indicate the failure to enforce those PCC rules.\n-\tIf the PCRF sends a CCA including policy decisions, the PCEF shall send a CCR command including,\n-\tif the policy decision is applicable for the session level, the event trigger related with the failure to enforce the corresponding policy decision and the UE-Status AVP sets to UE_STATUS_SUSPEND.\n-\tif the policy decision includes the installation of one or more PCC rules, the Charging-Rule-Report AVP with the Rule-Failure-Code AVP sets to UE_STATUS_SUSPEND and with the PCC-Rule-Status sets to INACTIVE to indicate the failure to enforce those policy decisions.\n-\tif the policy decision includes the modification of one or more PCC rules, the Charging-Rule-Report AVP with the Rule-Failure-Code AVP sets to UE_STATUS_SUSPEND and with the PCC-Rule-Status set to ACTIVE to indicate the failure to enforce those PCC rules.\nUpon reception of the Rule-Failure-Code AVP sets to UE_STATUS_SUSPEND, the Experimental-Result-Code sets to DIAMETER_UE_STATUS_SUSPEND or the UE-Status AVP set to UE_STATUS_SUSPEND, the PCRF shall not initiate any IP-CAN Session Modification procedure, except if it is initiated for the PCC rule removal only, for the given IP-CAN session over Gx untill the UE’s status is resumed.\nIf the UE’s status is resumed from suspend state, the PCEF shall inform the PCRF of the UE status including the Event-Trigger AVP sets to \"UE_STATUS_RESUME\". The PCRF shall after this update the PCEF with PCC Rules if necessary.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_4.5.32",
      "section_id": "4.5.32",
      "section_title": "IMS Restricted Local Operator Services Support",
      "content": "RLOS is an optional feature supported in certain countries. Service requirements of RLOS are defined in 3GPP TS 22.101 [64] and the architectural requirements are defined in 3GPP TS 23.221 [65]. The RLOS stage 2 services description for the Evolved Packet System (EPS) is specified in 3GPP TS 23.401 [34]. The policy and charging control architecture is described in 3GPP TS 23.203 [7].\nRLOS may be supported as described in subclause 4.5.15 with the following clarifications:\n-\temergency APN is replaced by RLOS APN;\n-\temergency service is replaced by RLOS;\n-\temergency session is replaced by RLOS session;\n-\tthe PCRF provides the PDN GW with the QoS parameters, based on operator policy, including an ARP value reserved for the Restricted Local Operator Services where RLOS has a lower priority in terms of admission control than regular PDN connections; and\n-\tthe BBERF is not integrated into the RLOS support.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.15",
        "ts_22.101",
        "ts_23.221",
        "ts_23.401",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_29.212_4.6",
      "section_id": "4.6",
      "section_title": "Void",
      "content": "4a\tGxx reference points\n4a.1\tOverview\nThe Gxx reference point is located between the Policy and Charging Rules Function (PCRF) and the Bearer Binding and Event Reporting Function (BBERF). Gxc applies when the BBERF is located in the S-GW and Gxa applies when the BBERF is located in a trusted non-3GPP access. The Gxx reference point is used for:\n-\tProvisioning, update and removal of QoS rules from the PCRF to the BBERF\n-\tTransmission of traffic plane events from the BBERF to the PCRF.\nThe stage 2 level requirements for the Gxx reference point are defined in 3GPP TS 23.203 [7] and 3GPP TS 23.402 [23].\nSignalling flows related to Rx, Gx and Gxx interfaces are specified in 3GPP TS 29.213 [8].\nGxx reference point does not apply for 3GPP-GPRS Access Type.\nThe definition of case 1, case 2a and case 2b is specified in clause 4.0 in 3GPP TS 29.213 [8].\nRefer to Annex G of 3GPP TS 29.213 [8] for Diameter overload control procedures over the Gxx interface.\nRefer to Annex J of 3GPP TS 29.213 [8] for Diameter message priority mechanism procedures over the Gxx interface.\nRefer to Annex K of 3GPP TS 29.213 [8] for Diameter load control procedures over the Gxx interface.\n4a.2\tGxx Reference model\nThe Gxx reference point is defined between the PCRF and the BBERF. The BBERF is located in the AN-Gateway. The AN-Gateway is the S-GW when Gxc applies and it is the trusted non-3GPP access gateway when Gxa applies. The relationships between the different functional entities involved are depicted in figure 4a.2.1. The overall PCC architecture is depicted in subclause 3a of 3GPP TS 29.213 [8].\nFigure 4a.2.1: Gxx reference model\nNOTE 1:\tRefer to Annexes A.5 and H.2 of 3GPP TS 23.203 [7] for application of AN-Gateways.\nFigure 4a.2.2:Void\n4a.3\tQuality of Service Control Rules\n4a.3.1\tQuality of Service Control Rule Definition\nThe purpose of the Quality of Service Control rule (QoS rule) for the BBERF is to:\n-\tDetect a packet belonging to a service data flow.\n-\tThe service data flow filters within the QoS rule are used for the selection of downlink IP CAN bearers.\n-\tThe service data flow filters within the QoS rule are used for the enforcement that uplink IP flows are transported in the correct IP CAN bearer.\n-\tIdentify the service the service data flow contributes to.\nFor an IP-CAN session, the QoS rules are derived from the PCC rules. The QoS rule shall contain the same service data flow template, precedence and QoS information as the corresponding PCC rule. For case 2a (as defined in 3GPP TS 29.213 [8]), the QoS rules that are derived from a PCC rule shall contain the applicable tunnelling header information.\nNOTE 1:\tDuring the course of a BBERF relocation procedure, the QoS rules in the non-primary BBERF might not be consistent with the PCC rules in the PCEF.\nFor case 2a (as defined in 3GPP TS 29.213 [8]) there can be also QoS rules that do not apply to the IP-CAN session and that are local to the access system, thus not having any corresponding PCC rule. These QoS rules shall not have any associated tunnelling header information.\nThe BBERF shall select a QoS rule for each received packet by evaluating received packets against in this order:\n-\tif present, the tunnelling header information\n-\tthe service data flow filters of QoS rules, associated with the matching tunnelling header information, in their order of the precedence.\n-\tservice data flow filters of QoS rules not associated with any tunnelling header info.\nWhen a packet matches a service data flow filter, the packet matching process for that packet is completed, and the QoS rule for that filter shall be applied.\nThere are two different types of QoS rules as defined in 3GPP TS 23.203 [7]:\n-\tDynamic Qos rules. Dynamically provisioned by the PCRF to the BBERF via the Gxx interface. These QoS rules are dynamically generated in the PCRF according to the corresponding PCC rules.\n-\tPredefined QoS rules. Preconfigured in the BBERF. Predefined QoS rules can be activated or deactivated by the PCRF along with the corresponding predefined PCC rules. Predefined QoS rules within the BBERF may be grouped allowing the PCRF to dynamically activate a set of QoS rules over the Gxx reference point.\nNOTE 2:\tThe mechanism for configuring pre-defined QoS rules at the BBERF and PCRF and corresponding pre-defined PCC rules at the PCEF and PCRF are outside the scope of this specification.\nA QoS rule consists of:\n-\ta rule name;\n-\tservice data flow filter(s);\n-\tprecedence;\n-\tQoS parameters.\nThe rule name shall be used to reference a QoS rule in the communication between the BBERF and the PCRF.\nThe service data flow filter(s) shall be used to select the traffic for which the rule applies.\nThe QoS information includes the QoS class identifier (authorized QoS class for the service data flow), the ARP and authorized bitrates for uplink and downlink.\nFor different QoS rules with overlapping service data flow filter, the precedence of the rule determines which of these rules is applicable. When a dynamic QoS rule and a predefined QoS rule have the same precedence, the dynamic QoS rule takes precedence.\n4a.3.2\tOperations on QoS Rules\nFor dynamic QoS rules, the following operations are available:\n-\tInstallation: to provision a QoS rule that has not been already provisioned.\n-\tModification: to modify a QoS rule already installed.\n-\tRemoval: to remove a QoS rule already installed.\nFor predefined QoS rules, the following operations are available:\n-\tActivation: to allow the QoS rule being active.\n-\tDeactivation: to disallow the QoS rule.\nThe procedures to perform these operations are further described in clause 4a.5.2.\n4a.4\tFunctional elements\n4a.4.1\tPCRF\nThe PCRF has been already specified in clause 4.4.1. Particularities for the Gxx reference point are specified in this clause.\nThe PCRF shall provision QoS Rules to the BBERF via the Gxx reference point.\nThe PCRF shall provide QoS rules with identical service data flow templates as provided to the PCEF in the PCC rules. If the service data flow is tunnelled at the BBERF, the PCRF shall provide the BBERF with mobility protocol tunnelling header information received from the PCEF to enable the service data flow detection in the mobility tunnel at the BBERF.\nIf IP flow mobility applies, the PCRF shall, based on IP flow mobility routing rules received from the PCEF, provide the authorized QoS rules to the applicable BBERF.\nThe PCRF QoS Rule decisions may be based on one or more of the following:\n-\tInformation obtained from the AF via the Rx reference point, e.g. the session, media and subscriber related information.\n-\tInformation obtained from the PCEF via the Gx reference point, e.g. IP-CAN bearer attributes, request type, subscriber related information and IP flow mobility routing rules (if IP flow mobility is supported).\n-\tInformation obtained from the SPR via the Sp reference point, e.g. subscriber and service related data.\n-\tInformation obtained from the BBERF via the Gxx reference point.\nThe PCRF shall inform the BBERF through the use of QoS rules on the treatment of each service data flow that is under PCC control, in accordance with the PCRF policy decision(s).\nUpon subscription to loss of AF signalling bearer notifications by the AF, the PCRF shall request to BBERF to be notified of the loss of resources associated to the QoS Rules corresponding with AF Signalling IP Flows, if this has not been requested previously to the BBERF. In this case, PCRF will not subscribe to this event in the PCEF.\nThe PCRF shall, based on information reported from BBERF and PCEF, determine the Gx session(s) that shall be linked with a Gateway Control session.\n4a.4.2\tBBERF\nThe BBERF (Bearer Binding and Event Reporting Function) is a functional element located in the S-GW when Gxc applies and in a trusted non-3GPP access when Gxa applies. It provides control over the user plane traffic handling and encompasses the following functionalities:\n-\tBearer binding: For a service data flow that is under QoS control, the Bearer Binding Function (BBF) within BBERF shall ensure that the service data flow is carried over the bearer with the appropriate QoS class. The ARP, GBR, MBR and QCI are used by the BBERF in the same way as in the PCEF for resource reservation.\n-\tUplink bearer binding verification.\n-\tEvent reporting: The BBERF shall report events to the PCRF based on the event triggers installed by the PCRF.\n-\tService data flow detection for tunnelled and untunnelled SDFs: The BBERF uses service data flow filters received from the PCRF for service data flow detection.\n-\tService data flow detection for tunnelled SDFs: For the selection of the service data flow filters to apply the BBERF shall use a match with the tunnelling associated tunnelling header information received from the PCRF as a prerequisite.\nIf requested by the PCRF, the BBERF shall report to the PCRF when the status of the related service data flow changes.\nIf requested by the PCRF, a BBERF, which supports policy provisioning and enforcement of authorized QoS for service data flows that share resources, shall:\n-\tFor QoS rules bound to the same bearer perform resource sharing among QoS rules marked for resource sharing.\n4a.5\tPCC procedures over Gxx reference points\n4a.5.1\tGateway control and QoS Rules Request\nThe BBERF shall indicate, via the Gxx reference point, a request for QoS rules in the following instances:\n1)\tAt Gateway Control Session Establishment:\nThe BBERF shall send a CCR command with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\". The CCR command shall include the IMSI within the Subscription-Id AVP and the access network gateway address within the AN-GW-Address AVP. If available and applicable, the BBERF shall supply one or more of the following additional parameters to allow the PCRF to identify the rules to be applied : the type of IP-CAN within the IP-CAN-Type AVP, the type of the radio access technology within the RAT-Type AVP, the PDN information within the Called-Station-Id AVP, the PDN connection identifier within the PDN-Connection-ID AVP, if multiple PDN connections for the same APN are supported, the PLMN id within the 3GPP-SGSN-MCC-MNC AVP, the UE Ipv4 address within the Framed-IP-Address AVP and/or the UE Ipv6 prefix within the Framed-Ipv6-Prefix AVP, information about the user equipment within User-Equipment-Info AVP or User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported, QoS information within QoS-Information-AVP, user location information within the 3GPP-User-Location-Info AVP or 3GPP2-BSID AVP, the access network gateway address, and the UE time zone information within 3GPP-MS-TimeZone AVP. Furthermore, if applicable for the IP-CAN type, the BBERF may indicate the support of network-initiated bearer request procedures by supplying the Network-Request-Support AVP. The BBERF shall also send the APN-AMBR if available using the APN-Aggregate-Max-Bitrate-DL/UL AVPs or both the APN-Aggregate-Max-Bitrate-DL/UL AVPs and the Extended-APN-AMBR-DL/UL AVPs (see subclause 4a.5.19).\nFor case 2b, the BBERF may provide the Session-Linking-Indicator AVP to indicate whether the PCRF shall perform the linking of the new Gateway Control Session with an existing Gx session immediately or not.\nFor IP-CAN types that support multiple IP-CAN bearers, the BBERF may provide the Default-EPS-Bearer-QoS AVP including the ARP and QCI values corresponding to the Default EPS Bearer QoS.\n2)\tAt Gateway Control Session Modification:\nThe BBERF shall send a CC-Request with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\". For a Gateway Control and QoS Rules request where an existing IP-CAN resource is modified, the BBERF shall supply within the QoS rule request the specific event which caused such request (within the Event-Trigger AVP) and any previously provisioned QoS rule(s) affected by the gateway control and QoS Rules request. The affected QoS Rules and their status shall be supplied to the PCRF within the QoS-Rule-Report AVP.\nIn the case that the UE initiates a resource modification procedure, the BBERF shall include within the CC-Request the Event-Trigger AVP set to \"RESOURCE_MODIFICATION_REQUEST\" and shall include the Packet-Filter-Operation AVP set as follows:\n-\tWhen the UE requests to allocate new resources the BBERF shall set the Packet-Filter-Operation AVP to \"ADDITION\", and shall include within the CC-Request a Packet-Filter-Information AVP for each packet filter requested by the UE and the QoS-Information AVP to indicate the requested QoS for the affected packet filters. Each Packet-Filter-Information AVP shall include the packet filter precedence information within the Precedence AVP and the Packet-Filter-Content AVP set to the value of the packet filter provided by the UE. If the UE has specified a reference to an existing packet filter, the BBERF shall include an additional Packet-Filter-Information AVP with only the Packet-Filter-Identifier AVP, set to the value for the referred existing filter. If the QoS rule is generated for a GBR QCI, the PCRF shall update the existing QoS rule by adding the new packet filter(s).\n-\tWhen the UE requests to modify existing resources the BBERF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\", and shall include within the CC-Request a Packet-Filter-Information AVP for each affected packet filter. A packet filter is affected by the modification if QoS associated with it is modified or if its filter value or precedence is modified. If the UE request includes modified QoS information the BBERF shall also include the QoS-Information AVP within the CC-Request to indicate the updated QoS for the affected packet filters. Each Packet-Filter-Information AVP shall include a packet filter identifier as provided by the PCRF in the QoS rule within the Packet-Filter-Identifier AVP identifying the previously requested packet filter being modified and, if the precedence value is changed, shall include packet filter precedence information within the Precedence AVP. For each packet filter that the UE has requested to modify the filter value (if any), the BBERF shall provide the Packet-Filter-Content AVP set to the value of the updated packet filter provided by the UE.\n-\tWhen the UE requests to delete resources the BBERF shall set the Packet-Filter-Operation AVP to \"DELETION\", and shall include within the CC-Request a Packet-Filter-Information AVP for each packet filter deleted by the UE. Each Packet-Filter-Information AVP shall include a packet filter identifier as provided by the PCRF within the QoS rule within the Packet-Filter-Identifier AVP identifying the previously requested packet filter being deleted. If the deletion of the packet filters changes the QoS associated with the resource, the BBERF shall include the QoS-Information AVP to indicate the QoS associated with the deleted packet filters to allow the PCRF to modify the QoS accordingly.\nQoS rules can also be requested as a consequence of a failure in the QoS rule installation or enforcement without requiring an Event-Trigger. See clause 4a.5.4.\nIf the PCRF is, due to incomplete, erroneous or missing information (e.g. subscription related information not available or authorized QoS exceeding the subscribed bandwidth) not able to provision a policy decision as response to the request for QoS Rules by the BBERF, the PCRF may reject the request using a CC Answer with the Gx experimental result code DIAMETER_ERROR_INITIAL_PARAMETERS (5140). If the BBERF receives a CC Answer with this code, the BBERF shall reject the access network specific request that has resulted in this gateway control and QoS Rules request.\nIf the PCRF detects that the packet filters in the request for new QoS rules by the BBERF is covered by the packet filters of outstanding PCC/QoS rules that the PCRF is provisioning to the PCEF/BBERF, the PCRF may reject the request using a CC-Answer with the Gx experimental result code DIAMETER_ERROR_CONFLICTING_REQUEST (5147). If the BBERF receives a CC-Answer with this code, the BBERF shall reject the modification that initiated the CC-Request.\n4a.5.2\tGateway control and QoS Rules Provision\n4a.5.2.1\tOverview\nThe PCRF may decide to operate on QoS Rules without obtaining a request from the BBERF, e.g. in response to information provided to the PCRF via the Rx reference point, or in response to an internal trigger within the PCRF, or from a trigger by the SPR. To operate on QoS Rules without a request from the BBERF, the PCRF shall include these QoS Rules in an RA-Request message within either the QoS-Rule-Install AVP or the QoS-Rule-Remove AVP.\nThe BBERF shall reply with an RA-Answer. If the corresponding IP-CAN resource cannot be established or modified to satisfy the bearer binding, then the BBERF shall reject the activation of a QoS rule using the Gxx experimental result code DIAMETER_BEARER_EVENT (4142) and a proper Event-Trigger value. Depending on the cause, the PCRF can decide if re-installation, modification, removal of QoS Rules or any other action apply.\nThe PCRF shall indicate, via the Gxx reference point, QoS rules to be applied at the BBERF. This may be using one of the following procedures:\n-\tPULL procedure (Provisioning solicited by the BBERF): In response to a request for QoS rules being made by the BBERF, as described in the preceding section, the PCRF shall provision QoS rules in the CC-Answer; or\n-\tPUSH procedure (Unsolicited provisioning): The PCRF may decide to provision QoS rules without obtaining a request from the BBERF, e.g. in response to information provided to the PCRF via the Rx reference point, or in response to an internal trigger within the PCRF, or from a trigger by the SPR. To provision QoS rules without a request from the BBERF, the PCRF shall include these QoS rules in an RA-Request message. The PCRF should NOT send a new RA-Request command to the PCEF until the previous RA-Request has been acknowledged for the same IP-CAN session.\nFor each request from the BBERF or upon the unsolicited provision the PCRF shall provision zero or more QoS rules. The PCRF may perform an operation on a single QoS rule by one of the following means:\n-\tTo activate or deactivate a QoS rule that is predefined at the BBERF, the PCRF shall provision a reference to this QoS rule within a QoS-Rule-Name AVP and indicate the required action by choosing either the QoS-Rule-Install AVP or the QoS-Rule-Remove AVP.\n-\tTo install or modify a PCRF-provisioned QoS rule, the PCRF shall provision a corresponding QoS-Rule-Definition AVP within a QoS-Rule-Install AVP.\n-\tTo remove a QoS rule which has previously been provisioned by the PCRF, the PCRF shall provision the name of this rule as value of a QoS-Rule-Name AVP within a QoS-Rule-Remove AVP.\nAs an alternative to providing a single QoS rule, the PCRF may provide a QoS-Rule-Base-Name AVP within a QoS-Rule-Install AVP or the QoS-Rule-Remove AVP as a reference to a group of QoS rules predefined at the BBERF. With a QoS-Rule-Install AVP, a predefined group of QoS rules is activated or moved. With a QoS-Rule-Remove AVP, a predefined group of QoS rules is deactivated.\nThe PCRF may combine multiple of the above QoS rule operations in a single CC-Answer command or RA-Request command.\nTo install a new or modify an already installed PCRF defined QoS rule, the QoS-Rule-Definition AVP shall be used. If a QoS rule with the same rule name, as supplied in the QoS-Rule-Name AVP within the QoS-Rule-Definition AVP, already exists at the BBERF, the new QoS rule shall update the currently installed rule. If the existing QoS rule already has attributes also included in the new QoS rule definition, the existing attributes shall be overwritten. Any attribute in the existing QoS rule not included in the new QoS rule definition shall remain valid.\nIf no QoS rule(s) with uplink packet filters that are provided to the UE that are bound to a bearer which requires traffic mapping information (according to the rules as defined in 3GPP TS 23.060 [17]), the BBERF shall derive traffic mapping information based on implementation specific logic (e.g. traffic mapping information that effectively disallows any useful packet flows in uplink direction as described in clause 15.3.3.4 of 3GPP TS 23.060 [17]) and shall provide it to the UE.\nNOTE 1:\tFor GPRS and EPS, the state of TFT packet filters, as defined in 3GPP TS 23.060 [17], for an IP-CAN session requires that there is at most one bearer with no traffic mapping information for the uplink direction.\nNOTE 2:\tFor a default bearer, the BBERF will not add traffic mapping information that effectively disallows any useful packet flows in uplink direction on its own.\nUpon the same modification of the QCI and/or ARP of all the QoS rules bound to the same bearer, the BBERF should modify the QCI and/or ARP for that bearer.\nProvisioning of predefined QoS rules upon invocation/revocation of an MPS service shall be done according to clause 5.3 in 3GPP TS 29.213 [8].\nIn case 2a, if the PCRF has received the access network charging identifier information within Access-Network-Charging-Identifier-Gx AVP from the PCEF, the PCRF shall include the Access‑Network-Charging-Identifier-Value AVP within the QoS-Rule-Install AVP to inform the BBERF about the charging identifier information for the related QoS rules. The charging identifier information is used by the BBERF for charging correlation.\nThe PCRF may request the BBERF to confirm that the resources associated to a QoS rule are successfully allocated. To do so the PCRF shall provide the Event-Trigger AVP with the value SUCCESSFUL_RESOURCE_ALLOCATION (22). In addition the PCRF shall install the rules that need resource allocation confirmation by including the Resource-Allocation-Notification AVP with the value ENABLE_NOTIFICATION (0) within the corresponding Charging-Rule-Install AVP. If a Charging-Rule-Install AVP does not include the Resource-Allocation-Notification AVP, the resource allocation shall not be notified by the BBERF even if this AVP was present in previous installations of the same rule.\nNOTE 3:\tThe BBERF reporting the successful installation of QoS rules using RAA command means that the QoS rules are installed but the bearer binding or QoS resource reservation may not yet be completed, see 3GPP TS 29.213 [8]. The BBERF informs the PCRF about the successful resource reservation only if the PCRF has provided the Event-Trigger AVP indicating SUCCESSFUL_RESOURCE_ALLOCATION (22).\nIf the provisioning of QoS rules fails or provisioning of QoS rules succeed and then QoS resource reservation failed, the BBERF informs the PCRF as described in clause 4a.5.4 QoS Rule Error Handling. Depending on the cause, PCRF can decide if re-installation, modification, removal of QoS rules or any other action apply.\nIf the PCRF is unable to create a QoS rule for the response to the CC Request by the PCEF, the PCRF may reject the request as described in clause 4a5.1.\n4a.5.2.2\tSupport for DSCP marking of downlink packets at the TDF\nIn order to support QoS control in the downlink direction by the BBERF for an application detected and marked by the TDF as specified in clause 4b.5.14, the PCRF may either install a corresponding dynamic QoS Rule or activate a pre-defined QoS rule, which identifies traffic based on the corresponding DSCP value (provided by the ToS-Traffic Class AVP within the Flow-Information AVP).\nNOTE:\tThis solution is particularly useful for QoS enforcement in the downlink direction procedures performed by the BBERF. The TDF may still perform application detection and control as per received ADC Rules, including application detection reporting to the PCRF, enforcement control, usage monitoring control and charging, while applying DSCP marking. The BBERF may also perform then QoS control in the downlink direction.\n4a.5.3\tGateway Control Session Termination\nThe BBERF shall contact the PCRF when the gateway control session is being terminated (e.g. detach). The BBERF shall send a CC-Request with CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\".\nIf the BBERF needs to send a Gateway Control Session termination request towards a PCRF which is known to have restarted since the Gateway Control Session establishment, the BBERF should not send CC-Request to inform the PCRF.\nWhen the PCRF receives the CC-Request, it shall acknowledge this message by sending a CC-Answer to the BBERF.\n4a.5.4\tRequest of Gateway Control Session Termination\nThe PCRF may request the termination of a gateway control session.\nIf the PCRF decides to terminate a gateway control session due to an internal trigger or trigger from the SPR, the PCRF shall send an RAR command including the Session-Release-Cause AVP to the BBERF. When the BBERF receives the RAR Command, it shall acknowledge the command by sending an RAA command to the PCRF and instantly remove/deactivate all the QoS rules that have been previously installed or activated on that gateway control session. And then the BBERF shall apply the gateway control session termination procedure in clause 4a.5.3.\n4a.5.5\tQoS Control Rule error handling\nThe same error handling behaviour as defined in clause 4.5.12 shall apply for QoS control rules. However, QoS-Rule-Report AVP shall be used to report the affected QoS rules instead of Charging-Rule-Report AVP.\n4a.5.6\tGateway Control session to Gx session linking\nFor the cases where Gxx is deployed in the network, the PCRF shall determine at IP-CAN session establishment, which open Gateway Control session applies to the new established IP-CAN session.\nIf the already established Gateway Control session for that subscriber is not related with a PDN identifier (i.e. the Called-Station-Id AVP was not received at Gateway Control Session Establishment), the PCRF shall determine that the IP-CAN session being established corresponds to that Gateway Control Session if the following conditions are fulfilled:\n-\tThe CoA-IP-Address AVP received in the IP-CAN session establishment matches the Framed-IP-Address or Framed-Ipv6-Prefix received during the Gateway Control Session Establishment and\n-\tOptionally, the Subscription-Id AVP received in the IP-CAN session establishment matches the Subscription-Id AVP received during the Gateway Control Session Establishment\nIn this case, the PCRF may have more than one IP-CAN Gx session linked to the Gateway Control session.\nWhen the PCRF checks if APNs within Called-Station-Id AVPs match each other, the PCRF shall apply the APN matching procedures in Annex H of 3GPP TS 29.213 [8].\nIf the already established Gateway Control session for that subscriber is related with a PDN identifier (i.e. the Called-Station-Id AVP was received during the Gateway Control Session Establishment), the PCRF shall determine that the IP-CAN session being established corresponds to that Gateway Control Session if the following conditions are fulfilled:\n-\tThe Called-Station-Id AVP received in the IP-CAN session establishment matches the Called-Station-Id AVP received during the Gateway Control Session Establishment and\n-\tThe Subscription-Id AVP received in the IP-CAN session establishment matches the Subscription-Id AVP received during the Gateway Control Session Establishment and\n-\tIf received, the PDN-Connection-ID AVP received in the IP-CAN session establishment matches the PDN-Connection-ID AVP received during the Gateway Control Session Establishment.\nIn this case, the PCRF shall have only one IP-CAN Gx session linked to the Gateway Control session.\nUpon reception of a Gateway Control Session Establishment where there are already active Gx sessions for that UE in the PCRF (i.e. BBERF relocation, BBERF pre-registration and flow mobility), the PCRF may be able to determine the Gx session(s) that apply to the new established Gateway Control session as follows:\n-\tIf the new Gateway Control session for that subscriber is not related with a PDN identifier (i.e. the Called-Station-Id AVP was not received at Gateway Control Session Establishment), the PCRF shall determine the Gx session(s) that correspond to that Gateway Control Session upon reception of IP-CAN session modification. In this case, the same conditions as for the IP-CAN session establishment need to be fulfilled.\n-\tIf the new Gateway Control session for that subscriber is related with a PDN identifier (i.e. the Called-Station-Id AVP is received) the PCRF shall check the Session-Linking-Indicator AVP. If it is not received, or it indicates SESSION_LINKING_IMMEDIATE the PCRF shall determine the Gx session that corresponds to the Gateway Control Session as follows:\nIf multiple PDN connections for the same APN are not supported:\n-\tThe Called-Station-Id AVP is received in the Gateway Control Session Establishment and it matches the APN of the Gx session and\n-\tThe Subscription-Id AVP received in the Gateway Control Session Establishment matches the Subscription-Id for the IP-CAN session(s) and\n-\tIf received, the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP included in the Gateway Control Session Establishment matches the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP, of the Gx session. If both Framed-IP-Address AVP and Framed-Ipv6-Prefix AVP are present in the Gateway Control Session Establishment, both of them also need to be present in the Gx session.\nNOTE:\tThe Subscription-Id AVP used for the session linking may be in the form IMSI or IMSI based NAI as defined in 3GPP TS 23.003 [25].\nIf multiple PDN connections for the same APN are supported:\n-\tIf the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are received during the Gateway Control Session Establishment, the PCRF links the Gateway Control Session to the existing Gx session where Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are equal and the PDN ID are matched.\n-\tIf the Framed-IP-Address AVP and/or Framed-Ipv6-Prefix AVP are not received during the Gateway Control Session Establishment, the PCRF has to defer the linking with existing Gx session until an IP-CAN Session modification is received with matching UE Identity, PDN Connection ID, and PDN ID.\nIn this case, the PCRF shall link the Gateway Control Session to the Gx session.\nWhen the Session-Linking-Indicator AVP is received and indicates SESSION_LINKING_DEFERRED, the PCRF shall keep the new Gateway Control Session pending and shall defer linking until an IP-CAN Session Establishment or Modification is received including the Subscription-Id AVP, Called-Station-Id AVP and IP-CAN-Type AVP with the same values as those received during the Gateway Control Session establishment.\n4a.5.7\tMultiple BBF support\n4a.5.7.1\tGeneral\nAfter the PCRF has linked the new established Gateway Control session with the active Gx session as specified in clause 4a.5.6, if the PCRF receives the indication of IP flow mobility applying (e.g. ROUTING_RULE_CHANGE (37) event trigger) from the active Gx session, then the clause 4a.5.7.3 will apply, otherwise the clause 4a.5.7.2 will apply.\n4a.5.7.2\tHandling of two BBFs associated with the same IP-CAN session during handover\nThis procedure takes place during the handover situations where one or more BBF can be part of a pre-registration procedure. The two BBFs can be located in two separate BBERFs, or one BBF is located in the PCEF and the other one in a BBERF.\nThe PCRF, based on IP-CAN type information received from the BBERF and PCEF, shall identify the BBERF as primary or non-primary.\nUpon receiving a Gateway Control Session Establishment request from a new BBERF and if the PCRF identifies multiple Gateway Control sessions involved for a particular IP-CAN session (i.e. multiple BBERF connections during handovers) the PCRF shall carry out the following procedures:\n-\tThe PCRF shall identify the Gateway Control session that reported the same IP-CAN type as reported by PCEF and classify the BBERF that initiated that Gateway Control session as \"primary\".\n-\tIn the case where more that one Gateway Control sessions reported the same IP-CAN type as reported by PCEF the PCRF shall classify the BBERF that initiated the last Gateway Control session as \"primary\".\n-\tThe remaining BBERF connections shall be classified by the PCRF as \"non-primary\".\nAdditionally, the PCRF may update the PCC rules, derive corresponding QoS rules and provide the updated QoS rules to the new BBERF to accommodate the capabilities of the target access network (e.g. based on RAT and IP-CAN types).\nDuring the Gateway Control and QoS Rule Request, the PCRF shall act as follows with regards to the Gxx reference point:\n-\tIn the response to a CCR command with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\", if the BCM selected by the PCRF for that BBERF (primary/non-primary) indicates UE_NW, the PCRF shall provision the applicable active QoS rules for the linked IP-CAN session in the QoS-Rule-Install AVP in the CC-Answer command. In the case of non-primary BBERF, only those that do not require any modification for the active PCC rules will be provided.\n-\tIn the response of a CCR command with the CC-Request-Type set to the value \"INITIAL_REQUEST\", if the BCM selected by the PCRF for that BBERF (primary/non-primary) that initiated the Gateway Control session indicates UE_ONLY, the PCRF shall only include QoS rules applicable to the default bearer in the CC-Answer command.\n-\tIn the response to a CCR command with the CC-Request-Type set to the value \"UPDATE_REQUEST\" initiated by a BBERF that the PCRF has classified as non-primary, indicating UE-initiated resource modification request as described in clause 4a.5.1, the PCRF shall create the QoS rules based on the traffic mapping information received in the request and check whether there are aligned PCC rules installed in the PCEF. If the aligned PCC rules active in the PCEF require no modification, the PCRF shall provision the QoS rules within the QoS-Rule-Install AVP to the non-primary BBERF that created the request. Otherwise, the PCRF shall reject the request using the Gxx experimental result code DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED (5144).\n-\tIn the response to a CCR command with the CC-Request-Type set to the value \"UPDATE_REQUEST\" initiated by a BBERF including any other event trigger within the Event-Trigger AVP, the PCRF shall provision/modify/remove the applicable QoS rules in the CC-Answer command when the BBERF is selected as primary. Otherwise, only QoS rules with aligned active PCC rules will be provided.\nNOTE:\tThe PCRF operates on the PCC rules towards the PCEF when the CCR command was received from a primary BBERF.\nWhen the PCRF receives a CCR command with the CC-Request-Type set to the value \"TERMINATION_REQUEST\" initiated by a BBERF, the PCRF shall apply the procedure described in clause 4a.5.3.\nFor unsolicited provisioning of QoS rules, the PCRF shall provision the applicable QoS rules (those that are Nw-init) to those BBERFs where the Bearer Control Mode is UE_NW.\nFor the case where the primary BBERF rejects the installation of one or more QoS rule(s) in a RA-Answer command, the PCRF shall remove the impacted QoS rules from all the non-primary BBERFs in a RAR message including the removed QoS rules in the QoS-Rule-Remove AVP. If a non-primary BBERF rejects the installation of one or more QoS rules the PCRF shall not take any action towards the PCEF and BBERFs regarding the rejected rules.\nIf a primary BBERF reported the failure in a new CC-Request command, the PCRF shall remove the impacted QoS rules in the CC-Answer command and shall initiate a RA-Request command towards all the non-primary BBERFs including the removed QoS rules in the QoS-Rule-Remove AVP. If the BBERF that reported the failure is a non-primary BBERF, the PCRF shall acknowledge the Diameter CCR with a CCA command and shall not take further action towards the PCEF and BBERFs regarding the failed rules.\nUpon reception of a CCR command over the Gx interface indicating \"UPDATE_REQUEST\" with Event-Trigger AVP value indicating IP-CAN_CHANGE and AN_GW_CHANGE, the PCRF shall reclassify the BBERFs based on the classification procedures described above. After re-classification of the BBERFs, the PCRF shall perform necessary update to the QoS rules in the new primary BBERF based on the status of the PCC rules and the Bearer Control Mode supported.\nWhen the PCEF subscribes to events by using the Event-Report-Indication AVP, the PCRF shall provision those events only in the primary BBERF.\n4a.5.7.3\tHandling of multiple BBFs with flow mobility within IP-CAN session\nThis procedure takes place during S2c-based flow mobility situations where more than one BBF exist within the same IP-CAN session. The multiple BBFs can be located in separate BBERFs, or one BBF is located in the PCEF and the other one in separate BBERFs.\nFor flow mobility within IP-CAN session, the PCRF does not differentiate between primary and non-primary BBFs. Based on the IP flow mobility routing rule information received from the PCEF, the PCRF may associate the default route with one of the BBFs. The default route is identified by the IP flow mobility routing rule containing a wild card routing filter.\nUpon an IP-CAN Session Establishment or IP-CAN Session Modification that includes one or more Routing‑Rule- Definition AVP(s), the PCRF shall store the IP flow mobility routing rule information.\nUpon an IP-CAN Session Modification that includes one or more Routing-Rule-Definition AVP(s), the PCRF shall check whether there are service data flow(s) for active PCC Rules that can be associated with one BBF based on the routing information by comparing the Flow-Information AVP of the PCC Rules with the Routing-Filter AVP of the Routing‑Rule‑Definition AVP. If they match, the PCRF determines that the bearer binding for a service data flow is located in a BBF comparing the Routing-IP-address AVP contained in the IP flow mobility routing rule against the Framed-IP-Address/Framed-Ipv6-Prefix and CoA-IP-Address received during the IP-CAN session establishment/modification. The matching IP address will identify the BBF to be used for the related service data flows. When the BBF corresponds to a BBERF, the PCRF shall, if required, create the QoS rules, and provide the QoS rules to the identified BBERF.\nIf the PCRF creates new PCC Rules or modifies the Flow-Information AVP of an existing one (e.g. as a consequence of an AF interaction, or Bearer Resource Modification Request), the PCRF shall check if the new service data flow information matches any of the IP flow mobility routing rule information. If they match, the PCRF determines that the bearer binding for a service data flow is located in a BBF comparing the Routing-IP-address AVP contained in the IP flow mobility routing rule against the Framed-IP-Address/Framed-Ipv6-Prefix and CoA-IP-Address received during the IP-CAN session establishment/modification. The matching IP address will identify the BBF to be used for the related service data flows. If the PCRF determines that the bearer binding for a service data flow is located in the BBERF, the PCRF shall, if required, create the QoS rules, and provide the QoS rules to the identified BBERF.\nNOTE:\tFor IP flow mobility, the address/prefix contained in the CoA-IP-Address AVP identifies the BBERF set up for case 2a; the address/prefix contained in the Framed-IP-Address or Framed-Ipv6-Prefix AVP identifies the BBF located in the PCEF or in the BBERF of the 3GPP access.\nThe PCRF may select different bearer control mode for different BBFs based on the procedures described in clause 4.5.10 for PCEF and clause 4a.5.9 for BBERF. Provision of PCC/QoS rules to a specific BBF follows the rule provision procedures based on the bearer control mode selected for that BBF.\nWhen the route of a service data flow changes from one source BBF to another target BBF, the PCRF shall:\n-\tif the source BBF is located in a BBERF, remove the QoS rules related to the service data flow from the source BBERF following the Gateway control and QoS rules provision procedures described in clause 4a.5.2;\n-\tif the target BBF is located in a BBERF, and the BCM is NW_UE, provision the QoS rules related to the service data flow to the target BBERF following the Gateway control and QoS rules provision procedures described in clause 4a.5.2.\nThe PCRF supporting IFOM that has received an IP-CAN type associated to an established IP-CAN session, upon reception of an IP-CAN type AVP from a PCEF as part of an IP-CAN session modification procedure, if the IP-CAN type is different from the one stored for that IP-CAN session and the IP-CAN session modification contains the ROUTING_RULE_CHANGE event trigger, shall associate the new received IP CAN type to the IP-CAN session (i.e. multiple IP-CAN types are associated to the IP-CAN session).\n4a.5.8\tProvisioning of Event Triggers\nThe PCRF may provide one or several event triggers within one or several Event-Trigger AVP to the BBERF using the Gateway Control and QoS rule provision procedure. Event triggers may be used to determine which specific event causes the BBERF to re-request QoS rules. Provisioning of event triggers will be done at Gateway Control session level. The Event-Trigger AVP may be provided either in combination with the initial or subsequent QoS rule provisioning.\nThe PCEF may request the PCRF to be informed about specific changes occurred in the access network as indicated in clause 4.5.11. In this case, the PCRF shall additionally subscribe to the corresponding event triggers at the BBERF.\nThe PCRF may add new event triggers or remove the already provided ones at each request from the BBERF or upon the unsolicited provision from the PCRF. In order to do so, the PCRF shall provide the new complete list of applicable event triggers related to the Gateway Control session including the needed provisioned Event-Trigger AVPs in the CCA or RAR commands.\nThe BBERF shall include the initial information related to the event trigger that has been provisioned in the Event-Trigger AVP in the response to the Gateway Control and QoS rule provisioning procedure. The initial information related to the event trigger is included within a RAA command.\nThe PCRF may remove all previously provided event triggers by providing the Event-Trigger AVP set to the value NO_EVENT_TRIGGERS. When an Event-Trigger AVP is provided with this value, no other Event-Trigger AVP shall be provided in the CCA or RAR command. Upon reception of an Event-Trigger AVP with this value, the BBERF shall not inform PCRF of any event that requires to be provisioned from the PCRF except for those events that are always reported and do not require provisioning from the PCRF.\nIf no Event-Trigger AVP is included in a CCA or RAR operation, any previously provisioned event trigger will be still applicable.\n4a.5.9\tBearer Control Mode Selection\nWhen bearer binding is performed at the BBERF, the BBERF may indicate, via the Gxx reference point, a request for Bearer Control Mode (BCM) selection at Gateway Control session establishment. It will be done using the Gateway Control and QoS rule request procedure.\nWhen applicable for the IP-CAN type, the BBERF shall supply at Gateway Control Session Establishment, if information about the support of network initiated procedures is available, the Network-Request-Support AVP in the CC-Request with a CC-Request-Type AVP set to the value \"INITIAL_REQUEST\". The Network-Request-Support AVP indicates the access network support of the network requested bearer control.\nThe PCRF derives the selected Bearer-Control-Mode AVP based on the received Network-Request-Support AVP, access network information, subscriber information and operator policy. If the selected bearer control mode is UE_NW, the PCRF shall decide what mode (UE or NW) shall apply for every QoS rule.\nNOTE:\tFor operator-controlled services, the UE and the PCRF may be provisioned with information indicating which mode is to be used.\nIf the BBERF provided the Network-Request-Support AVP, the PCRF shall provide the selected Bearer-Control-Mode AVP to the BBERF using the Gateway Control and QoS Rules provision procedure at Gateway Control session establishment. The selected value will be applicable for the whole Gateway Control session.\nWhen the bearer binding function is changed from the PCEF to the BBERF, the BBERF may indicate, via the Gxx reference point, a request for Bearer Control Mode (BCM) selection at Gateway Control Session Establishment as described above.\nIn multiple BBERFs case, each BBERF may indicate a request for Bearer Control Mode selection independently and the BCM selected for each BBERF may be different.\n4a.5.10\tProvisioning and Policy Enforcement of Authorized QoS\n4a.5.10.1\tProvisioning of authorized QoS for the Default EPS Bearer\nThe PCRF may provision the authorized QoS for the default EPS bearer. The authorized QoS may be obtained upon interaction with the SPR.\nThe default EPS bearer QoS information shall be provisioned at RAR or CCA command level using the Default-EPS-Bearer-QoS AVP including the QoS-Class-Identifier AVP and the Allocation-Retention-Priority AVP. The provided QoS-Class-Identifier AVP shall include a non-GBR corresponding value.\n4a.5.10.2\tPolicy enforcement for authorized QoS of the Default EPS Bearer\nThe BBERF may receive the authorized QoS for the default bearer over Gxx interface. The BBERF enforces it which may lead to the change of the subscribed default EPS Bearer QoS.\n4a.5.10.3\tProvisioning of authorized QoS per APN\nThe PCRF may provision the authorized QoS per APN as part of the Gateway Control and QoS rules provision procedure.\nThe authorized QoS per APN may be modified at Gateway Control session establishment and also at Gateway Control session modification. To do so, the PCRF shall provision the authorized QoS per APN for each IP-CAN session for that APN.\nThe authorized QoS per APN shall be provisioned at RAR or CCA command level using the QoS-Information AVP including the APN-Aggregate-Max-Bitrate-UL AVP and/or the APN-Aggregate-Max-Bitrate-DL AVP, or the Extended-APN-AMBR-DL AVP and/or the Extended-APN-AMBR-UL AVP (see subclause 4a.5.19). When APN-Aggregate-Max-Bitrate-UL AVP and/or the APN-Aggregate-Max-Bitrate-DL AVP or the Extended-APN-AMBR-DL AVP and/or the Extended-APN-AMBR-UL AVP (see subclause 4a.5.19) are provided, the Max-Requested-Bandwidth values, and the Guaranteed Bitrate values shall not be included.\nNOTE:\tThe QoS per APN limits the aggregate bit rate of all Non‑GBR bearers of the same APN, i.e. the GBR bearers are outside the scope of QoS per APN.\nUpon receiving the subscribed AMBR per APN from the BBERF, the PCRF shall be able to provision the AMBR per APN to the PCEF for enforcement using the provisioning of authorized QoS per APN procedure specified in clause 4.5.5.7.\n4a.5.10.4\tPolicy provisioning for authorized QoS per service data flow\nThe Provisioning of authorized QoS per service data flow is a part of QoS rule provisioning procedure, as described in clause 4a.5.2.\nThe authorized QoS per service data flow shall be provisioned within the corresponding QoS rule by including the QoS-Information AVP within the QoS-Rule-Definition AVP in the CCA or RAR commands. This QoS-Information AVP shall not contain a Bearer-Identifier AVP.\n4a.5.10.5\tPolicy enforcement for authorized QoS per service data flow\nThe BBERF shall reserve the resources necessary for the guaranteed bitrate for the QoS rule upon receipt of a QoS rule provisioning including QoS information. The BBERF shall start the needed procedures to ensure that the provisioned resources are according to the authorized values. This may imply that the BBERF needs to request the establishment of new IP CAN bearer(s) or the modification of existing IP CAN bearer(s). If the enforcement is not successful, the BBERF shall inform the PCRF as described in clause 4a.5.5.\nUpon deactivation or removal of a QoS rule, the BBERF shall free the resources reserved for that QoS rule.\n4a.5.10.6\tPolicy provisioning and enforcement of authorized QoS for service data flows that share resources\nIf the ResShare feature is supported by both the BBERF and PCRF as described in clause 5a.4.1, the PCRF may indicate that the BBERF should commonly reserve resources for a set of QoS rules. The BBERF shall then, for QoS rules bound to the same bearer and the same sharing key value, use the highest GBR value among those QoS rules as input for calculating the common GBR value when reserving bearer resources. The GBR value for each direction shall be considered separately, so that the uplink and downlink GBR values may originate from different QoS rules.\nThe BBERF may based on internal logic use the highest MBR value among the provided QoS rules indicated to share resources, when determining the MBR for the bearer. Each individual QoS rule is still subject to data rate policing based on its own MBR values.\nThe PCRF shall provide the Sharing-Key-UL AVP and/or Sharing-Key-DL AVP within the QoS-Rule-Definition AVP in order to indicate that the related QoS rule may share resources with other QoS rules bound to the same bearer. The BBERF shall apply resource sharing if at least two QoS rules bound to the same bearer share the same value in the Sharing-Key-UL AVP and/or Sharing-Key-DL AVP.\nIf Sharing-Key-UL AVP and/or Sharing-Key-DL AVP with a modified value is received in the BBERF it will replace any previously provided value for the specified QoS rule. If Sharing-Key-UL AVP and/or Sharing-Key-DL AVP is omitted, then any previous value for the omitted AVP is still valid.\nWhen modifying the value of Sharing-Key-UL AVP and/or Sharing-Key-DL AVP to a QoS rule that is subject to resource sharing the BBERF may adjust the resource sharing of the remaining QoS rules.\nNOTE 1:\tA QoS rule that is deleted is also removed from the resource sharing, while the remaining QoS rules continue their sharing relationship.\nNOTE 2:\tThe state of resource sharing ends when less than two of the QoS rules in the set remains.\n4a.5.11\tTrace activation/deactivation\nTrace activation/deactivation at the P-GW takes place via the PCRF and is 3GPP-EPS access specific. See Annex B for further information.\n4a.5.12\tIMS Emergency Session Support\n4a.5.12.1\tPCC procedures for Emergency services over Gxx reference point\n4a.5.12.1.1\tGateway control and QoS Rules request for Emergency services\nThe BBERF executes the same procedure as for a Gateway control and QoS Rules request unrelated to Emergency Services described in clause 4a.5.1.\nA BBERF that requests QoS Rules at Gateway Control Session Establishment shall send a CCR command with CC-Request-Type AVP set to value \"INITIAL_REQUEST\". For case 2b the BBERF shall send the Called-Station-Id AVP including the Emergency APN. The BBERF may include the IMSI within the Subscription-Id AVP and if the IMSI is not available the BBERF shall include the IMEI(SV) within the User-Equipment-Info AVP or the User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported. The BBERF may include the rest of the attributes described in clause 4a.5.1.\nIf the PCRF detects that the initial or subsequent CCR command shall be rejected, it shall execute the procedure for the type of Gx experimental result code described in clause 4a.5.1.\n4a.5.12.1.2\tProvisioning of QoS Rules for Emergency services\n4a.5.12.1.2.1\tProvisioning of QoS Rules at Gxx session establishment\nThe PCRF shall detect that a Gxx session is restricted to IMS Emergency services when a CCR command is received with a CC-Request-Type AVP set to value \"INITIAL_REQUEST\" and the Called-Station-Id AVP includes a PDN identifier that matches one of the Emergency APNs from the configurable list. The PCRF:\n-\tshall provision QoS Rules restricting the access to Emergency Services (e.g. P-CSCF(s), DHCP(s) and DNS (s) and SUPL(s) addresses) as required by local operator policies in a CCA command according to the procedures described in clause 4a.5.2.\n-\tmay provision the authorized QoS that applies to the default EPS bearer within the Default-EPS-Bearer-QoS AVP in a CCA command according to the procedures described in clause 4a.5.10.1 except for obtaining the authorized QoS upon interaction with the SPR. The value for the Priority-Level AVP shall be assigned as required by local operator policies (e.g. if an IMS Emergency session is prioritized the Priority-Level AVP may contain a value that is reserved for an operator domain use of IMSEmergency sessions). If the IP-CAN Type AVP is assigned to \"3GPP-EPS\" the values for Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP shall be assigned as required by local operator policies.\n-\tmay provision the authorized QoS that applies to an APN within the APN-Aggregate-Max-Bitrate UL/DL in a CCA command according to the procedures described in clause 4a.5.10.3.\nWhen the PCEF detects that the provisioning of QoS Rules failed, it shall execute the procedure for the type of Gx experimental result code described in clause 4a.5.5.\n4a.5.12.1.2.2\tProvisioning of QoS Rules for Emergency services\nWhen the PCRF receives IMS service information from the AF for an Emergency service and derives authorized QoS Rules from the service information, the priority in the Priority-Level AVP in the QoS information within the QoS Rule shall be assigned a value as required by local operator policies (e.g. if an IMS Emergency session is prioritized the Priority-Level AVP may contain a value that is reserved for an operator domain use of IMSEmergency sessions). If the IP-CAN Type AVP is assigned to \"3GPP-EPS\" the values for the Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP shall also be assigned as required by local operator policies.\nThe PCRF shall derive authorized QoS Rules from the PCC Rules that are bound to an IP-CAN session restricted to Emergency services and immediately initiate a PUSH procedure as described in clause 4a.5.2.1 to provision QoS Rules and the procedures described in clause 4.5.5.2 to provision the authorized QoS per service data flow.\nAny BBERF-initiated request for QoS Rules for an IMS Emergency service triggered by Event-Trigger AVP assigned to \"RESOURCE_MODIFICATION_REQUEST\" (i.e. UE-initiated resource reservation) shall be rejected by the PCRF, with the error DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED.\nThe BBERF shall execute the procedures described in clause 4a.5.2.1 and clause 4.5.5.3 to ensure that a new IP-CAN bearer is established for the Emergency service.\nWhen the BBERF detects that the provisioning of QoS Rules failed, it shall execute the procedure for the type of Gx experimental result code described in clause 4a.5.5.\n4a.5.12.2\tGateway Control Session to Gx session linking\nIf the Subscription-Id AVP was not received, the PCRF shall perform Gateway Control Session to Gx session linking by using the User-Equipment-Info AVP or the User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported.\n4a.5.12.3\tRemoval of QoS Rules for Emergency Services\nThe reception of a request to terminate an AF session for an IMS Emergency service by the PCRF triggers the removal of QoS Rules assigned to the terminated IMS Emergency Service from the BBERF by using the clause 4a.5.2.1 to provision QoS Rules.\nAt reception of a RAR that removes one or several QoS Rules from an IP-CAN Session restricted to emergency services the BBERF shall:\n-\twhen all QoS Rules bound to an IP-CAN bearer are removed, initiate an IP-CAN bearer termination procedure.\n-\twhen not all QoS Rules bound an IP-CAN bearer are removed, initiate an IP-CAN bearer modification procedure.\n4a.5.12.4\tTermination of Gateway Control session for Emergency Services\nThe procedure to terminate a Gateway Control Session defined for case 2b) in 4a.5.3 and for case 2a) in 4a.5.4 applies.\n4a.5.13\tTime of the day procedures\nBBERF shall be able to perform PCC rule request as instructed by the PCRF. To do so, the PCRF shall provide the Event-Trigger AVP with the value REVALIDATION_TIMEOUT (17) if the event trigger is not previously set, and in addition the Revalidation-Time AVP when set by the PCRF. This shall cause the BBERF to trigger a PCRF interaction to request QoS rules from the PCRF for an established gateway control session. The BBERF shall stop the timer once the BBERF triggers a REVALIDATION_TIMEOUT event. The BBERF should send the PCC rule request during a preconfigured period before the indicated revalidation time.\nNOTE 1:\tThe PCRF is expected to be prepared to provide a new policy, as desired for the revalidation time, during a preconfigured period before the revalidation time.The preconfigured periods in the BBERF and PCRF need to be aligned.\nPCRF shall be able to provide a new value for the revalidation timeout by including Revalidation-Time AVP in CCA or RAR. The PCRF may provide the Revalidation-Time AVP together with the event trigger REVALIDATION_TIMEOUT or in a subsequent QoS rule provisioning.\nPCRF shall be able to stop the revalidation timer by disabling the REVALIDATION_TIMEOUT event trigger.\nNOTE 2:\tBy disabling the REVALIDATION_TIMEOUT the revalidation time value previously provided to the BBERF is not applicable anymore.\nIf the PCRF includes the activation time in Rule-Activation-Time and/or the deactivation time in Rule-Deactivation-Time when the PCRF provision the PCC rules to the PCEF, the PCRF shall set the same activation time in Rule-Activation-Time and/or the deactivation time in Rule-Deactivation-Time when the PCRF provision the corresponding QoS rules to the BBERF.\nThe PCRF may control at what time the status of a QoS rule changes.\n1)\tIf Rule-Activation-Time is specified only and has not yet occurred, then the BBERF shall set the QoS rule inactive and make it active at that time. If Rule-Activation-Time has passed, then the BBERF shall immediately set the QoS rule active.\n2)\tIf Rule-Deactivation-Time is specified only and has not yet occurred, then the BBERF shall set the QoS rule active and make it inactive at that time. If Rule-Deactivation-Time has passed, then the BBERF shall immediately set the QoS rule inactive.\n3)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, and also when the QoS rule is provided before or at the time specified in the Rule-Deactivation-Time, the BBERF shall handle the rule as defined in 1) and then as defined in 2).\n4)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, and also when the QoS rule is provided before or at the time specified in the Rule-Activation-Time, the BBERF shall handle the rule as defined in 2) and then as defined in 1).\n5)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has already occurred for both, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, then the BBERF shall immediately set the QoS rule inactive.\n6)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has passed for both, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, then the BBERF shall immediately set the QoS rule active.\n7)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified with the same time, the PCEF shall report a PCC rule error for the concerned PCC rule, as specified in subclause 4a.5.5, with the Rule-Failure-Code set the value \"SAME_TIME_ERROR\".\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified in the QoS-Rule-Install then it will replace the previously set values for the specified QoS rules. If Rule-Activation-Time AVP, Rule-Deactivation-Time AVP or both AVPs are omitted, then any previous value for the omitted AVP is no longer valid.\nThe 3GPP-MS-TimeZone AVP, if available, may be used by the PCRF to derive the Rule-Activation-Time and Rule-Deactivation-Time.\nIf the QoS rule(s) that include the Rule-Activation-Time AVP are bound to a bearer that will require traffic mapping information to be sent to the UE, the BBERF shall report the failure to the PCRF by including the QoS-Rule-Report AVP with the Rule-Failure-Code set the value \"NO_BEARER_BOUND (15)\" for the affected QoS rule(s) identified by the QoS-Rule-Name AVP in either a CCR or an RAA command.\nNOTE 3:\tThis limitation prevents dependencies on the signalling of changed traffic mapping information towards the UE.\nThe QoS rules including Rule-Activation-Time and Rule-Deactivation-Time shall not be applied for changes of the QoS or service data flow filter information.\n4a.5.14\tMultimedia Priority Support\n4a.5.14.1\tPCC Procedures for Multimedia Priority services over Gxx reference point\n4a.5.14.1.1\tProvisioning of QoS Rules for Multimedia Priority Services\nThe provision of QoS Rules corresponding to both MPS and non-MPS services shall be performed as described in clause 4a.5.2.\nThe QoS Rules applicable for MPS and non-MPS services shall be derived from the PCC Rules generated as described in clause 4.5.191.2.\nWhen the PCRF receives a CCR command with CC-Request-Type AVP set to value \"INITIAL_REQUEST\", the PCRF shall check whether any of these parameters are stored in the SPR: MPS EPS Priority, MPS Priority Level and/or IMS Signalling Priority. The PCRF shall derive the QoS Rules from the generated PCC Rules and default bearer QoS based on that information. If the IMS Signalling Priority is set and the Called-Station-Id AVP is received and corresponds to an APN dedicated for IMS, the PCRF shall assign an ARP corresponding to MPS for the default bearer and for the PCC/QoS Rules corresponding to the IMS signalling bearer. If the Called-Station-Id AVP does not correspond to an APN dedicated for IMS, the ARP shall be derived without considering IMS Signalling Priority.\nNOTE 0: Subscription data for MPS is provided to PCRF through the Sp reference point.\nOnce the PCRF receives a notification of a change in MPS EPS Priority, MPS Priority Level and/or IMS Signalling Priority from the SPR, the PCRF shall make the corresponding policy decisions (i.e. ARP and/or QCI change) and, if applicable, shall initiate a RAR command to provision the modified data.\nNOTE 1:\tThe details associated with the Sp reference point are not specified in this Release. The SPR's relation to existing subscriber databases is not specified in this Release.\nNOTE 2:\tThe MPS Priority Level is one among other input data such as operator policy for the PCRF to set the ARP.\nThe PCRF shall derive the ARP of the default bearer as described in clause 4.5.19.1.1.\n4a.5.14.1.2\tInvocation/Revocation of Priority EPS Bearer Services\nWhen a Priority EPS Bearer Service is invoked or revoked, the PCRF shall behave as described in clause 4.5.19.1.2. The PCRF shall derive the QoS Rules from the applicable PCC Rules.\nThe PCRF shall provision the BBERF with the applicable QoS Rules upon Priority EPS Bearer Service activation and deactivation as described in clause 4a.5.2. The provision of the QoS information applicable for the QoS Rules shall be performed as described in clause 4a.5.10.4. The provision of QoS information for the default bearer shall be performed as described in clause 4a.5.10.1.\n4a.5.14.1.3\tInvocation/Revocation of IMS Multimedia Priority Services\nIf the PCRF receives service information including an MPS session indication and the service priority level from the P-CSCF or detects that the P-CSCF released all the MPS Session, the PCRF shall behave as described in clause 4.5.19.1.3. The PCRF shall derive the QoS Rules from the applicable PCC Rules.\nThe PCRF shall provision the BBERF with the applicable QoS Rules upon MPS session initiation and release as described in clause 4a.5.2. The provision of the QoS information applicable for the QoS Rules shall be performed as described in clause 4a.5.10.4. The provision of QoS information for the default bearer shall be performed as described in clause 4a.5.10.1.\n4a.5.14.1.4\tInvocation/Revocation of Multimedia Priority Services for DTS\nWhen MPS for DTS is invoked or revoked, the PCRF shall behave as described in clause 4.5.19.1.4.\nThe provision of QoS information for the default bearer shall be performed as described in clause 4a.5.10.1.\nNOTE:\tFor the already installed dynamic PCC/QoS rules that are bound to the default bearer, the PCRF can derive the QoS Rules from the applicable PCC Rules as described in clause 4.5.19.1.4 and provision the BBERF with the applicable QoS Rules.\n4a.5.15\tPCRF Failure and Restoration\nIf the BBERF needs to send a Gateway Control Session modification request towards a PCRF which is known to have restarted since the Gateway Control Session establishment, the BBERF should not send the Gateway Control Session modification request towards a PCRF and the BBERF may tear down the associated PDN connection based on operator policy, by initiating PDN connection deactivation procedure. Emergency and eMPS sessions should not be torn down.\nNOTE 1:\tThis mechanism enables the clean up of PDN connections affected by the PCRF failure and leads the UE to initiate a UE requested PDN connectivity procedure for the same APN.\nNOTE 2:\tThe method the BBERF uses to determine that a PCRF has restarted is not specified in this release.\n4a.5.16\tReporting Access Network Information\nIf the AF requests the PCRF to report the access network information and if the PCRF cannot determine that access network information cannot be provided as described in clause 5.5.4 of 3GPP TS 29.214 [10], the PCRF shall provide the requested access network information indication (e.g. user location and/or user timezone information) to the BBERF as follows:\n-\tIf the PCRF is installing or modifying a QoS rule, the PCRF shall include the Required-Access-Info AVP within the QoS-Rule-Definition AVP of an appropriate installed or modified QoS rule;\n-\tOtherwise, if the PCRF is removing QoS rules based on the AF requests, the PCRF shall include the Required-Access-Info AVP within the QoS-Rule-Remove AVP associated with the corresponding QoS rules being removed.\nThe PCRF shall also provide the ACCESS_NETWORK_INFO_REPORT event trigger within Event-Trigger AVP (if this event trigger is not yet set).\nFor the QoS Rule(s) based on preliminary service information as described in 3GPP TS 29.214 [10] the PCRF may assign the QCI and ARP of the default bearer to avoid signalling to the UE. These QoS Rules shall not include the Packet-Filter-Usage AVP within the Flow-Information AVP included in the QoS-Rule-Definition AVP. These QoS rule(s) may be provisioned by the PCRF without corresponding PCC rule(s).\nNOTE:\t3GPP TS 23.203 [7] provides further information about appropriate QoS rules in clause 6.2.1.0.\nIf the ACCESS_NETWORK_INFO_REPORT event trigger is set, upon installation, modification and removal of any QoS rule(s) with the Required-Access-Info AVP in a Gxx RAR command, the BBERF shall determine if it can obtain the required location information for the used IP CAN type. If the BBERF determines that the IP CAN type does not support such procedures, the BBERF shall immediately inform the PCRF by including the NetLoc-Access-Support AVP with the value of 0 (NETLOC_ACCESS_NOT_SUPPORTED) in the RAA command. Otherwise, the BBERF shall apply appropriate IP CAN specific procedures to obtain this information. When the BBERF then receives access network information through those IP CAN specific procedures, the BBERF shall provide the corresponding access network information to the PCRF as follows:\n-\tIf the user location information was requested by the PCRF and was provided to the BBERF, the BBERF shall provide the user location information within the 3GPP-User-Location-Info AVP and the time when it was last known within User-Location-Info-Time AVP (if available).\n-\tIf the user location information was requested by the PCRF and was not provided to the BBERF, the BBERF shall provide the serving PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP.\n-\tIf the time zone was requested by the PCRF, the BBERF shall provide it within the 3GPP-MS-TimeZone AVP.\nIn addition, the BBERF shall provide the ACCESS_NETWORK_INFO_REPORT event trigger within Event-Trigger AVP.\nDuring bearer deactivation, the BBERF shall provide the access network information to the PCRF by including the user location information within the 3GPP-User-Location-Info AVP (if requested by the PCRF and provided to the BBERF), the information on when the UE was last known to be in that location within User-Location-Info-Time AVP ( if user location information was requested by the PCRF and the corresponding information was provided to the BBERF) the PLMN identifier within the 3GPP-SGSN-MCC-MNC (if the user location information was requested by the PCRF but was not provided to the BBERF) and the timezone information within the 3GPP-MS-TimeZone AVP (if requested by the PCRF).\nDuring IP-CAN session termination procedure, the BBERF shall, if ACCESS_NETWORK_INFO_REPORT event trigger is set, provide the access network information to the PCRF by including the user location information within the 3GPP-User-Location-Info AVP (if it was provided to the BBERF), the information on when the UE was last known to be in that location within User-Location-Info-Time AVP (if it was provided to the BBERF), the PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP (if the user location information was not provided to the BBERF) and the timezone information within the 3GPP-MS-TimeZone AVP.\nTheBBERF shall not report any subsequent access network information updates received from the IP-CAN without any previous provisioning or removal of related QoS rules unless the associated IP-CAN bearer or connection has been released.\n4a.5.17\tResource reservation for services sharing priority\nWhen the PCRF derives QoS Rules corresponding to a service related to an AF that has indicated that priority sharing is allowed for that service over Rx interface, it derives the corresponding QoS Rules according to current procedures as described in 3GPP TS 29.213 [8], subclause 5.3. The PCRF may additionally take the suggested pre-emption capability and vulnerability values into account if they were provided by the AF when the PCRF determines the ARP pre-emption capability and vulnerability. The ARP derived at this point and the priority sharing indicator provided over Rx reference point (see 3GPP TS 29.214 [10] for further information) related to these derived QoS Rules are stored for later use.\nFor QoS Rules related to the same IP-CAN session with the same assigned QCI and with the priority sharing indicator enabled (see 3GPP TS 29.214 [10], subclause 4.4.8), the PCRF shall rederive the ARP into a shared ARP for these QoS Rules as follows:\n-\tThe Priority Level shall be set to the lowest value (i.e. highest priority) among the Priority Level values derived for the QoS rules that include the priority sharing indicator;\n-\tThe Pre-emption Capability shall be set to ENABLED if any of the original derived QoS Rules have the Pre-emption-Capability  value set to ENABLED.\n-\tThe Pre-emption Vulnerability shall be set to ENABLED if all the original derived QoS Rules have the Pre-emption Vulnerability value set to ENABLED.\nNOTE 1:\tHaving the same setting for the ARP parameter in the QoS rules with the priority sharing indicator set enables the usage of the same bearer. Furthermore, a combined modification of the ARP parameter in the QoS Rules ensures that a bearer modification is triggered when a media flow with higher service priority starts.\nIf the QCI and/or ARP related to any of the QoS Rules that share priority is changed (e.g. based on local policies), the PCRF shall rederive the ARP for the impacted QoS Rules following the same procedure as defined in this subclause.\nThe PCRF shall provision the QoS Rules according to the rederived ARP information as described in subclause 4a.5.2.1.\nIf the PCRF receives a report that a QoS rule provisioning or modification failed due to the resource reservation failure as defined in subclause 4a.5.5 and if the PCRF supports the MCPTT-Preemption feature as defined in subclause 5.4.1 of 3GPP TS 29.214 [10], the PCRF shall check if pre-emption control based on the pre-emption control information provided by the AF as defined in subclause 4.4.8 of 3GPP TS 29.214 [10] applies.\nNOTE 2:\t The PCRF determines that pre-emption control applies based on the presence of the Pre-emption-Control-Info AVP received over Rx reference point as defined in 3GPP TS 29.214 [10] and operator policies.\nIf pre-emption control applies, the PCRF shall check the corresponding derived QoS Rules (before applying priority sharing procedures). If the Pre-emption Capability of the derived QoS Rule is disabled the PCRF shall notify that resource allocation has failed for this QoS rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10]. Otherwise, if the Pre-emption Capability of the derived QoS Rule is enabled, the PCRF shall perform the pre-emption control as follows:\nFor all the active QoS rule(s) that applied priority sharing mechanism, the PCRF shall identify the QoS Rules that have the Pre-emption Vulnerability enabled. For those selected QoS Rule(s), the PCRF shall check the Priority Level value.\n-\tIf there is only one QoS Rule with the Priority Level value higher (i.e. lower priority) than the derived Priority Level value of new or modified QoS Rule, the PCRF shall remove this QoS rule. The PCRF shall retry the QoS rule provisioning or modification procedure for the QoS rule that failed.\n-\tOtherwise, if there are more than one QoS Rule with the Priority Level value higher (i.e. lower priority) than the derived Priority Level value of new or modified QoS Rule, the PCRF shall remove the QoS Rule with the highest Priority Level from the PCEF.  The PCRF shall retry the QoS rule provisioning or modification procedure for the QoS rule that failed; If more than one QoS Rule have the same highest Priority Level, the PCRF shall check the Pre-emption-Control-Info AVP received over Rx interface as defined in 3GPP TS 29.214 [10] and remove the QoS Rule that matches the condition.\n-\tOtherwise, if there is at least one QoS Rule with the same Priority Level value than the derived Priority Level value of new or modified QOS Rule, the PCRF shall check the Pre-emption-Control-Info AVP received over Rx interface as defined in 3GPP TS 29.214 [10] for these QoS Rules and remove the QoS Rule that matches the condition.\n-\tOtherwise, the PCRF shall notify that resource allocation has failed for this QoS rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10].\nIf there is no active QoS Rule with the Pre-emption Vulnerability enabled, the PCRF shall notify that resource allocation has failed for this QoS rule to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10].\nNOTE 2:\tIf the PCRF receives a report that a QoS rule provisioning or modification failed due to the resource reservation failure as defined in subclause 4a.5.5 and the PCRF does not support the MCPTT-Preemption feature as defined in subclause 5.4.1 of 3GPP TS 29.214 [10], the PCRF can apply pre-emption and remove active QoS rules from the BBERF and then retry the QoS rule provisioning or modification procedure. Otherwise, the PCRF will notify it to the AF as defined in subclause 4.4.1 or 4.4.2 of 3GPP TS 29.214 [10]. How the PCRF applies the pre-emption depends on the implementation.\n4a.5.18\tSupport for QoS rule versioning\nThe support of QoS rule versioning is optional. When the RuleVersioning feature is supported, the BBERF and PCRF shall comply with the procedures specified in this subclause.\nIf required by operator policies, the PCRF shall assign a content version for each generated QoS rule and include the version within the Content-Version AVP included within the QoS-Rule-Definition AVP. Upon each QoS rule modification, if the content version was assigned to a QoS rule, the PCRF shall assign a new content version. In this case, all the content related to that QoS rule shall be included. The content version is unique for the lifetime of the QoS rule.\nNOTE 1:\tThe PCRF will include all the content of the QoS rule in each modification of the QoS rule in order to ensure that the rule is installed with the proper information regardless of the outcome of the bearer procedure related to previous rule provisioning versions that are not reported yet.\nNOTE 2:\tThe operation policies can take into account whether the AF provides the related content version information over Rx reference point (see subclause 4.4.9 in 3GPP TS 29.214 [10]).\nWhenever the BBERF provides a QoS rule report for rules that were provisioned with a content version, the BBERF shall include the Content-Version AVP(s) as part of the QoS-Rule-Report AVP for those corresponding QoS rules. The BBERF may include more than one Content-Version AVP for the same QoS rule within the QoS-Rule-Report AVP (e.g. The BBERF has combined multiple QoS rule versions enforcement into one bearer operation). In this case, the PCC-Rule-Status AVP shall indicate the final status of the QoS rule.\nNOTE 3:\tThe PCRF will use the content version to identify the QoS rule version that failed or succeed when multiple provisions of the same QoS rule in a short period of time. If required by the AF, the PCRF will inform the AF according to 3GPP TS 29.214 [10], subclause 4.4.9 about the failure or success for the media component version associated to the PCC rule version.\n4a.5.19\tExtended bandwidth support for EPC supporting Dual Connectivity (E-UTRAN and 5G NR)\nWhen the Extended-BW-NR feature is supported, extended bandwidth support as described in subclause 4.5.x applies.\nWhen the Gateway Control Session is being established and if the BBERF supports the Extended-BW-NR feature, the same behaviour as described for the PCEF in subclause 4.5.30 applies for the BBERF.\n4b\tSd reference point\n4b.1\tOverview\nThe Sd reference point is located between the Policy and Charging Rules Function (PCRF) and the Traffic Detection Function (TDF). For the solicited application reporting, the Sd reference point is used for establishment and termination of TDF session between PCRF and TDF, provisioning of Application Detection and Control rules from the PCRF for the purpose of traffic detection and enforcement at the TDF, usage monitoring control of TDF session and of detected applications and reporting of the start and the stop of a detected applications's traffic and transfer of service data flow descriptions for detected applications, ifdeducible, from the TDF to the PCRF. For the unsolicited reporting, the Sd reference point is used for establishment and termination of TDF session between PCRF and TDF, reporting of the start and the stop of a detected application's traffic and transfer of service data flow descriptions for detected applications, if deducible, and transfer of Application instance identifier, if service data flow descriptions are deducible, from the TDF to the PCRF.\nThe stage 2 level requirements for the Sd reference point are defined in 3GPP TS 23.203 [7].\nSignalling flows related to the Sd, Rx, Gxx and Gx interfaces are specified in 3GPP TS 29.213 [8].\nRefer to Annex G of 3GPP TS 29.213 [8] for Diameter overload control procedures over the Sd interface.\nRefer to Annex J of 3GPP TS 29.213 [8] for Diameter message priority mechanism procedures over the Sd interface.\nRefer to Annex K of 3GPP TS 29.213 [8] for Diameter load control procedures over the Sd interface.\nThe TDF is considered as monolithic entity in the present specification, but can be decomposed into a User Plane Function and a Control Plane Function connected via the Sx reference point. The Sx reference point and interactions between the Sd and Sx reference points are not considered in the present specification, but are specified in 3GPP TS 29.244 [63].\n4b.2\tSd Reference model\nThe Sd reference point is defined between the PCRF and the TDF. The relationships between the different functional entities involved are depicted in figure 4b.2.1. The overall PCC architecture is depicted in subclause 3a of 3GPP TS 29.213 [8].\nFigure 4b.2.1: Sd reference model\nNOTE:\tThe TDF can be decomposed into a User Plane Function and a Control Plane Function connected via the Sx reference point specified in 3GPP TS 29.244 [63]. If the TDF is decomposed, the Sd reference point terminates in the Control Plane Function.\nFigure 4b.2.2: Void\n4b.3\tApplication Detection and Control Rules\n4b.3.1\tFunctional entities\nThe PCRF may provide ADC Rules to the TDF by using Sd interface.\nOnce the start or stop of the application's traffic, matching one of those ADC Rules, is detected, if PCRF has previously subscribed to the APPLICATION_START/APPLICATION_STOP Event-Triggers, unless a request to mute such a notification (Mute-Notification AVP) is part of the corresponding ADC Rule, the TDF shall report the information regarding the detected application's traffic to the PCRF and apply the enforcement actions, if defined within the corresponding ADC Rule.\n4b.3.2\tApplication Detection and Control Rule Definition\nThe purpose of the ADC rule is to provide and apply the detection, enforcement actions and applicable charging parameters for the specified application traffic.\nThere are two different types of ADC rules as defined in 3GPP TS 23.203 [7]:\n-\tDynamic ADC rules. The PCRF can however provide and modify some parameters via the Sd reference point, respectively. These ADC rules can be installed, modified and removed at any time. The dynamic ADC rules are applicable only in case of solicited application reporting.\n-\tPredefined ADC rules. Preconfigured in the TDF. In the case of solicited reporting, the Predefined ADC rules can be activated or deactivated by the PCRF at any time. Predefined ADC rules within the TDF may be grouped allowing the PCRF to dynamically activate a set of ADC rules.\nAn ADC rule consists of:\n-\ta rule identifier;\n-\tTDF application identifier;\n-\tservice data flow filter(s);\n-\tprecedence;\n-\tcharging key (i.e. rating group);\n-\tother charging parameters;\n-\tmonitoring key;\n-\tsponsor identity;\n-\tapplication service provider identity;\n-\tgate status;\n-\tUL maximum bit rate;\n-\tDL maximum bit rate;\n-\tredirect;\n-\tDL DSCP value;\n-\tTraffic steering policy identifier(s).\nThe rule identifier shall be used to reference an ADC rule in the communication between the TDF and the PCRF.\nNOTE 1:\tThe PCRF has to ensure that there is no dynamically provided ADC rule that has the same rule identifier value as any of the predefined ADC rules.\nThe TDF application identifier shall be used to reference the corresponding application, for which the rule applies during reporting to the PCRF. The same application identifier value can occur in more than one ADC rule. If so, the PCRF shall ensure that there is at most one ADC rule active per application identifier value at any time. Instead of TDF Application identifier, the service data flow filter(s) list may be provided which comprises one or more service data flow filters and is used by the TDF to identify the packets belonging to a detected traffic. The service data flow filter(s) or the TDF application identifier shall be used to select the traffic for which the rule applies. Either service data flow filter(s) or TDF application identifier shall exist in an ADC rule.\nNOTE 2:\tThe same application identifier value could be used for a dynamic ADC rule and a pre-defined ADC rule or for multiple pre-defined ADC rules.\nNOTE 3:\tThe configuration of the application detection filter in the TDF can include the set of information required for encrypted detection as defined in Annex X of 3GPP TS 23.203 [7].\nThe precedence defines, if multiple ADC rules overlap in the application traffic detection, the ADC Rule with the highest precedence will be applied for the purpose of enforcement, reporting of application starts and stops, usage monitoring, and charging. When a dynamic ADC rule and a predefined ADC rule have the same precedence, the dynamic ADC rule takes precedence. For dynamic ADC rules, the Precedence will be either preconfigured at the TDF or provided dynamically by the PCRF within the ADC Rules.\nNOTE 4:\tThe operator ensures that overlap between the predefined ADC rules can be resolved based on precedence of each predefined ADC rule in the TDF. For dynamic ADC rules, if precedence is not preconfigured in the TDF, the PCRF ensures that overlap between the dynamic ADC rules can be resolved based on precedence of each dynamic ADC rule.\nNOTE 5:\tWhether precedence for dynamic ADC rules that contain an application identifier is preconfigured in TDF or provided in the ADC rule from the PCRF depends on network configuration.\nThe charging parameters define whether online and offline charging interfaces are used, what is to be metered in offline charging, on what level the TDF shall report the usage related to the rule, etc.\nThe monitoring key for an ADC rule identifies a monitoring control instance that shall be used for usage monitoring control of a particular application or a group of applications (as identified by the predefined or dynamic ADC rule(s)) or all detected traffic belonging to a specific TDF session.\nIf sponsored data connectivity is supported, the sponsor identity for a ADC rule identifies the 3rd party organization (the sponsor) willing to pay for the operator's charge for connectivity required to deliver a service to the end user.\nIf sponsored data connectivity is supported, the application service provider identity for a ADC rule identifies the 3rd party organization (the ASP) that is delivering the service to the end user.\nThe gate status indicates whether the application, identified by the TDF application identifier, may pass (gate is open) or shall be blocked (gate is closed) in uplink and/or in downlink direction.\nThe UL maximum bitrate indicates the authorized maximum bitrate for the uplink component of the detected application traffic.\nThe DL maximum bitrate indicates the authorized maximum bitrate for the downlink component of the detected application traffic.\nNOTE 6:\tIn order to support services that generate media with variable bitrate (e.g. video) , the policing function could need to measure the enforced MBR with a sliding window that averages over a suitable time period. For example, for MTSI media, 3GPP TS 26.114 [57] recommends a default period of 2 seconds and provides further considerations regarding suitable time periods for speech and video.\nThe Redirect indicates whether the uplink part of the detected application traffic should be redirected to another controlled address. The target redirect address may also be included.\nThe DL DSCP value indicates the DSCP value for marking of downlink packets of the detected application traffic.\nThe traffic steering policy identifier(s) is a reference to a pre-configured traffic steering policy at the TDF as defined in subclause 4b.4.2.\nOne or more of the following parameters can be modified for a dynamic ADC rule:\n-\tprecedence;\n-\tcharging key (i.e. rating group);\n-\tother charging parameters (with the exemption of charging method);\n-\tmonitoring key;\n-\tsponsor identity;\n-\tapplication service provider identity;\n-\tgate status;\n-\tUL maximum bit rate;\n-\tDL maximum bit rate;\n-\tredirect;\n-\tDL DSCP value;\n-\tTraffic steering policy identifier(s).\n4b.3.3\tOperations on ADC Rules\nFor dynamic ADC rules, the following operations are available:\n-\tInstallation: to provision an ADC rules that has not been already provisioned.\n-\tModification: to modify an ADC rule already installed.\n-\tRemoval: to remove an ADC rule already installed.\nFor predefined ADC rules, the following operations are available:\n-\tActivation: to allow the ADC rule being active.\n-\tDeactivation: to disallow the ADC rule.\nThe procedures to perform these operations are further described in clause 4b.5.\n4b.4\tFunctional elements\n4b.4.1\tPCRF\nThe PCRF (Policy Control and Charging Rules Function) is a functional element that encompasses policy control decision. The PCRF provides network control regarding the application detection, gating, bandwidth limitation, redirection and application based charging (except credit management) towards the TDF.\nThe PCRF may provision ADC Rules to the TDF via the Sd reference point.\nThe PCRF ADC Rule decisions may be based on one or more of the following:\n-\tInformation obtained from the PCEF via the Gx reference point, e.g. request type, subscriber/device related information, location information.\n-\tInformation obtained from the SPR via the Sp reference point, e.g. subscriber related data. The subscription information may include user profile configuration indicating whether application detection and control should be enabled.\nNOTE:\tThe details associated with the Sp reference point are not specified in this Release. The SPR's relation to existing subscriber databases is not specified in this Release.\n-\tInformation obtained from the TDF via the Sd reference point, e.g. detected application, usage monitoring report.\n-\tInformation obtained from the BBERF via the Gxx reference point.\n-\tInformation obtained from the AF via the Rx reference point, e.g. an AF application identifier.\n-\tOwn PCRF pre-configured information.\nThe PCRF shall inform the TDF through the use of ADC rules, if applicable, on the treatment of applications, in accordance with the PCRF policy decisions.\nIt is PCRF's responsibility to coordinate the PCC rules and QoS rules, if applicable, with ADC rules in order to ensure consistent service delivery.\nThe PCRF may use one or more pieces of information defined in the subclause as input for the selection of traffic steering policies used to control the steering of the subscriber's traffic to appropriate (S)Gi-LAN service functions.\n4b.4.2\tTDF\nThe TDF (Traffic Detection Function) is a functional entity that performs application's traffic detection and reporting of the detected application by using TDF application identifier and its TDF application instance identifier and its service data flow descriptions to the PCRF when service data flow descriptions are deducible. The TDF shall support solicited application reporting and/or unsolicited application reporting.\nNOTE 1:\tThe application detection filter can be pre-configured and/or extended with the PFDs by the PFDF as described in 3GPP TS 23.203 [7] and 3GPP TS 29.251 [62].\nThe TDF shall detect start and stop of the application traffic for the ADC rules that the PCRF has activated at the TDF (solicited application reporting) or which are pre-provisioned at the TDF (unsolicited application reporting). When the APPLICATION_START and APPLICATION_STOP event trigger are subscribed, the TDF shall report, unless the notification is muted for the specific ADC rule in case of solicited application reporting, to the PCRF:\n-\tFor the APPLICATION_START event trigger: the application identifier and, when service data flow descriptions are deducible, the application instance identifier and the service data flow descriptions to use for detecting that application traffic with a dynamic PCC rule.\n-\tFor the APPLICATION_STOP event trigger: the application identifier and if the application instance identifier was reported for the start, also the application instance identifier.\nFor the solicited application reporting, the TDF shall perform the following enforcement actions to the detected application traffic, if requested by PCRF:\n-\tGating;\n-\tRedirection;\n-\tBandwidth limitation.\nFor the solicited application reporting, in order to allow service data flow detection in the PCEF/BBERF in the downlink direction for applications with non-deducible service data flows detected by the TDF, if requested by the PCRF, the TDF shall perform marking of downlink packets of the detected application traffic, as specified in clause 4b.5.14.\nFor the solicited application reporting, the TDF shall support usage monitoring as specified in clauses 4b.5.6 and 4b.5.7.\nFor the solicited application reporting, the TDF shall support application based charging by having online and offline charging interactions.\nFor an application that is under charging control the TDF shall allow the application's traffic to pass through it if and only if, for online charging, the OCS has authorized the applicable credit with that Charging key. The TDF may let an application pass through it during the course of the credit re-authorization procedure.\nA TDF shall ensure that a detected application's traffic, which is discarded at the TDF as a result of ADC rule enforcement (e.g. gating), is neither reported for offline charging nor cause credit consumption for online charging.\nFor unsolicited application reporting, the TDF shall only perform application detection and reporting functionality.\nNOTE 2:\tFor unsolicited application reporting, the TDF does not perform enforcement actions, application based charging or usage monitoring.\nWhen the PCRF provides a traffic steering policy identifier(s) in an ADC rule, the TDF shall enforce the referenced traffic steering policy for the detected traffic.\nTo enforce the traffic steering policy, the TDF should perform deployment specific actions as configured for that traffic steering policy. The TDF may for example perform packet marking (e.g. mark the Type of service (ToS) field of the IP packet header) where, for the traffic identified by the application identifier or service data flow filter(s), the TDF provides information for traffic steering, as part of the packets, to the (S)Gi-LAN. This information for traffic steering identifies, explicitly or implicitly, a specific set of service functions and their order via which the traffic needs to be steered in the (S)Gi-LAN.\n4b.5\tADC procedures over Sd reference point for solicited application reporting\n4b.5.1\tProvisioning of ADC rules\n4b.5.1.1\tGeneral\nIf PCRF decides, based on subscriber's profile configuration, that the TDF session should be established with the TDF per corresponding IP-CAN session, during the IP-CAN session establishment or at any point of time when the PCRF decides that the session with TDF is to be established (e.g. subscriber profile changes), the PCRF shall indicate via the Sd reference point, the ADC rules to be applied at the TDF. The TDF-Information AVP shall be either received over Gx within initial CC-Request received from PCEF or pre-provisioned at PCRF. Each ADC rule shall include TDF-Application-Identifier AVP which references the corresponding application for which the rule applies.\nWhen establishing the session with the TDF, the PCRF shall send a TS-Request with the PDN information, if available, within the Called-Station-Id AVP, the UE Ipv4 address within the Framed-IP-Address and/or the UE Ipv6 prefix within the Framed-Ipv6-Prefix AVP. These parameters shall uniquely identify the session between the PCRF and the TDF. Additionally, if available (i.e. received from the PCEF or the BBERF), the PCRF may include the following information: the user identification within the Subscription-Id AVP, the type of IP-CAN within the IP-CAN-Type AVP, the type of the radio access technology within the RAT-Type AVP if applicable and AN-Trusted AVP if applicable, the device information within User-Equipment-Info AVP or User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported, the SGSN address within either 3GPP-SGSN-Address AVP or 3GPP-SGSN-Ipv6-Address AVP, the user location information within 3GPP-User-Location-Info or within 3GPP2-BSID, the Routing Area Identity within RAI AVP, the Ipv4 and/ or Ipv6 address(es) of the access node gateway (SGW for 3GPP and AGW for non-3GPP networks) in the AN-GW-Address AVPs, the MCC and the MNC of the SGSN/S-GW in the 3GPP-SGSN-MCC-MNC AVP, the UE time zone information within 3GPP-MS-TimeZone AVP, the presence reporting area identifier within the Presence-Reporting-Area-Information AVP, the charging characteristics within 3GPP-Charging-Characteristics AVP, control plane P-GW address(es) within 3GPP-GGSN-Address AVP and/or 3GPP-GGSN-Ipv6-Address AVP, 3GPP-Selection-Mode AVP indicating how the APN was selected, Dynamic-Address-Flag AVP and Dynamic-Address-Flag-Extension AVP defining whether IP address(es) where statically or dynamically allocated and PDN-Connection-Charging-ID AVP containing the charging identifier to identify different records belonging to the same PDN connection. For xDSL IP-CAN Type, the Logical-Access-ID AVP and the Physical-Access-ID AVP may be provided.\nNOTE:\tFor PDN type Ipv4v6, in case the UE Ipv4 address is not available in the PCRF , the PCRF initiates the TDF session establishment providing the UE Ipv6 prefix, and will subsequently provide UE Ipv4 address to the TDF using Event-Report-Indication AVP (as specified in clause 4b.5.8) to the TDF.\nThe ADC rules may be transferred to the TDF by using one of the following procedures:\n-\tPUSH procedure (Unsolicited provisioning): The PCRF may decide to provision ADC rules at TDF session establishment within TS-Request or at any point of time within active TDF session by using RA-Request. To provision ADC rules, the PCRF shall include those ADC rules in either TS-Request or RA-Request message; or\n-\tPULL procedure (Provisioning solicited by the TDF): In response to a request for ADC rules being made by the TDF, as described in the clause 4b.5.2, the PCRF shall provision ADC rules in the CC-Answer.\nFor each request from the TDF or upon the unsolicited provision, the PCRF shall provision zero or more ADC rules. The PCRF may perform an operation on a single ADC rule by one of the following means:\n-\tTo activate or deactivate an ADC rule that is predefined at the TDF, the PCRF shall provision a reference to this ADC rule within an ADC-Rule-Name AVP and indicate the required action by choosing either the ADC-Rule-Install AVP or the ADC-Rule-Remove AVP.\n-\tTo install or modify a PCRF-provisioned ADC rule, the PCRF shall provision a corresponding ADC-Rule-Definition AVP within an ADC-Rule-Install AVP.\n-\tTo remove an ADC rule which has previously been provisioned by the PCRF, the PCRF shall provision the name of this ADC rule as value of an ADC-Rule-Name AVP within an ADC-Rule-Remove AVP.\nAs an alternative to providing a single ADC rule, the PCRF may provide an ADC-Rule-Base-Name AVP within an ADC-Rule-Install AVP or the ADC-Rule-Remove AVP as a reference to a group of ADC rules predefined at the TDF. With an ADC-Rule-Install AVP, a predefined group of ADC rules is activated. With an ADC-Rule-Remove AVP, a predefined group of ADC rules is deactivated.\nThe PCRF may combine multiple of the above ADC rule operations in a single command.\nTo activate a predefined ADC rule at the TDF, the rule name within an ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Install AVP as a reference to the predefined rule. To activate a group of predefined ADC rules within the TDF, an ADC-Rule-Base-Name AVP shall be supplied within an ADC-Rule-Install AVP as a reference to the group of predefined ADC rules.\nTo install a new or modify an already installed PCRF defined ADC rule, the ADC-Rule-Definition AVP shall be used. If an ADC rule with the same rule name, as supplied in the ADC-Rule-Name AVP within the ADC-Rule-Definition AVP, already exists at the TDF, the new ADC rule shall update the currently installed rule. If the existing ADC rule already has attributes also included in the new ADC rule definition, the existing attributes shall be overwritten. Any attribute in the existing ADC rule not included in the new ADC rule definition shall remain valid.\nFor deactivating single predefined or removing PCRF-provided ADC rules, the ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Remove AVP. For deactivating a group of predefined ADC rules, the ADC-Rule-Base-Name AVP shall be supplied within an ADC-Rule-Remove AVP.\nThe TDF shall apply the ADC rules to the user plane traffic with the IP address(es) matching the UE Ipv4 address within the Framed-IP-Address and/or the UE Ipv6 prefix within the Framed-Ipv6-Prefix AVP received over Sd interface and report the detected application information via the corresponding TDF session.\nIf the provisioning of ADC rules fails, the TDF informs the PCRF as described in clause 4b.5.5 ADC Rule Error Handling. Depending on the cause, the PCRF may decide if re-installation, modification, removal of ADC rules or any other action applies.\n4b.5.1.2\tGate function\nThe Gate Function represents a user plane function enabling or disabling the forwarding of application's traffic. A gate is applicable to the detected application's traffic. The Flow-Status AVP of the ADC rule shall describe if the possible uplink and possible downlink gate for the detected application's traffic is opened or closed.\nThe commands to open or close the gate shall lead to the enabling or disabling of the passage for corresponding detected application's traffic uplink/downlink. If the corresponding uplink and/or downlink gate is closed, all packets belonging to the detected application's traffic uplink and/or downlink shall be dropped. If the corresponding uplink and/or downlink gate is opened, all packets belonging to the detected application's traffic uplink and/or downlink are allowed to be forwarded.\n4b.5.1.3\tBandwidth limitation function\nThe PCRF can provide the maximum allowed bit rate (QoS) for an ADC rule to the TDF. The Provisioning shall be performed using the ADC rule provisioning procedure. The allowed QoS shall be encoded using a QoS-Information AVP within the ADC-Rule-Definition AVP of the ADC rule. If QoS-Information is provided for an ADC rule, the TDF shall enforce the corresponding policy for the detected application's traffic. Only the Max-Requested-Bandwidth-UL AVP and the Max-Requested-Bandwidth-DL AVP or the Extended-Max-Requested-BW-UL AVP and the Extended-Max-Requested-BW-DL AVP (see subclause 4b.5.17) shall be used.\n4b.5.1.4\tRedirect function\nThe PCRF may provide the redirect instruction (e.g. redirect the detected application's traffic to another controlled address) for a dynamic ADC rule to the TDF. The Provisioning shall be performed using the ADC rule provisioning procedure. The redirect instruction shall be encoded using a Redirect-Information AVP within the ADC-Rule-Definition AVP of the dynamic ADC rule. If a dynamic ADC rule includes flow informations for UE IPv4 address and IPv6 prefix address related to the same application identifier and if ADC-Add-Redirection feature is supported, two Redirect-Information AVPs may be provided simultaneously as the redirect instruction for dual stack UE addresses.\nFor a dynamic ADC rule, the redirect address may be provided as part of the dynamic ADC rule or may be preconfigured in the TDF. A redirect destination provided within the Redirect-Server-Address AVP in a dynamic ADC Rule shall override the redirect destination preconfigured in the TDF for this ADC Rule.\nNOTE:\tThe TDF uses the preconfigured redirection address only if it can be applied to the application traffic being detected, e.g. the redirection destination address could be preconfigured on a per application identifier basis.\nIf Redirect-Information AVP is provided for a dynamic ADC rule, the TDF shall implement the redirection for the detected application's uplink traffic. If the Redirect-Server-Address AVP is provided within.the Redirect-Information AVP and the Redirect-Support AVP is not set to REDIRECTION_DISABLED, the TDF shall redirect the detected application's uplink traffic to this address. In this case, the redirect address type (e.g. Ipv4, Ipv6, URL) shall be defined by the Redirect-Address-Type AVP. If the Redirect-Server-Address AVP is not provided, the redirection address preconfigured in the TDF shall be used instead. .If the Redirect-Server-Address AVP is not provided and the redirection address is not preconfigured in the TDF for the ADC rule, the TDF shall perform ADC Rule Error Handling as specified in clause 4b.5.5.\nWhen the PCRF wants to disable the redirect function for an already installed ADC Rule, the PCRF shall update the ADC rule including the Redirect-Information AVP with Redirect-Support AVP set to REDIRECTION_DISABLED.\n4b.5.1.5\tUsage Monitoring Control\nUsage monitoring may be performed for application (s) associated with one or more ADC rules.\nThe provisioning of usage monitoring control per ADC rule shall be performed using the ADC rule provisioning procedure. For a dynamic ADC rule, the monitoring key shall be set using the Monitoring-Key AVP within the ADC-Rule-Definition AVP of the ADC rule. For a predefined ADC rule, the monitoring key shall be included in the rule definition at the TDF.\n4b.5.1.6\tMarking of downlink packets\nThe PCRF may provide the packet marking instruction (i.e. marking of downlink packets of the detected application traffic) for a dynamic ADC rule to the TDF. The provisioning shall be performed using the ADC rule provisioning procedure. The marking instruction shall be encoded using a ToS-Traffic-Class AVP within the ADC-Rule-Definition AVP of the dynamic ADC rule.\nIf the ToS-Traffic-Class AVP is provided, all downlink packets belonging to the detected application's traffic are marked with this value.\n4b.5.2\tRequest for ADC rules\nThe TDF shall indicate, via the Sd reference point, a request for ADC rules during the active TDF session established with PCRF, when a provisioned Event trigger is met. The TDF shall send a CC-Request with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\". Additionally, the TDF shall supply the specific event which caused the request (within the Event-Trigger AVP) and any previously provisioned affected ADC rule(s) The ADC rules and their status shall be supplied to PCRF within the ADC-Rule-Report AVP.\nADC rules can also be requested as a consequence of a failure in the ADC rule installation/activation or enforcement without requiring an Event-Trigger. For the additional information see clause 4b.5.5.\n4b.5.3\tProvisioning of Event Triggers\nThe PCRF may provide one or several event triggers within one or several Event-Trigger AVP to the TDF using the ADC rule provision procedure. Event triggers may be used to determine which event causes the TDF to inform PCRF once occur. Provisioning of event triggers from the PCRF to the TDF shall be done at TDF session level. The Event-Trigger AVP may be provided in combination with the initial or subsequent ADC rule provisioning in TSR, RAR or CCA message.\nThe PCRF may add new event triggers or remove the already provided ones. In order to do so, the PCRF shall provide the new complete list of applicable event triggers including the needed provisioned Event-Trigger AVPs in the CCA or RAR commands.\nThe PCRF may remove all previously provided event triggers by providing the Event-Trigger AVP set to the value NO_EVENT_TRIGGERS. When an Event-Trigger AVP is provided with this value, no other Event-Trigger AVP shall be provided in the CCA or RAR command. Upon reception of an Event-Trigger AVP with this value, the TDF shall not inform PCRF of any event.\nIf no Event-Trigger AVP is included in a CCA or RAR operation, any previously provisioned event trigger shall still be applicable.\nThere are event triggers that are required to be unconditionally reported from the TDF to the PCRF as specified in clause 5.3.7 even though the PCRF has not provisioned them to the TDF.\n4b.5.4\tRequest of TDF Session Termination\nWhen the corresponding IP-CAN session is terminated or at any point of time when the PCRF decides that the session with TDF is to be terminated (e.g. subscriber profile changes), the PCRF shall send a RAR command including the Session-Release-Cause AVP to the TDF. The TDF shall acknowledge the command by sending a RAA command to the PCRF and instantly remove/deactivate all the ADC rules that have been previously installed or activated on that TDF session.\nThe TDF shall send a CC-Request with CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\" to PCRF to terminate the TDF session.\nWhen the PCRF receives the CC-Request, it shall acknowledge this message by sending a CC-Answer to the TDF.\nNOTE 1:\tAccording to DCC procedures, the Diameter Credit Control session is being terminated with this message exchange, as specified in IETF RFC 8506 [66].\nSignalling flows for the TDF session termination are presented in 3GPP TS 29.213 [8].\n4b.5.5\tADC Rule Error Handling\nIf the installation/activation of one or more ADC rules fails, the TDF shall include one or more ADC-Rule-Report AVP(s) in either a TSA, a CCR or an RAA command as described below for the affected ADC rules. Within each ADC-Rule-Report AVP, the TDF shall identify the failed ADC rule(s) by including the ADC-Rule-Name AVP(s) or ADC-Rule-Base-Name AVP(s), shall identify the failed reason code by including a Rule-Failure-Code AVP, and shall include the PCC-Rule-Status AVP as described below:\n-\tIf the installation/activation of one or more ADC rules fails using a PUSH mode (i.e., the PCRF installs/activates a rule using TSR or RAR command), the TDF shall communicate the failure to the PCRF in the corresponding TSA/RAA response.\n-\tIf the installation/activation of one or more ADC rules fails using a PULL mode (i.e., the PCRF installs/activates a rule using a CCA command), the TDF shall send the PCRF a new CCR command and include the Rule-Failure-Code AVP.\nIf the installation/activation of one or more new ADC rules (i.e., rules which were not previously successfully installed) fails, the TDF shall set the PCC-Rule-Status to INACTIVE for both the PUSH and the PULL modes.\nIf the modification of a currently active ADC rule using PUSH mode fails, the TDF shall retain the existing ADC rule as active without any modification unless the reason for the failure has an impact also on the existing ADC rule. The TDF shall report the modification failure to the PCRF using the TSA/RAA command.\nIf the modification of a currently active ADC rule using PULL mode fails, the TDF shall retain the existing ADC rule as active without any modification unless the reason for the failure has an impact also on the existing ADC rule. The TDF shall report the modification failure to the PCRF using the CCR command.\nDepending on the value of the Rule-Failure-Code for PULL and PUSH mode, the PCRF may decide whether retaining of the old ADC rule, re-installation, modification, removal of the ADC rule or any other action applies.\nIf an ADC rule was successfully installed/activated, but can no longer be enforced by the TDF, the TDF shall send the PCRF a new CCR command and include an ADC-Rule-Report AVP. The TDF shall include the Rule-Failure-Code AVP within the ADC-Rule-Report AVP and shall set the PCC-Rule-Status to INACTIVE.\n4b.5.6\tRequesting Usage Monitoring Control\nThe PCRF may indicate, via the Sd reference point, the need to apply monitoring control for the accumulated usage of network resources on a per TDF session basis. Usage is defined as volume or time of user plane traffic. Monitoring for volume usage and time usage can be performed in parallel. The data collection for usage monitoring control shall be performed per monitoring key, which may apply to one application (i.e. the monitoring key is used by a single ADC rule), or to several applications (i.e., the monitoring key is used by many ADC rules), or all detected traffic belonging to a specific TDF session. If the usage monitoring of a TDF session level is enabled, the PCRF may request the TDF to exclude one application or several applications from the usage monitoring of the TDF session level.\nIf the PCRF requests usage monitoring control and if at this time, the PCRF is not subscribed to the \"USAGE_REPORT\" Event-Trigger, the PCRF shall include the Event-Trigger AVP, set to the value \"USAGE_REPORT\", in a TS-Request, CC-Answer or RA-Request.\nAt TDF session establishment and modification, the PCRF may provide the applicable thresholds, volume threshold, time threshold or both volume threshold and time threshold, for usage monitoring control to the TDF, together with the respective monitoring keys. To provide the initial threshold for one or more monitoring key(s), the PCRF may include the threshold in either TSR, RAR or in the response of a CCR, initiated by the TDF.\nDuring the IP-CAN session establishment, the PCRF may receive information about total allowed usage per PDN and UE from the SPR, i.e. the overall amount of allowed traffic volume and/or time of usage that are to be monitored per PDN and UE and/or total allowed usage for Monitoring key(s) per PDN and UE and should use it when making a decisions about usage monitoring control.\nIn order to provide the applicable threshold for usage monitoring control, the PCRF shall include a Usage-Monitoring-Information AVP per monitoring key. The threshold level shall be provided in its Granted-Service-Unit AVP. Threshold levels may be defined for:\n-\tthe total volume only; or\n-\tthe uplink volume only; or\n-\tthe downlink volume only; or\n-\tthe uplink and downlink volume; or\n-\tthe time.\nThe PCRF shall provide the applicable volume threshold(s) in the CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs and/or time threshold in the CC-Time AVP of the Granted-Service-Unit AVP. The monitoring key shall be provided in the Monitoring-Key AVP. The PCRF may provide multiple usage monitoring control instances. The PCRF shall indicate if the usage monitoring instance applies to the TDF session or to one or more ADC rules. For this purpose, the Usage-Monitoring-Level AVP may be provided with a value respectively set to SESSION_LEVEL or ADC_RULE_LEVEL. The PCRF may provide one usage monitoring control instance applicable at TDF session level and one or more usage monitoring instances applicable at ADC Rule level. If the TDF session level usage monitoring is enabled and if the application(s) need to be excluded from TDF session level usage monitoring, the PCRF shall provide an indication of exclusion from session level monitoring associated with the respective ADC rule(s) by including the Monitoring-Flags AVP with the bit 0 set in the corresponding ADC-Rule-Install AVP when the PCRF installs or updates the ADC rule(s). If the exclusion is enabled, the PCRF may disable the exclusion again by including the Monitoring-Flags AVP with the bit 0 not set in the corresponding ADC-Rule-Install AVP.\nThe PCRF may provide a Monitoring-Time AVP to the TDF for the monitoring keys(s) in order to receive reports for the accumulated usage before and after the monitoring time occurs within the report triggered by the events defined in 4b.5.7.2-4b.5.7.6. In such a case, there may be two instances of Granted-Service-Unit AVP within Usage-Monitoring-Information AVP per monitoring key. One of them indicates the threshold levels before the monitoring time occurs, and the other one, which includes Monitoring-Time AVP, indicates the subsequent threshold levels after the monitoring time occurs.The detailed functionality in such a case is defined by 4b.5.7.7.\nIf the PCRF wishes to modify the threshold level for one or more monitoring keys, the PCRF shall provide the thresholds for all the different levels applicable to the corresponding monitoring key(s).\nIf the PCRF wishes to modify the monitoring key for the TDF session level usage monitoring instance, it shall disable the existing session level monitoring usage instance following the procedures defined in 4b.5.7.4 and shall provide a new TDF session level usage monitoring instance following the procedures defined in this clause. The PCRF may enable the new TDF session level usage monitoring instance and disable the existing TDF session level usage monitoring instance in the same command.\nWhen the accumulated usage is reported in a CCR command, the PCRF shall indicate to the TDF if usage monitoring shall continue for that TDF session, usage monitoring key, or both as follows:\n-\tIf monitoring shall continue for specific level(s), the PCRF shall provide the new thresholds for the level(s) in the CC-Answer using the same AVP as before (CC-Total-Octets, CC-Input-Octets, CC-Output-Octets or CC-Time AVPs within the Granted-Service-Unit AVP);\n-\totherwise, if the PCRF wishes to stop monitoring for specific level(s) the PCRF shall not include an updated threshold in the CCA command for the stopped level(s) i.e. the corresponding CC-Total-Octets, CC-Input-Octets, CC-Output-Octets or CC-Time AVPs shall not be included within Granted-Service-Units AVP.\nIf both volume and time thresholds were provided and the threshold for one of the measurements is reached, the TDF shall report this event to the PCRF and the accumulated usage since last report shall be reported for both measurements.\nWhen usage monitoring is enabled, the PCRF may request the TDF to report accumulated usage for all enabled monitoring or selected monitoring keys regardless if a usage threshold has been reached by sending to the TDF within the Usage-Monitoring-Information AVP the Usage-Monitoring-Report AVP set to the value USAGE_MONITORING_REPORT_REQUIRED. The PCRF shall only require TDF to report accumulated usage for one or more monitoring keys in a CC-Answer when the TDF has not provided accumulated usage in the CC-Request for the same monitoring key(s).\nTo specify the usage monitoring key for which usage is requested, the PCRF shall include the usage monitoring key within the Monitoring-Key AVP within the Usage-Monitoring-Information AVP. To request usage be reported for all enabled usage monitoring keys, the PCRF shall omit the Monitoring-Key.\nThe PCRF shall process the usage reports and shall perform the actions as appropriate for each report.\n4b.5.7\tReporting Accumulated Usage\n4b.5.7.1\tGeneral\nWhen usage monitoring is enabled, the TDF shall measure the volume and/or the time of usage of the TDF session or the volume and/or the time of usage of the particular application (s). The TDF shall be able to support volume and time measurements simultaneously for a given application(s). If the ADC rule is installed or updated with the Monitoring-Flags AVP with the bit 0 set, the TDF shall not include the corresponding application in the volume and/or time measurement on TDF session level.\nWhen the time based usage monitoring is supported, the PCRF may optionally indicate to the TDF, along with other usage monitoring information provided, the Inactivity Detection Time within the Quota-Consumption-Time AVP. This value represents the time interval after which the time measurement shall stop for the Monitoring Key, if no packets are received belonging to the corresponding Monitoring Key. Time measurement shall resume again on receipt of a further packet belonging to the Monitoring Key.\nTime measurement for a Monitoring key shall also be stopped when time based usage monitoring is disabled, if this happens before the Inactivity Detection Time is reached.\nIf an Inactivity Detection Time value of zero is provided, or if no Inactivity Detection Time is present within the usage monitoring information provided by the PCRF, the time measurement shall be performed continuously from the point at the first packet is received matching the applicable Monitoring Key and until time based usage monitoring is disabled.\nThe TDF shall report accumulated usage to the PCRF in the following conditions:\n-\twhen a usage threshold is reached;\n-\twhen all ADC rules for which usage monitoring is enabled for a particular usage monitoring key are removed or deactivated;\n-\twhen usage monitoring is explicitly disabled by the PCRF;\n-\twhen a TDF session is terminated;\n-\twhen requested by the PCRF.\nTo report accumulated usage for a specific monitoring key, the TDF shall send a CC-Request with the Usage-Monitoring-Information AVP including the accumulated usage since the last report. The Usage-Monitoring-Information AVP shall include the monitoring key in the Monitoring-Key AVP and the accumulated volume usage in the Used-Service-Unit AVP. Accumulated volume reporting shall be done for the total volume, the uplink volume or the downlink volume as requested by the PCRF, and set in CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of Used-Service-Unit AVP respectively. Accumulated time reporting shall be set in the CC-Time AVP of Used-Service-Unit AVP. The TDF shall continue to perform volume measurement after the report until instructed by the PCRF to stop the monitoring. If both volume and time measurements are requested by the PCRF and the threshold for one of the measurements is reached, the TDF shall report this event to the PCRF and the accumulated usage since last report shall be reported for both measurements.\nIn case a Monitoring-Time AVP was provided by the PCRF within one instance of the Granted-Service-Unit AVP included within the Usage-Monitoring-Information AVP for the usage monitoring control request, the PCEF shall report as defined in 4b.5.7.7.\nFor cases, where the PCRF indicates in a CC-Answer command whether the usage monitoring shall continue as a response to the reporting of accumulated usage in a CCR command, the TDF shall behave as follows:\n-\tif the PCRF provisions an updated usage threshold in the CCA command, the monitoring continues using the updated threshold value provisioned by the PCRF;\n-\totherwise, if the PCRF does not include an updated usage threshold in the CCA command, the TDF shall not continue usage monitoring for that TDF session, usage monitoring key, or both as applicable.\nNOTE:\tWhen the PCRF indicates that usage monitoring shall not continue in the CCA, the TDF does not report usage which has accumulated between sending the CCR and receiving the CCA.\nUpon receiving the reported usage from the TDF, the PCRF shall deduct the value of the usage report from the total allowed usage for that IP-CAN session, usage monitoring key, or both as applicable, and the PCRF may also derive the ADC rules based on the remaining allowed usage or reported usage and provision them to the TDF.\nAdditional procedures for each of the scenarios above are described in the following clauses of 4b.5.7.\n4b.5.7.2\tUsage Threshold Reached\nWhen usage monitoring is enabled for a particular monitoring key, the TDF shall measure the volume and/or the time of usage of all traffic for the TDF session or the corresponding application (s) and notify the PCRF when a usage threshold for that monitoring key is reached and report the accumulated usage for that monitoring key and include the \"USAGE_REPORT\" Event-Trigger in a CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" by following the procedures to report accumulated usage defined in clause 4b.5.7.1.\n4b.5.7.3\tADC Rule Removal\nWhen the PCRF removes or deactivates the last ADC rule associated with a usage monitoring key in an RAR or CCA command in response to a CCR command not related to reporting usage for the same monitoring key, the TDF shall send a new CCR command with the CC-Request-Type set to the value \"UPDATE_REQUEST\" including the Event-Trigger set to \"USAGE_REPORT\" to report accumulated usage for the usage monitoring key within the Usage-Monitoring-Information AVP using the procedures to report accumulated usage defined in clause 4b.5.7.1.\nWhen the TDF reports that the last ADC rule associated with a usage monitoring key is inactive, the TDF shall report the accumulated usage for that monitoring key within the same CCR command if the ADC-Rule-Report AVP was included in a CCR command; otherwise, if the ADC-Rule-Report AVP was included in an RAA command, the TDF shall send a new CCR command to report accumulated usage for the usage monitoring key.\n4b.5.7.4\tUsage Monitoring Disabled\nOnce enabled, the PCRF may explicitly disable usage monitoring as a result of receiving a CCR from the TDF which is not related to reporting usage, but related to other external triggers (e.g. subscriber profile update), or a PCRF internal trigger. When the PCRF disables usage monitoring, the TDF shall report the accumulated usage which has occurred while usage monitoring was enabled since the last report.\nTo disable usage monitoring for a monitoring key, the PCRF shall send the Usage-Monitoring-Information AVP including only the applicable monitoring key within the Monitoring-Key AVP and the Usage-Monitoring-Support AVP set to USAGE_MONITORING_DISABLED.\nWhen the PCRF disables usage monitoring in a RAR or CCA command, the TDF shall send a new CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" and the Event-Trigger AVP set to \"USAGE_REPORT\" to report accumulated usage for the disabled usage monitoring key(s).\n4b.5.7.5\tTDF Session Termination\nAt TDF session termination, the TDF shall send the accumulated usage information for all monitoring keys for which usage monitoring is enabled in the CCR command with the CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\" using the procedures to report accumulated usage defined in clause 4b.5.7.1.\n4b.5.7.6\tPCRF Requested Usage Report\nWhen the TDF receives the Usage-Monitoring-Information AVP including the Usage-Monitoring-Report AVP set to the value USAGE_MONITORING_REPORT_REQUIRED, the TDF shall send a new CCR command with CC-Request Type AVP set to the value \"UPDATE_REQUEST\" and the Event-Trigger AVP set to \"USAGE_REPORT\" to report accumulated usage for the monitoring key received in the Usage-Monitoring-Information AVP using the procedures to report accumulated usage defined in clause 4b.5.7, e.g. if the volume threshold and time threshold were provided, the TDF shall report the volume usage and time of usage. If the Monitoring-Key AVP was omitted in the received Usage-Monitoring-Information AVP, the TDF shall send the accumulated usage for all the monitoring keys that were enabled at the time the Usage-Monitoring-Information was received.\n4b.5.7.7\tReport in case of Monitoring Time provided\nIf Monitoring-Time AVP was provided within one instance of the Granted-Service-Unit AVP included within the Usage-Monitoring-Information AVP by the PCRF, and if the TDF needs to report the accumulated usage when one of the events defined in subclauses 4b.5.7.2-4b.5.7.6 occurs before the monitoring time, the PCEF shall report the accumulated usage as defined subclauses 4b.5.7.2-4b.5.7.6 and the TDF shall not retain the monitoring time; otherwise,\n-\tIf two instances of the Granted-Service-Unit AVP are provided by the PCRF, then the TDF shall, at the monitoring time, reset the usage threshold to the value of the Granted-Service-Unit AVP with the Monitoring-Time AVP.\n-\tIf only one instance of the Granted-Service-Unit AVP is provided by the PCRF, then the TDF shall, at the monitoring time, reset the usage threshold to the remaining value of the Granted-Service-Unit AVP previously sent by the PCRF (i.e. excluding the accumulated volume and/or time usage).\n-\tFor both cases, the usage report from the TDF shall include two instances of the Used-Service-Unit AVP, one of them to indicate the usage before the monitoring time and the other one accompanied by the Monitoring-Time AVP under the same Used-Service-Unit AVP to indicate the usage after the monitoring time.\nWhen PCRF receives the accumulated usage report in a CCR command, the PCRF shall indicate to the TDF if usage monitoring shall continue as defined in clause 4b.5.6. The PCRF may provide the Monitoring-Time AVP again within one instance of the Granted-Service-Unit AVP if reports for the accumulated usage before and after the provided monitoring time are required.\n4b.5.8\tProvisioning of Event Report Indication\nThe TDF may request from the PCRF to be informed about specific changes occurred in the location information/access network information in either a TSA, a CCR or an RAA command. In this case, the PCRF shall subscribe to the appropriate event triggers in the PCEF according to clause 4.5.3 or in the BBERF according to clause 4a.5.8.\nNOTE 1: In case the IP flow mobility feature is enabled, the TDF doesn't have accurate information about the location and the type of RAT the user is attached to.\nAfter receiving the reply of the event subscription from the PCEF or the BBERF, the PCRF shall send the event related information to the TDF by using a RAR command.\nWhen PCRF is notified that an event is triggered in the PCEF or the BBERF, if the TDF has previously requested to be informed of the specific event, the PCRF shall notify the TDF about the event occurred together with additional related information (i.e. the parameter value). This notification shall be done by using the Event-Report-Indication AVP. There may be neither ADC Rule provisioning nor Event Trigger provisioning together with event report indication in this message.\nWhen PCRF is notified by PCEF that either an UE_IP_ADDRESS_ALLOCATE or an UE_IP_ADDRESS_RELEASE event of the IP-CAN session occurs in the PCEF, the PCRF shall notify the TDF about the event for the corresponding TDF session. The Framed-IP-Address AVP shall also be provided. This notification shall also be done by using the Event-Report-Indication AVP within a RAR command. There may be neither ADC Rules nor Event Triggers in this message. If the PCRF notifies of the new UE Ipv4 address to the TDF, the TDF shall additionally apply the ADC rules to the user plane traffic with the IP address matching the new UE Ipv4 address and report the detected application information via the corresponding TDF session. If the PCRF notifies to the TDF that the UE Ipv4 address has been released, the TDF shall stop applying the ADC rule to the user plane traffic with IP address matching the released UE Ipv4 address.\nNOTE 2:\tThe TDF does not need to subscribe the notification of the UE_IP_ADDRESS_ALLOCATE and UE_IP_ADDRESS_RELEASE.\nWhenever the TDF subscribes to an event report indication by using the TSA, CCR or RAA command, the PCRF shall only send the corresponding currently applicable values which have been updated (e.g. 3GPP-User-Location-Info, 3GPP2-BSID, etc.) to the TDF in the RAR or CCA if available. In this case, the Event-Trigger AVPs shall not be included.\nNOTE 3:\tThe PCRF can get the currently applicable values during the IP-CAN session establishment procedure or during the information reporting from the BBERF when the BBERF gets event subscription from the PCRF as defined in clause 5.3.7.\n4b.5.9\tApplication Detection Information\nFor the solicited application reporting, the PCRF may instruct the TDF to detect application (s) by providing the ADC-Rule-Install AVP (s) with the corresponding parameters as follows: the application to be detected is identified by the TDF-Application-Identifier AVP, which is either provided under ADC-Rule-Definition AVP for dynamic ADC Rules or pre-provisioned for the corresponding predefined ADC Rule, and in such a case only ADC-Rule-Name/ADC-Rule-Base-Name is provided . If the PCRF requires to be reported about when the application start/stop is detected, it shall also subscribe to the APPLICATION_START and APPLICATION_STOP Event-Triggers. The PCRF may also mute such a notification about a specific detected application by providing Mute-Notification within the corresponding ADC-Rule-Definition AVP.\nWhen the start or stop of the application's traffic, identified by TDF-Application-Identifier, is detected, if PCRF has previously subscribed to the APPLICATION_START/APPLICATION_STOP Event-Triggers, unless a request to mute such a notification (Mute-Notification AVP ) is part of the corresponding ADC-Rule-Definition AVP, the TDF shall report the information regarding the detected application's traffic in the Application-Detection-Information AVP in the CCR command even if the application traffic is discarded due to enforcement actions of the ADC rule.\nThe corresponding TDF-Application-Identifier AVP shall be included under Application-Detection-Information AVP. When the Event trigger indicates APPLICATION_START, the Flow-Information AVP for the detected application may be included under Application-Detection-Information AVP, if deducible. The Flow-Information AVP, if present, shall contain the Flow-Description AVP and Flow-Direction AVP. The TDF-Application-Instance-Identifier, which is dynamically assigned by the TDF in order to allow correlation of APPLICATION_START and APPLICATION_STOP Event-Triggers to the specific Flow-Information AVP, if service data flow descriptions are deducible, shall also be provided. Also, the corresponding Event-Trigger (APPLICATION_START or APPLICATION_STOP) shall be provided to PCRF. When the TDF-Application-Instance-Identifier is provided along with the APPLICATION_START, it shall also be provided along with the corresponding APPLICATION_STOP. The PCRF then may make the policy decision based on the information received and send the updated PCC rules to the PCEF, updated QoS rules to the BBERF, if applicable, and the updated ADC rules to the TDF.\nWhen a PFD provisioned by the PFDF is removed/modified and the removed/modified PFD was used to detect application traffic related to an application identifier in an ADC Rule installed or activated for an TDF session, if the removed/modified PFD in TDF results in that the stop of an application or an application instance is not able to be detected, and if the TDF has reported the application start as described in this subclause to the PCRF for the application or application instance represented by this PFD, the TDF shall report the application stop to the PCRF for the corresponding application or the corresponding application instance.\nNOTE:\tMultiple PFDs can be associated with the application identifier. When the removed/modified PFD is the last one which is used to detect traffic identified by TDF-Application-Identifier AVP, the TDF reports application stop.\n4b.5.10\tTime of the day procedures\nTDF shall be able to perform ADC rule request based on time as instructed by the PCRF in a TSR, CCA or a RAR commands. To do so, the PCRF shall provide the Event-Trigger AVP with the value REVALIDATION_TIMEOUT (17) if the event trigger is not previously set, and in addition the Revalidation-Time, when set by the PCRF. This shall cause the TDF to trigger a PCRF interaction to request ADC rules from the PCRF for an established TDF session. The TDF shall stop the timer once the TDF triggers an REVALIDATION_TIMEOUT event.\nPCRF shall be able to provide a new value for the revalidation timeout by including Revalidation-Time in CCA or RAR. The PCRF may provide the Revalidation-Time AVP together with the event trigger REVALIDATION_TIMEOUT or in a subsequent ADC rule provisioning.\nPCRF shall be able to stop the ADC revalidation timer by disabling the REVALIDATION_TIMEOUT event trigger.\nNOTE 1:\tBy disabling the REVALIDATION_TIMEOUT the revalidation time value previously provided to the TDF is not applicable anymore.\nThe PCRF may control at what time the status of an ADC rule changes.\n1)\tIf Rule-Activation-Time is specified only and has not yet occurred, then the TDF shall set the ADC rule inactive and make it active at that time. If Rule-Activation-Time has passed, then the TDF shall immediately set the ADC rule active.\n2)\tIf Rule-Deactivation-Time is specified only and has not yet occurred, then the TDF shall set the ADC rule active and make it inactive at that time. If Rule-Deactivation-Time has passed, then the TDF shall immediately set the ADC rule inactive.\n3)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, and also when the ADC rule is provided before or at the time specified in the Rule-Deactivation-Time, the TDF shall handle the rule as defined in 1) and then as defined in 2),\n4)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, and also when the ADC rule is provided before or at the time specified in the Rule-Activation-Time., the TDF shall handle the rule as defined in 2) and then as defined in 1),\n5)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has passed for both, and the Rule-Activation-Time occurs before the Rule-Deactivation-Time, then the TDF shall immediately set the ADC rule inactive.\n6)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified but time has passed for both, and the Rule-Deactivation-Time occurs before the Rule-Activation-Time, then the PCEF shall immediately set the ADC rule active.\n7)\tIf both Rule-Activation-Time and Rule-Deactivation-Time are specified with the same time, the PCEF shall report a PCC rule error for the concerned PCC rule, as specified in subclause 4b.5.5, with the Rule-Failure-Code set the value \"SAME_TIME_ERROR\".\nADC Rule Activation or Deactivation shall not generate any CCR commands with ADC-Rule-Report since PCRF is already aware of the state of the rules.\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified in the ADC-Rule-Install, then it shall replace the previously set values for the specified ADC rules.\nIf Rule-Activation-Time AVP, Rule-Deactivation-Time AVP or both AVPs are omitted, then any previous value for the omitted AVP is no longer valid.\nThe 3GPP-MS-TimeZone AVP, if available, may be used by the PCRF and by the TDF to derive the Rule-Activation-Time and Rule-Deactivation-Time.\n4b.5.11\tPCRF Failure and Restoration\nIf the TDF needs to send a TDF Session update request (e.g. following usage threshold reached) towards a PCRF which is known to have restarted since the TDF Session establishment, the TDF should not send the TDF Session update request towards a PCRF, and the TDF may clean up the TDF session related information.\nNOTE 1:\tThis mechanism in the TDF removes all application traffic control on the PDN connection and has no effect on the state of the PDN connection. It is expected that the PCEF will perform the same detection and clean up of PDN connections affected by the PCRF failure and restoration\nNOTE 2:\tThe method the TDF uses to determine that a PCRF has restarted is not specified in this release.\n4b.5.12\tBandwidth limitation function\nThe PCRF may provide the maximum allowed bit rate (QoS) to the TDF.\nThe maximum allowed bit rate (QoS) shall be provisioned within a TSR, CCA or RAR Diameter message as QoS-Information AVP. Only the Max-Requested-Bandwidth-UL AVP and the Max-Requested-Bandwidth-DL AVP or the Extended-Max-Requested-BW-UL AVP and the Extended-Max-Requested-BW-DL AVP (see subclause 4b.5.17) shall be used. The maximum allowed bit rate (QoS) can refer to a detected application's traffic or to a TDF session.\n-\tWhen the maximum allowed bit rate (QoS) applies to a detected application's traffic, see clause 4b.5.1.3.\n-\tWhen the maximum allowed bit rate (QoS) applies to a TDF session, the provisioning is done outside an ADC-Rule-Definition AVP at command level. The allowed QoS shall be encoded using a QoS-Information AVP. Only the Max-Requested-Bandwidth-UL AVP and the Max-Requested-Bandwidth-DL AVP or the Extended-Max-Requested-BW-UL AVP and the Extended-Max-Requested-BW-DL AVP  (see subclause 4b.5.17) shall be used. If QoS-Information is provided at command level, the TDF shall enforce the corresponding policy for the TDF session.\nNOTE:\tIn case the maximum allowed bit rate (QoS) applies to a TDF session, in order to avoid down-link packets being discarded in PCEF when TDF performs charging, the PCRF has to set the Maximum downlink bit rate to the DL APN-AMBR.\n4b.5.13\tProvisioning of charging related information for the TDF session\n4b.5.13.1\tProvisioning of Charging Addresses\nIn combination with the initial ADC rule provisioning only, the PCRF may provide OFCS and/or OCS addresses within a Charging-Information AVP to the TDF within the TSR command defining the offline and online charging system addresses respectively. These shall overwrite any predefined addresses at the TDF. Both primary and secondary addresses for OFCS and/or OCS shall be provided simultaneously. Provisioning of OFCS and/or OCS addresses without ADC rules for offline or online charged applications, respectively, shall not be considered as an error since such ADC rules may be provided in later provisioning.\nIf no OCS address is available at the TDF (i.e. no predefined OCS addresses, and no OCS addresses supplied by the PCRF), the TDF shall use the IMSI (MNC and MCC values) of the user to construct the OCS Home network domain name as specified in 3GPP TS 23.003 [25], clause 25.\n4b.5.13.2\tProvisioning of Default Charging Method\nThe default charging method indicates what charging method shall be used for every ADC rule where the charging method is omitted. The TDF may have a pre-configured Default charging method.\nUpon the initial interaction with the TDF, the PCRF may provide default charging method within the Online AVP or Offline AVP embedded directly within the TSR command to the TDF. The default charging method provided by the PCRF shall overwrite any predefined default charging method at the TDF.\n4b.5.13.3\tProvisioning of Charging Characteristics\nUpon the initial interaction with the TDF, if Charging Characteristics are received from the PCEF and charging is applicable to the TDF, the PCRF shall provide Charging Characteristics within 3GPP‑Charging‑Characteristics AVP within the TSR command to the TDF. In addition, if Charging Characteristics are received by the PCRF from the PCEF, the PCRF may take them into account to also provide Charging‑Information AVP, Online AVP and Offline AVP to the TDF.\nIn case the TDF receives 3GPP‑Charging‑Characteristics AVP in addition to Charging‑Information AVP, Online AVP and/or Offline AVP, then the Charging‑Information AVP, Online AVP or Offline AVP shall supersede the values determined from the received  3GPP-Charging-Characteristics AVP.\n4b.5.14\tDownlink packet marking by the TDF\nFor the solicited application reporting, typically for applications with non-deducible service data flows, the PCRF may instruct the TDF to detect application(s) and to mark the detected application traffic in the downlink direction with DSCP value by providing DL DSCP value encoded by ToS-Traffic-Class AVP within the ADC-Rule-Definition AVP.\nNOTE 1:\tUnless a class of applications matches the definition of a DSCP value standardised by IETF, DSCP values with no standardised meaning in IETF are used. DSCP values in ranges reserved by IANA for \"experimental or Local Use\" are suitable.\nNOTE 2:\tUsing DSCP values with no standardised meaning in IETF prevents any IP router between TDF and PCEF to perform differentiated service scheduling for related IP packets unless it is updated or configured to support those DSCP values. This implies that sufficient network capacity need to be guaranteed along the path between the TDF and PCEF so that the disabling of DiffServ packet forwarding has no detrimental impact on the end-to-end QoS.\nNOTE 3:\tMarking of DSCP bits for this purpose can interfere with appropriate traffic handling in some operator transport networks. The DSCP marking can also get remarked by routing entities within the operator networks.\nNOTE 4:\tIf the application sets DSCP marking that is used for policy and charging control in the PCEF, either no ADC Rule is installed in the TDF matching this application traffic or if an ADC Rule is installed, then DSCP marking is not enabled. When TDF sets DSCP to values used for policy and charging control, network configuration needs to prevent an untrusted source from getting unplanned QoS and charging and also prevent remapping of this traffic between the application and the TDF.\nIn order to ensure that the DL DSCP value used for service data flow detection is not visible to the operator's transport network, based on operator configuration, a tunnelling protocol may be used between the TDF and the PCEF. In case tunnelling is used, the DL DSCP value encoded with the received ToS-Traffic-Class AVP shall be carried in the inner IP header. The DSCP value used in the operator's transport network is carried in the outer IP header of the tunnel.\nNOTE 5:\tThe tunnel connections are preconfigured in the IP infrastructure connecting the TDF and the PCEF. The operator needs to ensure the same tunnel configuration is used for the TDF and for the PCEF. The tunnel protocol can be any applicable IP-based tunnel depending on operator´s choice.\n4b.5.15\tTraffic steering control support\nThis procedure takes place if the TSC feature as defined in subclause 5 b.4.1 is supported.\nThe PCRF may instruct the TDF to apply a traffic steering control which consists of applying a specific (S)Gi-LAN traffic steering policy for the traffic detected based on application level information or service data flow level information. The PCRF achieves this by providing the ADC-Rule-Definition AVP within the ADC-Rule-Install AVP (s) with the corresponding parameters as follows:\n-\teither the application to be detected is identified by the TDF-Application-Identifier AVP or\n-\tthe service data flow to be detected is identified by the Flow-Information AVP(s)\n-\tand the traffic steering policy identifier(s) within the Traffic-Steering-Policy-Identifier-DL AVP and/or Traffic-Steering-Policy-Identifier-UL AVP.\nThe PCRF may also provision the traffic steering control information by activating the pre-defined ADC rule(s) in the TDF.\nWhen a combination of TDF with traffic steering control feature and TSSF is deployed, the TDF shall behave as specified in subclause 6.1.17 of 3GPP TS 23.203 [7]. In this case, the PCRF shall include the packet marking information within the Traffic-Steering-Policy-Identifier-DL AVP and/or Traffic-Steering-Policy-Identifier-UL AVP included within the ADC-Rule-Definition AVP. The PCRF shall ensure that the value included in these AVP(s) is aligned with the traffic detection information provided over the St reference point. That is, it shall ensure that the value is the same as the applicable value provided as part of the service data flow information  or as the value(s) configured in the TSSF referred by the application identifier. See subclause 4c.4.1 in this Technical Specification for the details in the Diameter based St reference point. See 3GPP TS 29.155 [52] for the details in the REST based St reference point.\nNOTE:\tThe PCRF and the TDF are configured with the packet marking and forwarding mechanism to be applied in the TDF. This information will be aligned with the information configured in the TSSF for traffic detection. The flow information provided over St reference point can be used for traffic detection at the TSSF when the TDF is configured to do packet marking and forwarding using e.g. ToS value in the IP header. The Application Identifier provided over St reference point can be used when the TDF is configured to do packet marking and forwarding using e.g. GRE or NSH.\n4b.5.16\tSponsored Data Connectivity\nSponsored data connectivity may be performed for service data flows associated with one or more ADC rules if the information about the sponsor, the application service provider and optionally the threshold values are provided by the AF and if the AF has not indicated to disable/not enable sponsored data connectivity as described in 3GPP TS 29.214 [10] subclauses 4.4.1 and 4.4.2.\nThe provisioning of sponsored data connectivity per ADC rule shall be performed using the ADC rule provisioning procedure. The sponsor identity shall be set using the Sponsor-Identity AVP within the ADC-Rule-Definition AVP of the ADC rule. The application service provider identity shall be set using the Application-Service-Provider-Identity AVP within the ADC-Rule-Definition AVP of the ADC rule. Sponsor-Identity AVP and Application-Service-Provider-Identity AVP shall be included if the Reporting-Level AVP is set to the value SPONSORED_CONNECTIVITY_LEVEL.\nWhen receiving the usage thresholds from the AF, the PCRF shall use the sponsor identity to generate a monitoring key and request usage monitoring control for the monitoring key by following the procedures specified in subclauses 4b.5.1.5 and 4b.5.6.\nWhen the AF disables sponsoring a service (See 3GPP TS 29.214 [10] subclause 4.4.2), the PCRF\n-\tmay modify the ADC rules in order to set the Reporting-Level AVP to SERVICE_IDENTIFIER_LEVEL or RATING_GROUP_LEVEL and not include the Sponsor-Identity AVP and Application-Service-Provider-Identity AVP if they were included previously.\n-\tmay modify the ADC rules to update the charging key.\nNOTE 1:\tA specific charging key can be applied to the sponsored data connectivity for online charging.\n-\tshall disable the usage monitoring for the sponsored data connectivity according to subclause 4b.5.7.4 if it was enabled previously. As a result, PCRF gets the accumulated usage of the sponsored data connectivity.\nNOTE 2:\tIt depends on the implementation whether the solutions defined in Annex F can be used to disable the usage monitoring.\n4b.5.17\tExtended bandwidth support for EPC supporting Dual Connectivity (E-UTRAN and 5G NR)\nWhen the Extended-BW-NR feature is supported, extended bandwidth support as described in subclause 4.5.30 applies.\nWhen the TDF session is being established in solicited mode and if the PCRF supports the Extended-BW-NR feature the same behaviour as described in subclause 4.5.30 applies for all the QoS information provided in the TSR command.\n4b.5a\tADC procedures over Sd reference point for unsolicited application reporting\n4b.5a.1\tProvisioning of ADC rules\n4b.5a.1.1\tGeneral\nIf a TDF is configured for unsolicited reporting, the TDF is pre-configured with ADC rules which specify which applications to detect and report. These rules are always active and are not controlled by the PCRF.\n4b.5a.2\tApplication Detection Information\nWhen the start or stop of the application's traffic, identified by TDF-Application-Identifier, is detected, the TDF shall report the information regarding the detected application's traffic in the Application-Detection-Information AVP in the CCR command.\n1)\tWhen the TDF detects an application for an Ipv4 address or Ipv6 address for which a TDF session does not exist, the TDF shall send CC-Request with CC-Request-Type set to value \"INITIAL-REQUEST\". The TDF provides the full UE IP address using either Framed-IP-Address AVP or Framed-Ipv6-Prefix AVP and, if available, the PDN identifier. The corresponding CCA may contain the Ipv6 prefix within the Framed-Ipv6-Prefix AVPs if the established TDF session is Ipv6 address related.\n2)\tWhen an application is detected for an Ipv4 address or Ipv6 Prefix for which a TDF session already exists, the TDF shall send CC-Request with CC-Request-Type set to value \"UPDATE_REQUEST\".\nNOTE:\tIt is considered that a TDF session exists for a detected application related to an Ipv6 address if the Ipv6 address belongs to the Ipv6 prefix provided by the PCRF for that TDF session.\nThe corresponding TDF-Application-Identifier AVP shall be included under Application-Detection-Information AVP. Also, the corresponding Event-Trigger (APPLICATION_START or APPLICATION_STOP) shall be provided to PCRF. When the Event trigger indicates APPLICATION_START, if deducible, the Flow-Information AVP for the detected application shall be included under Application-Detection-Information AVP. The Flow-Information AVP, if present, shall contain the Flow-Description AVP and Flow-Direction AVP. The TDF-Application-Instance-Identifier, which is dynamically assigned by the TDF in order to allow correlation of APPLICATION_START and APPLICATION_STOP Event-Triggers to the specific Flow-Information AVP, if service data flow descriptions are deducible, shall also be provided.\n4b.5a.3\tRequest of TDF Session Termination\nIn the unsolicited reporting case the session termination procedure as defined in clause 4b.5.4 is initiated in the following cases.\n-\tthe corresponding IP-CAN session is terminated;\n-\tthe Ipv4 address of a dual stack IP-CAN session is released and there is an active Ipv4 address related TDF session for that IP-CAN session;\n-\tat any point of time when the PCRF decides that the session with TDF is to be terminated (e.g. subscriber profile changes).\n4b.5a.4\tTDF session to Gx session linking\nWhen the PCRF receives the CCR command with the CC-Request-Type set to the value \"INITIAL_REQUEST\", the PCRF links the TDF session to a Gx session, if the UE Ipv4 address orUE Ipv6 address of the TDF session matches the UE Ipv4 address or UE Ipv6 prefix of the Gx session. The PDN information if available in the Called-Station-Id AVP may also be used for this session linking.\nWhen the PCRF checks if APNs within Called-Station-Id AVPs match each other, the PCRF shall apply the APN matching procedures in Annex H of 3GPP TS 29.213 [8].\nThe TDF should handle each UE Ipv4 address and UE Ipv6 prefix, assuming the max prefix length used in the access network, within a separate TDF session. The PCRF shall link the separate UE Ipv4 address related TDF session and UE Ipv6 address related TDF session to the same IP-CAN session and correlate the TDF sessions.\nNOTE 1:\tIn the scenario where the TDF performs initial Application Detection on multiple simultaneous traffic flows for the same UE Ipv6 prefix (i.e. two or more traffic flows from UE Ipv6 addresses of the same IP-CAN session) the TDF could not be aware that those flows belong to the same IP-CAN session until a response is received from the PCRF, containing the UE Ipv6 prefix. This leads to using separate TDF sessions for the UE Ipv6 addresses for the same IP-CAN session. The TDF reports new application detection information related to that UE Ipv6 prefix via any of the TDF sessions at a later stage.\n4c\tSt reference point\n4c.1\tOverview\nThe St reference point resides between the PCRF and TSSF. The St reference point is used to provision the traffic steering control information from the PCRF to the TSSF.\nThe stage 2 level requirements for the St reference point are defined in 3GPP TS 23.203 [7].\nSignalling flows related to the St interface is specified in 3GPP TS 29.213 [8].\nAn alternative HTTP-based protocol for the St reference point is defined in 3GPP TS 29.155 [52].\nRefer to Annex G of 3GPP TS 29.213 [8] for Diameter overload control procedures over the St interface.\nRefer to Annex J of 3GPP TS 29.213 [8] for Diameter message priority mechanism procedures over the St interface.\nRefer to Annex K of 3GPP TS 29.213 [8] for Diameter load control procedures over the St interface.\n4c.2\tSt Reference model\nThe St reference point resides between the PCRF and TSSF. The relationship between the different functional entities involved for non-roaming scenario is depicted in figure 4c.2.1. The overall PCC architecture is depicted in subclause 3a of 3GPP TS 29.213 [8].\nFigure 4c.2.1: The PCC architecture with the St for non-roaming scenario\nNOTE:\tTraffic steering control with TSSF in roaming scenarios is in this release only specified for the home routed access case. In this case, the TSSF interacts with the H-PCRF.\n4c.3\tFunctional elements\n4c.3.1\tPCRF\nThe PCRF functionality defined in 3GPP TS 23.203 [7] is applicable. The PCRF shall be able to make a decision of traffic steering policies used to control the steering of the subscriber’s traffic to appropriate (S)Gi-LAN service functions. The PCRF shall inform the TSSF through the use of ADC rules, if applicable, on the treatment of service data flows or applications, in accordance with the PCRF policy decisions.\nNOTE:\tIn order to allow the PCRF to select and provision an application based traffic steering policy, the reporting of detected applications to the PCRF or any other information can be used.\n4c.3.2\tTSSF\nThe TSSF is a function that receives traffic steering control information from the PCRF and ensures that the related traffic steering policy is enforced in the (S)Gi-LAN.\nA traffic steering policy is locally configured in TSSF and can be used for uplink, downlink or for both directions. To ensure that the traffic steering policy is enforced, the TSSF performs deployment specific actions as configured for that traffic steering policy.\n4c.4\tProcedures over St reference point\n4c.4.1\tTraffic Steering Control Information Provisioning\nIf the PCRF determines at IP-CAN session establishment or at any later point of time that the traffic steering control is needed for the IP-CAN session, the PCRF shall indicate via the St reference point the traffic steering control to be applied at the TSSF.\nTo indicate the traffic steering control information, the PCRF shall use the following procedure.\nIf no active St Diameter session exists for the IP-CAN session, the PCRF shall establish an St Diameter session by sending an TDF-Session-Request (TSR) to the TSSF including the Request-Type AVP set to \"0 (initial request)\". Within the TSR, the PCRF shall provide the UE IPv4 address within the Framed-IP-Address AVP and/or UE IPv6 prefix within the Framed-IPv6-Prefix AVP and ADC-Rule-Install AVP(s) , and if required by the operator policies, the PDN information within the Called-Station-Id AVP. The TSSF identifier is pre-configured on the PCRF, e.g. per PCEF.\nNOTE 1:\tHow to cover a scenario where the same IP address is related to different PDN connections within the same PDN is not addressed in the present release.\nIf an active St Diameter session exists for the IP CAN session, the PCRF shall send an TDF-Session-Request (TSR) to the TSSF including the Request-Type AVP set to \"1 (update request)\" and ADC-Rule-Install AVP(s) and/or ADC-Rule-Remove AVP(s).\nThe PCRF shall use the ADC rule to contain the traffic steering control information. An ADC rule for traffic steering control, as defined within the ADC-Rule-Definition AVP shall consist of:\n-\ta rule identifier within the ADC-Rule-Name AVP;\n-\teither an TDF-Application-Identifier AVP or service data flow filter(s) within an Flow-Information AVP;\n-\ta Precedence AVP; and\n-\tTraffic steering policy identifier(s) within the Traffic-Steering-Policy-Identifier-DL AVP and/or the Traffic-Steering-Policy-Identifier-UL AVP.\nThe PCRF may perform an operation on a single ADC rule by one of the following means:\n-\tTo activate or deactivate an ADC rule that is predefined at the TSSF, the PCRF shall provision a reference to this ADC rule within an ADC-Rule-Name AVP and indicate the required action by choosing either the ADC-Rule-Install AVP or the ADC-Rule-Remove AVP.\n-\tTo install or modify a PCRF-provisioned ADC rule, the PCRF shall provision a corresponding ADC-Rule-Definition AVP within an ADC-Rule-Install AVP.\n-\tTo remove an ADC rule which has previously been provisioned by the PCRF, the PCRF shall provision the name of this ADC rule as value of an ADC-Rule-Name AVP within an ADC-Rule-Remove AVP.\nAs an alternative to providing a single ADC rule, the PCRF may provide an ADC-Rule-Base-Name AVP within an ADC-Rule-Install AVP or the ADC-Rule-Remove AVP as a reference to a group of ADC rules predefined at the TSSF. With an ADC-Rule-Install AVP, a predefined group of ADC rules is activated. With an ADC-Rule-Remove AVP, a predefined group of ADC rules is deactivated.\nThe PCRF may combine multiple of the above ADC rule operations in a single command.\nTo activate a predefined ADC rule at the TSSF, the rule name within an ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Install AVP as a reference to the predefined rule. To activate a group of predefined ADC rules within the TSSF, an ADC-Rule-Base-Name AVP shall be supplied within an ADC-Rule-Install AVP as a reference to the group of predefined ADC rules.\nTo install a new or modify an already installed PCRF defined ADC rule, the ADC-Rule-Definition AVP shall be used. If an ADC rule with the same rule name, as supplied in the ADC-Rule-Name AVP within the ADC-Rule-Definition AVP, already exists at the TSSF, the new ADC rule shall update the currently installed rule. If the existing ADC rule already has attributes also included in the new ADC rule definition, the existing attributes shall be overwritten. Any attribute in the existing ADC rule not included in the new ADC rule definition shall remain valid.\nFor deactivating single predefined or removing PCRF-provided ADC rules, the ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Remove AVP. For deactivating a group of predefined ADC rules, the ADC-Rule-Base-Name AVP shall be supplied within an ADC-Rule-Remove AVP.\nThe TSSF shall apply the ADC rules to the user plane traffic with the IP address(es) matching the UE Ipv4 address within the Framed-IP-Address and/or the UE Ipv6 prefix within the Framed-Ipv6-Prefix AVP , and the PDN the UE accesses matching the PDN identifier within the Called-Station-Id AVP if provided by the PCRF.\nIf the provisioning of ADC rules fails, the TSSF informs the PCRF as described in subclause 4c.4.3. Depending on the cause, the PCRF may decide if re-installation, modification, removal of ADC rules or any other action applies.\nWhen a combination of PCEF/TDF with traffic steering control feature and TSSF is deployed, the TSSF shall behave as specified in subclause 6.1.17 of 3GPP TS 23.203 [7]. In this case, the PCRF shall provide the traffic detection information as part of the service data flow information included within the Flow-Information AVP  or within the TDF-Application-Identifier AVP. If traffic detection is performed using the ToS-Traffic-Class AVP within the Flow-Information\t AVP, the PCRF shall ensure that the ToS-Traffic-Class AVP included within the Flow-Information AVP used for traffic detection is the same as the value provided in the Traffic-Steering-Policy-Identifier-UL and/or Traffic-Steering-Policy-Identifier-DL AVP over Gx or Sd reference point. If traffic detection is performed using the TDF-Application-Identifier AVP, the PCRF shall ensure that the identifier included within the TDF-Application-Identifier AVP refers to the configured value(s) in the TSSF that corresponds to the value provided in the Traffic-Steering-Policy-Identifier-UL and/or Traffic-Steering-Policy-Identifier-DL over Gx or Sd reference point. See subclauses 4.5.2.8 and 4b.5.15 for the details in the Gx and Sd reference points respectively.\nNOTE 2:\tThe PCRF and TSSF are configured with the traffic detection mechanism to be applied when the TDF-Application-Identifier AVP is used for traffic detection.\nNOTE 3:\tThe TDF-Application-Identifier AVP can refer to the configured traffic detection information for uplink and/or downlink traffic.\n4c.4.2\tSt Session Termination\nWhen the corresponding IP-CAN session is terminated or at any point of time when the PCRF decides that the session with TSSF is to be terminated (e.g. subscriber profile changes), the PCRF shall send a STR command to the TSSF. The TSSF shall acknowledge the command by sending a STA command to the PCRF and instantly remove/deactivate all the ADC rules that have been previously installed or activated on that St session.\n4c.4.3\tADC Rule Error Handling\nIf the installation/activation of one or more ADC rules fails, the TSSF shall include one or more ADC-Rule-Report AVP(s) in the corresponding TSA command for the affected ADC rules. Within each ADC-Rule-Report AVP, the TSSF shall identify the failed ADC rule(s) by including the ADC-Rule-Name AVP(s) or ADC-Rule-Base-Name AVP(s), shall identify the failed reason code by including a Rule-Failure-Code AVP, and shall include the PCC-Rule-Status AVP as described below:\nIf the installation/activation of one or more new ADC rules (i.e., rules which were not previously successfully installed) fails, the TSSF shall set the PCC-Rule-Status to INACTIVE.\nIf the modification of a currently active ADC rule fails, the TSSF shall retain the existing ADC rule as active without any modification unless the reason for the failure has an impact also on the existing ADC rule.\nDepending on the value of the Rule-Failure-Code, the PCRF may decide whether retaining of the old ADC rule, re-installation, modification, removal of the ADC rule or any other action applies.\nIf an ADC rule was successfully installed/activated, but can no longer be enforced by the TSSF, the TSSF shall send the PCRF a new TNR command and include an ADC-Rule-Report AVP. The TSSF shall include the Rule-Failure-Code AVP within the ADC-Rule-Report AVP and shall set the PCC-Rule-Status to INACTIVE.\n4c.4.4\tUE IPv4 Address Provisioning\nWhen PCRF is notified by PCEF that either an UE_IP_ADDRESS_ALLOCATE or an UE_IP_ADDRESS_RELEASE event of the IP-CAN session occurs in the PCEF, the PCRF shall notify the TSSF about the event for the corresponding St session by including the UE_IP_ADDRESS_ALLOCATE or the UE_IP_ADDRESS_RELEASE event trigger within the Event-Reporting-Indication AVP which is included in a TSR command with the Request-Type AVP set to \"1 (update request)\". The Framed-IP-Address AVP shall also be provided within the Event-Report-Indication AVP when the UE_IP_ADDRESS_ALLOCATE event trigger is included. If the PCRF notifies of the new UE Ipv4 address to the TSSF, the TSSF shall additionally apply the ADC rules to the user plane traffic with the IP address matching the new UE Ipv4 address. If the PCRF notifies to the TSSF that the UE Ipv4 address has been released, the TSSF shall stop applying the ADC rule to the user plane traffic with IP address matching the released UE Ipv4 address.\nNOTE 1:\tIt is possible not to include ADC Rules in the TSR command.\nNOTE 2:\tThe TSSF does not need to subscribe the notification of the UE_IP_ADDRESS_ALLOCATE and UE_IP_ADDRESS_RELEASE.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.213_clause_4.0",
        "ts_29.213_clause_3",
        "clause_4",
        "clause_4.4.1",
        "ts_23.060_clause_15.3.3.4",
        "ts_29.213_clause_5.3",
        "clause_4.5.12",
        "clause_4.5.10",
        "clause_4.5.11",
        "clause_4.5.5.7",
        "clause_5",
        "clause_4.5.5.2",
        "clause_4.5.5.3",
        "clause_4.5.191.2",
        "clause_4.5.19.1.1",
        "clause_4.5.19.1.2",
        "clause_4.5.19.1.3",
        "clause_4.5.19.1.4",
        "ts_29.214_clause_5.5.4",
        "clause_6.2.1.0",
        "ts_29.214_clause_4.4.8",
        "ts_29.214_clause_5.4.1",
        "ts_29.214_clause_4.4.1",
        "ts_29.214_clause_4.4.9",
        "clause_4.5",
        "clause_4.5.30",
        "clause_5.3.7",
        "clause_4.5.3",
        "ts_23.003_clause_25",
        "ts_23.203_clause_6.1.17",
        "ts_29.214_clause_4.4.2",
        "figure_4",
        "ts_29.213_figure_4",
        "ts_23.203",
        "ts_23.402",
        "ts_29.213",
        "ts_23.060",
        "ts_23.003",
        "ts_29.214",
        "ts_29.244",
        "ts_26.114",
        "ts_29.251",
        "ts_29.155"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.1",
      "section_id": "5.1",
      "section_title": "Protocol support",
      "content": "The Gx protocol in the present release is based on Gx protocol defined for Release 6 as specified in 3GPP TS 29.210 [2]. However, due to a new paradigm (DCC session for an IP-CAN session) between Release 6 and the present release, the Gx application in the present release has an own vendor specific Diameter application.\nThe Gx application is defined as a vendor specific Diameter application, where the vendor is 3GPP and the Application-ID for the Gx Application in the present release is 16777238. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.\nNOTE:\tA route entry can have a different destination based on the application identification AVP of the message. Therefore, Diameter agents (relay, proxy, redirection, translation agents) need to be configured appropriately to identify the 3GPP Gx application within the Auth-Application-Id AVP in order to create suitable routeing tables.\nThe Gx application identification shall be included in the Auth-Application-Id AVP.\nWith regard to the Diameter protocol defined over the Gx interface, the PCRF acts as a Diameter server, in the sense that it is the network element that handles PCC Rule requests for a particular realm. The PCEF acts as the Diameter client, in the sense that is the network element requesting PCC rules in the transport plane network resources.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.210"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.2",
      "section_id": "5.2",
      "section_title": "Initialization, maintenance and termination of connection and session",
      "content": "The initialization and maintenance of the connection between each PCRF and PCEF pair is defined by the underlying protocol. Establishment and maintenance of connections between Diameter nodes is described in IETF RFC 6733 [61].\nAfter establishing the transport connection, the PCRF and the PCEF shall advertise the support of the Gx specific Application by including the value of the application identifier in the Auth-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands are specified in the Diameter Base Protocol (IETF RFC 6733 [61]).\nThe termination of the Diameter session on Gx can be initiated either by the PCEF or PCRF, as specified in clauses 4.5.7 and 4.5.9, respectively.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.0",
      "section_id": "5.3.0",
      "section_title": "General",
      "content": "Table 5.3.0.1 describes the Diameter AVPs defined for the Gx reference point, their AVP Code values, types, possible flag values, whether or not the AVP may be encrypted, what access types (e.g. 3GPP-GPRS, etc.) the AVP is applicable to, the applicability of the AVPs to charging control, policy control or both, and which supported features the AVP is applicable to. The Vendor-Id header of all AVPs defined in the present document shall be set to 3GPP (10415).\nTable 5.3.0.1: Gx specific Diameter AVPs\nAVP Flag rules(NOTE 1)\nAttribute Name\nAVP Code\nClause defined\nValue Type (NOTE 2)\nMust\nMay\nShould not\nMust not\nMay Encr.\nAcc. Type\nApplicability (notes 3, 9)\n3GPP-PS-Data-Off-Status\n2847\n5.3.133\nEnumerated\nV\nP\nM\nY\n3GPP-EPS\n3GPP-PS-Data-Off\nAccess-Availability-Change-Reason\n2833\n5.3.121\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nAccess-Network-Charging-Identifier-Gx\n1022\n5.3.22\nGrouped\nM,V\nP\nY\nAll\nCC\nAllocation-Retention-Priority\n1034\n5.3.32\nGrouped\nV\nP\nM\nY\nAll\nBoth\nRel8\nAN-GW-Address\n1050\n5.3.49\nAddress\nV\nP\nM\nY\nAll\nBoth\nRel8\nEPC-routed\nAN-GW-Status\n2811\n5.3.100\nEnumerated\nV\nP\nM\nY\n3GPP-EPS\nBoth\nSGW-Rest\nAPN-Aggregate-Max-Bitrate-DL\n1040\n5.3.39\nUnsigned32\nV\nP\nM\nY\nAll\nPC\nRel8\nAPN-Aggregate-Max-Bitrate-UL\n1041\n5.3.40\nUnsigned32\nV\nP\nM\nY\nAll\nPC\nRel8\nApplication-Detection-Information\n1098\n5.3.91\nGrouped\nV\nP\nM\nY\nAll\nADC\nBearer-Control-Mode\n1023\n5.3.23\nEnumerated\nM,V\nP\nY\n3GPP-GPRS\n3GPP-EPS\n3GPP2\nNon-3GPP-EPS\n(NOTE 6)\nPC\nBearer-Identifier\n1020\n5.3.20\nOctetString\nM,V\nP\nY\n3GPP-GPRS\nBoth\nBearer-Operation\n1021\n5.3.21\nEnumerated\nM,V\nP\nY\n3GPP-GPRS\nBoth\nBearer-Usage\n1000\n5.3.1\nEnumerated\nM,V\nP\nY\n3GPP-GPRS\n3GPP-EPS\nBoth\nCharging-Correlation-Indicator\n1073\n5.3.67\nEnumerated\nV\nP\nM\nY\nAll\nCC\nRel8\nCharging-Rule-Base-Name\n1004\n5.3.5\nUTF8String\nM,V\nP\nY\nAll\nBoth\nCharging-Rule-Definition\n1003\n5.3.4\nGrouped\nM,V\nP\nY\nAll\nBoth\nCharging-Rule-Install\n1001\n5.3.2\nGrouped\nM,V\nP\nY\nAll\nBoth\nCharging-Rule-Name\n1005\n5.3.6\nOctetString\nM,V\nP\nY\nAll\nBoth\nCharging-Rule-Remove\n1002\n5.3.3\nGrouped\nM,V\nP\nY\nAll\nBoth\nCharging-Rule-Report\n1018\n5.3.18\nGrouped\nM,V\nP\nY\nAll\nBoth\nCoA-Information\n1039\n5.3.37\nGrouped\nV\nP\nM\nY\nAll\n(NOTE 8)\nBoth\nRel8\nCoA-IP-Address\n1035\n5.3.33\nAddress\nV\nP\nM\nY\nAll\n(NOTE 8)\nBoth\nRel8\nConditional-APN-Aggregate-Max-Bitrate\n2818\n5.3.105\nGrouped\nV\nP\nM\nY\nAll\n(NOTE 5)\nPC\nConditionalAPNPolicyInfo\nConditional-Policy-Information\n2840\n5.3.128\nGrouped\nV\nP\nM\nY\nAll\nBoth\nCondPolicyInfo,\nCondPolicyInfo-DefaultQoS\nCredit-Management-Status\n1082\n5.3.102\nUnsigned32\nV\nP\nM\nY\nAll\nCC\nCSG-Information-Reporting\n1071\n5.3.64\nEnumerated\nV\nP\nM\nY\n3GPP-GPRS\n3GPP-EPS\nCC\nRel9\nDefault-Access\n2829\n5.3.120\nEnumerated\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nDefault-Bearer-Indication\n2844\n5.3.132\nEnumerated\nV\nP\nM\nY\n3GPP-EPS,\nNon-3GPP-EPS\nRule-Bound-to-Default-Bearer\nDefault-EPS-Bearer-QoS\n1049\n5.3.48\nGrouped\nV\nP\nM\nY\nAll\n(NOTE 5)\nPC\nRel8\nDefault-QoS-Information\n2816\n5.3.103\nGrouped\nV\nP\nM\nY\nFBA\nPC\nFBAC\nDefault-QoS-Name\n2817\n5.3.104\nUTF8String\nV\nP\nM\nY\nFBA\nPC\nFBAC\nEvent-Report-Indication\n1033\n5.3.30\nGrouped\nV\nP\nM\nY\nAll\nBoth\nRel8\nEvent-Trigger\n1006\n5.3.7\nEnumerated\nM,V\nP\nY\nAll\nBoth\nExecution-Time\n2839\n5.3.127\nTime\nV\nP\nM\nY\nAll\nBoth\nCondPolicyInfo,\nCondPolicyInfo-DefaultQoS\nExtended-APN-AMBR-DL\n2848\n5.3.134\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nExtended-BW-NR\nExtended-APN-AMBR-UL\n2849\n5.3.135\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nExtended-BW-NR\nExtended-GBR-DL\n2850\n5.3.136\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nExtended-BW-NR\nExtended-GBR-UL\n2851\n5.3.137\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nExtended-BW-NR\nFlow-Direction\n1080\n5.3.65\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nRel9\nFlow-Information\n1058\n5.3.53\nGrouped\nV\nP\nM\nY\nAll\nBoth\nFlow-Label\n1057\n5.3.52\nOctetString\nV\nP\nM\nY\nAll\nBoth\nFixed-User-Location-Info\n2825\n5.3.112\nGrouped\nV\nP\nM\nY\nFBA\nBoth\nFBAC\nGuaranteed-Bitrate-DL\n1025\n5.3.25\nUnsigned32\nM,V\nP\nY\nAll\nPC\nGuaranteed-Bitrate-UL\n1026\n5.3.26\nUnsigned32\nM,V\nP\nY\nAll\nPC\nHeNB-Local-IP-Address\n2804\n5.3.95\nAddress\nV\nP\nM\nY\n3GPP-EPS\nPC\nEPC-routed\nIP-CAN-Session-Charging-Scope\n2827\n5.3.114\nEnumerated\nV\nP\nM\nY\nAll\nCC\nIP-CAN-Type\n1027\n5.3.27\nEnumerated\nM,V\nP\nY\nAll\nBoth\nMax-PLR-DL\n2852\n5.3.138\nFloat32\nV\nP\nM\nY\nAll\nPC\nRAN-Support-Info\nMax-PLR-UL\n2853\n5.3.139\nFloat32\nV\nP\nM\nY\nAll\nPC\nRAN-Support-Info\nMetering-Method\n1007\n5.3.8\nEnumerated\nM,V\nP\nY\nAll\nCC\nMonitoring-Flags\n2828\n5.3.115\nUnsigned32\nV\nM\nY\nAll\nExUsage\nMonitoring-Key\n1066\n5.3.59\nOctetString\nV\nP\nM\nY\nAll\nBoth\nRel9\nMute-Notification\n2809\n5.3.98\nEnumerated\nV\nP\nM\nY\nAll\nADC\nMonitoring-Time\n2810\n5.3.99\nTime\nV\nP\nM\nY\nAll\nBoth\nUMCH\nNBIFOM-Mode\n2830\n5.3.117\nEnumerated\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nNBIFOM-Support\n2831\n5.3.116\nEnumerated\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nNetLoc-Access-Support\n2824\n5.3.111\nUnsigned32\nV\nP\nM\nY\nAll\nNetLoc\nNetLoc- Trusted-WLAN\nNetLoc- Untrusted-WLAN\nNetwork-Request-Support\n1024\n5.3.24\nEnumerated\nM,V\nP\nY\n3GPP-GPRS\n3GPP-EPS\n3GPP2 Non-3GPP-EPS (NOTE 6)\nPC\nOffline\n1008\n5.3.9\nEnumerated\nM,V\nP\nY\nAll\nCC\nOnline\n1009\n5.3.10\nEnumerated\nM,V\nP\nY\nAll\nCC\nPacket-Filter-Content\n1059\n5.3.54\nIPFilterRule\nV\nP\nM\nY\nAll\n(NOTE 5)\nBoth\nRel8\nPacket-Filter-Identifier\n1060\n5.3.55\nOctetString\nV\nP\nM\nY\nAll\n(NOTE 5)\nBoth\nRel8\nPacket-Filter-Information\n1061\n5.3.56\nGrouped\nV\nP\nM\nY\nAll\n(NOTE 5)\nBoth\nRel8\nPacket-Filter-Operation\n1062\n5.3.57\nEnumerated\nV\nP\nM\nY\nAll\n(NOTE 5)\nBoth\nRel8\nPacket-Filter-Usage\n1072\n5.3.66\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nRel9\nPCC-Rule-Status\n1019\n5.3.19\nEnumerated\nM,V\nP\nY\nAll\nBoth\nPDN-Connection-ID\n1065\n5.3.58\nOctetString\nV\nP\nY\nAll\n(NOTE 7)\nBoth\nRel9\nPRA-Install\n2845\n5.3.130\nGrouped\nV\nP\nM\n3GPP-EPS\nBoth\nMultiple-PRA\nPRA-Remove\n2846\n5.3.131\nGrouped\nV\nP\nM\n3GPP-EPS\nBoth\nMultiple-PRA\nPrecedence\n1010\n5.3.11\nUnsigned32\nM,V\nP\nY\nAll\nBoth\nPre-emption-Capability\n1047\n5.3.46\nEnumerated\nV\nP\nM\nY\n3GPP- EPS, 3GPP-GPRS\nBoth\nRel8\nPre-emption-Vulnerability\n1048\n5.3.47\nEnumerated\nV\nP\nM\nY\n3GPP- EPS, 3GPP-GPRS\nBoth\nRel8\nPresence-Reporting-Area-Elements-List\n2820\n5.3.107\nOctetString\nV\nP\nM\nY\n3GPP-EPS\nBoth\nCNO-ULI\nMultiple-PRA\nPresence-Reporting-Area-Identifier\n2821\n5.3.108\nOctetString\nV\nP\nM\nY\n3GPP-EPS\nBoth\nCNO-ULI\nMultiple-PRA\nPresence-Reporting-Area-Information\n2822\n5.3.109\nGrouped\nV\nP\nM\nY\n3GPP-EPS\nBoth\nCNO-ULI\nMultiple-PRA\nPresence-Reporting-Area-Node\n2855\n5.3.141\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS\nPresence-Reporting-Area-Status\n2823\n5.3.110\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS\nBoth\nCNO-ULI\nMultiple-PRA\nPriority-Level\n1046\n5.3.45\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nRel8\nPS-to-CS-Session-Continuity\n1099\n5.3.84\nEnumerated\nV\nP\nY\n3GPP-EPS\nBoth\nvSRVCC\nQoS-Class-Identifier\n1028\n5.3.17\nEnumerated\nM,V\nP\nY\nAll (NOTE 10, NOTE 12)\nBoth\nQoS-Information\n1016\n5.3.16\nGrouped\nM.V\nP\nY\nAll\nBoth\nQoS-Negotiation\n1029\n5.3.28\nEnumerated\nM,V\nP\nY\n3GPP-GPRS\nPC\nQoS-Upgrade\n1030\n5.3.29\nEnumerated\nM.V\nP\nY\n3GPP-GPRS\nPC\nRAN-NAS-Release-Cause\n2819\n5.3.106\nOctetString\nV\nP\nM\nY\n3GPP-EPS,\nNon-3GPP-EPS\nBoth\nRAN-NAS-Cause\nRAN-Rule-Support\n2832\n5.3.122\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nRAT-Type\n1032\n5.3.31\nEnumerated\nV\nP\nM\nY\nAll\n(NOTE 4)\nBoth\nRel8\nRedirect-Information\n1085\n5.3.82\nGrouped\nV\nP\nM\nY\nAll\nADC\nADC-Add-Redirection\nRedirect-Support\n1086\n5.3.83\nEnumerated\nV\nP\nM\nY\nAll\nADC\nRemoval-Of-Access\n2842\n5.3.126\nEnumerated\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nReporting-Level\n1011\n5.3.12\nEnumerated\nM,V\nP\nY\nAll\nCC\nResource-Allocation-Notification\n1063\n5.3.50\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nRel8\nResource-Release-Notification\n2841\n5.3.125\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nEnh-RAN-NAS-Cause\nRevalidation-Time\n1042\n5.3.41\nTime\nM,V\nP\nY\nAll\nBoth\nRouting-Filter\n1078\n5.3.72\nGrouped\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-IP-Address\n1079\n5.3.73\nAddress\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-Rule-Definition\n1076\n5.3.70\nGrouped\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-Rule-Identifier\n1077\n5.3.71\nOctetString\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-Rule-Install\n1081\n5.3.68\nGrouped\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-Rule-Remove\n1075\n5.3.69\nGrouped\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\nBoth\nIFOM\nRouting-Rule-Failure-Code\n2834\n5.3.119\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nRouting-Rule-Report\n2835\n5.3.118\nGrouped\nV\nP\nM\nY\n3GPP-EPS, Non-3GPP-EPS\n(NOTE 11)\nBoth\nNBIFOM\nRule-Activation-Time\n1043\n5.3.42\nTime\nM,V\nP\nY\nAll\nBoth\nRule-Deactivation-Time\n1044\n5.3.43\nTime\nM,V\nP\nY\nAll\nBoth\nRule-Failure-Code\n1031\n5.3.38\nEnumerated\nM.V\nP\nY\nAll\nBoth\nSecurity-Parameter-Index\n1056\n5.3.51\nOctetString\nV\nP\nM\nY\nAll\nBoth\nSession-Release-Cause\n1045\n5.3.44\nEnumerated\nM,V\nP\nY\nAll\nBoth\nTCP-Source-Port\n2843\n5.3.129\nUnsigned32\nV\nP\nM\nY\nNon-3GPP-EPS\nPC\nNetLoc-Untrusted-WLAN\nTDF-Information\n1087\n5.3.78\nGrouped\nV\nP\nM\nY\nAll\nPC\nTDF-Application-Identifier\n1088\n5.3.77\nOctetString\nV\nP\nM\nY\nAll\nPC\nADC\nTDF-Application-Instance-Identifier\n2802\n5.3.92\nOctetString\nV\nP\nM\nY\nAll\nADC\nTDF-Destination-Host\n1089\n5.3.80\nDiameterIdentity\nV\nP\nM\nY\nAll\nPC\nTDF-Destination-Realm\n1090\n5.3.79\nDiameterIdentity\nV\nP\nM\nY\nAll\nPC\nTDF-IP-Address\n1091\n5.3.81\nAddress\nV\nP\nM\nY\nAll\nPC\nTFT-Filter\n1012\n5.3.13\nIPFilterRule\nM,V\nP\nY\n3GPP-GPRS\nBoth\nTFT-Packet-Filter-Information\n1013\n5.3.14\nGrouped\nM,V\nP\nY\n3GPP-GPRS\nBoth\nTraffic-Steering-Policy-Identifier-DL\n2836\n5.3.123\nOctetString\nV\nP\nM\nY\nAll\nPC\nTSC\nTraffic-Steering-Policy-Identifier-UL\n2837\n5.3.124\nOctetString\nV\nP\nM\nY\nAll\nPC\nTSC\nToS-Traffic-Class\n1014\n5.3.15\nOctetString\nM,V\nP\nY\nAll\nBoth\nTunnel-Header-Filter\n1036\n5.3.34\nIPFilterRule\nV\nP\nM\nY\nAll\n(NOTE 8)\nBoth\nRel8\nTunnel-Header-Length\n1037\n5.3.35\nUnsigned32\nV\nP\nM\nY\nAll\n(NOTE 8)\nBoth\nRel8\nTunnel-Information\n1038\n5.3.36\nGrouped\nV\nP\nM\nY\nAll\n(NOTE 8)\nBoth\nRel8\nUDP-Source-Port\n2806\n5.3.97\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS\nNon-3GPP-EPS\nPC\nEPC-routed\nNetLoc-Untrusted-WLAN\nUE-Local-IP-Address\n2805\n5.3.96\nAddress\nV\nP\nM\nY\nNon-3GPP-EPS\nPC\nBBAI\nNetLoc- Untrusted-WLAN\nUE-Status\n2854\n5.3.140\nUnsigned32\nV\nP\nM\nY\n3GPP-EPS\nUE-Status-Change\nUsage-Monitoring-Information\n1067\n5.3.60\nGrouped\nV\nP\nM\nY\nAll\nBoth\nRel9\nUsage-Monitoring-Level\n1068\n5.3.61\nEnumarated\nV\nP\nM\nY\nAll\nBoth\nRel9\nUsage-Monitoring-Report\n1069\n5.3.62\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nRel9\nUsage-Monitoring-Support\n1070\n5.3.63\nEnumerated\nV\nP\nM\nY\nAll\nBoth\nRel9\nUser-Location-Info-Time\n2812\n5.3.101\nTime\nV\nP\nM\nY\n3GPP-GPRS.\n3GPP-EPS\nBoth\nNetLoc\nRAN-NAS-Cause NetLoc- Untrusted-WLAN\nPCSCF-Restoration-Indication\n2826\n5.3.113\nUnsigned32\nV\nP\nM\nY\nAll\nBoth\nPCSCF-Restoration-Enhancement\nNOTE 1:\tThe AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [61].\nNOTE 2:\tThe value types are defined in IETF RFC 6733 [61].\nNOTE 3:\tAVPs marked with \"CC\" are applicable to charging control, AVPs marked with \"PC\" are applicable to policy control and AVPs marked with \"Both\" are applicable to both charging control and policy control. AVPs marked with \"ADC\" are applicable to application detection and control. AVPs marked with \"ABC\" are applicable to application based charging.\nNOTE 4:\tRAT-Type AVP applies to 3GPP, Non-3GPP-EPS, and 3GPP2 access types.\nNOTE 5:\tThis AVP does not apply to 3GPP-GPRS access type.\nNOTE 6:\tThe 3GPP2 usage is defined in 3GPP2 X.S0062 [30]. Non-3GPP-EPS usage applies to GTP based S2b,\nNOTE 7:\tThis AVP only applies to case 2b as defined in 3GPP TS 29.213 [8].\nNOTE 8:\tThis AVP only applies to case 2a as defined in 3GPP TS 29.213 [8].\nNOTE 9:\tAVPs marked with a supported feature (e.g. \"Rel8\", \"Rel9\", \"IFOM\" or \"EPC-routed\") are applicable as described in subclause 5.4.1.\nNOTE 10:\tThe MissionCriticalQCIs supported feature indicates support for the Mission Critical QCI values 65, 69 and 70, and the Non Mission Critical QCI value 66 within the QoS-Class-Identifier AVP defined in subclause 5.3.17.\nNOTE 11:\tRAT type of Non-3GPP-EPS only applies to WLAN & VIRTUAL.\nNOTE 12:\tThe MCVideoQCI supported feature indicates support for the Mission Critical Video QCI value 67 within the QoS-Class-Identifier AVP defined in subclause 5.3.17.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4.1",
        "clause_5.3.17",
        "table_5.3.0.1",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.1",
      "section_id": "5.3.1",
      "section_title": "Bearer-Usage AVP (3GPP-GPRS and 3GPP-EPS access types)",
      "content": "The Bearer-Usage AVP (AVP code 1000) is of type Enumerated, and it shall indicate how the bearer is being used. If the Bearer-Usage AVP has not been previously provided, its absence shall indicate that no specific information is available. If the Bearer-Usage AVP has been provided, its value shall remain valid until it is provided the next time. The following values are defined:\nGENERAL (0)\nThis value shall indicate no specific bearer usage information is available.\nIMS_SIGNALLING (1)\nThis value shall indicate that the bearer is used for IMS signalling only.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.2",
      "section_id": "5.3.2",
      "section_title": "Charging-Rule-Install AVP (All access types)",
      "content": "The Charging-Rule-Install AVP (AVP code 1001) is of type Grouped, and it is used to activate, install or modify PCC rules as instructed from the PCRF to the PCEF.\nFor installing a new PCC rule or modifying a PCC rule already installed, Charging-Rule-Definition AVP shall be used.\nFor activating a specific PCC rule predefined at the PCEF, Charging-Rule-Name AVP shall be used as a reference for that PCC rule. The Charging-Rule-Base-Name AVP is a reference that may be used for activating a group of PCC rules predefined at the PCEF.\nFor GPRS scenarios where the bearer binding is performed by the PCRF, the Bearer Identifier AVP shall be included as part of Charging-Rule-Install AVP.\nIf present within Charging-Rule-Install AVP, the Bearer-Identifier AVP indicates that the PCC rules within this Charging-Rule-Install AVP shall be installed or activated within the IP CAN bearer identified by the Bearer-Identifier AVP.\nIf no Bearer-Identifier AVP is included within the Charging-Rule-Install AVP, the PCEF shall select an IP CAN bearer for each of the PCC rules within this Charging-Rule-Install AVP, where the PCC rule is installed or activated.\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified then it applies to all the PCC rules within the Charging-Rule-Install AVP.\nIf Resource-Allocation-Notification AVP is included then it applies to all the rules within the Charging-Rule-Install AVP. If a Charging-Rule-Install AVP does not include the Resource-Allocation-Notification AVP, the resource allocation shall not be notified by the PCEF even if this AVP was present in previous installations of the same rule.\nIf the Charging-Correlation-Indicator AVP is included within the Charging-Rule-Install AVP, it indicates that the PCEF shall provide the assigned access network charging identifier for the dynamic PCC Rules that are provided in the Charging-Rule-Definition AVP(s) within the Access-Network-Charging-Identifier-Gx AVP.\nIf the Monitoring-Flags AVP is included within the Charging-Rule-Install AVP, it is used to indicate the monitoring action related to the corresponding service data flow. It applies to all the PCC rules within the Charging-Rule-Install AVP. If the Monitoring-Flags AVP is provided, the value will be valid for the PCC rules until the new value is provided for the PCC rules.\nIP-CAN-Type AVP identifies the access to be used for transporting the service data flows in NBIFOM scenario. If the IP-CAN-Type AVP is omitted and NBIFOM applies to the corresponding IP-CAN session, the traffic identified by the PCC rule is to be transferred on the NBIFOM default access even if this AVP was present in previous installations of the same rule. Only the 3GPP-EPS and Non-3GPP-EPS IP-CAN type values are applicable in this release.\nNOTE:\tThe IP-CAN-Type AVP is always included in the Charging-Rule-Install AVP when a PCC rule is installed or modified if the PCC rule is intended to be bound to the non-default access.\nAVP Format:\nCharging-Rule-Install ::= \t< AVP Header: 1001 >\n*[ Charging-Rule-Definition ]\n*[ Charging-Rule-Name ]\n*[ Charging-Rule-Base-Name ]\n[ Bearer-Identifier ]\n[ Monitoring-Flags ]\n[ Rule-Activation-Time ]\n[ Rule-Deactivation-Time ]\n[ Resource-Allocation-Notification ]\n[ Charging-Correlation-Indicator ]\n[ IP-CAN-Type ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.3",
      "section_id": "5.3.3",
      "section_title": "Charging-Rule-Remove AVP (All access types)",
      "content": "The Charging-Rule-Remove AVP (AVP code 1002) is of type Grouped, and it is used to deactivate or remove PCC rules from an IP CAN session.\nCharging-Rule-Name AVP is a reference for a specific PCC rule at the PCEF to be removed or for a specific PCC rule predefined at the PCEF to be deactivated. The Charging-Rule-Base-Name AVP is a reference for a group of PCC rules predefined at the PCEF to be deactivated.\nRequired-Access-Info AVP may be included if the AF requests the PCRF to report user access network information and the PCRF is removing PCC rules based on the AF requests.AVP Format.\nIf Resource-Release-Notification AVP is included then it applies to all the rules within the Charging-Rule-Remove AVP. If a Charging-Rule-Remove AVP does not include the Resource-Release-Notification AVP, the resource release shall not be notified by the PCEF.\nCharging-Rule-Remove ::= < AVP Header: 1002 >\n*[ Charging-Rule-Name ]\n*[ Charging-Rule-Base-Name ]\n*[ Required-Access-Info ]\n[ Resource-Release-Notification ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.4",
      "section_id": "5.3.4",
      "section_title": "Charging-Rule-Definition AVP (All access types)",
      "content": "The Charging-Rule-Definition AVP (AVP code 1003) is of type Grouped, and it defines the PCC rule sent by the PCRF to the PCEF. The Charging-Rule-Name AVP uniquely identifies the PCC rule and it is used to reference to a PCC rule in communication between the PCEF and the PCRF within one IP CAN session. The Flow-Information AVP(s) or the application detection filter referenced by the TDF-Application-Identifier AVP determines the traffic that belongs to the service data flow. Either Flow-Information AVP(s) or TDF-Application-Identifier AVP shall exist in a Charging-Rule-Definition AVP.\nIf optional AVP(s) within a Charging-Rule-Definition AVP are omitted, but corresponding information has been provided in previous Gx messages, the previous information remains valid. If Flow-Information AVP(s) are supplied, they replace all previous Flow-Information AVP(s). If Flows AVP(s) are supplied, they replace all previous Flows AVP(s).\nThe Default-Bearer-Indication AVP is an indicator for the PCRF to the PCEF whether the corresponding PCC rule shall be bound to the default bearer. If the Default-Bearer-Indication AVP with value “BIND_TO_DEF_BEARER (0)” is supplied or has been supplied within the most recent Default-Bearer-Indication AVP, information within the QoS-Class-Identifier AVP and the Allocation-Retention-Priority AVP within the QoS-Information AVP shall not be used for bearer binding purposes.\nThe PS-to-CS-Session-Continuity AVP indicates if a service data flow is a candidate for PS to CS session continuity.\nFlows AVP may appear if and only if AF-Charging-Identifier AVP is also present.\nAF-Signalling-Protocol AVP may appear if the PCC Rule applies for IMS signalling.\nMonitoring-Key AVP contains the monitoring key that may apply to the PCC rule.\nMute-Notification status shall not be changed during the lifetime of the PCC rules.\nSponsor-Identity AVP and Application-Service-Provider-Identity AVP shall be included if the Reporting-Level AVP is set to the value SPONSORED_CONNECTIVITY_LEVEL for the service data flow.\nRequired-Access-Info AVP may appear if the AF requests PCRF to report user access network information.\nSharing-Key-UL AVP and/or Sharing-Key-DL AVP may appear if the PCC rule is a candidate for resource sharing.\nTraffic-Steering-Policy-Identifier-UL AVP and/or Traffic-Steering-Policy-Identifier-DL AVP may appear if the traffic steering control is required for the service data flow. If the traffic steering policies are identical in both downlink and uplink directions, the values of the Traffic-Steering-Policy-Identifier-UL AVP and the Traffic-Steering-Policy-Identifier-DL AVP shall be identical.\nThe Content-Version AVP may be included if the PCC rule is installed or modified.\nThe Max-PLR-DL AVP and/or Max-PLR-UL AVP may be included if the RAN-Support-Info feature is supported.\nThe Calling-Party-Address AVP and Callee-Information AVP may be included if VBCLTE feature is supported.\nAVP Format:\nCharging-Rule-Definition ::= < AVP Header: 1003 >\n{ Charging-Rule-Name }\n[ Service-Identifier ]\n[ Rating-Group ]\n*[ Flow-Information ]\n[ Default-Bearer-Indication ]\n[ TDF-Application-Identifier ]\n[ Flow-Status ]\n[ QoS-Information ]\n[ PS-to-CS-Session-Continuity ]\n[ Reporting-Level ]\n[ Online ]\n[ Offline ]\n[ Max-PLR-DL ]\n[ Max-PLR-UL ]\n[ Metering-Method ]\n[ Precedence ]\n[ AF-Charging-Identifier ]\n*[ Flows ]\n[ Monitoring-Key]\n0*2\t [ Redirect-Information ]\n[ Mute-Notification ]\n[ AF-Signalling-Protocol ]\n[ Sponsor-Identity ]\n[ Application-Service-Provider-Identity ]\n*[ Required-Access-Info ]\n[ Sharing-Key-DL ]\n[ Sharing-Key-UL ]\n[ Traffic-Steering-Policy-Identifier-DL ]\n[ Traffic-Steering-Policy-Identifier-UL ]\n[ Content-Version ]\n*[ Calling-Party-Address ]\n[ Callee-Information ]\n*[ AVP ]",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.5",
      "section_id": "5.3.5",
      "section_title": "Charging-Rule-Base-Name AVP (All access types)",
      "content": "The Charging-Rule-Base-Name AVP (AVP code 1004) is of type UTF8String, and it indicates the name of a pre‑defined group of PCC rules residing at the PCEF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.6",
      "section_id": "5.3.6",
      "section_title": "Charging-Rule-Name AVP (All access types)",
      "content": "The Charging-Rule-Name AVP (AVP code 1005) is of type OctetString, and it defines a name for PCC rule. For PCC rules provided by the PCRF it uniquely identifies a PCC rule within one IP CAN session. For PCC rules pre-defined at the PCEF it uniquely identifies a PCC rule within the PCEF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.7",
      "section_id": "5.3.7",
      "section_title": "Event-Trigger AVP (All access types)",
      "content": "The Event-Trigger AVP (AVP code 1006) is of type Enumerated. When sent from the PCRF to the PCEF the Event-Trigger AVP indicates an event that shall cause a re-request of PCC rules. When sent from the PCEF to the PCRF the Event-Trigger AVP indicates that the corresponding event has occurred at the gateway.\nNOTE 1:\tAn exception to the above is the Event Trigger AVP set to NO_EVENT_TRIGGERS that indicates that PCEF shall not notify PCRF of any event that requires to be provisioned.\nNOTE 2:\tThere are events that do not require to be provisioned by the PCRF, according to the value definition included in this subclause. These events will always be reported by the PCEF even though the PCRF has not provisioned them in a RAR or CCA command.\nWhenever the PCRF subscribes to one or more event triggers by using the RAR command, unless otherwise specified in an event trigger's value definition, the PCEF shall send the corresponding currently applicable values (e.g. 3GPP-SGSN-Address AVP or 3GPP-SGSN-Ipv6-Address AVP, RAT-Type, 3GPP-User-Location-Info, etc.) to the PCRF in the RAA if available, and in this case, the Event-Trigger AVPs shall not be included.\nWhenever one of these events occurs, the PCEF shall send the related AVP that has changed together with the event trigger indication.\nUnless stated for a specific value, the Event-Trigger AVP applies to all access types.\nThe values 8, 9, 10, 38 and 41 are obsolete and shall not be used.\nThe following values are defined:\nSGSN_CHANGE (0)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon the change of the serving SGSN PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because the serving SGSN changed. The new value of the serving SGSN shall be indicated in either 3GPP-SGSN-Address AVP or 3GPP-SGSN-Ipv6-Address AVP. Applicable only to 3GPP-GPRS access types and 3GPP-EPS access types with access to the P-GW using Gn/Gp.\nQOS_CHANGE (1)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon any QoS change (even within the limits of the current authorization) at bearer or APN level PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the requested QoS for a specific bearer (e.g. the previously maximum authorized QoS has been exceeded) or APN. When applicable to 3GPP-GPRS and if the PCRF performs bearer binding, the Bearer-Identifier AVP shall be provided to indicate the affected bearer. QoS-Information AVP is required to be provided in the same request with the new value. When applicable at APN level, this event trigger shall be reported when the corresponding event occurs, even if the event trigger is not provisioned by the PCRF. Not applicable for FBA.\nRAT_CHANGE (2)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a RAT change PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because of a RAT change. The new RAT type shall be provided in the RAT-Type AVP and AN-Trusted AVP if applicable. Not applicable for FBA.\nTFT_CHANGE (3)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a TFT change at bearer level PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because of a change in the TFT. The Bearer-Identifier AVP shall be provided to indicate the affected bearer. All the TFT filter definitions for this bearer, including the requested changes, but excluding the TFT filters created with NW-initiated procedures, shall be provided in TFT-Packet-Filter-Information AVP. This event trigger shall be provisioned by the PCRF at the PCEF. Applicable only to 3GPP-GPRS.\nPLMN_CHANGE (4)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a PLMN change PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because there was a change of PLMN. 3GPP-SGSN-MCC-MNC AVP shall be provided in the same request with the new value. Not applicable for FBA.\nLOSS_OF_BEARER (5)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon loss of bearer, GW should inform PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because the bearer associated with the PCC rules indicated by the corresponding Charging-Rule-Report AVP was lost. The PCC-Rule-Status AVP within the Charging-Rule-Report AVP shall indicate that these PCC rules are temporarily inactive. Applicable to GPRS and 3GPP-EPS when PGW interoperates with a Gn/Gp SGSN.The mechanism of indicating loss of bearer to the GW is IP-CAN access type specific. For GPRS, this is indicated by a PDP context modification request with Maximum Bit Rate (MBR) in QoS profile changed to 0 kbps.When the PCRF performs the bearer binding, the PCEF shall provide the Bearer-Identifier AVP to indicate the bearer that has been lost.\nRECOVERY_OF_BEARER (6)\nThis value shall be in CCA and RAR commands by the PCRF used to indicate that upon recovery of bearer, GW should inform PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because the bearer associated with the PCC rules indicated by the corresponding Charging-Rule-Report AVP was recovered. The PCC-Rule-Status AVP within the Charging-Rule-Report AVP shall indicate that these rules are active again. Applicable to GPRS and 3GPP-EPS when PGW interoperates with a Gn/Gp SGSN.The mechanism for indicating recovery of bearer to the GW is IP-CAN access type specific. For GPRS, this is indicated by a PDP context modification request with Maximum Bit Rate (MBR) in QoS profile changed from 0 kbps to a valid value.When the PCRF performs the bearer binding, the PCEF shall provide the Bearer-Identifier AVP to indicate the bearer that has been recovered.\nIP-CAN_CHANGE (7)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the IP-CAN type PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because there was a change of IP-CAN type. IP-CAN-Type AVP shall be provided in the same request with the new value. The RAT-Type AVP, AN-Trusted AVP and AN-GW-Address AVP shall also be provided when applicable to the specific IP-CAN Type. Not applicable for FBA.\nQOS_CHANGE_EXCEEDING_AUTHORIZATION (11)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that only upon a requested QoS change beyond the current authorized value(s) at bearer level PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the requested QoS beyond the authorized value(s) for a specific bearer. The Bearer-Identifier AVP shall be provided to indicate the affected bearer. QoS-Information AVP is required to be provided in the same request with the new value. Applicable only to 3GPP-GPRS.\nRAI_CHANGE (12)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the RAI, PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the RAI. The new RAI value shall be provided in the RAI AVP. If the user location has been changed but the PCEF can not get the detail location information (e.g. handover from 3G to 2G network), the PCEF shall send the RAI AVP to the PCRF by setting the LAC of the RAI to value 0x0000. Applicable only to 3GPP-GPRS and 3GPP-EPS access types.\nUSER_LOCATION_CHANGE (13)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the user location (i.e. applicable for CGI/SAI/RAI/TAI/ECGI/Macro eNB ID), PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the user location. The new location value shall be provided in the 3GPP-User-Location-Info AVP. If the user location has been changed but the PCEF can not get the detail location information (e.g. handover from 3G to 2G network), the PCEF shall send the 3GPP-User-Location-Info AVP to the PCRF by setting the LAC of the CGI/SAI to value 0x0000, LAC of the RAI to value 0x0000 for GPRS access, and setting the TAC of the TAI to value 0x0000, setting the ECI of the ECGI to value 0x0000, setting the Macro eNB ID to values 0x0000 for the EPS access.\nNOTE:\tThe access network may be configured to report location changes only when transmission resources are established in the radio access network.\nApplicable only to 3GPP-GPRS and 3GPP-EPS access types.\nNO_EVENT_TRIGGERS (14)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that PCRF does not require any Event Trigger notification except for those events that do not require subscription and are always provisioned.\nOUT_OF_CREDIT (15)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that the PCEF shall inform the PCRF about the PCC rules for which credit is no longer available, together with the applied termination action. When used in a CCR command, this value indicates that the PCEF generated the request because the PCC rules indicated by the corresponding Charging-Rule-Report AVP have run out of credit, and that the termination action indicated by the corresponding Final-Unit-Indication AVP applies (3GPP TS 32.240 [21] and 3GPP TS 32.299 [19]).\nREALLOCATION_OF_CREDIT (16)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that the PCEF shall inform the PCRF about the PCC rules for which credit has been reallocated after the former out of credit indication. When used in a CCR command, this value indicates that the PCEF generated the request because the PCC rules indicated by the corresponding Charging-Rule-Report AVP have been reallocated credit after the former out of credit indication (3GPP TS 32.240 [21] and 3GPP TS 32.299 [19]).\nREVALIDATION_TIMEOUT (17)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon revalidation timeout, the PCEF shall inform the PCRF. In order for the PCEF to report this event, it is required that the PCRF provides a revalidation time in the Revalidation-Time AVP. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a PCC revalidation timeout.\nUE_IP_ADDRESS_ALLOCATE (18)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because a UE Ipv4 address is allocated. The Framed-IP-Address AVP shall be provided in the same request. This event trigger does not require to be provisioned by the PCRF. This event trigger shall be reported when the corresponding event occurs, even if the event trigger is not provisioned by the PCRF. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nUE_IP_ADDRESS_RELEASE (19)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because a UE Ipv4 address is released. The Framed-IP-Address AVP shall be provided in the same request. This event trigger does not require to be provisioned by the PCRF. This event trigger shall be reported when the corresponding event occurs, even if the event trigger is not provisioned by the PCRF. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nDEFAULT_EPS_BEARER_QOS_CHANGE (20)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the default EPS Bearer QoS, PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the default EPS Bearer QoS. The new value shall be provided in the Default-EPS-Bearer-QoS AVP. This event trigger shall be reported when the corresponding event occurs, even if the event trigger is not provisioned by the PCRF. Not applicable for 3GPP‑GPRS and FBA access types. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1.\nAN_GW_CHANGE (21)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon the change of the serving Access Node Gateway, PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because the serving Access Node gateway changed. The new value of the serving Access Node gateway shall be indicated in the AN-GW-Address AVP. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nSUCCESSFUL_RESOURCE_ALLOCATION (22)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that the PCEF can inform the PCRF of successful resource allocation for those rules that requires so.\nWhen used in a CCR command, this value indicates that the PCEF informs the PCRF that the resources for a rule have been successfully allocated. The affected rules are indicated within the Charging-Rule-Report AVP with the PCC-Rule-Status AVP set to the value ACTIVE (0). Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. The PCEF may also indicate the Content-Version AVP(s) related to the affected PCC rule(s) within the Charging-Rule-Report. Not applicable for FBA.\nRESOURCE_MODIFICATION_REQUEST (23)\nThis value shall be used in a CCR command to indicate that PCC rules are requested for a resource modification request initiated by the UE. The Packet-Filter-Operation and Packet-Filter-Information AVPs shall be provided in the same request. This event trigger does not require to be provisioned by the PCRF. It shall be reported by the PCEF when the corresponding event occurs even if the event trigger is not provisioned by the PCRF. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nPGW_TRACE_CONTROL (24)\nThis value indicates that the command contains a trace activation or deactivation request for the P-GW. Trace activation is indicated with the presence of the Trace-Data AVP with the relevant trace parameters. Trace deactivation is indicated with the presence of the Trace-Reference AVP. This event trigger needs no subscription. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nUE_TIME_ZONE_CHANGE (25)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change to the time zone the UE is currently located in, PCC rules shall be requested. When used in a CCR command, this value indicates that the PCEF generated the request because the time zone the UE is currently located in has changed. The new value of the UE's time zone shall be indicated in the 3GPP-MS-TimeZone AVP. Not applicable for FBA.\nTAI_CHANGE (26)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the TAI, PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the TAI. The new TAI value shall be provided in the 3GPP-User-Location-Info AVP. If the user tracking area location has been changed but the PCEF can not get the detail location information, the PCEF shall send the 3GPP-User-Location-Info AVP to the PCRF by setting the TAC of the TAI to value 0x0000. Applicable only to 3GPP-EPS access type and to functionality introduced with the Rel8 feature as described in subclause 5.4.1.\nECGI_CHANGE (27)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the ECGI, PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the ECGI. The new ECGI value shall be provided in the 3GPP-User-Location-Info AVP. If the ECGI has been changed but the PCEF can not get the detail location information, the PCEF shall send the 3GPP-User-Location-Info AVP to the PCRF by setting the ECI of the ECGI to value 0x0000. Applicable only to 3GPP-EPS access type and to functionality introduced with the Rel8 feature as described in subclause 5.4.1.\nCHARGING_CORRELATION_EXCHANGE (28)\nThe PCRF shall use this value in CCA and RAR commands to indicate that the PCEF shall report the access network charging identifier associated to one or more dynamic PCC Rules within the Access-Network-Charging-Identifier-Gx AVP. In order for the PCEF to report this event, it is required that the Charging-Correlation-Indicator AVP with value CHARGING_IDENTIFIER_REQUIRED is provided. Not applicable for FBA.\nWhen used in a CCR command, this value indicates that an access network charging identifier has been assigned. The actual value shall be reported with the Access-Network-Charging-Identifier-Gx AVP. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1.\nAPN-AMBR_MODIFICATION_FAILURE (29)\nThe PCEF shall use this value to indicate to the PCRF that APN-AMBR modifications have failed. The PCEF shall use this value in a new CCR command that indicates the failure of either a PUSH initiated modification or a PULL initiated modification. This event trigger needs no subscription. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nUSER_CSG_INFORMATION_CHANGE (30)\nThe PCRF shall use this value to indicate a request of reporting the event that the user enters/leaves a CSG cell.\nWhen the user enters a CSG cell, the User-CSG-Information AVP shall also be provided with the event report in the CCR command. Applicable to functionality introduced with the Rel9 feature as described in subclause 5.4.1. Not applicable for FBA.\nUSAGE_REPORT (33)\nThis value shall be used in a CCA and RAR commands by the PCRF when requesting usage monitoring at the PCEF. In order for the PCEF to report this event, it is required that the PCRF provides in a CCA or RAR command the Usage-Monitoring-Information AVP(s) including the Monitoring-Key AVP and the Granted-Service-Unit AVP.\nWhen used in a CCR command, this value indicates that the PCEF generated the request to report the accumulated usage for one or more monitoring keys. The PCEF shall also provide the accumulated usage volume and/or time using the Usage-Monitoring-Information AVP(s) including the Monitoring-Key AVP and the Used-Service-Unit AVP. Applicable to functionality introduced with the Rel9 feature for volume usage reporting, with the ADC feature and with the TimeBasedUM feature for time usage reporting, as described in subclause 5.4.1.\nDEFAULT-EPS-BEARER-QOS_MODIFICATION_FAILURE (34)\nThe PCEF shall use this value to indicate to the PCRF that Default EPS Bearer QoS modifications have failed. The PCEF shall use this value in a new CCR command that indicates the failure of either a PUSH initiated modification or a PULL initiated modification. This event trigger needs no subscription. Applicable to functionality introduced with the Rel8 feature as described in subclause 5.4.1. Not applicable for FBA.\nUSER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE (35)\nThe PCRF shall use this value to indicate a request of reporting the event that the user enters/leaves a hybrid cell that the user subscribes to.\nWhen the user enters a hybrid cell where the user is a member, the User-CSG-Information AVP shall also be provided with the event report in the CCR command. Applicable to functionality introduced with the Rel9 feature as described in subclause 5.4.1. Not applicable for FBA.\nUSER_CSG_ HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE (36)\nThe PCRF shall use this value to indicate a request of reporting the event that the user enters/leaves a hybrid cell that the user does not subscribe to.\nWhen the user enters a hybrid cell where the user is not a member, the User-CSG-Information AVP shall be provided with the event report in the CCR command. Applicable to functionality introduced with the Rel9 feature as described in subclause 5.4.1. Not applicable for FBA.\nROUTING_RULE_CHANGE (37)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the IP flow mobility routing rules for s2c based IP flow mobility (installation/modification/removal of the IP flow mobility routing rule) or a change in the NBIFOM routing rules for NBIFOM (installation/modification/removal of the NBIFOM routing rule). The new IP flow mobility/NBIFOM routing rule information shall be provided in the Routing‑Rule‑Definition AVP within the same CCR command. This event trigger needs no subscription. Applicable only to IPFlowMobility functionality feature (IFOM) or NBIFOM functionality feature as described in subclause 5.4.1. Not applicable for FBA.\nAPPLICATION_START (39)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that the PCEF shall inform the PCRF when the start of the application's traffic for the application, required for detection, has been identified, unless a request to mute such a notification (Mute-Notification AVP) is part of the corresponding Charging-Rule-Definition AVP.\nWhen used in a CCR command, this value indicates that the PCEF identified the start of the corresponding application's traffic for an applicationidentified by a TDF-Application-Identifier AVP.The detected application(s) shall be identified by the Application-Detection-Information AVP(s). Applicable to functionality introduced with the ADC feature as described in subclause 5.4.1.\nFor unsolicited application reporting, APPLICATION_START Event Trigger is always set and does not need to be subscribed by the PCRF.\nNOTE 1:\tFor solicited application reporting, APPLICATION_START is always provided together with APPLICATION_STOP, when used by the PCRF in CCA and RAR commands sent to the PCEF.\nAPPLICATION_STOP (40)\nThis value shall be used in a CCA and RAR commands by the PCRF to indicate that the PCEF shall inform the PCRF when the stop of the application's traffic for the application, required for detection, has been identified, unless a request to mute such a notification (Mute-Notification AVP) is part of the corresponding Charging-Rule-Definition AVP.\nWhen used in a CCR command, this value indicates that the PCEF identified the stop of the corresponding application's traffic for an applicationidentified by a TDF-Application-Identifier AVP . The detected application(s) shall be identified by the Application-Detection-Information AVP(s). Applicable to functionality introduced with the ADC feature as described in subclause 5.4.1.\nFor unsolicited application reporting, APPLICATION_STOP Event Trigger is always set and does not need to be subscribed by the PCRF.\nCS_TO_PS_HANDOVER (42)\nThis value shall be used in CCA and RAR command by the PCRF to indicate that upon a CS to PS Handover, the PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there is a CS to PS handover. Applicable only to CS to PS SRVCC functionality feature (rSRVCC) as described in subclause 5.4.1.\nUE_LOCAL_IP_ADDRESS_CHANGE (43)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because the UE Local IP Address or the UDP source port number or both assigned by the Fixed Broadband Access have changed. The UE-Local-IP-Address AVP and/or the UDP-Source-Port AVP shall be provided in the same request. This event trigger does not require to be provisioned by the PCRF. Applicable to functionality introduced with the EPC-routed feature as described in subclause 5.4.1.\nH(E)NB_LOCAL_IP_ADDRESS_CHANGE (44)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because the H(e)NB Local IP Address or the UDP source port number or both assigned by the Fixed Broadband Access have changed. The HeNB-Local-IP-Address AVP and/or the UDP-Source-Port AVP shall be provided in the same request. Applicable to functionality introduced with the EPC-routed feature as described in subclause 5.4.1.\nACCESS_NETWORK_INFO_REPORT (45)\nThis value shall be used in CCA and RAR commands by the PCRF to request access network information from the PCEF as defined in clause 4.5.22. When used in a CCR command, this value indicates that the PCEF generated the request because the PCEF reports the corresponding access network information to the PCRF as requested. The PCEF shall not provide the requested access network information in an RAA command solely based on the fact that the PCRF provisioned this Event-Trigger in an RAR command. Instead, procedures defined in subclause 4.5.22 shall be followed. Applicable to functionality introduced with the NetLoc feature as described in subclause 5.4.1.\nCREDIT_MANAGEMENT_SESSION_FAILURE (46)\nWhen used in a CCR command, this value indicates that a transient/permanent failure has been detected in the OCS. If the failure does not apply to all PCC Rules, the affected PCC Rules are indicated within the Charging-Rule-Report AVP, with the PCC-Rule-Status set to value ACTIVE and the Rule-Failure-Code AVP set to the corresponding value as reported by the OCS. If the failure applies to the session, the Credit-Management-Status shall be set to the corresponding value as reported by the OCS. When used over Sd reference point, it is applicable to functionality introduced with the ABC features as described in subclause 5.4.1.\nNOTE 2:\tFor the PCEF, CREDIT_MANAGEMENT_SESSION_FAILURE event trigger only applies to the situation that the IP-CAN session is not terminated by the PCEF due to the credit management session failure.\nDEFAULT_QOS_CHANGE (47)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon any Default QoS change PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the Default QoS. The new value shall be provided in the Default-QoS-Information AVP. Applicable only to FBA access type and to functionality introduced with the FBAC feature as described in subclause 5.4.1.\nCHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT (48)\nThis value shall be used in CCA or RAR commands by the PCRF to indicate that the PCEF shall report the event when the user enters/leaves the area as indicated in the Presence-Reporting-Area-Information AVP. This includes reporting the initial status at the time the request for reports is initiated.\nWhen used in a CCR command, this value indicates whether the UE is within or outside the requested presence reporting area. Presence-Reporting-Area-Identifier AVP and Presence-Reporting-Area-Status AVP shall be provided in the same request included in Presence-Reporting-Area-Information AVP. Applicable only to 3GPP-EPS access type and to functionality introduced with the CNO-ULI or Multiple-PRA feature as described in subclause 5.4.1.\nADDITION_OF_ACCESS (49)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because an access is added in the NBIFOM scenario. The new IP-CAN type of the new accessis provided within the same CCR command. This event trigger needs no subscription. Applicable only to NBIFOM functionality feature as described in subclause 5.4.1. Not applicable for FBA.\nREMOVAL_OF_ACCESS (50)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because an access is removed in the NBIFOM scenario. The IP-CAN type of the removed access is provided within the same CCR command. This event trigger needs no subscription. Applicable only to NBIFOM functionality feature as described in subclause 5.4.1. Not applicable for FBA.\nUNAVAILABLITY_OF_ACCESS (51)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because an access is not availabl in the NBIFOM scenario. The IP-CAN type of the unavailable access within the IP-CAN-Type AVP and the reason causing the access to be unavailable within the Access-Availability-Change-Reason AVP are provided within the same CCR command. This event trigger needs no subscription. Applicable only to NBIFOM functionality feature as described in subclause 5.4.1. Not applicable for FBA.\nAVAILABLITY_OF_ACCESS (52)\nWhen used in a CCR command, this value indicates that the PCEF generated the request because an access is available again in the NBIFOM scenario or PCEF receives an Access stratum indication as defined in 3GPP TS 29.274 [22]. The IP-CAN type of the available access within the IP-CAN-Type AVP and the reason causing the access to be available within the Access-Availability-Change-Reason AVP are provided within the same CCR command. When the PCEF receives the move-to-wlan or move-from-wlan indication, the IP-CAN type of the WLAN or 3GPP access within the IP-CAN-Type AVP and the reason of Access stratum indication within the Access-Availability-Change-Reason AVP are provided within the same CCR command. This event trigger needs no subscription. Applicable only to NBIFOM functionality feature as described in subclause 5.4.1. Not applicable for FBA.\nRESOURCE_RELEASE (53)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that the PCEF can inform the PCRF of the outcome of the release of resources for those rules that require so.\nWhen used in a CCR command, this value indicates that the PCEF informs the PCRF about the outcome of the resource release for a rule that has been removed. The affected rules are indicated within the Charging-Rule-Report AVP with the PCC-Rule-Status AVP set to the value INACTIVE (1). If the PCEF receives from the access network some RAN/NAS release cause(s), TWAN release cause(s) or untrusted WLAN release cause(s), the PCEF shall also provide the received cause(s) in the Charging-Rule-Report AVP. Applicable to functionality introduced with the Enh-RAN-NAS-Cause feature as described in subclause 5.4.1. Not applicable for FBA.\nENODEB_CHANGE (54)\nThis value shall be used in CCA and RAR commands by the PCRF to indicate that upon a change in the user location of eNB change granularity, PCEF shall inform the PCRF. When used in a CCR command, this value indicates that the PCEF generated the request because there has been a change in the user location of eNB change granularity, the new eNB ID value shall be provided in the 3GPP-User-Location-Info AVP. Applicable only to 3GPP-EPS access type and to functionality introduced with the ENB-Change feature as described in subclause 5.4.1.\n3GPP_PS_DATA_OFF_CHANGE (55)\nThis value shall be used in CCR command by the PCEF to indicate that the PCEF generated the request because there has been a change of 3GPP PS Data Off status indicated by the UE, with the status of 3GPP PS Data Off in the 3GPP-PS-Data-Off-Status AVP. This event trigger needs no subscription. Applicable only to 3GPP-EPS access type and to functionality introduced with the 3GPP-PS-Data-Off feature as described in subclause 5.4.1.\nUE_STATUS_RESUME (56)\nThis value shall be used in RAR and CCA commands by the PCRF to indicate that the PCEF shall report the event when the user’s status is changed from suspend to resume. When used in a CCR command by the PCEF, this value indicates that the UE’s status is resumed. Applicable only to 3GPP-EPS access type and to functionality introduced with the UE-Status-Change feature as described in subclause 5.4.1.\nSUCCESSFUL_QOS_UPDATE (57)\nThis value shall be used in the RAR command by the PCRF to indicate that the PCEF shall inform the PCRF when resources for the MPS for DTS invocation/revocation are successfully allocated for MPS for DTS, as described in subclause 4.5.19.1.4.\nWhen used in a CCR command by the PCEF, this value indicates that the requested resources for the MPS for DTS invocation/revocation have been successfully allocated. Applicable only to 3GPP-EPS access type and to functionality introduced with the MPSforDTS feature as described in clause 5.4.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.1",
        "clause_4.5.22",
        "clause_4.5.19.1.4",
        "ts_32.240",
        "ts_32.299",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.8",
      "section_id": "5.3.8",
      "section_title": "Metering-Method AVP (All access types)",
      "content": "The Metering-Method AVP (AVP code 1007) is of type Enumerated, and it defines what parameters shall be metered for offline charging. The PCEF may use the AVP for unit request in online charging in case of decentralized unit determination, refer to 3GPP TS 32.299 [19].\nThe following values are defined:\nDURATION (0)\nThis value shall be used to indicate that the duration of the service data flow traffic shall be metered.\nVOLUME (1)\nThis value shall be used to indicate that volume of the service data flow traffic shall be metered.\nDURATION_VOLUME (2)\nThis value shall be used to indicate that the duration and the volume of the service data flow traffic shall be metered.\nEVENT (3)\nThis value shall be used to indicate that events of the service data flow traffic shall be metered.\nNOTE:\tEvent based charging is only applicable to predefined PCC rule using a service data flow filter and any PCC rule (predefined and dynamic) using an application detection filter (i.e. with an application identifier).\nIf the Metering-Method AVP is omitted but has been supplied previously, the previous information remains valid. If the Metering-Method AVP is omitted and has not been supplied previously, the metering method pre-configured at the PCEF is applicable as default metering method.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_32.299"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.9",
      "section_id": "5.3.9",
      "section_title": "Offline AVP (All access types)",
      "content": "The Offline AVP (AVP code 1008) is of type Enumerated.\nIf the Offline AVP is embedded within a Charging-Rule-definition AVP it defines whether the offline charging interface from the PCEF for the associated PCC rule shall be enabled. The absence of this AVP within the first provisioning of the Charging-Rule-definition AVP of a new PCC rule indicates that the default charging method for offline shall be used.\nIf the Offline AVP is embedded within the initial CCR on command level, it indicates the default charging method for offline pre-configured at the PCEF is applicable as default charging method for offline. The absence of this AVP within the initial CCR indicates that the charging method for offline pre-configured at the PCEF is not available.\nIf the Offline AVP is embedded within the initial CCA on command level, it indicates the default charging method for offline. The absence of this AVP within the initial CCA indicates that the charging method for offline pre-configured at the PCEF is applicable as default charging method for offline.\nThe default charging method provided by the PCRF shall take precedence over any pre-configured default charging method at the PCEF.\nThe following values are defined:\nDISABLE_OFFLINE (0)\nThis value shall be used to indicate that the offline charging interface for the associated PCC rule shall be disabled.\nENABLE_OFFLINE (1)\nThis value shall be used to indicate that the offline charging interface for the associated PCC rule shall be enabled.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.10",
      "section_id": "5.3.10",
      "section_title": "Online AVP (All access types)",
      "content": "The Online AVP (AVP code 1009) is of type Enumerated.\nIf the Online AVP is embedded within a Charging-Rule-definition AVP, it defines whether the online charging interface from the PCEF for the associated PCC rule shall be enabled. The absence of this AVP within the first provisioning of the Charging-Rule-Definition AVP of a new PCC rule indicates that the default charging method for online shall be used.\nIf the Online AVP is embedded within the initial CCR on command level, it indicates the default charging method for online pre-configured at the PCEF is applicable as default charging method for online. The absence of this AVP within the initial CCR indicates that the charging method for online pre-configured at the PCEF is not available.\nIf the Online AVP is embedded within the initial CCA on command level, it indicates the default charging method for online. The absence of this AVP within the initial CCA indicates that the charging method for online pre-configured at the PCEF is applicable as default charging method for online.\nThe default charging method provided by the PCRF shall take precedence over any pre-configured default charging method at the PCEF.\nThe following values are defined:\nDISABLE_ONLINE (0)\nThis value shall be used to indicate that the online charging interface for the associated PCC rule shall be disabled.\nENABLE_ONLINE (1)\nThis value shall be used to indicate that the online charging interface for the associated PCC rule shall be enabled.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.11",
      "section_id": "5.3.11",
      "section_title": "Precedence AVP (All access types)",
      "content": "The Precedence AVP (AVP code 1010) is of type Unsigned32.\nWithin the Charging Rule Definition AVP, the Precedence AVP determines the order, in which service data flow templates consisting of service data flow filters are applied at service data flow detection at the PCEF. For PCC rules with an application detection filter, the Precedence AVP only determines which PCC rule is applicable for the detected application for the enforcement of QoS, for charging control, for reporting of application start and stop and for usage monitoring. A PCC rule with the Precedence AVP with lower value shall be applied before a PCC rule with the Precedence AVP with higher value.\nNOTE 1:\tFor PCRF-initiated IP-CAN session modification cases where the PCEF creates new service data flow filters (e.g. mapping into new TFT-UL filters), the PCEF need to make an appropriate mapping between the value of the Precedence AVP from the PCC rule and the precedence information of the traffic mapping information filter. The PCEF have to maintain the order of the precedence information provided by the PCRF for the PCC rules with the precedence information of the new traffic mapping information filters. For UE-initiated IP-CAN session modification cases, according to 3GPP TS 23.060 [17], the precedence of the traffic mapping information filter provided by the UE is not modified by the PCEF. Also see access specific annexes for mapping of Precedence AVP from the PCC rule and the precedence information of the traffic mapping information filter.\nNOTE 2:\tThe precedence value range defined within the PCC rule is operator configurable and can be set based on the IP-CAN type.\nThe Precedence AVP is also used within the TFT-Packet-Filter-Information AVP to indicate the evaluation precedence of the Traffic Mapping Information filters (for GPRS the TFT packet filters) as received from the UE. The PCEF shall assign a lower value in the corresponding Precedence AVP to a Traffic Mapping Information filter with a higher evaluation precedence than to a Traffic Mapping Information filter with a lower evaluation precedence.\nThe Precedence AVP is also used within the Routing-Rule-Definition AVP to indicate the evaluation precedence of the routing filters contained as within the IP flow mobility routing rules or NBIFOM routing rules. A lower value in the Precedence AVP indicates higher evaluation precedence. The PCEF shall assign the lowest evaluation precedence to a Routing filter containg the wild card filter.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.12",
      "section_id": "5.3.12",
      "section_title": "Reporting-Level AVP (All access types)",
      "content": "The Reporting-Level AVP (AVP code 1011) is of type Enumerated, and it defines on what level the PCEF reports the usage for the related PCC rule. The following values are defined:\nSERVICE_IDENTIFIER_LEVEL (0)\nThis value shall be used to indicate that the usage shall be reported on service id and rating group combination level, and is applicable when the Service-Identifier and Rating-Group have been provisioned within the Charging-Rule-Definition AVP.\nRATING_GROUP_LEVEL (1)\nThis value shall be used to indicate that the usage shall be reported on rating group level, and is applicable when the Rating-Group has been provisioned within the Charging-Rule-Definition AVP.\nSPONSORED_CONNECTIVITY_LEVEL (2)\nThis value shall be used to indicate that the usage shall be reported on sponsor identity and rating group combination level, and is applicable when the Sponsor-IdentityAVP, Application-Service-Provider-Identity AVP and Rating-Group AVP have been provisioned within the Charging-Rule-Definition AVP. Applicable for offline charging.\nIf the Reporting-Level AVP is omitted but has been supplied previously, the previous information remains valid. If the Reporting-Level AVP is omitted and has not been supplied previously, the reporting level pre-configured at the PCEF is applicable as default reporting level.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.13",
      "section_id": "5.3.13",
      "section_title": "TFT-Filter AVP (3GPP-GPRS access type only)",
      "content": "The TFT-Filter AVP (AVP code 1012) is of type IPFilterRule, and it contains the flow filter for one TFT packet filter. The TFT-Filter AVP is derived from the Traffic Flow Template (TFT) defined in 3GPP TS 24.008 [13]. The following information shall be sent:\n-\tAction shall be set to \"permit\".\n-\tDirection shall be set to \"out\".\n-\tProtocol shall be set to the value provided within the TFT packet filter parameter \"Protocol Identifier/Next Header Type\". If the TFT packet filter parameter \"Protocol Identifier/Next Header Type\" is not provided within the TFT packet filter, Protocol shall be set to \"ip\".\n-\tSource IP address (possibly masked). The source IP address shall be derived from TFT packet filter parameters \"Remote address\" and \"Subnet Mask\". The source IP address shall be set to \"any\", if no such information is provided in the TFT packet filter.\n-\tSource and/or destination port (single value, list or ranges). The information shall be derived from the corresponding TFT packet filter remote and/or local port parameters. Source and/or destination port(s) shall be omitted if the corresponding information is not provided in the TFT packet filter.\n-\tDestination IP address (possibly masked). The Destination IP address shall be derived from TFT packet filter parameters \"Local address\" and \"Subnet Mask\". If no such information is provided in the TFT packet filter, the Destination IP address shall be set to \"assigned\".\nThe IPFilterRule type shall be used with the following restrictions:\n-\tNo options shall be used.\n-\tThe invert modifier \"!\" for addresses shall not be used.\nThe direction \"out\" indicates that the IPFilterRule \"source\" parameters correspond to the TFT filter \"remote\" parameters in the packet filter and the IPFilterRule \"destination\" correspond to the TFT filter \"local\" (UE end) parameters. The TFT-Filter AVP applies in the direction(s) as specified in the accompanying Flow-Direction AVP.\nDestination IP address including the value provided by the UE may be provided within the TFT-Filter AVP when the ExtendedFilter feature is supported as described in clause 5.4.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.1",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.14",
      "section_id": "5.3.14",
      "section_title": "TFT-Packet-Filter-Information AVP (3GPP-GPRS access type only)",
      "content": "The TFT-Packet-Filter-Information AVP (AVP code 1013) is of type Grouped, and it contains the information from a single TFT packet filter including the evaluation precedence, the filter and the Type-of-Service/Traffic Class sent from the PCEF to the PCRF. The PCEF shall include one TFT-Packet-Filter-Information AVP for each TFT packet filter applicable at a PDP context within each PCC rule request corresponding to that PDP context. TFT-Packet-Filter-Information AVPs are derived from the Traffic Flow Template (TFT) defined in 3GPP TS 24.008 [13].\nAVP Format:\nTFT-Packet-Filter-Information ::= < AVP Header: 1013 >\n[ Precedence ]\n[ TFT-Filter ]\n[ ToS-Traffic-Class ]\n[ Security-Parameter-Index ]\n[ Flow-Label ]\n[ Flow-Direction ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.15",
      "section_id": "5.3.15",
      "section_title": "ToS-Traffic-Class AVP (All access types)",
      "content": "The ToS-Traffic-Class AVP (AVP code 1014) is of type OctetString, and is encoded on two octets. The first octet contains the Ipv4 Type-of-Service or the Ipv6 Traffic-Class field and the second octet contains the ToS/Traffic Class mask field. One example is that of a TFT packet filter as defined in 3GPP TS 24.008 [13].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.16",
      "section_id": "5.3.16",
      "section_title": "QoS-Information AVP (All access types)",
      "content": "The QoS-Information AVP (AVP code 1016) is of type Grouped, and it defines the QoS information for resources requested by the UE, an IP-CAN bearer, PCC rule, QCI or APN. When this AVP is sent from the PCEF to the PCRF, it indicates the requested QoS information associated with resources requested by the UE, an IP CAN bearer or the subscribed QoS information at APN level. When this AVP is sent from the PCRF to the PCEF, it indicates the authorized QoS for:\n-\tan IP CAN bearer (when appearing at CCA or RAR command level or\n-\ta service data flow (when included within the PCC rule) or\n-\ta QCI (when appearing at CCA or RAR command level with the QoS-Class-Identifier AVP and the Maximum-Requested-Bandwidth-UL AVP and/or the Maximum-Requested-Bandwidth-DL AVP) or\n-\tan APN (when appearing at CCA or RAR command level with APN-Aggregate-Max-Bitrate-UL and APN-Aggregate-Max-Bitrate-DL or Extended-APN-AMBR-UL and Extended-APN-AMBR-DL).\nThe QoS class identifier identifies a set of IP-CAN specific QoS parameters that define QoS, excluding the applicable bitrates and ARP. It is applicable both for uplink and downlink direction.\nThe Max-Requested-Bandwidth-UL and the Extended-Max-Requested-BW-UL define the maximum bit rate allowed for the uplink direction.\nThe Max-Requested-Bandwidth-DL and the Extended-Max-Requested-BW-DL defines the maximum bit rate allowed for the downlink direction.\nThe Guaranteed-Bitrate-UL and the Extended-GBR-UL define the guaranteed bit rate allowed for the uplink direction.\nThe Guaranteed-Bitrate-DL and the Extended-GBR-DL define the guaranteed bit rate allowed for the downlink direction.\nThe APN-Aggregate-Max-Bitrate-UL and the Extended-APN-AMBR-UL define the total bandwidth usage for the uplink direction of non-GBR QCIs at the APN.\nThe APN-Aggregate-Max-Bitrate-DL and the Extended-APN-AMBR-DL define the total bandwidth usage for the downlink direction of non-GBR QCIs at the APN.\nThe Conditional-APN-Aggregate-Max-Bitrate defines total bandwidth usage for the uplink and downlink direction of non-GBR QCIs at the APN, with condition.\nThe Bearer Identifier AVP shall be included as part of the QoS-Information AVP if the QoS information refers to an IP CAN bearer initiated by the UE and the PCRF performs the bearer binding. The Bearer Identifier AVP identifies this bearer. Several QoS-Information AVPs for different Bearer Identifiers may be provided per command.\nWhen the QoS-Information AVP is provided within the CCR command along with the RESOURCE_MODIFICATION_REQUEST event trigger, the QoS-information AVP includes only the QoS-Class-Identifier AVP and Guaranteed-Bitrate-UL and/or Guaranteed-Bitrate-DL AVPs or Extended-GBR-UL and/or Extended-GBR-DL AVPs (see subclause 4.5.30).\nThe Allocation-Retention-Priority AVP is an indicator of the priority of allocation and retention for the Service Data Flow.\nIf the QoS-Information AVP has been supplied previously but is omitted in a Diameter message or AVP, the previous information remains valid. If the QoS-Information AVP has not been supplied from the PCRF to the PCEF previously and is omitted in a Diameter message or AVP, no enforcement of the authorized QoS shall be performed.\nAVP Format:\nQoS-Information ::= < AVP Header: 1016 >\n[ QoS-Class-Identifier ]\n[ Max-Requested-Bandwidth-UL ]\n[ Max-Requested-Bandwidth-DL ]\n[ Extended-Max-Requested-BW-UL ]\n[ Extended-Max-Requested-BW-DL ]\n[ Guaranteed-Bitrate-UL ]\n[ Guaranteed-Bitrate-DL ]\n[ Extended-GBR-UL ]\n[ Extended-GBR-DL ]\n[ Bearer-Identifier ]\n[ Allocation-Retention-Priority ]\n[ APN-Aggregate-Max-Bitrate-UL ]\n[ APN-Aggregate-Max-Bitrate-DL ]\n[ Extended-APN-AMBR-UL ]\n[ Extended-APN-AMBR-DL ]\n*[ Conditional-APN-Aggregate-Max-Bitrate ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.17",
      "section_id": "5.3.17",
      "section_title": "QoS-Class-Identifier AVP (All access types)",
      "content": "QoS-Class-Identifier AVP (AVP code 1028) is of type Enumerated, and it identifies a set of IP-CAN specific QoS parameters that define the authorized QoS, excluding the applicable bitrates and ARP for the IP-CAN bearer or service data flow. The allowed values for the standard QCIs are defined in Table 6.1.7 of 3GPP TS 23.203 [7].\nThe following values are defined:\nQCI_1 (1)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 1 from 3GPP TS 23.203 [7].\nQCI_2 (2)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 2 from 3GPP TS 23.203 [7].\nQCI_3 (3)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 3 from 3GPP TS 23.203 [7].\nQCI_4 (4)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 4 from 3GPP TS 23.203 [7].\nQCI_5 (5)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 5 from 3GPP TS 23.203 [7].\nQCI_6 (6)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 6 from 3GPP TS 23.203 [7].\nQCI_7 (7)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 7 from 3GPP TS 23.203 [7].\nQCI_8 (8)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 8 from 3GPP TS 23.203 [7].\nQCI_9 (9)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 9 from 3GPP TS 23.203 [7].\nQCI_65 (65)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 65 from 3GPP TS 23.203 [7].\nQCI_66 (66)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 66 from 3GPP TS 23.203 [7].\nQCI_67 (67)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 67 from 3GPP TS 23.203 [7].\nQCI_69 (69)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 69 from 3GPP TS 23.203 [7].\nQCI_70 (70)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 70 from 3GPP TS 23.203 [7].\nQCI_71 (71)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 71 from 3GPP TS 23.203 [7].\nQCI_72 (72)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 72 from 3GPP TS 23.203 [7].\nQCI_73 (73)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 73 from 3GPP TS 23.203 [7].\nQCI_74 (74)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 74 from 3GPP TS 23.203 [7].\nQCI_75 (75)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 75 from 3GPP TS 23.203 [7].\nQCI_76 (76)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 76 from 3GPP TS 23.203 [7].\nQCI_79 (79)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 79 from3GPP TS 23.203 [7] .\nQCI_80 (80)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 80 from 3GPP TS 23.203 [7].\nQCI_82 (82)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 82 from 3GPP TS 23.203 [7].\nQCI_83 (83)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 83 from 3GPP TS 23.203 [7].\nQCI_84 (84)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 84 from 3GPP TS 23.203 [7].\nQCI_85 (85)\nThis value shall be used to indicate standardized characteristics associated with standardized QCI value 85 from 3GPP TS 23.203 [7].\nThe QCI values 0, 10 – 64, 68, 77 – 78, 81, and 86 ‑ 255 are divided for usage as follows:\n0: Reserved\n10-64: Spare\n68: Spare\n77-78: Spare\n81: Spare\n86-127: Spare\n128-254: Operator specific\n255: Reserved\nNOTE:\tFor the different use of the terms \"Reserved\" and \"Spare\" see clause 9.9.4.3 in 3GPP TS 24.301 [42].\nTable 5.3.17.1: Void",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_24.301_clause_9.9.4.3",
        "ts_23.203_table_6.1.7",
        "ts_24.301_table_5.3.17.1",
        "ts_23.203",
        "ts_24.301"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.18",
      "section_id": "5.3.18",
      "section_title": "Charging-Rule-Report AVP (All access types)",
      "content": "The Charging-Rule-Report AVP (AVP code 1018) is of type Grouped, and it is used to report the status of PCC rules.\nCharging-Rule-Name AVP is a reference for a specific PCC rule at the PCEF that has been successfully installed, modified or removed (for dynamic PCC rules), or activated or deactivated (for predefined PCC rules) because of trigger from the MS. Charging-Rule-Base-Name AVP is a reference for a group of PCC rules predefined at the PCEF that has been successfully activated or deactivated because of trigger from the MS.\nThe Charging-Rule-Report AVP can also be used to report the status of the PCC rules which cannot be installed/activated or enforced at the PCEF. In this condition, the Charging-Rule-Name AVP is used to indicate a specific PCC rule which cannot be installed/activated or enforced, and the Charging-Rule-Base-Name AVP is used to indicate a group of PCC rules which cannot be activated. The Rule-Failure-Code indicates the reason that the PCC rules cannot be successfully installed/activated or enforced.\nThe Charging-Rule-Report AVP can also be used to report the status of the PCC rules for which credit is no longer available or credit has been reallocated after the former out of credit indication or credit management session failure has been detected by the OCS. When reporting an out of credit condition, the Final-Unit-Indication AVP indicates the termination action the PCEF applies to the PCC rules as instructed by the OCS.\nThe Charging-Rule-Report AVP can also be used to report the status of the PCC rules for which corresponding NBIFOM routing rule was rejected by the UE or which corresponding access is removed. In the case that UE rejects the NBIFOM routing rule, the Charging-Rule-Name AVP is used to indicate a specific PCC rule which corresponding NBIFOM routing rule was rejected. The Rule-Failure-Code AVP indicates the reason for the rejection of the routing rule.\nFor GPRS scenarios where the bearer binding is performed by the PCRF, the Bearer-Identifier AVP may be included within the Charging-Rule-Report AVP.\nIf the RuleVersioning feature is supported, the Content-Version AVP(s) shall be included if it was included in the Charging-Rule-Definition AVP when the corresponding PCC rule was installed or modified.\nAVP Format:\nCharging-Rule-Report ::= < AVP Header: 1018 >\n*[ Charging-Rule-Name ]\n*[ Charging-Rule-Base-Name ]\n[ Bearer-Identifier ]\n[ PCC-Rule-Status ]\n[ Rule-Failure-Code ]\n[ Final-Unit-Indication ]\n*[ RAN-NAS-Release-Cause ]\n*[ Content-Version ]\n*[ AVP ]\nMultiple instances of Charging-Rule-Report AVPs shall be used in the case it is required to report different PCC-Rule-Status or Rule-Failure-Code values for different groups of rules within the same Diameter command. If the Content-Version is included in a Charging-Rule-Report AVP, then only the one corresponding Charging-Rule-Name AVP shall be included.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.19",
      "section_id": "5.3.19",
      "section_title": "PCC-Rule-Status AVP (All access types)",
      "content": "The PCC-Rule-Status AVP (AVP code 1019) is of type Enumerated, and describes the status of one or a group of PCC Rules.\nThe following values are defined:\nACTIVE (0)\nThis value is used to indicate that the PCC rule(s) are successfully installed (for those provisioned from PCRF) or activated (for those pre-provisioned in PCEF).\nINACTIVE (1)\nThis value is used to indicate that the PCC rule(s) are removed (for those provisioned from PCRF) or inactive (for those pre-provisioned in PCEF).\nTEMPORARILY INACTIVE (2)\nThis value is used to indicate that, for some reason (e.g. loss of bearer), already installed or activated PCC rules are temporarily disabled.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.20",
      "section_id": "5.3.20",
      "section_title": "Bearer-Identifier AVP (Applicable access type 3GPP-GPRS)",
      "content": "The Bearer-Identifier AVP (AVP code 1020) is of type OctetString, and it indicates the bearer to which specific information refers.\nWhen present within a CC-Request Diameter command, subsequent AVPs within the CC-Request refer to the specific bearer identified by this AVP.\nThe bearer identifier of an IP CAN bearer shall be unique within the corresponding IP CAN session. The bearer identifier shall be selected by the PCEF.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.21",
      "section_id": "5.3.21",
      "section_title": "Bearer-Operation AVP (Applicable access type 3GPP-GPRS)",
      "content": "The Bearer-Operation AVP (AVP code 1021) is of type of Enumerated, and it indicates the bearer event that causes a request for PCC rules. This AVP shall be supplied if the bearer event relates to an IP CAN bearer initiated by the UE.\nThe following values are defined:\nTERMINATION (0)\nThis value is used to indicate that a bearer is being terminated.\nESTABLISHMENT (1)\nThis value is used to indicate that a new bearer is being established.\nMODIFICATION (2)\nThis value is used to indicate that an existing bearer is being modified.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.22",
      "section_id": "5.3.22",
      "section_title": "Access-Network-Charging-Identifier-Gx AVP (All access types)",
      "content": "The Access-Network-Charging-Identifier-Gx AVP (AVP code 1022) is of type Grouped. It contains a charging identifier (e.g. GCID) within the Access-Network-Charging-Identifier-Value AVP, when applicable, and the related PCC rule name(s) within the Charging-Rule-Name AVP(s) and/or within the Charging-Rule-Base-Name AVP(s). If the charging identifier applies to the entire IP CAN session, no Charging-Rule-Name AVPs or Charging-Rule-Base-Name AVPs need to be provided. Otherwise, all the Charging-Rule-Name AVPs or Charging-Rule-Base-Name AVPs corresponding to PCC rules associated to the provided Access-Network-Charging-Identifier-Value shall be included.\nNOTE 1: During the IP-CAN Session Establishment no Charging-Rule-Name AVPs or Charging-Rule-Base-Name AVPs are provided regardless if the charging identifier applies to the entire IP-CAN session or to the default bearer since the PCC Rules are not yet authorized at this stage.\nNOTE 2:\tFor Case 1 and GPRS, the charging identifier for an IP-CAN bearer is provided together with all the Charging-Rule-Name AVPs or Charging-Rule-Base-Name AVPs corresponding to PCC rules activated or installed within the IP-CAN bearer.\nThe Access-Network-Charging-Identifier-Gx AVP can be sent from the PCEF to the PCRF. The PCRF may use this information for charging correlation towards the AF.\nAVP Format:\nAccess-Network-Charging-Identifier-Gx ::= \t< AVP Header: 1022 >\n{ Access-Network-Charging-Identifier-Value}\n*[ Charging-Rule-Base-Name ]\n*[ Charging-Rule-Name ]\n[ IP-CAN-Session-Charging-Scope ]\n*[ AVP ]",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.23",
      "section_id": "5.3.23",
      "section_title": "Bearer-Control-Mode AVP",
      "content": "The Bearer-Control-Mode AVP (AVP code 1023) is of type of Enumerated. It is sent from PCRF to PCEF and indicates the PCRF selected bearer control mode.\nThe following values are defined:\nUE_ONLY (0)\nThis value is used to indicate that the UE shall request any resource establishment, modification or termination.\nRESERVED (1)\nThis value is not used in this Release.\nUE_NW (2)\nThis value is used to indicate that both the UE and PCEF may request any resource establishment, modification or termination by adding, modifying or removing traffic flow information.\nSee Annex A.3.8 for particularities in 3GPP-GPRS access.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.24",
      "section_id": "5.3.24",
      "section_title": "Network-Request-Support AVP",
      "content": "The Network-Request-Support AVP (AVP code 1024) is of type of Enumerated and indicates the UE and network support of the network initiated procedures.\nIf the Network Request Support AVP has not been previously provided, its absence shall indicate the value NETWORK_REQUEST NOT SUPPORTED. If the Network Request Support AVP has been provided, its value shall remain valid until it is provided the next time.\nThe following values are defined:\nNETWORK_REQUEST NOT SUPPORTED (0)\nThis value is used to indicate that the UE and the access network do not support the network initiated bearer establishment request procedure.\nNETWORK_REQUEST SUPPORTED (1)\nThis value is used to indicate that the UE and the access network support the network initiated bearer establishment request procedure.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.25",
      "section_id": "5.3.25",
      "section_title": "Guaranteed-Bitrate-DL AVP",
      "content": "The Guaranteed-Bitrate-DL AVP (AVP code 1025) is of type Unsigned32, and it indicates the guaranteed bitrate in bits per second for a downlink service data flow. The bandwidth contains all the overhead coming from the IP-layer and the layers above, e.g. IP, UDP, RTP and RTP payload.\nWhen the Extended-BW-NR feature is supported and the value to be transmitted exceeds 2^32-1, the Extended-GBR-DL AVP shall be used; see subclause 4.5.30 and subclause 5.3.136.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30",
        "clause_5.3.136"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.26",
      "section_id": "5.3.26",
      "section_title": "Guaranteed-Bitrate-UL AVP",
      "content": "The Guaranteed–Bitrate-UL AVP (AVP code 1026) is of type Unsigned32, and it indicates the guaranteed bitrate in bits per second for an uplink service data flow. The bandwidth contains all the overhead coming from the IP-layer and the layers above, e.g. IP, UDP, RTP and RTP payload.\nWhen the Extended-BW-NR feature is supported and the value to be transmitted exceeds 2^32-1, the Extended-GBR-UL AVP shall be used; see subclause 4.5.30 and subclause 5.3.137.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30",
        "clause_5.3.137"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.27",
      "section_id": "5.3.27",
      "section_title": "IP-CAN-Type AVP (All access types)",
      "content": "The IP-CAN-Type AVP (AVP code 1027) is of type Enumerated, and it shall indicate the type of Connectivity Access Network in which the user is connected.\nThe IP-CAN-Type AVP shall always be present during the IP-CAN session establishment. During an IP-CAN session modification, this AVP shall be present when there has been a change in the IP-CAN type and the PCRF requested to be informed of this event. The Event-Trigger AVP with value IP-CAN-CHANGE shall be provided together with the IP-CAN-Type AVP.\nNOTE 1:\tThe informative Annex C presents a mapping between the code values for different access network types.\nThe following values are defined:\n3GPP-GPRS (0)\nThis value shall be used to indicate that the IP-CAN is associated with a 3GPP GPRS access that is connected to the GGSN based on the Gn/Gp interfaces and is further detailed by the RAT-Type AVP. RAT-Type AVP will include applicable 3GPP values, except EUTRAN (WB-EUTRAN) , EUTRAN-NB-IoT and LTE-M.\nDOCSIS (1)\nThis value shall be used to indicate that the IP-CAN is associated with a DOCSIS access.\nxDSL (2)\nThis value shall be used to indicate that the IP-CAN is associated with an xDSL access.\nWiMAX (3)\nThis value shall be used to indicate that the IP-CAN is associated with a WiMAX access (IEEE 802.16).\n3GPP2 (4)\nThis value shall be used to indicate that the IP-CAN is associated with a 3GPP2 access connected to the 3GPP2 packet core as specified in 3GPP2 X.S0011 [20] and is further detailed by the RAT-Type AVP.\n3GPP-EPS (5)\nThis value shall be used to indicate that the IP-CAN is associated with a 3GPP EPS access and is further detailed by the RAT-Type AVP.\nNon-3GPP-EPS (6)\nThis value shall be used to indicate that the IP-CAN is associated with an EPC based non-3GPP access and is further detailed by the RAT-Type AVP and AN-Trusted AVP if applicable.\nFBA (7)\nThis value shall be used to indicate that the IP-CAN is associated with any kind of Fixed Broadband Network access convergence via the IP Edge (e.g, xDSL, Fiber).\n3GPP-5GS (8)\nThis value shall be used to indicate that the IP-CAN is associated with a 3GPP 5GS access and is further detailed by the RAT-Type AVP. RAT-Type AVP will include applicable 3GPP values, except EUTRAN-NB-IoT and LTE-M.\nNOTE 2:\tThis value is not used in the present specification.\nNon-3GPP-5GS (9)\nThis value shall be used to indicate that the IP-CAN is associated with a 5GS based non-3GPP access.\nNOTE 3:\tThis value is not used in the present specification.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.28",
      "section_id": "5.3.28",
      "section_title": "QoS-Negotiation AVP (3GPP-GPRS Access Type only)",
      "content": "The QoS-Negotiation AVP (AVP code 1029) is of type Enumerated. The value of the AVP indicates for a single PCC rule request if the PCRF is allowed to negotiate the QoS by supplying in the answer to this request an authorized QoS different from the requested QoS.\nNOTE:\tThe indicated value of the QoS-Negotiation AVP has no significance for any later PCC rule request.The following values are defined:\nNO_QoS_NEGOTIATION (0)\nThis value indicates that a QoS negotiation is not allowed for the corresponding PCC rule request.\nQoS_NEGOTIATION_SUPPORTED (1)\nThis value indicates that a QoS negotiation is allowed for the corresponding PCC rule request. This is the default value applicable if this AVP is not supplied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.29",
      "section_id": "5.3.29",
      "section_title": "QoS-Upgrade AVP (3GPP-GPRS Access Type only)",
      "content": "The QoS-Upgrade AVP (AVP code 1030) is of type Enumerated. The value of the AVP indicates whether the SGSN supports that the GGSN upgrades the QoS in a Create PDP context response or Update PDP context response. If the SGSN does not support a QoS upgrade, the PCRF shall not provision an authorized bitrates (e.g. GBR, MBR) which are higher than the requested bitrates for this IP CAN bearer in the response of the IP-CAN session establishment or modification. The setting is applicable to the bearer indicated in the request within the Bearer-Identifier AVP.\nIf no QoS-Upgrade AVP has been supplied for an IP CAN bearer, the default value QoS_UPGRADE_NOT_SUPPORTED is applicable. If the QoS-Upgrade AVP has previously been supplied for an IP CAN bearer but is not supplied in a new PCC rule request, the previously supplied value remains applicable.\nThe following values are defined:\nQoS_UPGRADE_NOT_SUPPORTED (0)\nThis value indicates that the IP-CAN bearer does not support the upgrading of the requested QoS. This is the default value applicable if no QoS-Upgrade AVP has been supplied for an IP CAN bearer.\nQoS_UPGRADE_SUPPORTED (1)\nThis value indicates that the IP-CAN bearer supports the upgrading of the requested QoS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.30",
      "section_id": "5.3.30",
      "section_title": "Event-Report-Indication AVP (All access types)",
      "content": "The Event-Report-Indication AVP (AVP code 1033) is of type Grouped. When sent from the PCRF to the PCEF, it is used to report an event coming from the Access Network GW (BBERF) and relevant info to the PCEF. When sent from the PCEF to the PCRF, it is used to provide the information about the required event triggers to the PCRF. Only Event-Trigger AVP will be supplied in this case.\nThe PCEF may require adding new event triggers or removing the already provided ones. In order to do so, the PCEF shall provide the new complete list of applicable event triggers within the Event-Trigger AVP included in the Event-Report-Indication AVP to the PCRF.\nThe PCEF may require removing all previously provided event triggers by providing the Event-Trigger AVP set to the value NO_EVENT_TRIGGERS included in the Event-Report-Indication AVP to the PCRF.\nIf the event triggers required by the PCEF are associated with certain parameter values, the PCRF shall provide those values to the PCEF.\nWhenever the PCEF subscribes to an event report indication by using the CCR command, the PCRF shall only send the corresponding currently applicable values which have been updated (e.g. 3GPP-User-Location-Info, 3GPP2-BSID, etc.) to the PCEF in the CCA if available. In this case, the Event-Trigger AVPs shall not be included.\nNOTE 1:\tThe PCRF can get the currently applicable values during the IP-CAN session establishment procedure or during the information reporting from the BBERF when the BBERF gets event subscription from the PCRF as defined in clause 5.3.7.\nThe PCEF may subscribe to different or common set of event triggers at different BBERFs by including the Routing-IP-Address AVP in the Event-Report-Indication AVP to the PCRF.\nThe PCEF may provide the following Event-Trigger values to the PCRF: RAI_CHANGE, RAT_CHANGE, USER_LOCATION_CHANGE, UE_TIME_ZONE_CHANGE, USER_CSG_INFORMATION_CHANGE, USER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE, USER_CSG_ HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE, TAI_CHANGE, ECGI_CHANGE and ENODEB_CHANGE.\nApplicability of the Event-Triggers to the different accesses is defined in clause 5.3.7.\nAVP Format:\nEvent-Report-Indication ::= < AVP Header: 1033 >\n[ AN-Trusted ]\n*[ Event-Trigger ]\n[ User-CSG-Information ]\n[ IP-CAN-Type ]\n0*2 [ AN-GW-Address ]\n[ 3GPP-SGSN-Address ]\n[ 3GPP-SGSN-Ipv6-Address ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ Framed-IP-Address ]\n[ RAT-Type ]\n[ RAI ]\n[ 3GPP-User-Location-Info ]\n[ Trace-Data ]\n[ Trace-Reference ]\n[ 3GPP2-BSID ]\n[ 3GPP-MS-TimeZone ]\n[ Routing-IP-Address ]\n[ UE-Local-IP-Address ]\n[ HeNB-Local-IP-Address ]\n[ UDP-Source-Port ]\n[ Presence-Reporting-Area-Information ]\n*[ AVP ]\nNOTE 2:\tThe IP-CAN-Type, AN-GW-Address, AN-Trusted, 3GPP-SGSN-Address, 3GPP-SGSN-Ipv6-Address, 3GPP-SGSN-MCC-MNC, Framed-IP-Address, UE-Local-IP-Address, HeNB-Local-IP-Address and UDP-Source-Port, Presence-Reporting-Area-Information AVPs are not applicable to the Gx interface.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.7"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.31",
      "section_id": "5.3.31",
      "section_title": "RAT-Type AVP",
      "content": "The RAT-Type AVP (AVP code 1032) is of type Enumerated and is used to identify the radio access technology that is serving the UE. It may be further detailed by AN-Trusted if applicable.\nNOTE 1:\tValues 0-999 are used for generic radio access technologies that can apply to different IP-CAN types and are not IP-CAN specific.\nNOTE 2:\tValues 1000-1999 are used for 3GPP specific radio access technology types.\nNOTE 3:\tValues 2000-2999 are used for 3GPP2 specific radio access technology types.\nNOTE 4:\tThe informative Annex C presents a mapping between the code values for different access network types.\nThe following values are defined:\nWLAN (0)\nThis value shall be used to indicate that the RAT is WLAN.\nVIRTUAL (1)\nThis value shall be used to indicate that the RAT is unknown. For further details refer to 3GPP TS 29.274 [22].\nTRUSTED- N3GA (2)\nThis value shall be used to indicate that the RAT is a trusted non-3GPP access, different than Trusted Wireless LAN (IEEE 802.11) access.\nNOTE 5:\t\tThis value is not used in the present specification.\nWIRELINE (3)\nThis value shall be used to indicate that the transmission technology is wireline access. It is used when it is not possible to differentiate between wireline cable and wireline BBF.\nNOTE 6:\tThis value is not used in the present specification.\nWIRELINE-CABLE (4)\nThis value shall be used to indicate that the transmission technology is wireline cable.\nNOTE 7:\t\tThis value is not used in the present specification.\nWIRELINE-BBF (5)\nThis value shall be used to indicate that the transmission technology is wireline BBF.\nNOTE 8:\t\tThis value is not used in the present specification.\nUTRAN (1000)\nThis value shall be used to indicate that the RAT is UTRAN. For further details refer to 3GPP TS 29.060 [18].\nGERAN (1001)\nThis value shall be used to indicate that the RAT is GERAN. For further details refer to 3GPP TS 29.060 [18].\nGAN (1002)\nThis value shall be used to indicate that the RAT is GAN. For further details refer to 3GPP TS 29.060 [18] and 3GPP TS 43.318 [29].\nHSPA_EVOLUTION (1003)\nThis value shall be used to indicate that the RAT is HSPA Evolution. For further details refer to 3GPP TS 29.060 [18].\nEUTRAN (1004)\nThis value shall be used to indicate that the RAT is EUTRAN (WB-EUTRAN) terrestrial RAT type. For further details refer to 3GPP TS 29.274 [22].\nEUTRAN-NB-IoT (1005)\nThis value shall be used to indicate that the RAT is NB-IoT. For further details refer to 3GPP TS 29.274 [22].\nNR (1006)\nThis value shall be used to indicate that the RAT is NR.\nNOTE 9:\tThis value is not used in the present specification.\nLTE-M (1007)\nThis value shall be used to indicate that the RAT is LTE-M. For further details refer to 3GPP TS 29.274 [22].\nNR-U (1008)\nThis value shall be used to indicate that the RAT is NR in unlicensed bands.\nNOTE 10:\tThis value is not used in the present specification.\nEUTRAN(LEO) (1011)\nThis value shall be used to indicate that the RAT is WB-EUTRAN(LEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN(MEO) (1012)\nThis value shall be used to indicate that the RAT is WB-EUTRAN(MEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN(GEO) (1013)\nThis value shall be used to indicate that the RAT is WB-EUTRAN(GEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN(OTHERSAT) (1014)\nThis value shall be used to indicate that the RAT is WB-EUTRAN(OTHERSAT). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN-NB-IoT(LEO) (1021)\nThis value shall be used to indicate that the RAT is NB-IoT(LEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN-NB-IoT(MEO) (1022)\nThis value shall be used to indicate that the RAT is NB-IoT(MEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN-NB-IoT(GEO) (1023)\nThis value shall be used to indicate that the RAT is NB-IoT(GEO). For further details refer to 3GPP TS 29.274 [22].\nEUTRAN-NB-IoT(OTHERSAT) (1024)\nThis value shall be used to indicate that the RAT is NB-IoT(OTHERSAT). For further details refer to 3GPP TS 29.274 [22].\nLTE-M(LEO) (1031)\nThis value shall be used to indicate that the RAT is LTE-M(LEO). For further details refer to 3GPP TS 29.274 [22].\nLTE-M(MEO) (1032)\nThis value shall be used to indicate that the RAT is LTE-M(MEO). For further details refer to 3GPP TS 29.274 [22].\nLTE-M(GEO) (1033)\nThis value shall be used to indicate that the RAT is LTE-M(GEO). For further details refer to 3GPP TS 29.274 [22].\nLTE-M(OTHERSAT) (1034)\nThis value shall be used to indicate that the RAT is LTE-M(OTHERSAT). For further details refer to 3GPP TS 29.274 [22].\nNR(LEO) (1035)\nThis value shall be used to indicate that the RAT is NR(LEO).\nNOTE 11:\tThis value is not used in the present document.\nNR(MEO) (1036)\nThis value shall be used to indicate that the RAT is NR(MEO).\nNOTE 12:\tThis value is not used in the present document.\nNR(GEO) (1037)\nThis value shall be used to indicate that the RAT is NR(GEO).\nNOTE 13:\tThis value is not used in the present document.\nNR(OTHERSAT) (1038)\nThis value shall be used to indicate that the RAT is NR(OTHERSAT).\nNOTE 14:\tThis value is not used in the present document.\nNR-REDCAP (1039)\nThis value shall be used to indicate that the RAT is NR-REDCAP.\nNOTE 15:\tThis value is not used in the present document.\nNR-EREDCAP (1040)\nThis value shall be used to indicate that the RAT is NR-EREDCAP.\nNOTE 16:\tThis value is not used in the present document.\nCDMA2000_1X (2000)\nThis value shall be used to indicate that the RAT is CDMA2000 1X. For further details refer to 3GPP2 X.S0011 [20].\nHRPD (2001)\nThis value shall be used to indicate that the RAT is HRPD. For further details refer to 3GPP2 X.S0011 [20].\nUMB (2002)\nThis value shall be used to indicate that the RAT is UMB. For further details refer to 3GPP2 X.S0011 [20].\nEHRPD (2003)\nThis value shall be used to indicate that the RAT is eHRPD. For further details refer to 3GPP2 X.S0057 [24].\nNOTE 17:\tRAT type value to indicate that the RAT is EUTRAN (WB-EUTRAN) in unlicensed bands is not defined, since it is not applicable over Gx/Rx interface.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274",
        "ts_29.060",
        "ts_43.318"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.32",
      "section_id": "5.3.32",
      "section_title": "Allocation-Retention-Priority AVP (All access types)",
      "content": "The Allocation-Retention-Priority AVP (AVP code 1034) is of type Grouped, and it is used to indicate the priority of allocation and retention, the pre-emption capability and pre-emption vulnerability for the SDF if provided within the QoS-Information-AVP or for the EPS default bearer if provided within the Default-EPS-Bearer-QoS AVP.\nThe Priority-Level AVP of the default bearer should be set to a sufficiently high level of priority and the ARP pre-emption vulnerability of the default bearer should be set appropriately to minimize the risk for unexpected PDN disconnection or UE detach from the network according to operator specific policies.\nAVP Format:\nAllocation-Retention-Priority ::= < AVP Header: 1034 >\n{ Priority-Level }\n[ Pre-emption-Capability ]\n[ Pre-emption-Vulnerability ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.33",
      "section_id": "5.3.33",
      "section_title": "CoA-IP-Address AVP (All access types)",
      "content": "The CoA-IP-Address AVP (AVP Code 1035) is of type Address and contains the mobile node's care-of-address. The care-of-address type may be Ipv4 or Ipv6.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.34",
      "section_id": "5.3.34",
      "section_title": "Tunnel-Header-Filter AVP (All access types)",
      "content": "The Tunnel-Header-Filter AVP (AVP code 1036) is of type IPFilterRule, and it defines the tunnel (outer) header filter information of a MIP tunnel where the associated QoS rules apply for the tunnel payload.\nThe Tunnel-Header-Filter AVP shall include the following information:\n-\tAction shall be set to \"permit\";\n-\tDirection (in or out);\n-\tProtocol;\n-\tSource IP address;\n-\tSource port (single value) for UDP tunneling;\n-\tDestination IP address;\n-\tDestination port (single value) for UDP tunneling.\nThe IPFilterRule type shall be used with the following restrictions:\n-\tOptions shall not be used.\n-\tThe invert modifier \"!\" for addresses shall not be used.\nThe direction \"out\" refers to downlink direction.\nThe direction \"in\" refers to uplink direction.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.35",
      "section_id": "5.3.35",
      "section_title": "Tunnel-Header-Length AVP (All access types)",
      "content": "The Tunnel-Header-Length AVP (AVP code 1037) is of type Unsigned32. This AVP indicates the length of the tunnel header in octets.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.36",
      "section_id": "5.3.36",
      "section_title": "Tunnel-Information AVP (All access types)",
      "content": "The Tunnel-Information AVP (AVP code 1038) is of type Grouped, and it contains the tunnel (outer) header information from a single IP flow. The Tunnel-Information AVP is sent from the PCEF to the PCRF and from the PCRF to the BBERF.\nThe Tunnel-Information AVP may include only the Tunnel-Header-Length AVP, only the Tunnel-Header-Filter AVP, or both.\nThe Tunnel-Header-Length AVP provides the length of the tunnel header and identifies the offset where the tunnelled payload starts. The BBERF uses the length value provided in Tunnel-Header-Length AVP to locate the inner IP header and perform service data flow detection and related QoS control.\nThe Tunnel-Header-Filter AVP identifies the tunnel (outer) header information in the downlink and uplink directions.\nAVP Format:\nTunnel-Information ::= < AVP Header: 1038 >\n[ Tunnel-Header-Length ]\n2 [ Tunnel-Header-Filter ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.37",
      "section_id": "5.3.37",
      "section_title": "CoA-Information AVP (All access types)",
      "content": "The CoA-Information AVP (AVP code 1039) is of type Grouped, and it contains care-of-address and the tunnel information related to the care of address. The CoA-Information AVP is sent from the PCEF to the PCRF.\nWhen used, the CoA-Information AVP shall include a CoA-IP-Address AVP. The CoA-Information AVP shall also include a Tunnel-Information AVP, which provides the tunnel header length and tunnel header filter information related to the specific care-of-address.\nAVP Format:\nCoA-Information ::= < AVP Header: 1039>\n{ Tunnel-Information }\n{ CoA-IP-Address }\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.38",
      "section_id": "5.3.38",
      "section_title": "Rule-Failure-Code AVP (All access types)",
      "content": "The Rule-Failure-Code AVP (AVP code 1031) is of type Enumerated. It is sent by the PCEF to the PCRF within a Charging-Rule-Report AVP to identify the reason a PCC Rule is being reported.\nThe following values are defined:\nUNKNOWN_RULE_NAME (1)\nThis value is used to indicate that the pre-provisioned PCC rule could not be successfully activated because the Charging-Rule-Name or Charging-Rule-Base-Name is unknown to the PCEF.\nRATING_GROUP_ERROR (2)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced because the Rating-Group specified within the Charging-Rule-Definition AVP by the PCRF is unknown or, invalid.\nSERVICE_IDENTIFIER_ERROR (3)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced because the Service-Identifier specified within the Charging-Rule-Definition AVP by the PCRF is invalid, unknown, or not applicable to the service being charged.\nGW/PCEF_MALFUNCTION (4)\nThis value is used to indicate that the PCC rule could not be successfully installed (for those provisioned from the PCRF) or activated (for those pre-provisioned in PCEF) or enforced (for those already successfully installed) due to GW/PCEF malfunction.\nRESOURCES_LIMITATION (5)\nThis value is used to indicate that the PCC rule could not be successfully installed (for those provisioned from PCRF) or activated (for those pre-provisioned in PCEF) or enforced (for those already successfully installed) due to a limitation of resources at the PCEF.\nMAX_NR_BEARERS_REACHED (6)\nThis value is used to indicate that the PCC rule could not be successfully installed (for those provisioned from PCRF) or activated (for those pre-provisioned in PCEF) or enforced (for those already successfully installed) due to the fact that the maximum number of bearers has been reached for the IP-CAN session.\nUNKNOWN_BEARER_ID (7)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced at the PCEF because the Bearer-Id specified within the Charging-Rule-Install AVP by the PCRF is unknown or invalid. Applicable only for GPRS in the case the PCRF performs the bearer binding.\nMISSING_BEARER_ID (8)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced at the PCEF because the Bearer-Id is not specified within the Charging-Rule-Install AVP by the PCRF. Applicable only for GPRS in the case the PCRF performs the bearer binding.\nMISSING_FLOW_INFORMATION (9)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced because neither the Flow-Information AVP nor TDF-Application-Identifier AVP is specified within the Charging-Rule-Definition AVP by the PCRF during the first install request of the PCC rule.\nRESOURCE_ALLOCATION_FAILURE (10)\nThis value is used to indicate that the PCC rule could not be successfully installed or maintained since the bearer establishment/modification failed, or the bearer was released.\nUNSUCCESSFUL_QOS_VALIDATION (11)\nThis value is used to:\n-\tindicate that the QoS validation has failed or,\n-\tIndicate when Guaranteed Bandwidth > Max-Requested-Bandwidth.\nINCORRECT_FLOW_INFORMATION (12)\nThis value is used to indicate that the PCC rule could not be successfully installed or modified at the PCEF because the provided flow information is not supported by the network (e.g. the provided IP address(es) or Ipv6 prefix(es) do not correspond to an IP version applicable for the IP-CAN session).\nPS_TO_CS_HANDOVER (13)\nThis value is used to indicate that the PCC rule could not be maintained because of PS to CS handover. This value is only applicable for 3GPP-GPRS and 3GPP-EPS. Applicable to functionality introduced with the Rel9 feature as described in subclause 5.4.1.\nTDF_APPLICATION_IDENTIFIER_ERROR (14)\nThis value is used to indicate that the rule could not be successfully installed or enforced because the TDF-Application-Identifier is invalid, unknown, or not applicable to the application required for detection.\nNO_BEARER_BOUND (15)\nThis value is used to indicate that there is no IP-CAN bearer which the PCEF can bind the PCC rule(s) to.\nFILTER_RESTRICTIONS (16)\nThis value is used to indicate that the Flow-Description AVP(s) cannot be handled by the PCEF because any of the restrictions specified in subclause 5.4.2 was not met.\nAN_GW_FAILED (17)\nThis value is used to indicate that the AN-Gateway has failed and that the PCRF should refrain from sending policy decisions to the PCEF until it is informed that the S-GW has been recovered. This value shall not be used if the IP-CAN Session Modification procedure is initiated for PCC rule removal only.\nMISSING_REDIRECT_SERVER_ADDRESS (18)\nThis value is used to indicate that the PCC rule could not be successfully installed or enforced at the PCEF because there is no valid Redirect_Server_Address within the Redirect-Server-Address AVP provided by the PCRF and no preconfigured redirection address for this PCC rule at the PCEF.\nCM_END_USER_SERVICE_DENIED (19)\nThis value is used to indicate that the charging system denied the service request due to service restrictions (e.g. terminate rating group) or limitations related to the end-user, for example the end-user's account could not cover the requested service. When used over Sd reference point, it is applicable to functionality introduced with the ABC feature as described in subclause 5b.4.1.\nCM_CREDIT_CONTROL_NOT_APPLICABLE (20)\nThis value is used to indicate that the charging system determined that the service can be granted to the end user but no further credit control is needed for the service (e.g. service is free of charge or is treated for offline charging). When used over Sd reference point, it is applicable to functionality introduced with the ABC feature as described in subclause 5b.4.1.\nCM_AUTHORIZATION_REJECTED (21)\nThis value is used to indicate that the charging system denied the service request in order to terminate the service for which credit is requested. When used over Sd reference point, it is applicable to functionality introduced with the ABC feature as described in subclause 5b.4.1.\nCM_USER_UNKNOWN (22)\nThis value is used to indicate that the specified end user could not be found in the charging system. When used over Sd reference point, it is applicable to functionality introduced with the ABC feature as described in subclause 5b.4.1.\nCM_RATING_FAILED (23)\nThis value is used to inform the PCRF that the charging system cannot rate the service request due to insufficient rating input, incorrect AVP combination or due to an AVP or an AVP value that is not recognized or supported in the rating. When used over Sd reference point, it is applicable to functionality introduced with the ABC feature as described in subclause 5b.4.1.\nROUTING_RULE_REJECTION (24)\nThis value is used to inform the PCRF that the PCC rule cannot be enforced due to the corresponding NBIFOM routing rule is rejected by the UE because of the unspecified reason. Applicable to functionality introduced with the NBIFOM feature as described in subclause 5.4.1.\nUNKNOWN_ROUTING_ACCESS_INFORMATION (25)\nThis value is used to inform the PCRF that the PCC rule cannot be enforced due to the corresponding NBIFOM routing rule is rejected by the UE because of the access information indicated in the PCC rule is unknown for the UE. Applicable to functionality introduced with the NBIFOM feature as described in subclause 5.4.1.\nNO_NBIFOM_SUPPORT (26)\nThis value is used to inform the PCRF that the PCEF has discovered that NBIFOM is not supported. Applicable to functionality introduced with the NBIFOM feature as described in subclause 5.4.1.\nUE_STATE_SUSPEND (27)\nThis value is used to inform the PCRF that the PCEF has discovered that the UE is in suspend state. Applicable to functionality introduced with the UE-Status-Change feature as described in subclause 5.4.1.\nTRAFFIC_STEERING_ERROR (28)\nThis value is used to inform the PCRF that the steering of traffic to the Gi-LAN failed, or the dynamic PCC rule could not be successfully installed because e.g. the provided traffic steering identifier(s) are invalid. Applicable when the functionality introduced with the TSC feature described in subclause 5.4.1 applies, and, when used over Sd reference point, when the TSC feature as described in subclause 5b.4.1 applies.\nSAME_TIME_ERROR (29)\nThis value is used to inform the PCRF that the the PCC rule cannot be enforced because the Rule-Activation-Time and Rule-Deactivation-Time are specified with the same time.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.1",
        "clause_5.4.2",
        "clause_5"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.39",
      "section_id": "5.3.39",
      "section_title": "APN-Aggregate-Max-Bitrate-DL AVP",
      "content": "The APN-Aggregate-Max-Bitrate-DL AVP (AVP code 1040) is of type Unsigned32, and it indicates the maximum aggregate bit rate in bits per seconds for the downlink direction across all non-GBR bearers related with the same APN.\nWhen provided in a CC-Request, it indicates the subscribed maximum bitrate and/or the maximum bitrate retained in the PCEF. When provided in a CC-Answer, it indicates the maximum bandwidth authorized by PCRF.\nWhen the Extended-BW-NR feature is supported and the value to be transmitted exceeds 2^32-1, the Extended-APN-AMBR-DL AVP shall be used; see subclause 4.5.30 and subclause 5.3.134.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30",
        "clause_5.3.134"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.40",
      "section_id": "5.3.40",
      "section_title": "APN-Aggregate-Max-Bitrate-UL AVP",
      "content": "The APN-Aggregate-Max-Bitrate-UL AVP (AVP code 1041) is of type Unsigned32, and it indicates the maximum aggregate bit rate in bits per seconds for the uplink direction across all non-GBR bearers related with the same APN.\nWhen provided in a CC-Request, it indicates the subscribed maximum bandwidth and/or the maximum bitrate retained in the PCEF. When provided in a CC-Answer, it indicates the maximum bandwidth authorized by PCRF.\nWhen the Extended-BW-NR feature is supported and the value to be transmitted exceeds 2^32-1, the Extended-APN-AMBR-DL AVP shall be used; see subclause 4.5.30 and subclause 5.3.135.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.30",
        "clause_5.3.135"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.41",
      "section_id": "5.3.41",
      "section_title": "Revalidation-Time (ALL Access Types)",
      "content": "The Revalidation-Time AVP (AVP code 1042) is of type Time. This value indicates the NTP time before which the PCEF will have to re-request PCC rules. This value only applies when the event trigger value REVALIDATION_TIMEOUT is provisioned together with Revalidation-Time AVP or has been already provisioned via CCA or RAR.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.42",
      "section_id": "5.3.42",
      "section_title": "Rule-Activation-Time (ALL Access Types)",
      "content": "The Rule-Activation-Time AVP (AVP code 1043) is of type Time. This value indicates the NTP time at which the PCC rule has to be enforced. The AVP is included in Charging-Rule-Install AVP and is applicable for all the PCC rules included within the Charging-Rule-Install AVP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.43",
      "section_id": "5.3.43",
      "section_title": "Rule-Deactivation-Time (ALL Access Types)",
      "content": "The Rule-Deactivation-Time AVP (AVP code 1044) is of type Time. This value indicates the NTP time at which the PCEF has to stop enforcing the PCC rule. The AVP is included in Charging-Rule-Install AVP and is applicable for all the PCC rules included within the Charging-Rule-Install AVP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.44",
      "section_id": "5.3.44",
      "section_title": "Session-Release-Cause (All access types)",
      "content": "Session-Release-Cause AVP (AVP code 1045) is of type Enumerated, and determines the cause of release the IP-CAN session by the PCRF. The following values are defined:\nUNSPECIFIED_REASON (0)\nThis value is used for unspecified reasons.\nUE_SUBSCRIPTION_REASON (1)\nThis value is used to indicate that the subscription of UE has changed (e.g. removed) and the session needs to be terminated.\nINSUFFICIENT_SERVER_RESOURCES (2)\nThis value is used to indicate that the server is overloaded and needs to abort the session.\nIP_CAN_SESSION_TERMINATION (3)\nThis value is used to indicate that the corresponding IP-CAN session is terminated. The IP_CAN_SESSION_TERMINATION value is introduced in order to be used by Sd only, when PCRF initiates the TDF session termination within IP-CAN session termination.\nUE_IP_ADDRESS_RELEASE (4)\nThis value is used to indicate that the Ipv4 address of a dual stack IP-CAN session is released. The UE_IP_ADDRESS_RELEASE value is introduced in order to be used by Sd only, when PCRF initiates the TDF session termination if the Ipv4 address of a dual stack IP-CAN session is released and if there is an active Ipv4 address related TDF session for that IP-CAN session.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.45",
      "section_id": "5.3.45",
      "section_title": "Priority-Level AVP (All access types)",
      "content": "The Priority-Level AVP (AVP code 1046) is of type Unsigned 32. The AVP is used for deciding whether a bearer establishment or modification request can be accepted or needs to be rejected in case of resource limitations (typically used for admission control of GBR traffic). The AVP can also be used to decide which existing bearers to pre-empt during resource limitations. The priority level defines the relative importance of a resource request.\nValues 1 to 15 are defined, with value 1 as the highest level of priority.\nValues 1 to 8 should only be assigned for services that are authorized to receive prioritized treatment within an operator domain. Values 9 to 15 may be assigned to resources that are authorized by the home network and thus applicable when a UE is roaming.\nNOTE:\tThe Priority-Level AVP can be used in addition to the QoS-Class-Identifier AVP to determine the user plane transport level packet marking, e.g. to set the DSCP marking of the associated EPS bearer.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.46",
      "section_id": "5.3.46",
      "section_title": "Pre-emption-Capability AVP",
      "content": "The Pre-emption-Capability AVP (AVP code 1047) is of type Enumerated. If it is provided within the QoS-Information AVP, the AVP defines whether a service data flow can get resources that were already assigned to another service data flow with a lower priority level. If it is provided within the Default-EPS-Bearer-QoS AVP, the AVP defines whether the default bearer can get resources that were already assigned to another bearer with a lower priority level.\nThe following values are defined:\nPRE-EMPTION_CAPABILITY_ENABLED (0)\nThis value indicates that the service data flow or bearer is allowed to get resources that were already assigned to another service data flow or bearer with a lower priority level.\nPRE-EMPTION_CAPABILITY_DISABLED (1)\nThis value indicates that the service data flow or bearer is not allowed to get resources that were already assigned to another service data flow or bearer with a lower priority level. This is the default value applicable if this AVP is not supplied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.47",
      "section_id": "5.3.47",
      "section_title": "Pre-emption-Vulnerability AVP",
      "content": "The Pre-emption Vulnerability AVP (AVP code 1048) is of type Enumerated. If it is provided within the QoS-Information AVP, the AVP defines whether a service data flow can lose the resources assigned to it in order to admit a service data flow with higher priority level. If it is provided within the Default-EPS-Bearer-QoS AVP, the AVP defines whether the default bearer can lose the resources assigned to it in order to admit a pre-emption capable bearer with a higher priority level.\nThe following values are defined:\nPRE-EMPTION_VULNERABILITY_ENABLED (0)\nThis value indicates that the resources assigned to the service data flow or bearer can be pre-empted and allocated to a service data flow or bearer with a higher priority level. This is the default value applicable if this AVP is not supplied.\nPRE-EMPTION_VULNERABILITY_DISABLED (1)\nThis value indicates that the resources assigned to the service data flow or bearer shall not be pre-empted and allocated to a service data flow or bearer with a higher priority level.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.48",
      "section_id": "5.3.48",
      "section_title": "Default-EPS-Bearer-QoS AVP",
      "content": "The Default-EPS-Bearer-QoS AVP (AVP code 1049) is of type Grouped, and it defines the QoS information for the EPS default bearer. When this AVP is sent from the PCEF to the PCRF, it indicates the subscribed QoS for the default EPS bearer and/or the retained QoS for the default EPS bearer in the PCEF. When this AVP is sent from the PCRF to the PCEF, it indicates the authorized QoS for the default EPS bearer.\nThe QoS class identifier identifies a set of IP-CAN specific QoS parameters that define QoS, excluding the applicable bitrates and ARP. When included in the Default-EPS-Bearer-QoS AVP, it shall include only non-GBR values.\nThe Allocation-Retention-Priority AVP is an indicator of the priority of allocation and retention for the default bearer.\nAVP Format:\nDefault-EPS-Bearer-QoS::= \t< AVP Header: 1049 >\n[ QoS-Class-Identifier ]\n[ Allocation-Retention-Priority ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.49",
      "section_id": "5.3.49",
      "section_title": "AN-GW-Address AVP (All access types)",
      "content": "The AN-GW-Address AVP (AVP code 1050) is of type Address, and it contains the control plane Ipv4 and/ or Ipv6 (if available) address(es) of the access node gateway (SGW for 3GPP and AGW/ePDG for non-3GPP networks).\nNOTE:\tIf both Ipv4 and Ipv6 addresses are provided then two instances of this AVP are required in Diameter commands",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.50",
      "section_id": "5.3.50",
      "section_title": "Resource-Allocation-Notification AVP (All access types)",
      "content": "The Resource-Allocation-Notification AVP (AVP code 1063) is of type Enumerated.\nIf the Resource-Allocation-Notification AVP is included within a Charging-Rule-Install AVP it defines whether the rules included within the Charging-Rule-Install AVP need be notified.\nThe following values are defined:\nENABLE_NOTIFICATION (0)\nThis value shall be used to indicate that the allocation of resources for the related PCC rules shall be confirmed.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.51",
      "section_id": "5.3.51",
      "section_title": "Security-Parameter-Index AVP (All access types)",
      "content": "The Security-Parameter-Index AVP (AVP code 1056) is of type OctetString, and it contains the security parameter index of the IPSec packet. One example is that of a TFT packet filter as defined in 3GPP TS 24.008 [13].",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.52",
      "section_id": "5.3.52",
      "section_title": "Flow-Label AVP (All access types)",
      "content": "The Flow-Label AVP (AVP code 1057) is of type OctetString, and it contains the Ipv6 flow label header field. One example is that of a TFT packet filter as defined in 3GPP TS 24.008 [13].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.53",
      "section_id": "5.3.53",
      "section_title": "Flow-Information AVP (All access types)",
      "content": "The Flow-Information AVP (AVP code 1058) is of type Grouped, and it is sent from the PCRF to the PCEF and contains the information from a single IP flow packet filter.\nThe Flow-Description, ToS-Traffic-Class, Security-Parameter-Index and Flow-Label AVPs specify the parameters to be used for matching payload packets. If any of these AVPs is present, then the Flow-Direction AVP shall also be included. If the Flow-Information AVP includes any of the Flow-Description, ToS-Traffic-Class, Security-Parameter-Index or Flow-Label AVPs, these values replace any previous value for all the Flow-Description, ToS-Traffic-Class, Security-Parameter-Index and Flow-Label AVPs.\nThe Flow-Information AVP shall include the Flow-Direction AVP, declaring in what direction(s) the filter applies.\nThe PCRF shall only assign the packet filter identifier in the Packet-Filter-Identifier AVP for PCC rules created as a result of UE-initiated resource allocation.\nNOTE 1:\tThe UE can only modify or delete the packet filters that the UE has introduced and associated resources. The packet filter identifiers are only needed for packet filters created by the UE.\nFor PCC rules modified as a result of UE-initiated resource modification that include the modified Flow-Information AVP, the PCRF shall include the packet filter identifier in the Packet-Filter-Identifier AVP.\nThe Flow-Direction AVP shall be included unless no other AVPs other than Packet-Filter-Identifier AVP are included within the Flow-Information AVP.\nThe Routing-Rule-Identifier AVP shall be included in the case of NBIFOM and when the PCRF initiates/has initiated the NBIFOM routing rule(s). It is used by the PCEF as routing rule identifier for the corresponding NBIFOM routing rule sent over Gx interface when the PCEF receives an UE-requested IP flow mapping modification request for the routing rule. See subclause 4.5.25.2 for further details.\nNOTE 2:\tFor 3GPP accesses, the possible combinations of Flow-Description, Type-of-Service/Traffic Class, the IPSec SPI, and the Flow Label in the TFT filter are defined in 3GPP TS 23.060 [17].\nAVP Format:\nFlow-Information ::= < AVP Header: 1058 >\n[ Flow-Description ]\n[ Packet-Filter-Identifier ]\n[ Packet-Filter-Usage ]\n[ ToS-Traffic-Class ]\n[ Security-Parameter-Index ]\n[ Flow-Label ]\n[ Flow-Direction ]\n[ Routing-Rule-Identifier ]\n*[ AVP ]",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.5.25.2",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.54",
      "section_id": "5.3.54",
      "section_title": "Packet-Filter-Content AVP",
      "content": "The Packet-Filter-Content AVP (AVP code 1059) is of type IPFilterRule, and it contains the content of the packet filter as requested by the UE and required by the PCRF to create the PCC rules. The following information shall be sent:\n-\tAction shall be set to \"permit\".\n-\tDirection shall be set to \"out\".\n-\tProtocol shall be set to the value provided within the packet filter provided by the UE. If not provided, Protocol shall be set to \"ip\".\n-\tSource IP address (possibly masked). The Source IP address shall be derived from the packet filter parameters, for the remote end, sent by the UE. If the Source IP address is not provided by the UE, this field shall be set to \"any\".\n-\tSource and/or destination port (single value, list or ranges). The information shall be derived from the remote and/or local port packet filter parameters. Source and/or destination port(s) shall be omitted if the corresponding information is not provided in the packet filter.\n-\tDestination IP address (possibly masked). The Destination IP address shall be derived from the packet filter parameters sent by the UE. The Destination shall be set to the value provided by the UE. If no Destination IP address is provided in the packet filter the Destination shall be set to \"assigned\", which refers to the Ipv4 address and/or Ipv6 prefix of the UE as indicated by the Framed-IP-Address and/or Framed-Ipv6-Prefix AVPs.\nThe IPFilterRule type shall be used with the following restrictions:\n-\tNo options shall be used.\n-\tThe invert modifier \"!\" for addresses shall not be used.\nThe direction \"out\" indicates that the IPFilterRule \"source\" parameters correspond to the \"remote\" parameters in the packet filter and the IPFilterRule \"destination\" parameters correspond to the \"local\" (UE end) parameters. The Packet-Filter-Content AVP applies in the direction(s) as specified in the accompanying Flow-Direction AVP.\nDestination IP address including the value provided by the UE may be provided within the Packet-Filter-Content AVP when the ExtendedFilter feature is supported as described in clause 5.4.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.55",
      "section_id": "5.3.55",
      "section_title": "Packet-Filter-Identifier AVP",
      "content": "The Packet-Filter-Identifier AVP (AVP code 1060) is of type OctetString, and it indicates the identity of the packet filter. For PCC rules created as a result of UE-initiated resource allocation, the packet filter identifier is assigned by the PCRF and within the scope of the PCRF is unique per UE.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.56",
      "section_id": "5.3.56",
      "section_title": "Packet-Filter-Information AVP",
      "content": "The Packet-Filter-Information AVP (AVP code 1061) is of type Grouped, and it contains the information from a single packet filter sent from the PCEF to the PCRF. Depending on the Packet-Filter-Operation included within the CCR command it may include the packet filter identifier, evaluation precedence, filter value, filter direction, Type-of-Service/Traffic Class, the IPSec SPI, and the Flow Label.\nWhen the Packet-Filter-Operation AVP included within the CCR command indicates DELETION, only the Packet-Filter-Identifier AVP shall be provided.\nThe Flow-Direction AVP shall be included unless no other AVPs other than Packet-Filter-Identifier AVP are included within the Packet-Filter-Information AVP.\nWhen the Packet-Filter-Operation AVP included within the CCR command indicates ADDITION and is linked to an existing packet filter, only the Packet-Filter-Identifier AVP shall be provided for the existing packet filter.\nSee annex B.3.4 for E-UTRAN specific details.\nAVP Format:\nPacket-Filter-Information ::= < AVP Header: 1061 >\n[ Packet-Filter-Identifier ]\n[ Precedence ]\n[ Packet-Filter-Content ]\n[ ToS-Traffic-Class ]\n[ Security-Parameter-Index ]\n[ Flow-Label ]\n[ Flow-Direction ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.57",
      "section_id": "5.3.57",
      "section_title": "Packet-Filter-Operation AVP",
      "content": "The Packet-Filter-Operation AVP (AVP code 1062) is of type of Enumerated, and it indicates a UE initiated resource operation that causes a request for PCC rules.\nThe following values are defined:\nDELETION (0)\nThis value is used to indicate that the resources reserved for the provided packet filter identifiers are to be deleted and are no longer used by the UE.\nADDITION (1)\nThis value is used to indicate that the UE requests resources allocated for the provided packet filters.\nMODIFICATION (2)\nThis value is used to indicate that the reserved QoS, the filter, the precedence, or any of the fields for the provided packet filter identifiers are being modified.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.58",
      "section_id": "5.3.58",
      "section_title": "PDN-Connection-ID AVP",
      "content": "The PDN-Connection-ID AVP (AVP code 1065) is of type OctetString, and it indicates the PDN connection to which specific information refers.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.59",
      "section_id": "5.3.59",
      "section_title": "Monitoring-Key AVP",
      "content": "The Monitoring-Key AVP (AVP code 1066) is of type OctetString and is used for usage monitoring control purposes as an identifier to a usage monitoring control instance.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.60",
      "section_id": "5.3.60",
      "section_title": "Usage-Monitoring-Information AVP",
      "content": "The Usage-Monitoring-Information AVP (AVP code 1067) is of type Grouped, and it contains the usage monitoring control information.\nThe Monitoring-Key AVP identifies the usage monitoring control instance.\nThe Granted-Service-Unit AVP shall be used by the PCRF to provide the volume and/or the time of usage threshold level to the PCEF. The CC-Total-Octets AVP shall be used for providing threshold level for the total volume, or the CC-Input-Octets and/or CC-Output-Octets AVPs shall be used for providing threshold level for the uplink volume and/or the downlink volume. The CC-Time AVP shall be used for providing the time threshold to the PCEF. Monitoring-Time AVP shall be used for providing the time at which the PCEF shall reapply the threshold value provided by the PCRF.\nThe Used-Service-Unit AVP shall be used by the PCEF to provide the measured usage to the PCRF. Reporting shall be done, as requested by the PCRF, in CC-Total-Octets, CC-Input-Octets, CC-Output-Octets or CC-Time AVPs of Used-Service-Unit AVP. The Monitoring-Time AVP within the Used-Service-Unit AVP shall indicate the usage after the monitoring time as specified in clause 4.5.17.6.\nThe Quota-Consumption-Time AVP defines the time interval in seconds after which the time measurement shall stop for the Monitoring Key, if no packets are received belonging to the corresponding Monitoring Key. The Quota-Comsumption-Time may be included when the Usage-Monitoring-InformationAVP also contains a Granted-Service-Unit including a CC-Time AVP (i.e. when the granted usage is for for usage monitoring based on time). If the Quota-Consumption-Time AVP contains a value of zero, or if no Quota-Consumption-Time AVP is present, the time of usage shall be measured continuously from the point user plane traffic is detected for the corresponding Monitoring Key until the time usage measurement is disabled for the same Monitoring Key.\nThe Usage-Monitoring-Level AVP determines the scope of the usage monitoring instance.\nThe Usage-Monitoring-Report AVP determines if accumulated usage shall be reported for the usage monitoring key included in Monitoring-Key AVP.\nThe Usage-Monitoring-Support AVP determines if a usage monitoring instance is disabled.\nAVP Format:\nUsage-Monitoring-Information::= < AVP Header: 1067 >\n[ Monitoring-Key ]\n0*2 [ Granted-Service-Unit ]\n0*2 [ Used-Service-Unit ]\n[ Quota-Consumption-Time ]\n[ Usage-Monitoring-Level ]\n[ Usage-Monitoring-Report ]\n[ Usage-Monitoring-Support ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.17.6"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.61",
      "section_id": "5.3.61",
      "section_title": "Usage-Monitoring-Level AVP",
      "content": "The Usage-Monitoring-Level AVP (AVP code 1068) is of type Enumerated and is used by the PCRF to indicate whether the usage monitoring instance applies to the IP-CAN session or to one or more PCC rules or to one or more ADC rules.\nIf Usage-Monitoring-Level AVP is not provided, its absence shall indicate the value PCC_RULE_LEVEL (1).\nThe following values are defined:\nSESSION_LEVEL (0)\nThis value, if provided within an RAR or CCA command by the PCRF, indicates that the usage monitoring instance applies to the entire IP-CAN session.\nPCC_RULE_LEVEL (1)\nThis value, if provided within an RAR or CCA command by the PCRF indicates that the usage monitoring instance applies to one or more PCC rules. This value is only applicable to Gx reference point.\nADC_RULE_LEVEL (2)\nThis value, if provided within a TSR, RAR or CCA command by the PCRF, indicates that the usage monitoring instance applies to one or more ADC rules. This value is only applicable to Sd reference point. See clause 5b.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.62",
      "section_id": "5.3.62",
      "section_title": "Usage-Monitoring-Report AVP",
      "content": "The Usage-Monitoring-Report AVP (AVP code 1069) is of type Enumerated and is used by the PCRF to indicate that accumulated usage is to be reported by the PCEF regardless of whether a usage threshold is reached.\nThe following values are defined:\nUSAGE_MONITORING_REPORT_REQUIRED (0)\nThis value, if provided within an RAR or CCA command by the PCRF indicates that accumulated usage shall be reported by the PCEF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.63",
      "section_id": "5.3.63",
      "section_title": "Usage-Monitoring-Support AVP",
      "content": "The Usage-Monitoring-Support AVP (AVP code 1070) is of type Enumerated and is used by the PCRF to indicate whether usage monitoring shall be disabled for certain Monitoring Key.\nThe following values are defined:\nUSAGE_MONITORING_DISABLED (0)\nThis value indicates that usage monitoring is disabled for a monitoring key.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.64",
      "section_id": "5.3.64",
      "section_title": "CSG-Information-Reporting AVP",
      "content": "The CSG-Information-Reporting AVP (AVP code 1071) is of type Enumerated, it is sent from the PCRF to the PCEF to request the PCEF to report the user CSG information change to the OFCS. The following values are defined:\nCHANGE_CSG_CELL (0)\nThis value indicates that the PCEF reports the user CSG information change to the OFCS when the UE enters/leaves/accesses via a CSG cell.\nCHANGE_CSG_SUBSCRIBED_HYBRID_CELL (1)\nThis value indicates that the PCEF reports the user CSG information change to the OFCS when the UE enters/leaves/accesses via a hybrid cell in which the subscriber is a CSG member.\nCHANGE_CSG_UNSUBSCRIBED_HYBRID_CELL (2)\nThis value indicates that the PCEF reports the user CSG information change to the OFCS when the UE enters/leaves/accesses via a hybrid cell in which the subscriber is not a CSG member.\nNOTE:\tDue to the increased signalling load, it is recommended that such reporting applied for a limited number of subscribers only.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.65",
      "section_id": "5.3.65",
      "section_title": "Flow-Direction AVP",
      "content": "The Flow-Direction AVP (AVP code 1080) is of type Enumerated. It indicates the direction/directions that a filter is applicable, downlink only, uplink only or both down- and uplink (bidirectional).\nUNSPECIFIED (0)\nThe corresponding filter applies for traffic to the UE (downlink), but has no specific direction declared. The service data flow detection shall apply the filter for uplink traffic as if the filter was bidirectional. The PCRF shall not use the value UNSPECIFIED in filters created by the network in NW-initiated procedures. The PCRF shall only include the value UNSPECIFIED in filters in UE-initiated procedures if the same value is received from in the CCR request from the PCEF.\nDOWNLINK (1)\nThe corresponding filter applies for traffic to the UE.\nUPLINK (2)\nThe corresponding filter applies for traffic from the UE.\nBIDIRECTIONAL (3)\nThe corresponding filter applies for traffic both to and from the UE.\nNOTE:\tThe corresponding filter data is unidirectional. The filter for the opposite direction has the same parameters, but having the source and destination address/port parameters swapped.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.66",
      "section_id": "5.3.66",
      "section_title": "Packet-Filter-Usage AVP (All access types)",
      "content": "The Packet-Filter-Usage AVP (AVP code 1072) is of type of Enumerated, and it indicates whether the UE shall be provisioned with the related traffic mapping information, i.e. the packet filter. Traffic mapping information may be sent to the UE as per the relevant IP-CAN specifications even if not instructed to do so with the Packet-Filter-Usage AVP.\nThe following values are defined:\nSEND_TO_UE (1)\nThis value is used to indicate that the related traffic mapping information, i.e. the packet filter, shall be sent to the UE, if applicable to the IP-CAN type as per relevant IP-CAN specifications.\nNOTE:\tThe maximum number of packet filters sent to UE is limited by the IP-CAN type. See access specific annexes.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.67",
      "section_id": "5.3.67",
      "section_title": "Charging-Correlation-Indicator AVP (All access types)",
      "content": "The Charging-Correlation-Indicator AVP (AVP code 1073) is of type Enumerated.\nIf the Charging-Correlation-Indicator AVP is included within a Charging-Rule-Install AVP it indicates that the Access-Network-Charging-Identifier-Gx AVP assigned to the dynamic PCC rules need to be provided.\nThe following values are defined:\nCHARGING_IDENTIFIER_REQUIRED (0)\nThis value shall be used to indicate that the Access-Network-Charging-Identifier-Gx AVP for the dynamic PCC rule(s) shall be reported to the PCRF by the PCEF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.68",
      "section_id": "5.3.68",
      "section_title": "Routing-Rule-Install AVP",
      "content": "The Routing-Rule-Install AVP (AVP code 1081 ) is of type Grouped, and it is used to install or modify IP flow mobility routing rules defined in clause 4.3a or NBIFOM routing rules defined in clause 4.3c as instructed from the PCEF to the PCRF.\nFor installing a new IP flow mobility routing rule/NBIFOM routing rule or modifying an IP flow mobility routing rule/NBIFOM routing rule already installed, Routing-Rule-Definition AVP shall be used.\nAVP Format:\nRouting-Rule-Install ::= \t< AVP Header: 1081 >\n*[ Routing-Rule-Definition ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.69",
      "section_id": "5.3.69",
      "section_title": "Routing-Rule-Remove AVP",
      "content": "The Routing-Rule-Remove AVP (AVP code 1075) is of type Grouped, and it is used to remove IP flow mobility routing rules defined in clause 4.3a or NBIFOM routing rule defined in clause 4.3c for an IP CAN session from the PCRF.\nRouting-Rule-Identifier AVP is a reference for a specific IP flow mobility routing rule/NBIFOM routing rule at the PCRF to be removed.\nAVP Format:\nRouting-Rule-Remove ::= < AVP Header: 1075 >\n*[ Routing-Rule-Identifier ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.70",
      "section_id": "5.3.70",
      "section_title": "Routing-Rule-Definition AVP",
      "content": "The Routing-Rule-Definition AVP (AVP code 1076) is of type Grouped, and it defines the IP flow mobility routing rule or NBIFOM routing rule sent by the PCEF to the PCRF.\nThe Routing-Rule-Identifier AVP uniquely identifies the IP flow mobility routing rule or NBIFOM routing rule. It is used to reference to a IP flow mobility routing rule or NBIFOM routing rule in communication between the PCEF and the PCRF within one IP CAN session.\nThe Routing-IP-Address AVP identifies the IP address to be used for transporting for service data flows matching the IP flow mobility routing rule. The IP address may be a care-of-address or the home address.\nThe IP-CAN-Type AVP identifies the access to be used for transporting service data flows matching the NBIFOM routing rule. The IP-CAN type can be 3GPP-EPS or Non-3GPP-EPS in this release.\nThe Routing-Filter AVP(s) contains detailed description of routing filter(s) for determining the service data flows that belong to the IP flow mobility routing rule or NBIFOM routing rule.\nAVP Format:\nRouting-Rule-Definition ::= < AVP Header: 1076 >\n{ Routing-Rule-Identifier }\n*[ Routing-Filter ]\n[ Precedence ]\n[ Routing-IP-Address ]\n[ IP-CAN-Type ]\n*[ AVP ]",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.71",
      "section_id": "5.3.71",
      "section_title": "Routing-Rule-Identifier AVP",
      "content": "The Routing-Rule-Identifier AVP (AVP code 1077) is of type OctetString, and it defines a unique identifier for IP flow mobility routing rule or NBIFOM routing rule. It uniquely identifies a IP flow mobility routing rule or NBIFOM routing rule within one IP CAN session. The identifier value is assigned by the PCEF when instructing the PCRF to install the IP flow mobility routing rule. The identifier value is assigned by the PCEF or the PCRF for the NBIFOM as defined in subclause 4.3c.2.\nThe Routing-Rule-Identifier AVP content shall be encoded as a UTF8String and begin with the type of node that assigned the NBIFOM routing ruleidentifier, i.e. \"PCEF\" or \"PCRF\", the remainder of the Routing-Rule-Identifier AVP is delimited by a \";\" character and may be any sequence.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_4.3"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.72",
      "section_id": "5.3.72",
      "section_title": "Routing-Filter AVP",
      "content": "The Routing-Filter AVP (AVP code 1078) is of type Grouped and is sent from the PCEF to the PCRF. This AVP contains the information for a single routing filter .\nThe Routing-Filter AVP shall include the Flow-Direction AVP with value set to \"BIDIRECTIONAL\". The direction information contained in the Flow-Description AVP shall be \"out\".\nThe routing filter may be wild carded by omitting ToS-Traffic-Class AVP, Security-Parameter-Index AVP, and Flow-Label AVP, setting Flow-Direction AVP to the value \"BIDIRECTIONAL\", setting Flow-Description AVP to the value \"permit out ip from any to any\".\nThe Routing-Filter AVP may also include the Type-of-Service/Traffic Class, the IPSec SPI, and the Flow Label. The values of these AVPs are obtained from the routing information provided to the PCEF.\nAVP Format:\nRouting-Filter ::= < AVP Header: 1078 >\n{ Flow-Description }\n{ Flow-Direction }\n[ ToS-Traffic-Class ]\n[ Security-Parameter-Index ]\n[ Flow-Label ]\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.73",
      "section_id": "5.3.73",
      "section_title": "Routing-IP-Address AVP",
      "content": "The Routing-IP-Address AVP (AVP Code 1079) is of type Address and contains the mobile node's home address or care-of-address. The address type may be Ipv4 or Ipv6.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.77",
      "section_id": "5.3.77",
      "section_title": "TDF-Application-Identifier AVP",
      "content": "The TDF-Application-Identifier AVP (AVP Code 1088) is of type OctetString. It references the application detection filter (e.g. its value may represent an application such as a list of URLs, etc.) which the PCC rule for application detection and control in the PCEF applies. The TDF-Application-Identifier AVP references also the application in the reporting to the PCRF.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.78",
      "section_id": "5.3.78",
      "section_title": "TDF-Information AVP",
      "content": "The TDF-Information AVP (AVP code 1087) is of type Grouped and may be sent from the PCEF to the PCRF in a Gx CCR with CC-Request-Type set to INITIAL-REQUEST. This AVP contains the information about the TDF that shall handle the application detection and reporting for that IP-CAN Session. The PCRF shall create the TDF session with that TDF.\nThe TDF-Information AVP shall include either the TDF-Destination-Realm and TDF-Destination-Host AVP, or the TDF-IP-Address AVP.\nNOTE:\tThe TDF-Information AVP may also be pre-provisioned in the PCRF. In case the TDF-Information AVP pre-provisioned at the PCRF and not received from the PCEF, it is being handled e.g. by configuration that PCEF routes the traffic to the same TDF. In case the TDF-Information is pre-provisioned in the PCRF and also the value is received in CC-Request from the PCEF, the value received in CC-Request takes precedence over pre-provisioned value.\nAVP Format:\nTDF-Information::= < AVP Header: 1087 >\n[ TDF-Destination-Realm ]\n[ TDF-Destination-Host ]\n[ TDF-IP-Address ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.79",
      "section_id": "5.3.79",
      "section_title": "TDF-Destination-Realm AVP",
      "content": "The TDF-Destination-Realm AVP (AVP code 1090) is of type DiameterIdentity and contains the Destination-Realm of the TDF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.80",
      "section_id": "5.3.80",
      "section_title": "TDF-Destination-Host AVP",
      "content": "The TDF-Destination-Host AVP (AVP code 1089) is of type DiameterIdentity and contains the Destination-Host of the TDF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.81",
      "section_id": "5.3.81",
      "section_title": "TDF-IP-Address AVP",
      "content": "The TDF-IP-Address AVP (AVP Code 1091) is of type Address and contains the address of the corresponding TDF node.\nThe address type may be Ipv4 or Ipv6.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.82",
      "section_id": "5.3.82",
      "section_title": "Redirect-Information AVP",
      "content": "The Redirect-Information AVP (AVP code 1085) is of type Grouped. It indicates whether the detected application traffic should be redirected to another controlled address. The Redirect-Information AVP is sent from the PCRF as a part of Charging-Rule-Definition AVP.\nIf the Redirect-Information AVP includes the Redirect-Server-Address AVP, the Redirect-Address-Type AVP shall also be provided indicating the type of address given in the Redirect-Server-Address AVP.\nAVP Format:\nRedirect-Information ::= < AVP Header: 1085 >\n[ Redirect-Support ]\n[ Redirect-Address-Type ]\n[ Redirect-Server-Address ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.83",
      "section_id": "5.3.83",
      "section_title": "Redirect-Support AVP",
      "content": "The Redirect-Support AVP (AVP Code 1086) is of type Enumerated.\nThe following value is defined:\nREDIRECTION_DISABLED (0)\nThis value indicates that redirection is disabled for a detected application's traffic.\nREDIRECTION_ENABLED (1)\nThis value indicates that redirection is enabled for a detected application's traffic. This is the default value applicable if a Redirect-Information AVP is provided for the first time and if this AVP is not supplied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.84",
      "section_id": "5.3.84",
      "section_title": "PS-to-CS-Session-Continuity AVP (3GPP-EPS access type only)",
      "content": "The PS-to-CS-Session-Continuity AVP (AVP code 1099) is of type Enumerated, and indicates whether the service data flow is a candidate for PS to CS session continuity as specified in 3GPP TS 23.216 [40].\nThe following values are defined:\nVIDEO_PS2CS_CONT_CANDIDATE (0)\nThis value is used to indicate that the service data flow carries video and is a candidate for PS to CS session continuity.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.216"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.91",
      "section_id": "5.3.91",
      "section_title": "Application-Detection-Information AVP",
      "content": "The Application-Detection-Information AVP (AVP code 1098) is of type Grouped, and it is used to report once the start/stop of the application traffic, defined by TDF-Application-Identifier, has been detected, in case PCRF has subscribed for APPLICATION_START/APPLICATION_STOP Event-Triggers, unless a request to mute such a notification (Mute-Notification AVP) is part of the corresponding Charging-Rule-Definition AVP to the PCEF.\nThe corresponding TDF-Application-Identifier AVP shall be included under Application-Detection-Information AVP. When the Event trigger indicates APPLICATION_START, the Flow-Information AVP for the detected application, if deducible, shall be included under Application-Detection-Information AVP. When the Flow-Information AVP is included, the TDF-Application-Instance-Identifier AVP shall also be included. The Flow-Information AVP, if present, shall contain the Flow-Description AVP and Flow-Direction AVP. Also, the corresponding Event-Trigger (APPLICATION_START or APPLICATION_STOP) shall be provided to PCRF. When the TDF-Application-Instance-Identifier AVP is included with an APPLICATION_START event, it shall also be included when the corresponding APPLICATION_STOP event is notified.\nAVP Format:\nApplication-Detection-Information ::=      < AVP Header: 1098 >\n{ TDF-Application-Identifier }\n[ TDF-Application-Instance-Identifier ]\n*[ Flow-Information ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.92",
      "section_id": "5.3.92",
      "section_title": "TDF-Application-Instance-Identifier AVP",
      "content": "The TDF-Application-Instance-Identifier AVP (AVP Code 2802) is of type OctetString. It shall be dynamically assigned by the PCEF supporting ADC feature in order to allow correlation of application Start and Stop events to the specific service data flow description, if service data flow descriptions are deducible and shall be reported from the PCEF to the PCRF when the flow description is deducible along with the corresponding Event Trigger.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.95",
      "section_id": "5.3.95",
      "section_title": "HeNB-Local-IP-Address AVP (3GPP-EPS access type only)",
      "content": "The HeNB-Local-IP-Address AVP (AVP code 2804) is of type Address and contains the H(e)NB local IP address as defined in Annex E.2.1. The H(e)NB local IP address type may be Ipv4 or Ipv6.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.96",
      "section_id": "5.3.96",
      "section_title": "UE-Local-IP-Address AVP (Non-3GPP-EPS access type only)",
      "content": "The UE-Local-IP-Address AVP (AVP code 2805) is of type Address and contains the UE local IP address. For BBAI, refer to Annex E.2.1. The UE local IP address type may be Ipv4 or Ipv6.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.97",
      "section_id": "5.3.97",
      "section_title": "UDP-Source-Port AVP (3GPP-EPS and Non-3GPP-EPS access types)",
      "content": "The UDP-Source-Port AVP (AVP Code 2806) is of type Unsigned32 and contains the UDP source port number in the case that NA(P)T is detected for supporting interworking with fixed broadband access network as defined in Annex E. When Untrusted WLAN over S2b access is supported as defined in Annex D.4, it contains the UDP source port number used for the IKEv2 tunnel in the case that a NAT is detected and the IKEv2 messages exchanged between the UE and the ePDG are encapsulated in the UDP messages according to IETF RFC 3948 [58].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.98",
      "section_id": "5.3.98",
      "section_title": "Mute-Notification AVP",
      "content": "The Mute-Notification AVP (AVP code 2809) is of type Enumerated, and it is used to mute the notification to the PCRF of the detected application's start/stop for the specific PCC Rule from the PCEF.\nThe following values are defined:\nMUTE_REQUIRED (0)\nThis value is used to indicate that the PCEF shall not inform the PCRF when the application's start/stop for the specific PCC rule(s) is detected.\nMute-Notification AVP shall be used for solicited application reporting only.\nAbsence of this AVP means that application start/stop notifications shall be sent for the detected application.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.99",
      "section_id": "5.3.99",
      "section_title": "Monitoring-Time AVP",
      "content": "The Monitoring-Time AVP (AVP Code 2810) is of type Time and it defines the time at which the PCEF shall reapply the threshold value provided by the PCRF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.100",
      "section_id": "5.3.100",
      "section_title": "AN-GW-Status AVP (3GPP-EPS access type)",
      "content": "The AN-GW-Status AVP (AVP code 2811) is of type Enumerated. It is sent from the PCEF to the PCRF to indicate the status of the SGW.\nThe following values are defined:\nAN_GW_FAILED (0)\nThis value indicates that the AN-Gateway has failed and that the PCRF should refrain from sending policy decisions to the PCEF until it is informed that the AN-Gateway has been recovered. This value shall not be used if the IP-CAN Session Modification procedure is initiated for PCC rule removal only.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.101",
      "section_id": "5.3.101",
      "section_title": "User-Location-Info-Time AVP",
      "content": "The User-Location-Info-Time AVP (AVP Code 2812) is of type Time, and it contains the NTP time at which the UE was last known to be in the location. The User-Location-Info-Time AVP is sent from the PCEF to the PCRF. The PCRF forwards it to the AF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.102",
      "section_id": "5.3.102",
      "section_title": "Credit-Management-Status AVP",
      "content": "The Credit-Management-Status AVP is of type Unsigned32 and it shall contain a bit mask. The bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x0001 should be used. The meaning of the bits shall be as defined below:\nTable 5.3.102: Credit-Management-Status\nBit\nName\nDescription\n0\nEnd User Service Denied\nThis bit, when set, indicates that the charging system denied the service request due to service restrictions (e.g. terminate rating group) or limitations related to the end-user, for example the end-user's account could not cover the requested service.\n1\nCredit Control Not Applicable\nThis bit, when set, indicates that the charging system determined that the service can be granted to the end user but no further credit control is needed for the service (e.g. service is free of charge or is treated for offline charging).\n2\nAuthorization Rejected\nThis bit, when set, indicates that the charging system denied the service request in order to terminate the service for which credit is requested.\n3\nUser Unknown\nThis bit, when set, indicates that the specified end user could not be found in the charging system.\n4\nRating Failed\nThis bit, when set, indicates that the charging system cannot rate the service request due to insufficient rating input, incorrect AVP combination or an AVP value that is not recognized or supported in rating.\n5\nNo Gyn Session, service allowed\nThis bit, when set, indicates that the Gyn session was terminated (e.g. network failure), but the OCS allowed the service to continue (NOTE).\n6\nNo Gyn Session, service not allowed\nThis bit, when set, indicates that the Gyn session was terminated (e.g. network failure) and the OCS did not allow the service to continue (NOTE).\nNOTE:\tApplicable only over Sd reference point.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.3.102"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.103",
      "section_id": "5.3.103",
      "section_title": "Default-QoS-Information AVP (FBA access type)",
      "content": "The Default-QoS-Information AVP (AVP code 2816) is of type Grouped, and it defines the Default QoS information for the IP-CAN session in the Fixed Broadband Access.When this AVP is sent from the PCEF to the PCRF, it indicates the default QoS information provided by the Fixed Broadband Access network. When this AVP is sent from the PCRF to the PCEF, it indicates the authorized Default QoS for the IP-CAN session.\nThe Default-QoS-Information AVP can be dynamically provided or preconfigured in the PCEF. When dynamically provided, it consists of a QCI (QoS-Class-Identifier AVP) and MBR (Max-Requested-Bandwidth-UL AVP and Max-Requested-Bandwidth-DL AVP). When it is preconfigured in the PCEF it consists of the default QoS profile name included in Default-QoS-Name AVP.\nThe QoS-Class-Identifier AVP identifies a set of IP-CAN specific QoS parameters that define the Default QoS.\nThe Max-Requested-Bandwidth-UL AVP defines the maximum bit rate allowed for the uplink direction.\nThe Max-Requested-Bandwidth-DL AVP defines the maximum bit rate allowed for the downlink direction.\nThe Default-QoS-Name AVP defines the default QoS profile pre-defined in the PCEF.\nIf the Default-QoS-Information AVP is omitted in a Diameter message, the previous information remains valid.\nAVP Format:\nDefault-QoS-Information ::= \t< AVP Header: 2816 >\n[ QoS-Class-Identifier ]\n[ Max-Requested-Bandwidth-UL ]\n[ Max-Requested-Bandwidth-DL ]\n[ Default-QoS-Name ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.104",
      "section_id": "5.3.104",
      "section_title": "Default-QoS-Name AVP (FBA access type)",
      "content": "The Default-QoS-Name AVP (AVP code 2817) is of type UTF8String, and it indicates the name of a pre-configured default QoS profile at the PCEF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.105",
      "section_id": "5.3.105",
      "section_title": "Conditional-APN-Aggregate-Max-Bitrate (All access types)",
      "content": "The Conditional‑APN‑Aggregate‑Max‑Bitrate AVP (AVP code 2818) is of type Grouped, and it defines the conditional APN policy info.\nThe APN‑Aggregate‑Max‑Bitrate‑UL defines the total bandwidth usage in bps for the uplink direction of non-GBR QCIs at the APN.\nThe APN‑Aggregate‑Max‑Bitrate‑DL defines the total bandwidth usage in bps for the downlink direction of non-GBR QCIs at the APN.\nThe Extended-APN‑AMBR‑UL defines the total bandwidth usage in kbps for the uplink direction of non-GBR QCIs at the APN.\nThe Extended-APN‑AMBR‑DL defines the total bandwidth usage in kbps for the downlink direction of non-GBR QCIs at the APN.\nWhen maximum bandwidth values are lower or equal to 2^32-1 bps, one of the APN‑Aggregate‑Max‑Bitrate‑UL AVP and APN‑Aggregate‑Max‑Bitrate‑DL AVP shall be present.\nFor maximum bandwidth values higher than 2^32 bps and when the Extended-BW-NR feature is supported, one of the Extended-APN‑AMBR‑UL AVP and Extended-APN‑AMBR‑DL AVP shall be present.\nThe IP‑CAN‑Type and the RAT‑Type AVP(s) specify the condition, in terms of IP Connectivity Access Network type and the Radio Access Technology type of the UE, respectively, when the APN‑Aggregate‑Max‑Bitrate‑UL/DL shall be enforced.\nAt least one of the RAT‑Type and IP‑CAN‑Type shall be present.\nConditional-APN-Aggregate-Max-Bitrate ::= \t < AVP Header: 2818 >\n[ APN-Aggregate-Max-Bitrate-UL ]\n[ APN-Aggregate-Max-Bitrate-DL ]\n[ Extended-APN-AMBR-UL ]\n[ Extended-APN-AMBR-DL ]\n*[ IP-CAN-Type ]\n*[ RAT-Type ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.106",
      "section_id": "5.3.106",
      "section_title": "RAN-NAS-Release-Cause AVP (3GPP-EPS and Non-3GPP-EPS access type)",
      "content": "The RAN-NAS-Release-Cause AVP (AVP code 2819) is of type OctetString, and indicates the RAN or NAS release cause code information in 3GPP-EPS access type, or indicates the TWAN or untrusted WLAN release cause code information in Non-3GPP-EPS access type. The AVP shall be coded as per the RAN/NAS Cause in clause 8.103 of 3GPP TS 29.274 [22], starting with Octet 5.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274_clause_8.103",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.107",
      "section_id": "5.3.107",
      "section_title": "Presence-Reporting-Area-Elements-List AVP (3GPP-EPS access type)",
      "content": "The Presence-Reporting-Area-Elements-List AVP (AVP code 2820) is of type Octetstring and is coded as specified in 3GPP TS 29.274 [22] in Presence Reporting Area Action IE, starting from octet 9.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.108",
      "section_id": "5.3.108",
      "section_title": "Presence-Reporting-Area-Identifier AVP (3GPP-EPS access type)",
      "content": "The Presence-Reporting-Area-Identifier AVP (AVP code 2821) is of type OctetString, and it indicates the presence reporting area or presence reporting areas set to which specific information refers. The Presence Reporting Area Identifier, which is specified in 3GPP TS 29.274 [22] in the Presence Reporting Area Information IE in octets 5 to 7, shall contain the identifier of the Presence Reporting Area the UE is entering or leaving or the identifier of the Presence Reporting Area set if applicable. It shall be encoded using full hexadecimal representation (binary not ASCII encoding).",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.109",
      "section_id": "5.3.109",
      "section_title": "Presence-Reporting-Area-Information AVP (3GPP-EPS access type)",
      "content": "The Presence-Reporting-Area-Information AVP (AVP code 2822) is of type Grouped, contains the information which describes a Presence Reporting Area.\nThe Presence-Reporting-Area-Identifier AVP defines a unique identifier for presence reporting area or presence reporting area set.\nThe Presence-Reporting-Area-Status AVP indicates the status of UE for presence reporting area or the status of the presence reporting area.\nThe Presence-Reporting-Area-Elements-List AVP contains, for a UE-dedicated presence area, the elements of the Presence Reporting Area. For a core network pre-configured presence reporting area, the element list shall not be present.\nWhen the presence area is UE-dedicated, the PCRF may acquire the presence reporting area information from the SPR.\nSPR.\nThe Presence-Reporting-Area-Node AVP indicates the node(s) which subscribed to the UE status in the presence reporting area. This AVP is not applicable to the Gx interface.\nAVP Format:\nPresence-Reporting-Area-Information ::= < AVP Header: 2822 >\n[ Presence-Reporting-Area-Identifier ]\n[ Presence-Reporting-Area-Status ]\n[ Presence-Reporting-Area-Elements-List ]\n[ Presence-Reporting-Area-Node ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.110",
      "section_id": "5.3.110",
      "section_title": "Presence-Reporting-Area-Status AVP (3GPP-EPS access type)",
      "content": "The Presence-Reporting-Area-Status AVP (AVP code 2823) is of type Unsigned32, and it indicates whether the UE is inside or outside of the presence reporting area.\nThe following values are defined in this specification:\n0 (In area):\nThis value shall be used to indicate that the UE is inside or enters the presence reporting area.\n1 (Out of area):\nThis value shall be used to indicate that the UE is outside or leaves the presence reporting area.\n2 (Inactive)\nThis value shall be used to indicate that the presence reporting area is inactive in the serving node.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.111",
      "section_id": "5.3.111",
      "section_title": "NetLoc-Access-Support AVP",
      "content": "The NetLoc-Access-Support AVP (AVP code 2824) is of type Unsigned32. It indicates the level of support for NetLoc procedures provided by the current access network.\nThe following values are defined:\n0 (NETLOC_ACCESS_NOT_SUPPORTED)\nThis value is used when the access network currently serving the UE does not support access network information retrieval as described by the NetLoc feature in clause 5.4.1",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.1"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.112",
      "section_id": "5.3.112",
      "section_title": "Fixed-User-Location-Info AVP (FBA access type)",
      "content": "The Fixed-User-Location-Info AVP (AVP code 2825) is of type Grouped and contains the UE location in a Fixed Access Network.\nAVP Format:\nFixed-User-Location-Info::=  < AVP Header: 2825 >\n[ SSID ]\n[ BSSID ]\n[ Logical-Access-ID ]\n[ Physical-Access-ID ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.113",
      "section_id": "5.3.113",
      "section_title": "PCSCF-Restoration-Indication AVP",
      "content": "The PCSCF-Restoration-Indication AVP (AVP code 2826) is of type Unsigned32, and indicates a P-CSCF Restoration is requested. The following values are defined:\n0 (PCSCF_RESTORATION)\nThis value indicates the P-CSCF Restoration is requested.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.114",
      "section_id": "5.3.114",
      "section_title": "IP-CAN-Session-Charging-Scope AVP",
      "content": "The IP-CAN-Session-Charging-Scope AVP (AVP code 2827) is of type Enumerated, and indicates that the Access-Network-Charging-Identifier-Gx AVP applies to the whole IP-CAN Session. The following values are defined:\nIP-CAN_SESSION_SCOPE (0)\nThis value indicates that the charging identifier corresponds to the IP-CAN Session",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.115",
      "section_id": "5.3.115",
      "section_title": "Monitoring-Flags AVP",
      "content": "The Monitoring-Flags AVP (AVP code 2828) is of type Unsigned32, it shall contain a bit mask. The bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x0001 should be used. The meaning of the bits shall be as defined below:\nTable 5.3.115: Monitoring-Flags\nBit\nName\nDescription\n0\nEnable/disable excluding service data flow(s) from the usage monitoring for all traffic of the IP-CAN session\nThis bit, when set, indicates that the PCEF shall not include the corresponding service data flow in the volume and/or time measurement on IP-CAN session level; when not set, indicates that exclusion action is disabled.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.3.115"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.116",
      "section_id": "5.3.116",
      "section_title": "NBIFOM-Support AVP",
      "content": "The NBIFOM-Support AVP (AVP code 2831) is of type of Enumerated. When the AVP is sent from the PCEF to the PCRF in the initial CCR command, it indicates that the UE and network support the NBIFOM procedures as defined in 3GPP TS 23.161 [51].When the AVP is sent from the PCRF to the PCEF in the initial CCA command, it indicates whether the PCRF authorizes that the NBIFOM can be applied to the IP-CAN session.\nThe following value is defined:\nNBIFOM_NOT_SUPPORTED (0)\nThis value is used to indicate that the PCRF does not authorize that the NBIFOM can be applied to the IP-CAN session.\nNBIFOM_SUPPORTED (1)\nWhen included in a CCR command, this value is used to indicate that the UE and the access network support the NBIFOM procedures. When included in a CCAcommand, this value is used to indicate that the PCRF authorizes that NBIFOM can be applied to the IP-CAN session.\nAbsence of this AVP in the initial CCR command means that the NBIFOM procedures are not supported by the UE and/or network.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.161"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.117",
      "section_id": "5.3.117",
      "section_title": "NBIFOM-Mode AVP",
      "content": "The NBIFOM-Mode AVP (AVP code 2830) is of type of Enumerated. When the AVP is sent from the PCEF to the PCRF in the initial CCR command, it indicates the NBIFOM mode suggested by the UE. When the AVP is sent from the PCRF to the PCEF in the CCA command, it indicates the NBIFOM mode selected by the PCRF.\nThe following value is defined:\nUE_INITIATED (0)\nIP flow mobility can be initiated by the UE.\nNETWORK_INITIATED (1)\nIP flow mobility can be initiated by the network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.118",
      "section_id": "5.3.118",
      "section_title": "Routing-Rule-Report AVP",
      "content": "The Routing-Rule-Report AVP (AVP code 2835) is of type Grouped, and it is used to report the status of NBIFOM routing rules.\nRouting-Rule-Identifier AVP is a reference for a specific NBIFOM routing rule at the PCRF that cannot be installed or modified due to the operator’s policy or user subscription.\nRouting-Rule-Failure-Code AVP indicates the reason why the NBIFOM routing rules cannot be successfully installed or modified.\nAVP Format:\nRouting-Rule-Report ::= < AVP Header: 2835 >\n*[ Routing-Rule-Identifier ]\n[ PCC-Rule-Status ]\n[ Routing-Rule-Failure-Code ]\n*[ AVP ]\nMultiple instances of Routing-Rule-Report AVPs shall be used in the case it is required to report different Routing-Rule-Failure-Code values for different groups of rules within the same Diameter command.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.119",
      "section_id": "5.3.119",
      "section_title": "Routing-Rule-Failure-Code AVP",
      "content": "The Routing-Rule-Failure-Code AVP (AVP code 2834) is of type Unsigned32. It is sent by the PCRF to the PCEF within a Routing-Rule-Report AVP to identify the reason a NBIFOM routing rule is being reported.\nThe following values are defined in this specification:\n0 (Subscription limitation):\nThis value shall be used to indicate that the NBIFOM routing rule cannot be installed or modified due to the subscription limitation.\n1 (Operator policy):\nThis value shall be used to indicate that the NBIFOM routing rule cannot be installed or modified due to the operator policy.\n2 (Resource limitation):\nThis value shall be used to indicate that the NBIFOM routing rule cannot be installed or modified due to the resource limitation.\n3 (Routing access information not allowed):\nThis value shall be used to indicate that the NBIFOM routing rule cannot be installed or modified due to the routing access information is not allowed by the network.\n4 (Unspecified error):\nThis value shall be used to indicate that the NBIFOM routing rule cannot be installed or modified due to the unspecified error.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.120",
      "section_id": "5.3.120",
      "section_title": "Default-Access AVP",
      "content": "The Default-Access AVP (AVP code 2829) is of type  Enumerated. When it is sent from the PCEF to the PCRF, it indicates the default access selected by the UE. When it is sent from the PCRF to the PCEF, it indicates the default access determined by the PCRF. The values defined in the Default-Access AVP are the same as the ones defined in IP-CAN-Type AVP.\nNOTE: Only the 3GPP-EPS and Non-3GPP-EPS IP-CAN type values are applicable in this release.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.121",
      "section_id": "5.3.121",
      "section_title": "Access-Availability-Change-Reason AVP",
      "content": "The Access-Availability-Change-Reason AVP (AVP code 2833) is of type Unsigned32 and it is used to indicate the reason why the avalibility of an access is changed by the PCEF.\nThe following values are defined in this specification:\n0 (Access stratum indication):\nThis value shall be used to indicate that the availablitlity of an access is changed due to theAccess stratum indication.\n1 (Access usable/unusable):\nThis value shall be used to indicate that the availablitlity of an access is changed due to the access is unusable or usable again.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.122",
      "section_id": "5.3.122",
      "section_title": "RAN-Rule-Support AVP",
      "content": "The RAN-Rule-Support AVP (AVP code 2832) is of type Unsigned32, and it is used to indicate the network supports the RAN rule indication.\nThe following values are defined in this specification:\n0 (RAN rule indication support):\nThis value shall be used to indicate that the network supports the RAN rule indication.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.123",
      "section_id": "5.3.123",
      "section_title": "Traffic-Steering-Policy-Identifier-DL AVP",
      "content": "The Traffic-Steering-Policy-Identifier-DL (AVP code 2836) is of type OctetString and is used to contain a reference to a pre-configured traffic steering policy at the PCEF as defined in subclause 4.4.2 in the downlink direction.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_4.4.2"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.124",
      "section_id": "5.3.124",
      "section_title": "Traffic-Steering-Policy-Identifier-UL AVP",
      "content": "The Traffic-Steering-Policy-Identifier-UL (AVP code 2837) is of type OctetString and is used to contain a reference to a pre-configured traffic steering policy at the PCEF as defined in subclause 4.4.2 in the uplink direction.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_4.4.2"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.125",
      "section_id": "5.3.125",
      "section_title": "Resource-Release-Notification AVP (All access types)",
      "content": "The Resource-Release-Notification AVP (AVP code 2841) is of type Enumerated.\nIf the Resource-Release-Notification AVP is included within a Charging-Rule-Remove AVP it defines whether the rules included within the Charging-Rule-Remove AVP need to be notified.\nThe following values are defined:\nENABLE_NOTIFICATION (0)\nThis value shall be used to indicate that the outcome of the release of resources for the related PCC rules shall be notified.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.126",
      "section_id": "5.3.126",
      "section_title": "Removal-Of-Access AVP",
      "content": "The Removal-Of-Access AVP (AVP code 2842) is of type Enumerated and is used by the PCRF to indicate one access shall be removed from multi access IP-CAN session.\nThe following values are defined:\nREMOVAL_OF_ACCESS (0)\nThis value indicates that one access shall be removed from multi access IP-CAN session.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.127",
      "section_id": "5.3.127",
      "section_title": "Execution-Time AVP (ALL Access Types)",
      "content": "The Execution-Time AVP (AVP code 2839) is of type Time. This value indicates the NTP time at which the provided  policy info shall take effect. The AVP is included in the Conditional-Policy-Information AVP.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.128",
      "section_id": "5.3.128",
      "section_title": "Conditional-Policy-Information AVP",
      "content": "The Conditional-Policy-Information AVP (AVP code 2840) is of type Grouped, and it defines the conditional policy information for resources requested by the PCRF.\nThe Default-EPS-Bearer-QoS defines the QoS of the default bearer.\nThe APN-Aggregate-Max-Bitrate-UL defines the total bandwidth usage for the uplink direction of non-GBR QCIs at the APN.\nThe APN-Aggregate-Max-Bitrate-DL defines the total bandwidth usage for the downlink direction of non-GBR QCIs at the APN.\nThe Extended-APN‑AMBR‑UL defines the total bandwidth usage in kbps for the uplink direction of non-GBR QCIs at the APN.\nThe Extended-APN‑AMBR‑DL defines the total bandwidth usage in kbps for the downlink direction of non-GBR QCIs at the APN.\nWhen maximum bandwidth values are lower or equal to 2^32-1 bps, one of the APN‑Aggregate‑Max‑Bitrate‑UL AVP and APN‑Aggregate‑Max‑Bitrate‑DL AVP shall be present.\nFor maximum bandwidth values higher than 2^32 bps and when the Extended-BW-NR feature is supported, one of the Extended-APN‑AMBR‑UL AVP and Extended-APN‑AMBR‑DL AVP shall be present.\nThe Conditional-APN-Aggregate-Max-Bitrate defines total bandwidth usage for the uplink and downlink direction of non-GBR QCIs at the APN, with condition.\nThe Execution-Time AVP indicates the time when the included policy information shall take effect.\nConditional-Policy-Information ::= < AVP Header: 2840 >\n[ Execution-Time ]\n[ Default-EPS-Bearer-QoS ]\n[ APN-Aggregate-Max-Bitrate-UL ]\n[ APN-Aggregate-Max-Bitrate-DL ]\n[ Extended-APN-AMBR-UL ]\n[ Extended-APN-AMBR-DL ]\n*[ Conditional-APN-Aggregate-Max-Bitrate ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.129",
      "section_id": "5.3.129",
      "section_title": "TCP-Source-Port AVP (Non-3GPP-EPS access type)",
      "content": "The TCP-Source-Port AVP (AVP Code 2843) is of type Unsigned32. When Untrusted WLAN over S2b access is supported as defined in Annex D.4, it contains the TCP source port number used for the IKEv2 tunnel in the case that a NAT and firewall are detected and the IKEv2 messages exchanged between the UE and the ePDG are transported using the firewall traversal tunnel as described in 3GPP TS 24.302 [59].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.130",
      "section_id": "5.3.130",
      "section_title": "PRA-Install AVP (3GPP-EPS access type)",
      "content": "The PRA-Install AVP (AVP code 2845) is of type Grouped, and it is used to provision a list of new or updated Presence Reporting Area(s) for an IP-CAN session.\nAVP Format:\nPRA-Install ::= \t< AVP Header: 2845 >\n*[ Presence-Reporting-Area-Information ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.131",
      "section_id": "5.3.131",
      "section_title": "PRA-Remove AVP (3GPP-EPS access type)",
      "content": "The PRA-Remove AVP (AVP code 2846) is of type Grouped, and it is used to stop the reporting of a list of Presence Reporting Area(s) for an IP-CAN session.\nAVP Format:\nPRA-Remove ::= < AVP Header: 2846 >\n*[ Presence-Reporting-Area-Identifier ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.132",
      "section_id": "5.3.132",
      "section_title": "Default-Bearer-Indication AVP",
      "content": "The Default-Bearer-Indication AVP (AVP code 2844) is of type Enumerated and is used by the PCRF to indicate the related PCC rule shall be bound to the default bearer.\nThe following values are defined:\nBIND_TO_DEF_BEARER (0)\nThis value indicates that the related PCC rule shall be bound to the default bearer.\nBIND_TO_APPLICABLE_BEARER (1)\nThis value indicates that the related PCC rule shall follow the bearer binding procedures by using the QCI/ARP within the QoS-Information AVP as defined in subclause 5.4 of 3GPP TS 29.213 [8]. This is the default value when the AVP has not yet been provided.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.213_clause_5.4",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.3.133",
      "section_id": "5.3.133",
      "section_title": "3GPP-PS-Data-Off-Status AVP (Applicable access type 3GPP-EPS)",
      "content": "The 3GPP-PS-Data-Off-Status AVP (AVP code 2847) is of type Enumerated, and describes the 3GPP PS Data off status indicated by the UE.\nThe following values are defined:\nACTIVE (0)\nThis value is used to indicate that the UE activates the 3GPP PS Data off.\nINACTIVE (1)\nThis value is used to indicate that the UE deactivates the 3GPP PS Data off. This is the default value applicable if this AVP has not been supplied yet.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.134",
      "section_id": "5.3.134",
      "section_title": "Extended-APN-AMBR-DL AVP",
      "content": "The Extended-APN-AMBR-DL AVP (AVP code 2848) is of type Unsigned32, and it indicates the maximum aggregate bit rate in kbit per second for the downlink direction across all non-GBR bearers related with the same APN.\nWhen provided in a CC-Request, it indicates the subscribed maximum bitrate and/or the maximum bitrate retained in the PCEF. When provided in a CC-Answer, it indicates the maximum bandwidth authorized by PCRF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.135",
      "section_id": "5.3.135",
      "section_title": "Extended-APN-AMBR-UL AVP",
      "content": "The Extended-APN-AMBR-UL AVP (AVP code 2849) is of type Unsigned32, and it indicates the maximum aggregate bit rate in kbit per second for the uplink direction across all non-GBR bearers related with the same APN.\nWhen provided in a CC-Request, it indicates the subscribed maximum bitrate and/or the maximum bitrate retained in the PCEF. When provided in a CC-Answer, it indicates the maximum bandwidth authorized by PCRF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.136",
      "section_id": "5.3.136",
      "section_title": "Extended-GBR-DL AVP",
      "content": "The Extended-GBR-DL AVP (AVP code 2850) is of type Unsigned32, and it indicates the guaranteed bitrate in kbit per second for a downlink service data flow. The bandwidth contains all the overhead coming from the IP-layer and the layers above, e.g. IP, UDP, RTP and RTP payload.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.137",
      "section_id": "5.3.137",
      "section_title": "Extended-GBR-UL AVP",
      "content": "The Extended-GBR-UL AVP (AVP code 2851) is of type Unsigned32, and it indicates the guaranteed bitrate in kbit per second for an uplink service data flow. The bandwidth contains all the overhead coming from the IP-layer and the layers above, e.g. IP, UDP, RTP and RTP payload.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.138",
      "section_id": "5.3.138",
      "section_title": "Max-PLR-DL AVP",
      "content": "The Max-PLR-DL AVP (AVP code 2852) is of type  Unsigned32, and it indicates ratio of lost packets per number of packets sent in unit of tenth of percent for a downlink voice service data flow. This AVP is only applicable for PCC rule with QCI=1. The value of this AVP shall be within range 0 to 1000.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.139",
      "section_id": "5.3.139",
      "section_title": "Max-PLR-UL AVP",
      "content": "The Max-PLR-UL AVP (AVP code 2853) is of type Unsigned32, and it indicates ratio of lost packets per number of packets sent in unit of tenth of percent for an uplink voice service data flow. This AVP is only applicable for PCC rule with QCI=1. The value of this AVP shall be within range 0 to 1000.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.140",
      "section_id": "5.3.140",
      "section_title": "UE-Status AVP (3GPP-EPS access type)",
      "content": "The UE-Status AVP (AVP code 2854) is of type Unsigned32. It is sent from the PCEF to the PCRF to indicate the status of the UE.\nThe following values are defined in this specification:\n1 (UE status suspend)\nThis value indicates that the policy enforcement has failed because the UE is in suspend status, and that the PCRF should refrain from sending policy decisions to the PCEF until it is informed that the UE has been resumed. This value shall not be used if the IP-CAN Session Modification procedure is initiated for PCC rule removal only.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.3.141",
      "section_id": "5.3.141",
      "section_title": "Presence-Reporting-Area-Node AVP (3GPP-EPS access type)",
      "content": "The Presence-Reporting-Area-Node AVP (AVP code 2855) is of type Unsigned32, it shall contain a bit mask. The bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x0001 should be used. The meaning of the bits shall be as defined below:\nTable 5.3.141: Presence-Reporting-Area-Node\nBit\nName\nDescription\n0\nOCS\nThis bit, when set, indicates that the OCS subscribes to the UE status.\n1\nPCRF\nThis bit, when set, indicates that the PCRF subscribes to the UE status.\nNOTE:\tThe AVP is only introduced for reuse within charging management.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.3.141"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.4.0",
      "section_id": "5.4.0",
      "section_title": "General",
      "content": "Table 5.4.0.1 lists the Diameter AVPs re-used by the Gx reference point from existing Diameter Applications, reference to their respective specifications, short description of their usage within the Gx reference point, the applicability of the AVPs to charging control, policy control or both, and which supported features the AVP is applicable to. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table 5.4.0.1, but they are re-used for the Gx reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings. Where 3GPP Radius VSAs are re-used, unless otherwise stated, they shall be translated to Diameter AVPs as described in RFC 4005 [12] with the exception that the 'M' flag shall be set and the 'P' flag may be set.\nTable 5.4.0.1: Gx re-used Diameter AVPs\nAttribute Name\nReference\nDescription\nAcc. Type\nApplicability (notes 1, 4)\n3GPP-Charging-Characteristics\n3GPP TS 29.061 [11]\nThe Charging Characteristics applied to the IP-CAN session.\nThis AVP shall have the 'M' bit cleared.\nAll\nABC\n3GPP-GGSN-Address\n3GPP TS 29.061 [11]\nThe Ipv4 address of the P-GW.\nThis AVP shall have the 'M' bit cleared.\nAll (NOTE 8)\nBoth\nEPC-routed, ABC\n3GPP-GGSN-Ipv6-Address\n3GPP TS 29.061 [11]\nThe Ipv6 address of the P-GW.\nThis AVP shall have the 'M' bit cleared.\nAll (NOTE 8)\nBoth\nEPC-routed, ABC\n3GPP-MS-TimeZone\n3GPP TS 29.061 [11]\nIndicate the offset between universal time and local time in steps of 15 minutes of where the MS currently resides.\nAll\nBoth\n3GPP-RAT-Type\n(NOTE 3)\n3GPP TS 29.061 [11]\nIndicate which Radio Access Technology is currently serving the UE.\n3GPP-GPRS\nBoth\n3GPP-Selection-Mode\n3GPP TS 29.061 [11]\nAn index indicating how the APN was selected.\nThis AVP shall have the 'M' bit cleared.\nAll\nABC\n3GPP-SGSN-Address\n3GPP TS 29.061 [11]\nThe Ipv4 address of the SGSN\n3GPP-GPRS, 3GPP-EPS\nBoth\n3GPP-SGSN-Ipv6-Address\n3GPP TS 29.061 [11]\nThe Ipv6 address of the SGSN\n3GPP-GPRS.\n3GPP-EPS\nBoth\n3GPP-SGSN-MCC-MNC\n(NOTE 6)\n3GPP TS 29.061 [11]\nFor GPRS the MCC and the MNC of the SGSN.\nFor 3GPP/non-3GPP accesses the MCC and the MNC provided by the serving gateway (SGW, or AGW or TWAG).\nAll\nBoth\n3GPP-User-Location-Info\n3GPP TS 29.061 [11]\nIndicates details of where the UE is currently located (e.g. SAI, CGI or eNodeB ID)\n3GPP-GPRS.\n3GPP-EPS\nBoth\n3GPP2-BSID\n3GPP2 X.S0057 [24]\nFor 3GPP2 indicates the BSID of where the UE is currently located (e.g. Cell-Id, SID, NID).\nThe Vendor-Id shall be set to 3GPP2 (5535) [24].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the value 5535, identifying 3GPP2, in a Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\n3GPP2,\nNon-3GPP-EPS\nBoth\nRel8\nAccess‑Network-Charging-Address\n3GPP TS 29.214 [10]\nIndicates the IP Address of the network entity within the access network performing charging (e.g. the GGSN IP address).\nAll\nCC\nAccess‑Network-Charging-Identifier-Value\n3GPP TS 29.214 [10]\nContains a charging identifier (e.g. GCID).\nAll\nCC\nAF-Charging-Identifier\n3GPP TS 29.214 [10]\nThe AF charging identifier that may be used in charging correlation. For IMS the ICID. This AVP may only be included in a Charging-Rule-definition AVP if the SERVICE_IDENTIFIER_LEVEL reporting is being selected with the Reporting-Level AVP.\nAll\nCC\nAF-Signalling-Protocol\n3GPP TS 29.214 [10]\nIndicates the protocol used for signalling between the UE and the AF.\nAll\nBoth\nProvAF-signalFlow\nAN-Trusted\n3GPP TS 29.273 [48]\nIndicates whether the access network is trusted or untrusted for the Non-3GPP access network. This AVP shall have the 'M' bit cleared.\nNon-3GPP-EPS\nBoth\nApplication-Service-Provider-Identity\n3GPP TS 29.214 [10]\nFor sponsored connectivity, the identity of the application service provider that is delivering a service to a end user.\nAll\nBoth\nSponsoredConnectivity\nBSSID\n3GPP TS 32.299 [19]\nContains the BSSID of the access point where UE is located.\nFBA\nBoth\nFBAC\nCalled-Station-Id\nIETF RFC 4005 [12]\nThe address the user is connected to. For GPRS and EPS the APN. When used to contain the APN, the APN is composed of the APN Network Identifier only, or the APN Network Identifier and the APN Operator Identifier as specified in TS 23.003 [25], clause 9.1. The inclusion of the APN Operator Identifier can be configurable.\nAll\nBoth\nCallee-Information\n3GPP TS 29.214 [10]\nContains the callee information.\nEPS\nVBCLTE\nCalling-Party-Address\n3GPP TS 32.299 [19]\nThe address or addresses (Public User ID or Public Service ID) of the party requesting a service or initiating a session.\nEPS\nVBCLTE\nCC-Request-Number\nIETF RFC 8506 [66]\nThe number of the request for mapping requests and answers\nAll\nBoth\nCC-Request-Type\nIETF RFC 8506 [66]\nThe type of the request (initial, update, termination)\nAll\nBoth\nCharging-Information\n3GPP TS 29.229 [14]\nThe Charging-Information AVP is of type Grouped, and contains the addresses of the charging functions in the following AVPs:\n-\tPrimary-Event-Charging-Function-Name is of type DiameterURI and defines the address of the primary online charging system. The protocol definition in the DiameterURI shall be either omitted or supplied with value \"Diameter\".\n-\tSecondary-Event-Charging-Function-Name is of type DiameterURI and defines the address of the secondary online charging system for the bearer. The protocol definition in the DiameterURI shall be either omitted or supplied with value \"Diameter\".\n-\tPrimary-Charging-Collection-Function-Name is of type DiameterURI and defines the address of the primary offline charging system for the bearer. If the GTP' protocol is applied on the Gz interface as specified in TS 32.295 [16], the protocol definition in the DiameterURI shall be omitted. If Diameter is applied on the Gz interface, the protocol definition in DiameterURI shall be either omitted or supplied with value \"Diameter\". The choice of the applied protocol on the Gz interface depends upon configuration in the PCEF.\n-\tSecondary-Charging-Collection-Function-Name is of type DiameterURI and defines the address of the secondary offline charging system for the bearer. If the GTP' protocol is applied on the Gz interface as specified in TS 32.295 [16], the protocol definition in the DiameterURI shall be omitted. If Diameter is applied on the Gz interface, the protocol definition in DiameterURI shall be either omitted or supplied with value \"Diameter\". The choice of the applied protocol on the Gz interface depends upon configuration in the PCEF.\nAll\nCC\nContent-Version\n3GPP TS 29.214 [10]\nIt indicates the content version of a PCC rule. It uniquely identifies a version of the PCC rule as defined in subclause 4.5.28\nAll\nRuleVersioning\nDRMP\nIETF RFC 7944 [53]\nAllows Diameter endpoints to indicate the relative priority of Diameter transactions.\nAll\nBoth\nDynamic-Address-Flag\n3GPP TS 32.299 [19]\nIndicates whether the PDP context/PDN address is statically or dynamically allocated.\nThis AVP shall have the 'M' bit cleared.\nAll\nABC\nDynamic-Address-Flag-Extension\n3GPP TS 32.299 [19]\nIndicates that the Ipv4 PDN address has been dynamically allocated for that particular IP-CAN bearer (PDN connection) of PDN type Ipv4v6, while the dynamic Ipv6 address is indicated in Dynamic Address Flag.\nThis AVP shall have the 'M' bit cleared.\nAll\nABC\nExtended-Max-Requested-BW-DL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbit per second for downlink.\nAll\nPC\nExtended-BW-NR\nExtended-Max-Requested-BW-UL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbit per second for uplink.\nAll\nPC\nExtended-BW-NR\nFinal-Unit-Indication\nIETF RFC 8506 [66]\nThe action applied by the PCEF, and the related filter parameters and redirect address parameters (if available), when the user's account cannot cover the service cost.\nAll\nCC\nFlow-Description\n3GPP TS 29.214 [10],5.4.2\nDefines the service data flow filter parameters for a PCC rule or routing filter parameters for an IP flow mobility routing rule. The rules for usage on Gx are defined insub clause 5.4.2.\nAll\nBoth\nFlows\n3GPP TS 29.214 [10]\nThe flow identifiers of the IP flows related to a PCC rule as provided by the AF. May be only used in charging correlation together with AF-Charging-Identifier AVP.\nAll\nCC\nFlow-Status\n3GPP TS 29.214 [10]\nDefines whether the service data flow is enabled or disabled. The value \"REMOVED\" is not applicable to Gx.\nAll\nBoth\nFramed-IP-Address\nIETF RFC 4005 [12]\nThe Ipv4 address allocated for the user.\nAll\nBoth\nFramed-Ipv6-Prefix\nIETF RFC 4005 [12]\nThe Ipv6 prefix allocated for the user.\nThe encoding of the value within this Octet String type AVP shall be as defined in IETF RFC 3162 [15], clause 2.3. The \"Reserved\", \"Prefix-Length\" and \"Prefix\" fields shall be included in this order. For FBA, it may indicate an Ipv6 address by setting the \"Prefix Length\" to 128 and encoding the Ipv6 address of the fixed device within the \"Prefix\" field as defined in annex G.5.2.\nAll\nBoth\nGranted-Service-Unit\n(NOTE 5) (NOTE 7)\nIETF RFC 8506 [66]\nThe volume and/or time threshold for usage monitoring control purposes. Only the CC-Total-Octets, one of the CC-Input-Octets and CC-Output-Octets or CC-Time AVPs are re-used. Monitoring-Time AVP as defined in 5.3. 99 may be optionally added to the grouped AVP if UMCH feature is supported.\nThis AVP shall have the 'M' bit cleared.\nAll\nBoth\nRel9\nTimeBasedUM\nLoad\nIETF RFC 8583 [60]\nThe AVP used to convey load information between Diameter nodes.\nThis AVP and all AVPs within this grouped AVP shall have the 'M' bit cleared.\nAll\nLogical-Access-ID\n3GPP TS 283 034 [37]\nContains a Circuit‑ID (as defined in RFC 3046 [36]). The Logical Access ID may explicitly contain the identity of the Virtual Path and Virtual Channel carrying the traffic.\nThe vendor-id shall be set to ETSI (13019) [37].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\nxDSL\nBoth\nRel10\nMax-Requested-Bandwidth-UL(NOTE 2)\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in bit per second for uplink.\nAll\nPC\nMax-Requested-Bandwidth-DL(NOTE 2)\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in bit per second for downlink.\nAll\nPC\nMaximum-Wait-Time\n3GPP TS 29.273 [48]\nIt indicates the number of milliseconds since the originating time stamp during which the originator of a request waits for a response.\nAll\nOC-OLR\nIETF RFC 7683 [49]\nContains the necessary information to convey an overload report\nAll\nBoth\nOC-Supported-Features\nIETF RFC 7683 [49]\nDefines the support for the Diameter overload indication conveyence by the sending node\nAll\nBoth\nOrigination-Time-Stamp\n3GPP TS 29.273 [48]\nIt indicates the UTC time when the originating entity (i.e. MME, SGSN, TWAN or ePDG) initiated the request.\nAll\nPDN-Connection-Charging-ID\n3GPP TS 32.299 [19]\nContains the charging identifier to identify different records belonging to same PDN connection. When NBIFOM is supported, this field includes the Charging Id assigned by the PGW for the PDN connection.\nOtherwise,this field includes Charging Id of first IP-CAN bearer activated within the PDN connection (the EPS default bearer in case of GTP based connectivity or the unique Charging Id in the PMIP based connectivity case).\nThis AVP shall have the 'M' bit cleared.\nAll\nABC\nPhysical-Access-ID\nETSI TS 283 034 [37]\nIdentifies the physical access to which the user equipment is connected. Includes a port identifier and the identity of the access node where the port resides.\nThe vendor-id shall be set to ETSI (13019) [37].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\nxDSL\nBoth\nRel10\nQuota-Consumption-Time\n3GPP TS 32.299 [19]\nDefines the time interval in seconds after which the time measurement shall stop for the Monitoring Key, if no packets are received belonging to the corresponding Monitoring Key.\nThis AVP shall have the 'M' bit cleared.\nAll\nTimeBasedUM\nRAI\n3GPP TS 29.061 [11]\nContains the Routing Area Identity of the SGSN where the UE is registered\n3GPP-GPRS.\n3GPP-EPS\nBoth\nRating-Group\nIETF RFC 8506 [66]\nThe charging key for the PCC rule used for rating purposes\nAll\nCC\nRedirect-Address-Type\nIETF RFC 8506 [66]\nDefines the address type of the address given in the Redirect-Server-Address AVP.\nAll\nPC\nADC\nRedirect-Server-Address\nIETF RFC 8506 [66]\nIndicates the target for redirected application traffic.\nAll\nPC\nADC\nRequired-Access-Info\n3GPP TS 29.214 [10]\nIndicates the access network information for which the AF entity requests the PCRF reporting.\n3GPP-GPRS.\n3GPP-EPS\nCC\nNetLoc\nService-Identifier\nIETF RFC 8506 [66]\nThe identity of the service or service component the service data flow in a PCC rule relates to.\nAll\nCC\nSharing-Key-DL\n3GPP TS 29.214 [10]\nIndicates, by containing the same value, what PCC rules may share resource in downlink direction.\nAll\nResShare\nSharing-Key-UL\n3GPP TS 29.214 [10]\nIndicates, by containing the same value, what PCC rules may share resource in uplink direction.\nAll\nResShare\nSponsor-Identity\n3GPP TS 29.214 [10]\nFor sponsored data connectivity, it Identifies the sponsor willing to pay for the operator's charge for connectivity.\nAll\nCCSponsoredConnectivity\nSSID\n3GPP TS 29.273 [48]\nContains the SSID of the access point where UE is located\nFBA\nBoth\nFBAC\nSubscription-Id\nIETF RFC 8506 [66]\nThe identification of the subscription (IMSI, MSISDN, etc)\nAll\nBoth\nSupported-Features\n3GPP TS 29.229 [14]\nIf present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange.\nAll\nBoth\nRel8\nTrace-Data\n(NOTE 5)\n3GPP TS 29.272 [26]\nContains trace control and configuration parameters, specified in TS 32.422 [27].\nThis AVP shall have the 'M' bit cleared.\n3GPP-EPS\nBoth\nRel8\nTrace-Reference\n3GPP TS 29.272 [26]\nContains the trace reference parameter, specified in TS 32.422 [27].\nThis AVP shall have the 'M' bit cleared.\n3GPP-EPS\nBoth\nRel8\nTWAN-Identifier\n3GPP TS 29.061 [11]\nIndicates the UE location in a Trusted WLAN Access Network.\nIndicates the UE location in an Untrusted WLAN Access Network.\nNon-3GPP-EPS\nTrusted-WLAN\nNetLoc-Trusted-WLAN\nNetLoc- Untrusted-WLAN\nUser-CSG-Information\n3GPP TS 32.299 [19]\nIndicates the user \"Closed Subscriber Group\" Information associated to CSG cell access: it comprises the CSG-Id, CSG-Access-Mode and CSG-Membership-Indication AVPs.\n3GPP-EPS\nCC\nRel9\nUser-Equipment-Info\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, etc.)\nWhen the User-Equipment-Info-Type is set to IMEISV(0), the value within the User-Equipment-Info-Value shall be a UTF-8 encoded decimal.\nAll\nBoth\nUser-Equipment-Info-Extension\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, IMEI, etc.)\nWhen the User-Equipment-Info-IMEISV or the User-Equipment-Info-IMEI is used, it shall be a UTF-8 encoded decimal.\nAll\nBoth\nUser-Equipment-Info-Extension\nUsed-Service-Unit\n(NOTE 5) (NOTE 7)\nIETF RFC 8506 [66]\nThe measured volume and/or time for usage monitoring control purposes. The volume threshold for usage monitoring control purposes. Only the CC-Total-Octets, one of the CC-Input-Octets and CC-Output-Octets, or CC-Time AVPs are re-used. Monitoring-Time AVP as defined in clause 5.3.99 may be optionally added to the grouped AVP if UMCH feature is supported.\nThis AVP shall have the 'M' bit cleared.\nAll\nBoth\nRel9\nTimeBasedUM\nNOTE 1:\tAVPs marked with \"CC\" are applicable to charging control, AVPs marked with \"PC\" are applicable to policy control and AVPs marked with \"Both\" are applicable to both charging control and policy control.\nNOTE 2:\tWhen sending from the PCRF to the PCEF, the Max-Requested-Bandwidth-UL/DL AVP indicate the maximum allowed bit rate for the uplink/downlink direction; when sending from the PCEF to the PCRF, the Max-Requested-Bandwidth-UL/DL AVP indicate the maximum requested bit rate for the uplink/downlink direction.\nNOTE 3:\tThis AVP is included for backward compatibility purposes when the PCEF only supports features that are not required for the successful operation of the session.\nNOTE 4:\tAVPs marked with a supported feature (e.g. \"Rel8\", \"Rel9\", \"ProvAFsignalFlow\" or \"SponsoredConnectivity\" or \"ADC\" ) are applicable as described in clause 5.4.1.\nNOTE 5:\tAVPs included within this grouped AVP shall have the 'M' bit cleared.\nNOTE 6:\tFor Trusted WLAN access, TWAG provides the MCC and the MNC of the selected PLMN as described in subclause16.2.1 of TS 23.402 [23].\nNOTE 7:\tVolume Usage monitoring control functionality is applicable for Rel9 supported feature. Time Based Usage monitoring control is applicable for TimeBasedUM supported feature.\nNOTE 8:\tFor EPC routed feature, only Non-3GPP-EPS is applicable.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_9.1",
        "clause_4.5.28",
        "ts_29.214_clause_5.4.2",
        "clause_2.3",
        "clause_5.3.99",
        "clause_5.4.1",
        "table_5.4.0.1",
        "ts_29.061",
        "ts_29.214",
        "ts_29.273",
        "ts_32.299",
        "ts_23.003",
        "ts_29.229",
        "ts_32.295",
        "ts_29.272",
        "ts_32.422",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.4.1",
      "section_id": "5.4.1",
      "section_title": "Use of the Supported-Features AVP on the Gx reference point",
      "content": "The Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The client shall, in the first request in a Diameter session indicate the set of supported features. The server shall, in the first answer within the Diameter session indicate the set of features that it has in common with the client and that the server shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the Gx reference point shall be compliant with the requirements for dynamic discovery of supported features and associated error handling on the Cx reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [14].\nThe base functionality for the Gx reference point is the 3GPP Rel-7 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the Gx commands. As defined in clause 7.1.1 of 3GPP TS 29.229 [14], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [14], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the Gx reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the Gx reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [14]. The following exceptions apply to the initial CCR/CCA command pair:\n-\tIf the PCEF supporting post-Rel-7 Gx functionality is able to interoperate with a PCRF supporting Rel-7, the CCR shall include the features supported by the PCEF within Supported-Features AVP(s) with the 'M' bit cleared. Otherwise, the CCR shall include the supported features within the Supported-Features AVP(s) with the M-bit set.\nNOTE 1:\tOne instance of Supported-Features AVP is needed per Feature-List-ID.\n-\tIf the CCR command does not contain any Supported-Features AVP(s) and the PCRF supports Rel-7 Gx functionality, the CCA command shall not include the Supported-Features AVP. In this case, both PCEF and PCRF shall behave as specified in the Rel-7 version of this document.\n-\tIf the CCR command contains the Supported-Features AVP, the PCRF shall include the Supported-Features AVP in the CCA command, with the 'M' bit cleared, indicating only the features that both the PCRF and PCEF support. In this case, the PCRF should not use the 'M' bit setting of the Supported-Features AVP(s) to determine if the CCR is accepted or rejected.\nNOTE 2:\tThe client will always declare all features that are supported according to table 5.4.1.1 and 5.4.1.2. When more than one feature identifying a release is supported by both PCEF and PCRF, the PCEF will work according to the latest common supported release.\nOnce the PCRF and PCEF have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe tables below define the features applicable to the Gx interfaces for the feature lists with a Feature-List-ID of 1 and 2.\nTable 5.4.1.1: Features of Feature-List-ID 1 used in Gx\nFeature bit\nFeature\nM/O\nDescription\n0\nRel8\nM\nThis feature indicates the support of base 3GPP Rel-8 Gx functionality, including the AVPs and corresponding procedures supported by the base 3GPP Rel-7 Gx standard, but excluding those features represented by separate feature bits. AVPs introduced with this feature are marked with \"Rel8\" in table 5.3.0.1.\n1\nRel9\nM\nThis feature indicates the support of base 3GPP Rel-9 Gx functionality, including the AVPs and corresponding procedures supported by the Rel8 feature bit, but excluding those features represented by separate feature bits. AVPs introduced with this feature are marked with \"Rel9\" in table 5.3.0.1.\n2\nProvAFsignalFlow\nO\nThis feature indicates support for the feature of IMS Restoration as described in subclause 4.5.18. If PCEF supports this feature the PCRF may provision AF signalling IP flow information.\n3\nRel10\nM\nThis feature indicates the support of base 3GPP Rel-10 Gx functionality, including the AVPs and corresponding procedures supported by the Rel8 and Rel9 feature bit, but excluding those features represented by separate feature bits. AVPs introduced with this feature are marked with \"Rel10\" in table 5.3.0.1.\n4\nSponsoredConnectivity\nO\nThis feature indicates support for sponsored data connectivity feature. If the PCEF supports this feature, the PCRF may authorize sponsored data connectivity to the subscriber.\n5\nIFOM\nO\nThis feature indicates support for IP flow mobility feature. If the PCEF supports this feature, the PCRF shall behave as described in subclause 4a.5.7.3.\n6\nADC\nO\nThis feature indicates support for the Application Detection and Control feature.\n7\nvSRVCC\nO\nThis feature indicates support for the vSRVCC feature (see TS 23.216 [40]).\n8\nEPC-routed\nO\nThis feature indicates support for interworking with Fixed Broad band Access networks when the traffic is routed via the EPC network as defined in Annex E.\n9\nrSRVCC\nO\nThis feature indicates support for the CS to PS SRVCC feature (see TS 23.216 [40]).\n10\nNetLoc\nO\nThis feature indicates the support of the Access Network Information Reporting for GPRS and EPS. If the PCEF supports this feature, the PCRF shall behave as described in subclause 4.5.22\n11\nUMCH\nO\nThis feature indicates support for Usage Monitoring Congestion Handling. If the PCEF supports this feature, the behaviour shall be as specified in subclause 4.5.17.6.\n12\nExtendedFilter\nO\nThis feature indicates the support for the local (i.e. UE) address and mask being present in filters signalled between network and UE.\n13\nTrusted-WLAN\nO\nThis feature indicates the support for the Trusted WLAN access as defined in 3GPP TS 23.402 [23].\n14\nSGW-Rest\nO\nThis feature indicates the support of SGW Restoration procedures as defined in 3GPP TS 23.007 [43].\n15\nTimeBasedUM\nO\nThis feature indicates support for Time based Usage Monitoring Control. If the PCEF supports this feature, the behaviour shall be as specified in corresponding clauses in this specification.\n16\nPendingTransaction\nO\nThis feature indicates support for the race condition handling as defined in 3GPP TS 29.213 [8].\n17\nABC\nO\nThis feature indicates support for Application Based Charging.\n18\nvoid\n19\nNetLoc-Trusted-WLAN\nO\nThis feature indicates the support of the Access Network Information Reporting for Trusted WLAN. If supported, the PCEF and the PCRF shall behave as described in annex D.3, this feature is applicable only if NetLoc feature and Trusted-WLAN feature are also supported.\n20\nFBAC\nO\nThis feature indicates support for the Fixed Broadband Access Convergence as defined in Annex G.\n21\nConditionalAPNPolicyInfo\nO\nThis feature indicates support for APN related policy information with condition as defined in subclause 4.5.5.7.\nNot applicable to IPFlowMobility functionality feature (IFOM) as described in clause 5.4.1 or NBIFOM functionality feature as defined in subclause 4.5.25.\n22\nRAN-NAS-Cause\nO\nThis feature indicates the support for the detailed release cause code information (NOTE 1) from the access network.\n23\nCNO-ULI\nO\nThis feature indicates support for Presence Reporting Area Information reporting. If the PCEF supports this feature, the PCRF shall behave as described in Annex B.3.16. (NOTE 2)\n24\nPCSCF-Restoration-Enhancement\nO\nThis feature indicates support of P-CSCF Restoration Enhancement. It is used for the PCEF to indicate if it supports P-CSCF Restoration Enhancement.\n25\nMissionCriticalQCIs\nO\nThis feature indicates support for the Mission Critical QCI values 65, 69 and 70, and the Non Mission Critical QCI value 66 within the QoS-Class-Identifier AVP defined in subclause 5.3.17.\n26\nResShare\nO\nThis feature indicates the support of service data flows that share resources. If the PCEF supports this feature, the PCRF shall behave as described in subclause 4.5.5.11.\n27\nExUsage\nO\nThis feature indicates support for excluding the corresponding service data flow for the volume and/or time measurement on IP-CAN session level.\n28\nNBIFOM\nO\nThis feature indicates support for network-based IP flow mobility as described in 3GPP TS 23.161 [51].\n29\nTSC\nO\nThis feature indicates support for traffic steering control in the (S)Gi-LAN. If the PCEF supports this feature, the PCRF shall behave as described in subclause 4.5.2.8.\n30\nNetLoc-Untrusted-WLAN\nO\nThis feature indicates the support of the Access Network Information Reporting for Untrusted WLAN access as defined in 3GPP TS 23.203 [7]. If supported, the PCEF shall behave as described in annex D.4.It requires that NetLoc feature is also supported.\n31\nCondPolicyInfo\nO\nThis feature indicates support for time controlled APN-AMBR as defined in subclause 4.5.5.12.\nNot applicable to IPFlowMobility functionality feature (IFOM) as described in subclause 5.4.1 or NBIFOM functionality feature as defined in subclause 4.5.25 if this feature is used together with the feature ConditionalAPNPolicyInfo.\nFeature bit:\tThe order number of the bit within the Feature-List AVP where the least significant bit is assigned number \"0\".\nFeature:\tA short name that can be used to refer to the bit and to the feature, e.g. \"EPS\".\nM/O:\tDefines if the implementation of the feature is mandatory (\"M\") or optional (\"O\") in this 3GPP Release.\nDescription:\tA clear textual description of the feature.\nNOTE 1:\tIn this release, the release cause code information from the access network can include RAN/NAS release cause(s), a TWAN release cause or an untrusted WLAN release cause.\nNOTE 2:\tCNO-ULI feature will only be used when the PCEF and/or the PCRF does not support Multiple-PRA (see Table 5.4.1.2) and both PCEF and PCRF support CNO-ULI.\nTable 5.4.1.2: Features of Feature-List-ID 2 used in Gx\nFeature bit\nFeature\nM/O\nDescription\n0\nEnh-RAN-NAS-Cause\nO\nThis feature indicates the support of the detailed release cause code information from the access network in the PCRF-initiated PCC Rule removal scenarios. It requires that RAN-NAS-Cause feature is also supported.\n1\nENB-Change\nO\nThis feature indicates support of eNodeB change reporting Enhancement. It is used for the PCEF to indicate if it supports eNodeB change reporting Enhancement.\n2\nRuleVersioning\nO\nThis feature indicates the support of PCC rule versioning as defined in subclause 4.5.28\n3\nMultiple-PRA\nO\nThis feature indicates support for Multiple Presence Reporting Area Information reporting. If the PCEF supports this feature, the PCRF shall behave as described in Annex B.3.17.\n4\nCondPolicyInfo-DefaultQoS\nO\nThis feature indicates support for time controlled default EPS bearer QoS as defined in subclause 4.5.5.12. It requires that Rule-Bound-to-Default-Bearer feature is also supported.\n5\nRule-Bound-to-Default-Bearer\nO\nThis feature indicates support for policy provisioning and enforcement of authorized QoS for service data flows that shall be bound to the default bearer feature as defined in subclause 4.5.5.13.\n6\n3GPP-PS-Data-Off\nO\nThis feature indicates the support of 3GPP PS Data off status change reporting. If this feature is supported, the PCEF and the PCRF shall behave as defined in subclause 4.5.29.\n7\nExtended-BW-NR\nO\nThis feature indicates the support of extended bandwidth values for NR.\n8\nRAN-Support-Info\nO\nThis feature indicates the support of maximum packet loss rate value(s) for uplink and/or downlink voice service data flow(s).\n9\nMCVideoQCI\nO\nThis feature indicates support for the Mission Critical Video QCI value 67 within the QoS-Class-Identifier AVP defined in subclause 5.3.17.\n10\nUE-Status-Change\nO\nThis feature indicates the support of report when the UE is suspended and then resumed from suspend state. If this feature is supported, the PCEF and the PCRF shall behave as defined in subclause 4.5.31.\n11\nADC-Add-Redirection\nO\nThis feature indicates support for additional redirection information in application detection and control. It requires the support of ADC feature.\n12\nVBCLTE\nO\nThis feature indicates the support of providing the caller and callee information for Volume Based Charging as defined in subclause A.16 3GPP TS 29.214 [10].\n13\nMPSforDTS\nO\nIndicates support for MPS for DTS as described in subclauses 4.5.19.1.1 and 4.5.19.1.4\n14\nUser-Equipment-Info-Extension\nO\nThis feature indicates the support of the User-Equipment-Info-Extension AVP as defined in IETF RFC 8506 [66].\nFeature bit: The order number of the bit within the Feature-List AVP where the least significant bit is assigned number \"0\".\nFeature: A short name that can be used to refer to the bit and to the feature, e.g. \"EPS\".\nM/O: Defines if the implementation of the feature is mandatory (\"M\") or optional (\"O\") in this 3GPP Release.\nDescription: A clear textual description of the feature.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229_clause_7.2.1",
        "ts_29.229_clause_7.1.1",
        "clause_4.5.18",
        "clause_4",
        "clause_4.5.22",
        "clause_4.5.17.6",
        "clause_4.5.5.7",
        "clause_5.4.1",
        "clause_4.5.25",
        "clause_5.3.17",
        "clause_4.5.5.11",
        "clause_4.5.2.8",
        "clause_4.5.5.12",
        "clause_4.5.28",
        "clause_4.5.5.13",
        "clause_4.5.29",
        "clause_4.5.31",
        "table_5.4.1.1",
        "table_5.3.0.1",
        "table_5.4.1.2",
        "ts_29.229",
        "ts_23.216",
        "ts_23.402",
        "ts_23.007",
        "ts_29.213",
        "ts_23.161",
        "ts_23.203",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.4.2",
      "section_id": "5.4.2",
      "section_title": "Flow-Description AVP",
      "content": "The Flow-Description AVP (AVP code is defined in 3GPP TS 29.214 [10]) is of type IPFilterRule, and defines a packet filter for an IP flow with the following information:\n-\tAction shall be keyword permit\"\n-\tDirection shall be keyword \"out\".\n-\tProtocol shall be the decimal protocol number or, to indicate that the value is not used for matching packets, the keyword \"ip\".\n-\tSource IP address (possibly masked) or, to indicate that the value is not used for matching packets, the keyword \"any\".\n-\tSource port is optional and, if present, shall be the decimal port number or port range.\n-\tDestination IP address (possibly masked) or, to indicate that the value is not used for matching packets, the keyword \"assigned\".\n-\tDestination port is optional and, if present, shall be the decimal port number or port range.\nThe IPFilterRule type shall be used with the following restrictions:\n-\tThe parameter encoding shall comply with  IETF RFC 6733 [61].\n-\tNo \"options\" shall be used.\n-\tThe invert modifier \"!\" for addresses shall not be used.\nThe direction \"out\" indicates that the IPFilterRule \"source\" parameters correspond to the \"remote\" parameters in the packet filter and the IPFilterRule \"destination\" parameters correspond to the \"local\" (UE end) parameters. The Flow-Description AVP applies in the direction(s) as specified in the accompanying Flow-Direction AVP.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.5.1",
      "section_id": "5.5.1",
      "section_title": "General",
      "content": "IETF RFC 6733 [61] specifies the Experimental-Result AVP containing Vendor-ID AVP and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code 298) is of type Unsigned32 and contains a vendor-assigned value representing the result of processing a request. The Vendor-ID AVP shall be set to 3GPP (10415).",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.5.2",
      "section_id": "5.5.2",
      "section_title": "Success",
      "content": "Result Codes that fall within the Success category are used to inform a peer that a request has been successfully completed.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] shall be applied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.5.3",
      "section_id": "5.5.3",
      "section_title": "Permanent Failures",
      "content": "Errors that fall within the Permanent Failures category shall be used to inform the peer that the request failed, and should not be attempted again.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] are applicable, as an addition the following Result-Code AVP value defined in IETF RFC 8506 [66] is applicable:\nDIAMETER_USER_UNKNOWN (5030)\nThis error shall be used by the PCRF to indicate to the PCEF that the end user specified in the request is unknown to the PCRF and that the Gx session cannot be created.\nFurther as an addition the following Experimental-Result AVP values defined in 3GPP TS 29.273 [48] are applicable:\nDIAMETER_ERROR_LATE_OVERLAPPING_REQUEST (5453)\nThis error shall be used by the PCRF to indicate that the incoming request collides with an existing session which has a more recent time stamp than the time stamp of the new request.\nDIAMETER_ERROR_TIMED_OUT_REQUEST (5454)\nThis error shall be used by the PCRF to indicate the incoming request is known to have already timed out at the originating entity.\nAlso the following specific Gx Experimental-Result-Codes values are defined:\nDIAMETER_ERROR_INITIAL_PARAMETERS (5140)\nThis error shall be used when the set of bearer or session or subscriber information needed by the PCRF for rule selection is incomplete or erroneous or not available for the decision to be made. (E.g. QoS, SGSN address, RAT type, TFT, subscriber information)\nDIAMETER_ERROR_TRIGGER_EVENT (5141)\nThis error shall be used when the set of bearer/session information sent in a CCR originated due to a trigger event been met is incoherent with the previous set of bearer/session information for the same bearer/session. (E.g. event trigger met was RAT changed, and the RAT notified is the same as before)\nDIAMETER_PCC_RULE_EVENT (5142)\nThis error shall be used when the PCC rules cannot be installed/activated. Affected PCC-Rules will be provided in the Charging-Rule-Report AVP including the reason and status as described in clause 4.5.12. Absence of the Charging-Rule-Report means that all provided PCC rules for that specific bearer/session are affected.\nDIAMETER_ERROR_BEARER_NOT_AUTHORIZED (5143)\nThis error shall be used when the PCRF cannot authorize an IP-CAN bearer (e.g. the authorized QoS would exceed the subscribed QoS) upon the reception of an IP-CAN bearer authorization request coming from the PCEF. The affected IP-CAN bearer is the one that triggered the corresponding CCR. The PCEF shall reject the attempt to initiate or modify the bearer indicated in the related CCR command.\nDIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED (5144)\nThis error shall be used when the PCRF does not accept one or more of the traffic mapping filters (e.g. TFT filters for GPRS) provided by the PCEF in a CC Request.\nDIAMETER_ERROR_CONFLICTING_REQUEST (5147)\nThis error shall be used when the PCRF cannot accept the UE-initiated resource request as a network-initiated resource allocation is already in progress that has packet filters that cover the packet filters in the received UE-initiated resource request. The PCEF shall reject the attempt for UE-initiated resource request.\nDIAMETER_ADC_RULE_EVENT (5148)\nThis error shall be used when the ADC rules cannot be installed/activated. Affected ADC Rules shall be provided in the ADC-Rule-Report AVP including the reason and status as described in clause 5b.3.6. Absence of the ADC-Rule-Report means that all provided ADC rules for that IP-CAN session are affected.\nDIAMETER_ERROR_NBIFOM_NOT_AUTHORIZED (5149)\nThis error shall be used when the PCRF cannot authorize NBIFOM applies to the multi-access PDN connection. (e.g. invalid combination of IP-CAN and RAT Types or not allowed by the subscription) upon the reception of an addition of an access request coming from the PCEF.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.5.12",
        "clause_5",
        "ts_29.273"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.5.4",
      "section_id": "5.5.4",
      "section_title": "Transient Failures",
      "content": "Errors that fall within the transient failures category are used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future.\nThe Result-Code AVP values defined in Diameter Base IETF RFC 6733 [61] are applicable. Also the following specific Gx Experimental-Result-Code value is defined for transient failures:\nDIAMETER_PCC_BEARER_EVENT (4141)\nThis error shall be used when for some reason a PCC rule cannot be enforced or modified successfully in a network initiated procedure. Affected PCC-Rules will be provided in the Charging-Rule-Report AVP including the reason and status as described in clause 4.5.12.\nDIAMETER_AN_GW_FAILED (4143)\nThis error shall be used when the policy decisions (i.e. installation/modification of PCC rules or provisioning of policy decisions not related to a PCC rule) received within a RAR initiated by the PCRF cannot be enforced by the PCEF because the AN-Gateway has failed. If one or more PCC Rules are affected, these PCC Rules will be provided in the Charging-Rule-Report AVP including the Rule-Failure-Code AVP set to AN_GW_FAILED (17), and PCC-Rule-Status AVP set to INACTIVE as described in clause 4.5.12. Applicable only to 3GPP-EPS.\nDIAMETER_PENDING_TRANSACTION (4144)\nThis error shall be used when a node that supports the PendingTransaction feature receives an incoming request on a session while it has an ongoing transaction on the same session and cannot handle the request as described in clause 8.2 of 3GPP TS 29.213 [8].\nDIAMETER_UE_STATUS_SUSPEND (4145)\nThis error shall be used when the policy decisions received within a RAR initiated by the PCRF cannot be enforced by the PCEF because the UE’s status is suspended. Applicable only to 3GPP-EPS access type and to functionality introduced with the UE-Status-Change feature as described in subclause 5.4.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5.12",
        "ts_29.213_clause_8.2",
        "clause_5.4.1",
        "ts_29.213"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.6.1",
      "section_id": "5.6.1",
      "section_title": "Gx Application",
      "content": "Gx Messages are carried within the Diameter Application(s) described in clause 5.1.\nExisting Diameter command codes from the Diameter base protocol IETF RFC 6733 [61] and the Diameter Credit Control Application IETF RFC 8506 [66] are used with the Gx specific AVPs specified in clause 5.3. The Diameter Credit Control Application AVPs and AVPs from other Diameter applications that are re-used are defined in clause 5.4. The Gx application identifier shall be included in the Auth-Application-Id AVP.\nIn order to support both PULL and PUSH procedures, a diameter session needs to be established for each IP-CAN session. For IP-CAN types that support multiple IP-CAN bearers (as in the case of GPRS), the diameter session is established when the very first IP-CAN bearer for the IP-CAN session is established.\nNOTE:\tSome of the AVPs included in the messages formats below are in bold to highlight that these AVPs are used by this specific protocol and do not belong to the original message definition in the DCC Application IETF RFC 8506 [66] or Diameter Base Protocol IETF RFC 6733 [61].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "clause_5.3",
        "clause_5.4"
      ]
    },
    {
      "chunk_id": "ts_29.212_5.6.2",
      "section_id": "5.6.2",
      "section_title": "CC-Request (CCR) Command",
      "content": "The CCR command, indicated by the Command-Code field set to 272 and the 'R' bit set in the Command Flags field, is sent by the PCEF to the PCRF in order to request PCC rules for a bearer and provision IP flow mobility routing rules. The CCR command is also sent by the PCEF to the PCRF in order to indicate bearer, PCC rule or IP flow mobility routing rule related events or the termination of the IP CAN bearer and/or session.\nMessage Format:\n<CC-Request> ::= < Diameter Header: 272, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ Credit-Management-Status ]\n[ Destination-Host ]\n[ Origin-State-Id ]\n*[ Subscription-Id ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n[ TDF-Information ]\n[ Network-Request-Support ]\n*[ Packet-Filter-Information ]\n[ Packet-Filter-Operation ]\n[ Bearer-Identifier ]\n[ Bearer-Operation ]\n[ Dynamic-Address-Flag ]\n[ Dynamic-Address-Flag-Extension ]\n[ PDN-Connection-Charging-ID ]\n[ Framed-IP-Address ]\n[ Framed-Ipv6-Prefix ]\n[ IP-CAN-Type ]\n[ 3GPP-RAT-Type ]\n[ AN-Trusted ]\n[ RAT-Type ]\n[ Termination-Cause ]\n[ User-Equipment-Info ]\n[ User-Equipment-Info-Extension ]\n[ QoS-Information ]\n[ QoS-Negotiation ]\n[ QoS-Upgrade ]\n[ Default-EPS-Bearer-QoS ]\n[ Default-QoS-Information ]\n0*2 [ AN-GW-Address ]\n[ AN-GW-Status ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ 3GPP-SGSN-Address ]\n[ 3GPP-SGSN-Ipv6-Address ]\n[ 3GPP-GGSN-Address ]\n[ 3GPP-GGSN-Ipv6-Address ]\n[ 3GPP-Selection-Mode ]\n[ RAI ]\n[ 3GPP-User-Location-Info ]\n[ Fixed-User-Location-Info ]\n[ User-Location-Info-Time ]\n[ User-CSG-Information ]\n[ TWAN-Identifier ]\n[ 3GPP-MS-TimeZone ]\n*[ RAN-NAS-Release-Cause ]\n[ 3GPP-Charging-Characteristics ]\n[ Called-Station-Id ]\n[ PDN-Connection-ID ]\n[ Bearer-Usage ]\n[ Online ]\n[ Offline ]\n*[ TFT-Packet-Filter-Information ]\n*[ Charging-Rule-Report ]\n*[ Application-Detection-Information ]\n*[ Event-Trigger ]\n[ Event-Report-Indication ]\n[ Access-Network-Charging-Address ]\n*[ Access-Network-Charging-Identifier-Gx ]\n*[ CoA-Information ]\n*[ Usage-Monitoring-Information ]\n[ NBIFOM-Support ]\n[ NBIFOM-Mode ]\n[ Default-Access ]\n[ Origination-Time-Stamp ]\n[ Maximum-Wait-Time ]\n[ Access-Availability-Change-Reason ]\n[ Routing-Rule-Install ]\n[ Routing-Rule-Remove ]\n[ HeNB-Local-IP-Address ]\n[ UE-Local-IP-Address ]\n[ UDP-Source-Port ]\n[ TCP-Source-Port ]\n*[ Presence-Reporting-Area-Information ]\n[ Logical-Access-ID ]\n[ Physical-Access-ID ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n[ 3GPP-PS-Data-Off-Status ]\n*[ AVP ]\nNOTE:\tMultiple instances of the Subscription-Id AVP in the CCR command correspond to multiple types of identifier for the same subscriber, for example IMSI and MSISDN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.6.3",
      "section_id": "5.6.3",
      "section_title": "CC-Answer (CCA) Command",
      "content": "The CCA command, indicated by the Command-Code field set to 272 and the 'R' bit cleared in the Command Flags field, is sent by the PCRF to the PCEF in response to the CCR command. It is used to provision PCC rules and event triggers for the bearer/session and to provide the selected bearer control mode for the IP-CAN session. If the PCRF performs the bearer binding, PCC rules will be provisioned at bearer level. The primary and secondary CCF and/or primary and secondary OCS addresses may be included in the initial provisioning.\nMessage Format:\n<CC-Answer> ::=  < Diameter Header: 272, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Supported-Features ]\n[ Bearer-Control-Mode ]\n*[ Event-Trigger ]\n[ Event-Report-Indication ]\n[ Origin-State-Id ]\n*[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n*[ Charging-Rule-Remove ]\n*[ Charging-Rule-Install ]\n[ Charging-Information ]\n[ Online ]\n[ Offline ]\n*[ QoS-Information ]\n[ Revalidation-Time ]\n[ Default-EPS-Bearer-QoS ]\n[ Default-QoS-Information ]\n[ Bearer-Usage ]\n*[ Usage-Monitoring-Information ]\n*[ CSG-Information-Reporting ]\n[ User-CSG-Information ]\n[ PRA-Install ]\n[ PRA-Remove ]\n[ Presence-Reporting-Area-Information ]\n[ Session-Release-Cause ]\n[ NBIFOM-Support ]\n[ NBIFOM-Mode ]\n[ Default-Access ]\n[ RAN-Rule-Support ]\n*[ Routing-Rule-Report ]\n0*4[ Conditional-Policy-Information ]\n[ Removal-Of-Access ]\n[ IP-CAN-Type ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.6.4",
      "section_id": "5.6.4",
      "section_title": "Re-Auth-Request (RAR) Command",
      "content": "The RAR command, indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the PCEF in order to provision PCC rules using the PUSH procedure initiate the provision of unsolicited PCC rules. It is used to provision PCC rules, event triggers and event report indications for the session. If the PCRF performs the bearer binding, PCC rules will be provisioned at bearer level.\nMessage Format:\n<RA-Request> ::= < Diameter Header: 258, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Re-Auth-Request-Type }\n[ Session-Release-Cause ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n*[ Event-Trigger ]\n[ Event-Report-Indication ]\n*[ Charging-Rule-Remove ]\n*[ Charging-Rule-Install ]\n[ Default-EPS-Bearer-QoS ]\n*[ QoS-Information ]\n[ Default-QoS-Information ]\n[ Revalidation-Time ]\n*[ Usage-Monitoring-Information ]\n[ PCSCF-Restoration-Indication ]\n0*4[ Conditional-Policy-Information ]\n[ Removal-Of-Access ]\n[ IP-CAN-Type ]\n[ PRA-Install ]\n[ PRA-Remove ]\n*[ CSG-Information-Reporting ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.212_5.6.5",
      "section_id": "5.6.5",
      "section_title": "Re-Auth-Answer (RAA) Command",
      "content": "The RAA command, indicated by the Command-Code field set to 258 and the 'R' bit cleared in the Command Flags field, is sent by the PCEF to the PCRF in response to the RAR command.\nMessage Format:\n<RA-Answer> ::=  < Diameter Header: 258, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ IP-CAN-Type ]\n[ RAT-Type ]\n[ AN-Trusted ]\n0*2 [ AN-GW-Address ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ 3GPP-SGSN-Address ]\n[ 3GPP-SGSN-Ipv6-Address ]\n[ RAI ]\n[ 3GPP-User-Location-Info ]\n[ User-Location-Info-Time ]\n[ NetLoc-Access-Support ]\n[ User-CSG-Information ]\n[ 3GPP-MS-TimeZone ]\n[ Default-QoS-Information ]\n*[ Charging-Rule-Report]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ AVP ]\n5a\tGxx protocols\n5a.1\tProtocol support\nThe Gxx application is defined as a vendor specific Diameter application, where the vendor is 3GPP and the Application-ID for the Gxx Application in the present release is 16777266. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.\nNOTE:\tA route entry can have a different destination based on the application identification AVP of the message. Therefore, Diameter agents (relay, proxy, redirection, translation agents) need to be configured appropriately to identify the 3GPP Gxx application within the Auth-Application-Id AVP in order to create suitable routeing tables.\nThe Gxx application identification shall be included in the Auth-Application-Id AVP.\nWith regard to the Diameter protocol defined over the Gxx interface, the PCRF acts as a Diameter server, in the sense that it is the network element that handles QoS Rule requests for a particular realm. The BBERF acts as the Diameter client, in the sense that it is the network element requesting QoS rules in the transport plane network resources.\n5a.2\tInitialization, maintenance and termination of connection and session\nThe initialization and maintenance of the connection between the BBERF and PCRF (visited or home) are defined by the underlying protocol. Establishment and maintenance of connections between Diameter nodes are described in IETF RFC 6733 [61].\nAfter establishing the transport connection, the PCRF and the BBERF shall advertise the support of the Gxx specific Application by including the value of the application identifier in the Auth-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands are specified in the Diameter Base Protocol (IETF RFC 6733 [61]).\nThe termination of the Diameter session on Gxx can be initiated either by the BBERF or PCRF, as specified in clauses 4a.5.3 and 4a.5.4, respectively.\n5a.3\tGxx specific AVPs\n5a.3.0\tGeneral\nTable 5a.3.0.1 describes the Diameter AVPs defined for the Gxx reference point, their AVP Code values, types, possible flag values, whether or not the AVP may be encrypted and what access types (e.g. 3GPP-EPS, etc.) the AVP is applicable to. The Vendor-Id header of all AVPs defined in the present document shall be set to 3GPP (10415).\nTable 5a.3.0.1: Gxx specific Diameter AVPs\nAVP Flag rules (NOTE 1)\nAttribute Name\nAVP Code\nClause defined\nValue Type (NOTE 2)\nMust\nMay\nShould not\nMust not\nMay Encr.\nAcc. Type\nApplicability\n(NOTE 5)\nQoS-Rule-Install\n1051\n5a.3.1\nGrouped\nM,V\nP\nY\nAll\nQoS-Rule-Remove\n1052\n5a.3.2\nGrouped\nM,V\nP\nY\nAll\nQoS-Rule-Definition\n1053\n5a.3.3\nGrouped\nM,V\nP\nY\nAll\nQoS-Rule-Name\n1054\n5a.3.4\nOctetString\nM,V\nP\nY\nAll\nQoS-Rule-Base-Name\n1074\n5a.3.7\nUTF8String\nV\nP\nM\nY\nAll\nRel9\nQoS-Rule-Report\n1055\n5a.3.5\nGrouped\nM,V\nP\nY\nAll\nSession-Linking-Indicator\n1064\n5a.3.6\nEnumerated\nM,V\nP\nY\nAll\n(NOTE4)\nNOTE 1:\tThe AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [61].\nNOTE 2:\tThe value types are defined in IETF RFC 6733 [61].\nNOTE 3:\tThe Gxx specific AVPs do not apply to 3GPP-GPRS Access Type.\nNOTE 4:\tThis AVP only applies to case 2b as defined in TS 29.213 [8]\nNOTE 5:\tAVPs marked with \"Rel9\" are applicable as described in clause 5a.4.1.\n5a.3.1\tQoS-Rule-Install AVP (All access types)\nThe QoS-Rule-Install AVP (AVP code 1051) is of type Grouped, and it is used to activate, install or modify QoS rules as instructed from the PCRF to the BBERF.\nFor installing a new QoS rule or modifying a QoS rule already installed, QoS-Rule-Definition AVP shall be used.\nFor activating a specific QoS rule predefined at the BBERF, QoS-Rule-Name AVP shall be used as a reference for that QoS rule. The QoS-Rule-Base-Name AVP is a reference that may be used for activating a group of QoS rules predefined at the BBERF.\nWhen Tunnel-Information AVP is provided it applies to all the QoS rules included within the QoS-Rule-Install AVP. When QoS rules are being modified, the newly provided Tunnel-Information AVP replaces previously provided Tunnel-Information AVP for the modified QoS rules. If Resource-Allocation-Notification AVP is included then it applies to all the rules within the QoS-Rule-Install AVP. If a QoS-Rule-Install AVP does not include the Resource-Allocation-Notification AVP, the resource allocation shall not be notified by the BBERF even if this AVP was present in previous installations of the same rule.\nIn case 2a, the QoS-Rule-Install AVP may also contain a charging identifier within the Access-Network-Charging-Identifier-Value AVP. The charging identifier information is used by the BBERF for charging correlation. When the Access-Network-Charging-Identifier-Value AVP is included, the identifier applies to all the QoS rules included within the QoS-Rule-Install AVP. The charging identifier value for a QoS rule shall be the same as that for the corresponding PCC rule. When a QoS rule is being modified and no new charging identifier is provided, then the previously provided charging identifier shall apply for the modified QoS rules.\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified then it applies to all the QoS rules within the QoS-Rule-Install AVP.\nThe 3GPP-GGSN-Address AVP, 3GPP-GGSN-Ipv6-Address AVP, AN-GW-Address AVP and UDP-Source-Port AVP are only applicable for S9a interface when provided. UDP-Source-Port AVP provided within QoS-Rule-Install AVP is only applicable for the trusted S2c case and shall take precedence over the one provided at the S9a command level.\nAVP Format:\nQoS-Rule-Install ::= < AVP Header: 1051>\n*[ QoS-Rule-Definition ]\n*[ QoS-Rule-Name ]\n*[ QoS-Rule-Base-Name ]\n[ Tunnel-Information ]\n[ Access-Network-Charging-Identifier-Value ]\n[ Resource-Allocation-Notification ]\n[ Rule-Activation-Time ]\n[ Rule-Deactivation-Time ]\n[ 3GPP-GGSN-Address ]\n[ 3GPP-GGSN-Ipv6-Address ]\n0*2 [ AN-GW-Address ]\n[ UDP-Source-Port ]\n*[ AVP ]\n5a.3.2\tQoS-Rule-Remove AVP (All access types)\nThe QoS-Rule-Remove AVP (AVP code 1052) is of type Grouped, and it is used to deactivate or remove QoS rules from an Gateway Control session.\nQoS-Rule-Name AVP is a reference for a specific QoS rule at the BBERF to be removed or for a specific QoS rule predefined at the BBERF to be deactivated. The QoS-Rule-Base-Name AVP is a reference for a group of QoS rules predefined at the BBERF to be deactivated.\nRequired-Access-Info AVP may be included if the AF requests the PCRF to report user access network information and the PCRF is removing QoS rules based on the AF requests.\nAVP Format:\nQoS-Rule-Remove ::= < AVP Header: 1052>\n*[ QoS-Rule-Name ]\n*[ QoS-Rule-Base-Name ]\n*[ Required-Access-Info ]\n*[ AVP ]\n5a.3.3\tQoS-Rule-Definition AVP (All access types)\nThe QoS-Rule-Definition AVP (AVP code 1053) is of type Grouped, and it defines the QoS rule for a service data flow sent by the PCRF to the BBERF. The QoS-Rule-Name AVP uniquely identifies the QoS rule and it is used to reference to a QoS rule in communication between the BBERF and the PCRF within one Gateway Control session. The Flow-Information AVP(s) determines the traffic that belongs to the service data flow.\nIf optional AVP(s) within a QoS-Rule-Definition AVP are omitted, but corresponding information has been provided in previous Gxx messages, the previous information remains valid. If Flow-Information AVP(s) are supplied, they replace all previous Flow-Information AVP(s).\nRequired-Access-Info AVP may appear if the AF requests PCRF to report user access network information.\nSharing-Key-UL AVP and/or Sharing-Key-DL AVP may appear if the QoS rule is a candidate for resource sharing.\nThe Content-Version AVP may be included if the QoS rule is installed or modified.\nAVP Format:\nQoS-Rule-Definition ::= < AVP Header: 1053>\n{ QoS-Rule-Name }\n*[ Flow-Information ]\n[ QoS-Information ]\n[ Precedence ]\n*[ Required-Access-Info ]\n[ Sharing-Key-DL ]\n[ Sharing-Key-UL ]\n[ Content-Version ]\n*[ AVP ]\n5a.3.4\tQoS-Rule-Name AVP (All access types)\nThe QoS-Rule-Name AVP (AVP code 1054) is of type OctetString, and it defines a name for QoS rule. For QoS rules provided by the PCRF it uniquely identifies a QoS rule within one Gateway Control session. For QoS pre-defined at the BBERF it uniquely identifies a QoS rule within the BBERF.\n5a.3.5\tQoS-Rule-Report AVP (All access types)\nThe QoS-Rule-Report AVP (AVP code 1055) is of type Grouped, and it is used to report the status of QoS rules.\nQoS-Rule-Name AVP is a reference for a specific QoS rule at the BBERF that has been successfully installed, modified or removed (for dynamic QoS rules), or activated or deactivated (for predefined QoS rules). QoS-Rule-Base-Name AVP is a reference for a group of QoS rules predefined at the BBERF that has been successfully activated or deactivated.\nThe QoS-Rule-Report AVP can also be used to report the status of the QoS rules which cannot be installed/activated or enforced at the BBERF. In this condition, the QoS-Rule-Name AVP is used to indicate a specific QoS rule which cannot be installed/activated or enforced and the QoS-Rule-Base-Name AVP is used to indicate a group of QoS rules which cannot be activated. The Rule-Failure-Code AVP indicates the reason that the QoS rules cannot be successfully installed/activated or enforced.\nIf the RuleVersioning feature is supported, the Content-Version AVP(s) shall be included if it was included in the QoS-Rule-Definition AVP when the corresponding QoS rule was installed or modified.\nAVP Format:\nQoS-Rule-Report ::= < AVP Header: 1055>\n*[ QoS-Rule-Name ]\n*[ QoS-Rule-Base-Name ]\n[ PCC-Rule-Status ]\n[ Rule-Failure-Code ]\n*[ Content-Version ]\n*[ AVP ]\nMultiple instances of QoS-Rule-Report AVPs shall be used in the case it is required to report different PCC-Rule-Status or Rule-Failure-Code values for different rules within the same Diameter command. If the Content-Version AVP is included within a QoS-Rule-Report AVP, then only the one corresponding QoS-Rule-Name AVP shall be included.\n5a.3.6\tSession-Linking-Indicator AVP (All access types)\nThe Session-Linking-Indicator AVP (AVP code 1064) is of type Enumerated and indicates whether the session linking between the Gateway Control Session and the Gx session shall be deferred. The absence of this AVP in case 2b as defined in 3GPP TS 29.213 [8] shall indicate the value SESSION_LINKING_IMMEDIATE.\nThe following values are defined:\nSESSION_LINKING_IMMEDIATE (0)\nThis value shall be used to indicate that the PCRF shall perform the linking between the new Gateway Control Session with an existing Gx session immediately.\nSESSION_LINKING_DEFERRED (1)\nThis value shall be used to indicate that the PCRF shall not attempt linking the new Gateway Control Session with an existing Gx session immediately.\n5a.3.7\tQoS-Rule-Base-Name AVP (All access types)\nThe QoS-Rule-Base-Name AVP (AVP code 1074) is of type UTF8String, and it indicates the name of a pre‑defined group of QoS rules residing at the BBERF.\n5a.4\tGxx re-used AVPs\n5a.4.0\tGeneral\nTable 5a.4.0.1 lists the Diameter AVPs re-used by the Gxx reference point from Gx reference point and other existing Diameter Applications, reference to their respective specifications, short description of their usage within the Gxx reference point, the applicability of the AVPs to a specific access, and which supported features the AVP is applicable to. When reused from Gx reference point, the specific clause in the present specification is referred. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table 5a.4, but they are re-used for the Gxx reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings. Where RADIUS VSAs are re-used, unless otherwise stated, they shall be translated to Diameter AVPs as described in IETF RFC 4005 [12] with the exception that the 'M' flag shall be set and the 'P' flag may be set.\nTable 5a.4.0.1: Gxx re-used Diameter AVPs\nAttribute Name\nReference\nDescription\nAcc. Type\nApplicability (NOTE 5)\n3GPP-MS-TimeZone\n3GPP TS 29.061 [11]\nIndicate the offset between universal time and local time in steps of 15 minutes of where the MS currently resides.\nAll\n3GPP-SGSN-MCC-MNC\n3GPP TS 29.061 [11]\nCarries the MCC/MNC information of the AN-GW\nAll\n3GPP-User-Location-Info\n3GPP TS 29.061 [11]\nIndicates details of where the UE is currently located (e.g. SAI or CGI)\n3GPP-EPS\n3GPP2-BSID\n3GPP2 X.S0057 [24]\nFor 3GPP2 indicates the BSID of where the UE is currently located (e.g. Cell-Id, SID, NID).\nThe Vendor-Id shall be set to 3GPP2 (5535) [24].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the value 5535, identifying 3GPP2, in a Supported-Vendor-Id AVP.\n3GPP2, Non-3GPP-EPS\nAccess-Network-Charging-Identifier-Value\n3GPP TS 29.214 [10]\nContains a charging identifier.\nAll (See NOTE 6)\nAllocation- Retention-Priority\n5.3.32\nIndicates a priority for accepting or rejecting a bearer establishment or modification request and dropping a bearer in case of resource limitations.\nAll\nAN-GW-Address\n5.3.49\nCarries the control plane address of the AN-GW (S-GW/AGW/ ePDG)\nAll\nEPC-routed (See NOTE 8)\nAPN-Aggregate-Max-Bitrate-DL\n5.3.39\nIndicates the aggregate maximum bitrate in bps for the downlink direction for all non-GBR bearers of the APN.\nAll\nAPN-Aggregate-Max-Bitrate-UL\n5.3.40\nIndicates the aggregate maximum bitrate in bps for the uplink direction for all non-GBR bearers of the APN.\nAll\nBearer-Control-Mode\n5.3.23\nIndicates the PCRF selected bearer control mode.\nAll (See NOTE 3)\nCalled-Station-Id\nIETF RFC 4005 [12]\nThe address the user is connected to (i.e. the PDN identifier). For EPS the APN. When used to contain the APN, the APN is composed of the APN Network Identifier only, or the APN Network Identifier and the APN Operator Identifier as specified in TS 23.003 [25], clause 9.1. The inclusion of the APN Operator Identifier can be configurable.\nAll\nCC-Request-Number\nIETF RFC 8506 [66]\nThe number of the request for mapping requests and answers\nAll\nCC-Request-Type\nIETF RFC 8506 [66]\nThe type of the request (initial, update, termination)\nAll\nDefault-EPS-Bearer-QoS\n5.3.48\nDefines the QoS information of the default bearer\nAll\nContent-Version\n3GPP TS 29.214 [10]\nIt Indicates the content version of a QoS rule. It uniquely identifies a version of the QoS rule as defined in subclause 4a.5.18.\nAll\nRuleVersioning\nDRMP\nIETF RFC 7944 [53]\nAllows Diameter endpoints to indicate the relative priority of Diameter transactions.\nAll\nEvent-Trigger\n5.3.7\nReports the event that occurred on the BBERF.\nFor Event-Trigger LOSS_OF_BEARER, BBERF will include the impacted QoS rules within the QoS-Rule-Report.\nFor Event-Trigger RECOVERY_OF_BEARER BBERF will include the impacted QoS rules within the QoS-Rule-Report.\nFor 3GPP2 access USER_LOCATION_CHANGE is used to report and request changes to the 3GPP2-BSID.\nFor the Event-Trigger UE_TIME_ZONE_CHANGE, the BBERF includes the new value of the UE time zone within the 3GPP-MS-TimeZone AVP.\nThe following values are not applicable:\nSGSN_CHANGE (0), PLMN_CHANGE (4), IP-CAN_CHANGE (7), QOS_CHANGE_EXCEEDING_AUTHORIZATION (11), OUT_OF_CREDIT (15), REALLOCATION_OF_CREDIT (16), REVALIDATION_TIMEOUT (17), UE_IP_ADDRESS_ALLOCATE (18), UE_ IP_ADDRESS_RELEASE (19) , AN_GW_CHANGE (21) and USAGE_REPORT (33), ROUTING_RULE_CHANGE (37), APPLICATION_START (39), APPLICATION_STOP (40), CREDIT_MANAGEMENT_SESSION_FAILURE (46).\nAll\nExtended-APN-AMBR-DL\n5.3.134\nIndicates the aggregate maximum bitrate in kbps for the downlink direction for all non-GBR bearers of the APN.\nAll\nExtended-BW-NR\nExtended-APN-AMBR-UL\n5.3.135\nIndicates the aggregate maximum bitrate in kbps for the uplink direction for all non-GBR bearers of the APN.\nAll\nExtended-BW-NR\nExtended-GBR-DL\n5.3.136\nDefines the guaranteed bitrate in kbps for downlink.\nAll\nExtended-BW-NR\nExtended-GBR-UL\n5.3.137\nDefines the guaranteed bitrate in kbps for uplink.\nAll\nExtended-BW-NR\nExtended-Max-Requested-BW-DL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbps for downlink.\nAll\nExtended-BW-NR\nExtended-Max-Requested-BW-UL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbps for uplink.\nAll\nExtended-BW-NR\nFlow-Description\n3GPP TS 29.214 [10],\n5.4.2\nDefines the service data flow filter parameters for a QoS rule. The same rules as for Gx, Table 5.4.0.1, apply. The rules for usage on Gxx are defined in clause 5.4.2\nAll\nFlow-Information\n5.3.53\nDefines the service data flow filter parameters for a QoS rule and may include flow description, packet filter identifier, ToS/Traffic Class, SPI and Flow Label information.\nMay also include an instruction as to whether signalling the information to the UE is to occur.\nAll\nFlow-Label\n5.3.52\nDefines the Ipv6 flow label\nFramed-IP-Address\nIETF RFC 4005 [12]\nThe Ipv4 address allocated for the user.\nAll\nFramed-Ipv6-Prefix\nIETF RFC 4005 [12]\nThe Ipv6 prefix allocated for the user.\nThe encoding of the value within this Octet String type AVP shall be as defined in IETF RFC 3162 [15], clause 2.3. The \"Reserved\", \"Prefix-Length\" and \"Prefix\" fields shall be included in this order.\nAll\nGuaranteed-Bitrate-DL (NOTE 1)\n5.3.25\nDefines the guaranteed bitrate in bps for downlink.\nAll\nGuaranteed-Bitrate-UL (NOTE 1)\n5.3.26\nDefines the guaranteed bitrate in bps for uplink.\nAll\nHeNB-Local-IP-Address\n5.3.95\nContains the H(e)NB local IP address as defined in Annex E.2.1.\n3GPP-EPS\nEPC-routed\nIP-CAN-Type\n5.3.27\nIndicates the type of Connectivity Access Network that the user is connected to.\nAll\nLoad\nIETF RFC 8583 [60]\nThe AVP used to convey load information between Diameter nodes.\nThis AVP and all AVPs within this grouped AVP shall have the 'M' bit cleared.\nAll\nMax-Requested-Bandwidth-UL(Note 2)\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth for uplink.\nAll\nMax-Requested-Bandwidth-DL(Note 2)\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth for downlink.\nAll\nNetLoc-Access-Support\n5.3.111\nIndicates the access network information reporting level of support.\nAll\nNetLoc\nNetwork-Request-Support\n5.3.24\nIndicates whether the UE and access network supports the network requested bearer control mode or not.\nAll (See NOTE 3)\nOC-OLR\nIETF RFC 7683 [49]\nContains the necessary information to convey an overload report.\nAll\nOC-Supported-Features\nIETF RFC 7683 [49]\nDefines the support for the Diameter overload indication conveyence by the sending node.\nAll\nPacket-Filter-Content\n5.3.54\nIndicates the content of the packet filter. Destination IP address including the value provided by the UE may be provided when the ExtendedFilter feature is supported as described in clause 5a.4.1.\nAll\nPacket-Filter-Identifier\n5.3.55\nThe identity of the packet filter.\nAll\nPacket-Filter-Information\n5.3.56\nInformation related to the packet filters that the BBERF provides to the PCRF.\nAll\nPacket-Filter-Operation\n5.3.57\nIndicates the operation that the terminal is requesting over the packet filters provided by the Packet-Filter-Information AVPs.\nAll\nPacket-Filter-Usage\n5.3.66\nIndicates whether the UE shall be provisioned with the related traffic mapping information.\nAll\nRel9\nPCC-Rule-Status\n5.3.19\nDescribes the status of one or a group of QoS rules.\nAll\nPDN-Connection-ID\n5.3.58\nThe identification of PDN connection to the same APN.\nAll (See NOTE 4)\nRel9\nPrecedence\n5.3.11\nIndicates the precedence of QoS rules or packet filters.\nAll\nPS-to-CS-Session-Continuity\n5.3.84\nIndicates whether the service data flow is a candidate for PS to CS session continuity.\n3GPP- EPS\nvSRVCC\nQoS-Class-Identifier\n5.3.17\nIdentifies a set of IP-CAN specific QoS parameters\nAll\nQoS-Information\n5.3.16\nDefines the QoS information for a resource or QoS rule.\nAll\nRAI\n3GPP TS 29.061 [11]\nContains the Routing Area Identity of the SGSN where the UE is registered\n3GPP-EPS\nRAT-Type\n5.3.31\nIdentifies the radio access technology that is serving the UE.\nAll\nRequired-Access-Info\n3GPP TS 29.214 [10]\nIndicates the access network information for which the AF entity requestes the PCRF reporting.\n3GPP-EPS\nCC\nNetLoc\nResource-Allocation- Notification\n5.3.50\nIndicates whether successful resource allocation notification for rules is needed or not.\nAll\nRule-Activation-Time\n5.3.41\nIndicates the NTP time at which the QoS rules has to be enforced.\nAll\nRule-Deactivation-Time\n5.2.42\nIndicates the NTP time at which the BBERF has to stop enforcing the QoS rules.\nAll\nRule-Failure-Code\n5.3.38\nIdentifies the reason a QoS rule is being reported.\nAll\nSecurity-Parameter-Index\n5.3.51\nDefines the IPSec SPI\nAll\nSession-Release-Cause\n5.3.44\nIndicate the reason of termination initiated by the PCRF. Only the reason code UNSPECIFIED_REASON is applicable for the PCRF-initiated Gxx session termination.\nAll\nSharing-Key-DL\n3GPP TS 29.214 [10]\nIndicates, by containing the same value, what QoS rules may share resource in downlink direction.\nAll\nResShare\nSharing-Key-UL\n3GPP TS 29.214 [10]\nIndicates, by containing the same value, what QoS rules may share resource in uplink direction.\nAll\nResShare\nSubscription-Id\nIETF RFC 8506 [66]\nThe identification of the subscription (i.e. IMSI)\nAll\nSupported-Features\n3GPP TS 29.229 [14]\nIf present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange\nAll\nToS-Traffic-Class\n5.3.15\nDefines the Ipv4 ToS or Ipv6 Traffic Class\nAll\nTrace-Data\n3GPP TS 29.272 [26]\nContains trace control and configuration parameters, specified in 3GPP TS 32.422 [27].\n3GPP-EPS\nTrace-Reference\n3GPP TS 29.272 [26]\nContains the trace reference parameter, specified in 3GPP TS 32.422 [27].\n3GPP-EPS\nTunnel-Header-Filter\n5.3.34\nDefines the tunnel (outer) header filter information of a tunnelled IP flow.\nAll (see NOTE 3 and NOTE 6)\nTunnel-Header-Length\n5.3.35\nIndicates the length of the tunnel (outer) header.\nAll (see NOTE 3\nand NOTE 6)\nTunnel-Information\n5.3.36\nDefines the tunnel (outer) header information for an IP flow.\nAll (see NOTE 3\nand NOTE 6)\nUDP-Source-Port\n5.3.97\nContains the UDP source port number in the case that NA(P)T is detected for supporting interworking with Fixed Broadband access network as defined in Annex E.\n3GPP-EPS\nNon-3GPP-EPS\nEPC-routed\nUE-Local-IP-Address\n5.3.96\nContains the UE local IP address as defined in Annex E.2.1.\nNon-3GPP-EPS\nBBAI\nUser-CSG-Information\n(NOTE 7)\n3GPP TS 32.299 [19]\nIndicates the user \"Closed Subscriber Group\" Information associated to CSG or hybrid cell access: it comprises the CSG-Id, CSG-Access-Mode and CSG-Membership-Indication AVPs.\nThis AVP shall have the 'M' bit cleared.\n3GPP-EPS\nRel9\nUser-Equipment-Info\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, etc.)\nWhen the User-Equipment-Info-Type is set to IMEISV(0), the value within the User-Equipment-Info-Value shall be a UTF-8 encoded decimal.\nAll\nUser-Equipment-Info-Extension\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, IMEI, etc.)\nWhen the User-Equipment-Info-IMEISV or the User-Equipment-Info-IMEI is used, it shall be a UTF-8 encoded decimal.\nAll\nUser-Equipment-Info-Extension\nUser-Location-Info-Time\n5.3.101\nIndicates the time at which the user was in that location when the corresponding bearer is deactivated.\n3GPP-EPS\nCC\nNetLoc\nNOTE 1:\tWhen sending from the PCRF to the BBERF, the Guaranteed-Bitrate-UL/DL AVP indicate the allowed guaranteed bit rate for the uplink/downlink direction; when sending from the BBERF to the PCRF, the Guaranteed-Bitrate-UL/DL AVP indicate the requested guaranteed bit rate for the uplink/downlink direction.\nNOTE 2:\tWhen sending from the PCRF to the BBERF, the Max-Requested-Bandwidth-UL/DL AVP indicate the maximum allowed bit rate for the uplink/downlink direction; when sending from the BBERF to the PCRF, the Max-Requested-Bandwidth-UL/DL AVP indicate the maximum requested bit rate for the uplink/downlink direction.\nNOTE 3:\tThis AVP does not apply to 3GPP-EPS Access Types.\nNOTE 4:\tThis AVP only applies to case 2b as defined in 3GPP TS 29.213 [8].\nNOTE 5:\tAVPs marked with \"Rel9\" are applicable as described in clause 5a.4.1.\nNOTE 6:\tThis AVP only applies to case 2a as defined in 3GPP TS 29.213 [8].\nNOTE 7:\tAVPs included within this grouped AVP shall have the 'M' bit cleared.\nNOTE 8:\tAN-GW-Address AVP carries the address of the ePDG is only applicable for \"EPC-routed\".\n5a.4.1\tUse of the Supported-Features AVP on the Gxx reference point\nThe Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The client shall, in the first request of a Diameter session indicate the set of supported features. The server shall, in the first answer within the Diameter session indicate the set of features that it has in common with the client and that the server shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the Gxx reference point shall be compliant with the requirements for dynamic discovery of supported features on the Cx reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [14].\nThe base functionality for the Gxx reference point is the 3GPP Rel-8 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the Gxx commands. As defined in clause 7.1.1 of 3GPP TS 29.229 [14], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [14], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the Gxx reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the Gxx reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [14]. The following exceptions apply to the initial CCR/CCA command pair:\n-\tIf the BBERF supports post-Rel-8 Gxx functionality, the CCR shall include the features supported by the BBERF within Supported-Features AVP(s) with the 'M' bit cleared.\nNOTE: One instance of Supported-Features AVP is needed per Feature-List-ID.\n-\tIf the CCR command does not contain any Supported-Features AVP(s) and the PCRF supports Rel-8 Gxx functionality, the PCRF shall not include the Supported-Features AVP in the CCA command. In this case, both BBERF and PCRF shall behave as specified in the Rel-8 version of this document.\nNOTE: The client will always declare all features that are supported according to table 5a.4.1.1. When more than one feature identifying a release is supported by both BBERF and PCRF, the BBERF will work according to the latest common supported release.\nOnce the PCRF and BBERF have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe table below defines the features applicable to the Gxx interfaces for the feature list with a Feature-List-ID of 1.\nTable 5a.4.1.1: Features of Feature-List-ID 1 used in Gxx\nFeature bit\nFeature\nM/O\nDescription\n0\nRel9\nM\nThis feature indicates the support of base 3GPP Rel-9 Gxx functionality, including the AVPs and corresponding procedures supported by the base 3GPP Rel-8 Gxx standard, but excluding those features represented by separate feature bits. AVPs introduced with this feature are marked with \"Rel9\" in Table 5a.3.0.1 and Table 5a.4.0.1.\n1\nvSRVCC\nO\nThis feature indicates support for the vSRVCC feature (see 3GPP TS 23.216 [40]).\n2\nEPC-routed\nO\nThis feature indicates support for interworking with Fixed Broad band Access networks when the traffic is routed via the EPC network as defined in Annex E.\n3\nNetLoc\nO\nThis feature indicates the support of the Access Network Information Reporting. If the BBERF supports this feature, the PCRF shall behave as described in subclause 4a.5.16\n4\nExtendedFilter\nO\nThis feature indicates the support for the local UE address being present in 3GPP filters signalled between network and UE.\n5\nPendingTransaction\nO\nThis feature indicates support for the race condition handling as defined in 3GPP TS 29.213 [8].\n6\nvoid\n7\nResShare\nO\nThis feature indicates the support of service data flows that share resources. If the BBERF supports this feature, the PCRF shall behave as described in clause 4a.5.10.6.\n8\nRuleVersioning\nO\nThis feature indicates the support of QoS rule versioning as defined in subclause 4a.5.18.\n9\nExtended-BW-NR\nO\nThis feature indicates the support of extended bandwidth values for NR.\n10\nMPSforDTS\nO\nIndicates support for MPS for DTS as described in subclauses 4.5.19.1.1 and 4a.5.14.1.4\n11\nUser-Equipment-Info-Extension\nO\nThis feature indicates the support of the User-Equipment-Info-Extension AVP as defined in IETF RFC 8506 [66].\nNOTE:\nFeature bit:\tThe order number of the bit within the Feature-List AVP where the least significant bit is assigned number \"0\".\nFeature:\tA short name that can be used to refer to the bit and to the feature, e.g. \"EPS\".\nM/O:\tDefines if the implementation of the feature is mandatory (\"M\") or optional (\"O\") in this 3GPP Release.\nDescription:\tA clear textual description of the feature.\n5a.5\tGxx specific Experimental-Result-Code AVP values\nThe same codes specified in clause 5.5 apply here with the following exceptions:\nThe following permanent Experimental-Result-Code shall be used instead of DIAMETER_PCC_RULE_EVENT (5142):\nDIAMETER_QOS_RULE_EVENT (5145)\nThis error shall be used when the QoS rules cannot be installed/activated. Affected QoS-Rules will be provided in the QoS-Rule-Report AVP including the reason and status as described in clause 4a.5.5.\nThe following transient Experimental-Result-Code shall be used instead of DIAMETER_PCC_BEARER_EVENT (4141):\nDIAMETER_BEARER_EVENT (4142)\nThis error shall be used when for some reason a QoS rule cannot be enforced or modified successfully in a network initiated procedure. Affected QoS Rules will be provided in the QoS-Rule-Report AVP including the reason and status as described in clause 4a.5.5.\n5a.6\tGxx Messages\n5a.6.1\tGxx Application\nGxx Messages are carried within the Diameter Application(s) described in clause 5a.1.\nExisting Diameter command codes from the Diameter base protocol IETF RFC 6733 [61] and the Diameter Credit Control Application IETF RFC 8506 [66] are used with the Gxx specific AVPs specified in clause 5a.3. The Diameter Credit Control Application AVPs and AVPs from other Diameter applications that are re-used are defined in clause 5a.4. The Gxx application identifier shall be included in the Auth-Application-Id AVP. A diameter session needs to be established for each Gateway Control session.\nNOTE:\tSome of the AVPs included in the messages formats below are in bold to highlight that these AVPs are used by this specific protocol and do not belong to the original message definition in the DCC Application IETF RFC 8506 [66] or Diameter Base Protocol IETF RFC 6733 [61].\n5a.6.2\tCC-Request (CCR) Command\nThe CCR command, indicated by the Command-Code field set to 272 and the 'R' bit set in the Command Flags field, is sent by the BBERF to the PCRF in order to request QoS rules. The CCR command is also sent by the BBERF to the PCRF in order to indicate QoS rule related events or the termination of the Gateway Control session.\nMessage Format:\n<CC-Request> ::= < Diameter Header: 272, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ Destination-Host ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n*[ Subscription-Id ]\n[ Network-Request-Support ]\n*[ Packet-Filter-Information ]\n[ Packet-Filter-Operation ]\n[ Framed-IP-Address ]\n[ Framed-Ipv6-Prefix ]\n[ IP-CAN-Type ]\n[ RAT-Type ]\n[ Termination-Cause ]\n[ User-Equipment-Info ]\n[ User-Equipment-Info-Extension ]\n[ QoS-Information ]\n[ Default-EPS-Bearer-QoS ]\n0*2 [ AN-GW-Address ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ RAI ]\n[ 3GPP-User-Location-Info]\n[ User-Location-Info-Time ]\n[ 3GPP-MS-TimeZone ]\n[ 3GPP2-BSID ]\n[ User-CSG-Information ]\n[ HeNB-Local-IP-Address ]\n[ UE-Local-IP-Address ]\n[ UDP-Source-Port ]\n[ Called-Station-Id ]\n[ PDN-Connection-ID ]\n*[ QoS-Rule-Report]\n*[ Event-Trigger]\n[ Session-Linking-Indicator ]\n[ Trace-Data ]\n[ Trace-Reference ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5a.6.3\tCC-Answer (CCA) Command\nThe CCA command, indicated by the Command-Code field set to 272 and the 'R' bit cleared in the Command Flags field, is sent by the PCRF to the BBERF in response to the CCR command. It is used to provision QoS rules and event triggers for the bearer/session and to provide the selected bearer control mode for the Gateway Control session.\nMessage Format:\n<CC-Answer> ::=  < Diameter Header: 272, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Supported-Features ]\n[ Bearer-Control-Mode ]\n*[ Event-Trigger ]\n[ Framed-Ipv6-Prefix ]\n[ Origin-State-Id ]\n*[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n*[ QoS-Rule-Remove ]\n*[ QoS-Rule-Install ]\n[ QoS-Information ]\n[ Default-EPS-Bearer-QoS ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Load ]\n*[ AVP ]\n5a.6.4\tRe-Auth-Request (RAR) Command\nThe RAR command, indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the BBERF in order to provision QoS rules using the PUSH procedure initiate the provision of unsolicited QoS rules. It is used to provision QoS rules, event triggers and event report indications for the session.\nMessage Format:\n<RA-Request> ::= < Diameter Header: 258, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Re-Auth-Request-Type }\n[ Session-Release-Cause ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n*[ Event-Trigger ]\n*[ QoS-Rule-Remove ]\n*[ QoS-Rule-Install ]\n[ QoS-Information ]\n[ Default-EPS-Bearer-QoS ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5a.6.5\tRe-Auth-Answer (RAA) Command\nThe RAA command, indicated by the Command-Code field set to 258 and the 'R' bit cleared in the Command Flags field, is sent by the BBERF to the PCRF in response to the RAR command.\nMessage Format:\n<RA-Answer> ::=  < Diameter Header: 258, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ RAT-Type ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ RAI ]\n[ 3GPP-User-Location-Info ]\n[ User-Location-Info-Time ]\n[ NetLoc-Access-Support ]\n[ User-CSG-Information ]\n[ 3GPP-MS-TimeZone ]\n[ 3GPP2-BSID ]\n*[ QoS-Rule-Report]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ AVP ]\n5b\tSd protocol\n5b.1\tProtocol support\nThe Sd application is defined as a vendor specific Diameter application, where the vendor is 3GPP. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415. The Application-ID for the Sd Application is 16777303 and this value shall be used in the Diameter command header as well as any Application-ID AVPs (Auth-Application-Id/Vendor-Specific-Application-Id) in the command body.\n5b.2\tInitialization, maintenance and termination of connection and session\nThe initialization and maintenance of the connection between each PCRF and TDF pair is defined by the underlying protocol. Establishment and maintenance of connections between Diameter nodes is described in IETF RFC 6733 [61].\nAfter establishing the transport connection, the PCRF and the TDF shall advertise the support of the Sd specific Application by including the value of the application identifier in the Auth-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands are specified in the Diameter Base Protocol (IETF RFC 6733 [61]).\nThe Diameter session on Sd is established either at the request of the PCRF in case of solicited application reporting or at the request of the TDF in case of unsolicited application reporting. Session modifications may be initiated by either TDF or PCRF. Session termination is initiated at the request of the PCRF as specified in clause 4b.5.4.\n5b.3\tSd specific AVPs\n5b.3.0\tGeneral\nTable 5b.3.0.1 describes the Diameter AVPs defined for the Sd reference point, their AVP Code values, types, possible flag values, whether or not the AVP may be encrypted, what access types (e.g. 3GPP-GPRS, etc.) the AVP is applicable to, the applicability of the AVPs to charging control, policy control or both, and which supported features the AVP is applicable to. The Vendor-Id header of all AVPs defined in the present document shall be set to 3GPP (10415).\nTable 5b.3.0.1: Sd specific Diameter AVPs\nAVP Flag rules (NOTE 1)\nAttribute Name\nAVP Code\nClause defined\nValue Type (NOTE 2)\nMust\nMay\nShould not\nMust not\nMay Encr.\nAcc. Type\nApplicability\nADC-Rule-Base-Name\n1095\n5b.3.4\nUTF8String\nM,V\nP\nY\nAll\nADC-Rule-Definition\n1094\n5b.3.3\nGrouped\nM,V\nP\nY\nAll\nADC-Rule-Install\n1092\n5b.3.1\nGrouped\nM,V\nP\nY\nAll\nADC-Rule-Name\n1096\n5b.3.5\nOctetString\nM,V\nP\nY\nAll\nADC-Rule-Remove\n1093\n5b.3.2\nGrouped\nM,V\nP\nY\nAll\nADC-Rule-Report\n1097\n5b.3.6\nGrouped\nM,V\nP\nY\nAll\nNOTE 1:\tThe AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [61].\nNOTE 2:\tThe value types are defined in IETF RFC 6733 [61].\n5b.3.1\tADC-Rule-Install AVP\nThe ADC-Rule-Install AVP (AVP code 1092) is of type Grouped, and it is used to activate, install or modify ADC rules as instructed from the PCRF.\nFor installing a new ADC rule or modifying an ADC rule already installed, ADC-Rule-Definition AVP shall be used.\nFor activating a specific predefined ADC rule, ADC-Rule-Name AVP shall be used as a reference for that ADC rule. The ADC-Rule-Base-Name AVP is a reference that may be used for activating a group of predefined ADC rules.\nIf Rule-Activation-Time or Rule-Deactivation-Time is specified then it applies to all the ADC rules within the ADC-Rule-Install.\nIf the Monitoring-Flags AVP is included within the ADC-Rule-Install AVP, it is used to indicate the monitoring action related to the corresponding application. It applies to all the ADC rules within the ADC-Rule-Install AVP. If the Monitoring-Flags AVP is provided, the value will be valid for the ADC rules until the new value is provided for the ADC rules.\nAVP Format:\nADC-Rule-Install ::= \t< AVP Header: 1092 >\n*[ ADC-Rule-Definition ]\n*[ ADC-Rule-Name ]\n*[ ADC-Rule-Base-Name ]\n[ Monitoring-Flags ]\n[ Rule-Activation-Time ]\n[ Rule-Deactivation-Time ]\n*[ AVP ]\n5b.3.2\tADC-Rule-Remove AVP\nThe ADC-Rule-Remove AVP (AVP code 1093) is of type Grouped, and it is used to deactivate or remove ADC rules as instructed from the PCRF.\nADC-Rule-Name AVP is a reference for a specific dynamic ADC rule to be removed or for a specific predefined ADC rule to be deactivated. The ADC-Rule-Base-Name AVP is a reference for a group of predefined ADC rules to be deactivated.\nAVP Format:\nADC-Rule-Remove ::= < AVP Header: 1093 >\n*[ ADC-Rule-Name ]\n*[ ADC-Rule-Base-Name ]\n*[ AVP ]\n5b.3.3\tADC-Rule-Definition AVP\nThe ADC-Rule-Definition AVP (AVP code 1094) is of type Grouped, and it defines the ADC rule sent by the PCRF. The ADC-Rule-Name AVP uniquely identifies the ADC rule and it is used to reference to an ADC rule in communication between the PCRF and the TDF within one TDF session. The TDF Application Identifier AVP(s) or the Flow-Information AVP(s) determines the traffic that belongs to the application.\nIf optional AVP(s) within an ADC-Rule-Definition AVP are omitted, but corresponding information has been provided in previous Sd messages, the previous information remains valid.\nMonitoring-Key AVP contains the monitoring key that may apply to the ADC rule.\nSponsor-Identity AVP and Application-Service-Provider-Identity AVP shall be included if the Reporting-Level AVP is set to the value SPONSORED_CONNECTIVITY_LEVEL for the service data flow.\nMute-Notification status shall not be changed during the lifetime of the ADC rules.\nTraffic-Steering-Policy-Identifier-UL AVP and/or Traffic-Steering-Policy-Identifier-DL AVP may appear if the traffic steering control is required for the service data flow or application. If the traffic steering policies are identical in both downlink and uplink directions, the values of the Traffic-Steering-Policy-Identifier-UL AVP and the Traffic-Steering-Policy-Identifier-DL AVP shall be identical.\nAVP Format:\nADC-Rule-Definition ::= < AVP Header: 1094 >\n{ ADC-Rule-Name }\n[ TDF-Application-Identifier ]\n*[ Flow-Information ]\n[ Service-Identifier ]\n[ Rating-Group ]\n[ Reporting-Level ]\n[ Online ]\n[ Offline ]\n[ Metering-Method ]\n[ Precedence ]\n[ Flow-Status ]\n[ QoS-Information ]\n[ Monitoring-Key ]\n[ Sponsor-Identity ]\n[ Application-Service-Provider-Identity ]\n0*2[ Redirect-Information ]\n[ Mute-Notification ]\n[ Traffic-Steering-Policy-Identifier-DL ]\n[ Traffic-Steering-Policy-Identifier-UL ]\n[ ToS-Traffic-Class ]\n*[ AVP ]\n5b.3.4\tADC-Rule-Base-Name AVP\nThe ADC-Rule-Base-Name AVP (AVP code 1095) is of type UTF8String, and it indicates the name of a predefined group of ADC rules.\n5b.3.5\tADC-Rule-Name AVP\nThe ADC-Rule-Name AVP (AVP code 1096) is of type OctetString, and it defines a name for ADC rule. For ADC rules provided by the PCRF it uniquely identifies an ADC rule within one TDF session. For predefined ADC rules, it uniquely identifies an ADC rule within the TDF.\n5b.3.6\tADC-Rule-Report AVP\nThe ADC-Rule-Report AVP (AVP code 1097) is of type Grouped, and it is used to report the status of ADC rules.\nThe ADC-Rule-Report AVP is used to report the status of the ADC rules which cannot be installed/activated or enforced at the TDF. In this condition, the ADC-Rule-Name AVP is used to indicate a specific ADC rule which cannot be installed/activated or enforced, and the ADC-Rule-Base-Name AVP is used to indicate a group of ADC rules which cannot be activated. The PCC-Rule-Status AVP is set to INACTIVE. The Rule-Failure-Code indicates the reason that the ADC rules cannot be successfully installed/activated or enforced.\nThe ADC-Rule-Report AVP can also be used to report the status of the ADC rules for which credit is no longer available or credit has been reallocated after the former out of credit indication. When reporting an out of credit condition, the Final-Unit-Indication AVP indicates the termination action the TDF applies to the ADC rules as instructed by the OCS.\nAVP Format:\nADC-Rule-Report ::=\t < AVP Header: 1097 >\n*[ ADC-Rule-Name ]\n*[ ADC-Rule-Base-Name ]\n[ PCC-Rule-Status ]\n[ Rule-Failure-Code ]\n[ Final-Unit-Indication ]\n*[ AVP ]\nMultiple instances of ADC-Rule-Report AVPs shall be used in the case it is required to report different PCC-Rule-Status or Rule-Failure-Code values for different groups of rules within the same Diameter command.\n5b.3.7\tVoid\n5b.4\tSd re-used AVPs\n5b.4.0\tGeneral\nTable 5b.4.0.1 lists the Diameter AVPs re-used by the Sd reference point from existing Diameter Applications, reference to their respective specifications, short description of their usage within the Sd reference point and which supported features the AVP is applicable to. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table 5b.4.0.1, but they are re-used for the Sd reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings. Where 3GPP Radius VSAs are re-used, unless otherwise stated, they shall be translated to Diameter AVPs as described in IETF RFC 4005 [12] with the exception that the 'M' flag shall be set and the 'P' flag may be set.\nTable 5b.4.0.1: Sd re-used Diameter AVPs\nAttribute Name\nReference\nDescription\nAN-GW-Address\n5.3.49\nContains the control plane Ipv4 and/ or Ipv6 (if available) address(es) of the access node gateway (SGW for 3GPP and AGW for non-3GPP networks).\nAN-Trusted\n3GPP TS 29.273 [48]\nIndicates whether the access network is trusted or untrusted for the Non-3GPP access network. This AVP shall have the 'M' bit cleared.\nApplication-Detection-Information\n5.3.91\nUsed to report from the TDF to the PCRF once the start/stop of the application traffic, defined by TDF-Application-Identifier, has been detected.\nTDF is used instead of PCEF and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nApplication-Service-Provider-Identity\n3GPP TS 29.214 [10]\nFor sponsored connectivity, the identity of the application service provider that is delivering a service to a end user.\nSponsoredConnectivity-Sd\nBSSID\n3GPP TS 32.299 [19]\nContains the BSSID of the access point where UE is located.\nFBAC\nCalled-Station-Id\nIETF RFC 4005 [12]\nThe address the user is connected to (i.e. the PDN identifier). For GPRS and EPS the APN. When used to contain the APN, the APN is composed of the APN Network Identifier only, or the APN Network Identifier and the APN Operator Identifier as specified in TS 23.003 [25], subclause 9.1. The inclusion of the APN Operator Identifier can be configurable.\nCC-Request-Number\nIETF RFC 8506 [66]\nThe number of the request for mapping requests and answers.\nCC-Request-Type\nIETF RFC 8506 [66]\nThe type of the CC-Request. For the Solicited application reporting, only update and termination values are applicable.\nCharging-Information\n3GPP TS 29.229 [14]\nIt contains the addresses of the charging functions in the following AVPs:\n-\tPrimary-Event-Charging-Function-Name is of type DiameterURI and defines the address of the primary online charging system. The protocol definition in the DiameterURI shall be either omitted or supplied with value \"Diameter\".\n-\tSecondary-Event-Charging-Function-Name is of type DiameterURI and defines the address of the secondary online charging system. The protocol definition in the DiameterURI shall be either omitted or supplied with value \"Diameter\".\n-\tPrimary-Charging-Collection-Function-Name is of type DiameterURI and defines the address of the primary offline charging system. If the GTP' protocol is applied on the Gzn interface as specified in TS 32.295 [16], the protocol definition in the DiameterURI shall be omitted. If Diameter is applied on the Gzn interface, the protocol definition in DiameterURI shall be either omitted or supplied with value \"Diameter\". The choice of the applied protocol on the Gzn interface depends upon configuration in the TDF.\n-\tSecondary-Charging-Collection-Function-Name is of type DiameterURI and defines the address of the secondary offline charging system. If the GTP' protocol is applied on the Gzn interface as specified in TS 32.295 [16], the protocol definition in the DiameterURI shall be omitted. If Diameter is applied on the Gzn interface, the protocol definition in DiameterURI shall be either omitted or supplied with value \"Diameter\". The choice of the applied protocol on the Gzn interface depends upon configuration in the TDF.\nABC\nCredit-Management-Status\n5.3.102\nIndicate the failure status in credit management.\nABC\nCSG-Information-Reporting\n5.3.64\nSent from the PCRF to the TDF to request the TDF to report the user CSG information change to the charging domain in case of offline charging.\nTDF is used instead of PCEF.\nABC\nDRMP\nIETF RFC 7944 [53]\nAllows Diameter endpoints to indicate the relative priority of Diameter transactions.\nDynamic-Address-Flag\n3GPP TS 32.299 [19]\nIndicates whether the PDP context/PDN address is statically or dynamically allocated.\nThis AVP shall have the 'M' bit cleared.\nABC\nDynamic-Address-Flag-Extension\n3GPP TS 32.299 [19]\nIndicates that the Ipv4 PDN address has been dynamically allocated for that particular IP-CAN bearer (PDN connection) of PDN type Ipv4v6, while the dynamic Ipv6 address is indicated in Dynamic Address Flag.\nThis AVP shall have the 'M' bit cleared.\nABC\nEvent-Report-Indication (NOTE 3)(NOTE 4)\n5.3.30\nWhen sent from the PCRF to the TDF, it is used to report an event coming from the PCEF, BBERF or BPCF if NSWO is supported and the relevant info to the TDF. When sent from the TDF to the PCRF, it is used to provide the information about the required event triggers to the PCRF. Only Event-Trigger AVP will be supplied in this case.\nFor 3GPP2 access, USER_LOCATION_CHANGE is used to report and request changes to the 3GPP2-BSID.\nThe following values for the included Event-Trigger are applicable:\nSGSN_CHANGE (0),\nRAT_CHANGE (2),\nPLMN_CHANGE (4),\nIP-CAN_CHANGE (7),\nRAI_CHANGE (12),\nUSER_LOCATION_CHANGE (13),NO_EVENT_TRIGGERS (14),\nUE_IP_ADDRESS_ALLOCATE (18),UE_IP_ADDRESS_RELEASE (19),\nAN_GW_CHANGE (21),\nUE_TIME_ZONE_CHANGE (25),\nTAI_CHANGE (26), ECGI_CHANGE (27),\nUSER_CSG_INFORMATION_CHANGE (30),\nUSER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE (35),\nUSER_CSG_HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE (36),\nCHANGE_OF_UE_PRESENCE_IN_PRESENCE AREA_REPORT (48),\nENODEB_CHANGE (54)\nThe following AVPs which are included in Event-Report-Indication are applicable to Sd interface:\nIP-CAN-Type, RAT-Type, AN-Trusted, AN-GW-Address, 3GPP-SGSN-Address, 3GPP-SGSN-Ipv6-Address, 3GPP-SGSN-MCC-MNC, RAI, 3GPP-User-Location-Info, 3GPP2-BSID, 3GPP-MS-Timezone, User-CSG-Information and Framed-IP-Address and Presence-Reporting-Area-Information.\nEvent-Trigger\n5.3.7\nWhen sent from the PCRF to the TDF, indicates an event that shall cause a re-request of ADC rules. When sent from the TDF to the PCRF, indicates that the corresponding event has occurred at the TDF.\nThe following values are applicable:\nNO_EVENT_TRIGGERS (14); OUT_OF_CREDIT (15), REALLOCATION_OF_CREDIT (16), REVALIDATION_TIMEOUT (17), USAGE_REPORT (33); APPLICATION_START (39); APPLICATION_STOP (40) ; CREDIT_MANAGEMENT_SESSION_FAILURE (46).\nCREDIT_MANAGEMENT_SESSION_FAILURE(46) does not require to be provisioned by the PCRF and it will always be reported by the TDF.\nTDF is used instead of PCEF, ADC rule is used instead of PCC rule, ADC-Rule-Report AVP is used instead of Charging-Rule-Report AVP and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nEvent-Trigger AVP is also applicable in TSR command.\n(NOTE 3)\nExtended-Max-Requested-BW-UL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbps for uplink.\nExtended-BW-NR\nExtended-Max-Requested-BW-DL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in kbps for downlink.\nExtended-BW-NR\nFinal-Unit-Indication\nIETF RFC 8506 [66]\nThe Final-Unit-Action applied by the TDF, and the related redirect address parameters (if available and applicable), when the user's account cannot cover the service cost.\nABC\nFixed-User-Location-Info\n5.3.112\nIt contains the UE location in a Fixed Access Network.\nFBAC\nFlow-Description\n3GPP TS 29.214 [10], 5.4.2\nDefines the service data flow filter parameters for a detected application, if deducible. The rules for usage on Sd are defined in subclause 5.4.2\nFlow-Direction\n5.3.65\nIt indicates the direction/directions that a filter for a detected application is applicable, downlink only, uplink only or both down- and uplink (bidirectional).\nFlow-Information\n5.3.53\nThis parameter may be sent from the TDF to the PCRF within Application-Detection-Information AVP and contains the information from a single IP flow packet filter of an application, once detected, if deducible at TDF.\nIn this case, only Flow-Description AVP and Flow-Direction AVPs are used.\nSee NOTE 1.\nThis parameter may also be sent from the PCRF to the TDFwithin the ADC-Rule-Definition AVP to identify the service data flow to be applied to the traffic steering control policy\nFlow-Status\n3GPP TS 29.214 [10]\nThis parameter may be sent from the PCRF to the TDF within ADC-Rule-Definition AVP and describe if the possible uplink and/or possible downlink gate for the detected application shall be opened or closed.\nFramed-IP-Address\nIETF RFC 4005 [12]\nThe Ipv4 address allocated for the user. If NSWO is supported, the AVP contains the Local Ipv4 address assigned by Fixed Broadband Access network.\nFramed-Ipv6-Prefix\nIETF RFC 4005 [12]\nThe Ipv6 prefix allocated for the user. If NSWO is supported, the AVP contains the Local Ipv6 prefix or address assigned by Fixed Broadband Access network.\nThe encoding of the value within this Octet String type AVP shall be as defined in IETF RFC 3162 [15], subclause 2.3. The \"Reserved\", \"Prefix-Length\" and \"Prefix\" fields shall be included in this order.\nFor the unsolicited case, the TDF may include the valid full Ipv6 address that is applicable to an IP flow or IP flows.\nThe TDF shall set the \"Prefix Length\" to 128 and encode the Ipv6 address of the UE within the \"Prefix\" field.\nGranted-Service-Unit\n(NOTE 2)\nIETF RFC 8506 [66]\nThe volume and/or time threshold for usage monitoring control purposes. Only the CC-Total-Octets, one of the CC-Input-Octets and CC-Output-Octets or CC-Time AVPs are re-used. Monitoring-Time AVP as defined in 5.3.99 may be optionally added to the grouped AVP if UMCH feature is supported.\nThis AVP shall have the 'M' bit cleared.\nIP-CAN-Type\n5.3.27\nIndicate the type of Connectivity Access Network in which the user is connected.\nLoad\nIETF RFC 8583 [60]\nThe AVP used to convey load information between Diameter nodes.\nThis AVP and all AVPs within this grouped AVP shall have the 'M' bit cleared.\nLogical-Access-ID\nETSI TS 283 034 [37]\nContains a Circuit‑ID (as defined in RFC 3046 [36]). The Logical Access ID may explicitly contain the identity of the Virtual Path and Virtual Channel carrying the traffic.\nThe vendor-id shall be set to ETSI (13019) [37].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\nMax-Requested-Bandwidth-UL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in bps for uplink.\nMax-Requested-Bandwidth-DL\n3GPP TS 29.214 [10]\nDefines the maximum authorized bandwidth in bps for downlink.\nMetering-Method\n5.3.8\nDefines what parameters shall be metered by the TDF for offline charging and also for online charging in case of decentralized unit determination, refer to TS 32.299 [19]. TDF is used instead of PCEF, application traffic is used instead of service data flow traffic, ADC Rule instead of PCC Rule (both predefined and dynamic ADC Rule are applicable).\nABC\nMonitoring- Flags\n5.3.115\nIndicates the monitoring action related to the application for the volume and/or time measurement on TDF session level\nThis AVP shall have the 'M' bit cleared.\nExUsage\nMonitoring-Key\n5.3.59\nAn identifier to a usage monitoring control instance.\nMonitoring-Time\n5.3.99\nDefines the time at which the TDF re-applies the volume or time threshold, provided by the PCRF. Applicable if UMCH is supported as described in the subclause 5b.4.1.\nMute-Notification\n5.3.98\nAn indication whether application start/stop notification is to be muted for ADC Rule by the TDF, Mute-Notification status shall not be changed during the lifetime of the ADC rules.\nTDF is used instead of PCEF and ADC rule is used instead of PCC rule.\nOC-OLR\nIETF RFC 7683 [49]\nContains the necessary information to convey an overload report.\nOC-Supported-Features\nIETF RFC 7683 [49]\nDefines the support for the Diameter overload indication conveyence by the sending node.\nOffline\n5.3.9\nDefines whether the offline charging interface from the TDF shall be enabled. TDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP. Can only be embedded within the initial TSR on command level or under ADC-Rule-Definition AVP for the initial provisioning of the specific ADC Rule.\nABC\nOnline\n5.3.10\nDefines whether the online charging interface from the TDF shall be enabled. TDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP. Can only be embedded within the initial TSR on command level or under ADC-Rule-Definition AVP for the initial provisioning of the specific ADC Rule.\nABC\nPCC-Rule-Status\n5.3.19\nDescribes the status of one or a group of ADC rules.\nPDN-Connection-Charging-ID\n3GPP TS 32.299 [19]\nContains the charging identifier to identify different records belonging to same PDN connection. When NBIFOM is supported, this field includes the Charging Id assigned by the PGW for the PDN connection.\nOtherwise,this field includes Charging Id of first IP-CAN bearer activated within the PDN connection (the EPS default bearer in case of GTP based connectivity or the unique Charging Id in the PMIP based connectivity case).\nThis AVP shall have the 'M' bit cleared.\nABC\nPhysical-Access-ID\nETSI TS 283 034 [37]\nIdentifies the physical access to which the user equipment is connected. Includes a port identifier and the identity of the access node where the port resides.\nThe vendor-id shall be set to ETSI (13019) [37].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\nPrecedence\n5.3.11\nDefines, if multiple ADC rules overlap, which ADC Rule shall be applied for the purpose of enforcement, reporting of application start and stop, usage monitoring, and charging.\nABC\nPresence-Reporting-Area-Identifier\n5.3.108\nIndicates the presence reporting area to which specific information refers.\nCNO-ULI\nPresence-Reporting-Area-Information\n5.3.109\nContains the information from a presence reporting area.\nCNO-ULI\nPresence-Reporting-Area-Status\n5.3.110\nIndicates whether the UE moves in or out of the presence reporting area.\nCNO-ULI\nQoS-Information\n5.3.16\nDefines the QoS information (bandwidth limitation) for the applications, detected by the TDF and sent from the PCRF to the TDF.\nOnly the Max-Requested-Bandwidth-UL and the Max-Requested-Bandwidth-DL are used.\nQuota-Consumption-Time\n3GPP TS 32.299 [19]\nDefines the time interval in seconds after which the time measurement shall stop for the Monitoring Key, if no packets are received belonging to the corresponding Monitoring Key during that time period.\nThis AVP shall have the 'M' bit cleared.\nRAI\n3GP TS 29.061 [11]\nContains the Routing Area Identity of the SGSN where the UE is registered.\nRAT-Type\n5.3.31\nIdentifies the radio access technology that is serving the UE.\nRating-Group\nIETF RFC 8506 [66]\nThe charging key for the ADC rule used for rating purposes.\nABC\nRedirect- Address-Type\nIETF RFC 8506 [66]\nDefines the address type of the address given in the Redirect-Server-Address AVP included in the ADC-Rule-Definition AVP.\nRedirect-Information\n5.3.82\nContains the address information of the redirect server (e.g., captive portal) with which the end user is to be connected.\nADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nADC-Add-Redirection (NOTE 6)\nRedirect-Server-Address\nIETF RFC 8506 [66]\nDefines the address of the redirect server with which the end user is to be connected.\nRedirect-Support\n5.3.83\nIndicates whether redirection is disabled or enabled for an ADC rule.\nReporting-Level\n(NOTE 5)\n5.3.12\nDefines on what level the TDF reports the usage for the related ADC rule. TDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nABC\nRevalidation-Time\n5.3.41\nIndicates the NTP time before which the TDF will have to re-request ADC rules.\nRule-Failure-Code\n5.3.38\nIdentifies the reason an ADC rule is being reported.\nTDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nRule-Activation-Time\n5.3.42\nIndicates the time when rule is to be activated.\nRule-Deactivation-Time\n5.3.43\nIndicates the time when rule is to be deactivated.\nService-Identifier\nIETF RFC 8506 [66]\nThe identity of the service, the application for which the ADC rule applies, relates to.\nABC\nSession-Release-Cause\n5.3.44\nIndicate the reason of termination initiated by the PCRF.\nSponsor-Identity\n3GPP TS 29.214 [10]\nFor sponsored data connectivity, it Identifies the sponsor willing to pay for the operator's charge for connectivity.\nSponsoredConnectivity-Sd\nSSID\n3GPP TS 29.273 [48]\nContains the SSID of the access point where UE is located\nFBAC\nSubscription-Id\nIETF RFC 4006 [9]\nThe identification of the subscription (IMSI, MSISDN, etc).\nSupported-Features\n3GPP TS 29.229 [14]\nIf present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange.\nTraffic-Steering-Policy-Identifier-DL\n5.3.123\nContains a reference to a pre-configured traffic steering policy at the TDF in the downlink direction.\nTSC\nTraffic-Steering-Policy-Identifier-UL\n5.3.124\nContains a reference to a pre-configured traffic steering policy at the TDF in the uplink direction.\nTSC\nTDF-Application-Identifier\n5.3.77\nReferences the application, for which the Application Detection and Control (ADC) rule applies.\nTDF is used instead of PCEF and ADC rule is used instead of PCC rule.\nTDF-Application-Instance-Identifier\n5.3.92\nShall be assigned and reported by the TDF to the PCRF in order to allow correlation of application Start and Stop Event-Triggers to the specific service data flow descriptions, if service data flow descriptions are deducible.\nToS-Traffic-Class\n5.3.15\nSpecify the DSCP value for marking of downlink packets of detected application traffic as defined within the corresponding Application Detection and Control (ADC) rule. The first octet contains the DSCP code and the second octet contains the mask field set to 11111100.\nDLDSCPMarking\nTWAN-Identifier\n3GPP TS 29.061 [11]\nIndicates the UE location in a Trusted WLAN Access Network\nTrusted-WLAN\nUsage-Monitoring-Information\n5.3.60\nContains the usage monitoring control information.\nUsage-Monitoring-Level\n5.3.61\nIndicates whether the usage monitoring instance applies to the TDF session or to one or more ADC rules. Only SESSION_LEVEL (0) referring to TDF session instead of IP-CAN session and ADC-Rule-Level (2) apply.\nUsage-Monitoring-Report\n5.3.63\nIndicates that accumulated usage is to be reported by the TDF regardless of whether a usage threshold is reached for certain usage monitoring key (within a Usage-Monitoring-Information AVP).\nUsage-Monitoring-Support\n5.3.62\nIndicates whether usage monitoring shall be disabled for certain Monitoring Key.\nUser-CSG-Information\n3GPP TS 32.299 [19]\nIndicates the user \"Closed Subscriber Group\" Information associated to CSG cell access: it comprises the CSG-Id, CSG-Access-Mode and CSG-Membership-Indication AVPs.\nABC\nUsed-Service-Unit\n(NOTE 2)\nIETF RFC 8506 [66]\nThe measured volume and/or time for usage monitoring control purposes. The volume threshold for usage monitoring control purposes. Only the CC-Total-Octets, one of the CC-Input-Octets and CC-Output-Octets AVPs, or CC-Time are re-used. Monitoring-Time AVP as defined in 5.3.99 may be optionally added to the grouped AVP if UMCH feature is supported.\nThis AVP shall have the 'M' bit cleared.\nUser-Equipment-Info\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, etc.)\nWhen the User-Equipment-Info-Type is set to IMEISV(0), the value within the User-Equipment-Info-Value shall be a UTF-8 encoded decimal.\nUser-Equipment-Info-Extension\nIETF RFC 8506 [66]\nThe identification and capabilities of the terminal (IMEISV, IMEI, etc.)\nWhen the User-Equipment-Info-IMEISV or the User-Equipment-Info-IMEI is used, it shall be a UTF-8 encoded decimal.\nUser-Equipment-Info-Extension\n3GPP-Charging-Characteristics\n3GPP TS 29.061 [11]\nThe Charging Characteristics applied to the IP-CAN session. Indicate how to control TDF behaviour regarding online and offline charging.\nThis AVP shall have the 'M' bit cleared.\nABC\n3GPP-GGSN-Address\n3GPP TS 29.061 [11]\nThe Ipv4 address of the P-GW.\nThis AVP shall have the 'M' bit cleared.\nABC\n3GPP-GGSN-Ipv6-Address\n3GPP TS 29.061 [11]\nThe Ipv6 address of the P-GW.\nThis AVP shall have the 'M' bit cleared.\nABC\n3GPP-MS-TimeZone\n3GPP TS 29.061 [11]\nIndicate the offset between universal time and local time in steps of 15 minutes of where the MS currently resides.\n3GPP-Selection-Mode\n3GPP TS 29.061 [11]\nAn index indicating how the APN was selected.\nThis AVP shall have the 'M' bit cleared.\nABC\n3GPP-SGSN-Address\n3GPP TS 29.061 [11]\nThe Ipv4 address of the SGSN.\n3GPP-SGSN-Ipv6-Address\n3GPP TS 29.061 [11]\nThe Ipv6 address of the SGSN.\n3GPP-SGSN-MCC-MNC\n3GPP TS 29.061 [11]\nFor GPRS the MCC and the MNC of the SGSN.\nFor 3GPP/non-3GPP accesses the MCC and the MNC provided by the serving gateway (SGW, or AGW).\nFor TWAN, the MCC and the MNC of the selected PLMN as described in §16.2.1 of TS 23.402 [23].\n3GPP-User-Location-Info\n3GPP TS 29.061 [11]\nIndicates details of where the UE is currently located (e.g. SAI CGI or eNodeB ID)\n3GPP2-BSID\n3GPP2 X.S0057 [24]\nFor 3GPP2 indicates the BSID of where the UE is currently located (e.g. Cell-Id, SID, NID).\nThe Vendor-Id shall be set to 3GPP2 (5535) [24].\nThe support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the value 5535, identifying 3GPP2, in a Supported-Vendor-Id AVP.\nThis AVP shall have the 'M' bit cleared.\nNOTE 1:\tThis parameter can apply only to some of the detected applications. For other applications (e.g. P2P), this parameter may not be possible to provide.\nNOTE 2:\tAVPs included within this grouped AVP shall have the 'M' bit cleared.\nNOTE 3:\tThe following event trigger values are applicable when ABC feature is supported: OUT_OF_CREDIT (15), REALLOCATION_OF_CREDIT (16), USER_CSG_INFORMATION_CHANGE (30), USER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE (35), USER_CSG_ HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE (36), CREDIT_MANAGEMENT_SESSION_FAILURE (46). User-CSG-Information AVP and Credit-Management-Status AVP are only applicable when ABC feature is supported.\nNOTE 4:\tFor Fixed Broadband Access, the TDF does not subscribe to event triggers indication from the PCRF at any IP-CAN session procedure.\nNOTE 5:\tSPONSORED_CONNECTIVITY_LEVEL is only applicable to the supported feature SponsoredConnectivity-Sd as defined in subclause 5b.4.1.\nNOTE 6:\tThe base function for Sd reference point supports only one Redirect-Information AVP, ADC-Add-Redirection feature supports additional Redirect-Information AVP.\n5b.4.1\tUse of the Supported-Features AVP on the Sd reference point\nThe Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The Diameter node sending a Diameter request that establishes a Diameter session (i.e. the PCRF for solicited application reporting and the TDF for unsolicited application reporting) shall, in this request indicate the set of features it supports. The Diameter node answering this request (i.e. the TDF for solicited application reporting and the PCRF for unsolicited application reporting) shall indicate the set of features that it has in common with the features in the request and that it shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the Sd reference point shall be compliant with the requirements for dynamic discovery of supported features and associated error handling on the Sd reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [14].\nThe base functionality for the Sd reference point is the 3GPP Rel-11 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the Sd commands. As defined in clause 7.1.1 of 3GPP TS 29.229 [14], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [14], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the Sd reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the Sd reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [14]. The following exceptions apply to the initial TSR/TSA command pair:\n-\tIf the TDF supports post-Rel-11 Sd functionality, the TSA shall include the features supported by the TDF within Supported-Features AVP(s) with the 'M' bit cleared.\nNOTE: One instance of Supported-Features AVP is needed per Feature-List-ID.\n-\tIf the TSR command does not contain any Supported-Features AVP(s), the TSA command shall not include the Supported-Features AVP. In this case, both TDF and PCRF shall behave as specified in the Rel-11 version of this document without UMCH feature.\nOnce the PCRF and TDF have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe table below defines the features applicable to the Sd interfaces for the feature list with a Feature-List-ID of 1.\nTable 5b.4.1.1: Features of Feature-List-ID 1 used in Sd\nFeature bit\nFeature\nM/O\nDescription\n0\nUMCH\nO\nThis feature indicates support for Usage Monitoring Congestion Handling. If the TDF supports this feature, the behaviour shall be as specified in clauses 4b.5.7.7.\n1\nTrusted-WLAN\nO\nThis feature indicates the support for the Trusted WLAN access as defined in TS 23.402 [23].\n2\nTimeBasedUM\nO\nThis feature indicates support for Time based Usage Monitoring Control. If the TDF supports this feature, the behaviour shall be as specified in corresponding clauses in this specification.\n3\nPendingTransaction\nO\nThis feature indicates support for the race condition handling as defined in TS 29.213 [8].\n4\nABC\nO\nThis feature indicates support for Application Based Charging.\n5\nCNO-ULI\nO\nThis feature indicates support for Presence Reporting Area Information Reporting. If the TDF supports this feature, the PCRF shall behave as described in Annex B.3.16.\n6\nExUsage\nO\nThis feature indicates support for excluding the corresponding application for the volume and/or time measurement on TDF session level.\n7\nDLDSCPMarking\nO\nThis feature indicates support for DSCP marking of downlink packets for the detected application traffic(s) as specified in clause 4b.5.14.\n8\nTSC\nO\nThis feature indicates support for traffic steering control in the (S)Gi-LAN. If the TDF supports this feature, the PCRF shall behave as described in subclause 4b.5.15.\n9\nENB-Change\nO\nThis feature indicates support for eNodeB change reporting Enhancement. It is used for the TDF to indicate if it supports eNodeB change reporting Enhancement.\n10\nSponsoredConnectivity-Sd\nO\nThis feature indicates support for sponsored data connectivity feature. If the TDF supports this feature, the PCRF may authorize sponsored data connectivity to the subscriber. This feature is applicable only if the ABC feature is also supported.\n11\nExtended-BW-NR\nO\nThis feature indicates the support of extended bandwidth values for NR.\n12\nADC-Add-Redirection\nO\nThis feature indicates support for additional redirection information in application detection and control.\n13\nUser-Equipment-Info-Extension\nO\nThis feature indicates the support of the User-Equipment-Info-Extension AVP as defined in IETF RFC 8506 [66].\nNOTE:\nFeature bit:\tThe order number of the bit within the Feature-List AVP where the least significant bit is assigned number \"0\".\nFeature:\tA short name that can be used to refer to the bit and to the feature, e.g. \"EPS\".\nM/O:\tDefines if the implementation of the feature is mandatory (\"M\") or optional (\"O\") in this 3GPP Release.\nDescription:\tA clear textual description of the feature.\n5b.5\tSd specific Experimental-Result-Code AVP values\n5b.5.1\tGeneral\nIETF RFC 6733 [61] specifies the Experimental-Result AVP containing Vendor-ID AVP and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code 298) is of type Unsigned32 and contains a vendor-assigned value representing the result of processing a request. The Vendor-ID AVP shall be set to 3GPP (10415).\n5b.5.2\tSuccess\nResult Codes that fall within the Success category are used to inform a peer that a request has been successfully completed.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] shall be applied.\n5b.5.3\tPermanent Failures\nErrors that fall within the Permanent Failures category shall be used to inform the peer that the request failed, and should not be attempted again.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] are applicable. Also the following specific Gx Experimental-Result-Codes value is reused for TDF session: DIAMETER_ADC_RULE_EVENT (see 5.5.3):\n5b.5.4\tTransient Failures\nErrors that fall within the transient failures category are used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future.\nThe Result-Code AVP values defined in Diameter Base IETF RFC 6733 [61] are applicable.\n5b.6\tSd Messages\n5b.6.1\tSd Application\nSd Messages are carried within the Diameter Application(s) described in clause 5b.1.\nIn addition to the TDF-Session-Request/Answer commands used to establish the TDF session, existing Diameter command codes from the Diameter base protocol IETF RFC 6733 [61] and the Diameter Credit Control Application IETF RFC 8506 [66] are used with the Sd specific AVPs specified in clause 5b.3. The Diameter Credit Control Application AVPs and AVPs from other Diameter applications that are re-used are defined in clause 5b.4. The Sd application identifier shall be included in the Auth-Application-Id AVP for the reused commands. The Sd application identifier shall be included in the Auth-Application-Id AVP within the Vendor-Specific-Application-Id grouped AVP contained in the TDF-Session-Request/Answer commands.\nNOTE 1:\tAs TDF-Session-Request/Answer commands have been defined based on the former specification of the Diameter Base Protocol (IETF RFC 3588 [5]), the Vendor-Specific-Application-Id AVP is still assumed as a required AVP (an AVP indicated as {AVP}) in the command code format to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter Base Protocol (IETF RFC 6733 [61]).\nIn order to support both PULL and PUSH procedures, a Diameter session needs to be established for each TDF session, if there is a decision made by PCRF to establish TDF session.\nNOTE 2:\tSome of the AVPs included in the messages formats below are in bold to highlight that these AVPs are used by this specific protocol and do not belong to the original message definition in the DCC Application IETF RFC 8506 [66] or Diameter Base Protocol IETF RFC 6733 [61].\n5b.6.2\tTDF-Session-Request (TSR) Command\nThe TSR command, indicated by the Command-Code field set to 8388637 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the TDF in order to establish the TDF session and to provision the ADC rules. It may also include the requested event triggers.\nMessage Format:\n<TS-Request> ::= < Diameter Header: 8388637, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n*[ Subscription-Id ]\n*[ Supported-Features ]\n[ Framed-IP-Address ]\n[ Framed-Ipv6-Prefix ]\n[ IP-CAN-Type ]\n[ RAT-Type ]\n[ AN-Trusted]\n[ User-Equipment-Info ]\n[ User-Equipment-Info-Extension ]\n[ QoS-Information ]\n0*2 [ AN-GW-Address ]\n[ 3GPP-SGSN-Address ]\n[ 3GPP-SGSN-Ipv6-Address ]\n[ 3GPP-GGSN-Address ]\n[ 3GPP-GGSN-Ipv6-Address ]\n[ 3GPP-Selection-Mode ]\n[ Dynamic-Address-Flag ]\n[ Dynamic-Address-Flag-Extension ]\n[ PDN-Connection-Charging-ID ]\n[ 3GPP-SGSN-MCC-MNC ]\n[ RAI ]\n[ 3GPP-User-Location-Info ]\n[ Fixed-User-Location-Info ]\n[ User-CSG-Information ]\n[ TWAN-Identifier ]\n[ 3GPP-MS-TimeZone ]\n[ 3GPP-Charging-Characteristics ]\n[ Called-Station-Id ]\n[ Charging-Information ]\n[ Online ]\n[ Offline ]\n*[ ADC-Rule-Install ]\n[ Revalidation-Time ]\n*[ Usage-Monitoring-Information ]\n*[ CSG-Information-Reporting ]\n*[ Event-Trigger]\n[ Presence-Reporting-Area-Information ]\n[ Logical-Access-ID ]\n[ Physical-Access-ID ]\n[ 3GPP2-BSID ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5b.6.3\tTDF-Session-Answer (TSA) Command\nThe TSA command, indicated by the Command-Code field set to 8388637and the 'R' bit cleared in the Command Flags field, is sent by the TDF to the PCRF in response to the TS-Request command.\nMessage Format:\n<TS-Answer> ::=  < Diameter Header: 8388637, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Supported-Features ]\n*[ ADC-Rule-Report ]\n[ Event-Report-Indication ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Load ]\n*[ AVP ]\n5b.6.4\tCC-Request (CCR) Command\nThe CCR command, indicated by the Command-Code field set to 272 and the 'R' bit set in the Command Flags field, is sent by the TDF to the PCRF in order to request ADC rules or to inform PCRF about the application detection. It is also sent to the PCRF in case of TDF session termination, following receipt of the corresponding RAR command from the PCRF.\nMessage Format:\n<CC-Request> ::= < Diameter Header: 272, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ OC-Supported-Features ]\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ Credit-Management-Status ]\n[ Destination-Host ]\n[ Origin-State-Id ]\n[ Framed-IP-Address ]\n[ Framed-Ipv6-Prefix ]\n*[ ADC-Rule-Report]\n*[ Application-Detection-Information ]\n*[ Event-Trigger]\n[ Event-Report-Indication ]\n*[ Usage-Monitoring-Information ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Supported-Features ]\n*[ AVP ]\nNOTE 1:\tFor the Solicited application reporting, only CC-Request-Type equal to UPDATE_REQUEST and TERMINATION_REQUEST are used.\n5b.6.5\tCC-Answer (CCA) Command\nThe CCA command, indicated by the Command-Code field set to 272 and the 'R' bit cleared in the Command Flags field, is sent by the PCRF to the TDF in response to the CCR command. It is used to provision ADC rules and event triggers for the TDF session and to acknowledge the report of the application's traffic start/stop.\nMessage Format:\n<CC-Answer> ::=  < Diameter Header: 272, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ Framed-Ipv6-Prefix ]\n[ QoS-Information ]\n*[ Event-Trigger ]\n*[ CSG-Information-Reporting ]\n[ Event-Report-Indication ]\n[ Origin-State-Id ]\n*[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n*[ ADC-Rule-Remove ]\n*[ ADC-Rule-Install ]\n[ Revalidation-Time ]\n*[ Usage-Monitoring-Information ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Supported-Features ]\n*[ Load ]\n*[ AVP ]\nNOTE 1:\tFor the Solicited application reporting, only CC-Request-Type equal to UPDATE_REQUEST and TERMINATION_REQUEST are used.\nNOTE 2:\tFramed-Ipv6-Prefix AVP is applicable only for the Unsolicited Application Reporting.\nNOTE 3\tLoad AVP is only applicable to the unsolicited application reporting.\n5b.6.6\tRe-Auth-Request (RAR) Command\nThe RAR command, indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the TDF in order to provision ADC rules using the PUSH procedure for solicited application reporting. It is also used to provision event triggers and to report event report indications for the TDF session for solicited application reporting and to request the TDF session termination for both solicited and unsolicited application reporting.\nMessage Format:\n<RA-Request> ::= < Diameter Header: 258, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Re-Auth-Request-Type }\n[ Session-Release-Cause ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ QoS-Information ]\n*[ Event-Trigger ]\n*[ CSG-Information-Reporting ]\n[ Event-Report-Indication ]\n*[ ADC-Rule-Remove ]\n*[ ADC-Rule-Install ]\n[ Revalidation-Time ]\n*[ Usage-Monitoring-Information ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP]\n5b.6.7\tRe-Auth-Answer (RAA) Command\nThe RAA command, indicated by the Command-Code field set to 258 and the 'R' bit cleared in the Command Flags field, is sent by the TDF to the PCRF in response to the RAR command.\nMessage Format:\n<RA-Answer> ::=  < Diameter Header: 258, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ ADC-Rule-Report ]\n[ Event-Report-Indication ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Load ]\n*[ AVP ]\n5c\tSt Diameter protocol\n5c.1\tSt Application\nThe St application is defined as a vendor specific Diameter application, where the vendor is 3GPP. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415. The Application-ID for the St Application is 16777349 and this value shall be used in the Diameter command header as well as any Application-ID AVPs (Auth-Application-Id/Vendor-Specific-Application-Id) in the command body.\n5c.2\tInitialization, maintenance and termination of connection and session\nThe initialization and maintenance of the connection between each PCRF and TSSF pair is defined by the underlying protocol. Establishment and maintenance of connections between Diameter nodes is described in IETF RFC 6733 [61].\nAfter establishing the transport connection, the PCRF and the TSSF shall advertise the support of the St Application by including the value of the application identifier in the Auth-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands are specified in the Diameter Base Protocol (IETF RFC 6733 [61]).\nThe Diameter session on the St reference point shall be established at the request of the PCRF by an TDF-Session-Request including the Request-Type AVP set to \"0 (initial request)\". Session modifications shall be initiated by PCRF with an TDF-Session-Request including the Request-Type AVP set to \"1 (update request)\". The session termination shall be initiated by the PCRF with an Session-Termination-Request.\n5c.3\tSt specific AVPs\n5c.3.1\tGeneral\nTable 5c.3.1.1 describes the Diameter AVPs defined for the St reference point, their AVP Code values, types, possible flag values, and whether or not the AVP may be encrypted. The Vendor-Id header of all AVPs defined in the present document shall be set to 3GPP (10415).\nTable 5c.3.1.1: St specific Diameter AVPs\nAVP Flag rules (NOTE 1)\nApplicability (NOTE 3)\nAttribute Name\nAVP Code\nClause defined\nValue Type (NOTE 2)\nMust\nMay\nShould not\nMust not\nMay Encr.\nRequest-Type\n2838\n5c.3.2\nUnsigned32\nM,V\nP\nY\nNOTE 1:\tThe AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [61].\nNOTE 2:\tThe value types are defined in IETF RFC 6733 [61].\nNOTE 3:\tAVPs marked with a supported feature are applicable as described in subclause 5c.4.2.\n5c.3.2\tRequest-Type AVP\nThe Request-Type AVP (AVP code 2838) is of type Unsigned32, and contains the reason for sending a Request message.\nThe following values are defined:\n0\t(initial request)\nAn initial request is used to initiate a Diameter session and contains information that is relevant to initiation.\n1\t(update request)\nAn update request is used to update an existing Diameter session.\n5c.4\tSt re-used AVPs\n5c.4.1\tGeneral\nTable 5c.4.1.1 lists the Diameter AVPs re-used by the St reference point from existing Diameter Applications, reference to their respective specifications, short description of their usage within the St reference point and which supported features the AVP is applicable to. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table 5c.4.1.1, but they are re-used for the St reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings.\nTable 5c.4.1.1: St re-used Diameter AVPs\nAttribute Name\nReference\nDescription\nApplicability (NOTE 1)\nADC-Rule-Base-Name\n5b.3.4\nThe ADC-Rule-Base-Name t indicates the name of a predefined group of ADC rules with rules with traffic steering policies.\nADC-Rule-Definition\n5b.3.3\nThe ADC-Rule-Definition AVP defines the ADC rule with traffic steering policies sent by the PCRF.\nOnly the ADC-Rule-Name AVP, the TDF-Application-Identifier AVP (NOTE 2), the Flow-Information AVP, the Precedence AVP, the Traffic-Steering-Policy-Identifier-DL AVP and the Traffic-Steering-Policy-Identifier-UL AVP within the AVP are required on the St reference point\nADC-Rule-Install\n5b.3.1\nThe ADC-Rule-Install AVP is used to activate, install or modify ADC rules with traffic steering policies as instructed from the PCRF.\nOnly the ADC-Rule-Definition AVP, the ADC-Rule-Name AVP and the ADC-Rule-Based-Name within the AVP are required on the St reference point.\nADC-Rule-Name\n5b.3.5\nThe ADC-Rule-Name defines a name for ADC rule with traffic steering policies. For ADC rules provided by the PCRF it uniquely identifies an ADC rule within one St session. For predefined ADC rules, it uniquely identifies an ADC rule within the TSSF.\nADC-Rule-Remove\n5b.3.2\nThe ADC-Rule-Remove AVP is used to deactivate or remove ADC rules with traffic steering policies as instructed from the PCRF.\nADC-Rule-Report\n5b.3.6\nThe ADC-Rule-Report AVP is used to report the status of the ADC rules which cannot be installed/activated. Only the the ADC-Rule-Name AVP, the ADC-Rule-Base-Name and the PCC-Rule-Status AVP within the AVP are required on the St reference point.\nCalled-Station-Id\nIETF RFC 4005 [12]\nThe address the user is connected to (i.e. the PDN identifier). For GPRS and EPS the APN. When used to contain the APN, the APN is composed of the APN Network Identifier only, or the APN Network Identifier and the APN Operator Identifier as specified in 3GPP TS 23.003 [25], clause 9.1. The inclusion of the APN Operator Identifier can be configurable.\nDRMP\nIETF RFC 7944  [53]\nAllows Diameter endpoints to indicate the relative priority of Diameter transactions.\nEvent-Report-Indication\n5.3.30\nWhen sent from the PCRF to the TSSF, it is used to report an event coming from the PCEF and the relevant info to the TSSF.\nThe following values for the included Event-Trigger are applicable:\nUE_IP_ADDRESS_ALLOCATE (18), UE_IP_ADDRESS_RELEASE (19).\nThe following AVP which is included in Event-Report-Indication is applicable to St interface:\nFramed-IP-Address.\nFlow-Description\n3GPP TS 29.214 [10], 5.4.2\nDefines the service data flow filter parameters for a detected application, if deducible. The rules for usage on St are defined in subclause 5.4.2.\nFlow-Direction\n5.3.65\nIt indicates the direction/directions that a filter for a detected application is applicable, downlink only, uplink only or both down- and uplink (bidirectional).\nFlow-Information\n5.3.53\nThis parameter may be sent from the PCRF to the TSSF to identify a service data flow.\nFramed-IP-Address\nIETF RFC 4005 [12]\nThe Ipv4 address allocated for the user.\nFramed-Ipv6-Prefix\nIETF RFC 4005 [12]\nThe Ipv6 prefix allocated for the user. The encoding of the value within this Octet String type AVP shall be as defined in IETF RFC 3162 [15], subclause 2.3. The \"Reserved\", \"Prefix-Length\" and \"Prefix\" fields shall be included in this order.\nLoad\nIETF RFC 8583 [60]\nThe AVP used to convey load information between Diameter nodes.\nThis AVP and all AVPs within this grouped AVP shall have the 'M' bit cleared.\nOC-OLR\nIETF RFC 7863 [49]\nContains the necessary information to convey an overload report.\nOC-Supported-Features\nIETF RFC 7863 [49]\nDefines the support for the Diameter overload indication conveyence by the sending node.\nPCC-Rule-Status\n5.3.19\nDescribes the status of one or a group of ADC rules.\nPrecedence\n5.3.11\nDefines, if multiple ADC rules overlap, which ADC Rule shall be applied for the purpose of enforcement, reporting of application start and stop, usage monitoring, and charging.\nRule-Failure-Code\n5.3.38\nIdentifies the reason an ADC rule is being reported.\nTSSF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.\nSecurity-Parameter-Index\n5.3.51\nDefines the IPSec SPI\nSupported-Features\n3GPP TS 29.229 [14]\nIf present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange.\nTDF-Application-Identifier\n5.3.77\nIt indicates the application detection filter defined at the TSSF. When used in a combination of PCEF/TDF and TSSF case, it shall refer to the value(s) for packet marking detection configured in the TSSF.\nToS-Traffic-Class\n5.3.15\nDefines the Ipv4 ToS or Ipv6 Traffic Class.\nWhen used for traffic detection, it defines the packet marking information used for traffic detection in the TSSF.\nTraffic-Steering-Policy-Identifier-DL\n5.3.123\nPointer to a pre-configured traffic steering policy at the TSSF for DL traffic\nTraffic-Steering-Policy-Identifier-UL\n5.3.124\nPointer to a pre-configured traffic steering policy at the TSSF for UL traffic\nNOTE 1:\tAVPs marked with a supported feature are applicable as described in clause 5c.4.2.\nNOTE 2:\tWhen used in the St interface, the TDF-Application-Identifier AVP shall refer to the application detection filter defined at the TSSF.\n5c.4.2\tUse of the Supported-Features AVP on the St reference point\nThe Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The  PCRF shall, in the first request in a Diameter session, indicate the set of supported features. The TSSF shall, in the first answer within the Diameter session, indicate the set of features that it has in common with the PCRF; the TSSF shall then support those features within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the St reference point shall be compliant with the requirements for dynamic discovery of supported features and associated error handling on the Cx reference point as defined in subclause 7.2.1 of 3GPP TS 29.229 [14].\nThe base functionality for the St reference point is the 3GPP Rel-13 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the St commands. As defined in subclause 7.1.1 of 3GPP TS 29.229 [14], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [14], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the St reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the St reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in subclause 7.2.1 of 3GPP TS 29.229 [14]. The following exceptions apply to the initial TSR/TSA command pair:\n-\tIf the TSSF supports any supported features defined for the St application, the TSA shall include the features supported by the TSSF within Supported-Features AVP(s) with the ‘M’ bit cleared.\nNOTE: One instance of Supported-Features AVP is needed per Feature-List-ID.\n-\tIf the TSR command does not contain any Supported-Features AVP(s), the TSA command shall not include the Supported-Features AVP. In this case, both TSSF and PCRF shall behave as specified in the Rel-13 version of this document.\nOnce the PCRF and TSSF have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nThe table below defines the features applicable to the St interfaces for the feature list with a Feature-List-ID of 1.\nTable 5b.4.1.1: Features of Feature-List-ID 1 used in St Protocol\nFeature bit\nFeature\nM/O\nDescription\nFeature bit:\tThe order number of the bit within the Feature-List AVP where the least significant bit is assigned number \"0\".\nFeature:\tA short name that can be used to refer to the bit and to the feature, e.g. \"EPS\".\nM/O:\tDefines if the implementation of the feature is mandatory (\"M\") or optional (\"O\") in this 3GPP Release.\nDescription:\tA clear textual description of the feature.\nIn this release there are no supported features.\n5c.5\tSt specific Experimental-Result-Code AVP values\n5c.5.1\tGeneral\nIETF RFC 6733 [61] specifies the Experimental-Result AVP containing Vendor-ID AVP and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code 298) is of type Unsigned32 and contains a vendor-assigned value representing the result of processing a request. The Vendor-ID AVP shall be set to 3GPP (10415).\n5c.5.2\tSuccess\nResult Codes that fall within the Success category are used to inform a peer that a request has been successfully completed.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] shall be applied.\n5c.5.3\tPermanent Failures\nErrors that fall within the Permanent Failures category shall be used to inform the peer that the request failed, and should not be attempted again.\nThe Result-Code AVP values defined in Diameter BASE IETF RFC 6733 [61] are applicable. Also the following specific Gx Experimental-Result-Codes value is reused for St session: DIAMETER_ADC_RULE_EVENT (see subclause 5.5.3).\n5c.5.4\tTransient Failures\nErrors that fall within the transient failures category are used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future.\nThe Result-Code AVP values defined in Diameter Base IETF RFC 6733 [61] are applicable.\n5c.6\tSt Messages\n5c.6.1\tGeneral\nSt Messages shall use the Diameter Application described in subclause 5c.1.\nExisting Diameter command codes from the Diameter base protocol IETF RFC 6733 [61] and from the Diameter Sd protocol are used. In additions, the TNR and TNA commands are defined.\nThe St application identifier shall be included in the Auth-Application-Id AVP for the reused commands. The St application identifier shall be included in the Auth-Application-Id AVP within the Vendor-Specific-Application-Id grouped AVP contained in the TDF-Session-Request/Answer commands.\nNOTE 1:\tAs TDF-Session-Request/Answer commands have been defined based on the former specification of the Diameter Base Protocol (IETF RFC 3588 [5]), the Vendor-Specific-Application-Id AVP is still assumed as a required AVP (an AVP indicated as {AVP}) in the command code format to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter Base Protocol (IETF RFC 6733 [61]).\nEvery command is defined by means of the ABNF syntax in IETF RFC 2234 [55], and according to the rules in IETF RFC 6733 [61].\nNOTE 2:\tSome of the AVPs included in the messages formats below are in bold to highlight that these AVPs are used by this specific protocol and do not belong to the original message definition in the Diameter Base Protocol IETF RFC 6733 [61], or to the standard set of AVPs required in most Diameter commands.\nThe following Command Codes are defined for the St Diameter application, as allocated by IANA from the vendor-specific namespace defined in IETF RFC 5719 [54]:\nTable 5c.6.1.1: Command-Code values for St\nCommand-Name\nAbbreviation\nCode\nSection\nTSSF-Notification-Request\nTNR\n8388731\n5c.6.6\nTSSF-Notification-Answer\nTNA\n8388731\n5c.6.7\n5c.6.2\tTDF-Session-Request (TSR) Command\nThe TSR command, indicated by the Command-Code field set to 8388637 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the TSSF in order to establish an St session, provision and update ADC rules.\nMessage Format:\n<TS-Request> ::= < Diameter Header: 8388637, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Request-Type }\n[ Destination-Host ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ Event-Report-Indication ]\n[ Framed-IP-Address ]\n[ Framed-Ipv6-Prefix ]\n[ Called-Station-Id ]\n*[ ADC-Rule-Install ]\n*[ ADC-Rule-Remove ]\n*[ Supported-Features ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5c.6.3\tTDF-Session-Answer (TSA) Command\nThe TSA command, indicated by the Command-Code field set to 8388637 and the 'R' bit cleared in the Command Flags field, is sent by the TSSF to the PCRF in response to the TC-Request command.\nMessage Format:\n<TS-Answer> ::=  < Diameter Header: 8388637, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ ADC-Rule-Report ]\n*[ Supported-Features ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Load ]\n*[ AVP ]\n5c.6.4\tSession-Termination-Request (STR) command\nThe STR command, indicated by the Command-Code field set to 275 and the ‘R’ bit set in the Command Flags field, is sent by the PCRF to inform the TSSF that an established St session shall be terminated.\nMessage Format:\n<ST-Request> ::= < Diameter Header: 275, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ Destination-Host ]\n[ OC-Supported-Features ]\n*[ Class ]\n[ Origin-State-Id ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5c.6.5\tSession-Termination-Answer (STA) command\nThe STA command, indicated by the Command-Code field set to 275 and the ‘R’ bit cleared in the Command Flags field, is sent by the TSSF to the PCRF in response to the STR command.\nMessage Format:\n<ST-Answer>  ::= < Diameter Header: 275, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ Failed-AVP ]\n[ Origin-State-Id ]\n*[ Class ]\n*[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n*[ Proxy-Info ]\n*[ Load ]\n*[ AVP ]\n5c.6.6\tTSSF-Notification-Request (TNR) Command\nThe TNR command, indicated by the Command-Code field set to 8388731 and the 'R' bit set in the Command Flags field, is sent by the TSSF to the PCRF in order to provide notifications.\nMessage Format:\n<TN-Request> ::= < Diameter Header: 8388731, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n[ Origin-State-Id ]\n*[ ADC-Rule-Report]\n[ OC-Supported-Features ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\n5c.6.7\tTSSF-Notification-Answer (TNA) Command\nThe TNA command, indicated by the Command-Code field set to 8388731 and the 'R' bit cleared in the Command Flags field, is sent by the PCRF to the TSSF in response to the TNR command.\nMessage Format:\n<TN-Answer> ::=  < Diameter Header: 8388731, PXY >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ Origin-State-Id ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\nAnnex A (normative):Access specific aspects (GPRS)\nA.1\tScope\nThis annex defines access specific aspects procedures for use of Gx/Gxx between PCRF and a GPRS IP-CAN.\nA.2\tReference model\nIn GPRS IP-CAN, the BBERF does not apply. The Gxx reference point is not applicable.\nA.2\tFunctional elements\nA.2.1\tPCRF\nFor GPRS it shall be possible to support policy control, i.e. access control and QoS control, on a per-PDP context basis for the UE initiated bearer control case.\nA.3\tPCC procedures\nA.3.1\tRequest for PCC rules\nAt IP-CAN session establishment as described in clause 4.5.1, information about the user equipment (e.g. IMEI(SV)), QoS negotiated and further QoS related information as detailed in clause A.3.3.1, user location information (e.g. RAI, CGI/SAI) SGSN Address, SGSN country and network codes, APN and indication if the bearer is used as IMS signalling PDP context shall be provided. The PCEF shall provide the Bearer-Identifier AVP at the IP-CAN session establishment. In this case, the PCEF shall also include the Bearer-Operation AVP set to the value \"Establishment\". If information about the support of network-initiated bearer procedures is available, the Network-Request-Support AVP shall be provided.\nNOTE 1:\t3GPP TS 29.060 [18] defines the RAT type as optional over Gn/Gp interface up to 3GPP Rel‑9. In fact the optionality was introduced solely for maintaining backwards compatibility at the protocol level between different versions of the protocol. For 3GPP Rel-9 and and earlier releases, the conditions about when the RAT-Type is present over Gn/Gp interface are defined in 3GPP TS 23.060 [17] clause 15.1.1a. From 3GPP Rel-10 onwards, it is mandatory for the RAT Type IE to be sent by the SGSN to the GGSN at Create PDP Context, or at Update PDP Context when the RAT has changed.\nIP-CAN session modification with PCEF-requested rules, as described in clause 4.5.1, can occur in the following cases:\n-\tWhen a new PDP Context is being established by the UE in an already existing IP-CAN Session.\n-\tWhen a PDP context is being modified and an Event trigger is met.\n-\tWhen a PDP context is being terminated.\nThe request for PCC rules is formed in the same way, regardless the bearer control mode. The IP-CAN session may have no resources initiated by the network, e.g. for an IP-CAN session that operates in BCM UE_ONLY, and in that case there are no NW-initiated resources to take into account.\nThe following replaces, for packet filter information and QoS handling, what is specified in clause 4.5.1:\n-\tIf a new IP-CAN bearer is being established, the PCEF shall assign a new bearer identifier to this IP-CAN bearer, include this identifier within the Bearer-Identifier AVP, and include the Bearer-Operation AVP set to the value \"ESTABLISHMENT\", the UE-provided TFT filters and the requested QoS of the new IP-CAN bearer.\n-\tIf an existing IP-CAN bearer is being modified:\n-\tIf the PCEF has not yet notified the PCRF about this IP CAN bearer and the UE adds one or more packet filters to the Traffic Flow template, the PCEF shall assign a new bearer identifier to this IP-CAN bearer, include the Bearer-Identifier AVP, the Bearer-Operation AVP set to the value \"ESTABLISHMENT\", the UE-provided TFT filters and the requested QoS as detailed in clause A.3.3.3a.\n-\tIf the PCEF has already notified the PCRF about this IP CAN bearer, the PCEF shall include the Bearer-Identifier AVP, the Bearer-Operation AVP set to the value \"MODIFICATION\" all the TFT filter definitions for this bearer, including the requested changes but excluding the TFT filters created with NW-initiated procedures, and QoS related information as detailed in clause A.3.3.3a.\n-\tIf an existing IP-CAN bearer is being terminated, the PCEF shall include the Bearer-Identifier AVP, the Bearer-Operation AVP set to the value \"TERMINATION\" and the Charging-Rule-Report AVP indicating the removal of any PCC rules created with NW-initiated procedures having the bearer binding with the same bearer.\n-\tIf the Event trigger that caused the IP-CAN bearer modification applies at session level (i.e. it is common to all the bearers belonging to that IP-CAN session), PCEF shall send a single CC-Request for all the affected bearers. In this case, the Bearer-Identifier AVP shall not be included to indicate that it applies to all the IP-CAN bearers in the IP-CAN session. If the Event trigger that caused the IP CAN bearer modification applies at bearer level, the Charging-Rule-Report AVP shall include all the affected PCC rules.\nIf the PCRF does not accept one or more of the TFT filters provided by the PCEF in a CC Request (e.g. because the PCRF does not allow the UE to request enhanced QoS for services not known to the PCRF), the PCRF shall reject the request using a CC Answer with the Gx experimental result code TRAFFIC_MAPPING_INFO_REJECTED (5144). If the PCEF receives a CC Answer with this code, the PCEF shall reject the IP-CAN session establishment or modification that initiated the CC Request by applying a proper cause code and other parameters as per 3GPP TS 29.060 [18].\nA.3.2\tProvisioning of PCC rules\nIf the PCRF performs the bearer binding and installs or activates a new PCC rule, the PCRF shall indicate the IP CAN bearer where the new rule shall be installed or activated using a Bearer-Identifier AVP within the Charging-Rule-Install AVP. If the PCRF modifies an already installed PCC rule, the PCRF does not need to indicate the bearer. If the PCEF obtains an updated definition of a PCC rule within a Charging-Rule-Install AVP without a Bearer-Identifier AVP, the PCEF shall continue to apply the PCC rule to the IP CAN bearer that has previously been indicated.\nIf the PCRF does not perform the bearer binding and installs or activates a new PCC rule, the PCRF does not indicate the bearer within the Charging-Rule-Install AVP. The PCEF shall then perform the bearer binding and select the IP CAN bearer where the provisioned new PCC rule is applied.\nIf the PCRF performs the bearer binding, the PCRF may move previously installed or activated PCC rule(s) from one IP CAN bearer to another IP CAN bearer. To move such PCC rule(s), the PCRF shall indicate the new bearer using the Bearer-Identifier AVP within a Charging-Rule-Install AVP and shall indicate the charging rules(s) to be moved using Charging-Rule name AVP(s), and/or a Charging-Rule-Base-Name AVP(s), and/or Charging-Rule-Definition AVP(s) (for PCC rule(s) that are modified at the same time). The PCEF shall then apply these PCC rules at the new indicated IP CAN bearer and shall remove them from the IP CAN bearer where the rules previously had been applied.\nThe PCRF may request the establishment of a bearer dedicated to IMS signalling by providing the applicable PCC rules to the PCEF.\nWhen the PCEF includes the Bearer-Usage AVP required for the bearer within the CCR command during the IP-CAN session establishment procedure, the PCRF shall provide the Bearer-Usage AVP back in the response with the authorized usage. If the PCEF includes IMS_SIGNALLING within the Bearer-Usage AVP and the PCRF accepts that default bearer is dedicated to IMS signalling, the PCRF shall include the IMS_SIGNALLING within the Bearer-Usage AVP. In this case, the PCRF shall restrict the bearer to only be used for IMS signalling as specified in 3GPP TS 23.228 [31] by applying the applicable QCI for IMS signalling.\nIf the PCEF include the IMS_SIGNALLING within the Bearer-Usage AVP in the CCR command, but the PCRF does not include the IMS_SIGNALLING within the Bearer-Usage AVP in the CCA command, the PCC Rules provided by the PCRF shall have a QCI value different from the QCI value for the IMS signalling.\nWhen the PCRF performs the bearer binding and the UE initiates a Secondary PDP Context Activation, if the PCEF includes the Bearer-Usage AVP indicating IMS_SIGNALLING and the PCRF accepts that a bearer dedicated to IMS signalling shall be used, the PCRF shall return the IMS_SIGNALLING within the Bearer-Usage AVP. The provided PCC rules shall have the QCI applicable for IMS signalling.\nA.3.2.1\tPCC rule request for services not known to PCRF\nWhen the PCRF receives a request for PCC rules while no suitable authorized PCC rules are configured in the PCRF, and if the user is not allowed to access AF session based services but is allowed to request resources for services not known to the PCRF, refer to clause 4.5.2.0, the PCRF may downgrade the bitrate parameters and the QCI according to PCC internal policies when authorizing the request.\nA.3.2.2\tSelecting a PCC rule and IP CAN Bearer for Downlink IP packets\nTFT filters shall not be applied to assign downlink IP packets to PDP contexts if PCC is enabled for an APN.\nA.3.3\tProvisioning and Policy Enforcement of Authorized QoS\nFor 3GPP-GPRS, default EPS bearer QoS provisioning and enforcement is not applicable.\nA.3.3.0\tOverview\nThe PCRF may provide the authorized QoS that applies to a bearer to the PCEF. When the authorized QoS applies to an IP CAN bearer, it shall be provisioned outside a Charging-Rule-Definition AVP and it shall also include the Bearer-Identifier AVP to indicate what bearer it applies to.\nIf the PCRF performs the bearer binding, the authorized QoS per IP CAN bearer presents the QoS for this IP CAN bearer. Authorized QoS per QCI is not applicable. If the PCEF performs the bearer binding, the authorized QoS per IP CAN bearer is not applicable.\nThe Provisioning of authorized QoS per IP CAN bearer may be performed separate or in combination with the PCC rule provisioning procedure in clause 4.5.2.0.\nIn case the PCRF provides PCC rules dynamically, authorised QoS information for the IP-CAN bearer (combined QoS) may be provided. For a predefined PCC rule within the PCEF the authorized QoS information shall take affect when the PCC rule is activated.\nThe PCEF shall make sure that the total QoS information of the PCC rules for one IP-CAN bearer does not exceed the authorized QoS information, i.e. the information received from the PCRF.\nA.3.3.1\tProvisioning of authorized QoS per IP CAN bearer\nThe authorized QoS per IP-CAN bearer is used if the bearer binding is performed by the PCRF (as defined in 3GPP TS 29.213 [8]).\nThe PCEF will request the authorization of an IP CAN bearer establishment or modification by the PCRF using the \"Request for PCC rules\" procedure if the related conditions outlined in clause 4.5.1 apply. While executing this procedure, the PCEF shall apply the following QoS related procedures:\n-\tWhen the UE request the establishment of a new IP-CAN bearer, the PCEF shall derive the requested QoS information. The PCEF shall use Table A.4.1.1 to map the requested QoS within the IP CAN bearer establishment request to the QoS-Information AVP. If the PCEF receives the \"upgrade QoS Supported\" flag set to \"1\" in the Common Flag Information element within the corresponding Create PDP context request (3GPP TS 29.060 [18]), the PCEF shall supply the QoS-Upgrade AVP with value QoS_UPGRADE_SUPPORTED. The PCEF shall request a new PCC decisions using a CCR command including the requested QoS information within the QoS-Information AVP, in the CCR command to be sent to the PCRF.\nThe PCEF shall then wait for the corresponding CCA before replying to the IP-CAN bearer establishment request.\n-\tIf at any point of time the PCEF receives a request for a modification of an already existing IP-CAN bearer that matches event triggers supplied by the PCRF for the IP CAN session, the PCEF shall also request a new PCC decisions using a CCR command including the corresponding event triggers in the Event-Trigger AVP. If a QoS change for the existing IP-CAN bearer is requested the PCEF shall include the requested QoS information within the QoS-Information AVP in the CCR. If the PCEF receives within the corresponding Update PDP context request the \"upgrade QoS Supported\" flag in the Common Flag Information element (3GPP TS 29.060 [18]) set to a different value than previously communicated to the PCRF, the PCEF shall supply the QoS-Upgrade AVP indicating the new value. If the PCEF receives within the Update PDP context request the \"No QoS negotiation\" flag set to \"1\" in the Common Flag Information element (3GPP TS 29.060 [18]), the PCEF shall supply the QoS-Negotiation AVP with the value NO_QoS_NEGOTIATION.The PCEF shall wait for the corresponding CCA before replying to the IP-CAN bearer modification request.\nWhen receiving a CCR with a QoS-Information AVP, the PCRF shall decide upon the requested QoS information within the CCR command.\n-\tThe PCRF may compare the authorized QoS derived according to clause 6.3 of 3GPP TS 29.213 [8] with the requested QoS. If the requested QoS is less than the authorised QoS, the PCRF may either request to upgrade the IP CAN QoS by supplying that authorised QoS in the QoS-Information AVP to the PCEF (e.g. if the PCRF has exact knowledge of the required QoS for the corresponding service), or the PCRF may only authorise the requested QoS by supplying the requested QoS in the QoS-Information AVP to the PCEF (e.g. if the PCRF only derives upper limits for the authorized QoS for the corresponding service). If the requested bitrates are higher than the authorised bitrates, the PCRF shall downgrade the IP CAN QoS by supplying the authorised QoS in the QoS-Information AVP to the PCEF.\nThe following restrictions apply to the PCRF QoS authorization process:\n-\tIf the QoS-Negotiation AVP is received by the PCRF indicating that QoS negotiation is not allowed, the PCRF shall provision the requested QoS as authorized QoS.\n-\tIf the QoS-Upgrade AVP has been received by the PCRF indicating that QoS upgrade is not supported, the PCRF shall not provision an authorized bitrates (e.g. GBR, MBR) that are higher than the requested bitrates.\nIf for any reason the PCRF cannot authorize the requested QoS (e.g. authorized QoS would exceed the subscribed QoS), the PCRF shall indicate to the PCEF that the request is rejected by answering with a CCA command including the Experimental-Result-Code AVP set to the value DIAMETER_ERROR_BEARER_NOT_AUTHORIZED (5143) together with the bearer-identifier AVP. Otherwise, the PCRF shall provide a response for the CCR to the PCEF by issuing a CCA command without this experimental result code. The PCRF may use this CCA at the same time for the solicited PCC rule provisioning procedure in clause 4.5.2. The CCA command shall include a QoS-Information AVP at command level including the Bearer-Identifier AVP used in the corresponding CCR and the authorized QCI and bitrates. If PCRF decides to move rules between bearers, the CCA command shall also include the QoS-Information AVP(s) for the impacted bearers.\nThe PCRF may also decide to modify the authorized QoS per IP CAN bearer if it receives a CCR with other event triggers, for instance if the PCRF moves PCC rules from one IP-CAN bearer to another (e.g. in GPRS due to a TFT change). The PCRF shall then provision the updated authorized QoS per IP CAN bearer in the CCA within a QoS-Information AVP at command level including the corresponding Bearer-Identifier AVP.\nThe PCRF may decide to modify the authorized QoS per IP CAN bearer at any time. To modify the authorized QoS per IP CAN bearer, The PCRF shall send an unsolicited authorization to the PCEF. The unsolicited authorization shall be performed by sending a RAR command to the PCEF and including the QoS-Information AVP(s) with the new authorized values per IP CAN bearer. The PCRF may use this RAR at the same time for the unsolicited PCC rule provisioning procedure in clause 4.5.2.0. If the trigger to modify the authorized QoS comes from the AF, before starting an unsolicited provisioning, the PCRF may start a timer to wait for a UE requested corresponding PDP context modification. At the expiry of the timer, if no PCC rule request has previously been received by the PCRF, the PCRF should go on with the unsolicited authorization as explained above.\nIn addition to a provisioning of the \"Authorized QoS\" per IP CAN Bearer, the PCRF may also provide an authorized QoS per PCC rule.\nA.3.3.2\tPolicy enforcement for authorized QoS per IP CAN bearer\nThe PCEF is responsible for enforcing the policy based authorization, i.e., to ensure that the requested QoS is in-line with the \"Authorized QoS\" per IP-CAN bearer, as described in clause 4.5.5.1.\nUpon reception of an authorized QoS per IP-CAN bearer within a CCA or RAR command, the PCEF shall perform the mapping from that \"Authorised QoS\" information for the IP-CAN bearer into authorised UM3GPP TS QoS information according to Table A.4.1.1. The authorised UM3GPP TS QoS information is further processed by the UM3GPP TS BS Manager within the GGSN.\nIf the PCEF receives a solicited authorization decision from the PCRF (i.e. a decision within a CCA) and the requested QoS received within the IP-CAN bearer establishment or modification request that triggered the corresponding request for the authorization decision does not match the authorised QoS, the PCEF shall adjust the requested QoS information to the authorised QoS information within the IP-CAN bearer establishment or modification response.\nThe PCEF may store the authorized QoS of an active IP-CAN bearer in order to be able to make local decisions, when the UE requests for an IP-CAN bearer modification.\nWhen the PCEF receives an unsolicited authorisation decision from the PCRF (i.e. a decision within a RAR) with updated QoS information for an IP-CAN bearer, the PCEF shall update the stored authorised QoS. If the existing QoS of the IP-CAN bearer does not match the updated authorised QoS the PCEF shall perform a network initiated IP-CAN bearer modification to adjust the QoS to the authorised level.\nIf the PCEF provide authorized QoS for both, the IP-CAN bearer and PCC rule(s), the enforcement of authorized QoS of the individual PCC rules shall take place first.\nA.3.3.2a\tPolicy provisioning for authorized QoS per service data flow\nIf the PCRF performs the bearer binding for a service data flow, the PCRF may optionally provision an authorized QoS for that service data flow.\nFor the authorization of a PCC rule with a GBR QCI the PCRF shall assign a GBR value within the limit supported by the serving network (i.e. GERAN/UTRAN). The PCRF shall subscribe the RAT_CHANGE event to get the RAT type information for PCC rule authorization.\nNOTE:\tFor the authorization of PCC Rules with the same QCI the PCRF may also check that aggregated GBR is within the limits supported by the serving network to minimize the risk of rejection of the bearer by the serving network.\nA.3.3.3\tPolicy enforcement for authorized QoS per service data flow\nIf the PCRF provides authorized QoS for both, the IP-CAN bearer and PCC rule(s), the enforcement of authorized QoS of the individual PCC rules shall take place first.\nThe mapping from the authorized QoS parameters to the UM3GPP TS QoS parameters shall be performed according to Table A.4.1.1.\nA.3.3.3a\tCoordination of authorized QoS scopes in mixed mode\nThe PCEF will request the authorization of an IP CAN bearer establishment or modification by the PCRF using the \"Request for PCC rules\" procedure if the related conditions outlined in clause 4.5.1 and A.3.1 apply. The PCEF shall exclude any guaranteed bitrate for the NW-created PCC rule(s) it has bound to that IP CAN bearer from the requested QoS of that IP CAN bearer and request the authorization of the QoS for the affected PCC rules and, if any, new filters from the PCRF within the within the QoS-Information AVP.\nThe PCRF shall authorize the bandwidth for an IP CAN bearer which is required for the PCC rules it has bound to this IP CAN bearer. The PCEF shall add to the PCRF-provisioned authorized bandwidth of an IP CAN bearer the required bandwidth of all PCC rules it has bound to that IP CAN bearer unless the derived MBR value exceeds a possibly provisioned authorized QoS per QCI for the bearerer´s QCI (see clause 4.5.5.6).\nA.3.3.3b\tProvisioning of authorized QoS per QCI\nIf the PCRF performs the bearer binding the PCRF shall not provision an authorized QoS per QCI.\nPolicy provisioning for authorized QoS per QCI may apply when the IP-CAN type is 3GPP-GPRS. It shall be performed according to clause 4.5.5.5.\nA.3.3.4\tPolicy enforcement for authorized QoS per QCI\nPolicy enforcement for authorized QoS per QCI may apply when the IP-CAN type is 3GPP-GPRS. It shall be performed according to clause 4.5.5.6.\nThe mapping from the authorized QoS parameters to the UM3GPP TS QoS parameters shall be performed according to Table A.4.1.1.\nA.3.3.5\tVoid\nA.3.3.6\tProvisioning of authorized QoS per APN\nIf the PCRF receives the requested QoS per APN as part of the IP-CAN session establishment procedure, the PCRF shall provision the authorized unconditional APN policy information and may provision the authorized conditional APN policy information in the response. The PCRF may also provide QoS per APN with time conditions.\nA.3.4\tIndication of IP-CAN Bearer Termination Implications\nWhen a PDP context is terminated, , the PCEF shall apply the \"Indication of IP CAN Bearer Termination Implications\" procedure to inform the PCRF about implications of this bearer termination if any of the following conditions apply while the IP-CAN Session remains active:\n-\tA PDP Context is terminated, which has been initiated by the UE.\n-\tA PDP Context is terminated, which has been initiated by the network (e.g. SGSN).\nThe following exceptions to clause 4.5.6 shall apply in 3GPP-GPRS.\nWhen the PCRF performs bearer binding, the PCEF shall also supply the Bearer-Identifier and Bearer-Operation AVPs to indicate \"Termination\" of a specific bearer in a CC-Request with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\".\nWhen the PCRF receives the CC-Request indicating the implications of a bearer termination, it shall acknowledge the message by sending a CC-Answer to the PCEF. The PCRF has the option to make a new PCC decision for the affected PCC Rules. Within the CC-answer, the PCRF may provision PCC rules as detailed in clause 4.5.2.0. When the PCRF performs the bearer binding, the PCRF may provision PCC rules e.g. to move PCC rules previously applied to the terminated IP CAN bearer to any of the remaining IP CAN bearer(s). The Bearer-Identifier of the selected bearer(s) will be provided. The PCEF shall remove all PCC rules previously applied to the terminated IP CAN bearer, which have not been moved.\nThe PCEF shall remove all PCC rules previously applied to the terminated IP CAN bearer, which have not been moved.\nIf the last PDP context within an IP CAN session is being terminated, the PCEF shall apply the procedures in clause A.3.5 to indicate the IP CAN session termination.\nA.3.5\tIndication of IP-CAN Session Termination\nFor GPRS, an IP-CAN session is terminated when the last PDP Context within the IP-CAN session is being terminated. The procedure described in clause 4.5.7 applies here.\nA.3.6\tRequest of IP-CAN Bearer Termination\nIf no more PCC rules are applied to an IP CAN bearer, the PCEF shall send a PDP context deactivation request.\nIf the termination of the last IP CAN bearer within an IP CAN session is requested, the PCRF and PCEF shall apply the procedures in clause A.3.7.\nIf the selected Bearer Control Mode is UE-only, the PCRF may request the termination of an existing IP CAN bearer within an IP CAN session by using the PCC rule provisioning procedures in clause 4.5.2.0 to remove all PCRF-provisioned PCC rules and deactivate all PCC rules predefined within the PCEF, which have been applied to this IP CAN bearer. The PCRF may either completely remove these PCC rules from the IP CAN session or move them to another IP CAN bearer within the IP CAN session.\nIf the PCEF performs the IP CAN bearer binding, the PCRF is not aware that it requests the termination of an IP CAN bearer by removing certain PCC rules. If upon removal of the PCC rules, there are no more PCC rules active in the PCEF for an IP-CAN bearer, the PCEF shall initiate the bearer termination procedure. Further details of the binding mechanism can be found in 3GPP TS 29.213 [8].\nIf the selected Bearer Control Mode (BCM) is UE-only, and the PCRF receives a trigger for the removal of all PCC rules bound to an IP CAN bearer from the AF, the following steps apply. In order to avoid race conditions, the PCRF should start a timer to wait for the UE-initiated termination message. If a UE-initiated termination of an IP CAN bearer is performed before timer expiry, the PCRF will receive an Indication of IP-CAN Bearer Termination Implications according to clause 4.5.6 and shall then not perform the network-initiated termination of that IP CAN bearer. Otherwise, if the timer expires, the PCRF shall remove/deactivate all the PCC rules that have been previously installed/activated for that IP-CAN bearer.\nIf the IP-CAN bearer termination is caused by the PS to CS handover, the PCEF shall report related PCC rules for this IP-CAN bearer by including the Rule-Failure-Code AVP set to the value PS_TO_CS_HANDOVER.\nIf the PCRF decides to remove all PCC rules bound to an IP CAN bearer due to an internal trigger or trigger from the SPR, the PCRF shall instantly remove/deactivate all the PCC rules that have been previously installed/activated on that IP-CAN bearer.\nIf no more PCC rules are applied to an IP CAN bearer, the PCEF shall terminate the IP CAN bearer.\nA.3.7\tRequest of IP-CAN Session Termination\nThe procedure described in clause 4.5.9 applies with the following changes:\nIf no more PCC rules are applied to an IP CAN session, the PCEF shall send a PDP context deactivation request with the teardown indicator set to indicate that the termination of the entire IP-CAN session is requested.\nIf the selected Bearer Control Mode (BCM) is UE-only, and the PCRF receives a trigger for the removal of all PCC rules bound to an IP CAN session from the AF, the following steps apply. In order to avoid race conditions, the PCRF should start a timer to wait for the UE-initiated bearer termination message. If a UE-initiated bearer termination of an IP CAN session is performed before timer expiry, the PCRF will receive an Indication of IP-CAN Session Termination according to clause A.3.5 and shall then not perform the network-initiated termination of that IP CAN session. Otherwise, if the timer expires, the PCRF shall remove/deactivate all the PCC rules that have been previously installed or activated for that IP-CAN session.\nA.3.8\tBearer Control Mode Selection\nThe GGSN shall only include the Network-Request-Support AVP if it supports this procedure and both the UE and the SGSN have previously indicated to the GGSN (refer to 3GPP TS 23.060 [17] and 3GPP TS 29.060 [18]) that they also support it. The Network-Request-Support AVP shall be included if the GGSN received it from the SGSN.\nThe PCRF derives the Selected Bearer-Control-Mode AVP based on the received Network-Request-Support AVP, access network information, subscriber information and operator policy.\nAt IP-CAN session establishment, if the GGSN provided the Network-Request-Support AVP, the PCRF shall provide the Selected Bearer-Control-Mode AVP to the GGSN using the PCC Rules provision procedure at IP-CAN session establishment. At IP-CAN session modification, if the GGSN provided the Network-Request-Support AVP, the PCRF shall also provide the Bearer-Control-Mode AVP with the new value if the selected bearer control mode has changed. The GGSN should forward it to the UE. The selected value is applicable to all PDP Contexts within the activated PDP Address/APN pair.\nThe BCM selection procedure can also be triggered as a consequence of a change of SGSN.\nThe values defined in 5.3.23 for the Bearer-Control-Mode AVP apply with the following meaning:\nUE_ONLY (0)\nThis value is used to indicate that the UE shall request any additional PDP Context establishment.\nRESERVED (1)\nThis value is not used in this Release.\nUE_NW (2)\nThis value is used to indicate that both the UE and PCEF may request any additional PDP Context establishment and add own traffic mapping information to a PDP Context.\nA.3.9\tBearer Binding Mechanism\nRefer to annex D.2 of 3GPP TS 29.213 [8].\nA.3.10\tVoid\nA.3.11\tPCC Rule Error Handling\nIn addition to the procedures described in clause 4.5.12 the following procedures apply:\nIf the PCRF performs the bearer binding, for predefined PCC rules that contain only uplink service data flow filters which are known to the PCRF, the PCEF may include the Bearer-Identifier AVP within the Charging-Rule-Report AVP to indicate the affected IP-CAN bearer from a failed PCC rule activation. If no Bearer-Identifier is provided then the PCRF shall assume that PCC rule failed to activate to all assigned IP-CAN bearers.\nNOTE: In such a case the same PCC rule can be activated to multiple IP-CAN bearers of the same IP-CAN session.\nA.3.12\tIMS Emergency Session Support\nA.3.12.1\tRequest of PCC Rules for an Emergency services\nThe PCEF shall execute the procedures described in clause A.3.1 to Request PCC Rules for Emergency.\nA PCEF that requests PCC Rules at IP-CAN Session Establishment shall send a CCR command with CC-Request-Type AVP set to value \"INITIAL_REQUEST\" and the Called-Station-Id AVP including the Emergency APN. The PCEF may include the IMSI within the Subscription-Id AVP and if the IMSI is not available the PCEF shall include the IMEI(SV) within the User-Equipment-Info AVP or the User-Equipment-Info-Extension AVP if the User-Equipment-Info-Extension feature is supported. The PCEF may include the rest of the attributes described in clause A.3.1.\nIf the PCRF detects that the initial or subsequent CCR command shall be rejected, it shall execute the procedure for the type of Gx experimental result code described in clause A.3.1.\nAny PCEF-initiated requests for PCC Rules for an IMS Emergency service that include the \"TFT_CHANGE\" Event-Trigger AVP shall be rejected by the PCRF with the error DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED.\nA.3.12.2\tProvisioning of PCC Rules for an Emergency services\nThe PCRF shall execute the procedures described in clause A.3.2 to provision PCC Rules.\nThe PCRF shall detect that a Gx session is restricted to IMS Emergency services when a CCR command is received with a CC-Request-Type AVP set to value \"INITIAL_REQUEST\" and the Called-Station-Id AVP includes a PDN identifier that matches one of the Emergency APNs from the configurable list. The PCRF:\n-\tshall provision PCC Rules restricting the access to Emergency Services (e.g. P-CSCF(s), DHCP(s) and DNS (s) and SUPL(s) addresses) required by local operator policies in a CCA command according to the procedures described in clause A.3.2.\n-\tmay provision the authorized QoS within the QoS-Information AVP in a CCA command according to the procedures described in clause A.3.3.1 except for obtaining the authorized QoS upon interaction with the SPR.\n-\tshall assign NW mode to the PCC Rules that are bound to an IP-CAN session restricted to Emergency services.\nNOTE 1:\tThe PCRF does not provision the authorized QoS per QCI for Gx sessions established for the Emergency purposes.\nWhen the PCRF receives IMS service information for an Emergency service and derives authorized PCC Rules from the service information, the Priority-Level AVP, the Pre-emption-Capability AVP and the Pre-emption-Vulnerability AVP in the QoS information within the PCC Rule shall be assigned values as required by local operator policies.\nIf the Bearer Control Mode is assigned to \"UE_NW\" the PCRF shall assign NW mode to the PCC Rules that are bound to an IP-CAN session restricted to Emergency services and immediately initiate a PUSH procedure as described in clause A.3.2 to provision PCC Rules and the procedures described in clause A.3.3.2a to provision the authorized QoS per service data flow, except for the QoS Information within the PCC Rules that shall be assigned a priority within the Priority-Level AVP as required by local operator policies.\nAny PCEF-initiated request for PCC Rules for an IMS Emergency service triggered by Event-Trigger AVP assigned to \"TFT-change\" shall be rejected by the PCRF with the error DIAMETER_ERROR_TRAFFIC_MAPPING_INFO_REJECTED.\nA.3.13\tRemoval of PCC Rules for Emergency Services\nThe reception of a request to terminate an AF session for an IMS Emergency service by the PCRF follows the same procedure defined in clause 4.5.15.2.3.\nA.3.14\tRemoval of PCC Rules at Gx session termination\nThe reception of a request to terminate the IP-CAN session restricted to IMS Emergency session shall follow the same procedure defined in clause 4.5.15.2.4.\nA.3.15\tIMS Restoration Support\nThe procedure described in clause 4.5.18 applies and the monitoring procedure is defined in 3GPP TS 29.061 [11] Section 13a.2.2.1.\nA.3.16\tProvisioning of CSG information reporting indication\nThe PCRF may provide one or more CSG-Information-Reporting AVPs during IP-CAN/TDF session establishment and/or throughout the lifetime of the IP-CAN/TDF session, to request the PCEF/TDF to report the user CSG information change applicable for an IP-CAN/TDF session to the OFCS.\nNOTE:\tThe SPR can provide the Subscriber's User CSG Information reporting rules to the PCRF, the SPR's relation to existing subscriber databases is not specified in this Release.\nA.3.17\tPacket-Filter-Usage AVP\nNOTE:\tThe maximum number of packet filters sent to UE is limited as specified in 3GPP TS 24.008 [13].\nA.3.18\tPrecedence handling\nPCRF provides only one precedence value per PCC rule. For network initiated IP-CAN session modification, since one PCC rule may result in more than one TFT filters, the PCEF shall ensure that each TFT filter is assigned unique precedence value across all TFT filters of the corresponding PDN connection (as specified in 3GPP TS 24.008 [13]). When two PCC rules result in two sets of TFT filters, the PCEF shall also ensure that the relative precedence of the each set of TFT filters is same as the relative precedence of the corresponding PCC rule. E.g. if PCC rule R1 has higher precedence than PCC rule R2, all the TFT filters corresponding to R1 shall have higher precedence than all the TFT filters corresponding to R2.\nNOTE:\tThe maximum value of precedence of the TFT filter is limited as specified in 3GPP TS 24.008 [13].\nProvisioning of CSG information reporting indication to the TDF applies when ABC feature is supported.\nA.3.19\tReporting Access Network Information\nThe procedure described in clause 4.5.22 applies.\nThe GGSN provides the CGI/SAI within the 3GPP-User-Location-Info AVP.\nA.3.20\tUser CSG Information Reporting\nIf the PCEF receives the credit re-authorization triggers from the OCS and CSG information reporting indications within the CSG-Information-Reporting AVPs from the PCRF which request different levels of reporting of user CSG information change for a single IP-CAN session, the PCEF should derive the highest level of detail required and request the user CSG information change from the SGSN as defined in 3GPP TS 29.060 [18].\nWhen ABC feature is supported, the PCEF may send user CSG information to the TDF via the PCRF. During the IP-CAN Session Establishment, the PCEF may send the user CSG information to the PCRF in a CC-Request command within a User-CSG-Information AVP, and the PCRF sends User-CSG-Information AVP in a TSR command to the TDF.\nThe TDF shall, for the purpose of reporting to the OCS, select and subscribe to the applicable event triggers USER_CSG_INFORMATION_CHANGE, USER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE and/or USER_CSG_ HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE within an Event-Report-Indication AVP for reporting from the PCEF via the PCRF if the corresponding credit re-authorization triggers are requested by the OCS. The PCRF shall subscribe to the event triggers for the highest level of detail required for the reporting within the user CSG information reporting rules and Event-Report-Indication AVP to the PCEF. Then the PCEF request the user CSG information change from the SGSN as defined in 3GPP TS 29.060 [18].\nThe PCEF reports that user CSG information has changed with the applicable values provided in the related Event-Trigger AVPs and, when applicable, the new user CSG information within the User-CSG-Information AVP.\nThe PCRF shall send the Event-Trigger AVPs and when applicable, the User-CSG-Information AVP within an Event-Report-Indication AVP to the TDF in a RA-Request command.\nNOTE:\tThe PCEF/TDF reports the user CSG information to the OFCS on the level of detail as requested by the PCRF within the CSG-Information-Reporting AVPs and reports the user CSG information to the OCS on the level of detail as requested by the OCS re-authorization triggers.\nA.3.21\tIMS RLOS Support\nRLOS may be supported as described in clauses A.3.12, A.3.13 and A.3.14 with the following differences:\n-\temergence is replaced by RLOS;\n-\temergency APN  is replaced by RLOS APN;\n-\temergency service is replaced by RLOS; and\n-\tthe PCRF provides the PDN GW with the QoS parameters, based on operator policy, including an ARP value reserved for the Restricted Local Operator Services where RLOS has a lower priority in terms of admission control than regular PDN connections.\nA.4\tQoS mapping\nA.4.1\tGPRS QCI to UMTS QoS parameter mapping\nThe mapping of GPRS QCI to UM3GPP TS QoS parameters is shown in the following table (coming from 3GPP TS 23.203 [7] Annex A table A.3):\nTable A.4.1.1: Mapping for GPRS QoS Class Identifier to/from R99 UMTS QoS parameters\nGPRS QoS-Class-Identifier AVP Value\nR99 UMTS QoS parameters\nTraffic Class\nTHP\nSignalling Indication\nSource Statistics Descriptor\n1\nConversational\nn/a\nn/a\nspeech(NOTE)\n2\nConversational\nn/a\nn/a\nunknown\n3\nStreaming\nn/a\nn/a\nspeech(NOTE)\n4\nStreaming\nn/a\nn/a\nunknown\n5\nInteractive\n1\nYes\nn/a\n6\nInteractive\n1\nNo\nn/a\n7\nInteractive\n2\nNo\nn/a\n8\nInteractive\n3\nNo\nn/a\n9\nBackground\nn/a\nn/a\nn/a\nNOTE:\tThe QCI values that map to \"speech\" should be selected for service data flows consisting of speech (and the associated RTCP) only.\nNOTE:\tThis table defines the mapping for GPRS QCI to/from UM3GPP TS QoS parameters for pre-release 8 GPRS. The characteristics of GPRS QCIs are independent from the standardized QCI characteristics for EPS.\nThe PCEF determines R97/98 attributes from R99 attributes according to 3GPP TS 23.107 [41].\nA.4.2\tGPRS ARP to UMTS ARP parameter mapping\nThe mapping of the Allocation-Retention-Priority AVP to the UM3GPP TS ARP parameter(s) is specified in clause B.3.3.3.\nAnnex B (normative):Access specific aspects, 3GPP (GERAN/UTRAN/E-UTRAN) EPS\nB.1\tScope\nThis annex defines access specific aspects procedures for use of Gx/Gxx between PCRF and a 3GPP EPC IP-CAN.\nB.2\tFunctional Elements\nB.2.1\tPCRF\nThere are no access specific procedures defined.\nB.2.2\tPCEF\nThere are no access specific procedures defined.\nB.2.3\tBBERF\nThere are no access specific procedures defined.\nB.3\tPCC procedures\nB.3.1\tRequest for PCC and/or QoS rules\nThis procedure is defined in clauses 4.5.1 and 4a.5.1 the following specifics.\nInformation about the support of network-initiated bearer procedures for the IP-CAN session shall be provided via the Gx reference point.\nThe PCEF shall always include the RAT-Type as part of the IP-CAN Session Establishment procedure.\nFor GERAN and UTRAN accesses:\n-\tWhen the UE requests to modify the bearer QoS without specifying any TFT filter the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\", and shall include within the CC-Request:\n-\tone Packet-Filter-Information AVP with only the Packet-Filter-Identifier AVP, set to the value for each of the packet filter(s) created by the UE. If BCM is MS-only, the PCEF shall include all the packet filter identifier(s) previously assigned on Gx for this EPS bearer within the Packet-Filter-Identifier AVP. If BCM is MS/NW, the PCEF shall also include the SDF filter identifier(s) that correspond to the packet filter identifier(s) in the parameter list of the TFT within the Packet-Filter-Identifier AVP; and\n-\tthe QoS-Information AVP to indicate the requested QoS for the affected packet filters; and\n-\tif there is no packet filter set by the network on the same bearer, the QoS-Information AVP may indicate an updated QCI.\n-\tWhen the UE requests to add filters to an existing TFT, the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\", and shall include within the CC-Request the request:\n-\tone Packet-Filter-Information AVP for each for each packet filter requested for addition without any Packet-Filter-Identifier AVP; and\n-\tone Packet-Filter-Information AVP for each of the existing filter(s), created by the UE, with the Packet-Filter-Identifier AVP and without any filter attributes used for matching; and\n-\tthe QoS-Information AVP to indicate the requested QoS for the affected PCC rules.\nFor GERAN and UTRAN access, the relationship between the TFT operation requested by MS and the Gx operation provided by PCEF to PCRF is as follows:\n-\tIf the TFT operation is \"Replace packet filters in existing TFT\", the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\".\n-\tIf the TFT operation is \"Delete packet filters from existing TFT\", the PCEF shall set the Packet-Filter-Operation AVP to \"DELETION\".\n-\tIf the TFT operation is \"Add packet filters to existing TFT\", the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\".\n-\tIf the TFT operation is \"Create new TFT\", the PCEF shall set the Packet-Filter-Operation AVP to \"ADDITION\".\n-\tIf the TFT operation is \"Delete existing TFT\", the PCEF shall set the Packet-Filter-Operation AVP to \"DELETION\".\n-\tIf the TFT operation is \"No TFT operation\" or the TFT is missing (allowed in BCM MS-only only, the PCEF shall set the Packet-Filter-Operation AVP to \"MODIFICATION\".\nFor GERAN and UTRAN accesses, the PCRF shall provide packet filters in the PCC rule as received in the Packet-Filter-Information AVP for each packet filter requested by the UE.\nFor GERAN and UTRAN accesses, if the PCRF receives a request for addition of service data flow(s) with a reference to existing packet filter identifiers (and by that to existing PCC rule(s)), the PCRF shall update the existing PCC rule for the new service data flow(s) without changing the QCI and ARP.\nNOTE:\tThe reference to an existing packet filter identifiers informs the PCRF that the request is confined to an existing bearer, having bearer bindings with PCC rules that have the same QCI/ARP combination. Assigning a different QCI or ARP to the new service data flows would cause the procedure to fail, since the PCEF cannot map the new service data flows to another bearer.\nFor GERAN and UTRAN accesses, when BCM is MS-only and the UE requests to create a TFT for a PDP context without a TFT created by the PDP Context Activation Procedure, the PCRF shall authorize a PCC rule which contains the packet filters as requested by the UE when receiving the CCR request from the PCEF. The PCEF shall install the PCC rule provisioned by the PCRF, shall deactivate/remove the activated PCC rules that were previously activated/installed by the PCRF and were bound to the same bearer, and shall send a CCR command to the PCRF with CC-Request-Type AVP set to the value \"UPDATE_REQUEST\", including the Charging-Rule-Report AVP specifying the deactivated/removed PCC rules with the PCC-Rule-Status set to inactive and including the Rule-Failure-Code AVP assigned to the value NO_BEARER_BOUND (15).\nFor GERAN and UTRAN accesses, when BCM is MS-only and the UE requests to delete the existing TFT, the PCRF should provide at least one new PCC rule to be installed at the same time when the PCC rule corresponding to the TFT is removed.\nFor E-UTRAN accesses with UE initiated resource modification procedure, the PCRF shall either authorize the same QoS as requested QoS within the QoS-Information AVP or reject the request if the requested QoS can not be authorized. The PCRF may reject the request using a CC-Answer with the Gx experimental result code DIAMETER_ERROR_INITIAL_PARAMETERS (5140). If the PCEF receives a CC-Answer with this code, the PCEF shall reject the IP-CAN session modification that initiated the CC-Request.\nB.3.2\tProvisioning of PCC and/or QoS rules\nFor GTP-based 3GPP accesses, the PCRF may request the establishment of a bearer dedicated to IMS signalling by providing the applicable PCC rules to the PCEF.\nFor PMIP-based 3GPP accesses, the PCRF may request the establishment of a bearer dedicated to IMS signalling by providing the applicable QoS rules to the BBERF.\nWhen the PCEF includes the Bearer-Usage AVP required for the default bearer within the CCR command during the IP-CAN session establishment procedure, the PCRF shall provide the Bearer-Usage AVP back in the response with the authorized usage.\nIf during IP-CAN session establishment procedure, the PCEF includes IMS_SIGNALLING within the Bearer-Usage AVP and the PCRF accepts that default bearer is dedicated to IMS signalling, the PCRF shall include the IMS_SIGNALLING within the Bearer-Usage AVP. In this case, the PCRF shall restrict the bearer to only be used for IMS signalling as specified in 3GPP TS 23.228 [31] by applying the applicable QCI for IMS signalling.\nIf the PCEF include the IMS_SIGNALLING within the Bearer-Usage AVP in the CCR command, but the PCRF does not include the IMS_SIGNALLING within the Bearer-Usage AVP in the CCA command, the PCC Rules provided by the PCRF shall have a QCI value different from the QCI value for the IMS signalling.\nWhen UE initiates a resource modification request, if the PCEF includes the Bearer-Usage AVP indicating IMS_SIGNALLING and the PCRF accepts that a bearer dedicated to IMS signalling shall be used, the PCRF shall return the IMS_SIGNALLING within the Bearer-Usage AVP. The provided PCC rules shall have the QCI applicable for IMS signalling.\nDuring the IP-CAN session establishment, the PCEF shall not provide packet filters to UE on the default bearer in the IP-CAN session establishment response, referring to 3GPP TS 29.274 [22].\nB.3.3\tProvisioning and Policy Enforcement of Authorized QoS\nB.3.3.1\tProvisioning of authorized QoS per APN\nThe PCRF shall provision the authorized unconditional APN policy information and may provision the authorized conditional APN policy information as part of the IP-CAN session establishment procedure. The PCRF may also provide QoS per APN with time conditions.\nB.3.3.2\tPolicy enforcement for authorized QoS per APN\nThere are no access specific procedures defined.\nB.3.3.3\tQoS handling for interoperation with Gn/Gp SGSN\nWhen the PCEF receives the establishment or modification of an IP-CAN bearer from a Gn/Gp SGSN, the PCEF shall derive the requested QoS information in the CC-Request command following the mapping rules included in 3GPP TS 23.401 [32] Annex E as follows:\n-\tGuaranteed-Bitrate-UL AVP and Guaranteed-Bitrate-DL AVP shall be obtained from the bearer parameter GBR received within the PDP-Context.\n-\tIf APN-AMBR is not received within the initial PDP-Context for the IP-CAN session, the APN-Aggregate-Max-Bitrate-UL AVP and APN-Aggregate-Max-Bitrate-DL AVP shall be mapped from the bearer parameter MBR received within the PDP-Context. If APN-AMBR is received as a part of the initial PDP Context for the IP-CAN session, it shall be included within the APN-Aggregate-Max-Bitrate-UL AVP and APN-Aggregate-Max-Bitrate DL AVP. When the PCEF receives a request for modification of the MBR for the initial PDP context or any non-GBR PDP context, the PCEF shall take the common flags \"Upgrade QoS Supported\" and \"No QoS negotiation\" described down below in to consideration and act accordingly.\n-\tDefault-EPS-Bearer-QoS AVP shall be derived based on the QoS bearer parameters included in the initial PDP-Context received for the IP-CAN session. When the PCEF receives a request for modification of the initial PDP context that modifies either the QoS-Class-Identifier AVP or Allocation-Retention-Priority AVP, the modified values shall be provided as part of the Default-EPS-Bearer-QoS AVP.\n-\tAllocation-Retention-Priority AVP shall be mapped one-to-one from the Evolved ARP if this parameter is included within the PDP Context. Otherwise, it will be derived as follows:\n-\tThe Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP shall be set based on operator policies.\n-\tThe Priority-Level AVP is derived as described in table B.3.3.3.1:\nTable B.3.3.3.1: Mapping of ARP to Priority-Level AVP\nARP Value\nPriority-Level AVP\n1\n1\n2\nH+1\n3\nM+1\nNOTE 1:\tThe values of H (high priority) and M (medium priority) can be set according to operator requirements to ensure proper treatment of users with higher priority level information. The minimum value of H is 1. The minimum value of M is H+1.\n-\tQoS-Class-Identifier AVP may be derived based on table B.3.3.3.2:\nTable B.3.3.3.2: Mapping between standardized QCIs and R99 UMTS QoS parameter values\nQoS-Class-Identifier AVP value\nR99 UMTS QoS parameters\nTrafficClass\nTrafficHandlingPriority\nSignallingIndication\nSourceStatisticsDescriptor\n1\nConversational\nN/A\nN/A\nSpeech\n2\nConversational\nN/A\nN/A\nUnknown (NOTE 1)\n3\nConversational\nN/A\nN/A\nUnknown (NOTE 2)\n4\nStreaming\nN/A\nN/A\nUnknown (NOTE 3)\n5\nInteractive\n1\nYes\nN/A\n6\nInteractive\n1\nNo\nN/A\n7\nInteractive\n2\nNo\nN/A\n8\nInteractive\n3\nNo\nN/A\n9\nBackground\nN/A\nN/A\nN/A\nNOTE 1:\tWhen QCI 2 is mapped to UMTS QoS parameter values, the Transfer Delay parameter is set to 150 ms. When UMTS QoS parameter values are mapped to a QCI, QCI 2 is used for conversational/unknown if the Transfer Delay parameter is greater or equal to 150 ms.\nNOTE 2:\tWhen QCI 3 is mapped to UMTS QoS parameter values, the Transfer Delay parameter is set to 80 ms as the lowest possible value. When UMTS QoS parameter values are mapped to a QCI, QCI 3 is used for conversational/unknown if the Transfer Delay parameter is lower than 150 ms.\nNOTE 3:\tWhen QCI 4 is mapped to UMTS QoS parameter values, it is mapped to Streaming/Unknown. When UMTS QoS parameter values are mapped to a QCI, Streaming/Unknown and Streaming/Speech are both mapped to QCI 4.\nThe PCEF determines R97/98 attributes from R99 attributes according to 3GPP TS 23.107 [41].\nThe PCRF shall provide the authorized QoS information according to clause 4.5.5.2 (when the authorized QoS applies to the service data flow), clause 4.5.5.8 (when the authorized QoS applies at APN level) or 4.5.5.9 (when the authorized QoS applies to the default bearer).\nWhen the PCEF receives the authorized QoS information applicable for the service data flow, the PCEF shall act according to clause 4.5.5.3. The PCEF shall then derive the QoS information of the PDP context from the calculated authorized QoS as follows:\n-\tFor non-GBR bearers, if APN-AMBR parameter was not received in the initial PDP context for the IP-CAN session, the bearer parameter MBR shall be set to the value of the authorized APN-Aggregate-Max-Bitrate-UL and APN-Aggregate-Max-Bitrate-DL AVPs. For GBR-bearers the MBR and GBR of the PDP-Context shall be mapped one-to-one from the MBR and GBR values calculated for that bearer according to clause 4.5.5.3.\n-\tThe Allocation-Retention-Priority AVP received as part of the PCC Rule shall be used to bind the PCC rules to the corresponding bearer. If the SGSN supports the Evolved ARP parameter (i.e. it was received as part of the PDP contexts) the Evolved ARP for the PDP context shall be mapped one-to-one from the Allocation-Retention-Priority AVP assigned to the corresponding bearer. If the SGSN does not support Evolved ARP parameter, the P-GW shall ignore the Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP when deriving the ARP of the PDP Context.\nThe ARP parameter is derived as described in table B.3.3.3.3:\nTable B.3.3.3.3: Mapping of Priority-Level AVP to ARP\nPriority-Level AVP\nARP value\n1 to H\n1\nH+1 to M\n2\nM+1 to 15\n3\nNOTE 2:\tThe values of H (high priority) and M (medium priority) can be set according to operator requirements to ensure proper treatment of users with higher priority level information. The minimum value of H is 1. The minimum value of M is H+1.\n-\tThe P-GW shall bind only PCC rules with the same ARP setting (Priority-Level AVP, Pre-emption-Capability AVP and Pre-emption-Vulnerability AVP) to the same PDP context to enable modification of the bearer ARP without impacting the assignment of services to bearers after a handover to E-UTRAN.\nNOTE 3:\tWhen Evolved ARP parameter is not received as part of the PDP-Context, any change of the bearer ARP parameter may get overwritten by the SGSN due to subscription enforcement.\n-\tThe PCEF may derive the Traffic Class, Traffic Handling Priority, Signalling Indication and Source Statistics Descriptor from the QoS-Class-Identifier AVP based on the table B.3.3.3.2. The standardized QCI characteristics may be derived from the QoS-Class-Identifier AVP according to table 6.1.7 in 3GPP TS 23.203 [7]. The derivation of other values received as part of the QoS-Class-Identifier AVP shall be performed as defined in 3GPP TS 23.401 [32], Annex E.\nCommon flags \"Upgrade QoS Supported\" and \"No QoS negotiation\" shall be handled as follows.\n-\tWhen the PCEF receives a Create PDP context request, the PCEF shall derive the QoS information according to the mapping procedures described in this clause and it shall check whether the \"Upgrade QoS Supported\" flags are present. The following procedures shall apply.\n-\tIf the \"Upgrade QoS Supported\" flag is set to \"1\" in the Common Flag Information Element within the Common Flag IE (3GPP TS 29.060 [18]), normal procedures apply.\n-\tIf the \"Upgrade QoS Supported\" flag is set to \"0\" or if it is absent, the PCEF shall contact the PCRF including the requested QoS information derived following the mapping rules described in this clause. When the PCEF derives the authorized UM3GPP TS QoS information received from the PCRF according to the mapping procedures described in this clause, it shall check\n-\tWhether the authorized GBR, MBR or APN-AMBR is equal to or higher than the GBR, MBR or APN-AMBR requested from the GnGp SGSN. If it is so, the PCEF shall accept the requested values. Otherwise the PCEF shall accept the authorized values.\n-\tWhether the authorized ARP priority level is equal to or higher than the ARP priority level requested from the GnGp SGSN. If it is so, the PCEF shall accept the requested priority value. Otherwise the PCEF shall accept the authorized values.\nNOTE 4:\tThe ARP priority level attribute represents the actual priority for the service/user with the value 1 as the highest.\nNOTE 5:\tWhether the QCI is permitted to be changed or not is subject to operator policies and normal restrictions on changing from a Non-GBR QCI value to GBR QCI value on a default bearer.\nNOTE 6:\tWhether the Pre-emption capability and Pre-emption vulnerability are permitted to be changed or not is subject to operator policies.\n-\tWhen the PCEF receives an Update PDP context request, the PCEF shall derive the QoS information according to the mapping procedures described in this clause and it shall check whether the \"No QoS negotiation\" flag and the \"Upgrade QoS Supported\" flags are present. The following procedures shall apply.\n-\tIf the \"Upgrade QoS Supported\" flag set to \"1\" and the \"No QoS negotiation\" flag set to \"0\" or is absent, normal procedures apply with the following exceptions when only MBR is changed:If the derived MBR is equal to or less than the authorized APN-AMBR for the IP-CAN session, the PCEF shall accept the requested QoS values without interacting with the PCRF. If the derived MBR is higher than the last authorized APN-AMBR for the IP-CAN session, the PCEF shall send a MBR equal to the authorized APN-AMBR in the Update PDP context response without interacting with the PCRF, i.e. the PCEF does not report the QOS_CHANGE event trigger to the PCRF.\n-\tIf the \"No QoS negotiation\" flag is set to \"1\" in the Common Flag Information Element (3GPP TS 29.060 [18]), and the derived QCI and/or ARP is different from the QCI and/or ARP authorized for that bearer, the PCEF shall reject the procedure. Otherwise, the next procedure shall apply.\n-\tIf the \"No QoS negotiation\" flag is set to \"1\", if the derived MBR or APN-AMBR is equal to or less than the authorized APN-AMBR for the IP-CAN session, the PCEF shall accept the requested QoS values without interacting with the PCRF. If the derived MBR or APN-AMBR is higher than the authorized APN-AMBR for the IP-CAN session, the PCEF shall reject the requested QoS change. If the GBR is different from the authorized GBR, the PCEF shall reject the requested QoS change.\n-\tIf the \"Upgrade QoS Supported\" flag set to \"0\" in the Common Flag Information Element or if the corresponding bit within the Common Flag IE is absent (3GPP TS 29.060 [18]), and the \"No QoS negotiation\" flag is set to \"0\" or is absent, the PCEF shall behave in the same way as when the \"Upgrade QoS supported\" flag set to \"0\" is received in the Create PDP Context request procedure with the following exceptions when only MBR is changed:If the derived MBR is equal to or less than the last authorized APN-AMBR for the IP-CAN session, the PCEF shall accept the requested QoS values without interacting with the PCRF. If the derived MBR is higher than the authorized APN-AMBR for the IP-CAN session, the PCEF shall send a MBR equal to the authorized APN-AMBR in the Update PDP context response without interacting with the PCRF, i.e. the PCEF does not report the QOS_CHANGE event trigger to the PCRF.\nWhen the PCEF receives the authorized QoS information applicable for the default bearer as part of the Default-EPS-Bearer-QoS AVP, the PCEF shall then derive the QoS information corresponding to the initial PDP Context from the QoS-Class-Identifier AVP and Allocation-Retention-Priority AVP, following the same derivation rules as when the QoS information is received as part of the PCC Rule.\nWhen the PCEF receives the authorized QoS information applicable for the APN, the PCEF shall act according to clause 4.5.5.8. The PCEF shall modify the MBR for the PDP contexts with Traffic Class 'Interactive' and 'Background'.\nWhen the PCEF receives the Secondary PDP Context Activation command, the PCEF shall derive the QoS information and packet filter information, and interact with PCRF by applying the UE initiated resource modification procedure as specified in clause 4.5.1.\nB.3.3.4\tVoid\nB.3.3.5\tPolicy provisioning for authorized QoS per service data flow\nFor the authorization of a PCC rule with a GBR QCI the PCRF shall assign a GBR value within the limit supported by the serving network (i.e. GERAN/UTRAN). The PCRF shall subscribe the RAT_CHANGE event to get the RAT type information for PCC rule authorization.\nNOTE:\tFor the authorization of PCC Rules with the same QCI the PCRF may also check that aggregated GBR is within the limits supported by the serving network to minimize the risk of rejection of the bearer by the serving network.\nB.3.3.6\tPolicy enforcement for authorized QoS of the Default EPS Bearer\nThe procedures defined in clause 4.5.5.10 apply.\nWhenever the PCRF modifies the Authorized QoS of the default bearer, the PCRF shall simultaneously modify the QCI and/or ARP of all PCC/QoS Rules that, according to the operator policy, shall have the same QoS as the default bearer. The PCEF/BBERF shall re-evaluate the bearer binding procedure defined in clause 5.4 in the 3GPP TS 29.213 [8] taking into account the default bearer QoS change and any PCC/QoS Rule operation requested by the PCRF.\nNOTE2:\tThe network configuration can ensure that at least one PCC/QoS Rule is bound to the default bearer by applying either operator policies in the PCRF ensuring that a PCC/QoS Rule with matching QoS will be active or in the PCEF/BBERF ensuring that a predefined PCC/QoS Rule not known to the PCRF is bound to the default bearer.\nB.3.4\tPacket-Filter-Information AVP\nIn addition to the definition of the Packet-Filter-Information AVP in clause 5.3.55, for E-UTRAN the Packet-Filter-Information AVPs shall be derived from the information defined in 3GPP TS 24.008 [13].\nB.3.5\tBearer Control Mode Selection\nBearer Control Mode Selection shall take place via the Gx reference point according to clause 4.5.10.\nB.3.6\tTrace activation/deactivation at P-GW\nIn case of a PMIP-based 3GPP access the S-GW sends the trace activation and deactivation to the P-GW via the PCRF. To activate the trace, the S-GW sends the Trace Information to the PCRF in a CCR message within a Trace-Data AVP and with an Event-Trigger AVP containing the value PGW_TRACE_CONTROL. The PCRF sends the Trace-Data and Event-Trigger AVPs within an Event-Report-Indication AVP further to the P-GW in a CCA message (upon IP-CAN session establishment) or RAR message. To deactivate the trace, the S-GW sends the Trace Reference to the PCRF in a CCR message within a Trace-Reference AVP and with an Event-Trigger AVP containing the value PGW_TRACE_CONTROL. The PCRF sends the Trace-Reference and Event-Trigger AVPs within an Event-Report-Indication AVP further to the P-GW in a RAR message.\nB.3.7\tIMS Restoration Support\nThe procedure described in clause 4.5.18 applies and the monitoring procedure is defined in 3GPP TS 29.061 [11] Section 13a.2.2.1.\nB.3.8\tProvisioning of CSG information reporting indication\nThe PCRF may provide one or more CSG-Information-Reporting AVPs during IP-CAN/TDF session establishment and/or throughout the lifetime of the IP-CAN/TDF session, to request the PCEF/TDF to report the user CSG information change applicable for an IP-CAN/TDF session to the OFCS.\nNOTE:\tThe SPR can provide the Subscriber's User CSG Information reporting rules to the PCRF, the SPR's relation to existing subscriber databases is not specified in this Release.\nProvisioning of CSG information reporting indication to the TDF applies when ABC feature is supported.\nB.3.9\tPacket-Filter-Usage AVP\nNOTE:\tThe maximum number of packet filters sent to UE is limited as specified in 3GPP TS 24.008 [13].\nB.3.10\tUser CSG Information Reporting\nB.3.10.1\tGTP-based S5/S8\nThe procedure defined in clause A.3.20 is applied except that the PCEF should request the user CSG information change from the S-GW as defined in 3GPP TS 29.274 [22].\nB.3.10.2\tPMIP-based S5/S8\nThe S-GW may send user CSG information to the P-GW via the PCRF.\nDuring the IP-CAN Session Establishment, the S-GW may send the user CSG information to the PCRF in a CC-Request command within a User-CSG-Information AVP and the PCRF sends User-CSG-Information AVP in a CC-Answer command to the P-GW or in a TSR command to the TDF if the ABC feature is supported.\nThe P-GW or TDF if ABC feature is supported shall select and subscribe to the applicable event triggers USER_CSG_INFORMATION_CHANGE, USER_CSG_HYBRID_SUBSCRIBED_INFORMATION_CHANGE and/or USER_CSG_ HYBRID_UNSUBSCRIBED_INFORMATION_CHANGE within an Event-Report-Indication AVP for reporting from the BBERF via the PCRF if the corresponding credit re-authorization triggers are requested by the OCS. The PCRF shall subscribe to the event triggers for the highest level of detail required for the reporting within the user CSG information reporting rules and Event-Report-Indication AVP to the S-GW.\nThe S-GW reports that user CSG information has changed with the applicable values provided in the related Event-Trigger AVPs and, when applicable, the new user CSG information within the User-CSG-Information AVP.\nThe PCRF shall send the Event-Trigger AVPs and when applicable, the User-CSG-Information AVP within an Event-Report-Indication AVP to the P-GW/TDF in a RA-Request command.\nNOTE:\tThe PCEF/TDF reports the user CSG information to the OFCS on the level of detail as requested by the PCRF within the CSG-Information-Reporting AVPs and reports the user CSG information to the OCS on the level of detail as requested by the OCS re-authorization triggers.\nB.3.11\tRequest of IP-CAN Bearer Termination\nFor PMIP-based 3GPP accesses, if the IP-CAN bearer termination is caused by the PS to CS handover, the BBERF reports related QoS rules for this IP-CAN bearer by including the Rule-Failure-Code AVP set to the value PS_TO_CS_HANDOVER as part of the Gateway Control Session Modification procedure.\nFor GTP-based 3GPP accesses, if the IP-CAN bearer termination is caused by the PS to CS handover, the PCEF reports related PCC rules for this IP-CAN bearer by including the Rule-Failure-Code AVP set to the value PS_TO_CS_HANDOVER as part of the IP-CAN session modification procedure.\nB.3.12\tCS to PS handover\nIn order to support CS to PS handover according to 3GPP TS 23.216 [40], the PCRF shall ensure that voice media may use the default bearer until the appropriate bearer has been established.\nIf the operator policy requires a policy decision to be made in order to allow voice media on the default bearer, the PCRF shall subscribe to the CS_TO_PS_HANDOVER event trigger. Upon detection of CS to PS handover, the PCEF shall generate a CS_TO_PS_HANDOVER event. In response to the event the PCRF shall make policy decisions, for example provisioning or modifying the appropriate PCC rules, to allow voice media on the default bearer.\nNOTE 1:\tIf the PCRF provides dynamic PCC rules to be installed in the default bearer, the QoS-Class-Identifier AVP and Allocation-Retention-Priority AVP in the PCC rule(s) shall be respectively set to the same value as the ones of the default EPS bearer QoS information of the IP-CAN session.\nIf the PCRF received the first voice media authorized over Rx interface that corresponds to the voice session being transferred, the PCRF shall provide the corresponding PCC Rules and shall also subscribe to SUCCESSFUL_RESOURCE_ALLOCATION event trigger.\nIf the PCRF receives the SUCCESSFUL_RESOURCE_ALLOCATION event trigger for the first voice media authorized over Rx that corresponds to the voice session being transferred and the PCRF made policy decisions upon request of the CS_TO_PS_HANDOVER event, the PCRF should revoke that decision. In the case there were PCC Rules related to the voice media being transferred installed in the default bearer should be removed by the PCRF.\nNOTE 2:\tThere exists a very small possibility that another Rx session is established before or in parallel to the IMS voice session in transfer, i.e. due to a terminating voice session request. It is considered that this can be avoided by implementation and is therefore out of scope of standard.\nB.3.13\tPrecedence handling\nPCRF provides only one precedence value per PCC rule. For network initiated IP-CAN session modification, since one PCC rule may result in more than one TFT filters, the PCEF/BBERF has to ensure that each TFT filter is assigned unique precedence value across all TFT filters of the corresponding PDN connection (as specified in 3GPP TS 24.008 [13] and 3GPP TS 24.301 [42]). When two PCC rules result in two sets of TFT filters, the PCEF/BBERF shall also ensure that the relative precedence of the each set of TFT filters is same as the relative precedence of the corresponding PCC rule. E.g. if PCC rule R1 has higher precedence than PCC rule R2, all the TFT filters corresponding to R1 shall have higher precedence than all the TFT filters corresponding to R2.\nNOTE:\tThe maximum value of precedence of the TFT filter is limited as specified in 3GPP TS 24.008 [13].\nB.3.14\tS-GW Restoration Support\nDuring IP-CAN session establishment, if both the PCEF and PCRF advertise the support for S-GW restoration, the PCRF shall subscribe to the AN_GW_CHANGE event trigger.\nWhen the PCRF sends a RAR or CCA command with new policy decisions for a PDN connection maintained during a S-GW failure, the PCEF shall act as follows:\n-\tFor MME/S4-SGSN triggered S-GW Restoration scenarios:\nif the policy decisions were received in a RAR command, the PCEF shall send an RAA command with the Experimental-Result-Code set to DIAMETER_AN_GW_FAILED (4143) indicating the failure to enforce all those policy decisions.\nIf the installation/modification of one or more PCC rules fails the PCEF shall reject the procedure as described in clause 4.5.12. The Rule-Failure-Code AVP, for both PULL and PUSH modes shall be set to AN_GW_FAILED (17).\nIf the PCRF sends a CCA that includes policy decision not related to a PCC Rule (e.g. change of APN-AMBR), the PCEF shall send a CCR that includes the event trigger related with the failure to enforce the corresponding policy decision (as per the existing procedures) and the AN-GW-Status AVP set to AN_GW_FAILED (0).\n-\tFor P-GW triggered S-GW Restoration scenarios, the PCEF shall accept the procedure as per normal procedures. In the case, the PDN connection is not restored during an operator configured time period, the PCEF shall send a new CCR command when the related timer expires. If the RAR/CCA related to a PCC Rule procedure, the CCR shall include the Charging-Rule-Report AVP with the Rule-Failure-Code AVP set to RESOURCE_ALLOCATION_FAILURE and with the PCC-Rule-Status set to INACTIVE. If the RAR/CCA included policy decision not related to the PCC Rules (e.g. change of APN-AMBR), the CCR shall include the event trigger related with the failure to enforce the corresponding policy decision according to the current procedures.\nFor MME/S4-SGSN triggered S-GW Restoration scenarios, while the S-GW restoration is in progress, if the PCEF sends a CCR command towards the PCRF that is triggered by a different event (e.g. internal event at PCEF or Gy interface related event), the PCEF shall include the AN-GW-Status AVP set to AN_GW_FAILED (0).\nUpon reception of the Rule-Failure-Code set to AN_GW_FAILED (17) , AN-GW-Status set to AN_GW_FAILED (0) or a Experimental-Result-Code set to DIAMETER_AN_GW_FAILED (4143) the PCRF shall not initiate any IP-CAN Session Modification procedure, except if the IP-CAN Session Modification procedure is initiated for the PCC rule removal only, for the given IP-CAN session over Gx until the S-GW has recovered.\nIf the PCEF indicated AN_GW_FAILED previously according to the procedures described above, the PCEF shall inform the PCRF when the S-GW has recovered using the Event-Trigger AVP set to AN_GW_CHANGE and including the AN-GW-Address AVP related to the restored or new S-GW. The PCRF may after this update the PCEF with PCC Rules if necessary.\nNOTE 1:\tThe PCRF could reject requests from the AF and SPR when the Rule-Failure-Code set to AN_GW_FAILED (17) , the AN-GW-Status AVP set to AN_GW_FAILED (0) or the Experimental-Result-Code set to DIAMETER_AN_GW_FAILED (4143) is received until the Event-Trigger AVP set to AN_GW_CHANGE is received.\nThe PCEF shall maintain the PDN connections affected by the S-GW failure and eligible for restoration for an operator configurable time period (see 3GPP TS 23.007 [43]). Upon expiry of that time period, the PCEF shall release the PDN connection and inform the PCRF about the IP-CAN Session Termination as specified in clause 4.5.7.\nNOTE 2:\tThe PCRF is not aware of which PDN connections are eligible for restoration. When the PCEF detects a S-GW failure, the PCEF requests the PCRF to terminate IP-CAN sessions associated to PDN connections affected by the S-GW failure and not eligible for restoration.\nThe PCEF should maintain the GBR bearers of the PDN connections eligible for restoration for an operator configurable time period (see 3GPP TS 23.007 [43]). Upon expiry of that time period, the PCEF shall release GBR bearers that have not yet been restored and inform the PCRF about the PCC rule removal as specified in clause 4.5.6.\nThe PCEF shall discard downlink packets received for a PDN connection maintained during a S-GW failure that has not yet been restored.\nThe PCEF shall delete the PDN connection locally when it receives an IP-CAN session termination from the PCRF as described in clause 4.5.9.\nFor the PMIP-based 3GPP access, when the PCRF detects a BBERF failure or restart, the PCRF shall maintain the IP-CAN sessions and delete locally the Gateway Control sessions affected by the BBERF failure. In this case, if the PCRF receives a request from the AF or SPR that requires to modify the IP-CAN session and no error indication was received from the PCEF before, the PCRF may initiate the IP-CAN session modification towards the PCEF.\nNOTE 3:\tThe method the PCRF uses to determine that a BBERF has failed or restarted is not specified in this release.\nNOTE 4:\tThe PCRF can refrain from sending policy information within the RAR command since it is aware that the BBERF has failed or restarted via Gxx reference point. The PCRF will know that the BBERF has recovered when a new Gateway Control Session Establishment is received that is linked with the affected IP-CAN session.\nB.3.15\tReporting Access Network Information\nThe procedure described in clause 4.5.22 or clause 4a.5.16 applies.\nIn case of a GTP-based 3GPP access the P-GW provides the CGI/SAI/ECGI within the 3GPP-User-Location-Info AVP.\nIn case of a PMIP-based 3GPP access the S-GW provides the CGI/SAI/ECGI within the 3GPP-User-Location-Info AVP.\nIf the ACCESS_NETWORK_INFO_REPORT event trigger is set, upon installation, modification and removal of any PCC/QoS rule(s) containing the Required-Access-Info AVP the PCEF/BBERF shall send an appropriate \"Bearer Setup Request\", \"Update Bearer Request\" or \"Delete Bearer Request\". The response message will include the access network information to the PDN GW.\nNOTE:\tNo specific request for location information reporting is required within those request messages.\nB.3.16\tPresence Reporting Area Information reporting\nThe PCRF determines at IP-CAN session establishment, whether reports for change of UE presence in Presence Reporting Area are desired for the IP-CAN session based on the subscriber's profile configuration and the Supported-Features AVP indicating the value \"CNO-ULI\". If the reporting is desired for the IP-CAN session, the PCRF shall provide the Presence-Reporting-Area-Information AVP which contains the Presence Reporting Area Identifier within the Presence-Reporting-Area-Identifier AVP, and, for a UE-dedicated Presence Reporting Area, the list of elements composing the presence reporting area within the Presence-Reporting-Area-Elements-List AVP to the PCEF. The PCRF may activate the reporting changes of UE presence in Presence Reporting Area by subscribing to the CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT event trigger at the PCEF at any time during the lifetime of the IP-CAN session.\nNOTE 1:\tIf Presence Reporting Area reporting is not supported, the PCRF can instead activate location change reporting that reports actual location. Due to the potential increase in signalling load, careful consideration of the network load is necessary for such reporting, e.g. limiting the number of subscribers subject to such reporting.\nThe PCRF may also provide Presence-Reporting-Area-Identifier AVP within Presence-Reporting-Area-Information AVP via TSR command during the TDF session establishment. The TDF may request the notification of \"CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT (48)\" by including it in Event-Trigger AVP within Event-Report-Indication AVP via TSA or CCR command to indicate the PCRF to report the presence reporting area status change.\nWhen the UE enters or leaves the presence reporting area, the PCEF shall report the CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT event; additionally, the PCEF shall also report the presence reporting area status within the Presence-Reporting-Area-Status AVP and presence reporting area identifier within Presence-Reporting-Area-Identifier AVP included in Presence-Reporting-Area-Information AVP. If the TDF has requested the notification of the change of UE presence in Presence Reporting Area, the PCRF shall provide Presence-Reporting-Area-Information AVP within the Event-Report-Indication AVP via RAR command to the TDF.\nNOTE 2:\tThe PCRF may acquire the necessary data for presence reporting from the SPR. The SPR's relation to existing subscriber databases is not specified in this Release.\nNOTE 3:\tFor a given PDN connection, reporting for only one presence reporting area is specified in this Release.\nNOTE 4:\tHomogeneous support of Presence Area reporting in a network is assumed.\nNOTE 5:\tPresence Reporting Area reporting is not supported for case 2b in this release.\nThe PCRF may be notified during the lifetime of an IP-CAN session that the UE is located in an access network where local configuration indicates that the reporting change of UE presence in Presence Reporting Area is not supported. The PCRF may unsubscribe to the change of UE presence in Presence Reporting Area by providing the Event-Trigger AVP with removing the value CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT (48), if previously activated.\nThe PCEF shall de-activate the relevant IP-CAN specific procedure for reporting Change of UE presence in Presence Reporting Area, when the PCRF and OCS unsubscribe to change of UE presence in Presence Reporting Area.\nB.3.17\tMultiple Presence Reporting Area Information reporting\nWhen Multiple-PRA feature is supported, the PCRF may determine at any time during the lifetime of the IP-CAN session whether reports for change of UE presence in Presence Reporting Area(s) are desired for the IP-CAN session based on the subscriber's profile configuration. If the reporting is desired for the IP-CAN session, the PCRF shall provide the PRA-Install AVP including the Presence-Reporting-Area-Information AVP(s) which each contains the Presence Reporting Area Identifier within the Presence-Reporting-Area-Identifier AVP, and, for a UE-dedicated Presence Reporting Area and the list of elements composing the presence reporting area within the Presence-Reporting-Area-Elements-List AVP. If PCRF is configured with a Presence Reporting Area identifier referring to the list of Presence Reporting Area Identifier(s) within a Set of Core Network predefined Presence Reporting Areas as defined in 3GPP TS 23.401 [32], the PCRF shall include the identifier of the Presence Reporting Area set within the Presence-Reporting-Area-Identifier AVP.The PCRF shall activate the reporting changes of UE presence in Presence Reporting Area(s) by subscribing to the CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT event trigger at the PCEF.\nNOTE 1:\tIf this feature is not supported, the PCRF can instead activate location change reporting that reports actual location. Due to the potential increase in signalling load, careful consideration of the network load is necessary for such reporting, e.g. limiting the number of subscribers subject to such reporting.\nNOTE 2:\tThe Presence Reporting Area Identifier can correspond to a list of Presence Reporting Area Identifier(s) within a set of Core Network predefined Presence Reporting Areas (PRA set identifier) as defined in 3GPP TS 23.401 [32] if the PCRF is configured\nThe PCRF may modify the list of PRA Identifier(s) by providing the new Presence Reporting Areas within the PRA-Install AVP as described above and/or by removing existing Presence Reporting Area(s) within the PRA-Remove AVP. In this case, the Presence-Reporting-Area-Identifier AVP of the removed Presence Reporting Area shall be included within the Presence-Reporting-Area-Information AVP(s).\nThe PCRF may modify the list(s) of Presence Reporting Area elements. In that case, the PCRF shall provide the PRA-Install AVP including the Presence-Reporting-Area-Information AVP(s) which contains the Presence-Reporting-Area-Identifier AVP(s) for the affected Presence Reporting Area(s) and the Presence Reporting Area elements within the Presence-Reporting-Area- Elements-List AVP. All the contents related to the Presence Reporting Area shall be included in this case.\nThe PCRF may unsubscribe to the change of UE presence in Presence Reporting Area by providing the Event-Trigger AVP with removing the value CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT (48), if previously activated.\nIf the CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT event trigger is set, when the PCRF provides a list of presence reporting areas as described above, the PCRF shall ensure that the maximum number of provisioned Presence Reporting Area Identifiers is not exceeded. The maximum number of PRAs may be configured in the PCRF. The PCRF may have independent configuration of the maximum number for Core Network pre-configured PRAs and UE-dedicated PRAs.\nNOTE 3:\tFor all the Presence Reporting Area(s) provided by the PCRF, the PCEF can store the Presence Reporting Area Identifier(s) together with an indication that states that it relates to PCRF requested PRA status changes.\nNOTE 4:\tThis information is needed so that if both PCRF and OCS subscribe to reports of PRA status changes, the PCEF is able to differentiate whether the reported PRA changes are relevant to PCRF or OCS.\nThe PCEF shall initiate the appropriate IP-CAN specific procedure according to 3GPP TS 29.274 [22].\nWhen the PCEF receives the presence reporting area information from the serving node as defined in 3GPP TS 29.274 [22] indicating that the UE is inside or outside of one or more presence reporting areas or any of the presence reporting areas is set to inactive, the PCEF shall check if the reported presence reported area identifier corresponds to a presence reporting area that is relevant for the PCRF. In that case, the PCEF shall report the CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT event in the Event-Trigger AVP; additionally, the PCEF shall also report the presence reporting area status within the Presence-Reporting-Area-Status AVP and presence reporting area identifier within Presence-Reporting-Area-Identifier AVP included in Presence-Reporting-Area-Information AVP(s) for each of the presence reporting areas reported by the serving node.\nIf the PCEF receives additional presence reporting area information together with the PRA Identifier as described in 3GPP TS 29.274 [22], the PCEF shall only provide the PCRF with the presence reporting area information corresponding to the additional PRA information.\nNOTE 5:\tThe PCEF will receive additional presence reporting area information when the UE enters or leaves one or more presence reporting areas related to a PRA set. In that case, the additional presence reporting area information corresponds to the actual individual presence reporting area. The received presence reporting area identifier corresponds to the PRA set id and is used to identify the requester (PCRF or OCS) of the notification information.\nNOTE 6:\tThe PCRF can acquire the necessary data for presence reporting from the SPR. The SPR's relation to existing subscriber databases is not specified in this Release.\nNOTE 7:\tHomogeneous support of Presence Area reporting in a network is assumed.\nNOTE 8:\tPresence Reporting Area reporting is not supported for case 2b in this release.\nNOTE 9:\tThe serving node can activate the reporting for the PRAs which are inactive as described in the 3GPP TS 23.401 [32].\nThe PCRF may be notified during the lifetime of an IP-CAN session that the UE is located in an access network where local configuration indicates that the reporting change of UE presence in Presence Reporting Area is not supported. The PCRF may unsubscribe to the change of UE presence in Presence Reporting Area by providing the Event-Trigger AVP with the value CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT (48) omitted, if previously activated.\nThe PCEF shall de-activate the relevant IP-CAN specific procedure for reporting Change of UE presence in Presence Reporting Area, when the PCRF and OCS unsubscribe to change of UE presence in Presence Reporting Area.\nB.3.18\tRAN Information Support\nIf RAN-Support-Info feature or CHEM feature are enabled, the PCRF may provide, for PCC rules with QCI of 1, the Charging-Rule-Definition AVP including the downlink maximum packet loss rate within the Max-PLR-DL AVP and/or the uplink maximum packet loss rate within the Max-PLR-UL AVP.\nUpon receipt of the Max-PLR-DL AVP and/or Max-PLR-UL AVP from the PCRF, the PCEF shall set the downlink and/or uplink maximum packet loss rate value(s) to the lowest one for each direction among all of the values sharing the QCI=1 bearer.\nAnnex C (Informative):Mapping table for type of access networks\nTable C-1 maps the values of the IANA registered Access Technology Types used for PMIP in 3GPP TS 29.275 [28] with the values of the RAT types specified for GTPv2 in 3GPP TS 29.274 [22] and with the values of the RAT types and IP-CAN types specified in this specification.\nTable C-1: Mapping table for type of access network code values\nAccess Technology Type registered with IANA, seeTS 29.275 [28]\nPCC related RAT-Type, seeclause 5.3.31\nRAT-Type specified for GTPv2, see TS 29.274 [22]\nIP-CAN-Type, seeclause 5.3.27\n(NOTE 1 and 2)\nValue\nDescription\nValue\nDescription\nValue\nDescription\nValue\nDescription\n0\nReserved\n0\n<reserved>\n1\nVirtual\n1\nVIRTUAL\n7\nVirtual\n6\nNon-3GPP-EPS\n2\nPPP\n3\nIEEE 802.3\n4\nIEEE 802.11a/b/g\n0\nWLAN\n3\nWLAN\n6\nNon-3GPP-EPS\n5\nIEEE 802.16e\n6\n3\nNon-3GPP-EPS\nWiMAX\n6\n3GPP GERAN\n1001\nGERAN\n2\nGERAN\n0\n3GPP-GPRS\n5\n3GPP-EPS\n7\n3GPP UTRAN\n1000\nUTRAN\n1\nUTRAN\n0\n3GPP-GPRS\n5\n3GPP-EPS\n8\n3GPP E-UTRAN\n1004\nEUTRAN (NOTE 3)\n6\nEUTRAN (WB-E-UTRAN)\n5\n3GPP-EPS\n9\n3GPP2 eHRPD\n2003\nEHRPD\n6\nNon-3GPP-EPS\n10\n3GPP2 HRPD\n2001\nHRPD\n4\n3GPP2\n11\n3GPP2 1xRTT\n2000\nCDMA2000_1X\n4\n3GPP2\n12\n3GPP2 UMB\n2002\nUMB\n4\n3GPP2\n13\n3GPP NB-IOT\n1005\nEUTRAN-NB-IoT\n8\nEUTRAN-NB-IoT\n5\n3GPP-EPS\n14-255\nUnassigned\n1002\nGAN\n4\nGAN\n0\n3GPP-GPRS\n5\n3GPP-EPS\n1003\nHSPA_EVOLUTION\n5\nHSPA Evolution\n0\n3GPP-GPRS\n5\n3GPP-EPS\n1\nDOCSIS\n2\nxDSL\n7\nFBA\nNOTE 1:\tThe mapping of RAT-Type and Access Technology Type parameters to IP-CAN-Type depends on the packet core the radio access network is connected to. Possible mappings are listed in the IP-CAN-Type column.\nNOTE 2:\tWhen the RAT-Type is GERAN, UTRAN or HSPA Evolution connecting P-GW, it shall be mapped to 3GPP-EPS. When connected to GGSN, it shall be mapped to 3GPP-GPRS.\nNOTE 3:\tThe RAT-Type EUTRAN represents WB-EUTRAN.\nAnnex D (normative):Access specific aspects (EPC-based Non-3GPP)\nD.1\tScope\nThis annex defines access specific procedures for use of Gxx between PCRF and a Non-3GPP access connected to EPC. Gx interface applies between the PCRF and the PCEF and shall follow the procedures within the main body of this specification.\nIf an EPC-based non-3GPP access (3GPP TS 23.402 [23]) requires Gxx for dynamic QoS control then it shall include the BBERF. The allocation of a BBERF to a node within the non-3GPP IP‑CAN is out of 3GPP scope, unless otherwise specified in this Annex.\nD.2\tEPC-based eHRPD Access\nD.2.1\tGeneral\nIn case of EPC-based eHRPD access the BBERF is located in the HRPD Serving Gateway (HSGW) as defined in 3GPP2 X.S0057 [24].\nThe HSGW of an EPC-based eHRPD access that supports a Gxa interface shall support all the Gxa procedures defined in this specification.\nDuring the pre-registration phase in case of optimised EUTRAN-to-HRPD handovers, the Serving GW and the HSGW are associated with the IP‑CAN session(s) of the UE in the PCRF. The HSGW is the non-primary BBERF.\nD.2.2\tGxa procedures\nD.2.2.1\tRequest for QoS rules\nThe procedures specified in clause 4a.5.1 apply with the following additions.\nIf the BBERF in HSGW is being requested via IP-CAN specific signaling not to establish the Gateway Control session, the BBERF shall not establish the Gateway Control session.\nNOTE 1:\tWhen the Gateway Control Session is not used, certain functions such as location information report, APN-AMBR update and dedicated bearer establishment are impacted.\nNOTE 2:\tThe decision to not establish the Gateway Control session applies for the life time of the IP-CAN session.\nNOTE 3:\tThe indicator to not establish the Gateway Control session is configured in the HSS. It is delivered to the BBERF within the Charging Characteristics. The indicator is operator specific, therefore it can only be used in non-roaming cases.\nAt gateway control session establishment as described in clause 4a.5.1, the information about the radio access technology shall be provided. The BBERF includes also the BSID if available. If information about the support of network-initiated QoS procedures is available, the Network-Request-Support AVP shall be provided.\nWhen the PCRF receives a CCR command with the CC-Request-Type set to the value \"INITIAL_REQUEST\", the IP-CAN-Type AVP set to the value \"Non-3GPP-EPS\", the RAT-Type AVP set to the value \"EHRPD\" from a new BBERF and at least one Gateway Control Session for the same user identity and PDN ID exists, and if the UE has acquired an IPv6 prefix via the 3GPP access, the PCRF shall provide the IPv6 prefix of the UE to the BBERF by including the Framed-Ipv6-Prefix AVP in the CCA command.\nNOTE 4\tIn order to allow the PCRF to link the new Gateway Control session to a Gx session based on the information received in the CCR command, it is assumed that there is only a single IP-CAN session per PDN ID and user identity.\nWhen UE requests the establishment or modification of resources, the BBERF shall map the requested QoS information to the QoS-Information AVP following the guideline described in clause D.2.4.\nD.2.2.2\tProvisioning of QoS rules\nD.2.2.2.1\tQoS rule request for services not known to PCRF\nWhen the PCRF receives a request for QoS rules while no suitable authorized PCC/QoS rules are configured in the PCRF, and if the user is not allowed to access AF session based services but is allowed to request resources for services not known to the PCRF, to the procedures specified in clause 4.5.2.0 apply. In addition, the PCRF may downgrade the bitrate parameters and the QCI according to operator policies when authorizing the request.\nD.2.2.3\tProvisioning and Policy Enforcement of Authorized QoS\nD.2.2.3.1\tProvisioning of authorized QoS\nWhen receiving a CCR with a QoS-Information AVP, the PCRF shall decide upon the requested QoS information within the CCR command.\n-\tThe PCRF may compare the authorized QoS derived according to clause 6.3 of 3GPP TS 29.213 [8] with the requested QoS for the service data flow. If the requested QoS is less than the authorised QoS, the PCRF may either request to upgrade the IP CAN QoS by supplying that authorised QoS in the QoS-Information AVP within the QoS-Rule-Definition AVP to the BBERF (e.g. if the PCRF has exact knowledge of the required QoS for the corresponding service), or the PCRF may only authorise the requested QoS by supplying the requested QoS in the QoS-Information AVP within the QoS-Rule-Definition AVP to the BBERF (e.g. if the PCRF only derives upper limits for the authorized QoS for the corresponding service data flow). If the requested QoS is higher than the authorised QoS, the PCRF shall downgrade the IP CAN QoS by supplying the authorised QoS in the QoS-Information AVP within the QoS-Rule-Definition AVP to the BBERF.\nThe PCRF may decide to modify the authorized QoS at any time. The PCRF shall send an unsolicited authorization to the BBERF as described in 4a.5.2. If the trigger to modify the authorized QoS comes from the AF, before starting an unsolicited provisioning, the PCRF may start a timer to wait for a UE requested corresponding QoS modification. At the expiry of the timer, if no QoS rule request has previously been received by the PCRF, the PCRF should go on with the unsolicited authorization as explained above.\nD.2.2.3.2\tPolicy enforcement for authorized QoS\nThe procedures as described in 4a.5.10 apply with the following additions.\nUpon reception of an authorized QoS within a CCA or RAR command, the BBERF shall perform the mapping from that \"Authorised QoS\" information into authorised access specific QoS information according to guidelines described in clause D.2.4.\nWhen the BBERF receives an unsolicited authorisation decision from the PCRF (i.e. a decision within a RAR) with updated QoS information, the BBERF shall update the stored authorised QoS. If the existing QoS of the IP-CAN bearer does not match the updated authorised QoS the BBERF shall perform a network initiated QoS modification to adjust the QoS to the authorised level.\nD.2.3\tBearer Control Mode selection\nBearer Control Mode selection shall take place via Gxa reference point to the HSGW.\nThe HSGW shall only include the Network-Request-Support AVP if it supports this the network-initiated bearer setup procedure and the UE has previously indicated to the HSGW that the UE also support it.\nThe PCRF derives the selected Bearer-Control-Mode AVP based on the received Network-Request-Support AVP, access network information, subscriber information and operator policy. The PCRF selects the same Bearer Control Mode for all PDN connections from a UE to the same APN. The selected Bearer-Control-Mode AVP shall be provided to the HSGW using the QoS rule provision procedures at Gateway control session establishment.\nThe BCM selection procedure may also be triggered as a consequence of a change of HSGW.\nThe values defined in 5.3.23 for the Bearer-Control-Mode AVP apply with the following meaning:\nUE_ONLY (0)\nThis value is used to indicate that the UE shall request any additional resource establishment.\nRESERVED (1)\nThis value is not used in this Release.\nUE_NW (2)\nThis value is used to indicate that both the UE and the BBERF may request any additional bearer establishment and add additional traffic mapping information to an existing bearer.\nD.2.4\tQoS Mapping\nD.2.4.1\tQCI to eHRPD QoS parameter mapping\nThe mapping of QCI to eHRPD QoS parameters follows the guidelines described 3GPP2 X.S0057 [24].\nD.3\tEPC-based Trusted WLAN Access with S2a\nFor EPC-based trusted WLAN Access with S2a, the PCEF is located in the P-GW and the BBERF does not apply.\nNOTE:\tGxa interface is not used for S2a-PMIP in Trusted WLAN within this release of the specification.\nThe PCEF provides the PCRF with the access network information as described in clause 4.5.1, with the exception of the user location information that, if available, is included in the TWAN-Identifier AVP. RAT-Type AVP set to \"WLAN\" and AN-Trusted AVP set to \"Trusted\" shall be provided. If the NetLoc-Trusted-WLAN is supported, the procedure described in clause 4.5.22 shall apply with the exception of the user location information that, if available, is included in the TWAN-Identifier AVP.\nPLMN_CHANGE, IP-CAN_CHANGE and RAT_CHANGE event triggers as defined in clause 5.3.7 apply in this access. When reporting IP-CAN_CHANGE and RAT_CHANGE event triggers, the PCEF shall, in addition to the IP-CAN-Type AVP and/or RAT-Type AVP, provide the AN-Trusted AVP set to \"Trusted\".\nD.4\tEPC-based Untrusted WLAN Access\nFor EPC-based untrusted WLAN Access the BBERF does not apply.\nFor an IP-CAN session set-up over an untrusted WLAN access over S2b the following applies:\nAt IP-CAN Session Establishment the PCEF provides the PCRF with the IP-CAN-Type AVP indicating Non-3GPP-EPS, the RAT-Type AVP indicating the access technology type as provided by the access network, the ePDG address used as IPSec tunnel endpoint with the UE within the AN-GW-Address AVP, the serving network identifier in 3GPP-SGSN-MCC-MNC AVP and the AN-Trusted AVP set to \"Untrusted\". If the following information is available as appropriate, the PCEF also provides the PCRF with location information within the TWAN-Identifier AVP, a location timestamp in the User-Location-Info-Time AVP and the UE local IP address within the UE-Local-IP-Address AVP and the UDP source port number  within the UDP-Source-Port AVP or the TCP source port number within the TCP-Source-Port AVP as received from the access network.\nIf the NetLoc-Untrusted-WLAN feature is supported, reporting access network information procedure described in subclause 4.5.22 shall apply with the exception that the PCEF provides the PCRF with location information within the TWAN-Identifier AVP, a location timestamp in the User-Location-Info-Time AVP and the UE local IP address within the UE-Local-IP-Address AVP and the UDP source port number within the UDP-Source-Port AVP or the TCP source port number within the TCP-Source-Port AVP as received from the access network.\nPLMN_CHANGE, IP-CAN_CHANGE and RAT_CHANGE event triggers as defined in clause 5.3.7 apply in this access. When reporting IP-CAN_CHANGE and RAT_CHANGE event triggers, the PCEF shall, in addition to the IP-CAN-Type AVP and/or RAT-Type AVP, provide the AN-Trusted AVP set to \"Untrusted\". As described for the case of an IP‑CAN Session Establishment, the PCEF provides also the PCRF with location information it may have received from the ePDG and the ePDG IP address used as IPSec tunnel endpoint with the UE.\nNOTE:\tThe PCEF reports IP-CAN_CHANGE and RAT_CHANGE event triggers to the PCRF when a Create Session Request is received including information that the UE moved to an untrusted WLAN access.\nAnnex E (normative):Access specific aspects, Fixed Broadband Access interworking with EPC\nE.1\tScope\nThis annex defines access specific aspects procedures for use of Gx, Gxx and S15 between PCRF and PCEF, BBERF(ePDG/S-GW) and HNB GW respectively.\nE.2\tDefinitions and abbreviations\nE.2.1\tDefinitions\nUE local IP address is defined as: either the public Ipv4 address and/or Ipv6 address assigned to the UE by the BBF domain in the no-NAT case, or the public Ipv4 address assigned by the BBF domain to the NATed RG that is used for this UE.\nH(e)NB local IP address is defined as: either the public IP Ipv4 address and/or Ipv6 address assigned to the H(e)NB by the BBF domain in the no-NAT case, or the public Ipv4 address assigned by the BBF domain to the NATed RG that is used for this H(e)NB.\nNon-seamless WLAN offload (NSWO) is defined as: a capability of routing specific IP flows over the WLAN access without traversing the EPC as defined in clause 4.1.5 of 3GPP TS 23.402 [23].\nNon-seamless WLAN offload APN (NSWO-APN) is defined as: an APN allowing the BPCF to indicate to PCRF that for subscribers of a certain HPLMN the IP-CAN session is related to NSWO traffic.\nEPC-routed traffic is defined as: User plane traffic that is routed via a PDN GW in EPC as part of a PDN Connection. EPC-routed traffic applies to non-roaming, roaming with home routed and roaming with visited aceess cases.\nE.2.2\tAbbreviations\nThe following abbreviations are relevant for this annex only:\nBBF\tBroadband Forum\nBPCF\tBroadband Policy Control Function\nNA(P)T\tNetwork Address (Port) Translation\nNSWO\tNon-Seamless WLAN offload\nNSWO-APN\tNon-Seamless WLAN offload APN\nRG\tResidential Gateway\nE.3\tReference points and Reference model\nE.3.0\tGeneral\nFor Fixed Broadband Access network interworking, the applied scenarios of case 1, case 2a and case 2b are defined in clause E.4.1 in 3GPP TS 29.213 [8].\nE.3.1\tGx Reference Point\nIn addition to the specification of the Gx reference point defined in clause 4, this reference point is also used to transport, for case 1:\n-\tThe UE local IP address, the UDP source port number of IPSec tunnel if the NA(P)T is detected and ePDG IP address when GTP-based S2b is used in the WLAN scenario.\n-\tThe UE local IP address, the UDP source port number of DSMIPv6 binding update signalling (user plane traffic is not encapsulated by Ipsec), UDP source port number of IPSec tunnel (user plane traffic is encapsulated by Ipsec) if the NA(P)T is detected and P-GW IP address when trusted S2c is used in the WLAN scenario.\n-\tThe H(e)NB local IP address and the UDP source port number of IPSec tunnel if the NA(P)T is detected for GTP-based S5/S8 is used in the H(e)NB scenario.\nE.3.2\tGxx Reference Point\nThis reference point is defined between the PCRF and the BBERF which is located at the ePDG or S-GW for PMIP-based S5/S8. It is used to transport:\n-\tThe UE local IP address, the UDP source port number of IPSec tunnel if the NA(P)T is detected, and ePDG IP address when PMIP based S2b (case 2b) or untrusted S2c (case 2a) is used in the WLAN scenario (BBERF located at the ePDG).\n-\tThe H(e)NB local IP address and the UDP source port number of IPSec tunnel if the NA(P)T is detected for PMIP based S5/S8 (case 2b) in the H(e)NB scenario (BBERF located at the S-GW).\nWhen the BBERF is located at the ePDG, no QoS Rules should be sent over the Gxx reference point.\nE.3.3\tS15 Reference Point\nThe S15 reference point is located between the HNB GW and the PCRF and between the HNB GW and the V-PCRF. It enables provisioning and removal of dynamic QoS rules from the (V-) PCRF to the BPCF for the purpose of allocation and release of QoS resources in the Fixed Broadband Access Network for HNB CS calls.\nRefer to Annex G of 3GPP TS 29.213 [8] for Diameter overload control procedures over the S15 interface.\nRefer to Annex J of 3GPP TS 29.213 [8] for Diameter message priority mechanism procedures over the S15 interface.\nRefer to Annex K of 3GPP TS 29.213 [8] for Diameter load control procedures over the S15 interface.\nE.3.3a\tSd Reference Point\nThis reference point is an intra-operator interface between the TDF and the (V-)PCRF for the NSWO traffic. Scenarios where NSWO traffic is routed via the TDF are therefore limited to the case where the Fixed Broadband Access Network and the PLMN are owned by the same operator.\nE.3.4\tReference Model\nThe relationships between the different functional entities involved for EPC-routed traffic are depicted in figure E.3.4.1 and E.3.4.2\nFigure E.3.4.1: Gx, Gxx and S15 reference point at the Policy and Charging Control (PCC) architecture with SPR\nFigure E.3.4.2: Gx, Gxx and S15 reference point at the Policy and Charging Control (PCC) architecture with UDR\nThe relationships between the different functional entities involved for NSWO traffic are depicted in figure E.3.4.3 and E.3.4.4\nFigure E.3.4.3: Sd reference point at the Policy and Charging Control (PCC) architecture with SPR\nFigure E.3.4.4: Sd reference point at the Policy and Charging Control (PCC) architecture with UDR\nNOTE 1:\tThe TDF in this architecture is used with traffic that is non-seamless WLAN offloaded in the Fixed Broadband Access Network.\nNOTE 2:\tSd is an intra-operator interface. Scenarios where non-seamless WLAN offloaded traffic is routed via the TDF are therefore limited to the case where the Fixed Broadband Access Network and the PLMN are owned by the same operator.\nNOTE 3:\tOnly the PCRF related interfaces are shown in the above figures.\nE.4\tFunctional Elements\nE.4.1\tPCRF\nThe PCRF functionality defined in clause 4.4.1, clause 4a.4.1 and clause 4b.4.1 shall apply. In addition, to support interworking with Fixed Broadband Access networks for EPC-routed traffic, the PCRF shall:\n-\tBe able to receive from the PCEF the H(e)NB Local IP address and if available UDP source port number for the H(e)NB scenario when GTP-based S5/S8 is used (case 1).\n-\tBe able to receive from the BBERF(S-GW) the H(e)NB Local IP address and if available UDP source port number, and if available for the H(e)NB scenario when PMIP-based S5/S8 is used (case 2b).\n-\tBe able to receive the UE local IP address, if available, UDP source port number from the BBERF (ePDG) (case 2a and case 2b) and PCEF (case 1) and ePDG IP address or P-GW IP address for the WLAN scenario.\n-\tBe able to receive the HNB local IP address and if available, UDP source port number from HNB GW (case 1) for the HNB CS scenario.\nIn addition, to support interworking with Fixed Broadband Access networks for NSWO traffic, the PCRF shall:\n-\tEstablish an Sd session with the TDF for an S9a* session with the UE local IP address. The TDF address may be received over S9a reference point or can be preprovisioned in the PCRF.\nNOTE:\tScenarios where non-seamless WLAN offloaded traffic is routed via the TDF are limited to the case where the Fixed Broadband Access Network and the PLMN are owned by the same operator.\n-\tMake the ADC decisions based on information obtained from the BPCF via the S9a reference point.\nE.4.2\tPCEF\nThe PCEF functionality defined in clause 4.4.2 shall apply. In addition, to support interworking with Fixed Broadband Access networks, the PCEF shall:\n-\tSupport the reporting of the H(e)NB Local IP address and if available UDP source port number over Gx reference point for the H(e)NB scenario when GTP-based S5/S8 is used (case 1).\n-\tSupport the reporting of the UE local IP address, if available UDP source port number (case 1) and P-GW IP address over Gx reference point for the WLAN scenario when GTP-based S2b or trusted S2c is used (case 1).\nE.4.3\tBBERF\nFor case 2a and case 2b of WLAN scenario, the BBERF(ePDG) shall support the reporting of the UE's Local IP address, UDP source port number if the NA(P)T is detected and ePDG IP address to the PCRF over Gxx reference point corresponding to Gxb* Bearer Binding, uplink bearer binding verification functions are not supported.\nFor case 2b of H(e)NB scenario, Gxx reference point corresponds to Gxc and the BBERF(S-GW) functionality defined in clause 4a.4.2 shall apply. In addition, to support interworking with Fixed Broadband Access networks, the BBERF shall support reporting the H(e)NB local IP address and the UDP source port number of IPSec tunnel if the NA(P)T is detected.\nE.4.4\tHNB GW\nTo support interworking with Fixed Broadband Access networks, the HNB GW shall:\n-\tSupport S15 session establishment, modification and termination between the HNB GW and PCRF for the CS sessions.\n-\tSupport the reporting of the QoS information of CS session to the PCRF so as to trigger the PCRF to request allocation of resources in the Fixed Broadband access network.\n-\tSupport the reporting of the HNB local IP address and if available UDP source port number.\nE.5\tPCC procedures\nE.5.1\tPCC procedures over Gx reference point\nThe PCC procedures over Gx reference point defined in clause 4.5 shall apply. In addition, to support interworking with Fixed Broadband Access networks, during the IP-CAN session establishment or modification, the PCEF may include\n-\tIn WLAN scenario, when GTP-based S2b and trusted S2c is used, the UE Local IP Address within the UE-Local-IP-Address AVP, and the UDP source port number of IPSec tunnel or the UDP source port number of DSMIPv6 binding update signalling within the UDP-Source-Port AVP if available for case 1 and the PDN-GW address used as the endpoint of the DSMIPv6 Ipv4 user plane tunnel with the UE within the 3GPP-GGSN-Address (Ipv4 address) or the PDN-GW address used as the endpoint of the DSMIPv6 Ipv6 user plane tunnel with the UE within the 3GPP-GGSN-Ipv6-Address (Ipv6 address) for trusted S2c access or the ePDG IP address derived from the ePDG IP address IE as defined in clause 7.2.1 of 3GPP TS 29.274 [22] within the AN-GW-Address for GTP-based S2b. The event trigger set to the value UE_LOCAL_IP_ADDRESS_CHANGE shall be included when the UE local IP address and/or UDP source port number are changed. The IP-CAN-Type is set to the value \"Non-3GPP-EPS\".\n-\tIn H(e)NB scenario, when GTP-based S5/S8 is used, the H(e)NB local IP Address within the HeNB-Local-IP-Address and UDP source port number of IPSec tunnel within UDP-Source-Port AVP if available for case 1 in H(e)NB scenario when GTP-base S5/S8 is used. The event trigger set to the value H(E)NB_LOCAL_IP_ADDRESS_CHANGE shall be included when the H(e)NB local IP address and/or UDP source port number are changed. The IP-CAN-Type is set to the value \"3GPP-EPS\".\nE.5.2\tPCC procedures over Gxx reference point\nE.5.2.1\tGateway Control Session Establishment\nFor the case 2a and case 2b of WLAN scenario, the BBERF (ePDG) may initiate a Gateway Control Session Establishment with the PCRF if it is aware that a 3GPP UE has attached via the BBF access and also learns the IMSI of the subscriber.\nThe BBERF(ePDG) shall send a CCR command with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\", the CCR command shall include the IMSI within the Subscription-Id AVP, the type of IP-CAN within the IP-CAN-Type AVP set to the value \"Non-3GPP-EPS\", the PDN information within the Called-Station-ID AVP if available, the UE Local IP Address within the UE-Local-IP-Address AVP, the UDP source port number of IPSec tunnel within the UDP-Source-Port AVP if available and the ePDG IP address used as IPSec tunnel endpoint with the UE within the AN-GW-Address AVP.\nFor the case 2b of H(e)NB scenario, the procedure defined in clause 4a.5.1 applies. In addition, to support interworking with Fixed Broadband Access networks, during the Gateway Control session establishment, the BBERF(S-GW) may include the H(e)NB local IP Address within the HeNB-Local-IP-Address and UDP source port number of IPSec tunnel within UDP-Source-Port AVP if available.\nE.5.2.2\tGateway Control Session Modification\nFor the case 2a and case 2b of WLAN scenario, the BBERF(ePDG) may initiate a Gateway Control session modification with the PCRF if the Local UE IP address and/or the UDP source port number if available are changed.\nThe BBERF(ePDG) shall send a CCR command with the CC-Request-Type AVP set to the value \"UPDATE_REQUEST\", the CCR command shall include the UE Local IP Address within the UE-Local-IP-Address AVP and/or the UDP source port number of Ipsec tunnel within the UDP-Source-Port AVP, and the event trigger set to the value UE_LOCAL_IP_ADDRESS_CHANGE.\nFor the case 2b of H(e)NB scenario, the procedure defined in clause 4a.5.1 applies. In addition, to support interworking with Fixed Broadband Access networks, during the Gateway Control session modification, the BBERF(S-GW) may include the H(e)NB local IP Address within the HeNB-Local-IP-Address and/or UDP source port number of IPSec tunnel within UDP-Source-Port AVP if available, and the event trigger set to the value H(E)NB_LOCAL_IP_ADDRESS_CHANGE.\nE.5.2.3\tGateway Control Session Termination\nProcedure defined in clause 4a.5.3 shall apply.\nE.5.2.4\tRequest of Gateway Control Session Termination\nProcedure defined in clause 4a.5.4 shall apply.\nNOTE:\tBBERF(ePDG) does not need to remove/deactivate the QoS rule because the QoS rule are not applicable to the BBERF(ePDG).\nE.5.3\tS15 Procedures\nE.5.3.1\tS15 Session Establishment\nThe HNB GW initiates an S15 Session Establishment with the PCRF if the HNB registers to the HNB GW.\nThe HNB GW shall send a CC-Request with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\", The CCR command shall include the HNB Local IP address within the HeNB-Local-IP-Address AVP and the UDP source port number of IPSec tunnel within the UDP-Source-Port AVP if available.\nWhen the PCRF receives the CC-Request, it shall acknowledge this message by sending a CC-Answer to the HNB GW.\nE.5.3.2\tS15 Session Modification\nE.5.3.2.1\tS15 Session Modification initiated by the HNB GW\nThe HNB GW initiates an S15 session modification with the PCRF if the HNB GW receives the RAB assignment message to request, modify and cancel the resource for the CS service.\nThe HNB GW shall send a CCR command with the CC-Request-Type AVP set to the value \"UPDATE_REQUEST\".\nWhen the RAB assignment requests to allocate new resources, the HNB GW shall include the requested QoS information which is derived from the RAB message within the QoS-Information AVP, and the QoS request identifier assigned by the HNB GW within CS-Service-QoS-Request-Identifier AVP in the CCR command.\nWhen the RAB assignment requests to modify existing resources, the HNB GW shall set the CS-Service-QoS-Request-Operation AVP to \"MODIFICATION\", the HNB GW shall also include the requested QoS information which is derived from the RAB message within the QoS-Information AVP and the QoS request identifier assigned by the HNB GW within CS-Service-QoS-Request-Identifier AVP in the CCR command.\nWhen the RAB assignment requests to delete resources the HNB GW shall set the CS-Service-QoS-Request-Operation AVP to \"DELETION\", and shall also include the QoS request identifier assigned by the HNB GW within CS-Service-QoS-Request-Identifier AVP in the CCR command.\nE.5.3.2.2\tS15 Session Modification initiated by the PCRF\nThe PCRF initiates an S15 session modification with the HNB GW if the PCRF receives the QoS rule failure report with the PCC-Rule-Status AVP set to the value \"INACTIVE\" from the BPCF.\nThe PCRF shall include the CS-Service-Resource-Report AVP in the RAR command with the CS-Service-Resource-Result-Operation AVP set to the value \"DELETION\", the CS-Service-QoS-Request-Identifier AVP containing the QoS request identifier corresponding to the QoS rule reported by the BPCF and the CS-Service-Resource-Failure-Cause AVP indicating the reason why the resource is released.\nThe HNB GW shall initiate RAB modification or RAB release procedure to release the corresponding resource allocated in the 3GPP network as defined in 3GPP TS 23.060 [17].\nE.5.3.3\tS15 Session Termination\nThe HNB GW initiates the S15 session termination with the PCRF if the HNB GW initiates deregistration for the HNB or receives the deregistration request from the HNB.\nThe HNB GW shall send a CC-Request with CC-Request-Type AVP set to the value \"TERMINATION_REQUEST\".\nIf the HNB GW needs to send an S15 Session termination request towards a PCRF which is known to have restarted since the S15 Session establishment, the HNB GW should not send CC-Request to inform the PCRF.\nWhen the PCRF receives the CC-Request, it shall acknowledge this message by sending a CC-Answer to the HNB GW.\nE.5.4\tADC procedures over Sd reference point for solicited application reporting\nE.5.4.1\tTDF session establishment\nIf PCRF decides, based on subscriber's profile configuration, that the TDF session should be established with the TDF per corresponding IP-CAN session, during the IP-CAN session establishment or at any point of time when the PCRF decides that the session with TDF is to be established (e.g. subscriber profile changes), the PCRF shall indicate via the Sd reference point, the ADC rules to be applied at the TDF. The TDF-Information AVP shall be either received over S9a within initial CC-Request received from BPCF or pre-provisioned at PCRF.\nNOTE:\tIn case the TDF-Information is pre-provisioned in the PCRF and also the value is received in CC-Request from the BPCF, the value received in CC-Request takes precedence over the pre-provisioned value.\nWhen establishing the session with the TDF, the PCRF shall send a TS-Request with the PDN information (NSWO-APN), if available, within the Called-Station-Id AVP, the UE Local IP address within the Framed-IP-Address AVP and/or the Framed-Ipv6-Prefix AVP.\nE.5.5\tADC procedures over Sd reference point for unsolicited application reporting\nE.5.5.1\tGeneral\nFor provisioning of ADC Rules and Application Detection Information reporting the procedures described in clauses 4b.5a.1 and 4b.5a.2 apply respectively.\nFor the request of TDF Session Termination, the procedure described in clause 4b.5a.3 applies, with the exemption that the release of Ipv4 address in a dual stack scenario is notified with the S9a* Session Termination for that Ipv4 address.\nE.5.5.2\tTDF session to S9a* session linking\nWhen the PCRF receives the CCR command with the CC-Request-Type set to the value \"INITIAL_REQUEST\" over Sd reference point, the PCRF links the TDF session to an S9a* session, if the Ipv4 address or Ipv6 address of the TDF session matches the UE local IP address of the S9a* session. The PDN information (i.e NSWO-APN) if available in the Called-Station-Id AVP may also be used for this session linking.\nWhen the PCRF checks if APNs within Called-Station-Id AVPs match each other, the PCRF shall apply the APN matching procedures in Annex H of 3GPP TS 29.213 [8].\nThe TDF should handle each Ipv4 address and Ipv6 prefix, assuming the max prefix length used in the access network, within a separate TDF session.\nNOTE 1:\tIn a dual-stack scenario where a 3GPP UE in the Broadband Fixed Access Network is allocated an Ipv6 address/prefix and an Ipv4 address, this would result in two S9a* sessions. The PCRF would link the Ipv4 address related TDF session and Ipv6 address related TDF session for the same UE to the different S9a* sessions.\nNOTE 2:\tIn the scenario where the TDF performs initial Application Detection on multiple simultaneous traffic flows for the same Ipv6 prefix (i.e. two or more traffic flows from Ipv6 addresses of the same IP-CAN session) the TDF could not be aware that those flows belong to the same IP-CAN session until a response is received from the PCRF, containing the Ipv6 prefix. This leads to using separate TDF sessions for the Ipv6 addresses for the same IP-CAN session. The TDF reports new application detection information related to that Ipv6 prefix via any of the TDF sessions at a later stage.\nE.6\tS15 Protocol\nE.6.1\tProtocol support\nThe S15 application is defined as a vendor specific Diameter application, where the vendor is 3GPP and the Application-ID for the S15 Application in the present release is 16777318. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.\nNOTE:\tA route entry can have a different destination based on the application identification AVP of the message. Therefore, Diameter agents (relay, proxy, redirection, translation agents) need to be configured appropriately to identify the 3GPP S15 application within the Auth-Application-Id AVP in order to create suitable routeing tables.\nThe S15 application identification shall be included in the Auth-Application-Id AVP.\nWith regard to the Diameter protocol defined over the S15 interface, the PCRF acts as a Diameter server, the HNB GW acts as the Diameter client.\nE.6.2\tInitialization, maintenance and termination of connection and session\nThe initialization and maintenance of the connection between each PCRF and HNB GW pair is defined by the underlying protocol. Establishment and maintenance of connections between Diameter nodes is described in IETF RFC 6733 [61].\nAfter establishing the transport connection, the PCRF and the HNB GW shall advertise the support of the S15 specific Application by including the value of the application identifier in the Auth-Application-Id AVP and the value of the 3GPP (10415) in the Vendor-Id AVP of the Vendor-Specific-Application-Id AVP contained in the Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands. The Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands are specified in the Diameter base protocol (IETF RFC 6733 [61]).\nThe termination of the Diameter user session on S15 can be initiated by the HNB GW, as specified in clause E.5.3.3.\nE.6.3\tS15 specific AVPs\nE.6.3.1\tGeneral\nTable E.6.3.1.1 describes the Diameter AVPs defined for the S15 reference point, their AVP Code values, types, possible flag values, whether or not the AVP may be encrypted, what access types (e.g. 3GPP-EPS, etc.) the AVP is applicable to, the applicability of the AVPs to charging control, policy control or both, and which supported features the AVP is applicable to. The Vendor-Id header of all AVPs defined in the present document shall be set to 3GPP (10415).\nTable E.6.3.1.1: S15 specific Diameter AVPs\nAVP Flag rules (NOTE 1)\nAttribute Name\nAVP Code\nClause defined\nValue Type (NOTE 2)\nMust\nMay\nShould not\nMust not\nMay Encr.\nAcc. Type\nApplicability\n(NOTE3)\nCS-Service-Qos-Request-Identifier\n2807\nE.6.3.2\nOctetString\nM, V\nP\nY\n3GPP-EPS\nPC\nCS-Service-QoS-Request-Operation\n2808\nE.6.3.3\nEnumerated\nM.V\nP\nY\n3GPP-EPS\nPC\nCS-Service-Resource-Report\n2813\nE.6.3.6\nGrouped\nM.V\nP\nY\n3GPP-EPS\nPC\nCS-Service-Resource-Failure-Cause\n2814\nE.6.3.5\nEnumerated\nM.V\nP\nY\n3GPP-EPS\nPC\nCS-Service-Resource-Result-Operation\n2815\nE.6.3.4\nEnumerated\nM.V\nP\nY\n3GPP-EPS\nPC\nNOTE 1:\tThe AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [61].\nNOTE 2:\tThe value types are defined in IETF RFC 6733 [61].\nNOTE 3:\tAVPs marked \"PC\" are applicable to policy control.\nE.6.3.2\tCS-Service-QoS-Request-Identifier\nThe CS-Service-QoS-Requset-Identifier (AVP code 2807) is of type OctetString, and it identifies the QoS request instance request by the HNB GW for the CS-Service. QoS request identifier is assigned by the HNB GW and within the scope of the HNB GW is unique per PCRF.\nE.6.3.3\tCS-Service-QoS-Request-Operation\nCS-Service-QoS-Request-Operation AVP (AVP code 2808) is type of Enumerated, and it indicates a resource request operation of the CS service.\nThe following values are defined:\nDELETION (0)\nThis value is used to request that the resources reserved for the provided QoS request identifiers are to be deleted and no longer used by CS service.\nMODIFICATION (1)\nThis value is used to request that the reserved resources for the provided QoS request identifiers are to be modified.\nE.6.3.4\tCS-Service-Resource-Result-Operation\nCS-Service-Resource-Result-Operation AVP (AVP code 2815) is type of Enumerated, and it indicates a resource result operation of the CS service in the Fixed Broadband Access network.\nThe following values are defined:\nDELETION (0)\nThis value is used to indicate a result that the resources reserved for the provided QoS request identifiers have been removed by the Fixed Broadband Access network.\nE.6.3.5\tCS-Service-Resource-Failure-Cause\nCS-Service-Resource-Failure-Cause AVP (AVP code2814) is type of Enumerated, and it indicates the reason why the resource is released.\nThe following values are defined:\nRESOURCE_RELEASED (0)\nThis value is used to indicate that resource can not be maintained in the Fixed Broadband Access network.\nE.6.3.6\tCS-Service-Resource-Report\nCS-Service-Resource-Report AVP (AVP code2813) is type of Grouped, and it is used to report a resource result for the CS service in the Fixed Broadband Access network.\nCS-Service-Resource-Result-Operation AVP indicates a resource result operation of the CS service in the Fixed Broadband Access network.\nCS-Service-QoS-Request-Identifier AVP indicates the QoS request identifier that corresponding resource result is reported by the BPCF.\nCS-Service-Resource-Failure-Cause AVP indicates the reason why the resource is released.\nAVP Format:\nCS-Service-Resource-Report ::= < AVP Header: 2813 >\n*[ CS-Service-QoS-Request-Identifier ]\n[ CS-Service-Resource-Result-Operation ]\n[ CS-Service-Resource-Failure-Cause ]\nE.6.4\tS15 re- used AVPs\nE.6.4.1\tGeneral\nTable E.6.4.1.1 lists the Diameter AVPs re-used by the S15 reference point from Gx reference point and other existing Diameter Applications, reference to their respective specifications, short description of their usage within the S15 reference point and the applicability of the AVPs to a specific access. When reused from Gx reference point, the specific clause in the present specification is referred. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol, do not need to be supported. The AVPs from Diameter base protocol are not included in table E.6.4.1.1, but they are re-used for the S15 reference point. Unless otherwise stated, re-used AVPs shall maintain their 'M', 'P' and 'V' flag settings. Where RADIUS VSAs are re-used, unless otherwise stated, they shall be translated to Diameter AVPs as described in IETF RFC 4005 [12] with the exception that the 'M' flag shall be set and the 'P' flag may be set.\nTable E.6.4.1.1: S15 re-used Diameter AVPs\nAttribute Name\nReference\nDescription\nAcc. Type\nDRMP\nIETF RFC 7944 [53]\nAllows Diameter endpoints to indicate the relative priority of Diameter transactions.\n3GPP-EPS\nHeNB-Local-IP-Address\n5.3.95\nContains the HNB local IP address as defined in Annex E.2.1.\n3GPP-EPS\nLoad\nIETF RFC 8583 [60]\nThe AVP used to convey load information between Diameter nodes.\nThis AVP and all AVPs within this grouped AVP shall have the 'M' bit cleared.\n3GPP-EPS\nOC-OLR\nIETF RFC 7683 [49]\nContains the necessary information to convey an overload report.\n3GPP-EPS\nOC-Supported-Features\nIETF  RFC 7683 [49]\nDefines the support for the Diameter overload indication conveyence by the sending node.\n3GPP-EPS\nQoS-Information\n5.3.16\nContains the QoS information for a resource of the CS service\n3GPP-EPS\nUDP-Source-Port\n5.3.97\nContains the UDP source port number in the case that NA(P)T is detected for supporting interworking with Fixed Broadband access network as defined in Annex E.\n3GPP-EPS\nE.6.4.2\tUse of the Supported-Features AVP on the S15 reference point\nThe Supported-Features AVP is used during session establishment to inform the destination host about the required and optional features that the origin host supports. The client shall, in the first request of a Diameter session indicate the set of supported features. The server shall, in the first answer within the Diameter session indicate the set of features that it has in common with the client and that the server shall support within the same Diameter session. Any further command messages shall always be compliant with the list of supported features indicated in the Supported-Features AVPs during session establishment. Features that are not advertised as supported shall not be used to construct the command messages for that Diameter session. Unless otherwise stated, the use of the Supported-Features AVP on the S15 reference point shall be compliant with the requirements for dynamic discovery of supported features on the Cx reference point as defined in clause 7.2.1 of 3GPP TS 29.229 [14].\nThe base functionality for the S15 reference point is the 3GPP Rel-11 standard and a feature is an extension to that functionality. If the origin host does not support any features beyond the base functionality, the Supported-Features AVP may be absent from the S15 commands. As defined in clause 7.1.1 of 3GPP TS 29.229 [14], when extending the application by adding new AVPs for a feature, the new AVPs shall have the M bit cleared and the AVP shall not be defined mandatory in the command ABNF.\nAs defined in 3GPP TS 29.229 [14], the Supported-Features AVP is of type grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the S15 reference point, the Supported-Features AVP is used to identify features that have been defined by 3GPP and hence, for features defined in this document, the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are multiple feature lists defined for the S15 reference point, the Feature-List-ID AVP shall differentiate those lists from one another.\nOn receiving an initial request application message, the destination host shall act as defined in clause 7.2.1 of 3GPP TS 29.229 [14]. The following exceptions apply to the initial CCR/CCA command pair:\n-\tIf the HNB GW supports post-Rel-11 S15 functionality, the CCR shall include the features supported by the HNB GW within Supported-Features AVP(s) with the 'M' bit cleared.\nNOTE:\tOne instance of Supported-Features AVP is needed per Feature-List-ID.\n-\tIf the CCR command does not contain any Supported-Features AVP(s) and the PCRF supports Rel-11 S15 functionality, the CCA command shall not include the Supported-Features AVP. In this case, both HNB GW and PCRF shall behave as specified in the Rel-11 version of this document.\nOnce the HNB GW and PCRF have negotiated the set of supported features during session establishment, the set of common features shall be used during the lifetime of the Diameter session.\nE.6.5\tS15 specific Experimental-Result-Code AVP values\nE.6.5.1\tGeneral\nIETF RFC 6733 [61] specifies the Experimental-Result AVP containing Vendor-ID AVP and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code 298) is of type Unsigned32 and contains a vendor-assigned value representing the result of processing a request. The Vendor-ID AVP shall be set to 3GPP (10415).\nE.6.5.2\tSuccess\nResult Codes that fall within the Success category are used to inform a peer that a request has been successfully completed.\nThe Result-Code AVP values defined in Diameter base protocol, IETF RFC 6733 [61], shall be applied.\nE.6.5.3\tPermanent Failures\nErrors that fall within the Permanent Failures category shall be used to inform the peer that the request failed, and should not be attempted again.\nThe Result-Code AVP values defined in Diameter base protocol, IETF RFC 6733 [61], are applicable.\nE.6.5.4\tTransient Failures\nErrors that fall within the transient failures category are used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future.\nThe Result-Code AVP values defined in Diameter base protocol, IETF RFC 6733 [61], are applicable.\nE.6.6\tS15 Messages\nE.6.6.1\tS15 Application\nS15 Messages are carried within the Diameter Application(s) described in clause E.6.1.\nExisting Diameter command codes from the Diameter base protocol, IETF RFC 6733 [61], and the Diameter Credit Control Application, IETF RFC 8506 [66], are used with the S15 specific AVPs specified in clause E.6.3. The Diameter Credit Control Application AVPs and AVPs from other Diameter applications that are re-used are defined in clause E.6.4. The S15 application identifier shall be included in the Auth-Application-Id AVP. A diameter session needs to be established for each S15 session.\nNOTE:\tSome of the AVPs included in the messages formats below are in bold to highlight that these AVPs are used by this specific protocol and do not belong to the original message definition in the DCC Application, IETF RFC 8506 [66], or Diameter base protocol, IETF RFC 6733 [61].\nE.6.6.2\tCC-Request (CCR) Command\nThe CCR command, indicated by the Command-Code field set to 272 and the 'R' bit set in the Command Flags field, is sent by the HNB GW to the PCRF in order to initiate an S15 session establishment or request resource for the CS service. The CCR command is also sent by the HNB GW to the PCRF in order to indicate the termination of the S15 session.\nMessage Format:\n<CC-Request> ::= < Diameter Header: 272, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ OC-Supported-Features ]\n[ CS-Service-QoS-Request-Identifier ]\n[ CS-Service-QoS-Request-Operation ]\n[ Destination-Host ]\n[ HeNB-Local-IP-Address ]\n[ Origin-State-Id ]\n[ QoS-Information ]\n[ UDP-Source-Port ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\nE.6.6.3\tCC-Answer (CCA) Command\nThe CCA command, indicated by the Command-Code field set to 272 and the 'R' bit cleared in the Command Flags field, is sent by the PCRF to the HNB GW in response to the CCR command. It is used to provision the admission control result in the fixed broadband access network.\nMessage Format:\n<CC-Answer> ::=  < Diameter Header: 272, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n{ CC-Request-Type }\n{ CC-Request-Number }\n[ Origin-State-Id ]\n*[ Redirect-Host ]\n[ Redirect-Host-Usage ]\n[ Redirect-Max-Cache-Time ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ Load ]\n*[ AVP ]\nE.6.6.4\tRe-Auth-Request (RAR) Command\nThe RAR command, indicated by the Command-Code field set to 258 and the 'R' bit set in the Command Flags field, is sent by the PCRF to the HNB GW in order to report the resource reservation result in the Fixed Broadband Access network.\nMessage Format:\n<RA-Request> ::= < Diameter Header: 258, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Re-Auth-Request-Type }\n[ Origin-State-Id ]\n[ OC-Supported-Features ]\n*[ CS-Service-Resource-Report ]\n*[ Proxy-Info ]\n*[ Route-Record ]\n*[ AVP ]\nE.6.6.5\tRe-Auth-Answer (RAA) Command\nThe RAA command, indicated by the Command-Code field set to 258 and the 'R' bit cleared in the Command Flags field, is sent by the HNB GW to the PCRF in response to the RAR command.\nMessage Format:\n<RA-Answer> ::=  < Diameter Header: 258, PXY >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Result-Code ]\n[ Experimental-Result ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ Origin-State-Id ]\n[ Error-Message ]\n[ Error-Reporting-Host ]\n[ Failed-AVP ]\n*[ Proxy-Info ]\n*[ AVP ]\nAnnex F (informative):Disabling/re-enabling Usage Monitoring for a PCC/ADC rule\nIf usage monitoring for a PCC/ADC rule (belonging to a usage monitoring group) needs to be disabled, one of the two ways below can be chosen to realize this feature:\n-\tThe PCRF generates a new PCC/ADC rule with the same information (apart from the PCC/ADC Rule identifier within the Charging-Rule-Name AVP/ADC-Rule-Name AVP) as the existing PCC/ADC rule used to control the same traffic but without the monitoring key. The PCRF provides the new PCC/ADC rule with the Charging-Rule-Install AVP/ADC-Rule-Install AVP to the PCEF/TDF and removes the existing PCC/ADC rule with the Charging-Rule-Remove AVP/ ADC-Rule-Remove AVP in one CCA or RAR command.\nNOTE 1:\tIt is assumed that the activation of the new PCC/ADC rule takes place at the same time as the removal of the existing PCC/ADC rule and that no other actions are triggered (e.g. with respect to charging and bearer management) beside the ones related to the disabling of usage monitoring.\n-\tThe operator selects a specific monitoring key value to be used for all PCC/ADC rules for which usage monitoring is disabled. The PCRF modifies the monitoring key in the corresponding PCC/ADC rules to this specific value with the Charging-Rule-Install AVP/ADC-Rule-Install AVP. Following the PCRF instruction, the PCEF or TDF updates the monitoring key in the modified PCC/ADC rule and collects the usage information for the specific monitoring key value. The PCEF/TDF usage reports would still be received by the PCRF but could be ignored.\nNOTE 2:\tThe operator should configure the usage threshold to a sufficiently high value so that frequent usage reports are avoided.\nIf usage monitoring needs to be re-enabled for a PCC/ADC rule (i.e. usage monitoring has been disabled for this PCC/ADC rule before), one of the two ways below can be chosen to realize this feature:\n-\tThe PCRF generates a new PCC/ADC rule with the same information (apart from the PCC/ADC Rule identifier within the Charging-Rule-Name AVP/ADC-Rule-Name AVP) as the existing PCC/ADC rule used to control the same traffic and adds the required monitoring key. The PCRF provides the new PCC/ADC rule with the Charging-Rule-Install AVP/ADC-Rule-Install AVP to the PCEF/TDF and removes the existing PCC/ADC rule without monitoring key with the Charging-Rule-Remove AVP/ ADC-Rule-Remove AVP in one CCA or RAR command. The PCEF/TDF executes the operations in the same way it is described above in Note 1.\n-\tThe PCRF modifies the monitoring key of the corresponding PCC/ADC rule to the value of the required usage monitoring group (e.g. back to its original value) with the Charging-Rule-Install AVP/ADC-Rule-Install AVP.\nAnnex G (normative):Access specific aspects, Fixed Broadband Access network convergence\nG.1\tScope\nThis annex defines the enhancement to Gx/Sd reference point for supporting policy and charging control in the fixed broadband access network in the convergent scenario where a single operator is deploying both the fixed broadband access network and the Evolved Packet Core (EPC).\nThe scope of this Annex is to define the convergent scenario where the PCRF controls directly the network element(s) in the fixed broadband access without the mediation of a different policy server, such as the Broadband Policy Control Function (BPCF).\nPolicy and charging control is provided for both Non-seamless WLAN offload traffic from a 3GPP UE and the traffic from fixed devices.\nG.2\tDefinitions and abbreviations\nG.2.1\tDefinitions\nThe definitions in the following are relevant for this annex only.\nUE local IP address is defined as either the public IP address assigned to the UE by the Broadband Forum domain in the no-NAT case, or the public IP address assigned by the Broadband Forum domain to the NATed RG.\nIP-CAN session as defined in clause 3.1 applies with the following clarifications for fixed broadband access. The term UE corresponds to the device that accesses the services provided by the network (i.e. either RG, or 3GPP UE or fixed end-device), the PDN identifies the IP network where the device gets IP connectivity and the UE identity information may be the IMSI, the user-name or the access line identifier (if available). In a Fixed Broadband Access an IP-CAN session corresponds to a Subscriber IP Session defined in Broadband Forum TR-146 [46].\nNOTE:\tThe PDN connection concept and APN are not applicable to Subscriber IP session for fixed device.\nG.2.2\tAbbreviations\nThe following abbreviations are relevant for this annex only:\nBBF\tBroadband Forum\nBSSID\tBasic Service Set Identifier\nNAT\tNetwork Address Translation\nNSWO\tNon-Seamless WLAN offload\nNSWO-APN\tNon-Seamless WLAN offload APN\nRG\tResidential Gateway\nSSID\tService Set Identifier\nG.3\tReference points and Reference model\nG.3.1\tReference architecture\nG.3.1.1\tGeneral\nFor Fixed Broadband Access network convergence, the reference architecture in Figure G.3.1.2.1 and Figure G.3.1.3.1 applies with the following conditions:\n-\tPCEF resides in the IP Edge in the Fixed Broadband Access network.\nNOTE 1:\tEither SPR or UDR is used in this architecture.\nNOTE 2:\tGxx reference point is not used.\nG.3.1.2\tReference architecture\nFigure G.3.1.2.1: PCC Reference architecture for Fixed Broadband Access network convergence when SPR is used\nFigure G.3.1.2.2: PCC Reference architecture for Fixed Broadband Access network convergence when UDR is used\nG.3.2\tGx Reference Point\nThis reference point corresponds to the Gx which resides between the PCEF in the IP Edge and the PCRF. The Gx reference point provides the same functionality as the Gx described in clause 4 with the following exceptions:\n-\tNo provisioning of IP flow mobility routing information from the PCEF in the IP Edge to the PCRF is performed.\n-\tNegotiation of Bearer Control Mode (UE-only or UE/NW) does not apply.\nIn addition, for the purpose of convergence between 3GPP access and Fixed Broadband Access Network, the Gx reference point enables the transfer of PCC rules for an IP-CAN session that exists in the PCEF for a fixed device or for a 3GPP UE.\nG.3.3\tSd Reference Point\nThe Sd reference point as described in clause 4b applies with the exception that the TDF does not request any notifications of specific events from the PCRF.\nG.4\tFunctional Elements\nG.4.1\tPCRF\nThe PCRF functionality defined in clause 4.4.1 and clause 4b.4.1 shall apply, with the following exceptions:\n-\tNo negotiation of IP-CAN bearer control mode applies.\n-\tSubscriptions to changes of IP-CAN type, RAT type or Access Network Information do not apply.\n-\tUsage Monitoring Control as defined in clause 4.5.2.5, 4.5.16, 4.5.17 for Gx reference point and 4b.5.1.5, 4b.5.6, 4b.5.7 for Sd reference point applies with the following exceptions:\n-\tIn the routed RG with NAT mode, the IP-CAN session is per RG in the PCEF/IP Edge, the PCRF retrieves the usage monitoring related information from the SPR using the subscriber identifier within Subscription-ID AVP provided over Gx. The PCRF decides how to allocate a usage threshold to each existing IP-CAN session and/or monitoring key.\n-\tIn the bridge RG mode and in routed RG mode without NAT there may be a separate fixed subscriber session (i.e. IP-CAN session) for the each device behind the RG. The PCRF retrieves usage monitoring related information from the SPR using the subscriber identifier within Subscription-ID AVP and the NSWO APN information within the Called-Station-Id AVP if available provided over Gx. The PCRF decides how to allocate a usage threshold to each existing IP-CAN session and/or monitoring key.\nG.4.2\tPCEF(IP Edge)\nThe PCEF is located in the IP Edge as defined in TR-300 [47]. The PCEF performs those functions specified in clause 4.4.2 with the following Fixed Broadband specific functions:\nThe PCEF converts QoS parameters sent from the PCRF to Fixed Broadband Access to specific QoS attributes and determines the QoS parameters sent to the PCRF from a set of Fixed Broadband Access specific QoS attributes.\nThe support of Application Detection functionality is considered as a network operator's choice in Fixed Broadband Access. In addition, the UE and/or Network initiated bearer procedures and enforcement of authorized QoS for an IP-CAN bearer does not apply for Fixed Broadband Access.\nG.4.3\tTDF\nThe TDF functionality defined in clause 4b.4.2 shall apply. For supporting Fixed Broadband Access network convergence, the TDF does not request any notifications of specific events from the PCRF as described in clause 4b.5.8.\nG.5\tPCC procedures\nG.5.1\tConcept Adaptations for Fixed Broadband Access Network Convergence\nG.5.1.1\tGeneral\nThe PCC procedures specified in clause 4.5 for Gx and in clause 4b.5 for Sd apply with the following concept adaptation for Fixed Broadband Access network convergence.\nG.5.1.2\tIP-CAN session\nFixed Broadband Access IP-CAN is a fixed access broadband network that provides IP connectivity to a 3GPP UE or fixed devices. The Fixed Broadband Access IP-CAN reuses the definition of an IP-CAN session in clause 3.1 with the following addition.\nFor routed mode RG with NAT, one IP-CAN session shall be established for each corresponding Subscriber IP session on the IP Edge for the Ipv4 address and/or Ipv6 address or Ipv6 prefix assigned to the RG.\nIn case of routed mode RG when the PPP pass-through feature is enabled (see requirement R-10 in Broadband Forum TR‑124 Issue 3 [45]) an IP-CAN session shall be established for the each single fixed device starting the PPP session. In this case the 3GPP UE does not have Subscriber IP session in IP Edge.\nFor bridged mode RG, one IP-CAN session shall be established for each corresponding Subscriber IP session on the IP Edge for each Ipv4 address and/or Ipv6 address or Ipv6 prefix assigned to the fixed device or 3GPP UE which established a Subscriber IP session in Fixed Broadband Access network.\nFor routed mode RG with Ipv6 when stateless Ipv6 address autoconfiguration is used by the end-device behind the RG, one IP-CAN session shall be established for each corresponding Subscriber IP session on the IP Edge for the Ipv6 prefix assigned to the RG. When stateful Ipv6 address configuration is used by the end-devices, one IP-CAN session may be established for each end-device.\nFor routed mode RG, the successful completion of 3GPP-based access authentication and assignment of IP address to the 3GPP UE shall not result in any IP-CAN session establishment if the IP address assignment does not result in a new Subscriber IP Session in the IP Edge. In this case the pre-existent IP-CAN session for the RG is used.\nA device connected to the RG (e.g. VoIP phones) may also initiate a Subscriber IP session when the RG is configured in bridge mode or when the PPP pass-through feature is enabled on the Routing RG (see requirement R-10 in Broadband Forum TR‑124 Issue 3 [45]).\nG.5.1.3\tIP-CAN bearer\nThe Fixed Broadband Access network does not support the concept of a bearer and multiple bearers as defined in 3GPP TS 23.401 [32]. However, DSCP marking provides QoS support on transport network layer so that QoS and charging policies can be applied per SDF.\nG.5.1.4\tPCC rule\nThe definition of PCC rules and PCC rule operations in clause 4.3 are applicable except:\n-\tPS to CS session continuity\n-\tUser Location Report\nNOTE:\tThe procedure for provisioning predefined PCC rules at the IP Edge is out of 3GPP scope.\nG.5.1.5\tADC rule\nFor convergent application detection and control and TDF based charging, the definition of ADC rules in clause 4b.3 are applicable.\nG.5.1.6\tSubscriber Identifier\nIn the convergence scenario the Subscriber Identifier represents the identifier of the user.\nFor the 3GPP UE the Subscriber Identifier is received in the Subscription-Id AVP and includes the IMSI.\nThe Subscriber Identifier used by fixed device or the RG at establishment of Subscriber IP session in fixed broadband access network can be the Access Line Identifier (Physical-Access-ID AVP and Logical-Access-ID AVP) or the username received in Subscription-Id AVP, for example when the Subscriber IP session is a PPP Session.\nNOTE:\tFor the RG and fixed device based on Broadband Forum specification, the Subscriber Identifier is defined in Broadband Forum TR‑134 [44].\nG.5.1.7\tDefault QoS control\nThe BBF AAA may provide a default Access Profile QoS for the IP-CAN session that may contain QoS information.\nThe PCRF may provide the default QoS for the IP-CAN session to the PCEF over Gx. The IP Edge/PCEF shall enforce the default QoS provisioned over Gx.\nNOTE:\tThe IP Edge/PCEF does not enforce the default Access Profile QoS provided by the Broadband Fixed Access Network if PCRF is deployed.\nThe default QoS is included in the Default-QoS-Information AVP provided at command level as defined in clause 5.3.103.\nThe IP Edge/PCEF shall be able to convert default QoS into Fixed Broadband Access QoS attribute values. In the IP Edge, the QCI and optionally the Priority-Level AVP within the Allocation-Retention-Priority AVP is used to determine the DSCP code value or other transport specific information element and the MBR is used for bandwidth limitation for the DSCP code value. The PCEF/IP Edge shall enforce first the QoS for the packets that matches a service data flow template in an installed PCC Rule for which specific QoS enforcement actions are provided then the IP Edge/PCEF shall enforce the default QoS for all downlink and uplink traffic for the IP-CAN session.\nThe IP Edge/PCEF shall be able to convert the Fixed Broadband Access QoS attributes values into the default QoS included in the Default-QoS-Information AVP.\nG.5.2\tIP-CAN Session Establishment\nThe IP-CAN session establishment procedure defined in clause 4.5.1 applies.\nNOTE 1:\tIn routed mode configuration with NATed RG, the PCEF located in the IP Edge initiates the IP-CAN session establishment after the RG has been connected to the network and has been assigned an IPv4 address and/or IPv6 Prefix. In bridge mode, the PCEF located in the IP Edge initiates the IP-CAN session establishment after it becomes aware of an IPv4 address and/or an IPv6 address/IPv6 prefix has been assigned to the fixed device and/or 3GPP UE by the fixed broadband access.\nNOTE 2:\tIn case of routed mode RG when the PPP pass-through feature is enabled, an IP-CAN session is established for the each single fixed device starting the PPP session. In this case the 3GPP UE does not have Subscriber IP session in IP Edge.\nNOTE 3:\tFor routed mode RG, the successful completion of 3GPP-based access authentication and assignment of IP address to the 3GPP UE would not result in any IP-CAN session establishment if the IP address assignment does not result in a new Subscriber IP Session in the IP Edge. In this case the pre-existent IP-CAN session for the RG is used.\nNOTE 4:\tHow to assign the IPv4 address and/or IPv6 address/IPv6 Prefix to a RG or fixed device is out of the scope of 3GPP.\nThe PCEF located in the IP Edge shall send a CC-Request command to the PCRF with the CC-Request-Type AVP set to the value \"INITIAL_REQUEST\", the CC-Request command shall include the type of IP-CAN within the IP-CAN-Type AVP set to the value \"FBA\", the NSWO-APN information within the Called-Station-Id if available, the PLMN id within the 3GPP-SGSN-MCC-MNC AVP if available, the location information within the Fixed-User-Location-Info AVP if available and the Default QoS within the Default-QoS-Information AVP if available.\nNOTE 5: How the location information becomes available to the PCEF/IP Edge is out of the scope of 3GPP.\nNOTE 6: Operator policies in the PCEF indicate if dynamic policy control is provided. In addition, the NSWO-APN is also configured for subscribers on a PLMN basis.\nIn route mode configuration with NATed RG, the CC-Request command shall include the Access Line Identifier of the RG within the Physical-Access-ID AVP and the Logical-Access-ID AVP and the RG Ipv4 address within the Framed-IP-Address AVP and/or the RG Ipv6 prefix within the Framed-Ipv6-Prefix AVP.\nIn bridge mode, the CCR command may include the Subscription-Id AVP with the identity of the device (e.g. IMSI for the 3GPP UE, username for a fixed device) and the Access Line Identifier within the Physical-Access-ID AVP and the Logical-Access-ID AVP and the Ipv4 address within the Framed-IP-Address AVP and/or the Ipv6 address/prefix within the Framed-Ipv6-Prefix AVP.\nWhen the PCRF receives the CC-Request, it shall respond to this message by sending a CC-Answer to the PCEF located in the IP Edge. The CC-Answer command shall include the Default QoS within the Default‑QoS‑Information AVP, the applicable PCC Rules within the Charging‑Rule‑Install AVP and the applicable event triggers within the Event-Trigger AVP. The PCEF located in the IP Edge maps the Default QoS received in the QoS-Information AVP into the Default Access Profile required in the Fixed Broadband Access network.\nNOTE 7:\tThe Default-Access-Profile is defined by Broandband Forum and out of the 3GPP scope.\nNOTE 8:\tHow the mapping between the Default-Access-Profile to Default-QoS is performed is out of 3GPP scope.\nNOTE 9:\tWhether the Default QoS within the Default-QoS-Information AVP provided by the PCRF corresponds to a dynamic QoS or a default QoS name is subject to operator policies.\nG.5.3\tIP-CAN Session Termination\nIP-CAN session termination can be initiated by the PCEF(IP Edge) and PCRF.\nPCEF (IP Edge) initiated IP-CAN session termination is in accordance with the clause 4.5.7 with the following exceptions:\nThe IP-CAN session termination is triggered by PCEF when Subscriber IP session is terminated. The trigger to terminate the Subscriber IP session is Broadband Forum specific (e.g. RG switch off, loss of transmission, IP address lease expiration PPPoE session termination, etc) and out of the scope of 3GPP.\nIn routed mode configuration with NAT this procedure is applicable only when IP session from RG is terminated, e.g. when RG switches off or when public IP address assigned to the RG is released, etc. (The termination of connection from a device in LAN, e.g. when device releases the local IP address or it disconnects from WLAN does not trigger the IP-CAN session termination for IP session from RG.)\nPCRF initiated IP-CAN session termination is in accordance with the clause 4.5.9. The term UE in the value of Session-Release-Cause AVP corresponds to the device that accesses the services provided by the network (i.e. either RG, or 3GPP UE or fixed end-device).\nG.5.4\tIP-CAN Session Modification\nG.5.4.1\tPCEF-Initiated IP-CAN Session Modification\nThis clause is related to IP-CAN session modification initiated by PCEF(IP Edge) for IP session. This procedure is in accordance with clause F.4.4.1 of 3GPP TS 29.213 [8].\nThe PCEF(IP Edge) may initiate an IP-CAN Session Modification by sending a CCR command when an event is met according to clause 4.5.1. The PCRF may provide in the CCA command PCC Rules according to clause 4.5.2.0 and Event Triggers according to clause 4.5.3. The PCRF may also provide the Default QoS within the Default‑QoS‑Information AVP. For solicited application reporting with a TDF, the PCRF may provide ADC Rules to the TDF as described in clause 4b.5.1 and Event Triggers according to clause 4b.5.3.\nNOTE 1:\tWhether the Default QoS within the Default-QoS-Information AVP provided by the PCRF corresponds to a dynamic QoS or a default QoS name is subject to operator policies\nThe PCEF(IP Edge) may initiate an IP-CAN Session Modification by sending a CCR command in order to indicate a PCC Rule failure (e.g. release of resources) to the PCRF.\nThe CCR shall include the Charging-Rule-Report AVP indicating the PCC rules that were not accepted and the Rule-Failure-Code AVP indicating the failure cause at command level.\nThe PCRF shall include the result of the procedure in the CCA command.\nG.5.4.2\tPCRF-Initiated IP-CAN Session Modification\nThis procedure is in accordance with clause F.4.4.2 of 3GPP TS 29.213 [8].\nThe PCRF may include in the RAR command the applicable PCC Rules according to clause 4.5.2.0 and Event-Triggers according to clause 4.5.3. The PCRF may also provide the Default QoS within the Default-QoS-Information AVP. For solicited application reporting with a TDF, the PCRF may provide ADC Rules to the TDF according to clause 4b.5.1 and Event Triggers according to clause 4b.5.3.\nNOTE 1:\tWhether the Default QoS within the Default-QoS-Information AVP provided by the PCRF corresponds to a dynamic QoS or a default QoS name is subject to operator policies.\nThe PCEF(IP Edge) shall include the result of the procedure in the RAA command.\nAnnex H (informative):Policy Control for Remote UEs behind a ProSe UE-to-network relay UE\nWith the Proximity-based services, as described in 3GPP TS 23.303 [56] a UE acting as a remote UE can connect to a PDN via a ProSe UE-to-network relay UE, using an IP-CAN session that the ProSe UE-to-network relay UE has established.\nIn this Release of the specification, the following functionalities are required to enable support for policy control for remote UEs:\n-\tThe PDN GW and PCRF are configured with a dedicated APN for ProSe UE-to-network relay connectivity.\n- \tThe remote UE is assigned a 64-bit IPv6 Prefix from a shorter IPv6 prefix by the ProSe UE-to-network relay UE.\n-\tExtendedFilter feature as described in subclause 5.4.1 is supported for the IP-CAN session so that services can be authorized separately for each remote UE.\nNOTE:\tThe non support of any of these conditions will mean that policy control for the remote UE in the established PDN connection will not be supported.\nAnnex I (informative):Change history\nChange history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nSubject/Comment\nOld\nNew\n12-2014\nCT-66\nCP-140922\n1230\n2\nUPCON related update on definition,abbreviation and achitecture part\n12.6.0\n13.0.0\n12-2014\nCT-66\nCP-140935\n1238\n3\nDouble Resource Reuse support over Gx\n12.6.0\n13.0.0\n03-2015\nCT-67\nCP-150131\n1264\nNAS/RAN cause handling\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150135\n1266\nMute-Notification Status on Gx and Sd Session\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150136\n1267\nCorrection to the PC to CS handover indication\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150132\n1268\nRESOURCE_ALLOCATION_FAILURE error response not to be sent upon PCRF-initiated PCC rule\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150133\n1269\nNumber of standard QCI values\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150133\n1270\nNumber of standard QCI values\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150132\n1271\n3GPP2 reference correction\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150132\n1272\nSupport for IPv6 prefix retrieve by the HSGW during the eHRPD pre-registration procedure\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150132\n1274\nCorrection of the REVALIDATION_TIMEOUT event trigger\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150105\n1277\nCorrections to the Used-Service-Unit AVP when UMCH feature is supported\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150111\n1277\nReference update to align with the published BBF document\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150122\n1283\nCorrection on volume and time threshold provisioning\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150114\n1285\n1\nTWAN supports access network information report\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150117\n1287\n3\nCorrection to the PRA reporting\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150128\n1288\n1\nExcluding Usage of a Service/Application from IP-CAN session/TDF session Usage\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150127\n1289\nCompletion of Double Resource Reuse support over Gx\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150106\n1293\n1\nQoS change of default bearer\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150102\n1296\n2\nCorrection about conditions for filter restrictions\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150106\n1301\n2\nCharging correlation identifier for the IP-CAN session in Gx\n13.0.0\n13.1.0\n03-2015\nCT-67\nCP-150102\n1304\n3\nCorrection of TFT handling on default bearer\n13.0.0\n13.1.0\n06-2015\nCT-68\nCP-150363\n1307\n-\nTDF support for downlink packet marking\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150361\n1308\n1\nReport of trust condition in non-3GPP accesses\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150356\n1309\n-\nCorrection for the support of resource sharing\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150345\n1311\n-\nCorrection to the charging identifier scope\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150345\n1313\n2\nQoS change of default bearer\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150363\n1315\n1\nSmall editorial corrections\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150363\n1317\n1\nAdding TWAN and untrusted WLAN release cause\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150363\n1320\n4\nActivate PCC function per UE based on subscription information\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150354\n1322\n4\nPriority of Default Bearer\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150360\n1325\n1\nDiameter overload control over S15 interface\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150362\n1327\n4\nAPN matching procedures\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150362\n1328\n3\nCorrecting Hanging Paragraphs\n13.1.0\n13.2.0\n06-2015\nCT-68\nCP-150344\n1334\n1\nCorrections in Netloc functionality\n13.1.0\n13.2.0\n09-2015\nCT-69\nCP-150482\n1337\n2\nChange of chargeable party when sponsor connectivity applies\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150485\n1340\n2\nControl Plane Address of SGW & AGW\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150491\n1342\n5\nPCC related update over Gx to support NBIFOM\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150485\n1343\n-\nClarification of the P-CSCF restoration indication\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150492\n1344\n1\nUpdate the architecture for FMSS\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150492\n1345\n2\nFunctionalities of PCRF and PCEF to support traffic steering control\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150485\n1346\n2\nCorrection to the indicator to not establish the Gx session\n13.2.0\n13.3.0\n09-2015\nCT-69\nCP-150466\n1349\n1\nUse of the Supported-Features AVP on the Sd reference point\n13.2.0\n13.3.0\n12-2015\nCT-70\nCP-150661\n1335\n1\nReport access network information for NBIFOM\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150647\n1353\n-\nCorrection to the Monitoring-Flag AVP usage\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150661\n1354\n6\nResolve the issues of NBIFOM\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150650\n1356\n2\nGx support for traffic steering control\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150650\n1357\n2\nTraffic steering control support over Sd\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150650\n1359\n6\nTraffic steering control support over St\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150797\n1360\n1\nUpdate the PCC architecture figures in 29.212\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150632\n1365\n9\nOverlapping transaction over Gx\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150668\n1366\n6\nLocation report to support emergency service in Untrusted WLAN access\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150797\n1367\n-\nBCM handling at IP-CAN session establishment and modification\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150661\n1368\n4\nRemoval of editor's notes for NBIFOM\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150661\n1370\n1\nClarify on RAN rule indication\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150661\n1371\n3\nAdd new codes to the Routing-Rule-Failure-Code\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150661\n1372\n1\nUpdate the ROUTING_RULE_REJECTION\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150650\n1375\n9\nDiameter St Protocol\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150630\n1384\n1\nUpdate draft-ietf-dime-ovli reference to RFC 7683\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150629\n1385\n1\nUpdate the PCC architecture to include the Nt reference point\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150631\n1387\n1\nUpdate the reference of draft-ietf-dime-ovli\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150730\n1388\n2\nDiameter message priority for PCC\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150650\n1391\n1\nUpdate the scope to include St interface\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150808\n1392\n1\nClarification of NBIFOM\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150797\n1397\n1\nOCS home domain realm derived from subscriber identity\n13.3.0\n13.4.0\n12-2015\nCT-70\nCP-150797\n1404\n3\nClarification on the use of 3GPP_GPRS and 3GPP_EPS as IP-CAN-Type\n13.3.0\n13.4.0\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2016-03\nCT#71\nCP-160090\n1405\n2\nB\nCompletion of NBIFOM\n13.5.0\n2016-03\nCT#71\nCP-160109\n1406\n2\nB\nTime conditioned APN-AMBR handling\n13.5.0\n2016-03\nCT#71\nCP-160094\n1407\n1\nF\nInclude RCAF in the EPC-routed architecture\n13.5.0\n2016-03\nCT#71\nCP-160107\n1409\n4\nF\nNetwork-initiated removal of one access from the PDN connection\n13.5.0\n2016-03\nCT#71\nCP-160091\n1411\n2\nF\nIPv4 address provisioning\n13.5.0\n2016-03\nCT#71\nCP-160093\n1412\n2\nB\nDiameter Message Priority over diameter based St interface\n13.5.0\n2016-03\nCT#71\nCP-160101\n1413\n1\nF\nConveying the IMEI of devices to the EPC\n13.5.0\n2016-03\nCT#71\nCP-160104\n1414\n-\nF\nTransfer of the serving network identifier\n13.5.0\n2016-03\nCT#71\nCP-160099\n1416\n-\nA\nMissed Fixed-User-Location-Info AVP in CC-request command\n13.5.0\n2016-03\nCT#71\nCP-160101\n1417\n5\nB\nNAS/RAN cause handling at bearer termination failure\n13.5.0\n2016-03\nCT#71\nCP-160092\n1419\n2\nB\nUE-to-network relay PCC handling over Gx\n13.5.0\n2016-03\nCT#71\nCP-160090\n1420\n1\nF\nCorrection for the PCEF procedures\n13.5.0\n2016-03\nCT#71\nCP-160090\n1421\n-\nF\nEditorial correction on DIAMETER_ERROR_NBIFOM_NOT_AUTHORIZED\n13.5.0\n2016-03\nCT#71\nCP-160100\n1424\n1\nA\nClarifications regarding Monitoring-Time procedures\n13.5.0\n2016-03\nCT#71\nCP-160091\n1425\n-\nF\nSt Diameter Application ID\n13.5.0\n2016-03\nCT#71\nCP-160091\n1426\n-\nF\nSt Supported Feature Mechanism Clarifications\n13.5.0\n2016-03\nCT#71\nCP-160091\n1427\n3\nB\nDiameter St Error Notifications\n13.5.0\n2016-03\nCT#71\nCP-160110\n1428\n2\nB\nSupport of bitrate variations\n13.5.0\n2016-03\nCT#71\nCP-160101\n1430\n-\nB\nCR Incorrect use of the term \"full hexadecimal representation\" to mean binary\n13.5.0\n2016-06\nCT#72\nCP-160266\n1432\n2\nA\nSupported feature for charging related error handling over Gx\n13.6.0\n2016-06\nCT#72\nCP-160264\n1433\n-\nF\nSupport of Charging Identifier for the PDN connection in NBIFOM\n13.6.0\n2016-06\nCT#72\nCP-160368\n1435\n5\nF\nPriority sharing for concurrent sessions\n13.6.0\n2016-06\nCT#72\nCP-160255\n1436\n1\nF\nCommand codes for TNR and TNA St messages\n13.6.0\n2016-06\nCT#72\nCP-160264\n1437\n1\nF\nNegotiation on the default access\n13.6.0\n2016-06\nCT#72\nCP-160264\n1438\n1\nF\nDefault access AVP\n13.6.0\n2016-06\nCT#72\nCP-160279\n1439\n1\nF\nCorrection on the PCRF procedures\n13.6.0\n2016-06\nCT#72\nCP-160367\n1440\n5\nB\nRAT-Type extension for NB-IoT\n13.6.0\n2016-06\nCT#72\nCP-160268\n1444\n5\nA\nCorrection to the usage monitoring for sponsored data connectivity\n13.6.0\n2016-06\nCT#72\nCP-160279\n1445\n1\nF\nRemoval of access due to NBIFOM support change\n13.6.0\n2016-06\nCT#72\nCP-160279\n1446\n-\nF\nClarification of network-initiated removal of access\n13.6.0\n2016-06\nCT#72\nCP-160251\n1447\n2\nF\nCorrection to the PCRF behaviour when the sponsoring is disabled\n13.6.0\n2016-06\nCT#72\nCP-160255\n1448\n-\nF\nCorrection to the wrong CR implementation for ADC rule error handling\n13.6.0\n2016-06\nCT#72\nCP-160255\n1449\n1\nF\nTSSF addressing\n13.6.0\n2016-06\nCT#72\nCP-160255\n1456\n2\nF\nSome corrections to the NBIFOM\n13.6.0\n2016-06\nCT#72\nCP-160251\n1458\n2\nF\nPolicy decision based on the transfer policy\n13.6.0\n2016-06\nCT#72\nCP-160255\n1460\n1\nF\nClarification of TDF-Application-ID AVP of Diameter St reference point\n13.6.0\n2016-06\nCT#72\nCP-160280\n1401\n4\nB\nAdding ENODEB_CHANGE event trigger\n14.0.0\n2016-09\nCT#73\nCP-160461\n1462\n1\nA\nAddition of UDP port and ePDG address as untrusted WLAN location\n14.1.0\n2016-09\nCT#73\nCP-160460\n1463\n1\nB\nAdding eNB ID and supported feature for eNB change reporting\n14.1.0\n2016-09\nCT#73\nCP-160442\n1465\n-\nA\nCorrection of IETF drmp draft version\n14.1.0\n2016-09\nCT#73\nCP-160441\n1467\n1\nF\nAdd the missiong abbreviations for NB-IoT\n14.1.0\n2016-09\nCT#73\nCP-160462\n1469\n2\nA\nClarification of creation, modification and deletion of NBIFOM routing rule\n14.1.0\n2016-09\nCT#73\nCP-160455\n1471\n1\nA\nClarification of omission of IP-CAN-Type AVP in the Charging-Rule-Install AVP\n14.1.0\n2016-09\nCT#73\nCP-160455\n1473\n-\nA\nNBIFOM routing rule correction\n14.1.0\n2016-09\nCT#73\nCP-160575\n1475\n2\nA\nPCEF and PCRF procedures for NBIFOM\n14.1.0\n2016-09\nCT#73\nCP-160455\n1477\n1\nA\nUsage monitoring control enhancement for NBIFOM\n14.1.0\n2016-09\nCT#73\nCP-160445\n1480\n1\nA\nChange of ARP or QCI for media flows under priority sharing\n14.1.0\n2016-09\nCT#73\nCP-160455\n1482\n1\nA\nCorrection on the PCEF procedure\n14.1.0\n2016-09\nCT#73\nCP-160455\n1484\n3\nA\nRemoval of an access by PCRF\n14.1.0\n2016-09\nCT#73\nCP-160455\n1486\n1\nA\nCorrection to the routing rule report\n14.1.0\n2016-09\nCT#73\nCP-160456\n1482\n2\nB\nReporting of PLMN identifier in Trusted and Untrusted WLAN\n14.1.0\n2016-09\nCT#73\nCP-160463\n1488\n2\nB\nSupport of sponsored data connectivity for TDF\n14.1.0\n2016-12\nCT#74\nCP-160619\n1491\n4\nA\nOverlapping IP Addresses with FMSS\n14.2.0\n2016-12\nCT#74\nCP-160626\n1494\n1\nA\nAn access becomes not available/available\n14.2.0\n2016-12\nCT#74\nCP-160626\n1496\n1\nA\nPCC Rule decision for NBIFOM\n14.2.0\n2016-12\nCT#74\nCP-160614\n1500\n-\nA\nUsage report when the the AF stops sponsoring\n14.2.0\n2016-12\nCT#74\nCP-160615\n1501\n2\nB\nDiameter Load Control Mechanism\n14.2.0\n2016-12\nCT#74\nCP-160626\n1503\n1\nA\nRemoval of access in NBIFOM\n14.2.0\n2016-12\nCT#74\nCP-160619\n1506\n3\nA\nSupport of deployments with both PCEF/TDF and TSSF\n14.2.0\n2016-12\nCT#74\nCP-160633\n1507\n2\nB\nMSISDN as part of IP-CAN session establishment for emergency sessions\n14.2.0\n2016-12\nCT#74\nCP-160628\n1510\n1\nB\nEncrypted traffic detection by using domain name matching\n14.2.0\n2016-12\nCT#74\nCP-160630\n1513\n3\nF\nUpdate the UE IP address provisioning description in 29.212\n14.2.0\n2016-12\nCT#74\nCP-160630\n1514\n1\nF\nCorrection to clause number of CSG Information Reporting in Table 5b.4\n14.2.0\n2016-12\nCT#74\nCP-160632\n1515\n1\nB\nAdd new QCI values for V2X services\n14.2.0\n2016-12\nCT#74\nCP-160622\n1516\n2\nA\nCorrection of the Mission Critical QCI values\n14.2.0\n2016-12\nCT#74\nCP-160611\n1522\n1\nA\nCorrection to change IETF drmp draft version to official RFC 7944\n14.2.0\n2016-12\nCT#74\nCP-160628\n1523\n2\nB\nCorrection to the sponsored data connectivity supported by the TDF\n14.2.0\n2016-12\nCT#74\nCP-160628\n1524\n2\nB\nAF triggers the activation of PCC/ADC rule with application identifier\n14.2.0\n2016-12\nCT#74\nCP-160628\n1527\n2\nB\nExtend the application detection filter with the PFDs provided by the PFDF for SDCI\n14.2.0\n2016-12\nCT#74\nCP-160616\n1531\n1\nF\nDiameter base protocol specification update\n14.2.0\n2016-12\nCT#74\nCP-160626\n1533\n2\nA\nCorrection to UE requested resource allocation procedure\n14.2.0\n2016-12\nCT#74\nCP-160626\n1535\n1\nA\nCorrection to PCC rule enforcement by the PCEF supporting NBIFOM\n14.2.0\n2016-12\nCT#74\nCP-160630\n1538\n3\nB\nHandling of PCC/QoS rule instance\n14.2.0\n2016-12\nCT#74\nCP-160637\n1540\n1\nA\nAcess Stratum indication for NBIFOM\n14.2.0\n2016-12\nCT#74\nCP-160634\n1542\n3\nB\nSupport of multiple PRAs\n14.2.0\n2016-12\nCT#74\nCP-160638\n1543\n1\nB\nTime conditioned default EPS bearer QoS change\n14.2.0\n2016-12\nCT#74\nCP-160638\n1544\n1\nB\nDynamic PCC rules controlled by PCRF to be bound to the default bearer\n14.2.0\n2017-03\nCT#75\nCP-170086\n1545\n1\nF\nCorrection of time conditioned default EPS bearer QoS change functionality\n14.3.0\n2017-03\nCT#75\nCP-170074\n1546\n-\nF\nCorrection to the multiple PRAs reporting AVPs\n14.3.0\n2017-03\nCT#75\nCP-170074\n1547\n1\nF\nHandling of Vendor-Specific-Application-Id AVPs\n14.3.0\n2017-03\nCT#75\nCP-170086\n1548\n2\nF\nAssociation of content versioning information\n14.3.0\n2017-03\nCT#75\nCP-170074\n1553\n2\nF\nCorrection of multiple PRA handling\n14.3.0\n2017-03\nCT#75\nCP-170074\n1554\n2\nF\nCorrection to the reporting of the presence reporting areas set to active again\n14.3.0\n2017-03\nCT#75\nCP-170086\n1556\n2\nF\nCorrection to the Default-Bearer-Indication AVP\n14.3.0\n2017-03\nCT#75\nCP-170086\n1557\n-\nF\nCorrection to the CondPolicyInfo feature\n14.3.0\n2017-03\nCT#75\nCP-170081\n1558\n2\nC\nPre-emption control for priority sharing\n14.3.0\n2017-03\nCT#75\nCP-170084\n1559\n5\nB\n3GPP PS data off support\n14.3.0\n2017-03\nCT#75\nCP-170086\n1560\n2\nF\nSupport for transport level packet marking\n14.3.0\n2017-03\nCT#75\nCP-170076\n1561\n-\nF\nUpdate instance number for the Failed-AVP in answer commands\n14.3.0\n2017-06\nCT#76\nCP-171119\n1565\n1\nF\nReference update for draft-ietf-dime-load\n14.4.0\n2017-06\nCT#76\nCP-171139\n1568\n3\nF\nCorrections to PS Data Off Support\n14.4.0\n2017-06\nCT#76\nCP-171116\n1571\n1\nF\nApply CHANGE_OF_UE_PRESENCE_IN_PRESENCE_REPORTING_AREA_REPORT to Multiple PRA\n14.4.0\n2017-06\nCT#76\nCP-171133\n1574\n2\nF\nCorrection to the priority sharing\n14.4.0\n2017-06\nCT#76\nCP-171117\n1616\n1\nF\nImpacts of CUPS to PCC reference model\n14.4.0\n2017-06\nCT#76\nCP-171133\n1619\n-\nF\nAdd feature applicability for multiple PRA\n14.4.0\n2017-06\nCT#76\nCP-171133\n1620\n-\nF\nReference correction for NetLoc\n14.4.0\n2017-09\nCT#77\nCP-172044\n1621\n2\nF\nFurther PS data off corrections\n14.5.0\n2017-09\nCT#77\nCP-172043\n1622\n1\nF\nCorrection to the definition of Default-Bearer-Indication\n14.5.0\n2017-09\nCT#77\nCP-172042\n1626\n-\nA\nNetLoc corrections in trusted WLAN\n14.5.0\n2017-09\nCT#77\nCP-172048\n1628\n-\nA\nNetLoc corrections in untrusted WLAN\n14.5.0\n2017-09\nCT#77\nCP-172038\n1623\n1\nB\nExtension of QoS values.\n15.0.0\n2017-09\nCT#77\nCP-172046\n1629\n-\nD\nCorrection for Online AVP description in Sd interface.\n15.0.0\n2017-09\nCT#77\nCP-172051\n1630\n-\nD\nSome corrections of 29.212.\n15.0.0\n2017-12\nCT#78\nCP-173101\n1633\n-\nA\nCorrection for NetLoc in Untrusted WLAN.\n15.1.0\n2017-12\nCT#78\nCP-173094\n1636\n1\nA\nCorrection for NetLoc in Trusted WLAN.\n15.1.0\n2017-12\nCT#78\nCP-173089\n1637\n-\nF\nCorrection for EDCE5.\n15.1.0\n2017-12\nCT#78\nCP-173103\n1638\n-\nF\nCorrections to normative language.\n15.1.0\n2017-12\nCT#78\nCP-173089\n1639\n-\nF\nEDCE5-CT correction.\n15.1.0\n2017-12\nCT#78\nCP-173106\n1639\n2\nB\nPS DATA OFF modification.\n15.1.0\n2018-03\nCT#79\nCP-180047\n1642\nA\nCorrection for Rule-Failure-Code AVP\n15.2.0\n2018-03\nCT#79\nCP-180043\n1646\nA\nTimezone correction for NetLoc in untrusted WLAN\n15.2.0\n2018-03\nCT#79\nCP-180047\n1648\n1\nA\nFlow-Description AVP definition for Sd interface\n15.2.0\n2018-03\nCT#79\nCP-180047\n1650\n1\nA\nFlow-Description AVP definition for St interface\n15.2.0\n2018-03\nCT#79\nCP-180039\n1651\n-\nB\nIntroduction of new QCIs for low latency with normal reliablity requirements\n15.2.0\n2018-03\nCT#79\nCP-180037\n1652\n3\nB\nIP-CAN Type & RAT-Type values for 5GS\n15.2.0\n2018-03\nCT#79\nCP-180049\n1653\n1\nF\nCSG-Information-Reporting missing in RAR\n15.2.0\n2018-03\nCT#79\nCP-180045\n1656\n1\nA\nErroneous M bit setting on Supported-Features\n15.2.0\n2018-03\nCT#79\nCP-180040\n1657\n4\nB\nEnhanced VoLTE performance\n15.2.0\n2018-03\nCT#79\nCP-180039\n1659\n2\nF\nCorrection on Extended-GBR-UL\n15.2.0\n2018-06\nCT#80\nCP-181023\n1661\n-\nB\nQCIs for URLLC\n15.3.0\n2018-06\nCT#80\nCP-181023\n1662\n1\nF\nDefinition of Bit Rate\n15.3.0\n2018-06\nCT#80\nCP-181017\n1665\n2\nF\nDefinition of Maximum Packet Loss Rate AVPs\n15.3.0\n2018-09\nCT#81\nCP-182026\n1666\n4\nF\nPolicy Update when UE suspends\n15.4.0\n2018-09\nCT#81\nCP-182017\n1667\n2\nB\nnew QCI for MCVideo\n15.4.0\n2018-09\nCT#81\nCP-182025\n1670\n2\nA\nApplication report when the PFDs are removed or modified\n15.4.0\n2018-09\nCT#81\nCP-182026\n1671\n1\nF\nExtend RAT type supporting LTE-M\n15.4.0\n2018-12\nCT#82\nCP-183108\n1672\n1\nF\nCorrection to RAT Type\n15.5.0\n2018-12\nCT#82\nCP-183122\n1673\n1\nF\nCorrection of CR implementation error related to RAT-Type AVP\n15.5.0\n2018-12\nCT#82\nCP-183124\n1674\n2\nF\nIntroduction of Presence Reporting Area Node AVP\n15.5.0\n2018-12\nCT#82\nCP-183120\n1675\n1\nF\nCorrection of CR implementation error related to the PFDs management\n15.5.0\n2019-03\nCT#83\nCP-190120\n1676\n1\nF\nCorrection of Extended-Max-Requested-BW-DL parameter name\n15.6.0\n2019-03\nCT#83\nCP-190127\n1679\n2\nA\nTDF application report when the PFDs are removed or modified\n15.6.0\n2019-06\nCT#84\nCP-191095\n1686\n2\nA\nCorrection to MISSING_FLOW_INFORMATION\n15.7.0\n2019-06\nCT#84\nCP-191100\n1681\n1\nF\nUpdate the redirection server address to support dual stack UE\n16.0.0\n2019-09\nCT#85\nCP-192169\n1687\nF\nCorrection in the supported feature name for sponsored connectivity\n16.1.0\n2019-09\nCT#85\nCP-192164\n1688\n1\nB\nSupport for Restricted Local Operator Services\n16.1.0\n2019-09\nCT#85\nCP-192154\n1691\n1\nA\ndraft-ietf-dime-load published as RFC 8583\n16.1.0\n2019-12\nCT#86\nCP-193215\n1692\n4\nB\nCoverage and Handover Enhancements for Media (CHEM)\n16.2.0\n2019-12\nCT#86\nCP-193219\n1694\n1\nF\nCorrect the redirection server address to support dual stack UE\n16.2.0\n2019-12\nCT#86\nCP-193208\n1696\nA\nCorrect transit failure code for UE suspension\n16.2.0\n2019-12\nCT#86\nCP-193221\n1697\n2\nB\nAdding Caller and Callee information\n16.2.0\n2020-03\nCT#87e\nCP-200215\n1698\nB\nSupport of QCI values for Framework for Live Uplink Streaming (FLUS)\n16.3.0\n2020-09\nCT#89e\nCP-202059\n1699\n1\nF\nCorrection on RAT-Type AVP\n16.4.0\n2021-06\nCT#92e\nCP-211226\n1700\n2\nB\n29.212 PCC Support for MPS for DTS\n17.0.0\n2021-06\nCT#92e\nCP-211230\n1701\n1\nF\nClarifiction of PCF Requested Usage Report\n17.0.0\n2021-06\nCT#92e\nCP-211230\n1702\nB\nEroror handling for the deferred rule\n17.0.0\n2021-06\nCT#92e\nCP-211230\n1703\n1\nF\nFailure handling for traffic steering\n17.0.0\n2021-06\nCT#92e\nCP-211253\n1704\n2\nB\nIMEI over Gx Gxx Sd reference points\n17.0.0\n2021-09\nCT#93e\nCP-212212\n1705\n1\nB\n29.212 MPS for DTS QoS update failure\n17.1.0\n2022-03\nCT#95e\nCP-220178\n1706\n1\nF\n29.212 MPS for DTS Notes Correction\n17.2.0\n2022-03\nCT#95e\nCP-220210\n1707\n1\nB\nSupport policy and QoS control for satellite access\n17.2.0\n2022-03\nCT#95e\nCP-220196\n1708\nF\nClarification of the packet filter identifier\n17.2.0\n2022-03\nCT#95e\nCP-220195\n1711\n1\nF\nCorrection to enable retrieval of Network Provided Location information in a MESSAGE request\n17.2.0\n2022-06\nCT#100\nCP-231170\n1713\nF\nCorrections for the RAT types\n17.3.0\n2024-03\nSA#103\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0\n2024-06\nCT#104\nCP-241131\n1714\n1\nB\nAccess control for users with eRedcap/Redcap subscriptions\n18.1.0\n2024-09\nCT#105\nCP-242140\n1717\n1\nF\nAdd clarification regarding the missing RAT type EUTRAN-U\n18.2.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "ts_23.003_clause_9.1",
        "clause_4",
        "clause_5.4.2",
        "clause_2.3",
        "ts_29.229_clause_7.2.1",
        "ts_29.229_clause_7.1.1",
        "clause_5.5",
        "clause_5.5.3",
        "clause_4.5.1",
        "ts_23.060_clause_15.1.1",
        "clause_4.5.2.0",
        "ts_29.213_clause_6.3",
        "clause_4.5.2",
        "clause_4.5.5.1",
        "clause_4.5.5.6",
        "clause_4.5.5.5",
        "clause_4.5.6",
        "clause_4.5.7",
        "clause_4.5.9",
        "clause_4.5.12",
        "clause_4.5.15.2.3",
        "clause_4.5.15.2.4",
        "clause_4.5.18",
        "ts_29.061_clause_13",
        "clause_4.5.22",
        "clause_4.5.5.2",
        "clause_4.5.5.8",
        "clause_4.5.5.3",
        "clause_4.5.5.10",
        "ts_29.213_clause_5.4",
        "clause_5.3.55",
        "clause_4.5.10",
        "clause_5.3.31",
        "clause_5.3.27",
        "clause_5.3.7",
        "ts_23.402_clause_4.1.5",
        "clause_4.4.1",
        "clause_4.4.2",
        "clause_4.5",
        "ts_29.274_clause_7.2.1",
        "clause_3.1",
        "clause_4.5.2.5",
        "clause_4.3",
        "clause_5.3.103",
        "clause_4.5.3",
        "clause_5.4.1",
        "table_5",
        "table_5.4.0.1",
        "ts_23.203_table_6.1.7",
        "ts_29.213",
        "ts_29.061",
        "ts_29.214",
        "ts_23.003",
        "ts_29.229",
        "ts_29.272",
        "ts_32.422",
        "ts_32.299",
        "ts_23.216",
        "ts_29.273",
        "ts_32.295",
        "ts_23.402",
        "ts_29.060",
        "ts_23.060",
        "ts_23.228",
        "ts_24.008",
        "ts_23.203",
        "ts_23.107",
        "ts_29.274",
        "ts_23.401",
        "ts_24.301",
        "ts_23.007",
        "ts_29.275",
        "ts_23.303",
        "ts_15.2",
        "ts_17.0"
      ]
    }
  ]
}