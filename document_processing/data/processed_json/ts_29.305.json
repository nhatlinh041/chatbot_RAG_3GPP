{
  "metadata": {
    "specification_id": "ts_29.305",
    "version": "18.0.0",
    "title": "3GPP TS 29.305",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29305-i00/29305-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:18:41.906881",
    "total_chunks": 83
  },
  "chunks": [
    {
      "chunk_id": "ts_29.305_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document is to specify the InterWorking Functions (IWF)\n-\tbetween MAP-based Gr, Gf interfaces and Diameter-based S6a, S6d, S13, S13a interfaces;\n-\tbetween the S6a interface with SMS subscription data on the MME side and the S6a interface without SMS subscription data plus the MAP-based  D interface for SMS subscription on the HSS side;\n-\tbetween MAP-based C for SMS interface and Diameter-based S6c interface;\n-\tbetween MAP-based E for SMS interface and Diameter-based SGd interface.\nThe InterWorking Function between the S6a interface with SMS subscription data and the S6a interface without SMS subscription data plus the MAP-based  D interface for SMS subscription (S6a/S6a+D) is described in Annex A.\nThe InterWorking Function between MAP-based C for SMS interface and Diameter-based S6c interface is described in Annex A.3\nThe InterWorking Function between MAP-based E for SMS interface and Diameter-based SGd interface is described in Annex A.2\nFor each IWF scenario, the present document will specify the mapping of related procedures and the corresponding parameter handling.\nThe present document will also specify the related mechanisms for the IWF, e.g. message routing, user data handling. The other mechanism, such as security, will also be described in this document as a part of the whole solution.\nIf there is no specific indication, the SGSN in the specification refers to a S4-SGSN which supports S4 interface.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 33.401: \"3GPP System Architecture Evolution: Security Architecture\".\n[3]\t3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System (EPS); Stage 2\".\n[4]\t3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System (EPS); Stage 2\".\n[5]\t3GPP TS 29.272: \"Evolved Packet System (EPS); Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol\".\n[6]\t3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic 3GPP Internet Protocol (IP) access; Stage 2\".\n[7]\t3GPP TS 23.003: \"Numbering, addressing and identification\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_33.401",
        "ts_23.272",
        "ts_29.272",
        "ts_23.204",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.305_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nexample: text used to clarify abstract rules by applying them literally.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.305_3.2",
      "section_id": "3.2",
      "section_title": "Symbols",
      "content": "For the purposes of the present document, the following symbols apply:\n<symbol>\t<Explanation>",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_3.3",
      "section_id": "3.3",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nEPS\tEvolved Packet System\nIWF\tInterworking Function\nTAU\tTracking Area Update",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.1",
      "section_id": "4.1",
      "section_title": "General Description",
      "content": "The interworking scenarios in this specification are described based on interface mapping.\nThe stage 2 network deployments for each of the interworking scenarios are also described.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_4.2.1",
      "section_id": "4.2.1",
      "section_title": "General Description",
      "content": "This interworking scenario is for S6a/S6d interface based on Diameter and Pre Rel8 Gr interface based on MAP with one IWF in the path.\nThis IWF scenario can be an inter PLMN use case.\nThis IWF scenario can be an intra PLMN use case for operator to do the partly update of their legacy network.\nThis interworking scenario is described as below:\nFigure 4.2.1-1 S6a/S6d - Pre Rel8 Gr interworking scenario with one IWF\nThe Pre Rel8 HLR shall be upgraded to support Rel-8 EPS security and Pre Rel8 Gr shall be upgraded to support transfer of Rel-8 security parameters..",
      "chunk_type": "definition",
      "cross_references": [
        "figure_4.2.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.2.2",
      "section_id": "4.2.2",
      "section_title": "Network Deployments",
      "content": "This IWF scenario will apply the following network deployment situation:\n-\tUsers of a Pre Rel8 UMTS/GPRS network access into a visited EPS with only E-UTRAN, which is described as below:\nFigure 4.2.2-1 IWF Scenario one network deployment: visited EPS with E-UTRAN only, home Pre Rel8 UMTS/GPRS only\nThe subscription data for Pre Rel8 Gn/Gp SGSN is downloaded to MME. Mapping of the subscription data is done on MME. Additional security solution is needed in which the Pre Rel8 HLR can not be changed.\n-\tUsers of a Pre Rel8 UMTS/GPRS network access into a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure 4.2.2-2 IWF Scenario one network deployment: visited EPS with E-UTRAN and UTRAN/GERAN, home Pre Rel8 UMTS/GPRS only\nThe subscription data for Pre Rel8 Gn/Gp SGSN is downloaded toSGSN. Mapping of the subscription data is done on SGSN. Security solution is not needed because the security mechanism in visited and home network is the same.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.2-1",
        "figure_4.2.2-2"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.3.1",
      "section_id": "4.3.1",
      "section_title": "General Description",
      "content": "This interworking scenario is for S6a/S6d interface based on Diameter and Rel8 Gr interface based on MAP with one IWF in the path.\nThis IWF scenario can be an inter PLMN use case.\nThis IWF scenario can be an intra PLMN use case for operator to do the partly update of their legacy network.\nThis interworking scenario is described as below:\nFigure 4.3.1-1 S6a/S6d - Rel8 Gr interworking scenario with one IWF",
      "chunk_type": "definition",
      "cross_references": [
        "figure_4.3.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.3.2",
      "section_id": "4.3.2",
      "section_title": "Network Deployments",
      "content": "This IWF scenario will apply the following network deployment situation:\n-\tUsers of a Rel8 UMTS/GPRS network access into a visited EPS with only E-UTRAN, which is described as below:\nFigure 4.3.2-1 IWF Scenario two network deployment: visited EPS with E-UTRAN only, home Rel8 UMTS/GPRS only\nThe subscription data for Rel8 Gn/Gp SGSN is downloaded to MME. Mapping of the subscription data is done on MME. Additional security solution is needed in which the Pre Rel8 HLR can be changed.\n-\tUsers of a Rel8 UMTS/GPRS network access into a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure 4.3.2-2 IWF Scenario two network deployment: visited EPS with E-UTRAN and UTRAN/GERAN, home Rel8 UMTS/GPRS only\nThe subscription data for Rel8 Gn/Gp SGSN is downloaded to SGSN. Mapping of the subscription data is done on SGSN. Security solution is not needed because the security mechanism in visited and home network is the same.\n-\tUsers of a Pre Rel8 UMTS/GPRS/E-UTRAN network access into a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure 4.3.2-3 IWF Scenario two network deployment: visited EPS with E-UTRAN and UTRAN/GERAN, home EPS with E-UTRAN only and Pre Rel8 UMTS/GPRS\nThe subscription data for Pre Rel8 Gn/Gp SGSN and the subscription data for MME is downloaded to SGSN. Mapping of the subscription data is done on SGSN. Security solution is not needed because the security mechanism in visited and home network is the same.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.3.2-1",
        "figure_4.3.2-2",
        "figure_4.3.2-3"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.4.1",
      "section_id": "4.4.1",
      "section_title": "General Description",
      "content": "This interworking scenario is for S6a/S6d interface based on Diameter, S6a/S6d interface based on Diameter and SS7/MAP based roaming agreement with two IWFs in the path.\nWith this interworking scenario, two EPS operators can reuse the SS7 based roaming agreement.\nThis IWF scenario can only be an inter PLMN use case in which the two IWFs are in the VPLMN and HPLMN separately.\nThis interworking scenario is described as below:\nFigure 4.4.1-1 S6a/S6d - S6a/S6d interworking scenario with two IWFs",
      "chunk_type": "definition",
      "cross_references": [
        "figure_4.4.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.4.2",
      "section_id": "4.4.2",
      "section_title": "Network Deployments",
      "content": "This IWF scenario will apply the following network deployment situation:\n-\tUsers of a Pre Rel8 UMTS/GPRS/EPS for UTRAN/GERAN and E-UTRAN network access into a visited EPS with only E-UTRAN, which is described as below:\nFigure 4.4.2-1 IWF Scenario three network deployment: visited EPS with E-UTRAN only, home EPS with E-UTRAN and UTRAN/GERAN and Pre Rel8 UMTS/GPRS\nThe subscription data for Pre Rel8 Gn/Gp SGSN, subscription data for SGSN and the subscription data for MME is downloaded to MME. MME picks up the subscription data for MME and discards the subscription data for Pre Rel8 UMTS/GPRS and the subscription data for SGSN.\n-\tUsers of a Pre Rel8 UMTS/GPRS/EPS for UTRAN/GERAN and E-UTRAN network access into a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure 4.4.2-2 IWF Scenario three network deployment: visited EPS with E-UTRAN only and UTRAN/GERAN, home EPS with E-UTRAN and UTRAN/GERAN and Pre Rel8 UMTS/GPRS\nThe subscription data for Pre Rel8 Gn/Gp SGSN, subscription data for SGSN and the subscription data for MME is downloaded to SGSN or MME. SGSN or MME picks up the subscription data forSGSN or MME and discards the subscription data for Pre Rel8 UMTS/GPRS and the subscription data for MME or SGSN.\n-\tUsers of an EPS for UTRAN/GERAN and E-UTRAN network access into a visited EPS with only E-UTRAN, which is described as below:\nFigure 4.4.2-3 IWF Scenario three network deployment: visited EPS with E-UTRAN only, home EPS with E-UTRAN and UTRAN/GERAN\nThe subscription data for SGSN and the subscription data for MME is downloaded to MME. MME picks up the subscription data for MME and discards the subscription data for the subscription data for SGSN.\n-\tUsers of an EPS for UTRAN/GERAN and E-UTRAN network access into a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure 4.4.2-4 IWF Scenario three network deployment: visited EPS with E-UTRAN and UTRAN/GERAN, home EPS with E-UTRAN and UTRAN/GERAN\nThe subscription data for SGSN and the subscription data for MME is downloaded to SGSN or MME. SGSN or MME picks up the subscription data for SGSN or MME and discards the subscription data for MME or SGSN.\n-\tUsers of a Pre Rel8 UMTS/GPRS/EPS for E-UTRAN only network access into a visited EPS with only E-UTRAN, which is described as below:\nFigure 4.4.2-5 IWF Scenario three network deployment: visited EPS with E-UTRAN only, home ESP with E-UTRAN only and Pre Rel8 UMTS/GPRS\nThe subscription data for Pre Rel8 Gn/Gp SGSN and the subscription data for MME is downloaded to MME. MME picks up the subscription data for MME and discards the subscription data for Pre Rel8 Gn/Gp SGSN.\nNOTE:\tThis IWF scenario can not be used for interworking between two EPS network with only E-UTRAN in which there in no MAP based roaming agreement to be reused.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.4.2-1",
        "figure_4.4.2-2",
        "figure_4.4.2-3",
        "figure_4.4.2-4",
        "figure_4.4.2-5"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.5.1",
      "section_id": "4.5.1",
      "section_title": "General Description",
      "content": "This interworking scenario is for S13/S13' interface based on Diameter and Gf interface based on MAP with one IWF in the path.\nThis IWF scenario can only be an intra PLMN use case for operator to do the partly update of their legacy network.\nThis interworking scenario is described as below:\nFigure 4.5.1-1 S13/S13' - Gf interworking scenario with one IWF",
      "chunk_type": "definition",
      "cross_references": [
        "figure_4.5.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_4.5.2",
      "section_id": "4.5.2",
      "section_title": "Network Deployments",
      "content": "This IWF scenario will apply the following network deployment situation:\n-\tME identity/IMEISV of a user from a Pre Rel8 UMTS/GPRS network can be checked in a visited EPS with E-UTRAN only, which is described as below:\nFigure 4.5.2-1 IWF Scenario for network deployment: UE access from EPS with E-UTRAN only\n-\tME identity/IMEISV of a user from a Pre Rel8 UMTS/GPRS network can be checked in a visited EPS with E-UTRAN and UTRAN/GERAN, which is described as below:\nFigure4.5.2-2 IWF Scenario for network deployment: UE access from EPS with E-UTRAN and UTRAN/GERAN",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.5.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_5.1",
      "section_id": "5.1",
      "section_title": "Message Routing Mechanism",
      "content": "The principles for IWF message routing are:\n-\tFor the same user, the messages shall go to and come back through the same route with the same IWF(s) for the duration of a MAP dialog.\n-\tTo ensure the correct message routing for the interworking scenarios, the IWFs in the network shall be able to map the SS7 number and the Diameter identity of the MME/SGSN 1-to-1. This may be achieved by static or dynamic configuration.\n-\tTo ensure the parallel multiple request messages can get their correct response messages, the IWFs in the network shall be able to map the MAP Dialogue Id and the Diameter Session Id 1-to-1.\nThe overall message routing mechanism for the scenario is described as below:\n1.\tThe MME/SGSN may not be able to identify whether there is an IWF or not on the route to an HSS. The routing of the first message from the MME/SGSN to the IWF/HSS is the same as for a normal Diameter message routing. If the MME/SGSN knows the address/name of the IWF/HSS for a certain user, both the Destination-Realm and Destination-Host AVPs shall be present in the request. Otherwise, only the Destination-Realm AVP shall be present and the command shall be routed to the next Diameter node based on the Diameter routing table in the client.\nWhen the MME/SGSN receives an answer message from the IWF/HSS, it should store the identity of the IWF/HSS for each IMSI for future reference to be able to send messages for the same IMSI.\n2.\tThe IWF shall assign an SS7 number for the Diameter node MME/SGSN and shall assign a Diameter identity for the SS7 node HSS. This may be achieved by static configuration or dynamic assignment when the first signalling exchange occurs between the Diameter/SS7 nodes and the IWF. The IWF shall maintain a mapping table (address mapping table) for the assignment relationship.\nWhen a Diameter message reaches the IWF to set up a new Diameter session, the IWF(s) shall allocate a MAP Dialogue Id for the Diameter session. The IWF(s) shall maintain a mapping table (session mapping table) between the MAP Dialogue Id and the Diameter Session Id.\nThe IWF shall then process messages as described below:\na.\tWhen the IWF receives a Diameter message from a Diameter node, it shall map the Diameter message to a MAP message. It shall obtain a MAP Dialogue Id from the Diameter Session Id in the received message according to the session mapping table. The IWF shall obtain the source/destination SS7 Number from the source/destination Diameter Identity in the received message according to the address mapping table.\nb.\tWhen the IWF receives an SS7 message from an SS7 node, it shall map the MAP message to a Diameter message. It shall obtain the Diameter Session Id from the MAP Dialogue Id in the received message according to the session mapping table. The IWF shall obtain the source/destination Diameter Identity from the source/destination SS7 Number in the received message according to the address mapping table.\n3.\tWhen the HSS/HLR receives the first message from IWF/SGSN, the HSS/HLR shall record the SS7 number of the source for future message handling.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_5.3",
      "section_id": "5.3",
      "section_title": "Security Consideration for IWF",
      "content": "To support the full EPS-AKA security level for the related IWF scenarios, the Pre Rel8 HLR shall be upgraded so that E-UTRAN authentication vector requests from nodes serving E-UTRAN can be identified. The detailed mechanism is described in 3GPP TS 33.401 [2].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_33.401"
      ]
    },
    {
      "chunk_id": "ts_29.305_6.1",
      "section_id": "6.1",
      "section_title": "One IWF scenario",
      "content": "In this scenario, one IWF is located between MME or SGSN or combined MME/SGSN and HSS or one IWF is located between MME and EIR, as illustrated in figure 6.1-1:\nFigure 6.1.-1: One IWF scenarios\nThe IWF needs not to be aware whether its connection via Gr is to an HSS or to a second IWF (see Two IWF scenario).",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.1-1",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_29.305_6.2",
      "section_id": "6.2",
      "section_title": "Two IWF scenario",
      "content": "In this scenario, two IWFs are located between MME or SGSN or combined MME/SGSN and HSS, as illustrated in figure 6.2-1:\nFigure 6.2-1: Two IWFs scenario\nThe IWF1 is located in the VPLMN. IWF2 is located in the HPLMN. The IWF1 needs not to be aware whether its connection via Gr is to an IWF or to an HSS (see One IWF scenario).",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.1.1",
      "section_id": "7.1.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.1.1-1:\nFigure 7.1.1-1: Mapping of Authentication Info Retrieval Procedure for scenario with one IWF\n1.\tThe IWF receives an AIR message from the MME, SGSN or combined MME/SGSN.\n2.\tThe IWF opens a MAP v3 dialogue towards the HSS by sending SendAuthenticationInfo.\n3.\tThe HSS may initiate MAP version fallback and/or send partial results. The IWF performs the version fallback and/or stores the partial results. If EPS-Vectors are requested for immediate use, version fallback is not applicable;\n4.\tThe HSS closes the MAP dialogue by sending the (final) SendAuthenticationInfo Ack to the IWF.\n5.\tThe IWF uses the information received from the HSS to construct an AIA which is sent to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.1.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.1.2",
      "section_id": "7.1.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.1.2-1:\nFigure 7.1.2-1: Mapping of Authentication Info Retrieval Procedure for scenario with two IWFs\n1.\tThe IWF1 receives an AIR message from the MME, SGSN or combined MME/SGSN.\n2.\tThe IWF1 opens a MAP v3 dialogue towards IWF2 by sending SendAuthenticationInfo.\n3.\tThe IWF2 constructs an AIR message and sends it to the HSS.\n4.\tThe IWF2 receives AIA from the HSS.\n5.\tIf segmentation is required, the IWF2 sends partial results to the IWF1 which stores the partial results.\n6.\tThe IWF2 closes the MAP dialogue by sending the (final) SendAuthenticationInfo Ack to IWF1.\n7.\tThe IWF1 uses the information received from the IWF2 to construct an AIA which is sent to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.1.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.2.1",
      "section_id": "7.2.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.2.1-1:\nFigure 7.2.1-1: Mapping of Update Location Procedure for scenario with one IWF\n1.\tThe IWF receives an ULR message from the MME, SGSN or combined MME/SGSN.\n2.\tThe IWF shall open a MAP v3 dialogue towards the HSS by sending UpdateGprsLocation.\n3.\tDepending on \"skip subscriber data\" indication received in the ULR (bullet 1 aboveand hence sent as per bullet 2 in the UpdateGprsLocation), the HSS may continue the MAP dialogue by sending one or several InsertSubscriberData messages (in acknowledgement mode or in burst mode) to the IWF. The IWF then temporarily stores the received data and sends InsertSubscriberData Ack messages to the HSS.\nNote that the HSS may send InsertSubscriberData messages although a \"skip subscriber data\" indication was present. In this case InsertSubscriberData messages received from the HSS shall be acknowledged but need not be stored in the IWF.\nWhen sending InsertSubscriberData Ack messages to the HSS the IWF shall mirror back any services requested by the HSS (within the InsertSubscriberData message) but not supported by the MME or SGSN or combined MME/SGSN (as indicated in 1.ULR). The IWF shall reject a MAP ActivateTraceMode message received from the HSS by returning ActivateTraceMode Error (facilityNotSupported).\nIf the IWF received a MAP ActivateTraceMode message from the HSS, the IWF needs to store the received trace data. Based upon support of tracing (as indicated the ULR received in bullet 1 above), the MME/SGSN sends an ActivateTraceMode Result (positive Ack) or Error FacilityNotSupported (negative Ack) to the HSS.\n4.\tThe HSS shallclose the MAP dialogue by sending UpdateGprsLocation Ack to the IWF.\n5.\tThe IWF shal use the information received from the HSS to construct an ULA which is sent to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.2.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.2.2",
      "section_id": "7.2.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.2.2-1:\nFigure 7.2.2-1: Mapping of Update Location Procedure for scenario with two IWFs\n1.\tThe IWF1 receives an ULR message from the MME, SGSN or combined MME/SGSN.\n2.\tThe IWF1 shall open a MAP v3 dialogue towards IWF2 by sending UpdateGprsLocation.\n3.\tThe IWF2 shall construct a ULR message and shall send it to the HSS.\n4.\tThe IWF2 receives ULA from the HSS.\n5.\tIf subscriber data is included in the ULA(as per bullet 4), the IWF2 shall send one or several InsertSubscriberData messages (in acknowledgement mode or in burst mode) to the IWF1. IWF1 then temporarily stores the received data and sends InsertSubscriberData Ack messages to the IWF2. If trace data is included in the ULA (bullet 4. above) , the IWF2 sends an ActivateTraceMode message to the IWF1, which sends an ActivateTraceMode Ack message to the IWF2.\n6.\tThe IWF2 shall close the MAP dialogue by sending UpdateGprsLocation Ack to IWF1.\n7.\tThe IWF1 shall use the information received from the IWF2 to construct an ULA which shall be sent to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.2.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.3.1",
      "section_id": "7.3.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.3.1-1:\nFigure 7.3.1-1: Mapping of Cancel Location Procedure for scenario with one IWF\n1.\tThe IWF receives a CancelLocation MAP v3 message from the HSS (the IWF shall reject CancelLocation messages in version <3 and shall initiate version fallback when receiving CancelLocation messages in versions >3; not shown in figure 7.3.1-1).\n2.\tThe IWF sends CLR to the MME or SGSN or combined MME/SGSN.\n3.\tThe IWF receives CLA.\n4.\tThe IWF closes the MAP dialogue with the HSS by sending CancelLocation Ack.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.3.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.3.2",
      "section_id": "7.3.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.3.2-1:\nFigure 7.3.2-1: Mapping of Cancel Location Procedure for scenario with two IWFs\n1.\tThe IWF2 receives a CLR message from the HSS.\n2.\tThe IWF2 opens a MAP v3 dialogue towards IWF1 by sending CancelLocation.\n3.\tThe IWF1 constructs a CLR message and sends it to the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF1 receives CLA from the MME, SGSN or combined MME/SGSN.\n5.\tThe IWF1 closes the MAP dialogue with the IWF2 by sending CancelLocation Ack.\n6.\tThe IWF2 sends CLA to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.3.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.4.1",
      "section_id": "7.4.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.4.1-1:\nFigure 7.4.1-1: Mapping of Purge Procedure for scenario with one IWF\n1.\tThe IWF receives a PUR message from the MME, SGSN, or combined MME/SGSN.\n2.\tThe IWF opens a MAP v3 dialogue towards the HSS by sending PurgeMS.\n3.\tThe IWF receives PurgeMS Ack from the HSS.\n4.\tThe IWF sends PUA to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.4.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.4.2",
      "section_id": "7.4.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.4.2-1:\nFigure 7.4.2-1: Mapping of Purge Procedure for scenario with two IWFs\n1.\tThe IWF1 receives a PUR message from the MME, SGSN, or combined MME/SGSN.\n2.\tThe IWF1 opens a MAP v3 dialogue towards IWF2 by sending PurgeMS.\n3.\tThe IWF2 constructs a PUR message and sends it to the HSS.\n4.\tThe IWF2 receives PUA from the HSS.\n5.\tThe IWF2 closes the MAP dialogue with the IWF1 by sending PurgeMS Ack.\n6.\tThe IWF1 sends PUA to the MME, SGSN, or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.4.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.5.1",
      "section_id": "7.5.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.5.1-1:\nFigure 7.5.1-1: Mapping of Insert Subscriber Data Procedure for scenario with one IWF\n1.\tThe IWF receives an (stand alone) InsertSubscriberData or ProvideSubscriberInfo message from the HSS.\n2.\tThe IWF constructs an IDR message and sends it to the MME, SGSN, or combined MME/SGSN.\n3.\tThe IWF receives IDA from the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF sends InsertSubscriberData or ProvideSubscriberInfo Ack to the HSS.\n5.\tSteps 1 to 4 may be repeated several times for InsertSubscriberData. The repetition may be in burst mode or in acknowledge mode.\n6.\tThe HSS closes the MAP dialogue.\nNOTE:\tIn a mapping procedure, the IWF correlates the MAP Dialogue ID of the MAP request message and the Diameter Session-ID of the mapped Diameter request message which is to be used in the subsequent mapping from Diameter Answer message to corresponding MAP Ack message.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.5.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.5.2",
      "section_id": "7.5.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.5.2-1:\nFigure 7.5.2-1: Mapping of Insert Subscriber Data Procedure for scenario with two IWFs\n1.\tThe IWF2 receives a IDR message from the HSS.\n2.\tThe IWF2 opens a MAP v3 dialogue towards IWF1 by sending InsertSubscriberData (if the IDR-Flags AVP within the IDR is not present or the \"UE Reachability Request\" flag was set in the IDR-Flags AVP within the IDR) or ProvideSubscriberInfo in other cases. If segmentation of the data (on MAP level) is required the IWF2 temporarily stores the data that could not be sent in this step.\n3.\tThe IWF1 constructs a IDR message and sends it to the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF1 receives IDA from the MME, SGSN, or combined MME/SGSN.\n5.\tThe IWF1 sends InsertSubscriberData or ProvideSubscriberInfo Ack to IWF2.\n6.\tIf segmentation is required for InsertSubscriberData, steps 2 to 5 are be repeated until all data are sent. Repetition may be in burst mode or in acknowledge mode.\n7.\tIWF2 closes the MAP dialogue with IWF1.\n8.\tIWF2 sends IDA to the HSS.\nNOTE:\tIn a mapping procedure, the IWFs correlates the MAP Dialogue ID of the MAP request message and the Diameter Session-ID of the mapped Diameter request message which is to be used in the subsequent mapping from Diameter Answer message to corresponding MAP Ack message or vice versa.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.5.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.6.1",
      "section_id": "7.6.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.6.1-1:\nFigure 7.6.1-1: Mapping of Delete Subscriber Data Procedure for scenario with one IWF\n1.\tThe IWF receives a DeleteSubscriberData MAP v3 message from the HSS (the IWF shall reject DeleteSubscriberData messages in version <3 and shall initiate version fallback when receiving DeleteSubscriberData messages in versions >3; not shown in figure 7.6.1-1).\n2.\tThe IWF sends DSR to the MME or SGSN or combined MME/SGSN.\n3.\tThe IWF receives DSA.\n4.\tThe IWF closes the MAP dialogue with the HSS by sending DeleteSubscriberData Ack.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.6.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.6.2",
      "section_id": "7.6.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.6.2-1:\nFigure 7.6.2-1: Mapping of Delete Subscriber Data Procedure for scenario with two IWFs\n1.\tThe IWF2 receives a DSR message from the HSS.\n2.\tThe IWF2 opens a MAP v3 dialogue towards IWF1 by sending DeleteSubscriberData.\n3.\tThe IWF1 constructs a DSR message and sends it to the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF1 receives DSA from the MME, SGSN or combined MME/SGSN.\n5.\tThe IWF1 closes the MAP dialogue with the IWF2 by sending DeleteSubscriberData Ack.\n6.\tThe IWF2 sends DSA to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.6.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.7.1",
      "section_id": "7.7.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.7.1-1:\nFigure 7.7.1-1: Mapping of Reset Procedure for scenario with one IWF\n1.\tThe IWF receives a Reset MAP v1 or v2 message from the HSS.\n2.\tThe IWF sends RSR to the MME or SGSN or combined MME/SGSN.\n3.\tThe IWF receives RSA.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.7.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.7.2",
      "section_id": "7.7.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.7.2-1:\nFigure 7.7.2-1: Mapping of Reset Procedure for scenario with two IWFs\n1.\tThe IWF2 receives a RSR message from the HSS.\n2.\tThe IWF2 opens a MAP v1 or v2 (vendor option) dialogue towards IWF1 by sending Reset.\n3.\tThe IWF2 sends RSA to the HSS.\n4.\tThe IWF1 constructs a RSR message and sends it to the MME, SGSN, or combined MME/SGSN.\n5.\tThe IWF1 receives RSA from the MME, SGSN or combined MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.7.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.8.1",
      "section_id": "7.8.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.8.1-1:\nFigure 7.8.1-1: Mapping of Notification Procedure for scenario with one IWF\n1.\tThe IWF receives a NOR message from the MME, SGSN, or combined MME/SGSN.\n2.\tThe IWF sends UpdateGprsLocation or ReadyForSM to the HSS.\n3.\tThe IWF sends NOA to the MME, SGSN, or combined MME/SGSN.\n4.\tThe HSS (if it does not support the \"skip subscriber data\" indication) may continue the MAP dialogue by sending InsertSubscriberData messages which are positively acknowledged and discarded by the IWF.\n5.\tThe HSS closes the MAP dialogue by sending UpdateGprsLocation Ack or ReadyForSM Ack.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.8.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.8.2",
      "section_id": "7.8.2",
      "section_title": "Two IWFs Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.8.2-1:\nFigure 7.8.2-1: Mapping of Notification Procedure for scenario with two IWFs\n1.\tThe IWF1 receives a NOR message from the MME, SGSN, or combined MME/SGSN.\n2. \tThe IWF1 sends UpdateGprsLocation or ReadyForSM to the  IWF2.\n3.\tThe IWF1 sends NOA to the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF2 sends NOR to the HSS.\n5.\tThe IWF2 closes the MAP dialogue with IWF1 by sending UpdateGprsLocation Ack or ReadyForSM Ack.\n6.\tThe IWF2 receives NOA from the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.8.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.9.1",
      "section_id": "7.9.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.9.1-1:\nFigure 7.9.1-1: Mapping of IMEI Check Procedure with one IWF\n1.\tThe IWF receives an ECR message from the MME/SGSN.\n2.\tThe IWF sends Check IMEI to the EIR.\n3.\tThe IWF receives Check IMEI Ack from the EIR.\n4.\tThe IWF sends ECA to the MME/SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.9.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.10.1",
      "section_id": "7.10.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.10.1-1:\nFigure 7.10.1-1: Mapping of Trace Activation Procedure for scenario with one IWF\n1.\tThe IWF receives an ActivateTraceMode message from the HSS.\n2.\tThe IWF shall construct an IDR message and send it to the MME, SGSN, or combined MME/SGSN.\n3.\tThe IWF receives IDA from the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF shall send an ActivateTraceMode Ack to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.10.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.10.2",
      "section_id": "7.10.2",
      "section_title": "Two IWFs Scenario",
      "content": "Figure 7.10.2-1: Mapping of Trace Activation Procedure for scenario with two IWFs\n1.\tThe IWF2 receives an IDR message from the HSS.\n2.\tIf the IWF2 finds that Trace Data is included in the IDR, it shall open a MAP v3 dialogue towards IWF1 by sending ActivateTraceMode.\n3.\tThe IWF1 shall construct an IDR message and shall send it to the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF1 receives IDA from the MME, SGSN, or combined MME/SGSN.\n5.\tThe IWF1 shall send an ActivateTraceMode Ack to IWF2.\n6.\tIWF2 shall send an IDA to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.10.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.11.1",
      "section_id": "7.11.1",
      "section_title": "One IWF Scenario",
      "content": "The mapping of procedures for this scenario is shown in figure 7.11.1-1:\nFigure 7.11.1-1: Mapping of Trace Deactivation Procedure for scenario with one IWF\n1.\tThe IWF receives a DeactivateTraceMode message from the HSS.\n2.\tThe IWF shall construct a DSR message and shall send it to the MME, SGSN, or the combined MME/SGSN.\n3.\tThe IWF receives DSA from the MME, SGSN, or combined MME/SGSN.\n4.\tThe IWF shall send a DeactivateTraceMode Ack to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.11.1-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_7.11.2",
      "section_id": "7.11.2",
      "section_title": "Two IWFs Scenario",
      "content": "Figure 7.11.2-1: Mapping of Trace Deactivation Procedure for scenario with two IWFs\n1.\tThe IWF2 receives a DSR message from the HSS.\n2.\tIf the IWF2 finds that a Trace Data Withdrawal indication is included in the DSR, it shall open a MAP v3 dialogue towards IWF1 by sending DeactivateTraceMode.\n3.\tThe IWF1 shall construct a DSR message and shall send it to the MME, SGSN, or the combined MME/SGSN.\n4.\tThe IWF1 receives DSA from the MME, SGSN, or combined MME/SGSN.\n5.\tThe IWF1 shall send a DeactivateTraceMode Ack to the IWF2.\n6.\tThe IWF2 shall send a DSA to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_7.11.2-1"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.1.1",
      "section_id": "8.1.1",
      "section_title": "AIR mapping to SendAuthenticationInfoArg (v3)",
      "content": "When the IWF needs to construct a MAP-SendAuthenticationInfo message as a result of receiving an AIR command (see sections 7.1.1 step 2, and 7.1.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of SendAuthenticationInfoArg as described below:\nimsi in SendAuthenticationInfoArg shall be populated with the value of the User-Name AVP received within AIR.\nIf AIR contains a Requested-EUTRAN-Authentication-Info AVP but does not contain a Requested-UTRAN-GERAN-Authentication-Info AVP:\nnumberOfRequestedVectors in SendAuthenticationInfoArg shall be populated with the value of the Number-Of-Requested-Vectors AVP received within the Requested-EUTRAN-Authentication-Info AVP received within AIR.\nIf AIR contains a Requested-UTRAN-GERAN-Authentication-Info AVP but does not contain a Requested-EUTRAN-Authentication-Info AVP:\nnumberOfRequestedVectors in SendAuthenticationInfoArg shall be populated with the value of the Number-Of-Requested-Vectors AVP received within the Requested-UTRAN-GERAN-Authentication-Info AVP received within AIR.\nIf AIR contains a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP, and the Immediate-Response-Preferred AVP is present within the Requested-EUTRAN-Authentication-Info AVP:\nnumberOfRequestedVectors in SendAuthenticationInfoArg shall be populated with the value of the Number-Of-Requested-Vectors AVP received within the Requested-EUTRAN-Authentication-Info AVP received within AIR.\nIf AIR contains a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP, and the Immediate-Response-Preferred AVP is not present within the Requested-EUTRAN-Authentication-Info AVP:\nnumberOfRequestedVectors in SendAuthenticationInfoArg shall be populated with the value of the Number-Of-Requested-Vectors AVP received within the Requested-UTRAN-GERAN-Authentication-Info AVP received within AIR.\nsegmentationProhibited shall be absent in SentAuthenticationInfoArg.\nIf AIR contains a Requested-EUTRAN-Authentication-Info AVP but does not contain a Requested-UTRAN-GERAN-Authentication-Info AVP:\nimmediateResponsePreferred in SendAuthenticationInfoArg shall be present if and only if the Immediate-Response-Preferred AVP is present within the Requested-EUTRAN-Authentication-Info AVP within AIR.\nIf AIR contains a Requested-UTRAN-GERAN-Authentication-Info AVP but does not contain a Requested-EUTRAN-Authentication-Info AVP:\nimmediateResponsePreferred in SendAuthenticationInfoArg shall be present if and only if the Immediate-Response-Preferred AVP is present within the Requested-UTRAN-GERAN-Authentication-Info AVP within AIR.\nIf AIR contains a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP:\nimmediateResponsePreferred in SendAuthenticationInfoArg shall be present if and only if the Immediate-Response-Preferred AVP is present within the Requested-UTRAN-GERAN-Authentication-Info AVP or within the Requested-EUTRAN-Authentication-Info AVP within AIR.\nre-synchronisationInfo in SendAuthenticationInfoArg shall be present if and only if a Re-synchronization-Info AVP is present wihin the Requested-EUTRAN-Authentication-Info AVP or within the Requested-UTRAN-GERAN-Authentication-Info AVP within AIR.\nextensionContainer in SendAuthenticationInfoArg shall be absent.\nrequestingNodeType in SendAuthenticationInfoArg shall be present and shall be populated with the value  \t\"mme\" if a Requested-EUTRAN-Authentication-Info AVP and no Requested-UTRAN-GERAN-Authentication-Info AVP was present within AIR; \t\"sgsn\" if a Requested-UTRAN-GERAN-Authenticatio-Info AVP and no Requested EUTRAN-Authentication-Info AVP was present within  AIR;.\t\"mme-sgsn\" if both a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP were present within AIR .\nrequestingPLMN-Id in SendAuthenticationInfoArg shall be present and shall be populated with the value received within the Visited-PLMN-ID AVP within AIR.\nnumberOfRequestedAdditional-Vectors in SendAuthenticationInfoArg shall be present if and only if both a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP are present within AIR. If present, the parameter shall be populated with the value received in the Number-Of-Requested-Vectors AVP within the Requested-EUTRAN-Authentication-Info (if the Immediate-Response-Preferred AVP is absent within Requested-EUTRAN-Authentication-Info AVP within AIR) or with the value received in the Number-Of-Requested-Vectors AVP within the Requested-UTRAN-GERAN-Authentication-Info AVP (otherwise).\nadditionalVectorsAreForEPS shall be present in SendAuthenticationInfoArg if and only if a Requested-EUTRAN-Authentication-Info AVP and a Requested-UTRAN-GERAN-Authentication-Info AVP are present within AIR and the Immediate-Response-Preferred AVP is absent in the Requested-EUTRAN-Authentication-Info AVP.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.2",
      "section_id": "8.1.2",
      "section_title": "AIR mapping to SendAuthenticationInfoArg (v2)",
      "content": "When the IWF needs to construct a MAP-SendAuthenticationInfo message in MAP AC version 2 as a result of MAP version negotiation (see sections 7.1.1 step 3), the IWF shall open a MAP dialogue in application context version 2 and populate sub-parameters of SendAuthenticationInfoArg as described below:\nimsi in SendAuthenticationInfoArg shall be populated with the value of the User-Name AVP received within AIR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.3",
      "section_id": "8.1.3",
      "section_title": "AIR mapping to SendParametersArg (v1)",
      "content": "When the IWF needs to construct a MAP-SendParameters message in MAP AC version 1 as a result of MAP version negotiation (see section 7.1.1 step 3), the IWF shall open a MAP dialogue in application context version 1 and populate sub-parameters of SendParametersArg as described below:\nsubscriberId in SendParametersArg shall take the imsi alternative; imsi shall be populated with the value of the User-Name AVP received within AIR.\nrequestedParameterList in SendParametersArg shall contain one RequestParameter which contains the value of \"requestAuthenticationSet\".",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_7.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.1.4",
      "section_id": "8.1.4",
      "section_title": "SendAuthenticationInfoRes / Error (v3) mapping to AIA",
      "content": "When the IWF needs to construct an AIA command as a result of receiving a SendAuthenticationInfo Ack/Error message in MAP version 3 (see sections 7.1.1 step 5, and 7.1.2 step 7), the IWF shall populate AVPs of AIA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a SendAuthenticationInfoRes parameter was received in a TCAP ResultLast component;\n-\tDIAMETER_ERROR_USER_UNKNOWN if an error of unknownSubscriber without a diagnostic parameter or with a diagnostic parameter of imsiUnknown was received;\n-\tDIAMETER_ERROR_UNKNOWN_SUBSCRIPTION if an error unknownSubscriber with a diagnostic parameter of gprs-eps-SubscriptionUnknown was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be absent.\nAuthentication-Info AVP shall be present if authenticationSetList or eps-AuthenticationSetList is present in the received SendAuthenticationInfoRes. If present, the AVP shall contain EPS-Vector AVPs and/or either UTRAN-Vector AVPs or GERAN-Vector AVPs as mapped from received EPC-AVs and/or either AuthenticationQuintuplets or AuthenticationTriplets respectively.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.5",
      "section_id": "8.1.5",
      "section_title": "SendAuthenticationInfoRes / Error (v2) mapping to AIA",
      "content": "When the IWF needs to construct an AIA command as a result of receiving a SendAuthenticationInfo Ack/Error message in MAP version 2 (see sections 7.1.1 step 5), the IWF shall  populate AVPs of AIA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if aSendAuthenticationInfoRes parameter was received in a TCAP ResultLast component;\n-\tDIAMETER_ERROR_USER_UNKNOWN if an error of unknownSubscriber without a diagnostic parameter or with a diagnostic parameter of imsiUnknown was received;\n-\tDIAMETER_ERROR_UNKNOWN_SUBSCRIPTION if an error unknownSubscriber with a diagnostic parameter of gprsSubscriptionUnknown was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be absent.\nAuthentication-Info AVP shall be present if authenticationSetList is present in the received SendAuthenticationInfoRes. If present, the AVP shall contain GERAN-Vector AVPs as mapped from received AuthenticationTriplets.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.6",
      "section_id": "8.1.6",
      "section_title": "SendParameterList / Error (v1) mapping to AIA",
      "content": "When the IWF needs to construct an AIA command as a result of receiving a SendParameters Ack/Error message in MAP version 1 (see sections 7.1.1 step 5), the IWF shall  populate AVPs of AIA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\nDIAMETER_SUCCESS if a SentParameterList parameter was received in a TCAP ResultLast component;\nDIAMETER_ERROR_USER_UNKNOWN if an error of unknownSubscriber was received;\nan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be absent.\nAuthentication-Info AVP shall be present if sentParameterList is present in the received TCAP ResultLast component. If present, the AVP shall contain GERAN-Vector AVPs as mapped from received AuthenticationTriplets.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.7",
      "section_id": "8.1.7",
      "section_title": "SendAuthenticationInfoArg (v3) mapping to AIR",
      "content": "When the IWF needs to construct an AIR command as a result of receiving a SendAuthenticationInfo message in MAP version 3 (see sections 7.1.2 step 3), the IWF shall  populate AVPs of AIR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of SendAuthenticationInfoArg.\nSupported-Features AVP shall be absent.\nRequested-EUTRAN-Authentication-Info AVP shall be present if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme\" or \"mme-sgsn\".\nNumber-Of-Requested-Vectors AVP within Requested-EUTRAN-Authentication-Info AVP (if present) shall be populated with\na)\tthe value received within the numberOfRequestedVectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme\";\nb)\tthe value received within the numberOfRequestedVectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and the additionalVectorsAreForEPS parameter is absent from SendAuthenticationInfoArg;\nc)\tthe value received within the numberOfRequestedAdditional-Vectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and the additionalVectorsAreForEPS parameter is present within SendAuthenticationInfoArg.\nImmediate-Response-Preferred AVP within Requested-EUTRAN-Authentication-Info AVP (if present) shall be present if:\na)\trequestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme\" and immediateResponsePreferred parameter is present in SendAuthenticationInfoArg, or\nb)\trequestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and additionalVectorsAreForEPS parameter is absent from SendAuthenticationInfoArg and immediateResponsePreferred is present within SendAuthenticationInfoArg.\nRe-synchronization-Info AVP within Requested-EUTRAN-Authentication-Info AVP (if present) shall be populated with the value received in the re-synchronizationInfo parameter within SendAuthenticationInfoArg.\nRequested-UTRAN-GERAN-Authentication-Info AVP shall be present if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"sgsn\" or \"mme-sgsn\".\nNumber-Of-Requested-Vectors AVP within Requested-UTRAN-GERAN-Authentication-Info AVP (if present) shall be populated with:\na)\tthe value received within the numberOfRequestedVectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"sgsn\";\nb)\tthe value received within the numberOfRequestedVectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and the additionalVectorsAreForEPS parameter is present within SendAuthenticationInfoArg;\nc)\tthe value received within the numberOfRequestedAdditional-Vectors parameter of SendAuthenticationInfoArg if requestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and the additionalVectorsAreForEPS parameter is absent from SendAuthenticationInfoArg.\nImmediate-Response-Preferred AVP within Requested-UTRAN-GERAN-Authentication-Info AVP (if present) shall be present if\na)\trequestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"sgsn\" and immediateResponsePreferred parameter is present in SendAuthenticationInfoArg, or\nb)\trequestingNodeType parameter within SendAuthenticationInfoArg takes the value of \"mme-sgsn\" and additionalVectorsAreForEPS parameter is present from SendAuthenticationInfoArg and immediateResponsePreferred is present within SendAuthenticationInfoArg.\nRe-synchronization-Info AVP within Requested-EUTRAN-Authentication-Info AVP (if present) shall be populated with the value received in the re-synchronizationInfo parameter within SendAuthenticationInfoArg.\nVisited-PLMN-Id AVP shall be populated with the value of the requestingPLMN-Id parameter received within SendAuthenticationInfoArg.\nRequestingNodeType AVP shall be populated with the value of the requestingNodeType parameter received within SendAuthenticationInfoArg.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.1.8",
      "section_id": "8.1.8",
      "section_title": "AIA mapping to SendAuthenticationInfoRes/Error (v3)",
      "content": "When the IWF needs to construct a MAP SendAuthenticationInfo Ack message (v3) as a result of receiving an AIA command (see sections 7.1.2 steps 5 and 6), the IWF shall construct partial result messages (if segmentation is required) and a final result message or an error message (if the Result-Code AVP within AIA takes a value different from \"success\"). Sub-parameters of SendAuthenticationInfoRes shall be populated as described below:\nauthenticationSetList within SendAuthenticationInfoRes shall be present if UTRAN-Vector AVP or GERAN-Vector AVP is present in Authentication-Info AVP within AIA. If so the parameter shall be populated with the value received within the UTRAN-Vector AVP or GERAN-Vector AVP (whichever is present).\neps-AuthenticationSetList within SendAuthenticationInfoRes shall be present if EPS-Vector AVP is present in Authentication-Info AVP within AIA. If so the parameter shall be populated with the values received within the EPS-Vector AVP.\nAn error of unknownSubscriber with unknownSubscriberParam containing a unknownSubscriberDiagnostic of \"imsiUnknown\" shall be sent if the received AIA command contains an Experimental-Result AVP with a value of \"User Unknown\".\nAn error of unknownSubscriber with unknownSubscriberParam containing a unknownSubscriberDiagnostic of \"gprs-epsSubscriptionUnknown\" shall be sent if the received AIA command contains an Experimental-Result AVP with a value of \"Unknown EPS Subscription\".\nOther values within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.2.1",
      "section_id": "8.2.1",
      "section_title": "ULR mapping to UpdateGprsLocationArg",
      "content": "When the IWF needs to construct a MAP-UpdateGprsLocation message as a result of receiving an ULR command (see sections 7.2.1 step 2, and 7.2.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of UpdateGprsLocationArg as described below:\nimsi in UpdateGprsLocationArg shall be populated with the value of the User-Name AVP received within ULR.\nsgsn-Number in UpdateGprsLocationArg shall be populated with the value of the SGSN.Number AVP if present within ULR, otherwise it shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\nsgsn-Address in UpdateGprsLocationArg shall be populated with the IP-address of the source node sending the ULR command.\nextensionContainer in UpdateGprsLocationArg shall be absent.\nsgsn-Capability in UpdateGprsLocationArg shall be populated as follows:\n-\tsolsaSupportIndicator shall be absent;\n-\textensionContainer shall be absent;\n-\tsuperChargerSupportedInServingNetworkEntity shall be absent;\n-\tgprsEnhancementSupportIndicator shall be present;\n-\tsupportedCamelPhases shall be absent or shall indicate no support of any CAMEL phase;\n-\tsupportedLCS-CapabilitySet shall be absent or shall indicate no support of any LCS capability set;\n-\tofferedCamel4CSIs shall be absent;\n-\tsmsCallBarringSupportIndicator shall be absent;\n-\tsupportedRAT-TypesIndicator shall be present and populated with the value received  within the RAT-Type AVP in the received ULR;\n-\tsupportedFeatures shall be present if a SupportedFeature AVP was present in the received ULR which indicated support of odbs and regsubs.\ninformPreviousNetworkEntity in UpdateGprsLocationArg shall be absent;\nps-LCS-NotSupportedByUE in UpdateGprsLocationArg shall be absent\nv-gmlc-Address in UpdateGprsLocationArg shall be absent.\nadd-info in UpdateGprsLocationArg shall be present if a Terminal-Information AVP was present in the received ULR. If present the parameter shall be poulated with the received IMEI and software version; skipSubscriberDataUpdate in add-info shall be absent.\neps-info in UpdateGprsLocationArg shall be present.\n-\tif the S6a/S6d indicator within the ULR-Flags AVP was set, the parameter shall contain isr-Information with updateLocation indication, and if a Single-Registration-Indication was present in the received ULR-Flags AVP then the isr-Information shall also contain a cancelSGSN indication, and if an InitialAttachIndicator was present in the received ULR-Flags AVP then the isr-Information shall also contain initialAttachIndicator;\n-\tif the S6a/S6d indicator within the ULR-Flags was not set, the parameter shall contain isr-Information with updateLocation indication, and if an InitialAttachIndicator was present within the ULR-Flags AVP, the parameter shall contain isr-Information with initialAttachIndicator.\nservingNodeTypeIndicator in UpdateGprsLocationArg shall be present if the S6a/S6d-Indicator was present in the ULR-Flags AVP within the received ULR.\nskipSubscriberData Update in UpdateGprsLocationArg shall be present if a skip subscriber data indication was receive within the ULR-Flags within ULR.\nusedRAT-Type in UpdateGprsLocationArg shall be populate with the value received within the RAT-Type AVP within ULR.\ngprsSubscriptionDataNotNeeded in UpdateGprsLocationArg shall be present if bit 3 (GPRS-Subscription-Data-Indicator) was not set in the ULR-Flags AVP received within ULR.\nnodeTypeIndicator in UpdateGprsLocationArg shall be present if bit 4 (Node-Type-Indicator) was set in the ULR-Flags AVP received within ULR.\nareaRestricted in UpdateGprsLocationArg shall be absent.\nue-reachableIndicator in UpdateGprsLocationArg shall be absent.\nue-srvcc-Capability in UpdateGprsLocationArg shall be present if a UE-SRVCC-Capability AVP was present in the received ULR. If present the parameter shall be populated with the received ue-srvcc-Capability.\nmmeNumberforMTSMS in UpdateGprsLocationArg shall be populated with the value of the MME-Number-for-MT-SMS AVP if present within ULR.\nsms-Only in UpdateGprsLocationArg shall be populated with the value of the SMS-Only AVP if present within ULR.\nsmsRegisterRequest in UpdateGprsLocationArg shall be populated with the value of the SMS-Register-Request AVP if present within ULR.\nadjacentPLMN-List in UpdateGprsLocationArg shall be constructed with the values of the Adjacent-PLMNs grouped AVP, if present within ULR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.2.2",
      "section_id": "8.2.2",
      "section_title": "UpdateGprsLocationRes/Error/InsertSubscriberDataArg/ActivateTraceModeArg mapping to ULA",
      "content": "When the IWF needs to construct an ULA command as a result of receiving an UpdateGprsLocation Ack/Error message (see sections 7.2.1 step 5, and 7.2.2 step 7), the IWF shall populate AVPs of ULA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if an UpdateGprsLocationRes parameter was received in a TCAP ResultLast component;\n-\tDIAMETER_ERROR_USER_UNKNOWN if an error of unknownSubscriber without a diagnostic parameter or with a diagnostic parameter of imsiUnknown was received;\n-\tDIAMETER_ERROR_UNKNOWN_SUBSCRIPTION if an error of unknownSubscriber with a diagnostic parameter of gprs-eps-SubscriptionUnknown was received;\n-\tDIAMETER_ERROR_RAT_NOT_ALLOWED if an error of roamingNotAllowed with a roamingNotAllowedParam containing an additionalRoamingNotAllowedCause of \"supportedRAT-TypesNotAllowed\" was received;\n-\tDIAMETER_ERROR_ROAMING_NOT_ALLOWED if an error of roamingNotAllowed without \"supportedRAT-TypesNotAllowed\" was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be absent.\nULA-Flags AVP: Flags shall be set as follows:\n-\tSeparationIndication shall be set to 1 if the sgsn-mmeSeparationSupported parameter was present within UpdateGprsLocationRes; otherwise shall be set to 0.\n-\tMME Registered for SMS shall be set to 1 if the mmeRegisteredforSMS parameter was present within UpdateGprsLocationRes; otherwise shall be set to 0.\nSubscription-Data AVP shall be present if MAP InsertSubscriberData messages have been received from the HSS and a \"skip-subscriber-Data\" indication was not present in the received ULR command or a MAP ActivateTraceMode message has been received from the HSS. If present the AVP shall be populated as follows:\nSubscriber status AVP shall be present if a subscriberStatus parameter was present in a received SubscriberData parameter within InsertSubscriberDataArg. If so, values shall be mapped appropriately.\nMSISDN AVP shall be present if an msisdn parameter was present in a received SubscriberData parameter within InsertSubscriberDataArg.\nSTN-SR AVP shall be present if an stn-sr parameter was present in a received EPS-SubscriptionData parameter within InsertSubscriberDataArg.\nNetwork-Access-Mode AVP shall be present if a networkAccessMode parameter was present within InsertSubscriberDataArg.\nOperator-Determined-Barring AVP shall be present if an odb-GeneralData parameter was present within an odb-Data parameter within a SubscriberData parameter within InsertSubscriberDataArg.\nHPLMN-ODB AVP shall be present if an odb-HPLMN-Data parameter was present within an odb-Data parameter within a SubscriberData parameter within InsertSubscriberDataArg.\nRegional-Subscription-Zone-Code AVPs shall be present if ZoneCodes were present within an regionalSubscriptionData parameter within a SubscriberData parameter within InsertSubscriberDataArg.\nAccess-Restriction-Data AVP shall be present if accessRestrictionData or ext-AccessRestrictionData parameters were present within InsertSubscriberDataArg, and/or a ho-to-non-3GPP-Access-Not-Allowed parameter was present in an eps-SubscriptionData parameter within InsertSubscriberDataArg.\nAPN-OI-Replacement AVP shall be present if an apn-oi-Replacement parameter was present within an eps-SubscriptionData parameter within InsertSubscriberDataArg.\n3GPP-Charging-Characteristics AVP shall be present if a chargingCharacteristics parameter was present within InsertSubscriberDataArg.\nAMBR AVP shall be present if an ambr parameter was present within an eps-SubscriptionData parameter within InsertSubscriberDataArg.\nAPN-Configuration-Profile AVP shall be present if an apn-ConfigurationProfile parameter was present within an eps-SubscriptionData parameter within InsertSubscriberDataArg.\nRAT-Frequency-Selection-Priority-ID AVP shall be present if a rfsp-id parameter was present within an eps-SubscriptionData parameter within InsertSubscriberDataArg.\nAdjacent-Access-Restriction-Data AVP shall be present if adjacentAccessRestrictionDataList was present within InsertSubscriberDataArg.\n-\tIMSI-Group-Id AVP shall be present if imsi-Group-Id-List was present within InsertSubscriberDataArg.\n-\tTrace-Data AVP shall be present if a MAP ActivateTraceMode message has been received from the HSS. Sub-AVPs in Trace-Data AVP shall be populated as follows:\n-\tTrace-Reference AVP shall be present and populated with the values received within the traceReference and traceReference2 parameters within ActivateTraceModeArg.\n-\tTrace-Depth-List AVP shall be present if a Trace-DepthList parameter was present within ActivateTraceModeArg.\n-\tTrace-NE-Type-List AVP shall be present if a TraceNE-TypeList parameter was present within ActivateTraceModeArg.\n-\tTrace-Depth-List AVP shall be present if a Trace-DepthList parameter was present within ActivateTraceModeArg.\n-\tTrace-Interface-List AVP shall be present if a TraceInterfaceList parameter was present within ActivateTraceModeArg.\n-\tTrace-Event-List AVP shall be present if a TraceEventList parameter was present within ActivateTraceModeArg.\n-\tOMC-Id AVP shall be present if a OMC-Id parameter was present within ActivateTraceModeArg.\n-\tTrace-Collection-Entity AVP shall be present if a TraceCollectionEntity parameter was present within ActivateTraceModeArg.\n-\tMDT-Configuration AVP shall be present if a MDT-Configuration parameter was present within ActivateTraceModeArg.\nGPRS-Subscription-Data AVP shall be present if a gprsSubscriptionData parameter was present within InsertSubscriberDataArg.\nLCS-Info AVP shall be present if a LCS Information parameter was present within InsertSubscriberDataArg.\nCSG-Subscription-Data AVPs shall be populated with information received within the csg-SubscriptionDataList parameter within InsertSubscriberDataArg.\nRoaming-Restricted-Due-To-Unsupported-Feature AVP shall be present and set to \"Roaming-Restricted-Due-To-Unsupported-Feature (0)\" if the parameter roamingRestrictedInSgsnDueToUnsupportedFeature was present within InsertSubscriberDataArg. Otherwise shall be absent.\nTeleservice-List AVP shall be present if a Teleservice List parameter was present within InsertSubscriberDataArg.\nCall-Barring-Info AVPs shall be present if call barring SS-code and SS-status parameters were present within InsertSubscriberDataArg and the SS-Code AVP and SS-Status AVP within the Call-Barring-Info AVPs shall be populated with the values of the received call barring SS-code and SS-status parameters within InsertSubscriberDataArg.\nMDT-User-Consent AVP shall be present if a MDT User Consent parameter was present within InsertSubscriberDataArg.\nSubscribed-VSRVCC AVP shall be present if a Subscribed vSRVCC parameter was present in a received EPS-SubscriptionData parameter within InsertSubscriberDataArg.\nPS-and-SMS-Only-Service-Provision AVP shall be present if a psAndSMS-OnlyServiceProvision parameter was present within InsertSubscriberDataArg.\nSMS-In-SGSN-Allowed AVP shall be present if an smsInSGSNAllowed parameter was present within InsertSubscriberDataArg.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.2.3",
      "section_id": "8.2.3",
      "section_title": "UpdateGprsLocationArg mapping to ULR",
      "content": "When the IWF needs to construct an ULR command as a result of receiving an UpdateGprsLocation message without a pdn-gw-update parameter within eps-info and without an isr-Information parameter within eps-info not indicating updateLocation or without a skipSubscriberDataUpdate parameter within add-info (see section 7.2.2 step 3), the IWF shall populate AVPs of ULR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of UpdateGprsLocationArg.\nSupported-Features AVP shall be populated with a value mapped from received parameter supportedFeatures within sgsn-Capability.\nTerminal-Information AVP shall be present if an add-info parameter was received within UpdateGprsLocationArg. If present the received value of the imeisv parameter shall be mapped onto IMEI and (if present) Software Version.\nRAT-Type AVP shall be populated with the value received within the usedRAT-Type parameter of UpdateGprsLocationArg\nULR-Flags AVP: Flags shall be set as follows:\nSingle-Registration-Indication shall be set to 1 if the ISR-Information parameter within the EPS-Info parameter within UpdateGprsLocationArg is present and indicates \"cancelSGSN\"; otherwise shall be set to 0.\n-\tS6a/S6d-Indicator shall be set to 1 if the servingNodeTypeIndicator parameter was present in UpdateGprsLocationArg; otherwise shall be set to 0.\n-\tSkip Subscriber Data shall be set to 1 if a skipSubscriberData parameter was present in UpdateGprsLocationArg; otherwise shall be set to 0.\n-\tGPRS-Subscription-Data-Indicator shall be set to 1 if the \"GPRS Subscription Data not needed Indicator\" was absent from UpdateGprsLocationArg; otherwise shall be set to 0.\n- Node-Type-Indicator shall be set to 1 if the \"Node-Type Indicator\" was present in UpdateGprsLocationArg; otherwise shall be set to 0.\n-\tInitial-Attach-Indicator shall be set to 1 if the initialAttachIndicator parameter within the ISR-Information parameter within the EPS-Info parameter within UpdateGprsLocationArg is present; otherwise shall be set to 0.\nVisited-PLMN-Id AVP shall populated with a value derived from the sgsn-Number parameter received within UpdateGprsLocationArg.\nSGSN-Number AVP shall be populated with the value received within the SGSN Number parameter of UpdateGprsLocationArg.\nUE-SRVCC-Capability AVP shall be present if a ue-srvcc-Capability parameter was present in UpdateGprsLocationArg. If present the AVP shall be populated with the received ue-srvcc-Capability parameter.\nMME-Number-for-MT-SMS AVP shall be populated with the value received within the mmeNumberforMTSMS parameter of UpdateGprsLocationArg.\nSMS-Register-Request AVP shall be populated with the value received within the smsRegisterRequest parameter of UpdateGprsLocationArg.\nSMS-Only AVP shall be populated with the value received within the sms-Only parameter of UpdateGprsLocationArg.\nAdjacent-PLMNs AVP shall be constructed with the values received within the adjacentPLMN-List parameter of UpdateGprsLocationArg.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.2.4",
      "section_id": "8.2.4",
      "section_title": "ULA mapping to InsertSubscriberDataArg/ ActivateTraceModeArg/UpdateGprsLocationRes/Error",
      "content": "When the IWF needs to construct a MAP InsertSubscriberData messages and/or a MAP- ActivateTraceMode message and/or a MAP-UpdateGprsLocation Ack message, as a result of receiving an ULA command (see sections 7.2.2 steps 5 and 6), the IWF shall populate sub-parameters of InsertSubscriberDataArg, ActivateTraceModeArg and UpdateGprsLocationRes/Error as described below:\nInsertSubscriberDataArg:\nimsi in InsertSubscriberDataArg shall be absent.\nmsisdn in InsertSubscriberDataArg shall be populated with the value received within the MSISDN AVP within the Subscription-Data AVP within ULA.\ncategory in InsertSubscriberDataArg shall be absent.\nsubscriberStatus in InsertSubscriberDataArg shall be populated with the value received within the Subscriber-Status AVP within the Subscription-Data AVP within ULA.\nbearerServiceList in InsertSubscriberDataArg shall be absent.\nteleserviceList in InsertSubscriberDataArg shall be absent\nprovisionedSS in InsertSubscriberDataArg shall be absent.\nodb-Data in InsertSubscriberDataArg shall be populated with the value received within the Operator-Determined-Barring AVP and HPLMN-ODB AVP AVP within the Subscription-Data AVP within ULA.\nroamingRestrictedDueToUnsupportedFeature in InsertSubscriberDataArg shall be absent.\nregionalSubscriptionData in InsertSubscriberDataArg shall be populated with the value received within the Regional-Subscription-Zone-Code AVPs within the Subscription-Data AVP within ULA.\nvbsSubscriptionData in InsertSubscriberDataArg shall be absent.\nvgcsSubscriptionData in InsertSubscriberDataArg shall be absent\nvlrCamelsubscriptionInfo in InsertSubscriberDataArg shall be absent.\nnaea-PreferredCI in InsertSubscriberDataArg shall be absent.\ngprsSubscriptionData in InsertSubscriberDataArg shall be populated with GPRS-Subscription Data received  within the Subscription-Data AVP within ULA.\nroamingRestrictedInSgsnDueToUnsupportedFeature in InsertSubscriberDataArg shall be present if a Roaming-Restricted-Due-To-Unsupported-Feature AVP Subscription-Data AVP within ULA.\nnetworkAccessMode in InsertSubscriberDataArg shall be populated with the value received within the Network-Access-Mode AVP within the Subscription-Data AVP within ULA.\nlsaInformation in InsertSubscriberDataArg shall be absent.\nlmu-Indicator in InsertSubscriberDataArg shall be absent\nlcsInformation in InsertSubscriberDataArg shall be absent.\nistAlertTimer in InsertSubscriberDataArg shall be absent.\nsuperChargerSupportedInHLR in InsertSubscriberDataArg shall be absent.\nmc-SS-Info in InsertSubscriberDataArg shall be absent.\ncs-AllocationRetentionPriority in InsertSubscriberDataArg shall be absent.\nsgsn-CAMEL-SubscriptionInfo in InsertSubscriberDataArg shall be absent.\nchargingCharacteristics in InsertSubscriberDataArg shall be populated with the value received within the 3GPP-Charging-Characteristics AVP within the Subscription-Data AVP within ULA.\naccessRestrictionData and ext-AccessRestrictionData in InsertSubscriberDataArg shall be populated according to the values received within the Access-Restriction-Data AVP within the Subscription-Data AVP within ULA.\nics-Indicator in InsertSubscriberDataArg shall be absent.\nLCS Information in InsertSubscriberDataArg shall be populated with the value received within the LCS-Info AVP within the Subscription-Data AVP within ULA.\nTeleservice List in InsertSubscriberDataArg shall be populated with the value received within the Teleservice-List AVP within the Subscription-Data AVP within ULA.\nSS-code and SS-status parameters of Call Barring Information List in InsertSubscriberDataArg shall be populated with the values of SS-Code AVP and SS-Status AVP received within the Call-Barring-Info AVPs within the Subscription-Data AVP within ULA.\npsAndSMS-OnlyServiceProvision in InsertSubscriberDataArg shall be populated with the value received within the Subscription-Data AVP within ULA.\nsmsInSGSNAllowed in InsertSubscriberDataArg shall be populated with the value received within the Subscription-Data AVP within ULA.\nadjacentAccessRestrictionDataList in InsertSubscriberDataArg shall be constructed with the values received within the Adjacent-Access-Restriction-Data AVP within the Subscription-Data AVP within ULA.\nimsi-Group-Id-List in InsertSubscriberDataArg shall be constructed with the values received within the IMSI-Group-Id AVP within the Subscription-Data AVP within ULA.\nSub-parameters of eps-SubscriptionData in InsertSubscriberDataArg shall be populated as follows:\napn-oi-Replacement shall be populated with the value received in the APN-OI-Replacement AVP within the Subscription-Data AVP within ULA.\nrfsp-id shall be populated with the value received within the RAT-Frequency-Selection-Priority-ID AVP within the Subscription-Data AVP within ULA.\nambr shall be populated with the value received within the AMBR AVP within the Subscription-Data AVP within ULA.\napn-ConfigurationProfile shall be populated with the value received within the APN-Configuration-Profile AVP within the Subscription-Data AVP within ULA.\nstn-sr shall be populated with the value received within the STN-SR AVP within the Subscription-Data AVP within ULA.\ncsg-SubscriptionDataList shall be populated with values received within CSG-Subscription-Data AVPs within the Subscription-Data AVP within ULA.\nue-ReachabilityRequestIndicator shall be absent.\nmdtUserConsent shall be populated with the value received within MDT-User-Consent AVP within the Subscription-Data AVP within ULA.\nsubscribed-vsrvcc shall be present if the Subscribed-VSRVCC AVP is present within the Subscription-Data AVP within ULA.\npcscf-Restoration-Request shall be absent.\nActivateTraceModeArg:\nimsi in ActivateTraceModeArg shall be absent.\nTraceReference shall be populated with the value of Trace-ID part of the Trace-Reference AVP received within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nTraceType shall be present with any value.\nTraceReference2 shall be populated with the value of MCC+MNC part of the Trace-Reference AVP received within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nTraceDepthList shall be populated with the value received in the Trace-Depth-List AVP within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nTraceNE-TypeList shall be populated with the value received in the Trace-NE-Type-List AVP within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nTraceInterfaceList shall be populated with the value received in the Trace-Interface-List AVP within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nTraceEventList shall be populated with the value received in the Trace-Event-List AVP within the Trace-Data AVP within the Subscription-Data AVP within ULA.\nOmc-Id shall be populated with the value received in the OMC-Id AVP within the Trace-Data AVP within the Subscription-Data AVP within ULA\nTraceCollectionEntity shall be populated with the address received within the Trace-Collection-Entity AVP within the Subscription-Data AVP within ULA.\nUpdateGprsLocationRes:\nhlr-Number in UpdateGprsLocationRes shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\nextensionContainer in UpdateGprsLocationRes shall be absent.\nadd-Capability in UpdateGprsLocationRes shall be present.\nsgsn-mmeSeparationSupported in UpdateGprsLocationRes shall be present if the Separation Indication within the ULA-Flags AVP was set to 1 within ULA.\nMDT-Configuration shall be populated with the value received within the MDT-Configuration AVP within the Subscription-Data AVP within ULA.\nmmeRegisteredforSMS in UpdateGprsLocationRes shall be present if the \"MME registered for SMS\" flag within the ULA-Flags AVP was set to 1 within ULA.\nUpdateGprsLocation Error:\nAn error of unknownSubscriber with unknownSubscriberParam containing a unknownSubscriberDiagnostic of \"imsiUnknown\" shall be sent if the received ULA command contains an Experimental-Result AVP with a value of \"User Unknown\".\nAn error of unknownSubscriber with unknownSubscriberParam containing a unknownSubscriberDiagnostic of \"gprs-epsSubscriptionUnknown\" shall be sent if the received ULA command contains an Experimental-Result AVP with a value of \"Unknown EPS Subscription\".\nOther values within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.3.1",
      "section_id": "8.3.1",
      "section_title": "CancelLocationArg mapping to CLR",
      "content": "When the IWF needs to construct a CLR command as a result of receiving a MAP-CancelLocation message (see sections 7.3.1 step 2, and 7.3.2 step 3), the the IWF shall populate AVPs of CLR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the imsi value received within the identity parameter of CancelLocationArg.\nSupported-Features AVP shall be absent.\nCancellationType AVP shall contain the value MME_UPDATE_PROCEDURE if the parameter CancellationType within CancelLocationArg was set to updateProcedure and typeOfUpdate within CancelLocationArg was set to mme-change; the AVP shall contain the value SGSN_UPDATE_PROCEDURE if the parameter CancellationType within CancelLocationArg was set to updateProcedure and typeOfUpdate within CancelLocationArg was set to sgsn-change; the AVP shall contain the value SUBSCRIPTION_WITHDRAWAL if the parameter CancellationType within CancelLocationArg was set to subscriptionWithdraw; the AVP shall contain the value UPDATE_PROCEDURE_IWF if the parameter CancellationType within CancelLocationArg was set to updateProcedure and typeOfUpdate within CancelLocationArg was absent; the AVP shall contain the value INITIAL_ATTACH_PROCEDURE if the parameter CancellationType within CancelLocationArg was set to InitialAttachProcedure.\nCLR-Flags AVP: Flags shall be set as follows:\n-\tS6a/S6d-Indicator shall be set to 1 if the TypeOfUpdate parameter was present in CancelLocationArg and indicates \"mme-change\"; it shall be set to 0 if the TypeOfUpdate parameter was present in CancelLocationArg and indicates \"sgsn-change\".\n- \tReattach-Required shall be set to 1 if the reattach-Required parameter was present in CancelLocationArg.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.3.2",
      "section_id": "8.3.2",
      "section_title": "CLA mapping to CancelLocationRes/Error",
      "content": "When the IWF needs to construct MAP-CancelLocation Ack  message as a result of receiving an CLA command (see sections 7.3.1 step 4 and 7.3.2.step 5), the IWF shall populate sub-parameters of CancelLocationRes/Error as described below:\nCancelLocationRes:\nextensionContainer in CancelLocationRes shall be absent.\nCancelLocation Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.3.3",
      "section_id": "8.3.3",
      "section_title": "CLR mapping to CancelLocationArg",
      "content": "When the IWF needs to construct a MAP-CancelLocation message as a result of receiving a CLR command (see sections 7.3.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of CancelLocationArg as described below:\nidentity in CancelLocationArg shall be populated with the imsi value of the User-Name AVP received within CLR.\ncancellationType in CancelLocationArg shall contain a value of updateProcedure if the Cancellation-Type AVP received in CLR contains the value MME_UPDATE_PROCEDURE or SGSN_UPDATE_PROCEDURE. The parameter shall contain a value of subscriptionWithdraw if the Cancellation-Type AVP received in CLR contains the value SUBSCRIPTION_WITHDRAWAL. The parameter shall contain a value of InitialAttachProcedure if the Cancellation-Type AVP received in CLR contains the value INITIAL_ATTACH_PROCEDURE.\nextensionContainer in CancelLocationArg shall be absent.\ntypeOfUpdate in CancelLocationArg shall be set to sgsn-change if SGSN_UPDATE_PROCEDURE was received in the Cancellation-Type AVP within CLR, or INITIAL_ATTACH_PROCEDURE was received in the Cancellation-Type AVP within CLR and the S6a/S6d-Indicator flag was cleared in the CLR-Flags AVP within the received CLR. It shall be set to mme-change if MME_UPDATE_PROCEDURE was received in Cancellation-Type AVP within CLR, or if INITIAL_ATTACH_PROCEDURE was received in the Cancellation-Type AVP within CLR and the S6a/S6d-Indicator flag was set in the CLR-Flags AVP within the received CLR. Otherwise it shall be absent.\nreattach-Required in CancelLocationArg shall be present if the Reattach-Required flag was set in the CLR-Flags AVP received within CLR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.3.4",
      "section_id": "8.3.4",
      "section_title": "CancelLocationRes / Error  mapping to CLA",
      "content": "When the IWF needs to construct an CLA command as a result of receiving a CancelLocation Ack/Error message  (see sections 7.3.2 step 6), the IWF shall populate AVPs of CLA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a CancelLocationRes parameter was received in a TCAP ResultLast component;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nSupported-Features AVP shall be absent.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.4.1",
      "section_id": "8.4.1",
      "section_title": "PUR mapping to PurgeMS-Arg",
      "content": "When the IWF needs to construct a MAP-PurgeMS message as a result of receiving an PUR command (see sections 7.4.1 step 2 and 7.4.2. step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of PurgeMS-Arg as described below:\nimsi in PurgeMS-Arg shall be populated with the imsi value of the User-Name AVP received within PUR.\nvlr-Number in PurgeMS-Arg shall be absent.\nsgsn-Number in PurgeMS-Arg shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\nextensionContainer in PurgeMS-Arg shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.4.2",
      "section_id": "8.4.2",
      "section_title": "PurgeMS-Res / Error  mapping to PUA",
      "content": "When the IWF needs to construct an PUA command as a result of receiving a PurgeMS Ack/Error message  (see sections 7.4.1 step 4 and 7.4.2. step 6), the IWF shall populate AVPs of PUA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a PurgeMS-Res parameter was received in a TCAP ResultLast component;\n-\tDIAMETER_ERROR_USER_UNKNOWN if an error of unknownSubscriber without a diagnostic parameter or with a diagnostic parameter of imsiUnknown or gprs-eps-SubscriptionUnknown was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nPUA-Flags AVP: Flags shall be set as follows:\n-\tFreeze M-TMSI shall be set to 1 if the freezeM-TMSI parameter was present within PurgeMS-Res; otherwise shall be set to 0.\n-\tFreeze P-TMSI shall be set to 1 if the freezeP-TMSI parameter was present within PurgeMS-Res; otherwise shall be set to 0.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.4.3",
      "section_id": "8.4.3",
      "section_title": "PurgeMS-Arg mapping to PUR",
      "content": "When the IWF needs to construct a PUR command as a result of receiving a MAP-PurgeMS message (see section 7.4.2 step 3), the the IWF shall populate AVPs of PUR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of PurgeMS-Arg.\nSupported-Features AVP shall be absent.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.4.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.4.4",
      "section_id": "8.4.4",
      "section_title": "PUA mapping to PurgeMS-Res/Error",
      "content": "When the IWF needs to construct MAP-PurgeMS Ack  message as a result of receiving a PUA command (see section 7.4.2.step 5), the IWF shall populate sub-parameters of PurgeMS-Res/Error as described below:\nPurgeMS-Res:\nfreezeTMSI in PurgeMS-Res shall be absent.\nfreezeP-TMSI in PurgeMS-Res shall be present if a Freeze-P-TMSI indication was received within the PUA-Flags AVP within PUA.\nextensionContainer in PurgeMS-Res shall be absent.\nfreezeM-TMSI in PurgeMS-Res shall be present if a Freeze-M-TMSI indication was received within the PUA-Flags AVP within PUA.\nPurgeMS Error:\nAn error of unknownSubscriber with unknownSubscriberParam containing a unknownSubscriberDiagnostic of \"imsiUnknown\" shall be sent if the received AIA command contains an Experimental-Result AVP with a value of \"User Unknown\".\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.4.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.5.1",
      "section_id": "8.5.1",
      "section_title": "InsertSubscriberDataArg mapping to IDR",
      "content": "When the IWF needs to construct an IDR command as a result of receiving a MAP-InsertSubscriberData message (see sections 7.5.1 step 2, and 7.5.2 step 3), the IWF shall populate AVPs of IDR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of InsertSubscriberDataArg.\nSupported-Features AVP shall be absent.\nSubscription-Data AVP: See chapter 8.2.2.\nIDR-Flags AVP: Flags shall be set as follows:\nUE Reachability Request shall be set to 1 if the ue-reachabilityRequestIndicator was present within InsertSubscriberDataArg; othewise shall be set to 0 or the AVP shall be absent.\nP-CSCF Restoration Request flag shall be set to 1 if the pcscf-Restoration-Request parameter was present within InsertSubscriberDataArg; otherwise shall be set to 0 or the AVP shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.2",
      "section_id": "8.5.2",
      "section_title": "IDA mapping to InsertSubscriberDataRes/Error",
      "content": "When the IWF needs to construct a MAP-InsertSubscriberData Ack message as a result of receiving an IDA command (see sections 7.5.1 step 4 and 7.5.2.step 5), the IWF shall populate sub-parameters of InsertSubscriberDataRes/Error as described below:\nInsertSubscriberDataRes:\nteleserviceList in InsertSubscriberDataRes shall include all teleserviceCodes that have been received within InsertSubscriberDataArg.\nbearerServiceList in InsertSubscriberDataRes shall include all bearerServiceCodes that have been received within InsertSubscriberDataArg.\nss-List in InsertSubscriberDataRes shall include all ssCodes that have been received within InsertSubscriberDataArg.\nodb-GeneralData in InsertSubscriberDataRes shall include all odb categoties that have been requested within the received InsertSubscriberDataArg but are not supported by the serving node as indicated within the Supported-Feature AVP within IDA.\nregionalSubscriptionResponse in InsertSubscriberDataRes -shall be set to regionalSubscNotSupported if regional subscription was requested within the received InsertSubscriberDataArg but is not supported by the serving node as indicated within the Supported-Feature AVP within IDA.-shall be set to networkNode-AreaRestricted if regional subscription was requested within the received InsertSubscriberDataArg but a Network-Node-Area-Restricted indication  has been received within the IDA-Flags AVP within IDA.- otherwise shall be absent.\nsupportedCamelPhases in InsertSubscriberDataRes shall be absent or shall indicate that no CAMEL phase is supported.\nextensionContainer in CancelLocationRes shall be absent.\nofferedCamel4CSIs in InsertSubscriberDataRes shall be absent.\nsupportedFeatures in InsertSubscriberDataRes shall be populated with the information received within the Supported-Features AVP within IDA.\nInsertSubscriberData Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.3",
      "section_id": "8.5.3",
      "section_title": "IDR mapping to InsertSubscriberDataArg/ ActivateTraceModeArg",
      "content": "When the IWF needs to construct a MAP-InsertSubscriberData message or a MAP-ActivateTraceMode message as a result of receiving an IDR command (see sections 7.5.2 step 2, and 7.10.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of InsertSubscriberDataArg/ActivateTraceModeArg as described below:\nInsertSubscriberDataArg:\nimsi in InsertSubscriberDataArg shall be populated with the value received within the User-Name AVP within IDR.\nmsisdn in InsertSubscriberDataArg shall be populated with the value received within the MSISDN AVP within the Subscription-Data AVP within IDR.\ncategory in InsertSubscriberDataArg shall be absent.\nsubscriberStatus in InsertSubscriberDataArg shall be populated with the value received within the Subscriber-Status AVP within the Subscription-Data AVP within IDR.\nbearerServiceList in InsertSubscriberDataArg shall be absent.\nteleserviceList in InsertSubscriberDataArg shall be absent\nprovisionedSS in InsertSubscriberDataArg shall be absent.\nodb-Data in InsertSubscriberDataArg shall be populated with the value received within the Operator-Determined-Barring AVP and HPLMN-ODB AVP AVP within the Subscription-Data AVP within IDR.\nroamingRestrictedDueToUnsupportedFeature in InsertSubscriberDataArg shall be absent.\nregionalSubscriptionData in InsertSubscriberDataArg shall be populated with the value received within the Regional-Subscription-Zone-Code AVPs within the Subscription-Data AVP within IDR.\nvbsSubscriptionData in InsertSubscriberDataArg shall be absent.\nvgcsSubscriptionData in InsertSubscriberDataArg shall be absent\nvlrCamelsubscriptionInfo in InsertSubscriberDataArg shall be absent.\nnaea-PreferredCI in InsertSubscriberDataArg shall be absent.\ngprsSubscriptionData in InsertSubscriberDataArg shall bepopulated with GPRS-Subscription Data received  within the Subscription-Data AVP within IDR.\nroamingRestrictedInSgsnDueToUnsupportedFeature in InsertSubscriberDataArg shall be present if a Roaming-Restricted-due-To-Unsupported-Feature AVP was received within the Subscription-Data AVP within IDR.\nnetworkAccessMode in InsertSubscriberDataArg shall be populated with the value received within the Network-Access-Mode AVP within the Subscription-Data AVP within IDR.\nlsaInformation in InsertSubscriberDataArg shall be absent.\nlmu-Indicator in InsertSubscriberDataArg shall be absent\nlcsInformation in InsertSubscriberDataArg shall be absent.\nistAlertTimer in InsertSubscriberDataArg shall be absent.\nsuperChargerSupportedInHLR in InsertSubscriberDataArg shall be absent.\nmc-SS-Info in InsertSubscriberDataArg shall be absent.\ncs-AllocationRetentionPriority in InsertSubscriberDataArg shall be absent.\nsgsn-CAMEL-SubscriptionInfo in InsertSubscriberDataArg shall be absent.\nchargingCharacteristics in InsertSubscriberDataArg shall be populated with the value received within the 3GPP-Charging-Characteristics AVP within the Subscription-Data AVP within IDR.\naccessRestrictionData and ext-AccessRestrictionData in InsertSubscriberDataArg shall be populated according to the values received within the Access-Restriction-Data AVP within the Subscription-Data AVP within IDR.\nics-Indicator in InsertSubscriberDataArg shall be absent.\nLCS Information in InsertSubscriberDataArg shall be populated with the value received within the LCS-Info AVP within the Subscription-Data AVP within ULA.\nTeleservice List in InsertSubscriberDataArg shall be populated with the value received within the Teleservice-List AVP within the Subscription-Data AVP within ULA.\nCall Barring Information List in InsertSubscriberDataArg shall be populated with the value received within the Call- Barring-Infor-List AVP within the Subscription-Data AVP within ULA.\nadjacentAccessRestrictionDataList in InsertSubscriberDataArg shall be constructed with the value received within the Adjacent-Access-Restriction-Data AVP within the Subscription-Data AVP within IDR.\nimsi-Group-Id-List in InsertSubscriberDataArg shall be constructed with the values received within the IMSI-Group-Id AVP within the Subscription-Data AVP within IDR.\n-\tSub-parameters of eps-SubscriptionData in InsertSubscriberDataArg shall be populated as follows:\napn-oi-Replacement shall be populated with the value received in the APN-OI-Replacement AVP within the Subscription-Data AVP within IDR.\nrfsp-id shall be populated with the value received within the RAT-Frequency-Selection-Priority-ID AVP within the Subscription-Data AVP within IDR.\nambr shall be populated with the value received within the AMBR AVP within the Subscription-Data AVP within IDR.\napn-ConfigurationProfile shall be populated with the value received within the APN-Configuration-Profile AVP within the Subscription-Data AVP within IDR.\nstn-sr shall be populated with the value received within the STN-SR AVP within the Subscription-Data AVP within IDR.\nsubscribed-vsrvcc shall be present if the Subscribed-VSRVCC AVP is present within the Subscription-Data AVP within IDR.\ncsg-SubscriptionDataList in InsertSubscriberDataArg shall be populated with information received within the CSG-Subscription-Data AVPs within the Subscription-Data AVP within IDR.\nue-ReachabilityRequestIndicator in the InsertSubscriberDataArg shall be present if the corresponding information was present within the IDR-Flags AVP within an IDR; otherwise it shall be absent.\npsAndSMS-OnlyServiceProvision in InsertSubscriberDataArg shall be populated with the information received within the PS-and-SMS-Only-Service-Provision AVP within the Subscription-Data AVP within IDR.\nsmsInSGSNAllowed in InsertSubscriberDataArg shall be populated with the information received within the SMS-In-SGSN-Allowed AVP within the Subscription-Data AVP within IDR.\npcscf-Restoration-Request in the InsertSubscriberDataArg shall be present if the corresponding information was present within the IDR-Flags AVP within an IDR; otherwise it shall be absent.\nActivateTraceModeArg:\nimsi shall be populated with the value received within the User-Name AVP within IDR.\nTraceReference shall be populated with the value of Trace-ID part of the Trace-Reference AVP received within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceType shall be present with any value.\nTraceReference2 shall be populated with the value of MCC+MNC part of the Trace-Reference AVP received within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceDepthList shall be populated with the value received in the Trace-Depth-List AVP within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceNE-TypeList shall be populated with the value received in the Trace-NE-Type-List AVP within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceInterfaceList shall be populated with the value received in the Trace-Interface-List AVP within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceEventList shall be populated with the value received in the Trace-Event-List AVP within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nOmc-Id shall be populated with the value received in the OMC-Id AVP within the Trace-Data AVP within the Subscription-Data AVP within IDR.\nTraceCollectionEntity shall be populated with the address received within the Trace-Collection-Entity AVP within the Subscription-Data AVP within IDR.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.4",
      "section_id": "8.5.4",
      "section_title": "InsertSubscriberDataRes / Error  mapping to IDA",
      "content": "When the IWF needs to construct an IDA command as a result of receiving an InsertSubscriberData Ack/Error message  (see sections 7.5.2 step 8), the IWF shall populate AVPs of IDA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if no InsertSubscriberData error component was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nIDA-Flags AVP: Flags shall be set as follows: -\tNetwork-Node-Area-Restricted shall be set to 1 if the regionalSubscriptionResponse parameter within InsertSubscriberDataRes indicated regionalSubscNotSupported; otherwise shall be set to 0.\nSupported-Features AVP: Support of features shall be indicated according to information received within the supportedFeatures parameter within InsertSubscriberDataRes.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.5",
      "section_id": "8.5.5",
      "section_title": "ProvideSubscriberInfoArg mapping to IDR",
      "content": "When the IWF needs to construct an IDR command as a result of receiving a MAP-ProvideSubscriberInfo message (see sections 7.5.1 step 2, and 7.5.2 step 3), the IWF shall populate AVPs of IDR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of ProvideSubscriberInfoArg.\nSupported-Features AVP shall be absent.\nSubscription-Data AVP shall be empty.\nIDR-Flags AVP: Flags shall be set as follows:\nUE Reachability Request shall be set to 0.\nT-ADS Data Request shall be set to 1 if the t-adsData within the RequestedInfo parameter within ProvideSubscriberInfoArg was present; otherwise it shall be set to 0 or the AVP shall be absent.\nEPS User State Request shall be set to 1 if the subscriberState within the RequestedInfo parameter was present within ProvideSubscriberInfoArg; otherwise it shall be set to 0 or the AVP shall be absent.\nEPS Location Information Request shall be set to 1 if the locationInformation within the RequestedInfo parameter was present within ProvideSubscriberInfoArg; otherwise it shall be set to 0 or the AVP shall be absent.\nCurrent Location Request shall be set to 1 if the currentLocation within the RequestedInfo parameter was present within ProvideSubscriberInfoArg; otherwise it shall be set to 0.\nLocal Time Zone Request shall be set to 1 if the localTimeZoneRequest within the RequestedInfo parameter was present within ProvideSubscriberInfoArg; otherwise it shall be set to 0.\nP-CSCF Restoration Request shall be set to 0.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.6",
      "section_id": "8.5.6",
      "section_title": "IDA mapping to ProvideSubscriberInfoRes/Error",
      "content": "When the IWF needs to construct a MAP-ProvideSubscriberInfo Ack message as a result of receiving an IDA command (see sections 7.5.1 step 4 and 7.5.2.step 5), the IWF shall populate sub-parameters of ProvideSubscriberInfoRes/Error as described below:\nProvideSubscriberInfoRes:\nSub-parameters of SubscriberInfo in ProvideSubscriberInfoRes shall be populated as follows:\nimsVoiceOverPS-SessionsIndication shall be populated with the value received in the IMS-Voice-Over-PS-Sessions-Supported AVP within IDA.\nlastUE-ActivityTime shall be populated with the value received in the Last-UE-Activity-Time AVP within IDA.\nlastRAT-Type shall be populated with the value received in the RAT-Type AVP within IDA.\neps-SubscriberState shall be populated with the value received in the EPS-User-State AVP within IDA.\nSub-parameters of locationInformationEPS shall be populated with the values of the corresponding AVPs received in the EPS-Location-Information AVP within IDA.\ntimeZone shall be populated with the value received in the Time-Zone AVP within IDA.\ndaylightSavingTime shall be populated with the value received in the Daylight-Saving-Time AVP within IDA.\nextensionContainer in ProvideSubscriberInfoRes shall be absent.\nProvideSubscriberInfo Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.7",
      "section_id": "8.5.7",
      "section_title": "IDR mapping to ProvideSubscriberInfoArg",
      "content": "When the IWF needs to construct a MAP-ProvideSubscriberInfo message as a result of receiving an IDR command (see sections 7.5.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of ProvideSubscriberInfoArg as described below:\nProvideSubscriberInfoArg:\nimsi in ProvideSubscriberInfoArg shall be populated with the value received within the User-Name AVP within IDR.\nlmsi in ProvideSubscriberInfoArg shall be absent.\nSub-parameters of requestedInfo in ProvideSubscriberInfoArg shall be populated as follows:\nt-adsData in requestedInfo shall be present if the \"T-ADS Data Request\" flag was set in the IDR-Flags AVP within IDR.\nsubscriberState in requestedInfo shall be present if the \"EPS User State Request\" flag was set in the IDR-Flags AVP within IDR.\nlocationInformation in requestedInfo shall be present if the \"EPS Location Information Request\" flag was set in the IDR-Flags AVP within IDR.\ncurrentLocation in requestedInfo shall be present if the \"Current Location Request\" flag was set in the IDR-Flags AVP within IDR.\nlocalTimeZoneRequest in requestedInfo shall be present if the \"Local Time Zone Request\" flag was set in the IDR-Flags AVP within IDR.\nextensionContainer in ProvideSubscriberInfoArg shall be absent.\ncallPriority in ProvideSubscriberInfoArg shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.5.8",
      "section_id": "8.5.8",
      "section_title": "ProvideSubscriberInfoRes/Error mapping to IDA",
      "content": "When the IWF needs to construct an IDA command as a result of receiving an ProvideSubscriberInfo Ack/Error message  (see sections 7.5.2 step 8), the IWF shall populate AVPs of IDA as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be absent.\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if no ProvideSubscriberInfo error component was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nIMS-Voice-Over-PS-Sessions-Supported AVP shall be populated with the value received within the imsVoiceOverPS-SessionsIndication parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\nLast-UE-Activity-Time AVP shall be populated with the value received within the lastUE-ActivityTime parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\nRAT-Type AVP shall be populated with the value received within the lastRAT-Type parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\nEPS-User-State AVP shall be populated with the value received within the eps-SubscriberState parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\nAVPs within EPS-Location-Information AVP shall be populated with the values of the corresponding sub-parameters received within the locationInformationEPS parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\nIDA-Flags AVP shall be absent.\nAVPs within Local-Time-Zone AVP shall be populated as follows:\n-\tTime-Zone AVP shall be populated with the value received within the timeZone parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.\n-\tDaylight-Saving-Time AVP shall be populated with the value received within the daylightSavingTime parameter within the SubscriberInfo parameter of ProvideSubscriberInfoRes.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.6.1",
      "section_id": "8.6.1",
      "section_title": "DeleteSubscriberDataArg mapping to DSR",
      "content": "When the IWF needs to construct a DSR command as a result of receiving a MAP-DeleteSubscriberData message (see sections 7.6.1 step 2, and 7.6.2 step 3), the the IWF shall populate AVPs of DSR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of DeleteSubscriberDataArg.\nSupported-Features AVP shall be absent.\nDSR-Flags AVP: Flags shall be set as follows:\n-\tRegionalSubscriptionWithdrawal shall be set to 1 if a regionalSubscriptionIdentifier parameter was present in DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tComplete APN Configuration Profile Withdrawal shall be set to 1 if the allEPS-Data parameter was present within the EPS-SubscriptionDataWithdraw parameter within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tSubscribed Charging Characteristics Withdrawal shall be set to 1 if the chargingCharacteristicsWithdraw parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tPDN Subscription Context Withdrawal shall be set to 1 if the contextIdList parameter was present within the EPS-SubscriptionDataWithdraw parameter within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tSTN-SR shall be set to 1 if the stn-srWithdraw parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tGMLC List Withdrawal shall be set to 1 if the GMLC List Withdraw parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tLCS Withdrawal shall be set to 1 if the SS code list parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tComplete PDP context list Withdrawal shall be shall be set to 1 if the allGPRS-Data parameter was present within the GPRS-SubscriptionDataWithdraw parameter within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tPDP context Withdrawal shall be set to 1 if the contextIdList parameter was present within the GPRS-SubscriptionDataWithdraw parameter within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tRoaming Restricted in due to unsupported feature shall be set to 1 if the roamingRestrictedInSgsnDueToUnsupportedFeature parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tTrace Data Withdrawal shall be set to 0.\n-\tCSG Deleted shall be set to 1 if the csg-SubscriptionDeleted parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tAPN-OI-Replacement shall be set to 1 if the apn-oi-replacementWithdraw parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\n-\tSMS Withdrawal shall be set to 1 if the SS-Code list parameter was present within DeleteSubscriberDataArg and the service codes are related to short message services; otherwise shall be set to 0.\n-\tSubscribed VSRVCC Withdrawal shall be set to 1 if the subscribed-vsrvccWithdraw parameter was present within DeleteSubscriberDataArg; otherwise shall be set to 0.\nContext-Identifier AVPs shall be populated with values received within the contextIdList parameter within EPS-SubscriptionDataWithdraw or GPRS-SubscriptionDataWithdraw within DeleteSubscriberDataArg;",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.6.2",
      "section_id": "8.6.2",
      "section_title": "DSA mapping to DeleteSubscriberDataRes/Error",
      "content": "When the IWF needs to construct a MAP-DeleteSubscriberData Ack  message as a result of receiving a DSA command (see sections 7.6.1 step 4 and 7.6.2.step 5), the IWF shall populate sub-parameters of DeleteSubscriberDataRes/Error as described below:\nDeleteSubscriberDataRes:\nregionalSubscriptionResponse in DeleteSubscriberDataRes shall be set to:\n-\tregionalSubscNotSupported if a corresponding information was received within the Supported-Feature AVP within DSA .\n-\tnetworkNode-AreaRestricted if a Network-Node-Area-Restricted indication was received within the DSA-Flags AVP within DSA.\nextensionContainer in DeleteSubscriberDataRes shall be absent.\nDeleteSubscriberData Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.6.3",
      "section_id": "8.6.3",
      "section_title": "DSR mapping to DeleteSubscriberDataArg/ DeactivateTraceModeArg",
      "content": "When the IWF needs to construct a MAP-DeleteSubscriberData message or a MAP-DeactivateTraceMode message as a result of receiving a DSR command (see sections 7.6.2 step 2, 7.11.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of DeleteSubscriberDataArg/DeactivateTraceModeArg as described below:\nDeleteSubscriberDataArg:\nimsi in DeleteSubscriberDataArg shall be populated with the value of the User-Name AVP received within DSR.\nbasicServiceList in DeleteSubscriberDataArg shall be absent.\nss-List in DeleteSubscriberDataArg shall be absent.\nroamingRestrictionDueToUnsupportedFeature in DeleteSubscriberDataArg shall be absent.\nregionalSubscriptionIdentifier in DeleteSubscriberDataArg shall be present if a Regional-Subscription-Withdrawal indication has been received within the DSR-Flags AVP within DSR. If present, the value of the ZoneCode is arbitrary.\nvbsGroupIndication in DeleteSubscriberDataArg shall be absent.\nvgcsGroupIndication in DeleteSubscriberDataArg shall be absent.\ncamelSubscriptionInfoWithdraw in DeleteSubscriberDataArg shall be absent.\nextensionContainer in DeleteSubscriberDataArg shall be absent.\ngprsSubscriptionDataWithdraw in DeleteSubscriberDataArg shall be present if corresponding information was received within the DSR-Flags AVP and GPRS-Context-Identifier AVPs within DSR.\nroamingRestrictedInSgsnDueToUnsupportedFeature in DeleteSubscriberDataArg shall be present if a corresponding indication has been received within the DSR-Flags AVP within DSR.\nlsaInformationWithdraw in DeleteSubscriberDataArg shall be absent.\ngmlc-ListWithdraw in DeleteSubscriberDataArg shall be absent.\nistInformationWithdraw in DeleteSubscriberDataArg shall be absent.\nspecificCSI-Withdraw in DeleteSubscriberDataArg shall be absent.\nchargingCharacteristicsWithdraw in DeleteSubscriberDataArg shall be present if a Subscribed-Charging-Characteristics-Withdrawl indication was received within the DSR-Flags AVP within DSR.\nstn-srWithdraw in DeleteSubscriberDataArg shall be present if a STN-SR indication was received within the DSR-Flags AVP within DSR.\nepsSubscriptionDataWithdraw in DeleteSubscriberDataArg shall be present if a Complete-APN-Configuration-Profil-Withdrawal indication or a PDN-Subscription-Context-Withdrawl indication was received within the DSR-Flags AVP. The sub-parameter allEPS-Data shall be present if a Complete-APN-Configuration-Profile-Withdrawl indication was was received in the DSR-Flags AVP within DSR. The sub-parameter contextIdList shall be present if a PDN-Subscription-Context-Withdrawl indication was received within the DSR-Flags AVP within DSR; if so, the contextIdList shall be populatede with values received within the Context-Identifier AVPs within DSR.\nGMLC List Withdraw in DeleteSubscriberDataArg shall be present if a GMLC List Withdrawal indication was received within the DSR-Flags AVP.\nSS-Code List in DeleteSubscriberDataArg shall be present if corresponding information was received within the DSR-Flags AVP and SS-Code AVPs within DSR.\napn-oi-replacementWithdraw in DeleteSubscriberDataArg shall be present if a APN-OI-Replacement indication was received within the DSR-Flags AVP within DSR.\ncsg-SubscriptionDeleted in DeleteSubscriberDataArg shall be present if a CSG Deleted indication was received within the DSR-Flags AVP within DSR.\nSS-Code List in DeleteSubscriberDataArg shall be present if SMS Withdrawal bit was set within the DSR-Flags AVP and SS-Code AVPs was within DSR.\nsubscribed-vsrvccWithdraw in DeleteSubscriberDataArg shall be present if a Subscribed VSRVCC Withdrawal indication was received within the DSR-Flags AVP within DSR.\nDeactivateTraceModeArg:\nimsi in DeactivateTraceModeArg shall be populated with the value received within the User-Name AVP within DSR.\nTraceReference in DeactivateTraceModeArg shall be populated with the value of Trace-ID part of the Trace-Reference AVP received within DSR.\nTraceReference2 in DeactivateTraceModeArg shall be populated with the value of MCC+MNC part of the Trace-Reference AVP received within DSR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.6.4",
      "section_id": "8.6.4",
      "section_title": "DeleteSubscriberDataRes / Error  mapping to DSA",
      "content": "When the IWF needs to construct a DSA command as a result of receiving a DeleteSubscriberData Ack/Error message  (see sections 7.6.2 step 6), the IWF shall populate AVPs of DSA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a DeleteSubscriberDataRes parameter was received in a TCAP ResultLast component;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nSupported-Features AVP shall be present and shall indicate support of Regional Subscription if a Regional-Subscription-Withdrawal indication was present within the DSR-Flags AVP within DSR and no regionalSubscNotSupported indication was received in regionalSubscriptionResponse in DeleteSubscriberDataRes.\nDSA-Flags AVP: Flags shall be set as follows:\n-\tNetwork-Node-Area-Restricted shall be set to 1 if a networkNode-AreaRestricted indication was received within the regionalSubscriptionResponse parameter within DeleteSubscriberDataRes; otherwise shall be set to 0.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.7.1",
      "section_id": "8.7.1",
      "section_title": "Reset (v1 or v2) mapping to RSR",
      "content": "When the IWF needs to construct a RSR command as a result of receiving a MAP-Reset message with AC version 1 or version 2 (see sections 7.7.1 step 2, and 7.7.2 step 4), the the IWF shall populate AVPs of RSR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Id AVPs shall be populated with the values received within the HLR-Id parameters within hlr-list within ResetArg.\nSupported-Features AVP shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.7.2",
      "section_id": "8.7.2",
      "section_title": "RSR mapping to ResetArg (v1 or v2)",
      "content": "When the IWF needs to construct MAP-Reset message as a result of receiving a RSR command (see section 7.7.2 step 2), the IWF shall open a MAP dialogue in version 1 or version 2 according to an implementation option; note that the IWF shall be prepared to fall back to v1 when v2 is chosen. Sub-parameters of ResetArg shall be populated as described below:\nnetworkResource in ResetArg (only v1) shall be set to hlr.\nhlr-Number in ResetArg shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\nhlr-List in ResetArg shall be populated with values received within User-Id AVPs within RSR.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.7.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.8.1",
      "section_id": "8.8.1",
      "section_title": "NOR mapping to UpdateGprsLocation-Arg",
      "content": "When the IWF needs to construct a MAP-UpdateGprsLocation message as a result of receiving an NOR command (see sections 7.8.1 step 2 and 7.8.2. step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of UpdateGprsLocation-Arg as described below:\nimsi in UpdateGprsLocationArg shall be populated with the value of the User-Name AVP received within NOR.\nsgsn-Number in UpdateGprsLocationArg shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\nsgsn-Address in UpdateGprsLocationArg shall be populated with the IP-address of the source node sending the NOR command.\nextensionContainer in UpdateGprsLocationArg shall be absent.\nsgsn-Capability in UpdateGprsLocationArg shall be absent.\ninformPreviousNetworkEntity in UpdateGprsLocationArg shall be absent;\nps-LCS-NotSupportedByUE in UpdateGprsLocationArg shall be absent\nv-gmlc-Address in UpdateGprsLocationArg shall be absent.\nadd-info in UpdateGprsLocationArg shall be present if a Terminal-Information AVP was present in the received NOR. If present the parameter shall be populated with the received IMEI and software version, and with a skipSubscriberDataUpdate indication.\neps-info in UpdateGprsLocationArg shall be present and contain a pdn-gw-update parameter if the received NOR contained a MIP6-Agent-Info AVP. It shall be present and contain a isr-Information parameter if the received NOR contained a Single-Registration-Indication indication within the NOR-Flags AVP.\nservingNodeTypeIndicator in UpdateGprsLocationArg shall be present only if the S6a/S6d-Indicator flag within the NOR-Flags AVP received within the NOR is set to 1; otherwise, it shall be absent.\nskipSubscriberData Update in UpdateGprsLocationArg shall be present.\nusedRAT-Type in UpdateGprsLocationArg shall be absent.\ngprsSubscriptionDataNotNeeded in UpdateGprsLocationArg shall be absent.\nnodeTypeIndicator in UpdateGprsLocationArg shall be absent.\nareaRestricted in UpdateGprsLocationArg shall be present if the corresponding information was received within the NOR-Flags AVP within a NOR; otherwise it shall be absent.\nue-reachableIndicator in UpdateGprsLocationArg shall be present if the corresponding information was received within the NOR-Flags AVP within a NOR; otherwise it shall be absent.\nue-srvcc-Capability in UpdateGprsLocationArg shall be present if a UE-SRVCC-Capability AVP was present in the received NOR. If present the parameter shall be populated with the received ue-srvcc-Capability.\nhomogeneousSupportOfIMSVoiceOverPSSessions in UpdateGprsLocationArg shall be present if the corresponding information was received within the NOR; otherwise it shall be absent.\nupdateofHomogeneousSupportOfIMSVoiceOverPSSessions in UpdateGprsLocationArg shall be present if the corresponding information was received within the NOR-Flags AVP within a NOR; otherwise it shall be absent.\nremovalofMMERegistrationforSMS in UpdateGprsLocationArg shall be present if the corresponding information was received within the NOR-Flags AVP within a NOR; otherwise it shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.8.2",
      "section_id": "8.8.2",
      "section_title": "UpdateGprsLocation-Arg  mapping to NOR",
      "content": "When the IWF needs to construct a NOR command as a result of receiving a MAP-UpdateGprsLocation message with a pdn-gw-update parameter within eps-info or with an isr-Information parameter within eps-info not indicating updateLocation or with a skipSubscriberDataUpdate parameter within add-info or with ue-srvcc-Capability parameter but without usedRAT-Type parameter (see section 7.8.2 step 4), the the IWF shall populate AVPs of NOR as described below:\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nUser-Name AVP shall be populated with the value received within the imsi parameter of UpdateGprsLocation-Arg.\nSupported-Features AVP shall be absent.\nTerminal-Information AVP shall be present if an add-info parameter was present inUpdateGprsLocationArg..\nMIP6-Agent-Info AVP  shall be present if pdn-gw-Identity was received within pdn-gw-update parameter within eps-info within UpdateGprsLocationArg.\nService-Selection AVP  shall be present if apn was received within pdn-gw-update parameter within eps-info within UpdateGprsLocationArg.\nNOR-Flags AVP: Flags shall be set as follows:\n-\tSingle-Registration-Indication shall be set to 1 if a cancelSGSN indication was received within the ISR-Information within the eps-info within the UpdateGprsLocationArg; otherwise it shall be set to 0.\n-\tSGSN area restricted shall be set to 1 if an sgsnAreaRestricted indication was received within the UpdateGprsLocationArg; otherwise it shall be set to 0.\n-\tReady for SM shall be set to 0.\n-\tUE Reachable shall be set to 1 if a ue-reachableIndicator was received within the UpdateGprsLocationArg; otherwise it shall be set to 0.\n-\tS6a/S6d-Indicator shall be set to 1 if a servingNodeTypeIndicator was received within the UpdateGprsLocationArg; otherwise it shall be set to 0.\n-\tHomogeneous Support of IMS Voice Over PS Sessions shall be set to 1 if an updateofHomogeneousSupportOfIMSVoiceOverPSSessions was received within the UpdateGprsLocationArg; otherwise it shall be set to 0.\n-\tRemoval of MME Registration for SMS shall be set to 1 if a removalofMMERegistrationforSMS was received within the UpdateGprsLocationArg; otherwise it shall be set to 0.\nContext-Identifier AVP shall be present if contextId was received within pdn-gw-update parameter within eps-info within UpdateGprsLocationArg.\nUE-SRVCC-Capability AVP shall be present if a ue-srvcc-Capability parameter was present in UpdateGprsLocationArg. If present the AVP shall be populated with the received ue-srvcc-Capability parameter.\nHomogeneous-Support-of-IMS-Voice-Over-PS-Sessions AVP shall be present if updateofHomogeneousSupportOfIMSVoiceOverPSSessions was present in UpdateGprsLocationArg; otherwise it shall be absent.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.8.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.8.3",
      "section_id": "8.8.3",
      "section_title": "NOR mapping to ReadyForSM-Arg",
      "content": "When the IWF needs to construct a MAP-ReadyForSM message as a result of receiving an NOR command (see sections 7.8.1 step 2 and 7.8.2. step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of ReadyForSMArg as described below:\nimsi in ReadyForSMArg shall be populated with the value of the User-Name AVP received within NOR.\nalertReason in ReadyForSMArg shall be populated with the value of the Alert-Reason AVP received within NOR.\nalertReasonIndicator in ReadyForSMArg shall be present if the \"Ready for SM from SGSN\" flag within the NOR-Flags AVP received within NOR is set; otherwise it shall be absent.\nadditionalAlertReasonIndicator in ReadyForSMArg shall be absent.\nextensionContainer in ReadyForSMArg shall be absent.\nmaximumUeAvailabilityTime shall be present and populated with the value of the Max-UE-Availaibility-Time AVP, when received within NOR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.8.4",
      "section_id": "8.8.4",
      "section_title": "ReadyForSM-Arg mapping to NOR",
      "content": "When the IWF needs to construct a NOR command as a result of receiving a MAP-ReadyForSM message (see section 7.8.2 step 4), the the IWF shall populate AVPs of NOR as described below:\nUser-Name AVP shall be populated with the value received within the imsi parameter of ReadyForSMArg.\nSupported-Features AVP shall be absent.\nTerminal-Information AVP shall be absent.\nMIP6-Agent-Info AVP shall be absent.\nContext-Identifier AVP shall be absent.\nService-Selection AVP shall be absent.\nAlert-Reason AVP shall be present and populated with the value received within the alertReason parameter of ReadyForSMArg.\nNOR-Flags AVP: Flags shall be set as follows:\n-\tSingle-Registration-Indication shall be set to 0.\n-\tSGSN area restricted shall be set to 0.\n-\tReady for SM from SGSN shall be set to 1 if alertReasonIndicator is received within ReadyForSMArg; otherwise it shall be set to 0.\n-\tReady for SM from MME shall be set to 1 if alertReasonIndicator is not received within ReadyForSMArg; otherwise it shall be set to 0.\n-\tUE Reachable shall be set to 0.\n-\tHomogeneous Support of IMS Voice Over PS Sessions shall be set to 0.\n-\tRemoval of MME Registration for SMS shall be set to 0.\nMaximum-UE-Availability-Time AVP shall be present and populated with the value of the maximumUeAvailabilityTime parameter, when received in the ReadyForSMArg.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.8.2"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.9.1",
      "section_id": "8.9.1",
      "section_title": "ECR mapping to CheckIMEI-Arg",
      "content": "When the IWF needs to construct a MAP-CheckIMEI message as a result of receiving an ECR command (see section 7.9.1 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of CheckIMEI-Arg as described below:\nimei in CheckIMEI-Arg shall be populated with the imei (and software version) as received within the Terminal-Information AVP within ECR.\nrequestedEquipmentInfo in CheckIMEI-Arg shall indicate equipmentStatus.\nextensionContainer in CheckIMEI-Arg shall be absent.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.9.1"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.9.2",
      "section_id": "8.9.2",
      "section_title": "CheckIMEI-Res / Error  mapping to ECA",
      "content": "When the IWF needs to construct an ECA command as a result of receiving a CheckIMEI Ack/Error message  (see section 7.9.1 step 4), the IWF shall populate AVPs of ECA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a CheckIMEI-Res parameter was received in a TCAP ResultLast component;\n-\tDIAMETER_ERROR_UNKNOWN_EQUIPMENT if an error of unknownEquipment was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nAuth-Session-State AVP shall be set to the value NO_STATE_MAINTAINED (1).\nEquipment-Status AVP shall be populated with a value as received within the equipmentStatus parameter within CheckIMEI-Res.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.9.1"
      ]
    },
    {
      "chunk_id": "ts_29.305_8.10.1",
      "section_id": "8.10.1",
      "section_title": "ActivateTraceMode-Arg mapping to IDR",
      "content": "When the IWF needs to construct an IDR command as a result of receiving a MAP-ActivateTraceMode message (see sections 7.10.1 step 2), the IWF shall populate AVPs of the IDR as described below:\nUser-Name AVP shall be populated with the value received within the imsi parameter of ActivateTraceModeArg.\nSupported-Features AVP shall be absent.\nSubscription-Data AVP shall be present and populated as follows:\nTrace-Data AVP shall be present and populated as in chapter 8.2.2.\nAll other sub-AVPs shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.10.2",
      "section_id": "8.10.2",
      "section_title": "IDA mapping to ActivateTraceMode-Res / Error",
      "content": "When the IWF needs to construct a MAP-ActivateTraceMode Ack message as a result of receiving an IDA command (see sections 7.10.1 step 4), the IWF shall populate sub-parameters of ActivateTraceMode Res/Error as described below:\nActivateTraceModeRes:\ntraceSupportIndicator shall be present if an indication of support of this feature was received within the Supported-Feature AVP within IDA; Otherwise, it shall be absent.\nextensionContainer shall be absent.\nActivateTraceMode Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.11.1",
      "section_id": "8.11.1",
      "section_title": "DeactivateTraceMode-Arg mapping to DSR",
      "content": "When the IWF needs to construct an DSR command as a result of receiving a MAP-DeactivateTraceMode message (see sections 7.11.1 step 2), the IWF shall populate AVPs of DSR as described below:\nUser-Name AVP shall be populated with the value received within the imsi parameter of DeactivateTraceModeArg.\nTrace-Reference AVP shall be populated with the values received within the traceReference and traceReference2 parameters of DeactivateTraceModeArg.\nSupported-Features AVP shall be absent.\nDSR-Flags AVP: Trace Data Withdrawal shall be set to 1. All other Flags shall be set as 0.\nContext-Identifier AVPs shall be absent.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.305_8.11.2",
      "section_id": "8.11.2",
      "section_title": "DSA mapping to DeactivateTraceMode-Res / Error",
      "content": "When the IWF needs to construct a MAP-DeactivateTraceMode Ack message as a result of receiving an DSA command (see sections 7.11.1 step 4), the IWF shall populate sub-parameters of DeactivateTraceMode Res/Error as described below:\nDeactivateTraceModeRes:\nextensionContainer shall be absent.\nDeactivateTraceMode Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.\nAnnex A:\tIWFs for the support of SMS capable MMEs or SGSNs\nA.1\tGeneral\nThis Annex describes the various cases of IWFs used for SMS related interfaces.\nA.2\tIWF related to the SGd/Gdd interfaces between MME/SGSN and central SMS functions\nA.2.1\tIntroduction\nThe clause A.2 with its subclauses describes the IWFs  used between an MME/SGSN, supporting the SGd/Gdd interface and Central SMS functions (SMS-GMSC, SMS-IWMSC, SMS Router) supporting a MAP E interface.\n3GPP TS 23.204 [6] has specified the support of SMS for IMS UE to IMS UE without MSISDN which impacts the IWF description for the IP-SM-GW with SMS Central functions over SGd/Gdd.\nA.2.2\tGeneral considerations\nVoid\nA.2.3\tInterworking scenarios\nA.2.3.1 \tOne IWF scenario\nThis interworking scenario, illustrated in figure A.2.3.1-1, is between a MME/SGSN supporting SGd/Gdd interface based on Diameter and central SMS functions (SMS-GMSC, SMS-IWMSC, SMS Router) supporting a MAP based E interface for SMS with one IWF in the path.\nThis interworking scenario also applies between an IP/SM/GW  supporting SGd/Gdd interface based on Diameter and central SMS functions (SMS-GMSC, SMS-IWMSC) supporting a MAP based E interface for SMS with one IWF in the path, in particular for SMS for IMS UE to IMS UE without MSISDN (see 3GPP TS 23.204 [6]).\nThis IWF scenario can be an inter PLMN use case where the MME/SGSN and the IWF are in the Visited PLMN.\nThis IWF scenario can be an intra PLMN use case where the central SMS functions are supporting MAP based interfaces.\nFigure A.2.3.1-1 SGd - E for SMS interworking scenario with one IWF\nFor MO Forward short messages requests, the IWF shall use the SC address (E.164 number) received over SGd/Gdd  for routing over MAP.\nFor MT Forward short messages, the IWF shall rely on the E.164 number of the MME/SGSN used to route the MAP message towards the IWF to locally determine the Diameter address of the MME/SGSN.\nFor ALR, the IWF shall use the SC address (E.164 number) received over SGd/Gdd  for routing over MAP.\nA.2.3.2\tTwo IWF scenario\nThis interworking scenario, illustrated in figure A.2.3.2-1 is between a MME/SGSN supporting a SGd/Gdd interface based on Diameter and central SMS functions (SMS-GMSC, SMS-IWMSC, SMS Router) supporting a SGd/Gdd interface based on Diameter with two IWF in the path, a MAP based E interface for SMS being used between the IWFs.\nThis interworking scenario, also applies between an IP-SM-GW supporting a SGd/Gdd interface based on Diameter and central SMS functions (SMS-GMSC) supporting a SGd/Gdd interface based on Diameter with two IWF in the path, a MAP based E interface for SMS being used between the IWFs, in particular for SMS for IMS UE to IMS UE without MSISDN (see 3GPP TS 23.204 [6]).\nFigure A.2.3.2-1: Two IWFs scenario\nThe IWF1 is located in the PLMN of the MME/SGSN or in the PLMN of the IP-SM-GW. IWF2 is located in the PLMN of the SMS-GMSC or the SMS-IWMSC or the SMS Router. The SMS Router may be in a PLMN different from the PLMN of the SMS-GMSC.\nThe IWF1 needs not to be aware whether its connection via E for SMS interface is to an IWF or to central SMS functions (see One IWF scenario).\nFor routing of MO and MT forward short messages and ALR, the IWF1 shall behave as the IWF of the one IWF scenario.\nFor MO Forward short messages requests, the IWF2 shall rely on the E.164 number of the SMS-SC used to route the MAP message towards the IWF2 to locally determine the Diameter address of the SMS-IWMSC.\nFor MT Forward short messages requests, the IWF2 shall use the E.164 number of the MME/SGSN/IP-SM-GW received over SGd/Gdd to route the MAP message towards the IWF1.\nFor ALR, the IWF2 shall route the message using the SMS-GMSC Diameter Address received in the Alert Service Centre message.\nA.2.4\tThe mapping of procedures\nA.2.4.1\tMO Forward Short Message\nA.2.4.1.1\tOne IWF Scenario\nThe mapping of the MO Forward Short Message procedure for this scenario is shown in figure A.2.4.1.1-1:\nFigure A.2.4.1.1-1: Mapping of MO Forward Short Message procedure with one IWF\n1.\tThe IWF receives a OFR message from the MME/SGSN/IP-SM-GW.\n2.\tThe IWF opens a MAP v3 dialogue towards the SMS-IWMSC by sending MO-ForwardSM.\n3.\tThe IWF receives MO-ForwardSM Ack from the SMS-IWMSC.\n4.\tThe IWF sends OFA to the MME/SGSN/IP-SM-GW.\nA.2.4.1.2\tTwo IWFs Scenario\nThe mapping of the MO Forward Short Message procedure for this scenario is shown in figure A.2.4.1.2-1:\nFigure A.2.4.1.2-1: Mapping of MO Forward Short Message procedure with two IWFs\n1.\tThe IWF1 receives an OFR message from the MME/SGSN.\n2.\tThe IWF1 opens a MAP v3 dialogue towards IWF2 by sending MO-ForwardSM.\n3.\tThe IWF2 constructs the OFR message and sends it to the SMS-IWMSC.\n4.\tThe IWF2 receives the OFA message from the SMS-IWMSC.\n5.\tThe IWF2 closes the MAP dialogue with the IWF2 by sending MO-ForwardSM Ack.\n6.\tThe IWF1 sends the OFA message to the MME/SGSN.\nA.2.4.2\tMT Forward Short Message\nA.2.4.2.1\tOne IWF Scenario\nThe mapping of the MT Forward Short Message procedure for this scenario is shown in figure A.2.4.2.1-1:\nFigure A.2.4.2.1-1: Mapping of MT Forward Short Message procedure with one IWF\n1.\tThe IWF receives a MT-ForwardSM MAP v3 message from the SMS-GMSC or from the SMS Router.\n2.\tThe IWF sends TFR to the MME/SGSN/IP-SM-GW.\n3.\tThe IWF receives TFA.\n4.\tThe IWF closes the MAP dialogue with the SMS-GMSC or the SMS Router by sending MT-ForwardSM Ack.\nA.2.4.2.2\tTwo IWFs Scenario\nThe mapping of the MT Forward Short Message procedure for this scenario is shown in figure A.2.4.2.2-1:\nFigure A.2.4.2.2-1: Mapping of MT Forward Short Message procedure with two IWFs\n1.\tThe IWF2 receives a TFR message from the SMS-GMSC or the SMS Router.\n2.\tThe IWF2 opens a MAP v3 dialogue towards IWF1 by sending MT-ForwardSM.\n3.\tThe IWF1 constructs the TFR message and sends it to the MME/SGSN/IP-SM/GW.\n4.\tThe IWF1 receives the TFA message from the MME/SGSN/IP-SM-GW.\n5.\tThe IWF1 closes the MAP dialogue with the IWF1 by sending MT-ForwardSM Ack.\n6.\tThe IWF2 sends an OFA message to the SMS-GMSC or the SMS Router.\nA.2.4.3\tAlert Service Centre\nA.2.4.3.1\tOne IWF Scenario\nThe mapping of the Alert Service Center procedure for this scenario is shown in figure A.2.4.3.1-1:\nFigure A.2.4.3.1-1: Mapping of Alert Service Centre procedure with one IWF\n1.\tThe IWF receives an ALR message from the MME or SGSN.\n2.\tThe IWF opens a MAP v3 dialogue towards the SMS-GMSC or SMS Router by sending an alertServiceCentre.\n3.\tThe IWF receives an alertServiceCentre Ack from the SMS-GMSC or SMS Router.\n4.\tThe IWF sends an ALA message to the MME or SGSN.\nA.2.4.3.2\tTwo IWFs Scenario\nThe mapping of the Alert Service Center procedure for this scenario is shown in figure A.2.4.x.2-1:\nFigure A.2.4.3.2-1: Mapping of Alert Service Centre procedure with two IWFs\n1.\tThe IWF1 receives an ALR message from the MME or SGSN.\n2.\tThe IWF1 opens a MAP v3 dialogue towards the IWF2 by sending an alertServiceCentre.\n3.\tThe IWF2 sends an ALR message to the SMS-GMSC or SMS Router.\n4.\tThe IWF2 receives an ALA from the SMS-GMSC or SMS Router.\n5.\tThe IWF2 sends an alertServiceCenter Ack to the IWF1.\n6.\tThe IWF1 sends an ALA message to the MME or SGSN.\nA.2.5\tThe mapping of parameters\nA.2.5.1\tMapping of Parameters for the MO Forward Short Message procedure\nA.2.5.1.1\tOFR mapping to MO-ForwardSM-Arg\nWhen the IWF needs to construct a MAP MO-ForwardSM message as a result of receiving an OFR command (see subclause A.2.4.1.1 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of MO-ForwardSM-Arg as described below:\nsm-RP-DA in MO-ForwardSM-Arg shall be present and populated with the value received within the SC-Address AVP within OFR.\nsm-RP-OA in MO-ForwardSM-Arg shall be present and populated with the value received within the MSISDN AVP within the User-Identifier  AVP within OFR.\nsm-RP-UI in MO-ForwardSM-Arg shall be present and populated with the value received within the SM-RP-UI AVP within OFR\nextensionContainer in MO-ForwardSM-Arg shall be present .\nimsi in MO-ForwardSM-Arg shall be present and populated with the value received within the User-Name AVP in the User-Identifier  AVP within OFR. .\ncorrelationID in MO-ForwardSM-Arg shall be present if SMSMI-Correlation-ID AVP in OFR is present and be populated as follows:\nhlr-id parameter shall be populated with the value received within HSS-ID AVP within SMSMI-Correlation-ID AVP within OFR.\nsip-uri-A parameter shall be populated with the value received within Originating-SIP-URI AVP within SMSMI-Correlation-ID AVP within OFR.\nsip-uri-B parameter  shall be populated with the value received within Destination-SIP-URI AVP within SMSMI-Correlation-ID AVP within OFR.\nsm-DeliveryOutcome in MO-ForwardSM-Arg shall be present if SMSMI-Correlation-ID AVP in OFR is present and be populated with the value received  in SM-Delivery-Cause within IP-SM-GW-SM-Delivery-Outcome within SM-Delivery-Outcome within OFR.\nA.2.5.1.2\tMO-ForwardSM-Res / Error  mapping to OFA\nWhen the IWF needs to construct an OFA command as a result of receiving a MAP MO-ForwardSM Ack/Error message (see subclause A.2.4.1.1 step 4), the IWF shall populate AVPs of OFA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a MO-ForwardSM-Res parameter was received in the TCAP ResultLast component;\n-\tDIAMETER_ERROR_FACILITY_NOT_SUPPORTED if an error of facilityNotSupported was received;\n-\tDIAMETER_UNABLE_TO_COMPLY if an error of systemFailure was received;\n-\tDIAMETER_SM_DELIVERY_FAILURE if an error of sm-DeliveryFailure was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nSM-Delivery- Failure-Cause AVP: shall be populated as follows:\nSM-Enumerated-Delivery-Failure-Cause AVP shall be present and populated with the value received within the SM-EnumeratedDeliveryFailureCause parameter, when present, within the sm-DeliveryFailureCause of the MO-ForwardSM message.\nSM-Diagnostic-Info AVP shall be populated with the value received within the diagnosticInfo parameter, when present, within the sm-DeliveryFailureCause within the MO-ForwardSM message.\nSM-RP-UI AVP shall be populated with the value received within the sm-RP-UI parameter, when present, of the MT-ForwardSM-Res message.\nA.2.5.1.3\tMO-ForwardSM-Arg mapping to OFR\nWhen the IWF needs to construct a OFR command as a result of receiving a MAP MO-ForwardSM message (see subclause A.2.4.1.2 step 3), the IWF shall populate AVPs of OFR as described below:\nUser-Name AVP shall be present and populated with the value received within the sm-RP-DA parameter of MO-ForwardSM-Arg and translated into an UTF8String format.\nUser Identifier AVP shall be present and shall be populated as follows:\nUser-Name AVP shall be present and populated with the value received within the imsi parameter of MO-ForwardSM-Arg and translated into an UTF8String format.\nMSISDN AVP shall be populated with the value received within the sm-RP-OA parameter of MO-ForwardSM-Arg\nSM-RP-UI AVP shall be populated with the value received within the sm-RP-UI parameter of MO-ForwardSM-Arg\nSupported-Features AVP shall be absent.\nA.2.5.1.4\tOFA mapping to MO-ForwardSM-Res/Error\nWhen the IWF needs to construct MAP MO-ForwardSM Ack message as a result of receiving a OFA command (see subclause A.2.4.1.2 step 5), the IWF shall populate sub-parameters of MO-ForwardSM-Res/Error as described below:\nmo-ForwardSM-Res:\nsm-RP-UI in MO-ForwardSM-Res shall be populated with the value received within the SM-RP-UI AVP when present.\nextensionContainer in MO-ForwardSM-Res shall be absent.\nmo-ForwardSM Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto the following MAP errors:\n-\tAn error of systemFailure if a DIAMETER_UNABLE_TO_COMPLY result was received;\n-\tAn error of unexpectedDataValue if a DIAMETER_INVALID_AVP_VALUE result was received;\n-\tAn error of facilityNotSupported if a DIAMETER_ERROR_FACILITY_NOT_SUPPORTED result was received;\n-\tAn error of sm-DeliveryFailure if a DIAMETER_ERROR_SM_DELIVERY_FAILURE.\n-\tsm-DeliveryFailureCause when a DIAMETER_ERROR_SM_DELIVERY_FAILURE result was received, shall be populated as follows:\n-\tSM-EnumeratedDeliveryFailureCause shall be populated with the value received within the SM-Enumerated-Delivery-Failure-Cause AVP within the SM-DeliveryFailureCause AVP within OFA;\n-\tdiagnosticInfo parameter shall be populated with the value received within the SM-Diagnostic-Info AVP, when present, within the SM-DeliveryFailureCause AVP within OFA.\nA.2.5.2\tMapping of Parameters for the MT Forward Short Message Procedure\nA.2.5.2.1\tMT-ForwardSM-Arg mapping to TFR\nWhen the IWF needs to construct a TFR command as a result of receiving a MAP MT-ForwardSM message (see subclause A.2.4.2.1 step 2), the IWF shall populate AVPs of TFR as described below:\nUser-Name AVP shall be populated with the value received within the sm-RP-DA parameter of MT-ForwardSM-Arg.\nSC-Address AVP shall be populated with the value received within the sm-RP-OA parameter of MT-ForwardSM-Arg\nSM-RP-UI AVP shall be populated with the value received within the sm-RP-UI parameter of MT-ForwardSM-Arg\nSMSMI-Correlation-ID AVP shall be present if correlationID in MT-ForwardSM-Arg is present and be populated as follows:\nOriginating-SIP-URI AVP shall be populated with the value received within the sip-uri-A parameter within correlationID of MT-ForwardSM-Arg.\nDestination-SIP-URI AVP shall be populated with the value received within the sip-uri-B parameter within correlationID of MT-ForwardSM-Arg.\nTFR-Flags AVP: Flags shall be set as follows:\nMore-Messages- To-Send shall be set to 1 if the moreMessagesToSend parameter was present within MT-ForwardSM-Arg; otherwise shall be set to 0 or the AVP shall be absent.\nSupported-Features AVP shall be absent.\nSM-Delivery-Timer AVP shall be present and populated with the value of the smDeliveryTime, when present within the MT-ForwardSM-Arg.\nSM-Delivery- Start-Time AVP shall be present and populated with the value of the smDeliveryStartTime, when present within the MT-ForwardSM-Arg.\nMaximum-Retransmission-Time AVP shall be present and populated with the value of the maximumRetransmissionTime parameter, when present within the MT-ForwardSM-Arg.\nSMS-GMSC Address AVP shall be present and populated with the value of the smsGmscAddress parameter, when present within the MT-ForwardSM-Arg.\nA.2.5.2.2\tTFA mapping to MT-ForwardSM-Res/Error\nWhen the IWF needs to construct MAP MT-ForwardSM Ack message as a result of receiving a TFA command (see subclause A.2.4.2.1 step 4), the IWF shall populate sub-parameters of MT-ForwardSM-Res/Error as described below:\nmt-ForwardSM-Res:\nsm-RP-UI in MO-ForwardSM-Res shall be populated with the value received within the SM-RP-UI AVP when present.\nextensionContainer in MT-ForwardSM-Res shall be absent.\nmt-ForwardSM Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto the following MAP errors:\n-\tAn error of systemFailure error if a DIAMETER_UNABLE_TO_COMPLY result was received;\n-\tAn error of dataMissing if a DIAMETER_MISSING_AVP result was received;\n-\tAn error of unexpectedDataValue if a DIAMETER_INVALID_AVP_VALUE result was received;\n-\tAn error of facilityNotSupported if a DIAMETER_ERROR_FACILITY_NOT_SUPPORTED result was received;\n-\tAn error of unidentifiedSubscriber if a DIAMETER_ERROR_USER_UNKNOWN result was received;\n-\tAn error of illegalSubscriber if a DIAMETER_ERROR_ILLEGAL_USER result was received;\n-\tAn error of illegalEquipment if a DIAMETER_ERROR_ILLEGAL_EQUIPMENT result was received;\n-\tAn error of subscriberBusyForMT-SMS if a DIAMETER_ERROR_USER_BUSY_FOR_MT_SMS result was received;\n-\tAn error of sm-DeliveryFailure if a DIAMETER_ERROR_SM_DELIVERY_FAILURE result was received;\n-\tAn error of absentSubscriberSM if a DIAMETER_ERROR_ABSENT_USER result was received.\n-\tsm-DeliveryFailureCause, when a  DIAMETER_ERROR_SM_DELIVERY_FAILURE result was received,  shall be populated  as follows:\n-\tSM-EnumeratedDeliveryFailureCause shall be populated with the value received within the SM-Enumerated-Delivery-Failure-Cause AVP within the SM-DeliveryFailureCause AVP within TFA;\n-\tdiagnosticInfo shall be populated with the value received within the SM-Diagnostic-Info AVP, when present, within the SM-DeliveryFailureCause AVP within TFA.\n-\tabsentSubscriberDiagnosticSM, when a DIAMETER_ERROR_ABSENT_USER result was received,  shall be populated with the value received within the Absent-Subscriber-Diagnostic-SM AVP, when present, within TFA.\n-\trequestedRetransmissionTime shall be present and populated with the value received in the Requested-Retransmission-Time AVP, when present, within TFA.\nA.2.5.2.3\tTFR mapping to MT-ForwardSM-Arg\nWhen the IWF needs to construct a MAP MT-ForwardSM message as a result of receiving a TFR command (see subclause A.2.4.2.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of MT-ForwardSM-Arg as described below:\nsm-RP-DA in MT-ForwardSM-Arg shall be present and populated with the value received within the User-Name AVP within TFR.\nsm-RP-OA in MT-ForwardSM-Arg shall be present and populated with the value received within the SC-Address AVP within TFR.\ncorrelationID  in MT-ForwardSM-Arg shall be present if SMSMI-Correlation-ID AVP in TFR is present and be populated as follows:\nsip-uri-A parameter shall be populated with the value received within Originating-SIP-URI AVP within SMSMI-Correlation-ID AVP within TFR.\nsip-uri-B parameter shall be populated with the value received within Destination-SIP-URI AVP within SMSMI-Correlation-ID AVP within TFR.\nsm-RP-UI in MT-ForwardSM-Arg shall be present and populated with value received within the SM-RP-UI AVP within TFR\nmoreMessagesToSend shall be present  if the More-Messages-To-Send flag is set to 1 within the TFR-Flags AVP within MT-ForwardSM-Arg.\nsmDeliveryTime in MT-ForwardSM-Arg shall be present and populated with the value within the SM-Delivery-Timer AVP when received within TFR.\nsmDeliveryStartTime in MT-ForwardSM-Arg shall be present and populated with the value within the SM-Delivery- Start-Time AVP when received within TFR.\nmaximumRetransmissionTime in MT-ForwardSM-Arg shall be present and populated with the value of the Maximum-Retransmission-Time AVP when received within TFR.\nsmsGmscAddress shall be present and populated with the value within the SMS-GMSC Address AVP, when received within TFR.\nNOTE:\tThe value of the MME-Number-For-MT-SMS AVP or of the SGSN-Number AVP is not conveyed in the MAP MT-ForwardSM message but is used by IWF2 for routing the MAP MT-ForwardSM message towards IWF1.\nA.2.5.2.4\tMT-ForwardSM-Res / Error  mapping to TFA\nWhen the IWF needs to construct a TFA command as a result of receiving a MAP MT-ForwardSM Ack/Error message (see subclause A.2.4.2.2 step 6), the IWF shall populate AVPs of TFA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a MT-ForwardSM-Res parameter was received in the TCAP ResultLast component;\n-\tDIAMETER_ERROR_USER_UNKNOWN if an error of unidentifiedSubscriber was received;\n-\tDIAMETER_ERROR_ABSENT_USER if an error of absentSubscriberSM was received;\n-\tDIAMETER_ERROR_USER_BUSY_FOR_MT_SMS if an error of subscriberBusyForMT-SMS was received;\n-\tDIAMETER_ERROR_ILLEGAL_USER if an error of illegalSubscriber was received;\n-\tDIAMETER_ERROR_ILLEGAL_EQUIPMENT if an error of illegalEquipment was received\n-\tDIAMETER_UNABLE_TO_COMPLY if an error of systemFailure was received\n-\tDIAMETER_SM_DELIVERY_FAILURE if an error of sm-DeliveryFailure was received;\n-\tan appropriate DIAMETER base protocol result code otherwise.\nSM-Delivery-Failure-Cause AVP, when an error of sm-DeliveryFailure was received, shall be populated as follows:\n-\tSM-Enumerated-Delivery-Failure-Cause AVP shall be present and populated with the value received within the SM-EnumeratedDeliveryFailureCause parameter of the MT-ForwardSM Error message.\n-\tSM-Diagnostic-Info AVP shall be populated with the value received within the diagnosticInfo parameter, when present, within the sm-DeliveryFailureCause within the MT-ForwardSM Error message.\nAbsent-Subscriber-Diagnostic-SM AVP, when an error of absentSubscriberSM was received, shall be populated with the value received within the absentSubscriberDiagnosticSM parameter of the MT-ForwardSM Error message.\nSM-RP-UI AVP shall be populated with the value received within the sm-RP-UI parameter, when present, of the MT-ForwardSM-Res message.\nRequested-Retransmission-Time AVP shall be present and populated with the value received within the requestedRetransmissionTime parameter, when present within the MT-ForwardSM Error message.\nA.2.5.3\tMapping of Parameters for the Alert Service Centre Procedure\nA.2.5.x.1\tALR mapping to alertServiceCentre-Arg\nWhen the IWF needs to construct a MAP alertServiceCentre message as a result of receiving an ALR command, the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of alertServiceCentre-Arg as described below:\n-\tmsisdn shall be populated with the dummy MSISDN value (see clause 3 of 3GPP TS 23.003 [7])\nNOTE:\tNo MSISDN AVP is present in this scenario within the User-Identifier AVP in the ALR message.\n-\timsi shall be populated with the value received within User-Name AVP within the User-Identifier AVP within ALR.\n-\tserviceCentreAddress shall be present and populated with the value received within the SC-Address AVP within ALR.\n-\tnewSgsnNumber shall be present and populated with the value received within the SGSN-Number AVP of the Serving-Node AVP within ALR.\n-\tnewMmeNumber shall be present and populated with the value received within the MME-Number-for-MT-SMS AVP of the Serving-Node AVP within ALR.\n-\tnewSgsnDiameterAddress shall be present and populated with the value received within the SGSN-Name and SGSN-Realm AVPs of the Serving-Node AVP, when present in ALR.\n-\tnewMmeDiameterAddress shall be present and populated with the value received within the MME-Name and MME-Realm AVPs of the Serving-Node AVP, when present in ALR.\n-\tsmsGmscAlertEvent shall be present and populated with the value received within the SMS-GMSC-Alert-Event AVP within ALR.\n-\tsmsGmscDiameterAddress shall be present and populated with the value received in the Destination-Host and Destination-Realm in ALR.\nA.2.5.3.2\talertServiceCentre-Res / Error mapping to ALA\nWhen the IWF needs to construct an ALA command as a result of receiving a MAP alertServiceCentre Ack/Error message, the IWF shall populate AVPs of ALA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if no error was received in the TCAP ResultLast component;\n-\ta DIAMETER base protocol result code according to the following table:\nTable A.2.5.3.2-1 Mapping from MAP error codes to Diameter error codes\nMAP error code\nDiameter Result code / Experimental Result\nsystemFailure\nDIAMETER_UNABLE_TO_COMPLY\ndataMissing\nDIAMETER_MISSING_AVP\nunexpectedDataValue\nDIAMETER_INVALID_AVP_VALUE\nSupported Features AVP shall be absent.\nA.2.5.3.3\talertServiceCentre-Arg mapping to ALR\nWhen the IWF needs to construct an ALR command as a result of receiving a MAP alertServiceCentre message, the IWF shall populate the ALR as described below:\n-\tUser-Name AVP within User-Identifier AVP shall be present and populated with the value received within the imsi parameter of the alertServiceCenter-Arg.\n-\tSC-Address AVP shall be present and populated with the value received within the serviceCentreAddress parameter of the alertServiceCenter-Arg.\n-\tSGSN-Number AVP of the Serving-Node AVP shall be present and populated with the value received within the newSgsnNumber of the alertServiceCenter-Arg.\n-\tMME-Number-for-MT-SMS AVP shall be present and populated with the value received within the newMmeNumber of the alertServiceCenter-Arg.\n-\tSGSN-Name and SGSN-Realm AVPs of the Serving-Node AVP shall be present and populated with the value received within newSgsnDiameterAddress, when present in the alertServiceCenter-Arg.\n-\tMME-Name and MME-Realm AVPs shall be present and populated with the value received within newMmeDiameterAddress, when present in the alertServiceCenter-Arg.\n-\tSMS-GMSC-Alert-Event AVP shall be present and populated with the value received within the smsGmscAlertEvent of the alertServiceCenter-Arg.\n-\tDestination-Host and Destination-Realm AVPs shall be present and populated with the value received in the smsGmscDiameterAddress in the alertServiceCenter-Arg.\nA.2.5.3.4\tALA mapping to alertServiceCentre-Res\nWhen the IWF needs to construct a MAP alertServiceCentre Ack/Error message as a result of receiving an ALA command, the IWF shall populate the MAP alertServiceCenter Ack/Error as described below:\nMAP error code shall be set as follows:\nTable A.2.5.3.4-1 Mapping from Diameter error codes to MAP error codes\nDiameter Result code / Experimental Result\nMAP error code\nDIAMETER_UNABLE_TO_COMPLY\nsystemFailure\nDIAMETER_MISSING_AVP\ndataMissing\nDIAMETER_INVALID_AVP_VALUE\nunexpectedDataValue\nA.3.\tIWF related to the S6c interface between HSS and central SMS functions\nA.3.1\tIntroduction\n3GPP TS 23.272 [3] has specified the \"SMS in MME\" architecture option, where an IWF between the HSS supporting the S6c interface and the central SMS functions (SMS-GMSC, SMS-IWMSC, SMS Router) supporting the MAP C interface for SMS is defined.  This S6c IWF is described in the following subclauses.\n3GPP TS 23.204 [6] has specified the support of SMS for IMS UE to IMS UE without MSISDN which impacts the IWF description over S6c.\nA.3.2\tInterworking scenarios\nA.3.2.1 \tIWF scenario\nThis interworking scenario is illustrated in the two following figures:\n-\tin figure A.3.2.1-1, an IWF is between a HSS supporting the S6c interface based on Diameter and central SMS functions (SMS-GMSC, SMS-IWMSC) supporting a MAP based C interface for SMS. There is no SMS Router.\n-\tin figure A.3.2.1-2, there is a SMS router used for MT SMS with which the IWF will interact, taking into account that Diameter requests from the IWF, according to operator configuration, are sent to the SMS Router either directly or via the HSS.\nThis IWF scenario can be an inter PLMN use case where the HSS, the SMS Router, the IP-SM-GW and the IWF are in the Home PLMN.\nIn the Home PLMN, when the HSS supports S6c, the SMS Router shall also support S6c, i.e. there is no IWF between HSS and SMS Router.\nThis IWF scenario can be an intra PLMN use case.\nFigure A.3.2.1-1 S6c - C for SMS interworking scenario with an IWF\nFigure A.3.2.1-2 S6c - C for SMS interworking scenario with SMS Router and an IWF\nA.3.3\tGeneral considerations\nA.3.3.1\tRouting considerations\nMAP requests issued by the SMS-GMSC are routed to the IWF on the basis of the SSN and of the MSISDN, then the corresponding Diameter requests are routed on the basis of the Diameter application identifier and of the MSISDN or of the IMSI. If a SMS router is deployed, the HSS will forward the Send Routing Info for SM commands to the SMS router.\nIn a retry context of SMS for IMS UE to IMS UE without MSISDN (see 3GPP TS 23.204 [6]), the MAP requests issued by the SMS-GMSC or the SMS-SC are routed to the IWF on the basis of the SSN and of the HSS ID, then the corresponding Diameter requests are routed on the basis of the Diameter application identifier and of the HSS ID. In this case, the HSS does not forward the Send Routing Info for SM commands to the IP-SM-GW.\nDiameter requests (i.e when an Alert procedure) issued by the HSS are routed to the IWF on the basis of the application identifier and of the SC-Address AVP containing the SMS-SC number.  Then the corresponding MAP request is routed to the SMS-IWMSC on the basis of the SSN and of the SMS-SC number.\nA.3.4\tThe mapping of procedures\nA.3.4.1\tSend Routing Info for SM\nThe mapping of the Send Routing Info for SM procedure is shown in figure A.3.4.1-1:\nFigure A.3.4.1-1: Mapping of Send Routing Info for SM procedure\n1.\tThe IWF receives a sendRoutingInfoForSM MAP V3 message from the SMS-GMSC.\n2.\tThe IWF sends SRR to the HSS or SMS Router or IP-SM-GW.\n3.\tThe IWF receives SRA from the HSS or SMS Router or IP-SM-GW.\n4.\tThe IWF sends a sendRoutingInfoForSM  Ack message to the SMS-GMSC.\n5. The IWF sends an informServiceCentre message to the SMS-GMSC if the SRA contains information elements requiring to be delivered with an informServiceCentre message and closes the MAP dialog\nA.3.4.2\tAlert Service Centre\nThe mapping of the Alert Service Centre procedure is shown in figure A.3.4.2-1:\nFigure A.3.4.2-1: Mapping of Alert Service Centre procedure\n1.\tThe IWF receives a ALR message from the HSS.\n2.\tThe IWF opens a MAP v3 dialogue towards the SMS-IWMSC by sending alertServiceCentre.\n3.\tThe IWF receives alertServiceCentre Ack from the SMS-IWMSC.\n4.\tThe IWF sends ALA to the MME, SGSN.\nA.3.4.3\tReport SM Delivery Status\nThe mapping of the Report SM Delivery Status procedure is shown in figure A.3.4.3-1:\nFigure A.3.4.3-1: Mapping of Report SM Delivery Status procedure\n1.\tThe IWF receives a reportSM-DeliveryStatus MAP V3 message from the SMS-GMSC or the SMS-SC.\n2.\tThe IWF sends RDR to the HSS.\n3.\tThe IWF receives SRA from the HSS.\n4.\tThe IWF closes the MAP dialogue with the SMS-GMSC by sending a reportSM-DeliveryStatus Ack to the SMS-GMSC or the SMS-SC.\nA.3.5\tThe mapping of parameters\nA.3.5.1\tMapping of Parameters for the Send Routing Info for SM Procedure\nA.3.5.1.1\tRoutingInfoForSM-Arg mapping to SRR\nWhen the IWF needs to construct a SRR command as a result of receiving a MAP sendRoutingInfoForSM message (see subclause A.3.4.1.1 step 2), the IWF shall populate AVPs of SRR as described below:\n-\tMSISDN AVP shall be populated with the value received within the msisdn parameter of RoutingInfoForSM-Arg when available.\n-\tUser-Name AVP shall be populated with the value received within the imsi parameter of RoutingInfoForSM-Arg when available.\n-\tSMSMI-Correlation-ID AVP shall be present if correlationID in RoutingInfoForSM-Arg is present and be populated as follows:\n-\tDestination-SIP-URI AVP shall be populated with the value received within the sip-uri-B parameter of RoutingInfoForSM-Arg.\n-\tSM-RP-PRI AVP shall be present and populated with the value received within the sm-RP-PRI parameter of RoutingInfoForSM-Arg.\n-\tSC-Address AVP shall be present and populated with the value received within the serviceCentreAddress parameter of RoutingInfoForSM-Arg\n-\tSM-RP-MTI AVP shall be populated with the value received within the sm-RP-MTI parameter, when present, of RoutingInfoForSM-Arg\n-\tSM-RP-SMEA AVP shall be populated with the value received within the sm-RP-SMEA parameter, when present, of RoutingInfoForSM-Arg\n-\tSRR-Flags AVP: Flags shall be set as follows:\n-\tGPRS-Indicator shall be set to 1 if the gprsSupportIndicator parameter was present within RoutingInfoForSM-Arg; otherwise shall be set to 0 or the AVP shall be absent.\n-\tSM-Delivery-Not-Intended AVP shall be populated with the value received within the sm-deliveryNotIntended parameter, when present, of RoutingInfoForSM-Arg\n-\tSupported-Features AVP shall be absent.\nA.3.5.1.2\tSRA mapping to RoutingInfoForSM-Res/Error\nWhen the IWF needs to construct a MAP sendRoutingInfoForSM Ack message as a result of receiving a SRA command (see subclause A.3.4.1.1 step 5), the IWF shall populate sub-parameters of RoutingInfoForSM-Res/Error as described below:\nRoutingInfoForSM-Res:\n-\timsi shall be  populated with the value received within the User-Name AVP, when present,  within SRA.\n-\tSub-parameters of locationInfoWithLMSI shall be populated as follows:\n-\tnetworkNode-Number shall be populated with the value received within either the MME-Number-for-MT-SMS AVP or the MSC-Number AVP or the SGSN-Number AVP or the IP-SM-GW-Number AVP, within the Serving-Node when present, within the SRA.\n-\tSub-parameters diameter-Name and diameter-Realm of networkNodeDiameterAddress shall be populated with the values received within the MME-Name & MME-Realm AVPs or within the IP-SM-GW-Name & IP-SM-GW-Realm AVPs within the Serving-Node AVP when present, within the SRA.\n-\tlmsi shall be  populated with the value received within the LMSI AVP when present, within the SRA.\n-\tgprsNodeIndicator shall be set if the received Serving Node AVP contains a SGSN AVP.\n-\tadditional-Number shall be populated with the value received within either the MME-Number-for-MT-SMS User-Name AVP or the MSC-Number AVP or the SGSN-Number SGSN AVP, within the Additional-Serving-Node when present, within the SRA.\n-\tSub-parameters diameter-Name and diameter-Realm of additionalNetworkNodeDiameterAddress shall be populated with the values received within the MME-Name and MME-Realm AVPs within the Additonal-Serving-Node AVP when present, within the SRA.\n-\tsm-RP-UI in MO-ForwardSM-Res shall be populated with the value received within the SM-RP-UI AVP when present.\n-\textensionContainer in MT-ForwardSM-Res shall be absent.\nError:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped according to the following table:\nTable A.3.5.1.2-1 Mapping from Diameter error codes to MAP error codes\nDiameter Result code / Experimental Result\nMAP error code\nDIAMETER_UNABLE_TO_COMPLY\nsystemFailure\nDIAMETER_MISSING_AVP\ndataMissing\nDIAMETER_INVALID_AVP_VALUE\nunexpectedDataValue\nDIAMETER_ERROR_FACILITY_NOT_SUPPORTED\nfacilityNotSupported\nDIAMETER_ERROR_USER_UNKNOWN\nunknownSubscriber\nDIAMETER_ERROR_SERVICE_NOT_SUBSCRIBED\nteleserviceNotProvisioned\nDIAMETER_ERROR_SERVICE_BARRED\ncallBarred\nDIAMETER_ERROR_ABSENT_USER\nabsentSubscriberSM\nWhen the Diameter Result code is DIAMETER_ERROR_ABSENT_USER, one or two absent user diagnostics (MME-Absent-User-Diagnostic-SM or MSC-Absent-User-Diagnostic-SM or SGSN-Absent-User-Diagnostic-SM AVPs) may be received. The following additional mapping shall apply:\n-\tWhen only one absent user diagnostic AVP is received, it is mapped to the absentSubscriberDiagnosticSM parameter.\n-\tWhen two absent user diagnostics AVPs are received , the SGSN-Absent-User-Diagnostic-SM AVP is mapped to the additionalAbsentSubscriberDiagnosticSM parameter , the other AVP is mapped to the absentSubscriberDiagnosticSM parameter.\nA.3.5.1.3\tSRA mapping to informServiceCentreArg\nWhen the IWF needs to construct a MAP informServiceCentre message as a result of receiving a SRA command (see subclause A.3.4.1.1 step 4), the IWF shall populate sub-parameters of InformServiceCentreArg as described below:\n-\tstoredMSISDN shall be populated with the value received within the MSISDN AVP within the User Identifier AVP, when present, within SRA.\n-\tmw-Status shall be populated with the value received within the MWD-Status AVP, when present, within SRA.\n-\tabsentSubscriberDiagnosticSM shall be populated with the value received within\n-\teither the MME-Absent-User-Diagnostic-SM AVP or the MSC-Absent-User-Diagnostic-SM AVP or the SGSN-Absent-User-Diagnostic-SM AVP, when only one of them is present, within the SRA.\n-\teither MME-Absent-User-Diagnostic-SM AVP or the MSC-Absent-User-Diagnostic-SM AVP, if one of them is present and if SGSN-Absent-User-Diagnostic-SM AVP is also present.\n-\tadditionalAbsentSubscriberDiagnosticSM shall be populated with the value received within the SGSN-Absent-User-Diagnostic-SM AVP, if it is present and if either the MME-Absent-User-Diagnostic-SM AVP or the MSC-Absent-User-Diagnostic-SM AVP  is present , within the SRA.\nA.3.5.2\tMapping of Parameters for the Alert Service Centre Procedure\nA.3.5.2.1\tALR mapping to alertServiceCentre-Arg\nWhen the IWF needs to construct a MAP alertServiceCentre message as a result of receiving an ALR command (see subclause A.3.4.2 step 2), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of alertServiceCentre-Arg as described below:\n-\tmsisdn shall be populated with the value received within MSISDN AVP, when present, within the User-Identifier AVP within ALR.\n-\timsi shall be populated with the value received within User-Name AVP, when present, within the User-Identifier AVP within ALR.\n-\tserviceCentreAddress shall be present and populated with the value received within the SC-Address AVP within ALR.\n-\tcorrelationId shall be present if SMSMI-Correlation-ID AVP within ALR  is present and be populated as follows:\nsip-uri-B parameter  shall be populated with the value received within Destination-SIP-URI AVP within SMSMI-Correlation-ID AVP within ALR\nA.3.5.2.2\talertServiceCentre-Res / Error mapping to ALA\nWhen the IWF needs to construct an ALA command as a result of receiving a MAP alertServiceCentre Ack/Error message (see subclause A.3.4.2 step 4), the IWF shall populate AVPs of ASA as described below:\nResult-Code / Experimental-Result AVP shall be set to:\n-\tDIAMETER_SUCCESS if a MO-ForwardSM-Res parameter was received in the TCAP ResultLast component;\n-\ta DIAMETER base protocol result code according to the following table:\nTable A.3.5.2.2-1 Mapping from MAP error codes to Diameter error codes\nMAP error code\nDiameter Result code / Experimental Result\nsystemFailure\nDIAMETER_UNABLE_TO_COMPLY\ndataMissing\nDIAMETER_MISSING_AVP\nunexpectedDataValue\nDIAMETER_INVALID_AVP_VALUE\nSupported Features AVP shall be absent.\nA.3.5.3\tMapping of Parameters for the Report SM Delivery Status Procedure\nA.3.5.3.1\tReportSM-DeliveryStatusArg mapping to RDR\nWhen the IWF needs to construct a SRR command as a result of receiving a MAP reportSM-DeliveryStatus message (see subclause A.3.4.3 step 2), the IWF shall populate AVPs of SRR as described below:\n-\tUser-Identifier AVP shall be present and populated as follows:\n-\tMSISDN AVP shall be populated with the value received, after format translation, within the msisdn parameter of ReportSM-DeliveryStatusArg.\n-\tSMSMI-Correlation-ID AVP shall be present if correlationID in ReportSM-DeliveryStatusArg is present and be populated as follows:\n-\tDestination-SIP-URI AVP shall be populated with the value received within the sip-uri-B parameter of ReportSM-DeliveryStatusArg.\n-\tSC-Address AVP shall be present and populated with the value received within the serviceCentreAddress parameter of RoutingInfoForSM-Arg\n-\tSM-Delivery-Outcome AVP shall be present and populated as follows:\nSGSN-SM-Delivery-Outcome AVP shall be populated\n-\twith the value received in sm-DeliveryOutcome parameter within ReportSM-DeliveryStatusArg if deliveryOutcomeIndicator flag is present;\n-\twith the value received in additionalSM-DeliveryOutcome, when  present, within ReportSM-DeliveryStatusArg;\notherwise SGSN-SM-Delivery-Outcome AVP shall be absent.\nMSC-SM-Delivery-Outcome AVP shall be populated\n-\twith the value received in sm-DeliveryOutcome parameter within ReportSM-DeliveryStatusArg if deliveryOutcomeIndicator flag is absent;\notherwise MSC-SM-Delivery-Outcome AVP shall be absent.\nMME-SM-Delivery-Outcome AVP shall be absent.\nNOTE:\tthe MAP-REPORT-SM-DELIVERY-STATUS request does not differentiate the delivery to a MSC from a delivery to a MME.\nIP-SM-GW-Delivery-Outcome AVP shall be populated\n-\twith the value received in sm-DeliveryOutcome parameter within ReportSM-DeliveryStatusArg if ip-sm-gw-Indicator flag is present;\n-\twith the value received in ip-sm-gw-sm-deliveryOutcome, when  present, within ReportSM-DeliveryStatusArg;\notherwise IP-SM-GW- Delivery-Outcome AVP shall be absent.\nNOTE:\tThe IP-SM-GW- Delivery-Outcome AVP presence can only occur when SMS-GMSC supports T4 triggering.\nSupported-Features AVP shall be absent.\nA.3.5.3.2\tRDA mapping to ReportSM-DeliveryStatusRes/Error\nWhen the IWF needs to construct a MAP reportSM-DeliveryStatus Ack message as a result of receiving a RDA command (see subclause A.3.4. step 4), the IWF shall populate sub-parameters of reportSM-DeliveryStatusRes/Error as described below:\nreportSM-DeliveryStatusRes:\n-\tstoredMSISDN shall be  populated with the value, after format translation, received within the User-Name AVP, when present,  within SRA.\n-\textensionContainer shall be absent.\nError:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped according to the following table:\nTable A.3.5.3.2-1 Mapping from Diameter error codes to MAP error codes\nDiameter Result code / Experimental Result\nMAP error code\nDIAMETER_UNABLE_TO_COMPLY\nsystemFailure\nDIAMETER_MISSING_AVP\ndataMissing\nDIAMETER_INVALID_AVP_VALUE\nunexpectedDataValue\nDIAMETER_ERROR_USER_UNKNOWN\nunknownSubscriber\nDIAMETER_ERROR_MWD_LIST_FULL\nmessageWaitingListFull\nA.4\tIWF related to the S6a/S6a+D interface between MME and  HSS\nA.4.1\tIntroduction\n3GPP TS 23.272 [2] has specified the \"SMS in MME\" architecture option, where an IWF, named S6a/S6a+D IWF, between the S6a interface with SMS subscription data on the MME side and the S6a interface without SMS subscription data plus the MAP-based D interface for SMS subscription on the MME side is defined. This S6a/S6a+D IWF is described in the following subclauses.\nA.Z.2\tInterworking scenario\nThis interworking scenario is illustrated in the figure A.4.2.1-1 where an IWF is placed between a MME supporting a Diameter based S6a interface with the SMS in MME feature and a HSS supporting a S6a interface without the SMS feature and a MAP D interface where the IWF emulates a VLR  limited to the support of SMS teleservice.\nThis IWF scenario, according to 3GPP TS 23.272 [4], may be used for roaming cases between the HSS in the home PLMN and the MME in the visited network.\nFigure A.4.2-1 S6a/S6a+D for SMS interworking scenario with one IWF\nThe S6a interface without SMS between the IWF and the HSS may be replaced by a MAP Gr interface without SMS between a S6a/Gr + D IWF and the HSS as illustrated in the figure A.4.2-2. The mapping of procedures described in clause A.4.4 and the mapping of parameters described in clause A.4.5 shall apply by replacing the commands transferred between the IWF and the HSS over S6a by the corresponding ones over the Gr interface in compliance with the clauses 6, 7, 8.\nFigure A.4.2-2 S6a/Gr+D for SMS interworking scenario with one IWF\nThe IWF shall be configured as a MSC-VLR in the HSS over the D interface. Only the SMS teleservice will be available on the D interface.\nA.4.3\tGeneral considerations\nA.4.3.1\tProcedures covered\nThe MAP procedures on the D interface to be supported by the IWF are:\n-\tthe procedures involved in the support of SMS teleservice:\n-\tMAP-UPDATE-LOCATION\n-\tMAP-CANCEL-LOCATION\n-\tMAP-INSERT-SUBSCRIBER-DATA\n-\tMAP-DELETE-SUBSCRIBER-DATA\n-\tMAP-READY-FOR-SM\n-\tthe procedures not linked to the SMS teleservice as such:\n-\tMAP-PURGE\n-\tMAP-RESET\nOther MAP procedures of the D interface between a VLR and the HSS shall not be supported by the IWF.\nNOTE 1:\tSome MAP general procedures that are not linked to the SMS service does not need to be handled over the MAP D interface, as they will be normally handled with equivalent procedures by the HSS over  the S6 interface, e.g. for MAP-PROVIDE-SUBSCRIBER-INFO, MAP-ACTIVATE/DEACTIVATE-TRACE-MODE or MAP-RESTORE-DATA.\nNOTE 2:\tIt is considered that proper configuration of HSS will avoid the HSS to attempt to use procedures not supported by the IWF.\nThe following S6a procedures defined in 3GPP TS 29.272 [5] shall be supported by the IWF.\n-\tUpdate Location\n-\tCancel Location\n-\tPurge UE\n-\tInsert Subscriber Data\n-\tDelete Subscriber Data\n-\tAuthentication Information Retrieval\n-\tReset\n-\tNotification\nThe Authentication Information Retrieval procedure can be simply relayed by the IWF as having no interaction with a MAP procedure on the D interface.\nA.4.4\tThe mapping of procedures\nA.4.4.1\tCommon aspects\nIn the S6a, ULR and NOR commands requests received from MME with the SMS in MME feature bit set , the IWF may remove it in the corresponding command transferred to the HSS.\nIn the S6a ULA, NOA commands that the IWF transfers to the MME, the IWF shall set the SMS in MME feature bit if it was set in the associated ULR or NOR request.\nIn the S6a commands IDR, DSR that the IWF transfers to the MME, the IWF shall set the SMS in MME feature bit if it was set in the previous ULR received from the MME.\nIn the S6a, IDA, DSA answers received from MME with the SMS in MME feature bit set, the IWF may remove it in the corresponding command transferred to the HSS.\nThe IWF shall support MAP version V3 and should support fallback to version V1 or V2.\nA.4.4.2\tUpdate Location\nThe mapping of the Update Location procedure is shown in figure A.4.4.2-1:\nFigure A.4.4.2-1: Mapping of the Update Location procedure\n1.\tThe IWF receives a ULR from the MME with the SMS in MME feature bit set and a request to be registered for MT-SMS.\n2.\tThe IWF stores the SMS related information (SMS Register Request, SMS only indication, MME number for MT-SMS), sends the ULR to the HSS where the IWF may clear the SMS in MME feature bit and remove the information related to SMS.\n3.\tThe HSS answers with a ULA.\n4.\tIf the ULA is successful and has the SMS in MME feature bit cleared and the received Network Access Mode (NAM) is PS + CS, the IWF sends a MAP updateLocation to the HSS with the MME Number for MT SMS. Otherwise the IWF skips to the step 8.\n5.\tThe HSS sends a MAP insertSubscriberData with the CS subscription data of the user.\n6. \tIf the IWF receives the SMS teleservice in insertSubscriberData and\nif the SMS Register Request is \"SMS in MME required\",\nor if the SMS Register Request is \"No preference\" and a \"SMS only indication\" was received in step 2,\nor if the SMS Register Request is \"No preference\" and no SMS only indication\" was received in step 2 and no other CS teleservices than the SMS teleservice have been received,\nthen the IWF sends an insertSubscriberDataAck in which the IWF returns the received CS teleservices other than the SMS teleservice, if any;\notherwise the IWF sends an insertSubscriberDataAck in which the IWF returns the received CS teleservices including the SMS teleservice.\nIf the IWF has not received the SMS teleservice in insertSubscriberData, the IWF sends an insertSubscriberDataAck where the IWF returns the received CS teleservices\n7\tThe HSS sends a MAP updateLocationAck.\n8.\tIf the ULA received in step 3 is successful and the received Network Access Mode (NAM) is PS, the IWF sends the received ULA with the SMS in MME feature bit set and the indication that MME is not registered for SMS.\nNOTE:\tThe use of SMS in MME is not possible in this IWF case when the user has no CS subscription for the SMS teleservice.\nIf the IWF receives the SMS teleservice in insertSubscriberData and\nif the SMS Register Request is \"SMS in MME required\",\nor if the SMS Register Request is \"No preference\" and a \"SMS only indication\" was received in step 2,\nor if the SMS Register Request is \"No preference\" and no SMS only indication\" was received in step 2 and no other  CS teleservices than the SMS teleservice have been received in step 5,\nthen the IWF sends the ULA received in step 3 in which the IWF sets the SMS in MME feature bit and indicates that the MME is registered for SMS and includes the SMS subscription data;\notherwise the IWF sends the ULA received in step 3 in which the IWF sets the SMS in MME feature bit and indicates that the MME is not registered for SMS and does not include any SMS subscription data.\nNOTE:\tthe MSC registration is not cancelled because it has been indicated that SMS teleservice is not supported. Further it is assumed that the MME will perform an SGs association which will initiate a Location Update via a VLR\nIf the IWF has not received the SMS teleservice in insertSubscriberData, the IWF sends the ULA received in step 3 in which the IWF indicates that the MME is not registered for SMS.\nIf the ULA received in step 4 is unsuccessful, the IWF sends the ULA received in step 3 unchanged.\nIf in step 7, the IWF receives an updateLocation answer with a MAP error, the IWF sends the ULA received in step 3 unchanged with the indication that MME is not registered for SMS.\nA.4.4.3\tCancel Location\nA.4.4.3.1\tCancel Location over S6a\nThe mapping of the Cancel Location over S6a procedure is shown in figure A.4.4.3.1-1:\nFigure A.4.4.3.1-1: Mapping of the Cancel Location over S6a procedure\n1.\tThe IWF receives a CLR from the HSS.\n2.\tThe IWF send the CLR unchanged to the MME.\n3.\tThe IWF, if it has been registered  by the HSS over the MAP D interface shall send a MAP purgeMS message to the HSS.\n4.\tthe IWF receives a purgeMSAck  from the HSS.\n5.\tthe IWF receives a CLA from the MME.\n6.\tthe IWF sends the CLA unchanged to the MME.\nThe steps 3/4 and the step 5 may occur in parallel.\nA.4.4.3.2\tCancel Location over MAP D\nThe mapping of the Cancel Location over MAP D procedure is shown in figure A.4.4.3.2-1:\nFigure A.4.4.3.2-1: Mapping of the Cancel Location over MAP D procedure\n1.\tThe IWF receives a CancelLocation from the HSS\n2.\tIf the MME is registered for SMS, the IWF sends an IDR to the MME with the indication to remove the MME registration for SMS; otherwise the IWF skips to the step 4.\n3.\tThe IWF receives an IDA.\n4.\tThe IWF sends a CancelLocation Ack to the HSS.\nA.4.4.4\tPurge\nThe mapping of the Purge procedure is shown in figure A.4.4.4-1:\nFigure A.4.4.4-1: Mapping of the Purge procedure\n1.\tThe IWF receives a PUR message from the MME.\n2a.\tThe IWF sends the PUR message unchanged to the HSS.\n3a.\tThe IWF receives PUA from the HSS.\n2b.\tThe IWF, if it has been registered by the HSS over the MAP D interface, sends a MAP  purgeMS message to the HSS.\n3b.\tThe IWF receives a MAP purgeMSAck message from the HSS.\n4.\tThe IWF sends PUA to the MME.\nThe steps 2a/3a and 2b/3b may occur in parallel.\nA.4.4.5\tInsert Subscriber Data\nA.4.4.5.1\tInsert Subscriber Data over S6a\nIf the IWF receives an IDR from the HSS, the IWF sends  the IDR unchanged to the MME apart the possible setting of the SMS in MME feature bit as described in subclause A.4.4.1.\nA.4.4.5.2\tInsert Subscriber Data over MAP D\nThe mapping of the Insert Subscriber Data over MAP D procedure is shown in figure A.4.4.5.2-1:\nFigure A.4.4.5.2-1: Mapping of the Insert Subscriber Data over MAP D procedure\n1.\tThe IWF receives a (stand alone) MAP InsertSubscriberData message from the HSS.\n2.\tIf the MAP InsertSubscriberData does not contain any data related to SMS, the IWF ignores the received data data and skips to the step 4\nIf  the MAP InsertSubscriberData contains data related to SMS, the IWF maps them into an IDR towards the MME and  ignores the other received data data.\n3.\tThe IWF receives IDA from the MME.\n4.\tThe IWF sends InsertSubscriberData Ack to the HSS.\n5.\tSteps 1 to 4 may be repeated several times for InsertSubscriberData. The repetition may be in burst mode or in acknowledge mode.\n6.\tThe HSS closes the MAP dialogue.\nA.4.4.6\tDelete Subscriber Data\nA.4.4.6.1\tDelete Subscriber Data over S6a\nIf the IWF receives a DSR from the HSS, the IWF sends  the DSR unchanged  to the MME apart the possible setting of the SMS in MME feature bit as  described in subclause A.4.4.1\nA.4.4.6.2\tDelete Subscriber Data over MAP D\nThe mapping of the Delete Subscriber Data over MAP D procedure is shown in figure A.4.4.6.2-1:\nFigure A.4.4.6.2-1: Mapping of the Delete Subscriber Data over MAP D procedure\n1.\tThe IWF receives a  MAP DeleteSubscriberData message from the HSS.\n2.\tIf the MAP DeleteSubscriberData does not contain any data related to SMS, the IWF ignores the received data data. The IWF skips to step 4.If  the MAP DeleteSubscriberData contains data related to SMS, the IWF maps them into a DSR towards the MME and  ignores the other received data data .\n3.\tThe IWF receives DSA from the MME.\n4.\tThe IWF sends DeleteSubscriberData Ack to the HSS.\n5\tIf the SMS subscription is withdrawn, the IWF sends an IDR to the MME with the indication to remove the MME registration for SMS. Otherwise the procedure is terminated.\n6.\tThe IWF receives an IDA from the MME.\n7.\tThe IWF sends a PurgeMS to the HSS.\n8. \tThe IWF receives a Purge MS Ack from the HSS.\nA.4.4.7\tReset\nThe mapping of the Reset procedure is shown in figure A.4.4.7-1:\nFigure A.4.4.7-1: Mapping of the Reset over S6a procedure\nWhen there is a reset from HSS, the reset shall normally occur on both the S6a interface and the MAP D interface. The procedure handling may also apply when only a RSR is received on the S6a interface and no Reset message over the MAPD interface.\nNOTE:\tIt is out of the scope to address the handling of a Reset message received over the MAP D interface without receiving a RSR over the S6a interface.\n1a.\tThe IWF receives a RSR from the HSS, the IWF stores this information\n1.b The IWF should receive a  MAP Reset from the HSS.\n2.\tThe IWF sends a RSR unchanged to the MME.\n3.\tThe IWF receives a RSA from the MME.\n4.\tThe IWF sends the RSA unchanged to the HSS.\nA.4.4.8\tNotification\nThe mapping of the Notification procedure is shown in figure A.4.4.8-1:\nFigure A.4.4.8-1: Mapping of the Notification Procedure\n1.\tThe IWF receives a NOR message from the MME.\n2a.\tIf the NOR message contains notifications other than the Ready for SM from MME notification, the IWF sends a NOR message with the Ready for SM flag cleared, the Alert Reason information element removed and unchanged for the other notifications to the HSS.\n3a.\tThe IWF receives a NOA if a NOR was sent in step 2a.\n2b.\tIf the Ready for SM from MME flag is set in the NOR received in step 1, the IWF sends a MAP ReadyForSM message to the HSS.\n3b.\tThe IWF receives a MAP ReadyForSM Ack message, if a MAP ReadyForSM message was sent in step 2b.\n4\tIf the NOR and/or the MAP ReadyForSM Ack messages received from the HSS are successful, the IWF sends a successful NOA to the MME.\nThe steps 2a/3a and 2b/3b may occur in parallel.\nIf one of the NOA or ReadyForSM answer from the HSS is successful and the other unsuccessful, the NOA sent to MME should be with an unsuccessful result mapped from the received error.\nA.4.5\tThe mapping of parameters\nA.4.5.1\tUnchanged AVPs\nMany commands between the MME and the IWF are not specific to SMS and are transferred over the S6a interface between the IWF and the HSS. Unless otherwise stated in the following A.4.5 subclauses, the AVPs received by the IWF in a Diameter command are transferred unchanged in the Diameter command sent by the IWF.\nA.4.5.2\tMapping of Parameters for the Update Location procedure\nA.4.5.2.1\tULR mapping to ULR\nWhen the IWF receives a ULR from the MME with the SMS in MME feature bit set, the IWF generates a ULR towards the HSS where:\n-\tthe feature bit \"SMS in MME\" shall not be set;\n-\tthe MME-Number-for-MT-SMS AVP, the  SMS-Only AVP and  the SMS-Register-Request AVP shall be removed.\nA.4.5.2.1\tULR mapping to UpdateLocationArg\nWhen the IWF needs to construct a MAP-UpdateLocation message as a result of receiving an ULR command (see sections A.Z.4.2 step 4), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of UpdateLocationArg as described below:\n-\timsi in UpdateLocationArg shall be populated with the value of the User-Name AVP received within ULR.\n-\tmsc-Number in UpdateLocationArg shall be populated with the value of the MME-Number-for-MT-SMS AVP within ULR,\n-\tvlr-Number in UpdateLocationArg shall be populated with a value locally assigned to the IWF and consistent with SS7 routing principles.\n-\tmme-DiameterAddress in UpdateLocationArg shall be present and be populated as follows\n-\tdiameter-Name shall be populated with the value received in the Origin-Host AVP within ULR;\n-\tdiameter-Realm shall be populated with the value received within the Origin-Realm AVP within ULR.\nOther parameters defined for UpdateLocationArg shall be absent.\nA.4.5.2.2\tInsertSubscriberDataArg mapping to ULA\nWhen the IWF needs to construct an ULA command as a result of receiving a successful ULA and a successful  UpdateLocation Ack, the IWF shall behave as described in subclause A.Z.4.2 step 8 and in particular:\n-\tTeleservice-List AVP shall only contain the TS-Code AVPs related to the short message teleservice with the values received in the corresponding Ext-TeleserviceCode parameters in the InsertSubscriberDataArg.\n-\tCall-Barring-Info AVPs shall be present if call barring SS-code and SS-status parameters were present within the Call Barring Information List parameter within the InsertSubscriberDataArg and the SS-Code AVP and SS-Status AVP within the Call-Barring-Info AVPs shall be populated with the values of the received call barring SS-code and SS-status parameters within the Call Barring Information List parameter within the InsertSubscriberDataArg.\n-\tOperator-Determined-Barring AVP shall be present if an odb-GeneralData parameter within  SubscriberData parameter within InsertSubscriberDataArg was present with values related to call barring which shall be mapped to the corresponding flags within Operator-Determined-Barring AVP.\nNOTE: ODB values in the ULA received  from HSS are transferred unchanged in the ULA sent to the MME.\nA.4.5.2.2\tMapping to InsertSubscriberDataRes\nWhen the IWF needs to construct a MAP-InsertSubscriberData Ack message as a result of receiving an InsertSubscriberDataArg message (see subclause  A.Z.4.2, step 6), the IWF shall populate sub-parameter of InsertSubscriberDataRes as follows:\n-\tss-List in InsertSubscriberDataRes shall include the ssCodes that have been received within InsertSubscriberDataArg and for which the corresponding flag of the Feature-List AVP is not set in the IDA.\n-\tteleserviceList in InsertSubscriberDataRes shall include all teleserviceCodes that have been received within InsertSubscriberDataArg except those related to the short message teleservice.\n-\tbearerServiceList in InsertSubscriberDataRes shall include all bearerServiceCodes that have been received within InsertSubscriberDataArg.\n-\todb-GeneralData in InsertSubscriberDataRes shall include all odb categoties that have been received  within InsertSubscriberDataArg and that are not supported by the MME as indicated within the Supported-Feature AVP within ULR.\nOther sub parameters in InsertSubscriberDataRes shall be absent.\n-\tFor InsertSubscriberData Error: Values other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.\nA.4.5.3\tMapping of Parameters for the Cancel Location procedure\nA.4.5.3.1\tCLR mapping to PurgeMSArg mapping to\nWhen the IWF needs to construct a MAP-PurgeMS message as a result of receiving CLR command (see subclause A4.4.3.1 step 3), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of PurgeMS-Arg as described below:\n-\timsi in PurgeMS-Arg shall be populated with the imsi value of the User-Name AVP received within CLR.\n-\tvlr-Number in PurgeMS-Arg shall be populated with the value given in the previous Update Location procedure.\n-\tsgsn-Number and extensionContainer in PurgeMS-Arg shall be absent.\nA.4.5.3.2\tCancelLocationArg mapping to IDR\nWhen the IWF needs to construct an IDR as a result of receiving a CancelLocation message (see subclause A.4.4.3.2 step 2), the IWF shall populate AVPs of DSR as described below:\nIDR-Flags AVP:\n-\tRemove SMS Registration flag shall be set to 1.\n-\tOther flags shall be set to 0.\nSubscription-Data AVP shall be included empty.\nA.4.5.3.3\tIDA mapping to CancelLocationRes/Error\nWhen the IWF needs to construct a MAP-CancelLocation Ack message as a result of receiving an IDA command (see subclause A.4.4.3.2 step 4), the IWF shall populate sub-parameters of CancelLocationRes/Error as described below:\nCancelLocationRes:\n-\textensionContainer in CancelLocationRes shall be absent.\nCancelLocation Error:\n-\tValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.\nA.4.5.4\tMapping of Parameters for the Purge Procedure\nA.4.5.4.1\tPUR mapping to PurgeMS-Arg\nWhen the IWF needs to construct a MAP-PurgeMS message as a result of receiving a PUR command (see subclause A.4.4.4 step 2b), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of PurgeMS-Arg as described below:\n-\timsi in PurgeMS-Arg shall be populated with the imsi value of the User-Name AVP received within PUR.\n-\tvlr-Number in PurgeMS-Arg shall be populated with the value given in the previous Update Location procedure.\n-\tsgsn-Number and extensionContainer in PurgeMS-Arg shall be absent.\nA.4.5.4.2\tPurgeMS-Res / Error mapping to PUA\nThe Result-Code / Experimental-Result AVP and the other AVPs of the PUA sent by the IWF to the MME, shall be the same as those received in the PUA from the HSS and are not dependent of the PurgeMS Ack message received over MAP D.\nA.4.5.5\tMapping of Parameters for the Insert Subscriber Data Procedure\nA.4.5.5.1\tInsertSubscriberDataArg mapping to IDR\nWhen the IWF needs to construct an IDR as a result of receiving a InsertSubscriberData message, the IWF shall behave as described in subclause A.Z.4.2 step 8.  In particular:\n-\tTeleservice-List AVP, shall be present if short message related Ext-TeleserviceCode parameters were received and shall contain the TS-Code AVPs related to the short message teleservice with the values received in the corresponding Ext-TeleserviceCode parameters.\n-\tCall-Barring-Info AVPs shall be present if call baring SS-code and SS-status parameters were present within the Call Barring Information List parameter within the InsertSubscriberDataArg and the SS-Code AVP and SS-Status AVP within the Call-Barring-Info AVPs shall be populated with the values of the received call barring SS-code and SS-status parameters within the Call Barring Information List parameter within the InsertSubscriberDataArg.\nA.4.5.5.2\tIDA mapping to InsertSubscriberDataRes/Error\nWhen the IWF needs to construct a MAP-InsertSubscriberData Ack message as a result of receiving an IDA command (see subclause  A.Z.4.5.2, step 4), the IWF shall populate sub-parameter of InsertSubscriberDataRes as follows:\nss-List in InsertSubscriberDataRes shall include the ssCodes that have been received within InsertSubscriberDataArg and for which the corresponding flag of the Feature-List AVP is not set in the IDA.\nOther sub parameters in InsertSubscriberDataRes shall be absent.\nFor InsertSubscriberData Error: Values other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.\nA.4.5.6\tMapping of Parameters for the Delete Subscriber Data Procedure\nA.4.5.6.1\tDeleteSubscriberDataArg mapping to DSR\nWhen the IWF needs to construct a DSR command as a result of receiving a MAP-DeleteSubscriberData message (see subclause A.4.4.6.2 step 2), the the IWF shall populate AVPs of DSR as described below:\n-\tUser-Name AVP shall be populated with the value received within the imsi parameter of DeleteSubscriberDataArg.\n-\tSupported-Features AVP shall be absent.\n-\tDSR-Flags AVP: Flags shall be set as follows:\n-\tSMS Withdrawal shall be set to 1 if the SS-Code list parameter was present within DeleteSubscriberDataArg and the service codes are related to short message services; otherwise shall be set to 0.\n-\tother flags shall be set to 0.\nA.4.5.6.2\tDSA mapping to DeleteSubscriberDataRes/Error\nWhen the IWF needs to construct a MAP-DeleteSubscriberData Ack message as a result of receiving a DSA command (see subclause A.4.4.6.2 step 4), the IWF shall populate sub-parameters of DeleteSubscriberDataRes/Error as described below:\nDeleteSubscriberDataRes:\n-\tNo sub-parameter shall be present in DeleteSubscriberDataRes.\nDeleteSubscriberData Error:\nValues other than SUCCESS within the Result-Code / Experimental-Result AVP shall be mapped onto an appropriate MAP error.\nA.4.5.7\tMapping of Parameters for the Reset Procedure\nA.4.5.7.1\tReset mapping to RSR\nWhen the IWF needs to construct a RSR command as a result of receiving a RSR and a MAP Reset message (see subclause A.4.4.7 step 2), the IWF shall send the RSR received from HSS unchanged and ignore the sub-parameters of the MAP Reset message.\nA.4.5.8\tMapping of Parameters for the Notification Procedure\nA.4.5.8.1\tNOR mapping to ReadyForSM-Arg\nWhen the IWF needs to construct a MAP-ReadyForSM message as a result of receiving a NOR command (see subclause A.Z.4.8 step 2b), the IWF shall open a MAP dialogue in application context version 3 and populate sub-parameters of ReadyForSMArg as described below:\n-\timsi in ReadyForSMArg shall be populated with the value of the User-Name AVP received within NOR.\n-\talertReason in ReadyForSMArg shall be populated with the value of the Alert-Reason AVP received within NOR.\n-\talertReasonIndicator in ReadyForSMArg shall be absent.\n-\tadditionalAlertReasonIndicator in ReadyForSMArg shall be absent.\n-\textensionContainer in ReadyForSMArg shall be absent.\n-\tmaximumUeAvailabilityTime in ReadyForSMArg shall be present and populated with the value received within the Maximum-UE-Availability-Time AVP, when present, within NOR .\nAnnex B (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2008-12\nCT#42\nCP-080711\nVersion 1.0.0 approved in CT#42\n8.0.0\n2009-03\nCT#43\nCP-090056\n0001\nSupported RAT Type\n8.1.0\nCP-090056\n0002\nTrace\nCP-090056\n0004\nContext Identifier for Update or Removal of PDN GW\nCP-090044\n0005\n2\nReady For SM\nCP-090044\n0006\nHandling LCS Subscription Data\nCP-090056\n0007\n1\nRequesting-Node-Type mapping\nCP-090056\n0008\nParameter mapping correction\nCP-090044\n0010\n2\nHandling SMS Subscription Data\n2009-06\nCT#44\nCP-090308\n0011\nParameter Mapping\n8.2.0\nCP-090380\n0013\n3\nUser Data Download\n2009-09\nCT#45\nCP-090545\n0014\nNotification of SMS over IP Non-Delivery for E-UTRAN and UE Reachability\n8.3.0\nCP-090545\n0015\nRemoval of User Data Handling Principles\nCP-090545\n0016\n2\nCancel Location for Initial Attach\n2009-12\n-\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2011-03\nCT#51\nCP-110082\n0018\n1\nUE SRVCC Capability Support for IWF\n10.0.0\n2011-06\nCT#52\nCP-110380\n0020\n1\nParameter Mapping for MDT\n10.1.0\n2011-09\nCT#53\nCP-110584\n0021\n2\nAdd vSRVCC updates to the IWF function\n11.0.0\n2012-03\nCT#55\nCP-120024\n0026\n1\nMapping of Parameters for Insert Subscriber Data\n11.1.0\nCP-120025\n0022\n1\nMapping of Parameters for Cancel Location\n2012-06\nCT#56\nCP-120240\n0023\n3\nMapping of CSG ID and Local Time for NPLI\n11.2.0\n2012-09\nCT#57\nCP-120473\n0029\n4\nSMS in MME/SGSN\n11.3.0\nCP-120473\n0032\n1\nSMS in MME IWF General\nCP-120480\n0034\n1\nLocal Time Zone\n2012-12\nCT#58\nCP-120714\n0038\n4\nClarification on EPS Info\n11.4.0\nCP-120732\n0033\n5\nSMS in MME S6c IWF\nCP-120732\n0035\n3\nSMS in MME IWF error cases for SGd\nCP-120732\n0036\n5\nSMS in MME S6a/S6a+D IWF\nCP-120732\n0037\n-\nSMS in MME SGd  IWF\n2013-06\nCT#60\nCP-130278\n0045\n1\nParameter Mapping of SS Status for Call Barring\n11.5.0\n2013-09\nCT#61\nCP-130450\n0048\n-\nMME Diameter address mapping\n11.6.0\n2013-09\nCT#61\nCP-130463\n0046\n2\nCancelLocation requesting reattach\n12.0.0\nCP-130456\n0047\n1\nIWF description for Gdd support\n2013-12\nCT#62\nCP-130614\n0050\n4\nParameter Mapping for S6aS6d-Indicator in NOR\n12.1.0\nCP-130617\n0055\n-\nParameter Mapping for MME Initiated Removal of MME Registration for SMS\nCP-130623\n0051\n1\nS6c support for HSS and SMS Router\nCP-130623\n0056\n1\nFigures about IWF description for Gdd support\nCP-130800\n0052\n2\nIWFs with SMS for IMS UE without MSISDN\nCP-130643\n0053\n1\nForwarding of Diameter based SRI for SMS\n2014-09\nCT#65\nCP-140506\n0058\n1\nP-CSCF Restoration Indication\n12.2.0\n2015-06\nCT#68\nCP-150263\n0060\n1\nAccess Restriction Data per PLMN\n13.0.0\n2015-12\nCT#70\nCP-150784\n0061\n1\nIntroducing IMSI-Group ID List\n13.1.0\n2016-03\nCT#71\nCP-160030\n0062\n-\nAlert procedure from MME/SGSN to SMS-GMSC for MT SMS to UE using eDRX\n13.2.0\n2017-03\nCT#75\n-\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2017-12\nCT#78\nCP-173036\n0063\n-\nMapping of ext-AccessRestrictionData in IWF\n15.0.0\n2018-03\nCT#79\nCP-180012\n0068\n-\nCorrection of DIAMETER_ERROR_SYSTEM_FAILURE\n15.1.0\n2020-07\nCT#88e\n-\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\nDate\nTSG #\nTSG Doc.\nCR\nRev\nSubject/Comment\nNew\n2008-12\nCT#42\nCP-080711\nVersion 1.0.0 approved in CT#42\n8.0.0\n2009-03\nCT#43\nCP-090056\n0001\nSupported RAT Type\n8.1.0\nCP-090056\n0002\nTrace\nCP-090056\n0004\nContext Identifier for Update or Removal of PDN GW\nCP-090044\n0005\n2\nReady For SM\nCP-090044\n0006\nHandling LCS Subscription Data\nCP-090056\n0007\n1\nRequesting-Node-Type mapping\nCP-090056\n0008\nParameter mapping correction\nCP-090044\n0010\n2\nHandling SMS Subscription Data\n2009-06\nCT#44\nCP-090308\n0011\nParameter Mapping\n8.2.0\nCP-090380\n0013\n3\nUser Data Download\n2009-09\nCT#45\nCP-090545\n0014\nNotification of SMS over IP Non-Delivery for E-UTRAN and UE Reachability\n8.3.0\nCP-090545\n0015\nRemoval of User Data Handling Principles\nCP-090545\n0016\n2\nCancel Location for Initial Attach\n2009-12\n-\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2011-03\nCT#51\nCP-110082\n0018\n1\nUE SRVCC Capability Support for IWF\n10.0.0\n2011-06\nCT#52\nCP-110380\n0020\n1\nParameter Mapping for MDT\n10.1.0\n2011-09\nCT#53\nCP-110584\n0021\n2\nAdd vSRVCC updates to the IWF function\n11.0.0\n2012-03\nCT#55\nCP-120024\n0026\n1\nMapping of Parameters for Insert Subscriber Data\n11.1.0\nCP-120025\n0022\n1\nMapping of Parameters for Cancel Location\n2012-06\nCT#56\nCP-120240\n0023\n3\nMapping of CSG ID and Local Time for NPLI\n11.2.0\n2012-09\nCT#57\nCP-120473\n0029\n4\nSMS in MME/SGSN\n11.3.0\nCP-120473\n0032\n1\nSMS in MME IWF General\nCP-120480\n0034\n1\nLocal Time Zone\n2012-12\nCT#58\nCP-120714\n0038\n4\nClarification on EPS Info\n11.4.0\nCP-120732\n0033\n5\nSMS in MME S6c IWF\nCP-120732\n0035\n3\nSMS in MME IWF error cases for SGd\nCP-120732\n0036\n5\nSMS in MME S6a/S6a+D IWF\nCP-120732\n0037\n-\nSMS in MME SGd  IWF\n2013-06\nCT#60\nCP-130278\n0045\n1\nParameter Mapping of SS Status for Call Barring\n11.5.0\n2013-09\nCT#61\nCP-130450\n0048\n-\nMME Diameter address mapping\n11.6.0\n2013-09\nCT#61\nCP-130463\n0046\n2\nCancelLocation requesting reattach\n12.0.0\nCP-130456\n0047\n1\nIWF description for Gdd support\n2013-12\nCT#62\nCP-130614\n0050\n4\nParameter Mapping for S6aS6d-Indicator in NOR\n12.1.0\nCP-130617\n0055\n-\nParameter Mapping for MME Initiated Removal of MME Registration for SMS\nCP-130623\n0051\n1\nS6c support for HSS and SMS Router\nCP-130623\n0056\n1\nFigures about IWF description for Gdd support\nCP-130800\n0052\n2\nIWFs with SMS for IMS UE without MSISDN\nCP-130643\n0053\n1\nForwarding of Diameter based SRI for SMS\n2014-09\nCT#65\nCP-140506\n0058\n1\nP-CSCF Restoration Indication\n12.2.0\n2015-06\nCT#68\nCP-150263\n0060\n1\nAccess Restriction Data per PLMN\n13.0.0\n2015-12\nCT#70\nCP-150784\n0061\n1\nIntroducing IMSI-Group ID List\n13.1.0\n2016-03\nCT#71\nCP-160030\n0062\n-\nAlert procedure from MME/SGSN to SMS-GMSC for MT SMS to UE using eDRX\n13.2.0\n2017-03\nCT#75\n-\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2017-12\nCT#78\nCP-173036\n0063\n-\nMapping of ext-AccessRestrictionData in IWF\n15.0.0\n2018-03\nCT#79\nCP-180012\n0068\n-\nCorrection of DIAMETER_ERROR_SYSTEM_FAILURE\n15.1.0\n2020-07\nCT#88e\n-\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2022-04\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_3",
        "ts_23.204",
        "ts_23.003",
        "ts_23.272",
        "ts_29.272"
      ]
    }
  ]
}