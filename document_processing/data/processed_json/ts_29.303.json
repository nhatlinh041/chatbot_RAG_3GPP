{
  "metadata": {
    "specification_id": "ts_29.303",
    "version": "18.0.0",
    "title": "3GPP TS 29.303",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29303-i00/29303-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:07:15.699809",
    "total_chunks": 69
  },
  "chunks": [
    {
      "chunk_id": "ts_29.303_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document describes Domain Name System (DNS) Procedures for the Evolved Packet System. This document covers the Evolved Packet Core gateway node selection using DNS (e.g. SGW and PGW nodes) excluding all User Equipment (UE) initiated DNS-based discovery and selection procedures.\nThe present document specifies functions, procedures and information which apply to GERAN Iu mode. However, functionality related to GERAN Iu mode is neither maintained nor enhanced.\nThe present document also describes the Domain Name System (DNS) Procedures for the Evolved Packet System interworking with the 5G System, as specified in 3GPP TS 23.501 [28] and 3GPP TS 23.502 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_29.303_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\tIETF RFC 1034:\"DOMAIN NAMES - CONCEPTS AND FACILITIES\".\n[3]\tIETF RFC 1035:\"DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION\".\n[4]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[5]\tGSMA PRD IR.67: \"DNS Guidelines for Operators\" Version 2.1.0.\n[6]\tIETF RFC 3596: \"DNS Extensions to Support IP Version 6\".\n[7]\tIETF RFC 3403: \" Dynamic Delegation Discovery System (DDDS) Part Three: The Domain Name System (DNS) Database\".\n[8]\tIETF RFC 2782: \"A DNS RR for specifying the location of services (DNS SRV)\".\n[9]\tIETF RFC 3958: \"Domain-Based Application Service Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS)\".\n[10]\tIETF RFC 3401: \"Dynamic Delegation Discovery System (DDDS) Part One: The Comprehensive DDDS\".\n[11]\t3GPP TS 23.401: \"GPRS enhancements for E-UTRAN access \".\n[12]\t3GPP TS 25.413: \"UTRAN Iu interface RANAP signalling\".\n[13]\tIETF RFC 2671: \"Extension Mechanisms for DNS (EDNS0)\".\n[14]\tIETF RFC 3402: \"Dynamic Delegation Discovery System (DDDS) Part Two: The Algorithm\".\n[15]\tIETF RFC 2308: \"Negative Caching of DNS Queries (DNS NCACHE)\".\n[16]\tIETF RFC 3330: \"Special Use IPv4 Addresses\".\n[17]\tIETF RFC 3849: \"IPv6 Address Prefix Reserved for Documentation\".\n[18]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service Description; Stage 2\".\n[19]\t3GPP TS 36.413: \"Evolved Universal Terrestrial Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[20]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC)\".\n[21]\t3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network (E-UTRAN); S1 Application Protocol (S1AP)\".\n[22]\t3GPP TS 36.300: \" Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[23]\t3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[24]\t3GPP2 X.S0057‑B: \"E‑UTRAN - eHRPD Connectivity and Interworking: Core Network Aspects\".\n[25]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[26]\t3GPP TS 29.244: \"Interface between the Control Plane and the User Plane of EPC Nodes; stage 3\".\n[27]\t3GPP TS 29.272: \"Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol\".\n[28]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[29]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[30]\t3GPP TS 29.273: \"Evolved Packet System (EPS); 3GPP EPS AAA interfaces\".\n[31]\t3GPP TS 23.007: \"Restoration procedures\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_23.003",
        "ts_23.401",
        "ts_25.413",
        "ts_23.060",
        "ts_36.413",
        "ts_23.216",
        "ts_36.300",
        "ts_29.274",
        "ts_23.402",
        "ts_29.244",
        "ts_29.272",
        "ts_23.501",
        "ts_23.502",
        "ts_29.273",
        "ts_23.007"
      ]
    },
    {
      "chunk_id": "ts_29.303_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nDomain Name System as defined in IETF RFC 1034 [2], IETF RFC 1035[3], and as used in 3GPP in 3GPP TS 23.003 [4] and GSMA PRD IR.67 [5]\nThe phrase \"operators shall provision\" in this document is intended to convey what is required to provision in DNS to provide DNS based selection for the corresponding function documented here. If there is a non-DNS procedure in an operator's network for that function then there is no functional requirement for the operator to provision such DNS records.\nThe term \"S4-SGSN\" refers to a Release-8 SGSN that has at least one set of S4/S3/S16 interfaces enabled.\nThe term \"Release 8 SGSN supporting only Gn/Gp\" refers to a Release 8 or later SGSN that either explicitly does not support S4 interfaces or all S4/S3/S16 interfaces are disabled due to operator policy. Such a node cannot use an SGW but can use a collocated PGW/GGSN. See 3GPP TS 23.401 [11] Annex D for use cases.\nThe term \"Release-8 SGSN\" applies to either case.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905[1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\nDCN\tDedicated Core Network\nDDDS\tDynamic Delegation Discovery Service\nDNS\tDomain Name System\nECGI\tE-UTRAN Cell Global Identification\neHRPD\tevolved High Rate Packet Data\nFQDN\tFully Qualified Domain Name\nGUTI\tGlobally Unique Temporary Identity\nHSGW\teHRPD Serving Gateway\nLGW\tLocal Gateway\nLIPA\tLocal IP Access\nNR\tNew Radio\nPGW\tPDN Gateway\nRAI\tRouting Area Identity\nSGW\tServing Gateway\nSIPTO\tSelected IP Traffic Offload\nTAI\tTracking Area Identity\nTAU\tTracking Area Update\nTWAN\tTrusted WLAN Access Network",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.1.1",
      "section_id": "4.1.1",
      "section_title": "A and AAAA",
      "content": "The A resource record is used to define IPv4 host address corresponding to fully qualified name of the host as defined in IETF RFC 1035 [3]. The AAAA resource record is used to define IPv6 host address corresponding to fully qualified name of the host as defined in IETF RFC 3596 [6].\nIt should be noted that in DNS A or AAAA record names, in general, represent a host and its \"equivalent\" interface. Host names, in general, cannot be used as node names. A node may need to have more than one host name for the simple reason that it can have multiple interfaces for different purposes.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.1.2",
      "section_id": "4.1.2",
      "section_title": "NAPTR",
      "content": "The NAPTR resource record is defined in IETF RFC 3403 [7] and is a powerful tool that allows DNS to be used to lookup services for a wide variety of resource names, which are not in domain name syntax. NAPTR would be used by a client program to rewrite a string into a domain name. The rewrite process is controlled by flags that provide information on how to communicate with the host at the domain name that was the result of the rewrite. If DNS returns multiple NAPTR resource records those can be prioritized using embedded order and preference values defined by the DNS administrator.\nThe S-NAPTR procedure i.e., the \"Straightforward-NAPTR\" procedure, is defined in IETF RFC 3958 [9] and describes a Dynamic Delegation Discovery System (DDDS) [10] application procedures on how to resolve a domain name, application service name, and application protocol dynamically to target server and port by using both NAPTR and SRV (see IETF RFC 2782 [8]) resource records. The S-NAPTR also simplifies the use of NAPTR by limiting the NAPTR flags only to \"a\", \"s\" and \"\". Furthermore, only NAPTR \"replacement\" expressions are allowed, not \"regular expressions\", during the rewrite process. The changes compared to IETF RFC 3403 [7] NAPTR usage are procedural and are limited only to the resolver. The S-NAPTR use of the NAPTR resource record is exactly the same as defined in IETF RFC 3403 [7] from the DNS server and DNS infrastructure point of view. Additional information on S-NAPTR usage is provided in Annex B and Annex C.\nThe NAPTR resource record flags \"s\" and \"\" allow another layer of indirection in the DNS configuration. The \"\" flag causes the S-NAPTR procedure to query for new NAPTR resource records from the DNS infrastructure. The \"s\" flag causes the S-NAPTR procedure to query for an intermediary SRV resource record pointing to A/AAAA resource records. This additional query provides a selection mechanism by which the operator is able to assign different weights to different A/AAAA resource records while larger weights are given a proportionately higher probability of being selected. A DNS server might provide the A/AAAA records together with the SRV resource records as per IETF RFC 2782 [7]. The length of the NAPTR resource record indirection chain enabled using the \"\" flag is unbounded and may lead to a deep chaining of resource records over time in the DNS configuration. Additional layer of indirection and possible deep chaining both grows the DNS configuration significantly in size and complexity, and also makes the configuration prone to hard to trace errors. The use of NAPTR resource record \"\" flag pointing to other NAPTR resource records with flag \"\" is strongly discouraged. Specifically, NAPTR resource flag \"\" should only be provisioned to point to terminal NAPTR records (i.e., flag \"a\" or flag \"s\"). Generally, the use of flag \"a\" or of flag \"s\" is encouraged.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.1.3",
      "section_id": "4.1.3",
      "section_title": "SRV",
      "content": "The SRV resource record is defined in IETF RFC 2782 [8] and allows DNS administrators to use pool of servers for a single domain with static load balancing to each server, to move services from host to host, and to designate some hosts as primary servers for a service from a pool of hosts. A resolver can ask for a specific service/protocol combination for a specific domain name and get back a Fully Qualified Domain Names (FQDN) of any available servers.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.2",
      "section_id": "4.2",
      "section_title": "Selecting Domain Names",
      "content": "When using the S-NAPTR procedure under the DDDS framework, it becomes essential which domain name gets used for querying the actual NAPTR records. In the S-NAPTR procedure, the Application-Unique String used by the DDDS algorithm is the starting domain name for which the information of the services, protocols and actual canonical node names are sought. Related to the Application-Unique String, the First well-Known Rule of the DDDS algorithm in the S-NAPTR procedure outputs the same domain name that constitutes the Application-Unique String. For each node type in EPC that can be queried for information using the S-NAPTR procedure, the authoritative DNS server for the given domain should be provisioned with unique domain name for each EPC node or other identifier that is explicitly specified by a procedure in this specification (for example one based on APN, TAI,GUTI, etc) and corresponding NAPTR records. The authoritative DNS server for a given domain shall provision at least the EPC node names that may be exposed to the inter-operator roaming interfaces.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.3.1",
      "section_id": "4.3.1",
      "section_title": "IETF RFC 3958 Service and Protocol service names for 3GPP",
      "content": "Service and protocol service names for the S-NAPTR procedure shall be used in accordance with 3GPP TS 23.003 [4], clause 19.4.3.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.2",
      "section_id": "4.3.2",
      "section_title": "Identification of canonical node names",
      "content": "There are many use cases where it is desirable to select a collocated node in preference to a non-collocated node, or a topologically closer (with respect to the network topology) node in preference to a less topologically closer node. To easily do this action a \"canonical\" node name shall be employed so that the \"canonical\" node names from two or more sets of records can be compared to see if nodes are actually the same nodes, or topologically closer nodes.\nIn DNS neither A or AAAA host names, in general, represent a node name, but rather a set of \"equivalent\" interfaces. A node may need to have more than one host name for the simple reason that it can have different interfaces for different purposes. For example, a node can have a set of roaming interfaces on a completely different network than the internal network due to security needs. Hence, there are always situations where multiple A/AAAA record sets must exist that implies multiple distinct host names. Therefore, host names, in general, cannot be used as node names.\nInstead of creating new DNS records to map a host name to a node name this specification defines how host names shall be constructed and used in S-NAPTR procedure within 3GPP EPC.\nThe host names shall have form:\n<\"topon\" | \"topoff\"> . <single-label-interface-name> . <canonical-node-name>\nWhere the first label is \"topon\" or \"topoff\" to indicate whether or not collocated and topologically close node selection shall be preferred, \"single-label-interface-name\" is a single label used to name a specific interface on a node (e.g. Eth-0, S8, vip, board3), \"canonical-node-name\" is a the canonical node name of a specific node. A node shall have exactly one canonical node name so a host name always includes the unique canonical node name of the node.Hence, when comparing the host name FQDNs to find out whether the nodes are actually the same, the first two labels of the host name FQDN shall be ignored.\nNOTE 1:\tThe canonical node name is not related to canonical name in the CNAME DNS record.\nWhen using host names with \"topon\" as the first label the canonical node names of nodes shall be hierarchically structured to allow an operator to reflect the topological closeness of two nodes by naming the nodes with canonical node names sharing a common suffix domain name. The number of labels in the common suffix shall represent how close the operator considers them during node selection. The higher the number of labels in the common suffix is, the closer the nodes are. In other words, two topologically closest nodes are those with the longest matching suffix in their respective canonical node names.\nThe following list contains examples of domain names where canonical node names are in bold:\ntopon.Eth-0.gw32.california.west. example.com\ntopon.S8.gw32.california.west. example.com\ntopon.vip.sgw3.oregon.west. example.com m\ntopon.board3.pgw1.cluster1.net27. example.net\ntopon.S5.gw4.cluster1.net27. example.net\ntopon.board3.pgw1.cluster2.net27. example.net\nIn the examples above, \"Eth-0.gw32.california.west.example.com \" and \"S8.gw32.california.west. example.com \" are two different interfaces on the same node, \"gw32.california.west. example.com \". On the other hand, \"gw4.cluster1.net27.example.net\" is topologically closer to \"pgw1.cluster1.net27. example.net\" (they are both connected to the \"cluster1.net27. example.net\" subnetwork) than to \"pgw1.cluster2.net27. example.net\" (only connected to the wider \"net.27. example.net\" subnetwork.)\nInterface names and node names do NOT identify a function in the procedures here. The interface is part of the natural hierarchy within a node and the host name is already returned with the existing DNS records. The approach of identifying a canonical node name from a host name is believed to be simpler and more logical to maintain than creating additional DNS records simply to return a node name.\nThe topologically aware naming restriction (i.e. the format above using \"topon\" or \"topoff\") shall be placed only on all targets/replacements pointing logically to a A/AAAA record sets from the S-NAPTR procedure. These targets/replacements are denoted host names here (following the normal DNS terminology unless a CNAME is used to point to the actual A or AAAA record). This restriction shall NOT apply to any other DNS records the operator may be using.\nSpecifically, a NAPTR with flag \"a\" will have a replacement target pointing to the A/AAAA record directly, thus the topologically aware naming restriction on the host name applies to the replacement in the NAPTR record with a flag \"a\". For the NAPTR flag \"s\" case the topologically aware naming restriction on the host name applies to the target in the SRV record, and not the NAPTR record replacement. For the NAPTR empty flag \"\" case the topologically aware naming does not apply any restriction since this is not a host name. Other flags are not used in S-NAPTR.\nDuring DNS provisioning for the S-NAPTR procedure the operator is free to add another layer of indirection using a CNAME record (see clause 6.6.2 of IETF RFC 1034 [2]).\nWhile operators shall provision host names in DNS according to the above rules, it is still possible that the host name might be incorrectly configured (i.e. not conforming to the above format with first label of \"topon\" or \"topoff\"). For such misconfigured records implementations shall treat the misconfigured host name as valid within the S-NAPTR procedure where that host name was found, but may favor correctly configured records. Misconfigured host name for topological matching and colocation checks shall be treated as if the misconfigured host name had the label \"topoff.\" prepended. Operators shall not depend on this behavior.\nThe order of using DNS records to contact a node is based on following ordering. When collocation of a pair of node types is explicitly stated as applicable in a procedure, collocation of the nodes shall have high est importance . When topological matching is explicitly stated as applicable in a procedure then topological matching with \"topon\", is of second highest importance. Then finally the ordering obtained by the S-NAPTR output . When collocation and topological ordering applies, collocated sets of nodes have highest importance, then sets of nodes with \"topon\" and the most labels in their common suffix, then sets of nodes with \"topon\" and second most number of labels and so on until we reach non-colocated nodes with \"topoff\" and within sets with same colocation or topological order then S-NAPTR order of one of the two nodes is used (specified in the specific procedure). Additional informative clarifications on how S-NAPTR is employed in the context of 3GPP EPC node usage and specifically how topological matching using the \"topon\" label interacts with S-NAPTR ordering is provided in Annex C.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.6.2"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.1",
      "section_id": "4.3.3.1",
      "section_title": "General",
      "content": "There are potential use cases where a node has a logical name of a peer or other FQDN identifier for a service but does not have the protocols it supports. The NAPTR record for any of the services can be provisioned at the nodes logical name or other FQDN identifier for a service. The node logical name or other FQDN identifier for a service is equal to the domain name under which NAPTR records are provisioned. This allows any core network node to discover the available services based on node's logical name or other FQDN identifier for a service.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.3.3.2.1",
      "section_id": "4.3.3.2.1",
      "section_title": "S-NAPTR Procedure - General",
      "content": "These procedures are employed when any core network node has the FQDN of an entity and needs to find one or more services at that entity.\nNOTE:\tThere are three likely sources of the entity name. O&M provisioned, 3GPP specified based on some other identifier of a service (such as GUTI, TAC, IMSI, MISDN etc.), or the canonical node name obtained from a previous S‑NAPTR procedure. Note that a node can have more than one name, i.e. an alias, but there shall be only one canonical node name for a node. (CNAME records are a way to create aliases for the canonical node name or any other FQDN as per IETF RFC 1034 [2])\nThe S-NAPTR procedure requires that DNS NAPTR records shall be consistently provisioned as described in IETF RFC 3958 [9]. This means a NAPTR record for each protocol using \"a\" flag and the service field populated with the service and proto value may be provisioned. If a more sophisticated load balancing or non-standard ports are desired, NAPTR with \"s\" flag for each protocol and the corresponding SRV records with relative weighting for each interface need to be provisioned. NAPTR records with empty \"\" flag records may also be used.\nA DNS resolver that intends to use the S-NAPTR procedure shall use the FQDN of the node or a specified FQDN identifier of a service as the Application-Unique String. If all protocols are desired, then the resolver simply runs the S-NAPTR procedure as if all protocols match.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This list can be obtained one host name at a time, in a procedure similar to Annex C.2, or a complete ordered list of all nodes, in a procedure similar to Annex C.3. Such a complete list obtained from an S-NAPTR procedure is referred here as a candidate list.\nNOTE:\tThe candidate list is valid for at most for finite period of time due to DNS time to live and order of the records can change due to statistical selection. Operators should provision records with reasonable time to live values.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_4.3.3.2.2",
      "section_id": "4.3.3.2.2",
      "section_title": "S-NAPTR Procedure for a canonical node name",
      "content": "One very important special case is S-NAPTR based on a node's canonical node name.\nOperators shall provision NAPTR records for all enabled interfaces of a node that are explicitly listed in clause 19.4.3 of 3GPP TS 23.003 [4] at the FQDN of the node's unique canonical node name.\nNOTE 1:\tException to this rule: The NAPTR records for x-3gpp-mme: x- s1-mme and x-3gpp-sgw:x-s1-u from clause 19.4.3 of 3GPP TS 23.003 [4] are to be considered entirely optional in this release of 3GPP.\nWith such provisioning by an operator a DNS resolver can at any time use the S-NAPTR procedure with a valid canonical node name to find all interfaces and protocols supported by that node that are listed in clause 19.4.3 of 3GPP TS 23.003 [4]. This includes interfaces of co-located functions that might not be easily discovered by other means.\nNOTE 2:\tThe remaining clauses within clause 4.3.3 cover cases where the FQDN used for the Application-Unique String is known to correspond to the resource of exactly one node and are relatively simple. These include the cases where an explicit identifier is defined by 3GPP for S-NAPTR lookup and examples of S-NAPTR based on canonical node names (the later is not intended to be an exhaustive list of examples). More complicated cases that cover identifiers for multiple nodes are covered in other clauses.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "clause_4.3.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.3",
      "section_id": "4.3.3.3",
      "section_title": "Services of a PGW from PGW node name (or collocated PGW/GGSN)",
      "content": "A UE with both a 3GPP access capability and non-3GPP access capability can roam in and out of the 3GPP network while maintaining the same PDN connection.\nTo support roaming to or from a non-3GPP network the HSS (or AAA) server can have an FQDN of a particular PGW or collocated PGW/GGSN node. One reason for using an FQDN instead of an IP address is that a PGW can be multihomed (i.e. more than one IP address). Another possible use case is when the PGW interface needs to be changed between PMIP and GTP. Even if each interface type only uses one IP address, the different interfaces can still use different IP addresses. For example, roaming and non-roaming interfaces are likely to be separated from each other using firewall or other mechanisms. Another possible use case is when the Home Agent (HA) functionality of a particular PGW needs to be discovered, e.g., during the HA reallocation procedure.\nIf the PGW node name employed by the operator is the PGW canonical node name then see clause 4.3.3.2 for provisioning.\nIf the PGW node name employed by the operator is not the PGW canonical node name then the operators shall provision at least the NAPTR records for S5 and S8 interfaces of a PGW node (see clause 19.4.3 of 3GPP TS 23.003 [4]) at that PGW node name. If the GGSN function is co-located then the NAPTR records for the Gn/Gp interfaces of the collocated PGW/GGSN shall be included as well. Only interfaces that exist and are allowed by the operator policy need be included.\nNOTE 1:\tThe PGW node name in HSS/AAA may or may not be the PGW's canonical node name if the PGW's FQDN was placed in the HSS/AAA from a non-3GPP source.\nTo resolve the allowed PMIPv6 interfaces the S-NAPTR procedure shall be used with the \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-pmip\" , \"x-3gpp-pgw:x-s8-pmip\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the PGW or collocated PGW/GGSN node.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This list can be obtained one host name at a time, in a procedure similar to Annex C.2, or a complete ordered list of all nodes, in a procedure similar to Annex C.3. Such a complete list obtained from an S-NAPTR procedure is referred here as a candidate list.\nFor a more explicit example, an operator might provision a PGW name at:\ngw1.pgw.node.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\nSimilarly for the GTPv2 interfaces the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\" , \"x-3gpp-pgw:x-s8-gtp\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW or collocated PGW/GGSN node.\nSimilarly for the GTPv1 Gn/Gp interfaces the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-gn\" , \"x-3gpp-pgw:x-gp\"  \"x-3gpp-ggsn:x-gn\", \"x-3gpp-ggsn:x-gp\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW , collocated PGW/GGSN node. The \"Service Parameters\" of \"x-3gpp-pgw:x-gn\", \"x-3gpp-pgw:x-gp\" represent collocated PGW/GGSN nodes and \"x-3gpp-ggsn:x-gn\", \"x-3gpp-ggsn:x-gp\" represent a GGSN that does not have a PGW co-located.\nSimilarly for the Home Agent functionality of a PGW the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2c-dsmip\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW.\nSimilarly for the S2a interface the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2a-pmip\", \"x-3gpp-pgw:x-s2a-gtp\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW.\nSimilarly for the S2b interface the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2b-pmip\", \"x-3gpp-pgw:x-s2b-gtp\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW.\nAdditional requirements to support DCN are specified in clause 5.8.It is also possible for the DNS resolver to leave \"Service Parameters\" unspecified in the S-NAPTR procedure in order to identify all interfaces for all supported services and protocols.\nNOTE 2:\tThe services based on S-NAPTR at the canonical node name of the PGW might return services other than ones starting with x-3gpp-pgw or x-3gpp-ggsn since the PGW node can have a co-located SGW function or other functions.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.3.2",
        "ts_23.003_clause_19.4.3",
        "clause_5.8",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.4",
      "section_id": "4.3.3.4",
      "section_title": "Services of a MME from MME node name (or GUTI or 5G-GUTI)",
      "content": "There are procedures when:\n-\tthe old MME must be contacted by the new AMF, MME or S4 SGSN (a Release-8 SGSN supporting only Gn/Gp may also optionally use this procedure);\n-\tthe old AMF must be contacted by the new MME.\nThe primary use case is context transfer.\nThe 3GPP defined MME node FQDN shall be constructed as defined in clause 19.4.2.4 of 3GPP TS 23.003 [4] where the needed data can be obtained from the UE's old GUTI (or mapped from old P-TMSI and old RAI see clause 4.3.3.5 for more details, or mapped from the 5G-GUTI). The 3GPP defined MME node FQDN is either the canonical node name itself or an alias of the MME's canonical node name (the operator is free to choose the canonical node name).\nIf the MME node name employed by the operator is the 3GPP defined MME node FQDN then see clause 4.3.3.2 for provisioning.\nIf the MME node name employed by the operator is the 3GPP defined MME node FQDN, the operator shall provision NAPTR records under the 3GPP defined MME node FQDN for at least \"x-3gpp-mme:x-s10\", \"x-3gpp-mme:x-s3\" if S3/S4 GERAN/UTRAN is supported, and \"x-3gpp-mme:x- gn \" or \"x-3gpp-mme:x-gp\" if Gn/Gp is supported.\nSo, for example, for an MME or AMF to find all S10 interfaces of an MME based on the old GUTI or 5G-GUTI, the S-NAPTR procedure shall be prefixed with \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\"\nand set the Application-Unique String to the FQDN as defined in clause 19.4.2.4 of 3GPP TS 23.003 [4], with the initial query targeted at 3GPP defined MME node FQDN.\nSimilarly, for example, for an MME to find all N26 interfaces of an AMF based on the old GUTI, the S-NAPTR procedure shall be prefixed with \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\"\nand set the Application-Unique String to the FQDN as defined in clause 19.4.2.4 of 3GPP TS 23.003 [4], with the initial query targeted at 3GPP defined MME node FQDN.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This list can be obtained one host name at a time, in a procedure similar to Annex C.2, or a complete ordered list of all nodes, in a procedure similar to Annex C.3. Such a complete list obtained from an S-NAPTR procedure is referred here as a candidate list.\nSimilarly, for an S4 -SGSN to find all S3 interfaces of an MME based on the old GUTI it would use a \"Service Parameter\" of \"x-3gpp-mme:x-s3\".\nSimilarly, for a Release 8 Gn/Gp-SGSN to find all Gn and Gp interfaces of an MME based on the old GUTI it would use a \"Service Parameter\" of \" x-3gpp-mme:x-gn\", \" x-3gpp-mme:x-gp\".\nTo find all MME related services of an MME based on the MME's canonical node name, the S-NAPTR procedure shall be prefixed with \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\", \"x-3gpp-mme:x-s3\", \"x-3gpp-mme:x-s11\", \"x-3gpp-mme:x-gn\", \"x-3gpp-mme:x-gp\",\nand set the Application-Unique String to the MME's canonical node name.\nIt is also possible for the DNS resolver to use only the interfaces it is interested in or leave \"Service Parameters\" unspecified in the S-NAPTR procedure in order to identify all interfaces for all supported services and protocols.\nNOTE 1:\tThe services based on MME canonical node name can return services not starting with x-3gpp-mme since the MME node might, for example, have a co-located SGSN.\nNOTE 2:\tThe above procedures for discovering and selecting an AMF are identical to the procedures specified for discovering and selecting an MME; they can be used by MMEs not upgraded to support the procedure specified in clause 4.3.3.8. In this case, AMFs are provisioned in DNS as MMEs, following the mapping rules specified for EPS interworking with 5GS in clause 2.10.2 of 3GPP TS 23.003 [4], and the code space between AMF Region ID and MMEGI needs to be coordinated.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_19.4.2.4",
        "clause_4.3.3.5",
        "clause_4.3.3.2",
        "clause_4.3.3.8",
        "ts_23.003_clause_2.10.2",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.5",
      "section_id": "4.3.3.5",
      "section_title": "Services of an SGSN from a P-TMSI",
      "content": "There are procedures where the source SGSN must be contacted by the target MME or a target S4-SGSN. A Release 8 SGSN supporting only Gn/Gp may also optionally use this procedure.\nDuring a mobility procedure towards a new core network node, a UE served by a SGSN has a previously assigned P‑TMSI by the source SGSN. A pre-Release-8 UE will provide the P‑TMSI. A Release-8 UE will map P‑TMSI to a derived GUTI using the procedure in 3GPP TS 23.003 [4] clause 2.8.2and referred to in Annex H of 3GPP TS 23.401 [11].\nThe targetMME or a target S4-SGSN extracts the source's NRI, RAC, LAC, MNC and MCC from the P‑TMSI (or GUTI based on the procedure described in 3GPP TS 23.003 [4] clause 2.8.2).\nThe FQDN based on NRI, RAC, LAC, MNC and MCC as defined in 3GPP TS 23.003 [4] clause 19.4.2.6 is denoted in this specification as the NRI-RAI FQDN.\nIf the SGSN canonical node name employed by the operator is the NRI-RAI FQDN then see clause 4.3.3.2 for provisioning.\nIf the 3GPP defined NRI-RAI FQDN is not employed by an operator as the SGSN's canonical node name then the operator shall provision NAPTR records under the NRI-RAI FQDN with at least \"x-3gpp-sgsn:x-s3\", \"x-3gpp-sgsn:x-s4\", \"x-3gpp-sgsn:x-s16\" (assuming the SGSN supports S3/S4/S16 GERAN/U-TRAN) and at least \"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\" (assuming the SGSN supports legacy Gn/Gp).\nThe S-NAPTR procedure for finding the old SGSN services and interfaces from the P‑TMSI is started with \"Service Parameters\" of\n\"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\", \"x-3gpp-sgsn:x-s3\", \"x-3gpp-sgsn:x- s16\"\nas defined in 3GPP TS 23.003 [4] and setting the Application-Unique String to the NRI-RAI FQDN based on NRI, RAC, LAC, MNC and MCC as defined in 3GPP TS 23.003 [4] clause 19.4.2.6:\nNOTE 1:\tIn the event a valid NRI is not available then the <NRI> value shall be excluded from the FQDN. The default SGSN in the SGSN pool shall be provisioned under that record (or the sole SGSN if there is no SGSN pool for that RAI).\nNOTE 2:\tService Parameters are logically limited to those supported by the target node that is performing the search for the source SGSN. So for example, a target Release-8 SGSN supporting only Gn/Gp would employ \"x-3gpp-sgsn:x-gn\" and \"x-3gpp-sgsn:x-gp\". An S4-SGSN only supporting S4/S3/S16 would employ \"x-3gpp-sgsn:x-s3\", \"x-3gpp-sgsn:x-s16\". A target MME would employ \"x-3gpp-sgsn:x-s3\" and may additionally include \"x-3gpp-sgsn:x-gn\" and \"x-3gpp-sgsn:x-gp\", to support the procedures in Annex D of 3GPP TS 23.401 [11].\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This list can be obtained one host name at a time, in a procedure similar to Annex C.2, or a complete ordered list of all nodes, in a procedure similar to Annex C.3. Such a complete list obtained from an S-NAPTR procedure is referred here as a candidate list.\nNOTE 3:\tThe services based on canonical node name can return services not starting with x-3gpp-sgsn since the SGSN node might, for example, have a co-located MME.\nFor a pre-Release-8 target node i.e. a UE moving from eUTRAN to pre-Release-8 UTRAN/GERAN the UE will provide a derived P-TMSI based on a GUTI (See Annex H of 3GPP TS 23.401 [11]). As a result the source MME or Release-8 SGSN looks like a pre-Release-8 SGSN to a pre-Release-8 target node. For pre-Release‑8 compatibility operators would continue to provision A/AAAA records as described in Annex C.1 of 3GPP TS 23.003 [4] for the corresponding Gn/Gp interfaces regardless of whether the source SGSN is pre-Release-8 or not.\nNOTE 4:\tGn/Gp interfaces are provisioned redundantly for both \".gprs\" and \".3gppnetwork.org\" top level domains during the transition to Release-8 to allow a gradual forward migration to 3ggpnetwork.org while still supporting existing pre-Release‑8 usage.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_2.8.2",
        "ts_23.003_clause_19.4.2.6",
        "clause_4.3.3.2",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.6",
      "section_id": "4.3.3.6",
      "section_title": "Services of an SGW from SGW canonical node name",
      "content": "An MME or S4-SGSN may need to find SGW interfaces on a SGW based solely on SGW's canonical node name. The most common use cases are:\n-\tAn MME finding an S11 interface from an SGW node name where the SGW node name was determined from an S5/S8 interface selection based on TAI/eNodeB-ID (see clause 5.2).\n-\tAn S4-SGSN finding an S4 interface from an SGW node name where the SGW node name was determined from an S5/S8 interface selection based on RAI/RNC-ID (see clause 5.2).\n-\tFinding if an SGW node has PGW interfaces from an SGW node name (both SGW and PGW functions would be listed under one canonical node name for co-located PGW/SGW).\nSee clause 4.3.3.2 for DNS provisioning of the canonical node name records.\nFor LTE initial attach cases, the S11 interface is initially unknown by an MME. The S5/S8 interface and the SGW hostname will be selected by procedures in clause 5. The MME will obtain SGW S11 interfaces from the SGW canonical node name. The S-NAPTR procedure shall use \"Service Parameter\" of\n\"x-3gpp-sgw:x-s11\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the canonical node name of the specific SGW node to find the available S11 interfaces\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of services and interfaces of that SGW (see Annex C.2 for a more detailed description of a candidate list).\nFor example, an operator might provision an SGW name at:\ngw21.sgw.node.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\nSimilarly, for GERAN/UTRAN initial attach cases the S4-SGSN will need to obtain the SGW S4 interface after procedures in clause 5 select the S5/S8 interface and SGW hostname. The only change from the MME case is the \"Service Parameter\" of\n\"x-3gpp-sgw:x-s4\"\nis employed.\nIn cases where a new PDN connection is added to an existing SGW the available SGW S5/S8 interfaces are commonly needed.\nTo resolve the allowed SGW PMIPv6 interfaces the S-NAPTR procedure shall be used with the \"Service Parameters\" of\n\"x-3gpp-sgw:x-s5-pmip\", \"x-3gpp-sgw:x-s8-pmip\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the canonical node name of the specific SGW node\nSimilarly for the S5/S8 GTP interfaces the S-NAPTR procedure shall use \"Service Parameters\" of\n\"x-3gpp-sgw:x-s5-gtp\", \"x-3gpp-pgw:x-s8-gtp\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific SGW node.\nAdditional requirements to support DCN are specified in clause 5.8.\nIt is also possible to combine the \"Service Parameters\" in the S-NAPTR or to leave \"Service Parameters\" as logically unspecified initially in the S-NAPTR procedure in order to identify all interfaces for all 3GPP TS 29.303 supported protocols of the node.\nNOTE 1:\tThe services based on canonical node name can return services not starting with x-3gpp-sgw since the SGW node might, for example, have a co-located PGW.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2",
        "clause_4.3.3.2",
        "clause_5",
        "ts_23.003_clause_19.4.3",
        "clause_5.8",
        "ts_23.003",
        "ts_29.303"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.7",
      "section_id": "4.3.3.7",
      "section_title": "Services of an MSC Server from MSC Server canonical node name",
      "content": "During the SRVCC operations (see 3GPP TS 23.216 [20]), an MME or an SGSN may need to find the MSC Server Sv interface based on MSC Server canonical node name. The most common use cases are:\n-\tAn MME or an SGSN finding the Sv interface from an MSC Server node name, where the MSC server node name was determined from the Sv interface selection based on the Target RAI.\nSee clause 4.3.3.2 for DNS provisioning of the canonical node name records.\nTo find the MSC server services under the MSC server node name, the operator shall at least provision the \"Service Parameter\" of\n\"x-3gpp-msc:x-sv\"",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.3.2",
        "ts_23.216"
      ]
    },
    {
      "chunk_id": "ts_29.303_4.3.3.8",
      "section_id": "4.3.3.8",
      "section_title": "Services of an AMF from AMF instance name (or 5G-GUTI)",
      "content": "During a 5GS to EPS Idle mode mobility using N26 interface (see clause 4.11.1.3.2 of 3GPP TS 23.502 [29]), the MME needs to contact the old AMF for contexts transfer.\nThe 3GPP defined AMF instance FQDN shall be constructed as defined in clause 28.3.2.8 of 3GPP TS 23.003 [4] where the needed data can be obtained from the UE's old GUTI (mapped from the 5G-GUTI). The 3GPP defined AMF instance FQDN is either the canonical node name itself or an alias of the AMF's canonical node name (the operator is free to choose the canonical node name).\nIf the AMF node name employed by the operator is the 3GPP defined AMF instance FQDN then see clause 4.3.3.2 for provisioning.\nIf the AMF node name employed by the operator is the 3GPP defined AMF instance FQDN, the operator shall provision NAPTR records under the 3GPP defined AMF instance FQDN for \"x-3gpp-amf:x-n26\".\nSo, for example, for an MME to find all N26 interfaces of an AMF based on the old GUTI, the S-NAPTR procedure shall be prefixed with \"Service Parameters\" of\n\"x-3gpp-amf:x-n26\"\nand set the Application-Unique String to the FQDN as defined in clause 28.3.2.8 of 3GPP TS 23.003 [4], with the initial query targeted at 3GPP defined AMF instance FQDN.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This list can be obtained one host name at a time, in a procedure similar to Annex C.2, or a complete ordered list of all nodes, in a procedure similar to Annex C.3. Such a complete list obtained from an S-NAPTR procedure is referred here as a candidate list.\nNOTE:\tThe above procedure avoids the need for code space coordination between AMF Region ID and MMEGI for EPS interworking with 5GS, i.e. the full address space of the AMF Region ID can be used for 5GS.\n4A\tSGW/PGW selection using GTP-C load control\n4A.1\tGeneral\nThe nodes responsible for the SGW or PGW selection (i.e. the MME, S4-SGSN, TWAN or ePDG) shall apply the additions specified in this clause, if GTP-C load control is supported and enabled (see clause 12.2 of 3GPP TS 29.274 [23]).\nGTP-C load control allows for the advertising of load information at node level (i.e. the SGW or PGW load) or at APN level (for a PGW only) and selecting the target node (i.e. the SGW or PGW) based on this information.\nThe nodes responsible for the SGW or PGW selection shall take into account the load control information reported via GTP-C signalling and shall implement a SGW or PGW selection logic according to the principles specified in the following clauses.\nNOTE:\tThe exact algorithm used at the node performing the SGW or PGW selection, as per the aforementioned requirements, is implementation specific.\n4A.2\tNode-level load control\nThis clause specifies the extensions to the SGW or PGW selection procedures which shall be supported when GTP-C load control is supported and enabled at node level.\nThe node level load information consists of the \"Load Metric\" of the target node, i.e. the SGW or PGW, representing the current utilization of the resources as compared to the overall available resources at the target node.\nUsing the DNS based procedures specified in this document, the node performing the SGW or PGW selection (i.e. the MME, S4-SGSN, ePDG or TWAN), referred to as \"selecting node\" hereafter, shall prepare the candidate list of the target nodes satisfying the required criteria to serve the new session request.\nThe criteria for ordering the candidate list of target nodes shall be as specified in clause 4.3.2, i.e. giving priority to collocation when applicable, then to topological matching when applicable, then to the ordering obtained by the S-NAPTR output and then to the ordering obtained by the priority in the SRV records (when SRV records are used). However, the selecting node may select a candidate target node with a lower relative order if all the candidate target nodes with a higher relative order are not available, e.g. when they have reported a Load-Metric=100.\nThen within sets of available candidates with the same relative order (e.g. with the same topological order or with the same NAPTR order field) and with the same priority in SRV records (when SRV records are used), further called the \"TNodeList\" for the list of candidate target nodes \"TNode\", the node performing the SGW or PGW selection shall use the \"Load Metric\" and, if available (i.e. when SRV records are used), the DNS-weight-factor of each candidate target node to perform the node selection as indicated below:\n1)\tThe selecting node shall calculate the effective available load of each candidate target nodes, considering the current available load and the DNS weight-factor of the target node as follows:\nTNode-effective-available-load = (100 – TNode-load-metric)% X TNode-weight-factor\n2)\tThe selecting node shall then calculate the relative available load of each candidate target node, representing the effective-available-load of the target node, as compared to the effective-available-load of all the other candidate target nodes as follows:\nTNode-relative-available-load = (TNode-effective-available-load / sum-of-effective-available-load-of-all-the-nodes-in-TNodeList) X 100%\n3)\tThe selecting node shall then select the SGW or PGW for new session requests according to the TNode-relative-available-load of each target candidate node, e.g. a TNode-relative-available-load value of X% indicates that the corresponding target node should be selected for X% of the new sessions requests.\nThe selecting node shall assume the following in the calculations above:\n-\tThe selecting node shall assume the TNode-load-metric=0 for a candidate target node for which no node level load-metric is available (e.g. due to the load control feature being not supported between two PLMNs and that the PGW and the MME are from different PLMNs);\n-\tThe selecting node shall compute the TNode-weight-factor as (65535-NAPTR preference), as per Annex B.2, for each candidate target node if no SRV weight factor is received from the DNS, i.e. when only NAPTR records with the \"a\" flag are provisioned.\nAnnex E.1 provides an example illustrating these principles.\nWhen using GTP-C load control, the DNS should not be provisioned with a mix of NAPTR records with an \"s\" flag and with an \"a\" flag for a given FQDN.\nNOTE:\tIt is not possible to directly compare the TNode-weight-factor used with SRV records with the TNode-weight-factor used when there is no SRV record. It is implementation specific how to distribute the load among candidate SGW or PGWs if the DNS is provisioned with a mix of NAPTR records with an \"s\" flag and with an \"a\" flag.\n4A.3\tAPN-level load control\nThis clause specifies the extensions to the PGW selection procedures which shall be supported when GTP-C load control is supported and enabled at node level and APN level.\nA PGW may report the following APN load control information for a given APN via GTP-C signalling (see clause 12.2.4 of 3GPP TS 29.274 [23]):\n-\tAPN-Load-Metric: this indicates the current resource utilization for a particular APN, as a percentage, compared to the total resources reserved for that APN at the target PGW; and\n-\tAPN-relative-capacity: this indicates the total resources configured for a given APN, compared to the total resources of the target PGW, as a percentage. It is a static parameter and does not change unless the resources configured for the APN change.\nThe selecting node shall calculate the TNode APN weight factor of each candidate target node, considering the TNode APN relative capacity and the TNode weight factor as follows:\nTNode-APN-weight-factor = TNode-weight-factor X TNode-APN-relative-capacity.\nThe node performing the PGW selection shall then apply the principles and assumption specified in clause 4A.1 with the following additions or modifications:\n-\tthe selecting node shall substitute node level (TNode-\"X\") parameters with their corresponding APN level (TNode-APN-\"X\") parameters to calculate the relative APN available load of each candidate target node, i.e.:\nTNode-APNx-effective-available-load = (100 – TNode-APNx-load-metric)% X TNode-APNx-weight-factor\nTNode-APNx-relative-available-load = (TNode-APNx-effective-available-load / sum-of-APNx-effective-available-load-of-all-the-nodes-in-TNodeList) X 100%\n-\tthe selecting node shall then select the PGW for new session requests according to the TNode-APN-relative-available-load of each target candidate node, e.g. a TNode-APN-relative-available-load value of X% indicates that the corresponding target node should be selected for X% of the new sessions requests towards the requested APN.\n-\tIf the candidate PGW did not provide APN load control information for an APN (called \"APNx\"), but provided APN load control information for other APNs (called \"APNn\"), the selecting node shall assume the following when computing the relative APN available load for that candidate PGW for the \"APNx\":\nTNode-APNx-relative-capacity = (100 – sum of [TNode-APN-relative-capacity of other APNs \"APNn\")]) for the same PGW\nTNode-APNx-load-metric = {TNode-load-metric – sum of [for each APNs in APNn (TNode-APN-load-metric X TNode-APN-relative-capacity) / 100]} / {100 – sum of [TNode-APN-relative-capacity of each APNs in APNn]) / 100}\nNOTE:\tThe formula to compute the APNx load metric results from the following equation:TNode-load-metric X TNode-capacity = sum of [for each APNs in APNn (TNode-APN-load-metric X TNode-capacity X TNode-APN-relative-capacity / 100)] + TNode-APNx-load-metric X TNode-capacity X (100 – sum of [ TNode-APN-relative-capacity of each APNs in APNn) / 100\n-\tIf the candidate PGW did not provide APN load control information for any APN, the selecting node shall assume the following when computing the relative APN available load for that candidate PGW for an APN:\nTNode-APNx-relative-capacity = 100\nTNode-APNx-load-metric = TNode-load-metric (i.e. the load at the target node level)\nAnnex E.2 provides examples illustrating these principles.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.11.1.3.2",
        "ts_23.003_clause_28.3.2.8",
        "clause_4.3.3.2",
        "ts_29.274_clause_12.2",
        "clause_4.3.2",
        "ts_29.274_clause_12.2.4",
        "clause_4",
        "ts_23.502",
        "ts_23.003",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.1.1",
      "section_id": "5.1.1.1",
      "section_title": "General",
      "content": "The procedures here give a list of possible PGWs and their interfaces that serve a particular APN. This is very similar to the existing function that resolves the GGSN IP address based on an APN.\nNOTE 1:\tThe RAI/RNC-ID FQDN is used in addition to the APN FQDN when selecting the GGSN for SIPTO above RAN enabled APN. See clause 5.6.\nHowever, the Release-8 behaviour includes more functionality than pre-Release-8 systems since the PGW now can support more than one protocol and there is sometimes a desire to have the PGW and SGW collocated or topologically close to each other (with respect to the network topology), if possible. New DNS records are required to distinguish between different protocols and interfaces and assist in the more complicated selections.\nThe operator shall provision the authoritative DNS server(s) responsible for the APN‑FQDN, including all derivatives used by the operator in the APN‑OI replacement field (as defined in 3GPP TS 23.060 [18] and 3GPP TS 23.401 [11])with NAPTR records for the given APN-FQDN and corresponding PGWs under the APN-FQDN.\nSee clause 19.4.2.2 of 3GPP TS 23.003 [4].\nThe above format is used in DNS for use in DNS queries by S4-SGSN and MME to networks with DNS provisioned to Release-8. A Release-8 SGSN only supporting Gn/Gp may also optionally use this procedure.\nThe DNS records provisioned at that location are NAPTR records and include all S5/S8 and Gn/Gp interfaces for PGW, GGSN, and collocated PGW/GGSN that are intended to be used for that APN.\nWhen PGW-C/SMFs are deployed in a PGW-C/SMF set, as an operator option, one separate NAPTR DNS record may be provisioned for the PGW-C/SMF Set under the APN records of each APN supported by the PGW-C/SMF set (see example in Annex A.3.5); if so, in this DNS record, the NAPTR flag shall be set to \"\", and NAPTR \"replacement\" shall be set to the PGW Set FQDN as specified in clause 19.4.2.13 of 3GPP TS 23.003 [4]. An MME supporting the Restoration of PDN connections after a PGW-C/SMF Change procedure as specified in 3GPP TS 23.007 [31] shall be able to select a PGW-C/SMF from this PGW-C/SMF Set identified by the PGW Set FQDN as specified in clause 5.1.4.\nNOTE 2:\tThe provisioning of the above DNS record is not necessary to support restoring the PDN connections after a PGW-C/SMF change. This provisioning can allow an MME to select a PGW pertaining to a PGW-C/SMF set for a given APN during the initial PDN connection establishment.\nThe pre-Release-8 format APN as specified in clause 9.1 of 3GPP TS 23.003 [4] is still used in pre-Release-8 SGSN DNS queries and continues to be used as a fallback in Release-8 SGSN for discovering Gn/Gp interfaces.\nThe DNS records provisioned at that location are A and/or AAAA records but only for the Gn/Gp interfaces of a standalone GGSN or collocated PGW/GGSN.\nThe APN-FQDN is derived from the APN where the APN is typically in the legacy format of \"<APN‑NI>.mnc<MNC>.mcc<MCC>.gprs\" as specified in clause 9.1of 3GPP TS 23.003 [4].\nNOTE 3:\tThe APN-FQDN is used for DNS query purposes in Release-8. It does not imply a change in the use or format of the APN in other protocols, nodes or UE/MS. The APN-FQDN and the APN use independent formats but are related as below for DNS usage by the MME and S4-SGSN.\nThe APN received by the EPC node discovery function for 3GPP accesses, is always of the form of an APN-NI part and operator part. It is the output from Annex A of 3GPP TS 23.060 [18], which is exactly three labels with last label \"gprs\".\nIf the APN is constructed using the default APN-OI or using the APN-OI Replacement field (as defined in 3GPP TS 23.060 [18] and 3GPP TS 23.401 [11]), then the APN-FQDN shall be obtained from the APN as specified in clause 19.4.2.2.1 of 3GPP TS 23.003 [4], otherwise the APN is considered to be invalid and cannot be used.\nIn Annex A of 3GPP TS 23.060 [18] the SDL diagram refers to a \"DNS interrogation\" succeeding or failing which is the only DNS interaction. This is clarified as follows:\nFor the procedures defined in the present document the APN-FQDN shall be used in the S-NAPTR with a NAPTR query (see later clauses for details). If the S-NAPTR procedure succeeds the \"DNS interrogation\" succeeds. If the S-NAPTR procedure fails to find a PGW or collocated PGW/GGSN then the \"DNS interrogation\" fails.\nFor the legacy procedures defined in Annex A of 3GPP TS 23.060 [18] the unmodified APN shall be used in the DNS A query and DNS AAAA query. If either query succeeds, the \"DNS interrogation\" succeeds. If the A and AAAA queries both fail then the \"DNS interrogation\" fails.\nThe nodes responsible for the PGW selection (i.e. the MME or S4-SGSN) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.6",
        "ts_23.003_clause_19.4.2.2",
        "ts_23.003_clause_19.4.2.13",
        "clause_5.1.4",
        "ts_23.003_clause_9.1",
        "ts_23.003_clause_19.4.2.2.1",
        "clause_4",
        "ts_23.060",
        "ts_23.401",
        "ts_23.003",
        "ts_23.007"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.1.2",
      "section_id": "5.1.1.2",
      "section_title": "Discovering a PGW or collocated PGW/GGSN for a 3GPP Access - S8/Gp roaming case existing PDN",
      "content": "This clause covers the case where the SGW or S4-SGSN is in the visiting network, the SGW is already pre-selected by having at least one existing PDN connection and a UE attempts to create a new PDN connection for a different APN to be selected in the home network.\nOperators shall provision NAPTR records for each APN-FQDN that allows roaming with at least \"Service Parameters\" of\n\"x-3gpp-pgw:x-s8-gtp\", \"x-3gpp-pgw:x-s8-pmip\", \"x-3gpp-ggsn:x-gp\", \"x-3gpp-pgw:x-gp\"\nfor each such supported interface of that type.\nThe S-NAPTR procedure, employed by the MME or S4-SGSN, to discover all S8interfaces shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s8-gtp\", \"x-3gpp-pgw:x-s8-pmip\"\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and set the Application-Unique String to the APN FQDN as defined in clause 19.4.2.2 of 3GPP TS 23.003 [4]. The \"Service Parameter\" of \"x-3gpp-pgw:x-gp\" shall be included if the MME or S4-SGSN wishes to potentially bias towards a collocated PGW/GGSN.\nAdditional requirements to support DCN are specified in clause 5.8.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of candidate IPv4 and IPv6 addresses. This is a \"candidate\" list of PGW or collocated PGW/GGSN for that APN (see Annex C.2 for an informative description of a candidate list and Annex B for the S-NAPTR procedure).\nThe above procedure shall be used by the MME or S4-SGSN to select the PGW or collocated PGW/GGSN.\nNOTE 1:\tWhen an LTE capable terminal is in GERAN/UTRAN access, the S4-SGSN might wish to preferentially select a node with both Gp and S8 (i.e. a co-located PGW/GGSN) based on an operator policy. A preference for a co-located PGW/GGSN may also exist in an LTE access based on operator policy. The MME, or Release-8 SGSN, may find co-located PGW/GGSN nodes by searching the APN \"candidate\" list for interfaces with the same canonical node name in a Gp interface host name and S8 interface host name.\nThe PGW and SGW cannot be collocated in this case since the SGW and PGW are in different operator networks. Furthermore, topological matching by DNS host names shall not be done since the host names are under different operators' administrative control.\nThe Service Parameter of \"x-3gpp-pgw:x-gp\" denotes a collocated Release 8 GGSN function on a PGW. A PGW with a collocated Release 8 GGSN function may be preferred subject to operator policies. If that is the case the collocated PGW/GGSN nodes should be moved to the front of the candidate list but otherwise retaining the same relative order. The interfaces from the candidate list that are not S8 based shall be removed. The PGW S8 interfaces are tried in order from the candidate list.\nNOTE 2:\tContrary to the non-roaming case, in the roaming case the domain name of the SGW interface selected does not influence the PGW selection.\nIn the above procedure after the PGW has been contacted, the selected PGW node name, selected IP address, port (if non standard) and selected protocol type (GTPv2 vs. PMIP) shall be stored in the MME or S4-SGSN so it can be accessed on a PDN basis.\nNOTE 3:\tIn this release of 3GPP only standard ports are used.\n3GPP TS 23.401 [11] currently indicates only one of PMIP or GTPv2 will be used based on roaming agreements so the above query would actually not require both gtp and pmip. The operator could use the order field in the NAPTR records to accomplish an optional fallback to the other protocol type.\nUse cases where a SGW needs to be selected are covered in clause 5.2. However, since Gn/Gp access bypasses SGW selection completely both for subsequent PDP context activations and initial attach we note that special case here.\nIf the UE is in GERAN or UTRAN access and the Release 8 SGSN supports Gp, but not S4, the procedure above is modified as follows. The \"Service Parameters\" shall be\n\"x-3gpp-pgw:x-gp\" , \"x-3gpp-ggsn:x-gp\"\nAdditional requirements to support DCN are specified in clause 5.8.\nIf an LTE capable mobile is in GERAN/UTRAN access a PGW with a collocated PGW/GGSN function may be preferred subject to operator policies. If that is the case the PGW/GGSN nodes should be moved to the front of the candidate list but otherwise retaining the same relative order. The rest of the procedure is the same as above.\nIf the APN record does not exist at the .3gppnetwork.org domain and the UE is in GERAN or UTRAN access and the Release 8 SGSN supports Gp then the pre Release-8 DNS procedures shall apply for the APN lookup by the Release 8 SGSN (i.e. APN lookup by A/AAAA records in the domain .gprs).",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.2",
        "clause_5.8",
        "clause_5.2",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.1.3",
      "section_id": "5.1.1.3",
      "section_title": "Discovering a PGW or collocated PGW/GGSN for a 3GPP Access - S5/Gn intra-operator existing PDN",
      "content": "Operators shall provision NAPTR records for each APN-FQDN for use within their network with at least \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\", \"x-3gpp-pgw:x-s5-pmip\", \"x-3gpp-ggsn:x-gn\", \"x-3gpp-pgw:x-gn\"\nfor each such supported interface of that type.\nAssuming the SGW is already pre-selected by having an existing PDN connection and a UE attempts to create a new PDN connection for a different APN in the user's home network, then the MME or S4-SGSN shall perform the following procedure:\nThe S-NAPTR procedure, employed by the MME or S4-SGSN to discover S5 interfaces shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\", \"x-3gpp-pgw:x-s5-pmip\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and set the Application-Unique String to the APN FQDN as defined in clause 19.4.2.2 of 3GPP TS 23.003 [4]. The \"Service Parameter\" of \"x-3gpp-pgw:x-gn\" shall be included if the MME or S4-SGSN wishes to potentially bias towards a collocated PGW/GGSN.\nAdditional requirements to support DCN are specified in clause 5.8.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of candidate IPv4 and IPv6 addresses. This is a \"candidate\" list of PGW or collocated PGW/GGSN for that APN (see Annex C.2 for an informative description of a candidate list and Annex B for the S-NAPTR procedure).\nCollocation and topological ordering between the PGW and SGW applies in this case.\nIf the existing SGW hostname has \"topoff\" then the candidate list of PGW shall be used in the order given to try to contact a PGW, after moving any colocated SGW/PGW to the front of the candidate list while maintaining relative order within that set.\nThe Service Parameter of \"x-3gpp-pgw:x-gn\" denotes a collocated Release 8 GGSN function on a PGW. A PGW with a collocated Release 8 GGSN function may be preferred subject to operator policies. If that is the case the collocated PGW/GGSN nodes should be moved to the front of the candidate list but otherwise retaining the same relative order. The interfaces from the candidate list that are not S5 based shall be removed. The PGW S5 interfaces are tried in order from the candidate list..\nIf the existing SGW hostname has \"topon\" the two candidate lists shall be used in the procedure in Annex C.4 with the PGW as \"A\" and the SGW as \"B\". Annex C.4 results in a list of PGW to try in order.\nOnce a PGW is successfully contacted the selected PGW host name, PGW IP address used, port (if non-standard) and selected protocol type (GTP vs PMIP) shall be stored in the MME or S4-SGSN so it can be accessed on a PDN basis.\nNOTE 1:\tIn this release of 3GPP only standard ports are used.\nUse cases where a SGW needs to be selected are covered in clause 5.2 and clause 5.3. However, since Gn/Gp access bypasses SGW selection completely both for subsequent PDP context activations and initial attach we note that special case here.\nIf the UE is in GERAN or UTRAN access and the Release 8 SGSN supports Gn, but not S4, the procedure above is modified as follows. The \"Service Parameters\" shall be\n\"x-3gpp-pgw:x-gn\" , \"x-3gpp-ggsn:x-gn\"\nAdditional requirements to support DCN are specified in clause 5.8.\nNOTE 2:\tWhen the SGSN supports Gn selects the GGSN or collocated PGW/GGSN for SIPTO above RAN enabled APN, in addition to the APN FQDN, the S-NAPTR procedure use the \"Service Parameters\" of \"x-3gpp-pgw:x-gn\" , \"x-3gpp-ggsn:x-gn\", and set the Application-Unique String to the RAI FQDN as specified in clause 5.5.2 or the RNC-ID FQDN as specified in clause 19.4.2.7 of 3GPP TS 23.003 [4] . See clause 5.6.\nIf an LTE capable mobile is in GERAN/UTRAN access a PGW with a collocated PGW/GGSN function may be preferred subject to operator policies. A preference for a co-located PGW/GGSN may also exist in an LTE access based on operator policy. The MME, or Release-8 SGSN, may find co-located PGW/GGSN nodes by searching the APN \"candidate\" list for interfaces with the same canonical node name in a Gn interface host name and S5 interface host name. If that is the case the PGW/GGSN nodes should be moved to the front of the candidate list but otherwise retaining the same relative order. The rest of the procedure is the same as above.\nIf the APN record does not exist at the .3gppnetwork.org domain and the UE is in GERAN or UTRAN access and the Release 8 SGSN supports Gn then the pre Release-8 DNS procedures shall apply for the APN lookup by the Release 8 SGSN (i.e. APN lookup by A/AAAA records in the domain .gprs).\nThose procedures apply also to the case of roaming with local breakout when subscription data and network policy allow selection of a PGW from the VPLMN (see e.g. clause 4.2.2 in 3GPP TS 23.401 [11]).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.2",
        "clause_5.8",
        "clause_5.2",
        "clause_5.3",
        "clause_5.5.2",
        "ts_23.003_clause_19.4.2.7",
        "ts_23.003_clause_5.6",
        "ts_23.401_clause_4.2.2",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.1.4",
      "section_id": "5.1.1.4",
      "section_title": "Discovering a PGW, collocated PGW/GGSN or GGSN for a 3GPP Access - S5/Gn intra-operator initial attach",
      "content": "During the initial attach and PDN connection creation using a 3GPP access both a PGW and an SGW need to be selected by an MME and will also be used by a S4-SGSN in PDP context creation. The discovery and selection procedures for cases employing a SGW are the same as for the PGW and the SGW discovery and selection procedure described in clause 5.3.\nThe discovery and selection procedures for a Release-8 SGSN selecting a Gn interface for PDP context creation are in clause 5.1.1.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3",
        "clause_5.1.1.3"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.2.1",
      "section_id": "5.1.2.1",
      "section_title": "Discovering a PGW for a non-3GPP Access – S2a/S2b initial attach for roaming and non-roaming",
      "content": "The MAG functionality or TWAN within the trusted non-3GPP IP access or the e-PDG shall use the S-NAPTR procedure with \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2a-pmip\", \"x-3gpp-pgw:x-s2b-pmip\", \"x-3gpp-pgw:x-s2a-mipv4\",\"x-3gpp-pgw:x-s2b-gtp\", \"x-3gpp-pgw:x-s2a-gtp\"\nand the APN-FQDN as the Application-Unique String.\n<APN-NI>.apn.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\nSee clause 19.4.2.2 of 3GPP TS 23.003 [4].\nAdditional requirements to support DCN are specified in clause 5.8.\nWhen PGW-C/SMFs are deployed in a PGW-C/SMF set, as an operator option, one separate NAPTR DNS record may be provisioned for the PGW-C/SMF Set under the APN records of each APN supported by the PGW-C/SMF set (see example in Annex A.3.5); if so, in this DNS record, the NAPTR flag shall be set to \"\", and NAPTR \"replacement\" shall be set to the PGW Set FQDN as specified in clause 19.4.2.13 of 3GPP TS 23.003 [4]. An ePDG supporting the Restoration of PDN connections after a PGW-C/SMF Change procedure as specified in 3GPP TS 23.007 [31] shall be able to select a PGW-C/SMF from this PGW-C/SMF Set identified by the PGW Set FQDN as specified in clause 5.1.4.\nNOTE:\tThe provisioning of the above DNS record is not necessary to support restoring the PDN connections after a PGW-C/SMF change. This provisioning can allow an ePDG to select a PGW pertaining to a PGW-C/SMF set for a given APN during the initial PDN connection establishment.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of PGW for that APN (see Annex B for S-NAPTR procedure and see Annex C.2 for an informative description of a candidate list).\nThere is no requirement for selection for a collocated PGW/SGW in this procedure. In the above procedure, the selected PGW node name, port and selected type (PMIPv6, MIPv4 or GTP) shall be stored in the MAG functionality, TWAN or the ePDG so it can be accessed on a PDN basis.\nThe nodes responsible for the PGW selection (i.e. the TWAN or ePDG) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.4.2.2",
        "clause_5.8",
        "ts_23.003_clause_19.4.2.13",
        "clause_5.1.4",
        "clause_4",
        "ts_23.003",
        "ts_23.007"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.2.2",
      "section_id": "5.1.2.2",
      "section_title": "Discovering a PGW for a non-3GPP Access – S2a/S2b initial attach and chained PMIP-based S8-S2a/S2b",
      "content": "The MAG functionality within the trusted non-3GPP IP access or the e-PDG shall use the S-NAPTR procedure with the \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2a-pmip\", \"x-3gpp-pgw:x-s2b-pmip\"\nand the APN-FQDN as the Application-Unique String.\n<APN-NI>.apn.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\nSee clause 19.4.2.2 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of PGW for that APN (see Annex B for S-NAPTR procedure and see Annex C.2 for an informative description of a candidate list).\nThe MAG selects a PGW based on the protocol type (GTP v/s PMIPv6) supported over the S5/ S8 interface based on information received over STa and SWm interfaces.\nThe PGW and SGW cannot be collocated in this case since the SGW and PGW are in different operator networks.\nThe DNS records in the order returned are then used to contact the PGW node.\nThe nodes responsible for the PGW selection (i.e. the TWAN or ePDG) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.4.2.2",
        "clause_4",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.3.1",
      "section_id": "5.1.3.1",
      "section_title": "Discovering a PGW for a non-3GPP Access – S2c initial attach",
      "content": "This clause covers the case where the IP address of the Home Agent (HA) functionality of a particular PGW needs to be discovered from the FQDN of the PGW. This query may be sent from a trusted access gateway or from an ePDG. The trusted access gateway or ePDG shall use the S-NAPTR procedure with \"Service Parameters\" of\n\"x-3gpp-pgw:x-s2c-dsmip\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the FQDN of the specific PGW.\nThe nodes responsible for the PGW selection (i.e. the TWAN or ePDG) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "clause_4",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.4.1",
      "section_id": "5.1.4.1",
      "section_title": "General",
      "content": "The DNS procedure specified in this clause shall be used by an MME or an ePDG to select an alternative PGW-C/SMF from a PGW-C/SMF Set during an MME or ePDG triggered Restoration of a PDN connection after an PGW-C/SMF change, as specified in clause 31 of 3GPP TS 23.007 [31], if the MME or ePDG did not receive Alternative PGW-C/SMF IP Addresses from the PGW for the PDN connection, i.e. if the PGW Change Info IE received from the PGW for the PDN connection contains either the PGW Set FQDN IE or the Alternative PGW-C/SMF FQDN IE(s).",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.007_clause_31",
        "ts_23.007"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.4.2",
      "section_id": "5.1.4.2",
      "section_title": "Using the PGW Set FQDN",
      "content": "For deployments using a PGW Set FQDN, operators shall provision NAPTR records under the PGW Set FQDN (as defined in clause 19.2.4.13 of 3GPP TS 23.003 [4]) with at least \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\", \"x-3gpp-pgw:x-s8-gtp\", \"x-3gpp-pgw:x-s2b-gtp\"\nfor each PGW-C/SMF within the PGW-C/SMF Set,\nThe MME or ePDG shall discover the PGW-C/SMFs available within a PGW-C/SMF Set by initiating an S-NAPTR procedure, with the Application-Unique String set to the PGW Set FQDN, and with the \"Service Parameters\" set to \"x-3gpp-pgw:x-s5-gtp\" or \"x-3gpp-pgw:x-s8-gtp\" (for an MME) or to \"x-3gpp-pgw:x-s2b-gtp\" (for an ePDG).\nThe PGW Set FQDN shall be the PGW Set FQDN last received (over S5/S8 and S11 interfaces or over the S2b interface) from the PGW for the PDN connection.\nThe S-NAPTR procedure outputs a list of host names (PGWs) each with a service, protocol, port and a list of IPv4 and IPv6 addresses pertaining to the PGW-C/SMF set. See further details and examples in Annexes B, C and G.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.2.4.13",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.1.4.3",
      "section_id": "5.1.4.3",
      "section_title": "Using Alternative PGW-C/SMF FQDNs",
      "content": "For deployments using Alternative PGW-C/SMF FQDNs, the procedure specified in clause 4.3.3.3 shall apply, i.e.:\n-\toperators shall provision NAPTR records for the S5, S8 and/or S2b interfaces of the alternative PGW-C/SMFs of the PGW-C/SMF set, and\n-\tthe MME or ePDG shall use the S-NAPTR procedure using the \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\" , \"x-3gpp-pgw:x-s8-gtp\", \"x-3gpp-pgw:x-s2b-gtp\"\nfor the S5, S8 and S2b interface respectively, and the Application-Unique String set to the Alternative PGW-C/SMF FQDN received in the PGW Change Info IE.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.3.3.3"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.2.1",
      "section_id": "5.2.1",
      "section_title": "General",
      "content": "These procedures are employed when an SGW needs to be selected by an EPC core node and a PGW has already been selected. In particular for the tracking area update procedure with SGW change.\nThe SGW is selected based on the target cell where the UE has moved into. The MME has the new target eNodeB cell ID (eCID)/target eNodeB-ID and TAI available . The MME shall construct the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4] and the MME shall construct the eNodeB-ID FQDN as defined in clause 19.4.2.10 of 3GPP TS 23.003 [4].\nThe selected SGW shall serve the UE's TAI and/or eNodeB-ID. During the attach/TAU/Handover procedure the MME receives the TAI value and eNodeB-ID which is derived from the ECGI or received from the source MME/SGSN. The MME shall contruct the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4] and eNodeB-ID FQDN as defined in clause 19.4.2.10 of 3GPP TS 23.003 [4].\nOperators shall provision, for each TAI/eNodeB-ID value in their network, NAPTR records under the TAI/eNodeB-ID FQDN corresponding to each valid SGW interfaces from the following \"Service Parameters\"\n\"x-3gpp-sgw:x-s8-gtp\", \"x-3gpp-sgw:x-s8-pmip\", \"x-3gpp-sgw:x-s5-gtp\", \"x-3gpp-sgw:x-s5-pmip\"\nwhere additional \"Service Parameters\" may be included optionally.\nAdditional requirements to support DCN are specified in clause 5.8.\nFor each RAI/RNC-ID value that is served by a S4-SGSN the same records would be provisioned under the RAI FQDN (see clause 5.5.2 for the RAI FQDN) or the RNC-ID FQDN (see clause 19.4.2.7 of 3GPP TS 23.003 [4] for the RNC-ID FQDN).\nThe S-NAPTR procedure employed by an MME for finding a candidate set of SGW nodes shall use the TAI FQDN/eNodeB-ID FQDN as the Application-Unique String.\nFor the purposes of this document the NAPTR record-set at that location will be called the TAI/eNodeB-ID NAPTR record-set.\nThe MME selects the S11 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the TAI/eNodeB-ID records.\nNOTE:\tIf an operator does not use the \"a\" and \"s\" flags in the TAI/eNodeB-ID NAPTR records (i.e. they use the \"\" flag) and they are using SGW service areas it is strongly recommended that the TAI/eNodeB-ID NAPTR records point directly to NAPTR records representing the SGW service areas. This is to facilitate possible future use in the SGW Load Re-balancing procedure.\nFor the case of an S4-SGSN making the SGW selection the RAI FQDN (see clause 5.5.2) or the RNC-ID FQDN (see clause 19.4.2.7 of 3GPP TS 23.003 [4] for the RNC-ID FQDN ) is used instead of the TAI FQDN or the eNodeB-ID FQDN to select the SGW but is otherwise the same as the MME handling TAU. The S4-SGSN selects the S4 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the RAI/RNC-ID records.\nS-GW selection when SGW that acts as a local anchor for non-3GPP access in the case of S8-S2a/b chained roaming is outside the scope of this specification.\nThe nodes responsible for the SGW selection (i.e. the MME or S4-SGSN) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.2.10",
        "clause_5.8",
        "clause_5.5.2",
        "ts_23.003_clause_19.4.2.7",
        "clause_4.3.3",
        "clause_4",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.2.2",
      "section_id": "5.2.2",
      "section_title": "SGW Selection during TAU or RAU with SGW change - 3GPP roaming case",
      "content": "For the roaming case the type of protocol (PMIP vs. GTP) is chosen based on a roaming agreement according to 3GPP TS 23.401 [11]. The MME shall therefore use the S-NAPTR procedure with \"Service Parameters\" of\n\"x-3gpp-sgw:x-s8-gtp\" or \"x-3gpp-sgw:x-s8-pmip\"\nAdditional requirements to support DCN are specified in clause 5.8.(based on whetherGTP v2 or PMIPv6 is used for the current PDN connection)\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and possibly restricted based ona roaming agreement to use only GTPv2 or PMIPv6 and set the Application-Unique String to the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4] or the eNodeB-ID FQDN as defined in clause 19.4.2.10 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of SGW for that TAI/eNodeB-ID (see Annex B for S-NAPTR procedure and see Annex C.2 for an informative description of a candidate list).\nIf the first choice protocol (PMIP or GTPv2) fails the second choice MAY be tried subject to the operators' roaming agreements.\nNeither collocation of PGW and SGW nor topological ordering rules apply in this case.\nThe present clause to this point implicitly assumes only one PDN connection is currently employed by a UE which may not be the case with multiple PDN connections for the same UE. All PDN connections after the TAU must be on the same SGW since there is only one SGW at a time for a UE.\nIf an existing PDN for the UE is PMIPv6 S8 and some existing PDN for the UE is GTPv2 S8 then a SGW supporting both protocols is required. If that occurs and there are no such SGW then the PDN connections with the least important retention (from the ARP value) would have to be dropped until a list of viable SGW of one protocol meeting the retention policies is found. If there are non viable SGW they are removed from the original SGW candidate list. After this point the SGW candidate list order is used in the same way as it was in the case of only one PDN connection.\nOnce an SGW is successfully contacted the selected SGW host name, selected SGW IP address, selected port (if non-standard) and selected protocol type (GTPv2 vs. PMIP - which is unchanged here) shall be stored in the MME so it can be accessed on a PDN basis.\nNOTE 1:\tIn this release of 3GPP only standard ports are used.\nFor the case of an S4-SGSN making the SGW selection the RAI FQDN (see clause 5.5.2) or the RNC-ID FQDN (see clause 19.4.2.7 of 3GPP TS 23.003 [4] for the RNC-ID FQDN) is used instead of the TAI/eNodeB-ID FQDN to select the SGW but is otherwise the same as the MME handling TAU. The S4-SGSN selects the S4 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the RAI/RNC-ID records.\nNOTE 2:\tA SGW will need to be selected at a handover attach from another access type. The SGW selection method is the same as presented here since there are existing PDN connections (typically PMIPv6 for non-3GPP accesses).",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.8",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.2.10",
        "clause_5.5.2",
        "ts_23.003_clause_19.4.2.7",
        "clause_4.3.3",
        "ts_23.401",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.2.3",
      "section_id": "5.2.3",
      "section_title": "SGW Selection during TAU or RAU with SGW change - non-roaming case",
      "content": "This differs from the 3GPP roaming case in 5.2.2 primarily in that the PGW and the SGW are in the same network. Hence, there is a need to be able of selecting a SGW collocated with the PGW or a topologically close SGW. The current PGW's node name should previously have been stored in the MME or S4-SGSN when the default bearer was established or transported from the old MME to the new MME, and is therefore available for comparison.\nFor the non-roaming case the S-NAPTR procedure shall be initiated with \"Service Parameters\" of\n\"x-3gpp-sgw:x-s5-gtp\" and/or \"x-3gpp-sgw:x-s5-pmip\"\nAdditional requirements to support DCN are specified in clause 5.8.(based on whether GTPv2 or PMIPv6 is used for the current PDN connection)\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and set the Application-Unique String to the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4]. The Application-Unique-String may be set to the eNodeB-ID FQDN as defined in clause 19.4.2.10 of 3GPP TS 23.003 [4] as an operator specific deployment option.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of SGW for that TAI/eNodeB-ID (see Annex B for S-NAPTR procedure and see Annex C.2 for a more detailed informative description of a candidate list).\nCollocation of PGW and SGW and topological ordering rules both apply in this case.If the existing PGW hostname for the PDN has \"topoff\" then the \"candidate\" list of SGW would be used in the order given to try to contact a SGW after moving the PGW with the same SGW node name to the front of the list keeping relative order.\nIf the existing PGW hostname has \"topon\" the two candidate lists shall be used in the procedure in Annex C.4 with the SGW as \"A\" and the PGW as \"B\". Annex C.4 results in a list of SGW to try in order.\nThe present clause to this point implicitly assumes only one PDN connection is currently employed by a UE which may not be the case with multiple PDN connections for the same UE.\nIf an existing PDN for the UE is PMIPv6 S5 and some existing PDN for the UE is GTPv2 S5 then a SGW supporting both protocols is required. If that occurs and there are no such SGW then the PDN connections with the least important retention (from the ARP value) would have to be dropped until a list of viable SGW of one protocol meeting the retention policies is found. If there are non viable SGW they are removed from the original SGW candidate list. After this point the SGW candidate list order is used in the same way as it was in the case of only one PDN connection.\nAfter this point it is a matter of operator policy or vendor implementation which PDN or PDNs (and hence their corresponding PGW canonical node names) are used for selecting the corresponding best SGW interface.\nNOTE 1:\tOne possible option would be as follows. First try to maximize the number of PDN connections that are on PGW colocated on the same viable SGW. If there are no collocated choices the PGW giving the closest topological match to any viable SGW are used. If they are all equal then SGW ordering from the SGW candidate list is used. This approach would be very similar, but not identical, to passing the list of PGW being used as list \"B\" and the SGW candidate list with only viable SGW as list \"A' in the procedure in Annex C.4\nOnce an SGW is successfully contacted the selected SGW host name, SGW IP address used, port (if non-standard) and selected type (GTP vs PMIP) shall be stored in the MME so it can be accessed on a PDN basis.\nNOTE 2:\tIn this release of 3GPP only standard ports are used.\nFor the case of an S4-SGSN making the SGW selection the RAI FQDN (see clause 5.5.2) is used or as an operator deployment option the Application-Unique-String may be set to the RNC-ID FQDN as defined in clause 19.4.2.7 of 3GPP TS 23.003 [4] instead of the TAI/eNodeB-ID FQDN to select the SGW but is otherwise the same as the MME handling for TAU. The S4-SGSN selects the S4 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the RAI or RNC-ID records.\nNOTE 3:\tA SGW will need to be selected at a handover attach from another access type. The SGW selection method is the same as presented here since there are existing PDN connections (typically PMIPv6 for non-3GPP accesses).\nNOTE 4:\teNodeB-ID and RNC-ID FQDN are only employed by Release 10 or onwards MME/SGSNs for SGW selection.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.2.10",
        "clause_5.5.2",
        "ts_23.003_clause_19.4.2.7",
        "clause_4.3.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.2.4",
      "section_id": "5.2.4",
      "section_title": "SGW Selection during non-3GPP handover to 3GPP access",
      "content": "The SGW selection is similar with other cases. For the non-roaming case, there is a need of selecting a SGW collocated with the PGW or a topologically close SGW. The current PGW's node name should previously have been stored in the HSS and would be sent to the MME during the access authentication procedure and is therefore available for comparison.\nThe S-NAPTR procedure for SGW Selection is same as clause 5.2.2 for roaming case, and is same as clause 5.2.3 for non-roaming case.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2",
        "clause_5.2.3"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.3",
      "section_id": "5.3",
      "section_title": "Procedures for Discovering and Selecting a PGW and SGW",
      "content": "This scenario applies to the UE initial attach and PDP context activation cases, where the MME or S4-SGSN has not yet assigned a PGW or a SGW to the UE. During the attach procedures, the MME shall select the SGW and the PGW as described below. During the UTRAN/GERAN PDP context activation procedure, the S4-SGSN shall select the SGW and the PGW as described below.\nNOTE 1:\tThe procedure specified in this clause is not applied for the LGW selection for LIPA service or for SIPTO at the local network with LGW collocated with (H)(e)NB. The MME/S4 SGSN uses the LGW address proposed by the (H)(e)NB in the S1-AP/RANAP message as specified in 3GPP TS 36.413 [19] and 3GPP TS 25.413 [12] to select the appropriate LGW for LIPA service or for SIPTO at the local network with LGW collocated with (H)(e)NB.\nFor SIPTO at the local network with stand-alone GW, the SGW shall be selected based on the < LHN name> provided by the (H)(e)NodeB during the attach or SIPTO at local network PDN connection creation. The MME shall construct the Local Home Network-ID FQDN defined in clause 19.4.2.11 of 3GPP TS 23.003 [4].\nThe selected SGW shall serve the UE's TAI/eNodeB-ID. During the attach procedure the MME receives the TAI value and eNodeB-ID which is derived from the ECGI. The S-NAPTR procedure to obtain a list of \"candidate\" SGW shall be used with \"Service Parameters\" of\n\"x-3gpp-sgw:x-s5-gtp\", \"x-3gpp-sgw:x-s5-pmip\"\nAdditional requirements to support DCN are specified in clause 5.8.as defined in clause 19.4.3 of 3GPP TS 23.003 [4], and set the Application-Unique String set to the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4] or as an operator specific deployment option the Application-Unique-String may be set to the eNodeB-ID FQDN as defined in clause 19.4.2.10 of 3GPP TS 23.003 [4]. For SIPTO at the Local Network with stand-alone GW the Local Home Network ID as defined in clause 19.4.2.11 of 3GPP TS 23.003 [4] shall be used to select the SGW.\nThe S-NAPTR procedure logically outputs a list of host names each coupled with a service, a protocol, a port, and a list of IPv4 and IPv6 addresses. This is the \"candidate\" list of SGWs for a specific TAI/eNodeB-ID (see Annex B for S-NAPTR procedure and see Annex C.2 for an informativedescription of the candidate list).\nThe list of \"candidate\" PGW is obtained as follows:\nThe S-NAPTR procedure to get the list of \"candidate\" PGW shall use \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp\", \"x-3gpp-pgw:x-s5-pmip\", \"x-3gpp-pgw:x-gn\"\nAdditional requirements to support DCN are specified in clause 5.8.\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4], and the Application-Unique String set to the APN FQDN as defined in clause 19.4.2.2 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure logically outputs a list of host names each coupled with a service, a protocol, a port, and a list of IPv4 and IPv6 addresses. This is the \"candidate\" list of PGWs for a specific APN (see Annex C.2 for a detailed description of a candidate list).\nThe two candidate lists shall be used in the procedure described in Annex C.4 with the SGW as an \"A\" node type and the PGW as a \"B\" node type in the procedure.\nThe procedure described in Annex C.4 results in a selection of a SGW and a PGW along with the protocol, the IP address and the port. In the case of a failure to contact the SGW or the PGW, the required gateway reselection procedures are described in Annex C.4.\nThe MME selects the S11 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the TAI records.\nNOTE 2:\tThe MME (S4-SGSN) send a GTPv2 Create Session Request to the SGW respectively over S11 or S4 with the IPv4/IPv6 address of the PGW. After the SGW has been successfully contacted over S11 or S4, the SGW can try to contact the PGW over S5/S8.\nOnce the SGW has successfully been contacted, the selected SGW host name, the used SGW IP address, the port number and the selected protocol type shall be stored in the MME or S4-SGSN per PDN.\nOnce the PGW has successfully been contacted, the selected PGW host name, the used PGW IP address, the port number and the selected protocol type shall be stored in the MME or S4-SGSN per PDN.\nFor the case of an S4-SGSN making the selection the RAI FQDN is used, or as an operator deployment option the Application-Unique-String may be set to the RNC-ID FQDN as defined in clause 19.4.2.7 of 3GPP TS 23.003 [4] instead of the TAI FQDN/eNodeB-ID FQDN to select the SGW but is otherwise the same as an MME doing the selection. The S4-SGSN selects the S4 interface of the SGW from the SGW's canonical node record (see clause 4.3.3) if it is not obtained from the RAI or RNC-ID records.\nThe nodes responsible for the SGW and PGW selection (i.e. the MME or S4-SGSN) shall apply the additions specified in clause 4A, if GTP-C load control is supported and enabled.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.2.11",
        "clause_5.8",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.2.10",
        "ts_23.003_clause_19.4.2.2",
        "clause_4.3.3",
        "ts_23.003_clause_19.4.2.7",
        "clause_4",
        "ts_36.413",
        "ts_25.413",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.4",
      "section_id": "5.4",
      "section_title": "Procedures for Discovering and Selecting an MME",
      "content": "These procedures can be used as part of:\n-\tthe 'Inter eNodeB handover with MME relocation' procedure to select an MME;\n-\tthe RAN Information Management (RIM) procedure to select an MME;\n-\tUTRAN/GERAN to E-UTRAN SRVCC procedure to select an MME as specified in 3GPP TS 23.216 [20];\n-\tIMSI and APN Information retrieval procedure for RAN User Plane Congestion mitigation to select an MME as specified in clause 5.9.3 of 3GPP TS 23.401[11];\n-\tNAS Message Redirection procedure to retrieve the MMEGI identifying the DCN serving a particular UE usage type as specified in 3GPP TS 23.401[11];\n-\t5GS to EPS handover using N26 interface to select an MME, as specified in clause 4.11.1.2.1 of 3GPP TS 23.502 [29]; or\n-\tEPS to 5GS handover using N26 interface to select an AMF, as specified in clause 4.11.1.2.2 of 3GPP TS 23.502 [29].\nIn the 'Inter eNodeB handover with MME relocation' procedure, the 'UTRAN Iu mode to E-UTRAN Inter RAT handover' procedure, the 'GERAN A/Gb mode to E-UTRAN Inter RAT handover' procedure, the 'UTRAN/GERAN to E-UTRAN SRVCC' procedure, the 5GS to EPS handover using N26 interface, the MME is selected based on the target cell where the UE is expected to move into. The MME has the new target eNodeB cell ID (eCID) and TAI available. The TAI includes the TAC, the MNC and the MCC.\nIn the EPS to 5GS handover using N26 interface procedure, the AMF is selected based on the target 5GS TAI received from the source eNB. The 5GS TAI includes the 5GS TAC, the MNC and the MCC.\nIn the 'IMSI and APN Information retrieval' procedure, the MME is selected based on the TAI of the cell or eNodeB that is congested in the user plane. The RCAF has the congested eNodeB cell ID (eCID) and TAI available. The TAI includes the TAC, the MNC and the MCC.\nThe S-NAPTR procedure for finding a candidate set of MME nodes for a target TAI is always started at the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4]. The S-NAPTR procedure performed at the source MME/S4-SGSN/AMF for finding a candidate set of target MME nodes is started with at least the \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure for finding a candidate set of AMFs for a target 5GS TAI shall be started at the 5GS TAI FQDN as defined in clause 28.3.2.6 of 3GPP TS 23.003 [4]. The S-NAPTR procedure performed at the source MME for finding a candidate set of target AMF nodes is started with at least the \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4].\nAdditional requirements to support DCN are specified in clause 5.8.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of MMEs (or AMFs) for that TAI (or 5GS TAI) (see Annex C.2 for a more detailed description of a candidate list).\nTopological closeness shall not be used for the MME selection so the MME candidate list would be used in the order given to try to contact a MME.\nNOTE 1:\tThe source MME/S4-SGSN may wish to preferentially select a target MME that is co-located with a SGSN function based on an operator policy. The S-NAPTR procedure using the canonical node name (clause 4.3.3) may be used to find any co-located SGSN interfaces in the candidate list. Optionally an operator may provision NAPTR records with \"x-3gpp-sgsn:x-gn\" and/or \"x-3gpp-sgsn:x-s4\" at the TAI FQDN to allow an MME to directly get a candidate list for the co-located SGSN and hence for the source MME to match node names from the hostnames in the two candidate lists.\nNOTE 2:\tIf an operator does not use the \"a\" and \"s\" flags in the TAI NAPTR records (i.e. they use the \"\" flag) it is strongly recommended that the TAI NAPTR records point directly to NAPTR records at mmegi<MMEGI>.mme.epc.mnc<mnc>. mcc<mcc>.3gppnetwork.org (i.e. an MME pool )\nNOTE 3:\tThe above procedures for discovering and selecting an AMF are identical to the procedures specified for discovering and selecting an MME but using a 5GS TAI FQDN instead of a TAI FQDN; they can be used by MMEs not upgraded to support the procedure specified in clause 5.4A, during an EPS to 5GS handover using N26 interface. In this case, AMFs are provisioned in DNS as MMEs, following the mapping rules specified for EPS interworking with 5GS in clause 2.10.2 of 3GPP TS 23.003 [4].\nFor an S4-SGSN making the selection the \"Service Parameter\" of \"x-3gpp-mme:x-s3\" shall be employed instead of \"x‑3gpp-mme:x-s10\".\nAdditional requirements to support DCN are specified in clause 5.8.\nFor an MSC making the selection the \"Service Parameter\" of \"x-3gpp-mme:x-sv\" shall be employed instead of \"x‑3gpp-mme:x-s10\".\nFor an RCAF making the selection of an MME the \"Service Parameter\" of \"x-3gpp-mme:x-nq\" shall be employed.\nAn SGSN supporting only Gn/Gp may also optionally use this procedure with \"Service Parameter\" of \"x-3gpp-mme:x-gn\" in the '3G Gn/Gp SGSN to MME Combined Hard Handover and SRNS Relocation' procedure as specified in Annex D.3.4 of 3GPP TS 23.401 [11] .\nAdditional requirements to support DCN are specified in clause 5.8.\nNOTE 4:\tThe SGSN supporting only Gn/Gp need map the eNodeB id to the RNC id to avoid updating the Target ID IE in the GTPv1 Forward Relocation Request message.\nFor the case when a UE is moving from a pre-Release-8 UTRAN/GERAN to an MME the pre‑Release‑8 source node will not be able to use the .3ggpnetwork.org based records. As a result the MME being selected looks like a pre-Release‑8 SGSN to a pre-Release-8 node performing a selection. For pre-Release 8 compatibility, operators would continue to provision A/AAAA records as per Annex C.1 of 3GPP TS 23.003 [4] for the corresponding MME Gn/Gp interfaces under the RNC-ID corresponding to the mapped targed ID value (see clause D.3.4 of 3GPP TS 23.401 [11] and clause 5.5.3 of the present document).\nIn the RAN Information Management (RIM) procedure, the MME is selected based on the Target eNodeB Identifier specifed by source RAN node.\n5.4A\tProcedures for Discovering and Selecting an AMF with N26 interface\nThese procedures can be used as part of:\n-\tEPS to 5GS handover using N26 interface to select an AMF, as specified in clause 4.11.1.2.2 of 3GPP TS 23.502 [29].\nIn the EPS to 5GS handover using N26 interface procedure, the AMF is selected based on the target 5GS TAI received from the source eNB. The 5GS TAI includes the 5GS TAC, the MNC and the MCC.\nThe S-NAPTR procedure for finding a candidate set of AMFs for a target 5GS TAI shall be started at the 5GS TAI FQDN as defined in clause 28.3.2.6 of 3GPP TS 23.003 [4]. The S-NAPTR procedure performed at the source MME for finding a candidate set of target AMF nodes is started with at least the \"Service Parameters\" of\n\"x-3gpp-amf:x-n26\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4].\nAdditional requirements to support DCN are specified in clause 5.8.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of AMFs for that 5GS TAI (see Annex C.2 for a more detailed description of a candidate list).\n5.4B\tProcedures for Discovering and Selecting an MME_SRVCC\nThese procedures can be used as part of:\n-\t5G-SRVCC from NG-RAN to UTRAN procedure to select an MME_SRVCC, as specified in clause 6.5 of 3GPP TS 23.216 [20].\nIn the 5G-SRVCC from NG-RAN to UTRAN procedure, the MME_SRVCC is selected based on the Target ID received from the source NG-RAN. The Target ID includes the Target RNC ID.\nThe S-NAPTR procedure for finding a candidate set of MME_SRVCCs for a Target RNC ID shall be started at the Target RNC ID for UTRAN FQDN as defined in clause 19.4.2.7 of 3GPP TS 23.003 [4]. The S-NAPTR procedure performed at the source AMF for finding a candidate set of target MME_SRVCC nodes is started with at least the \"Service Parameters\" of\n\"x-3gpp-mme:x-s10\"\nas defined in clause 19.4.3 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of MME_SRVCCs for that Target RNC ID (see Annex C.2 for a more detailed description of a candidate list).",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.401_clause_5.9.3",
        "ts_23.502_clause_4.11.1.2.1",
        "ts_23.502_clause_4.11.1.2.2",
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_28.3.2.6",
        "clause_5.8",
        "clause_4.3.3",
        "clause_5.4",
        "ts_23.003_clause_2.10.2",
        "ts_23.401_clause_5.5.3",
        "ts_23.216_clause_6.5",
        "ts_23.003_clause_19.4.2.7",
        "ts_23.216",
        "ts_23.401",
        "ts_23.502",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.5.1",
      "section_id": "5.5.1",
      "section_title": "General",
      "content": "These procedures are employed:\n-\twhen a target SGSN that serves the target cell or RNC needs to be initially selected by an EPC core node or Release-8 SGSN or an MSC. It explicitly does not cover selection of an SGSN by a RNC or BSS;\n-\tas part of the UTRAN/GERAN to UTRAN (HSPA) SRVCC procedure to select an SGSN as specified in 3GPP TS 23.216 [20]; or\n-\tfor APN Information retrieval procedure for RAN User Plane Congestion mitigation to select an SGSN as specified in clause 6.17 of 3GPP TS 23.060[18].\n-\tNAS Message Redirection procedure to retrieve Null-NRI or the SGSN Group ID identifying the DCN serving a particular UE usage type as specified in 3GPP TS 23.401[11].\nClause 4.3.3.5 \"Services of an SGSN from a P-TMSI\" specifies how a target MME/S4-SGSN discovers the IP address of the source SGSN during Idle Mode Mobility from GERAN /UTRAN.\nEPC core nodes, i.e. the MME and the S4-SGSN employ the procedures below during the SRNS relocation procedure and the RAN Information Management (RIM) procedure. A Release‑8 SGSN supporting only Gn/Gp may also optionally use this procedure. An MSC supporting UTRAN/GERAN to UTRAN (HSPA) SRVCC procedure to select an SGSN may also use this procedure as specified in 3GPP TS 23.216 [20].\nThe SGSN is selected based on information in the Target ID (see 3GPP TS 23.003 [4] and 3GPP TS 25.413 [12]). For PS GERAN the Target ID has the global cell ID including PLMN and for U-TRAN the Target ID has RAC, RNC-ID and PLMN.\nFor the Fallback to GTPv1 scenario as specified in 3GPP TS 29.274 [23] clause 7.10, the new SGSN/MME shall send the related GTPv1 request message with the peer SGSN IP address on the Gn/Gp interface after receiving the GTPv2 response message with Cause \"Fallback to GTPv1\". The new MME/SGSN shall make another DNS query to obtain the peer SGSN IP address on the Gn/Gp interface if that address is not available. The A/AAAA query shall be used to obtain the peer SGSN IP address on the Gn/Gp interface.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.060_clause_6.17",
        "ts_23.401_clause_4.3.3.5",
        "ts_29.274_clause_7.10",
        "ts_23.216",
        "ts_23.060",
        "ts_23.401",
        "ts_23.003",
        "ts_25.413",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.5.2",
      "section_id": "5.5.2",
      "section_title": "SGSN initial target selection based on RAI (UTRAN target/GERAN Iu mode target/GERAN Gb mode target)",
      "content": "In both U-TRAN and GERAN cases the target RAC, LAC, MNC, and MCC are available from the information in the Target ID. This selection is done by an MME or Release-8 SGSN during SRNS relocation procedures and the RAN Information Management (RIM) procedures.\nThe S-NAPTR procedure for an MME/SGSN finding a candidate set of SGSN services and interfaces serving the target Routing Area is started with \"Service Parameters\" of\n\"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\", \"x-3gpp-sgsn:x-s3\",\"x-3gpp-sgsn:x-nqprime\"\nAdditional requirements to support DCN are specified in clause 5.8.\nas defined in 3GPP TS 23.003 [4] and setting the Application-Unique String to the RAI FQDN based on RAC, LAC, MNC, MCC as defined in 3GPP TS 23.003 [4] clause 19.4.2.5:\nrac<RAC>.lac<LAC>.rac.epc.mnc<MNC>. mcc<MCC>.3gppnetwork.org\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of SGSN for that RAI (see Annex B for S-NAPTR procedure and see Annex C.2 for a more informative description of a candidate list).\nNOTE 1:\tIn the SRNS relocation procedure, for an MME making the selection there is an existing PDN connection (and hence an existing SGW) so the S3 interfaces would logically be preferred over the Gn/Gp interfaces to keep the existing PDN connection. However, if there is a colocated PGW/GGSN being employed with the 3GPP TS 23.401 [11] Annex D procedures then the Gn/Gp interfaces on the target SGSN can also be valid. Operators should prioritize the DNS records according to their preference.\nFor an S4-SGSN making the selection the \"Service Parameter\" of \"x-3gpp-sgsn:x-s16\" shall be employed instead of \"x-3gpp-sgsn:x-s3\".\nAdditional requirements to support DCN are specified in clause 5.8.\nFor an MSC making the selection the \"Service Parameter\" of \"x-3gpp-sgsn:x-sv\" shall be employed instead of \"x‑3gpp-sgsn:x-s3\".\nFor an RCAF making the selection of an SGSN the \"Service Parameter\" of \"x-3gpp-sgsn:x-nqprime\" shall be employed.\nA Release 8 SGSN supporting only Gn/Gp may also optionally use this procedure with \"Service Parameters\" of \"x‑3gpp-sgsn:x-gn\" and \"x-3gpp-sgsn:x-gp\".\nAdditional requirements to support DCN are specified in clause 5.8.\nOperators shall provision, for each RAI value in their network, NAPTR records under the RAI FQDN corresponding to each valid SGSN interfaces from at least the following \"Service Parameters\"\n\"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\", \"x-3gpp-sgsn:x-s3\",\"x-3gpp-sgsn:x-s16\", \"x-3gpp-sgsn:x-nqprime\"\nAdditional requirements to support DCN are specified in clause 5.8.\nwhere NAPTR records for additional \"Service Parameters\" may be included optionally.\nNOTE 2:\tThe NAPTR record at the RAI FQDN can be provisioned to correspond to only the default SGSN node(s) in the SGSN pool(s) serving that RAI. The default SGSN after the DNS procedure exits would be contacted with GTP, the default SGSN then selects the actual SGSN within that SGSN pool. This results in all relocation requests being handled by the default SGSN nodes. If the operator's goal is to avoid load on the default SGSN nodes then the records provisioned at the RAI FQDN should instead include the entire set of SGSN in all SGSN pools that service that RAI. The S-NAPTR procedure would then return each SGSN in the SGSN pool based on the provisioned DNS weights and priority.\nNOTE 3:\tThe NAPTR record at the RAI FQDN for the service parameter of \"x-3gpp-sgsn:x-nqprime\" is provisioned with the entire set of SGSN in all SGSN pools that are serving that RAI.\nNOTE 4:\tThe SGSN(s) closest to the geographical region covered by the RAI can be biased by provisioning the DNS records with higher priority or weights.\n3GPP does not require that collocation and \"topon\" naming is applicable in SGSN selection.\nNOTE 5:\tService parameters are limited to those supported by the node doing the search.\nNOTE 6:\tSGW records will also be provisioned under the RAI FQDN see clause 5.2\nIn the SRNS relocation procedure, for the case when a UE is moving from a pre-Release-8 UTRAN/GERAN to a Release-8 target SGSN the pre‑Release‑8 source node will not be able to use the .3ggpnetwork.org based records. As a result the Release 8 SGSN (or MME) being selected looks like a pre-Release 8 SGSN to a pre-Release-8 node performing a selection. For pre-Release 8 compatibility operators would continue to provision A/AAAA records as per Annex C.1 of 3GPP TS 23.003 [4] for the corresponding Gn/Gp interfaces regardless of whether the SGSN is pre-Release-8 or not. Vendors shall support pre-Release 8 DNS procedures on Release 8 SGSN.\nIn the RAN Information Management (RIM) procedure, the SGSN is selected based on the RAI specifed by source RAN node.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_5.8",
        "ts_23.003_clause_19.4.2.5",
        "clause_5.8",
        "clause_5.2",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.5.3",
      "section_id": "5.5.3",
      "section_title": "SGSN initial target selection based on RNC-ID (UTRAN target/GERAN Iu mode target)",
      "content": "NOTE 1:\tIn the SRNS relocation procedure, the finer granularity this procedure allows only applies to UTRAN/GERAN Iu mode and only when different RNC-IDs have the same RAI values.\nThis procedure is used for a UTRAN/GERAN Iu mode target in the SRNS relocation procedure and the RAN Information Management (RIM) procedure.\nIn UTRAN/GERAN Iu mode case the target RNC-ID, MNC, and MCC are available from the information in the Target ID.\nThe S-NAPTR procedure for an MME/S4- SGSN finding a candidate set of SGSN services and interfaces serving the target RNC is started with \"Service Parameters\" of\n\"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\", \"x-3gpp-sgsn:x-s3\"\nAdditional requirements to support DCN are specified in clause 5.8.\nas defined in 3GPP TS 23.003 [4] and setting the Application-Unique String to the RNC-ID FQDN based on RNC‑ID,MNC,MCC as defined in 3GPP TS 23.003 [4] clause 19.4.2. 5.\nThe S-NAPTR procedure logically outputs a list of host names each with a service, protocol, port and a list of IPv4 and IPv6 addresses. This is a \"candidate\" list of SGSN for that RNC-ID (see Annex B for S-NAPTR procedure and see Annex C.2 for a more informative description of a candidate list).\nNOTE 2:\tIn the SRNS relocation procedure, for an MME making the selection there is an existing PDN connection (and hence an existing SGW) so the S3 interfaces would logically be preferred over the Gn/Gp interfaces to keep the existing PDN connection. However, if there is a colocated PGW/GGSN being employed with the 3GPP TS 23.401 [11] Annex D procedures then the Gn/Gp interfaces on the target SGSN can also be valid. Operators should prioritize the DNS records accordingly.\nFor an S4-SGSN making the selection the \"Service Parameter\" of \"x-3gpp-sgsn:x-s16\" shall be employed instead of \"x‑3gpp-sgsn:x-s3\".\nAdditional requirements to support DCN are specified in clause 5.8.\nFor an MSC making the selection the \"Service Parameter\" of \"x-3gpp-sgsn:x-sv\" shall be employed instead of \"x‑3gpp-sgsn:x-s3\".\nA Release 8 SGSN supporting only Gn/Gp may also optionally use this procedure with \"Service Parameters\" of \"x‑3gpp-sgsn:x-gn\" and \"x-3gpp-sgsn:x-gp\". Additional requirements to support DCN are specified in clause 5.8. If there are no NAPTR records at that RNC-ID then the RAI based lookup in clause 5.5.2 shall be used as a fallback.\nOperators using this feature shall provision, for each RNC-ID value in their network, NAPTR records under the RNC-ID FQDN corresponding to each valid SGSN interfaces from the following \"Service Parameters\"\n\"x-3gpp-sgsn:x-gn\", \"x-3gpp-sgsn:x-gp\", \"x-3gpp-sgsn:x-s3\", \"x-3gpp-sgsn:x-s16\",\nAdditional requirements to support DCN are specified in clause 5.8.\nwhere NAPTR records for additional \"Service Parameters\" may be included optionally.\nOperators not using this feature shall not provision the RNC-ID records.\nNOTE 3:\tThe NAPTR record at the RNC-ID FQDN can be provisioned to correspond to only the default SGSN node(s) in the SGSN pool(s) serving that RNC. The default SGSN after the DNS procedure exits would be contacted with GTP, the default SGSN then selects the actual SGSN within that SGSN pool. This results in all relocation requests being handled by the default SGSN nodes. If the operator's goal is to avoid load on the default SGSN nodes then the records provisioned at the RNC-ID FQDN should instead include the entire set of SGSN in all SGSN pools that service that RNC. The S-NAPTR procedure would then return each SGSN in the SGSN pool based on the provisioned DNS weights and priority.\nNOTE 4:\tThe SGSN(s) closest to the geographical region serving the RNC can be biased by provisioning the DNS records with higher priority or weights.\n3GPP does not require that collocation and \"topon\" naming is applicable in SGSN selection.\nNOTE 5:\tService parameters are limited to those supported by the node doing the search.\nIn the SRNS relocation procedure, for the case when a UE is moving from a pre-Release-8 UTRAN/GERAN to a Release-8 target SGSN the pre‑Release‑8 source node will not be able to use the .3ggpnetwork.org based records. As a result the target Release‑8 SGSN (or MME) looks like a pre‑Release‑8 SGSN to a pre-Release‑8 source node. For pre-Release 8 compatibility operators would continue to provision A/AAAA records as per Annex C.3 of 3GPP TS 23.003 [4] for the corresponding Gn/Gp interfaces regardless of whether the target SGSN is pre‑Release‑8 or not. Vendors shall support pre-Release 8 DNS procedures on Release 8 SGSN.\nIn the RAN Information Management (RIM) procedure, the SGSN is selected based on the RNC-ID specifed by source RAN node.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_5.8",
        "ts_23.003_clause_19.4.2",
        "clause_5.8",
        "clause_5.5.2",
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.6.1",
      "section_id": "5.6.1",
      "section_title": "SIPTO above RAN",
      "content": "DNS procedures defined in the clause 5 in this specification also apply for the GW selection for SIPTO service.\nThe S-NAPTR based selection of the SGW (based on TAI, eNodeB-ID, RAI, or RNC-ID) gives the shortest user plane path from the UE to the SGW from the S-NAPTR ordering. Topological naming should be employed (as specified in clause 4.3.2) to find the shortest user plane path from the SGW to the PGW based on the topological closeness. With this approach, the MME or SGSN can select an SGW and PGW to achieve the shortest user plane path to the UE for a SIPTO enabled APN.\nThe S-NAPTR based selection of the GGSN gives the shortest user plane path from the UE to the GGSN from the S-NAPTR ordering. When the network supports Direct Tunnel, separate S-NAPTR procedures should be used, with APN FQDN and then with RAI FQDN or RNC-ID FQDN, to retrieve a list of candidates respectively, the common one from the S-NAPTR ordering should be selected.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "clause_4.3.2"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.6.2",
      "section_id": "5.6.2",
      "section_title": "SIPTO at the local network with LGW collocated with the (H)(e)NB",
      "content": "The LGW shall reside in the local network and be collocated with the (H)(e)NB. The MME/SGSN shall use the LGW address proposed by the (H)(e)NB in the S1-AP/RANAP message, instead of selecting the PGW via DNS interrogation as specified in clause 5.\nThe SGW shall remain in the mobile operator's core network, i.e. collocation of the SGW and LGW is not applicable.\nDNS procedures defined in the clause 5 in this specification apply for the SGW selection (i.e. based on TAI, eNodeB-ID, RAI, or RNC-ID).\nEditor's Note: procedures for Gn SGSN are FFS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.6.3",
      "section_id": "5.6.3",
      "section_title": "SIPTO at the local network with stand-alone GW (LGW collocated with SGW)",
      "content": "The stand-alone GW shall reside in the local network and be collocated with the SGW.\nDNS procedures defined in the clause 5 in this specification also apply for the GW selection for SIPTO service with the following additions.\nThe MME/SGSN shall use the Local (H)(e)NB Network ID provided by the (H)(e)NB in the S1-AP/RANAP message to discover the SGW via the DNS. The S-NAPTR based selection of the SGW (based on the Local (H)(e)NB Network ID) gives the shortest user plane path from the UE to the SGW from the S-NAPTR ordering. Topological naming should be employed (as specified in clause 4.3.2) to find collocated SGW and LGW.\nNOTE:\tBased on operator policy, the MME/SGSN can select a local SGW (based on the Local (H)(e)NB Network ID) at UE attachment to the (H)eNB regardless of whether a SIPTO at the local network PDN connection is established or not (see TS 23.401 clause 4.3.15.2).",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5",
        "clause_4.3.2",
        "ts_23.401_clause_4.3.15.2",
        "ts_23.40"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.6.4",
      "section_id": "5.6.4",
      "section_title": "SIPTO for eHRPD",
      "content": "For the support of the SIPTO service for eHRPD access, topological naming should be employed (as specified in clause 4.3.2) to find the shortest user plane path from the HSGW to the PGW based on the topological closeness. With this approach, the HSGW can select a PGW to achieve the shortest userplane to the UE for a SIPTO enabled APN. Details related to SIPTO support for eHRPD access are specified in 3GPP2 X.S0057 [24] and 3GPP TS 23.402 [25].",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.2",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.7.1",
      "section_id": "5.7.1",
      "section_title": "General",
      "content": "These procedures are employed when a target MSC Server that serves the target cell or RNC needs to be initially selected by an EPC core node or Release-8 SGSN for the SRVCC operation. It explicitly does not cover selection of an MSC Server by a RAN node nor the selection of an MSC server at an SRNS relocation.\nEPC core nodes, i.e. the MME and the S4-SGSN employ the procedures below during the PS-to-CS relocation procedure for the SRVCC operation. A Release‑8 SGSN supporting only Gn/Gp may also optionally use this procedure.\nThe MSC server enhanced for SRVCC is selected based on information received in the Target ID from the source E-UTRAN or UTRAN (see 3GPP TS 23.003 [4], 3GPP TS 25.413 [12] and 3GPP TS 36.413 [21]).",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003",
        "ts_25.413",
        "ts_36.413"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.7.2",
      "section_id": "5.7.2",
      "section_title": "Selection of the MSC server enhanced for SRVCC based on target RAI (UTRAN / GERAN Iu & A/Gb mode target)",
      "content": "In SRVCC operations towards UTRAN and GERAN, the target MCC, MNC, LAC and optionally the RAC are available from the information in the Target ID.\nThe S-NAPTR procedure for an MME/SGSN finding the MSC Sv service and interfaces serving the target Routing Area is started with \"Service Parameters\" of\n\"x-3gpp-msc:x-sv\"\nas defined in 3GPP TS 23.003 [4] and setting the Application-Unique String to the RAI FQDN based on RAC, LAC, MNC, MCC as defined in 3GPP TS 23.003 [4] clause 19.4.2.5:\nrac<RAC>.lac<LAC>.rac.epc.mnc<MNC>. mcc<MCC>.3gppnetwork.org\nThe MME/SGSN shall set the RAC to a default value, e.g. hexadecimal value 'FF', if it is not available from the information in the Target ID.\nA Release 8 SGSN supporting only Gn/Gp may also optionally use this procedure with \"Service Parameters\" of \"x‑3gpp-msc:x-sv\".\nOperators shall provision, for each RAI value in their network, NAPTR records under the RAI FQDN corresponding to each valid MSC interfaces from at least the following \"Service Parameters\"\n\"x-3gpp-msc:x-sv\",\nwhere NAPTR records for additional \"Service Parameters\" may be included optionally.\nNOTE 1:\tThe NAPTR record at the RAI FQDN can be provisioned to correspond to only the default MSC server node(s) in the MSC pool(s) serving that RAI. The default MSC Server would be contacted with GTP, the default MSC server then selects the actual MSC Server within that MSC Server pool. This results in all SRVCC PS to CS service requests being handled by the default MSC Server nodes. If the operator's goal is to avoid load on the default MSC Server nodes then the records provisioned at the RAI FQDN should instead include the entire set of MSC Servers in all MSC Server pools that service that RAI. The S-NAPTR procedure would then return each MSC Server in the MSC Server pool based on the provisioned DNS weights and priority.\nNOTE 2:\tThe MSC Server closest to the geographical region covered by the RAI can be biased by provisioning the DNS records with higher priority or weights.\n3GPP does not require that collocation and \"topon\" naming is applicable in MSC Server selection.\nNOTE 3:\tService parameters are limited to those supported by the node doing the search.\nNOTE 4:\tSGW records will also be provisioned under the RAI FQDN see clause 5.2",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_19.4.2.5",
        "clause_5.2",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.8.1",
      "section_id": "5.8.1",
      "section_title": "General",
      "content": "These procedures shall be employed in PLMNs deploying DCNs for:\n-\tdiscovering and selecting an SGW, PGW or GGSN in a DCN serving a particular UE usage type;\n-\tretrieving the MMEGI or Null-NRI/SGSN Group ID to identify the DCN serving a particular UE usage type and to determine whether to perform a NAS Message Redirection procedure (see clause 5.19.1 of 3GPP TS 23.401 [11]);\n-\tdiscovering and selecting a target MME or SGSN serving a particular UE usage type during a handover procedure with a MME or SGSN change.\nDNS procedures to support DCNs shall be supported as specified in the rest of the specification, with the additions specified in the following clauses.\nThe UE usage type used during DNS procedure shall be the one mapped from the UE Usage Type received from the HSS as part of the subscription, based on the serving network operator configured policies and the UE related context information available at the serving network, e.g. information about roaming.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401_clause_5.19.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.8.2",
      "section_id": "5.8.2",
      "section_title": "SGW, PGW and GGSN Selection Procedure",
      "content": "The S-NAPTR procedure employed to discover and select an SGW, PGW or GGSN in a DCN shall use the Application-Unique String set to the FQDN specified in the rest of this specification, e.g. with the APN-FQDN for PGW selection or with the TAI/eNodeB-ID/RAI/RNC-ID FQDN for SGW selection, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed.\nFor example, the MME or S4-SGSN shall discover all GTP based S8 interfaces using \"Service Parameters\" of\n\"x-3gpp-pgw:x-s8-gtp+ue-<ue usage type>\"\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies.\nThe S-NAPTR procedure shall logically output a candidate list of SGWs, PGWs or GGSNs serving at least the requested UE usage type, according to the general principles specified in clause 4.3.3.2.1 and Annex B.3. If no candidate SGW, PGW or GGSN is found for the requested UE usage type, possibly also after using local configuration, the procedure shall be performed with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name.\nNOTE 1:\tThis is required to discover and select an SGW, PGW or GGSN when no dedicated SGW, PGW or GGSN is configured for a particular UE usage type and FQDN.\nAs an exception to the above requirement if no candidate SGW, PGW or GGSN is found for the requested UE usage type for the selection of an SGW, PGW or GGSN in the same PLMN, the MME/SGSN, TWAN or ePDG may decide not to perform an S-NAPTR procedure with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name if so configured by operator policies and abort the selection procedure.\nNOTE 2:\tThis can avoid selecting an SGW, PGW or GGSN not intended to support specific UE usage type.\nAnnex A.4 provides examples of DNS provisioning for SGW and PGW discovery and selection procedures in a DCN, and examples of procedures for discovery and selection of SGW/PGW.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "clause_4.3.3.2.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.8.3",
      "section_id": "5.8.3",
      "section_title": "MMEGI and Null-NRI/SGSN Group ID Retrieval Procedure",
      "content": "To retrieve the MMEGI identifying the DCN serving a particular UE usage type, the S-NAPTR procedure shall use the Application-Unique String set to the TAI FQDN as defined in clause 19.4.2.3 of 3GPP TS 23.003 [4] and use the enhanced service parameters as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed. The MME shall discover the MMEGI for a particular UE usage type by using the \"Service Parameters\" of\n\"x-3gpp-mme:x-s10+ue-<ue usage type>\"\nTo retrieve the Null-NRI/SGSN Group ID identifying the DCN serving a particular UE usage type, the S-NAPTR procedure shall use the Application-Unique String set to the RAI FQDN as defined in clause 19.4.2.5 of 3GPP TS 23.003 [4] and use the enhanced service parameters as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed. Gn/Gp SGSN shall discover the Null-NRI/SGSN Group ID for a particular UE usage type by using \"Service Parameters\" of\n\"x-3gpp-sgsn:x-gn+ue-<ue usage type>\"\nS4-SGSN shall discover the Null-NRI/SGSN Group ID for a particular UE usage type by using \"Service Parameters\" of\n\"x-3gpp-sgsn:x-s16+ue-<ue usage type>\"\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies. The MMEGI or Null-NRI/SGSN Group ID shall be provisioned in the host name of these records. The MMEGI or Null-NRI/SGSN Group ID shall be retrieved from the host name.\nThe NAPTR records associated to the TAI FQDN shall be provisioned with a host name in the replacement part, as specified in 4.3.2, having the canonical-node-name start as:\nmmec<MMEC>.mmegi<MMEGI>\nThe NAPTR records associated to the RAI FQDN shall be provisioned with a host name in the replacement part, as specified in 4.3.2, having the canonical-node-name start as:\nnri-sgsn<NRI>.null-nri<Null-NRI>\nThe NAPTR records associated to the RAI FQDN shall be provisioned with a host name in the replacement part, as specified in 4.3.2, having the canonical-node-name start as:\nnri-sgsn<NRI>.sgsngi<SGSN Group ID>\n<Null-NRI>and <SGSN Group ID>shall be Hex coded digits representing the Null-NRI code of the SGSNs and SGSN Group ID respectively (see 3GPP TS 25.413 [12]). If there are less than 4 significant digits in <Null-NRI> and <SGSN Group ID>, one or more \"0\" digit(s) is/are inserted at the left side to fill the 4 digit coding respectively. Coding for other fields is the same as specified in 3GPP TS 23.003 [4].\nNOTE 1:\tAnnex A provides examples of the MMEGI and Null-NRI/SGSN Group ID retrieval procedures.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.2.3",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.5",
        "ts_23.003",
        "ts_25.413"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.8.4",
      "section_id": "5.8.4",
      "section_title": "MME and SGSN Selection Procedure",
      "content": "The S-NAPTR procedure employed to discover and select an MME or SGSN serving a particular UE usage type, during a handover procedure with a MME or SGSN change, shall use the Application-Unique String set to the FQDN specified in the rest of this specification, e.g. with the TAI-FQDN for MME selection or with an RAI or RNC-ID FQDN for SGSN selection, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed.\nFor example, the procedure for an MME to find a candidate set of target MMEs makes use of the \"Service Parameters\" of:\n\"x-3gpp-mme:x-s10+ue-<ue usage type>\"\nand the procedure for an MME to find a candidate set of target SGSNs makes use of the \"Service Parameters\" of:\n\"x-3gpp-sgsn:x-s3+ue-<ue usage type>\"\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies.\nThe S-NAPTR procedure shall logically output a candidate list of MMEs and SGSNs serving at least the requested UE usage type, according to the general principles specified in clause 4.3.3.2.1 and Annex B.3. If no candidate MME or SGSN is found for the requested UE usage type, possibly also after using local configuration, the procedure shall be performed with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name.\nNOTE 1:\tThis is required to discover and select an MME or SGSN when no dedicated MME or SGSN is configured for a particular UE usage type and FQDN.\nAs an exception to the above requirement if no candidate MME or SGSN is found for the requested UE usage type for the selection of an MME or SGSN in the same PLMN, the MME/SGSN may decide not to perform an S-NAPTR procedure with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name if so configured by operator policies and abort the selection procedure.\nNOTE 2:\tThis can avoid selecting an MME or SGSN not intended to support specific UE usage types.\nAnnex A.4 provides examples of DNS provisioning for MME discovery and selection procedures in a DCN.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "clause_4.3.3.2.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.8.5",
      "section_id": "5.8.5",
      "section_title": "AMF Selection Procedure",
      "content": "The S-NAPTR procedure employed to discover and select an AMF serving a particular UE usage type, during a EPS to 5GS handover using N26 interface procedure, shall use the Application-Unique String set to the FQDN specified in the rest of this specification, e.g. with the 5GS TAI-FQDN for AMF selection, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed.\nFor example, the procedure for an MME to find a candidate set of target AMFs with N26 interface makes use of the \"Service Parameters\" of:\n\"x-3gpp-amf:x-n26+ue-<ue usage type>\"\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies.\nThe S-NAPTR procedure shall logically output a candidate list of AMFs serving at least the requested UE usage type, according to the general principles specified in clause 4.3.3.2.1 and Annex B.3. If no candidate AMF is found for the requested UE usage type, possibly also after using local configuration, the procedure shall be performed with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name.\nNOTE 1:\tThis is required to discover and select an AMF when no dedicated AMF is configured for a particular UE usage type and FQDN.\nAs an exception to the above requirement if no candidate AMF is found for the requested UE usage type for the selection of an AMF in the same PLMN, the MME may decide not to perform an S-NAPTR procedure with Service Parameters without the \"+ue-<ue usage type>\" appended to the 'app-protocol' name if so configured by operator policies and abort the selection procedure.\nNOTE 2:\tThis can avoid selecting an AMF not intended to support specific UE usage types.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "clause_4.3.3.2.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.9.1",
      "section_id": "5.9.1",
      "section_title": "DCN based solution",
      "content": "When DCN is supported in the network, the node performing the selection function may use the DNS procedures enhanced for supporting DCNs as specified in clause 5.8, to select an EPC entity, e.g. an SGW or PGW, which supports CIoT by configuring a specific UE Usage Type(s) for CIoT.\nFor a MS requesting a PDN Connection of type \"Non-IP\", the S4-SGSN may use the DNS procedures enhanced for supporting DCNs as specified in clause 5.8, to select an EPC entity, e.g. an SGW or PGW, which supports this PDN Connection of type \"Non-IP\" by configuring a specific UE Usage Type.\nFor a MS requesting a PDP Context of type \"Non-IP\", the Gn/Gp-SGSN may use the DNS procedures enhanced for supporting DCNs as specified in clause 5.8, to select a GGSN which supports this PDP Context of type \"Non-IP\" by configuring a specific UE Usage Type.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.9.2",
      "section_id": "5.9.2",
      "section_title": "Alternative solution",
      "content": "The SGSN shall use the DNS procedures specified in this specification for selecting a GGSN or PGW supporting the Non-IP PDN Type without any change. The GGSNs or PGWs configured in the DNS for an APN which can be used for a Non-IP PDN connection shall all support the Non-IP PDN type.\nThe MME shall use the DNS procedures specified in this specification for selecting a PGW optimised for CIoT without any change. The PGWs configured in the DNS for an APN which can be used for NB-IoT access or for a Non-IP PDN connection shall all support NB-IoT or the Non-IP PDN type respectively.\nThe MME or SGSN shall select an SGW optimised for CIoT, using the DNS procedures for selecting an SGW specified in clauses 5.2 and 5.3, but retaining then one SGW, from the candidate SGWs list, which is also known to support of CIoT. The MME or SGSN knows whether an SGW supports CIoT via the Notification of Supported features over the S11 or S4 interface (for the CIoT feature), as specified in 3GPP TS 29.274 [23].\nA source MME or SGSN shall select a target MME or SGSN, during a handover procedure for a UE supporting some CIoT EPS Optimisations, using the DNS procedures for selecting an MME or SGSN during a handover procedure specified in clause 5.4 or 5.5, but retaining then one target MME or SGSN, from the candidate target MME or SGSN list, which is also known by local configuration to support at least one CIoT EPS optimisation. The selected target MME or SGSN may forward the Forward Relocation Request to another MME or SGSN in the target MME or SGSN pool, as specified in 3GPP TS 29.274 [23].",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.10",
      "section_id": "5.10",
      "section_title": "Procedures for Discovering and Selecting an SGW-U",
      "content": "These procedures shall be employed when an SGW-U needs to be selected by an SGW-C and the SGW-C supports the UP selection function based on DNS specified in Annex B.2.6 of 3GPP TS 29.244 [26].\nOperators shall provision, for each TAI/eNodeB-ID/RAI/RNC-ID value in their network, NAPTR records under the TAI/eNodeB-ID/RAI/RNC-ID FQDN corresponding to each UP function serving as an SGW-U with the following \"Service Parameters\":\n\"x-3gpp-upf:x-sxa\"\nwhere additional \"Service Parameters\" may be included optionally.\nWhen DCN is deployed, operators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies:\n\"x-3gpp-upf:x-sxa+ue-<usage type>\"\nThe SGW-C may select a specific SGW-U for UE supporting a particular network capability (see clause 5.x). Operators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+nc-<network-capability>\" to the 'app-protocol' name as follows:\n\"x-3gpp-upf:x-sxa+nc-<network-capability>\"\nTo discover and select an SGW-U, the SGW-C shall use S-NAPTR procedure with the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxa\"\nand the TAI/eNodeB-ID/RAI/RNC-ID FQDN as the Application-Unique String.See clause 19.4 of 3GPP TS 23.003 [4].\nThe S-NAPTR procedure logically outputs a list of host names each coupled with a service, a protocol, a port, and a list of IPv4 and IPv6 addresses. This is the \"candidate\" list of SGW-Us for a given TAI/eNodeB-ID/RAI/RNC-ID.\nWhen DCN is deployed, the S-NAPTR procedure employed to discover and select an SGW-U shall use the Application-Unique String set to the TAI/eNodeB-ID/RAI/RNC-ID FQDN, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed.\nFor example, the SGW-C shall discover a UP function capable to serve as a SGW-U using the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxa+ue-<ue usage type>\"\nThe S-NAPTR procedure employed to discover and select an SGW-U shall use the Application-Unique String set to the TAI/eNodeB-ID/RAI/RNC-ID FQDN, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+nc-<network-capability>\" to the 'app-protocol' name identifying specific SGW-U supporting a particular network capability.\nFor example, the SGW-C shall discover a UP function capable to serve as a SGW-U using the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxa+nc-<network-capability>\"",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5",
        "ts_23.003_clause_19.4",
        "ts_23.003_clause_19.4.3",
        "ts_29.244",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.11",
      "section_id": "5.11",
      "section_title": "Procedures for Discovering and Selecting PGW-U",
      "content": "These procedures shall be employed when a PGW-U needs to be selected by an PGW-C and the PGW-C supports the UP selection function based on DNS specified in Annex B.2.6 of 3GPP TS 29.244 [26].\nOperators shall provision, for each APNs configured in their network, NAPTR records under the APN FQDN corresponding to each UP function serving as a PGW-U with the following \"Service Parameters\":\n\"x-3gpp-upf:x-sxb\"\nwhere additional \"Service Parameters\" may be included optionally. See clause 19.4.2.2 of 3GPP TS 23.003 [4].\nWhen DCN is deployed, operators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type(s) for which the record applies:\n\"x-3gpp-upf:x-sxb+ue-<usage type>\"\nThe PGW-C may select a specific PGW-U supporting a particular network capability (see clause 5.x). Operators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+nc-<network-capability>\" to the 'app-protocol' name, the following record applies:\n\"x-3gpp-upf:x-sxb+nc-<network-capability>\"\nTo discover and select a PGW-U, the PGW-C shall use S-NAPTR procedure with the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxb\"\nand the APN FQDN as the Application-Unique String.\nThe S-NAPTR procedure logically outputs a list of host names each coupled with a service, a protocol, a port, and a list of IPv4 and IPv6 addresses. This is the \"candidate\" list of PGW-Us for a given APN.\nWhen DCN is deployed, the S-NAPTR procedure employed to discover and select an PGW-U shall use the Application-Unique String set to the APN FQDN, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+ue-<ue usage type>\" to the 'app-protocol\" name identifying the UE usage type for which the discovery and selection procedure is performed.\nFor example, the PGW-C shall discover a UP function capable to serve as a PGW-U using the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxb+ue-<ue usage type>\".\nThe S-NAPTR procedure employed to discover and select an PGW-U shall use the Application-Unique String set to the APN FQDN, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+nc-<network-capability>\" to the 'app-protocol' name identifying specific PGW-U supporting a particular network capability.\nFor example, the PGW-C shall discover a UP function capable to serve as a PGW-U using the \"Service Parameters\" of:\n\"x-3gpp-upf:x-sxb+nc-<network-capability>\".",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_19.4.2.2",
        "clause_5",
        "ts_23.003_clause_19.4.3",
        "ts_29.244",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.1.1",
      "section_id": "5.12.1.1",
      "section_title": "General",
      "content": "Operators may need to discover and select a network node supporting a particular network capability.\nDNS procedures to select a node supporting a particular network capability shall be supported as specified in the rest of the specification, with the additions specified in clause 5.12. The following clauses also further define the specific network capabilities for which these procedures may be used.\nEnhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4] may be used to select a network node with a particular network capability, by appending the character string \"+nc-<network capability>\" to the 'app-protocol' name.\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+nc-<network capability>\" to the 'app-protocol' name identifying the network capability(s) for which the record applies.\nThe S-NAPTR procedure shall logically output a candidate list of network nodes supporting at least the requested network capability, according to the general principles specified in clause 4.3.3.2.1, Annex B.4. If no candidate network nodes are found for the requested network capability, possibly also after using local configuration, the procedure shall be performed with Service Parameters without the \"+nc-<network capability>\" appended to the 'app-protocol' name.\nNOTE 1:\tThis is required to discover and select a network node when no dedicated network node is configured for a particular network capability.\nAs an exception to the above requirement if no network node is found for the requested network capability for the selection of a network node in the same PLMN, e.g. the SGW and PGW in the same PLMN, the node performing the node selection may decide to not perform an S-NAPTR procedure with Service Parameters listed in the above requirement, if so configured by operator policies, and abort the selection procedure.\nNOTE 2:\tThis can avoid selecting a network node not supporting a particular network capability.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.12",
        "ts_23.003_clause_19.4.3",
        "clause_4.3.3.2.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.1.2",
      "section_id": "5.12.1.2",
      "section_title": "Selecting a node supporting a particular network capability within a Dedidated Core Network",
      "content": "When using Dedicated Core Networks, the selection of a node supporting a particular network capability may solely rely on the procedures specified for DCNs in clause 5.8, or combine the procedures specified in clauses 5.12 and 5.8 by using Enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4] to select a network node with a particular network capability within a particular DCN, by appending the character string \"+nc-<network capability>\" and \"+ue-<ue-usage-type> to the 'app-protocol' name  and provisioning NAPTR records accordingly.\nFor example, the MME or S4-SGSN shall discover all GTP based S5/S8 interfaces using \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp+nc-<network capability>+ue-<ue-usage-type>\", \"x-3gpp-pgw:x-s8-gtp+nc-<network capability>+ ue-<ue-usage-type>\"\nor\n\"x-3gpp-pgw:x-s5-gtp+ue-<ue-usage-type>+nc-<network capability>\", \"x-3gpp-pgw:x-s8-gtp+ ue-<ue-usage-type>+nc-<network capability>\"\nNOTE:\tAn 'app-protocol' name appears at most once in a NAPTR record. For instance, \"x-3gpp-pgw:x-s5-gtp+nc-<network capability>: x-s5-gtp+ue-<ue usage type>\" is not a valid NAPTR record.\nIf no candidate network nodes are found for the requested network capability and UE usage type, possibly also after using local configuration, the procedure shall be performed with Service Parameters:\n-\twithout the \"+nc-<network capability>\" appended to the 'app-protocol' name;\n-\twithout the \"+ue-<ue-usage-type>\" appended to the 'app-protocol' name;\n-\twithout the \"+nc-<network capability>\" nor the \"+ue-<ue-usage-type>\" appended to the 'app-protocol' name.\nAs an exception to the above requirement if no network node is found for the requested network capability and UE usage type for the selection of a network node in the same PLMN, e.g. the SGW and PGW in the same PLMN, the node performing the node selection may decide to not perform an S-NAPTR procedure with Service Parameters listed in the above requirement, if so configured by operator policies, and abort the selection procedure.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8",
        "ts_23.003_clause_19.4.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.1.3",
      "section_id": "5.12.1.3",
      "section_title": "Selecting an SGW or PGW supporting a particular network capability",
      "content": "The S-NAPTR procedure employed to discover and select an SGW and PGW supporting a particular network capability shall use the Application-Unique String set to the FQDN specified in the rest of this specification, e.g. with the APN-FQDN for PGW selection or with the TAI/eNodeB-ID/RAI/RNC-ID FQDN for SGW selection, and use the enhanced \"Service Parameters\" as specified in clause 19.4.3 of 3GPP TS 23.003 [4], i.e. appending the character string \"+nc-<network capability>\" to the 'app-protocol' name.\nFor example, the MME or S4-SGSN shall discover all GTP based S5/S8 interfaces using \"Service Parameters\" of\n\"x-3gpp-pgw:x-s5-gtp+nc-<network capability>\", \"x-3gpp-pgw:x-s8-gtp+nc-<network capability>\"\nOperators shall provision corresponding NAPTR records for these FQDNs, with enhanced \"Service Parameters\" appending the character string \"+nc-<network capability>\" to the 'app-protocol' name.\nThe S-NAPTR procedure shall logically output a candidate list of SGWs or PGWs supporting the requested network capability. If no candidate SGW and PGW is found, possibly also after using local configuration, the procedure shall be performed with Service Parameters without the \"+nc-<network capability>\" appended to the 'app-protocol' name.\nNOTE 1:\tThis is required to discover and select an SGW or PGW when no dedicated SGW or PGW is configured to support the requested network capability.\nAs an exception to the above requirement if no candidate SGW or PGW is found to support the requested network capability for the selection of an SGW or PGW in the same PLMN, the MME or S4-SGSN may decide not to perform an S-NAPTR procedure with Service Parameters without the \"+nc-<network capability>\" appended to the 'app-protocol' name if so configured by operator policies and abort the selection procedure.\nNOTE 2:\tThis can avoid selecting an SGW or PGW not supporting the requested network capability.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_19.4.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.2.1",
      "section_id": "5.12.2.1",
      "section_title": "General",
      "content": "An MME or SGSN may select specific SGWs and PGWs for UEs supporting dual connectivity with NR and not restricted to use NR by user subscription (see \"NR as Secondary RAT Not Allowed\" bit within Access Restriction Data as specified in TS 29.272 [27]) or local operator policy, e.g. due to requirements of higher bitrates, data usage reporting over the secondary RAT, etc. A UE signals its support for dual connectivity with NR to the MME and SGSN in NAS signalling. The specific SGWs and PGWs may be combined SGW/PGW functions.\nDNS procedures to support Dual Connectivity with NR shall be supported as specified in clause 5.12.1, with the following additions:\n-\tthe <network-capability> shall be set to \"nr\".\nFor example, the MME or S4-SGSN shall discover all GTP based S5/S8 interfaces using \"Service Parameters\" of \"x-3gpp-pgw:x-s5-gtp+nc-nr\", \"x-3gpp-pgw:x-s8-gtp+nc-nr\"\n-\tthis network capability may apply to:\n-\tthe 'app-service' names \"x-3gpp-sgw\", \"x-3gpp-pgw\";\n-\tthe 'app-protocol' names: \"x-s5-gtp\", \"x-s8-gtp\", \"x-s11\".",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.12.1",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.3.1",
      "section_id": "5.12.3.1",
      "section_title": "General",
      "content": "5GS interworking procedures with EPC rely on selecting a combined PGW-C/SMF and PGW-U/UPF during the PDN connection establishment (see clause 4.11 of 3GPP TS 23.501 [28]).",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.501_clause_4.11",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.3.2",
      "section_id": "5.12.3.2",
      "section_title": "PGW-C/SMF selection",
      "content": "An MME and an ePDG shall select a combined PGW-C/SMF for PDN connections that may be subject to mobility to 5GS, e.g. for UEs supporting N1 mode and not restricted to interworking with 5GS by user subscription (i.e. \"5GC not allowed\" bit within Core-Network-Restrictions AVP is not set and Interworking-5GS-Indicator AVP is set to \"SUBSCRIBED\" value as specified in 3GPP TS 29.272 [27] and 3GPP TS 29.273 [30]). A UE signals its support for 5GC NAS to the MME in NAS signalling and to the ePDG in IKEv2 signalling.\nAn MME and an ePDG should also select a combined PGW-C/SMF, if possible, for PDN connections of UEs not supporting N1 mode that are not restricted to access the 5GC by user subscription (i.e. \"5GC not allowed\" bit within Core-Network-Restrictions AVP is not set and Interworking-5GS-Indicator AVP is set to \"SUBSCRIBED\" value as specified in 3GPP TS 29.272 [27] and 3GPP TS 29.273 [30]).\nA PDN connection of a subscription restricted from accessing the 5GC or without 5GS interworking subscribed for the APN is not subject to mobility to 5GS and may be connected to a PGW, a PGW-C or a combined PGW-C/SMF; when PGW-C (or PGW) and combined PGW-C/SMF are available for election, the preference order may be based on operator's policy in the MME or ePDG.\nDNS procedures to select a combined PGW-C/SMF shall be supported as specified in clause 5.12.1, with the following additions:\n-\tthe <network-capability> shall be set to \"smf\".\nFor example, the MME shall discover all GTP based S5/S8 interfaces using \"Service Parameters\" of \"x-3gpp-pgw:x-s5-gtp+nc-smf\", \"x-3gpp-pgw:x-s8-gtp+nc-smf\" and the ePDG shall discover all GTP based S2b interfaces using \"Service Parameters\" of \"x-3gpp-pgw:x-s2b-gtp+nc-smf\".\n-\tthis network capability may apply to:\n-\tthe 'app-service' name \"x-3gpp-pgw\";\n-\tthe 'app-protocol' names: \"x-s5-gtp\", \"x-s8-gtp\", \"x-s2b-gtp\".",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.12.1",
        "ts_29.272",
        "ts_29.273"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.3.3",
      "section_id": "5.12.3.3",
      "section_title": "PGW-U/UPF selection",
      "content": "A PGW-C/SMF shall select a combined PGW-U/UPF for PDN connections that may be subject to mobility to 5GS and for PDN connections not subject to mobility to 5GS but that access the 5GC.\nIf the PGW-C/SMF supports the UP function selection based on DNS procedures specified in Annex B.2.6 of 3GPP TS 29.244 [26], DNS procedures to select a combined PGW-U/UPF shall be supported as specified in clause 5.11 (for discovering and selecting a PGW-U), with the following additions:\n-\tthe app-service of x-3gpp-upf with app-protocol \"x-n4\" identifies a User Plane function supporting N4 capabilities;\n-\tthe app-service of x-3gpp-upf with app-protocols \"x-sxb:x-n4\" identifies a PGW-U supporting N4 capabilities (i.e. a combined PGW-U/UPF).",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.11",
        "ts_29.244"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.12.3.4",
      "section_id": "5.12.3.4",
      "section_title": "PGW-U/UPF/MB-UPF selection",
      "content": "A PGW-C/SMF/MB-SMF may select a combined PGW-U/UPF/MB-UPF for PDN connections that may be subject to mobility to 5GS and to be associated with MBS session.\nIf the PGW-C/SMF/MB-SMF supports the UP function selection using DNS procedures, DNS procedures to select a combined PGW-U/UPF/MB-UPF shall be supported as specified in clause 5.12.3.3 (for discovering and selecting a PGW-U/UPF), with the following additions:\n-\tthe app-service of x-3gpp-upf with app-protocol \"x-n4mb\" identifies a User Plane function supporting N4mb capabilities;\n-\tthe app-service of x-3gpp-upf with app-protocols \"x-sxb:x-n4:x-n4mb\" identifies a PGW-U/UPF supporting N4mb capabilities (i.e. a combined PGW-U/UPF/MB-UPF).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.12.3.3"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.13.1",
      "section_id": "5.13.1",
      "section_title": "DCN based solution",
      "content": "When DCN is supported in the network, the MME may use the DNS procedures enhanced for supporting DCNs as specified in clause 5.8, to select an EPC entity, e.g. an SGW or a combined PGW-C/SMF, which supports Ethernet PDN connection by configuring to support a specific UE Usage Type(s).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.13.2",
      "section_id": "5.13.2",
      "section_title": "Network Capability based solution",
      "content": "An MME may use the DNS procedure as specified in clause 5.12.1, to select an EPC entity, e.g. an SGW or a combined PGW-C/SMF which supports Ethernet PDN connection, with the following additions:\n-\tthe <network-capability> shall be set to \"eth\" for an SGW selection and shall be set to \"smf.eth\" for a combined PGW-C/PGW-U selection. (See also clause 5.12.3 and Annex B.4)\nFor example, the MME shall discover all GTP based S5/S8 interfaces using \"Service Parameters\" of \"x-3gpp-pgw:x-s5-gtp+nc-smf.eth\", \"x-3gpp-pgw:x-s8-gtp+nc-smf.eth\"\n-\tthis network capability may apply to:\n-\tthe 'app-service' names \"x-3gpp-sgw\", \"x-3gpp-pgw\";\n-\tthe 'app-protocol' names: \"x-s5-gtp\", \"x-s8-gtp\", \"x-s11\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.12.1",
        "clause_5.12.3"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.13.3",
      "section_id": "5.13.3",
      "section_title": "Alternative solutions",
      "content": "The MME may use the DNS procedures specified in this specification for selecting a combined PGW-C/SMF supporting Ethernet PDN connection without any change if all combined PGW-C/SMFs configured in the DNS for an APN support Ethernet PDN connection.\nThe MME may know whether an SGW supports Ethernet PDN connection via the Notification of Supported features over the S11 interface (for the ETH feature), as specified in 3GPP TS 29.274 [23].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.303_5.14",
      "section_id": "5.14",
      "section_title": "Procedures for Discovering and Selecting a UCMF",
      "content": "These procedures shall be employed when a UCMF needs to be discovered and selected by MME.\nOperators shall provision NAPTR records under UCMF FQDN corresponding to valid UCMF interfaces from the following \"Service Parameters\":\n-\t\"x-3gpp-ucmf:x-urcmp\", \"x-3gpp-ucmf:x-n55\"\nWhere additional \"Service Parameters\" may be included optionally.\nMMEs are expected to select a UCMF based on MME's capability to support URCMP or N55 based signalling. If multiple UCMFs are deployed, implementation specific algorithms should be used to distribute load among available UCMFs.\n3GPP does not require that collocation and \"topon\" naming is applicable in UCMF selection.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.303_6.1.1",
      "section_id": "6.1.1",
      "section_title": "General",
      "content": "These procedures may be employed when a relay node (see 3GPP TS 36.300 [22], clause 4.7) needs to discover its Operations and Maintainence (OAM) system. The relay nodes employ the procedures below during the startup procedure in order to discover the OAM system, from which it obtains its configuration and updated software.\nThe OAM system is selected based on the operator identitity and the type allocation code identifying the relay node vendor, and optionally the tracking area code (see 3GPP TS 23.003 [4]). This enables vendor-specific OAM systems for relay nodes.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_36.300_clause_4.7",
        "ts_36.300",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_6.1.2",
      "section_id": "6.1.2",
      "section_title": "OAM System Selection based on Type Allocation Code",
      "content": "In both UTRAN and E-UTRAN cases the operator identity in terms of MNC and MCC is available from the information in IMSI (see 3GPP TS 23.003 [4], clause 2.2). The type allocation code (IMEI-TAC) identifying the relay node vendor is available from IMEI or IMEISV (see 3GPP TS 23.003 [4], clause 6.2).\n1)\tIn relay node startup procedure, the relay node may use the vendor-specific relay node OAM system FQDN as it is defined in 3GPP TS 23.003 [4], clause 23.3.2.2, to discover its OAM system. Operator provisions A/AAAA record under 3GPP vendor-specific relay node OAM system FQDN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_2.2",
        "ts_23.003_clause_6.2",
        "ts_23.003_clause_23.3.2.2",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.303_7.1",
      "section_id": "7.1",
      "section_title": "General",
      "content": "The discovery of NFs in the 5G System is supported by the NRF (see 3GPP TS 23.501 [28] and 3GPP TS 23.502 [29]), except for the following scenarios for which DNS procedures are defined:\n-\tAMF discovery and selection by MME, for EPS interworking with the 5G System using the N26 interface (see clauses 4.3.3.4, 4.3.3.8, 5.4 and 5.4A); and\n-\tAMF discovery by 5G-AN (see clause 7.2).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_7.2",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_29.303_7.2",
      "section_id": "7.2",
      "section_title": "Procedure for AMF Discovery by 5G-AN",
      "content": "The 5G-AN selects an AMF Set and an AMF from the AMF set as specified in clause 6.3.5 of 3GPP TS 23.501 [28].\nNOTE 1:\tThe 5G-AN (NG-RAN and N3IWF) is responsible for initiating the SCTP connectivity and setting up the NG-C association with the AMF. This requires the 5G-AN to first obtain the AMF's IP address(es).\nIn the 5G System, AMFs may be added or removed dynamically for scalability or planned maintenance. The DNS procedure specified in this clause may be used by the 5G-AN to discover the AMFs available in an AMF Set.\nNOTE 2:\tThe 5G-AN might obtain the information about the available AMFs via alternative means, e.g. OAM.\nThe AMFs available within an AMF Set should be provisioned within NAPTR records in the DNS, under the AMF Set FQDN (as defined in clause 28.3.2.7 of 3GPP TS 23.003 [4]), with the Service Parameters \"x-3gpp-amf:x-n2\".\nThe 5G-AN may discover the AMFs available within an AMF Set by:\n-\tconstructing the AMF Set FQDN, as defined in clause 28.3.2.7 of 3GPP TS 23.003 [4], identifying the AMF Set of the AMFs to be discovered; and\n-\tinitiating an S-NAPTR procedure, with the Application-Unique String set to that AMF Set FQDN, and with the \"Service Parameters\" set to \"x-3gpp-amf:x-n2\".\nThe S-NAPTR procedure outputs a list of host names (AMFs) each with a service, protocol, port and a list of IPv4 and IPv6 addresses. See further details and examples in Annexes B, C and F.\nAnnex A (Informative):Examples\nA.1\tIntroduction\nThis annex includes examples of the DNS provisioning needed for EPC node discovery and selection procedures. Examples are not exhaustive either in scope or in content but are intended to be sufficient to illustrate the general techniques and some of the more important use cases.\nA.2\tPreconditions\nThe following are general comments applying to all examples provided here.\na)\tDNS master file format follows IETF RFC 1035 [3] clause 5. The reader is reminded that in that format the character \":\" is used for comments, \"$\" is used for directives, and enclosing parenthesis (  ) combine lines.\nb)\tExamples are built from smaller files and merged with the $INCLUDE directive. This is to allow each file to be documented in a separate clause and to allow reuse of files in some of the examples.\nc)\tOnly one operator's network is used in all examples using MCC=311 (United States) and MNC=990 (currently an unassigned MNC value). All DNS records presented here are within the zone cut epc.mnc990.mcc311.3gppnetwork.org.\nd)\tSince the fully qualified domain names here are relatively long to avoid line wrapping and to save space in the examples we use the standard $ORIGIN directive \t$ORIGIN epc.mnc990.mcc311.3gppnetwork.org. Hence any domain names in the file that are not fully qualified (i.e. does not end with a period) would have epc.mnc990.mcc311.3gppnetwork.org. appended to them to form the fully qualified value. In the descriptive text in this Annex we use the same convention.\ne)\tWhen a printout is provided, it is from an actual printout of the \"dig\" command (from the BIND distribution) but with all values of the string .epc.mnc990.mcc311.3gppnetwork.org. replaced with .$ORIGIN in order to keep the output on one line when possible. Note the \"+tcp\" option is used in the \"dig\" command to avoid truncating large DNS responses in the examples.\nf)\tFiles provided here have been tested with a recent version of BIND and are presented here unmodified. In the examples the BIND server was set as authoritative only with default settings to make the configuration self contained. In a real network a recursive server is likely to be used as an intermediary and/or multiple authoritative servers.\ng)\tThe time to live (TTL) in the examples are all set to 1 hour = 3600 seconds by using the $TTL directive from IETF RFC 2308 [15].\nh)\tIPv4 addresses in the examples are from the IPv4 example documentation address space of 192.0.2.0/24 of IETF RFC 3330 [16] and IPv6 addresses are from the IPv6 documentation address space of IETF RFC 3849 [17] . These are by no means representative and are used solely for example purposes.\ni)\tSince A/AAAA records are well known we only provide A/AAAA records for the simpler examples and do not document every A and AAAA lookup in detail.\nA.3\tCollocated Simple LTE Example\nA.3.1\tNetwork description\nThis is a fairly complete example of an operator network with the following properties.\n1)\tNetwork only has LTE access with only interworking with LTE access. There is no support for Gn/Gp and no support for S3/S4.\n2)\tNetwork does not support PMIPv6 for S5 but does allow very limited roaming use of S8 PMIPv6. This is a policy that is extremely unlikely to be used by a real operator and is used only for illustrative purposes.\n3)\tThere are two combined PGW/SGW nodes and two standalone MME nodes.\n4)\tAny load balancing between nodes of the same functional type is on a strict bias. Hence, SRV records are not needed.\n5)\tOperator desires the flattest DNS structure possible due to desire to minimize the number of DNS queries. The use of NATPR with flag \"\" is therefore not used by operator policy. This is feasable since the network is small.\n6)\tDue to 4) and 5) only NAPTR records with flag \"a\" are used by the operator in this example.\n7)\tOne MME pool area.\n8)\tOne SGW service area.\n9)\tOperator desires that S1-U link cost is minimized (i.e. SGW closest to eNodeB is used)\n10)\tOperator does not care about distance or transport costs between SGW and PGW beyond the collocation for S5. Hence it does not use \"topon\" naming.\n11)\tSmall number of APNs\nOther than item 2) this set of conditions might fit a green field operator or government agency deploying LTE for use on laptop computers or high end hand held devices for internet access. This represents one of the simpler networks possible while still being non-trivial.\nVery large networks would tend to use MME pool areas and SGW service areas and NAPTR empty flag records. How complex the structure in DNS is employed between the initial NAPTR entry point and the final A/AAAA record set(s) is solely the operator's choice so long as the S-NAPTR requirements are met.\nAdditional comments on this example are in each clause as needed. Also commented out DNS records are often included in the sample files to illustrate how additional interface types would be added.\nA.3.2\tMaster file for \"Collocated Simple LTE Example\"\nThe master file for this example will be CS_EX.txt and has following content.\n$ORIGIN epc.mnc990.mcc311.3gppnetwork.org.\n;\n$TTL\t3600 ;  1 hour  - this directive is defined in IETF RFC 2308 not RFC 1035\n;\n$INCLUDE SOA_DB.txt\n;\n$INCLUDE CS_MME_DB.txt\n;\n$INCLUDE CS_SGW_PGW_NODE_DB.txt\n;\n$INCLUDE CS_TAI_DB.txt\n;\n$INCLUDE CS_APN_DB.txt\n;\n; End of file\nThe included files are detailed in following clauses.\nA.3.3\tSOA and NS records\nThe SOA and NS records need to exist for any DNS zone. Our example will use the following file with name SOA_DB.txt whose content is:\n;  SOA and NS glue records\n;  Note @, ns1, ns2 are relative to $ORIGIN\n;\n@  1D  IN      SOA @ administrator.example.com. (\n2008122401 ; serial\n1H ; refresh\n15 ; retry\n1w ; expire\n1h ; minimum - note this parameter\n; is used for negative caching\n; see RFC 2308 chapter 4\n)\nIN  NS     ns1\nIN  NS     ns2\n;\n; Glue records for the two DNS servers\nns1   IN  A      192.0.2.247\nns2   IN  A      192.0.2.248\n; End of file\nA.3.4\tMME file for \"Collocated Simple LTE Example\"\nThe MME S10 record lookup by GUTI is probably the simplest example of the NAPTR records and is the simplest introduction to the S-NAPTR procedure as well.\nA NAPTR record is required to be provisioned at mmec<MMEC>.mmegi<MMEGI>.mme (see clause 4.3.3.4 of this TS). This is used for GUTI based lookup of the old or source MME. Specifically, the target MME takes the UE's old GUTI value and derives the old MME's DNS name. The goal of the target MME is usually to be able to do a context transfer of the old MME's data (or similar action). MME to MME communication is done over S10. Hence, S10 is critical for the GUTI record in an LTE only network.\nThe mmec<MMEC>.mmegi<MMEGI>.mme is also the natural place for the MME canonical node record set. For this example we place the MME canonical node records and the required record for GUTI based lookup at the same location both for simplicity and better DNS caching.\nFor this example we have two MMEs with MMEC codes of 1 and 2 respectively and both in the same MME pool (MMEGI = 8000 hexadecimal).\nThe file containing the MME records for this example will be CS_MME_DB.txt and has following NAPTR record content.\n;\n; This is the GUTI related record and the MME node record\n; The operator has decided to use the 3GPP name as the canononical node name of the MME\n; rather than having two records (the 3GPP one and an operator defined value)\n;\nmmec01.mmegi8001.mme                      (\n;    IN NAPTR order pref. flag service                    regexp  replacement\nIN NAPTR 100   999   \"a\"   \"x-3gpp-mme:x-s10\"            \"\"  topoff.eth1.mmec01.mmegi8001.mme )\nIN NAPTR 200   999   \"a\"   \"x-3gpp-mme:x-s11\"            \"\"  topoff.eth3.mmec01.mmegi8001.mme\n;    IN NAPTR 300   999   \"a\"   \"x-3gpp-mme:x-s3\"             \"\"  topoff.eth5.mmec01.mmegi8001.mme\n;    IN NAPTR 400   999   \"a\"   \"x-3gpp-mme:x-gn\"             \"\"  topoff.eth6.mmec01.mmegi8001.mme\n;    IN NAPTR 500   999   \"a\"   \"x-3gpp-mme:x-s1-mme\"         \"\"  topoff.eth7.mmec01.mmegi8001.mme\n;  This particular operator only supports LTE access in their accesses etc.\n;  So the S3 record is commented out above. If the operator wants the MME to be used with S3/S4\n;  SGSN nodes then the record would have to be included.\n;  The Gn/Gp interface is commented out for same reason. This operator does not support it.\n;  If the operator wants the MME to be used for Gn/Gp SGSN interworking\n;  then the record would have to be included.\n;\n;   Reminder: Canonical node name records must be complete.\n;   However, \"x-3gpp-mme:x-s1-mme\" is an exception.\n;   While S1-MME interface must be physically present and used in a MME\n;   it is explicitly optional for an operator to provision in this release of 3GPP\n;.  So it too is commented out\n; NAPTR order plays no major role in this particular example since the MME node is already\n; selected in GUTI case and as a canonical node name. In most cases the interface type\n;(S10 vs S11 etc) is functionally determined so the NAPTR order is rarely used in this record set\n; If the S3 and Gn records were not commented out the S10 is preferred over S3 over Gn\n; I.e. a combined MME/SGSN  could communicate to the MME above using any of the three protocols\n; at context transfer.\n; So the operator is stating that S10 is preferred over S3 over Gn\n;\n; Of course if the MME had multiple S10 interfaces\n; the operator could provision more than one S10 record with different orders\n; perhaps to select S10 IPv6 over S10 IPv4\n; We have the same type of records for the other MME (same comments would apply)\n;\nmmec02.mmegi8001.mme                      (\n;    IN NAPTR order pref. flag service                    regexp  replacement\nIN NAPTR 100   999   \"a\"   \"x-3gpp-mme:x-s10\"            \"\"  topoff.eth1.mmec02.mmegi8001.mme )\nIN NAPTR 200   999   \"a\"   \"x-3gpp-mme:x-s11\"            \"\"  topoff.eth3.mmec02.mmegi8001.mme\n;    IN NAPTR 300   999   \"a\"   \"x-3gpp-mme:x-s3\"             \"\"  topoff.eth5.mmec02.mmegi8001.mme\n;    IN NAPTR 400   999   \"a\"   \"x-3gpp-mme:x-gn\"             \"\"  topoff.eth6.mmec02.mmegi8001.mme\n;    IN NAPTR 500   999   \"a\"   \"x-3gpp-mme:x-s1-mme\"         \"\"  topoff.eth7.mmec02.mmegi8001.mme\n;\n;\n; All MME IP addresses for both MME\n;\ntopoff.eth1.mmec01.mmegi8001.mme IN A 192.0.2.11\nIN A 192.0.2.12\nIN AAAA 2001:db8:0:0:0:0:0:0\nIN AAAA 2001:db8:0:1:0:0:0:0\ntopoff.eth3.mmec01.mmegi8001.mme IN A 192.0.2.13\nIN A 192.0.2.14\nIN AAAA 2001:db8:0:2:0:0:0:0\nIN AAAA 2001:db8:0:3:0:0:0:0\ntopoff.eth1.mmec02.mmegi8001.mme IN A 192.0.2.17\nIN A 192.0.2.18\nIN AAAA 2001:db8:0:6:0:0:0:0\nIN AAAA 2001:db8:0:7:0:0:0:0\ntopoff.eth3.mmec02.mmegi8001.mme IN A 192.0.2.19\nIN A 192.0.2.110\nIN AAAA 2001:db8:0:8:0:0:0:0\nIN AAAA 2001:db8:0:9:0:0:0:0\n; end of file\nThe partially qualified MME host names are topoff.eth1.mmec01.mmegi8001., topoff.eth3.mmec02.mmegi8001.mme and similar. The (partially qualified) canonical node names are mmec01.mmegi8001.mme and mmec02.mmegi8001.mme (obtained by stripping off the first two labels of the host names).\nThe fully qualified MME node names are the relatively long\nmmec01.mmegi8001.mme.epc.mnc990.mcc311.3gppnetwork.org.\nand\nmmec02.mmegi8001.mme.epc.mnc990.mcc311.3gppnetwork.org.\nwhich are obtained by appending the value of $ORIGIN to the partially qualified MME node names. As stated before we will use the partially qualified names in this Annex to avoid this visual clutter and for typographical reasons.\nNote that hostnames such as topoff.eth1.mmec01.mmegi8001.mme intentionally give back the node name mmec01.mmegi8001.mme so this record set is both for GUTI lookup and MME canonical node name lookup (and it is self consistent).\nFor the purposes of GUTI lookup the S10 record is sufficient for LTE only access and LTE only interworking. As stated in the comments above, S3 would be added for S4-SGSN support and the Gn/Gp records for Gn/Gp SGSN support.\nFor the purposes of being a canonical node record the S10 and S11 MME records are included (and they are mandatory to provision in the canonical node record of the MME).\nNOTE 1:\tThe rule for canonical node records is to always include all services that are allowed to be used on a node and are defined in 3GPP TS 23.003 [4] clause 19.4.3 for that node. Node records are meant to be complete. We have an exception here since x-3gpp-mme:x-s1-mme is explicitly optional in this release of 3GPP.\nA.3.5\tAPN file for \"Collocated Simple LTE Example\"\nReminder, the format of the APN FQDN is standardized by 3GPP TS 23.003 [4] clause 19.4.2.2 and is of form <APN-NI>.apn.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org\nService names are in 3GPP TS 23.003 [4] clause 19.4.3\nThere are two APN-NI in this network \"imsTV1\", and \"imsTV2\".\nThe file containing the APN records for this example will be CS_APN_DB.txt and has following content.\n;\n;\nimsTV1.apn                                   (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw01.nodes )\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw21.nodes\n;  IN NAPTR 300   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw01.nodes\n;  IN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw21.nodes\nIN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw01.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw21.nodes\nIN NAPTR 700   999   \"\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"          \"\" set12.pgwset\n;  The MME can derive the NAPTR DNS record for a PGW Set based on the second label pgwset.\n;  Operator has imsTV1.apn using gw01.nodes when possible. Possibly one IMS core and video server\n;  are closer to gw01.nodes than gw21.nodes\n;\n;  Operator only allows PMIPv6 for roaming type scenarios and only as a last choice\n;  The operator does not support Gn/Gp so those records are commented out\nimsTV2.apn                                   (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw01.nodes )\nIN NAPTR 100   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw21.nodes\n;  IN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw01.nodes\n;  IN NAPTR 300   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw21.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw01.nodes\nIN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw21.nodes\n;\n;  This is almost the same as imsTV1.\n;  However, NAPTR order values for a particular interface type are reverse in comparision\n;  to imsTV1.apn\n;\n;  Operator has imsTV2.apn using gw21.nodes when possible.\n; Obviously more APN would exist for a real operator\n;\n; end of file\nIf collocation were not a consideration then the APN-NI \"imsTV1\" causes topoff.vip1.gw01.nodes to be selected and the APN-NI \"imsTV2\" causes topoff.vip1.gw21.nodes to be selected. This is because in the corresponding record set the order 100 record is taken before the order 200 record in the S-NAPTR. In case of failure of a PGW then the other PGW can be used (the record with order 200). If there is deliberate bias to a specific PGW is solely the concern of this operator, the S-NAPTR procedure simply honors this.\nHowever, collocation is a consideration (topological checks are not relevant here since all records use topoff).\nThe (partially qualified) PGW node names are gw01.nodes and gw21.nodes (obtained by stripping off the first two labels of the partially qualified host names topoff.vip1.gw01.nodes, topoff.vip1.gw21.nodes and so on).\nA.3.6\tPGW/SGW node file for \"Collocated Simple LTE Example\"\nThe file containing the PGW/SGW canonical node name records (and A/AAAA records for the PGW/SGW nodes) for this example will be CS_SGW_PGW_NODE_DB.txt and has following content.\n; Node records for the combined PGW/SGW\ngw01.nodes                            (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw01.nodes )\nIN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw01.nodes\n;  IN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw01.nodes\n;  Above record is commented out since this operator does not support Release 8 Gn/Gp functions\n;  Would have to be included otherwise\n;\n; Above are PGW records.\n; Note this operator does NOT support PMIP for S5\n; Following are SGW records\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s11\"                     \"\" topoff.eth1.gw01.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.eth4.gw01.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"                 \"\" topoff.eth9.gw01.nodes\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s4\"                      \"\" topoff.eth6.gw01.nodes\n;  IN NAPTR 710   999   \"a\" \"x-3gpp-sgw:x-s12\"                     \"\" topoff.eth6.gw01.nodes\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-gn:x-gp\"                 \"\" topoff.eth8.gw01.nodes\n;  Above records are commented out since this operator does not support any SGSN variant\n;  or UTRAN support. The operator is pure LTE in this example\n;  Above records would be included if the SGWs were able to be used with the corresponding\n;  SGSN function (or direct tunnel function)\n;\n;  Reminder: Canonical node records must be complete.\n;\n;   Exception, \"x-3gpp-sgw:x-s1-u\" records could be listed but are purely optional for an operator to provision\n;    in this release of 3GPP.\n; NAPTR order plays no real role in this particular example (except for S8)\n; Reasons for this example are:\n; This is the PGW/SGW canonical node record so there is no node selection based from the record\n; The interface type is functionally determined in most use cases using this record set except S5/S8\n; This operator does NOT support PMIP for S5 and there is only one S5-GTP record.\n; So order is not important except for S8.\n; For S8 the operator does places PMIP with highest order just to be sure that GTP based S8 will be\n; used first when possible even at re-selection of an S8 interface on the SGW or PGW as per this\n; particular operators policy\n; This is of course subject to the roaming agreements this operator has.\n; Same record for the other combined PGW/SGW\ngw21.nodes                            (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw21.nodes )\nIN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw21.nodes\n;  IN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw21.nodes\n; Above are PGW records.\n; Following are SGW records\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s11\"                     \"\" topoff.eth1.gw21.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.eth4.gw21.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"                 \"\" topoff.eth9.gw21.nodes\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s4\"                      \"\" topoff.eth6.gw21.nodes\n;  IN NAPTR 710   999   \"a\" \"x-3gpp-sgw:x-s12\"                     \"\" topoff.eth6.gw21.nodes\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-gn:x-gp\"                 \"\" topoff.eth8.gw21.nodes\n; A/AAAA records\n;\n; IP addresses for gw01\n;\ntopoff.vip1.gw01.nodes IN A 192.0.2.113\nIN A 192.0.2.114\nIN AAAA 2001:db8:0:c:0:0:0:0\nIN AAAA 2001:db8:0:d:0:0:0:0\ntopoff.vip2.gw01.nodes IN A 192.0.2.143\nIN A 192.0.2.144\nIN AAAA 2001:db8:0:2a:0:0:0:0\nIN AAAA 2001:db8:0:2b:0:0:0:0\ntopoff.eth1.gw01.nodes IN A 192.0.2.129\nIN A 192.0.2.130\nIN AAAA 2001:db8:0:1c:0:0:0:0\nIN AAAA 2001:db8:0:1d:0:0:0:0\ntopoff.eth4.gw01.nodes IN A 192.0.2.131\nIN A 192.0.2.132\nIN AAAA 2001:db8:0:1e:0:0:0:0\nIN AAAA 2001:db8:0:1f:0:0:0:0\ntopoff.eth9.gw01.nodes IN A 192.0.2.133\nIN A 192.0.2.134\nIN AAAA 2001:db8:0:20:0:0:0:0\nIN AAAA 2001:db8:0:21:0:0:0:0\n; IP addresses for gw21\n;\ntopoff.vip1.gw21.nodes IN A 192.0.2.115\nIN A 192.0.2.116\nIN AAAA 2001:db8:0:e:0:0:0:0\nIN AAAA 2001:db8:0:f:0:0:0:0\ntopoff.vip2.gw21.nodes IN A 192.0.2.135\nIN A 192.0.2.136\nIN AAAA 2001:db8:0:22:0:0:0:0\nIN AAAA 2001:db8:0:23:0:0:0:0\ntopoff.eth1.gw21.nodes IN A 192.0.2.137\nIN A 192.0.2.138\nIN AAAA 2001:db8:0:24:0:0:0:0\nIN AAAA 2001:db8:0:25:0:0:0:0\ntopoff.eth4.gw21.nodes IN A 192.0.2.139\nIN A 192.0.2.140\nIN AAAA 2001:db8:0:26:0:0:0:0\nIN AAAA 2001:db8:0:27:0:0:0:0\ntopoff.eth9.gw21.nodes IN A 192.0.2.141\nIN A 192.0.2.142\nIN AAAA 2001:db8:0:28:0:0:0:0\nIN AAAA 2001:db8:0:29:0:0:0:0\n;end of file\nThe above records are essentially standalone records representing the PGW/SGW node and its interfaces. An operator would normally define the records when a new node is brought into service and would only modify it when new IP interfaces or services are added to that particular node.\nThe fact both record types are here under the same name is a result of the PGW/SGW being collocated and having the same canonical node name.\nNOTE:\tThe rule for node records is to always include all services that are allowed to be used on a node and are defined in 3GPP TS 23.003 [4] clause 19.4.3 for that node. Node records are meant to be complete.\nThe lack of a record in a canonical node name record set is just as important as the records that are there. The commented out records in the example would be included for supporting S4-SGSN and/or Gn/Gp interfaces. Their absence states that the node does not support the function.\nA.3.7\tTAI/TAC file for \"Collocated Simple LTE Example\"\nThe format of the TAI/TAC name is standardized by 3GPP 23.003 [4] clause 19.4.2.3 and is of form tac‑lb<TAC‑low‑byte>.tac‑hb<TAC-high-byte>.tac.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org and service names are in 3GPP 23.003 [4] clause 19.4.3.\nThe file containing the TAI/TAC records for this example will be SIMPLE_TAI_DB.txt and has following content.\n; All TAC codes for one region\n*.tac-hb01.tac                             (\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"      \"\"  topoff.eth4.gw01.nodes )\nIN NAPTR 200   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"      \"\"  topoff.eth4.gw21.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw01.nodes\nIN NAPTR 400   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw21.nodes\n; Above records are needed for SGW selection in initial attach of a UE (or TAU or handover attach)\n;\nIN NAPTR 500   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec01.mmegi8001.mme\nIN NAPTR 600   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec02.mmegi8001.mme\n;  Above two records are needed for target MME selection by source MME\n;\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s11\"                  \"\"  topoff.eth1.gw01.nodes )\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-s11\"                  \"\"  topoff.eth1.gw21.nodes\n;  Above two S11 records are purely optional for an operator to provision and are only\n;  an optimizaton when included so they are commented out for this example\n;  IN NAPTR 900   999   \"a\" \"x-3gpp-sgw:x-s4\"                   \"\"  topoff.eth6.gw01.nodes )\n;  IN NAPTR 1000  999   \"a\" \"x-3gpp-sgw:x-s4\"                   \"\"  topoff.eth6.gw21.nodes\n; This operator does not support S3/S4 so they are commented out for this example\n; Above two S4 records are purely optional for an operator to provision even if S3/S4 is supported\n; Note relative value of NAPTR order is important between the S5/S8 records,\n; relative value of NAPTR order is important between the S10 records,\n; relative value of NAPTR order is important between the S11 records\n; but is not really important between different interface types used here\n; (i.e. the MME selection procedure does not look for an SGW interface)\n;\n;  This operators policy is PMIPv6 is used only as last choice\n;  and only for S8 they don't allow S5 PMIPv6 at all\n; All TAC codes for another region\n*.tac-hb40.tac                           (\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"      \"\"  topoff.eth4.gw01.nodes )\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"      \"\"  topoff.eth4.gw21.nodes\nIN NAPTR 400   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw01.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw21.nodes\n;\nIN NAPTR 600   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec01.mmegi8001.mme\nIN NAPTR 500   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec02.mmegi8001.mme\n;\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-s11\"                  \"\"  topoff.eth1.gw01.nodes )\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s11\"                  \"\"  topoff.eth1.gw21.nodes\n;  IN NAPTR 1000  999   \"a\" \"x-3gpp-sgw:x-s4\"                   \"\"  topoff.eth6.gw01.nodes )\n;  IN NAPTR 900   999   \"a\" \"x-3gpp-sgw:x-s4\"                   \"\"  topoff.eth6.gw21.nodes\n; For the example the TAC values *.tac-hb40.tac are on other side of network than the *.tac-hb01.tac\n; Relative order reverses in comparison to since those TAI are closer to the other set of nodes\n; end of file\nSGW records are here since TAI is used to select the SGW in the initial attach procedure (and TAU with SGW change). The MME record is here for the the 'Inter eNodeB handover with MME relocation' procedure where a target MME must be selected by the source MME.\nWild cards are used in this example to simplify provisioning assuming that the operator picks tac codes with the same high byte for each eNodeB that are equivalent in terms of prioritization. Otherwise each TAC code needs to be provisioned individually in DNS requiring a small amount of additional repetitive provisioning as each set of TAC codes is added to a network.\nFrom above SGW records we see only GTP based S5 so there is no PMIPv6 S5 support for the SGWs. The operator insists on GTP based S5 i.e. when one of their PGW is used and the UE is in their network (the operator does let roamers use another operators PMIPv6 PGW though). The S5/S8 SGW interfaces with (partially qualified) canonical node name gw01.nodes is used when possible for tac codes with high byte of 01 hex and the S5/S8 SGW interfaces with (partially qualified) canonical node name gw21.nodes is used when possible for tac codes with high byte of 40 hex. This follows from the NAPTR order 100 record being used before the order 200 record in the corresponding record set. This is the general mechanism an operator can use to steer the SGW selection based on which TAI the user initially attaches to (or during TAU with SGW service change). So an operator trying to minimize S1-U link costs would set the order to the smallest value for the SGW with the least cost S1-U link(s) to the eNodeB(s) serving that TAI and use higher order for the TAI corresponding to the more expensive links.\nThe gw01.nodes and gw21.nodes are the collocated PGW/SGW canonical node names the operator chooses. These were defined in the file CS_SGW_PGW_NODE_DB.txt.\nThe TAI records are not intended to determine the SGW S11 interface directly but only the candidate list SGW S5/S8 interfaces with node names. S11 interface lookup can be done from the SGW canonical node name (see records in CS_SGW_PGW_NODE_DB.txt ) so inclusion of S11 here is not strictly needed.\nA.3.8\tMME lookup based on GUTI for \"Simple LTE Example\"\nHere we \"manually\" execute the S-NAPTR procedure using the standard \"dig\" command for finding the source MME at the target MME (for example in a TAU procedure) to illustrate the procedure and show how the DNS records work in practice.\nThe target MME receives the LTE UE's old GUTI. The target MME extracts the MNC, MCC, MMEC and MMEGI values. In this example the UE is in a cell where the MME selected by the RAN is assumed to be MMEC=1 and MMEGI=8000 hexadecimal. The MME creates the Application Unique String mmec01.mmegi8001.mme.$ORIGIN (see clause 4.3.3.4 of this TS)\nNOTE:\tReminder $ORIGIN is epc.mnc990.mcc311.3gppnetwork.org. and is employed here simply to keep the length of the example text manageable.\nThe target MME starts the S-NAPTR with Application Unique String = mmec01.mmegi8001.mme.$ORIGIN and desired services x-3gpp-mme:x-s10 since it is trying to contact the old MME to do a context transfer.\nHere we emulate the same action manually with the dig command.\n--------- Command to DNS server----------\ncommand: dig @192.0.2.247  +tcp  NAPTR mmec01.mmegi8001.mme.$ORIGIN\n---------Start Response from DNS server----------\n; <<>> DiG 9.5.0-P2-W2 <<>> @192.0.2.247 +tcp NAPTR mmec01.mmegi8001.mme.$ORIGIN\n; (1 server found)\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 1399\n;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: 10\n;; WARNING: recursion requested but not available\n;; QUESTION CLAUSE:\n;mmec01.mmegi8001.mme.$ORIGIN.\tIN NAPTR\n;; ANSWER CLAUSE:\nmmec01.mmegi8001.mme.$ORIGIN.\t3600 IN\tNAPTR 100 999 \"a\" \"x-3gpp-mme:x-s10\" \"\" topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN.\nmmec01.mmegi8001.mme.$ORIGIN.\t3600 IN\tNAPTR 200 999 \"a\" \"x-3gpp-mme:x-s11\" \"\" topoff.eth3.mmec01.mmegi8001.mme.$ORIGIN.\n;; AUTHORITY CLAUSE:\n$ORIGIN. 3600\tIN NS\tns1.$ORIGIN.\n$ORIGIN. 3600\tIN NS\tns2.$ORIGIN.\n;; ADDITIONAL CLAUSE:\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.12\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.11\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:1::\ntopoff.eth3.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.14\ntopoff.eth3.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.13\ntopoff.eth3.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:2::\ntopoff.eth3.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:3::\nns1.$ORIGIN. 3600 IN A 192.0.2.247\nns2.$ORIGIN. 3600 IN A 192.0.2.248\n;; Query time: 15 msec\n;; SERVER: 192.0.2.247#53(192.0.2.247)\n;; WHEN: Wed Jan 21 16:30:20 2009\n;; MSG SIZE  rcvd: 524\n---------End Response from DNS server----------\nMME retains only NAPTR with matching services matching x-3gpp-mme:x-s10 yielding\nNAPTR record set\nreplacement                              service                        flag order preference\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN x-3gpp-mme:x-s10               \"a\"  100   999\nMME node sorts the NAPTR records by RFC 3958 rules. Obviously since this is a list of only one record it yields the same list back again unchanged.\nSince the record is the terminal (\"a\") flag we have the host name (and canonical node name inside it).\nFormally the A/AAAA record lookup can be performed at this point or it can be deferred until a later step.\nThe MME can store the important content now\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN services of x-3gpp-mme:x-s10\nBecause there is only one match the MME now has the final candidate list (except for IP addresses).\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN services of x-3gpp-mme:x-s10\nNote the needed A/AAAA records for topoff.eth1.mmec01.mmegi8001.mme are already present in the additional record clause of the response.\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.12\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.11\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:1::\nIf the records had not been available in the additional record clause of the response then the MME would have had to done the A/AAAA record lookups directly. Emulated by dig command they would have been\ncommand: dig @192.0.2.247  +tcp  A topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN\nand\ncommand: dig @192.0.2.247  +tcp  AAAA topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN\nor\ncommand: dig @192.0.2.247  +tcp  ANY topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN\nRegardless of the source of the A and AAAA records, the order of the A records shall be randomly shuffled by the MME. The same shall be done for the AAAA records. (For our \"manual\" example it will be a coin flip as to which of the two records is first).\nThe MME now has a candidate list (very short here) with the needed IPv4 and IPv6 addresses. I.e.:\n(topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN, services of x-3gpp-mme:x-s10, {192.0.2.12,192.0.2.11}, { 2001:db8::, 2001:db8:0:1:: } )\nThe target MME then can use the IPv4 (or IPv6) addresses to contact the source MME over S10 to get the UE's context information from the old MME.\nWhen an operator uses only NAPTR flag \"a\" records the S-NAPTR procedure will only require one NAPTR lookup from the Application Unique String in all cases greatly streamlining the DNS lookups. Also assuming a modern DNS server where the NAPTR and A/AAAA records in the same DNS server the needed A/AAAA records are likely to be in the additional record clause (as the above real output shows).\nHowever, the needed A/AAAA records would NOT have been present even in this small example if the DNS resolver (dig here) had not used TCP transport (or EDNS0 for UDP) since the packet size of the response in this example was 524 bytes which exceeds the 512 byte limit for using UDP transport without EDNS0.\nA.3.9\tAPN lookup for \"Simple LTE Example\" (i.e. PGW candidate list)\nAssume a non-roaming LTE UE indicates it want to use APN-NI string \"imsTV2\" to the MME in our example network at initial attach.\nNOTE 1:\tReminder $ORIGIN is epc.mnc990.mcc311.3gppnetwork.org. and is employed here simply to keep the length of the example text manageable\nThe MME starts the S-NAPTR procedure with Application Unique String = imsTV2.apn.$ORIGIN and desired services x-3gpp-pgw:x-s5-gtp and x-3gpp-pgw:x-s5-pmip.\nHere we emulate the same action the MME would do manually with the dig command.\nMME starts with Application Unique String = imsTV2.apn.$ORIGIN and the desired services x-3gpp-pgw:x-s5-gtp and x-3gpp-pgw:x-s5-pmip\n--------- Command to DNS server----------\ncommand: dig @192.0.2.247  +tcp  NAPTR imsTV2.apn.$ORIGIN\n---------Start Response from DNS server----------\n; <<>> DiG 9.5.0-P2-W2 <<>> @192.0.2.247 +tcp NAPTR imsTV2.apn.$ORIGIN\n; (1 server found)\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 1796\n;; flags: qr aa rd; QUERY: 1, ANSWER: 4, AUTHORITY: 2, ADDITIONAL: 18\n;; WARNING: recursion requested but not available\n;; QUESTION CLAUSE:\n;imsTV2.apn.$ORIGIN. IN NAPTR\n;; ANSWER CLAUSE:\nimsTV2.apn.$ORIGIN. 3600 IN NAPTR 600 999 \"a\" \"x-3gpp-pgw:x-s8-pmip\" \"\" topoff.vip2.gw01.node.$ORIGIN.\nimsTV2.apn.$ORIGIN. 3600 IN NAPTR 100 999 \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.vip1.gw21.node.$ORIGIN.\nimsTV2.apn.$ORIGIN. 3600 IN NAPTR 200 999 \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.vip1.gw01.node.$ORIGIN.\nimsTV2.apn.$ORIGIN. 3600 IN NAPTR 500 999 \"a\" \"x-3gpp-pgw:x-s8-pmip\" \"\" topoff.vip2.gw21.node.$ORIGIN.\n;; AUTHORITY CLAUSE:\n$ORIGIN. 3600\tIN NS\tns2.$ORIGIN.\n$ORIGIN. 3600\tIN NS\tns1.$ORIGIN.\n;; ADDITIONAL CLAUSE:\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.116\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.115\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:e::\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:f::\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN A 192.0.2.114\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN A 192.0.2.113\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:c::\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:d::\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN A 192.0.2.136\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN A 192.0.2.135\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:22::\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:23::\ntopoff.vip2.gw01.node.$ORIGIN. 3600 IN A 192.0.2.144\ntopoff.vip2.gw01.node.$ORIGIN. 3600 IN A 192.0.2.143\ntopoff.vip2.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:2a::\ntopoff.vip2.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:2b::\nns1.$ORIGIN. 3600 IN A 192.0.2.247\nns2.$ORIGIN. 3600 IN A 192.0.2.248\n;; Query time: 0 msec\n;; SERVER: 192.0.2.247#53(192.0.2.247)\n;; WHEN: Wed Jan 21 19:21:14 2009\n;; MSG SIZE  rcvd: 890\n---------End Response from DNS server----------\nMME retains only NAPTR records with matching services x-3gpp-pgw:x-s5-gtp and\nx-3gpp-pgw:x-s5-pmip  yielding:\nNAPTR record set\nreplacement                    service                        flag order preference\ntopoff.vip1.gw21.node.$ORIGIN x-3gpp-pgw:x-s5-gtp:x-s8-gtp   \"a\"  100   999\ntopoff.vip1.gw01.node.$ORIGIN x-3gpp-pgw:x-s5-gtp:x-s8-gtp   \"a\"  200   999\n; Note the x-s8-gtp are not really included but are kept here to allow the\n; reader to see which NAPTR record was kept from the DNS response.\n; The DNS server \"luckily\" returns this in sorted order but the MME must sort it .\n; The DNS server is not responsible for sorting but the DNS resolver (i.e. the MME)\nMME node sorts NAPTR by RFC 3958 yielding\nNAPTR record set\nreplacement                    service                        flag order preference\ntopoff.vip1.gw21.node.$ORIGIN x-3gpp-pgw:x-s5-gtp:x-s8-gtp   \"a\"  100   999\ntopoff.vip1.gw01.node.$ORIGIN x-3gpp-pgw:x-s5-gtp:x-s8-gtp   \"a\"  200   999\nMME Stores records since they are flag \"a\"\ntopoff.vip1.gw21.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\ntopoff.vip1.gw01.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\nMME now has final candidate list (A and AAAA lookup is deferred for our hand example)\ntopoff.vip1.gw21.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\ntopoff.vip1.gw01.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\nThe needed A/AAAA records were included with additional records. I.e.\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.116\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.115\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:e::\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:f::\nand\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN A 192.0.2.114\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN A 192.0.2.113\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:c::\ntopoff.vip1.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:d::\nIF the A and AAAA records were not available in the Additional Record clause (or a DNS cache) the MME would do the A/AAAA lookups. Which emulating with manual commands would look like:\ndig @192.0.2.247  +tcp  A topoff.vip1.gw21.node.$ORIGIN\ndig @192.0.2.247  +tcp  AAAA topoff.vip1.gw21.node.$ORIGIN\ndig @192.0.2.247  +tcp  A topoff.vip1.gw01.node.$ORIGIN\ndig @192.0.2.247  +tcp  AAAA topoff.vip1.gw01.node.$ORIGIN\nWe can form the full candidate list now (after random shuffling the A and AAAA records) to get\n(topoff.vip1.gw21.node.$ORIGIN ,services of x-3gpp-pgw:x-s5-gtp , {192.0.2.115,192.0.2.116}, { 2001:db8:0:e::,2001:db8:0:f::} )\n(topoff.vip1.gw01.node.$ORIGIN ,services of x-3gpp-pgw:x-s5-gtp , {192.0.2.114,192.0.2.113}, { 2001:db8:0:c::, 2001:db8:0:d::)\nThe fact that the node topoff.vip1.gw21.node.$ORIGIN comes first is a direct result of the two different NAPTR order values.\nNOTE 2:\tThis is the last example in this Annex with A and AAAA lookups and IP addresses explicitly included in the candidate list. This detail is left for the reader for the remaining clauses.\nFor the initial attach case the candidate list of SGW has to be formally found to handle the collocated PGW and SGW case. The SGW candidate list is found in the next clause.\nNOTE 3:\tIf this DNS procedure was being used for an additional PDN connection for a UE with an existing SGW rather than a first attach, then the MME would check to see if the current SGW node name matches any of the PGW node names in the above list (gw01.node.$ORIGIN and gw21.node.$ORIGIN) to try to pick a collocated PGW on the current SGW. The canonical node name record of the current SGW can be used by the MME to find all S5/S8 SGW interfaces on the current PGW. This is a smaller example of what follows so we do not detail it further.\nA.3.10\tTAI lookup for \"Simple LTE Example\" (i.e. SGW candidate list)\nAssume a non-roaming LTE UE performs and initial attach and indicates it want to use a APN-NI (an APN in this operator's network). The MME knows it does not need to use S8 since it is a non-roaming UE and must be local APN so S5 is used.\nNOTE 1:\tReminder $ORIGIN is epc.mnc990.mcc311.3gppnetwork.org. and is employed here simply to keep the length of the example text manageable.\nThe MME has the TAI value where the UE has attached. We assume the low byte of the TAC is hex 11 and the high byte is hex 40.\nThe MME starts the S-NAPTR procedure with Application Unique String = tac-lb11.tac-hb40.tac.$ORIGIN and desired services x-3gpp-sgw:x-s11,x-3gpp-sgw:x-s5-gtp, x-3gpp-sgw:x-s5-pmip.\nNOTE 2:\tThis particular MME vendor looks for the x-s11 values, which is only an optional optimization. This will not have any benefit in this example since the operator chosed not to provision them.\nHere we emulate the same action the MME would do manually with the \"dig\" command.\nMME starts with Application Unique String = tac-lb11.tac-hb40.tac.$ORIGIN\ndesired services x-3gpp-sgw:x-s11,x-3gpp-sgw:x-s5-gtp,x-3gpp-sgw:x-s5-pmip\n--------- Command to DNS server----------\ncommand: dig @192.0.2.247  +tcp  NAPTR tac-lb11.tac-hb40.tac.$ORIGIN\n---------Start Response from DNS server----------\n; <<>> DiG 9.5.0-P2-W2 <<>> @192.0.2.247 +tcp NAPTR tac-lb11.tac-hb40.tac.$ORIGIN\n; (1 server found)\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 622\n;; flags: qr aa rd; QUERY: 1, ANSWER: 6, AUTHORITY: 2, ADDITIONAL: 26\n;; WARNING: recursion requested but not available\n;; QUESTION CLAUSE:\n;tac-lb11.tac-hb40.tac.$ORIGIN. IN NAPTR\n;; ANSWER CLAUSE:\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 400 999 \"a\" \"x-3gpp-sgw:x-s8-pmip\" \"\" topoff.eth9.gw01.node.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 500 999 \"a\" \"x-3gpp-mme:x-s10\" \"\" topoff.eth1.mmec02.mmegi8001.mme.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 600 999 \"a\" \"x-3gpp-mme:x-s10\" \"\" topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 100 999 \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.eth4.gw21.node.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 200 999 \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.eth4.gw01.node.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 300 999 \"a\" \"x-3gpp-sgw:x-s8-pmip\" \"\" topoff.eth9.gw21.node.$ORIGIN.\n;; AUTHORITY CLAUSE:\n$ORIGIN. 3600\tIN NS\tns2.$ORIGIN.\n$ORIGIN. 3600\tIN NS\tns1.$ORIGIN.\n;; ADDITIONAL CLAUSE:\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.140\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.139\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:26::\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:27::\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN A 192.0.2.132\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN A 192.0.2.131\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:1e::\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:1f::\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN A 192.0.2.142\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN A 192.0.2.141\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:28::\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:29::\ntopoff.eth9.gw01.node.$ORIGIN. 3600 IN A 192.0.2.134\ntopoff.eth9.gw01.node.$ORIGIN. 3600 IN A 192.0.2.133\ntopoff.eth9.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:20::\ntopoff.eth9.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:21::\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.18\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.17\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:6::\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:7::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.12\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.11\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:1::\nns1.$ORIGIN. 3600 IN A 192.0.2.247\nns2.$ORIGIN. 3600 IN A 192.0.2.248\n;; Query time: 0 msec\n;; SERVER: 192.0.2.247#53(192.0.2.247)\n;; WHEN: Wed Jan 21 19:33:00 2009\n;; MSG SIZE  rcvd: 1285\n---------End Response from DNS server----------\nMME retains only the NAPTR with matching services x-3gpp-sgw:x-s11,x-3gpp-sgw:x-s5-gtp,\nand x-3gpp-sgw:x-s5-pmip yielding\nNAPTR record set\nreplacement                     service                        flag order preference\ntopoff.eth4.gw01.node.$ORIGIN x-3gpp-sgw:x-s5-gtp:x-s8-gtp   \"a\"  200   999\ntopoff.eth4.gw21.node.$ORIGIN x-3gpp-sgw:x-s5-gtp:x-s8-gtp   \"a\"  100   999\n; Note the x-s8-gtp are not really included but are kept here to allow the\n; reader to see which NAPTR record was kept from the DNS response.\nMME node sorts the NAPTR records by RFC 3958 yielding\nNAPTR record set\nreplacement                    service                        flag order preference\ntopoff.eth4.gw21.node.$ORIGIN x-3gpp-sgw:x-s5-gtp:x-s8-gtp   \"a\"  100   999\ntopoff.eth4.gw01.node.$ORIGIN x-3gpp-sgw:x-s5-gtp:x-s8-gtp   \"a\"  200   999\nMME Stores\ntopoff.eth4.gw21.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\ntopoff.eth4.gw01.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\nMME now has candidate list\ntopoff.eth4.gw21.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\ntopoff.eth4.gw01.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\nAgain the A/AAAA records were available in the additional record clause.\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.140\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.139\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:26::\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:27::\nand\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN A 192.0.2.132\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN A 192.0.2.131\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:1e::\ntopoff.eth4.gw01.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:1f::\nNOTE:\tThe size of the response was 1285 bytes and indicates why EDNS0 or TCP transport should be used for S-NAPTR when feasible. Most of the data in the Additional Record Clause would not have been available if only 512 bytes had been sent.\nA.3.11\tFinding the collocated SGW and PGW together\nIP addresses are not included here for readability.\nWe are now in a position to look at both the SGW candidate list and PGW candidate list at the same time.\nFrom A.3.9 we had the PGW candidate list for the APN-NI \"imsTV2\" was\ntopoff.vip1.gw21.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\ntopoff.vip1.gw01.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\nFrom A.3.10 we had the SGW candidate list for TAI where low byte ofTAC is hex 11 and the high byte is hex 40 was\ntopoff.eth4.gw21.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\ntopoff.eth4.gw01.node.$ORIGIN services of x-3gpp-sgw:x-s5-gtp\nWe only have GTPv2 so the protocols match.\nBoth nodes gw21.node.$ORIGIN  and gw01.node.$ORIGIN are collocated.\nHence, moving the collocated nodes to the front of both lists leaves them unchanged.\nThe procedure requires we use the SGW ordering to select the SGW first.\nHence, the SGW interface to try first is topoff.eth4.gw21.node.$ORIGIN\nThat is node gw21.node.$ORIGIN.\nThat means the PGW record that is collocated is:\ntopoff.vip1.gw21.node.$ORIGIN services of x-3gpp-pgw:x-s5-gtp\nwhich is the first PGW interface to try.\nNOTE:\tIt is an \"accident\" that this is the same order as the APN-NI \"imsTV2\" gave back. If APN-NI had been \"imsTV1\" the order would have been reversed in the PGW candidate list and it would NOT have been first. Again the collocation ordering takes precedence.\nThe MME would use the IP addresses from the records (not shown) for the S11 Create Session Request attempt.\nAssuming it succeeds we would not need to try any other PGW or SGW records.\nThe MME needs the S11 interface so it can physically send the Create Session Request to the SGW. That is covered in the next clause.\nA.3.12\tS11 lookup by SGW canonical node name\nAssume an SGW has been picked with canonical node name of gw21.node.$ORIGIN\nThe MME starts with Application Unique String = gw21.node.$ORIGIN obtained from the SGW selection with.desired services x-3gpp-sgw:x-s11\n--------- Command to DNS server----------\ncommand: dig @192.0.2.247  +tcp  NAPTR gw21.node.$ORIGIN\n---------Start Response from DNS server----------\n; <<>> DiG 9.5.0-P2-W2 <<>> @192.0.2.247 +tcp NAPTR gw21.node.$ORIGIN\n; (1 server found)\n;; global options:  printcmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 23\n;; flags: qr aa rd; QUERY: 1, ANSWER: 5, AUTHORITY: 2, ADDITIONAL: 22\n;; WARNING: recursion requested but not available\n;; QUESTION CLAUSE:\n;gw21.node.$ORIGIN. IN NAPTR\n;; ANSWER CLAUSE:\ngw21.node.$ORIGIN. 3600 IN NAPTR 600 999 \"a\" \"x-3gpp-sgw:x-s8-pmip\" \"\" topoff.eth9.gw21.node.$ORIGIN.\ngw21.node.$ORIGIN. 3600 IN NAPTR 100 999 \"a\" \"x-3gpp-sgw:x-s11\" \"\" topoff.eth1.gw21.node.$ORIGIN.\ngw21.node.$ORIGIN. 3600 IN NAPTR 200 999 \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.vip1.gw21.node.$ORIGIN.\ngw21.node.$ORIGIN. 3600 IN NAPTR 300 999 \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\" \"\" topoff.eth4.gw21.node.$ORIGIN.\ngw21.node.$ORIGIN. 3600 IN NAPTR 400 999 \"a\" \"x-3gpp-pgw:x-s8-pmip\" \"\" topoff.vip2.gw21.node.$ORIGIN.\n;; AUTHORITY CLAUSE:\n$ORIGIN. 3600\tIN NS\tns2.$ORIGIN.\n$ORIGIN. 3600\tIN NS\tns1.$ORIGIN.\n;; ADDITIONAL CLAUSE:\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.138\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.137\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:24::\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:25::\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.116\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.115\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:e::\ntopoff.vip1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:f::\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.139\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN A 192.0.2.140\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:27::\ntopoff.eth4.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:26::\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN A 192.0.2.136\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN A 192.0.2.135\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:22::\ntopoff.vip2.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:23::\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN A 192.0.2.141\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN A 192.0.2.142\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:29::\ntopoff.eth9.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:28::\nns1.$ORIGIN. 3600 IN A 192.0.2.247\nns2.$ORIGIN. 3600 IN A 192.0.2.248\n;; Query time: 0 msec\n;; SERVER: 192.0.2.247#53(192.0.2.247)\n;; WHEN: Wed Jan 21 19:45:36 2009\n;; MSG SIZE  rcvd: 1072\n---------End Response from DNS server----------\nMME retains only the NAPTR records with matching service x-3gpp-sgw:x-s11 yielding\nNAPTR record set\nreplacement                    service                        flag order preference\ntopoff.eth1.gw21.node.$ORIGIN x-3gpp-sgw:x-s11               \"a\"  100   999\nMME node sorts NAPTR by RFC 3958 (trivially here) yielding\nNAPTR record set\nreplacement                    service                        flag order preference\ntopoff.eth1.gw21.node.$ORIGIN x-3gpp-sgw:x-s11               \"a\"  100   999\nMME Stores\ntopoff.eth1.gw21.node.$ORIGIN services of x-3gpp-sgw:x-s11\nMME now has candidate list\ntopoff.eth1.gw21.node.$ORIGIN services of x-3gpp-sgw:x-s11\nAgain the needed A and AAAA records are in the additional record clause\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.138\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN A 192.0.2.137\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:24::\ntopoff.eth1.gw21.node.$ORIGIN. 3600 IN AAAA 2001:db8:0:25::\nA.3.13\tTAI lookup for \"Colocation Simple LTE Example\" (i.e. MME candidate list)\nThis type of lookup is done for the \"Inter eNodeB handover with MME relocation\" procedure where the old MME selects the target MME in a new TAI.\nThe service is x-3gpp-mme:x-s10 again.\nSince this also starts with the TAI NAPTR lookup we have the same type of record set as the SGW selection from TAI clause (see A.3.10) and to not waste space the same TAC value will be used.\nThe only difference from that clause starts with which NAPTR records match.\nFrom the Answer clause these are:\n;; ANSWER CLAUSE:\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 500 999 \"a\" \"x-3gpp-mme:x-s10\" \"\" topoff.eth1.mmec02.mmegi8001.mme.$ORIGIN.\ntac-lb11.tac-hb40.tac.$ORIGIN. 3600 IN NAPTR 600 999 \"a\" \"x-3gpp-mme:x-s10\" \"\" topoff.eth1.mmec01.mmegi8001.mme.$ORIGIN.\nWhich are already in order. The NAPTR order of 500 is less than NAPTR order of 600.\nSo S10 interfaces in order are:\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN.\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN.\nand the needed A/AAAA records from the Additional clause in the DNS response in clause A.3.10 are:\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.18\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.17\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:6::\ntopoff.eth1.mmec02.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:7::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.12\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN A 192.0.2.11\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8::\ntopoff.eth1.mmec01.mmegi8001.mme.$ORIGIN. 3600 IN AAAA 2001:db8:0:1::\nA.4\tLTE Example with Dedicated Core Network\nA.4.1\tGeneral\nThe example of an operator network for DCN deployment has same properties as described in A.3.1 with the following modifications:\n5)\tCombined PGW/SGW (01) supports UE usage type of 1, 10, 20 and Combined PGW/SGW (21) supports all the UEs except UEs associated with UE usage type 1, 10, 20.\n7)\tTwo MME pool areas are defined and each MME pool has two MMEs. The MME pool with MMEGI of 8001 supports UE usage type of 1, 10, 20 where the other MME pool supports all the UEs except UEs associated with UE usage type 1, 10, 20.\n11)\tThere is only one APN-NI in this network \"imsTV1\".\nThe following figure shows the simple example of DCN deployment.\nFigure A.4.x1-1: Simple example of DCN depolyment\nA.4.2\tAPN file for DCN\nThe format of the APN FQDN is standardized by 3GPP TS 23.003 [4] clause 19.4.2.2 and is of form <APN-NI>.apn.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org.\nService names are in 3GPP TS 23.003 [4] clause 19.4.3 with +ue-<ue usage type> appended to the 'app-protocol' name.\nThe file containing the APN records for this example will be CS_APN_DB.txt and has following content.\nimsTV1.apn                                   (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-pgw:x-s5-gtp+ue-1.10.20:x-s8-gtp+ue-1.10.20\"         \"\" topoff.vip1.gw01.nodes )\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw21.nodes\n;  IN NAPTR 300   999   \"a\" \"x-3gpp-pgw:x-gn+ue-1.10.20:x-gp+ue-1.10.20\"                 \"\" topoff.vip3.gw01.nodes\n;  IN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw21.nodes\nIN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-s8-pmip+ue-1.10.20\"      \"\" topoff.vip2.gw01.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw21.nodes\n;The operator uses PGW01 for UE usage type of 1,10,20 and PGW21 for non DCN user.\n;The operator does not support Gn/Gp so those records are commented out\nA.4.3\tPGW/SGW node file for \"Collocated Simple LTE Example\"\nThe file containing the PGW/SGW canonical node name records (and A/AAAA records for the PGW/SGW nodes) for this example will be CS_SGW_PGW_NODE_DB.txt and has following content.\n; Node records for the combined PGW/SGW\ngw01.nodes                            (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp+ue-1.10.20:x-s8-gtp+ue-1.10.20\"         \"\" topoff.vip1.gw01.nodes )\nIN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-s8-pmip+ue-1.10.20\"                 \"\" topoff.vip2.gw01.nodes\n;  IN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-gn+ue-1.10.20:x-gp+ue-1.10.20\"                 \"\" topoff.vip3.gw01.nodes\n;  The operator does not support Gn/Gp so those records are commented out\n;\n; Above are PGW records.\n; Following are SGW records\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s11+ue-1.10.20\"          \"\" topoff.eth1.gw01.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s5-gtp+ue-1.10.20:x-s8-gtp+ue-1.10.20\"         \"\" topoff.eth4.gw01.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-sgw:x-s8-pmip+ue-1.10.20\"      \"\" topoff.eth9.gw01.nodes\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s4+ue-1.10.20\"           \"\" topoff.eth6.gw01.nodes\n;  IN NAPTR 710   999   \"a\" \"x-3gpp-sgw:x-s12+ue-1.10.20\"          \"\" topoff.eth6.gw01.nodes\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-gn+ue-1.10.20:x-gp+ue-1.10.20\"                 \"\" topoff.eth8.gw01.nodes\n;  The records related to the non supported interfaces are commented out\n;\n; Same record for the other combined PGW/SGW\n; As gw21 does not support any particular UE usage type, so no changes in the existing records\ngw21.nodes                            (\n;  IN NAPTR order pref. flag service                           regexp replacement\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.vip1.gw21.nodes )\nIN NAPTR 400   999   \"a\" \"x-3gpp-pgw:x-s8-pmip\"                 \"\" topoff.vip2.gw21.nodes\n;  IN NAPTR 500   999   \"a\" \"x-3gpp-pgw:x-gn:x-gp\"                 \"\" topoff.vip3.gw21.nodes\n; Above are PGW records.\n; Following are SGW records\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s11\"                     \"\" topoff.eth1.gw21.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"         \"\" topoff.eth4.gw21.nodes\nIN NAPTR 600   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"                 \"\" topoff.eth9.gw21.nodes\n;  IN NAPTR 700   999   \"a\" \"x-3gpp-sgw:x-s4\"                      \"\" topoff.eth6.gw21.nodes\n;  IN NAPTR 710   999   \"a\" \"x-3gpp-sgw:x-s12\"                     \"\" topoff.eth6.gw21.nodes\n;  IN NAPTR 800   999   \"a\" \"x-3gpp-sgw:x-gn:x-gp\"                 \"\" topoff.eth8.gw21.nodes\n; For A/AAAA records, see A.3.6.\nA.4.4\tTAI/TAC file for DCN\nThe format of the TAI/TAC name is standardized by 3GPP 23.003 [4] clause 19.4.2.3 and is of form tac‑lb<TAC‑low‑byte>.tac‑hb<TAC-high-byte>.tac.epc.mnc<MNC>.mcc<MCC>.3gppnetwork.org and service names are in 3GPP 23.003 [4] clause 19.4.3 with +ue-<ue usage type> appended to the 'app-protocol' name.\nThe file containing the TAI/TAC records for this example will be SIMPLE_TAI_DB.txt and has following content.\n; All TAC codes for one region\n; MME pool represented by mmegi8001 and mmegi8002 are for DCN user and non DCN user respectively.\n*.tac-hb01.tac                             (\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s5-gtp+ue-1.10.20:x-s8-gtp+ue-1.10.20\"      \"\"  topoff.eth4.gw01.nodes )\nIN NAPTR 200   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"\t   \"\"  topoff.eth4.gw21.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s8-pmip+ue-1.10.20\"   \"\"  topoff.eth9.gw01.nodes\nIN NAPTR 400   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw21.nodes\n;  The operator uses PGW01 for UE usage type of 1,10,20 and PGW21 for non DCN user.\n;  Above records are needed for SGW selection in initial attach of a UE (or TAU or handover attach)\n;\nIN NAPTR 500   999   \"a\" \"x-3gpp-mme:x-s10+ue-1.10.20\"       \"\"  topoff.eth1.mmec01.mmegi8001.mme\nIN NAPTR 600   999   \"a\" \"x-3gpp-mme:x-s10+ue-1.10.20\"       \"\"  topoff.eth1.mmec02.mmegi8001.mme\nIN NAPTR 700   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec03.mmegi8002.mme\nIN NAPTR 800   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec04.mmegi8002.mme\n;  From the above records with +ue-<ue usage type>, MMEGI information can be retieved when necessary.\n;\n*.tac-hb40.tac                           (\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-sgw:x-s5-gtp+ue-1.10.20:x-s8-gtp+ue-1.10.20\"      \"\"  topoff.eth4.gw01.nodes )\nIN NAPTR 200   999   \"a\" \"x-3gpp-sgw:x-s5-gtp:x-s8-gtp\"      \"\"  topoff.eth4.gw21.nodes\nIN NAPTR 300   999   \"a\" \"x-3gpp-sgw:x-s8-pmip+ue-1.10.20\"   \"\"  topoff.eth9.gw01.nodes\nIN NAPTR 400   999   \"a\" \"x-3gpp-sgw:x-s8-pmip\"              \"\"  topoff.eth9.gw21.nodes\n;\nIN NAPTR 600   999   \"a\" \"x-3gpp-mme:x-s10+ue-1.10.20\"       \"\"  topoff.eth1.mmec01.mmegi8001.mme\nIN NAPTR 500   999   \"a\" \"x-3gpp-mme:x-s10+ue-1.10.20\"       \"\"  topoff.eth1.mmec02.mmegi8001.mme\nIN NAPTR 800   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec03.mmegi8002.mme\nIN NAPTR 700   999   \"a\" \"x-3gpp-mme:x-s10\"                  \"\"  topoff.eth1.mmec04.mmegi8002.mme\n;  From the above records with +ue-<ue usage type>, MMEGI information can be retieved when necessary.\n;\nAnnex B (Normative):DNS procedures clarifications\nB.1\tDNS RFC procedures general clarifications\nThis clause clarifies DNS resolver use of the S-NAPTR procedures in EPC core network nodes.\nNOTE:\tThe only EPC core network nodes identified explicitly at this time that employ S-NAPTR procedures are the MME and Release 8 SGSN.\nDNS resolvers in EPC core network nodes shall support recursive queries and responses over UDP transport as specified in IETF RFC 1035 [3]. The EPC core network nodes may assume the existence of a local caching DNS server (see GSMA PRD IR.67 [5]) and hence may not need to do iterative queries as specified in IETF RFC 1035 [3]. However, the final deployment decision of local caching DNS servers is up to the operators. It is recommended that the EPC core network nodes support DNS queries and responses over TCP transport up to the 65535 byte maximum. Support of IETF RFC 2671 [13] (EDNS0) is recommended, in order to allow DNS response packets sizes over 512 octets when using UDP transport.\nIt is recommended that resolvers in EPC core network nodes cache frequently used DNS queries in order to lower load on DNS infrastructure.\nEPC core network nodes shall support SRV records as specified in IETF RFC 2782 [8]. However, in the 3GPP scope the ordering of SRV records of the same priority SHALL use the algorithm described in IETF RFC 2782 [8] page 4 instead of the the \"SHOULD\" requirement in the IETF RFC. This is a 3GPP specific requirement to strengthen the described algorithm and actually allow predictable behavior of the IETF RFC 2782 [8] based load balancing.\nB.2\tDNS procedures 3GPP clarifications on S-NAPTR\nIETF RFC 3958 [9] S-NAPTR procedures are unmodified with an exception of the following clarifications on the topological closeness and multi-protocol support:\n1)\tFor topological closeness the \"topon\" label matching of clause 4.3.2 of the present document takes precedence over NAPTR ordering but NAPTR ordering is still used when matching label lengths are equal. Therefore, a full list of \"candidate\" records is needed as sketched in Appendix A.2 of IETF RFC 3958 [9], which in turn requires \"backtracking\" as described by IETF RFC 3958 [9] clause 2.2.4. When collocation is to be considered applicable in a procedure it takes precedence in ordering over both \"topon\" and NAPTR ordering regardless of the value of the value of the \"topon|topoff\" label.\n2)\tIETF RFC 3958 [9] has an ambiguity for S-NAPTR with multiple protocols in last paragraph of clause 2.2.5 \"It MAY choose to run simultaneous DDDS resolutions for more than one protocol, in which case the requirements above apply for each protocol independently. That is, do not switch protocols mid- resolution.\"The term \" simultaneous DDDS resolutions\" and \"apply for each protocol independently\" are not defined and can have different meanings. To resolve that ambiguity in S-NAPTR, the present document formally defines \"Service description meeting the client requirement\" from IETF RFC 3402 [14] clause 3.3 step 4 as a NAPTR record with one or more of the 3GPP desired service and protocol field pair(s) and such that all ancestor NAPTR records in the current path to this point also include the identified service and protocol in the DDDS procedure. The present document uses that as the definition of \"simultaneous DDDS resolutions\". See clause C.1 for more practical information on this point.\n3)\tStrict ordering within S-NAPTR is obtained from the NAPTR order value as required in IETF RFC 3402 [14] and IETF RFC 3958 [8]. The value of (65535- NAPTR preference) shall be used as a statistical weight the same way the SRV weight is used on page 4 of IETF RFC 2782 [8] for SRV records.\nItems 1) , 2) and 3) impact the ordering of DNS records in which they are returned by the S-NAPTR procedure. Items 1) and 2) also involve areas where the IETF RFC 3958 [9] only provides a sketch of the procedures needed and implicitly relies on IETF RFC 3402 [14] for details. To clarify these points as well as to guide implementations informative pseudo-code is provided in clauses C.1, C.2 and C.3. Item 3) allows an operators to load balance within one NAPTR record set without employing SRV records giving a simpler DNS provisioning and potentially reducing the number of DNS queries.\nB.3\tDNS procedures 3GPP clarifications for Dedicated Core Networks\nWhen the app-protocol as input to the S-NAPTR procedure has the substring with at least +ue included, then any app-protocol returned from DNS shall be considered to match as follows. The characters following the + character follows the ABNF grammar as follows.\n\"ue-\" (USAGENUM)*( \".\" USAGENUM)\nUSAGENUM = 1*3(DIGIT)\nDIGIT = %x30-39; 0-9\nA record with any USAGENUM matching the input <usage> type value shall be considered as matching. As an example, x-s10+ue-8 as S-NAPTR input shall match a record with x-s10+ue-3.8.10.38, but shall not match a record with x-s10+ue-3.10.38.\nB.4\tDNS procedures 3GPP clarifications for Network Capability\nWhen the app-protocol as input to the S-NAPTR procedure has the substring with at least +nc included, then any app-protocol returned from DNS shall be considered to match as follows. The characters following the +nc follows the ABNF grammar as follows.\n\"nc-\" (NETCAP)*( \".\" NETCAP)\nNETCAP = 1*5(DIGIT / ALPHA)\nDIGIT = %x30-39; 0-9\nALPHA = %x41-5A / %x61-7A; A-Z / a-z\nA record with any NETCAP matching the input <network capability> value shall be considered as matching. As an example, x-s5-gtp+nc-nr as S-NAPTR input shall match a record with x-s5-gtp+nc-nr.5gs, but shall not match a record with x-s5-gtp+nc-nrs.\nAnnex C (Informative):DNS Pseudo-Code\nC.1\tS-NAPTR procedure base pseudo-code\nThe primary purpose of clause C.1 is to show practically any differences that are normatively documented in clause B.2. The changes to the IETF RFC 3958 [9] pseudo-code make this much clearer and self-contained than the normative text from clause B.2.\nThe pseudo-code immediately following is the pseudo-code from IETF RFC 3958 [9] Appendix A.1 modified to incorporate the clarifications from clause B.2.\ntarget = [initial domain]\n; Next line is changed from Appendix A.1 of RFC 3958\nusable-service-protocol-set  = [initial desired service and protocol pairs]\nnaptr-done = false\nwhile (not naptr-done)\n{\nNAPTR-RRset = [DNSlookup of NAPTR RRs for target]\n; Next two lines are changed from Appendix A.1 of RFC 3958\nNAPTR weight := 65535 - NAPTR PREF for each RR\n[sort NAPTR by ORDER, and by statistical NAPTR weight within each ORDER]\nrr-done = false\ncur-rr = [first NAPTR RR]\nwhile (not rr-done)\n; Next three lines are changed from Appendix A.1 of RFC 3958\ncompatable-service-protocol-set =[ [usable-service-protocol-set] set interclause with\n[SERVICE field of cur-rr] ]\nif ([compatable-service-protocol-set] is not empty)\nrr-done = true\ntarget= [REPLACEMENT target of NAPTR RR]\n; Next line is changed from Appendix A.1 of RFC 3958\nusable-service-protocol-set  = [compatable-service-protocol-set]\nelse\ncur-rr = [next rr in list]\nif (not empty [FLAG in cur-rr])\nnaptr-done = true\n}\nport = -1\nif ([FLAG in cur-rr is \"S\"])\n{\nSRV-RRset = [DNSlookup of SRV RRs for target]\n; Next line is changed from Appendix A.1\n[Sort SRV RRset using the algorithm described on page 4 of IETF RFC 2782 [8]]\ntarget = [target of first RR of SRV-RRset]\nport = [port in first RR of SRV-RRset]\n}\n; now, whether it was an \"S\" or an \"A\" in the NAPTR, we\n; have the target for an A record lookup\n;  Remaining lines are changed from Appendix A.1 of RFC 3958\n; or AAAA record lookup\nIPv4_hosts = [DNSlookup of A RRs for target]\nIPv6_hosts = [DNSlookup of AAAA RRs for target]\nrandomized order of IPv4_hosts and IPv6_hosts\nhostname = [target]\nreturn (hostname, usable-service-protocol-set, IPv4_hosts, IPv6_hosts, port)\nThe significant differences in the above Pseudo-Code and the IETF RFC 3958 [9] Pseudo-Code are :\nA)\t[Sort SRV RRset using the algorithm described on page 4 of IETF RFC 2782 [8]] which was changed from[sort SRV-RRset based on PREF]The Pseudo-Code in IETF RFC 3958 [9] simply has an error. There isn't even a PREF in a SRV record. Again see page 4 of IETF RFC 2782 [8] for the proper procedure. The NAPTR weight is defined to be 65535 - NAPTR preference and is handled analogously to the SRV case.\nB)\tIETF RFC 3958 [9] Appendix A.1 starts with \"Assuming the client supports 1 protocol for a particular application\" so the pseudo-code obviously was designed for one protocol at a time. The lines with usable-service-protocol-set and compatable-service-protocol-set above are the most important change to support multiple service/protocol combinations and are really the primary reason for providing the above Pseudo-Code.\nThere are two possible ways to interpret the last paragraph of clause 2.2.5 of IETF RFC 3958 [9] when a list of multiple services/protocols is desired. One is the above interpretation using \"set interclause\" which allows multiple services/protocols. The other is to run the above procedure for one service and protocol at a time from the \"desired service_and_protocol_set\" and get a separate list for each service and protocol. In both approaches the relative ordering within a particular service and protocol is identical. If the proper interpretation of IETF RFC 3958 [9] is one service and protocol at a time, then the IETF RFC 3958 [9] does not define order between different service or protocols. Thus 3GPP is free to order between different 3GPP service and protocol types so long as the order within a service and protocol is respected. The above method does respect the order within a service and protocol therefore it is valid in either interpretation of clause 2.2.5 of IETF RFC 3958 [9] and also valid in IETF RFC 3402 [14]).\nThe remaining changes in Pseudo-Code above are minor and mostly intended to show that the S-NAPTR procedure logically outputs following:\n(hostname, usable-service-protocol-set, IPv4_hosts, IPv6_hosts, port)\nwhere the returned hostname is the FQDN of the topologically aware node name with topon/topoff and interface information.\nNOTE:\tLookup of the A and AAAA records to get the IPv4 and IPv6 addresses may be deferred until they are needed to contact a selected server as an optional optimization.\nIn the 3GPP scope, a full implementation of RFC 3958 SHALL implement \"backtracking\" as described by IETF RFC 3958 [9] clause 2.2.4 as required in clause B.2.\nFor simplicity of the presentation in this Annex we assume a full IETF RFC 3958 [9] implementation with a call back interface as described in Appendix A.2 of the IETF RFC 3958 [9].\nprocedure S_NAPTR_to_callback(targetFQDN,\ndesired_service_and_protocol_set,\ncall_back_function)\nwhere the call_back_function has interface\ncall_back_function (hostname, usable_service_and_protocol_set, port, IPv4_list,IP6_list)\nThe call_back_function returns \"stop\" if it does not want more records otherwise it returns \"looking\" and will be called with the next record.\nC.2\tS-NAPTR procedure - no topon\nIf topological closeness is not stated as specifically applicable to a procedure, or all node names are prefixed with \"topoff\", and if collocation is stated as not applicable to a procedure, then the first interface that can be successfully connected to would be sufficient to be returned from the S-NAPTR procedure. The following pseudo-code shows how the procedure works.\n/*\n* The Callback function called from the S-NAPTR procedure\n* for each FQDN the S-NAPTR procedure finds..\n*/\nprocedure try_to_connect (hostname, service_and_protocol_set, port, IP4_list, IP6_list)\nBegin procedure\n//  Comment does procedure as outlined in C.1\nUse 3GPP procedures to try to connect in turn to all combinations\nof the service/protocols and IP addresses provided in the input.\nUpon first success return(stop);\nIf all fail return(looking);\nEnd procedure;\n};\n/*\n* The S-NAPTR procedure follows\n*\n*/\nprocedure connect_first_match (targetFQDN, desired_protocol_set)\nBegin procedure\nstatus:=S_NAPTR_to_callback(targetFQDN,\ndesired_service_and_protocol_set ,\ntry_to_connect);\nif status equals looking return(failure) else return(success);\nEnd procedure;\nC.3\tS-NAPTR procedure candidate list\nThe following procedure will get the complete candidate list. This is the \"sorted list of matches\" described in Appendix A.2 of IETF RFC 3958 [9]. This is used for an exhaustive search of all matches.\nIf the \"topon\" feature is specifically applicable to find \"close\" nodes, or collocation is applicable, then the simple approach of getting the first match as described in clause C.2 cannot be used. The S-NAPTR must be performed by exhaustive searching for all matching records since the best match by \"topon\" node name can be any record independent of S-NAPTR record ordering.\n/*\n* The Callback function called by the S-NAPTR procedure for\n* each found match..\n*/\nprocedure private_store_candidate_list (hostname,service_and_protocol_set, port,IP4_list,IP6_list)\nBegin procedure\nincrement  snaptr_output_order;\ncreate structure with fields\n(hostname, service_and_protocol_set,port,IP4_list,IP6_list,snaptr_output_order,List_Name)\nadd structure to end of candidate_list;\nreturn(looking);\nEnd procedure;\n/*\n* The procedure to find all candidate nodes.\n*\n*/\nprocedure get_candidate_list (targetFQDN, desired_service_and_protocol_set, List_Name)\nBegin procedure\ncandidate_list:= empty;\nsnaptr_output_order:=0;\n/*\n* The S-NAPTR resolving starts here.\n*/\nstatus:=S_NAPTR_to_callback(targetFQDN,\ndesired_service_and_protocol_set ,\nprivate_store_candidate_list);\nreturn(candidate_list);\nEnd procedure;\nThe procedure includes the NAPTR output ordering explicitly as a field with each record which is important in the context of \"topon\" matches and checks for collocated nodes.\nC.4\tS-NAPTR procedure pseudo-code with topon\nCollocation, when stated as specifically applicable in a procedure, takes precedence over other criteria such as topological ordering or S-NAPTR ordering. Topological ordering, when stated as specifically applicable in a procedure, takes precedence over S-NAPTR ordering. However, S-NAPTR ordering is used for ordering nodes with equivalent topological distances. Pseudo code below is informative and shows how to implement the ordering of record selection. See clause 4.3.2 for normative text.\nAssume two distinct types of nodes \"A\" and \"B\" are being checked for closeness and the best record pair is needed. First step, which is documented in each case in the main text of this document is to get two candidate lists using a procedure such as that outlined in clause C.3.\ncandidate_list_A:= get_candidates (targetFQDN_A,desired_service_and_protocol_set_A, \"A\");\ncandidate_list_B:= get_candidates (targetFQDN_B,desired_service_and_protocol_set_B, \"B\");\nAs an example take the selection of a PGW and SGW by an MME during a UE initial attach procedure. Both a PGW and SGW need to be selected and if \"topon\" is used in both lists the selected pair is to be as close as possible (collocated being the closest).\nSometimes one list in the procedure is not found by DNS (or was found previously) because the node was already selected. In that case, one of the candidate lists can be just one node.\nFor example, an UE with an existing PDN connection adds a new PDN connection to a different APN, which may result in a different PGW but needs to continue using the current SGW. Here one of the two candidate lists would just be the data for the current SGW node (i.e., its node name and whether it supports GTPv2 and/or PMIPv6 for S5/S8).\nThe following pseudo-code illustrates topological matching with full ordering.\nprocedure topo_matching  (candidate_list_A,candidate_list_B, topology_check, colocation_check)//  Comment: topology_check and colocation_check are booleans indicating if those checks are done\nBegin procedure\npaired_sets_list:=empty;\nif (colocation_check)\nBegin if\ntotal_list:= candidate_list_A appended with candidate_list B;\n// Comment:  Below canonical_node_name is the hostname with first two labels removed\nForeach unique canonical_node_name from total_list do\nBegin foreach\nForeach servce and protocol do\nBegin foreach\nfull_match_list:= get all records from total_list with service and protocol\nand canonical_node name\nIf there is at least one \"A\" record and one \"B\" record in full_match_list then\nBegin If\ndegree:=256;\nsuffix:=canonical_node_name;\ncreate structure with fields\n(degree, suffix,service_and_protocol,full_match_list)\nadd that structure to paired_sets_list\nEnd If\nEnd foreach\nEnd foreach\nEnd if;\nif (topology_check)         Begin if\nmax_labels:= (maximum number of DNS labels in total_list)-  2\nelse\nmax_labels =0;\nEnd If;\nfrom number_labels_to_match:=  max_labels down to 0 do\nBegin do\nif number_labels_to_match equals 0 then\nBegin if\ntotal_list:= candidate_list_A appended with candidate_list B\nelse\ntotal_list:= get all records from candidate_list_A and candidate_list_B                             with \"topon\" as first label and hostname has at least\n(number_labels_to_match+2) labels\n// Comment: Add 2 since the first two labels are not part of the node name         End If;\n// Comment:  Below suffix is a hostname chopped off to include only the last number_labels_to_match\nForeach unique suffix from total_list do\nBegin foreach\nForeach servce and protocol do\nBegin foreach\nfull_match_list:= get all records from total_list with service and protocol\nand suffix contained in end of the hostname\nIf there is at least one \"A\" record and one \"B\" record in full_match_list then\nBegin If\ndegree:=number_labels\ncreate structure with fields\n(degree, suffix,service_and_protocol,full_match_list)\nadd that structure to paired_sets_list\nEnd If\nEnd foreach\nEnd foreach\nEnd do\nsort paired_sets by degree\nreturn (paired_sets_list)\nEnd Procedure;\nNOTE 1:\tMatching collocated nodes get a degree of 256, which is above any normal match. Also the above procedure is specific to this document and is not a part of S-NAPTR.\nNOTE 2:\tOrder from S-NAPTR is from one S-NAPTR procedure. There is no meaningful order obtained from S-NAPTR between records from two different S-NAPTR procedures. So one node type will be selected \"logically first\" based on other criteria outside S-NAPTR information.\nThe above procedure simply creates a list of records which are sorted by decreasing degree of matching in DNS labels. It also gives the list of paired nodes with the same suffix and compatible service which is needed by the 3GPP application.\nSince highest degree is preferred over S-NAPTR ordering with \"topon\" labels the selection is done by degree starting with the highest degree obtaining only the possible \"A\" and \"B\" nodes at that degree. A sublist of the paired_sets_list containing the highest degree is taken from paired_sets_list denoted as degree_sublist. Assume the \"A\" node is to be selected \"logically first\". Sort the \"A\" parts of degree_sublist in increasing \"snaptr_output_order\". For the records in that order try to connect to the node with the service and protocol in the record using 3GPP procedures. On failure proceed with the next record. When that degree_sublist is exhausted then degree-1 is tried and so on until an \"A\" node is selected. Once an \"A\" node is chosen, the procedure has also a selected degree, suffix and service.\nNOTE 3:\tThe remaining part of this procedure is not needed if the \"B\" node was already pre-selected outside the present procedure.\nTaking the degree_sublist used to select the \"A\" node create a new sublist from only records with the same service, same protocol and suffix. Remove the \"A\" node records from that sublist. Sort this new sublist by increasing \"snaptr_output_order\" (see clause C.3). Using the records in that order try to connect to the \"B\" nodes with the service and protocol in the record. On a failure proceed with the next record. When that list is exhausted the procedure continues in next paragraph.\nNOTE 4:\tThe suffix of the \"A\" node that was selected influences which \"B\" nodes are closest to it. We can't easily and simply reuse the above structure for that reason and it is easier to \"reset\" the procedure.\nA new candidate_list_A is created consisting only of the selected \"A\" node A and service_and_protocol. The procedure \"topo_matching \" is run again giving a new paired_sets_list. The \"A\" node records are removed from the new paired_sets_list leaving only \"B\" nodes. Sort the records in paired_sets_list in decreasing order of degree and within degree in increasing \"snaptr_output_order\" (see clause C.3). Using the records in that order try to connect to the \"B\" nodes with the service in the record. On failure go to next record.\nNOTE 5:\tFailing to actually contact a node should result in the failing node(s) to be removed from consideration for a period of time. Such removal is not detailed above. Also a reasonable implementation would give up after some maximum number of failed attempts.\nAnnex D (Informative):SGSN examples\nD.1\tIntroduction\nThis annex includes examples of the DNS provisioning needed for an SGSN discovery and selection procedures. Examples are not exhaustive either in scope or in content but are intended to be sufficient to illustrate the general techniques and some of the more important use cases.\nD.2\tPreconditions\nProvisions of annex A.2 apply also here.\nD.3\tSGSN file\nA NAPTR record is required to be provisioned under the NRI-RAI FQDN (see clause 4.3.3.5 of this TS). The format of the NRI-RAI FQDN is nri-sgsn<NRI>.rac<RAC>.lac<LAC>.rac as defined in clause 19.4.2.6 of 3GPP TS 23.003 [4].\nThe nri-sgsn<NRI>.rac<RAC>.lac<LAC>.rac is also the natural place for the SGSN canonical node record set. For this example we place the SGSN canonical node records and the required record for the lookup at the same location both for simplicity and better DNS caching.\nFor this example we have two SGSNs with NRI codes of 1 and 2 respectively and both in the same SGSN pool (LAC = 1000 hexadecimal and RAC = 0003 hexadecimal).\n;\n; This is the P-TMSI and RAI related record and the SGSN node record\n; The operator has decided to use the 3GPP name as the canononical node name of the SGSN\n; rather than having two records (the 3GPP one and an operator defined value)\n;\nnri-sgsn01.rac0003.lac1001.rac\n;    IN NAPTR order pref. flag service                    regexp  replacement\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s4\"  \"\"  topoff.eth1.nri-sgsn01.rac0003.lac1001.rac\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s3\"  \"\"  topoff.eth2.nri-sgsn01.rac0003.lac1001.rac\nIN NAPTR 300   999   \"a\"   \"x-3gpp-sgsn:x-gn\"  \"\"  topoff.eth3.nri-sgsn01.rac0003.lac1001.rac\n;\n; Reminder: Canonical node name records must be complete.\n; In most cases the interface type (S3 etc) is functionally determined so the NAPTR order is rarely\n; used in this record set. The S3 is preferred over over Gn.\n;\n; Of course if the SGSN had multiple S3 interfaces\n; the operator could provision more than one S3 record with different orders\n; perhaps to select S3 IPv6 over S3 IPv4\n; We have the same type of records for the other SGSN (same comments would apply)\n;\nnri-sgsn02.rac0003.lac1001.rac\n;    IN NAPTR order pref. flag service                    regexp  replacement\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s4\"  \"\"  topoff.eth1.nri-sgsn02.rac0003.lac1001.rac\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s3\"  \"\"  topoff.eth2.nri-sgsn02.rac0003.lac1001.rac\nIN NAPTR 300   999   \"a\"   \"x-3gpp-sgsn:x-gn\"  \"\"  topoff.eth3.nri-sgsn02.rac0003.lac1001.rac\n;\n; All SGSN IP addresses for both SGSNs\n;\ntopoff.eth1.nri-sgsn01.rac0003.lac1001.rac IN A 192.0.2.11\nIN A 192.0.2.12\nIN AAAA 2001:db8:0:0:0:0:0:0\nIN AAAA 2001:db8:0:1:0:0:0:0\ntopoff.eth2.nri-sgsn01.rac0003.lac1001.rac IN A 192.0.2.13\nIN A 192.0.2.14\nIN AAAA 2001:db8:0:2:0:0:0:0\nIN AAAA 2001:db8:0:3:0:0:0:0\ntopoff.eth3.nri-sgsn01.rac0003.lac1001.rac IN A 192.0.2.15\nIN A 192.0.2.16\nIN AAAA 2001:db8:0:4:0:0:0:0\nIN AAAA 2001:db8:0:5:0:0:0:0\ntopoff.eth1.nri-sgsn02.rac0003.lac1001.rac IN A 192.0.2.17\nIN A 192.0.2.18\nIN AAAA 2001:db8:0:6:0:0:0:0\nIN AAAA 2001:db8:0:7:0:0:0:0\ntopoff.eth2.nri-sgsn02.rac0003.lac1001.rac IN A 192.0.2.19\nIN A 192.0.2.20\nIN AAAA 2001:db8:0:8:0:0:0:0\nIN AAAA 2001:db8:0:9:0:0:0:0\ntopoff.eth3.nri-sgsn02.rac0003.lac1001.rac IN A 192.0.2.21\nIN A 192.0.2.22\nIN AAAA 2001:db8:0:10:0:0:0:0\nIN AAAA 2001:db8:0:11:0:0:0:0\n; end of file\nThe partially qualified SGSN host names are topoff.eth1.nri-sgsn01.rac0003.lac1001.rac and topoff.eth1.nri-sgsn02.rac0003.lac1001.rac, and similar.\nThe fully qualified SGSN node names are the relatively long\nnri-sgsn01.rac0003.lac1001.rac.epc.mnc990.mcc311.3gppnetwork.org.\nand\nnri-sgsn02.rac0003.lac1001.rac.epc.mnc990.mcc311.3gppnetwork.org.\nwhich are obtained by appending the value of $ORIGIN to the partially qualified SGSN node names. As stated before we will use the partially qualified names in this Annex to avoid this visual clutter and for typographical reasons.\nD.4\tNull-NRI/SGSN Group ID file for DCN\nA NAPTR record is required to be provisioned under the RAI FQDN (see clause 5.8.3). The format of the RAI FQDN is rac<RAC>.lac<LAC>.rac as defined in clause 19.4.2.5 of 3GPP TS 23.003 [4].\nFor this example we have two SGSN pools represented by SGSN Group ID (sgsngi=0001) and Null-NRI (null-nri=0005). Each pool has two SGSNs with NRI code of 1, 2 and 3, 4 respectively.\n;\nrac0003.lac1001.rac\n;    IN NAPTR order pref. flag service                    regexp  replacement\nIN NAPTR 100   999   \"a\"   \"x-3gpp-sgsn:x-gn+ue-1.10.20\"    \"\"  topoff.eth1.nri-sgsn0001.sgsngi0001.rac0003.lac1001.rac\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s16+ue-1.10.20\"   \"\"  topoff.eth3.nri-sgsn0002.sgsngi0001.rac0003.lac1001.rac\nIN NAPTR 100   999   \"a\"   \"x-3gpp-sgsn:x-gn+ue-2.5\"        \"\"  topoff.eth1.nri-sgsn0003.null-nri0005.rac0003.lac1001.rac\nIN NAPTR 200   999   \"a\"   \"x-3gpp-sgsn:x-s16+ue-2.5\"       \"\"  topoff.eth3.nri-sgsn0004.null-nri0005.rac0003.lac1001.rac\n;\n;From above records, Null-NRI and SGSN Group ID information can be retrieved when necessary.\nAnnex E (Informative):SGW/PGW selection examples using GTP-C load control\nE.1\tPGW selection using GTP-C load control at node level\nThis example illustrates the principles of the SGW or PGW selection specified in clause 4A.2, with GTP-C load control supported and enabled at node level.\nThe example assumes that the procedures specified in this document have 3 candidate PGWs with the same relative order, (e.g. with the same topological order) and assume that the following weights are received from the DNS and \"Load Metric\" reported via GTP-C signalling:\nPGW1: DNS-weight-factor = 20, Load-metric = 10%\nPGW2: DNS-weight-factor = 20, Load-metric = 20%\nPGW3: DNS-weight-factor = 60, Load-metric= 30%\nBased on the above, the selecting node calculates the effective available load for each candidate PGW:\nPGW1-effective-available-load = (100 – 10)% X 20 = 18\nPGW2-effective-available-load = (100 – 20)% X 20 = 16\nPGW3-effective-available-load = (100 – 30)% X 60 = 42\nThe selecting node then calculates the relative available load of each candidate PGW (rounding-off to nearest integer value):\nPGW1-relative-available-load = 18 / (18 + 16 + 42) =~ 24%\nPGW2-relative-available-load = 16 / (18 + 16 + 42) =~ 21%\nPGW3-relative-available-load = 42 / (18 + 16 + 42) =~ 55%\nOut of the total new session requests, the node selects the PGW1, PGW2 and PGW3 for 24%, 21% and 55% respectively, e.g. per 100 new sessions requests, the PGW1 is selected for 24 sessions, PGW2 for 21 sessions and PGW3 for the remaining 55 new sessions.\nE.2\tPGW selection using GTP-C load control at APN level\nE. 2.1\tPGW selection when APN load control information is available for each candidate PGW\nThis example illustrates the principles of the PGW selection specified in clause 4A.3, with GTP-C load control supported and enabled at node level and APN level.\nThe example assumes that the procedures specified in this document have 3 candidate PGWs with the same relative order, (e.g. with the same topological order) and assume that the following weights are received from the DNS and APN load control information reported via GTP-C signalling:\nPGW1: DNS-weight-factor = 20, APN1-Load-metric = 60%, APN1-relative-capacity = 50%\nPGW2: DNS-weight-factor = 20, APN1-Load-metric = 50%, APN1-relative-capacity = 20%\nPGW3: DNS-weight-factor = 60, APN1-Load-metric= 50%, APN1-relative-capacity = 10%\nBased on the above, the APN1-effective-available-load is calculated as follows:\nPGW1-APN1-effective-available-load = (100 – 60)% X 50% X 20 = 4\nPGW2-APN1-effective-available-load = (100 – 50)% X 20% X 20 = 2\nPGW3-APN1-effective-available-load = (100 – 50)% X 10% X 60 = 3\nThen the APN1-relative-available-load is calculated as below (by rounding-off to nearest integer value):\nPGW1-APN1-relative-available-load = 4 / (4 + 2 + 3) =~ 45%\nPGW2-APN1-relative-available-load = 2 / (4 + 2 + 3) =~ 22%\nPGW3-APN1-relative-available-load = 3 / (4 + 2 + 3) =~ 33%\nOut of the total new session requests for APN1, the PGW1 is selected for 45%, PGW2 for 22% and PGW3 for 33%, e.g. per 100 new sessions requests for APN1, the PGW1 is selected for 45 sessions, PGW2 for 22 sessions and PGW3 for 33 sessions.\nE.2.2\tPGW selection when APN load control information is not available for each candidate PGW\nThis example illustrates the principles of the PGW selection specified in clause 4A.3, with GTP-C load control supported and enabled at node level and APN level.\nThe example assumes that the procedures specified in this document have 3 candidate PGWs with the same relative order, (e.g. with the same topological order) and assume that the following weights are received from the DNS and APN load control information reported via GTP-C signalling; it is assumed in particular that PGW3 did only report APN load control information for the APN2.\nPGW1: DNS-weight-factor = 20, APN1-Load-metric = 60%, APN1-relative-capacity = 50%\nPGW2: DNS-weight-factor = 20, APN1-Load-metric = 50%, APN1-relative-capacity = 20%\nPGW3: DNS-weight-factor = 60, APN2-Load-metric= 50%, APN2-relative-capacity = 30%, PGW3-Load-Metric 40%\nBased on the above, the APN1-effective-available-load for the PGW3 is calculated assuming the following:\nPGW3-APN1-relative-capacity =  100% – 30% = 70%\nPGW3-APN1-load-metric = {40% - (50% X 30%)} / {(100% – 30%)} = {40% - 15%} / {70%} = ~36%\nAnnex F (Informative):Examples for AMF Discovery by 5G AN\nF.1\tIntroduction\nThis annex provides examples of DNS provisioning for AMF Discovery by 5G AN.\nF.2\tPreconditions\nSee annex A.2.\nF.3\tExample of an AMF Region with 2 AMF Sets\nF.3.1\tMaster file\nThe master file for this example has following content.\n$ORIGIN 5gc.mnc990.mcc311.3gppnetwork.org.\n;\n$TTL\t600 ;  10 minutes  - this directive is defined in IETF RFC 2308 not IETF RFC 1035\n;\n$INCLUDE SOA_DB.txt\n;\n$INCLUDE AMFSET_DB.txt\n;\n; End of file\nF.3.2\tSOA and NS records\nSee Annex A.3.3.\nF.3.3\tAMF Set file\nThe file containing the AMF Set records for this example will be AMFSET_DB.txt and has following NAPTR record content.\nIn this example, we have two AMF Sets 1 and 2, in AMF Region 48 (hexadecimal), with 2 AMFs available in each AMF Set.\n; AMF Set 1 of AMF Region 48\nset001.region48.amfset\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-amf:x-n2\"                  \"\"  topoff.amf11.amf\nIN NAPTR 100   999   \"a\" \"x-3gpp-amf:x-n2\"                  \"\"  topoff.amf12.amf\n; AMF Set 2 of AMF Region 48\nset002.region48.amfset\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-amf:x-n2\"                  \"\"  topoff.amf21.amf\nIN NAPTR 100   999   \"a\" \"x-3gpp-amf:x-n2\"                  \"\"  topoff.amf22.amf\n; AMFs IP addresses\n;\ntopoff.amf11.amf\tIN A 192.0.2.11\nIN A 192.0.2.12\nIN AAAA 2001:db8:0:0:0:0:0:0\nIN AAAA 2001:db8:0:1:0:0:0:0\ntopoff.amf12.amf\tIN A 192.0.2.13\nIN A 192.0.2.14\nIN AAAA 2001:db8:0:2:0:0:0:0\nIN AAAA 2001:db8:0:3:0:0:0:0\ntopoff.amf21.amf\tIN A 192.0.2.17\nIN A 192.0.2.18\nIN AAAA 2001:db8:0:6:0:0:0:0\nIN AAAA 2001:db8:0:7:0:0:0:0\ntopoff.amf22.amf\tIN A 192.0.2.19\nIN A 192.0.2.110\nIN AAAA 2001:db8:0:8:0:0:0:0\nIN AAAA 2001:db8:0:9:0:0:0:0\n; end of file\nAnnex G (Informative):Examples for selecting an alternative PGW-C/SMF in a PGW-C/SMF Set\nG.1\tIntroduction\nThis annex provides examples of DNS provisioning for selecting an alternative PGW-C/SMF in a PGW-C/SMF Set by an MME or ePDG (see clause 5.1.4).\nG.2\tPreconditions\nSee annex A.2.\nG.3\tExample of an PGW-C/SMF Set\nG.3.1\tMaster file\nThe master file in A.3.2 is appended with the following content.\n$ORIGIN epc.mnc990.mcc311.3gppnetwork.org.\n;\n; $TTL\t600 ;  10 minutes  - this directive is defined in IETF RFC 2308 not IETF RFC 1035\n;\n; $INCLUDE SOA_DB.txt\n;\n$INCLUDE PGWSET_DB.txt\n;\n; End of file\nG.3.2\tSOA and NS records\nSee Annex A.3.3.\nG.3.3\tPGW-C/SMF Set file\nThe file containing the PGW-C/SMF Set records for this example will be PGWSET_DB.txt and has following NAPTR record content.\n; PGW Set 12\nset12.pgwset\n;  IN NAPTR order pref. flag service                        regexp replacement\nIN NAPTR 100   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp:x-s2b-gtp\"    \"\" topoff.vip1.gw01.nodes\nIN NAPTR 200   999   \"a\" \"x-3gpp-pgw:x-s5-gtp:x-s8-gtp:x-s2b-gtp\"    \"\" topoff.vip1.gw21.nodes\n; PGWs IP addresses\n;\ntopoff.vip1.gw01.nodes\t         IN A 192.0.2.11\nIN A 192.0.2.12\nIN AAAA 2001:db8:0:0:0:0:0:0\nIN AAAA 2001:db8:0:1:0:0:0:0\ntopoff.vip1.gw21.nodes\t\t\t IN A 192.0.2.13\nIN A 192.0.2.14\nIN AAAA 2001:db8:0:2:0:0:0:0\nIN AAAA 2001:db8:0:3:0:0:0:0\n; end of file\nAnnex H (Informative):Change history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nCat\nSubject/Comment\nNew\n2008-12\nCT#42\nCP-080714\nV2.0.0 approved in CT#42\n8.0.0\n2009-03\nCT#43\nCP-090054\n0001\n1\nDNS examples\n8.1.0\n0002\n2\nDNS  cleanup regarding topon/topoff\n0003\n1\nMissing clause for node name records of SGW\n0004\n1\nDNS Editorial cleanup\n0005\nSGW Selection for TAU and Handover\n0007\n1\nCorrection to DNS procedures\n0008\n2\nClarifications to NAPTR flag usage\n0009\n1\n2009-06\nCT#44\nCP-090291\n0010\n1\nHome agent discovery\n8.2.0\n0011\n1\nCorrection for PGW selection for colocated PGW/GGSN\n0012\n1\nHandling when hostnames are missing topon/topoff\n0013\n1\nRelease 8 SGSN clarifications\n2009-06\nCT#44\nCP-090542\n0015\nIncorrect FQDN nodes.mnc<MNC>.mcc<MCC>.3gppnetwork.org\n8.3.0\n0017\n3\nFailure of DNS procedures\n0018\n1\nCorrection about discovering and selecting a PGW and SGW\n2009-12\n-\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2010-03\nCT#47\nCP-100019\n0024\n2\nAPN-FQDN construction\n9.1.0\n2010-09\nCT#49\nCP-100457\n0027\n1\nConstruction of APN-FQDN\n9.2.0\n2010-12\nCT#50\nCP-100678\n0030\n3\nAdd missing MME/SGSN selection for the RIM procedure\n9.3.0\n2010-12\nCT#50\nCP-100686\n0029\n1\nPGW selection by ePDG with GTP over S2b\n10.0.0\nCP-100684\n0033\n3\nSIPTO support in DNS\nCP-100684\n0036\n2\nGW selection for SIPTO based on eNodeB id\nCP-100693\n0034\nCorrecting clause numbers in Annex A.3\nCP-100693\n0035\n1\nClarifications to DNS Based GW Selection in Roaming Cases\nCP-100693\n0037\n1\nCorrection in Annex C\n2011-03\nCT#51\nCP-110057\n0038\n2\nGGSN selection for SIPTO APN\n10.1.0\nCP-110057\n0045\n2\nGW selection based on RAI/RNC-ID/TAI/eNodeb ID\nCP-110056\n0039\n2\nPGW selection for LIPA\nCP-110076\n0042\n1\nAdding SGSN selection cases\nCP-110076\n0044\n2\nDNS Service for Sv\nCP-110076\n0047\n1\nMME selection\nCP-110088\n0043\n3\nDNS procedure for Relay Node OAM system discovery\nCP-110059\n0046\nService parameter for the GTP based S2b\n2011-06\nCT#52\nCP-110364\n0051\n1\nServices of a MME from MME node name\n10.2.0\nCP-110374\n0049\n1\nSGSN Selection\n2011-07\nEditorial correction to history table.\n10.2.1\n2011-09\nCT#53\nCP-110567\n0056\n2\nSGSN selection\n10.3.0\n2012-03\nCT#55\nCP-120028\n0058\n1\nSGSN selection\n11.0.0\nCP-120045\n0061\n1\nPGW discovery for GTP based S2a\n2012-06\nCT#56\nCP-120234\n0062\n2\nDNS procedure for CS to PS SRVCC\n11.1.0\n2012-09\nCT#57\nCP-120447\n0064\n1\nPGW selection in eHRPD for SIPTO\n11.2.0\nCP-120457\n0065\n1\nSGW selection based on eNodeB ID\n2013-06\nCT#60\nCP-130378\n0067\n1\nGWs selection for SIPTO at the local network\n12.0.0\n2013-09\nCT#61\nCP-130453\n0069\n2\nSGW selection for SIPTO at the Local Network\n12.1.0\nCP-130462\n0070\n2\nGERAN Iu Mode\n2013-12\nCT#62\nCP-130620\n0071\n1\nSGW selection for SIPTO at the Local Home Network\n12.2.0\n2014-06\nCT#64\nCP-140230\n0076\n1\nCleanup the pre-Release-8 DNS procedure on Release-8 SGSN\n12.3.0\n2014-09\nCT#65\nCP-140505\n0077\n2\nSGW/PGW selection with GTP-C node level load control\n12.4.0\nCP-140505\n0078\n2\nPGW selection with GTP-C APN level Load Control\n2014-12\nCT#66\nCP-140797\n0079\n3\nMME and SGSN selection by RCAF\n13.0.0\n2015-06\nCT#68\nCP-150270\n0080\n3\nMultiple IP addresses in DNS Record\n13.1.0\n2015-12\nCT#70\nCP-150781\n0082\n2\nDNS procedures for Decor\n13.2.0\nCP-150765\n0083\n-\nPriority ordering of SRV records\n2016-03\nCT#71\nCP-160038\n0084\n1\nGTP-C Load Control – Mix of NAPTR records with \"s\" and \"a\" flags\n13.3.0\nCP-160022\n0085\n1\nClarification on the use of UE Usage Type\nCP-160022\n0086\n4\nDNS procedures for Decor\nCP-160033\n0087\n3\nImpacts on the DNS procedures for CIoT with introduction of NB-IoT and Non-IP\n2016-06\nCT#72\nCP-160224\n0088\n1\nMME and SGSN selection procedures for Dedicated Core Networks\n13.4.0\n2016-06\nCT#72\nCP-160228\n0089\n2\nClarification on the DNS impact for CIoT\n13.4.0\n2016-09\nCT#73\nCP-160435\n0090\n1\nUse of DNS to select a GGSN handling Non-IP data\n14.0.0\n2016-12\nCT#74\nCP-160680\n0092\n1\nUse of DéCOR for NonIP_GPRS\n14.1.0\n2016-12\nCT#74\nCP-160680\n0096\n-\nGW selection by S4-SGSN for Non-IP PDN type\n14.1.0\n2016-12\nCT#74\nCP-160665\n0094\n1\nDECOR for GPRS Core\n14.1.0\n2017-06\nCT#76\nCP-171036\n0097\n1\nUP function selection by DNS\n14.2.0\n2017-09\nCT#77\nCP-172015\n0099\n-\nPGW selection for WLAN with deployed DCNs\n14.3.0\n2017-09\nCT#77\nCP-172020\n0100\n-\nMissing CUPS stage 3 reference\n14.3.0\n2017-12\nCT#78\nCP-173036\n0104\n4\nSGW/PGW selection for NR\n15.0.0\n2018-03\nCT#79\nCP-180020\n0107\n1\nCorrection for indicating DCNR to Combined SGW/PGW\n15.1.0\n2018-06\nCT#80\nCP-181132\n0108\n1\nSelection of a combined PGW/SMF for interworking with 5GS\n15.2.0\n2018-09\nCT#81\nCP-182067\n0109\n-\nDNS records for selecting a node with a network capability in a Dedidated Core Network\n15.3.0\n2018-09\nCT#81\nCP-182084\n0110\n1\nEPS interworking with 5GS\n15.3.0\n2018-09\nCT#81\nCP-182084\n0111\n1\nAMF Discovery by 5G AN\n15.3.0\n2018-12\nCT#82\nCP-183092\n0115\n3\nProcedures to support interworking with 5GC\n15.4.0\n2018-12\nCT#82\nCP-183092\n0116\n-\nCorrections to references in clause 7.2\n15.4.0\n2018-12\nCT#82\nCP-183092\n0117\n1\nEPS interworking with 5GS\n15.4.0\n2019-03\nCT#83\nCP-190032\n0118\n-\nPGW/SMF selection by ePDG\n15.5.0\n2019-03\nCT#83\nCP-190032\n0119\n-\nIncomplete references for AMF discovery and selection by MME\n15.5.0\n2019-09\nCT#85\nCP-192188\n0120\n1\nSelection of MME_SRVCC\n16.0.0\n2019-09\nCT#85\nCP-192126\n0121\n1\nDNS procedures to support Ethernet PDN\n16.0.0\n2019-12\nCT#86\nCP-193041\n0122\n1\nUEs not supporting 5GC NAS with a 5GS subscription\n16.1.0\n2020-03\nCT87e\nCP-200021\n0126\n-\nUCMF Selection by MMEs\n16.2.0\n2020-06\nCT#88e\nCP-201062\n0127\n-\nService parameter for SGW\n16.3.0\n2020-12\nCT#90e\nCP-203058\n0129\n1\nSupport of PGW-C/SMF change\n17.0.0\n2021-03\nCT#91e\nCP-210049\n0131\n-\nDCN support for AMF discovery\n17.1.0\n2021-12\nCT#94e\nCP-213097\n0132\n-\nB\nProcedure to select a combined UPF/MB-UPF\n17.2.0\n2022-03\nCT#95e\nCP-220092\n0133\n1\nF\nIncorrect reference in clause 7.2\n17.3.0\n2023-06\nCT#100\nCP-231074\n0134\n-\nF\nDiscovery by an ePDG of a PGW-C/SMF from a PGW-C/SMF Set\n17.4.0\n2024-03\nCT#103\nCP-240061\n0135\n1\nF\nDNS procedure to resolve the Alternative PGW-C/SMF FQDN\n17.5.0\n2024-03\nCT#103\nCP-240053\n0138\n3\nF\nCorrections on the Core-Network Restriction\n18.0.0",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.501_clause_6.3.5",
        "ts_23.003_clause_28.3.2.7",
        "clause_5",
        "clause_4.3.3.4",
        "ts_23.003_clause_19.4.3",
        "ts_23.003_clause_19.4.2.2",
        "clause_19.4.2.3",
        "clause_19.4.3",
        "clause_4.3.2",
        "clause_2.2.4",
        "clause_2.2.5",
        "clause_3.3",
        "clause_4.3.3.5",
        "ts_23.003_clause_19.4.2.6",
        "clause_5.8.3",
        "ts_23.003_clause_19.4.2.5",
        "clause_4",
        "clause_5.1.4",
        "clause_7.2",
        "ts_23.501",
        "ts_23.003"
      ]
    }
  ]
}