{
  "metadata": {
    "specification_id": "ts_23.380",
    "version": "18.1.0",
    "title": "3GPP TS 23.380",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23380-i10/23380-i10.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:26:42.941702",
    "total_chunks": 90
  },
  "chunks": [
    {
      "chunk_id": "ts_23.380_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document specifies the procedures required in 3GPP IMS to handle a S-CSCF or a P-CSCF service interruption scenario with minimum impact to the service to the end user.\nNOTE:\tIMS Restoration Procedures covering service interruption of other network elements are not defined in this version of the specification.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.007: \"Restoration procedures\".\n[3]\t3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx interfaces; Signalling flows and message contents\".\n[4]\t3GPP TS 24.008: \"Mobile radio interface Layer 3 specification\".\n[5]\t3GPP TS 29.213: \"Policy and charging control signalling flows and Quality of Service (QoS) parameter mapping\".\n[6]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[7]\t3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".\n[8]\t3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunnelling Protocol (GTP) across the Gn and Gp interface\".\n[9]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[10]\t3GPP TS 29.274: \"3GPP Evolved Packet System. Evolved GPRS Tunnelling Protocol for EPS (GTPv2)\".\n[11]\tIETF RFC 3361: \"Dynamic Host Configuration Protocol (DHCP-for-IPv4) Option for Session Initiation Protocol (SIP) Servers\".\n[12]\tIETF RFC 1034: \"Session Initiation Protocol (SIP): Locating SIP Servers\".\n[13]\tIETF RFC 3319: \"Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers\".\n[14]\tIETF RFC 6223: \"Indication of Support for Keep-Alive\".\n[15]\t3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and Tunnelling protocols; Stage 3\".\n[16]\tIETF RFC 7077: \"Update Notifications for Proxy Mobile IPv6\".\n[17]\t3GPP TS 23.401: \"GPRS Enhancements for E-UTRAN Access\".\n[18]\tIETF RFC 3261: \"SIP: Session Initiation Protocol\".\n[19]\t3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".\n[20]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[21]\tGSMA PRD IR.65: \"IMS Roaming and Interworking Guidelines, version 14.0\".\n[22]\t3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN access to EPC; Stage 3\".\n[23]\tIETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".\n[24]\t3GPP TS 29.273: \"Evolved Packet System (EPS); 3GPP EPS AAA interfaces\".\n[25]\tIETF RFC 3588: \"Diameter Base Protocol)\".\n[26]\tIETF RFC 5996 (September 2010): \"Internet Key Exchange Protocol Version 2 (IKEv2)\".\n[27]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[28]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[29]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[30]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[31]\t3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".\n[32]\t3GPP TS 29.512: \"5G System; Session Management Policy Control Service; Stage 3\".\n[33]\t3GPP TS 23.632: \"User Data Interworking, Coexistence and Migration; Stage 2\".\n[34]\t3GPP TS 24.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage 3\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_23.007",
        "ts_29.228",
        "ts_24.008",
        "ts_29.213",
        "ts_29.212",
        "ts_29.214",
        "ts_29.060",
        "ts_29.061",
        "ts_29.274",
        "ts_29.275",
        "ts_23.401",
        "ts_24.229",
        "ts_23.060",
        "ts_24.244",
        "ts_29.273",
        "ts_23.228",
        "ts_23.501",
        "ts_23.502",
        "ts_23.503",
        "ts_29.503",
        "ts_29.512",
        "ts_23.632",
        "ts_24.237"
      ]
    },
    {
      "chunk_id": "ts_23.380_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nService Interruption: A period of time in which one or more network elements do not respond to requests and do not send any requests to the rest of the system.\nS-CSCF Restoration Information: Information required for the S-CSCF to handle traffic for a registered user. This information is stored in HSS and if lost, retrieved by the S-CSCF.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.380_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\n5GC\t5G Core Network\nAPCO\tAdditional Protocol Configuration Options\nePCO\tExtended Protocol Configuration Options\nePDG\tEvolved Packet Data Gateway\nIKEv2\tInternet Key Exchange Protocol Version 2\nLIA\tLocation Information Answer\nLIR\tLocation Information Request\nLMA\tLocal Mobility Anchor\nNBIFOM\tNetwork-Based IP Flow Mobility\nPCF\tPolicy Control Function\nPCO\tProtocol Configuration Options\nPDU\tPacket Data Unit\nPGW\tPDN Gateway\nPMIP\tProxy Mobile IP\nRCS\tRich Communication Services\nSAA\tServer Assignment Answer\nSAR\tServer Assignment Request\nSGW\tServing Gateway\nSMF\tSession Management Function\nTWAN\tTrusted WLAN Access Network\nUAA\tUser Authorization Answer\nUAR\tUser Authorization Request\nUDM\tUnified Data Management\nUPF\tUser Plane Function\nVoLTE\tVoice over LTE\nWLAN\tWireless Local Area Network\nWLCP\tWireless LAN Control Plane Protocol",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.1",
      "section_id": "4.1",
      "section_title": "General",
      "content": "The following clauses describe the IMS Restoration Procedures for the S-CSCF service interruption in each of the scenarios where they apply.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.2.1",
      "section_id": "4.2.1",
      "section_title": "Introduction",
      "content": "The following clauses specify the behaviour of HSS and S-CSCF if they support the IMS restoration feature.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.2.2",
      "section_id": "4.2.2",
      "section_title": "S-CSCF Restoration after Failure",
      "content": "If the UE initiates a SIP REGISTER and the S-CSCF returned by the HSS during user registration status query procedure fails, the I-CSCF is unable to contact the S-CSCF. In this case, regardless of this registration is an initial registration, a re-registration or a de-registration, the I-CSCF shall send UAR with Authorization Type set to REGISTRATION_AND_CAPABILITIES to the HSS to explicitly request S-CSCF capabilities. After re-assignment of another S-CSCF according to the S-CSCF capabilities, the I-CSCF shall forward the REGISTER to the new S-CSCF. For registrations and re-registrations, S-CSCF shall proceed with the registration procedure as for initial registration, except for the clauses specified in 4.2.3.\nFor de-registrations, S-CSCF shall proceed as for user-initiated de-registration.\n4.2.2A\tSBI Support for S-CSCF Restoration after Failure\nIf the I-CSCF is unable to contact the currently assigned S-CSCF, regardless of this registration is an initial registration, a re-registration or a de-registration, the I-CSCF shall reselect an S-CSCF and forward the REGISTER to the new S-CSCF. The I-CSCF shall include a reselection indication in the REGISTER request. The S-CSCF shall proceed with the registration procedure as for initial registration. Additionally, the S-CSCF shall include the reselection indication towards the HSS.\nWhen receiving the reselection indication, the HSS shall allow the new S-CSCF to overwrite the current S-CSCF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.2.3",
      "section_id": "4.2.3",
      "section_title": "S-CSCF Restoration during Registration Process",
      "content": "During the registration procedure, the HSS shall send all the registered Private User Identities sharing the same Public User Identity which is being registered in the SAA, in addition to the basic user data to the S-CSCF. Subject to the operator policy, the HSS may include the S-CSCF restoration information for the registered Public User Identity in the response. Then the S-CSCF compares the registered Private User Identities received from the HSS with the ones it stores. If there are any registered Private User Identities the S-CSCF does not have their registration data, the S-CSCF shall send SAR with Server Assignment Type set to NO_ASSIGNMENT to the HSS to retrieve the S-CSCF restoration information for the registered Public User Identity. If there are S-CSCF restoration information related to the Public User Identity stored in the HSS, the HSS shall send the S-CSCF restoration information together with the user profile in the SAA to the S-CSCF. The result code shall be set to DIAMETER_SUCCESS. Subject to the operator policy, sending this SAR with Server Assignment Type set to NO_ASSIGNMENT may be skipped if the S-CSCF restoration information for the registered Public User Identity information was already received from the HSS.\nIf there are more than one group of S-CSCF restoration information related to the Public User Identity stored in the HSS, which may happen if the Public User Identity is shared by multiple Private User Identities, the HSS shall include all of the S-CSCF restoration information in the SAA. One group of S-CSCF restoration information corresponds to one Private User Identity.\nIf the S-CSCF receives an initial registration request for a Public User Identity that does not match any Public User Identity currently registered with the same Private User Identity as in the request at this S-CSCF, the S-CSCF shall check whether there is a reg-id parameter in the Contact header in the SIP REGISTER message and whether there is an \"sos\" SIP URI parameter in the SIP REGISTER message. Only when a reg-id parameter exists and an \"sos\" SIP URI parameter does not exist, the S-CSCF shall indicate to the HSS that the registration is related to a multiple registration.\nIf the HSS receives an SAR request with multiple registration indication, and the Public User Identity is stored as registered in the HSS, and there is restoration information related to the Private User Identity, the HSS shall not overwrite stored restoration information, instead, it shall send the stored S-CSCF restoration information together with the user profile in the SAA. Subject to the operator policy, the HSS may include all the S-CSCF restoration information groups associated to the registered Public User Identity in the response. The result code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. The S-CSCF shall send a new SAR with Server-Assignment-Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE to update the restoration information in the HSS in accordance to the current registration event.\nIf the S-CSCF receives a user-initiated deregistration request for a Public User Identity that does not match any Public User Identity currently registered with the same Private User Identity as in the request at this S-CSCF, the S-CSCF shall check whether there is a reg-id parameter in the Contact header in the received SIP REGISTER message,\n-\tif a reg-id parameter exists, the S-CSCF shall:\n1.\tSend SAR with Server-Asignment-Type set to NO_ASSIGNMENT to retrieve the S-CSCF restoration information associated with the Public User Identity. The Result-Code shall be set to DIAMETER SUCCESS.\n2.\tCompare the contact address(es) received in SAA with the contact address(es) in REGISTER request:\n-\tIf they are not the same, the S-CSCF shall send SAR with Server-Asignment-Type set to RE_REGISTRATION to update the S-CSCF restoration information in HSS with the Contact address(es) still associated with the Public User Identity after the deregistration event.\nOtherwise, the S-CSCF shall send SAR with Server-Asignment-Type set to USER_DEREGISTRATION.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.3.1",
      "section_id": "4.3.1",
      "section_title": "Introduction",
      "content": "The following clauses specify the behaviour of HSS, I-CSCF and S-CSCF if they support the IMS Restoration feature.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.3.2",
      "section_id": "4.3.2",
      "section_title": "S-CSCF Restoration after Restart",
      "content": "The S-CSCF lost all user data if it restarts after a failure or it is unable to trust any data after it resumes operation, due to the fact that it may have lost profile updates from the HSS in the service interruption period. If such a S-CSCF receives a terminating service request from the I-CSCF, it sends an SAR to the HSS for unregistered service data. In this case, HSS and S-CSCF proceed as indicated in 3GPP TS 29.228 [3], except that\n-\tif the Public User Identity is stored as registered in the HSS, and there are S-CSCF restoration information related to the Public User Identity stored in the HSS, the HSS shall send the S-CSCF restoration information together with the user profile in the SAA. The result code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. The S-CSCF shall trigger matched registered services for the Public User Identity.\nIf there are more than one group of S-CSCF restoration information related to the Public User Identity, which may happen if the Public User Identity is shared by multiple Private User Identities, the HSS shall include all of the S-CSCF restoration information in the SAA. One group of S-CSCF restoration information corresponds to one Private User Identity.\nIf the S-CSCF restoration information received includes the UE's subscription information, the S-CSCF shall construct a NOTIFY message according to the information and send it to the UE (or UEs if the IMPU is shared between several IMPIs) to trigger a new registration at anytime after normal processing of the terminating request.\nIf the S-CSCF restoration information received includes the P-CSCF's subscription information, the S-CSCF shall construct a NOTIFY message and send it to the P-CSCF to update the registration information at any time after normal processing of the terminating request.\nIf the S-CSCF restoration information received includes the UE's registration expiration time and the value is in the past, the S-CSCF proceeds as indicated in 3GPP TS 23.228 [27] clause 5.3.2.1.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.228_clause_5.3.2.1",
        "ts_29.228",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.3.3",
      "section_id": "4.3.3",
      "section_title": "S-CSCF Restoration after Failure",
      "content": "If the S-CSCF returned by the HSS during location query procedure fails, the I-CSCF is unable to contact the S-CSCF during terminating procedure. In this case, the I-CSCF shall send LIR to the HSS to explicitly request S-CSCF capabilities. If the HSS returns the S-CSCF capabilities to the I-CSCF, after re-selection of another S-CSCF according to the S-CSCF capabilities, the I-CSCF shall forward the service request to the new S-CSCF. The HSS and this new S-CSCF shall behave as described in clause 4.3.2, except that the HSS shall overwrite the S-CSCF name when receiving the SAR request, only if there is a previous explicit LIR request for S-CSCF capabilities.\nNOTE:\tIf the HSS indicates during location query procedure that the server name returned corresponds to an AS, then the service request is for PSI direct routing. In this case, IMS Restoration Procedures will not be executed and I-CSCF will reject the service request.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.3.2"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.3.4",
      "section_id": "4.3.4",
      "section_title": "SBI Support for S-CSCF Restoration after Failure",
      "content": "If the I-CSCF is unable to contact the S-CSCF during terminating procedure, the I-CSCF shall reselect an S-CSCF and forward the terminating request to the new S-CSCF. The I-CSCF shall include a reselection indication in the request. The S-CSCF shall proceed with the terminating request for an unregistered user. Additionally, the S-CSCF shall include the reselection indication towards the HSS.\nWhen receiving the reselection indication, the HSS shall allow the new S-CSCF to overwrite the current S-CSCF.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.4.1",
      "section_id": "4.4.1",
      "section_title": "Introduction",
      "content": "The following clauses specify the behaviour of HSS, S-CSCF and P-CSCF if they support the IMS Restoration feature.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.4.2",
      "section_id": "4.4.2",
      "section_title": "S-CSCF Restoration after Restart",
      "content": "The S-CSCF lost all user data if it restarts after a failure or it is unable to trust any data after it resumes operation, due to the fact that it may have lost profile updates from the HSS in the service interruption period. If such a S-CSCF receives an originating request different from SIP REGISTER coming from the UE, the S-CSCF shall send SAR to the HSS with Server Assignment Type set to NO_ASSIGNMENT to restore the user data. If the S-CSCF name sent in the Server-Assignment-Request command and the previously assigned S-CSCF name stored in the HSS are different, which may happen if S-CSCF reassignment occurred during a terminating restoration before, the HSS shall not overwrite the S-CSCF name; instead it shall send a response to the S-CSCF with result code set to DIAMETER_UNABLE_TO_COMPLY, as specified in the 3GPP TS 29.228 [3]. If there are S-CSCF restoration information related to the Public User Identity stored in the HSS, the HSS shall send the S-CSCF restoration information together with the user profile in the SAA to the S-CSCF. If the HSS returns an error DIAMETER_UNABLE_TO_COMPLY to the S-CSCF, the S-CSCF shall then return a specific error response to the UE to trigger a new registration.\nIf there are more than one group of S-CSCF restoration information related to the Public User Identity stored in the HSS, which may happen if the Public User Identity is shared by multiple Private User Identities, the HSS shall include all of the S-CSCF restoration information in the SAA. One group of S-CSCF restoration information corresponds to one Private User Identity.\nIf authentication of SIP request methods initiated by the UE excluding REGISTER is desired according to operator's policy, for other authentication schemes different from IMS-AKA, the S-CSCF requires authentication information (e.g. authentication vectors). If this information is not stored in the S-CSCF, the S-CSCF shall fetch that information from the HSS by means of the authentication procedures (Cx-MAR/MAA).\nNOTE 1:\tThe S-CSCF restoration information includes authentication scheme information (SIP-Authentication-Scheme). It allows the S-CSCF to identify the corresponding scheme for authentication when multiple schemes are supported.\nNOTE 2:\tThe authentication information (e.g. authentication vectors) was retrieved by the S-CSCF from the HSS for the authentication of REGISTER requests and it can be stored locally. This data may be lost after the S-CSCF restart.\nIf the S-CSCF receives SAA with the service profile of the user, the S-CSCF shall continue the originating service as normal.\nIf the S-CSCF receives SAA with S-CSCF restoration information and the S-CSCF restoration information includes the UE's subscription information, the S-CSCF shall construct a NOTIFY message according to the information and send it to the UE (or UEs if the IMPU is shared between several IMPIs) to trigger a new registration at anytime after normal processing of the originating request.\nIf the S-CSCF restoration information received includes the P-CSCF's subscription information, the S-CSCF shall construct a NOTIFY message and send it to the P-CSCF to update the registration information at any time after normal processing of the originating request.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.4.3",
      "section_id": "4.4.3",
      "section_title": "S-CSCF Restoration after Failure",
      "content": "If the UE initiates an originating service request different from SIP REGISTER and the P-CSCF is unable to contact the S-CSCF in the Route, the P-CSCF shall return a specific error response to the UE to trigger a new registration.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.5.1",
      "section_id": "4.5.1",
      "section_title": "Introduction",
      "content": "The following clauses specify the behaviour of HSS, I-CSCF and S-CSCF if they support the IMS Restoration feature.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.5.2",
      "section_id": "4.5.2",
      "section_title": "S-CSCF Restoration after Restart",
      "content": "The S-CSCF lost all user data if it restarts after a failure or it is unable to trust any data after it resumes operation, due to the fact that it may have lost profile updates from the HSS in the service interruption period. If such S-CSCF receives an originating request on behalf of a user (i.e. top-most route header in request contains \"orig\" parameter) coming from an AS, the S-CSCF shall send SAR to the HSS with Server Assignment Type set to UNREGISTERED_USER to inform the HSS that the user is unregistered. HSS and S-CSCF proceed as indicated in 3GPP TS 29.228 [3], except that:\n-\tif the Public User Identity is stored as registered in the HSS, and there is S-CSCF restoration information related to the Public User Identity stored in the HSS, the HSS shall send the S-CSCF restoration information together with the user profile in the SAA. The result code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. The S-CSCF shall trigger matched originating services for the Public User Identity.if the Public User Identity is stored as registered in the HSS, and there is no S-CSCF restoration information related to the Public User Identity stored in the HSS, the HSS shall send the user profile in the SAA and set the registration state for the Public Identity to unregistered. The result code shall be set to DIAMETER_SUCCESS. The S-CSCF shall trigger matched originating unregistered services for the Public User Identity.\n-\tif the S-CSCF name sent in the Server-Assignment-Request command and the previously assigned S-CSCF name stored in the HSS are different, the HSS shall not overwrite the S-CSCF name. Result Code will be DIAMETER_IDENTITY_ALREADY_REGISTERED. The S-CSCF shall return a specific error response to AS. The AS shall resend the request to the I-CSCF.\nNOTE:\tThe address of the S-CSCF can be obtained by AS either by querying the HSS on the Sh interface or during third-party registration. It may happen that if AS is using third party registration and a reassignment occurred during a terminating request, AS will have the wrong S-CSCF name.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.5.3",
      "section_id": "4.5.3",
      "section_title": "S-CSCF Restoration after Failure",
      "content": "If the application server sends the originating service request on behalf of the user to the S-CSCF, and the S-CSCF can not be contacted, after timeout, the application server shall resend the originating service request to the I-CSCF.\nIf the application server sends the originating service request directly to the I-CSCF, or resends the originating service request to the I-CSCF due to the S-CSCF can not be contacted, the I-CSCF shall behave as in clause 4.3.3. The S-CSCF and HSS shall behave as in clause 4.5.2, except that the HSS shall overwrite the S-CSCF name when receiving the SAR request, only if there is a previous explicit LIR request for S-CSCF capabilities.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.3.3",
        "clause_4.5.2"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.6.1",
      "section_id": "4.6.1",
      "section_title": "Introduction",
      "content": "The following clauses specify the behaviour of HSS and S-CSCF if they support the IMS Restoration feature.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_4.6.2",
      "section_id": "4.6.2",
      "section_title": "Backup and Update of S-CSCF Restoration Information during Registration Process",
      "content": "The S-CSCF shall backup the following data in the HSS during the initial registration process.\n-\tthe list of SIP proxies in the path (normally it would be just the P-CSCF address)\n-\tthe Contact Information (Contact Addresses and Contact Header parameters)\n-\tthe Authentication Information (SIP-Authentication-Scheme)\nThe S-CSCF may backup the following data in the HSS during the initial registration process.\n-\tthe Initial-CSeq-Sequence-Number and the Call-ID used if used for temporary GRUU generation (see IETF RFC 3261 [18])\nThe point in time of registration expiration\nThis is done with an additional information element in the SAR requesting user information, in addition to the basic set of information required to handle traffic, as specified in the 3GPP TS 29.228 [3]. The information is associated with the Private User Identity and the Implicit Registration Set that is affected by the SAR request. The HSS shall store this information.\nIf any of the above data is changed, the S-CSCF shall update it in the HSS using SAR request with Server-Assignment-Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE, as specified in the 3GPP TS 29.228 [3].\nNote:\tUpdating the point in time of registration expiration in the restoration information contributes to a better user experience at the cost of additional Cx traffic.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.6.3",
      "section_id": "4.6.3",
      "section_title": "Backup and Update of S-CSCF Restoration Information after UE's Subscription",
      "content": "If the S-CSCF receives the UE's subscription to notification of the reg-event for the first time, the S-CSCF shall send an SAR to the HSS to store the following UE's subscription information.\n-\tCall-ID, From, To, Record-Route, Contact\nTo avoid frequent storing of the subscription information in the HSS, the CSeq should not be included in the S-CSCF restoration information. Instead, the CSCF shall ensure that subsequent notification after retrieving this data includes a sufficiently large Cseq value so that the UE is able to accept it.\nThis is done with Server Assignment Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE in the SAR, as specified in the 3GPP TS 29.228 [3]. The information is associated with the Private User Identity affected by the SAR request. The HSS shall store this information.\nIf any of the above data is changed, the S-CSCF shall update it in the HSS using SAR request with Server-Assignment-Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE, as specified in the 3GPP TS 29.228 [3].\nThe S-CSCF shall send the registration data together with the subscription data as one S-CSCF restoration information. Each time the HSS receives the S-CSCF restoration information related to the same Private User Identity in the SAR with Server-Assignment-Type set to RE_REGISTRATION, the HSS shall overwrite the previous S-CSCF restoration information.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_4.6.4",
      "section_id": "4.6.4",
      "section_title": "Backup and Update of S-CSCF Restoration Information after P-CSCF's Subscription",
      "content": "Backup and Update of S-CSCF Restoration Information after P-CSCF's Subscription is an optional S-CSCF capability. If supported, the following applies:\nIf the S-CSCF receives the P-CSCF's subscription to notification of the reg-event for the first time, the S-CSCF shall send an SAR to the HSS to store the following P-CSCF's subscription information.\n-\tCall-ID, From, To, Contact\nTo avoid frequent storing of the subscription information in the HSS, the CSeq should not be included in the S-CSCF restoration information. Instead, the CSCF shall ensure that subsequent notification after retrieving this data includes a sufficiently large Cseq value so that the P-CSCF is able to accept it.\nThis is done with Server Assignment Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE in the SAR, as specified in the 3GPP TS 29.228 [3]. The information is associated with the Private User Identity affected by the SAR request. The HSS shall store this information.\nIf any of the above data is changed, the S-CSCF shall update it in the HSS using SAR request with Server-Assignment-Type set to RE_REGISTRATION and the User Data Already Available parameter set to USER_DATA_ALREADY_AVAILABLE, as specified in the 3GPP TS 29.228 [3].\nThe S-CSCF shall send the registration data together with the subscription data as one S-CSCF restoration information. Each time the HSS receives the S-CSCF restoration information related to the same Private User Identity in the SAR with Server-Assignment-Type set to RE_REGISTRATION, the HSS shall overwrite the previous S-CSCF restoration information.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.0",
      "section_id": "5.0",
      "section_title": "General",
      "content": "The following clauses show the requirements and information flows of IMS Restoration Procedures for the P-CSCF service interruption in each of the scenarios where they apply.\nProcedures over S9 between V-PCRF and H-PCRF are not supported in this release of the specification.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.1",
      "section_id": "5.1",
      "section_title": "Update PDP context/Bearer at P-CSCF failure",
      "content": "These flows show the procedures performed by the network at P-CSCF failure after user initiated registration..",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.1.1",
      "section_id": "5.1.1",
      "section_title": "General requirements",
      "content": "The following points are considered as requirements for the purpose of these procedures.\n1.\tP-CSCF discovery is performed by requesting and provisioning P-CSCF address(es) within Protocol Configuration Options (PCO), as specified in 3GPP TS 29.061 [9], clause 13a.2.1\n2.\tThe UE supports PCO IE, as specified in 3GPP TS 24.008 [4], clause 10.5.6.3.\n3.\tFor the GTP based S5 interface, GTPv1, as specified in 3GPP TS 29.060 [8] or GTPv2, as specified in 3GPP TS 29.274 [10] are supported by the GGSN/PDN-GW.\n4.\tFor the PMIP based S5 interface, PMIPv6, as specified in 3GPP TS 29.275 [15] is supported by the PDN-GW.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.061_clause_13",
        "ts_24.008_clause_10.5.6.3",
        "ts_29.061",
        "ts_24.008",
        "ts_29.060",
        "ts_29.274",
        "ts_29.275"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.1.2",
      "section_id": "5.1.2",
      "section_title": "Network recovery information flow - Update PDP context / Bearer",
      "content": "Figure 5.1.2a: P-CSCF failure (new list of P-CSCFs in PCO)\n1.\tThe UE initiates an IP-CAN session.\n2.\tP-CSCF discovery is performed. A list of P-CSCF addresses is received in CreatePDPContextResponse / CreateBearerResponse within the PCO IE.\n3.\tThe GGSN/PDN-GW sends CCR to request for PCC rules, as specified in 3GPP TS 29.212 [6].\n4.\tThe PCRF provides PCC rules to be applied in CCA.\n5.\tThe UE performs an initial registration towards a P-CSCF from the received list.\n6.\tThe P-CSCF sends Rx Push (see 3GPP TS 29.214 [7]) to provide the PCRF with the P-CSCF selected by the UE.\n7.\tThe PCRF sends Rx Push reponse.\n8.\tThe PCRF uses a Gx push procedure to provide the GGSN/PDN-GW with the P-CSCF address.\n9.\tThe GGSN/PDN-GW stores this address for the UE and sends Gx Push Rsp. Also, the GGSN/PDN-GW starts monitoring the health of the P-CSCF if not already done.\n10.\tThe P-CSCF sends 200 OK to the UE.\n11.\tA failure in P-CSCF is detected via Gi/sGi by the GGSN/PDN-GW. The GGSN/PDN-GW sends a new PCO IE with a new list of P-CSCF addresses (which does not include the failed P-CSCF) to all UEs associated to the failed P-CSCF address.\n12.\tThe UEs acknowledge the request.\n13.\tUpon receiving the new list of P-CSCFs, if the P-CSCF in use is missing, each UE performs an initial registration towards a new P-CSCF.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.1.2",
        "ts_29.212",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.1.3",
      "section_id": "5.1.3",
      "section_title": "Network recovery information flow with S5 PMIP",
      "content": "Figure 5.1.3: P-CSCF failure with S5 PMIP\n1 ~ 10.\tThe IMS session is setup as described in clause 5.1.2 except S5 PMIP procedure is used between SGW and PGW.\n11.\tOnce a P-CSCF failure is detected via Gi/sGi by the PDN-GW, the PDN-GW shall send a PMIP UPN message (MN ID, APN, PDN connection ID, PCO, and Additional parameters) as specified in 3GPP TS 29.275 [15] and IETF RFC 7077 [16]. The PCO contains a new list of P-CSCF address. The Notification reason shall indicate that update Bearer Context at P-CSCF failure is needed.\n12.\tIf the SGW supports the PMIP Update Notification message, it shall send Update Bearer Request message with the new list of P-CSCF address in the PCO to the MME/SGSN as part of the PGW initiated bearer modification without QoS update procedure as specified in 3GPP TS 23.401[17].\nOnce the Update Bearer Response message is received, the SGW shall response with a PMIP UPA message (MN ID, APN, PDN connection ID, PCO, and Additional parameters) as specified in 3GPP TS 29.275 [15] and IETF RFC 7077 [16].\n13.\tIf the PGW knows the SGW does not support the PMIP Update Notification procedure, the PGW shall skip step 11 and release the PMIP binding with cause code \"Reactivation Requested\".\n14.\tUpon receiving the new list of P-CSCFs, the UE may perform an initial registration towards a new P-CSCF.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.1.2",
        "figure_5.1.3",
        "ts_29.275",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.2",
      "section_id": "5.2",
      "section_title": "Inform UE about P-CSCF failure",
      "content": "These flows show the procedures performed by the network at P-CSCF failure after user initiated registration..",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.2.1",
      "section_id": "5.2.1",
      "section_title": "General requirements",
      "content": "The following points are considered as requirements for the purpose of these procedures.\n1.\tP-CSCF discovery is performed by requesting P-CSCF address(es) via DHCP method, as specified in 3GPP TS 29.061 [9], clause 13a.2.1\n2.\tThe UE supports PCO IE, as specified in 3GPP TS 24.008 [4], clause 10.5.6.3.\n3.\tFor the GTP based S5 interface, GTPv1, as specified in 3GPP TS 29.060 [8] or GTPv2, as specified in 3GPP TS 29.274 [10] are supported by the GGSN/PDN-GW\n4.\tFor the PMIPv6 based S5 interface, PMIPv6, as specified in 3GPP TS 29.275 [15] is supported by the PDN-GW.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.061_clause_13",
        "ts_24.008_clause_10.5.6.3",
        "ts_29.061",
        "ts_24.008",
        "ts_29.060",
        "ts_29.274",
        "ts_29.275"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.2.2",
      "section_id": "5.2.2",
      "section_title": "Network recovery information flow – Inform UE at P-CSCF failure",
      "content": "Figure 5.2.2a: P-CSCF failure for DHCP based scenarios\n1-2.\tThe UE initiates an IP-CAN session.\n3.\tP-CSCF discovery is performed using DHCP based method. The GGSN/PDN-GW relays/send the list of P-CSCF addresses in DHCP response.\nNOTE:\tThe DHCP response can include either a list of P-CSCF IPv4/IPv6 addresses or a list of FQDNs (see IETF RFC 3361 [11] and IETF RFC 3319 [13]). If P-CSCF FQDNs were provided, the UE uses DNS SIP server resolution mechanism (see IETF RFC 3263 [12])\n4.\tThe GGSN/PDN-GW sends CCR to request for PCC rules, as specified in 3GPP TS 29.212 [6].\n5.\tThe PCRF provides PCC rules to be applied in CCA.\n6.\tThe UE performs an initial registration towards the P-CSCF received.\n7.\tThe P-CSCF sends Rx Push (see 3GPP TS 29.214 [7]) to provide the PCRF with the P-CSCF selected by the UE,\n8.\tThe PCRF sends Rx Push reponse.\n9.\tThe PCRF uses a Gx push procedure to provide the GGSN/PDN-GW with the P-CSCF address.\n10.\tThe GGSN/PDN-GW stores this address for the UE and sends Gx Push Rsp. Also, the GGSN/PDN-GW starts monitoring the health of the P-CSCF if not already done.\n11.\tThe P-CSCF sends 200 OK to the UE.\n12.\tA failure in P-CSCF is detected via Gi/sGi by the GGSN/PDN-GW. The GGSN/PDN-GW informs to all UEs associated to the failed P-CSCF address that the P-CSCF is not available.\n13.\tThe UEs acknowledge the request.\n14.\tThe UE requests P-CSCF addresses (if needed) via new DHCP request.\n15.\tThe UE selects a new P-CSCF and initiates an initial IMS registration.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.2.2",
        "ts_29.212",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.2.3",
      "section_id": "5.2.3",
      "section_title": "Network recovery information flow – Inform UE at P-CSCF failure with S5 PMIP",
      "content": "Figure 5.2.3-1: P-CSCF failure for DHCP based scenarios with S5 PMIP\n1 ~ 11.\tSame as figure 5.2.2a step 1 ~ 11\n12.\tA failure in P-CSCF is detected via Gi/sGi by the GGSN/PDN-GW. The GGSN/PDN-GW informs to all UEs associated to the failed P-CSCF address that the P-CSCF is not available.\n-\tThe PDN-GW shall send a PMIP UPN message (MN ID, APN, PDN connection ID, PCO, and Additional parameters) as specified in 3GPP TS 29.275 [15] and IETF RFC 7077 [16]. The PCO contains a P-CSCF failure Indicator. The Notification reason shall indicate that there is a P-CSCF failure.\n-\tIf the SGW supports the PMIP Update Notification message, it shall send Update Bearer Request message with the P-CSCF failure Indicator in the PCO to the MME as part of the PGW initiated bearer modification without QoS update procedure as specified in 3GPP TS 23.401 [17]. Once the Update Bearer Response message is received, the SGW shall response with a PMIP UPA message (MN ID, APN, PDN connection ID, PCO, and Additional parameters) as specified in 3GPP TS 29.275 [15] and IETF RFC 7077 [16].\n-\tIf the PGW knows the SGW does not support the PMIP Update Notification procedure, the PGW may release the PMIP binding with cause code \"Reactivation Requested\".\n13 ~ 15.\tSame as figure 5.2.2a step 13 ~15.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.2.3-1",
        "figure_5.2.2",
        "ts_29.275",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.3",
      "section_id": "5.3",
      "section_title": "Network recovery information flow – UE uses keep alive mechanism",
      "content": "Figure 5.3a: P-CSCF failure detected by UE\n1.\tAfter establishment of an IP-CAN session and acquiring P-CSCF addresses, the UE performs initial registration towards a P-CSCF.\n2.\tIf registration is successful, the UE monitors the P-CSCF health according to IETF RFC 6223 [14]\n3.\tWhen a failure is detected, the UE acquires new P-CSCF addresses (if needed) and performs an initial registration.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.1",
      "section_id": "5.4.1",
      "section_title": "Introduction",
      "content": "The HSS-based P-CSCF restoration described in the clause 5.4 is an optional mechanism which applies when the UE is using a 3GPP access for the IMS PDN connection.\nWhen supported, this mechanism shall be executed when a terminating request cannot be serviced due to a P-CSCF failure, as long as there are no other registration flows for this terminating UE using an available P-CSCF.\nThe HSS-based P-CSCF restoration consists of a basic mechanism that makes usage of a path through HSS and MME/SGSN to request the release of the IMS PDN connection to the corresponding UE, as described in clause 5.4.2; and an optional extension that avoids the IMS PDN deactivation and re-activation, as described in clause 5.4.3.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4",
        "clause_5.4.2",
        "clause_5.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.2.1",
      "section_id": "5.4.2.1",
      "section_title": "General",
      "content": "The call flow for the HSS-based P-CSCF restoration mechanism is described in figure 5.4.2.1-1. The nodes included in this call flow shall execute following procedures if they support the HSS-based P-CSCF restoration mechanism.\nFigure 5.4.2.1-1: HSS-based P-CSCF restoration\n1.\tThe terminating S-CSCF receives a SIP message for a destination UE.\n2.\tThe S-CSCF forwards the SIP message to this called UE's terminating P-CSCF.\n3.\tThe S-CSCF shall identify whether the called UE's terminating P-CSCF is not able to process this request, based on received error codes (i.e. the UE registration data is not present) or no response. In this case, the following steps shall apply to execute the HSS-based P-CSCF restoration. For more information about S-CSCF failure detection, see clause 5.4.2.2.\n4.\tThe S-CSCF shall check the registration status of the Public User Identity associated to the called UE. If the registration state of the Public User Identity is Registered, the S-CSCF shall check if the Public User Identity is currently registered with one or more Private User Identities.\n-\tIf the Public User Identity is currently registered with only one Private User Identity, the S-CSCF shall unregister this Public User Identity by sending a Cx SAR to the HSS, including a P-CSCF Restoration indication.\n-\tIf the Public User Identity is currently registered with more than one Private User Identity, the S-CSCF shall send a deregistration request to the HSS for the corresponding Public User Identity and Private User Identity pair via Cx SAR, including a P-CSCF Restoration indication.\n5.\tThe HSS shall identify whether the MME/SGSN supports HSS-based P-CSCF restoration based on feature support information provided by the MME/SGSN as described in clause 5.4.2.3, then when the HSS receives a Cx SAR with a P-CSCF Restoration indication, it shall check whether the serving node(s) for corresponding user support this feature:\n-\tif at least one of the serving nodes support the feature:\n-\tthe HSS shall send a P-CSCF restoration indication to the supporting serving node(s) where the IMSI associated to the received Private Identity is registered, i.e. SGSN and/or MME, using S6a/S6d IDR/IDA or Gr ISD request/answer; and\n-\tthe HSS shall perform either the unregistration or deregistration requested and it shall send a successful response to the S-CSCF via Cx SAA. The S-CSCF shall set respectively this Public User Identity as Unregistered or this UE as not registered.\nNOTE 1:\tThe S-CSCF can start a P-CSCF Restoration Ongoing Timer to monitor the P-CSCF Restoration procedure. If the UE performs a new IMS registration before this timer expires, as a result of the P-CSCF Restoration procedure execution, the S-CSCF stops the timer. Otherwise, the S-CSCF registers again the Public User Identity by sending a Cx SAR to the HSS and it stops the timer. The value of the P-CSCF Restoration Ongoing Timer can consider how long the P-CSCF Restoration execution may take, and then it can take into account factors like paging re-transmission timers.\n-\tin addition, if the 3GPP AAA Server supports P-CSCF restoration for WLAN and if the user has an IMS APN configuration subscription for a WLAN access and is registered to a WLAN access, the procedure described in clause 5.6.2.2 from step 5 onwards shall apply.\n-\totherwise, the HSS shall provide an error response back in Cx SAA to the S-CSCF.\nNOTE 2:\tIn case there is not homogeneous support of this feature in corresponding user serving nodes, the P-CSCF Restoration procedure may be triggered as long as one serving node supports this feature, but if the UE is only reachable in the non-supporting serving node, the restoration procedure is not successful.\n6.\tThe S-CSCF shall send a SIP response back to the originating side. This shall be an error response if only one Private User Identity is registered, since the S-CSCF is not able to progress the request; otherwise the S-CSCF shall select the best possible response following normal forking procedures.\nSubject to an operator policy, the error response sent by S-CSCF may in addition inform the originating side that a terminating request reattempt is possible based on timer expiration.\nNOTE 3:\tSteps 4 and 6 above are not required to be in this order, reverse order is also possible.\n7.\tUpon reception of the P-CSCF Restoration indication from the HSS, the MME/SGSN from the received IMSI shall identify if the MM context of the UE exists and if the UE has an IMS PDN connection context. If either the MM context or the IMS PDN connection context does not exist, the MME/SGSN shall discard the P-CSCF Restoration indication without further processing; otherwise the MME/SGSN shall continue as below.\nNOTE 4:\tGSMA PRD IR.65 [21] clause 2.3 recommends one single IMS APN in case of simultaneous usage of VoLTE and RCS.\nThe MME/SGSN shall check the UE state:\n-\tIf the UE is in ECM-IDLE state, the MME/SGSN shall page the UE.\n-\tIf the UE is initially in ECM-CONNECTED state or when it gets a response from the UE after paging:\n-\tIf ISR is active, the MME/SGSN shall send a message, via the S3 interface, to stop paging the UE at the other ISR-associated node; and\n-\tThe MME/SGSN shall execute the optional PCO-based optional extension to this mechanism as described in clause 5.4.3, if this optional extension is supported by the MME/SGSN and by the serving SGW/PGW; otherwise it shall proceed as below.\nNOTE 5:\tThe support of this feature by the serving SGW/PGW is determined based on the local configuration at the MME/SGSN.\n-\tThe SGSN, or the MME if this is not the last PDN connection of the UE, shall release the UE's IMS PDN connection towards the UE by initiating a PDN disconnection procedure with the NAS cause \"reactivation requested\". If this is the last PDN connection of the UE, the MME shall initiate a detach procedure with the NAS cause code \"reactivation requested\". Additionally, the MME/SGSN shall also release the same PDN connection towards the SGW/PGW by sending Delete Session message (not shown in the figure).\n8.\tAs a result of the release of the IMS PDN connection, the UE shall activate the IMS PDN connection, select an available P-CSCF and perform a new initial IMS registration, as per 3GPP TS 29.061 [9].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4.2.2",
        "clause_5.4.2.3",
        "clause_5.6.2.2",
        "clause_2.3",
        "clause_5.4.3",
        "figure_5.4.2.1-1",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.2.2.1",
      "section_id": "5.4.2.2.1",
      "section_title": "General",
      "content": "If the P-CSCF is not reachable, the S-CSCF does not receive any SIP response when it sends a request. In this case,  the S-CSCF shall consider the P-CSCF to be non-reachable. As long as the S-CSCF considers the P-CSCF to be non-reachable, the S-CSCF shall not try to contact again this P-CSCF for subsequent terminating requests. The S-CSCF shall consider the P-CSCF to be reachable as soon as a SIP request, including REGISTER, is received from that P-CSCF.\nVarious mechanisms can be used for the S-CSCF to detect a non-reachable P-CSCF, e.g. keep-alive mechanisms or expiry of timers.\nIf the P-CSCF is reachable, but it is not able to process the request, it shall send an error indication to the S-CSCF.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.4.2.2.2",
      "section_id": "5.4.2.2.2",
      "section_title": "Direct connection from S-CSCF to P-CSCF",
      "content": "This is the normal case when the terminating user is not roaming.\nWhen the S-CSCF receives a terminating request towards a UE registered to a P-CSCF that is not considered non-reachable, the S-CSCF shall forward the request to the P-CSCF. If the P-CSCF does not respond, after a pre-defined number of retransmissions, the S-CSCF shall consider the P-CSCF to be non-reachable.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.4.2.2.3",
      "section_id": "5.4.2.2.3",
      "section_title": "S-CSCF connection to P-CSCF via IBCF/ATCF",
      "content": "This is the normal case when the terminating user is roaming and there are IBCFs between the S-CSCF and the P-CSCF. It can also be that an ATCF is inserted between the S-CSCF and the P-CSCF.\nIn this case, the SIP node closest to the P-CSCF shall identify when the P-CSCF is not reachable. It rejects the request with a SIP error response with an indication that the P-CSCF is not reachable.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.4.2.3",
      "section_id": "5.4.2.3",
      "section_title": "MME/SGSN mechanism support",
      "content": "If the MME/SGSN supports this mechanism, it shall indicate support of this feature to the HSS in S6a/S6d ULR. If support is indicated, this information shall be stored by HSS per MME/SGSN.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.4.3.1",
      "section_id": "5.4.3.1",
      "section_title": "Introduction",
      "content": "The HSS-based P-CSCF basic mechanism is optionally extended by reusing part of the \"Update PDP context/bearer at P-CSCF failure\" mechanism described in clause 5.1, in order to avoid the need to deactivate and reactivate the IMS PDN connection.\nThis extension is based on the possibility for the P-GW/GGSN to know whether or not the UE supports the \"Update PDP context/bearer at P-CSCF failure\" mechanism. This is described in clause 5.4.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "clause_5.4.4"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.3.2",
      "section_id": "5.4.3.2",
      "section_title": "Description",
      "content": "This procedure is described by figure 5.4.3.2-1 (for EPC) and 5.4.3.2-2 (for GPRS). The nodes included in this call flow shall execute following procedures if they support the HSS-based P-CSCF restoration mechanism.\nFigure 5.4.3.2-1: PCO-based optional extension - EPC\nFigure 5.4.3.2-2: PCO-based optional extension - GPRS\nSteps from 1 to 6 are the same as explained in figure 5.4.2.1-1 above.\n7.\tThe MME/SGSN shall send Modify Bearer Request / Update PDP Context Request to the P-GW/GGSN for this associated PDN connection with a P-CSCF Restoration indication.\nThe MME/S4 SGSN shall provide this indication to the P-GW via the S-GW. When the Modify Bearer Request is received by the S-GW with the P-CSCF Restoration indication, this message shall be forwarded to the P-GW.\n8.\tUpon reception of the P-CSCF Restoration indication, the P-GW/GGSN shall check whether the UE has indicated it supports \"Update PDP context/bearer at P-CSCF failure\" mechanism, as described in clause 5.4.4:\n-\tif supported, the PGW/GGSN shall send Update Bearer Request / Update PDP Context Request to the MME/SGSN with the list of available P-CSCF addresses within PCO IE to update destination UE. The list of available P-CSCFs may contain the address of the P-CSCF used by the UE if this P-CSCF has restarted and is again available.\n-\tif not supported, the P-GW/GGSN shall release the IMS PDN connection/PDP context by sending a Delete Bearer Request / Delete PDP Context Request to the MME/SGSN with GTP cause \"reactivation requested\".\n9.\tUpon reception of the Update Bearer Request / Update PDP Context Request, the MME/SGSN shall send an Update EPS Bearer Context Request / Modify PDP Context Request to the UE, including the PCO with the list of available P-CSCF addresses; otherwise, upon reception of a Delete Bearer Request / Delete PDP Context Request, the MME/SGSN shall send a Delete EPS Bearer Context Request / Delete PDP Context Request to the UE with the NAS cause \"reactivation requested\", then once the PDN connection is released, the UE shall re-activate the IMS PDN connection.\n10.\tThe UE selects an available P-CSCF. If the UE has received a Modify EPS Bearer Context Request / Modify PDP Context Request while the UE does not have any ongoing session then the UE shall select one available P-CSCF from the list for IMS registration and perform a new initial IMS registration.\nNOTE:\tThe P-CSCF can be completely unreachable, so it is up to UE implementation to detect the end of an ongoing session, e.g. using media plane inactivity detection. Services depending on signalling such as CW and MT calls will not work during this time.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.4",
        "figure_5.4.3.2-1",
        "figure_5.4.3.2-2",
        "figure_5.4.2.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.4",
      "section_id": "5.4.4",
      "section_title": "UE indication of support for \"Update PDP context/bearer at P-CSCF failure\" Restoration",
      "content": "This optional extension is based on the possibility for the P-GW/GGSN to identify whether or not the UE supports \"Update PDP context/bearer at P-CSCF failure\", as described in clause 5.1 and 3GPP TS 24.229 [19] (clauses B.2.2.1C and L.2.2.1C).\nThe UE shall indicate this capability to the P-GW/GGSN at the activation of the IMS PDN connection /PDP context, in the PCO parameter 0012H (P-CSCF Re-selection support) as described in 3GPP TS 24.008 [4] clause 10.5.6.3. The P-GW/GGSN shall store this UE capability.\nThis method has no impact on the MME/SGSN or SGW, as PCO information is transparently transferred through these network elements.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.229_clause_5.1",
        "ts_24.008_clause_10.5.6.3",
        "ts_24.229",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.5",
      "section_id": "5.4.5",
      "section_title": "Coexistence with \"Update PDP context/bearer at P-CSCF failure\" mechanism",
      "content": "If the \"Update PDP context/bearer at P-CSCF failure\" mechanism is deployed, as soon as a P-CSCF failure is detected, as described in clause 5.1, it triggers massive radio signalling first and then massive IMS registration. Therefore, the HSS-based P-CSCF restoration triggering use case does not occur in most cases, and benefits are minimal; i.e., in case of coexistence, the \"Update PDP context/bearer at P-CSCF failure\" mechanism takes precedence over the HSS-based P-CSCF restoration mechanism in most cases. Hence, if the optional HSS-based P-CSCF restoration is deployed in a network, the recommendation is to only deploy the HSS-based P-CSCF restoration.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.4.6",
      "section_id": "5.4.6",
      "section_title": "HSS based P-CSCF restoration in roaming scenarios",
      "content": "The considered roaming scenarios are the ones described in 3GPP TS 23.401 [17], clause 4.2.2.\nFor these roaming scenarios, when the VPLMN and the HPLMN both support the HSS based P-CSCF restoration mechanism, this mechanism shall be used for P-CSCF restoration. The HPLMN shall be aware that the VPLMN supports the HSS based P-CSCF restoration mechanism by signalling from the VPLMN. The HPLMN should not trigger a P-CSCF restoration otherwise.\nFor the roaming scenarios when either the VPLMN or the HPLMN does not support the HSS based P-CSCF restoration mechanism, then the PGW/GGSN which is located in network supporting the HSS based mechanism, depending on operator policy, may apply:\n-\tno P-CSCF restoration mechanism; or\n-\tanother existing mechanism e.g. the \"Update PDP context/bearer at P-CSCF failure\" mechanism described in clause 5.1. The PGW/GGSN shall be aware (e.g. by local configuration) that the HSS based P-CSCF restoration mechanism cannot be used.\nNOTE:\tThe PGW/GGSN identifies the roaming or non-roaming scenario based on the serving PLMN-ID and IMSI received from the MME/SGSN at the PDN connection establishment.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_4.2.2",
        "clause_5.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.1",
      "section_id": "5.5.1",
      "section_title": "Introduction",
      "content": "The PCRF-based P-CSCF restoration is an optional mechanism.\nThis mechanism is executed when a terminating request does not proceed due to a P-CSCF failure, as long as there are no other registration flows for this terminating UE using an available P-CSCF.\nThe PCRF-based P-CSCF restoration consists of a basic mechanism that makes usage of a path through an alternative P-CSCF and PCRF to request the release of the IMS PDN connection to the corresponding UE, as described in clause 5.5.2; and an optional extension that avoids the IMS PDN deactivation and re-activation, as described in clause 5.5.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.5.2",
        "clause_5.5.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.2",
      "section_id": "5.5.2",
      "section_title": "PCRF-based P-CSCF restoration information flow - deactivate PDN connection/PDP context",
      "content": "The following figures illustrate the details of PCRF-based P-CSCF restoration information flow.\nThe nodes included in this call flow shall execute following procedures if they support the PCRF-based P-CSCF restoration mechanism.\nFigure 5.5.2-1: PCRF based P-CSCF restoration\nThis call flow provides two options for termination call being treated.\nOption a) makes terminating UE to be deregistered until next re-registration.\nOption b) continues terminating call after successful re-IMS registration.\n1. The S-CSCF receives a terminating INVITE message.\n2a. The S-CSCF shall populate IMSI into the terminating INVITE message. IMSI is maintained in the S-CSCF, which is obtained from HSS when the UE registers. Then the S-CSCF shall forward the Terminating INVITE message to alternative P-CSCF. The alternative P-CSCF is chosen by local configuration.\nNOTE 1:\tThe IMSI is used by the alternative P-CSCF to find the associated PCRF associated for the UE. The IMSI information is subtracted in P-CSCF.\n2b. The S-CSCF shall populate IMSI into the terminating INVITE message. IMSI is maintained in the S-CSCF, which is obtained from HSS when the UE registers. Then the S-CSCF shall forward the terminating INVITE message to visited network.\n2c. If IBCF or ATCF next to the failed P-CSCF has detected the P-CSCF failure, IBCF or ATCF shall forward the terminating INVITE message to alternative P-CSCF. The alternative P-CSCF is chosen by local configuration.\n3. The alternative P-CSCF shall send SIP ERROR message to the S-CSCF.\n4a. If option a) is chosen, the S-CSCF shall check the registration status of the Public User Identity associated to the called UE. If the registration state of the Public User Identity is registered, the S-CSCF shall check if the Public User Identity is currently registered with one or more Private User Identities.\n- If the Public User Identity is currently registered with only one Private User Identity, the S-CSCF shall unregister this Public User Identity sending a Cx SAR/SAA to HSS. If the response is successful, the S-CSCF shall set this Public User Identity as Unregistered.\n- If the Public User Identity is currently registered with more than one Private User Identity, the S-CSCF shall send a deregistration to HSS for the corresponding Public User Identity and Private User Identity pair via Cx SAR/SAA. If the response is successful, the S-CSCF shall set this UE as not registered.\nNOTE 2:\tthe S-CSCF can start a P-CSCF Restoration Ongoing Timer to monitor the P-CSCF Restoration procedure. If the UE performs the new IMS registration before this timer expires, as a result of the P-CSCF Restoration procedure execution, the S-CSCF stops the timer. Otherwise, the S-CSCF registers again the Public User Identity by sending a Cx SAR to the HSS and it stops the timer. The value of the P-CSCF Restoration Ongoing Timer can consider how long the P-CSCF Restoration execution may take, and then it can take into account factors like paging re-transmission timers.\n4b. If option a) is chosen the S-CSCF shall send a SIP response back to the originating side. This shall be an error response if only one Private User Identity is registered; otherwise the S-CSCF shall select the best possible response following normal forking procedures.\n5. The alternative P-CSCF shall send an Rx AAR message with the P-CSCF restoration indication to the associated PCRF, the associated PCRF is found by UE's IP address (if available), IP Domain (if UE's IP address is provided and IP address overlapping can occur), IMSI and APN. The APN and IP Domain are set based on local configuration and additionally referring to the SDP information, e.g. media field, on the received SIP INVITE message.\nNOTE 3:\tWhen the UE's IP address is not available, the P-CSCF has to include both IMSI and APN in the Rx AAR command.\nNOTE 4:\tWhen IMSI is not available, the associated PCRF for the UE can be found by IP address of the UE with the condition that there is no IP translation function in the P-CSCF.\n6. The PCRF shall send an Rx AAA to the P-CSCF\n7. The PCRF shall find the IP-CAN session related to that UE based on the available information received in step 5 and shall send a Gx RAR including the P-CSCF restoration indication to the PDN GW/GGSN that has been associated with that IP-CAN session. In case where the alternative P-CSCF is located in the HPLMN and the associated PDN GW/GGSN is located in the VPLMN, in this case both S9 interface and Gx interface are used.\n8. The PDN GW/GGSN shall send Gx RAA to the PCRF.\n9. Then the PDN GW/GGSN shall perform one of following procedures.\n-\tFor 3GPP accesses, the PDN GW/GGSN initiates bearer deactivation procedure for the default bearer with \"reactivation requested\", if the PDN GW/GGSN has no knowledge whether the UE supports the \"Update PDP context/bearer at P-CSCF failure\". If the UE supports the \"Update PDP context/bearer at P-CSCF failure\" mechanism, step 11 and 12 in the procedure that is described in clause 5.1 is reused instead.\nNOTE 5:\tThe failed P-CSCF can be included in the new P-CSCF list if it has recovered.\n-\tFor the S2a and S2b, the PDN GW initiates bearer deactivation procedure to the trusted non 3GPP access domain and the ePDG, respectively.\n-\tFor the S2c, the PDN GW/GGSN initiates detach procedure.\nNOTE 6:\tFor the S2a/b/c, it should be noted that although this procedure does not request UE to re-attach to the IMS explicitly by signalling, it is assumed that IMS compliant UE shall re-attempt to obtain IMS service soon after detached from the IMS service.\n10. UE activates the PDN connection and registers to IMS. As a result of the release of the IMS PDN connection, the voice centric UE activates the IMS PDN connection, selects a new available P-CSCF and performs a new initial IMS registration.\n11. If option b) is chosen, the S-CSCF shall send the suspended terminating SIP INVITE message to a newly selected P-CSCF after the successful SIP registration for the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.1",
        "figure_5.5.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.3.1",
      "section_id": "5.5.3.1",
      "section_title": "Introduction",
      "content": "The PCRF-based P-CSCF basic mechanism is optionally extended by reusing part of the \"Update PDP context/bearer at P-CSCF failure\" mechanism described in clause 5.1, in order to avoid the need to deactivate and reactivate the IMS PDN connection.\nThis extension is based on the possibility for the P-GW/GGSN to know whether or not the UE supports the \"Update PDP context/bearer at P-CSCF failure\" mechanism. This is described in clause 5.5.3.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "clause_5.5.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.3.2",
      "section_id": "5.5.3.2",
      "section_title": "Description",
      "content": "This procedure is described by figure 5.4.3.2-1 (for EPC) starting with step 8a and 5.4.3.2-2 (for GPRS) starting with step 8. The nodes included in this call flow shall execute following procedures if they support the PCRF-based P-CSCF restoration mechanism.",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_5.4.3.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.3.3",
      "section_id": "5.5.3.3",
      "section_title": "UE indication of support for \"Update PDP context/bearer at P-CSCF failure\" Restoration",
      "content": "This function is identical to the HSS-based P-CSCF restoration. Refer to 5.4.4.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.5.4",
      "section_id": "5.5.4",
      "section_title": "Coexistence with \"Update PDP context/bearer at P-CSCF failure\" mechanism",
      "content": "If the \"Update PDP context/bearer at P-CSCF failure\" mechanism is deployed, as soon as a P-CSCF failure is detected, as described in clause 5.1, it triggers massive radio signalling first and then massive IMS registration. Therefore, the PCRF-based P-CSCF restoration triggering use case does not occur in most cases, and benefits are minimal; i.e., in case of coexistence, the \"Update PDP context/bearer at P-CSCF failure\" mechanism takes precedence over the PCRF-based P-CSCF restoration mechanism in most cases. Hence, if the optional PCRF-based P-CSCF restoration is deployed in a network, the recommendation is to only deploy the PCRF-based P-CSCF restoration.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.5.5",
      "section_id": "5.5.5",
      "section_title": "P-CSCF restoration in roaming scenarios for PCRF based solution",
      "content": "In a home routed scenario, i.e., S-GW(or any other gateway node) is in VPLMN and P-GW and P-CSCF are in HPLMN, the PCRF based solution can work sorely within HPLMN that supports the PCRF based solution, no matter VPLMN supports the solution or not.\nThe following procedures only apply to the local breakout scenario.\nIn roaming scenarios, the VPLMN and HPLMN operators may deploy the same or different P-CSCF restoration mechanisms, amongst those described in clause 5.1 (Update PDP context/bearer at P-CSCF failure), clause 5.4 (HSS based P-CSCF restoration) and clause 5.5 (PCRF based P-CSCF restoration), independently from each other.\nThe PCRF based P-CSCF restoration can work in roaming scenarios if:\n1) Both HPLMN and VPLMN support the PCRF based P-CSCF restoration; or\n2) When the HPLMN does not support the PCRF based P-CSCF restoration but VPLMN does and NAT is not performed.\nNOTE: If the HPLMN does not support the PCRF based P-CSCF restoration, IMSI may not be available on terminating INVITE message.\nAlternatively, based on the operator policy or roaming agreement, the VPLMN can use the \"Update PDP context/bearer at P-CSCF failure\" mechanism described in clause 5.1.\nFor a terminating call to outbound roamers, the S-CSCF may not populate IMSI to terminating INVITE message if HPLMN knows, e.g. by configuration in the S-CSCF according to roaming agreements, that VPLMN for outbound roamer does not support the PCRF based P-CSCF restoration.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "clause_5.4",
        "clause_5.5"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.1",
      "section_id": "5.6.1",
      "section_title": "Introduction",
      "content": "The clause 5.6 describes solutions to support P-CSCF restoration for UEs with an IMS PDN connection supported over a WLAN access.\nThe clauses 5.6.2 and 5.6.3 describe the basic mechanism for the HSS-based solution and for the PCRF-based solution. The basic mechanism relies on the release of the IMS PDN connection followed by its re-establishment to trigger a new IMS registration by the UE.\nThe clauses 5.6.4 and 5.6.5 describe extensions for trusted WLAN and for untrusted WLAN accesses to avoid the release of the IMS PDN connection and to trigger a new IMS registration by the UE over the existing IMS PDN connection. The extensions between the UE and the PGW are common for the HSS-based and for the PCRF-based solutions and rely on the same UE behavior.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.2.1",
      "section_id": "5.6.2.1",
      "section_title": "Overview and principles",
      "content": "The HSS-based P-CSCF restoration mechanism for WLAN extends the HSS-based P-CSCF restoration mechanism (specified for 3GPP accesses in clause 5.4) to trusted and untrusted WLAN accesses and is based on the same principles to disconnect the UE, which then re-establishes the connection via an available P-CSCF.\nIf  the UE is registered to the EPC via a WLAN access and has an IMS APN subscription permitting non-3GPP accesses, the HSS forwards a P-CSCF restoration indication to the 3GPP AAA Server which transfers it to the PGW. Then the PGW initiates the release of the IMS PDN connection towards the UE via the WLAN access.\nFollowing the release of the IMS PDN connection, the UE re-establishes a new IMS PDN connection and performs a new P-CSCF discovery (according to the existing procedures), and then registers again to IMS.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.2.2",
      "section_id": "5.6.2.2",
      "section_title": "Description",
      "content": "The call flow for the HSS-based P-CSCF restoration mechanism for WLAN is described in figure 5.6.2.2-1. The functional entities involved by this call flow shall execute the following procedure if they all support the HSS-based P-CSCF restoration for WLAN.\nFigure 5.6.2.2-1: HSS-based P-CSCF restoration for WLAN\nFor a WLAN access, the basic mechanism to request the UE to do a new IMS registration is to release the IMS PDN connection over the interface (S2a or S2b) through which the UE is connected. The solution avoids disconnecting other PDN connections than the IMS PDN one.\nNOTE 1:\tthe UE may establish multiple PDN connections via untrusted WLAN and trusted WLAN in multi-connection mode; while there is a single SWm Diameter session per PDN connection, there is a unique STa Diameter session per UE.\nSteps 1 to 4 are common with the steps 1 to 4 of clause 5.4.2.1.\n5.\tAfter having checked that the 3GPP AAA Server supports the HSS-based P-CSCF restoration for WLAN, the HSS, if the user has a non-3GPP access subscription with an IMS APN configuration and if the user has a non-3GPP access registration in the HSS for the WLAN access, shall forward a P-CSCF restoration indication to the 3GPP AAA Server over SWx by using a PPR command, perform either the IMS unregistration or deregistration requested by the S-CSCF and send a successful response to the S-CSCF via a Cx SAA command. The S-CSCF shall set respectively this Public User Identity as unregistered or this UE as not registered.\nIf the user has also an IMS APN configuration subscription for a 3GPP access and is registered to a 3GPP access, the procedure described in clause 5.4.2.1 from step 5 onwards shall apply in addition.\nOtherwise, if the P-CSCF restoration is not triggered over WLAN or 3GPP access, the HSS shall provide an error response in Cx SAA to the S-CSCF.\n6.\tStep 6 is common with step 6 described in clause 5.4.2.1 for 3GPP accesses.\nNOTE 2:\tSteps 4 and 6 above are not required to be in this order, reverse order is also possible.\n7.\tIf the 3GPP AAA Server has the information that an IMS PDN connection is established via a WLAN access for the user, the 3GPP AAA Server, after having checked that the PGW supports the HSS-based P-CSCF restoration for WLAN, shall send a P-CSCF restoration indication to the PGW over S6b in a Re-authorization Request (RAR) command, via a 3GPP AAA Proxy over SWd if a VPLMN is involved.\nNOTE 3:\tThe PGW does not send any AA-Request (AAR) command to the 3GPP AAA server after having received the Re-authorization Request (RAR) command in step7, given that it will send a Session Termination Request (STR) in step 9.\nNOTE 4:\tGSMA PRD IR.65 [21] clause 2.3 recommends one single IMS APN in case of simultaneous usage of VoLTE and RCS. If there were two PDN connections with the IMS APN, the reception of the P-CSCF restoration indication would result in the release of the two IMS PDN connections although only the PDN connection related to the failed P-CSCF should be released.\n8.\tThe PGW shall proceed with the release of the IMS PDN connection as follows:\n-\tFor a TWAN access, the PGW shall initiate over the S2a interface a Delete Bearer Request procedure (GTP) or a Proxy Mobile IPv6 LMA Initiated PDN Connection Deletion procedure (PMIP) to the TWAN which then shall initiate:\n-\ta WLCP PDN Disconnection procedure towards the UE  for a UE in multi connection mode as described in 3GPP TS 24.244 [22];\n-\ta TWAN specific resource release procedure, in single connection mode or transparent single connection mode;\n-\tFor an untrusted WLAN access, the PGW shall initiate over the S2b interface a Delete Bearer Request procedure (GTP) or a Proxy Mobile IPv6 LMA Initiated PDN Connection Deletion procedure (PMIP) to the ePDG which then initiates the release of the associated IKEv2 tunnel.\nA cause \"reactivation requested\" (as supported over 3GPP accesses) is added by the PGW over GTP-C based S2a and WLCP for TWAN and over GTP-C based S2b and IKEv2 for untrusted WLAN.\n9.\tThe PGW shall indicate the termination of the associated session to the 3GPP AAA Server by sending a Session Termination Request (STR).\n10.\tAs a result of the release of the IMS PDN connection, the UE shall re-establish the IMS PDN connection, and also perform a new P-CSCF discovery (as the IMS PDN connection was lost). After discovering a new P-CSCF, the UE shall perform a new initial IMS registration towards IMS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.2.1",
        "clause_2.3",
        "figure_5.6.2.2-1",
        "ts_24.244"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.3",
      "section_id": "5.6.3",
      "section_title": "Basic mechanism for the PCRF-based solution",
      "content": "The basic mechanism for the PCRF-based P-CSCF restoration for WLAN is part of the PCRF-based solution described in clause 5.5.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.5"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.4.1",
      "section_id": "5.6.4.1",
      "section_title": "Overview and principles",
      "content": "The basic mechanism for P-CSCF restoration over WLAN is optionally extended for the TWAN access to avoid the need to deactivate and reactivate the IMS PDN connection. This P-CSCF restoration extension applies to the HSS-based and the PCRF-based solutions.\nUpon receipt of a P-CSCF restoration indication from the 3GPP AAA Server, the PGW may invoke this P-CSCF restoration extension procedure if\n-\tthe UE is accessing the EPC via a TWAN in the multi-connection mode;\n-\tthe UE indicated support of this extension for the TWAN access (as further described in clause 5.6.4.3); and\n-\tif the TWAN indicated support of the WLCP PDN connection modification procedure.\nIf so, the PGW shall send the updated list of the addresses of available P-CSCFs towards the UE via the TWAN. This triggers the UE to initiate a new IMS registration towards an available P-CSCF over the existing IMS PDN connection.\nOtherwise, the PGW shall initiate the release of the IMS PDN connection and proceed with the basic P-CSCF restoration mechanism specified in clause 5.6.2 and 5.6.3.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.6.4.3",
        "clause_5.6.2"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.4.2",
      "section_id": "5.6.4.2",
      "section_title": "Description",
      "content": "The call flow for the P-CSCF restoration extension for the TWAN access is described in figure 5.6.4.2-1. The functional entities involved by this call flow shall execute the following procedure if they all support the P-CSCF restoration extension for the TWAN access.\nFigure 5.6.4.2-1: P-CSCF restoration extension for the TWAN access – GTP-based S2a\nFor the HSS-based solution, steps from 1 to 7 are the same as those explained in clause 5.6.2.2 for the P-CSCF restoration basic mechanism for WLAN. In step 7, the 3GPP AAA Server, when receiving a P-CSCF restoration indication from the HSS, transfers this indication to the PGW in a Re-authorization Request (RAR) command, This generates an authorisation procedure (step 7a) as according to 3GPP TS 29.273 [24].\nFor the PCRF-based solution, steps from 1 to 7 are the same as those explained in clause 5.3.2 for the P-CSCF restoration basic mechanism. In step 7, the PCRF transfers the P-CSCF restoration indication to the PGW.\nHereafter steps 8 to 11 are common to the HSS-based solution and to the PCRF-based solutions:\n8.\tIf the PGW has previously received the indication that the UE supports the P-CSCF restoration extension for the TWAN access and that the TWAN supports the WLCP PDN connection modification procedure, and if the UE is accessing the TWAN in multi-connection mode, the PGW shall send an Update Bearer Request to the TWAN including the PCO information element set with a list of available P-CSCF addresses,\nNOTE:\tthe TWAN reports to the PGW whether the UE is accessing the TWAN in multi-connection mode, single-connection mode or transparent single-connection mode, during the PDN connection establishment procedure.\n9.\tThe TWAN shall initiate a WLCP PDN connection modification request procedure towards the UE as described in 3GPP TS 24.244 [22] to transparently forward the PCO information element received from the PGW.\n10.\tThe UE shall send a response to the TWAN which then shall send an Update Bearer Response to the PGW.\n11.\tAs per the P-CSCF restoration procedures described in 3GPP TS 24.229 [19], the UE shall select one P-CSCF from the received list and proceed with an IMS registration.\nThe same call flow applies to PMIP-based S2a, whereby, in step 8, the PGW shall initiate an LMA Initiated Update Notification procedure to provide the TWAN with the available P-CSCF addresses.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.6.2.2",
        "clause_5.3.2",
        "figure_5.6.4.2-1",
        "ts_29.273",
        "ts_24.244",
        "ts_24.229"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.4.3",
      "section_id": "5.6.4.3",
      "section_title": "Indication of UE support of the P-CSCF restoration extension for the TWAN access",
      "content": "If the UE supports the P-CSCF restoration extension for the TWAN access, it shall send an indication of this capability to the PGW via the PCO information element at the establishment (or handover) of the IMS PDN connection over the WLAN access.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.6.5.1",
      "section_id": "5.6.5.1",
      "section_title": "Overview and principles",
      "content": "The basic mechanism for P-CSCF restoration over WLAN is optionally extended for the untrusted WLAN access to avoid the need to deactivate and reactivate the IMS PDN connection. This P-CSCF restoration extension applies to the HSS-based and the PCRF-based solutions.\nUpon receipt of a P-CSCF restoration indication from the 3GPP AAA Server, the PGW may invoke this P-CSCF restoration extension procedure if\n-\tthe UE is accessing the EPC via an untrusted WLAN access;\n-\tthe UE and the ePDG indicated support of this extension for the untrusted WLAN access (as further described in clause 5.6.5.3).\nIf so, the PGW shall send the updated list of the addresses of available P-CSCFs towards the UE via the ePDG. This triggers the UE to initiate a new IMS registration towards an available P-CSCF over the existing IMS PDN connection.\nOtherwise, the PGW shall initiate the release of the IMS PDN connection and proceed with the basic P-CSCF restoration mechanism specified in clauses 5.6.2 and 5.6.3.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.6.5.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.5.2",
      "section_id": "5.6.5.2",
      "section_title": "Description",
      "content": "The call flow for the P-CSCF restoration extension for the untrusted WLAN access is described in figure 5.6.5.2-1. The functional entities involved by this call flow shall execute the following procedure if they all support the P-CSCF restoration extension for the untrusted WLAN access.\nFigure 5.6.5.2-1: P-CSCF restoration extension for the untrusted WLAN access – GTP-based S2b\nFor the HSS-based solution, steps from 1 to 7 are the same as those explained in clause 5.6.2.2 for the P-CSCF restoration basic mechanism for WLAN. In step 7, the 3GPP AAA Server, when receiving a P-CSCF restoration indication from the HSS, transfers this indication to the PGW in a Re-authorization Request (RAR) command. This generates an authorisation procedure (step 7a) as according to 3GPP TS 29.273 [24].\nFor the PCRF-based solution, steps from 1 to 7 are the same as those explained in clause 5.3.2 for the P-CSCF restoration basic mechanism. In step 7, the PCRF transfers the P-CSCF restoration indication to the PGW.\nHereafter steps 8 to 11 are common to the HSS-based solution and to the PCRF-based solution:\n8\tIf the PGW has previously received the indication that the UE and the ePDG support the P-CSCF restoration extension for the untrusted WLAN access, the PGW shall send an Update Bearer Request (as described in 3GPP TS 29.274 [10]) to the ePDG including the APCO information element set with a list of available P-CSCF addresses.\n9\tThe ePDG shall initiate an IKEv2 informational exchange procedure, as described in IETF RFC 7296 [23], towards the UE to forward the list of available P-CSCF addresses received from the PGW.\n10\tThe UE shall send a response to the ePDG which then shall send an Update Bearer Response to the PGW.\n11\tAs per the P-CSCF restoration procedures described in 3GPP TS 24.229 [19], the UE shall select one P-CSCF from the received list and proceed with an IMS registration.\nThe same call flow applies to PMIP-based S2b, whereby, in step 8, the PGW shall initiate an LMA Initiated Update Notification procedure, as described in 3GPP TS 29.275 [15], to provide the ePDG with the available P-CSCF addresses.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.6.2.2",
        "clause_5.3.2",
        "figure_5.6.5.2-1",
        "ts_29.273",
        "ts_29.274",
        "ts_24.229",
        "ts_29.275"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.5.3",
      "section_id": "5.6.5.3",
      "section_title": "Indication of UE support of the P-CSCF restoration extension for the untrusted WLAN access",
      "content": "If the UE supports the P-CSCF restoration extension for the untrusted WLAN access, it shall send an indication of this capability to the ePDG via a notify payload in the IKEv2 message to the ePDG at the establishment (or handover) of the IMS PDN connection over the untrusted WLAN access.\nAn ePDG which supports the P-CSCF restoration extension for untrusted WLAN shall forward this UE capability in the APCO information element to the PGW over the S2b interface.\nNOTE:\tThe receipt by the PGW of the UE capability indicating the support of P-CSCF restoration for the untrusted WLAN access at the IMS PDN connection establishment (or handover) over the untrusted WLAN access serves also as an indication that the ePDG supports this procedure.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.6.6.1",
      "section_id": "5.6.6.1",
      "section_title": "Introduction",
      "content": "The P-CSCF restoration mechanism for WLAN, compared to the 3GPP access one, requires additional functionalities from the HSS, the 3GPP AAA Server, the PGW for the basic mechanism and in addition from the PGW, the TWAN, the ePDG and the UE for the extended mechanism.\nThe support or not of the additional functionalities by the involved entities has consequences on the applicability of the P-CSCF restoration mechanism, both for the basic mechanism and the extended mechanism.  User roaming may imply a modification of the supported features.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.6.6.2",
      "section_id": "5.6.6.2",
      "section_title": "Feature support in the HSS and S-CSCF",
      "content": "The S-CSCF behaviour when triggering the HSS with a P-CSCF restoration indication is independent of the 3GPP access or of the WLAN access that the UE is using. The signalling regarding P-CSCF restoration over the Cx interface and the S-CSCF behaviour are common for the P-CSCF restoration over a 3GPP or a WLAN access.\nIf the HSS does not support P-CSCF restoration for WLAN, but supports P-CSCF restoration over a 3GPP access and if the UE is registered in a 3GPP access, the HSS shall behave as described in clause 5.4.\nIf the HSS does not support P-CSCF restoration for 3GPP access, but supports P-CSCF restoration for WLAN, if the user is registered in the non 3GPP access with an IMS APN configuration for non 3GPP access in its subscription and if the 3GPP AAA Server previously indicated the support of P-CSCF restoration for WLAN to the HSS, then the HSS shall behave as described in clause 5.6.2.\nIf the HSS supports P-CSCF restoration both for 3GPP access and WLAN and if the UE is registered both with 3GPP access and WLAN, the HSS shall initiate P-CSCF restoration for 3GPP access and WLAN as described in clause 5.4 for 3GPP access and in clause 5.6.2 for WLAN.\nThe HSS shall report DIAMETER_SUCCESS to S-CSCF if at least one serving node (SGSN, MME or 3GPP AAA Server) supports HSS-based P-CSCF Restoration and a request indicating P-CSCF restoration is sent to at least one of these supporting nodes.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "clause_5.6.2"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.6.3",
      "section_id": "5.6.6.3",
      "section_title": "Feature support in the 3GPP AAA Server",
      "content": "The 3GPP AAA Server shall inform the HSS, at the user registration over SWx, if it supports the P-CSCF restoration feature through a supported feature indication, so to allow the HSS to correctly react to a P-CSCF restoration indication received from the S-CSCF. This feature support indication does not contain any information about the support of the P-CSCF restoration feature by the PGW handling the IMS PDN connection.\nNOTE:\tThe user registration over SWx can result from the establishment of another PDN connection via a different PGW, before the user sets up the IMS PDN connexion. So, at the user registration, the 3GPP AAA Server does not know if the PGW that will later handle the IMS PDN connection supports the P-CSCF restoration feature.\nTherefore, when the PGW informs the 3GPP AAA Server over S6b that an IMS PDN connection is established, the PGW shall advertise the 3GPP AAA Server if the PGW supports the P-CSCF restoration mechanism for WLAN. A 3GPP AAA Server that supports the P-CSCF restoration mechanism shall store this information and when the 3GPP AAA Server receives a P-CSCF restoration indication from the HSS (as described in figure 5.6.2.2-1 step5b):\n-\tif an IMS PDN connection is established and if the PGW supports the P-CSCF restoration mechanism for WLAN, the 3GPP AAA Server shall behave as described in step 7 of clause 5.6.2.2;\n-\tif an IMS PDN connection is established and if the PGW does not support the P-CSCF restoration mechanism for WLAN, the 3GPP AAA Server shall ignore the P-CSCF restoration indication received from the HSS;\n-\tif no IMS PDN connection is established, the 3GPP AAA Server shall ignore the P-CSCF restoration indication received from the HSS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.6.2.2",
        "figure_5.6.2.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.6.4",
      "section_id": "5.6.6.4",
      "section_title": "Feature support in the PGW",
      "content": "A PGW supporting the basic P-CSCF restoration mechanism for trusted and/or untrusted WLAN shall indicate the support of P-CSCF restoration for WLAN to the 3GPP AAA Server in the Authorization Request message sent over S6b at the creation of the IMS PDN connection.\nThe support of the extended mechanism by the PGW requires the support of the basic mechanism. The extended mechanism is optionally supported by the PGW for TWAN or for untrusted WLAN or for both.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.6.6.5",
      "section_id": "5.6.6.5",
      "section_title": "Feature support in the TWAN",
      "content": "The TWAN shall advertise the support of the WLCP PDN connection modification request procedure over S2a at establishment (or handover) of the IMS PDN connection. This is to allow the PGW to use the P-CSCF restoration extension on this TWAN.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.6.6.6",
      "section_id": "5.6.6.6",
      "section_title": "Feature support in the ePDG",
      "content": "As described in clause 5.6.5.3, the ePDG indicates its support of the P-CSCF restoration extension to the PGW over S2b when sending the UE capability indication to the PGW at the IMS PDN connection establishment (or handover) over S2b.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6.5.3"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.6.6.7",
      "section_id": "5.6.6.7",
      "section_title": "Capability support in the UE",
      "content": "A UE supporting the P-CSCF restoration extension may support this mechanism for:\n-\tthe 3GPP access (e.g. a Rel-12 UE) and/or;\n-\tthe TWAN and/or;\n-\tthe untrusted WLAN.\nIn consequence, a UE capability is defined for each type of access to indicate the UE support of the extended P-CSCF restoration mechanism for this type of access, meaning up to three capabilities with all the possible combinations.\nDuring the set up (or handover) of the IMS PDN connection over a given type of access, the UE shall indicate its capability over this type of access.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.7.1",
      "section_id": "5.7.1",
      "section_title": "Introduction",
      "content": "P-CSCF restoration and NBIFOM present interactions as NBIFOM can be applied to the IMS PDN connection which can be set on a 3GPP access or on a WLAN access or be simultaneously active over the two types of accesses. This impacts the P-CSCF restoration procedures for a network supporting both P-CSCF restoration and NBIFOM with IMS UEs supporting NBIFOM, as described in the hereafter clauses which cover:\n-\tthe HSS-based and the PCRF-based solutions;\n-\tthe cases where the IMS PDN connection is established over one access or over  two accesses (3GPP access, WLAN access);\n-\tthe cases where the basic mechanism and/or the extended mechanism for P-CSCF restoration  are  supported by the network over only one access or on both accesses used by the IMS PDN connection;\n-\tthe capabilities of the IMS UEs with NBIFOM regarding the support or not of the extended mechanism for P-CSCF restoration over the 3GPP access, the trusted WLAN and/or the untrusted WLAN.\nRegarding WLAN accesses, the statements in clause 5.7 are the same for trusted WLAN with multi-connection mode and untrusted WLAN. For a trusted WLAN with the single connection mode or the transparent single connection mode, only the basic P-CSCF restoration mechanism may apply.\nThe support of the basic mechanism or of the extended mechanism for P-CSCF restoration in clause 5.7 is meant as the support over the whole chain of involved functional elements over an access type at the creation of the IMS PDN connection over the concerned access, so, in particular, taking into account the UE capability for the extended mechanism over this access.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.7"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.7.2",
      "section_id": "5.7.2",
      "section_title": "HSS-based solution",
      "content": "If the MME/SGSN is configured with the extended mechanism (i.e. the MME/SGSN forwards a received P-CSCF restoration indication to the PGW) and:\n-\tIf the IMS PDN connection is established over at least one access supporting the extended mechanism with the UE, the PGW, when receiving a P-CSCF restoration indication, shall select one access supporting the extended mechanism and send the list of available P-CSCF addresses over this access. The PGW shall ignore any second P-CSCF restoration indication which may be received shortly afterwards;\n-\tIf the IMS PDN connection is established over access(es) not supporting the extended mechanism with the UE, but over at least one supporting the basic mechanism, the PGW, when receiving a P-CSCF restoration indication (be it from the MME or the 3GPP AAA server), shall:\n-\tselect one access supporting the basic mechanism and release the IMS PDN connection over that access with the cause \"reactivation requested\". The PGW shall ignore any second P-CSCF restoration indication which may be received shortly afterwards. If the IMS PDN connection is established on both accesses with the single connection mode over the trusted WLAN, the PGW shall select the 3GPP access; and\n-\trelease the IMS PDN connection over the other access with a \"local release\" cause. The MME/SGSN or TWAN/ePDG in the other access shall release the corresponding bearer resources as specified in 3GPP TS 23.401 [17] or IETF RFC 5996 [26], but without signalling to the UE. Further, for the local release of the bearer resources by the MME/SGSN for a UE that is in connected mode, the MME/SGSN shall initiate the radio access bearer release procedure towards the serving eNB/NB.\nIf the MME/SGSN supports only the basic mechanism (i.e. the MME/SGSN does not forward the P-CSCF restoration indication to the PGW), the MME/SGSN, when receiving a P-CSCF restoration indication, shall release the IMS PDN connection with the cause \"reactivation requested\" sent to the UE or, if this is the last PDN connection of the UE, sends an explicit detach to the UE with the cause \"reattach required\" (as specified in clause 5.4.2.1). The MME/SGSN shall release the IMS PDN connection towards the PGW by sending a Delete Session Request to the PGW with the Release Over Any Access Indication. Upon receipt of such a message and indication, the PGW shall initiate a Delete Bearer Request procedure with a \"local release\" cause to tear down the PDN connection over the other access, if this is a NBIFOM PDN connection and resources still exist on that other access. The TWAN/ePDG shall then proceed with the local disconnection of the PDN connection, i.e. the TWAN/ePDG need not send signalling to the UE to release that access. The UE may, over the WLAN access, also receive a release of the IMS PDN connection or a list of available P-CSCFs.\nUpon receipt of a request to release an IMS PDN connection with the cause \"reactivation requested\" over the 3GPP or the WLAN access, or a Detach request with the cause \"reattach required\" over the 3GPP access, the UE shall locally release the IMS PDN connection over the other access if the IMS PDN connection was established on both accesses, then re-establish the IMS PDN connection and do a new IMS registration. The UE should avoid doing two new IMS registrations in a row.\nNOTE:\tWhen a Detach request with the cause \"reattach required\" over the 3GPP access occurs due to a P-CSCF restoration indication, there is no PDN connection other than the IMS PDN connection established over the 3GPP access, so any PDN connection established over the WLAN access other than the IMS PDN connection is maintained.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.2.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.7.3",
      "section_id": "5.7.3",
      "section_title": "PCRF-based solution",
      "content": "If the IMS PDN connection is established over at least one access supporting the extended mechanism with the UE, the PGW, when receiving a P-CSCF restoration indication, shall select one access supporting the extended mechanism and send the list of available P-CSCF addresses over this access.\nIf the IMS PDN connection is established over access(es) not supporting the extended mechanism with the UE, but over at least one supporting the basic mechanism, the PGW, when receiving a P-CSCF restoration indication, shall:\n-\tselect one access supporting the basic mechanism and release the IMS PDN connection over that access with the cause \"reactivation requested\". If the IMS PDN connection is established on both accesses with the single connection mode over the trusted WLAN, the PGW shall select the 3GPP access; and\n-\trelease the IMS PDN connection over the other access with a \"local release\" cause. The MME/SGSN or TWAN/ePDG in the other access shall release the corresponding bearer resources as specified in 3GPP TS 23.401 [17] or IETF RFC 5996 [26], but without signalling to the UE. Further, for the local release of the bearer resources by the MME/SGSN for a UE that is in connected mode, the MME/SGSN shall initiate the radio access bearer release procedure towards the serving eNB/NB.\nUpon receipt of a request to release an IMS PDN connection with the cause \"reactivation requested\" over the 3GPP or the WLAN access, or a Detach request with the cause \"reattach required\" over the 3GPP access, the UE shall locally release the IMS PDN connection over the other access if the IMS PDN connection was established on both accesses, then re-establish the IMS PDN connection and do a new IMS registration.\nNOTE:\tWhen a Detach request with the cause \"reattach required\" over the 3GPP access occurs due to a P-CSCF restoration indication, there is no PDN connection other than the IMS PDN connection established over the 3GPP access, so any PDN connection established over the WLAN access other than the IMS PDN connection is maintained.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.1",
      "section_id": "5.8.1",
      "section_title": "Introduction",
      "content": "The clause 5.8 describes solutions to support P-CSCF restoration in 5GC for UEs with an IMS PDU session.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.2.1",
      "section_id": "5.8.2.1",
      "section_title": "General",
      "content": "If IMS service is required through 5GC, the UE performs Registration procedure and requests PDU Session Establishment procedure for IMS service, as specified in 3GPP TS 23.501 [28] and 3GPP TS 23.502 [29]. The UE selects P-CSCF via PDU Session Establishment procedure or via DHCP procedure and performs initial IMS registration (see 3GPP TS 23.228 [27]).\nP-CSCF failure may be detected during an originating SIP procedure or terminating SIP procedure. When P-CSCF failure is detected, various mechanisms for P-CSCF restoration can be invoked (by e.g. SMF, UDM or PCF), depending on the mechanism utilized.\nVarious mechanisms for P-CSCF restoration in 5GC have common procedures which are used to trigger the P-CSCF re-selection at the UE side, as specified in the following clauses.\nNOTE:\tAmongst the three common procedures, the PDU Session Release with Reactivation Procedure described at clause 5.8.2.4 has the highest signalling impact on the radio access and core networks; on the other hand it doesn't require the UE to support the optional P-CSCF Re-selection mechanism.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.8.2.4",
        "ts_23.501",
        "ts_23.502",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.2.2",
      "section_id": "5.8.2.2",
      "section_title": "P-CSCF Address List Update Procedure",
      "content": "The following requirements shall be supported for the procedure specified in this clause:\n1.\tP-CSCF discovery was performed by requesting and provisioning P-CSCF address(es) within Extended Protocol Configuration Options (ePCO), as specified in 3GPP TS 29.061 [9], clause 13a.2.1.\n2.\tThe UE has indicated the \"P-CSCF Re-selection support\" in the ePCO IE, as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A.\nFigure 5.8.2.2-1 describes the P-CSCF address list update procedure at detection of P-CSCF failure.\nFigure 5.8.2.2-1: P-CSCF Address Update Procedure\nWhen P-CSCF failure occurs, the SMF detects it or is informed of the event by another NF (e.g. AMF, UDM...) and it initiates the PDU Session Update procedure, in order to send the new P-CSCF list to the UE.\n1.\tThe SMF invokes Namf_Communication_N1N2MessageTransfer service operation, to trigger the PDU Session Modification procedure. Within the message, the SMF includes an ePCO IE as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A with a new list of P-CSCF addresses.\n2.\tThe AMF triggers the PDU Session Modification procedure with the UE to deliver the new list of P-CSCF.\n3.\tUpon receiving the new list of P-CSCFs, the UE selects a P-CSCF from the list to perform an initial SIP registration.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_29.061_clause_13",
        "ts_24.008_clause_10.5.6.3",
        "figure_5.8.2.2-1",
        "ts_29.061",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.2.3",
      "section_id": "5.8.2.3",
      "section_title": "DHCP based P-CSCF Selection Triggering Procedure",
      "content": "The following requirements shall be supported for the procedure specified in this clause:\n1.\tP-CSCF discovery was performed by requesting P-CSCF address(es) via DHCP method, as specified in 3GPP TS 29.061 [9], clause 13a.2.1\n2.\tThe UE has indicated the \"P-CSCF Re-selection support\" in the ePCO IE, as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A.\nFigure 5.8.2.3-1 describes the DHCP based P-CSCF selection triggering procedure.\nFigure 5.8.2.3-1: P-CSCF Selection Triggering Procedure\nWhen P-CSCF failure occurs, the SMF detects it or is informed of the event by another NF (e.g. AMF, UDM...) and it initiates the PDU Session Update procedure, in order to send a P-CSCF failure indication to the UE.\n1.\tThe SMF invokes Namf_Communication_N1N2MessageTransfer service operation, to trigger the PDU Session Modification procedure. Within the message, the SMF includes a P-CSCF failure indication in the ePCO IE as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A.\n2.\tThe AMF triggers the PDU Session Modification procedure to the UE, to deliver the P-CSCF failure indication to the UE.\n3.\tUpon receiving the P-CSCF failure indication, the UE discovers another P-CSCF via DHCP procedure to perform SIP registration.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_29.061_clause_13",
        "ts_24.008_clause_10.5.6.3",
        "figure_5.8.2.3-1",
        "ts_29.061",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.2.4",
      "section_id": "5.8.2.4",
      "section_title": "PDU Session Release with Reactivation Procedure",
      "content": "The following requirements shall be supported for the procedure specified in this clause:\n1.\tThe UE has not indicated the \"P-CSCF Re-selection support\" in the ePCO IE, as specified in 3GPP TS 24.008 [4], clause 10.5.6.3.\nFigure 5.8.2.4-1 describes the procedure of PDU session release with reactivation indication.\nFigure 5.8.2.4-1: PDU Session Release with Reactivation Indication\nWhen P-CSCF failure occurs, the SMF detects it or is informed of the event by another NF (e.g. AMF, UDM...) and it initiates the PDU Session Release procedure, with reactivation indication.\n1.\tThe network initiates a PDU session release with reactivation indication of the IMS PDU session according to 3GPP TS 23.502 [29], clause 4.3.4. The exact network function that triggers the procedure depends on the P-CSCF restoration method used.\n2.\tThe UE requests to re-establish IMS PDU session. The UE discovers P-CSCF during the IMS PDU session establishment or via DHCP procedure, to perform SIP registration.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_24.008_clause_10.5.6.3",
        "ts_23.502_clause_4.3.4",
        "figure_5.8.2.4-1",
        "ts_24.008",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.3.1",
      "section_id": "5.8.3.1",
      "section_title": "Overview and Principles",
      "content": "The P-CSCF failure detection at SMF/UPF is an optional mechanism.\nThis mechanism is executed when an originating request cannot be served due to a P-CSCF failure, as long as there are no other registration flows for this originating UE using an available P-CSCF.\nOnce the P-CSCF is reported as failed, the SMF initiates IMS PDU sesion update procedure, so as to trigger the UE to re-select a P-CSCF and to register again to IMS.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.8.3.2",
      "section_id": "5.8.3.2",
      "section_title": "P-CSCF Monitoring and Failure Detection Procedure",
      "content": "The following figure 5.8.3.2-1 describes the SMF-instructed P-CSCF monitoring and failure detection. When P-CSCF failure is detected, the SMF triggers the related procedures, as specified in 5.8.2 for P-CSCF restoration.\nFigure 5.8.3.2-1: P-CSCF Failure Detection at SMF/UPF\n1.\tThe UE sends a PDU Session Establishment Request towards the AMF, to establish a PDU session for IMS service.\n2.\tThe AMF invokes Nsmf_PDUSession_CreateSMContext service operation to the SMF, to request the SMF to create PDU session for IMS service.\n3.\tThe SMF invokes Npcf_SMFPolicyControl_Get service operation to the PCF, to retrieve session related policy.\n4.\tThe SMF selects appropriate UPF for IMS service and requests the UPF to establish N4 session.\n5.\tWhen PDU session is created, the SMF invokes Namf_Communication_N1N2MessageTransfer service operation to the AMF, to inform the request of PDU session establishment. A list of P-CSCF address is also included in the ePCO as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A.\n6.\tThe AMF sends PDU Establishenment Response message to the UE, with a list of P-CSCF included in the ePCO as specified in 3GPP TS 24.008 [4], clause 10.5.6.3A.\n7.\tThe UE performs an initial registration towards a P-CSCF from the received list.\n8.\tThe P-CSCF sends Rx Push (see 3GPP TS 29.214 [7]) to provide the PCF with the P-CSCF selected by the UE. The PCF sends Rx Push response.\n9.\tThe PCF sends P-CSCF address to the SMF, e.g. using Notification procedure.\nEditor's Note:\tIt is FFS on which Npcf procedure/message is used for the PCF to send P-CSCF address to the SMF.\n10.\tThe P-CSCF sends 200 OK to the UE.\nUpon P-CSCF failure detection by the SMF/UPF;\n11.a\tIf the requirements listed at clause 5.8.2.2 are fulfilled, the SMF initiates the P-CSCF address list update procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.2\n11.b\tIf the requirements listed at clause 5.8.2.3 are fulfilled, the SMF initiates the DHCP based P-CSCF selection triggering procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.3.\n11.c\tOtherwise the SMF initiates the PDU Session Release with Reactivation procedure to trigger the UE re-establish IMS PDUS session, as specified in clause 5.8.2.4.\n12.\tSubsequent to step 11, the UE performs an initial IMS registration towards the new P-CSCF, as specified in clause 5.8.2.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_24.008_clause_10.5.6.3",
        "clause_5.8.2.2",
        "clause_5.8.2.3",
        "clause_5.8.2.4",
        "clause_5.8.2",
        "figure_5.8.3.2-1",
        "ts_24.008",
        "ts_29.214"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.4.1",
      "section_id": "5.8.4.1",
      "section_title": "Overview and principles",
      "content": "The UDM/HSS based P-CSCF restoration is an optional mechanism.\nAs the IMS system interfaces an HSS, the UDM/HSS in this clause shall be interpreted as TS 23.228 [27], annex Y, clause Y.0.\nThis mechanism is executed when a terminating request does not proceed due to a P-CSCF failure, as long as there are no other registration flows for this terminating UE using an available P-CSCF.\nWhen P-CSCF failure is detected, the UDM shall, either:\n-\tsend a P-CSCF restoration indication to the SMF serving IMS PDU session, and the SMF thus initiates IMS PDU session update procedure or the IMS PDU session re-establishment, so as to trigger the UE re-selects P-CSCF and registers again to IMS, or\n-\tsend a P-CSCF restoration indication to the AMF serving the UE, and the AMF initiates IMS PDU session re-establishment, and the UE re-selects P-CSCF and registers again to IMS.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.4.2",
      "section_id": "5.8.4.2",
      "section_title": "Trigger P-CSCF Restoration Procedure via SMF",
      "content": "During establishing PDU Session for IMS service, the SMF performs registration to the UDM and provides sufficient information for triggering P-CSCF restoration procedure (e.g. DNN=\"IMS\", callback URI for P-CSCF restoration…), as specified in 3GPP TS 29.503 [31].\nWhen the UDM determines that a P-CSCF restoration needs to be triggered, the UDM selects the SMF serving IMS, according to the SMF registration information in the UDM, to trigger the P-CSCF restoration procedure.\nThe following figure 5.8.4.2-1 illustrates how the SMF supports P-CSCF restoration procedure in 5G network.\nFigure 5.8.4.2-1: Trigger P-CSCF Restoration Procedure via SMF\n0:\tThe SMF serving the IMS PDU session registers at the UDM. If the SMF supports the UDM based P-CSCF restoration mechanism, it provides a callback URI for P-CSCF restoration notifications.\n1-5. The S-CSCF receives incoming SIP message. If the S-CSCF detects the previous P-CSCF is failed (e.g. due to return SIP error or lack of response), the S-CSCF sends Cx SAR message to the HSS, including P-CSCF restoration indication and, optionally, the address of the failed P-CSCF.\nAfter receiving the Cx SAR message, the HSS forwards the P-CSCF restoration indication and the address of the failed P-CSCF to the UDM by means of the Nudm_UECM P-CSCF-RestorationTrigger service operation (see 3GPP TS 23.632 [33]).\n6.\tThe UDM sends Nudm_UECM_PCscfRestoration notification to the SMF serving IMS PDU session, using the received callback URI for P-CSCF restoration notifications. The notification may include the address of the failed P-CSCF. The SMF accepts the Nudm message and sends HTTP response message to the UDM.\n7.\tThe S-CSCF sends a SIP response back to the originating side.\n8.a\tIf the requirements listed at clause 5.8.2.2 are fulfilled, the SMF initiates the P-CSCF address list update procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.2; if the SMF received the address of the failed P-CSCF in the notification from UDM, it may take it into account to build the list of available P-CSCFs that should be sent to the UE.\nNOTE 1:\tThe address of the failed P-CSCF received by SMF from UDM corresponds to the Mw interface of the P-CSCF and the (updated) address list of P-CSCFs that the SMF sends to the UE over PCO corresponds to the Gm interface of the P-CSCF; the SMF derives the Gm IP address of the failed P-CSCF from the received Mw address (FQDN and/or IP address) (e.g., based on local mapping).\nNOTE 2:\tThe failed P-CSCF can be included again in the new P-CSCF list once it has recovered.\n8.b\tIf the requirements listed at clause 5.8.2.3 are fulfilled, the SMF initiates the DHCP based P-CSCF selection triggering procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.3.\n8.c\tOtherwise the SMF initiates the PDU Session Release with Reactivation procedure to the UE, to trigger the UE re-establish IMS PDUS session, as specified in clause 5.8.2.4.\n9.\tSubsequent to step 8, the UE performs an initial IMS registration towards the new P-CSCF, as specified in clause 5.8.2.\n10.\tThe S-CSCF sends the suspended terminating SIP message to a newly selected P-CSCF after the successful SIP registration for the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.2.2",
        "clause_5.8.2.3",
        "clause_5.8.2.4",
        "clause_5.8.2",
        "figure_5.8.4.2-1",
        "ts_29.503",
        "ts_23.632"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.4.3",
      "section_id": "5.8.4.3",
      "section_title": "Trigger P-CSCF Restoration Procedure via AMF",
      "content": "During establishing PDU Session for IMS service, the AMF performs registration to the UDM and provides sufficient information for triggering P-CSCF restoration procedure, as specified in 3GPP TS 29.503 [31].\nWhen the UDM determines P-CSCF restoration need to be triggered, the UDM selects the AMF serving the UE according to the AMF registration information in the UDM, to trigger the P-CSCF restoration procedure.\nThe following figure 5.8.4.3-1 illustrates how the AMF supports P-CSCF restoration procedure in 5G network.\nFigure 5.8.4.3-1: Trigger P-CSCF Restoration Procedure via AMF\n0:\tThe AMF serving the UE registers at the UDM. If the AMF supports the UDM based P-CSCF restoration mechanism, it provides a callback URI for P-CSCF restoration notifications.\n1-5. The S-CSCF receives incoming SIP message. If the S-CSCF detects the previous P-CSCF is failed (e.g. due to return SIP error or lack of response), the S-CSCF sends Cx SAR message to the HSS, including P-CSCF restoration indication.\nAfter receiving the Cx SAR message, the HSS forwards the P-CSCF restoration indication to the UDM by means of the Nudm_UECM P-CSCF-RestorationTrigger service operation (see 3GPP TS 23.632 [33]).\n6.\tThe UDM sends Nudm_UECM_PCscfRestoration notification to the AMF serving the UE, using the received callback URI for P-CSCF restoration notifications. The AMF accepts the Nudm message and sends HTTP response message to the UDM.\n7.\tThe S-CSCF sends a SIP response back to the originating side.\n8.\tThe AMF initiates a network-triggered PDU Session Release procedure of the IMS PDU session with Reactivation indication, as specified in clause 5.8.2.4.\n9.\tSubsequent to step 8, the UE performs an initial IMS registration towards the new P-CSCF, as specified in clause 5.8.2.4.\n10.\tThe S-CSCF sends the suspended terminating SIP message to a newly selected P-CSCF after the successful SIP registration for the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.2.4",
        "figure_5.8.4.3-1",
        "ts_29.503",
        "ts_23.632"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.8.5.1",
      "section_id": "5.8.5.1",
      "section_title": "Introduction",
      "content": "The PCF based P-CSCF restoration is an optional mechanism.\nThis mechanism is executed when a terminating request does not proceed due to a P-CSCF failure, as long as there are no other registration flows for this terminating UE using an available P-CSCF.\nWhen P-CSCF failure is detected, the S-CSCF sends a P-CSCF restoration indication through an alternative P-CSCF and the PCF thus initiates IMS PDU session update procedure, so as to trigger the UE re-selects P-CSCF and registers again to IMS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_5.8.5.2",
      "section_id": "5.8.5.2",
      "section_title": "Trigger P-CSCF Restoration Procedure via PCF",
      "content": "The following figure illustrates the details of PCF based P-CSCF restoration procedure in 5G network.\nFigure 5.8.5.2-1: Trigger P-CSCF Restoration Procedure via PCF\nThe P-CSCF failure is detected by S-CSCF or IBCF/ATCF, as specified in clause 5.5.\n1.\tThe S-CSCF receives a terminating INVITE message.\n2.\tAs the failure of the previous P-CSCF is detected, the S-CSCF forwards the Terminating INVITE message to an alternative P-CSCF, as specified in clause 5.5. The S-CSCF may include the address of the failed P-CSCF, if available. The alternative P-CSCF is chosen by local configuration.\n3.\tThe alternative P-CSCF shall send an Rx AAR message or shall invoke the Npcf_PolicyAuthorization_Create service operation with the P-CSCF restoration indication to the associated PCF. The associated PCF is chosen as specified in 3GPP TS 23.503 [30]. The alternative P-CSCF includes, if received, the address of the failed P-CSCF in the request. The PCF shall send an Rx AAA or shall respond the Npcf_PolicyAuthorization_Create request to the P-CSCF.\n4.\tThe PCF sends P-CSCF restoration indication to the SMF serving IMS PDU session, as specified in 3GPP TS 29.512 [32] clause 4.2.3; the PCF may include, optionally, the address of the failed P-CSCF.\n5.a\tIf the requirements listed at clause 5.8.2.2 are fulfilled, the SMF initiates the P-CSCF address list update procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.2; if the SMF received the address of the failed P-CSCF in the notification from PCF, it may take it into account to build the list of available P-CSCFs that should be sent to the UE.\nNOTE 1:\tThe address of the failed P-CSCF received by SMF from PCF corresponds to the Mw interface of the P-CSCF and the (updated) address list of P-CSCFs that the SMF sends to the UE over PCO corresponds to the Gm interface of the P-CSCF; the SMF derives the Gm IP address of the failed P-CSCF from the received Mw address (FQDN and/or IP address) (e.g., based on local mapping).\nNOTE 2:\tThe failed P-CSCF can be included again in the new P-CSCF list once it has recovered.\n5.b\tIf the requirements listed at clause 5.8.2.3 are fulfilled, the SMF initiates the DHCP based P-CSCF selection triggering procedure to trigger the P-CSCF reselection by the UE as specified in clause 5.8.2.3.\n5.c\tOtherwise the SMF initiates the PDU Session Release with Reactivation procedure to the UE, to trigger the UE re-establish IMS PDUS session, as specified in 5.8.2.4.\n6.\tSubsequent to step 8, the UE performs an initial IMS registration towards the new P-CSCF, as specified in clause 5.8.2.\n7.\tThe S-CSCF sends the suspended terminating SIP message to a newly selected P-CSCF after the successful SIP registration for the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.5",
        "ts_29.512_clause_4.2.3",
        "clause_5.8.2.2",
        "clause_5.8.2.3",
        "clause_5.8.2",
        "figure_5.8.5.2-1",
        "ts_23.503",
        "ts_29.512"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.9",
      "section_id": "5.9",
      "section_title": "P-CSCF Restoration in EPC with 5GC interworking",
      "content": "If IMS service is required in EPC with 5GC interworking as specified in 3GPP TS 23.501 [28], HSS+UDM and PGW-C+SMF are involved in the P-CSCF procedures.\nAfter mobility from 5GC to EPC happens for a UE as specified in 3GPP TS 23.502 [29], the MME via S6a (or AAA for WLAN via SWx) registers itself to HSS+UDM and PGW-C+SMF registered itself via N10 in the HSS+UDM when the UE was in 5GC. In this case, when P-CSCF restoration indication is received from S-CSCF, the HSS+UDM shall, either:\n-\tsend a P-CSCF restoration indication to the MME serving the UE as specified in clause 5.4 \"HSS-based P-CSCF restoration for 3GPP access\", or to the AAA for WLAN as specified in clause 5.6.2 \"Basic mechanism for the HSS-based solution\", or\n-\tsend a P-CSCF restoration indication via N10 interface to the PGW-C+SMF serving IMS PDN connection as described in clause 5.8.4.2 step 6, and the PGW-C+SMF thus initiates IMS PDN connection update procedure in EPC or the IMS PDN connection deactivation with reactivation required, to trigger the UE re-selects P-CSCF and registers again to IMS as described in clause 5.4.3.2 from step 8 to 10, in clause 5.6.2.2 from step 8 to 10, or in clause 5.6.5.2 step 8 to 11.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4",
        "clause_5.6.2",
        "clause_5.8.4.2",
        "clause_5.4.3.2",
        "clause_5.6.2.2",
        "clause_5.6.5.2",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.380_5.10",
      "section_id": "5.10",
      "section_title": "P-CSCF Restoration in EPC for untrusted WLAN when N10 is used instead of S6b",
      "content": "If the IMS service is required to be served by untrusted WLAN where N10 is used instead of S6b interface as specified in 3GPP TS 23.502 [29], the AAA registers itself in HSS+UDM via SWx interface, and PGW-C+SMF registers itself in HSS+UDM via N10.\nWhen P-CSCF restoration indication is received, the HSS+UDM shall send a P-CSCF restoration indication via N10 interface to the PGW-C+SMF serving the IMS PDN connection as described in clause 5.9 to continue with the P-CSCF restoration.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.9",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.380_6.1",
      "section_id": "6.1",
      "section_title": "General",
      "content": "The following clauses show the requirements and information flows of IMS Restoration Procedures for the SCC-AS service interruption in each of the scenarios where they apply.\nIt is an optional feature to support SCC-AS restoration. If SCC-AS restoration is supported, it is required to support enhanced third part registration procedure described in 6.2.1 and enhanced service request procedure described in 6.2.2 together.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.380_6.2",
      "section_id": "6.2",
      "section_title": "General Procedure",
      "content": "During the 3rd party registration, the SCC-AS should store extra SRVCC related information, i.e, ATCF-Path-URI, ATCF-Management-URI and g.3gpp.accesstype media feature tag if received as specified in 3GPP TS 24.237 [34] clause 6.3.2, in the HSS as Repository Data.\nWhen a service request is received when assigned SCC-AS is down, the S-CSCF should forward the service request to a working SCC-AS and this SCC-AS should:\n-\tdownload corresponding ATCF related information previously stored in the HSS and it should notify the ATCF with its own ATU-STI for SRVCC; and\n-\tdownload corresponding g.3gpp.accesstype media feature tag (if exist) previously stored in the HSS and determine that PS to CS SRVCC is usable for UE as specified in 3GPP TS 24.237 [34] clause 6.3.2.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_24.237_clause_6.3.2",
        "ts_24.237"
      ]
    },
    {
      "chunk_id": "ts_23.380_6.2.1.1",
      "section_id": "6.2.1.1",
      "section_title": "Introduction",
      "content": "The restoration described in the clause 6.2.1 is an optional mechanism which applies for third party registration. The SCC-AS are optionally enhanced to store ATCF related information and g.3gpp.accesstype media feature tag (if received) in the HSS as Repository Data.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.380_6.2.1.2",
      "section_id": "6.2.1.2",
      "section_title": "Description",
      "content": "Enhanced third party registration procedure is described in figure 6.2.1.2-1.\nFigure 6.2.1.2-1 Enhanced Third Party Registration Procedure\n21.\tFor the first time the SCC-AS receives a third party registration of a served user, the SCC-AS shall store the ATCF-Path-URI, ATCF–Management-URI parameters and g.3gpp.accesstype media feature tag (if received) contained in the SIP REGISTER request as new Repository Data in the HSS. For the subsequent third party registration of that served user, the SCC-AS shall update the ATCF-Path-URI, the ATCF-Management-URI and the g.3gpp.accesstype media feature tag stored in the HSS as Repository Data with the new received value.\nThe SCC-AS may as well store this data locally, and then for the subsequent third party registration of that served user, if the ATCF-Path-URI, the ATCF-Management-URI and/or the g.3gpp.accesstype media feature tag (if received) contained in the SIP REGISTER request is different from previously stored one, the SCC-AS shall update the locally stored ATCF-Path-URI, the ATCF-Management-URI or the g.3gpp.accesstype media feature tag as well as that stored in the HSS as Repository Data with the new received value.\nNOTE 1:\tThe SCC-AS already updates STN-SR in the HSS using PUR/PUA command, then the SCC-AS may send the new Repository Data along with STN-SR in a single PUR (only if  Update-Eff-Enhance feature is supported).\n22.\tHSS updates data and responds back.\n23 ~ 24.\tHSS sends the received STN-SR and C-MSISDN to update MME/SGSN as normal.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.2.1.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.380_6.2.2.1",
      "section_id": "6.2.2.1",
      "section_title": "Introduction",
      "content": "The restoration described in the clause 6.2.2 is an optional mechanism which applies for service request. And SCC-AS is optionally enhanced to download SRVCC related information as Repository Data from the HSS and notify the ATCF with new ATU-STI.\nEnhanced Service Request Procedure is based on enhanced third part registration procedure in 6.2.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2.2"
      ]
    },
    {
      "chunk_id": "ts_23.380_6.2.2.2",
      "section_id": "6.2.2.2",
      "section_title": "Description",
      "content": "Enhanced service request procedure is described in figure 6.2.2.2-1.\nFigure 6.2.2.2-1 Enhanced Service Request Procedure\n1.\tThe S-CSCF receives session service request message and it attempts to route the message towards the registered SCC-AS, that in the figure 6.2.2.2-1 is \"SCC-AS1\".\n2.\tThe S-CSCF detects the failure of SCC-AS1.\n3.\tS-CSCF re-selects a new available SCC-AS, i.e. \"SCC-AS2\" e.g. by a DNS procedure or by configuration in the matched Filter Criteria of an alternative SCC-AS to provide services to the user.\n4.\tThe S-CSCF sends the message to the selected SCC-AS2.\n5.\tAfter receiving the service request message, if no subscriber data is found, SCC-AS2 starts implicit registration procedure as normal (not displayed in figure 6.2.2.2-1). After retrieving required subscriber data from the HSS, the SCC-AS2 shall request the ATCF related information and the g.3gpp.accesstype media feature tag stored as Repository Data (if present).\n6.\tIf ATCF related Repository Data is stored in the HSS, it is received back by the SCC-AS2.\n7.\tIf ATCF related Repository Data is received by the SCC-AS2, it shall send a MESSAGE with its own ATU-STI towards the ATCF that is identified by received ATCF-Management-URI. If the g.3gpp.accesstype media feature tag is present, the SCC-AS2 shall determine that PS to CS SRVCC is usable for UE as specified in 3GPP TS 24.237 [34] clause 6.3.2.\n8.\tThe SCC-AS2 continues the session as normal.\nAnnex A (informative):Change history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nCat\nSubject/Comment\nNew\nCT#41\nV1.0.0 was approved in CT#41\n8.0.0\n2008-12\nCT#42\nCP-080698\n0003\n-\nRe-selection of S-CSCF at de-registration\n8.1.0\n2008-12\nCT#42\nCP-080698\n0004\n1\nSubscription to registration information recover\n8.1.0\n2008-12\nCT#42\nCP-080963\n0007\n3\nAS originating procedures\n8.1.0\n2008-12\nCT#42\nCP-080698\n0008\n-\nMultiple contacts restoration at re-registration\n8.1.0\n2008-12\nCT#42\nCP-080698\n0009\n1\nMultiple contacts restoration at de-registration\n8.1.0\n2009-03\nCT#43\nCP-090026\n0010\n-\nMultiple Registrations in De-Registration\n8.2.0\n2009-03\nCT#43\nCP-090026\n0011\n-\nMultiple Registrations in Registration\n8.2.0\n2009-06\nCT#44\nCP-090303\n0019\n-\nContact storage in reg event subscription\n8.3.0\n2009-12\nCT#46\nCP-090796\n0020\n1\nP-CSCF restoration procedures: stage 2\n9.0.0\n2010-03\nCT#47\nCP-100045\n0022\n1\nP-CSCF failure indication removal\n9.1.0\n2010-03\nCT#47\nCP-100045\n0023\n1\nP-CSCF failure handling for DHCP based scenarios\n9.1.0\n2010-03\nCT#47\nCP-100045\n0024\n1\nP-CSCF monitoring performed by UE\n9.1.0\n2010-03\nCT#47\nCP-100045\n0025\n1\nS9 interface procedures\n9.1.0\n2010-06\nCT#48\nCP-100285\n0027\n-\nNotification is to be sent to all UEs sharing the IMPU\n9.2.0\n2010-09\nCT#49\nCP-100462\n0030\n1\nRestoration Data Backup\n9.3.0\n2011-03\n-\nUpdate to Rel-10 version (MCC)\n10.0.0\n2011-06\nCT#52\nCP-110356\n0033\n-\nEmergency Restoration\n10.1.0\n2012-09\nCT#57\nCP-120440\n0040\n1\nEmergency registrations do not affect registration status\n10.2.0\n2012-09\nCT#57\nCP-120458\n0037\n1\nP-CSCF failure procedure with S5 PMIP\n11.0.0\n2012-09\nCT#57\nCP-120458\n0041\n1\nReference list correction to align with the corrected TS 29.212 title\n11.0.0\n2012-12\nCT#58\nCP-120745\n0042\n1\nAlignment on the Network recovery procedure at P-CSCF failure\n11.1.0\n2012-12\nCT#58\nCP-120743\n0046\n1\nPSI direct routing with restoration procedures\n11.1.0\n2013-12\nCT#62\nCP-130609\n0047\n1\nCorrection of reference to Update Notifications for Proxy Mobile IPv6\n11.2.0\n2014-03\nCT#63\nCP-140017\n0051\n1\nUpdate the reference of  draft-ietf-sipcore-keep-01 to RFC 6223\n11.3.0\n2014-03\nCT#63\nCP-140020\n0048\n1\nUpdate the reference of IETF draft Update Notifications for Proxy Mobile IPv6 to RFC 7077\n11.3.0\n2014-09\nCT#65\nCP-140515\n0053\n1\nT-GRUU restoration\n12.0.0\n2014-09\nCT#65\nCP-140506\n0054\n3\nHSS-based P-CSCF restoration\n12.0.0\n2014-09\nCT#65\nCP-140506\n0055\n2\nP-CSCF restoration in roaming scenarios for the HSS based mechanism\n12.0.0\n2014-09\nCT#65\nCP-140506\n0056\n5\nPCRF based P-CSCF restoration\n12.0.0\n2014-09\nCT#65\nCP-140506\n0057\n3\nP-CSCF restoration in roaming scenarios for PCRF based solution\n12.0.0\n2014-12\nCT#66\nCP-140794\n0059\n1\nHSS-based P-CSCF restoration, ISR implications\n12.1.0\n2014-12\nCT#66\nCP-140794\n0060\n3\nHSS-based P-CSCF restoration, MME/SGSN lack of support\n12.1.0\n2014-12\nCT#66\nCP-140794\n0061\n1\nHSS-based P-CSCF restoration, response back to UE with retry option\n12.1.0\n2014-12\nCT#66\nCP-140794\n0062\n2\nP-CSCF Restoration for single IMS APN\n12.1.0\n2014-12\nCT#66\nCP-140794\n0065\n1\nP-CSCF restoration in a roaming scenario that P-GW and P-CSCF are in HPLMN for PCRF based solution\n12.1.0\n2014-12\nCT#66\nCP-140794\n0066\n1\nA correction in figure of PCRF based P-CSCF restoration\n12.1.0\n2014-12\nCT#66\nCP-140794\n0069\n2\nP-CSCF Restart\n12.1.0\n2014-12\nCT#66\nCP-140794\n0070\n-\nAddition of P-CSCF restoration in the scope\n12.1.0\n2014-12\nCT#66\nCP-140794\n0071\n2\nP-CSCF as non-reachable clarification\n12.1.0\n2015-03\nCT#67\nCP-150033\n0073\n1\nP-CSCF restoration failure when UE is temporarily out of coverage\n12.2.0\n2015-06\nCT#68\nCP-150261\n0074\n1\nS-CSCF hanlding in PCRF based solution when UE is temporarily out of coverage\n12.3.0\n2015-09\nCT#69\nCP-150458\n0075\n1\nBasic P-CSCF restoration mechanism for WLAN\n13.0.0\n2015-09\nCT#69\nCP-150458\n0076\n2\nP-CSCF restoration supported features\n13.0.0\n2015-09\nCT#69\nCP-150458\n0077\n1\nP-CSCF restoration extension for trusted WLAN\n13.0.0\n2015-09\nCT#69\nCP-150458\n0078\n1\nP-CSCF restoration extension for untrusted WLAN\n13.0.0\n2015-12\nCT#70\nCP-150780\n0079\n1\nInteraction between P-CSCF Restoration and NBIFOM\n13.1.0\n2015-12\nCT#70\nCP-150780\n0080\n-\nReference correction and editorials\n13.1.0\n2015-12\nCT#70\nCP-150780\n0081\n2\nExtended P-CSCF restoration mechanism for WLAN and AA-Request\n13.1.0\n2015-12\nCT#70\nCP-150780\n0082\n-\nRemove the need to inform the UE about ePDG support of P-CSCF restoration\n13.1.0\n2016-03\nCT#71\nCP-160025\n0083\n1\nP-CSCF restoration not prioritized for WLAN\n13.2.0\n2016-03\nCT#71\nCP-160025\n0084\n1\nResult-Codes for P-CSCF Restoration\n13.2.0\n2016-03\nCT#71\nCP-160025\n0085\n-\nIndication of P-CSCF restoration extension support over IKEv2\n13.2.0\n2016-06\nCT#72\nCP-160231\n0086\n3\nP-CSCF restoration for NBIFOM PDN connections\n13.3.0\n2016-06\nCT#72\nCP-160216\n0087\n3\nSCC AS restoration Mechanism\n13.3.0\n2016-09\nCT#73\nCP-160415\n0091\n-\nNon REGISTER authentication after S-CSCF restart\n13.4.0\n2016-09\nCT#73\nCP-160431\n0088\nS-CSCF Restoration during Registration enhancement\n14.0.0\n2016-12\nCT#74\nCP-160656\n0093\n1\nP-CSCF restoration for NBIFOM connections\n14.1.0\n2018-06\nCT#80\nCP-181132\n0096\n5\nNew Clause for P-CSCF Restoration in 5G Access\n15.0.0\n2018-12\nCT#82\nCP-183092\n0102\n1\nUpdates to PCF Based P-CSCF Restoration Solution\n15.1.0\n2019-03\nCT#83\nCP-190015\n0103\n-\nCorrection to clause numbering\n16.0.0\n2019-09\nCT#85\nCP-192191\n0107\n-\n5G P-CSCF restoration using Nudm\n16.1.0\n2019-09\nCT#85\nCP-192099\n0109\n1\nP-CSCF restoration\n16.1.0\n2019-09\nCT#85\nCP-192124\n0105\n5\nCorrection to P-CSCF Restoration Procedures\n16.1.0\n2019-09\nCT#85\nCP-192125\n0106\n2\nAdd P-CSCF subscription info to Restoration information\n16.1.0\n2019-12\nCT#86\nCP-193040\n0110\n1\nS-CSCF restoration after registration timer expiry\n16.2.0\n2021-03\nCT#91e\nCP-210062\n0113\n-\nP-CSCF restoration alignment\n16.3.0\n2021-06\nCT#92e\nCP-211060\n0115\nS-CSCF reselection in eIMS\n16.4.0\n2021-12\nCT#94e\nCP-213119\n0116\n-\nB\nStore g.3gpp.accesstype media feature tag in the HSS as Repository Data\n17.0.0\n2021-12\nCT#94e\nCP-213119\n0117\n-\nF\nCorrection to HSS-based and PCRF-based P-CSCF restoration\n17.0.0\n2022-03\nCT#95e\nCP-220054\n0118\n1\nB\nP-CSCF restoration\n17.1.0\n2024-03\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0\n2024-09\nCT#105\nCP-242069\n0125\n-\nA\nUpdate on the IETF draft\n18.1.0",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.237_clause_6.3.2",
        "figure_6.2.2.2-1",
        "ts_24.237",
        "ts_29.212"
      ]
    }
  ]
}