{
  "metadata": {
    "specification_id": "ts_23.060",
    "version": "18.0.0",
    "title": "3GPP TS 23.060",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23060-i00/23060-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:43:01.221958",
    "total_chunks": 413
  },
  "chunks": [
    {
      "chunk_id": "ts_23.060_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document defines the stage‑2 service description for the General Packet Radio Service (GPRS) which is a packet bearer service and a main part of the packet domain. ITU-T Recommendation I.130 [29] describes a three-stage method for characterisation of telecommunication services, and ITU-T Recommendation Q.65 [31] defines stage 2 of the method. The GPRS described in the present document is also the description of the GERAN and UTRAN related functionality of the Evolved Packet System (EPS) according to TS 23.401 [89].\nThe present document does not cover the Radio Access Network functionality. TS 43.064 [11] contains an overall description of the GSM EDGE Radio Access Network (GERAN). TS 25.401 [53] contains an overall description of the Universal Terrestrial Radio Access Network (UTRAN). TS 43.051 [74] contains an overall description of GSM/EDGE Radio Access Network.\nThe present document does not cover the functionality of the GPRS enhancements for the Evolved Universal Terrestrial Radio Access Network (E‑UTRAN). This functionality and also the interoperation functionality between E‑UTRAN and GERAN/UTRAN accesses are described in TS 23.401 [89].\nThe present document specifies functions, procedures and information which apply to GERAN Iu mode. However, functionality related to GERAN Iu mode is neither maintained nor enhanced since Rel‑9.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401",
        "ts_43.064",
        "ts_25.401",
        "ts_43.051"
      ]
    },
    {
      "chunk_id": "ts_23.060_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions, which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. For a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\tVoid.\n[2]\t3GPP TS 41.061: \"General Packet Radio Service (GPRS); GPRS ciphering algorithm requirements\".\n[3]\t3GPP TS 22.060: \"General Packet Radio Service (GPRS); Service description; Stage 1\".\n[4]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[5]\t3GPP TS 23.007: \"Restoration procedures\".\n[5b]\t3GPP TS 23.016: \"Subscriber data management; Stage 2\".\n[6]\t3GPP TS 43.020: \"Security related network functions\".\n[7]\tGSM 03.22: \"Digital cellular telecommunications system (Phase 2+); Functions related to Mobile Station (MS) in idle mode and group receive mode\".\n[7b]\t3GPP TS 23.122: \"Non-Access Stratum functions related to Mobile Station (MS) in idle mode\".\n[8]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)\".\n[8b]\t3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced Logic (CAMEL) Phase 3 - Stage 2\".\n[9]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[10]\tVoid.\n[11]\t3GPP TS 43.064: \"General Packet Radio Service (GPRS); Overall description of the GPRS radio interface; Stage 2\".\n[12]\t3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General aspects\".\n[13]\t3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3\".\n[13b]\t3GPP TS 24.011: \"Point to Point (PP) Short Message Service (SMS) support on mobile radio interface\".\n[14]\tVoid.\n[15]\t3GPP TS 44.064: \"General Packet Radio Service (GPRS); Mobile Station – Serving GPRS Support Node (MS‑SGSN) Logical Link Control (LLC) layer specification\".\n[16]\t3GPP TS 44.065: \"General Packet Radio Service (GPRS); Mobile Station (MS) – Serving GPRS Support Node (SGSN); Subnetwork Dependent Convergence Protocol (SNDCP)\".\n[16b]\t3GPP TS 45.008: \"Digital cellular telecommunications system (Phase 2+); Radio subsystem link control\".\n[17]\t3GPP TS 27.060: \"Packet Domain; Mobile Station (MS) supporting Packet Switched services\".\n[18]\t3GPP TS 48.008: \"Mobile-services Switching Centre ‑ Base Station System (MSC‑BSS) interface; Layer 3 specification\".\n[19]\t3GPP TS 48.014: \"General Packet Radio Service (GPRS); Base Station System (BSS) ‑ Serving GPRS Support Node (SGSN) interface; Gb interface layer 1\".\n[20]\t3GPP TS 48.016: \"General Packet Radio Service (GPRS); Base Station System (BSS) ‑ Serving GPRS Support Node (SGSN) interface; Network Service\".\n[21]\tVoid.\n[22]\t3GPP TS 48.060: \"In-band control of remote transcoders and rate adaptors for Enhanced Full Rate (EFR) and full rate traffic channels\".\n[23]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[24]\t3GPP TS 29.016: \"General Packet Radio Service (GPRS); Serving GPRS Support Node (SGSN) ‑ Visitors Location Register (VLR); Gs interface network service specification\".\n[25]\t3GPP TS 29.018: \"General Packet Radio Service (GPRS); Serving GPRS Support Node (SGSN) ‑ Visitors Location Register (VLR); Gs interface layer 3 specification\".\n[26]\t3GPP TS 29.060: \"General Packet Radio Service (GPRS); GPRS Tunnelling Protocol (GTP) across the Gn and Gp Interface\".\n[27]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting Packet Based services and Packet Data Networks (PDN)\".\n[27b]\tVoid.\n[28]\t3GPP TS 51.011: \"Specification of the Subscriber Identity Module ‑ Mobile Equipment (SIM‑ME) interface\".\n[29]\tITU-T Recommendations I.130: \"Method for the characterization of telecommunication services supported by an ISDN and network capabilities of an ISDN\".\n[30]\tITU-T Recommendation E.164: \"The international public telecommunication numbering plan\".\n[31]\tITU-T Recommendation Q.65: \"The unified functional methodology for the characterization of services and network capabilities\".\n[32]\tITU-T Recommendation V.42bis: \"Data compression procedures for data circuit-terminating equipment (DCE) using error correction procedures\".\n[33]\tVoid.\n[34]\tITU-T Recommendation X.25: \"Interface between Data Terminal Equipment (DTE) and Data Circuit-terminating Equipment (DCE) for terminals operating in the packet mode and connected to public data networks by dedicated circuit\".\n[35]\tIETF RFC 4960: \"Stream Control Transmission Protocol\".\n[36]\t3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity Module (USIM) application\".\n[37]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[38]\tVoid.\n[39]\tIETF RFC 768 (1980): \"User Datagram Protocol\" (STD 6).\n[40]\tIETF RFC 791 (1981): \"Internet Protocol\" (STD 5).\n[41]\tIETF RFC 792 (1981): \"Internet Control Message Protocol\" (STD 5).\n[42]\tVoid.\n[43]\tIETF RFC 1034 (1987): \"Domain names – concepts and facilities\" (STD 13).\n[44]\tIETF RFC 1661 (1994): \"The Point-to-Point Protocol (PPP)\" (STD 51).\n[45]\tIETF RFC 1542 (1993): \"Clarifications and Extensions for the Bootstrap Protocol\".\n[46]\tIETF RFC 3344 (2002): \"IP Mobility Support for IPv4\".\n[47]\tIETF RFC 2131 (1997): \"Dynamic Host Configuration Protocol\".\n[48]\tIETF RFC 2460 (1998): \"Internet Protocol, Version 6 (IPv6) Specification\".\n[49]\tTIA/EIA‑136 (1999): \"TDMA Cellular / PCS\"; Arlington: Telecommunications Industry Association.\n[50]\t3GPP TS 25.301: \"Radio Interface Protocol Architecture\".\n[51]\t3GPP TS 25.303: \"Interlayer procedures in Connected Mode\".\n[51b]\t3GPP TS 25.304: \"UE Procedures in Idle Mode and Procedures for Call Reselection in Connected Mode\".\n[52]\t3GPP TS 25.331: \"RRC Protocol Specification\".\n[53]\t3GPP TS 25.401: \"UTRAN Overall Description\".\n[54]\t3GPP TS 23.121: \"Architectural Requirements for Release 1999\".\n[55]\t3GPP TS 25.322: \"RLC protocol specification\".\n[56]\t3GPP TS 25.412: \"UTRAN Iu interface signalling transport\".\n[56b]\t3GPP TS 25.413: \"UTRAN Iu interface Radio Access Network Application Part (RANAP) signalling\".\n[57]\t3GPP TS 25.323: \"Packet Data Convergence Protocol (PDCP) specification\".\n[58]\t3GPP TS 23.107: \"Quality of Service (QoS) concept and architecture\".\n[59]\tITU‑T Recommendation I.361: \"B‑ISDN ATM layer specification\".\n[60]\t3GPP TS 25.321: \"Medium Access Control (MAC) protocol specification\".\n[61]\t3GPP TS 33.102: \"3G Security; Security architecture\".\n[62]\tVoid.\n[63]\t3GPP TS 25.411: \"UTRAN Iu interface Layer 1\".\n[64]\t3GPP TS 25.414: \"UTRAN Iu interface data transport & transport signalling\".\n[65]\t3GPP TS 23.271: \"Functional stage 2 description of LCS\".\n[66]\t3GPP TS 23.015: \"Technical realization of Operator Determined Barring (ODB)\".\n[67]\tITU‑T Recommendation I.363.5: \"B‑ISDN ATM Adaptation Layer (AAL) specification: Type 5 AAL\".\n[68]\tVoid.\n[69]\tVoid.\n[70]\t3GPP TS 32.251: \"Telecommunication management; Charging management; Packet Switched (PS) domain charging\".\n[71]\tVoid.\n[72]\t3GPP TS 29.202: \"Signalling System No. 7 (SS7) signalling transport in core network; Stage 3\".\n[73]\t3GPP TS 23.236: \"Intra Domain Connection of RAN Nodes to Multiple CN Nodes\".\n[74]\t3GPP TS 43.051: \"Radio Access Network; Overall description – Stage 2\".\n[75]\t3GPP TS 24.229: IP Multimedia Call Control Protocol based on SIP and SDP.\n[76]\t3GPP TS 23.195: \"Provision of UE Specific Behaviour Information to Network Entities\".\n[77]\t3GPP TS 44.060: General Packet Radio Service (GPRS); Mobile Station (MS) - Base Station System (BSS) interface; Radio Link Control/Medium Access Control (RLC/MAC) protocol\".\n[78]\t3GPP TS 48.018: \"General Packet Radio Service (GPRS); Base Station System (BSS) - Serving GPRS Support Node (SGSN); BSS GPRS Protocol (BSSGP)\".\n[79]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[80]\t3GPP TS 23.221: \"Architectural requirements\".\n[81]\t3GPP TS 23.012: \"Location Management Procedures\".\n[82]\t3GPP TS 22.101: \"Service Principles\".\n[83]\t3GPP TS 23.251: \" Network Sharing; Architecture and Functional Description\".\n[84]\t3GPP TS 32.422: \"Subscriber and equipment trace; Trace control and Configuration Management (CM)\".\n[85]\t3GPP TS 44.018: \"Mobile radio interface layer 3 specification; Radio Resource Control (RRC) protocol\".\n[86]\tVoid.\n[87]\t3GPP TS 43.129: \"Packet-switched handover for GERAN A/Gb mode; Stage 2\".\n[88]\t3GPP TS 23.203: \"Policy and charging control architecture; Stage 2\".\n[89]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[90]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[91]\t3GPP TS 33.401: \"3GPP System Architecture Evolution: Security Architecture\".\n[92]\t3GPP TS 29.274: \"3GPP Evolved Packet System; Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[93]\t3GPP TS 23.272: \"Circuit Switched Fallback in Evolved Packet System; Stage 2\".\n[94]\t3GPP TS 32.240: \"Charging architecture and principles\".\n[95]\t3GPP TS 25.423: \"UTRAN Iur interface Radio Network Subsystem Application Part (RNSAP) signalling\".\n[96]\tIETF RFC 3588: \"Diameter Base Protocol\" (STD 1).\n[97]\tVoid.\n[98]\tIETF RFC 4861 (2007): \"Neighbor Discovery for IP Version 6 (IPv6)\".\n[99]\tIETF RFC 4862 (2007): \"IPv6 Stateless Address Autoconfiguration\".\n[100]\t3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".\n[101]\t3GPP TS 23.216: \"Single Radio Voice Call Continuity (SRVCC); Stage 2\".\n[102]\t3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet System (EPS); Stage 3\".\n[103]\t3GPP TS 25.467: \"UTRAN architecture for 3G Home NodeB; Stage 2\".\n[104]\t3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) centralized services; Stage 2\".\n[105]\tIETF RFC 3633: \"IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6\".\n[106]\tIETF RFC 3376: \"Internet Group Management Protocol, Version 3\".\n[107]\tIETF RFC 3810: \"Multicast Listener Discovery Version 2 (MLDv2) for IPv6\".\n[108]\tIETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".\n[109]\tIETF RFC 4291: \"IP Version 6 Addressing Architecture\".\n[110]\t3GPP TS 22.368: \"Service requirements for Machine-Type Communications (MTC)\".\n[111]\t3GPP TS 24.368: \"Non-Access Stratum (NAS) configuration Management Object (MO)\".\n[112]\t3GPP TS 22.011: \"Service Accessibility\".\n[113]\tIETF RFC 6603: \"Prefix Exclude Option for DHCPv6-based Prefix Delegation\".\n[114]\t3GPP TS 33.210: \"Network Domain Security (NDS); IP network layer security\".\n[115]\tIETF RFC 3168: \"The Addition of Explicit Congestion Notification (ECN) to IP\".\n[116]\t3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction\".\n[117]\tIETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration Protocol version 4 (DHCPv4)\".\n[118]\tIETF RFC 3736: \"Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6\".\n[119]\t3GPP TS 23.682: \"Architecture Enhancements to facilitate communications with Packet Data Networks and Applications\".\n[120]\t3GPP TS 29.281: \"GPRS Tunnelling Protocol User Plane (GTPv1-U)\".\n[121]\t3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia Telephony Service and supplementary services; Stage 1\".\n[122]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[123]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_41.061",
        "ts_22.060",
        "ts_23.003",
        "ts_23.007",
        "ts_23.016",
        "ts_43.020",
        "ts_23.122",
        "ts_23.040",
        "ts_23.078",
        "ts_21.905",
        "ts_43.064",
        "ts_24.007",
        "ts_24.008",
        "ts_24.011",
        "ts_44.064",
        "ts_44.065",
        "ts_45.008",
        "ts_27.060",
        "ts_48.008",
        "ts_48.014",
        "ts_48.016",
        "ts_48.060",
        "ts_29.002",
        "ts_29.016",
        "ts_29.018",
        "ts_29.060",
        "ts_29.061",
        "ts_51.011",
        "ts_31.102",
        "ts_36.331",
        "ts_25.301",
        "ts_25.303",
        "ts_25.304",
        "ts_25.331",
        "ts_25.401",
        "ts_23.121",
        "ts_25.322",
        "ts_25.412",
        "ts_25.413",
        "ts_25.323",
        "ts_23.107",
        "ts_25.321",
        "ts_33.102",
        "ts_25.411",
        "ts_25.414",
        "ts_23.271",
        "ts_23.015",
        "ts_32.251",
        "ts_29.202",
        "ts_23.236",
        "ts_43.051",
        "ts_24.229",
        "ts_23.195",
        "ts_44.060",
        "ts_48.018",
        "ts_23.008",
        "ts_23.221",
        "ts_23.012",
        "ts_22.101",
        "ts_23.251",
        "ts_32.422",
        "ts_44.018",
        "ts_43.129",
        "ts_23.203",
        "ts_23.401",
        "ts_23.402",
        "ts_33.401",
        "ts_29.274",
        "ts_23.272",
        "ts_32.240",
        "ts_25.423",
        "ts_29.303",
        "ts_23.216",
        "ts_24.301",
        "ts_25.467",
        "ts_23.292",
        "ts_22.368",
        "ts_24.368",
        "ts_22.011",
        "ts_33.210",
        "ts_26.114",
        "ts_23.682",
        "ts_29.281",
        "ts_22.173",
        "ts_36.300",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.060_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "Definitions can be found in TS 22.060 [3] and TS 25.401 [53]. For the purposes of the present document, the following terms and definitions apply:\nGERAN/UTRAN PS coverage: an MS is defined to be in GERAN/UTRAN PS coverage if it can access GPRS services via GERAN or UTRAN. These services may be provided in A/Gb mode or in Iu mode. According to this definition, an MS camped on an E‑UTRAN cell is not in GERAN/UTRAN PS coverage.\nGPRS: packet bearer service of the packet domain.\nA/Gb mode: indicates that this clause or paragraph applies only to a system or sub-system which operate in A/Gb mode of operation, i.e. with a functional division that is in accordance with the use of an A or a Gb interface between the radio access network and the core network. This definition is consistent with the A/Gb mode definition for the RAN in TS 43.051 [74].\nNOTE 1:\tA/Gb mode is independent of the support of both interfaces, e.g. an SGSN in A/Gb mode uses only the Gb interface.\nIu mode: indicates that this clause or paragraph applies only to a system or a sub-system which operates in Iu mode of operation, i.e. with a functional division that is in accordance with the use of an Iu-CS or Iu-PS interface between the radio access network and the core network. This definition is consistent with the Iu mode definition for the RAN in TS 43.051 [74]. Note that Iu mode is independent of the support of both parts of the Iu interface, e.g. an SGSN in Iu mode uses only the Iu-PS interface.\nInter-system change: change of an MS from A/Gb mode to Iu mode of operation and vice versa.\nMS: this specification makes no distinction between MS and UE\n2G‑ / 3G‑: prefixes 2G‑ and 3G‑ refer to systems or sub-systems, that support A/Gb mode or Iu mode, respectively, e.g. 2G‑SGSN refers to all functionality of an SGSN which serves an MS in A/Gb mode.\nNOTE 2:\tWhen the prefix is omitted, reference is made independently from the A/Gb mode or Iu mode functionality.\nPool area: refers to a grouping of one or more RA(s) that, from a RAN perspective, are served by a certain group of CN nodes, as defined for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes.\nEmergency attached MS: An MS which only has PDP context(s) related to emergency bearer service.\nNOTE 3:\tThe above term is equivalent to the term \"attached for emergency bearer services\" as specified in TS 24.008 [13].\nLIPA PDN connection: a PDN connection for local IP access for a UE connected to a HNB.\nSIPTO at local network PDN connection: a PDN connection for SIPTO at local network for a UE connected to a HNB.\nCorrelation ID: For a LIPA PDN connection, Correlation ID is a parameter that enables direct user plane path between the HNB and L-GW.\nSIPTO Correlation ID: For a SIPTO at local network PDN connection, SIPTO Correlation ID is a parameter that enables direct user plane path between the HNB and L-GW when they are collocated.\nLocal Home Network: A set of (H)NBs/RNCs and L-GWs in the standalone GW architecture, where the HNB-GWs/RNCs have IP connectivity for SIPTO at the Local Network via all the L-GWs.\nLocal Home Network ID: An identifier that uniquely identifies a Local Home Network within a PLMN.\nPresence Reporting Area: An area defined within 3GPP Packet Domain for the purposes of reporting of UE presence within that area due to policy control and/or charging reasons. A Presence Reporting Area may consist in a set of neighbour or non-neighbor cells/Service Areas or Routing Areas. There are two types of Presence Reporting Areas: \"UE-dedicated Presence Reporting Areas\" and \"Core Network pre-configured Presence Reporting Areas\".\nRAN user plane congestion: RAN user plane congestion occurs when the demand for RAN resources exceeds the available RAN capacity to deliver the user data for a prolonged period of time.\nNOTE:\tShort-duration traffic bursts is a normal condition at any traffic load level, and is not considered to be RAN user plane congestion. Likewise, a high-level of utilization of RAN resources (based on operator configuration) is considered a normal mode of operation and might not be RAN user plane congestion.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_22.060",
        "ts_25.401",
        "ts_43.051",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "Applicable abbreviations can be found in TR 21.905 [9]. For the purposes of the present document the following abbreviations apply:\nAAL5\tATM Adaptation Layer type 5\nADD\tAutomatic Device Detection\nAPN\tAccess Point Name\nAPN-AMBR\tAPN-Aggregate Maximum Bit Rate\nATM\tAsynchronous Transfer Mode\nAUTN\tAuthentication Token\nBCM\tBearer Control Mode\nBG\tBorder Gateway\nBSSAP+\tBase Station System Application Part +\nBSSGP\tBase Station System GPRS Protocol\nBVCI\tBSSGP Virtual Connection Identifier\nCCU\tChannel Codec Unit\nCDR\tCall Detail Record\nCGF\tCharging Gateway Functionality\nCGI\tCell Global Identification\nCIoT\tCellular IoT\nCK\tCipher Key\nCMM\tCircuit Mobility Management\nCS\tCircuit Switched\nCSG\tClosed Subscriber Group\nCSG ID\tClosed Subscriber Group Identity\nCSS\tCSG Subscriber Server\nDCN\tDedicated Core Network\nDHCP\tDynamic Host Configuration Protocol\nDNS\tDomain Name System\nDTI\tDirect Tunnel Indicator\nDTM\tDual Transfer Mode\nEGPRS\tEnhanced GPRS\nEPS\tEvolved Packet System\nESP\tEncapsulating Security Payload\nETFTN\tExtended TFT Support Network\nETFTU\tExtended TFT Support UE\nE-UTRAN\tEvolved UTRAN\nGCSI\tGPRS CAMEL Subscription Information indicator\nGEA\tGPRS Encryption Algorithm\nGERAN\tGSM EDGE Radio Access Network\nGGSN\tGateway GPRS Support Node\nGMM/SM\tGPRS Mobility Management and Session Management\nGPRS‑SSF\tGPRS Service Switching Function\nGPRS‑CSI\tGPRS CAMEL Subscription Information\nGRA\tGERAN Registration Area\nGSM‑SCF\tGSM Service Control Function\nGSIM\tGSM Service Identity Module\nGSN\tGPRS Support Node\nGTP\tGPRS Tunnelling Protocol\nGTP‑C\tGTP Control Plane\nGTP‑U\tGTP User Plane\nGW\tGateway\nHNB\tHome Node B\nHNB GW\tHome Node B Gateway\nICMP\tInternet Control Message Protocol\nIETF\tInternet Engineering Task Force\nIK\tIntegrity Key\nIoT\tInternet of Things\nIP\tInternet Protocol\nIPv4\tInternet Protocol version 4\nIPv6\tInternet Protocol version 6\nIPX\tInternet Packet eXchange\nISP\tInternet Service Provider\nKSI\tKey Set Identifier\nL2TP\tLayer‑2 Tunnelling Protocol\nL-GW\tLocal Gateway\nLIPA\tLocal IP Access\nLL‑PDU\tLLC PDU\nLLC\tLogical Link Control\nMAC\tMedium Access Control\nMIP\tMobile IP\nMNRF\tMobile station Not Reachable Flag\nMNRG\tMobile station Not Reachable for GPRS flag\nMNRR\tMobile station Not Reachable Reason\nMOCN\tMulti-Operator Core Network\nMTC\tMachine Type Communications\nMTP2\tMessage Transfer Part layer 2\nMTP3\tMessage Transfer Part layer 3\nMTU\tMaximum Transfer Unit\nNACC\tNetwork Assisted Cell Change\nNGAF\tNon-GPRS Alert Flag\nN-PDU\tNetwork Protocol Data Unit\nNRSU\tNetwork Request Support UE\nNRSN\tNetwork Request Support Network\nNS\tNetwork Service\nNSAPI\tNetwork layer Service Access Point Identifier\nNSS\tNetwork SubSystem\nOCS\tOnline Charging System\nODB\tOperator Determined Barring\nOFCS\tOffline Charging System\nP‑TMSI\tPacket TMSI\nPCC\tPolicy and Charging Control\nPCRF\tPolicy and Charging Rules Function\nPCU\tPacket Control Unit\nPDCH\tPacket Data CHannel\nPDCP\tPacket Data Convergence Protocol\nPDN\tPacket Data Network\nPDN GW\tPacket Data Network Gateway\nPDP\tPacket Data Protocol, e.g. IP\nPDU\tProtocol Data Unit\nP‑GW\tPDN Gateway\nPMM\tPacket Mobility Management\nPPF\tPaging Proceed Flag\nPPP\tPoint-to-Point Protocol\nPSM\tPower Saving Mode\nPTP\tPoint To Point\nPVC\tPermanent Virtual Circuit\nRA\tRouteing Area\nRAB\tRadio Access Bearer\nRAC\tRouteing Area Code\nRAI\tRouteing Area Identity\nRANAP\tRadio Access Network Application Protocol\nRAU\tRouteing Area Update\nRCAF\tRAN Congestion Awareness Function\nRLC\tRadio Link Control\nRNC\tRadio Network Controller\nRNS\tRadio Network Subsystem\nRNTI\tRadio Network Temporary Identity\nRRC\tRadio Resource Control\nRUCI\tRAN User Plane Congestion Information\nSBSC\tServing Base Station Controller\nSBSS\tServing BSS\nSGSN\tServing GPRS Support Node\nS‑GW\tServing Gateway\nSIPTO\tSelected IP Traffic Offload\nSM\tShort Message\nSM‑SC\tShort Message service Service Centre\nSMS‑GMSC\tShort Message Service Gateway MSC\nSMS‑IWMSC\tShort Message Service Interworking MSC\nSN‑PDU\tSNDCP PDU\nSNDC\tSubNetwork Dependent Convergence\nSNDCP\tSubNetwork Dependent Convergence Protocol\nSPI\tSecurity Parameter Index\nSRNC\tServing RNC\nSRNS\tServing RNS\nTCAP\tTransaction Capabilities Application Part\nTCP\tTransmission Control Protocol\nTFT\tTraffic Flow Template\nTEID\tTunnel Endpoint IDentifier\nTLLI\tTemporary Logical Link Identity\nTOM\tTunnelling Of Messages\nTOS\tType of Service\nTRAU\tTranscoder and Rate Adaptor Unit\nUDP\tUser Datagram Protocol\nUE-AMBR\tUE-Aggregate Maximum Bit Rate\nUEA\tUMTS Encryption Algorithm\nUESBI-Iu\tUE Specific Behaviour Information - Iu\nUESBI-Uu\tUE Specific Behaviour Information - Uu\nUIA\tUMTS Integrity Algorithm\nURA\tUTRAN Registration Area\nURRP-SGSN\tUE Reachability Request Parameter for SGSN\nUSIM\tUser Service Identity Module",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.060_3.3",
      "section_id": "3.3",
      "section_title": "Symbols",
      "content": "For the purposes of the present document, the following symbols apply:\nGa\tCharging data collection interface between a CDR transmitting unit (e.g. an SGSN, S‑GW, PDN GW or a GGSN) and a CDR receiving functionality (a CGF).\nGb\tInterface between an SGSN and a BSS.\nGc\tInterface between a GGSN and an HLR.\nGd\tInterface between an SMS‑GMSC and an SGSN, and between an SMS‑IWMSC and an SGSN (MAP based).\nGdd\tInterface between an SMS GMSC and an SGSN, and between an SMS IWMSC and an SGSN (Diameter based).\nGf\tInterface between an SGSN and an EIR.\nGi\tReference point between a GGSN and a packet data network.\nGn\tInterface between two SGSNs within the same or different PLMNs or between an SGSN and a GGSN within the same PLMN.\nGp\tInterface between a SGSN and a P‑GW/GGSN in different PLMNs. The Gp interface allows support of GPRS network services across areas served by the co-operating GPRS PLMNs.\nGr\tInterface between an SGSN and an HLR.\nGs\tInterface between an SGSN and an MSC/VLR.\nIu\tInterface between the RNS and the core network. It is also considered as a reference point.\nkbit/s\tKilobits per second.\nMbit/s\tMegabits per second. 1 Mbit/s = 1 million bits per second.\nNp\tInterface between an RCAF and the PCRF.\nNq'\tInterface between an S4-SGSN and an RCAF.\nR\tReference point between a non-ISDN compatible TE and MT. Typically this reference point supports a standard serial interface.\nReporting Area\tThe service area for which the location of an MS is reported.\nService Area\tThe location accuracy level needed for service management purposes in the 3G‑SGSN, e.g. a routeing area or a cell. The 3G‑SGSN can request the SRNC to report: i) the MS's current service area; ii) when the MS moves into a given service area; or iii) when the MS moves out of a given service area.\nS4\tInterface between a SGSN and a S‑GW within the same PLMN.\nS5\tInterface between a S‑GW and a P‑GW within the same PLMN.\nS6d\tInterface between a SGSN and a HSS.\nS8\tInterface between a S‑GW and a P‑GW in different PLMNs. The S8 interface allows support of GPRS network services across areas served by the co‑operating GPRS PLMNs\nS12\tUser plane interface between the RNS and a S‑GW for Direct Tunnel.\nS16\tInterface between two SGSNs within the same or different PLMNs when those SGSNs support S4.\nSGi\tReference point between a P‑GW and a packet data network.\nSGs\tInterface between MME and an MSC/VLR.\nUm\tInterface between the mobile station (MS) and the A/Gb mode network. The Um interface is the MS to network interface for providing GPRS services over the GERAN radio to the MS in A/Gb mode.\nUu\tInterface between the mobile station (MS) and the Iu mode network. The Uu interface is the Iu mode network interface for providing GPRS services over the UTRAN radio (and in Iu mode, over the GERAN radio) to the MS.\nS13'\tInterface between a SGSN and an EIR within the same or different PLMNs.\nNOTE:\tExcept where stated otherwise, this specification does not make an explicit assumption as to whether an interface is intra-PLMN or inter-PLMN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_4",
      "section_id": "4",
      "section_title": "Main Concept",
      "content": "The packet domain uses packet-mode techniques to transfer high-speed and low-speed data and signalling in an efficient manner. The packet domain optimises the use of network and radio resources. Strict separation between the radio subsystem and network subsystem is maintained, allowing the network subsystem to be reused with other radio access technologies.\nA common packet domain Core Network is used for both Radio Access Networks (RAN) the GERAN and the UTRAN. This common Core Network provides together with these RANs GPRS services. It is designed to support several quality of service levels to allow efficient transfer of non real-time traffic (e.g. intermittent and bursty data transfers, occasional transmission of large volumes of data) and real-time traffic (e.g. voice, video). Applications based on standard data protocols and SMS are supported, and interworking is defined with IP networks. Charging should be flexible and allow to bill according to the amount of data transferred, the QoS supported, and the duration of the connection.\nThe Serving GPRS Support Node (SGSN) keeps track of the location of an individual MS and performs security functions and access control. The SGSN is connected to the GERAN base station system through the Gb or Iu interface and/or to the UTRAN through the Iu interface. The SGSN also interfaces via the GPRS Service Switching Function with the GSM Service Control Function for optional CAMEL session and cost control service support.\nThe Gateway Node (P‑GW/GGSN) provides interworking with packet data networks, and is connected with other core network nodes via an IP-based packet domain PLMN backbone network.\nThe Serving Gateway is user plane node that provides a common anchor for interoperation between GERAN/UTRAN and E‑UTRAN accesses and when S4 is used it permits Direct Tunnel usage in roaming scenarios.\nThe Offline Charging System (OFCS) collects charging records from SGSNs, S‑GWs and P‑GW/GGSNs.\nThe HSS/HLR contains subscriber information.\nThe SMS‑GMSCs and SMS‑IWMSCs support SMS transmission via the SGSN.\nOptionally, the MSC/VLR can be enhanced for more-efficient co-ordination of packet-switched and circuit-switched services and functionality: e.g. combined GPRS and non-GPRS location updates.\nIn order to use GPRS services, an MS shall first make its presence known to the network by performing a GPRS attach. This makes the MS available for SMS over GPRS and SMS over IMS, paging via the SGSN, and notification of incoming packet data. If the UE is already PS‑attached due to an attach via E‑UTRAN it makes its presence known to an SGSN by a Routeing Area Update.\nIn order to send and receive packet data by means of GPRS services, the MS shall activate the Packet Data Protocol context that it wants to use. This operation makes the MS known in the corresponding P‑GW/GGSN, and interworking with data networks can commence.\nUser data are transferred transparently between the MS and the packet data networks with a method known as encapsulation and tunnelling: data packets are equipped with GPRS-specific protocol information and transferred between the MS and the P‑GW/GGSN. This transparent transfer method lessens the requirement for the PLMN to interpret external data protocols, and it enables easy introduction of additional interworking protocols in the future.\nPacket Switched (PS) handover is introduced in order to support real-time packet-switched service with strict QoS requirements on low latency and packet loss. PS handover reduces the service interruption of the user plane information at cell change compared to the cell-reselection and enables methods to improve buffer handling of user plane data in order to reduce packet loss at cell-change. PS handover is the handover between GERAN PS and UTRAN PS. The complete specification of the PS handover procedures for A/Gb mode and between Iu mode and A/Gb mode are described in TS 43.129 [87].\nEarlier release versions of this specification described a Network Mode Operation III, which is not available for deployment as GERAN specifications forbid deploying Packet Common Control Channels since Release 9 in TS 44.060 [77].",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.129",
        "ts_44.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.1",
      "section_id": "5.1",
      "section_title": "GPRS Access Interfaces and Reference Points",
      "content": "Each PLMN has two access points to GPRS services, the radio interface (labelled Um in A/Gb mode and Uu in Iu mode) used for mobile access and the R reference point used for origination or reception of messages. The R reference point for the MSs is defined in TS 27.060 [17].\nAn interface differs from a reference point in that an interface is defined where specific information is exchanged and needs to be fully recognised.\nThere is an inter PLMN interface called Gp or S8, respectively that connects two independent GPRS packet domain networks for message exchange.\nThere is also a PLMN to packet data network reference point called Gi or SGi, respectively. Gi and SGi are defined in TS 29.061 [27].\nFigure 1: GPRS Access Interfaces and Reference Points\nThere may be more than a single network interface to several different packet data networks. These networks may both differ in ownership as well as in communications protocol (e.g. TCP/IP etc.). The network operator defines and negotiates interconnection with each interconnected packet data network.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.061_figure_1",
        "ts_27.060",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.2",
      "section_id": "5.2",
      "section_title": "Network Interworking",
      "content": "Network interworking is required whenever a packet domain PLMN and any other network are involved in the execution of a service request. With reference to Figure 1, interworking takes place through the Gi or SGi reference point and the Gp or S8 interface.\nThe internal mechanism for conveying the PDP PDU through the PLMN is managed by the PLMN network operator and is not apparent to the data user. The use of the GPRS service may have an impact on and increase the transfer time normally found for a message when communicated through a fixed packet data network.",
      "chunk_type": "general",
      "cross_references": [
        "figure_1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.2.1",
      "section_id": "5.2.1",
      "section_title": "Internet (IP) Interworking",
      "content": "GPRS shall support interworking with networks based on the Internet protocol (IP). IP is defined in RFC 791 [40]. The packet domain may provide compression of the TCP/IP header when an IP datagram is used within the context of a TCP connection.\nMobile terminals offered service by a service provider may be globally addressable through the network operator's addressing scheme.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.0",
      "section_id": "5.3.0",
      "section_title": "General",
      "content": "The following list gives the logical functions performed within the packet domain network for GPRS with GERAN or UTRAN accesses. Several functional groupings (meta functions) are defined and each encompasses a number of individual functions:\n-\tNetwork Access Control Functions.\n-\tPacket Routeing and Transfer Functions.\n-\tMobility Management Functions.\n-\tLogical Link Management Functions (A/Gb mode).\n-\tRadio Resource Management Functions.\n-\tNetwork Management Functions.\n-\tUE reachability function",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1",
      "section_id": "5.3.1",
      "section_title": "Network Access Control Functions",
      "content": "Network access is the means by which a user is connected to a telecommunication network in order to use the services and/or facilities of that network. An access protocol is a defined set of procedures that enables the user to employ the services and/or facilities of the network.\nUser network access may occur from either the mobile side or the fixed side of the network. The fixed network interface may support multiple access protocols to packet data networks, for example IP. The set of access protocols to be supported is determined by the PLMN operator.\nIndividual PLMN administrations may require specific access-control procedures in order to limit the set of users permitted to access the network, or to restrict the capabilities of individual users, for example by limiting the type of service available to an individual subscriber. Such access control procedures are beyond the scope of the specifications.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.1",
      "section_id": "5.3.1.1",
      "section_title": "Registration Function",
      "content": "Registration is the means by which a user's Mobile Id is associated with the user's packet data protocol(s) and address(es) within the PLMN, and with the user's access point(s) to the packet data network. The association can be static, i.e. stored in an HLR, or dynamic, i.e. allocated on a per need basis.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.2",
      "section_id": "5.3.1.2",
      "section_title": "Authentication and Authorisation Function",
      "content": "This function performs the identification and authentication of the service requester, and the validation of the service request type to ensure that the user is authorised to use the particular network services. The authentication function is performed in association with the Mobility Management functions.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.3",
      "section_id": "5.3.1.3",
      "section_title": "Admission Control Function",
      "content": "The purpose of admission control is to calculate which network resources are required to provide the quality of service (QoS) requested, determine if those resources are available, and then reserve those resources. Admission control is performed in association with the Radio Resource Management functions in order to estimate the radio resource requirements within each cell.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.4",
      "section_id": "5.3.1.4",
      "section_title": "Message Screening Function",
      "content": "A screening function concerned with filtering out unauthorised or unsolicited messages is required. This should be supported through packet filtering functions. All types of message screening are left to the operators' control, e.g. by use of Internet firewalls.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.5",
      "section_id": "5.3.1.5",
      "section_title": "Packet Terminal Adaptation Function",
      "content": "This function adapts data packets received / transmitted from/to terminal equipment to a form suitable for transmission by GPRS across the packet domain network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.6",
      "section_id": "5.3.1.6",
      "section_title": "Charging Data Collection Function",
      "content": "This function collects data necessary to support subscription and/or traffic fees.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.1.7",
      "section_id": "5.3.1.7",
      "section_title": "Operator Determined Barring Function",
      "content": "The purpose of this function is to limit the service provider's financial risk with respect to new subscribers or to those who have not promptly paid their bills by restricting a particular packet switched service.\nThe functionality of ODB is described in the TS 23.015 [66].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.015"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.2",
      "section_id": "5.3.2",
      "section_title": "Packet Routeing and Transfer Functions",
      "content": "A route is an ordered list of nodes used for the transfer of messages within and between the PLMN(s). Each route consists of the originating node, zero or more relay nodes and the destination node. Routeing is the process of determining and using, in accordance with a set of rules, the route for transmission of a message within and between the PLMN(s).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.1",
      "section_id": "5.3.2.1",
      "section_title": "Relay Function",
      "content": "The relay function is the means by which a node forwards data received from one node to the next node in the route.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.2",
      "section_id": "5.3.2.2",
      "section_title": "Routeing Function",
      "content": "The routeing function determines the core network node to which a message should be forwarded and the underlying service(s) used to reach that GPRS Support Node (GSN), S‑GW or P‑GW, using the destination address of the message. The routeing function selects the transmission path for the \"next hop\" in the route.\nData transmission between core network nodes may occur across packet data networks that provide their own internal routeing functions, for example ITU-T Recommendation X.25 [34], Frame Relay or ATM networks.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.3",
      "section_id": "5.3.2.3",
      "section_title": "Address Translation and Mapping Function",
      "content": "Address translation is the conversion of one address to another address of a different type. Address translation may be used to convert an packet data network protocol address into an internal network address that can be used for routeing packets within and between the PLMN(s).\nAddress mapping is used to map a network address to another network address of the same type for the routeing and relaying of messages within and between the PLMN(s), for example to forward packets from one network node to another.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.4",
      "section_id": "5.3.2.4",
      "section_title": "Encapsulation Function",
      "content": "Encapsulation is the addition of address and control information to a data unit for routeing packets within and between the PLMN(s). Decapsulation is the removal of the addressing and control information from a packet to reveal the original data unit.\nEncapsulation and decapsulation are performed between the core network nodes, and between the GPRS serving support node and the MS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.5",
      "section_id": "5.3.2.5",
      "section_title": "Tunnelling Function",
      "content": "Tunnelling is the transfer of encapsulated data units within and between the PLMN(s) from the point of encapsulation to the point of decapsulation. A tunnel is a two-way point-to-point path. Only the tunnel endpoints are identified.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.6",
      "section_id": "5.3.2.6",
      "section_title": "Compression Function",
      "content": "The compression function optimises use of radio path capacity by transmitting as little of the SDU (i.e. the exterior PDP PDU) as possible while at the same time preserving the information contained within it. Only IP header compression is supported in Iu mode. The P‑GW/GGSN may instruct the SGSN to negotiate no data compression for specific PDP contexts.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.7",
      "section_id": "5.3.2.7",
      "section_title": "Ciphering Function",
      "content": "The ciphering function preserves the confidentiality of user data and signalling across the radio channels and inherently protects the PLMN from intruders.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.8",
      "section_id": "5.3.2.8",
      "section_title": "Domain Name Server Function",
      "content": "The Domain Name Server function resolves logical network node names to addresses. This function is standard Internet functionality according to RFC 1034 [43], which allows resolution of any name for GSNs and other nodes within the GPRS packet domain PLMN backbone networks.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.2.9",
      "section_id": "5.3.2.9",
      "section_title": "DHCP function",
      "content": "The Dynamic Host Configuration Function allows to deliver IP configuration information for UEs. This function is standard Internet functionality.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.3.1",
      "section_id": "5.3.3.1",
      "section_title": "General",
      "content": "The mobility management functions are used to keep track of the current location of an MS within the PLMN or within another PLMN.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.3.2",
      "section_id": "5.3.3.2",
      "section_title": "Idle Mode Signalling Reduction Function",
      "content": "The Idle mode Signalling Reduction (ISR) function provides a mechanism to limit signalling during cell‑reselection in idle mode between GERAN and E‑UTRAN or between UTRAN and E‑UTRAN and is described in TS 23.401 [89].\nNOTE:\tThis function is not used in GERAN/UTRAN only network deployments.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.4",
      "section_id": "5.3.4",
      "section_title": "Logical Link Management Functions (A/Gb mode)",
      "content": "Logical link management functions are concerned with the maintenance of a communication channel between an individual MS and the PLMN across the radio interface. These functions involve the co-ordination of link state information between the MS and the PLMN as well as the supervision of data transfer activity over the logical link.\nRefer to TS 44.064 [15] for further information.",
      "chunk_type": "general",
      "cross_references": [
        "ts_44.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.4.1",
      "section_id": "5.3.4.1",
      "section_title": "Logical Link Establishment Function",
      "content": "Logical link establishment is performed when the MS attaches to the PS services.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.4.2",
      "section_id": "5.3.4.2",
      "section_title": "Logical Link Maintenance Functions",
      "content": "Logical link maintenance functions supervise the logical link status and control link state changes.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.4.3",
      "section_id": "5.3.4.3",
      "section_title": "Logical Link Release Function",
      "content": "The logical link release function is used to de-allocate resources associated with the logical link connection.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.5.1",
      "section_id": "5.3.5.1",
      "section_title": "General",
      "content": "Radio resource management functions are concerned with the allocation and maintenance of radio communication paths, and are performed by the Radio Access Network. Refer to TS 43.064 [11] and to TS 43.051 [74] for further information on GERAN. Refer to TS 25.301 [50] for further information on UTRAN.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_43.064",
        "ts_43.051",
        "ts_25.301"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.5.2",
      "section_id": "5.3.5.2",
      "section_title": "RAT/Frequency Selection Priority",
      "content": "To support radio resource management in UTRAN/GERAN, the SGSN provides the parameter 'Index to RAT/Frequency Selection Priority' to RNC across Iu and to BSC across Gb. The RFSP Index is mapped by the RNC/BSC to locally defined configuration in order to apply specific RRM strategies. The RFSP Index is UE specific and applies to all the Radio Bearers. Examples of how this parameter may be used in UTRAN/GERAN:\n-\tto derive UE specific cell reselection priorities to control idle mode camping.\n-\tto decide on redirecting active mode UEs to different frequency layers or RATs.\nThe SGSN receives the subscribed RFSP Index from the HSS (e.g., during the Attach procedure). For non-roaming subscribers the SGSN chooses the RFSP Index in use according to one of the following procedures, depending on operator's configuration:\n-\tthe RFSP Index in use is identical to the subscribed RFSP Index, or\n-\tthe SGSN chooses the RFSP Index in use based on the subscribed RFSP Index, the locally configured operator's policies and the UE related context information available at the SGSN, including the UE's usage setting and voice domain preference for E-UTRAN, if received during Attach and Routing Area Update procedures (see clause 5.3.15).\nNOTE 1:\tOne example of how the SGSN can use the \"UE voice capabilities and settings\" is to select an RFSP value that enforces idle mode camping on 2G/3G for a UE acting in a \"Voice centric\" way and provisioned with \"CS Voice preferred, IMS Voice as secondary\", in order to minimize the occurrence of RAT changes. Another example is the selection of an RFSP value that prevents idle mode camping on 2G for a UE provisioned with \"IMS PS voice preferred, CS Voice as secondary\" if other RATs supporting IMS Voice are available, as the UE would in such case always select the CS domain for its voice calls.\nFor roaming subscribers the SGSN may alternatively choose the RFSP Index in use based on the visited network policy but can take input from HPLMN into account. (e.g. an RFSP Index value pre-configured per HPLMN, or a single RFSP Index value to be used for all roamers independent of the HPLMN).\nNOTE 2:\tOne example of how the SGSN can choose the RFSP Index in use for non-roaming or roaming subscribers with access restriction for E-UTRAN access due to access restriction in the subscription data or based on local configuration e.g. to reflect roaming restriction to E-UTRAN access, is to select an RFSP value that minimizes the risk of E-UTRAN cell reselection by a UE.\nThe SGSN forwards the RFSP Index in use to the RNC across Iu and to the BSC across Gb. The RFSP Index in use is also forwarded from source RNC to target RNC during the SRNS Relocation procedure for Intra-RAT handover.\nThe SGSN stores the subscribed RFSP Index value received from the HSS and the RFSP Index value in use. During the Routing Area Update procedure the SGSN may update the RFSP Index value in use and signal the updated value to the RNC across Iu and to the BSC across Gb, if the locally configured operator's policies indicate to do so (e.g. the SGSN may need to update the RFSP Index value in use if the UE related context information has changed). During inter-SGSN mobility procedures, the source SGSN forwards both RFSP Index values to the target SGSN. The target SGSN may replace the received RFSP Index value in use with a new RFSP Index value in use that is based on the operator's policies and the UE related context information available at the target SGSN.\nThe Iu messages that transfer the RFSP Index to the RNC are specified in TS 25.413 [56b].\nThe Gb messages that transfer the RFSP Index to the BSC are specified in TS 48.018 [78].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "ts_25.413",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.5.3",
      "section_id": "5.3.5.3",
      "section_title": "Service identification for improved radio utilisation for GERAN",
      "content": "The Service Class Indicator (SCI) (see TS 29.281 [120]) enables the GGSN/P-GW to provide the A/Gb mode GERAN access with an indication in the downlink user plane packet to assist the A/Gb mode GERAN access in providing specific RRM treatment in order to improve radio resource control and the overall performance of the GERAN.\nNOTE 1:\tIt is intended to standardize SCIs and relationship between SCIs and QoS classes in a future Release.\nIn the current specification, the SCI is only applicable for A/Gb mode GERAN access, and only for the Gn/Gp, S4 and the GTP based S5/S8 interfaces.\nSupport of SCI is optional in GERAN, A/Gb mode SGSN, and PGW/GGSN.\nThe GGSN/PGW is informed by the SGSN/MME of the UE's current RAT.\nWhen the UE is using an A/Gb mode GERAN the GGSN/PGW determines the value of the SCI based on configuration.The SCI is included in the downlink user plane data packet (see TS 29.281 [120]).\nNOTE 2:\tThe 3GPP charging architecture does not take the SCI value into account.\nThere is no impact on the S-GW as part of this feature. If the SCI is received at the S-GW, the S-GW forwards them transparently.\nNOTE 3:\tThis feature has no impact on the RNC, eNodeB and Iu mode SGSN. If (unusually) the SCI is received, these entities behave according to the existing specifications for the treatment of GTP extension headers.\nAn eNodeB or RNC shall ignore the Service Class Indicator if received over the S1-U, S12 or other interface.\nWhen the serving A/Gb mode SGSN receives SCI in a GTP-U packet, it copies it, without modifying its value, into a Gb interface information element that is sent by the SGSN in the downlink Gb interface user data packet to the GERAN access. In order to allow the GERAN to map the SCI into RRM behaviour, the downlink Gb interface user data packet also carries the HPLMN ID (in the IMSI parameter) and additional information, added by the SGSN, which indicates whether the SCI is assigned:\n-\tby a GGSN/P-GW in the Home PLMN, or\n-\tby a GGSN/P-GW in the Visited PLMN, or\n-\tby a GGSN/P-GW for which the SCIs are coordinated across the different operator group PLMNs and the serving PLMN of the SGSN (Operator Group GGSN).\nAbsence of additional information is an indication of a VPLMN provided SCI.\nNOTE 4:\tThe SGSN determines and indicates \"Operator Group GGSN\" based on local configuration, which consists of a list of specific APN-NIs and associated PLMN-IDs.\nThe A/Gb mode GERAN uses the information from the SGSN to determine whether to map, and how to map, the SCI to the related RRM behaviour. If the GERAN is not configured with an SCI mapping for the SGSN provided information, then the GERAN shall treat the user plane packet normally, i.e. the GERAN ignores the SCI.\nNOTE 5:\tWhen sending downlink GTP-U packets, there are some transient periods where the \"current RAT\" information for the user may be incorrect at the GGSN/P-GW e.g. after a handover from (E)UTRAN to GERAN, or if the MS is in idle mode with ISR active, or if the MS is in idle mode and located in a Routing Area comprising GERAN and UTRAN cells. In these cases, the A/Gb mode GERAN may receive the first downlink user plane packets without Service Class Indicator.\nIn network sharing configurations (MOCN or GWCN) the SCI can be supported as specified in TS 23.251 [83].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.281",
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.1",
      "section_id": "5.3.6.1",
      "section_title": "General",
      "content": "Network management functions provide mechanisms to support O&M functions related to GPRS.\n5.3.6.1a\tGTP-C signalling based Load and Overload Control\nThe S4-SGSN may support GTP-C based Load Control feature for enhanced GW selection procedures as described in TS 23.401 [89] clause 4.3.7.1a.1.\nThe S4-SGSN may support GTP-C signalling based Overload Control feature as described in TS 23.401 [89] clause 4.3.7.1a.2.\nFor details on the applicability and use of Load and Overload Control feature for PDN GW and Serving GW, see TS 23.401 [89], clause 4.3.7.1a.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401_clause_4.3.7.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.1",
      "section_id": "5.3.6.2.1",
      "section_title": "General",
      "content": "NAS level congestion control contains the functions: \"APN based congestion control\" and \"General NAS level Mobility Management congestion control\".\nThe use of the APN based MM and SM congestion control is for avoiding and handling of MM and SM signalling congestion associated with MSs with a particular APN. Both MSs and network shall support the functions to provide APN based MM and SM congestion control.\nThe SGSN may detect the NAS signalling congestion associated with the APN and start and stop performing the APN based congestion control based on criteria such as:\n-\tMaximum number of active PDP contexts per APN;\n-\tMaximum rate of PDP context activations per APN;\n-\tOne or multiple PDN GWs or GGSNs of an APN are not reachable or indicated congestion to the SGSN;\n-\tMaximum rate of MM signalling requests associated with the devices with a particular subscribed APN; and/or\n-\tSetting in network management.\nThe SGSN may detect the NAS signalling congestion associated with the MSs belonging to a particular group. The SGSN may start and stop performing the group based congestion control based on criteria such as:\n-\tMaximum rate of MM and SM signalling requests associated with the devices of a particular group; and/or\n-\tSetting in network management.\nThe SGSN may detect the NAS signalling congestion associated with the MSs that belong to a particular group and are subscribed to a particular APN. The SGSN may start and stop performing the APN and group specific NAS level congestion control based on criteria such as:\n-\tMaximum number of active PDP contexts per group and APN;\n-\tMaximum rate of MM and SM signalling requests associated with the devices of a particular group and a particular subscribed APN; and/or\n-\tSetting in network management.\nThe SGSN should not apply NAS level congestion control for emergency services.\nThe SGSN may also use the reject of NAS level Mobility Management signalling requests under general congestion conditions such as detecting congestion of one or several DCNs in an SGSN serving multiple DCNs.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.2",
      "section_id": "5.3.6.2.2",
      "section_title": "APN based Session Management congestion control",
      "content": "The APN based Session Management congestion control may be activated by SGSN due to e.g. congestion situation at SGSN, or by OAM at SGSN, or by a restart or recovery condition of a GGSN or PDN GW, or by a partial failure or recovery of a GGSN or PDN GW for a particular APN(s).\nThe SGSN may reject the Session Management (SM) requests from the MS (e.g. Activate PDP Context and Secondary PDP Context) with a Session Management back-off timer for congested APNs. If the MS provides no APN, then the SGSN uses the APN which is used in GGSN/PDN GW selection procedure.\nThe SGSN may deactivate PDP contexts belonging to a congested APN by sending the Deactivate PDP Context Request message to the MS with a Session Management back-off timer. If Session Management back-off timer is set in the Deactivate PDP Context Request message then the cause \"reactivation requested\" should not be set.\nNOTE 1:\tMSs that do not support the Session Management back-off timer (including earlier release of MS) might contribute to increasing the signalling load in the SGSN by reattempting Session Management procedure.\nThe SGSN may store a Session Management back-off time per MS and APN when congestion control is active for an APN if a request without the low access priority indicator is rejected by the SGSN. The SGSN may immediately reject any subsequent request from the MS targeting to the APN before the stored Session Management back-off time is expired except Modify PDP Context Request -as it may be used by the MS to report 3GPP PS Data Off status change, see clause 5.3.25). If the SGSN stores the Session Management back-off time per MS and APN and the SGSN decides to send a Session Management Request message to a MS connected to the congested APN (e.g. due to decreased congestion situation), the SGSN shall clear the Session Management back-off time prior to sending any Session Management Request message to the MS.\nNOTE 2:\tThe above functionality is to diminish the performance advantage for MSs that do not support the NAS level back-off timer (e.g. pre-Rel‑10 MSs) compared to MSs that do support it.\nThe SGSN should not apply APN based congestion control for emergency services.\nUpon reception of the Session Management back-off timer in the Session Management reject message or in the Deactivate PDP Context Request message, the MS shall take the following actions until the timer expires:\n-\tIf APN is provided in the rejected Session Management Request message or if the Session Management back-off timer is received in the Deactivate PDP Context Request message, the MS shall not initiate any Session Management procedures for the congested APN. The MS may initiate Session Management procedures for other APNs.\n-\tIf APN is not provided in the rejected Session Management Request message, the MS shall not initiate any Session Management requests without APN. The MS may initiate Session Management procedures for specific APN.\n-\tCell/RA/PLMN/RAT change do not stop the Session Management back-off timer.\n-\tThe MS is allowed to initiate the Session Management procedures when it is accessing the network with AC11‑15 or for emergency services even when the Session Management back-off timer is running.\n-\tThe MS is allowed to perform MS-initiated PDP Context Modification procedure to report 3GPP PS Data Off status change when the Session Management back off timer is running.\n-\tIf the MS receives a network initiated Session Management Request message for the congested APN while the Session Management back-off timer is running, the MS shall stop the Session Management back-off timer associated with this APN and respond to the SGSN.\n-\tIf the MS is configured with a permission for overriding low access priority and the Session Management back-off timer is running due to a reject message received in response to a request with low access priority, the upper layers in MS may request the initiation of Session Management procedures without low access priority.\nThe MS is allowed to initiate PDN disconnection procedure (e.g. sending Deactivate PDP Context Request) when the Session Management back off timer is running.\nNOTE 3:\tThe MS does not delete the related Session Management back-off timer when deactivating a PDP context.\nThe MS shall support a separate Session Management back-off timer for every APN that the MS may activate.\nTo avoid that large amounts of MSs initiate deferred requests (almost) simultaneously, the SGSN should select the Session Management back-off timer value so that deferred requests are not synchronized.\nThe APN based Session Management congestion control is applicable to the NAS SM signalling initiated from the MS in the control plane. The Session Management congestion control does not prevent the MS to send and receive data or initiate Service Request procedures for activating user plane bearers towards the APN(s) that are under SM congestion control.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.25"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.3",
      "section_id": "5.3.6.2.3",
      "section_title": "APN based Mobility Management congestion control",
      "content": "The SGSN may perform APN based congestion control for MSs with a particular subscribed APN by rejecting Attach procedures with a Mobility Management back-off timer. If the subscription contains a wildcard APN, the SGSN should not reject the request.\nWhen congestion control is active for MSs with a particular subscribed APN, a Mobility Management back-off timer may be sent by the SGSN to MS.\nIf SGSN maintains the MS context, the SGSN may store the back-off time per MS if a request without the low access priority indicator is rejected by the SGSN. The SGSN may immediately reject any subsequent request from the MS before the stored back-off time is expired.\nNOTE 1:\tThe above functionality is to diminish the performance advantage for MSs that do not support the NAS level back-off timer (e.g. pre-Rel‑10 MSs) compared to MSs that do support it.\nAfter rejecting Attach Requests, the SGSN should keep the subscriber data for some time. This allows for the rejection of subsequent requests without HSS signalling when the congestion situation resulting from MSs with a particular subscribed APN persists. Similarly the SGSN may reject Attach Requests based on subscriber data that the SGSN may store after the Detach procedure.\nWhile the Mobility Management back-off timer is running, the UE shall not initiate any NAS request for Mobility Management procedures. However, the UE is allowed to initiate Mobility Management procedures when it is accessing the network with AC11-15 or for emergency services even when the Mobility Management back-off timer is running.\nNOTE 2:\tWhen receiving the Mobility Management back-off timer the MS behaviour is not APN specific.\nWhile the Mobility Management back-off timer is running, the MS configured with a permission for overriding low access priority is allowed to initiate Mobility Management procedures without low access priority if the Mobility Management back-off timer was started due to a reject message received in response to a request with low access priority and the upper layers in MS request to activate a PDP context without low access priority or the MS has an activated PDP context that is without low access priority.\nTo avoid that large amounts of MSs initiate deferred requests (almost) simultaneously, the SGSN should select the Mobility Management back-off timer value so that deferred requests are not synchronized.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.4",
      "section_id": "5.3.6.2.4",
      "section_title": "General NAS level Mobility Management congestion control",
      "content": "Under general overload conditions the SGSN may reject Mobility Management signalling requests from MSs. When a NAS request is rejected, a Mobility Management back-off timer may be sent by the SGSN. If SGSN maintains the MS context, the SGSN may store the back-off time per MS if a request without the low access priority indicator is rejected by the SGSN. The SGSN may immediately reject any subsequent request from the MS before the stored back-off time is expired. While the Mobility Management back-off timer is running, the MS shall not initiate any NAS request for Mobility Management procedures. While the Mobility Management back-off timer is running, the MS is allowed to access the network with AC11-15, perform Detach Procedure, perform mobile terminated services and initiate emergency services. While the Mobility Management back-off timer is running, the MS is allowed to perform Routing Area Update (or combined RA/LA update) if it is already in READY or PMM-CONNECTED state. After any such Detach procedure, the back-off timer continues to run. If the MS receives a paging request from the SGSN while the Mobility Management back-off timer is running, the MS shall stop the Mobility Management back-off timer and initiate the Service Request procedure or the Routeing Area Update procedure as described in clause 6.9.2.1.\nWhile the Mobility Management back-off timer is running, the MS configured with a permission for overriding low access priority is allowed to initiate Mobility Management procedures without low access priority if the Mobility Management back-off timer was started due to a reject message received in response to a request with low access priority and the upper layers in MS request to activate a PDP context without low access priority or the MS has an activated PDP context that is without low access priority.\nThe Mobility Management back-off timer shall not impact the UE's function to perform Cell/RAT and PLMN change. Cell/RAT and RA change do not stop the Mobility Management back-off timer. The Mobility Management back-off timer shall not be a trigger for PLMN reselection. The back-off timer is stopped as defined in TS 24.008 [13] when a new PLMN that is not an equivalent PLMN is accessed.\nWhen the MS receives a handover command, the MS shall proceed with the handover procedure regardless of whether the Mobility Management back-off timer is running.\nThe SGSN should not reject Routing Area Update procedures that are performed when the MS is already in READY or PMM-CONNECTED state.\nIf the SGSN rejects a Routing Area Update Request or a Service Request with a Mobility Management back-off timer which is larger than the sum of the MS's periodic RA Update timer plus the implicit detach timer, the SGSN should adjust the mobile reachable timer and/or implicit detach timer such that the SGSN does not implicitly detach the MS while the Mobility Management back-off timer is running.\nNOTE:\tThis is to minimize unneeded signalling after the Mobility Management back-off timer expires.\nTo avoid that large amounts of MSs initiate deferred requests (almost) simultaneously, the SGSN should select the Mobility Management back-off timer value so that deferred requests are not synchronized.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.9.2.1",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.5",
      "section_id": "5.3.6.2.5",
      "section_title": "Group specific NAS level congestion control",
      "content": "The group specific NAS level congestion control applies to a specific group of MSs. Each group has a group identifier assigned.\nA MS belongs to a group, if the corresponding group identifier is stored in the MS's subscription data in the HLR/HSS. A MS may belong to multiple groups and the SGSN may perform the Group specific NAS level congestion control to an MS as described below independent of whether Group specific NAS level congestion control is activated for one, multiple, or all groups the MS belongs to. The group identifier shall be stored per MS in the HLR/HSS and obtained by the SGSN as part of normal HLR/HSS signalling. A MS is not aware of a group subscription.\nThe group specific NAS level congestion control may be activated for Session Management signalling, or for Mobility Management signalling, or both. The group specific NAS level congestion control is activated based on operator policies.\nWhen the group specific NAS level congestion control for Session Management signalling is active for a particular group, the SGSN's behaviour is similar to that in clause 5.3.6.2.2, with the following modifications:\n-\tSGSN may apply Session Management congestion control to all subscribed APNs for MSs that belong to this particular group.\nNOTE:\tHow the SGSN applies Session Management congestion control to all subscribed APNs is left to Stage 3.\n-\tThe SGSN may reject the Session Management (SM) requests from the MS belonging to this particular group (e.g. Activate PDP Context, Secondary PDP Context and Modify PDP Context Requests) with a Session Management back-off timer.\nWhen group specific NAS level congestion control for Mobility Management signalling is active for a particular group and a particular APN, the SGSN's behaviour is similar to that in clause 5.3.6.2.3, but applied to MSs with subscribed to this particular group rather that subscribed to a particular APN.\nGroup specific NAS level congestion control is performed at the SGSN based on the MS's subscription information provided by the HLR/HSS. There is no impact on the MS, and hence, MS's behaviour as described in clauses 5.3.6.2.2 and 5.3.6.2.3 does not change.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.6.2.2",
        "clause_5.3.6.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.2.6",
      "section_id": "5.3.6.2.6",
      "section_title": "APN and group specific NAS level congestion control",
      "content": "The APN and group specific NAS level congestion control is the interclause of APN specific NAS level congestion control and Group specific NAS level congestion control, i.e. it applies to a specific group of MSs with a particular subscribed APN. Each group of UEs has a group identifier assigned and stored in the HSS.\nA MS may belong to multiple groups and the SGSN may perform the APN and group specific NAS level congestion control to a MS as described below independent of whether the APN and group specific NAS level congestion control is activated for one, multiple or all groups the MS belongs to. The group identifier(s) shall be stored per MS in the HLR/HSS and obtained by the SGSN as part of normal HLR/HSS signalling. A MS is not aware of the group identifier(s) that the UE belongs to.\nThe APN and group specific NAS level congestion control may be activated for Session Management signalling, or for Mobility Management signalling, or both. The APN and group specific NAS level congestion control is activated based on operator policies.\nWhen the APN and group specific NAS level congestion control for Session Management signalling is activated for a MS belonging to a particular group and initiating signalling to a particular subscribed APN, the SGSN's behaviour is similar to that in clause 5.3.6.2.2, with the following modifications:\n-\tThe Session Management (SM) congestion control is applied to this particular APN, and for MSs belonging to this particular group.\n-\tThe SGSN may reject the SM requests from the MS belonging to this particular group and attaching to this particular APN (e.g. Activate PDP Context and Secondary PDP Context) with a Session Management back-off timer. If the MS provides no APN, then the SGSN uses the APN which is used in GGSN/PDN GW selection procedure.\n-\tThe SGSN may deactivate PDP contexts from the MSs, belonging to this particular group and attaching to this particular APN, by sending the Deactivate PDP Context Request message to the MS with a Session Management back-off timer.\nWhen APN and group specific NAS level congestion control for Mobility Management signalling is activated for a MS belonging to a particular group and with a particular subscribed APN, the SGSN's behaviour is similar to that in clause 5.3.6.2.3, but applied to MSs with this particular subscribed APN and belonging to this particular group.\nAPN and group specific NAS level congestion control is performed at the SGSN based on the MS's subscription information provided by the HLR/HSS. There is no impact on the MS, and hence, MS's behaviour described in clauses 5.3.6.2.2 and 5.3.6.2.3 does not change.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.6.2.2",
        "clause_5.3.6.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.3",
      "section_id": "5.3.6.3",
      "section_title": "GGSN control of overload",
      "content": "The GGSN may provide mechanisms for avoiding and handling overload situations. These include the rejection of PDP context requests from UEs.\nThe GGSN may detect congestion per APN and start and stop performing overload control based on criteria such as:\n-\tMaximum number of active PDP contexts per APN and/or\n-\tMaximum rate of PDP context activations per APN.\nWhen performing overload control the GGSN rejects PDP context requests. When receiving the rejection from the GGSN, the SGSN rejects the UE's PDP context request as specified in clause 5.3.6.2. In addition the GGSN may indicate a \"GGSN back-off time\" for a specific APN to the SGSN. The SGSN should reject PDP context requests from UEs for the specific APN related to that GGSN during the \"GGSN back-off time\", by the means specified in clause 5.3.6.2. If a GGSN indicates APN congestion by the \"GGSN back-off time\" the SGSN may select another GGSN of that APN instead of rejecting PDP context requests. unless there is already an existing PDP context to the same APN for the MS, in which case, the SGSN shall reject PDP context request",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.6.2"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.4",
      "section_id": "5.3.6.4",
      "section_title": "SGSN control of overload",
      "content": "The SGSN contains mechanisms for avoiding and handling overload situations. In an overload situation the SGSN can request the RNC to reduce any kind of signalling traffic as specified in TS 25.413 [56b].\nIn addition, the SGSN can request the BSC/RNC to reject the RR(C) connection establishments from MSs that access the network with low access priority that its connected BSCs/RNCs are generating on it.\nA BSC/RNC supports rejecting of RR(C) connection establishments from MSs that access the network with low access priority. When rejecting an RR(C) connection request for overload reasons the BSC/RNC indicates to the MSs an appropriate timer value that limits further RR(C) connection requests.\nIf the network is operating in Network Mode of Operation II, then (because at a common LA/RA boundary Location Area Updates are initiated before Routeing Area updates) MSs will often initiate signalling connections towards the SGSN while in RRC connected state. If the SGSN has indicated an overload situation to the RNC, then the RNC can use the Signalling Connection Release message to avoid establishing the signalling connection with the SGSN.\nAdditionally, a BSC/RNC provides support for the barring of MSs configured for Extended Access Barring, as described in TS 22.011 [112]. These mechanisms are further specified in TS 48.016 [20] and TS 44.018 [85] for GERAN, TS 25.331 [52] for UTRAN.\nA BSC/RNC may initiate Extended Access Barring when:\n-\tall the SGSNs (and all the MSCs) connected to a BSC/RNC request to restrict the load for MSs that access the network with low access priority; or\n-\trequested by O&M.\nIf a SGSN requests a BSC/RNC to restrict the load for MSs that access the network with low access priority, the SGSN should select all the BSCs/RNCs with which the SGSN has Gb/Iu interface connections (so that Extended Access Barring can be triggered if all SGSNs within a pool area are experiencing the same overload situation). Alternatively, the selected BSCs/RNCs may be limited to a subset of the BSCs/RNCs with which the SGSN has Gb/Iu interface connections (e.g. particular location area or where MSs of the targeted type are registered).\nFor GERAN, subsequent initial access attempts by a previously barred MS through Extended Access Barring is described in TS 44.018 [85].\nIn addition, to protect the network from overload the SGSN has the option of rejecting NAS request messages which include the low access priority indicator before rejecting NAS request messages without the low access priority indicator (see clause 5.3.6.2 for more information).\nNOTE:\tIt cannot be guaranteed that voice services will be available for mobile terminated calls while the Mobility Management back-off timer is running. It is recommended, that MS's requiring voice services are not configured for low access priority.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.6.2",
        "ts_25.413",
        "ts_22.011",
        "ts_48.016",
        "ts_44.018",
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.6.5",
      "section_id": "5.3.6.5",
      "section_title": "S4-SGSN control of overload",
      "content": "Under unusual circumstances (e.g. when the S4-SGSN load exceeds an operator configured threshold), the S4-SGSN may restrict the signalling load that its SGWs are generating on it, if configured to do so.\nThe S4-SGSN can reject Downlink Data Notification requests for low priority traffic for UEs in idle mode or to further offload the S4-SGSN, the S4-SGSN can request the SGWs to selectively reduce the number of Downlink Data Notification requests it sends for downlink low priority traffic received for UEs in idle mode according to a throttling factor and for a throttling delay specified in the Downlink Data Notification Ack message.\nSGW and S4-SGSN determine whether a bearer is for low priority traffic or not on the basis of the bearer's ARP priority level and operator policy (i.e. operator's configuration in the SGW and S4-SGSN of the ARP priority levels to be considered as priority or non- priority traffic). The S4-SGSN determines whether a Downlink Data Notification request is for low priority traffic or not on the basis of the ARP priority level that was received from the SGW and operator policy.\nIf ISR is not active for the UE, during the throttling delay, the SGW drops downlink packets received on all its low priority bearers for UEs known as not user plane connected (i.e. the SGW context data indicates no downlink user plane TEID) served by that S4-SGSN in proportion to the throttling factor, and sends a Downlink Data Notification message to the S4-SGSN only for the non throttled bearers.\nIf ISR is active for the UE, during the throttling delay, the SGW does not send DDN to the S4-SGSN and only sends the DDN to the MME. If both MME and SGSN are requesting load reduction, the SGW drops downlink packets received on all its low priority bearers for UEs known as not user plane connected (i.e. the SGW context data indicates no downlink user plane TEID) in proportion to the throttling factors.\nThe SGW resumes normal operations at the expiry of the throttling delay. The last received value of the throttling factor and throttling delay supersedes any previous values received from that S4-SGSN. The reception of a throttling delay restarts the SGW timer associated with that S4-SGSN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.6.6",
      "section_id": "5.3.6.6",
      "section_title": "Throttling of NIDD Submit Requests",
      "content": "Under unusual circumstances (e.g. when the SGSN load exceeds an operator configured threshold), the SGSN may restrict NIDD Submit Request messages that its SCEFs are generating on it, if configured to do so.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.7.1",
      "section_id": "5.3.7.1",
      "section_title": "SGW/PGW/GGSN selection function (3GPP accesses)",
      "content": "The SGSN supporting both S4 and Gn/Gp shall support selection of SGW/PGW and GGSN.\nThe Gn/Gp SGSN shall support selection of GGSN and may optionally support selection of PGW.\nFor a given UE, the SGSN shall select the same GGSN/PGW for all the PDP contexts belonging to the same APN.\nAt PDP Context activation, in addition to network local policy, it shall be possible for SGSN to use:\n-\tthe UE capability (as indicated in the MS Network Capability);\n-\tsubscription restriction to use NR as secondary RAT;\n-\tthe configuration about the roaming agreement for E-UTRAN with the HPLMN of the UE; and\n-\tthe UE Usage Type if DCNs are deployed in the network,\nas input to select GGSN, or a SGW and PGW.\nIt shall be possible to configure the selection function on the SGSN to give priority towards SGW/PGW for E-UTRAN capable UEs, and GGSN for non E-UTRAN capable UE.\nIt shall also be possible to configure the selection function on the SGSN to select GGSN/PGW using Gp when there is no roaming agreement for E-UTRAN with the HPLMN of the UE.\nNOTE:\tEPS-based mobility to non-3GPP accesses is only possible if the SGSN selects a PDN GW.\nThe S4-SGSN supporting GTP-C Load Control feature performs enhanced PDN GW selection as described in the clause 4.3.8.1 of TS 23.401 [89].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.401_clause_4.3.8.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.7.2",
      "section_id": "5.3.7.2",
      "section_title": "Serving GW selection function",
      "content": "The Serving GW selection function is described in the clause \"Serving GW selection function\" of TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.7.3",
      "section_id": "5.3.7.3",
      "section_title": "SGSN selection function",
      "content": "The SGSN selection function selects an available SGSN to serve a UE. The selection is based on network topology, i.e. the selected SGSN serves the UE's location and in case of overlapping SGSN service areas, the selection may prefer SGSNs with service areas that reduce the probability of changing the SGSN. Other criteria for SGSN selection may be load balancing between SGSNs. In networks that deploy dedicated MMEs/SGSNs, e.g. for UEs configured for low access priority, the possible target SGSN selected by source MME/SGSN is typically restricted to SGSNs with the same dedication.\nWhen a MME/SGSN supporting DCNs selects a target SGSN, the selected target SGSN is restricted to SGSNs that belong to the same DCN. The DNS procedure may be used by the source CN node to select the target SGSN from a given DCN. If both low access priority and UE Usage Type parameter are used for SGSN selection, selection based on UE Usage type parameter overrides selection based on the low access priority indication.\nWhen selecting an SGSN for an MS that is accessing for the purpose of utilizing EC-GSM-IoT (see TS 43.064 [11]), the SGSN selection function in the BSC shall select an SGSN taking into account the SGSN's support (or non-support) for CIoT GSM Optimization.",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.8",
      "section_id": "5.3.8",
      "section_title": "IMS voice over PS Session Supported Indication",
      "content": "The serving PLMN, both in Iu mode and A/Gb mode, shall send an indication toward the UE during the Attach procedure and Routing Area Update procedures if an IMS voice over PS session is supported. The serving PLMN uses this indicator to indicate to the UE whether it can expect a successful IMS voice over PS session according to TS 22.173 [121] with a bearer that supports Conversational Voice as specified in TS 23.203 [88], when the UTRAN Iu mode is used. A UE with \"IMS voice over PS\" voice capability should take this indication into account when:\n-\testablishing voice over PS sessions (as specified in TS 23.221 [80]);\n-\tdetermining whether to deactivate ISR locally (as detailed in clauses 6.9.1.2.0 and 6.9.2.1); and\n-\tdetermining whether to perform a Routing Area Update when changing between GERAN and UTRAN cells within a Routing Area with both GERAN and UTRAN cells (to inform about IMS voice over PS sessions support as detailed in clauses 6.9.1.2.0 and 6.9.2.1).\nThe serving PLMN provides this indication based e.g. on local policy, HPLMN, Voice Support Match Indicator, the SRVCC capability of the network and UE and/or level of UTRAN coverage. The serving PLMN shall indicate to the UE that the UE can expect a successful IMS voice over PS session according to TS 22.173 [121] with a bearer that supports Conversational Voice as specified in TS 23.203 [88] only if the SGSN is configured to know that the serving PLMN has a roaming agreement for IMS voice with the HPLMN of the UE. This indication is per RAI within the SGSN.\nOn request from the HSS, the SGSN shall indicate the following:\n-\twhether or not an IMS voice over PS session is supported in the UE's current Routing Area (\"IMS voice over PS Session Supported Indication\"), together with the time of the last radio contact with the UE; and\n-\tthe current RAT type.\n5.3.8A\tHomogenous Support of IMS Voice over PS Sessions Indication\nThe \"Homogenous Support of IMS Voice over PS Sessions\" indication is provided by the SGSN to the HSS/HLR, and can be used by the HSS/HLR to avoid requesting the serving nodes whether or not an IMS voice over PS session according to TS 22.173 [121] with bearer that supports Conversational Voice as specified in TS 23.203 [88] is supported. This indication is stored in the SGSN MM context.\nThe SGSN shall behave as follows whenever it sends a Update Location or a Notify Request message to the HLR/HSS:\n-\tif \"IMS Voice over PS Sessions\" is supported homogeneously in all RAs in the serving SGSN for the UE, the SGSN shall include the \"Homogenous Support of IMS Voice over PS Sessions\" indication set to \"Supported\".\n-\tif none of the RAs of the serving SGSN supports \"IMS Voice over PS Sessions\" for the UE, the SGSN shall include the \"Homogenous Support of IMS Voice over PS Sessions\" indication set to \"Not supported\".\n-\tif \"IMS Voice over PS Sessions\" support is either non-homogeneous or unknown, the SGSN shall not include the \"Homogenous Support of IMS Voice over PS Sessions\" indication.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_22.173",
        "ts_23.203",
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.9",
      "section_id": "5.3.9",
      "section_title": "Closed Subscriber Group functions",
      "content": "A Closed Subscriber Group (CSG) identifies a group of subscribers who are permitted to access one or more CSG cells of the PLMN as a member of the CSG for a HNB. The following CSG related functions are defined:\n-\tCSG subscription handling function stores and updates the user's CSG subscription data at the MS and the network.\n-\tFor closed mode, CSG access control function ensures a UE has valid subscription at a CSG where it performs an access.\n-\tAdmission and rate control function is used to provide different admission and rate control for CSG and non-CSG members for a hybrid cell.\n-\tCSG charging function enables per CSG charging for a subscriber consuming network services via a CSG cell or a hybrid cell.\n-\tPaging optimization function is optionally used to filter paging messages based on RAI/LAI, UE CSG capability, user's CSG subscription data and CSG access mode in order to avoid paging at CSG cells where the UE is not allowed to access. If the MS has emergency bearer service the paging optimization function shall not be performed.\n-\tVPLMN Autonomous CSG roaming function is optionally supported whereby a VPLMN, if allowed by the HPLMN, stores and manages VPLMN specific CSG subscription information for roaming UEs without interaction with the HLR/HSS.\nNOTE:\tThe support of the Closed Subscriber Group functions is optional for an UTRAN MS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.10",
      "section_id": "5.3.10",
      "section_title": "UE Reachability function",
      "content": "One or several services can subscribe to the HSS in order to be notified when the UE becomes reachable at NAS layer. On request from the HSS, the SGSN notifies the HSS when the UE is detected at NAS level by the SGSN, and the HSS notifies the subscribed services. An example service is SMS over IP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.11",
      "section_id": "5.3.11",
      "section_title": "Location Service functions",
      "content": "LCS procedures are described in the LCS stage 2 specification, see TS 23.271 [65].\nIn addition, in the Detach and PDP Context Deactivation procedures, the SGSN shall inform the GGSN/S-GW of the last known location of the MS, and shall provide information to enable the determination of the time at which the MS was in that location. The S-GW shall (if necessary taking into account information from the MME) inform the PDN GW of the last known location of the MS, and shall provide information to enable the determination of the time at which the MS was in that location. If requested by the PCRF the GGSN/PDN GW shall indicate this information to the PCRF as defined in TS 23.203 [88]. The information can also be made available on the Gi interface as specified in TS 29.061 [27] and on the CDRs at the GGSN/PDN GW as specified in TS 32.251 [70].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.271",
        "ts_23.203",
        "ts_29.061",
        "ts_32.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.12.1",
      "section_id": "5.3.12.1",
      "section_title": "SIPTO with GW Selection",
      "content": "The SIPTO function enables an operator to offload certain types of traffic at a network node close to that UE's point of attachment to the access network or to a local network.\nSIPTO function specified in TS 23.401 [89] clause 4.3.15 is applicable, with the SGSN node providing the functions specified for the MME.\nIn order to fully utilise the benefit of the SIPTO with GW selection function, direct tunnel functionality as described in clause 15.6 should be applied.\nIn order to select a set of GWs (S-GW/P-GW or GGSN) for SIPTO above RAN service that is most appropriate for that UE's current location (during the PDP Context Activation Procedure (clauses 9.2.2.1 and 9.2.2.1A)), the SGSN checks the APN status for SIPTO for the user during the GW Selection function procedure as described in clause 5.3.7 and Annex A.\nFor SIPTO above RAN, as a result of UE mobility (e.g. detected by the SGSN at RAU), the target SGSN may allocate a different GW that is more appropriate for the UE's current location, e.g. the SGSN may know whether the UE's new location is served by the same GW as the old one. When the SGSN decides upon the need for GW relocation, the SGSN deactivates the impacted PDN connections indicating \"reactivation requested\" as specified in clause 9.2.4.2.\nNOTE:\tIf the above procedure for GW relocation is initiated while the UE has active applications, it may cause disruption of services that are affected if the IP address changes.\nFor SIPTO above RAN or SIPTO at the Local network with stand-alone GW (with S-GW and L-GW collocated), if SIPTO PDN connection is initiated as an additional subsequent PDN connection, S4-SGSN should check if the S-GW is optimal for the user's current location. If it is not, S4-SGSN may decide to perform a S4-SGSN triggered Serving GW relocation according to the clause 9.2.2.4, when possible (e.g. no other restriction apply).\n5.3.12.1A\tSIPTO at the Local Network\n5.3.12.1A.1\tGeneral\nThe SIPTO at the Local Network function enables an IP capable UE connected via a (H)NB to access a defined IP network (e.g. the Internet) without the user plane traversing the mobile operator's network except the (H)NB subsystem.\nSIPTO at the Local Network can be achieved by selecting a L-GW function collocated with the (H)NB or selecting standalone GWs ( with S-GW and L-GW collocated) residing in the Local Network. In both cases the selected IP traffic is offloaded via the Local Network.\nSpecific to the HNB subsystem, SIPTO at the Local Network does not depend on CSG membership and the feature can be applied to any UE, as long as the UE is allowed to access the cell.\nSIPTO at the Local Network is available for UTRAN access only.\nFor this Release of the specification there is no support for secondary PDP context on the PDN connection used for SIPTO at the Local Network.The Local GW (L-GW) shall reject any MS initiated Secondary PDP Context Activation Procedure or any PDP Context Modification Procedure that is for the SIPTO at local network PDN Connection.\nSIPTO at the Local Network is intended for offloading Internet traffic only, thus the L-GW does not provide APN specific connectivity. Therefore if the subscription data in the HSS indicate that offload at the local network is allowed, this implies that the related APN is typically used for providing Internet connectivity.\nThe SIPTO at the Local Network function specified in TS 23.401 [89] clauses 4.3.15 and 4.3.15a are applicable, with the SGSN node providing the functions specified for the MME and the (H)NB/RNC providing the functions specified for the (H)eNB.\n5.3.12.1A.2\tSIPTO at the Local Network with stand-alone GW (S-GW/L-GW collocated) function\nSIPTO at the Local Network is achieved using a standalone GW (with S-GW and L-GW collocated) residing in the Local Network.\nIn order to select an appropriate Local GW (L-GW) for SIPTO at the local network service, the GW selection function in the SGSN uses the APN and the Local Home Network ID during the DNS interrogation as specified in TS 29.303 [100] to find the GW identity of the L-GW to be selected. The Local Home Network ID is provided to the SGSN in every INITIAL UE MESSAGE and every UTRAN Originated DIRECT TRANSFER control message, Relocation Complete message and Enhanced Relocation Complete message as specified in TS 25.413 [56b]. The (new) SGSN uses the Local Home Network ID to determine if the UE has left its current local network and if S-GW relocation is needed.\nIf SIPTO at local network with stand-alone GW, Serving GW relocation without mobility and ISR are supported in the core network, a Routing Area should only contain either cells inside one Local Home Network or cells inside the macro network. If a Routing Area contains both cells inside Local Home Network and cells inside the macro network, the ISR shall not be activated if the UE is allowed to use SIPTO at local network.\nIn the case using Gn/Gp SGSN and a new offload connection is requested, the PDP Context Activation Procedure (clause 9.2.2.1) can be used to set up the direct tunnel (Gn-UP) between HNB Subsystem/RNC and the Local GW.\n5.3.12.1A.3\tSIPTO at the Local Network with L-GW function collocated with HNB\nThe Local GW used for SIPTO at the Local Network may be same or different as the Local GW used for the LIPA functionality (if provided).\nThe HNB supporting the SIPTO at the Local Network function includes the Local GW address to the SGSN in every INITIAL UE MESSAGE and every UTRAN Originated DIRECT TRANSFER control message as specified in TS 25.413 [56b].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_4.3.15",
        "clause_15.6",
        "clause_5.3.7",
        "clause_9.2.4.2",
        "clause_9.2.2.4",
        "clause_9.2.2.1",
        "ts_23.401",
        "ts_29.303",
        "ts_25.413"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.12.2",
      "section_id": "5.3.12.2",
      "section_title": "Support for SIPTO at Iu-ps",
      "content": "SIPTO can be achieved by adding an optional Traffic Offload Function at Iu interface as described in clause B.1. If implemented, and in order to activate SIPTO at Iu-ps, the SGSN shall send charging parameters including MSISDN, APN, Charging Characteristics in the RANAP messages whenever a RAB to be offloaded is requested to be setup as described in clause B.2.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.13.1",
      "section_id": "5.3.13.1",
      "section_title": "General",
      "content": "This clause provides an overview about functionality for Machine Type Communications according to service requirements described in TS 22.368 [110]. The specific functionality is described in the affected procedures and features of this and other specifications. For discrepancies between this overview clause and the detailed procedure and function descriptions, the latter take precedence.\nMTC functionality is provided by the visited and home networks when the networks are configured to support machine type communication. It applies to both the non-roaming case and the roaming case and some functionality may be dependent upon the existence of appropriate roaming agreements between the operators.\nSome of the MTC functions are controlled by subscriber data. Other MTC functions are based on indicators sent by the UE to the network. MTC functionality is performed by UEs that are configured to support different options as described in clause 5.3.13.3.\nThough motivated by scenarios and use cases defined in TS 22.368 [110], the functions added to support MTC have general applicability and are in no way constrained to any specific scenario or use case except where explicitly stated.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.3.13.3",
        "ts_22.368"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.2",
      "section_id": "5.3.13.2",
      "section_title": "Overview of Protection from Potential MTC Related Overload",
      "content": "The number of Machine Type Communication devices may be several orders of magnitude greater than \"traditional\" devices. Many (but not all) MTC devices will be relatively stationary and/or generate low volumes of traffic. However, these MTC devices have the capability to generate normal quantities of signalling. As normal signalling from large numbers of MSs may cause overload independently whether the MS is used for MTC or not, generic functionality for overload and congestion control is required.\nThe total signalling from large numbers of MSs is a concern in at least two situations:\n-\twhen an application (running in many MSs) requests many MSs to do \"something\" at the same time; and/or\n-\twhen many MSs are roamers and their serving network fails, then they can all move onto the local competing networks, and potentially overload the not (yet) failed network(s).\nTo counter these potential problems, the following standardised indications and mechanisms are provided in a generic manner. These permit node specific features to be developed to protect the networks.\na)\tWhere applicable, MSs can be configured for enhancements as described in subsequent bullets. Post-manufacturing configuration can be performed remotely as described in clause 5.3.13.3.\nb)\tFor mobile originated services, MSs configured for low access priority provide:\n-\tthe UTRAN with information indicating that the RR(C) connection establishment request has low access priority (see clause 5.3.13.3); and\n-\tthe GERAN with information indicating that the RR connection establishment request has low access priority (see clause 5.3.13.3), when accessing the network for the purpose of PS domain signalling.\nIn GERAN, \"Implicit Reject\" functionality permits the BSS to inhibit Random Access Channel signalling (see TS 44.018 [85]).\nClause 5.3.13.3 describes when low access priority is not applicable.\nc)\tRRC signalling has the capability of providing 'extended wait timers' when rejecting messages.\nd)\tSGSN can initiate rejection of RR(C) connection establishment in the GERAN/UTRAN MSs that access the network with low access priority. In addition, SGSN signalling or GERAN/UTRAN O&M can trigger GERAN/UTRAN to initiate Extended Access Barring in the GERAN /UTRAN. These mechanisms are further described in clause 5.3.6.4.\ne)\tOverload messages from the SGSN to RNS/BSS are extended to aid the RAN in performing the functionality in bullets b, c and d above.\nf)\tMSs configured with a long minimum periodic PLMN search time limit (see TS 24.368 [111]) have an increased minimum time inbetween their searches for more preferred PLMNs.\nNOTE 1:\tFollowing the failure of a more preferred PLMN, MSs configured as above might change to other local competing networks. Expiry of this search timer will lead to the MS re-attempting to access the failed network, and then, if that network has not yet recovered, reaccessing one of the local competing networks. Use of a too short timer for the more preferred PLMN search can both prevent the failed network from recovering, and, impose more load on the local competing networks.\ng)\tAt PLMN change, MSs configured to perform Attach with IMSI at PLMN change (see TS 24.368 [111]) do this rather than an RA update with P-TMSI (thus avoiding the need to reject the RA update, and to request the IMSI following the subsequent Attach with P-TMSI).\nNOTE 2:\tIn the case of a network failure, this reduces the message processing load on a local competing network and hence makes that network more likely to survive the failure of the other network.\nh)\tFor mobile originated services, MSs configured for low access priority (see TS 24.368 [111]) provide a low access priority indication to the SGSN in NAS signalling that permits the SGSN to undertake protective measures (e.g. to permit the SGSN to immediately command the MS to move to a state where it does not need to generate further signalling messages and/or does not reselect PLMNs), as described in clause 5.3.6.4. Clause 5.3.13.3 describes when low access priority is not applicable.\ni)\tUsing periodic RAU timer information sent by the HSS and/or MS provided indication (bullet h above), the SGSN can allocate a long periodic RAU timer to the MS. A long periodic RAU timer is likely to slow down the rate at which an MS detects a network failure and thus it slows down the rate of movement of MSs from a failed network to other local competing networks (see clause 5.3.13.5).\nj)\tMechanisms for the SGSN and GGSN/P-GW to detect congestion associated with a particular APN (see clauses 5.3.6.2 and 5.3.6.3 and TS 23.401 [89]).\nk)\tThe addition of 'back off timers' to GMM and SM signalling messages (e.g. to rejection messages). These include some time randomisation to guard against a repeat of a load peak. The SGSN should be able to apply this behaviour on a per-APN basis as described in clause 5.3.6.2.\nl)\tMechanisms that permit the GGSN/P-GW to handle per-APN congestion (see clause 5.3.6.3 and TS 23.401 [89]).\nm)\tWhen using the S4 architecture, an SGSN overload control mechanism to selectively limit the number of Downlink Data Notification requests the S‑GW sends to the SGSN for downlink low priority traffic received for MSs in idle mode (see clause 5.3.6.5).\nn)\tThe BSS and RNS are provided with low access priority indications from the MS that permit them to steer \"new MTC entrants into a pool area\" to specific SGSNs (e.g. to an SGSN optimised for MTC devices by having a larger subscriber data base, see TS 23.236 [73]).\no)\tGERAN and/or UTRAN broadcast signalling can be used to command MSs configured to use the extended NMO I system information (see TS 24.368 [111]) to operate in Network Mode of Operation I while leaving other MSs operating in NMO II. This reduces the amount of signalling from MSs configured as above and may be particularly useful at times of the failure of another PLMN. Maintaining NMO II for existing MSs avoids changes to their existing service levels (see clause 6.3.3.1).\nNOTE 3:\tIt is assumed that the mechanisms described in this entire clause are designed by stage-3 in a manner that allows extensibility and forward compatibility.\np)\tMS configured for specific handling of the invalid USIM state, the \"forbidden PLMN list\" and the \"forbidden PLMNs for GPRS service list\" remembers that the (U)SIM is invalid and keeps the PLMN forbidden lists even if the MS is switched off and then switched on.\nq)\tWhen the MS has an activated PDP context that is without low access priority or the MS is requested to activate such a PDP context and the MS is configured with a permission for overriding low access priority, then the MS does not provide a low access priority indication to the SGSN in MM NAS signalling and also not to the RAN in the RR(C) requests. In the NAS request for activating a PDP context, this MS always indicates what the upper layers requested, i.e. the MS indicates low access priority in that NAS request unless the upper layers request activation of a PDN connection without low access priority.\nr)\tWhen the MS has an activated PDP context that is without low access priority or the MS is requested to activate such a PDP context and the MS is configured with a permission for overriding Extended Access Barring, then the MS ignores any Extended Access Barring (if it is activated in the network) as defined in TS 22.011 [112].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.3.13.3",
        "ts_44.018_clause_5.3.13.3",
        "clause_5.3.6.4",
        "clause_5.3.13.5",
        "clause_5.3.6.2",
        "ts_23.401_clause_5.3.6.3",
        "clause_5.3.6.5",
        "clause_6.3.3.1",
        "ts_44.018",
        "ts_24.368",
        "ts_23.401",
        "ts_23.236",
        "ts_22.011"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.3",
      "section_id": "5.3.13.3",
      "section_title": "MS configuration and usage of indicators",
      "content": "A subscriber can by agreement with its operator be required to use MSs that are configured (see TS 24.368 [111]) to support one or more of the following options:\n-\tMS configured for low access priority; and/or\n-\tMS configured with a permission for overriding low access priority, which is only applicable for an MS that is also configured for low access priority; and/or\n-\tMS configured to use the extended NMO I system information; and/or\n-\tMS configured to perform Attach with IMSI at PLMN change; and/or\n-\tMS configured with a long minimum periodic PLMN search time limit; and/or\n-\tMS configured for Extended Access Barring; and/or\n-\tMS configured with a permission for overriding Extended Access Barring, which is only applicable for a UE that is also configured for Extended Access Barring;and/or\n-\tMS configured for specific handling of the invalid (U)SIM state, the \"forbidden PLMN list\" and the \"forbidden PLMNs for GPRS service list\".\nNOTE 1:\tWhen an MS is accessing the network with low access priority, the MS may be subject for longer backoff timers at overload and consequently need to be designed to be tolerant to delays when accessing the network.\nMSs can be configured for one or more of the above options with the following restrictions:\n-\tin this Release of the specification, an MS that is configured for low access priority shall also be configured for Extended Access Barring; and\n-\tin this Release of the specification, an MS that is configured for Extended Access Barring shall be configured for low access priority.\n-\tin this Release of the specification, an MS that is configured for overriding low access priority shall also be configured for overriding Extended Access Barring; and\n-\tin this Release of the specification, an MS that is configured for overriding Extended Access Barring shall also be configured for overriding low access priority.\nPost-manufacturing configuration of these options in the MS can be performed only by OMA DM or (U)SIM OTA procedures. MSs capable of the above options should support configuration of these options by both OMA DM and (U)SIM OTA procedures.\nAn MS configured for low access priority shall transmit the low access priority indicator to the SGSN during the appropriate NAS signalling procedures and transmit the corresponding low access priority to the UTRAN/GERAN during RR(C) connection establishment procedures, unless the MS is also configured with a permission for overriding low access priority where bullet q from clause 5.3.13.2 applies.\nNOTE 2:\tThe low access priority indicator in NAS signalling and the corresponding low access priority for RR(C) connection establishment are used by the network to decide whether to accept the NAS request or the setup of the RR(C) connection, respectively.\nLow access priority shall not be applicable in the following situations:\n-\tfor all procedures related to an emergency PDN connection; used for IMS Emergency sessions that are to be prioritized as per the requirements for IMS Emergency session procedures (see clause 5.10). When an emergency PDN connection gets established, the SGSN may, based on SGSN configuration, initiate the deactivation of any non-emergency PDN connection using the SGSN-initiated PDP Context Deactivation Procedure described in clause 9.2.4.2 and, in S4 mode, the SGSN Initiated PDN connection Deactivation Procedure described in clause 9.2.4.1A.1;\n-\tfor all procedures when preferential access to the network is provided to the MS by the Access Class 11-15 mechanism according to TS 44.018 [85], TS 44.060 [77], TS 25.331 [52] and TS 22.011 [112];\nNOTE 3:\tThe configuration of an MS for low access priority and Access Class 11-15 is configured independently of each other. However, the home operator can take care to prevent a subscription for Access Class 11-15 from being used in an MS configured for low access priority.\n-\tfor RR(C) connection establishment procedures when responding to paging;\n-\tfor an MS configured with a permission for overriding low access priority under conditions described by bullet bullet q from clause 5.3.13.2; or\n-\tother specific situations described in TS 24.008 [13].\nIf the NAS session management request message used to establish a new PDN connection contains a low access priority indication, the SGSN shall forward the low access priority indication in the Create PDP Context Request message to the GGSN and, in S4 mode, in the Create Session Request message to the S-GW/P‑GW. The low priority indication gets associated with a PDN connection when it is established and it shall not change until the PDN connection is deactivated.\nThe low access priority indication may be included in charging records by the visited and home networks. In order to permit the S-GW and/or Gn/Gp SGSN to include the low access priority indicator in the charging records, the low access priority indicator should be stored in the SGSN EPS/PDP Bearer contexts and should be passed as part of these contexts to other SGSN/MME or S-GW nodes in mobility management procedures.\nNOTE 4:\tIn this release there is no other usage of storing the low access priority indicator in EPS/PDP Bearer contexts other than for the purpose to include it in charging records. Particularly, the low access priority indicator in EPS/PDP Bearer contexts is not used by the network to make overload control decisions.\nA network node may invoke one or more of the following mechanisms based on the indicators received in signalling from MSs or forwarded by other network nodes:\n-\tbased on the low access priority indicator in NAS request messages, bullets e, h, i, k and l as defined in clause 5.3.13.2; and/or\n-\tbased on the low access priority for RR(C) connection establishment, bullets b, c and n as defined in clause 5.3.13.2.\nAn MS shall invoke one or more of the following mechanisms based on the configuration and capabilities of the MS:\n-\twhen MS is configured with a long minimum periodic PLMN search time limit, MS invokes actions as described in bullet f in clause 5.3.13.2; and/or\n-\twhen MS is configured to perform Attach with IMSI at PLMN change, MS invokes actions as described in bullet g in clause 5.3.13.2; and/or\n-\twhen MS is configured to use the extended NMO I system information, MS invokes actions as described in bullet o in clause 5.3.13.2; and/or\n-\twhen MS is configured for low access priority, MS invokes actions as described in bullets b and h in clause 5.3.13.2; and/or\n-\twhen MS is configured for Extended Access Barring, MS invokes actions as defined in bullet d in clause 5.3.13.2; and/or\n-\twhen MS is configured for specific handling of the invalid (U)SIM state, the \"forbidden PLMN list\" and the \"forbidden PLMNs for GPRS service list\", MS invokes actions as defined in bullet p) in clause 5.3.13.2; and/or\n-\twhen MS is configured with a permission for overriding low access priority and Extended Access Barring, the MS invokes actions as described in bullets q and r in clause 5.3.13.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.13.2",
        "clause_5.10",
        "clause_9.2.4.2",
        "clause_9.2.4.1",
        "ts_24.368",
        "ts_44.018",
        "ts_44.060",
        "ts_25.331",
        "ts_22.011",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.5",
      "section_id": "5.3.13.5",
      "section_title": "Optimizing periodic RAU Signalling",
      "content": "To reduce network load from periodic RAU signalling and to increase the time until the MS detects a potential need for changing the RAT or PLMN (e.g. due to network problems) the longer values of the periodic RAU timer and Mobile Reachable timer shall be supported.\nA long periodic RAU/TAU timer value may be locally configured at SGSN or may be stored as part of the subscription data in HSS. During Attach and RAU procedures the SGSN allocates the periodic RAU timer value as periodic RAU timer to the UE based on VPLMN operator policy, low access priority indication from the MS, periodic RAU/TAU timer value requested by MS and subscription information received from the HSS.\nIf SGSN receives a subscribed periodic RAU/TAU timer value from the HSS it allocates the subscribed value to the MS as periodic RAU timer. A visited PLMN SGSN may use subscribed periodic RAU/TAU timer value, if available, as an indication to decide for allocating a locally configured periodic RAU/TAU timer value to the MS.\nIf no subscribed periodic RAU/TAU timer value is received from the HSS, the SGSN should:\n-\tif the periodic RAU/TAU timer value requested by MS is within the boundaries of the VPLMN operator policy, allocate the value requested by the MS;\n-\tif the periodic RAU/TAU timer value requested by MS is higher than allowed per the VPLMN operator policy, allocate the highest allowed value per the VPLMN operator policy;\n-\tif the periodic RAU/TAU timer value requested by MS is lower than allowed per the VPLMN operator policy, allocate the lowest allowed value per the VPLMN operator policy.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.13.6",
      "section_id": "5.3.13.6",
      "section_title": "Support of MSs configured for low access priority, Extended Access Barring and permission for override",
      "content": "An MS may be configured for low access priority and Extended Access Barring as defined in TS 22.011 [112]. This configuration is primarily for usage by applications or users that can tolerate being deferred when competing with other MSs for accessing network resources, e.g. during congestion situations. A subscriber can by agreement with its operator be required to use MSs that are configured for low access priority. The agreement may include a specific tariffing. CDRs show whether a PDN connections was activated for use with low access priority.\nAn MS that is configured for low access priority and Extended Access Barring may be also configured with a permission for an override of low access and Extended Access Barring priority restrictions. This configuration is primarily for usage by applications or users that most of the time can tolerate being deferred due to low access priority when competing with other MSs for accessing network resources, but occasionally the application or user needs access to the network also when the low access priority configuration would prevent getting access. For getting network access also during low priority access or Extended Access Barring restriction conditions, the user or application (upper layers in UE) may request the UE to initiate the activation of a PDN connection without low access priority.\nThe permission for overriding low access priority and Extended Access Barring restrictions by the application or user should be handled with care because as long as such a PDN connection without low access priority is active, the MS is not affected by any access restriction conditions that the network may set for access with low access priority. That is, after the activation of a PDN connection without low access priority, all further MM and RRC access requests of the UE are performed without low access priority as long as such a PDN connection is active.\nA subscriber can, by agreement with its operator, be required to use MSs that are configured with a permission for overriding low access priority and Extended Access Barring. As the 3GPP system cannot determine whether any overriding of access restrictions by such MSs is justified, the agreement can include a specific tariffing to avoid excessive usage of overriding the low access priority. This can for example be a specific tariffing for the amount of activations and/or the duration of PDN connections that are not with low access priority. CDRs show whether the MS activated the PDN connection with or without low access priority, but not necessarily the access priority the MS uses for the individual data transfer requests.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.011"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.7",
      "section_id": "5.3.13.7",
      "section_title": "High latency communication",
      "content": "Functions for High latency communication may be used to handle mobile terminated (MT) communication with UEs being unreachable while using power saving functions e.g. MS Power Saving Mode (see clause 5.3.20) or extended idle mode DRX depending on operator configuration. \"High latency\" refers to the initial response time before normal exchange of packets is established. That is, the time it takes before a UE has woken up from its power saving state and responded to the initial downlink packet(s). The feature is described in TS 23.682 [119].\nThe High latency communication includes invoking extended buffering of MT data at the Gn/Gp-SGSN or at the Serving GW when the UE is in a power saving state and not reachable. The handling is specified in the Network Initiated Service Request Procedure using Gn/Gp, clause 6.12.2. Establishing the user plane for delivering the buffered data when the UE contacts the SGSN by signalling shall be done in the Routing Area Update procedures. The SGSN uses its parameter DL Data Buffer Expiration Time in the MM context information to remember if there is buffered DL data to be delivered when the UE becomes reachable. When set, the DL Data Buffer Expiration Time shall be cleared at any user plane setup to the RAN, i.e. buffered DL data can been delivered. At RAU procedures with SGSN change, it is indicated in the context response to the new SGSN that buffered DL data is waiting and hence the user plane needs to be established for delivery of the buffer DL data. At RAU procedures the buffered DL data is forwarded to the new Gn/Gp-SGSN or new Serving GW when needed.\nThe High latency communication also includes sending event notifications to application servers that have requested \"UE Reachability\" or \"Availability after DDN failure\" monitoring events. If the notifying node is not a Gn/Gp-SGSN, event notifications are sent when a UE becomes reachable, for example as part of the RAU procedures and the MS/UE Initiated Service Request Procedures (see also corresponding procedures in TS 23.401 [89]).\nWhen \"UE Reachability\" moniorting is requested for UE's that are using extended idle mode DRX, an event notification is sent to the application server when the UE is about to become reachable for paging.\nIf the SGSN is aware that some signalling or data is pending in the network for an UE, e.g. whether the UE has extended idle mode DRX or PSM enabled, the SGSN may include a Pending Data indication in the next RANAP message towards the UTRAN. If the UTRAN receives this indication, it may take this information into account when determining user inactivity. At inter-RAN node handovers, if some signalling or data are still pending, the target SGSN may send a Pending Data indication to the target UTRAN node.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.20",
        "clause_6.12.2",
        "ts_23.682",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.8.1",
      "section_id": "5.3.13.8.1",
      "section_title": "General",
      "content": "The support of Non-IP data is part of the CIoT EPS optimisations. A PDP Type \"Non-IP\" is used for Non-IP data. The Non-IP data delivery to SCS/AS is accomplished by one of two mechanisms:\n-\tDelivery using a Point-to-Point (PtP) SGi tunnel as defined in TS 23.401 [89].\n-\tDelivery using SCEF as defined in TS 23.682 [119].\nNon-IP data in-sequence delivery cannot be guaranteed and data PDUs can be lost, i.e. delivery cannot be guaranteed.\nSecondary PDP Context Activation for PDP Contexts of PDP Type Non-IP is not supported.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.8.2",
      "section_id": "5.3.13.8.2",
      "section_title": "PDP Context Activation Procedure",
      "content": "The MS indicates in the Activate PDP Context Request that PDP type Non-IP shall be used. If the SGSN establishes a PDP contexct of PDP type Non-IP, header compression shall not be used for the PDP context.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.3.13.8.3",
      "section_id": "5.3.13.8.3",
      "section_title": "Delivery mechanism",
      "content": "5.3.13.8.3.1\tGeneral\nAt each PDP Context Request, the SGSN decides which delivery mechanism (SCEF based delivery or Gi/SGi based delivery) is used for delivering the Non-IP data between RAN and AS. An indication associated with the used APN determines if SCEF based delivery or Gi/SGi based delivery shall be used.\n5.3.13.8.3.2\tSCEF based delivery\nWhen the SGSN decides to use SCEF based delivery mechanism for Non-IP data, a T6b connection is established towards the selected SCEF. Such a connection is also known as an \"SCEF Connection\". The APN used for SCEF based delivery is an FQDN, which either resolves to an SCEF hostname or to an SCEF IP addresss.\nThe support of Non-IP data via the SCEF is further defined in TS 23.682 [119].\n5.3.13.8.3.3\tGi/SGi based delivery\nWhen support of Non-IP data is provided at the Gi/SGi interface, different point-to-point tunneling techniques may be used. Point-to-point tunneling by UDP/IP encapsulation can be used as described in TS 23.401 [89].\nSupport for the Gi/SGi based delivery of Non-IP data can be used by any MS.\nThe GGSN/PDN-GW decides at PDP Context establishment based on pre-configuration which point-to-point tunneling technique is used for the Gi/SGi based delivery between the GGSN/PDN-GW and the AS as described in TS 23.401 [89].\nNOTE:\tThe pre-configuration can be done in the GGSN/PDN-GW per APN or based on other criterion such as SLA between operator and 3rd party application service provider, etc.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.682",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.9",
      "section_id": "5.3.13.9",
      "section_title": "Introduction of CIoT GSM Optimisation",
      "content": "Cellular Internet of Things GSM Optimisation (CIoT GSM Optimization) provides support of:\n-\tNon-IP data (see clause 5.3.13.8);\n-\tNon-IP data delivery using SCEF (see TS 23.682 [119]);\n-\tAPN Rate Control (see clause 15.2.3.2).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.13.8",
        "clause_15.2.3.2",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.13.10",
      "section_id": "5.3.13.10",
      "section_title": "Restriction of use of Enhanced Coverage",
      "content": "Support of MSs in Enhanced Coverage is specified in TS 43.064 [11].\nThe usage of Enhanced Coverage may require use of extensive resources (e.g. radio and signalling resources) from the network. This feature enables the operator to prevent specific subscribers from using Enhanced Coverage.\nThe MS indicates its capability of support for restriction of use of Enhanced Coverage for the RAT it is camping on in the Attach and RAU procedure to the SGSN. SGSN receives Enhanced Coverage Restricted parameter from the HLR. This parameter is kept as part of the subscription data in the HLR and specifies per PLMN whether the enhanced coverage functionality is restricted or not for the MS. For roaming MSs, if HLR doesn't provide any Enhanced Coverage Restricted parameter or the provided Enhanced Coverage Restricted parameter is in conflict with the roaming agreement, the SGSN uses default Enhanced Coverage Restricted parameter locally configured in the VPLMN based on the roaming agreement with the subscriber's HPLMN. The UE shall assume that restriction for use of Enhanced Coverage is same in the equivalent PLMNs. If the MS includes the support for restriction of use of Enhanced Coverage, SGSN sends Enhanced Coverage Restricted parameter to the MS in Attach/RAU Accept message. The MS shall use the value of Enhanced Coverage Restricted parameter to determine if enhanced coverage feature should be used or not.\nThe MS assumes Enhanced Coverage is allowed unless explicitly restricted by the network for a PLMN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.14",
      "section_id": "5.3.14",
      "section_title": "Local IP Access (LIPA) function",
      "content": "The LIPA function enables an IP capable UE connected via a HNB to access other IP capable entities in the same residential/enterprise IP network without the user plane traversing the mobile operator's network except HNB subsystem.\nLIPA is available for UTRAN access only.\nFor this Release of the specification there is no support for secondary PDP context on the PDN connection used for Local IP Access.The PDN GW/GGSN shall reject any MS initiated Secondary PDP Context Activation Procedure or any PDP Context Modification Procedure that is for the LIPA PDN Connection.\nThe LIPA function specified in TS 23.401 [89] clause 4.3.16 is applicable, with the SGSN node providing the functions specified for the MME and the HNB providing the functions specified for the HeNB.\nThe HNB supporting the LIPA function includes the Local GW address to the SGSN in every INITIAL UE MESSAGE and every UTRAN Originated DIRECT TRANSFER control message as specified in TS 25.413 [56b].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_4.3.16",
        "ts_23.401",
        "ts_25.413"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.15",
      "section_id": "5.3.15",
      "section_title": "Voice domain preference and UE's usage setting",
      "content": "If the UE supports CS fallback, or the UE is configured to support IMS voice, or both, and the UE is E-UTRAN capable, the UE shall include the information element \"Voice domain preference and UE's usage setting\" in Attach Request and Routing Area Update Request messages. The purpose of this information element is to signal to the network the UE's usage setting and voice domain preference for E-UTRAN. The UE's usage setting indicates whether the UE behaves in a voice centric or data centric way (as defined in TS 23.221 [80]). The voice domain preference for E-UTRAN indicates whether the UE is configured as CS Voice only, CS Voice preferred and IMS PS Voice as secondary, IMS PS Voice preferred and CS Voice as secondary, or IMS PS Voice only (as defined in TS 23.221 [80]).\nNOTE:\tDepending on operator's configuration, the UE's usage setting and voice domain preference for E-UTRAN can be used by the network to choose the RFSP Index in use (see clause 5.3.5). As an example, this enables the enforcement of selective idle mode camping over GERAN/UTRAN for voice centric UEs relying on CS Fallback for voice support in E-UTRAN.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.3.5",
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.13.16",
      "section_id": "5.13.16",
      "section_title": "Support for Application / Service Layer Rate Adaptation",
      "content": "The UTRAN and the UE support of Explicit Congestion Notification (ECN) according to the RFC 3168 [115]) are described in TS 23.401 [89], TS 25.401 [53] and TS 26.114 [116].\nIf the UTRAN cannot sustain the GBR of an active GBR bearer the RNC should initiate a RAB Release according to clause 12.7.2. In addition, in case of UTRAN with GPRS (Gn/Gp SGSN with GGSN) the deactivation of the bearer is handled differently. The GPRS supports RNC initiated \"PDP Context modification\" where bearers are preserved in the core network for certain cases as described in clause 9.2.3.5 for architecture variants using Gn/Gp based interaction with GGSN.",
      "chunk_type": "general",
      "cross_references": [
        "clause_12.7.2",
        "clause_9.2.3.5",
        "ts_23.401",
        "ts_25.401",
        "ts_26.114"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.17",
      "section_id": "5.3.17",
      "section_title": "Support for subscriptions without MSISDN",
      "content": "GPRS shall allow for operation whereby a MSISDN is not allocated as part of the subscription data. For example this can be useful for devices supporting MTC applications, see TS 23.682 [119].\nThe following applies for a UE that operates without an MSISDN:\na)\tPresence of the MSISDN in the HLR/HSS subscription is optional.\nb)\tThe presence of the MSISDN in the SGSN MM context, PDP contexts and GGSN PDP contexts is dictated by its storage in HLR/HSS.\nc)\tGTP support for MSISDN optionality whereby MSISDN is included only if available.\nd)\tWhen the MSISDN is not available for CDR generation in the PS domain, the IMSI shall be used for CDR generation purposes.\ne)\tDelivery of SMS destined to an MS without MSISDN.\nThe following services have unresolved MSISDN dependencies and are not supported at operation without MSISDN:\na)\tCAMEL Services.\nNOTE:\tThere may be additional problems with the following services: I-WLAN, SMS, IMS, LCS, MNP, Presence Services, MBMS, GUP, Charging, Remote Device Management and Over-the-Air configuration.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.18",
      "section_id": "5.3.18",
      "section_title": "PS-only Service Provision and PS domain SMS support",
      "content": "The HSS allows an operator to configure a subscription, which is limited to only PS services and SMS services. This limitation is indicated in the PS subscription data as \"PS and SMS only\". With this subscription the SMS service can either be provided via the PS domain or via the CS domain.\nThe support of SMS services via SGSN is a network deployment option and may depend also on roaming agreements. Therefore a subscription profile intended for PS-only service provision is either a subscription profile that is PS-only without any CS subscriber data, or it is a subscription profile for PS domain services and allowing also for SMS services via CS domain by CS subscriber data. The latter option of configuring a subscription is for providing a UE with PS domain and SMS services in situations when serving node or the visited network does not support SMS via SGSN.\nIf the subscription profile does not contain any CS subscriber data the HSS indicates this by the Network Access Mode information in the subscriber data provided to the SGSN. This indicates to the SGSN that the SGSN shall not perform any combined MM procedures for the UE and shall not establish a Gs association.\nNOTE 1:\tAn operator should not configure a subscription profile without any CS subscription data when the UE/user shall be able to receive SMS services from an MME that uses SGs functionality for providing SMS services. It depends on (visited) network deployment or configuration whether the MME provides SMS services via \"SMS in MME\" or via SGs functionality. Further it should be noted that using PS-only service provision requires that the SMS-GMSC(s) deliver mobile terminating SMS via SGSN, which depends on network deployment or configuration (including a correct setting of the HSS \"Transfer of SMS option\" when the SMS-GMSC does not support two serving nodes addresses). For PS-only service provision it is therefore recommended that a home PLMN deploys an SMS-router and routes all terminating SMSs to its subscribers via the SMS-router. Especially when SMS-GMSCs from PLMNs other than the hPLMN are allowed to send mobile terminating SMS directly to the UE's serving CN node, but it cannot be ensured that all these SMS-GMSCs deliver SMS via SGSN.\nThe SGSN indicates that it offers SMS services via the PS domain to the HSS by an indication \"SMS in SGSN offered\" in the signalling with the HSS during the Attach/RAU procedure. In addition the SGSN may indicate a \"Registration for SMS Request\" according to the table below. The SGSN also forwards the capability indicated by the UE as an \"SMS-only\" indication to the HSS. When the subscription information indicates \"PS and SMS only\" the HSS shall respond to queries from SMS-GMSCs and SMS routers so that MT SMS gets routed to serving nodes in the PS domain when SMS via the PS domain are offered by these serving nodes.\nTable 5.3.18-1: Registration For SMS Request values\nSMS in SGSN Required\n-\tThe SGSN can be configured to use this value when the UE indicates \"SMS only\" or when known that the subscription is \"PS and SMS only\" for asking the HSS to cancel any registered MSC.\nSMS in SGSN Not Preferred\n-\tThe SGSN can be configured to use this value for asking the HSS to not register the SGSN for SMS and to not cancel a registered MSC. This value can be requested regardless whether the UE indicates \"SMS only\" or the subscription is \"PS and SMS only\".\nNo Preference for SMS in SGSN\n-\tThe SGSN has no preference about cancelling or keeping a registered MSC.\nNOTE 2:\tIn earlier Releases, CS is considered as primary domain and PS optional and related UEs may try to always get CS registration. The SGSN should not request \"SMS in SGSN Required\" for UEs that assume a need for being always also CS attached when PS attached.\nIf the SGSN indicates \"SMS in SGSN offered\" and the PS subscriber data allow for SMS services and the home PLMN supports SMS services via SGSN, the HSS indicates \"SMS in SGSN Support\" in the subscriber data provided to the SGSN, unless the SGSN indicated \"SMS in SGSN not Preferred\" and the subscription allows for SMS via CS domain.\nThe HSS may be configured per visited PLMN whether SMS services via SGSN are supported and wanted, e.g. based on roaming agreement, for the specific visited PLMN. The HSS provision of CS subscriber data to any serving node requesting CS subscriber data follows regular procedures and is not affected.\nWhen the HSS registers the SGSN for terminating SMS and the HSS has an old serving MSC registered, the HSS cancels the serving MSC for a UE if::\n-\tThe SGSN indicates no parameter \"Registration for SMS Request\" and the MS indicated \"SMS-only\"; or\n-\tThe SGSN indicated \"SMS in SGSN Required\" and the MS indicated \"SMS-only\"; or\n-\tThe SGSN indicated \"SMS in SGSN Required\" and the subscription is \"PS and SMS only\"; or\n-\tThe SGSN indicated \"No Preference for SMS in SGSN\" and the MS indicated \"SMS-only\".\nA CS/PS enabled UE that needs only PS domain services and SMS services over NAS indicates this capability as \"SMS-only\" to the SGSN during combined GPRS / IMSI attach or combined RA/LA update procedures, i.e. the included CS registration is only requested for obtaining SMS services over NAS. Based on that UE provided information, based on preferences configured in SGSN and when the HSS provided subscription information indicates \"SMS in SGSN Support\", the SGSN then decides not to establish an association with an MSC when requested by the UE by combined GPRS / IMSI attach or combined RA/LA update procedures.\nWhen the subscription information indicates \"SMS in SGSN Support\", the SGSN signals to the UE \"SMS-Supported\" in every Attach/RAU procedures to inform the UE that it can obtain SMS services via PS domain NAS from the SGSN. Thereby also UEs with CS services other than SMS are informed that SMS services via PS domain NAS can be obtained from the SGSN. The subscription information \"SMS in SGSN Support\" indicates to the SGSN that the UE's home PLMN is able and willing to provide SMS services via SGSN.\nA CS/PS enabled UE that needs only PS domain services and SMS services over NAS and that receives indications in Attach/RAU procedures that it can obtain SMS services via SGSN should not perform an IMSI Attach or LAU procedures with the CS domain. That UE shall however perform combined RAU/LAU procedures when required by the network operation mode (NMO) for being informed when the PS domain provided services change.\nIf SGSN provide SMS services via PS domain for a CS/PS enabled UE, the SGSN may activate ISR for this UE by indicating ISR Activated in Combined RAU Accept message.",
      "chunk_type": "general",
      "cross_references": [
        "table_5.3.18-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.19",
      "section_id": "5.3.19",
      "section_title": "Access and Mobility Restrictions",
      "content": "S4-SGSNs and Gn/Gp-SGSNs determine mobility and access restrictions with LA granularity. Any time the UE performs a GPRS Attach or RAU the SGSN checks for access restrictions (see TS 23.221 [80] and TS 23.008 [79]).\nIf roaming restriction to E-UTRAN access needs to be enforced, a SGSN that is connected to RNCs or BSCs that may handover or invoke release with redirection to E-UTRAN is configured with a list of HPLMN IDs that are permitted to access E‑UTRAN unless restricted by the UE individual access restriction information received from HLR/HSS. Also, the SGSN shall set the E-UTRAN Service Handover IE (in Iu mode) or the Service UTRAN CCO (in A/Gb mode) to an appropriate value to inform the RNC or BSC respectively about connected-mode mobility restriction to E-UTRAN.\nThe SGSN shall also determine a RAT/Frequency Selection Priority that minimizes the risk of cell reselection of RATs that have access restrictions for a UE and provides the RAT/Frequency Selection Priority to the RNC or BSC, see clause 5.3.5.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.5.2",
        "ts_23.221",
        "ts_23.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.20",
      "section_id": "5.3.20",
      "section_title": "MS Power Saving Mode",
      "content": "A MS may adopt a PSM that is described in TS 23.682 [119]. If an MS is capable of adopting a PSM and wants to use the PSM it shall request an Active Time value and may request a Periodic TAU/RAU Timer value during every Attach and RAU procedures, which are handled as described in TS 23.682 [119]. The MS shall not request a Periodic TAU/RAU Timer value if it is not requesting an Active Time value. The network shall not allocate an Active Time value if the MS has not requested it.\nPSM has no support in the CS domain on the network side, but when PSM is activated the MS shall apply an Active Time regardless if the RR connection was used for accessing the PS or the CS domain.\nNOTE 1:\tWhen the PSM is activated the MS might not be available for paging of Mobile Terminated CS services even though the MS is registered in the CS domain.\nNOTE 2:\tThe Attach and RAU procedures of this specification are not showing the details of the Periodic RAU Time and Active Time negotiation, i.e. are not showing the related IEs.\nIf the network has allocated an Active Time value, the MS and the SGSN starts the Active Timer (see clause 6.2.3) with the Active Time value allocated by the network when transitioning from READY/PMM-CONNECTED to STANDBY/PMM-IDLE state. The MS shall stop the Active Timer, if running, when a transition to READY/PMM-CONNECTED state is made. When the Active timer expires, the MS deactivates its Access Stratum functions and enters PSM. In PSM, due to deactivation of Access Stratum functions if no RR connection exists, the MS stops all idle mode procedures, but continues to run any NAS timers that may apply, e.g. periodic RAU timer. The MS shall resume Access Stratum functions and idle mode procedures before the periodic RAU timer expires for performing the periodic RAU procedure as applicable. The MS may resume idle mode procedures and AS functions any time while in PSM, e.g. for mobile originated communications. Any timers and conditions that remain valid during power-off, e.g. for NAS-level back-off, apply in the same way during PSM.\nWhen the Active Timer expires for the MS, the SGSN knows that the MS entered PSM and is not available for paging. The SGSN handles availability for paging as detailed in clause 6.2.3.\nOn MS side the PSM complies with some substates of GMM-REGISTERED, as specified in TS 24.008 [13]. The SGSN considers the MS to be GMM-REGISTERED, but not reachable. The MS's Access Stratum functions are considered as deactivated during PSM regardless if the MS is attached to the PS or PS and CS domain and therefore limiting the supported procedures in the respective domains.\nFor mobile terminated data while an MS is in PSM, the functions for High latency communication may be used as described in clause 5.3.13.7.\nWhen the MS has bearers for emergency services, the MS shall not apply PSM.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.2.3",
        "clause_5.3.13.7",
        "ts_23.682",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.21",
      "section_id": "5.3.21",
      "section_title": "Access network selection and traffic steering based on RAN-assisted WLAN interworking",
      "content": "As described in TS 36.300 [122], TS 36.331 [37], TS 25.304 [51b] and TS 25.331 [52], UTRAN and E-UTRAN may provide RAN assistance parameters to the UE via RRC signalling. TS 23.401 [89] describes how the network provides to the MS the WLAN offloading permissions for the UE and PDP context in NAS signalling.\nFor traffic steering decisions using procedures defined in TS 25.304 [51b] the S4-SGSN may provide a WLAN offloadability indication of a PDN Connection to the UE. The S4-SGSN may provide a per-RAT indication for the PDN connection, e.g. if the indication is different for UTRAN and for E-UTRAN. If the S4-SGSN provides a single indication, the UE shall apply such indication both to E-UTRAN and UTRAN.\nThe S4-SGSN may provide an updated WLAN offloadability indication of a PDN Connection to the UE. This may be initiated by HSS as part of the Insert Subscriber Data procedure as described in clause 6.11.1.1. It can also be initiated by S4-SGSN by invoking step 6 and step 7 of a PDP Context Modification Procedure as described in clause 9.2.3.1, Figure 70b when the UE is in Iu mode or by adding the WLAN offloadability indication to a session management NAS message sent to the UE as part of an existing procedure. The S4-SGSN shall not trigger signaling to a PMM-IDLE UE solely for the purpose of updating the WLAN offloadability indication.\nThe indication of whether a PDN connection is offloadable or not offloadable should be passed from the source to the target serving node in mobility management procedures from a S4-SGSN to a MME/S4-SGSN. This allows the target S4-SGSN/MME to learn the indication previously provided to the UE and to decide the need for updating the indication.\nWhen the MS receives, as described in TS 23.401 [89] the indication of whether a PDP context is offloadable or not, the MS stores the indication. Upon performing inter-RAT mobility the MS shall not reset the stored indication unless it receives a new indication from the network. If the UE is in A/Gb mode, the UE does not use the indication received from S4-SGSN or previously stored for as long as it is in A/Gb mode.\nTraffic steering decisions using procedures defined in TS 25.304 [51b] are not applicable to non-seamless WLAN offload (see TS 23.402 [90] for the definition of non-seamless WLAN offload).",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.11.1.1",
        "clause_9.2.3.1",
        "figure_70",
        "ts_36.300",
        "ts_36.331",
        "ts_25.304",
        "ts_25.331",
        "ts_23.401",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.22",
      "section_id": "5.3.22",
      "section_title": "User plane congestion management function",
      "content": "See clause 4.3.24 of TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_4.3.24",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.23.1",
      "section_id": "5.3.23.1",
      "section_title": "General",
      "content": "This feature enables an operator to deploy multiple core networks within a PLMN with each core network consisting of one or multiple CN nodes. Overview of UE non-assisted DCN selection feature is provided in clause 4.3.25.1 and UE assisted DCN selection feature is provided in clause 4.3.25.1a of TS 23.401 [89]. Specific impacts to supporting DCNs for UTRAN and GERAN accesses are captured in this specification and in TS 23.236 [73].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.3.25.1",
        "ts_23.401_clause_4.3.25.1",
        "ts_23.401",
        "ts_23.236"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.24",
      "section_id": "5.3.24",
      "section_title": "Support for Monitoring Events",
      "content": "The Monitoring Events feature is intended for monitoring of specific events in 3GPP system and making such monitoring event information available via the Service Capability Exposure Function (SCEF). The architecture and related functions to support Monitoring Events for S4-SGSN are defined in TS 23.682 [119]. Monitoring Events feature for Gn/Gp SGSN isn't supported.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.3.25.1",
      "section_id": "5.3.25.1",
      "section_title": "General",
      "content": "This clause provides an overview about feature for 3GPP PS Data Off according to service requirements described in TS 22.011 [112].\n3GPP PS Data Off feature specified in TS 23.401 [89] is applicable, with the SGSN node providing the functions specified for the MME and the GGSN node providing the functions of the PGW.\nThe MSs are configured with up to two lists of 3GPP PS Data Off Exempt Services and the list(s) are provided to the MSs by HPLMN via Device Management or UICC provisioning. When the MS is configured with two lists, one list is valid for the MSs camping in the home PLMN and the other list is valid for any VPLMN the MS is roaming in. If the MS is configured only a single list, without an indication to which PLMNs the list is applicable, then this list is valid for the home PLMN and any PLMN the MS is roaming in.\nWhen the MS requests PDP Context Activation, the MS shall send its current 3GPP PS Data Off status (i.e., activated, inactivate) in PCO to the GGSN/PGW as described in clause 9.2.2.\nIf 3GPP PS Data Off status is activated, the MS prevents the sending of uplink IP packets and non-IP data except those related to 3GPP PS Data Off Exempt Service as defined in TS 23.221 [80], based on the pre-configured list of 3GPP Data Off Exempt Services.\nFor those PGWs/GGSNs that indicated support for the 3GPP PS Data Off feature during PDP Context Activation procedure, the MS shall report a change of its 3GPP PS Data Off status in PCO immediately by using MS-initiated PDP Context Modification procedure to those PGWs/GGSNs as described in clause 9.2.3.3, this also applies to the scenario of inter-RAT mobility procedure to GERAN/UTRAN and also to scenarios where the 3GPP PS Data Off status is changed when the session management back-off timer is running as specified in clause 5.3.6. If the MS has not received any 3GPP PS Data Off Support Indication during PDP Context Activation procedure, it shall not report any change of its 3GPP PS Data Off Status for this PDN connection.\nThe MS discovers whether a PGW/GGSN supports 3GPP PS Data Off feature during PDP Context Activation procedure via the presence of the 3GPP PS Data Off Support Indication in the Activate PDP Context Accept message.\nNOTE 1:\tWhen the MS detects that the PGW/GGSN does not support 3GPP PS Data Off feature, how the MS reacts to non-exempt MT requests from the network is implementation dependent.\nThe additional behaviour of the PGW/GGSN for 3GPP PS Data Off is controlled by local configuration or policy from the PCRF as defined in TS 23.203 [88].\nNOTE 2:\tFor the PDN connection used for IMS services, the 3GPP Data Off Exempt Services are enforced in the IMS domain as specified TS 23.228 [123]. Policies configured in the PGW/GGSN/PCRF need to ensure those services are always allowed when the 3GPP PS Data Off status of the MS is set to \"activated\".",
      "chunk_type": "definition",
      "cross_references": [
        "clause_9.2.2",
        "clause_9.2.3.3",
        "clause_5.3.6",
        "ts_22.011",
        "ts_23.401",
        "ts_23.221",
        "ts_23.203",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.0",
      "section_id": "5.4.0",
      "section_title": "General",
      "content": "When based on Gn/Gp interfaces, the GPRS Core Network functionality is logically implemented on two network nodes, the Serving GPRS Support Node and the Gateway GPRS Support Node. When based on S4/S5/S8 interfaces, the GPRS Core Network functionality is logically implemented on three network nodes, the Serving GPRS Support Node, the Serving Gateway and the PDN Gateway. No inference should be drawn about the physical configuration on an interface from figure 2 or figure 2a.\nFigure 2: Overview of the GPRS Logical Architecture when based on Gn/Gp interfaces\nNOTE:\tBetween S4-SGSN and HSS, the interface is Diameter based (S6d). However, to assist with the SGSN transition the use of MAP based Gr between the S4-SGSN and the HSS is not precluded.\nFigure 2a: Overview of the GPRS Logical Architecture when based on S4/S5/S8 interfaces",
      "chunk_type": "definition",
      "cross_references": [
        "figure_2"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.1.1",
      "section_id": "5.4.1.1",
      "section_title": "General",
      "content": "A GPRS Support Node (GSN) contains functionality required to support GPRS functionality for GERAN and/or UTRAN. In one PLMN, there may be more than one GSN.\nThe SGSN and GGSN functionalities may be combined in the same physical node, or they may reside in different physical nodes. The SGSN and the GGSN contain IP or other (operator's selection, e.g. ATM-SVC) routeing functionality, and they may be interconnected with IP routers.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.4.1.2",
      "section_id": "5.4.1.2",
      "section_title": "Gateway GPRS Support Node",
      "content": "The Gateway GPRS Support Node (GGSN) is the node that is accessed by the packet data network due to evaluation of the PDP address. It contains routeing information for PS-attached users. The routeing information is used to tunnel N‑PDUs to the MS's current point of attachment, i.e. the Serving GPRS Support Node. The GGSN may request location information from the HLR via the optional Gc interface. The GGSN is the first point of PDN interconnection with a PLMN supporting GPRS (i.e. the Gi reference point is supported by the GGSN). GGSN functionality is common for all types of RANs.\nFor emergency bearer service, the GGSN shall block any traffic that is not from/to addresses of network entities (e.g. P‑CSCF) providing emergency service. The list of allowed addresses may be configured by the operator.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.4.1.3",
      "section_id": "5.4.1.3",
      "section_title": "Serving GPRS Support Node",
      "content": "The Serving GPRS Support Node (SGSN) is the node that is serving the MS. The SGSN supports GPRS for A/Gb mode (i.e. the Gb interface is supported by the SGSN) and/or Iu-mode (i.e. the Iu interface is supported by the SGSN). At PS attach, the SGSN establishes a mobility management context containing information pertaining to e.g. mobility and security for the MS. At PDP Context Activation, the SGSN establishes a PDP context, to be used for routeing purposes, with the GGSN that the subscriber will be using.\nIn Iu mode, the SGSN and RNC may be interconnected with one or more IP routers.\nIn Gn/Gp mode and when the SGSN and the GGSN are in different PLMNs, they are interconnected via the Gp interface. The Gp interface provides the functionality of the Gn interface, plus security functionality required for inter-PLMN communication. The security functionality is based on mutual agreements between operators.\nIn Gn/Gp mode, the SGSN interworks signalling on the Gn/Gp interface with Iu/Gb interface signalling. In S4 mode, the SGSN interworks signalling on the S4 interface with Iu/Gb interface signalling. One SGSN may have some MSs using Gn/Gp mode and other MSs using S4 mode.\nThe SGSN may send location information to the MSC/VLR via the optional Gs interface. The SGSN may receive paging requests from the MSC/VLR via the Gs interface.\nThe SGSN interfaces with the GSM‑SCF for optional CAMEL control using Ge reference point. Depending on the result from the CAMEL interaction, the session and packet data transfer may proceed normally. Otherwise, interaction with the GSM‑SCF continues as described in TS 23.078 [8b]. Only the GSM‑SCF interworking points are indicated in the signalling procedures in this specification.\nIf there is already an emergency bearer activated, the SGSN shall reject any additional PDP context activation request by the MS for emergency services.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.1.4",
      "section_id": "5.4.1.4",
      "section_title": "Serving Gateway",
      "content": "The functionality of the Serving Gateway is defined in TS 23.401 [89] with the following additions and exceptions:\nThe Serving Gateway:\n‑\tterminates the user plane interface towards the UTRAN when the Direct Tunnel feature is in use;\n‑\tis the local Mobility Anchor point for SRNS relocation when the Direct Tunnel feature is in use;\n‑\tis the local Mobility Anchor for inter-SGSN routeing area update;\n‑\tif E‑UTRAN is not in use in that PLMN, need not support functionality related to inter eNodeB mobility.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.1.5",
      "section_id": "5.4.1.5",
      "section_title": "PDN Gateway",
      "content": "The functionality of the PDN Gateway is defined in TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.2",
      "section_id": "5.4.2",
      "section_title": "Packet Domain PLMN Backbone Networks",
      "content": "There are two kinds of backbone networks. These are called:\n-\tintra-PLMN backbone network; and\n-\tinter-PLMN backbone network.\nThe intra-PLMN backbone network is the IP network interconnecting SGSNs, GGSNs, Serving GWs and PDN GWs within the same PLMN and it interconnects GGSNs and Serving GWs with RNCs if Direct Tunnel functionality is supported.\nThe inter-PLMN backbone network is the IP network interconnecting SGSNs, GGSNs, Serving GWs and PDN GWs with intra-PLMN backbone networks in different PLMNs.\nFigure 3: Intra- and Inter-PLMN Backbone Networks when based on Gn/Gp interfaces\nFigure 3a: Intra- and Inter-PLMN Backbone Networks when based on S5/S8 interfaces\nEvery intra-PLMN backbone network is a private IP network intended for GPRS packet domain data and signalling only. A private IP network is an IP network to which some access control mechanism is applied in order to achieve a required level of security. Two intra-PLMN backbone networks are connected via the Gp interface using Border Gateways (BGs) and an inter-PLMN backbone network. The inter-PLMN backbone network is selected by a roaming agreement that includes the BG security functionality. The BG is not defined within the scope of GPRS. The inter-PLMN backbone can be a Packet Data Network, e.g. the public Internet or a leased line.",
      "chunk_type": "general",
      "cross_references": [
        "figure_3"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.3",
      "section_id": "5.4.3",
      "section_title": "HLR/HSS",
      "content": "The HLR/HSS contains GPRS and EPS subscription data and routeing information. The HLR/HSS is accessible from the Gn/Gp SGSN via the Gr interface, from the S4-SGSN via the S6d interface and from the GGSN via the Gc interface. For roaming MSs, the HLR/HSS may be in a different PLMN than the current SGSN.\nNOTE:\tAs specified in clause 6.4, \"between S4-SGSN and HSS, the interface is Diameter based (S6d); however, to assist with SGSN transition the use of MAP based Gr between the S4-SGSN and HSS is not precluded\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.4",
      "section_id": "5.4.4",
      "section_title": "SMS‑GMSC and SMS‑IWMSC",
      "content": "The SMS‑GMSC and SMS‑IWMSC are connected to the SGSN via the Gd or the Gdd interface to enable the SGSN to support SMS.\nNOTE:\tThe interface between the SGSN and the SMS GMSC/SMS IWMSC when MAP-based is referred to as Gd and when Diameter-based is referred to as Gdd. Gd and Gdd interfaces are functionally equivalent.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.4.5",
      "section_id": "5.4.5",
      "section_title": "Mobile Stations (A/Gb mode)",
      "content": "An A/Gb mode MS operates in one of three modes of operation. The mode of operation depends on the network domains that the MS is attached to, i.e. only PS or both PS and CS domain, and upon the MS's capabilities to operate PS and CS domain services simultaneously.\n-\tClass‑A mode of operation: The MS is attached to both PS and CS domain, and the MS supports simultaneous operation of PS and CS domain services.\n-\tClass‑B mode of operation: The MS is attached to both PS and CS domain, but the MS can only operate one set of services, PS or CS services, at a time.\n-\tClass‑C mode of operation: The MS is exclusively attached to the PS domain.\nThe three modes of operation are defined in TS 22.060 [3].\nNOTE:\tOther technical specifications may refer to the MS modes of operation as GPRS class‑A MS, GPRS class‑B MS, and GPRS class‑C MS.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.6",
      "section_id": "5.4.6",
      "section_title": "Mobile Stations (Iu mode)",
      "content": "An Iu mode MS operates in one of three modes of operation. However, these operation modes are different from the ones of an A/Gb mode MS due to the capabilities of an Iu mode RAN to multiplex CS and PS connections, due to paging co-ordination for PS services and CS services that are offered by the CN or the UTRAN/GERAN-Iu, etc. The different Iu mode MS operation modes are defined as follows:\n-\tCS/PS mode of operation: The MS is attached to both the PS domain and CS domain, and the MS is capable of simultaneously signalling with the PS and CS core network domains. This mode of operation is comparable to the class‑A mode of operation defined for A/Gb mode. The ability to operate CS and PS services simultaneously depends on the MS capabilities (for example an A/Gb mode MS of class B, which can not operate simultaneously CS and PS services, may have the same limitations when changing to Iu mode and CS/PS mode of operation).\n-\tPS mode of operation: The MS is attached to the PS domain only and may only operate services of the PS domain. However, this does not prevent CS-like services to be offered over the PS domain (e.g. VoIP). This mode of operation is equivalent to the A/Gb mode GPRS class‑C mode of operation.\n-\tCS mode of operation: The MS is attached to the CS domain only and may only operate services of the CS domain. However, this does not prevent PS-like service to be offered over the CS domain. The CS mode of operation is outside the scope of this specification.\nAll combinations of different operation modes as described for A/Gb mode and Iu mode MSs shall be allowed for GERAN and UTRAN multisystem terminals.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.4.7",
      "section_id": "5.4.7",
      "section_title": "Charging Gateway Functionality",
      "content": "The Charging Gateway Functionality (CGF) described in TS 32.251 [70] is a function of the Offline Charging System (OFCS) which is described in TS 32.240 [94].",
      "chunk_type": "general",
      "cross_references": [
        "ts_32.251",
        "ts_32.240"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.8",
      "section_id": "5.4.8",
      "section_title": "PCRF",
      "content": "The PCRF is the policy and charging control element. PCRF functions are described in more detail in TS 23.203 [88].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.9",
      "section_id": "5.4.9",
      "section_title": "HNB subsystem",
      "content": "A HNB subsystem consists of a HNB, a HNB GW and optionally a Local GW.\nThe Local IP Access function and SIPTO at the Local Network with L-GW function collocated with HNB is achieved using a Local GW (L-GW) co-located with the HNB.\nFigure 5.4.9-1 and figure 5.4.9-2 illustrate LIPA and SIPTO at the Local Network with L-GW function collocated with HNB for HNB connected to respectively EPC and Gn-based SGSN.\nFigure 5.4.9-1: LIPA and SIPTO at the Local Network with L-GW function collocated with HNB architecture for HNB subsystem connected to EPC\nFigure 5.4.9-2: LIPA and SIPTO at the Local Network with L-GW function collocated with HNB architecture for HNB connected to a Gn-based SGSN\nThe HNB Subsystem appears as an RNS to the core network and is connected by means of the Iu-CS interface to the MSC and by means of the Iu-PS interface to the SGSN. When LIPA or SIPTO at the Local Network L-GW function collocated with HNB is activated, the HNB subsystem also has following interface to the core network i.e.:\n-\tFor S4-SGSN, an S5 interface between the S-GW and the Local GW;\n-\tFor Gn-based SGSN, a Gn interface between the SGSN and the Local GW.\nNOTE 1:\tIn this specification and for simplification the term RNC (or RNS if used instead) refers to the HNB subsystem if the MS accesses the network via a HNB unless stated otherwise.\nNOTE 2:\tDetailed functions of HNB and HNB GW are described in TS 25.467 [103].\nThe Local GW is the gateway towards the IP networks (e.g. residential/enterprise networks, Internet) associated with the HNB. The Local GW functions are described in TS 23.401 [89], clauses 4.4.9 and 4.3.15a:",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.4.9-1",
        "figure_5.4.9-2",
        "ts_25.467",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.10",
      "section_id": "5.4.10",
      "section_title": "CSG Subscriber Server",
      "content": "CSG Subscriber Server (CSS) is an optional element that stores CSG subscription data for roaming subscribers. The CSS stores and provides VPLMN specific CSG subscription information to the SGSN. The CSS is accessible from the Gn/Gp SGSN via the Ghv interface and from the S4-SGSN via the S7d interface. The CSS is always in the same PLMN as the current SGSN.\nIf the same CSG ID exists in both CSS subscription data and HLR/HSS subscription data, the CSG subscription data from HLR/HSS shall take precedence over the data from CSS.\nFigure 5.4.10-1 illustrates CSS connected to SGSN and MSC/VLR.\nFigure 5.4.10-1: CSS connected to SGSN and MSC/VLR",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.4.10-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.4.11",
      "section_id": "5.4.11",
      "section_title": "RAN Congestion Awareness Function (Iu mode)",
      "content": "The RAN Congestion Awareness Function (RCAF) is an element that provides RAN User Plane Congestion Information (RUCI) to the PCRF to enable the PCRF to take the RAN user plane congestion status into account for policy decisions.\nThe RCAF collects information related to user plane congestion from the RAN's OAM system based on which the RCAF determines the congestion level, the identifier of the impacted UTRAN cell and the IMSIs served by the impacted cell.\nVia the Nq' interface the RCAF retrieves the APNs of the active PDN connections of the UEs in the congested cell.\nVia the Np reference point, the RCAF sends the RUCI to the PCRFs serving the UEs' PDN connections.\nThe RCAF is available for UTRAN access only.\nNOTE 1:\tThe details of congestion reporting to the PCRF and the Np reference point are specified in TS 23.203 [88].\nNOTE 2:\tIn case of roaming or RAN sharing as specified in TS 23.251 [83], Np is an inter-operator reference point. Whether Np applies in case of roaming and RAN sharing is subject to inter-operator agreements.\nFigure 5.4.11-1 illustrates the RCAF connected to the S4-SGSN or Gn/Gp-SGSN. The RCAF is located in the same PLMN as the serving SGSN except in network sharing scenarios where the RCAF belongs to the RAN operator.\nFigure 5.4.11-1: RCAF connected to SGSN",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.4.11-1",
        "ts_23.203",
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.5",
      "section_id": "5.5",
      "section_title": "Assignment of Functions to General Logical Architecture",
      "content": "The functions identified in the functional model are assigned to the logical architecture.\nTable 1: Mapping of Functions to Logical Architecture\nFunction\nA/Gb mode -MS\nIu mode MS\nA/Gb mode RAN\nIu mode RAN\nA/Gb mode SGSN\nIu mode SGSN\nServing GW\nGGSN\nP‑GW\nHLR\nNetwork Access Control:\nRegistration\nX\nAuthentication and Authorisation\nX\nX\nX\nX\nX\nAdmission Control\nX\nX\nX\nX\nX\nX\nX\nX\nX\nMessage Screening\nX\nX\nPacket Terminal Adaptation\nX\nX\nCharging Data Collection\nX\nX\nX\nX\nX\nOperator Determined Barring\nX\nX\nX\nPacket Routeing & Transfer:\nRelay\nX\nX\nX\nX\nX\nX\nX\nX\nX\nRouteing\nX\nX\nX\nX\nX\nX\nX\nX\nX\nAddress Translation and Mapping\nX\nX\nX\nX\nX\nX\nX\nX\nEncapsulation\nX\nX\nX\nX\nX\nX\nX\nX\nTunnelling\nX\nX\nX\nX\nX\nX\nCompression\nX\nX\nX\nX\nCiphering\nX\nX\nX\nX\nX\nMobility Management:\nX\nX\nX\nX\nX\nX\nX\nX\nLogical Link Management:\nLogical Link Establishment\nX\nX\nLogical Link Maintenance\nX\nX\nLogical Link Release\nX\nX\nRadio Resource Management:\nX\nX\nX\nX\nX",
      "chunk_type": "definition",
      "cross_references": [
        "table_1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.1.1",
      "section_id": "5.6.1.1",
      "section_title": "MS – P‑GW/GGSN",
      "content": "The user plane consists of a layered protocol structure providing user information transfer, along with associated information transfer control procedures (e.g. flow control, error detection, error correction and error recovery). The user plane independence of the Network Subsystem (NSS) platform from the underlying radio interface is preserved via the Gb interface. The following user plane is used in A/Gb mode.\nFigure 4: User Plane for A/Gb mode and for Gn/Gp\nFigure 4a: User Plane for A/Gb mode and for GTP-based S5/S8\nNOTE:\tRefer to TS 23.402 [90] for the S‑GW ‑ P‑GW protocol stack with the PMIP-based S5/S8.\nLegend:\n-\tGPRS Tunnelling Protocol for the user plane (GTP‑U): This protocol tunnels user data between core network nodes in the backbone network. The GPRS Tunnelling Protocol shall encapsulate all PDP PDUs. GTP is specified in TS 29.060 [26], or TS 29.274 [92].\n-\tUDP carries GTP PDUs for protocols that do not need a reliable data link (e.g. IP), and provides protection against corrupted GTP PDUs. UDP is defined in RFC 768 [39].\n-\tIP: This is the backbone network protocol used for routeing user data and control signalling. The backbone network may initially be based on the IPv4. Ultimately, IPv6 shall be used. When IPv6 is used in the backbone, then IPv4 shall also be supported. IPv4 is defined in RFC 791 [40] and IPv6 is defined in RFC 2460 [48].\n-\tSubnetwork Dependent Convergence Protocol (SNDCP): This transmission functionality maps network-level characteristics onto the characteristics of the underlying network. SNDCP is specified in TS 44.065 [16].\n-\tLogical Link Control (LLC): This layer provides a highly reliable ciphered logical link. LLC shall be independent of the underlying radio interface protocols in order to allow introduction of alternative GPRS radio solutions with minimum changes to the NSS. LLC is specified in TS 44.064 [15].\n-\tRelay: In the BSS, this function relays LLC PDUs between the Um and Gb interfaces. In the SGSN, this function relays PDP PDUs either between the Gb and Gn interfaces or between the Gb and S4 interfaces.\n-\tBase Station System GPRS Protocol (BSSGP): This layer conveys routeing- and QoS-related information between the BSS and the SGSN. BSSGP does not perform error correction. BSSGP is specified in TS 48.018 [78].\n-\tNetwork Service (NS): This layer transports BSSGP PDUs. NS is specified in TS 48.016 [20].\n-\tRLC/MAC: This layer contains two functions: The Radio Link Control function provides a radio-solution-dependent reliable link. The Medium Access Control function controls the access signalling (request and grant) procedures for the radio channel, and the mapping of LLC frames onto the GSM physical channel. RLC/MAC is defined in TS 44.060 [77].\n-\tGSM RF: As defined in the  TS 45.xxx series of specifications.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4",
        "ts_23.402",
        "ts_29.060",
        "ts_29.274",
        "ts_44.065",
        "ts_44.064",
        "ts_48.018",
        "ts_48.016",
        "ts_44.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.1.2",
      "section_id": "5.6.1.2",
      "section_title": "Core Network Node - Core Network Node",
      "content": "Figure 5: User Plane for GTP-based Interfaces between Core Network Nodes\nNOTE:\tRefer to TS 23.402 [90] for the protocol stack with the PMIP-based S5 or S8.\nLegend:\n-\tGPRS Tunnelling Protocol for the user plane (GTP‑U): This protocol tunnels user data between SGSNs and GGSNs (Gn or Gp), between SGSNs and S‑GWs (S4), between S‑GWs and P‑GWs (S5 or S8) and between SGSNs in the backbone network (Gn or S16).\n-\tUser Datagram Protocol (UDP): This protocol transfers user data between GSNs. UDP is defined in RFC 768.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.2.1",
      "section_id": "5.6.2.1",
      "section_title": "MS – GGSN user plane with GERAN in Iu mode",
      "content": "NOTE 1:\tThe user plane for GERAN in Iu mode is described in TS 43.051 [74].\nNOTE 2:\tThe user plane for a HNB Subsystem in Iu mode is described in TS 25.467 [103].",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.051",
        "ts_25.467"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.2.2",
      "section_id": "5.6.2.2",
      "section_title": "MS – P‑GW/GGSN user plane with UTRAN",
      "content": "Figure 6a: User Plane with UTRAN for Gn/Gp\nFigure 6b: User Plane with UTRAN for Gn/Gp and Direct Tunnel\nFigure 6c: User Plane with UTRAN for GTP-based S5/S8\nNOTE:\tRefer to TS 23.402 [90] for the S‑GW ‑ P‑GW protocol stack with the PMIP‑based S5/S8.\nFigure 6d: User Plane with UTRAN for GTP-based S5/S8 and Direct Tunnel\nNOTE:\tRefer to TS 23.402 [90] for the S‑GW ‑ P‑GW protocol stack with the PMIP-based S5/S8.\nLegend:\n-\tPacket Data Convergence Protocol (PDCP): This transmission functionality maps higher-level characteristics onto the characteristics of the underlying radio-interface protocols. PDCP provides protocol transparency for higher-layer protocols. PDCP supports e.g. IPv4, PPP and IPv6. Introduction of new higher-layer protocols shall be possible without any changes to the radio-interface protocols. PDCP provides protocol control information compression. PDCP is specified in TS 25.323 [57].\nNOTE:\tUnlike in A/Gb mode, user data compression is not supported in Iu mode, because the data compression efficiency depends on the type of user data, and because many applications compress data before transmission. It is difficult to check the type of data in the PDCP layer, and compressing all user data requires too much processing.\n-\tGPRS Tunnelling Protocol for the user plane (GTP‑U): This protocol tunnels user data between UTRAN and the 3G‑SGSN, and between the GSN CN nodes in the backbone network. GTP shall encapsulate all PDP PDUs. GTP is specified in TS 29.060 [26].\n-\tSGSN controls the user plane tunnel establishment and may establish a Direct Tunnel between UTRAN and GGSN as shown in Figure 6b or a Direct Tunnel between UTRAN and S‑GW as shown in Figure 6d.\n-\tUDP/IP: These are the backbone network protocols used for routeing user data and control signalling.\n-\tRadio Link Control (RLC): The RLC protocol provides logical link control over the radio interface. There may be several simultaneous RLC links per MS. Each link is identified by a Bearer Id. RLC is defined in TS 25.322 [55].\n-\tMedium Access Control (MAC): The MAC protocol controls the access signalling (request and grant) procedures for the radio channel. MAC is specified in TS 25.321 [60].",
      "chunk_type": "general",
      "cross_references": [
        "figure_6",
        "ts_23.402",
        "ts_25.323",
        "ts_29.060",
        "ts_25.322",
        "ts_25.321"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.2.3",
      "section_id": "5.6.2.3",
      "section_title": "Core Network Node - Core Network Node",
      "content": "This user plane is the same as for A/Gb mode, see clause \"Core Network Node - Core Network Node\" above.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.6.3",
      "section_id": "5.6.3",
      "section_title": "Control Plane",
      "content": "The control plane consists of protocols for control and support of the user plane functions:\n-\tcontrolling the GPRS network access connections, such as attaching to and detaching from GPRS;\n-\tcontrolling the attributes of an established network access connection, such as activation of a PDP address;\n-\tcontrolling the routeing path of an established network connection in order to support user mobility; and\n-\tcontrolling the assignment of network resources to meet changing user demands.\nThe following control planes are used in both A/Gb mode and Iu mode unless specifically indicated.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.6.3.1",
      "section_id": "5.6.3.1",
      "section_title": "MS - SGSN (A/Gb mode)",
      "content": "Figure 7: Control Plane MS - SGSN in A/Gb mode\nLegend:\n-\tGPRS Mobility Management and Session Management (GMM/SM): This protocol supports mobility management functionality such as GPRS attach, GPRS detach, security, routeing area update, location update, PDP context activation, and PDP context deactivation, as described in clauses \"Mobility Management Functionality\" and \"PDP Context Activation, Modification, Deactivation, and Preservation Functions\".",
      "chunk_type": "general",
      "cross_references": [
        "figure_7"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.2",
      "section_id": "5.6.3.2",
      "section_title": "MS – SGSN (Iu mode)",
      "content": "NOTE 1:\tThe control plane for GERAN in Iu mode is described in TS 43.051 [74].\nNOTE 2:\tThe control plane for a HNB Subsystem in Iu mode is described in TS 25.467 [103].\nFigure 8: Control Plane MS - SGSN in Iu mode\nLegend:\n-\tIu mode Mobility Management and Session Management (GMM/SM): GMM supports mobility management functionality such as attach, detach, security, and routeing area update, as described in clause \"Mobility Management Functionality\". SM supports PDP context activation and PDP context deactivation, as described in clause \"PDP Context Activation, Modification, Deactivation, and Preservation Functions\".\n-\tSMS supports the mobile-originated and mobile-terminated short message service described in TS 23.040 [8].\n-\tRadio Access Network Application Protocol (RANAP): This protocol encapsulates and carries higher-layer signalling, handles signalling between the 3G‑SGSN and Iu mode RAN, and manages the GTP connections on the Iu interface. RANAP is specified in TS 25.413 [56b]. The layers below RANAP are defined in TS 25.412 [56] and TS 25.414 [64].\n-\tRadio Link Control (RLC): The RLC protocol offers logical link control over the radio interface for the transmission of higher layer-signalling messages and SMS. RLC is defined in TS 25.322 [55].",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.467_figure_8",
        "ts_43.051",
        "ts_25.467",
        "ts_23.040",
        "ts_25.413",
        "ts_25.412",
        "ts_25.414",
        "ts_25.322"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.3",
      "section_id": "5.6.3.3",
      "section_title": "Gn/Gp-SGSN - HLR",
      "content": "Figure 9: Control Plane Gn/Gp-SGSN ‑ HLR\nLegend:\n-\tMobile Application Part (MAP): This protocol supports signalling exchange with the HLR, as defined in TS 29.002 [23].\n-\tTCAP and SCCP are the same protocols as used to support MAP in CS PLMNs.\n-\tThe Signalling Bearer is one of the signalling bearers specified in TS 29.202 [72].",
      "chunk_type": "general",
      "cross_references": [
        "figure_9",
        "ts_29.002",
        "ts_29.202"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.4",
      "section_id": "5.6.3.4",
      "section_title": "SGSN - MSC/VLR",
      "content": "Figure 10: Control Plane SGSN ‑ MSC/VLR\nLegend:\n-\tBase Station System Application Part + (BSSAP+): A subset of BSSAP procedures supports signalling between the SGSN and MSC/VLR, as described in clause \"Mobility Management Functionality\" and in TS 29.018 [25]. The requirements for the lower layers are specified in TS 29.016 [24].",
      "chunk_type": "general",
      "cross_references": [
        "figure_10",
        "ts_29.018",
        "ts_29.016"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.5",
      "section_id": "5.6.3.5",
      "section_title": "SGSN - EIR",
      "content": "Figure 11: Control Plane SGSN ‑ EIR\nLegend:\n-\tMobile Application Part (MAP): This protocol supports signalling between the SGSN and the EIR, as described in clause \"Identity Check Procedures\".\n5.6.3.5a\tS4-SGSN - EIR\nLegend:\n-\tDiameter: This protocol supports MS identity check procedure between S4-SGSN and EIR (S13'), as described in clause \"Identity Check Procedures\". Diameter is defined in RFC 3588 [96].\n-\tStream Control Transmission Protocol (SCTP): This protocol transfers signalling messages. SCTP is defined in RFC 4960 [35].\nFigure 11A: Control Plane S4-SGSN - EIR",
      "chunk_type": "general",
      "cross_references": [
        "figure_11"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.6",
      "section_id": "5.6.3.6",
      "section_title": "SGSN - SMS-GMSC or SMS-IWMSC",
      "content": "Figure 12: Control Plane SGSN ‑ SMS‑GMSC and SGSN ‑ SMS‑IWMSC (MAP based)\nLegend:\n-\tMobile Application Part (MAP): This protocol supports signalling between the SGSN and SMS‑GMSC or SMS‑IWMSC over the Gd interface, as described in clause 16.1.\nFigure 12A: Control Plane SGSN SMS GMSC and SGSN SMS IWMSC (Diameter based)\nThe Gdd interface may be used to support a Diameter based signalling between a SGSN supporting EPS interfaces and the SMS GMSC or SMS IWMSC, as described in clause 16.1.\nAn Interworking Function may be used for interworking between a SGSN supporting the Gdd interface (Diameter based), and a SMS-GMSC or SMS-IWMSC only supporting the Gd interface (MAP Based).",
      "chunk_type": "general",
      "cross_references": [
        "clause_16.1",
        "figure_12"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.7",
      "section_id": "5.6.3.7",
      "section_title": "Core Network Node - Core Network Node",
      "content": "Figure 13: Control Plane for GTP-based Interfaces between Core Network Nodes\nNOTE:\tRefer to TS 23.402 [90] for the S‑GW ‑ P‑GW protocol stack with the PMIP‑based S5 or S8.\nLegend:\n-\tGPRS Tunnelling Protocol for the control plane (GTP‑C): This protocol tunnels signalling messages between SGSNs and GGSNs (Gn or Gp), between SGSNs and S‑GWs (S4), between S‑GWs and P‑GWs (S5 or S8) and between SGSNs in the backbone network (Gn or S16).\n-\tUser Datagram Protocol (UDP): This protocol transfers signalling messages between GSNs. UDP is defined in RFC 768 [39].",
      "chunk_type": "general",
      "cross_references": [
        "figure_13",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.8",
      "section_id": "5.6.3.8",
      "section_title": "GGSN - HLR",
      "content": "NOTE:\tThis interface is not supported when UEs are served via S5/S8.\nThis optional signalling path allows a GGSN to exchange signalling information with an HLR. There are two alternative ways to implement this signalling path:\n-\tIf an SS7 interface is installed in the GGSN, the MAP protocol can be used between the GGSN and an HLR.\n-\tIf an SS7 interface is not installed in the GGSN, any GSN with an SS7 interface installed in the same PLMN as the GGSN can be used as a GTP-to-MAP protocol converter to allow signalling between the GGSN and an HLR.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.6.3.8.1",
      "section_id": "5.6.3.8.1",
      "section_title": "MAP-based GGSN - HLR Signalling",
      "content": "Figure 14: Control Plane GGSN ‑ HLR Using MAP\nLegend:\n-\tMobile Application Part (MAP): This protocol supports signalling exchange with the HLR, as described in clause \"Network-Requested PDP Context Activation Procedure\".",
      "chunk_type": "general",
      "cross_references": [
        "figure_14"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.8.2",
      "section_id": "5.6.3.8.2",
      "section_title": "GTP and MAP-based GGSN - HLR Signalling",
      "content": "Figure 15: Control Plane GGSN ‑ HLR Using GTP and MAP\nLegend:\n-\tGPRS Tunnelling Protocol for the control plane (GTP‑C): This protocol tunnels signalling messages between the GGSN and the protocol-converting GSN in the backbone network.\n-\tInterworking: This function provides interworking between GTP and MAP for GGSN ‑ HLR signalling.",
      "chunk_type": "general",
      "cross_references": [
        "figure_15"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.9",
      "section_id": "5.6.3.9",
      "section_title": "S4-SGSN - HSS",
      "content": "Legend:\n-\tDiameter Base+Apps: Diameter Base Protocol as defined in RFC 3588 [96]. The Apps are various Diameter Applications as necessary for the operation between SGSN and HSS.\n-\tSCTP: This protocol guarantees delivery of upper layer packets between SGSN and the HSS with built-in redundancy scheme. SCTP is defined in RFC 4960 [35].\nFigure 15a: Control Plane S4-SGSN ‑ HSS\nNOTE:\tAs specified in clause 6.4, between S4-SGSN and HSS, the interface is Diameter based (S6d); however, to assist with SGSN transition the use of MAP based Gr between the S4-SGSN and HSS is not precluded\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4",
        "figure_15"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.10",
      "section_id": "5.6.3.10",
      "section_title": "Gn/Gp-SGSN - CSS",
      "content": "Legend:\n-\tMobile Application Part (MAP): This protocol supports signalling between Gn/Gp-SGSN and CSS, as defined in clause \"Mobility Management Functionality\".\nFigure 5.6.3.10-1: Control Plane Gn/Gp-SGSN‑CSS",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.6.3.10-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.11",
      "section_id": "5.6.3.11",
      "section_title": "S4-SGSN - CSS",
      "content": "Legend:\n-\tDiameter: This protocol supports signalling messages between S4-SGSN and CSS (S7d), as described in clause \"Mobility Management Functionality\". Diameter is defined in RFC 3588 [96].\n-\tStream Control Transmission Protocol (SCTP): This protocol transfers signalling messages. SCTP is defined in RFC 4960 [35].\nFigure 5.6.3.11-1: Control Plane S4-SGSN‑CSS",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.6.3.11-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.6.3.12",
      "section_id": "5.6.3.12",
      "section_title": "SGSN - RCAF (Iu mode)",
      "content": "Legend:\n-\tNq-AP: This application layer protocol supports the APN information retrieval procedure between the RCAF and the SGSN.\n-\tStream Control Transmission Protocol (SCTP): This protocol transfers signalling messages. SCTP is defined in RFC 4960 [35].\nFigure 5.6.3.12-1: Control Plane SGSN RCAF\nEditor's note:\tThe protocol stack will be added once Stage 3 has selected the protocol type to use between S4-SGSN and RCAF. It is up to Stage 3 to decide whether the same or different protocols will be used for the Nq' interface to the Gn/Gp-SGSN and the S4-SGSN, respectively.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.6.3.12-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.7",
      "section_id": "5.7",
      "section_title": "Functionality Needed for Mobile IPv4",
      "content": "To support the optional Mobile IP services, see TS 23.121 [54], efficiently by GPRS, Foreign Agent (FA) functionality needs to be provided in the GGSN. The interface between the GGSN and FA, including the mapping between the care of IP address and the GTP tunnel in the PLMN is not standardized as the GGSN and the FA are considered to be one integrated node.\nMobile IP service needs a Home Agent (HA) to anchor the IP session. The HA is a router that tunnels datagrams to/from an FA. The FA tunnels/de-tunnels the datagrams between the MS and the HA. In this case, the FA functionality resides in the GGSN. The location of the HA is outside the scope of the 3GPP specifications.\nThe FA and HA functionality is specified in RFC 3344 [46].\nThe Mobile IPv4 mobility management capabilities described in this clause are in addition to and distinct from the Mobile IP capabilities defined in TS 23.402 [90]. Support of Mobile IPv4 defined for the GGSN is retained in this specification for support of legacy terminals. Interworking between Mobile IPv4 support in the GGSN and MIPv4 as defined in TS 23.402 [90] is not defined for this release.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.121",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.8",
      "section_id": "5.8",
      "section_title": "Functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes",
      "content": "The Intra Domain Connection of RAN Nodes to Multiple CN Nodes overcomes the strict hierarchy that restricts the connection of a RAN node to just one CN node, and hence also to one SGSN. This implies that a RAN node must be able to determine which of the SGSNs, covering the area where an MS is located, should receive the signalling and user traffic sent from an MS. To avoid unnecessary signalling in the core network, an MS that has attached to one SGSN, should generally continue to be served by this SGSN as long as the MS is in the radio coverage of the pool area, to which the SGSN is associated. The concept of pool area is a RAN based definition that comprises one or more RA(s) that, from a RAN perspective, are served by a certain group of CN nodes. This does not exclude that one or more of the SGSNs in this group serve RAs outside the pool area. This group of SGSNs is also referred to as an SGSN pool.\nTo enable the RAN node to determine which SGSN to select when forwarding messages from an MS, Intra Domain Connection of RAN Nodes to Multiple CN Nodes defines a routing mechanism (and other related functionality). Another routing mechanism (and other related functionality) is defined for the SGSNs that support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes. The routing mechanism is required to find the correct old SGSN (from the multiple SGSNs that are associated with a pool area). When an MS roams out of the pool area and into the area of one or more SGSNs that do not know about the internal structure of the pool area where the MS roamed from, the new SGSN will send the Identification Request message or the SGSN Context Request message to an SGSN that is believed to be the old SGSN. This SGSN, which is associated with the same pool area as the actual old SGSN, resolves the ambiguity of multiple SGSNs in the pool area and determines the correct old SGSN from the P-TMSI (or the TLLI). The received message is then relayed to the correct old SGSN (unless it is itself the correct old SGSN). The routing mechanism in both the SGSNs and the RAN nodes utilises the fact that every SGSN that serves a pool area must have its own unique value range of the P-TMSI parameter within the pool area.\nNOTE:\tFollowing idle mode mobility from E‑UTRAN to GERAN/UTRAN, the new SGSN needs to find the \"correct old MME\" rather than the \"correct old SGSN\". As specified in TS 23.401 [89], E‑UTRAN capable MSs process EPS IDs such that information in the RAI and P‑TMSI or TLLI information elements enable the new SGSN to reuse the existing mechanism for \"finding the correct old SGSN\" to instead \"find the correct old MME\".\nThe requirements on, and the detailed functionality needed to support, the Intra Domain Connection of RAN Nodes to Multiple CN Nodes are defined in TS 23.236 [73] and additional functionality and requirements related to interworking with E‑UTRAN are specified in TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401",
        "ts_23.236"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.9",
      "section_id": "5.9",
      "section_title": "Functionality for network sharing",
      "content": "Network sharing allows multiple network operators to share a radio access network. In a shared network, an MS that supports network sharing selects one of the operators and indicates it to the network. This allows the network to provide services from the selected operator. For an MS that does not support network sharing, the network may select the network operator that provides the services.\nThe functionality needed to support network sharing is defined in TS 23.251 [83].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.1",
      "section_id": "5.10.1",
      "section_title": "Introduction",
      "content": "Emergency bearer services are provided to support IMS emergency sessions. Emergency bearer services are functionalities provided by the serving network when the network is configured to support emergency bearer services. Emergency bearer services are provided to normal attached UEs and to UEs that are in limited service state. Receiving emergency services in limited service state does not require a subscription. To provide emergency bearer services as a local service, node configuration parameters may be used to set service values that would otherwise be obtained from subscription data.\nWhen a PLMN supports IMS and emergency bearer services in UTRAN, all SGSNs in that PLMN shall have the same capability to support emergency bearer services.\nNOTE:\tIMS emergency session may be provided over GPRS without emergency procedures as specified from this release of specifications. In such a scenario, GPRS is unaware of the emergency session and thus provides no specific support explicitly required for such access.\nFor emergency services other than eCall, a UE that is not in in limited service state, as specified in TS 23.122 [7b] determines from a NAS indicator whether that additional emergency numbers/types received via WLAN from trusted sources may be used for detecting emergency calls.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.122"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.2.1",
      "section_id": "5.10.2.1",
      "section_title": "General",
      "content": "IMS emergency sessions over emergency access via packet core are supported for UTRAN access as well as inter-RAT handover between UTRAN and E-UTRAN. Support for Packet Core (GPRS and EPS) emergency bearer services over GERAN networks is not included in this Release and thus PS handover to GERAN access should not be performed when IMS emergency sessions over EPS or GPRS using emergency bearer services are active.\nThe MS shall signal a cause specific for emergency as defined in TS 25.331 [52] when it requests an RRC connection in relation to an emergency session. Specific situations that require setting the RRC establishment cause to emergency are described in TS 24.008 [13].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_25.331",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.2.2",
      "section_id": "5.10.2.2",
      "section_title": "Reachability Management for Emergency Attached MS in PMM-IDLE state",
      "content": "An emergency attached MS when its periodic RA update timer expires shall not initiate a periodic RAU procedure but enter PMM- DETACHED state. The SGSN assigns the periodic RAU timer value to emergency attached MS. This timer keeps the MS emergency attached after change to PMM-IDLE state to allow for a subsequent emergency service without a need to emergency attach again. For emergency attached MS the SGSN runs a mobile reachable timer with a similar value to the MS's periodic RAU timer. Any time after expiry of this timer the SGSN may change the PMM state of an emergency attached MS to PMM- DETACHED.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_5.10.2.3",
      "section_id": "5.10.2.3",
      "section_title": "Mobility and Access Restrictions for Emergency Services",
      "content": "When Emergency Services are supported and local regulation requires Emergency Sessions to be provided regardless of mobility or access restrictions, regional subscription restrictions or access restrictions (see TS 23.221 [80] and TS 23.008 [79]) e.g. CSG restrictions, should not be applied to MSs receiving emergency services. When the RABs for emergency bearers are established, the ARP value for emergency bearer services indicates the usage for emergency services to the UTRAN.\nDuring handover, the source UTRAN and source SGSN ignore any MS related restrictions during handover evaluation when there are active emergency bearers. UTRAN shall not initiate handover to GERAN PS domain. During handover to a CSG cell, if the UE is not a CSG member of the target CSG cell and has emergency bearer services, the target RNC only accepts the emergency bearers and the target SGSN releases the non-emergency bearers that were not accepted by the target RNC according to clause 9.2.4.2. Such UEs behave as emergency attached.\nDuring Routing Area Update procedures, including a RAU as part of a handover, the target SGSN ignores any mobility or access restrictions for MS with emergency bearer services where required by local regulation. Any non emergency bearer services are deactivated, according to clause 9.2.4.2, by the target SGSN when not allowed by the subscription for the target location. Such MSs behave as emergency attached. To allow the emergency attached MS to get access to normal services after the emergency session has ended and when it has moved to a new area that is not stored by the MS as a forbidden area, the MS may explicitly detach and reattach to normal services without waiting for the emergency PDN connection deactivation by the PDN GW or GGSN.\nThis functionality applies to all mobility procedures.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.4.2",
        "ts_23.221",
        "ts_23.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.3",
      "section_id": "5.10.3",
      "section_title": "Attach handling",
      "content": "An MS in limited service state, as specified in TS 23.122 [7b], initiates the GPRS Attach procedure by indicating that the attach procedure is for emergency services. The Attach Request message for emergency attach purpose is indicated as Attach Type \"GPRS Emergency Attach\". Also MSs that had attached for normal service and do not have emergency bearers established and are camped on a cell, where the MS is in limited service state (e.g. because of change to a restricted Tracking Area or not allowed CSG), shall initiate this Attach procedure, indicating that the attach is to receive emergency services. The network which support emergency services for an MS in limited service state provides emergency attach service to this MS, according to regulatory requirements. The UEs in limited service state determine that the cell supports emergency bearer services for IMS based emergency services over UTRAN from a broadcast indicator in AS.\nTS 23.401 [89] describes in clause \"IMS Emergency Session Support\" how the network provides emergency services according to different local regulations. Roaming or mobility restrictions are not applied when the network supports emergency services. Emergency Attach is supported only in UTRAN access.\nAn MS that camps normally on a cell, i.e. without any conditions that result in limited service state, initiates the normal GPRS attach procedure if not already attached. A normal attached IMS enabled MS is assumed to have a non-emergency PDN connection. A normal attached MS initiates the GPRS PDP Context Activation procedure by indicating emergency service to receive emergency bearer services. The UEs that camp normally on a cell are informed that the PLMN supports emergency bearer services for IMS based emergency services over UTRAN from the Emergency Service Support indicator in the Attach and RAU procedures. UEs that camp normally on a cell may also use the emergency attach procedure under conditions specified in TS 24.008 [13], e.g. when the MM back-off timer is running.\nNOTE 1:\tFailure of the normal initial attach may occur e.g. when the network rejects the request with a back-off time.\nNOTE 2:\tThe establishment of the emergency bearer services may fail e.g. when the MS needs to perform a RAU procedure prior to the GPRS PDP Context Activation procedure, i.e. the MS moved into a non-registered Routeing Area with the MM back-off timer running in the MS. Another example is when the MS needs to perform a Service Request procedure prior to the GPRS PDP Context Activation procedure, i.e. the MS is in PMM-IDLE state when the emergency service is triggered.\nThe details for Emergency Attach are included in the Combined GPRS/IMSI Attach procedure, see clause 6.5.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.5.3",
        "ts_23.122",
        "ts_23.401",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.4",
      "section_id": "5.10.4",
      "section_title": "PDP Context Activation for emergency bearer services",
      "content": "The procedure is executed after the MS has successfully performed a GPRS attach and is valid for both normal and limited service state. The MS shall always activate a new PDP Context when emergency bearer services are invoked. When the MS detects a request for emergency service and it is required to establish a PDP context within the same network as the SGSN, the MS performs a PDP context activation with an indication of emergency usage so that emergency bearer services handling can be provided by the local network per configuration without subscription limitations. The request for emergency bearer services is indicated as Request Type \"emergency\" in the PDP Context Activation message.\nMS request for emergency PDP context activation is added into the PDP Context Activation Procedure in clause 9.2.2.1.\nThe enhancements to support MS request for emergency PDP context activation are:\na)\tThe PDP Context Activation Request includes an indication of emergency usage.\nb)\tConfiguration parameters in the network are used to override subscription limitations such as bearer QoS.\nThe PDN GW/GGSN selection function in the SGSN shall derive a PDN GW/GGSN identity in the visited PLMN by using the Emergency APN. The PDN GW/GGSN address is derived from the PDN GW/GGSN identity by using the Domain Name Service function. If the Domain Name Service function provides a list of PDN GW/GGSN addresses, one PDN GW/GGSN address is selected from this list. If the selected PDN GW/GGSN cannot be used, e.g. due to an error, then another PDN GW/GGSN is selected from the list. The specific interaction between the SGSN and the Domain Name Service function may include functionality to allow for the retrieval or provision of additional information regarding the PDN GW capabilities (e.g. whether the PDN GW supports PMIP based or GTP-based S5/S8, or both).\nIf there is already an emergency bearer activated, the SGSN shall reject any PDP context activation request for normal services if the mobility and access restrictions do not allow the MS to access normal services.\nIf the PDN GW/GGSN identity is statically configured in the SGSN, then it may be a FQDN or an IP Address[es].",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_9.2.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.060_5.10.5",
      "section_id": "5.10.5",
      "section_title": "Handling of PDN Connections for Emergency Bearer Services",
      "content": "The PDP contexts (described in clause 5.10.4) of a PDN Connection associated with the emergency APN shall be dedicated for IMS emergency sessions and shall not allow any other type of traffic. The Emergency PDP contexts shall not be changed to normal PDP contexts and vice versa.\nThe PDN GW/GGSN shall block any traffic that is not from or to addresses of network entities (e.g. P-CSCF) providing IMS emergency service. Dynamic PCC shall be deployed in order to support IMS emergency sessions, the procedures are as described in TS 23.203 [88]. If there is already an emergency PDN connection, the MS shall not request another emergency PDN Connection. The SGSN shall reject any additional emergency PDN Connection requests. The MS shall not initiate any Secondary PDP Context Activation Procedure or any PDP Context Modification Procedure for the emergency PDN connection. The PDN GW/GGSN shall reject any MS initiated Secondary PDP Context Activation Procedure or any PDP Context Modification Procedure that is for the emergency PDN Connection.\nThe ARP reserved for emergency bearer service shall only be assigned to bearers associated with an emergency PDN Connection.\nFor emergency attached MS, SGSN initiates an implicit detach based on an inactivity timeout specific to emergency.\nNOTE:\tIn case of IMS emergency services prior to this release of specification, dynamic PCC support was not required in the specifications. In such case if PCC is not used the PDN GW/GGSN provides static policy.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.10.4",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.0",
      "section_id": "6.1.0",
      "section_title": "General",
      "content": "The Mobility Management (MM) activities related to a subscriber are characterised by one of three different MM states. In A/Gb mode, the MM states for a GPRS subscriber are IDLE, STANDBY, and READY. In Iu mode, the MM states for a GPRS subscriber are PMM‑DETACHED, PMM‑IDLE, and PMM‑CONNECTED. Each state describes a certain level of functionality and information allocated. The information sets held at the MS and the SGSN are denoted MM context.\nThe MM state relates only to GPRS MM activities of a subscriber. The MM state is independent of the number and state of PDP contexts for that subscriber.\nNOTE:\tA GERAN/UTRAN MS that is also capable of E‑UTRAN access has both MM states and EPS Mobility Management (EMM) states. The EMM states and the effects on the EMM and MM states of inter‑RAT mobility between GERAN/UTRAN and E‑UTRAN are described in TS 23.401 [89].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.1.1",
      "section_id": "6.1.1.1",
      "section_title": "IDLE (GPRS) State",
      "content": "In GPRS IDLE state, the subscriber is not attached to GPRS mobility management. The MS and SGSN contexts hold no valid location or routeing information for the subscriber. The subscriber-related mobility management procedures are not performed.\nThe MS performs PLMN selection and cell selection and re-selection.\nData transmission to and from the mobile subscriber as well as the paging of the subscriber is not possible. The GPRS MS is seen as not reachable in this case.\nIn order to establish MM contexts in the MS and the SGSN, the MS shall perform the GPRS Attach procedure.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.1.1.2",
      "section_id": "6.1.1.2",
      "section_title": "STANDBY State",
      "content": "In STANDBY state, the subscriber is attached to GPRS mobility management. The MS and SGSN have established MM contexts as described in clause \"Information Storage\".\nPages for data or signalling information transfers may be received. It is also possible to receive pages for the CS services via the SGSN. Data reception and transmission are not possible in this state.\nThe MS performs GPRS Routeing Area (RA) and GPRS cell selection and re-selection locally. The MS executes mobility management procedures to inform the SGSN when it has entered a new RA. The MS does not inform the SGSN on a change of cell in the same RA. Therefore, the location information in the SGSN MM context contains only the GPRS RAI for MSs in STANDBY state.\nThe MS may initiate activation or deactivation of PDP contexts while in STANDBY state. A PDP context shall be activated before data can be transmitted or received for this PDP context.\nThe SGSN may have to send data or signalling information to an MS in STANDBY state. The SGSN then sends a Paging Request in the routeing area where the MS is located if PPF is set. If PPF is cleared, then paging is not done. The MM state in the MS is changed to READY when the MS responds to the page, and in the SGSN when the page response is received. Also, the MM state in the MS is changed to READY when data or signalling information is sent from the MS and, accordingly, the MM state in the SGSN is changed to READY when data or signalling information is received from the MS.\nThe MS or the network may initiate the GPRS Detach procedure to move to the IDLE state. In IDLE state the MM and PDP contexts may then be deleted.\nAfter expiry of the Active Timer, if running for the MS, the SGSN should clear the PPF flag in the SGSN. After expiry of the mobile reachable timer the SGSN should clear the PPF flag in the SGSN and start an Implicit Detach timer, with a relatively large value and if ISR is activated, at least slightly larger than the UE's GERAN/UTRAN Deactivate ISR timer. After the Implicit Detach timer expires, the S4-SGSN can perform an implicit detach in order to return the MM contexts in the SGSN to IDLE state.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.1.1.3",
      "section_id": "6.1.1.3",
      "section_title": "READY State",
      "content": "In READY state, the SGSN MM context corresponds to the STANDBY MM context extended by location information for the subscriber on the cell level. The MS performs mobility management procedures to provide the network with the actual selected cell. GPRS cell selection and re-selection is done locally by the MS, or may optionally be controlled by the network.\nAn identifier of the cell, the Cell Global Identity including RAC and LAC, is included in the BSSGP header of the data packet from the MS; see TS 48.018 [78].\nThe MS may send and receive PDP PDUs in this state. The network initiates no GPRS pages for an MS in READY state. Pages for other services may be done via the SGSN. The SGSN transfers downlink data to the BSS responsible for the subscriber's actual GPRS cell.\nThe MS may activate or deactivate PDP contexts while in READY state.\nRegardless if a radio resource is allocated to the subscriber or not, the MM context remains in the READY state even when there is no data being communicated. A timer supervises the READY state. An MM context moves from READY state to STANDBY state when the READY timer expires. In order to move from READY state to IDLE state, the MS initiates the GPRS Detach procedure.",
      "chunk_type": "general",
      "cross_references": [
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.1.4",
      "section_id": "6.1.1.4",
      "section_title": "State Transitions and Functions",
      "content": "The movement from one state to the next is dependent on the current state (IDLE, STANDBY, or READY) and the event that occurs (e.g. GPRS attach).\nFigure 16: Functional Mobility Management State Model\nFigure 16 describes the following state transitions:\nMoving from IDLE to READY:\n-\tGPRS Attach: The MS requests access and a logical link to an SGSN is initiated. MM contexts are established at the MS and SGSN.\nMoving from STANDBY to IDLE:\n-\tImplicit Detach: The MM and PDP contexts in the SGSN shall return to IDLE and INACTIVE state. The MM and PDP contexts in the SGSN may be deleted. The GGSN PDP contexts shall be deleted. If ISR is not activated, the P‑GW and S‑GW bearer contexts shall be deleted.\n-\tCancel Location: The SGSN receives a MAP Cancel Location message from the HLR, and removes the MM and PDP contexts.\nMoving from STANDBY to READY:\n-\tPDU transmission: The MS sends an LLC PDU to the SGSN, possibly in response to a page.\n-\tPDU reception: The SGSN receives an LLC PDU from the MS.\nMoving from READY to STANDBY:\n-\tREADY timer expiry: The MS and the SGSN MM contexts return to STANDBY state.\n-\tForce to STANDBY: The SGSN indicates an immediate return to STANDBY state before the READY timer expires.\n-\tAbnormal RLC condition: The SGSN MM context returns to STANDBY state in case of delivery problems on the radio interface or in case of irrecoverable disruption of a radio transmission.\nMoving from READY to IDLE:\n-\tGPRS Detach: The MS or the network requests that the MM contexts return to IDLE state and that the PDP contexts return to INACTIVE state. The SGSN may delete the MM and PDP contexts. The PDP contexts in the GGSN/P‑GW and S‑GW shall be deleted.\n-\tCancel Location: The SGSN receives a MAP Cancel Location message from the HLR, and removes the MM and PDP contexts.",
      "chunk_type": "general",
      "cross_references": [
        "figure_16"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.2.1",
      "section_id": "6.1.2.1",
      "section_title": "PMM‑DETACHED State",
      "content": "In the PMM‑DETACHED state there is no communication between the MS and the 3G‑SGSN. The MS and SGSN contexts hold no valid location or routeing information for the MS. The MS MM state machine does not react on system information related to the 3G‑SGSN. The MS is not reachable by a 3G‑SGSN, as the MS location is not known.\nIn order to establish MM contexts in the MS and the SGSN, the MS shall perform the GPRS Attach procedure. When the PS signalling connection is established between the MS and the 3G‑SGSN for performing the GPRS attach, the state changes to PMM‑CONNECTED in the 3G‑SGSN and in the MS. The PS signalling connection is made up of two parts: an RRC connection and an Iu connection.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.1.2.2",
      "section_id": "6.1.2.2",
      "section_title": "PMM‑IDLE State",
      "content": "The MS location is known in the 3G‑SGSN with an accuracy of a routeing area. Paging is needed in order to reach the MS, e.g. for signalling. The MS and SGSN have established MM contexts as described in clause \"Information Storage\".\nThe MS shall perform a routeing area update if the RA changes. Signalling towards the HLR is needed if the 3G‑SGSN does not have an MM context for this MS.\nThe MS and 3G‑SGSN shall enter the PMM‑CONNECTED state when the PS signalling connection is established between the MS and the 3G‑SGSN.\nAfter expiry of the Active Timer, if running for the MS, the SGSN should clear the PPF flag in the SGSN. After expiry of the mobile reachable timer the 3G-SGSN should clear the PPF flag in the SGSN and start an Implicit Detach timer, with a relatively large value and if ISR is activated, at least slightly larger than the UE's GERAN/UTRAN Deactivate ISR timer. After the Implicit Detach timer expires, the SGSN can perform an implicit detach in order to return the MM contexts in the SGSN to PMM-DETACHED state. The MS's MM context may be deleted. The HLR may be informed about the deletion (see clause 6.7).",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.2.3",
      "section_id": "6.1.2.3",
      "section_title": "PMM‑CONNECTED State",
      "content": "The MS location is known in the 3G‑SGSN with an accuracy of a serving RNC. In the PMM‑CONNECTED state, the location of the MS is tracked by the serving RNC. The MS performs the routeing area update procedure when RAI in the MM system information changes.\nWhen an MS and a 3G‑SGSN are in the PMM‑CONNECTED state, a PS signalling connection is established between the MS and the 3G‑SGSN.\nIn the 3G‑SGSN, PS signalling connection release or failed downlink transfer with cause \"IMSI unknown in RNC\" changes the state to PMM‑IDLE.\nThe MS shall enter the PMM‑IDLE state when its PS signalling connection to the 3G‑SGSN has been released or broken. This release or failure is explicitly indicated by the RNC to the MS or detected by the MS (RRC connection failure). The radio connection shall also be released if a URA update fails because of \"RRC connection not established\", or if the URA update timer expires while the MS is out of UTRAN (or Iu mode GERAN) coverage.\nAfter a signalling procedure (e.g. routeing area update), the 3G‑SGSN may decide to release the PS signalling connection, after which the state is changed to PMM‑IDLE.\nGPRS detach changes the state to PMM‑DETACHED.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.1.2.4",
      "section_id": "6.1.2.4",
      "section_title": "State Transitions and Functions",
      "content": "Figure 17 introduces the MM states for a GPRS subscriber (PMM). The states and activations are further described below the figure.\nFigure 17: PMM State Model\nNOTE:\tIn both the PMM‑IDLE and the PMM‑CONNECTED states, session management may or may not have activated a PDP context. The consequence is that in PMM‑CONNECTED state, only a signalling connection may be established. In PMM‑IDLE state, a PDP context may be established, but no corresponding connection over the Iu interface nor the radio are established.\nMoving from PMM‑DETACHED to PMM‑CONNECTED in the MS:\n-\tGPRS Attach: The MM context shall move to the PMM‑CONNECTED state when a PS signalling connection is established between the MS and the 3G‑SGSN for performing a GPRS attach. If the GPRS attach is accepted an MM context is created in the MS.\nMoving from PMM‑CONNECTED to PMM‑DETACHED in the MS:\n-\tGPRS Detach: The MM context shall move to the PMM‑DETACHED state when the PS signalling connection is released between the MS and the 3G‑SGSN after the MS has performed a GPRS detach or after the network-initiated GPRS detach is performed. The MM context in the MS may be deleted.\n-\tRAU Reject: The MM context shall move to the PMM‑DETACHED state when the PS signalling connection is released between the MS and the 3G‑SGSN after a RAU is rejected by the 3G‑SGSN. The MM context may be deleted.\n-\tGPRS Attach Reject: The MM context shall move to the PMM‑DETACHED state when the PS signalling connection is released between the MS and the 3G‑SGSN after a GPRS attach is rejected by the 3G‑SGSN. The MM context may be deleted.\nMoving from PMM‑CONNECTED to PMM‑IDLE in the MS:\n-\tPS Signalling Connection Release: The MM context shall move to the PMM‑IDLE state when the PS signalling connection is released.\nMoving from PMM‑IDLE to PMM‑CONNECTED in the MS:\n-\tPS Signalling Connection Establishment: The MM context shall move to the PMM‑CONNECTED state when the PS signalling connection is established between the MS and the 3G‑SGSN.\nMoving from PMM‑IDLE to PMM‑DETACHED in the MS:\n-\tImplicit GPRS Detach: The MM context shall locally move to the PMM‑DETACHED state, e.g. in the case of removal of the battery, the USIM, or the SIM from the TE.\nMoving from PMM‑DETACHED to PMM‑CONNECTED in the 3G‑SGSN:\n-\tGPRS Attach: The MM context shall move to the PMM‑CONNECTED state when a PS signalling connection is established between the MS and 3G‑SGSN for performing a GPRS attach. If the GPRS attach is accepted, an MM context is created in the 3G‑SGSN.\nMoving from PMM‑CONNECTED to PMM‑DETACHED in the 3G‑SGSN:\n-\tGPRS Detach: The MM context shall move to the PMM‑DETACHED state when the PS signalling connection is released between the MS and the 3G‑SGSN after the MS has performed a GPRS detach or after the network-initiated GPRS detach is performed. The MM context in the 3G‑SGSN may be deleted.\n-\tRAU Reject: The MM context shall move to the PMM‑DETACHED state when the PS signalling connection is released between the MS and the 3G‑SGSN after a RAU is rejected.\n-\tGPRS Attach Reject: The MM context shall move to the PMM‑DETACHED state when a PS signalling connection is released between the MS and the 3G‑SGSN after a GPRS attach is rejected by the 3G‑SGSN.\nMoving from PMM‑CONNECTED to PMM‑IDLE in the 3G‑SGSN:\n-\tPS Signalling Connection Release: The MM context shall move to the PMM‑IDLE state when the PS signalling connection is released.\nMoving from PMM‑IDLE to PMM‑CONNECTED in the 3G‑SGSN:\n-\tPS Signalling Connection Establishment: The MM context shall move to the PMM‑CONNECTED state when the PS signalling connection is established.\nMoving from PMM‑IDLE to PMM‑DETACHED in the 3G‑SGSN:\n-\tImplicit GPRS Detach: The MM context may locally move to the PMM‑DETACHED state after expiry of the Implicit Detach timer. The MM and PDP context(s) in the 3G‑SGSN may be deleted.",
      "chunk_type": "general",
      "cross_references": [
        "figure_17"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.1.2.4.1",
      "section_id": "6.1.2.4.1",
      "section_title": "Handling of Un-synchronous States in the UE and the Network",
      "content": "6.1.2.4.1.1\tUnsynchronous PMM states in the UE and the SGSN\nIn case of RRC connection release with cause \"Directed Signalling connection re-establishment\" or in case of an error, the PMM state of the MS and the 3G‑SGSN may lose synchronisation. In this case the MS may be in the PMM‑IDLE state while the 3G‑SGSN is in the PMM‑CONNECTED state.\nNOTE 1:\tThe opposite (MS in the PMM‑CONNECTED state and SGSN in the PMM‑IDLE state) shall never happen because the 3G‑SGSN may not have the RAI where the MS is really located, so downlink transfer is impossible until the periodic URA update timer expires.\nThis situation is recovered by a successful MS initiated connection establishment, e.g. for a RAU or for data transfer, or by a failed downlink transfer with cause \"IMSI unknown in RNC\", triggering a paging procedure from the 3G‑SGSN.\nIf the SGSN in PMM-CONNECTED state receives Iu connection establishment request from the MS, the SGSN shall ensure the new Iu connection and the existing one are for the same MS, and if so the SGSN shall process the new request and release existing Iu connection and all RABs associated with it. To ensure that the new Iu connection and the existing one are for the same MS, the SGSN may perform the security functions. If the Iu connection establishment request is for signalling only and if Direct Tunnel was established for the MS, the SGSN (in Gn/Gp mode) sends Update PDP Context Request(s) to the GGSN(s) or the SGSN (in S4/S5/S8 mode) sends Update Bearer Request to the S‑GW, to establish the GTP tunnels between SGSN and GGSN(s)/S‑GW. If the Iu connection establishment request is for data transfer the SGSN may immediately establish a new direct tunnel and, in Gn/Gp mode, send Update PDP Context Request(s) to the GGSN(s) or, in S4/S5/S8 mode, send Update Bearer Request to the S‑GW and include the RNC's Address for User Plane and, downlink TEID for data.\nThe UE shall also perform a RAU procedure immediately on entering PMM-IDLE state when it has received a RRC Connection Release message with cause \"Directed Signalling connection re-establishment\" even if the RA has not changed since the last update. The UE shall perform a subsequent Service request procedure after successful completion of the RA Update procedure to re-establish the radio access bearer when it has pending user data to send.\nNOTE 2:\tThe RNC will send a RRC CONNECTION RELEASE message with cause \"Directed Signalling Connection re-establishment\" when it is unable to contact the SRNC to validate the UE due to lack of Iur connection (see TS 25.331 [52]).\n6.1.2.4.1.2\tUnsynchronous states in the UE and the UTRAN\nIn abnormal cases, the UTRAN can believe the UE is in the RRC-CONNECTED state while the UE is actually in the RRC-IDLE state.\nSymptoms of this condition are that the UTRAN has an Iu interface connection to the SGSN and the UTRAN pages with the RNTI but receives no answer from the UE.\nFor UTRAN paging triggered by CS domain pages, the RNC should take the responsibility to recover this situation by re-paging with the Core Network Identity in the cells of that RNC which are in the Location Area indicated by the CN. A consequence of this re-paging is that it may lead to the RNC having two RRC connections for one UE but different RNTIs. To resolve this, when the RNC receives the Common ID message from the MSC, the RNC may request the release of the Iu-PS connection associated with any different RNTI previously associated with that IMSI.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.2.1",
      "section_id": "6.2.1",
      "section_title": "READY Timer Function (A/Gb mode)",
      "content": "The READY timer function maintains the READY timer in the MS and SGSN. The READY timer controls the time an MS remains in READY state in the MS and the SGSN. The READY timer shall be reset and begin running in the MS when an LLC PDU is transmitted, and in the SGSN when an LLC PDU is correctly received. When the READY timer expires, the MS and SGSN MM contexts shall return to STANDBY state.\nThe length of the READY timer shall be the same in the MS and SGSN. The initial length of the READY timer shall be defined by a default value. The SGSN, and only the SGSN, may change the length of the READY timer by transmitting a new value in the Attach Accept or Routeing Area Update Accept messages.\nIf the READY timer length is set to zero, the MS shall immediately be forced into STANDBY state. If the timer length is set to all 1s (binary), the READY timer function shall be deactivated, i.e. the timer no longer runs and the MS remains in READY state.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.2.2",
      "section_id": "6.2.2",
      "section_title": "Periodic RA Update Timer Function",
      "content": "The Periodic RA Update Timer function monitors the periodic RA update procedure in the MS. The length of the periodic RA update timer is sent in the Routeing Area Update Accept or Attach Accept message. The periodic RA update timer is unique within an RA. Upon expiry of the periodic RA update timer, the MS shall start a periodic routeing area update procedure.\nThe SGSN may allocate long periodic RAU timer value to the MS as per clause 5.3.13.5.\nIf the MS is in GERAN/UTRAN coverage but out of GERAN/UTRAN PS coverage when the periodic RA update timer expires, then, if the MS is IMSI-attached to a network in network operation mode I, the periodic location update procedure (or other appropriate location update procedure) shall be started immediately. In addition, and irrespective of whether or not the MS was IMSI-attached, regardless of the network operation mode, the periodic RA update procedure (or other appropriate update procedure) shall be started as soon as the MS returns to GERAN/UTRAN PS coverage.\nIf the MS is out of GERAN/UTRAN PS coverage or camps on E-UTRAN when the periodic RA update timer expires then:\n-\tif the MS is both IMSI- and GPRS-attached and returns to GERAN/UTRAN coverage in a cell that supports packet-domain services in network operation mode I, then the combined RA / LA update procedure with IMSI attach requested shall be started as soon as the MS returns to GERAN/UTRAN coverage;\n-\tif the MS is both IMSI- and GPRS-attached and returns to GERAN/UTRAN coverage in a cell that supports packet-domain services in network operation mode II, or if a GPRS only-attached MS returns to GERAN/UTRAN coverage in a cell that supports packet-domain services, then the periodic RA update procedure shall be started as soon as the MS returns to GERAN/UTRAN coverage; or\n-\tif the MS returns to GERAN/UTRAN coverage in a cell that does not support packet-domain services, and if the MS is IMSI-attached, then the periodic location update procedure (or other appropriate location update procedure) shall be started as soon as the MS returns to GERAN/UTRAN coverage in that cell. In addition, and irrespective of whether or not the MS was IMSI-attached, the periodic RA update procedure (or other appropriate update procedure) shall be started as soon as the MS returns to GERAN/UTRAN PS coverage.\nIf the MS lost GERAN/UTRAN PS coverage or camped on E-UTRAN but the periodic RA update timer did not expire while not camping on a GERAN/UTRAN PS cell, then the MS shall not perform the periodic RA update procedure because of the MS's return to GERAN/UTRAN PS coverage.\nIf the MS lost GERAN/UTRAN coverage or camped on E-UTRAN but the periodic RA update timer did not expire while not camping on a GERAN/UTRAN cell, the MS shall not perform the periodic RA update procedure because of the MS's return to GERAN/UTRAN coverage.\nIf the MS's periodic RAU timer expires and ISR is activated the MS shall start the GERAN/UTRAN Deactivate ISR timer. After the GERAN/UTRAN Deactivate ISR timer expires the MS shall deactivate ISR by setting its TIN to \"GUTI\".\nThe GERAN/UTRAN Deactivate ISR timer is stopped when the MS performs a successful RAU.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.13.5"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.2.3",
      "section_id": "6.2.3",
      "section_title": "Mobile Reachable Timer Function",
      "content": "The Mobile Reachable Timer function monitors the periodic RA update procedure in the SGSN. If the SGSN supports PSM the SGSN uses the function also to know when an MS is not reachable due to entering PSM. The SGSN starts the mobile reachable timer with a value slightly longer than the periodic RA update timer used by the MS. If the SGSN has allocated an Active Time to the UE, then the SGSN starts the Active Timer with the value of Active Time.\nThe Active Timer and the mobile reachable timer are stopped when the READY state or PMM‑CONNECTED state is entered. The Active Timer and the mobile reachable timer are reset and started when the state returns to STANDBY or PMM‑IDLE.\nIf the mobile reachable timer expires or the Active Timer, the SGSN can deduce that the UE is not reachable and shall clear PPF. Typically, in GPRS, this causes the SGSN to stop sending GPRS paging or CS paging messages to the MS, but other features (e.g. MSC/VLR-based call forwarding) may happen immediately. PPF is set when the next activity from the MS is detected. The MM and PDP contexts shall be kept in the SGSN.\nWhen an MS first registers in an SGSN, then PPF is set.\nThe PPF in the SGSN is specific to GERAN/UTRAN access.\nTS 23.401 [89] specifies a separate PPF for E‑UTRAN. If the SGSN is combined with an MME, the SGSN's PPF shall have no impact on whether or not the MME performs paging in E‑UTRAN.\nIf the SGSN is requested to monitor Reachability for Data and the MS enters READY state or PMM CONNECTED, the SGSN sends a Monitoring Report message to the address that was indicated in the related Monitoring Request as described in TS 23.682 [119].\nWhen the SGSN applies General NAS level Mobility Management Congestion Control to a MS, the SGSN may need to adjust the mobile reachable timer and/or implicit detach timer (as clause 5.3.6.2.4).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.6.2.4",
        "ts_23.401",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.0",
      "section_id": "6.3.0",
      "section_title": "General",
      "content": "The interactions described in this clause shall be supported if the optional Gs interface is installed. All functionality of this clause applies for A/Gb mode and Iu mode unless stated differently.\nNOTE:\tThe functionality described in this clause operates independently of whether or not the MS supports E‑UTRAN access.\nAn association is created between SGSN and MSC/VLR to provide for interactions between SGSN and MSC/VLR. The association is created when the VLR stores the SGSN number and the SGSN stores the VLR number. The association is used for co-ordinating MSs that are both GPRS-attached and IMSI-attached.\nThe association supports the following actions:\n-\tIMSI attach and detach via SGSN. This makes combined GPRS / IMSI attach and combined GPRS / IMSI detach possible, thus saving radio resources.\n-\tCo-ordination of LA update and RA update, including periodic updates, thus saving radio resources. A combined RA / LA update is sent from the MS to the SGSN. The SGSN forwards the LA update to the VLR.\n-\tPaging for a CS connection via the SGSN.\n-\tAlert procedures for non-PS services.\n-\tIdentification procedure.\n-\tMM Information procedure.\n-\tCS and PS registration coordination in networks that support network sharing as defined in TS 23.251 [83] so that a UE is registered with the same core network operator in the CS and PS domain.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.1",
      "section_id": "6.3.1",
      "section_title": "Administration of the SGSN - MSC/VLR Association",
      "content": "The SGSN ‑ MSC/VLR association is created at the following occasions:\n-\tCombined GPRS / IMSI attach.\n-\tGPRS attach when the MS is already IMSI-attached.\n-\tCombined RA / LA update when the MS performs IMSI attach and is already GPRS-attached.\n-\tCombined RA / LA update when an IMSI and GPRS-attached MS changes from an area of network operation mode II to an area of network operation mode I.\nThe association is initiated by the SGSN. The SGSN creates an association by sending a BSSAP+ message concerning a particular MS to the VLR. An SGSN that does not provide functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes uses the RAI to determine the VLR number. An SGSN that provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes uses the RAI and a hash value from the IMSI to determine the VLR number. During a CS connection, an MS in class‑B mode of operation (A/Gb mode) cannot perform GPRS attach nor routeing area updates, only MSs in class‑A mode of operation can perform these procedures. If a GPRS attach was made during a CS connection, the association shall be initiated by a combined RA / LA update after the CS connection has been released.\nThe association is updated on the following occasions:\n-\tWhen an MS changes VLR.\n-\tWhen an MS changes SGSN.\nThe association is not updated during a CS connection.\nNOTE:\tWhen the Idle mode Signalling Reduction feature described in TS 23.401 [89] is active, the association is not impacted just because of mobility between GERAN/UTRAN and E‑UTRAN, unless CS Fallback is in use (see TS 23.272 [93]).\nWhen the MS is in idle mode (see GSM 03.22 [7] and TS 23.122 [7b]), the association is updated with the combined RA / LA updates procedure.\nIn relation to a CS connection, the association is managed in the following way:\nMS in class‑A or CS/PS mode of operation:\nAn MS in class‑A or CS/PS mode of operation makes RA updates but no combined RA / LA updates during the CS connection. If the MS changes SGSN, the SGSN (according to normal RA update procedures, see clause \"Inter SGSN Routeing Area Update\") updates the HLR and the GGSN, but not the VLR, about the new SGSN number.\nIf the MS changes MSC during the CS connection, the subscriber data still remains in the old VLR until the CS connection is released and a combined RA / LA update or LA update is made. The association is also not updated during the CS connection.\nAfter the CS connection has been released, a combined RA / LA update is performed (if there has been a change of RA, or if a GPRS attach was performed and the new cell indicates network operation mode I), and the association is updated according to combined RA / LA update procedures, see clause \"Combined RA / LA Update Procedure\". If the new cell indicates network operation mode II, then the MS performs an LA update.\nMS in class‑B mode of operation (A/Gb mode):\nAn MS in class‑B mode of operation does not make any RA updates during a CS connection. The SGSN number therefore remains the same during the CS connection and does not need to be updated in the VLR. If the MS changes MSC during the CS connection, the subscriber data still remains in the old VLR until the CS connection has been released and a combined RA / LA update or LA update is made. Therefore, the VLR number remains the same during the CS connection. After the CS connection has been released, the MS performs an RA update and an LA update if the RA has changed and the new cell indicates network operation mode II, or a combined RA / LA update if the RA has changed and the new cell indicates network operation mode I. The association is updated according to the combined RA / LA update procedures, see clauses \"Inter SGSN Routeing Area Update\" and \"Combined RA / LA Update Procedure\".\nThe SGSN - MSC/VLR association is removed at the following occasions:\n-\tAt IMSI detach.\n-\tAt GPRS detach.\n-\tSGs association establishment, see TS 23.272 [93].\nWhen the MSC/VLR receives an LA update via the A or Iu interface from an MS or establishes a SGs association with an MME for which a Gs association exists for that MS, the MSC/VLR shall remove the association without notifying the SGSN. When the SGSN receives a (non-combined) RA update from an MS for which an association exists, the SGSN shall remove the association without notifying the MSC/VLR. When the MSC/VLR receives a BSSAP+ MS Unreachable message from the SGSN indicating that PPF is cleared, the state of the association shall not be changed at the MSC/VLR.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401",
        "ts_23.272",
        "ts_23.122"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.2",
      "section_id": "6.3.2",
      "section_title": "Combined RA / LA Updating",
      "content": "When the MS is both IMSI and GPRS-attached, the LA and RA updating is done in a co-ordinated way to save radio resources if supported by the network operation mode. When the MS enters a new RA in network operation mode I, the MS sends a Routeing Area Update Request message to the SGSN, as described in clause \"Combined RA / LA Update Procedure\". The LA update is included in the RA update. The SGSN then forwards the LA update to the MSC/VLR. The MSC/VLR optionally returns a new VLR TMSI that is sent to the MS via the SGSN.\nAn MS in class‑A mode of operation involved in a CS connection makes only RA updates and no combined RA / LA updates to the SGSN.\nAn MS in CS/PS mode of operation involved in a CS connection makes only RA updates and no combined RA / LA updates to the SGSN.\nAn MS in class‑B mode of operation involved in a CS connection does not make any updates during the CS connection.\nAn MS in class‑C mode of operation never makes combined RA / LA updates. MSs in CS mode of operation and MSs in PS mode of operation never make combined RA / LA updates.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.3.3",
      "section_id": "6.3.3",
      "section_title": "CS Paging (A/Gb mode)",
      "content": "When an MS is both IMSI and GPRS-attached in a network that operates in mode I, the MSC/VLR executes paging for circuit-switched services via the SGSN. If the MS is in STANDBY state, it is paged in the routeing area and in the null routeing area (see clause \"Routeing Area Identity \"). If the MS is in READY state, it is paged in the cell. A paging timer in the MSC supervises the paging procedure. The SGSN converts the MSC paging message into an SGSN paging message.\nThe CS Paging procedure is illustrated in figure 18. Each step is explained in the following list.\nFigure 18: CS Paging Procedure in A/Gb mode\n1)\tThe SGSN receives a Page (IMSI, VLR TMSI, Channel Needed, Priority, Location Information) message from the MSC. Channel Needed is defined in TS 48.008 [18] and indicates to the MS which type of CS channel is needed to be requested in the response. VLR TMSI and Channel Needed are optional parameters. Priority is the circuit-switched paging priority parameter as defined in TS 48.008 [18].\n2)\tThe SGSN sends a BSSGP Paging Request (IMSI, TLLI, VLR TMSI, Area, Channel Needed, QoS) message to the BSS serving the MS. Area is derived from either the MS's MM context in the SGSN or, if no such information is available, from the Location Information received from the MSC/VLR. Area indicates a single cell for a READY state MS or a routeing area for a STANDBY state MS. VLR TMSI and Channel Needed are included if received from the MSC. If Channel Needed was not received from the MSC, then a default Channel Needed parameter indicating circuit-switched paging is included by the SGSN. QoS indicates the priority of this Paging Request relative to other Paging Request messages buffered in the BSS. If the location area where the MS was last known to be located has an associated null routeing area, then the SGSN shall send an additional BSSGP Paging Request message to each BSS serving this null RA.\n3)\tThe BSS translates the incoming BSSGP Paging Request message into one radio Paging Request message per cell. If a dedicated radio resource is assigned to the MS in a cell, then the BSS transmits one Paging Request (VLR TMSI or IMSI, Channel Needed) message on this radio resource, without stopping possibly ongoing data transfers for the MS. Otherwise, the BSS pages the MS with one Paging Request (VLR TMSI or IMSI, Channel Needed) message on the appropriate paging channel in each addressed cell. This is described in TS 43.064 [11].\n4)\tUpon receipt of a Paging Request message for a circuit-switched service the MS may accept to respond to this request and shall follow the CS procedures for paging response (random access, immediate assignment, and paging response) as specified in TS 24.008 [13].\n5)\tWhen received at the BSS, the Paging Response message is sent to the MSC, which shall stop the paging response timer.",
      "chunk_type": "general",
      "cross_references": [
        "figure_18",
        "ts_48.008",
        "ts_43.064",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.3.1",
      "section_id": "6.3.3.1",
      "section_title": "Paging Co-ordination in A/Gb mode",
      "content": "The network may provide co-ordination of paging for circuit-switched and packet-switched services. Paging co-ordination means that the network sends paging messages for circuit-switched services on the same channel as used for packet-switched services, i.e. on the GPRS paging channel or on the GPRS traffic channel, and the MS needs only to monitor that channel. Three network operation modes are defined:\n-\tNetwork operation mode I: the network sends a CS paging message for a GPRS-attached MS, either on the same channel as the GPRS paging channel (i.e. the packet paging channel or the CCCH paging channel), or on a GPRS traffic channel. This means that the MS needs only to monitor one paging channel, and that it receives CS paging messages on the packet data channel when it has been assigned a packet data channel.\n-\tNetwork operation mode II: the network sends a CS paging message for a GPRS-attached MS on the CCCH paging channel, and this channel is also used for GPRS paging. This means that the MS needs only to monitor the CCCH paging channel, but that e.g. CS paging continues on this paging channel even if the MS has been assigned a packet data channel, unless BSS paging co-ordination as described in 8.1.6 is active.\n-\tNetwork operation mode III: the network sends a CS paging message for a GPRS-attached MS on the CCCH paging channel, and sends a GPRS paging message on either the packet paging channel (if allocated in the cell) or on the CCCH paging channel. This means that an MS that wants to receive pages for both circuit-switched and packet-switched services shall monitor both paging channels in the cell, if the packet-paging channel is allocated. The core network performs no paging co-ordination. See, however, also 8.1.6 for description of paging co-ordination on BSS level.\nTable 2: Paging Channel Configuration in different Network Operation Modes for A/Gb mode without BSS paging co-ordination\nMode\nCircuit Paging Channel\nGPRS Paging Channel\nCN Paging co-ordination\nPacket Paging Channel\n(NOTE 1)\nPacket Paging Channel\n(NOTE 1)\nCCCH Paging Channel\nCCCH Paging Channel\nYes\nPacket Data Channel\nNot Applicable\nCCCH Paging Channel\nCCCH Paging Channel\nNo\nCCCH Paging Channel\nPacket Paging Channel\n(NOTE 1)\nNo\nCCCH Paging Channel\nCCCH Paging Channel\nNOTE 1:\tSince Release 9 GERAN TS 44.060 [77] forbid deploying Packet Common Control Channels. This makes use of NMO-III and packet paging channel obsolete.\nFor MSs with an SGSN – MSC/VLR association, which is established via the GS interface, all MSC-originated paging of GPRS-attached MSs shall go via the SGSN, thus allowing network co-ordination of paging. Paging co-ordination shall be made by the SGSN based on the IMSI, and is provided independently of whether the MS is in STANDBY or in READY state. The network operates in mode I.\nWhen no SGSN – MSC/VLR association exists, all MSC-originated paging of GPRS-attached MSs shall go via the A interface, and co-ordination of paging cannot be performed by the core network. The network shall then operate in mode II, meaning that the packet common control channel shall not be allocated in the cell.\nThe network operation mode (mode I or II) shall be indicated as system information to MSs. Additional system information can indicate that MSs configured to use the extended NMO I system information (see TS 24.368 [111]) shall use NMO I, regardless of what NMO is indicated by system information for other MSs. If this additional system information is absent, MSs configured to use the extended NMO I system information shall use the system information that represents the network operation mode for other MSs. From these indications, the MS determines which mode applies to it. That mode shall be used when using the procedures described in other clauses of this specification.\nFor proper operation, the mode of operation should be the same in each cell of a routeing area.\nBased on the system information provided by the network, the MS can then choose, according to its capabilities, whether it can attach to GPRS services, to non-GPRS services, or to both.",
      "chunk_type": "general",
      "cross_references": [
        "table_2",
        "ts_44.060",
        "ts_24.368"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.4",
      "section_id": "6.3.4",
      "section_title": "CS Paging (Iu mode)",
      "content": "When an MS is both IMSI- and GPRS-attached in a network that operates in mode I, the MSC/VLR executes paging for circuit-switched services via the SGSN.\nIn the MSC, a paging timer supervises the paging procedure.\nThe CS Paging procedure is illustrated in Figure 19. Each step is explained in the following list.\nFigure 19: CS Paging Procedure in Iu mode\n1)\tThe SGSN receives a Page (IMSI, VLR TMSI, Location Information) message from the MSC. If VLR TMSI is omitted, the IMSI is used instead of the TMSI as a paging address at the radio interface. If location information is not included, the SGSN shall page the MS in all the cells served by the VLR and the SGSN, unless the SGSN has reliable information about the location of the MS.\nNOTE 1:\tIf the PS network support paging optimization and MS has Emergency Service in CS domain, CS paging procedure via SGSN may fail.\n2)\tThe 3G‑SGSN sends a RANAP Paging (IMSI, TMSI, Area, CN Domain Indicator) message to each RNS. IMSI is needed by the RNS in order to calculate the MS paging group and to identify the paged MS. TMSI is included if received from the MSC. Area indicates the area in which the MS is paged, and is derived from either the MS's MM context in the SGSN or, if no such information is available, from the Location Information received from the MSC/VLR. CN Domain Indicator indicates which domain (CS or PS) initiated the paging message, and in this case it must be set to \"CS\" by the SGSN. The list of CSG IDs for paging is included when the SGSN is configured to support paging optimisation described in clause 5.3.9. For paging optimisation, the CSG IDs of expired CSG subscriptions and valid CSG subscriptions are both included in the list.\nNOTE 2:\tAn expired CSG subscription indicates that the MS is not allowed service in the CSG. However, since the removal of the CSG from the MS is pending, it is possible the MS will camp on that CSG and therefore the MS is still paged for the CSG.\n3)\tFor more details on the radio resource part of the paging procedure, see clause \"Paging Initiated by CN\".\n4)\tUpon receipt of a Paging Request message for a circuit-switched service, the MS responds to this request and returns the paging response as specified in TS 44.018 [85] in an RRC Initial Direct Transfer message as specified in TS 25.331 [52]. CN Domain Indicator is set to \"CS\" in the Initial Direct Transfer message.\n5)\tWhen received at the RNS, the Paging Response message is sent in an RANAP Initial UE message to the MSC, which shall then stop the paging response timer.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.9",
        "figure_19",
        "ts_44.018",
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.4.1",
      "section_id": "6.3.4.1",
      "section_title": "Network Operation Modes for Iu mode",
      "content": "The network operation mode is used to indicate whether the Gs interface is installed or not. When the Gs interface is present, MSs initiate combined procedures.\nTable 3-1: Network Operation Modes for Iu mode\nMode\nNetwork configuration\nCombined procedure by MT\nGs interface is present\nYes\nGs interface is not present\nNo\nThe network operation mode (mode I or II) shall be indicated as system information to the MSs. Additional system information can indicate that MSs configured to use the extended NMO I system information shall use NMO I, regardless of what NMO is indicated by system information for other MSs. If this additional system information is absent, MSs configured to use the extended NMO I system information shall use the system information that represents the network operation mode for other MSs. From these indications, the MS determines which mode applies to it. That mode shall be used when using the procedures described in other clauses of this specification.\nFor proper operation, the mode of operation should be the same in each cell of a routeing area.\nBased on the system information provided by the network, the MS derives whether to initiate combined update procedures or separate update procedures.\nNOTE:\tNetwork operation modes I and II for Iu mode correspond to modes I and II for A/Gb mode, respectively.\n6.3.4a\tCS Paging (in case Selective RA Update)\nWhen an MS is both IMSI- and GPRS-attached in a network that operates in mode I, and the MSC/VLR executes paging for circuit-switched services via the SGSN that support Selective RA Update Procedure, if the MS is in STANDBY or PMM-IDLE state, the SGSN shall cause the page to be sent in all cells in the routeing area where the MS is located. This can include both A/Gb mode and Iu mode cells (see clause \"Selective RA Update\").\nThe CS Paging procedure in A/Gb mode is illustrated in figure 18 and the CS Paging procedure in Iu mode is illustrated in figure 19.",
      "chunk_type": "general",
      "cross_references": [
        "table_3-1",
        "figure_18",
        "figure_19"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.5",
      "section_id": "6.3.5",
      "section_title": "Non-GPRS Alert",
      "content": "The MSC/VLR may request an SGSN to report activity from a specific MS. In this case, the MSC/VLR shall send a BSSAP+ Alert Request (IMSI) message to the SGSN where the MS is currently GPRS-attached.\nUpon reception of the Alert Request (IMSI) message, the SGSN shall set NGAF. If NGAF is set for an MS, the SGSN shall inform the MSC/VLR when the next activity from that MS (and the MS is both IMSI- and GPRS-attached) is detected, and shall clear NGAF.\nIf the activity detected by the SGSN leads to a procedure towards the MSC/VLR, the SGSN shall just follow this procedure. If the activity detected by the SGSN does not lead to any procedure towards the MSC/VLR, the SGSN shall send an MS Activity Indication (IMSI) message towards the MSC/VLR.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.3.6",
      "section_id": "6.3.6",
      "section_title": "MS Information Procedure",
      "content": "When the MS is marked at the VLR as both IMSI- and GPRS-attached, the VLR may perform the MS Information procedure via the SGSN. If the information requested by the VLR in the MS Information procedure is known by the SGSN, then the SGSN shall return this information to the VLR without interrogating the MS.\nIf the information requested is MS identity information (e.g. IMEI) that is not known by the SGSN but is known by the MS, then the SGSN shall interrogate the MS in a similar manner to that described in clause \"Identity Check Procedures\".\nIn A/Gb mode, if the information requested is MS location information, then this indicates a request for Cell Global Identity and Cell Identity Age. In Iu mode, if the information requested is MS location information, then this indicates a request for Service Area Identity and Service Area Identity Age, and in this case if an Iu connection for the MS exists, then the SGSN shall use the Location Reporting procedure (see clause \"Location Reporting Procedure\") in order to retrieve the Service Area Identity.\nThe MS Information procedure is illustrated in Figure 20. Procedure steps are explained in the following list.\nFigure 20: MS Information Procedure\n1)\tThe MSC/VLR sends an MS Information Request (IMSI, Information Type) message to the SGSN. Information Type indicates the information that the MSC/VLR is requesting for that IMSI.\n2)\tIf the information requested is not known by the SGSN but should be known by the MS, then the SGSN interrogates the MS in a similar manner to that described in the clause \"Identity Check Procedures\". The SGSN sends an Identity Request (Identity Type) message to the MS.\n3)\tThe MS responds with an Identity Response (Mobile Identity) message to the SGSN.\n4)\tIn Iu mode, if an Iu connection for the MS exists, then the SGSN shall use the Location Reporting procedure to retrieve the Service Area Identity. If the BSS/RNS cannot determine the current Service Area of the MS, it indicates in the Location Report message that the request could not be fulfilled and may report the Last Known Service Area with an indication of how long has past since the MS was known to be in the indicated Service Area.\n5)\tThe SGSN sends an MS Information Response (IMSI, Information) message to the MSC/VLR. Information contains the information requested by the MSC/VLR.If an Iu connection for MS exist and RAN node cannot determine current Service Area and Last Known Service Area is not reported, the SGSN shall include in the MS Information Response message the last successfully received Service Area Identity with time elapsed since it was saved by SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_20"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.3.7",
      "section_id": "6.3.7",
      "section_title": "MM Information Procedure",
      "content": "When the MS is marked at the VLR as both IMSI- and GPRS-attached, the VLR may perform the MM Information procedure via the SGSN. The MM Information procedure is typically used to inform the MS about such things as the network name and the local time zone of the mobile.\nThe MM Information procedure is illustrated in Figure 21.\nFigure 21: MM Information Procedure\n1)\tThe SGSN receives an MM Information (IMSI, Information) message from the MSC/VLR. Information is the information that the MSC/VLR is sending to the MS.\n2)\tThe SGSN sends an MM Information (Information) message to the MS including the information received by the MSC/VLR.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_21"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.4",
      "section_id": "6.4",
      "section_title": "MM Procedures",
      "content": "In A/Gb mode, the MM procedures shall use the LLC and RLC/MAC protocols for message transmission across the Gb and Um interfaces. The MM procedures shall provide information to the underlying layers to enable reliable transmission of MM messages on the Um interface. TS 43.064 [11] defines the mapping between LLC and the radio channels used.\nIn Iu mode, the MM procedures shall use the RANAP and RRC protocols for message transmission across the Iu and radio interfaces, respectively.\nFurthermore, the MM procedures use MAP interfaces between Gn/Gp SGSN and HLR (Gr), and between SGSN and EIR (Gf), and a BSSAP+ interface between SGSN and MSC/VLR (Gs). Between S4-SGSN and HSS, the interface is Diameter based (S6d).\nHowever, to assist with SGSN transition the use of MAP based Gr between the S4-SGSN and HSS is not precluded.\nUser data can in general be transmitted during MM signalling procedures. In A/Gb mode, user data transmitted during attach, authentication, and routeing area update procedures may be lost and may therefore have to be retransmitted. In order to minimise the need for retransmission, the MS and SGSN should not transmit user data during attach and authentication procedures. In case of routeing area update procedures, the user data transfer is allowed with restriction specified in description of these procedures in clauses 6.9.1.2 and 6.9.1.3.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_43.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.5.0",
      "section_id": "6.5.0",
      "section_title": "General",
      "content": "An MS shall perform a GPRS Attach to the SGSN in order to obtain access to the GPRS services. If the MS is connected in A/Gb mode, it shall perform an A/Gb mode GPRS Attach procedure. If the MS is connected via in Iu mode, it shall perform an Iu mode GPRS Attach procedure.\nIn the attach procedure, the MS shall provide its identity and an indication of which type of attach that is to be executed. The identity provided to the network shall be the MS's Packet TMSI (P‑TMSI) if it has a valid P-TMSI, otherwise it shall be the IMSI. The P-TMSI may be derived from a GUTI when the MS is E-UTRAN capable or may be a stored native P-TMSI from a previous GPRS registration (e.g. upon mobility from the 5G System). If the MS does not have a valid P‑TMSI or a valid GUTI, the MS shall provide its IMSI. For emergency attach, the IMEI shall be included when the MS has no IMSI, no valid GUTI and no valid P‑TMSI.\nIn order to limit load on the network, only when performing a GPRS Attach with a new PLMN (i.e. not the registered PLMN or an equivalent PLMN of the registered PLMN), an MS configured to perform Attach with IMSI at PLMN change (see TS 24.368 [111]) shall identify itself with its IMSI instead of any stored temporary identifier.\nDuring the Attach procedure, the MS provides its PS Handover and inter-RAT Handover capabilities in the Attach Request message. The SGSN uses the inter-RAT indicator and/or other indicators to ask the MS (using the Attach Accept message) to send the other RAT's Radio Access Capabilities in Iu mode and UTRAN Radio Access Capabilities in A/Gb mode in the Attach Complete message.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_24.368"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.5.1",
      "section_id": "6.5.1",
      "section_title": "A/Gb mode GPRS Attach Procedure",
      "content": "A GPRS attach is made to the SGSN. A GPRS-attached MS makes IMSI attach via the SGSN with the combined RA / LA update procedure if the network operation mode is I. In network operation mode II, or if the MS is not GPRS-attached, the MS makes an IMSI attach as already defined in A/Gb mode. An IMSI-attached MS in class‑A mode of operation engaged in a CS connection shall use the (non-combined) GPRS Attach procedures when it performs a GPRS attach.\nThe SGSN indicates \"SMS-Supported\" to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS services and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN.\nAt the RLC/MAC layer, the MS shall identify itself with a Local or Foreign TLLI if the MS is already GPRS-attached and is performing an IMSI attach. Otherwise, the MS shall identify itself with a Foreign TLLI, or a Random TLLI if a valid P‑TMSI is not available. The Foreign or Random TLLI is used as an identifier during the attach procedure until a new P‑TMSI is allocated.\nAfter having executed the GPRS attach, the MS is in READY state and MM contexts are established in the MS and the SGSN. The MS may then activate PDP contexts as described in clause \"Activation Procedures\".\nAn IMSI-attached MS that can only operate in class‑C mode of operation shall follow the normal IMSI detach procedure before it makes a GPRS attach. A GPRS-attached MS in class‑C mode of operation shall always perform a GPRS detach before it makes an IMSI attach.\nIf the network operates in mode I (see clause \"Paging Co-ordination in A/Gb mode\"), then an MS that is both GPRS-attached and IMSI-attached shall perform the Combined RA / LA Update procedures.\nIf the network operates in mode II, then a GPRS-attached MS that has the capability to be simultaneously GPRS-attached and IMSI-attached shall perform the (non-combined) Routeing Area Update procedures, and either:\n-\taccess the non-GPRS common control channels for CS operation (the way that CS operation is performed in parallel with GPRS operation is an MS implementation issue outside the scope of the present document); or\n-\tif CS operation is not desired, depending on system information that defines whether or not explicit detach shall be used, either:\n-\tavoid all CS signalling (in which case the MS may be implicitly IMSI detached after a while); or\n-\tperform an explicit IMSI detach via the non-GPRS common control channels (if the MS was already IMSI-attached).\nThe Combined GPRS / IMSI Attach procedure is illustrated in Figure 22.\nIf the MS needs to use extended idle mode DRX, the MS includes the extended idle mode DRX parameters information element in the Attach Request message. If the SGSN decides to enable extended idle mode DRX it includes the extended idle mode DRX parameters information element in the Attach Accept message.\nThe MS indicates its capability of supporting restriction of use of Enhanced Coverage in the Attach Request message. If the MS includes the capability of supporting restriction of use of Enhanced Coverage, SGSN sends Enhanced Coverage Restricted parameter received from the HLR to the MS in the Attach Accept message.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_22"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.5.2",
      "section_id": "6.5.2",
      "section_title": "Iu mode GPRS Attach Procedure",
      "content": "A GPRS-attached MS makes an IMSI attach via the SGSN with the combined RA / LA update procedure if the network operates in mode I. If the network operates in mode II, or if the MS is not GPRS-attached, the MS makes a normal IMSI attach. An IMSI-attached MS engaged in a CS connection shall use the (non-combined) GPRS Attach procedure when it performs a GPRS attach.\nThe SGSN indicates \"SMS-Supported\" to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS services and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN.\nAfter having executed the GPRS attach, the MS is in the PMM‑CONNECTED state and MM contexts are established in the MS and the SGSN. The MS may then activate PDP contexts as described in clause \"Activation Procedures\".\nAn IMSI-attached MS that cannot operate in CS/PS mode of operation shall follow the normal IMSI detach procedure before it makes a GPRS attach. A GPRS-attached MS that cannot operate in CS/PS mode of operation shall perform a GPRS detach before it makes an IMSI attach.\nIn networks that support network sharing as defined in TS 23.251 [83], the SGSN may be informed by the RNS about the identity of the selected core network operator when receiving the Attach Request message. If available, this information is stored in the SGSN MM context.\nDuring the GPRS Attach procedure, if the SGSN supports SRVCC and if any of the conditions described in step 7 in Figure 22 are satisfied, if the UE SRVCC capability has changed, it notifies the HSS with the UE SRVCC capability e.g. for further IMS registration.\nFor emergency attach handling, see clause 5.10.3.\nFor Emergency Attach only GPRS emergency attach is performed and no combined GPRS and IMSI attach is specified.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.10.3",
        "figure_22",
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.5.3",
      "section_id": "6.5.3",
      "section_title": "Combined GPRS / IMSI Attach procedure",
      "content": "The Combined GPRS / IMSI Attach procedure is illustrated in Figure 22.\nFigure 22: Combined GPRS / IMSI Attach Procedure\nNOTE 1:\tAll steps except steps 6 and 7d, 7e are common for architecture variants using Gn/Gp based interaction with GGSN and using S4-based interaction with S‑GW and P‑GW. For an S4-based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 6.5.3A and procedure steps (B) are defined in clause 6.5.3B.\nNOTE 2:\tFor an Emergency Attach in which the MS was not successfully authenticated, steps 6, 7, 8 and 11 are not performed.\n1)\tIn A/Gb mode, the MS initiates the attach procedure by the transmission of an Attach Request (IMSI or P‑TMSI and old RAI, MS Radio Access Capability, MS Network Capability, CKSN, Attach Type, DRX Parameters, extended idle mode DRX parameters, old P‑TMSI Signature, additional P-TMSI, Voice domain preference and UE's usage setting, SMS-only, Support for restriction of use of Enhanced Coverage) message to the SGSN. IMSI shall be included if the MS does not have a valid P‑TMSI available, or, if the MS is configured to perform Attach with IMSI at PLMN change and is accessing a new PLMN. If the MS has a valid P‑TMSI or a valid GUTI, then P‑TMSI and the old RAI associated with P‑TMSI shall be included. MS Radio Access Capability contains the MS's GPRS multislot capabilities, frequency bands, etc. as defined in TS 24.008 [13]. Attach Type indicates which type of attach is to be performed, i.e. GPRS attach only, GPRS Attach while already IMSI attached, or combined GPRS / IMSI attach. If the MS uses P‑TMSI for identifying itself and if it has also stored its old P‑TMSI Signature, then the MS shall include the old P‑TMSI Signature in the Attach Request message. The MS includes the extended idle mode DRX parameters information element if the MS needs to enable extended idle mode DRX.\nFor Iu mode, the MS initiates the attach procedure by the transmission of an Attach Request (IMSI or P‑TMSI and old RAI, Core Network Classmark, KSI, Attach Type, old P‑TMSI Signature, Follow On Request, DRX Parameters, additional P-TMSI, SMS-only) message to the SGSN. IMSI shall be included if the MS does not have a valid P‑TMSI available or a valid GUTI. If the MS uses P‑TMSI for identifying itself and if it has also stored its old P‑TMSI Signature, then the MS shall include the old P‑TMSI Signature in the Attach Request message. If the MS has a valid P‑TMSI, then P‑TMSI and the old RAI associated with P‑TMSI shall be included. KSI shall be included if the MS has valid security parameters. Core Network Classmark is described in clause \"MS Network Capability\". The MS shall set \"Follow On Request\" if there is pending uplink traffic (signalling or user data). The SGSN may use, as an implementation option, the follow on request indication to release or keep the Iu connection after the completion of the GPRS Attach procedure. Attach Type indicates which type of attach is to be performed, i.e. GPRS attach only, GPRS Attach while already IMSI attached, or combined GPRS / IMSI attach.\nIn both A/Gb and Iu mode, the DRX Parameters contain information about DRX cycle length for GERAN, UTRAN and possibly other RATs, e.g. E-UTRAN.\nIf the MS initiates the Attach procedure at a CSG cell or a hybrid cell, the RAN indicates the CSG ID of the cell with the Attach Request message sent to the new SGSN. If the MS attaches via a hybrid cell, the RAN indicates the CSG access mode to the new SGSN. If the CSG access mode is not indicated but the CSG ID is indicated, the SGSN shall consider the cell as a CSG cell.\nThe E-UTRAN capable MS stores the TIN in detached state. If the MS's TIN indicates \"P-TMSI\" or \"RAT related TMSI\" and the MS holds a valid P-TMSI then the \"old P-TMSI\" IE indicates this valid P-TMSI. If the MS's TIN indicates \"GUTI\" and the MS holds a valid GUTI then the \"old P-TMSI\" IE indicates a P-TMSI mapped from the GUTI. If the UE has a valid NAS token, the truncated NAS token shall be included in the \"old P-TMSI signature\" IE as described in TS 33.401 [91]. Otherwise, an empty NAS token shall be included in the \"old P-TMSI Signature\" IE.\nMapping a GUTI to P‑TMSI/RAI is specified in TS 23.003 [4]. If the MS holds a valid P-TMSI then the MS indicates the P-TMSI as additional P-TMSI, regardless whether the \"old P-TMSI\" IE also indicates this P-TMSI or a P-TMSI mapped from a GUTI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nFor an Emergency Attach the MS shall indicate emergency service and the IMSI shall be included if the MS does not have a valid P-TMSI or a valid GUTI available. The IMEI shall be included when the MS has no valid IMSI, no valid P-TMSI and no valid GUTI. The UE shall set the \"Follow On Request\" to indicate that there is pending uplink traffic and the UE shall initiate the activation of an emergency PDP context after successful Emergency Attach.\nIf the SGSN is not configured to support Emergency Attach the SGSN shall reject any Attach Request that indicates emergency service.\nThe MS indicates its \"SMS-only\" capability during a combined GPRS / IMSI attach when the MS is requesting IMSI attach only for obtaining SMS and not any other services from CS domain.\n2)\tIf the MS identifies itself with P‑TMSI and the SGSN has changed since detach, the new SGSN sends an Identification Request (P‑TMSI, old RAI, old P‑TMSI Signature) to the old SGSN (this could be an old MME) to request the IMSI. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI and send the Identification Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI and relay the message to that actual old SGSN. The old SGSN responds with Identification Response (IMSI, Authentication Triplets or Authentication Quintets). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN also validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. If the old SGSN is a MME and the truncated NAS token is included in the \"old P-TMSI Signature\" IE, this validation checks the NAS token as described in TS 33.401 [91].\nFor an Emergency Attach if the MS identifies itself with a temporary identity that is not known to the SGSN, the SGSN shall immediately request the IMSI from the MS. If the UE identifies itself with IMEI, the IMSI request shall be skipped.\n3)\tIf the MS is unknown in both the old and new SGSN, the SGSN sends an Identity Request (Identity Type = IMSI) to the MS. The MS responds with Identity Response (IMSI).\n4)\tThe authentication functions are defined in the clause \"Security Function\". If no MM context for the MS exists anywhere in the network, then authentication is mandatory. Ciphering procedures are described in clause \"Security Function\". If P‑TMSI allocation is going to be done and the network supports ciphering, the network shall set the ciphering mode.\nIf the SGSN is configured to support Emergency Attach for unauthenticated IMSIs and the MS indicated emergency service, the SGSN skips the authentication and security setup or the SGSN accepts that the authentication may fail and continues the attach procedure. If the MS is emergency attached and not successfully authenticated, integrity protection and ciphering shall not be performed.\n5)\tThe equipment checking functions are defined in the clause \"Identity Check Procedures\". Equipment checking is optional.\nFor an Emergency Attach, the MS may have included the IMEI in the Attach Request message. If not, and the IMSI cannot be authenticated, the SGSN shall retrieve the IMEI from the MS.\nFor an Emergency Attach, the IMEI check to the EIR may be performed. If the IMEI is blocked, operator policies determine whether the Emergency Attach procedure continues or is stopped.\n6)\tIf there are active PDP contexts in the new SGSN for this particular MS (i.e. the MS re-attaches to the same SGSN without having properly detached before), the new SGSN deletes these PDP contexts by sending Delete PDP Context Request (TEID) messages to the GGSNs involved. The GGSNs acknowledge with Delete PDP Context Response (TEID) messages.\n7)\tIf the SGSN number has changed since the GPRS detach, or if it is the very first attach, or if the Automatic Device Detection (ADD) function is supported and the IMEISV has changed (see TS 22.101 [82] for ADD functional requirement), or if the MS provides an IMSI or the MS provides an old P-TMSI/RAI which doesn't point to a valid context in the SGSN, or for some network sharing scenario (e.g. GWCN) if the PLMN-ID of the RAI supplied by the RNC is different from that of the RAI in the UE's context, then the SGSN informs the HLR:\na)\tThe SGSN sends an Update Location (SGSN Number, SGSN Address, IMSI, IMEISV, Update Type, Homogenous Support of IMS Voice over PS Sessions, UE SRVCC capability, equivalent PLMN list, Registration For SMS Request, SMS in SGSN offered) to the HLR. IMEISV is sent if the ADD function is supported. Update Type indicates an initial attach via initial attach indicator as this is an Attach procedure. The inclusion of the equivalent PLMN list indicates that the SGSN supports the inter-PLMN handover to a CSG cell in an equivalent PLMN using the subscription information of the target PLMN. If the S6d interface is used between S4-SGSN and HSS, a parameter \"SMS in SGSN offered\" is included in the Update Location message. When Gr is used, this parameter is included in the Insert Subscriber Data Ack (Step 7g). \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN.\nThe \"Homogenous Support of IMS Voice over PS Sessions\" indication (see clause 5.3.8A) shall not be included unless the SGSN has completed its evaluation of the support of \"IMS voice over PS Session\" as specified in clause 5.3.8.\nNOTE 3:\tAt this step, the SGSN may not have all the information needed to determine the setting of the IMS voice over PS Session Supported indication for this MS (see clause 5.3.8). Hence the SGSN can send the \"Homogenous Support of IMS Voice over PS Sessions\" later on in this procedure.\nIf the SGSN determines that only the UE SRVCC capability has changed, the SGSN sends a GPRS Update Location to the HSS to inform about the changed UE SRVCC capability.\nb)\tThe HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN. Also, because the Update Type indicates an initial attach via initial attach indicator, if the HSS has the MME registration, the HSS sends Cancel Location (IMSI, Cancellation Type) to the old MME. The Cancellation Type indicates the old MME or SGSN to release the old Serving GW / PDN GW resource.\nc)\tThe old SGSN acknowledges with Cancel Location Ack (IMSI). If there are any ongoing procedures for that MS, the old SGSN shall wait until these procedures are finished before removing the MM and PDP contexts.\nd)\tIf there are active PDP contexts in the old SGSN for this particular MS, the old SGSN deletes these PDP contexts by sending Delete PDP Context Request (TEID) messages to the GGSNs involved.\ne)\tThe GGSNs acknowledge with Delete PDP Context Response (TEID) messages.\nf)\tThe HLR sends Insert Subscriber Data (IMSI, Subscription Data) to the new SGSN. If the S6d interface is used between an S4-SGSN and HSS the message \"Insert Subscriber Data\" is not used. Instead, the Subscription Data is sent by HSS in the message Update Location Ack. (Step 7h). The subscription data may contain the CSG subscription data for the PLMN and the WLAN offloadability indication (see clause 5.3.21).\nThe subscription data may contain Enhanced Coverage Restricted parameter. If received from the HLR, SGSN stores this Enhanced Coverage Allowed parameter in the SGSN MM context.\nIf the MS initiates the Attach procedure at a CSG cell, the new SGSN shall check whether the CSG ID and associated PLMN is contained in the CSG subscription and is not expired. If the CSG ID and associated PLMN is not present or expired, the SGSN shall send an Attach Reject message to the MS with an appropriate cause value. The MS shall remove the CSG ID and associated PLMN from its Allowed CSG list, if present.\ng)\tThe new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions or access restrictions (see clause 5.3.19) e.g. CSG restrictions, the MS is not allowed to attach in the RA, the SGSN rejects the Attach Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If subscription checking fails for other reasons, the SGSN rejects the Attach Request with an appropriate cause and returns an Insert Subscriber Data Ack (IMSI, Cause) message to the HLR. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the Attach Request message. If all checks are successful then the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI, SMS in SGSN offered) message to the HLR. The \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN. If the S6d interface is used between S4-SGSN and HSS the message \"Insert Subscriber Data Ack\" is not used. Instead the subscription data check performed by S4-SGSN is done when the S4-SGSN has received the message \"Update Location Ack\" from HSS (Step 7h).\nh)\tThe HLR acknowledges the Update Location message by sending an Update Location Ack to the SGSN after the cancelling of old MM context and insertion of new MM context are finished. If the S6d interface is used the Update Location Ack messages includes the subscription Data. The subscription data may contain Enhanced Coverage Restricted parameter. If received from the HSS, SGSN stores this Enhanced Coverage Allowed parameter in the SGSN MM context. The subscription data may contain the WLAN offloadability indication (see clause 5.3.21). If the Update Location is rejected by the HLR, the SGSN rejects the Attach Request from the MS with an appropriate cause. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the Attach Request message.\nIf the HLR accepts to register the SGSN identity for terminating SMS services, the MS has indicated \"SMS-only\", then the HLR cancels the serving MSC if there is a serving MSC.\nIf the MS performs the attach procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the SGSN needs to retrieve the CSG subscription information of the MS from the CSS, the SGSN initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\nFor an Emergency Attach in which the MS was not successfully authenticated, the SGSN shall not send an Update Location Request to the HLR.\nFor an Emergency Attach, the SGSN shall ignore any unsuccessful Update Location Ack from HLR and continue with the Attach procedure.\n8)\tIf Attach Type in step 1 indicated GPRS Attach while already IMSI attached, or combined GPRS / IMSI attached, then the VLR shall be updated if the Gs interface is installed. This step is not performed if:\n-\tSubscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data; or\n-\tSubscription Data have an HSS indication of \"SMS in SGSN Support\" and only SMS services are used in CS domain (the MS indicated \"SMS-only\" or the subscription is PS and SMS only) and the SGSN is configured to not establish Gs under that conditions.\nWhen the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 6d). This operation marks the MS as GPRS-attached in the VLR.\na)\tThe SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) message to the VLR. Location Update Type shall indicate IMSI attach if Attach Type indicated combined GPRS / IMSI attach. Otherwise, Location Update Type shall indicate normal location update. The VLR creates an association with the SGSN by storing SGSN Number. In networks that support network sharing, the Location Update Request includes the identity of the selected core network operator if the SGSN has received this information from the RAN, as described in TS 23.251 [83].\nb)\tIf the LA update is inter-MSC, the new VLR sends Update Location (IMSI, new VLR, equivalent PLMN list) to the HLR. The inclusion of the equivalent PLMN list indicates that the SGSN supports the inter-PLMN handover to a CSG cell in an equivalent PLMN using the subscription information of the target PLMN.\nc)\tIf the LA update is inter-MSC, the HLR sends a Cancel Location (IMSI) to the old VLR.\nd)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\ne)\tIf the LA update is inter-MSC, the HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR. The subscriber data may contain the CSG subscription data for the PLMNs.\nf)\tThe VLR acknowledges with Insert Subscriber Data Ack (IMSI).\ng)\tAfter finishing the inter-MSC location update procedures, the HLR responds with Update Location Ack (IMSI) to the new VLR.\nh)\tThe VLR responds with Location Update Accept (VLR TMSI) to the SGSN.\nIf the MS performs the attach procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the VLR needs to retrieve the CSG subscription information of the MS from the CSS, the VLR initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\nIf the SGSN requires the RAN to check whether the UE capabilities are compatible with the network configuration to be able to set the IMS voice over PS Session Supported Indication (see clause 5.3.8) then the SGSN sends a UE Radio Capability Match Request to the RAN as defined in clause 6.9.5.\n9)\tThe SGSN selects Radio Priority SMS, and sends an Attach Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature, Radio Priority SMS, IMS voice over PS Session Supported Indication, Emergency Service Support indicator, Enhanced Coverage Restricted parameter, SMS-Supported, Cause) message to the MS. P‑TMSI is included if the SGSN allocates a new P‑TMSI. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nIf new SGSN has not received, from Step 8, Voice Support Match Indicator for the UE from the RAN then, based on implementation, the SGSN may set IMS Voice over PS session supported Indication and update it at a later stage.\nThe Emergency Service Support indicator informs the MS that Emergency PDP contexts are supported, i.e. the MS is allowed to request activation of emergency PDP contexts when needed.\n\"SMS-Supported\" is indicated to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS services and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN. If step 8 was not performed, e.g. due to Subscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data, then SGSN indicates that the Attach was successful for GPRS only and a Cause indicates why the IMSI attach was not performed.\nWhen receiving the Attach Accept message the E‑UTRAN capable UE shall set its TIN to \"P‑TMSI\" as no ISR Activated is indicated at Attach.\nIf the attach is initiated by manual CSG selection via a CSG cell, the MS upon receiving the Attach Accept message at a CSG cell shall add the CSG ID and associated PLMN of the cell where the MS has sent the Attach Request message to its Allowed CSG list if it is not already present. Manual CSG selection is not supported when an emergency service has been initiated.\nIf the SGSN decides to enable extended idle mode DRX for an MS that included the extended idle mode DRX parameters, it includes the extended idle mode DRX parameters information element.\nIf the MS initiates the Attach procedure at a hybrid mode CSG cell, the SGSN shall check whether the CSG ID is contained in the CSG subscription and is not expired. The SGSN shall send an indication whether the UE is a CSG member to the RAN along with the RANAP message. Based on this information the RAN may perform differentiated treatment for CSG and non-CSG members.\nNOTE 4:\tIf the MS receives a Attach Accept message via a hybrid cell, the MS does not add the corresponding CSG ID and associated PLMN to its Allowed CSG list. Adding a CSG ID and associated PLMN to the MS's Allowed CSG list for a hybrid cell is performed only by OTA or OMA DM procedures.\nIf the MS receives Enhanced Coverage Restricted parameter in the Attach Accept message, MS shall store this information and shall use the value of Enhanced Coverage Restricted parameter to determine if enhanced coverage feature should be used or not.\n10)\tIf P‑TMSI or VLR TMSI was changed, the MS acknowledges the received TMSI(s) by returning an Attach Complete message to the SGSN.\n11)\tIf VLR TMSI was changed, the SGSN confirms the VLR TMSI re-allocation by sending a TMSI Reallocation Complete message to the VLR.\n12)\tAfter step 7a, and in parallel to any of the preceding steps, the SGSN shall send either a GPRS Update Location (Homogeneous Support of IMS Voice over PS Sessions) to the HLR or, when the S6d interface is used, a Notify Request (Homogeneous Support of IMS Voice over PS Sessions) message to the HSS:\n-\tif the SGSN has evaluated the support of IMS Voice over PS Sessions, see clause 5.3.8; and\n-\tif the SGSN determines that it needs to update the Homogeneous Support of IMS Voice over PS Sessions, see clause 5.3.8A.\nFor an Emergency Attach the SGSN shall not check for access restrictions, regional restrictions, subscription restrictions (e.g. CSG restrictions) or perform CSG access control.\nIf the Attach Request cannot be accepted, the SGSN returns an Attach Reject (IMSI or IMEI, Cause) message to the MS. IMEI shall be sent if it is an Emergency Attach and no valid IMSI exists. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of returning an Attach Reject (IMSI, Cause) message to the MS.\nThe CAMEL procedure call shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Attach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Attach is called. In Figure 22, the procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".\n6.5.3A\tCombined GPRS / IMSI Attach procedure, Delete Bearer by the new SGSN, using S4\nThe procedure described in figures 22A shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given in clause 6.5.3.\nFigure 22A: Combined GPRS / IMSI Attach Procedure\nNOTE:\tSteps 6a and 6d are common for architecture variants with GTP based S5/S8 and PMIP‑based S5/S8. For a PMIP‑based S5/S8, procedure step (A) is defined in TS 23.402 [90]. Steps 6b and 6c concern GTP based S5/S8\n6)\tIf there are active PDP contexts in the new SGSN for this particular MS (i.e. the MS re‑attaches to the same SGSN without having properly detached before), the new SGSN deletes these PDP contexts by sending Delete Session Request (Cause, Operation Indication) messages to the GWs involved. If ISR is activated the Cause indicates that the old S‑GW shall delete the bearer resources on the other old CN node by sending Delete Session Request message to the other CN node. The Operation Indication flag is set by the new SGSN. This indicates to the S-GW that the S-GW shall initiate a delete procedure towards the PDN GW. The GWs acknowledges with Delete Session Response messages. If a PCRF is deployed, the PDN GW employs an IP‑CAN Session Termination procedure interacts with the PCRF to indicate that resources have been released.\n6.5.3B\tCombined GPRS / IMSI Attach procedure, Delete Bearer by the old SGSN, using S4\nThe procedure described in figure 22B shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clause 6.5.3.\nFigure 22B: Combined GPRS / IMSI Attach Procedure\nNOTE:\tSteps 7d1 and 7e2 are common for architecture variants with GTP based S5/S8 and PMIP‑based S5/S8. For a PMIP‑based S5/S8, procedure step (A) is defined in TS 23.402 [90]. Steps 7d2 and 7e1 concern GTP based S5/S8.\n7)\nd)\tIf there are active PDP contexts in the old SGSN for this particular MS, the old SGSN deletes these PDP contexts by sending Delete Session Request (Cause, Operation Indication) messages to the GWs involved. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is set by the old SGSN.This indicates to the S-GW that the S-GW shall initiate a delete procedure towards the PDN GW. The GWs return Delete Session Response message to the old SGSN. If a PCRF is deployed, the PDN GW employs an IP‑CAN Session Termination procedure.\ne)\tThe GWs acknowledge with Delete Session Response messages.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.5.3",
        "clause_5.3.15",
        "clause_5.3.8",
        "clause_5.3.21",
        "clause_5.3.19",
        "clause_6.16",
        "clause_6.9.5",
        "figure_22",
        "ts_24.008",
        "ts_33.401",
        "ts_23.003",
        "ts_22.101",
        "ts_23.251",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.6",
      "section_id": "6.6",
      "section_title": "Detach Function",
      "content": "The GPRS Detach procedure allows:\n-\tan MS to inform the network that it does not want to access the SGSN-based services any longer; and\n-\tthe network to inform an MS that it does not have access to the SGSN-based services any more.\nThe Detach function allows an MS to inform the network that it wants to make a GPRS and/or IMSI detach, and it allows the network to inform an MS that it has been GPRS-detached or IMSI-detached by the network.\nThe different types of detach are:\n-\tIMSI detach;\n-\tGPRS detach; and\n-\tcombined GPRS / IMSI detach (MS-initiated only).\nThe MS is detached either explicitly or implicitly:\n-\tExplicit detach: The network or the MS explicitly requests detach.\n-\tImplicit detach: The network detaches the MS, without notifying the MS, after the implicit detach timer expired, or after an irrecoverable radio error causes disconnection of the logical link.\nIn the explicit detach case, a Detach Request (Cause) is sent by the SGSN to the MS, or by the MS to the SGSN.\nThe MS can make an IMSI detach in one of two ways depending on whether it is GPRS-attached or not:\n-\tA GPRS-attached MS sends a Detach Request message to the SGSN, indicating an IMSI detach. This can be made in combination with GPRS detach.\n-\tAn MS that is not GPRS-attached makes the IMSI detach as already defined in A/Gb mode or Iu mode.\nIn the Mobile-originated Detach Request message there is an indication to tell if the detach is due to switch off or not. The indication is needed to know whether a Detach Accept message should be returned or not.\nIn the network-originated Detach Request message there may be an indication to tell the MS that it is requested to initiate GPRS Attach and PDP Context Activation procedures for the previously activated PDP contexts.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.6.1",
      "section_id": "6.6.1",
      "section_title": "MS-Initiated Detach Procedure",
      "content": "The MS-Initiated Detach procedure when initiated by the MS is illustrated in Figure 23.\nFigure 23: MS-Initiated Combined GPRS / IMSI Detach Procedure\nNOTE:\tAll steps except step 2 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 6.6.3.\n1)\tThe MS detaches by sending Detach Request (Detach Type, P‑TMSI, P‑TMSI Signature, Switch Off) to the SGSN. Detach Type indicates which type of detach is to be performed, i.e., GPRS Detach only, IMSI Detach only or combined GPRS and IMSI Detach. Switch Off indicates whether detach is due to a switch off situation or not. The Detach Request message includes P‑TMSI and P‑TMSI Signature. P‑TMSI Signature is used to check the validity of the Detach Request message. If P‑TMSI Signature is not valid or is not included, the authentication procedure should be performed.\nIf the SGSN receives a Detach Request via a CSG cell with Switch Off parameter indicating that detach is not due to a switch off situation, and the CSG subscription for this CSG ID and associated PLMN is absent or expired, the SGSN shall trigger a SGSN-initiated Detach procedure as specified in clause 6.6.2.1.\n2)\tIf GPRS detach, the active PDP contexts in the GGSNs regarding this particular MS are deactivated by the SGSN sending Delete PDP Context Request (TEID, CGI/SAI) to the GGSNs. The GGSNs acknowledge with Delete PDP Context Response (TEID). The GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone if it was requested by the PCRF. For any active T6b connection(s) the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\n3)\tIf IMSI detach, the SGSN sends an IMSI Detach Indication (IMSI) message to the VLR.\n4)\tIf the MS wants to remain IMSI-attached and is doing a GPRS detach, the SGSN sends a GPRS Detach Indication (IMSI) message to the VLR. The VLR removes the association with the SGSN and handles paging and location update without going via the SGSN.\n5)\tIf Switch Off indicates that detach is not due to a switch off situation, the SGSN sends a Detach Accept to the MS.\n6)\tIf the MS was GPRS detached, then the 3G‑SGSN releases the PS signalling connection.\nThe CAMEL procedure calls shall be performed; see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection.\nThis procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Detach is called. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.6.3",
        "clause_6.6.2.1",
        "figure_23",
        "ts_23.203",
        "ts_23.682",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.6.2.1",
      "section_id": "6.6.2.1",
      "section_title": "SGSN-Initiated Detach Procedure",
      "content": "The SGSN-Initiated Detach procedure when initiated by the SGSN is illustrated in Figure 24.\nFigure 24: SGSN-Initiated GPRS Detach Procedure\nNOTE:\tAll steps except step 2 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 6.6.3.\n1)\tThe SGSN informs the MS that it has been detached, by sending Detach Request (Detach Type) to the MS. Detach Type indicates if the MS is requested to make a new attach and PDP context activation for the previously activated PDP contexts. If so, the attach procedure shall be initiated when the detach procedure is completed.\nIf this Detach procedure is due to the MS's Detach Request via a CSG cell which the MS is not allowed to access, i.e. the CSG subscription for this CSG ID and associated PLMN is absent or expired, the SGSN shall send a Detach Request to MS with an appropriate cause indicating the MS is not allowed to access this CSG.\n2)\tThe active PDP contexts in the GGSNs regarding this particular MS are deactivated by the SGSN sending Delete PDP Context Request (TEID, CGI/SAI) messages to the GGSNs. The GGSNs acknowledge with Delete PDP Context Response (TEID) messages. The GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone if it was requested by the PRCF. For any active T6b connection(s) the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\n3)\tIf the MS was both IMSI- and GPRS-attached, the SGSN sends a GPRS Detach Indication (IMSI) message to the VLR. The VLR removes the association with the SGSN and handles paging and location update without going via the SGSN.\n4)\tThe MS sends a Detach Accept message to the SGSN any time after step 1. If the MS receives Detach Request from the SGSN via a CSG cell with the cause indicating the MS is not allowed to access this CSG, the MS shall remove this CSG ID and associated PLMN from its Allowed CSG list, if present.\n5)\tAfter receiving the Detach Accept message, if Detach Type did not request the MS to make a new attach, then the 3G SGSN releases the PS signalling connection.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection.\nThis procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Detach is called. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.6.3",
        "figure_24",
        "ts_23.203",
        "ts_23.682",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.6.2.2",
      "section_id": "6.6.2.2",
      "section_title": "HLR-Initiated Detach Procedure",
      "content": "The HLR-Initiated Detach procedure is initiated by the HLR. The HLR uses this procedure for operator-determined purposes to request the removal of a subscriber's MM and PDP contexts at the SGSN. The HLR-Initiated Detach Procedure is illustrated in Figure 25.\nFor MS with emergency PDP Context, the SGSN shall not send detach message to MS. Instead the SGSN shall deactivate all the non emergency PDP Contexts.\nFigure 25: HLR-Initiated GPRS Detach Procedure\nNOTE:\tAll steps except step 2 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 6.6.3.\n1)\tIf the HLR wants to request the immediate deletion of a subscriber's MM and PDP contexts from the SGSN, the HLR shall send a Cancel Location (IMSI, Cancellation Type) message to the SGSN with Cancellation Type set to Subscription Withdrawn. When receiving the Cancel Location Message the SGSN acknowledges with a Cancel Location Ack (IMSI) message to the HLR.\n2)\tThe SGSN shall inform the MS that it has been detached by sending Detach Request (Detach Type) to the MS. If the Cancel Location message includes a flag to indicate that re-attach is required, the SGSN shall perform detach and set the Detach Type to indicate that re-attach is required.\n3)\tThe active PDP contexts in the GGSNs regarding this particular MS are deactivated by the SGSN sending Delete PDP Context Request (TEID, CGI/SAI) messages to the GGSNs. The GGSNs acknowledge with Delete PDP Context Response (TEID) messages. The GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone if it was requested by the PRCF. For any active T6b connection(s) the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\n4)\tIf the MS was both IMSI- and GPRS-attached, the SGSN sends a GPRS Detach Indication (IMSI) message to the VLR. The VLR removes the association with the SGSN and handles paging and location update without going via the SGSN.\n5)\tThe MS sends a Detach Accept message to the SGSN any time after step 2.\n6)\tVoid.\n7)\tAfter receiving the Detach Accept message, if Detach Type did not request the MS to make a new attach, then the 3G‑SGSN releases the PS signalling connection.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection.\nThis procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Detach is called. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.6.3",
        "figure_25",
        "ts_23.203",
        "ts_23.682",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.6.3",
      "section_id": "6.6.3",
      "section_title": "SGSN interaction during Detach Procedure when using S4",
      "content": "Figure 25A: SGSN interaction when using S4\nNOTE 1:\tSteps A and D are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps B and C concern GTP based S5/S8.\nA)\tFor each PDN connection, the EPS Bearer(s) in the Serving GW regarding this particular MS are deactivated by the SGSN by sending Delete Session Request to the Serving GW. This message indicates that all bearers belonging to that PDN connection shall be released. User Location Information is also reported in this message.\nB)\tThe Serving GW sends Delete Session Request to the PDN GW, including User Location Information. The PDN GW may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone if it was requested by the PRCF.\nC)\tThe PDN GW acknowledges the bearer deactivation to the S‑GW by sending a Delete Session Response.\nD)\tThe SGW acknowledges with Delete Session Response.\nFurther messages due to ISR and messages between S‑GW and P‑GW are described in clause 5.3.8 \"Detach procedure\" of TS 23.401 [89].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.401_clause_5.3.8",
        "figure_25",
        "ts_23.402",
        "ts_23.203",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.7",
      "section_id": "6.7",
      "section_title": "Purge Function",
      "content": "The Purge function allows an SGSN to inform the HLR that it has deleted the MM and PDP contexts of a detached MS. The SGSN may, as an implementation option, delete the MM and PDP contexts of an MS immediately after the implicit or explicit detach of the MS. Alternatively, the SGSN may keep for some time the MM and PDP contexts and the authentication triplets of the detached MS, so that the contexts can be reused at a later GPRS attach without accessing the HLR.\nWhen the SGSN deletes the MM and PDP contexts, it shall initiate the Purge procedure as illustrated in Figure 26.\nFigure 26: Purge Procedure\n1)\tAfter deleting the MM and PDP contexts of a detached MS, the SGSN sends a Purge MS (IMSI) message to the HLR.\n2)\tThe HLR sets the MS Purged for GPRS flag and acknowledges with a Purge MS Ack message.",
      "chunk_type": "general",
      "cross_references": [
        "figure_26"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.0",
      "section_id": "6.8.0",
      "section_title": "General",
      "content": "The GERAN/UTRAN Security function:\n-\tGuards against unauthorised packet-domain service usage (authentication of the MS by the network and service request validation).\n-\tProvides user identity confidentiality (temporary identification and ciphering).\n-\tProvides user data and signalling confidentiality (ciphering).\n-\tProvides, for Iu mode only, data integrity and origin authentication of signalling data (integrity protection).\n-\tProvides, by UMTS authentication (USIM) only, authentication of the network by the MS.\nGERAN/UTRAN security-related network functions are described in TS 43.020 [6] and in TS 33.102 [61].\nNOTE:\tThe security functions related to mobility between GERAN/UTRAN access and E-UTRAN access are described in TS 33.401 [91] and TS 23.401 [89].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_43.020",
        "ts_33.102",
        "ts_33.401",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.1",
      "section_id": "6.8.1",
      "section_title": "Authentication",
      "content": "The Authentication function includes two types of authentication: \"UMTS authentication\" and \"GSM authentication\". These procedures are independent of the RAN modes, i.e. each procedure may be executed in A/Gb mode or in Iu mode. UMTS authentication requires a USIM for the MS and Authentication Quintets in the SGSN. GSM authentication bases on a SIM for the MS and Authentication Triplets in the SGSN or it bases on a GSM capable USIM for the MS and parameters derived from Authentication Quintets in the SGSN.\n\"UMTS authentication\" implies mutual authentication, i.e. authentication of the MS by the network and authentication of the network by the MS. It also implies establishment of a new UMTS ciphering key (CK) and integrity key (IK) agreement between the SGSN and the MS.\n\"GSM authentication\" implies authentication of the MS by the network and establishment of a new GSM ciphering key (Kc) agreement between the SGSN and the MS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.8.1.1",
      "section_id": "6.8.1.1",
      "section_title": "GSM Authentication procedure",
      "content": "The GSM Authentication procedure performs subscriber authentication, or selection of the ciphering algorithm, or both. In A/Gb mode it performs in addition the synchronisation of the start of ciphering. Authentication triplets are stored in the SGSN. The MSC/VLR shall not authenticate the MS via the SGSN upon IMSI attach, nor location update, but may authenticate the MS during CS connection establishment. Security-related network functions are described in TS 43.020 [6].\nThe GSM Authentication procedure is illustrated in Figure 27.\nFigure 27: GSM Authentication Procedure\n1)\tIf the SGSN does not have a previously stored authentication vector, a Send Authentication Info (IMSI) message is sent to the HLR. The HLR responds with a Send Authentication Info Ack (Authentication Triplets or quintets) message.\n2)\tThe SGSN sends an Authentication and Ciphering Request (RAND, CKSN, Ciphering Algorithm) message to the MS. The MS responds with an Authentication and Ciphering Response (SRES) message.\nIn A/Gb mode, the MS starts ciphering after sending the Authentication and Ciphering Response message as described in clause \"Start of Ciphering\".\nChange of the ciphering algorithm during PS Handover procedure is described in TS 43.129 [87].\nIn Iu mode, the SGSN and the MS shall generate the UMTS CK and IK from the GSM Kc using the standardised conversion functions specified for this purpose in TS 33.102 [61].\nIn Iu mode, the start of ciphering is controlled by the security mode procedure described in TS 33.102 [61].\nIf the SGSN cannot determine the HLR address to establish the Send Authentication Info dialogue, the GSM Authentication of Procedure fails.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_27",
        "ts_43.020",
        "ts_43.129",
        "ts_33.102"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.1.2",
      "section_id": "6.8.1.2",
      "section_title": "UMTS Authentication procedure",
      "content": "The UMTS authentication procedure is described in TS 33.102 [61]. The UMTS authentication procedure executed from the SGSN performs both the mutual authentication and security keys agreement. Authentication quintets are stored in the SGSN. The MSC/VLR shall not authenticate the MS via the SGSN upon IMSI attach nor upon location update, but may authenticate the MS during CS connection establishment.\nThe UMTS Authentication procedure is illustrated in Figure 28.\nFigure 28: UMTS Authentication\n1)\tIf the SGSN does not have previously stored UMTS Authentication Vectors (quintets), a Send Authentication Info (IMSI) message is sent to the HLR. Upon receipt of this message, the HLR responds with a Send Authentication Info Ack message including an ordered array of quintets to the SGSN. Each quintet contains RAND, XRES, AUTN, CK, and IK. The generation of quintets in HLR is performed as specified in TS 33.102 [61].\n2)\tAt authentication, the SGSN selects the next in-order quintet and transmits the RAND and AUTN, that belong to this quintet, to the MS in the Authentication and Ciphering Request (RAND, AUTN, KSI) message. The SGSN also selects a Key Set Identifier, KSI, and includes this in the message.\n3)\tAt reception of this message, the USIM in the MS verifies AUTN and, if accepted, the USIM computes the signature of RAND, RES, in accordance with TS 33.102 [61]. If the USIM considers the authentication as being successful, the MS returns an Authentication and Ciphering Response (RES) message to the SGSN. During generation of authentication vectors, the USIM in the MS also computes a new Ciphering Key, CK, and a new Integrity Key, IK. These keys are stored together with the KSI until KSI is updated at the next authentication.\nIf the USIM considers the authentication being unsuccessful, e.g., in case of an authentication synchronisation failure, the MS returns the Authentication and Ciphering Failure message to the SGSN. The actions then taken are described in TS 33.102 [61].\nIn A/Gb mode, the SGSN and the MS shall generate the Kc from the UMTS CK and IK using the standardised conversion function specified for this purpose in TS 33.102 [61].\nIn A/Gb mode, the MS starts ciphering after sending the Authentication and Ciphering Response message as described in clause \"Start of Ciphering\".\nIn Iu mode, the start of ciphering is controlled by the security mode procedure described in TS 33.102 [61].\nIf the SGSN cannot determine the HLR address to establish the Send Authentication Info dialogue, the UMTS Authentication Procedure fails.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_28",
        "ts_33.102"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.2.1",
      "section_id": "6.8.2.1",
      "section_title": "User Identity Confidentiality (A/Gb mode)",
      "content": "A Temporary Logical Link Identity (TLLI) identifies a user in A/Gb mode. The relationship between TLLI and IMSI is known only in the MS and in the SGSN. TLLI is derived from the P‑TMSI allocated by the SGSN or built by the MS as described in clause \"NSAPI and TLLI for A/Gb mode\".\nNOTE:\tFollowing inter-RAT mobility from E‑UTRAN, the MS will use values for the TLLI and P‑TMSI as instructed by the old MME.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.8.2.2",
      "section_id": "6.8.2.2",
      "section_title": "User Identity Confidentiality (Iu mode)",
      "content": "A Radio Network Temporary Identity (RNTI) identifies a user between the MS and an Iu mode RAN. The relationship between RNTI and IMSI is known only in the MS and in the RAN. A P‑TMSI identifies a user between the MS and the SGSN. The relationship between P‑TMSI and IMSI is known only in the MS and in the SGSN.\nNOTE:\tFollowing inter-RAT mobility from E‑UTRAN, the MS will use a value for the P‑TMSI as instructed by the old MME.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.8.2.3",
      "section_id": "6.8.2.3",
      "section_title": "P‑TMSI Signature",
      "content": "P‑TMSI Signature is optionally sent by the SGSN to the MS in Attach Accept and Routeing Area Update Accept messages. If the P‑TMSI Signature has been sent by the SGSN to the MS since the current P‑TMSI was allocated, then the MS shall include the P‑TMSI Signature in the next Routeing Area Update Request, Detach Request, and Attach Request for identification checking purposes. If the P‑TMSI Signature was sent, then the SGSN shall compare the P‑TMSI Signature sent by the MS with the signature stored in the SGSN. If the values do not match, the SGSN should use the security functions to authenticate the MS. If the values match or if the P‑TMSI Signature is missing, the SGSN may use the security functions to authenticate the MS. The P‑TMSI Signature parameter has only local significance in the SGSN that allocated the signature.\nNOTE:\tFollowing inter‑RAT mobility from E‑UTRAN, the P‑TMSI signature is also used for a different function and may carry other information from the MS to the old MME (see TS 23.401 [89]) without modification by the new SGSN.\nIf the network supports ciphering, the SGSN shall send the P‑TMSI Signature ciphered to the MS. Routeing Area Update Request and Attach Request, into which the MS includes the P‑TMSI Signature, are not ciphered.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.2.4",
      "section_id": "6.8.2.4",
      "section_title": "P-TMSI Reallocation Procedure",
      "content": "The SGSN may attempt to reallocate the P‑TMSI at any time that the MS is in GERAN/UTRAN PS coverage. The reallocation procedure can be performed by the P‑TMSI Reallocation procedure, or it can be included in the Attach or Routeing Area Update procedures. The P-TMSI reallocation during PS Handover procedure is described in TS 43.129 [87].\nThe P‑TMSI Reallocation procedure is illustrated in Figure 29.\nFigure 29: P‑TMSI Reallocation Procedure\n1)\tThe SGSN sends a P‑TMSI Reallocation Command (new P‑TMSI, P‑TMSI Signature, RAI) message to the MS. P‑TMSI Signature is an optional parameter that the MS, if received, shall return to the SGSN in the next Attach and Routeing Area Update procedures.\n2)\tThe MS returns a P‑TMSI Reallocation Complete message to the SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_29",
        "ts_43.129"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.3.1",
      "section_id": "6.8.3.1",
      "section_title": "Scope of Ciphering",
      "content": "In A/Gb mode, the scope of ciphering is from the ciphering function in the SGSN to the ciphering function in the MS. Ciphering is done in the LLC layer, and from the perspective of the A/Gb mode MS-BTS radio path, an LLC PDU is transmitted as plain text.\nIn Iu mode, the scope of ciphering is from the ciphering function in the RAN to the ciphering function in the MS.\nFigure 30: Scope of Ciphering",
      "chunk_type": "general",
      "cross_references": [
        "figure_30"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.3.2",
      "section_id": "6.8.3.2",
      "section_title": "Ciphering Algorithm",
      "content": "TS 41.061 [2] contains the requirements for the GPRS Encryption Algorithm (GEA) for A/Gb mode. The A/Gb mode ciphering key Kc is an input to the algorithm. The standard key management procedures for the Kc shall be used.\nIn Iu mode ciphering is performed with the UMTS Encryption Algorithm (UEA). The Iu mode Ciphering Key CK is an input to the algorithm.",
      "chunk_type": "general",
      "cross_references": [
        "ts_41.061"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.3.3",
      "section_id": "6.8.3.3",
      "section_title": "Start of Ciphering",
      "content": "In A/Gb mode, the MS starts ciphering after sending the Authentication and Ciphering Response message. The SGSN starts ciphering when a valid Authentication and Ciphering Response message is received from the MS. In the routeing area update case, if ciphering was used before the routeing area update, and if the authentication procedure is omitted, then the SGSN shall resume ciphering with the same algorithm when a ciphered Routeing Area Update Accept message is sent, and the MS shall resume ciphering when a ciphered Routeing Area Update Accept message is received.\nIn Iu mode, the start of ciphering is controlled by the security mode procedure described in TS 33.102 [61].",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.102"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.4",
      "section_id": "6.8.4",
      "section_title": "Identity Check Procedures",
      "content": "The Identity Check procedure is illustrated in Figure 31.\nFigure 31: Identity Check Procedure\n1)\tThe SGSN sends Identity Request (Identity Type) to the MS. The MS responds with Identity Response (Mobile Identity).\n2)\tIf the SGSN decides to check the IMEI against the EIR, it sends Check IMEI (IMEI) to EIR. The EIR responds with Check IMEI Ack (IMEI).",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_31"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.8.5",
      "section_id": "6.8.5",
      "section_title": "Data Integrity Procedure (Iu mode)",
      "content": "The Data Integrity procedure is performed between the MS and the RAN. It is applicable only to radio signalling. The Iu mode integrity check is made with the UMTS Integrity Algorithm (UIA). The UMTS Integrity Key IK is an input to the algorithm. The start of the data integrity procedure is controlled by the security mode procedure as described in TS 33.102 [61].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_33.102"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.0",
      "section_id": "6.9.0",
      "section_title": "General",
      "content": "The Location Management function provides:\n-\tmechanisms for cell and PLMN selection;\n-\ta mechanism for the network to know the Routeing Area for MSs in STANDBY, PMM‑IDLE, READY, and PMM‑CONNECTED states;\n-\ta mechanism for the 2G‑SGSN to know the cell identity for MSs in READY state;\n-\ta mechanism for the Iu mode RAN to know the RAN registration area identity or cell identity for MSs in PMM‑CONNECTED state;\n-\ta mechanism for the Iu mode RAN to indicate to an MS in RRC Connected mode when a Routeing Area Update procedure shall be performed by providing the RAI; and\n-\ta mechanism for the network in Iu mode to know the address of the serving BSC/RNC handling an MS in PMM‑CONNECTED state. This mechanism is the serving RNC relocation procedure.\nNOTE 1:\tThe SGSN may not know the Routeing Area where the Iu mode MS is physically located for an MS is in RRC Connected mode. An MS in PMM‑CONNECTED state is necessarily in RRC Connected mode. An MS in PMM‑IDLE state is in RRC Connected mode only if the MS is in CS MM‑CONNECTED state.\nIn Iu mode, the tracking of the location of the MS is on three levels (cell, RAN area, or RA); see TS 23.121 [54].\nIn A/Gb mode, the tracking of the location of the MS is on two levels (cell or RA).\nRouting Area Update procedure may be triggered by a PS Handover procedure as described in TS 43.129 [87].\nRouting Area Update procedure may be triggered by an Inter RAT Handover from EUTRAN to GERAN/UTRAN as described in TS 23.401 [89].\nRouting Area Update procedure may be triggered by the ISR function as described in TS 23.401 [89].\nOther specified events may also trigger the Routing Area Update procedure.\nRouteing Area (RA) is defined in clause \"Routeing Area Identity\".\nEmergency bearer service is not supported in GERAN PS domain. Relocation to A/Gb mode shall be prevented if an MS in UTRAN with emergency bearer services tries to handover to GERAN PS domain.\nIf SIPTO using GW selection is enabled for a PDN connection, the SGSN should re-evaluate whether the PGW/GGSN location is still acceptable. If the SGSN determines that GW relocation is needed, the SGSN may initiate PDN deactivation with reactivation requested according to clause 9.2.4.2 at the end of the routing area update procedure.\nNOTE 2:\tIt depends on the operator's configuration in the SGSN whether to use the deactivation with reactivation request or allow the continued usage of the already connected GW.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_9.2.4.2",
        "ts_23.121",
        "ts_43.129",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1",
      "section_id": "6.9.1",
      "section_title": "Location Management Procedures (A/Gb mode)",
      "content": "The PLMN shall provide information for the MS to be able to:\n-\tdetect when it has entered a new cell or a new RA; and\n-\tdetermine when to perform periodic RA updates.\nThe MS detects that it has entered a new cell by comparing the cell's identity with the cell identity stored in the MS's MM context. The MS detects that a new RA has been entered by periodically comparing the RAI stored in its MM context with that received from the new cell. The MS shall consider hysteresis in signal strength measurements.\nWhen the MS camps on a new cell, possibly in a new RA, this indicates one of three possible scenarios:\n-\ta cell update is required;\n-\ta routeing area update is required; or\n-\ta combined routeing area and location area update is required.\nIn all three scenarios the MS stores the cell identity in its MM context.\nIf the MS enters a new PLMN, the MS shall perform a routeing area update, unless it is not allowed to do so for the reasons specified in TS 24.008 [13] and TS 23.122 [7b], or it is an MS configured to perform Attach with IMSI at PLMN change.\nIn network mode of operation II, whenever an MS that needs only PS services and SMS services over NAS determines that it shall perform both an LA update/IMSI attach and an RA update/GPRS attach, the MS shall complete the RA update / GPRS attach first before initiating the LA update/ IMSI attach. If the GPRS Attach or RA update procedure indicates that SMS services via PS domain NAS is supported, such an MS determines that no LA update / IMSI Attach is required.\nIn network mode of operation II, whenever an MS that needs PS services and CS services other than SMS over NAS determines that it shall perform both an LA update and an RA update:\n1.\tIt shall initiate the LA update and then initiate the RA update, if the MS is in class A mode of operation.\n2.\tIt shall perform the LA update first if the MS is not in class A mode of operation.\nRouteing Area Update Request messages shall be sent unciphered, since in the inter-SGSN routeing area update case the new SGSN shall be able to process the request.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_24.008",
        "ts_23.122"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.1",
      "section_id": "6.9.1.1",
      "section_title": "Cell Update Procedure",
      "content": "A cell update takes place when the MS enters a new cell inside the current RA and the MS is in READY state. If the RA has changed, a routeing area update is executed instead of a cell update.\nIf the network does not support the Cell Notification which is an optimised Cell Update Procedure (see TS 24.008 [13]), the MS performs the cell update procedure by sending an uplink LLC frame of any type except the LLC NULL frame (see TS 44.064 [15]) containing the MS's identity to the SGSN. If the network and the MS support the Cell Notification, then the MS shall use the LLC NULL frame containing the MS's identity in order to perform a cell update. The support of Cell Notification is mandatory for the MS the network, but the network and the MS have to support the Cell Update Procedure without using the LLC NULL frame for backward compatibility reasons.\nIn the direction towards the SGSN, the BSS shall add the Cell Global Identity including RAC and LAC to all BSSGP frames, see TS 48.018 [78]. A cell update is any correctly received and valid LLC PDU carried inside a BSSGP PDU containing a new identifier of the cell.\nThe SGSN records this MS's change of cell and further traffic towards the MS is conveyed over the new cell. If requested by the GGSN according to charging requirements in clause 15.1.1a, the SGSN shall forward the new CGI to the GGSN based on the procedures defined in clause 15.1.3.2. If requested by the S‑GW/P‑GW according to charging requirements in clause 15.1.0, the SGSN shall forward the new CGI to the S‑GW/P‑GW based on the procedures defined in clause 15.1.3.2a.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_15.1.1",
        "clause_15.1.3.2",
        "clause_15.1.0",
        "ts_24.008",
        "ts_44.064",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.2.0",
      "section_id": "6.9.1.2.0",
      "section_title": "General",
      "content": "A Routeing Area Update takes place when a GPRS-attached MS detects:\n-\tthat it has entered a new RA (except for the case of an MS configured to perform GPRS Attach with IMSI when entering an RA in a new non-equivalent PLMN in RRC-IDLE mode);\n-\twhen the periodic RA update timer has expired;\n-\twhen the MS has to indicate changed access capabilities or DRX parameters to the network;\n-\twhen a change in conditions in the MS requires a change in the extended idle mode DRX parameters previously negotiated with the SGSN;\n-\tfor a UE supporting CS fallback, or configured to support IMS voice, or both, a change of the UE's usage setting or voice domain preference for E-UTRAN;\n-\tfor an SR-VCC capable MS, the MS has changed its MS Classmark 2, or MS Classmark 3, or Supported Codec information;\n-\tfor A/Gb mode, when a suspended MS is not resumed by the BSS (see clause \"Suspension of GPRS Services\");\n-\twhen the MS reselects GERAN/UTRAN with the TIN indicating \"GUTI\";\n-\twhen the MS moves from E-UTRAN-connected to GERAN via Cell Change Order that is not for CS fallback. If the TIN indicates \"RAT-related TMSI\" the MS shall set the TIN to \"GUTI\" before initiating the RA update procedure;\n-\tthe RRC layer in an E-UTRAN capable UE informs the UE's NAS layer that an RRC connection failure occurred in E-UTRAN and this led the MS to select a GERAN/UTRAN cell;\n-\twhen the UE Network Capability and/or MS Network Capability are changed; or\n-\tthat it is registered for IMS voice and has moved from a RAT that supports IMS voice over PS sessions (see clause 5.3.8 for more information) to one that does not, or vice versa. It shall be possible using Device Management or initial provisioning to configure the UE to apply/not apply this particular exception.\nNOTE:\tA UE moving between RATs that both support IMS voice over PS sessions, or, both that do not support IMS voice over PS sessions, is unaffected by the above.\nThe SGSN detects that it is an intra-SGSN routeing area update by noticing that it also handles the old RA. In this case, the SGSN has the necessary information about the MS and there is no need to inform the S‑GW/P‑GWs or GGSNs or the HLR/HSS about the new MS location. A periodic RA update is always an intra SGSN routeing area update.\nDuring the Routeing Area Update procedure, the MS provides its PS Handover inter-RAT Handover capabilities in the Routeing Area Update Request message. The SGSN uses the inter-RAT indicator and/or other indicators to ask the MS (using the Routeing Area Update Accept message) to send the other RAT's Radio Access Capabilities in Iu mode and UTRAN Radio Access Capabilities in A/Gb mode in the Routeing Area Update Complete message.\nDuring the Routeing Area Update procedure, if the SGSN supports SRVCC and if the UE SRVCC capability has changed, it notifies the HSS with the UE SRVCC capability e.g. for further IMS registration.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.3.8"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.2.1",
      "section_id": "6.9.1.2.1",
      "section_title": "Intra SGSN Routeing Area Update",
      "content": "The Intra SGSN Routeing Area Update procedure is illustrated in Figure 32. This procedure applies for S4-SGSNs and for Gn/Gp SGSNs.\nFigure 32: Intra SGSN Routeing Area Update Procedure\n1)\tThe MS sends a Routeing Area Update Request (P‑TMSI, old RAI, old P‑TMSI Signature, Update Type, MS Radio Access Capability, DRX parameters, extended idle mode DRX parameters, MS Network Capability, Support for restriction of use of Enhanced Coverage, additional P‑TMSI/RAI, Voice domain preference and UE's usage setting) to the SGSN. Update Type shall indicate RA update or periodic RA update. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the SGSN, see TS 48.018 [78]. MS Radio Access Capability contains the MS GPRS multislot capabilities, supported frequency bands, etc as defined in TS 24.008 [13]. DRX Parameters are included if the MS has altered its DRX Parameters. Extended idle mode DRX parameters information element is included if the MS wants to enable extended idle mode DRX.\nIf the E‑UTRAN capable UE's TIN indicates \"GUTI\" and the UE holds a valid GUTI then the UE indicates the GUTI as the old P‑TMSI and old RAI. If the UE's TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\" and the UE holds a valid P‑TMSI and related RAI then these two elements are indicated as old P‑TMSI and old RAI. Mapping a GUTI to a P‑TMSI and an RAI is specified in TS 23.401 [89]. In this scenario of intra SGSN RAU, the TIN indicates \"P‑TMSI\" or \"RAT-related TMSI\".\nIf the E‑UTRAN capable UE holds a valid P‑TMSI and related RAI then the UE indicates these parameters as additional P‑TMSI/RAI, regardless whether the old P‑TMSI and old RAI indicate the same parameters or parameters mapped from a GUTI.\nThe Gn/Gp SGSN shall ignore this additional P‑TMSI/RAI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\n2)\tSecurity functions may be executed. These procedures are defined in clause \"Security Function\".\n3)\tThe SGSN validates the MS's presence in the new RA. If, due to regional subscription restrictions, the MS is not allowed to be attached in the RA, or if subscription checking fails, the SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the SGSN updates the MM context for the MS. A new P‑TMSI may be allocated. A Routeing Area Update Accept (P‑TMSI, P‑TMSI Signature, IMS voice over PS Session Supported Indication, SMS-Supported, Enhanced Coverage Restricted parameter) is returned to the MS. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nIf ISR is activated for the MS when the S4-SGSN receives the Routeing Area Update Request in the intra SGSN scenario, the S4-SGSN should maintain ISR by indicating ISR Activated in the Routeing Area Update Accept message.\nIf the SGSN decides to enable extended idle mode DRX for an MS that included the extended idle mode DRX parameters, it includes the extended idle mode DRX parameters information element.\n\"SMS-Supported\" is indicated to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS services and SMS services over NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN.\nIf the MS included support for restriction of use of Enhanced Coverage, the SGSN sends Enhanced Coverage Restricted parameter to the MS in the Routeing Area Update Accept message. MS shall store Enhanced Coverage Allowed parameter and shall use the value of Enhanced Coverage Restricted parameter to determine if enhanced coverage feature should be used or not.\n4)\tIf P‑TMSI was reallocated, the MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete message to the SGSN.\nFor some network sharing scenario (e.g. GWCN) if the PLMN-ID of the RAI supplied by the RNC is different from that of the RAI in the UE's context, then the SGSN shall informs the HLR.\nIf the routeing area update procedure fails a maximum allowable number of times, or if the SGSN returns a Routeing Area Update Reject (Cause) message, the MS shall enter IDLE state.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b] C1:\nC1)\tCAMEL_GPRS_Routeing_Area_Update_Session, CAMEL_PS_Notification and CAMEL_GPRS_Routeing_Area_Update_Context.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Routeing_Area_Update_Session is called once per session. It returns as a result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called once per session. It returns as a result \"Continue\".\n-\tThen the procedure CAMEL_GPRS_Routeing_Area_Update_Context is called once per PDP context. It returns as a result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "clause_5.3.8",
        "figure_32",
        "ts_48.018",
        "ts_24.008",
        "ts_23.401",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.2.2",
      "section_id": "6.9.1.2.2",
      "section_title": "Inter SGSN Routeing Area Update",
      "content": "The Inter SGSN Routeing Area Update procedure is illustrated in Figure 33 for mobility between two Gn/Gp SGSNs and for mobility from S4-SGSN to Gn/Gp SGSN. The Inter SGSN Routeing Area Update procedure between two S4-SGSNs shows differences for the steps in the boxes (A) and (B). The Inter SGSN Routeing Area Update procedure from Gn/Gp SGSN to S4-SGSN shows differences for the steps in the box (B). These different step descriptions of the boxes are described in clause \"Inter SGSN Routeing Area Update and Combined Inter SGSN RA / LA Update using S4\".\nFigure 33: Inter SGSN Routeing Area Update Procedure\nNOTE 1:\tAll steps in figure 33, except steps 2, 4, and 6, are common for architecture variants using Gn/Gp based and S4 based SGSN. For specific interaction with S4 based SGSN, procedure steps (A) and (B) are defined in the clause 6.9.1.2.2a.\n1)\tThe MS sends a Routeing Area Update Request (old RAI, old P‑TMSI Signature, Update Type, MS Radio Access Capability, DRX parameters, extended idle mode DRX parameters, MS Network Capability, Support for restriction of use of Enhanced Coverage, additional P‑TMSI/RAI, Voice domain preference and UE's usage setting) to the new SGSN. Update Type shall indicate RA update or periodic RA update. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the SGSN. MS Radio Access Capability contains the MS GPRS multislot capabilities, supported frequency bands, etc. as defined in TS 24.008 [13]. DRX Parameters are included if the MS has altered its DRX Parameters. Extended idle mode DRX parameters information element is included if the MS wants to enable extended idle mode DRX.\nIf the E‑UTRAN capable UE's TIN indicates \"GUTI\" and the UE holds a valid GUTI then the UE indicates the GUTI as the old P‑TMSI and old RAI. If the UE's TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\" and the UE holds a valid P‑TMSI and related RAI then these two elements are indicated as old P‑TMSI and old RAI. Mapping a GUTI to a P‑TMSI and an RAI is specified in TS 23.401 [89]. In this scenario of inter SGSN RAU, the TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\".\nIf the E‑UTRAN capable UE holds a valid P‑TMSI and related RAI then the UE indicates these parameters as additional P‑TMSI/RAI, regardless whether the old P‑TMSI and old RAI indicate the same parameters or parameters mapped from a GUTI.\nThe Gn/Gp SGSN shall ignore this additional P‑TMSI/RAI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\n2)\tThe new SGSN sends SGSN Context Request (old RAI, TLLI, old P‑TMSI Signature, New SGSN Address) to the old SGSN to get the MM and PDP contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI (or TLLI) and send the SGSN Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI (or TLLI) and relay the message to that actual old SGSN. The old SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send an SGSN Context Request (old RAI, TLLI, MS Validated, New SGSN Address) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN stops assigning SNDCP N‑PDU numbers to downlink N‑PDUs received, and responds with SGSN Context Response (MM Context, PDP Contexts, Negotiated Evolved ARP). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN stores New SGSN Address, to allow the old SGSN to forward data packets to the new SGSN. Each PDP Context includes the SNDCP Send N‑PDU Number for the next downlink N‑PDU to be sent in acknowledged mode to the MS, the SNDCP Receive N‑PDU Number for the next uplink N‑PDU to be received in acknowledged mode from the MS, the GTP sequence number for the next downlink N‑PDU to be sent to the MS and the GTP sequence number for the next uplink N‑PDU to be tunnelled to the GGSN. The old SGSN starts a timer and stops the transmission of N-PDUs to the MS. The new SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\nSNDCP and GTP sequence numbers are not relevant for a new S4-SGSN if provided by an old Gn/Gp SGSN and need not to be provided by an old S4-SGSN as the EPS network shall not configure usage of \"delivery order required\" and no acknowledged mode NSAPIs (SNDCP) as described in clause \"Network Configuration for Interaction with E-UTRAN and S4-SGSNs\".\nIf the MS uses power saving functions and the DL Data Buffer Expiration Time for the MS has not expired, the old SGSN indicates Buffered DL Data Waiting. When this is indicated, data forwarding from the old SGSN to the new SGSN shall be done and the user plane set up in conjunction to the RAU procedure (see clause 5.3.13.7).\nIf the new SGSN supports CIoT GSM Optimization, the CIoT GSM Optimization support indication is included in the SGSN Context Request indicating support for various CIoT Optimisations (e.g. support for Non-IP data, SCEF, etc.).\nBased on the CIoT GSM Optimization support indication, old SGSN only transfers the PDP Context(s) that the new SGSN supports. If the new SGSN does not support CIoT GSM Optimization, Non-IP PDP Context(s) are not transferred to the new SGSN. If the PDP Context(s) has not been transferred, the old SGSN deactivate that PDP Context(s) and any buffered data in the old SGSN is discarded after receipt of SGSN Context Acknowledge.\n3)\tSecurity functions may be executed. These procedures are defined in clause \"Security Function\". Ciphering mode shall be set if ciphering is supported. If the SGSN Context Response message did not include IMEISV and ADD is supported by the SGSN, the SGSN retrieves the IMEISV from the MS.\nIf the security functions fail (e.g. because the SGSN cannot determine the HLR address to establish the Send Authentication Info dialogue), the Inter SGSN RAU Update procedure fails. A reject shall be returned to the MS with an appropriate cause.\n4)\tThe new SGSN sends an SGSN Context Acknowledge message to the old SGSN. This informs an old Gn/Gp SGSN that the new SGSN is ready to receive data packets belonging to the activated PDP contexts. Only old Gn/Gp SGSNs may forward data to a new Gn/Gp or S4-SGSN.\nThe old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure. If the security functions do not authenticate the MS correctly, then the routeing area update shall be rejected, and the new SGSN shall send a reject indication to the old SGSN. The old SGSN shall continue as if the SGSN Context Request was never received.\n5)\tOnly old Gn/Gp SGSNs may forward data to a new SGSN. An old Gn/Gp SGSN duplicates the buffered N‑PDUs and starts tunnelling them to the new SGSN. Additional N‑PDUs received from the GGSN before the timer described in step 2 expires are also duplicated and tunnelled to the new SGSN. N‑PDUs that were already sent to the MS in acknowledged mode and that are not yet acknowledged by the MS are tunnelled together with the SNDCP N‑PDU number. No N‑PDUs shall be forwarded to the new SGSN after expiry of the timer described in step 2.\nSNDCP N-PDU numbers are not relevant for S4-SGSNs as the network shall not configure usage of acknowledged mode NSAPIs (SNDCP) as described in clause \"Network Configuration for Interaction with E-UTRAN and S4-SGSNs\". A new S4-SGSN indicates reserved TEID and IP address parameters from an SGW to an old Gn/Gp SGSN so that the old Gn/Gp SGSN can forward data packets when needed. The SGW discards any packets received from old Gn/Gp SGSN.\n6)\tThe new SGSN sends Update PDP Context Request (new SGSN Address, TEID, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, NRSN) to the GGSNs concerned. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Context Response message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return Update PDP Context Response (TEID, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP). The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89] Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. User CSG Information includes CSG ID, access mode and CSG membership indication. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\nIf the new SGSN receives PDP context with SCEF, then the new SGSN updates the SCEF as defined in TS 23.682 [119].\n7)\tThe new SGSN informs the HLR of the change of SGSN by sending Update Location (SGSN Number, SGSN Address, IMSI, IMEISV, UE SRVCC capability, Registration For SMS Request) to the HLR. IMEISV is sent if the ADD function is supported. If the S6d interface is used between S4-SGSN and HSS, a parameter \"SMS in SGSN offered\" is included in the Update Location message, otherwise this parameter is included in the Insert Subscriber Data Ack (Step 9). \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN.\nIf the MS performs the Routeing Area Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the SGSN needs to retrieve the CSG subscription information of the MS from the CSS, the SGSN initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n8)\tThe HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN with Cancellation Type set to Update Procedure. If the timer described in step 2 is not running, the old SGSN removes the MM and PDP contexts/EPS Bearer Contexts and an old S4-SGSN releases in addition the S‑GW resources when the new SGSN is a Gn/Gp SGSN or when an S‑GW change is performed. GTPv1 SGSN context transfer signalling indicates to the old S4-SGSN that the new SGSN is a Gn/Gp SGSN, which does not signal any S‑GW change. When the timer described in step 2 is running, the MM and PDP/EPS Bearer Contexts and any affected S‑GW resources are removed when the timer expires and the SGSN received a Cancel Location. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\nWhen the timer described in step 2 expires and no Cancel Location was received the S4-SGSN removes the PDP contexts/EPS Bearer Contexts but preserves the MM context.\nThe timer started in step 2 allows the old SGSN to complete the forwarding of N‑PDUs. It also ensures that the MM and PDP contexts/EPS Bearer Contexts are kept in the old SGSN in case the MS initiates another inter-SGSN routeing area update before completing the ongoing routeing area update to the new SGSN. The old SGSN acknowledges with Cancel Location Ack (IMSI).\n9)\tThe HLR sends Insert Subscriber Data (IMSI, Subscription Data) to the new SGSN. The subscription data may contain Enhanced Coverage Restricted parameter. If received from the HLR, SGSN stores this Enhanced Coverage Allowed parameter in the SGSN MM context. The new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions or access restrictions the MS is not allowed to be attached in the RA, the SGSN rejects the Routeing Area Update Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If all checks are successful, the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI, SMS in SGSN offered) message to the HLR. The \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN. If the S6d interface is used between S4-SGSN and HSS the messages \"Insert Subscriber Data\" and \"Insert Subscriber Data Ack\" are not used. Instead, the Subscription Data is sent by HSS in the message Update Location Ack (Step 10).\n10)\tThe HLR acknowledges the Update Location by sending Update Location Ack (IMSI, GPRS Subscriber Data (only if S6d interface is used)) to the new SGSN.\n11)\tThe new SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS, is not allowed to be attached in the SGSN, or if subscription checking fails, the new SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the new SGSN constructs MM and PDP contexts/EPS Bearer Contexts for the MS. A logical link is established between the new SGSN and the MS. The new SGSN responds to the MS with Routeing Area Update Accept (P‑TMSI, P‑TMSI Signature, Receive N‑PDU Number, IMS voice over PS Session Supported Indication, SMS-Supported, Enhanced Coverage Restricted parameter). Receive N‑PDU Number contains the acknowledgements for each acknowledged-mode NSAPI used by the MS, thereby confirming all mobile-originated N‑PDUs successfully transferred before the start of the update procedure. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nISR Activated is never indicated to the MS in case of inter SGSN RAU as described in TS 23.401 [89]. The E‑UTRAN capable UE sets its TIN to \"P‑TMSI\" or \"RAT‑related TMSI\" as described for Routing Area Update procedures in TS 23.401 [89].\n\"SMS-Supported\" is indicated to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN.\nIf the MS included support for restriction of use of Enhanced Coverage, the SGSN sends Enhanced Coverage Restricted parameter to the MS in the Routeing Area Update Accept message. MS shall store Enhanced Coverage Allowed parameter and shall use the value of Enhanced Coverage Restricted parameter to determine if enhanced coverage feature should be used or not.\nIn Iu mode, if after step 6 the new SGSN receives a Downlink Data Notification message or any other downlink signalling message while the MS is still connected, the new SGSN may prolong the PS signalling connection with the MS.\nIf the SGSN decides to enable extended idle mode DRX for an MS that included extended idle mode DRX parameters information element, it includes the extended idle mode DRX parameters information element.\n12)\tThe MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete (Receive N‑PDU Number) message to the SGSN. Receive N‑PDU Number contains the acknowledgements for each acknowledged-mode NSAPI used by the MS, thereby confirming all mobile-terminated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms reception of N‑PDUs that were forwarded from the old SGSN, these N‑PDUs shall be discarded by the new SGSN. LLC and SNDCP in the MS are reset.\nFor a rejected routeing area update operation, due to regional subscription, roaming restrictions, access restrictions (see TS 23.221 [80] and TS 23.008 [79]) or because the SGSN cannot determine the HLR address to establish the locating updating dialogue, the new SGSN should not construct an MM context. In the case of receiving the subscriber data from HLR, the new SGSN may construct an MM context and store the subscriber data for the MS to optimize signalling between the SGSN and the HLR. A reject shall be returned to the MS with an appropriate cause. Upon return to idle, the MS shall act according to TS 23.122 [7b].\nIf the new SGSN is unable to update the PDP context/EPS Bearer Context in one or more GGSNs/P‑GWs, the new SGSN shall deactivate the corresponding PDP contexts/EPS Bearer Contexts as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe PDP Contexts/EPS Bearer Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important PDP Context/EPS Bearer Context first in the SGSN Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer Context from the GGSN/P‑GW or old S4-SGSN and then store the new Maximum APN restriction value.\nIf the new SGSN is unable to support the same number of active PDP contexts as received from old SGSN, the new SGSN should use the prioritisation sent by old SGSN as input when deciding which PDP contexts/EPS Bearer Contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in one or more GGSNs/P‑GWs and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nIf the timer described in step 2 expires and no Cancel Location (IMSI) was received from the HLR, the old SGSN stops forwarding N‑PDUs to the new SGSN.\nIf the routeing area update procedure fails a maximum allowable number of times, or if the SGSN returns a Routeing Area Update Reject (Cause) message, the MS shall enter IDLE state.\nIf \"SMS-Supported\" is indicated to the MS, the MS should not initiate Location Update or IMSI attach with the MSC for only obtaining SMS services as SMS services via PS domain NAS are provided by the SGSN.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure return as result \"Continue\".\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context. It returns as result \"Continue\".\n6.9.1.2.2a\tInter SGSN Routeing Area Update and Combined Inter SGSN RA / LA Update using S4\nThe procedures described in figures 33a and 33b show only the steps 2 and 4 for the case when new and old SGSNs are S4-SGSNs and step 6 when the new SGSN is an S4-SGSN. These steps are different from the Gn/Gp variant of the procedure given by clauses 6.9.1.2.2 and 6.9.1.3.2. The ISR function is deactivated in Inter SGSN RAU as defined in TS 23.401 [89].\nFigure 33a: Step 2 and 4 for Inter SGSN Routeing Area Update Procedure and Combined Inter SGSN RA / LA Update between S4-SGSNs\n2.\tThe new SGSN sends a Context Request (old RAI, TLLI, old P TMSI Signature, New SGSN Address) to the old SGSN to get the MM and EPS Bearer contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P‑TMSI (or TLLI) and send the Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P‑TMSI (or TLLI) and relay the message to that actual old SGSN. The old SGSN validates the old P TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send a Context Request (old RAI, TLLI, MS Validated) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN responds with a Context Response (MM Context, EPS Bearer Contexts). MM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2. If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN starts a timer and stops the transmission of N‑PDUs to the MS. The new SGSN shall ignore the MS Network Capability contained in MM Context of Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\nFor RAU between two S4-SGSNs, the old SGSN shall include the Change Reporting Action and CGI/SAI/RAI change support indication in the Context Response message.\nIf the new SGSN supports CIoT GSM Optimization, CIoT GSM Optimization support indication is included in the Context Request indicating support for various CIoT Optimisations (e.g. support for Non-IP data, SCEF, etc.).\nBased on the CIoT GSM Optimization support indication, old SGSN only transfers the PDP Context(s) that the new SGSN supports. If the new SGSN does not support CIoT GSM Optimization, Non-IP PDP Context(s) are not transferred to the new SGSN. If the PDP Context(s) has not been transferred, the old SGSN deactivate that PDP Context(s). Any buffered data in the old SGSN is discarded.\n4.\tThe new SGSN sends a Context Acknowledge message to the old SGSN. The old SGSN marks in its context that the MSC/VLR association and the information in the GWs and the HSS are invalid. This triggers the MSC/VLR, the S‑GW, the P‑GW and the HSS to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure. If the security functions do not authenticate the MS correctly, then the routeing area update shall be rejected, and the new SGSN shall send a reject indication to the old SGSN. The old SGSN shall continue as if the Context Request was never received.\nFigure 33b: Step 6 for Inter SGSN Routeing Area Update Procedure and Combined Inter SGSN RA / LA Update to S4-SGSNs\nNOTE:\tSteps A) and D) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (B1) are defined in TS 23.402 [90]. Steps B) and C) concern GTP based S5/S8.\n6A)\tIf the S‑GW does not change, the new SGSN updates these EPS Bearer contexts by sending Modify Bearer Request (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, SGSN Address(es) and TEID(s), PDN GW addresses and TEIDs (for GTP-based S5/S8) or GRE keys (for PMIP-based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication). The SGSN puts the according NSAPI in the field of EPS Bearer ID. If ISR is activated on the S‑GW that is updated by a new SGSN then this S‑GW deletes the bearer resources on the other old CN node by sending Delete Session Request message(s) to that CN node.\nIf the S‑GW changes or if an S‑GW needs to be allocated (Gn/Gp to S4-SGSN RAU) the SGSN selects an S‑GW and sends a Create Session Request message (APN-AMBR) with the content as described for the Modify Bearer Request message to the S‑GW.\nFor Gn/Gp to S4-SGSN RAU, the new S4-SGSN provides APN-AMBR to the Serving GW. Details on mapping MBR to APN-AMBR are specified in Annex E of TS 23.401 [89].\nIf the new SGSN receives the PDP context with SCEF, then the new SGSN updates the SCEF as defined in TS 23.682 [119].\n6B)\tIf the S-GW has changed, or if an S GW needs to be allocated (Gn/Gp to S4-SGSN RAU), or the RAT type has changed, or the S-GW received CGI/SAI from the S4-SGSN, the S‑GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, APN-AMBR) messages to the P‑GWs involved.\n6C)\tThe P‑GWs acknowledge by sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, Default bearer id, APN-AMBR) messages to S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP/EPS Bearer context. The default bearer id is included if the UE moves from a Gn/Gp SGSN to an S4-SGSN.\n6D)\tThe S‑GW acknowledges the user plane switch to the new SGSN via the message Modify Bearer Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, PDN GW addresses and TEIDs (for GTP-based S5/S8) or GRE keys (for PMIP-based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, default bearer id, APN-AMBR). If the SGSN sent a Create Session Request message the S‑GW sends a Create Session Response message with the content as described for the Modify Bearer Response message to the SGSN.\nIf there are active GBR bearers with maximum bit rate set to 0, the S4-SGSN should use the SGSN-initiated PDP Context Deactivation Procedure using S4 (as defined in clause 9.2.4.2) to deactivate the PDP Context.\nWhen the SGSN receives the Modify Bearer Response message, the SGSN checks if there is a \"Notify-on-available-after-DDN-failure\" monitoring event or a \"UE Reachability\" monitoring event configured for the UE in the SGSN and in such a case sends an event notification according to TS 23.682 [119].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.9.1.2.2",
        "clause_5.3.15",
        "clause_5.3.13.7",
        "clause_6.16",
        "clause_5.3.8",
        "clause_13.2.2",
        "clause_9.2.4.2",
        "figure_33",
        "ts_23.401_figure_33",
        "ts_24.008",
        "ts_23.401",
        "ts_23.682",
        "ts_23.221",
        "ts_23.008",
        "ts_23.122",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.3.0",
      "section_id": "6.9.1.3.0",
      "section_title": "General",
      "content": "A combined RA / LA update takes place in network operation mode I when:\n-\tthe MS enters a new RA (except for the case of an MS configured to perform GPRS Attach with IMSI when entering an RA in a new non-equivalent PLMN in RRC-IDLE mode, in which case, a Combined GPRS Attach shall be performed) or\n-\twhen a GPRS‑attached MS performs an IMSI attach or\n-\twhen the MS has to indicate changed access capabilities or DRX parameters to the network, or\n-\twhen a change in conditions in the MS requires a change in the extended idle mode DRX parameters previously negotiated with the SGSN.\n-\tfor a UE supporting CS fallback, or configured to support IMS voice, or both, a change of the UE's usage setting or voice domain preference for E-UTRAN, or\n-\tfor an SR-VCC capable MS, the MS has changed its MS Classmark 2, or MS Classmark 3, or Supported Codec information, or\n-\twhen a suspended MS is not resumed by the BSS (see clause \"Suspension of GPRS Services\"), or\n-\twhen the MS reselects GERAN/UTRAN with the TIN indicating \"GUTI\", or\n-\twhen the MS moves from E-UTRAN-connected to GERAN via Cell Change Order that is not for CS fallback. If the TIN indicates \"RAT-related TMSI\" the MS shall set the TIN to \"GUTI\" before initiating the RA update procedure;\n-\tthe RRC layer in an E-UTRAN capable UE informs the UE's NAS layer that an RRC connection failure occurred in E-UTRAN and this led the MS to select a GERAN/UTRAN cell.\n-\twhen a EPS and IMSI attached MS camps on GERAN/UTRAN and the E-UTRAN periodic TAU timer expires and the TIN indicates \"RAT Related TMSI\".\n-\tthe UE Network Capability and/or MS Network Capability are changed.\nThe MS sends a Routeing Area Update Request indicating that an LA update may also need to be performed, in which case the SGSN forwards the LA update to the VLR. This concerns only idle mode (see TS 23.122 [7b]), as no combined RA / LA updates are performed during a CS connection.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.122"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.3.1",
      "section_id": "6.9.1.3.1",
      "section_title": "Combined Intra SGSN RA / LA Update",
      "content": "The Combined RA / LA Update (intra SGSN) procedure is illustrated in Figure 34. This procedure applies for S4-SGSNs and for Gn/Gp SGSNs.\nFigure 34: Combined RA / LA Update in the Case of Intra SGSN RA Update Procedure\n1)\tThe MS sends a Routeing Area Update Request (old RAI, old P‑TMSI Signature, Update Type, MS Radio Access Capability, DRX parameters, extended Idle mode DRX request, MS Network Capability, additional P‑TMSI/RAI, Voice domain preference and UE's usage setting, SMS-only) to the SGSN. Update Type shall indicate combined RA / LA update, or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attach requested. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the SGSN. MS Radio Access Capability contains the MS GPRS multislot capabilities, supported frequency bands, etc as defined in TS 24.008 [13]. DRX Parameters are included if the MS has altered its DRX Parameters. Extended idle mode DRX parameters information element is included if the MS wants to enable extended Idle mode DRX.\nIf the E‑UTRAN capable UE's TIN indicates \"GUTI\" and the UE holds a valid GUTI then the UE indicates the GUTI as the old P‑TMSI and old RAI. If the UE's TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\" and the UE holds a valid P‑TMSI and related RAI then these two elements are indicated as old P‑TMSI and old RAI. Mapping a GUTI to a P‑TMSI and an RAI is specified in TS 23.401 [89]. In this scenario of Combined RA/LA Update in the Case of Intra SGSN RAU, the TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\".\nIf the E‑UTRAN capable UE holds a valid P‑TMSI and related RAI then the UE indicates these parameters as additional P‑TMSI/RAI, regardless whether the old P‑TMSI and old RAI indicate the same parameters or parameters mapped from a GUTI.\nThe Gn/Gp SGSN shall ignore this additional P‑TMSI/RAI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nThe MS indicates its \"SMS-only\" capability during a combined RA/LA update when the MS is requesting the LA update or IMSI attach only for obtaining SMS and not any other services from CS domain.\n2)\tSecurity functions may be executed. This procedure is defined in clause \"Security Function\". If the security functions fail (e.g. because the SGSN cannot determine the HLR address to establish the Send Authentication Info dialogue), the Inter SGSN RAU Update procedure fails. A reject shall be returned to the MS with an appropriate cause.\n3)\tIf the association has to be established, if Update Type indicates combined RA / LA update with IMSI attach requested, or if Update Type indicates combined RA / LA update without IMSI attach and the the MS Network Capability IE indicates that EMM Combined procedure is supported, or if the LA changed with the routeing area update, the SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The VLR creates or updates the association with the SGSN by storing SGSN Number.\nThis step is not performed if:\n-\tSubscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data; or\n-\tSubscription Data have an HSS indication of \"SMS in SGSN Support\" and the subscription allows SMS services and the MS indicated \"SMS-only\" and the SGSN provides SMS services via PS domain NAS.\n4)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the data in the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\nIf the MS performs the Combined RA / LA Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the VLR needs to retrieve the CSG subscription information of the MS from the CSS, the VLR initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n5)\tThe new VLR allocates a new VLR TMSI and responds with Location Update Accept (VLR TMSI) to the SGSN. VLR TMSI is optional if the VLR has not changed.\n6)\tThe SGSN validates the MS's presence in the new RA. If due to regional subscription restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the SGSN updates the MM context for the MS. A new P‑TMSI may be allocated. The SGSN responds to the MS with Routeing Area Update Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature, IMS voice over PS Session Supported Indication, SMS-Supported, Cause). The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nFor using S4 variant, if ISR is activated for the MS when the S4-SGSN receives the Routeing Area Update Request in the intra SGSN scenario, the S4-SGSN should maintain ISR by indicating ISR Activated in the Routeing Area Update Accept message.\n\"SMS-Supported\" is indicated to the MS when the subscription data indicate \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN. If step 3 was not performed, e.g. due to Subscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data, then the SGSN indicates that the Attach was successful for GPRS only and a Cause indicates why the IMSI attach was not performed.\nIf the SGSN decides to enable extended idle mode DRX for an MS that included the extended idle mode DRX parameters information element, it includes the extended idle mode DRX parameters information element.\n7)\tIf a new P-TMSI or VLR TMSI was received, the MS confirms the reallocation of the TMSIs by returning a Routeing Area Update Complete message to the SGSN.\n8)\tThe SGSN sends a TMSI Reallocation Complete message to the VLR if the MS confirms the VLR TMSI.\nFor some network sharing scenario (e.g. GWCN) if the PLMN-ID of the RAI supplied by the RNC is different from that of the RAI in the UE's context, then the SGSN shall informs the HLR.\nIf the routeing area update procedure fails a maximum allowable number of times, or if the SGSN returns a Routeing Area Update Reject (Cause) message, the MS shall enter IDLE state.\nIf the Location Update Accept message indicates a reject, this should be indicated to the MS, and the MS shall not access non-GPRS services until a successful Location Update is performed. If \"SMS-Supported\" is indicated to the MS the MS should not initiate Attach or Location Update with the MSC for only obtaining SMS services as SMS services via PS domain NAS are provided by the SGSN.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Routeing_Area_Update_Session, CAMEL_PS_Notification and CAMEL_GPRS_Routeing_Area_Update_Context.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Routeing_Area_Update_Session is called once per session. In Figure 34, the procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_GPRS_Routeing_Area_Update_Context is called once per PDP context. In Figure 34, the procedure returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "clause_6.16",
        "clause_5.3.8",
        "figure_34",
        "ts_24.008",
        "ts_23.401",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.1.3.2",
      "section_id": "6.9.1.3.2",
      "section_title": "Combined Inter SGSN RA / LA Update",
      "content": "The Combined RA / LA Update (inter-SGSN) procedure is illustrated in Figure 35 for mobility between two Gn/Gp SGSNs and for mobility from S4-SGSN to Gn/Gp SGSN. The Inter SGSN Routeing Area Update procedure between two S4-SGSNs shows differences for the steps in the boxes (A) and (B). The Inter SGSN Routeing Area Update procedure from Gn/Gp SGSN to S4-SGSN shows differences for the steps in the box (B). These different step descriptions of the boxes are described in clause \"Inter SGSN Routeing Area Update and Combined Inter SGSN RA / LA Update using S4\".\nFigure 35: Combined RA / LA Update in the Case of Inter SGSN RA Update Procedure\nNOTE 1:\tAll steps in figure 35, except steps 2, 4 and 6, are common for architecture variants using Gn/Gp based and S4 based SGSN. For specific interactions with S4 based SGSNs, procedure steps (A) and (B) are defined in the clause 6.9.1.2.2a.\n1)\tThe MS sends a Routeing Area Update Request (old RAI, old P‑TMSI Signature, Update Type, MS Radio Access Capability, DRX parameters, extended idle mode DRX parameters, MS Network Capability, additional P-TMSI/RAI, Voice domain preference and UE's usage setting, SMS-only) to the new SGSN. Update Type shall indicate combined RA / LA update, or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attach requested. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the SGSN. MS Radio Access Capability contains the MS GPRS multislot capabilities, supported frequency bands, etc. as defined in TS 24.008 [13]. DRX Parameters are included if the MS has altered its DRX Parameters. Extended idle mode DRX parameters information element is included if the MS wants to enable extended idle mode DRX.\nIf the E‑UTRAN capable UE's TIN indicates \"GUTI\" and the UE holds a valid GUTI then the UE indicates the GUTI as the old P‑TMSI and old RAI. If the UE's TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\" and the UE holds a valid P‑TMSI and related RAI then these two elements are indicated as old P‑TMSI and old RAI. Mapping a GUTI to a P‑TMSI and an RAI is specified in TS 23.401 [89]. In this scenario of Combined RA/LA Update in the case of inter SGSN RAU, the TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\".\nIf the E‑UTRAN capable UE holds a valid P‑TMSI and related RAI then the UE indicates these parameters as additional P‑TMSI/RAI, regardless whether the old P‑TMSI and old RAI indicate the same parameters or parameters mapped from a GUTI.\nThe Gn/Gp SGSN shall ignore this additional P‑TMSI/RAI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nThe MS indicates its \"SMS-only\" capability during a combined RA / LA update when the MS is requesting the LA update or IMSI attach only for obtaining SMS and not any other services from CS domain.\n2)\tThe new SGSN sends SGSN Context Request (old RAI, TLLI, old P‑TMSI Signature, New SGSN Address) to the old SGSN to get the MM and PDP contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI (or TLLI) and send the SGSN Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI (or TLLI) and relay the message to that actual old SGSN. The old SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send an SGSN Context Request (old RAI, TLLI, MS Validated, New SGSN Address) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN stops assigning SNDCP N‑PDU numbers to downlink N‑PDUs received, and responds with SGSN Context Response (MM Context, PDP Contexts, Negotiated Evolved ARP). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN stores New SGSN Address until the old MM context is cancelled, to allow the old SGSN to forward data packets to the new SGSN. Each PDP Context includes the SNDCP Send N‑PDU Number for the next downlink N‑PDU to be sent in acknowledged mode to the MS, the SNDCP Receive N‑PDU Number for the next uplink N‑PDU to be received in acknowledged mode from the MS, the GTP sequence number for the next downlink N‑PDU to be sent to the MS and the GTP sequence number for the next uplink N‑PDU to be tunnelled to the GGSN. The old SGSN starts a timer and stops the downlink transfer. The new SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\nFor RAU between two S4-SGSNs, the old SGSN shall include the Change Reporting Action in the Context Response message.\nSNDCP and GTP sequence numbers are not relevant for a new S4-SGSN if provided by an old Gn/Gp SGSN and need not to be provided by an old S4-SGSN as the EPS network shall not configure usage of \"delivery order required\" and no acknowledged mode NSAPIs (SNDCP) as described in clause \"Network Configuration for Interaction with E-UTRAN and S4-SGSNs\".\nIf the new SGSN supports CIoT GSM Optimization, the CIoT GSM Optimization support indication is included in the SGSN Context Request indicating support for various CIoT Optimisations (e.g. support for Non-IP data, SCEF, etc.).\nBased on the CIoT GSM Optimization support indication, old SGSN only transfers the PDP Context(s) that the new SGSN supports. If the new SGSN does not support CIoT GSM Optimization, Non-IP PDP Context(s) are not transferred to the new SGSN. If the PDP Context(s) has not been transferred, the old SGSN deactivate that PDP Context(s) and any buffered data in the old SGSN is discarded after receipt of SGSN Context Acknowledge.\n3)\tSecurity functions may be executed. These procedures are defined in clause \"Security Function\". Ciphering mode shall be set if ciphering is supported. If the SGSN Context Response message did not include IMEISV and ADD is supported, the SGSN retrieves the IMEISV from the MS. If the security functions fail (e.g. because the SGSN cannot determine the HLR address to establish the Send Authentication Info dialogue), the Inter SGSN RAU Update procedure fails. A reject shall be returned to the MS with an appropriate cause.\n4)\tThe new SGSN sends an SGSN Context Acknowledge message to the old SGSN. This informs an old Gn/Gp SGSN that the new SGSN is ready to receive data packets belonging to the activated PDP contexts. Only old Gn/Gp SGSNs may forward data to a new Gn/Gp or S4-SGSN.\nThe old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure. If the security functions do not authenticate the MS correctly, the routeing area update shall be rejected, and the new SGSN shall send a reject indication to the old SGSN. The old SGSN shall continue as if the SGSN Context Request was never received.\n5)\tOnly old Gn/Gp SGSNs may forward data to a new SGSN. An old Gn/Gp SGSN duplicates the buffered N‑PDUs and starts tunnelling them to the new SGSN. Additional N‑PDUs received from the GGSN before the timer described in step 2 expires are also duplicated and tunnelled to the new SGSN. N‑PDUs that were already sent to the MS in acknowledged mode and that are not yet acknowledged by the MS are tunnelled together with the SNDCP N‑PDU number. No N‑PDUs shall be forwarded to the new SGSN after expiry of the timer described in step 2.\nSNDCP N-PDU numbers are not relevant for S4-SGSNs as the network shall not configure usage of acknowledged mode NSAPIs (SNDCP) as described in clause \"Network Configuration for Interaction with E-UTRAN and S4-SGSNs\". A new S4-SGSN indicates reserved TEID and IP address parameters from an SGW to an old Gn/Gp SGSN so that the old Gn/Gp SGSN can forward data packets when needed. The SGW discards any packets received from old Gn/Gp SGSN.\n6)\tThe new SGSN sends Update PDP Context Request (new SGSN Address, TEID, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, NRSN) to the GGSNs concerned. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Context Response message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return an Update PDP Context Response (TEID, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP). The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89] Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\nIf the new SGSN receives the PDP context with SCEF, then the new SGSN updates the SCEF as defined in TS 23.682 [119].\n7)\tThe new SGSN informs the HLR of the change of SGSN by sending Update Location (SGSN Number, SGSN Address, IMSI, IMEISV, Homogenous Support of IMS Voice over PS Sessions, UE SRVCC capability, Registration For SMS Request) to the HLR. IMEISV is sent if the ADD function is supported. If the S6d interface is used between S4-SGSN and HSS, a parameter \"SMS in SGSN offered\" is included in the Update Location message, otherwise this parameter is included in the Insert Subscriber Data Ack (Step 9). \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN.\nFor \"Homogenous Support of IMS Voice over PS Sessions\", see clause 5.3.8A.\nNOTE 2:\tAs this is an A/Gb mode RAU procedure, and the T-ADS feature requires distinct GERAN and UTRAN Routing Areas, per-MS checking of the support of \"IMS voice over PS Session\" is not needed in this procedure.\nIf the MS performs the Routeing Area Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the SGSN needs to retrieve the CSG subscription information of the MS from the CSS, the SGSN initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n8)\tThe HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN with Cancellation Type set to Update Procedure. If the timer described in step 2 is not running, the old SGSN removes the MM and PDP contexts/EPS Bearer Contexts and an old S4-SGSN releases in addition the S‑GW resources when the new SGSN is a Gn/Gp SGSN or when an S‑GW change is performed. GTPv1 SGSN context transfer signalling indicates to the old S4-SGSN that the new SGSN is a Gn/Gp SGSN, which does not signal any S‑GW change. When the timer described in step 2 is running, the MM and PDP/EPS Bearer Contexts and any affected S‑GW resources are removed when the timer expires. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\nThe timer started in step 2 allows the old SGSN to complete the forwarding of N‑PDUs. It also ensures that the MM and PDP contexts/EPS Bearer Contexts are kept in the old SGSN in case the MS initiates another inter SGSN routeing area update before completing the ongoing routeing area update to the new SGSN. The old SGSN acknowledges with Cancel Location Ack (IMSI).\n9)\tThe HLR sends Insert Subscriber Data (IMSI, Subscription Data) to the new SGSN. The new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions or access restrictions the MS is not allowed to be attached in the RA, the SGSN rejects the Routeing Area Update Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If all checks are successful, the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI, SMS in SGSN offered) message to the HLR. The \"SMS in SGSN offered\" indicates if the SGSN supports SMS services via NAS. If the S6d interface is used between S4-SGSN and HSS the messages \"Insert Subscriber Data\" and \"Insert Subscriber Data Ack\" are not used. Instead the Subscription Data is sent by HSS in the message Update Location Ack (Step 10).\n10)\tThe HLR acknowledges the Update Location by sending Update Location Ack (IMSI, GPRS Subscriber Data (only if S6d interface is used)) to the new SGSN. If the HLR accepts to register the SGSN identity for terminating SMS services, then the HLR cancels the serving MSC if there is a serving MSC.\n11)\tIf the association has to be established, if Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the new SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 9). The VLR creates or updates the association with the SGSN by storing SGSN Number.\nThis step is not performed if:\n-\tSubscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data; or\n-\tSubscription Data have an HSS indication of \"SMS in SGSN Support\" and the subscription allows SMS services and the MS indicated SMS-only and the SGSN provides SMS services via PS domain NAS.\n12)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\nIf the MS performs the Combined RA / LA Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the VLR needs to retrieve the CSG subscription information of the MS from the CSS, the VLR initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n13)\tThe new VLR allocates a new TMSI and responds with Location Update Accept (VLR TMSI) to the SGSN. VLR TMSI is optional if the VLR has not changed.\n14)\tThe new SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the new SGSN establishes MM and PDP contexts/EPS Bearer Contexts for the MS. A logical link is established between the new SGSN and the MS. The new SGSN responds to the MS with Routeing Area Update Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature, Receive N‑PDU Number, IMS voice over PS Session Supported Indication, SMS-Supported, Cause). Receive N‑PDU Number contains the acknowledgements for each acknowledged-mode NSAPI used by the MS, thereby confirming all mobile-originated N‑PDUs successfully transferred before the start of the update procedure. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nISR Activated is never indicated in case of inter SGSN RAU as described in TS 23.401 [89]. The E‑UTRAN capable UE sets its TIN to \"P‑TMSI\" or \"RAT-related TMSI\" as described for Routing Area Update procedures in TS 23.401 [89].\n\"SMS-Supported\" is indicated to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN. If step 11 was not performed, e.g. due to Subscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data, then SGSN indicates that the Attach was successful for GPRS only and a Cause indicates why the IMSI attach was not performed.\nIn Iu mode, if after step 6 the new SGSN receives a Downlink Data Notification message or any other downlink signalling message while the MS is still connected, the new SGSN may prolong the PS signalling connection with the MS.\nIf the SGSN decides to enable extended idle mode DRX for an MS that included the extended idle mode DRX parameters information element, it includes the extended idle mode DRX parameters information element.\n15)\tThe MS confirms the reallocation of the TMSIs by returning a Routeing Area Update Complete (Receive N‑PDU Number) message to the SGSN. Receive N‑PDU Number contains the acknowledgements for each acknowledged-mode NSAPI used by the MS, thereby confirming all mobile-terminated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms reception of N‑PDUs that were forwarded from the old SGSN, these N‑PDUs shall be discarded by the new SGSN. LLC and SNDCP in the MS are reset.\n16)\tThe new SGSN sends a TMSI Reallocation Complete message to the new VLR if the MS confirms the VLR TMSI.\nFor a rejected routeing area update operation, due to regional subscription, roaming restrictions, access restrictions (see clause 5.3.19) or because the SGSN cannot determine the HLR address to establish the locating updating dialogue, the new SGSN should not construct an MM context. In the case of receiving the subscriber data from HLR, the new SGSN may construct an MM context and store the subscriber data for the MS to optimize signalling between the SGSN and the HLR. A reject shall be returned to the MS with an appropriate cause. Upon return to idle, the MS shall act according to TS 23.122 [7b].\nIf the new SGSN is unable to update the PDP context/EPS Bearer Context in one or more GGSNs/P‑GWs, the new SGSN shall deactivate the corresponding PDP contexts/EPS Bearer Contexts as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe PDP Contexts/EPS Bearer Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important PDP Context/EPS Bearer Context first in the SGSN Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer Context for using S4 from the GGSN/P‑GW or old S4-SGSN and then store the new Maximum APN restriction value.\nIf the new SGSN is unable to support the same number of active PDP contexts/EPS Bearer Contexts as received from old SGSN, the new SGSN should use the prioritisation sent by old SGSN as input when deciding which PDP contexts/EPS Bearer Contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in one or more GGSNs/EPS Bearer Context and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nIf the routeing area update procedure fails a maximum allowable number of times, or if the SGSN returns a Routeing Area Update Reject (Cause) message, the MS shall enter IDLE state.\nIf the timer described in step 2 expires and no Cancel Location (IMSI) was received from the HLR, the old SGSN shall stop forwarding N‑PDUs to the new SGSN.\nIf the Location Update Accept message indicates a reject, this should be indicated to the MS, and the MS shall not access non-GPRS services until a successful location update is performed. If \"SMS-Supported\" is indicated to the MS the MS should not initiate Location Update or IMSI attach with the MSC for only obtaining SMS services as SMS services via PS domain NAS are provided by the SGSN.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context. It returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.9.1.2.2",
        "clause_5.3.15",
        "clause_5.3.8",
        "clause_6.16",
        "clause_5.3.19",
        "figure_35",
        "ts_24.008",
        "ts_23.401",
        "ts_23.682",
        "ts_23.122",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2",
      "section_id": "6.9.2",
      "section_title": "Location Management Procedures (Iu-mode)",
      "content": "In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nRefer to TS 25.301 [50] for further information on the location management procedures for the UTRAN.\nThe PLMN shall provide information for the MS to be able to:\n-\tdetect when it has entered a new cell or a new RA; and\n-\tdetermine when to perform periodic RA updates.\nIn this specification, only the Location Management procedures related to the CN are described. These procedures are:\n-\ta routeing area update procedure; and\n-\tServing RNC relocation procedure.\nAn MS detects entering a new cell by comparing the cell's identity with the cell identity stored in the MS. By comparing the RAI stored in the MS's MM context with the RAI received from the network, the MS detects that an RA update shall be performed. In RRC‑CONNECTED mode (PMM‑CONNECTED state or CS MM CONNECTED state), the MS is informed of RAI and Cell Identity by the serving RNC via an \"MM information\" message at the RRC layer. In RRC‑IDLE state, the MS is informed of RAI and Cell Identity by the broadcast system information at the RRC layer.\nIf the MS enters a new PLMN, the MS shall perform a routeing area update, unless it is not allowed to do so for the reasons specified in TS 24.008 [13] and TS 23.122 [7b], or it is an MS configured to perform Attach with IMSI at PLMN change.\nIn network mode of operation II, whenever an MS that needs only PS and NAS based SMS services determines that it shall perform both an LA update/IMSI attach and an RA update/GPRS attach, the MS shall complete the RA update / GPRS attach first before initiating the LA update/ IMSI attach. If the GPRS Attach or RA update procedure indicates that NAS based SMS is supported by the PS domain, such an MS determines that no LA update / IMSI Attach is required.\nIn network mode of operation II, whenever an MS that needs PS services and CS services other than NAS based SMS determines that it shall perform both an LA update and an RA update, the MS shall start the LA update first. The MS should start the RA update procedure before the LA update is completed.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_25.301",
        "ts_24.008",
        "ts_23.122"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.1",
      "section_id": "6.9.2.1",
      "section_title": "Routeing Area Update Procedure",
      "content": "A Routeing Area Update takes place when an attached MS detects:\n-\tthat it has entered a new RA (except for the case of an MS configured to perform GPRS Attach with IMSI when entering an RA in a new non-equivalent PLMN in RRC-IDLE mode, in which case, a GPRS Attach shall be performed);\n-\twhen the periodic RA update timer has expired;\n-\twhen RRC connection is released with cause \"Directed Signalling connection re-establishment\";\n-\twhen the MS has to indicate changed access capabilities or new DRX parameters to the network;\n-\twhen a change in conditions in the MS require a change in the extended idle mode DRX parameters previously negotiated with the SGSN.\n-\tfor a UE supporting CS fallback, or configured to support IMS voice, or both, a change of the UE's usage setting or voice domain preference for E-UTRAN;\n-\tfor an SR-VCC capable MS, the MS has changed its MS Classmark 2, or MS Classmark 3, or Supported Codec information;\n-\twhen the MS reselects GERAN/UTRAN with the TIN indicating \"GUTI\";\n-\tthe RRC layer in an E-UTRAN capable UE informs the UE's NAS layer that an RRC connection failure occurred in E-UTRAN and this led the MS to select a GERAN/UTRAN cell;\n-\tthat it has manually selected a CSG cell whose CSG ID and associated PLMN is absent from both the MS's Allowed CSG list and the MS's Operator CSG list; or\n-\tthat it is registered for IMS voice and has moved from a RAT that supports IMS voice over PS sessions (see clause 5.3.8 for more information) to one that does not, or vice versa. It shall be possible. using Device Management or initial provisioning to configure the UE to apply/not apply this particular exception.\nNOTE 1:\tA UE moving between RATs that both support IMS voice over PS sessions, or, both that do not support IMS voice over PS sessions, is unaffected by the above.\n-\tMS receives a paging request from the SGSN while the Mobility Management back off timer is running and the MS's TIN indicates \"GUTI\".\nThe SGSN detects that it is an intra-SGSN routeing area update by noticing that it also handles the old RA. In this case, the SGSN has the necessary information about the MS and there is no need to inform the GGSNs or the HLR about the new MS location. A periodic RA update is always an intra-SGSN routeing area update. If the network operates in mode I, an MS that is in CS/PS mode of operation shall perform the Combined RA / LA Update procedures except this CS/PS mode MS is engaged in a CS connection, then it shall perform (non combined) RA Update procedures. When a EPS and IMSI attached MS camps on UTRAN/GERAN and the E-UTRAN periodic TAU timer expires and the TIN indicates \"RAT Related TMSI\", the MS shall perform combined RA/LA update procedure.\nIn Iu mode, an RA update is either an intra-SGSN or inter-SGSN RA update, either combined RA / LA update or only RA update, either initiated by an MS in PMM‑CONNECTED or in PMM‑IDLE state. The SRNC may provide a PMM-CONNECTED state MS with MM information like RAI by dedicated signalling. Typically, the SRNC should not provide a RAI to an MS in PMM-CONNECTED state. An exception is after an SRNS relocation, in which case the new SRNC shall indicate the RAI to the MS.\nDuring the Routeing Area Update procedure, the MS provides its PS Handover capabilities as defined in TS 24.008 [13].\nDuring the Routeing Area Update procedure, if the SGSN supports SRVCC and if the UE SRVCC capability has changed, it notifies the HSS with the UE SRVCC capability via Update Location Request or Notify Request message, and the HSS stores this information e.g. for further IMS registration.\nAll the RA update cases are contained in the procedure illustrated in Figure 36.\nFigure 36 illustrates mobility between two Gn/Gp SGSNs and mobility from S4-SGSN to Gn/Gp SGSN. The Inter SGSN Routeing Area Update procedure between two S4-SGSNs shows differences for the steps in the boxes (A) and (B). The Inter SGSN Routeing Area Update procedure from Gn/Gp SGSN to S4-SGSN shows differences for the steps in the box (B). These different step descriptions of the boxes are described in clause 6.9.2.1a \"Routeing Area Update Procedure using S4\".\nNOTE 2:\tThe network may receive an RA update from a UE in PMM-CONNECTED state over a new Iu signalling connection. This could happen when the UE enters PMM-IDLE state on receipt of RRC Connection Release with cause \"Directed Signalling connection re-establishment\" and initiates an RA or Combined RA update procedure (see clause 6.1.2.4.1).\nIf SIPTO at the local network is allowed for the APN associated with a PDN connection, and in case of stand-alone GW the Local Home Network ID is not the same, the source SGSN shall trigger the re-establishment of the SIPTO at the Local Network PDN connection as follows:\n-\tFor the intra-SGSN mobility, upon completion of the RAU procedure the SGSN checks that the Local Home Network ID has changed and decides whether to deactivate the SIPTO at the local Network PDN connection with the \"reactivation requested\" cause value according to clause 9.2.4.2.\n-\tFor the Inter-SGSN mobility, as part of the Routing Area Update procedure the new SGSN checks that the Local Home Network ID has changed and decides whether to deactivate the SIPTO at the Local Network PDN connection with the \"reactivation requested\" cause value according to clause 9.2.4.2.\nIf SIPTO at the local network is allowed for the APN associated with a PDN connection, and in case of collocated LGW, the source SGSN shall trigger the re-establishment of the SIPTO at the Local Network PDN connection as follows:\n-\tFor the intra-SGSN mobility, upon completion of the RAU procedure the SGSN shall deactivate the SIPTO at the local Network PDN connection with the \"reactivation requested\" cause value according to clause 9.2.4.2.\n-\tFor the Inter-SGSN mobility, as part of the Routing Area Update procedure the source SGSN shall not include the bearer(s) corresponding to the SIPTO at the local Network PDN connection into the PDP context and shall release the core network resources associated to the SIPTO at the local network PDN conection by performing the SGSN-initiated PDP Context Deactivation before sending the Context Response.\nIf LIPA is active for a PDN connection of the MS, the source Gn-SGSN shall not include LIPA bearer(s) in the PDP context during Routing Area Update procedure and shall release the core network resources of the LIPA PDN connections by performing the SGSN-initiated PDP Context Deactivation according to step A of clause 9.2.4.2 subsequent to the completion of the routing area update procedure. If LIPA is active for a PDN connection of the MS, the source S4-SGSN shall release the core network resources of the LIPA PDN connection by performing the SGSN-initiated PDP Context Deactivation according to step A of clause 9.2.4.2 before sending the Context Response.\nNOTE 3:\tThe source S4-SGSN may not be able to release the LIPA PDN connection after the Context Response is sent as the SGW will assign the S4 control plane tunnel of the UE to the new S4-SGSN.\nFigure 36: Iu mode RA Update Procedure\nNOTE 1:\tAll steps in figure 36, except steps 2, 3, 5 and 9, are common for architecture variants using Gn/Gp based and S4 based SGSNs. For specific interactions with S4 based SGSNs, procedure steps (A) and (B) are defined in the clause 6.9.2.1a.\nNOTE 2:\tFor Emergency Attach, an MS which is not successfully authenticated, steps 10, 11, 12, 13 and 14 are not performed.\n1)\tThe RRC connection is established, if not already done. The MS sends a Routeing Area Update Request message (P‑TMSI, old RAI, old P‑TMSI Signature, Update Type, follow on request, MS Radio Access Capability, DRX Parameters, extended idle mode DRX parameters, MS Network Capability, additional P-TMSI/RAI, Voice domain preference and UE's usage setting, SMS-only) to the new SGSN. The MS shall set a follow-on request if there is pending uplink traffic (signalling or user data). The SGSN may use, as an implementation option, the follow-on request indication to release or keep the Iu connection after the completion of the RA update procedure. Update Type shall indicate:\n-\tRA Update if the RA Update is triggered by a change of RA;\n-\tPeriodic RA Update if the RA update is triggered by the expiry of the Periodic RA Update timer;\n-\tCombined RA / LA Update if the MS is also IMSI-attached and the LA update shall be performed in network operation mode I (see clause \"Interactions Between SGSN and MSC/VLR\"); or\n-\tCombined RA / LA Update with IMSI attach requested if the MS wants to perform an IMSI attach in network operation mode I.\nThe SRNC shall add the Routeing Area Identity before forwarding the message to the 3G‑SGSN. This RA identity corresponds to the RAI in the MM system information sent by the SRNC to the MS. CSG ID is indicated if the MS sends the RAU Request message via a CSG cell or a hybrid cell. CSG access mode is provided if the MS sends the RAU Request message via a hybrid cell. If the CSG access mode is not provided but the CSG ID is provided, the SGSN shall consider the cell as a CSG cell. For SIPTO at the Local Network with stand-alone GW architecture the new SRNS includes also the Local Home Network ID in the Initial UE Message if the target cell is in a Local Home Network.\nMS Radio Access Capability is described in clause \"MS Network Capability\". The DRX Parameters contain information about DRX cycle length for GERAN, UTRAN and possibly other RATs, e.g. E-UTRAN. The extended idle mode DRX parameters information element is included if the MS wants to enable extended idle mode DRX.\nIf the E‑UTRAN capable UE's TIN indicates \"GUTI\" and the UE holds a valid GUTI then the UE indicates the GUTI as the old P‑TMSI and old RAI. If the UE's TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\" and the UE holds a valid P‑TMSI and related RAI then these two elements are indicated as old P‑TMSI and old RAI. Mapping a GUTI to a P‑TMSI and an RAI is specified in TS 23.401 [89]. In this scenario of Iu mode RAU, the TIN indicates \"P‑TMSI\" or \"RAT‑related TMSI\".\nIf the E‑UTRAN capable UE holds a valid P‑TMSI and related RAI then the UE indicates these parameters as additional P‑TMSI/RAI, regardless whether the old P‑TMSI and old RAI indicate the same parameters or parameters mapped from a GUTI.\nThe Gn/Gp SGSN shall ignore this additional P‑TMSI/RAI.\nThe UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nThe MS indicates its \"SMS-only\" capability during a combined RA/LA update when the MS is requesting LA update or IMSI attach only for obtaining SMS and not any other services from CS domain.\nNOTE 3:\tSending the Routeing Area Update Request message to the SGSN triggers the establishment of a signalling connection between RAN and SGSN for the concerned MS.\n2)\tIf the RA update is an Inter-SGSN Routeing area update and if the MS was in PMM‑IDLE state, the new SGSN sends an SGSN Context Request message (old P‑TMSI, old RAI, old P‑TMSI Signature) to the old SGSN to get the MM and PDP contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI and send the SGSN Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI and relay the message to that actual old SGSN. The old SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send an SGSN Context Request (IMSI, old RAI, MS Validated) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN starts a timer. If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause.\nIf the UE with emergency bearers is not authenticated in the old SGSN (in a network supporting unauthenticated UEs) the old SGSN continues the procedure with sending a Context Response and starting the timer also when it cannot validate the Context Request.\n2a) If the MS is PMM‑CONNECTED state in the old 3G‑Gn/Gp-SGSN or, in case of an intra-Gn/Gp-SGSN RA update, if the MS is in the PMM‑CONNECTED state and the RAU was received over another Iu connection than the established one, the old Gn/Gp SGSN sends an SRNS Context Request message to the old SRNS to retrieve the sequence numbers for the PDP context for inclusion in the SGSN Context Response message. Upon reception of this message, the SRNS buffers and stops sending downlink PDUs to the MS and returns an SRNS Context Response (IMSI, GTP‑SNDs, GTP‑SNUs, PDCP‑SNUs) message. The SRNS shall include for each PDP context the next in-sequence GTP sequence number to be sent to the MS and the GTP sequence number of the next uplink PDU to be tunnelled to the GGSN. For each active PDP context which uses lossless PDCP, the SRNS also includes the uplink PDCP sequence number (PDCP‑SNU). PDCP‑SNU shall be the next in-sequence PDCP sequence number expected from the MS (per each active radio bearer). No conversion of PDCP sequence numbers to SNDCP sequence numbers shall be done in the 3G-SGSN.\nSNDCP, GTP and PDCP sequence numbers are not relevant for the S4-SGSN as the network shall not configure usage of \"delivery order required\", no acknowledged mode NSAPIs (SNDCP) and also not loss less UTRAN PDCP as described in clause \"Network Configuration for Interaction with E-UTRAN and S4-SGSNs\".\n3)\tThe old 3G‑SGSN responds with an SGSN Context Response (MM Context, PDP Contexts, Negotiated Evolved ARP) message. For each PDP context the old 3G‑SGSN shall include the GTP sequence number for the next uplink GTP PDU to be tunnelled to the GGSN and the next downlink GTP sequence number for the next PDU to be sent to the MS. Each PDP Context also includes the PDCP sequence numbers if PDCP sequence numbers are received from the old SRNS. The new 3G-SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request. The GTP sequence numbers received from the old 3G-SGSN are only relevant if delivery order is required for the PDP context (QoS profile).\nIf the UE receives emergency services from the old 3G Gn/Gp-SGSN and the UE is UICCless, IMSI can not be included in the MM and PDP contexts in SGSN Context Response message. For emergency attached UEs if the IMSI cannot be authenticated then the IMSI shall be marked as unauthenticated.\nFor RAU between two S4-SGSNs, the old SGSN shall include the Change Reporting Action in the Context Response message.\n4)\tSecurity functions may be executed. These procedures are defined in clause \"Security Function\". If the SGSN Context Response message did not include IMEISV and ADD is supported, the SGSN retrieves the IMEISV from the MS. If the security functions do not authenticate the MS correctly, the routeing area update shall be rejected, and the new SGSN shall send a reject indication to the old SGSN. The old SGSN shall continue as if the SGSN Context Request was never received.\nIf the new SGSN is configured to allow emergency services for unauthenticated MS the new SGSN behave as follows:\n-\twhere a MS has only emergency bearer services, the SGSN either skips the authentication and security setup or accepts that the authentication may fail and continues the Routeing area update procedure, or.\n-\twhere a MS has both emergency and non emergency bearer services and authentication fails, the SGSN continues the Routing Area Update procedure and deactivates all the non-emergency PDP contexts as specified in clause 9.2.4.2.\n5)\tIf the RA update is an Inter-SGSN Routeing area update, the new SGSN sends an SGSN Context Acknowledge message to the old SGSN. This informs an old Gn/Gp SGSN that the new SGSN is ready to receive data packets belonging to the activated PDP contexts. Only old Gn/Gp SGSNs may forward data to a new Gn/Gp or S4-SGSN. A new S4-SGSN indicates reserved TEID and IP address parameters from an SGW to an old Gn/Gp SGSN so that the old Gn/Gp SGSN can forward data packets when needed. The SGW discards any packets received from old Gn/Gp SGSN.\nThe old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure.\n6)\tIf the MS is in PMM‑CONNECTED state in the old 3G-Gn/Gp-SGSN or, in case of an intra-Gn/Gp-SGSN RA update, if the MS is PMM connected and the RAU was received over another Iu connection than the established one, the old 3G‑Gn/Gp-SGSN sends an SRNS Data Forward Command (RAB ID, Transport Layer Address, Iu Transport Association) message to the SRNS. Upon receipt of the SRNS Data Forward Command message from the 3G‑SGSN, the SRNS shall start the data-forwarding timer.\n7)\tFor each indicated RAB the SRNS starts duplicating and tunnelling the buffered GTP PDUs to the old 3G-Gn/Gp-SGSN. For each radio bearer which uses lossless PDCP the SRNS shall start tunnelling the partly transmitted and the transmitted but not acknowledged PDCP-PDUs together with their related PDCP sequence numbers and start duplicating and tunnelling the buffered GTP PDUs to the old 3G-Gn/Gp-SGSN. Upon receipt of the SRNS Data Forward Command message from the 3G-Gn/Gp-SGSN, the SRNS shall start the data-forwarding timer.\n8)\tIf the RA update is an Inter-SGSN RA Update, the old 3G‑SGSN tunnels the GTP PDUs to the new 3G‑SGSN. No conversion of PDCP sequence numbers to SNDCP sequence numbers shall be done in the 3G-SGSN.\n9)\tIf the RA update is an Inter-SGSN RA Update and if the MS was not in PMM-CONNECTED state in the new 3G-SGSN, the new SGSN sends Update PDP Context Request (new SGSN Address, QoS Negotiated, Negotiated Evolved ARP, Tunnel Endpoint Identifier, serving network identity, CN Operator Selection Entity, CGI/SAI, RAT type, MS Info Change Reporting support indication, NRSN) to the GGSNs concerned. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Context Response message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return an Update PDP Context Response (Tunnel Endpoint Identifier, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP). The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\nNOTE 4:\tIf the RA update is an Inter-SGSN routeing area update initiated by an MS in PMM‑CONNECTED state in the new 3G-SGSN, the Update PDP Context Request message is sent as described in clause \"Serving RNS Relocation Procedures\".\n10)\tIf the RA update is an Inter-SGSN RA Update, the new SGSN informs the HLR of the change of SGSN by sending Update Location (SGSN Number, SGSN Address, IMSI, IMEISV, Homogenous Support of IMS Voice over PS Sessions, UE SRVCC capability, Registration For SMS Request) to the HLR. IMEISV is sent if the ADD function is supported. The \"Homogenous Support of IMS Voice over PS Sessions\" indication (see clause 5.3.8A) shall not be included unless the SGSN has completed its evaluation of the support of \"IMS voice over PS Session\" as specified in clause 5.3.8. If the S6d interface is used between S4-SGSN and HSS, a parameter \"SMS in SGSN offered\" is included in the Update Location message, otherwise this parameter is included in the Insert Subscriber Data Ack (Step 12). \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via SGSN.\nNOTE 5:\tAt this step, the SGSN may not have all the information needed to determine the setting of the IMS voice over PS Session Supported indication for this MS (see clause 5.3.8). Hence the SGSN can send the \"Homogenous Support of IMS Voice over PS Sessions\" later on in this procedure.\nIf the MS performs the Routeing Area Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the SGSN needs to retrieve the CSG subscription information of the MS from the CSS, the SGSN initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n11)\tIf the RA update is an Inter-SGSN RA Update, the HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN with Cancellation Type set to Update Procedure. If the timer described in step 2 is not running, the old SGSN removes the MM and PDP context/EPS Bearer Contexts and an old S4-SGSN releases in addition the S‑GW resources when the new SGSN is a Gn/Gp SGSN or when an S‑GW change is performed. GTPv1 SGSN context transfer signalling indicates to the old S4-SGSN that the new SGSN is a Gn/Gp SGSN, which does not signal any S‑GW change. When the timer described in step 2 is running the MM and PDP/EPS Bearer Contexts and any affected S‑GW resources are removed when the timer expires and the SGSN received a Cancel Location. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\nWhen the timer described in step 2 expires and no Cancel Location was received the S4-SGSN removes the PDP contexts/EPS Bearer Contexts but preserves the MM context.\nThe timer started in step 2 ensures that the MM and PDP contexts/EPS Bearer Contexts are kept in the old SGSN in case the MS initiates another inter SGSN routeing area update before completing the ongoing routeing area update to the new SGSN. The old SGSN acknowledges with Cancel Location Ack (IMSI).\n11a)\tOn receipt of Cancel Location, if the MS is PMM‑CONNECTED in the old 3G‑SGSN, the old 3G‑SGSN sends an Iu Release Command message to the old SRNC. When the data-forwarding timer has expired, the SRNS responds with an Iu Release Complete message.\n12)\tIf the RA update is an inter-SGSN RA Update, the HLR sends Insert Subscriber Data (IMSI, subscription data) to the new SGSN. The new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions or access restrictions (e.g. CSG restrictions) the MS is not allowed to be attached in the RA, the SGSN rejects the Routeing Area Update Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the Routeing Area Update Request. If all checks are successful, the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI, SMS in SGSN offered) message to the HLR. The \"SMS in SGSN offered\" indicates that the SGSN supports SMS services via NAS. If the S6d interface is used between S4-SGSN and HSS the messages \"Insert Subscriber Data\" and \"Insert Subscriber Data Ack\" are not used. Instead the Subscription Data is sent by HSS in the message Update Location Ack (Step 13). The subscription data may contain the CSG subscription data for the PLMN.\nIf the MS initiates the RAU procedure at a CSG cell, the new SGSN shall check whether the CSG ID and associated PLMN and associated PLMN is contained in the CSG subscription and is not expired. If the CSG ID and associated PLMN is not present or expired, the SGSN shall send a RAU reject message to the MS with an appropriate cause value. The MS shall remove the CSG ID and associated PLMN from its Allowed CSG list, if present.\n13)\tIf the RA update is an Inter-SGSN RA Update, the HLR acknowledges the Update Location by sending Update Location Ack (IMSI, GPRS Subscriber Data (only if S6d interface is used)) to the new SGSN. If the HLR accepts to register the SGSN identity for terminating SMS services, then the HLR cancels the serving MSC if there is a serving MSC.\n14)\tIf Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the association has to be established, and the new SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 8). The VLR creates or updates the association with the SGSN by storing SGSN Number. In networks that support network sharing, the Location Update Request includes the identity of the selected core network operator if the SGSN has received this information from the RNS, as described in TS 23.251 [83].\nThis step is not performed if:\n-\tSubscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data; or\n-\tSubscription Data have an HSS indication of \"SMS in SGSN Support\" and the subscription allows SMS services and the MS indicated SMS-only and the SGSN provides SMS services via PS domain NAS.\n15)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\nIf the MS performs the Routing Area Update procedure in a VPLMN supporting Autonomous CSG Roaming and the HPLMN has enabled Autonomous CSG Roaming in the VPLMN (via Service Level Agreement) and the VLR needs to retrieve the CSG subscription information of the MS from the CSS, the VLR initiates the Update CSG Location Procedure with CSS as described in clause 6.16.\n16)\tThe new VLR allocates a new TMSI and responds with Location Update Accept (VLR TMSI) to the SGSN. VLR TMSI is optional if the VLR has not changed.\n17)\tThe new SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions (e.g. CSG restrictions) the MS is not allowed to be attached in the RA, or if subscription checking fails, the SGSN rejects the routeing area update with an appropriate cause. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the routeing area update. If all checks are successful, the new SGSN establishes MM and PDP contexts/EPS Bearer Contexts for the MS. The new SGSN responds to the MS with Routeing Area Update Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature, IMS voice over PS Session Supported Indication, Emergency Service Support, SMS-Supported, Cause). The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nIf the SGSN did not receive the Voice Support Match Indicator in the MM Context, then the SGSN sends a UE Radio Capability Match Request to the RAN as described in clause 6.9.5. If the SGSN has not received Voice Support Match Indicator from the RAN then, based on implementation, SGSN may set IMS Voice over PS session supported Indication and update it at a later stage.\nISR Activated is never indicated in case of inter SGSN RAU as described in TS 23.401 [89]. The E‑UTRAN capable UE sets its TIN to \"P‑TMSI\" or \"RAT‑related TMSI\" as described for Routing Area Update procedures in TS 23.401 [89].\nIf ISR is activated for the MS when the S4-SGSN receives the Routeing Area Update Request in the intra SGSN scenario, the S4-SGSN should maintain ISR by indicating ISR Activated in the Routeing Area Update Accept message.\nIf RAU procedure is initiated by manual CSG selection and occurs via a CSG cell, the MS upon receiving the RAU Accept message shall add the CSG ID and associated PLMN to its Allowed CSG list if it is not already present. Manual CSG selection is not supported if the MS has emergency bearers established.\nIf the user plane setup is performed in conjunction with the RAU Accept message and the RAU is performed via a hybrid cell, then the SGSN shall send an indication whether the UE is a CSG member to the RAN along with the RANAP message. Based on this information the RAN may perform differentiated treatment for CSG and non-CSG members.\nNOTE 6:\tIf the UE receives a RAU Accept message via a hybrid cell, the UE does not add the corresponding CSG ID and associated PLMN to its Allowed CSG list. Adding a CSG ID and associated PLMN to the UE's local Allowed CSG list for a hybrid cell is performed only by OTA or OMA DM procedures.\nThe Emergency Service Support indicator informs the MS that Emergency PDP contexts are supported, i.e. the MS is allowed to request activation of emergency PDP context when needed.\nIf due to regional subscription restrictions, or not allowed CSG, an MS with ongoing emergency bearer service is not allowed to access the RA or CSG cell the SGSN shall accept the Routing Area Update Request and deactivate the non-emergency PDP context as specified in clause 9.2.4.2. If the Routing Area Update procedure is initiated in PMM-IDLE/STANDBY state, all non-emergency PDP Contexts are deactivated by the Routing Area Update procedure without PDP Context deactivation signalling between the SGSN and the MS. The MS shall be prevented from accessing GERAN in case of emergency bearer services.\n\"SMS-Supported\" is indicated to the MS when the HSS has indicated \"SMS in SGSN Support\". It indicates to the MS that it can obtain SMS services via PS domain NAS from the SGSN. An MS that needs only PS and SMS services via NAS should not perform any procedures via CS domain when it can obtain SMS services via PS domain NAS from SGSN. If step 14 was not performed, e.g. due to Subscription Data indicate by the Network Access Mode information that the subscription has no CS subscriber data, then SGSN indicates that the Attach was successful for GPRS only and a Cause indicates why the IMSI attach was not performed.\nIn Iu mode, if after step 9 the new SGSN receives a Downlink Data Notification message or any other downlink signalling message while the MS is still connected, the new SGSN may prolong the PS signalling connection with the MS.\nIf the SGSN decides to enable extended idle mode DRX for an MS that had included the extended idle mode DRX paremeters information element, it includes the extended idle mode DRX parameters information element.\n18)\tThe MS confirms the reallocation of the TMSIs by returning a Routeing Area Update Complete message to the SGSN.\n19)\tThe new SGSN sends a TMSI Reallocation Complete message to the new VLR if the MS confirms the VLR TMSI.\n20)\tAfter step 10, and in parallel to any of the preceding steps, the SGSN shall send either a GPRS Update Location (Homogeneous Support of IMS Voice over PS Sessions) to the HLR or, when the S6d interface is used, a Notify Request (Homogeneous Support of IMS Voice over PS Sessions) message to the HSS:\n-\tif the SGSN has evaluated the support of IMS Voice over PS Sessions, see clause 5.3.8, and\n-\tif the SGSN determines that it needs to update the Homogeneous Support of IMS Voice over PS Sessions, see clause 5.3.8A.\nNOTE 7:\tSteps 15, 16, and 19 are performed only if step 14 is performed.\nNOTE 8:\tThe new SGSN may initiate RAB establishment after execution of the security functions (step 4), or wait until completion of the RA update procedure. For the MS, RAB establishment may occur anytime after the RA update request is sent (step 1).\nFor of a rejected routeing area update operation, due to regional subscription, roaming restrictions, or access restrictions (see clause 5.3.19) the new SGSN should not construct an MM context. In the case of receiving the subscriber data from HLR, the new SGSN may construct an MM context and store the subscriber data for the MS to optimize signalling between the SGSN and the HLR. A reject shall be returned to the MS with an appropriate cause and the PS signalling connection shall be released. Upon return to idle, the MS shall act according to TS 23.122 [7b]. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the routeing area update.\nIf the new SGSN is unable to update the PDP context/EPS Bearer Context in one or more GGSNs/P‑GWs, the new SGSN shall deactivate the corresponding PDP contexts/EPS Bearer Contexts as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe PDP Contexts/EPS Bearer Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important PDP Context/EPS Bearer Context first in the SGSN Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer Context for using S4 from the GGSN/P‑GW or old S4-SGSN and then store the new Maximum APN restriction value.\nIf the new SGSN is unable to support the same number of active PDP contexts/EPS Bearer Contexts as received from old SGSN, the new SGSN should use the prioritisation sent by old SGSN as input when deciding which PDP contexts/EPS Bearer Contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in one or more GGSNs/P‑GWs and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nNOTE 9:\tIf the MS was in PMM-CONNECTED state the PDP Contexts are sent already in the Forward Relocation Request message as described in clause \"Serving RNS relocation procedures\".\nIf the routeing area update procedure fails a maximum allowable number of times, or if the SGSN returns a Routeing Area Update Reject (Cause) message, the MS shall enter PMM‑DETACHED state.\nIf the Location Update Accept message indicates a reject, this should be indicated to the MS, and the MS shall not access non-PS services until a successful location update is performed. If SMS-Supported is indicated to the MS the MS should not initiate Location Update or IMSI attach with the MSC for only obtaining SMS services as SMS services via NAS are provided by the SGSN.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context. It returns as result \"Continue\".\n6.9.2.1a\tRouteing Area Update Procedure using S4\nThe procedures described in figures 36a and 36b show only the steps 2, 3, 5 and 9, due to use of S4, which are different from the Gn/Gp variant of the procedure given by clause 6.9.2.1. The ISR function is deactivated in Inter-SGSN Routeing Area Update Procedures as defined in TS 23.401 [89].\nNOTE 1:\tIf the RA update is an Inter-SGSN routeing area update initiated by an MS in PMM CONNECTED state in the new 3G-SGSN, step 9 is described as the step 13 in clause 6.9.2.2.1a.\nFigure 36a: Step 2, 3 and 5 for Iu Mode Routeing Area Update Procedure between S4-SGSNs\n2)\tIf the RA update is an Inter‑SGSN Routeing area update and if the MS was in PMM IDLE state, the new SGSN sends a Context Request message (old P TMSI, old RAI, old P TMSI Signature) to the old SGSN to get the MM and EPS Bearer contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P‑TMSI and send the Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P‑TMSI and relay the message to that actual old SGSN. The old SGSN validates the old P TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send a Context Request (IMSI, old RAI, MS Validated) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN starts a timer. If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause.\nIf the UE with emergency bearers is not authenticated in the old MME (in a network supporting unauthenticated UEs) the old MME continues the procedure with sending a Context Response and starting the timer also when it cannot validate the Context Request.\n3)\tThe old 3G SGSN responds with a Context Response (MM Context, EPS Bearer Contexts) message. MM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2. The new 3G‑SGSN shall ignore the MS Network Capability contained in MM Context of Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\nIf the UE receives only emergency services from the old S4-SGSN and the UE is UICCless, IMSI can not be included in the MM and PDP contexts in SGSN Context Response message. For emergency attached UEs if the IMSI cannot be authenticated then the IMSI shall be marked as unauthenticated.\nFor RAU between two S4-SGSNs, the old SGSN shall include the Change Reporting Action and CGI/SAI/RAI change support indication in the Context Response message.\nIf SIPTO at the Local Network is active for a PDN connection in the architecture with stand-alone GW, the old S4 SGSN shall include the Local Home Network ID of the old cell in the EPS Bearer context corresponding to the SIPTO at the Local Network PDN connection.\n5)\tIf the RA update is an Inter‑SGSN Routeing area update, the new SGSN sends a Context Acknowledge message to the old SGSN. The old SGSN marks in its context that the MSC/VLR association and the information in the S‑GW and the HLR are invalid. This triggers the MSC/VLR, the S‑GWs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure.\nFigure 36b: Step 9 for Iu Mode Routeing Area Update Procedure using S4\nNOTE 2:\tSteps 9A) and 9D) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (B1) is defined in TS 23.402 [90]. Steps 9B) and 9C) concern GTP based S5/S8.\n9A)\tIf the S‑GW does not change, the new SGSN update these EPS Bearer contexts by sending Modify Bearer Request (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, SGSN Address(es) and TEID(s), PDN GW addresses and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication). The SGSN puts the according NSAPI in the field of EPS Bearer ID. If ISR is activated on the S‑GW that is updated by a new SGSN then this S‑GW deletes the bearer resources on the other old CN node by sending Delete Session Request message(s) to that CN node.\nIf ISR Activated is indicated or SGSN and SGW are configured to release S4 U-Plane when EPS Bearer Contexts associated with the released RABs are to be preserved, the SGSN does not send SGSN address and TEID for U-Plane in Modify Bearer Request. If the S‑GW changes or if an S‑GW needs to be allocated (Gn/Gp to S4-SGSN RAU) the SGSN selects an S‑GW and sends a Create Session Request message (APN-AMBR) with the content as described for the Modify Bearer Request message to the S‑GW.\nFor Gn/Gp to S4-SGSN RAU, the new S4-SGSN provides APN-AMBR to the Serving GW. Details on mapping MBR to APN-AMBR are specified in Annex E of TS 23.401 [89].\n9B)\tIf the S‑GW has changed, or if an S‑GW needs to be allocated (Gn/Gp to S4-SGSN RAU), or the RAT type has changed, or the S‑GW received CGI/SAI from the S4-SGSN, the S‑GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, APN-AMBR) messages to the P‑GWs involved.\n9C)\tThe P‑GWs acknowledge with sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, Default Bearer id, APN-AMBR) messages to S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The default bearer id is included if the UE moves from a Gn/Gp SGSN to an S4-SGSN.\n9D)\tThe S‑GW acknowledges the connection establishment to the new SGSN via the message Modify Bearer Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, PDN GW addresses and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, Default Bearer id, APN-AMBR). If the SGSN sent a Create Session Request message the S‑GW sends a Create Session Response message with the content as described for the Modify Bearer Response message to the SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.3.8",
        "clause_6.9.2.1",
        "clause_6.1.2.4.1",
        "clause_9.2.4.2",
        "clause_5.3.15",
        "clause_6.16",
        "clause_6.9.5",
        "clause_5.3.19",
        "clause_6.9.2.2.1",
        "clause_13.2.2",
        "figure_36",
        "ts_24.008",
        "ts_23.401",
        "ts_23.251",
        "ts_23.122",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2",
      "section_id": "6.9.2.2",
      "section_title": "Serving RNS Relocation Procedures",
      "content": "In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nServing RNS relocation procedures move the RAN to CN connection point at the RAN side of the source RNC to the target RNC. The Serving RNS Relocation Procedures, described in the following clauses, may be performed as \"Lossless SRNS Relocation\", which means packet loss during the SRNS change is eliminated. For this purpose, the RNS and the MS have to provide PDCP layer functionality, which in the subsequent description is referred as the lossless PDCP. The source RNC decides to perform the Serving RNS Relocation Procedure as \"Lossless SRNS Relocation\" based on capabilities of the UE and the RNS and based on QoS parameters (e.g. SDU error ratio).\nFor \"Lossless SRNS Relocation\", both the MS and the source RNS have to support and to use the lossless PDCP. When the SRNS changes, the old RNS forwards all received and not yet transferred downlink GTP-PDUs to the target RNS. GTP-PDUs forwarded to the target RNS indicate a PDCP sequence number if the contained N-PDUs were sent to the MS as a PDCP-SDUs, but are not yet acknowledged by lossless PDCP. The target RNS and the MS exchange respective sequence numbers of next expected PDCP-PDUs. This process indicates PDCP-PDUs that were already successfully transferred between the MS and the source RNS for downlink and uplink directions, respectively. This also confirms all N-PDUs (PDCP-SDUs) successfully transferred before the change of the SRNS. These N-PDUs are discarded by the MS and the target RNS, respectively. The target RNS identifies the forwarded GTP-PDUs containing confirmed N-PDUs by the PDCP sequence number in the GTP-PDU. All other N-PDUs have to be transmitted via the new MS – RNS link.\nFor inter-PLMN handover to a CSG cell, if the source SGSN has the CSG-ID list of the target PLMN, the source SGSN shall use it to validate the CSG membership of the MS in the target CSG cell. Otherwise, based on configuration the source SGSN may allow the handover by validating the CSG membership of the MS in the target CSG cell using the CSG-ID list of the registered PLMN-ID.If neither the CSG-ID lists of the target PLMN nor the operator's configuration permission, the source SGSN shall reject the handover due to no CSG membership information of the target PLMN-ID.\nNOTE 1:\tInter-PLMN handover to a CSG cell in a PLMN which is not an equivalent PLMN for the UE is not supported.\nNOTE 2:\tInter-PLMN handover to a CSG cell of an equivalent PLMN is only supported if the CSG-ID of the cell is in the CSG-ID list of both equivalent PLMNs.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2.1",
      "section_id": "6.9.2.2.1",
      "section_title": "Serving RNS Relocation Procedure",
      "content": "This procedure is only performed for an MS in PMM‑CONNECTED state where the Iur interface carries both the control signalling and the user data. This procedure is not applicable for GERAN.\nThe Serving SRNS Relocation procedure is used to move the RAN to CN connection point at the RAN side from the source SRNC to the target RNC, from a \"standing still position\". In the procedure, the Iu links are relocated. If the target RNC is connected to the same SGSN as the source SRNC, an Intra-SGSN SRNS Relocation procedure is performed. If the routeing area is changed, this procedure is followed by an Intra-SGSN Routeing Area Update procedure. The SGSN detects an Intra-SGSN routeing area update by noticing that it also handles the old RA. In this case, the SGSN has the necessary information about the MS and there is no need to inform the HLR about new location of the MS.\nFigure 37 shows user data routing before SRNS relocation when source SRNC and target RNC are connected to different SGSNs. Figure 38 shows the user data routing after SRNS Relocation procedure and Routeing Area Update procedure is completed. In case depicted in Figure 37 and Figure 38, the MS is in state PMM-CONNECTED.\nNOTE 1:\tThe figures showing S‑GW/P‑GW instead of GGSN are omitted since they are similar to figures 37 and 38.\nFigure 37: Before SRNS Relocation and Routeing Area Update\nBefore the SRNS Relocation procedure and RA update, the MS is registered in the old SGSN. The source RNC is acting as a serving RNC (SRNC).\nFigure 38: After SRNS Relocation and Routeing Area Update\nAfter the SRNS Relocation procedure and RA update, the MS is registered in the new SGSN. The MS is in the state PMM‑CONNECTED towards the new SGSN, and the target RNC is acting as the serving RNC.\nThe Serving SRNS Relocation procedure is illustrated in Figure 39. The sequence is valid for both intra-SGSN SRNS relocation and inter-SGSN SRNS relocation.\nFigure 39: SRNS Relocation Procedure\nNOTE 2:\tAll steps in figure 39, except steps (A) and 13, are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) and (B) are defined in the clause 6.9. 2.2.1a.\n1)\tThe source SRNC decides to perform/initiate SRNS relocation. At this point both uplink and downlink user data flows via the following tunnel(s): Radio Bearer between MS and source SRNC (data flows via the target RNC, which acts as a drift RNC); GTP-U tunnel(s) between source SRNC and old-SGSN; GTP-U tunnel(s) between old-SGSN and GGSN. (for using S4: GTP‑U tunnel(s) between old‑SGSN and S‑GW; GTP‑U tunnel(s) between S‑GW and P‑GW)\n2)\tThe source SRNC sends a Relocation Required message (Relocation Type, Cause, Source ID, Target ID, Source RNC to target RNC transparent container) to the old SGSN. The source SRNC shall set the Relocation Type to \"UE not involved\". The Source SRNC to Target RNC Transparent Container includes the necessary information for Relocation co-ordination, security functionality and RRC protocol context information (including MS Capabilities).\n3)\tThe old SGSN determines from the Target ID if the SRNS Relocation is intra-SGSN SRNS relocation or inter-SGSN SRNS relocation. The old SGSN selects the target SGSN as described in clause 5.3.7.3 on \"SGSN selection function\". In case of inter-SGSN SRNS relocation, the old SGSN initiates the relocation resource allocation procedure by sending a Forward Relocation Request message (IMSI, Tunnel Endpoint Identifier Signalling, MM Context, PDP Context/EPS Bearer Context, Negotiated Evolved ARP, Target Identification, RAN transparent container, RANAP Cause, GCSI) to the new SGSN. If this message is sent between two S4-SGSNs, the old SGSN shall include APN Restriction and Change Reporting Action in this message. MM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2. For relocation to an area where Intra Domain Connection of RAN Nodes to Multiple CN Nodes is used, the old SGSN may – if it provides Intra Domain Connection of RAN Nodes to Multiple CN Nodes have multiple target SGSNs for each relocation target in a pool area, in which case the old SGSN will select one of them to become the new SGSN, as specified in TS 23.236 [73].\nIf at least one of the two SGSNs is a Gn/Gp SGSN then PDP context is indicated. An S4-SGSN derives from GTPv1 Forward Relocation signalling that the other SGSN is a Gn/Gp SGSN, which also does not signal any S‑GW change. The PDP context contains GGSN Address for User Plane and Uplink TEID for Data (to this GGSN Address and Uplink TEID for Data the old SGSN and the new SGSN send uplink packets).\nAt the same time a timer is started on the MM and PDP contexts/EPS Bearer Contexts in the old SGSN (see the Routeing Area Update procedure in clause \"Location Management Procedures (Iu mode)\"). The Forward Relocation Request message is applicable only in the case of inter-SGSN SRNS relocation. The old SGSN 'sets' the GCSI flag if the MM context contains GPRS CAMEL Subscription Information.\nIf the UE receives only emergency services from the old SGSN and the UE is UICCless, IMSI can not be included in Forward Relocation Request message. For emergency attached UEs if the IMSI cannot be authenticated then the IMSI shall be marked as unauthenticated.\nIf SIPTO at the Local Network is active for a PDN connection in the architecture with stand-alone GW the old SGSN shall include the Local Home Network ID of the source cell in the EPS Bearer context corresponding to the SIPTO at the Local Network PDN connection.\n4)\tThe new SGSN sends a Relocation Request message (Permanent NAS UE Identity (if available), MSISDN, Cause, CN Domain Indicator, Source-RNC to target RNC transparent container, RABs to be setup (APN, Charging characteristics), UE-AMBR, Service Handover related info) to the target RNC. Only the Iu Bearers of the RABs are setup between the target RNC and the new-SGSN as the existing Radio Bearers will be reallocated between the MS and the target RNC when the target RNC takes the role of the serving RNC. For each requested RAB, the RABs to be setup information elements shall contain information such as RAB ID, RAB parameters, Transport Layer Address, and Iu Transport Association. SGSN shall not establish RABs for PDP contexts/EPS Bearer Contexts for using S4 with maximum bit rate for uplink and downlink of 0 kbit/s. . The list of RABs requested by the new SGSN may differ from list of RABs established in the Source RNC contained in the Source-RNC to target RNC transparent container. The target RNC shall not establish the RABs (as identified from the Source-RNC to target RNC transparent container) that did not exist in the source RNC prior to the relocation. The RAB ID information element contains the NSAPI value, and the RAB parameters information element gives the QoS profile. The Transport Layer Address is the SGSN Address for user data, and the Iu Transport Association corresponds to the uplink Tunnel Endpoint Identifier Data. The new SGSN may decide to establish Direct Tunnel unless it has received a 'set' GCSI flag from the old SGSN. If the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the GGSN's Address for User Plane and TEID for Uplink data. For using S4, if the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the S‑GW's Address for User Plane and TEID for Uplink data. If the Access Restriction is present in the MM context, the Service Handover related information shall be included by new S4-SGSN for the Relocation Request message in order for RNC to restrict the UE in connected mode to handover to the RAT prohibited by the Access Restriction. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\nAfter all necessary resources for accepted RABs including the Iu user plane are successfully allocated; the target RNC shall send the Relocation Request Acknowledge message (RABs setup, RABs failed to setup) to the new SGSN. Each RAB to be setup is defined by a Transport Layer Address, which is the target RNC Address for user data, and an Iu Transport Association, which corresponds to the downlink Tunnel Endpoint Identifier for user data. For each RAB to be set up, the target RNC may receive simultaneously downlink user packets both from the source SRNC and from the new SGSN.\n5)\tWhen resources for the transmission of user data between the target RNC and the new SGSN have been allocated and the new SGSN is ready for relocation of SRNS, the Forward Relocation Response message (Cause, RANAP Cause, and RAB Setup Information) is sent from the new SGSN to old SGSN. This message indicates that the target RNC is ready to receive from source SRNC the forwarded downlink PDUs, i.e. the relocation resource allocation procedure is terminated successfully. RANAP Cause is information from the target RNC to be forwarded to the source SRNC. The RAB Setup Information, one information element for each RAB, contains the RNC Tunnel Endpoint Identifier and the RNC IP address for data forwarding from the source SRNC to the target RNC. If the target RNC or the new SGSN failed to allocate resources, the RAB Setup Information element contains only NSAPI indicating that the source SRNC shall release the resources associated with the NSAPI. The Forward Relocation Response message is applicable only in case of inter-SGSN SRNS relocation.\n6)\tThe old SGSN continues the relocation of SRNS by sending a Relocation Command message (RABs to be released, and RABs subject to data forwarding) to the source SRNC. The old SGSN decides the RABs to be subject for data forwarding based on QoS, and those RABs shall be contained in RABs subject to data forwarding. For each RAB subject to data forwarding, the information element shall contain RAB ID, Transport Layer Address, and Iu Transport Association. These are the same Transport Layer Address and Iu Transport Association that the target RNC had sent to new SGSN in Relocation Request Acknowledge message, and these are used for forwarding of downlink N‑PDU from source SRNC to target RNC. The source SRNC is now ready to forward downlink user data directly to the target RNC over the Iu interface. This forwarding is performed for downlink user data only.\n7)\tThe source SRNC may, according to the QoS profile, begin the forwarding of data for the RABs to be subject for data forwarding. The data forwarding at SRNS relocation shall be carried out through the Iu interface, meaning that the data exchanged between the source SRNC and the target RNC are duplicated in the source SRNC and routed at IP layer towards the target RNC. For each radio bearer which uses lossless PDCP the GTP-PDUs related to transmitted but not yet acknowledged PDCP-PDUs are duplicated and routed at IP layer towards the target RNC together with their related downlink PDCP sequence numbers. The source RNC continues transmitting duplicates of downlink data and receiving uplink data. Before the serving RNC role is not yet taken over by target RNC and when downlink user plane data starts to arrive to target RNC, the target RNC may buffer or discard arriving downlink GTP-PDUs according to the related QoS profile.\nNOTE 3:\tThe order of steps, starting from step 7 onwards, does not necessarily reflect the order of events. For instance, source RNC may start data forwarding (step 7) and send Relocation Commit message (step 8) almost simultaneously except in the delivery order required case where step 7 triggers step 8. Target RNC may send Relocation Detect message (step 9) and RAN Mobility Information message (step 10) at the same time. Hence, target RNC may receive RAN Mobility Information Confirm message (step 10) while data forwarding (step 7) is still underway, and before the new SGSN receives Update PDP Context Response message (step 11).\n8)\tBefore sending the Relocation Commit the uplink and downlink data transfer in the source, SRNC shall be suspended for RABs, which require delivery order. The source RNC shall start the data-forwarding timer. When the source SRNC is ready, the source SRNC shall trigger the execution of relocation of SRNS by sending a Relocation Commit message (SRNS Contexts) to the target RNC over the Iur interface. The purpose of this procedure is to transfer SRNS contexts from the source RNC to the target RNC, and to move the SRNS role from the source RNC to the target RNC. SRNS contexts are sent for each concerned RAB and contain the sequence numbers of the GTP-PDUs next to be transmitted in the uplink and downlink directions and the next PDCP sequence numbers that would have been used to send and receive data from the MS. For PDP context(s) using delivery order not required (QoS profile), the sequence numbers of the GTP-PDUs next to be transmitted are not used by the target RNC. PDCP sequence numbers are only sent by the source RNC for radio bearers, which used lossless PDCP (see TS 25.323 [57]). The use of lossless PDCP is selected by the RNC when the radio bearer is set up or reconfigured.\nIf delivery order is required (QoS profile), consecutive GTP-PDU sequence numbering shall be maintained throughout the lifetime of the PDP context(s). Therefore, during the entire SRNS relocation procedure for the PDP context(s) using delivery order required (QoS profile), the responsible GTP-U entities (RNCs and GGSN) shall assign consecutive GTP-PDU sequence numbers to user packets belonging to the same PDP context for uplink and downlink, respectively.\n9)\tThe target RNC shall send a Relocation Detect message to the new SGSN when the relocation execution trigger is received. For SRNS relocation type \"UE not involved\", the relocation execution trigger is the reception of the Relocation Commit message from the Iur interface. When the Relocation Detect message is sent, the target RNC shall start SRNC operation.\n10)\tThe target SRNC sends a RAN Mobility Information message. This message contains UE information elements and CN information elements. The UE information elements include among others new SRNC identity and S‑RNTI. The CN information elements contain among others Location Area Identification and Routeing Area Identification. The procedure shall be co-ordinated in all Iu signalling connections existing for the MS.\nThe target SRNC establishes and/or restarts the RLC, and exchanges the PDCP sequence numbers (PDCP‑SNU, PDCP‑SND) between the target SRNC and the MS. PDCP‑SND is the PDCP sequence number for the next expected in-sequence downlink packet to be received in the MS per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SND confirms all mobile-terminated packets successfully transferred before the SRNC relocation. If PDCP‑SND confirms reception of packets that were forwarded from the source SRNC, the target SRNC shall discard these packets. PDCP‑SNU is the PDCP sequence number for the next expected in-sequence uplink packet to be received in the RNC per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SNU confirms all mobile originated packets successfully transferred before the SRNC relocation. If PDCP‑SNU confirms reception of packets that were received in the source SRNC, the MS shall discard these packets.\nUpon reception of the RAN Mobility Information message the MS may start sending uplink user data to the target SRNC. When the MS has reconfigured itself, it sends the RAN Mobility Information Confirm message to the target SRNC. This indicates that the MS is also ready to receive downlink data from the target SRNC.\nIf new the SGSN has already received the Update PDP Context Response message from the GGSN, it shall forward the uplink user data to GGSN over this new GTP-U tunnel. Otherwise, the new SGSN shall forward the uplink user data to that GGSN IP address and TEID(s), which the new SGSN had received earlier by the Forward Relocation Request message.\nFor using S4, if new the SGSN has already received the Modify Bearer Response message from the S‑GW, it shall forward the uplink user data to S‑GW over this new GTP‑U tunnel. Otherwise, the new SGSN shall forward the uplink user data to that S‑GW IP address and TEID(s), which the new SGSN had received earlier by the Forward Relocation Request message.\nFor all RABs, the target RNC should:\n-\tstart uplink reception of data and start transmission of uplink GTP-PDUs towards the new SGSN;\n-\tstart processing the already buffered and the arriving downlink GTP-PDUs and start downlink transmission towards the MS.\n11)\tWhen the target SRNC receives the RAN Mobility Information Confirm message, i.e. the new SRNC—ID + S‑RNTI are successfully exchanged with the MS by the radio protocols, the target SRNC shall initiate the Relocation Complete procedure by sending the Relocation Complete message to the new SGSN. The purpose of the Relocation Complete procedure is to indicate by the target SRNC the completion of the relocation of the SRNS to the CN.\nFor SIPTO at the Local Network with stand-alone GW architecture, the target RNC shall include the Local Home Network ID of the target cell in the Relocation Complete message.\n12)\tUpon receipt of Relocation Complete message, if the SRNS Relocation is an inter SGSN SRNS relocation, the new SGSN signals to the old SGSN the completion of the SRNS relocation procedure by sending a Forward Relocation Complete message.\n13)\tUpon receipt of the Relocation Complete message, the CN shall switch the user plane from the source RNC to the target SRNC. If the SRNS Relocation is an inter-SGSN SRNS relocation and the new SGSN has received Forward Relocation Complete Acknowledge message from the old SGSN or if Direct Tunnel was established in intra-SGSN SRNS relocation, the new SGSN sends Update PDP Context Request messages (new SGSN Address, SGSN Tunnel Endpoint Identifier, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, NRSN, DTI) to the GGSNs concerned. The SGSN shall send the serving network identity to the GGSN. If Direct Tunnel is established the SGSN provides to GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Forward Relocation Request message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return an Update PDP Context Response (GGSN Tunnel Endpoint Identifier, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, and Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\n14)\tUpon receiving the Relocation Complete message or if it is an inter-SGSN SRNS relocation; the Forward Relocation Complete message, the old SGSN sends an Iu Release Command message to the source RNC. When the RNC data-forwarding timer has expired the source RNC responds with an Iu Release Complete.\nAn old S4-SGSN starts a timer to supervise when resources in old Serving GW (in case of Serving GW change or in case of S4 to Gn/Gp SGSN change) shall be released. When this timer expires the old S4-SGSN releases the S‑GW resources. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\n15)\tAfter the MS has finished the RNTI reallocation procedure and if the new Routeing Area Identification is different from the old one, the MS initiates the Routeing Area Update procedure. See clause \"Location Management Procedures (Iu mode)\". Note that it is only a subset of the RA update procedure that is performed, since the MS is in PMM‑CONNECTED mode.\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer context for using S4 from the GGSN/P‑GW or old S4-SGSN for using S4 and then store the new Maximum APN restriction value.\nIf the SRNS Relocation is inter-SGSN, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b]):\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nIf the SRNS Relocation is intra-SGSN, then the above mentioned CAMEL procedures calls shall not be performed.\nIf Routeing Area Update occurs, the SGSN shall determine whether Direct Tunnel can be used based on the received GPRS CAMEL Subscription Information. If Direct Tunnel can not be maintained the SGSN shall re-establish RABs and initiate the Update PDP Context procedure to update the IP Address and TEID for Uplink and Downlink data.\nIf Routeing Area Update occurs, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b]):\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen, the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context. It returns as result \"\"Continue\"\".\nFor C2 and C3: refer to Routing Area Update procedure description for detailed message flow.\n6.9.2.2.1a\tServing RNS Relocation Procedure, Combined Hard Handover and SRNS Relocation Procedure, and Combined Cell / URA Update and SRNS Relocation Procedure Using S4\nThe procedures described in figures 39a and 39b shows only the steps (A) and 13, due to use of S4, which are different from the Gn/Gp variant of the procedure given by clauses 6.9.2.2.1, 6.9.2.2.2 and 6.9.2.2.3.\nFigure 39a: Steps 9A) for Serving RNS Relocation Procedure, Combined Hard Handover and SRNS Relocation Procedure, and Combined Cell / URA Update and SRNS Relocation Procedure Using S4\nA1.\tThe new S4-SGSN determines if the Serving GW is to be allocated or relocated, e.g., due to PLMN change or due to change from Gn/Gp to S4-SGSN. If a new Serving GW is needed or if the Serving GW changes, the new SGSN selects the new Serving GW as described in TS 23.401 [89] under clause 4.3.8.2 on \"Serving GW selection function\", and sends a Create Session Request message (IMSI, SGSN Tunnel Endpoint Identifier for Control Plane, SGSN Address for Control plane, PDN GW address(es) for user plane, PDN GW UL TEID(s) for user plane, PDN GW address(es) for control plane, and PDN GW TEID(s) for control plane, the Protocol Type over S5/S8, APN-AMBR, DTI) to the new Serving GW. The Protocol Type over S5/S8 is provided to Serving GW which protocol should be used over S5/S8 interface. SGSN User Plane TEID shall not be sent if the SGSN decides to establish the Direct Tunnel between RNC and Serving GW. DTI is used to instruct the Serving GW that the Direct Tunnel shall be established between RNC and Serving GW.\nThe new S4-SGSN establishes the EPS Bearer Context(s) in the indicated order. The new S4-SGSN deactivates the PDP Contexts/EPS Bearer Contexts which cannot be established.\nFor relocation from an old Gn/Gp SGSN, the new S4-SGSN provides APN-AMBR to the Serving GW. Details on mapping of MBR to APN-AMBR are specified in Annex E of TS 23.401 [89].\nA2.\tThe new Serving GW allocates its local resources and returns a Create Session Response (Serving GW address(es) for user plane, Serving GW UL TEID(s) for user plane, Serving GW Address for control plane, Serving GW TEID for control plane) message to the new SGSN.\n13.\tBox (B):\nFigure 39b: Step 13 for Serving RNS Relocation Procedure, Combined Hard Handover and SRNS Relocation Procedure, and Combined Cell / URA Update and SRNS Relocation Procedure Using S4\nNOTE:\tSteps A) and D) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (B1) are defined in TS 23.402 [90]. Steps B) and C) concern GTP based S5/S8.\nA)\tIf the SRNS Relocation is an inter‑SGSN SRNS relocation and the new SGSN received Forward Relocation Complete Acknowledge message from the old SGSN or if Direct Tunnel was established in intra‑SGSN SRNS relocation or the Serving GW is changed, the new SGSN update these EPS Bearer contexts by sending Modify Bearer Request (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, SGSN Address(es) and TEID(s) (if Direct Tunnel is not used) or RNC Address(es) and TEID(s) for User Traffic (if Direct Tunnel is used), PDN GW addresses and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, DTI, APN-AMBR). If Direct Tunnel is established the SGSN shall include the DTI to instruct the S‑GW to apply Direct Tunnel specific error handling procedure as described in clause 13.8. The SGSN puts the according NSAPI in the field of EPS Bearer ID.\nFor relocation from an old Gn/Gp SGSN, the new S4-SGSN provides APN-AMBR to the Serving GW. Details on mapping of MBR to APN-AMBR are specified in Annex E of TS 23.401 [89].\nB)\tIf the S‑GW changes, or if an S‑GW needs to be allocated (Gn/Gp to S4-SGSN RAU), or the RAT type has changed, or the S‑GW received CGI/SAI from the S4-SGSN, the S‑GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, APN-AMBR) messages to the P‑GWs involved.\nC)\tThe P‑GWs acknowledge with sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, Default bearer id) messages to S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context. The default bearer id is included if the UE moves from a Gn/Gp SGSN to an S4-SGSN.\nD)\tThe Serving GW acknowledges the user plane switch to the new SGSN via the message Modify Bearer Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, Protocol Configuration Options, PDN GW addresses and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, Default bearer id, APN-AMBR). At this stage the user plane path is established for all EPS Bearer contexts between the UE, target RNC, new SGSN in case Direct Tunnel is not used, Serving GW (for Serving GW relocation this will be the Target Serving GW) and PDN GW.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.9",
        "clause_5.3.7.3",
        "clause_13.2.2",
        "clause_13.8",
        "ts_23.401_clause_4.3.8.2",
        "figure_37",
        "figure_38",
        "figure_39",
        "ts_23.236",
        "ts_25.323",
        "ts_23.401",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2.2",
      "section_id": "6.9.2.2.2",
      "section_title": "Combined Hard Handover and SRNS Relocation Procedure",
      "content": "This procedure is only performed for an MS in PMM‑CONNECTED state in case the Iur interface is not available. In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving a mobile in Iu mode.\nThe Combined Hard Handover and SRNS Relocation procedure is used to move the RAN to CN connection point at the RAN side from the source SRNC to the target RNC, while performing a hard handover decided by the RAN. In the procedure, the Iu links are relocated. If the target RNC is connected to the same SGSN as the source SRNC, an Intra-SGSN SRNS Relocation procedure is performed. If the routeing area is changed, this procedure is followed by an Intra-SGSN Routeing Area Update procedure. The SGSN detects that it is an intra-SGSN routeing area update by noticing that it also handles the old RA. In this case, the SGSN has the necessary information about the MS and there is no need to inform the HLR about the new MS location.\nIf the target RNC is connected to a different SGSN than the source SRNC, an Inter-SGSN SRNS Relocation procedure is performed. This procedure is followed by an Inter-SGSN Routeing Area Update procedure.\nFigure 40 shows the situation before a Combined Hard Handover and SRNS Relocation procedure when source and target RNC are connected to different SGSNs. Figure 41 shows the situation after the Combined Hard Handover and SRNS Relocation procedure and RA update procedure have been completed. In the case described in Figure 40 and Figure 41 the MS is in PMM-CONNECTED state. Both figures are also applicable to BSS to RNS relocation and vice-versa, as well as for BSS to BSS relocation.\nNOTE 1:\tThe figures showing S‑GW/P‑GW instead of GGSN are omitted since they are similar with Figures 40 and 41.\nFigure 40: Before Combined Hard Handover and SRNS Relocation and Routeing Area Update\nBefore the SRNS Relocation and Routeing Area Update the MS is registered in the old SGSN and in the old MSC/VLR. The source RNC is acting as serving RNC.\nFigure 41: After Combined Hard Handover and SRNS Relocation and Routeing Area Update\nAfter the SRNS relocation and RA update, the MS is registered in the new SGSN and in the new MSC/VLR. The MS is in state PMM‑CONNECTED towards the new SGSN and in MM IDLE state towards the new MSC/VLR. The target RNC is acting as serving RNC.\nThe Combined Hard Handover and SRNS Relocation procedure for the PS domain is illustrated in Figure 42. The sequence is valid for both intra-SGSN SRNS relocation and inter-SGSN SRNS relocation. Furthermore, this signalling flow is also applicable for BSS to RNS relocation and vice-versa, as well as BSS to BSS relocation.\nFigure 42: Combined Hard Handover and SRNS Relocation Procedure\nNOTE 2:\tAll steps in figure 42, except steps (A) and 13, are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) and (B) are defined in the clause 6.9. 2.2.1a.\n1)\tBased on measurement results and knowledge of the RAN topology, the source SRNC decides to initiate a combined hard handover and SRNS relocation. At this point both uplink and downlink user data flows via the following tunnel(s): Radio Bearer between the MS and the source SRNC (no drift RNC available); GTP-U tunnel(s) between the source SRNC and the old SGSN; GTP-U tunnel(s) between the old SGSN and the GGSN (for using S4: GTP‑U tunnel(s) between old-SGSN and S‑GW; GTP‑U tunnel(s) between S‑GW and P‑GW).\nIf the UE has an ongoing emergency bearer service the source SRNC shall not initiate relocation from UTRAN to GERAN.\n2)\tThe source SRNC sends a Relocation Required message (Relocation Type, Cause, Source ID, Target ID, CSG ID, CSG access mode, Source RNC To Target RNC Transparent Container) to the old SGSN. The source SRNC shall set Relocation Type to \"UE Involved\". Source RNC To Target RNC Transparent Container includes the necessary information for relocation co‑ordination, security functionality and RRC protocol context information (including MS Capabilities). The source SRNC shall include the CSG ID of the target cell when the target cell is a CSG cell or a hybrid cell. The source SRNC shall indicate the CSG access mode of the target cell when the target cell is a hybrid cell.\n3)\tThe old SGSN determines from the Target ID if the SRNS relocation is intra-SGSN SRNS relocation or inter-SGSN SRNS relocation. The old SGSN selects the target SGSN as described in clause 5.3.7.3 on \"SGSN selection function\". In case of inter-SGSN SRNS relocation the old SGSN initiates the relocation resource allocation procedure by sending a Forward Relocation Request message (IMSI, Tunnel Endpoint Identifier Signalling, MM Context, PDP Context/EPS Bearer Context, Negotiated Evolved ARP, Target Identification, CSG ID, CSG Membership Indication, RAN Transparent Container, RANAP Cause, GCSI) to the new SGSN. If this message is sent between two S4-SGSNs then the old SGSN shall include APN restriction and Change Reporting Action in this message. For relocation to an area where Intra Domain Connection of RAN Nodes to Multiple CN Nodes is used, the old SGSN may – if it provides Intra Domain Connection of RAN Nodes to Multiple CN Nodes have multiple target SGSNs for each relocation target in a pool area, in which case the old SGSN will select one of them to become the new SGSN, as specified in TS 23.236 [73].\nIf the CSG ID is provided by the source SRNC, the old SGSN shall check whether the CSG ID is contained in the CSG subscription and is not expired. If the CSG ID is not present or is expired and the target cell is a CSG cell, the old SGSN shall reject the handover with an appropriate cause unless the UE has emergency bearer services.\nIf the CSG ID was received in the Relocation Required message, the old SGSN includes the CSG ID in the Forward Relocation Request message. If the CSG access mode was received in the Relocation Required message indicating the target cell is a hybrid cell, or if there are one or several emergency bearers and the target cell is a CSG cell, the old SGSN shall include the CSG Membership Indication indicating whether the UE is a CSG member in the Forward Relocation Request message.\nIf at least one of the two SGSNs is a Gn/Gp SGSN then PDP context is indicated. An S4-SGSN derives from GTPv1 Forward Relocation signalling that the other SGSN is a Gn/Gp SGSN, which also does not signal any S‑GW change. PDP context contains GGSN Address for User Plane and Uplink TEID for Data (to this GGSN Address and Uplink TEID for Data, the old SGSN and the new SGSN send uplink packets).\nBetween two S4-SGSNs EPS Bearer Context is indicated. The Bearer context contains S‑GW Address for User Plane and Uplink TEID for Data (to this S‑GW Address and Uplink TEID for Data the old SGSN and the new SGSN send uplink packets) and P‑GW Address for User Plane and Uplink TEID for Data.\nAt the same time a timer is started on the MM and PDP contexts/EPS Bearer Contexts in the old SGSN (see Routeing Area Update procedure in clause \"Location Management Procedures (Iu mode)\"). The Forward Relocation Request message is applicable only in case of inter-SGSN SRNS relocation. The old SGSN 'sets' the GCSI flag if the MM context contains GPRS CAMEL Subscription Information.\nIf the UE receives only emergency services from the old SGSN and the UE is UICCless, IMSI can not be included in Forward Relocation Request message. For emergency attached UEs if the IMSI cannot be authenticated then the IMSI shall be marked as unauthenticated.\nIf SIPTO at the Local Network is active for a PDN connection in the architecture with stand-alone GW the old SGSN shall include the Local Home Network ID of the source cell in the EPS Bearer context corresponding to the SIPTO at the Local Network PDN connection.\n4)\tThe new SGSN sends a Relocation Request message (Permanent NAS UE Identity (if available), MSISDN, Cause, CN Domain Indicator, CSG ID, CSG Membership Indication, Source RNC To Target RNC Transparent Container, RAB To Be Setup (APN, Charging characteristics), UE-AMBR, Service Handover related information) to the target RNC. For each RAB requested to be established, RABs To Be Setup shall contain information such as RAB ID, RAB parameters, Transport Layer Address, and Iu Transport Association. SGSN shall not establish RABs for PDP contexts with maximum bit rate for uplink and downlink of 0 kbit/s. The list of RABs requested by the new SGSN may differ from list of RABs established in the Source RNC contained in the Source-RNC to target RNC transparent container. The target RNC should not establish the RABs (as identified from the Source-RNC to target RNC transparent container) that did not exist in the source RNC prior to the relocation. The RAB ID information element contains the NSAPI value, and the RAB parameters information element gives the QoS profile. The Transport Layer Address is the SGSN Address for user data, and the Iu Transport Association corresponds to the uplink Tunnel Endpoint Identifier Data. The new SGSN may decide to establish Direct Tunnel unless it has received a 'set' GCSI flag from the old SGSN. If the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the GGSN's Address for User Plane and TEID for Uplink data. For using S4, if the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the S‑GW's Address for User Plane and TEID for Uplink data. If the Access Restriction is present in the MM context, the Service Handover related information shall be included by new S4-SGSN for the Relocation Request message in order for RNC to restrict the UE in connected mode to handover to the RAT prohibited by the Access Restriction. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\nThe new SGSN shall include the CSG ID and CSG Membership Indication when provided by the old SGSN in the Forward Relocation Request message.\nThe target RNC shall verify the CSG ID provided by the source SRNC, and reject the handover with an appropriate cause if it does not match the CSG ID and the target cell is a CSG cell. If the target cell is a hybrid cell and differentiated treatment of CSG and non-CSG members is performed then the CSG membership status is used to differentiate CSG and non-CSG members. If the target cell is a CSG cell, and if the CSG Membership Indication is \"non member\", the target RNC only accepts the emergency bearers.\nAfter all the necessary resources for accepted RABs including the Iu user plane are successfully allocated, the target RNC shall send the Relocation Request Acknowledge message (Target RNC To Source RNC Transparent Container, RABs Setup, RABs Failed To Setup) to the new SGSN. Each RAB to be setup is defined by a Transport Layer Address, which is the target RNC Address for user data, and the Iu Transport Association, which corresponds to the downlink Tunnel Endpoint Identifier for user data. The transparent container contains all radio-related information that the MS needs for the handover, i.e., a complete RRC message (e.g., Physical Channel Reconfiguration in UTRAN case, or Handover From UTRAN, or Handover Command in GERAN Iu mode case) to be sent transparently via CN and source SRNC to the MS. For each RAB to be set up, the target RNC may receive simultaneously downlink user packets both from the source SRNC and from the new SGSN.\n5)\tWhen resources for the transmission of user data between target RNC and new SGSN have been allocated and the new SGSN is ready for relocation of SRNS, the Forward Relocation Response (Cause, RAN Transparent Container, RANAP Cause, Target-RNC Information) message is sent from the new SGSN to the old SGSN. This message indicates that the target RNC is ready to receive from source SRNC the forwarded downlink PDUs, i.e., the relocation resource allocation procedure is terminated successfully. RAN transparent container and RANAP Cause are information from the target RNC to be forwarded to the source SRNC. The Target RNC Information, one information element for each RAB to be set up, contains the RNC Tunnel Endpoint Identifier and RNC IP address for data forwarding from the source SRNC to the target RNC. The Forward Relocation Response message is applicable only in case of inter-SGSN SRNS relocation.\n6)\tThe old SGSN continues the relocation of SRNS by sending a Relocation Command message (Target RNC To Source RNC Transparent Container, RABs To Be Released, RABs Subject To Data Forwarding) to the source SRNC. The old SGSN decides the RABs to be subject for data forwarding based on QoS, and those RABs shall be contained in RABs subject to data forwarding. For each RAB subject to data forwarding, the information element shall contain RAB ID, Transport Layer Address, and Iu Transport Association. These are the same Transport Layer Address and Iu Transport Association that the target RNC had sent to new SGSN in Relocation Request Acknowledge message, and these are used for forwarding of downlink N‑PDU from the source SRNC to the target RNC. The source SRNC is now ready to forward downlink user data directly to the target RNC over the Iu interface. This forwarding is performed for downlink user data only.\n7)\tThe source SRNC may, according to the QoS profile, begins the forwarding of data for the RABs to be subject for data forwarding.\nNOTE 3:\tThe order of steps, starting from step 7 onwards, does not necessarily reflect the order of events. For instance, source RNC may start data forwarding (step 7), send the RRC message to MS (step 8) and forward SRNS Context message to the old SGSN (step 9) almost simultaneously.\nThe data forwarding at SRNS relocation shall be carried out through the Iu interface, meaning that the GTP-PDUs exchanged between the source SRNC and the target RNC are duplicated in the source SRNC and routed at the IP layer towards the target RNC. For each radio bearer which uses lossless PDCP the GTP-PDUs related to transmitted but not yet acknowledged PDCP-PDUs are duplicated and routed at IP layer towards the target RNC together with their related downlink PDCP sequence numbers. The source RNC continues transmitting duplicates of downlink data and receiving uplink data.\nBefore the serving RNC role is not yet taken over by target RNC and when downlink user plane data starts to arrive to target RNC, the target RNC may buffer or discard arriving downlink GTP-PDUs according to the related QoS profile.\n8)\tBefore sending the RRC message the uplink and downlink data transfer shall be suspended in the source SRNC for RABs, which require delivery order. The RRC message is for example Physical Channel Reconfiguration for RNS to RNS relocation, or Intersystem to UTRAN Handover for BSS to RNS relocation, or Handover from UTRAN Command for BSS relocation, or Handover Command for BSS to BSS relocation. When the source SRNC is ready, the source RNC shall trigger the execution of relocation of SRNS by sending to the MS the RRC message provided in the Target RNC to source RNC transparent container, e.g., a Physical Channel Reconfiguration (UE Information Elements, CN Information Elements) message. UE Information Elements include among others new SRNC identity and S‑RNTI. CN Information Elements contain among others Location Area Identification and Routeing Area Identification.\nWhen the MS has reconfigured itself, it sends an RRC message e.g., a Physical Channel Reconfiguration Complete message to the target SRNC. If the Forward SRNS Context message with the sequence numbers is received, the exchange of packets with the MS may start. If this message is not yet received, the target RNC may start the packet transfer for all RABs, which do not require maintaining the delivery order.\n9)\tThe source SRNC continues the execution of relocation of SRNS by sending a Forward SRNS Context (RAB Contexts) message to the target RNC via the old and the new SGSN. The Forward SRNS Context message is acknowledged by a Forward SRNS Context Acknowledge message, from new to old SGSN. The purpose of this procedure is to transfer SRNS contexts from the source RNC to the target RNC, and to move the SRNS role from the source RNC to the target RNC. SRNS contexts are sent for each concerned RAB and contain the sequence numbers of the GTP PDUs next to be transmitted in the uplink and downlink directions and the next PDCP sequence numbers that would have been used to send and receive data from the MS. PDCP sequence numbers are only sent by the source RNC for the radio bearers which used lossless PDCP (see TS 25.323 [57]). The use of lossless PDCP is selected by the RNC when the radio bearer is set up or reconfigured.\nWhen using Gn/Gp, for PDP context(s) using delivery order not required (QoS profile), the sequence numbers of the GTP-PDUs next to be transmitted are not used by the target RNC.\nWhen using Gn/Gp, if delivery order is required (QoS profile), consecutive GTP-PDU sequence numbering shall be maintained throughout the lifetime of the PDP context(s). Therefore, during the entire SRNS relocation procedure for the PDP context(s) using delivery order required (QoS profile), the responsible GTP-U entities (RNCs and GGSN) shall assign consecutive GTP-PDU sequence numbers to user packets belonging to the same PDP context uplink and downlink, respectively.\nThe target RNC establishes and/or restarts the RLC and exchanges the PDCP sequence numbers (PDCP‑SNU, PDCP‑SND) between the target RNC and the MS. PDCP‑SND is the PDCP sequence number for the next expected in-sequence downlink packet to be received by the MS per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SND confirms all mobile terminated packets successfully transferred before the SRNC relocation. If PDCP‑SND confirms reception of packets that were forwarded from the source SRNC, then the target SRNC shall discard these packets. PDCP‑SNU is the PDCP sequence number for the next expected in-sequence uplink packet to be received in the RNC per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SNU confirms all mobile originated packets successfully transferred before the SRNC relocation. If PDCP‑SNU confirms reception of packets that were received in the source SRNC, the MS shall discard these packets.\n10)\tThe target RNC shall send a Relocation Detect message to the new SGSN when the relocation execution trigger is received. For SRNS relocation type \"UE Involved\", the relocation execution trigger may be received from the Uu interface; i.e., when target RNC detects the MS on the lower layers. When the Relocation Detect message is sent, the target RNC shall start SRNC operation.\n11)\tWhen the target SRNC receives the appropriate RRC message, e.g. Physical Channel Reconfiguration Complete message or the Radio Bearer Release Complete message in UTRAN case, or the Handover To UTRAN Complete message or Handover Complete message in GERAN case, i.e. the new SRNC‑ID + S‑RNTI are successfully exchanged with the MS by the radio protocols, the target SRNC shall initiate a Relocation Complete procedure by sending the Relocation Complete message to the new SGSN. The purpose of the Relocation Complete procedure is to indicate by the target SRNC the completion of the relocation of the SRNS to the CN.\nFor SIPTO at the Local Network with stand-alone GW architecture, the target RNC shall include the Local Home Network ID of the target cell in the Relocation Complete message.\n12)\tUpon receipt of Relocation Complete message, if the SRNS Relocation is an inter SGSN SRNS relocation, the new SGSN signals to the old SGSN the completion of the SRNS relocation procedure by sending a Forward Relocation Complete message.\n13)\tUpon receipt of the Relocation Complete message, the CN shall switch the user plane from the source RNC to the target SRNC. If the SRNS Relocation is an inter-SGSN SRNS relocation and the new SGSN received Forward Relocation Complete Acknowledge message from the old SGSN or if Direct Tunnel was established in intra-SGSN SRNS relocation, the new SGSN sends Update PDP Context Request messages (new SGSN Address, SGSN Tunnel Endpoint Identifier, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, NRSN, DTI) to the GGSNs concerned. The SGSN shall send the serving network identity to the GGSN. If Direct Tunnel is established the SGSN provides to GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Forward Relocation Request message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return an Update PDP Context Response (GGSN Tunnel Endpoint Identifier, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\n14)\tUpon receiving the Relocation Complete message or, if it is an inter-SGSN SRNS relocation, the Forward Relocation Complete message, the old SGSN sends an Iu Release Command message to the source RNC. When the RNC data-forwarding timer has expired, the source RNC responds with an Iu Release Complete message.\nAn old S4-SGSN starts a timer to supervise when resources in old Serving GW (in case of Serving GW change or in case of S4 to Gn/Gp SGSN change) shall be released. When this timer expires the old S4-SGSN releases the S‑GW resources. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\n15)\tAfter the MS has finished the reconfiguration procedure and if the new Routeing Area Identification is different from the old one, the MS initiates the Routeing Area Update procedure. See clause \"Location Management Procedures (Iu mode)\". Note that it is only a subset of the RA update procedure that is performed, since the MS is in PMM‑CONNECTED state.\nIf the SRNS Relocation is inter-SGSN, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b])\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer Context for using S4 from the GGSN/P‑GW or old S4-SGSN for using S4 and then store the new Maximum APN restriction value.\nIf the SRNS Relocation is intra-SGSN, then the above mentioned CAMEL procedures calls shall not be performed.\nIf Routeing Area Update occurs, the SGSN shall determine whether Direct Tunnel can be used based on the received GPRS CAMEL Subscription Information. If Direct Tunnel can not be maintained the SGSN shall re-establish RABs and initiate the Update PDP Context procedure to update the IP Address and TEID for Uplink and Downlink data.\nIf Routeing Area Update occurs, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b]):\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. In Figure 42, the procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context. It returns as result \"Continue\".\nFor C2 and C3: refer to Routing Area Update procedure description for detailed message flow.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.9",
        "clause_5.3.7.3",
        "clause_13.8",
        "figure_40",
        "figure_41",
        "figure_42",
        "ts_23.236",
        "ts_25.323",
        "ts_23.401",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2.3",
      "section_id": "6.9.2.2.3",
      "section_title": "Combined Cell / URA Update and SRNS Relocation Procedure",
      "content": "This procedure is only performed for an MS in PMM‑CONNECTED state, where the Iur/Iur-g interface carries control signalling but no user data In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nThe Combined Cell / URA Update and SRNS Relocation or Combined Cell/GRA Update and SBSS Relocation procedure is used to move the RAN to CN connection point at the RAN side from the source SRNC to the target RNC, while performing a cell re-selection in the RAN. In the procedure, the Iu links are relocated. If the target RNC is connected to the same SGSN as the source SRNC, an Intra-SGSN SRNS Relocation procedure is performed. If the routeing area is changed, this procedure is followed by an Intra-SGSN Routeing Area Update procedure. The SGSN detects that it is an intra-SGSN routeing area update by noticing that it also handles the old RA. In this case, the SGSN has the necessary information about the MS and there is no need to inform the HLR about the new MS location.\nBefore the Combined Cell / URA Update and SRNS Relocation or Combined Cell/GRA Update and SBSS Relocation and before the Routeing Area Update, the MS is registered in the old SGSN. The source RNC is acting as serving RNC or serving BSS.\nAfter the Combined Cell / URA Update and SRNS Relocation or Combined Cell/GRA Update and SBSS Relocation and after the Routeing Area Update, the MS is registered in the new SGSN. The MS is in state PMM‑CONNECTED towards the new SGSN, and the target RNC is acting as serving RNC.\nThe Combined Cell / URA Update and SRNS Relocation or Combined Cell/GRA Update and SBSS relocation procedure for the PS domain is illustrated in Figure 43. The sequence is valid for both intra-SGSN SRNS relocation and inter-SGSN SRNS relocation. This signalling flow is also applicable to BSS to RNS relocation and vice-versa, as well as for BSS to BSS relocation.\nFigure 43: Combined Cell / URA Update and SRNS Relocation Procedure\nNOTE 1:\tAll steps in figure 43, except steps (A) and 13, are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) and (B) are defined in clause 6.9.2.2.1a.\n1)\tThe MS sends a Cell Update / URA Update or a Cell Update / GRA Update message to the source SRNC (if the cell is located under another RNC the message is routed via the DRNC to SRNC over the Iur). The source SRNC decides whether or not to perform a combined cell / URA update and SRNS relocation towards the target RNC. The rest of this clause describes the case where a combined cell / URA update and SRNS relocation applies. In this case no radio bearer is established between the source SRNC and the UE. Nonetheless the following tunnel(s) are established: GTP-U tunnel(s) between source SRNC and old-SGSN; GTP-U tunnel(s) between old-SGSN and GGSN (for using S4: GTP‑U tunnel(s) between old-SGSN and S‑GW; GTP‑U tunnel(s) between S‑GW and P‑GW).\nIf the UE has an ongoing emergency bearer service the source SRNC shall not initiate relocation from UTRAN to GERAN.\n2)\tThe source SRNC sends a Relocation Required message (Relocation Type, Cause, Source ID, Target ID, Source RNC to Target RNC Transparent Container) to the old SGSN. The source SRNC shall set Relocation Type to \"UE not involved\". Source RNC to Target RNC Transparent Container includes the necessary information for Relocation co-ordination, security functionality, and RRC protocol context information (including MS Capabilities).\n3)\tThe old SGSN determines from the Target ID if the SRNS Relocation is intra-SGSN SRNS relocation or inter-SGSN SRNS relocation. The old SGSN selects the target SGSN as described in clause 5.3.7.3 on \"SGSN selection function\". In the case of inter-SGSN SRNS relocation the old SGSN initiates the relocation resource allocation procedure by sending a Forward Relocation Request (IMSI, Tunnel Endpoint Identifier Signalling, MM Context, PDP Context/EPS Bearer Context, Negotiated Evolved ARP, Target Identification, RAN Transparent Container, RANAP Cause, GCSI) message to the new SGSN. If this message is sent between two S4-SGSNs then the old SGSN shall include APN restriction and Change Reporting Action in this message. For relocation to an area where Intra Domain Connection of RAN Nodes to Multiple CN Nodes is used, the old SGSN may – if it provides Intra Domain Connection of RAN Nodes to Multiple CN Nodes have multiple target SGSNs for each relocation target in a pool area, in which case the old SGSN will select one of them to become the new SGSN, as specified in TS 23.236 [73].\nIf at least one of the two SGSNs is a Gn/Gp SGSN then PDP context is indicated. An S4-SGSN derives from GTPv1 Forward Relocation signalling that the other SGSN is a Gn/Gp SGSN, which also does not signal any S‑GW change. PDP context contains GGSN Address for User Plane and Uplink TEID for Data (to this GGSN Address and Uplink TEID for Data, the old SGSN and the new SGSN send uplink packets).\nBetween two S4-SGSNs EPS Bearer Context is indicated. The Bearer context contains S‑GW Address for User Plane and Uplink TEID for Data (to this S‑GW Address and Uplink TEID for Data the old SGSN and the new SGSN send uplink packets) and P‑GW Address for User Plane and Uplink TEID for Data.\nAt the same time a timer is started on the MM and PDP contexts/EPS Bearer Context in the old SGSN, see Routeing Area Update procedure in clause \"Location Management Procedures (Iu mode)\". The Forward Relocation Request message is applicable only in case of inter-SGSN SRNS relocation. The old SGSN 'sets' the GCSI flag if the MM context contains GPRS CAMEL subscription information.\nIf the UE receives only emergency services from the old SGSN and the UE is UICCless, IMSI can not be included in Forward Relocation Request message. For emergency attached UEs if the IMSI cannot be authenticated then the IMSI shall be marked as unauthenticated.\nIf SIPTO at the Local Network is active for a PDN connection in the architecture with stand-alone GW the old SGSN shall include the Local Home Network ID of the source cell in the EPS Bearer context corresponding to the SIPTO at the Local Network PDN connection.\n4)\tThe new SGSN sends a Relocation Request message (Permanent NAS UE Identity (if available), MSISDN, Cause, CN Domain Indicator, Source RNC to Target RNC Transparent Container, RABs To Be Setup (APN, Charging characteristics), UE-AMBR, Service Handover related information) to the target RNC. For each requested RAB, RABs To Be Setup shall contain information such as RAB ID, RAB parameters, Transport Layer Address, and Iu Transport Association. SGSN shall not establish RABs for PDP contexts with maximum bit rate for uplink and downlink of 0 kbit/s. The list of RABs requested by the SGSN may differ from list of RABs available in the Source RNC. The target RNC should not establish the RABs (as identified from the Source-RNC to target RNC transparent container) that did not exist in the source RNC prior to the relocation. The RAB ID information element contains the NSAPI value, and the RAB parameters information element gives the QoS profile. The Transport Layer Address is the SGSN Address for user data, and the Iu Transport Association corresponds to the uplink Tunnel Endpoint Identifier Data. The new SGSN may decide to establish Direct Tunnel unless it has received a 'set' GCSI flag from the old SGSN. If the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the GGSN's Address for User Plane and TEID for Uplink data. For using S4, if the new SGSN decides to establish Direct Tunnel, it provides to the target RNC the S‑GW's Address for User Plane and TEID for Uplink data. If the Access Restriction is present in the MM context, the Service Handover related information shall be included by new S4-SGSN for the Relocation Request message in order for RNC to restrict the UE in connected mode to handover to the RAT prohibited by the Access Restriction. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\nAfter all necessary resources for accepted RABs including the Iu user plane are successfully allocated, the target RNC shall send the Relocation Request Acknowledge message (RABs setup, RABs failed to setup) to the new SGSN. Each RAB to be setup is defined by a Transport Layer Address, which is the target RNC Address for user data, and a Iu Transport Association which corresponds to the downlink Tunnel Endpoint Identifier for user data.\nAfter the new SGSN receives the Relocation Request Acknowledge message, the GTP-U tunnels are established between the target RNC and the new-SGSN.\nThe target-RNC may simultaneously receive for each RAB to be set up downlink user packets both from the source SRNC and from the new SGSN.\n5)\tWhen resources for the transmission of user data between the target RNC and the new SGSN have been allocated and the new SGSN is ready for relocation of SRNS, the Forward Relocation Response message (Cause, RANAP Cause, and Target RNC Information) is sent from the new SGSN to the old SGSN. This message indicates that the target RNC is ready to receive from the source SRNC the forwarded downlink packets, i.e., the relocation resource allocation procedure is terminated successfully. RANAP Cause is information from the target RNC to be forwarded to the source SRNC. The RAB Setup Information, one information element for each RAB, contains the RNC Tunnel Endpoint Identifier and RNC IP address for data forwarding from the source SRNC to the target RNC. If the target RNC or the new SGSN failed to allocate resources, the RAB Setup Information element contains only NSAPI indicating that the source SRNC shall release the resources associated with the NSAPI. The Forward Relocation Response message is applicable only in case of inter-SGSN SRNS relocation.\n6)\tThe old SGSN continues the relocation of SRNS by sending a Relocation Command (RABs to be released, and RABs subject to data forwarding) message to the source SRNC. The old SGSN decides the RABs subject to data forwarding based on QoS, and those RABs shall be contained in RABs subject to data forwarding. For each RAB subject to data forwarding, the information element shall contain RAB ID, Transport Layer Address, and Iu Transport Association. These are the same Transport Layer Address and Iu Transport Association that the target RNC had sent to new SGSN in Relocation Request Acknowledge message, and these are used for forwarding of downlink N‑PDU from the source SRNC to the target RNC. The source SRNC is now ready to forward downlink data directly to the target RNC over the Iu interface. This forwarding is performed for downlink user data only.\n7)\tThe source SRNC may, according to the QoS profile, begin the forwarding of data for the RABs subject to data forwarding and starts the data-forwarding timer. The data forwarding at SRNS relocation shall be carried out through the Iu interface, meaning that the data exchanged between the source SRNC and the target RNC are duplicated in the source SRNC and routed at the IP layer towards the target RNC. For each radio bearer which uses lossless PDCP the GTP-PDUs related to transmitted but not yet acknowledged PDCP-PDUs are duplicated and routed at IP layer towards the target RNC together with their related downlink PDCP sequence numbers. The source RNC continues transmitting duplicates of downlink data and receiving uplink data.\nNOTE 2:\tThe order of steps, starting from step 7 onwards, does not necessarily reflect the order of events. For instance, source RNC may send data forwarding (step 7) and start Relocation Commit message (step 8) almost simultaneously. Target RNC may send Relocation Detect message (step 9) and Cell Update Confirm/URA Update Confirm (or Cell Update Confirm/GRA Update Confirm) message (step 10) at the same time. Hence, target RNC may receive the UTRAN or GERAN Mobility Information Confirm message from MS (step 10) while data forwarding (step 8) is still underway, and before the new SGSN receives Update PDP Context Response message (step 11).\nBefore the serving RNC role is not yet taken over by target RNC and when downlink user plane data starts to arrive to target RNC, the target RNC may buffer or discard arriving downlink GTP-PDUs according to the related QoS profile.\n8)\tBefore sending the Relocation Commit the uplink and downlink data transfer in the source, SRNC shall be suspended for RABs, which require delivery order.\nWhen the source SRNC is ready, the source SRNC shall trigger the execution of relocation of SRNS by sending a Relocation Commit message (SRNS Contexts) to the target RNC over the UTRAN Iur interface or over the GERAN Iur-g interface, respectively. The purpose of this procedure is to transfer SRNS contexts from the source RNC to the target RNC, and to move the SRNS role from the source RNC to the target RNC. SRNS contexts are sent for each concerned RAB and contain the sequence numbers of the GTP‑PDUs next to be transmitted in the uplink and downlink directions and the next PDCP sequence numbers that would have been used to send and receive data from the MS. . PDCP sequence numbers are only sent by the source RNC for radio bearers, which used lossless PDCP (see TS 25.323 [57]). The use of lossless PDCP is selected by the RNC when the radio bearer is set up or reconfigured. For PDP context(s) using delivery order not required (QoS profile), the sequence numbers of the GTP-PDUs next to be transmitted are not used by the target RNC.\nIf delivery order is required (QoS profile), consecutive GTP-PDU sequence numbering shall be maintained throughout the lifetime of the PDP context(s). Therefore, during the entire SRNS relocation procedure for the PDP context(s) using delivery order required (QoS profile), the responsible GTP-U entities (RNCs and GGSN) shall assign consecutive GTP-PDU sequence numbers to user packets belonging to the same PDP context for uplink and downlink respectively.\n9)\tThe target RNC shall send a Relocation Detect message to the new SGSN when the relocation execution trigger is received. For SRNS relocation type \"UE not involved\", the relocation execution trigger is the reception of the Relocation Commit message from the Iur interface. When the Relocation Detect message is sent, the target RNC shall start SRNC operation.\n10)\tThe target SRNC sends a Cell Update Confirm / URA Update Confirm or Cell Update Confirm / GRA Update Confirm message. This message contains UE information elements and CN information elements. The UE information elements include among others new SRNC identity and S‑RNTI. The CN information elements contain among others Location Area Identification and Routeing Area Identification. The procedure shall be co-ordinated in all Iu signalling connections existing for the MS.\nUpon reception of the Cell Update Confirm / URA Update Confirm or Cell Update Confirm / GRA Update Confirm message the MS may start sending uplink user data to the target SRNC. When the MS has reconfigured itself, it sends the RAN Mobility Information Confirm message to the target SRNC. This indicates that the MS is also ready to receive downlink data from the target SRNC.\nIf the new SGSN has already received the Update PDP Context Response message from the GGSN, it shall forward the uplink user data to the GGSN over this new GTP-U tunnel. Otherwise, the new SGSN shall forward the uplink user data to that GGSN IP address and TEID(s), which the new SGSN had received earlier by the Forward Relocation Request message.\nFor using S4, if new the SGSN has already received the Modify Bearer Context Response message from the S‑GW, it shall forward the uplink user data to S‑GW over this new GTP‑U tunnel. Otherwise, the new SGSN shall forward the uplink user data to that S‑GW IP address and TEID(s), which the new SGSN had received earlier by the Forward Relocation Request message.\nThe target SRNC and the MS exchange the PDCP sequence numbers; PDCP‑SNU and PDCP‑SND. PDCP‑SND is the PDCP sequence number for the next expected in-sequence downlink packet to be received in the MS per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SND confirms all mobile terminated packets successfully transferred before the SRNC relocation procedure. . If PDCP‑SND confirms the reception of packets that were forwarded from the source SRNC, the target SRNC shall discard these packets. PDCP‑SNU is the PDCP sequence number for the next expected in-sequence uplink packet to be received in the RNC per radio bearer, which used lossless PDCP in the source RNC. PDCP‑SNU confirms all mobile originated packets successfully transferred before the SRNC relocation. If PDCP‑SNU confirms reception of packets that were received in the source SRNC, the target SRNC shall discard these packets.\n11)\tWhen the target SRNC receives the RAN Mobility Information Confirm message, i.e. the new SRNC‑ID + S‑RNTI are successfully exchanged with the MS by the radio protocols, the target SRNC shall initiate the Relocation Complete procedure by sending the Relocation Complete message to the new SGSN. The purpose of the Relocation Complete procedure is to indicate by the target SRNC the completion of the relocation of the SRNS to the CN.\nFor SIPTO at the Local Network with stand-alone GW architecture, the target RNC shall include the Local Home Network ID of the target cell in the Relocation Complete message.\n12)\tUpon receipt of Relocation Complete message, if the SRNS Relocation is an inter SGSN SRNS relocation, the new SGSN signals to the old SGSN the completion of the SRNS relocation procedure by sending a Forward Relocation Complete message.\n13)\tUpon receipt of the Relocation Complete message, the CN shall switch the user plane from the source RNC to the target SRNC. If the SRNS Relocation is an inter-SGSN SRNS relocation and the new SGSN received Forward Relocation Complete Acknowledge message from the old SGSN or if Direct Tunnel was established in intra-SGSN SRNS relocation, the new SGSN sends Update PDP Context Request messages (new SGSN Address, SGSN Tunnel Endpoint Identifier, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, NRSN, DTI) to the GGSNs concerned. The SGSN shall send the serving network identity to the GGSN. If Direct Tunnel is established the SGSN provides to GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Forward Relocation Request message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. The GGSNs update their PDP context fields and return an Update PDP Context Response (GGSN Tunnel Endpoint Identifier, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\n14)\tUpon receiving the Relocation Complete message or if it is an inter-SGSN SRNS relocation, the Forward Relocation Complete message, the old SGSN sends an Iu Release Command message to the source RNC. When the RNC data-forwarding timer has expired the source RNC responds with an Iu Release Complete.\nAn old S4-SGSN starts a timer to supervise when resources in old Serving GW (in case of Serving GW change or in case of S4 to Gn/Gp SGSN change) shall be released. When this timer expires the old S4-SGSN releases the S‑GW resources. The old S4-SGSN deletes S-GW bearer resources by sending Delete Session Request (Cause, Operation Indication) messages to the SGW. If ISR is activated the Cause indicates that the old S-GW shall delete the bearer resources on the other old CN node by sending Delete Bearer Request message to the other CN node. The Operation Indication flag is not set by the old S4-SGSN. This indicates to the S-GW that the S‑GW shall not initiate a delete procedure towards the PDN GW.\n15)\tAfter the MS has finished the Cell / URA update or the Cell / GRA update and RNTI reallocation procedure and if the new Routeing Area Identification is different from the old one, the MS initiates the Routeing Area Update procedure. See clause \"Location Management Procedures (Iu mode)\". Note that it is only a subset of the RA update procedure that is performed, since the MS is in PMM‑CONNECTED state.\nIf the SRNS Relocation is inter-SGSN, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b])\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context/EPS Bearer Context for using S4 from the GGSN/P‑GW or old S4-SGSN and then store the new Maximum APN restriction value.\nIf the SRNS Relocation is intra-SGSN, then the above mentioned CAMEL procedures calls shall not be performed.\nIf Routeing Area Update occurs, the SGSN shall determine whether Direct Tunnel can be used based on the received GPRS CAMEL Subscription Information. If Direct Tunnel, can not be maintained the SGSN shall re-establish RABs and initiate the Update PDP Context procedure to update the IP Address and TEID for Uplink and Downlink data.\nIf Routeing Area Update occurs, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b]):\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen, the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times: once per PDP context/EPS Bearer Context for using S4. It returns as result \"Continue\". For C2 and C3: refer to Routing Area Update procedure description for detailed message flow.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.9.2.2.1",
        "clause_5.3.7.3",
        "clause_13.8",
        "figure_43",
        "ts_23.236",
        "ts_25.323",
        "ts_23.401",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2.4",
      "section_id": "6.9.2.2.4",
      "section_title": "SRNS Relocation Cancel Procedure",
      "content": "The purpose of the SRNS Relocation Cancel procedure is to cancel an ongoing SRNS relocation. The SRNS Relocation Cancel procedure may be initiated during or after the Relocation Preparation procedure and may be initiated by the source RNC.\nThe SRNS Relocation Cancel procedure is illustrated in Figure 44. The sequence is valid for cancelling both an intra-SGSN SRNS relocation and an inter-SGSN SRNS relocation.\nFigure 44: SRNS Cancel Relocation Procedure\nNOTE:\tAll steps in figure 44, except steps (A), are common for architecture variants using Gn/Gp based SGSN and using S4 based interaction with S‑GW. For an S4 based interaction with S‑GW, procedure steps (A) are defined in the clause 6.9.2.2.4a.\n1)\tAn SRNS Relocation procedure has started, as specified in clause 6.9.2.2.1.\n2a)\tThe SRNS Cancel Relocation may be initiated by a timer expiry or by an error event in the source RNC.\n2b)\tWhen one of conditions in 2a is satisfied, the source RNC sends a Relocation Cancel (Cause) to the old SGSN. Cause indicates the reason for cancelling the ongoing SRNS relocation.\n3)\tThe old SGSN sends a Relocation Cancel Request (RANAP Cause) to the new SGSN to indicate that the ongoing SRNS relocation should be cancelled. RANAP Cause contains the cause value received by the source RNC in the Relocation Cancel message.\n4)\tThe new SGSN sends an Iu Release Command (Cause) to request from the target RNC to release the Iu resources already allocated for the SRNS relocation, or to cancel the ongoing allocation of Iu resources for the SRNS relocation. Cause is set equal to RANAP Cause, i.e. to whatever cause value was included in the Relocation Cancel Request received from old SGSN. The target RNC releases the requested Iu resources and responds with an Iu Release Complete.\n5)\tThe new SGSN acknowledges the cancellation of the ongoing SRNS Relocation by sending a Relocation Cancel Response to the old SGSN.\n6)\tThe old SGSN responds to the source RNC with a Relocation Cancel Ack message.\nIf the SRNS Relocation is inter-SGSN, then the following CAMEL procedure calls shall be performed (see referenced procedures in TS 23.078 [8b]):\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe procedure CAMEL_GPRS_Routeing_Area_Update_Session is called. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThe procedure is called several times: once per PDP context. It returns as result \"Continue\".\nFor C2 and C3: refer to Routing Area Update procedure description for detailed message flow.\n6.9.2.2.4a\tSRNS Relocation Cancel Procedure Using S4\nThe procedures described in figures 44a shows only the steps (A) due to use of S4, which are different from the Gn/Gp variant of the procedure given by clauses 6.9.2.2.4.\nFigure 44a1: A) for SRNS Relocation Cancel Procedure Using S4\nA1.\tThis step is only performed in case of handover from S4-SGSN to S4-SGSN with Serving GW relocation or handover from Gn/Gp SGSN to S4-SGSN. The New S4-SGSN deletes the EPS bearer resources by sending Delete Session Request (Cause) messages to the New S‑GW.\nA2.\tThe New S‑GW acknowledges with Delete Session Response messages.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.9.2.2.4",
        "clause_6.9.2.2.1",
        "figure_44",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.2.2.5",
      "section_id": "6.9.2.2.5",
      "section_title": "Enhanced Serving RNS Relocation Procedure",
      "content": "The procedure can be used for relocation when source SRNC and target RNC are connected to same SGSN.\nNOTE 1:\tIf the MS is both MM-CONNECTED and PMM-CONNECTED, then this procedure can only be used if the source RNC and target RNC are connected to same MSC.\nThis procedure is only performed for an MS in PMM CONNECTED state where the Iur interface is available between a serving RNC and a drifting RNC. This procedure is not applicable for GERAN.\nIn Enhanced Serving RNS Relocation the SRNS functionality is prepared at RAN side and the SGSN is not informed until the preparation and execution of the relocation has taken place, the preparation and execution phases are performed as specified in TS 25.423 [95]. The completion phase is illustrated in Figure 44a below.\nFigure 44a2: Enhanced Serving RNS Relocation\nNOTE 2:\tThe figure shows the user plane connections when Direct Tunnel is established. If Direct Tunnel is not established only the user plane between RNC and SGSN is impacted due relocation.\nThere are three phases for the Enhanced Serving RNS Relocation.\nPreparation Phase:\n-\tThe Source RNC decides to relocate the UE to a neighbouring RNC (Target RNC).\n-\tThe Source RNC triggers the RNSAP: Enhanced Relocation procedure.\nExecution Phase:\n-\tThe RNC triggers the relocation to MS.\n-\tThe Source RNC may start data forwarding.\nCompletion Phase:\n1.\tThe MS has been relocated to the Target RNC.\n2.\tThe Target RNC sends Enhanced Relocation Complete Request message to the SGSN to indicate that the MS was relocated to the Target RNC. The Target RNC indicates successfully relocated, modified or released RABs to the SGSN.\nFor SIPTO at the Local Network with stand-alone GW architecture, the target RNC shall include the Local Home Network ID of the target cell in the Enhanced Relocation Complete Request message.\n3.\tUpon receipt of the enhanced Relocation Complete message, the SGSN shall switch the user plane from the source RNC to the target SRNC. If Direct Tunnel was established, the SGSN sends Update PDP Context Request messages (SGSN Address, SGSN Tunnel Endpoint Identifier, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, NRSN, DTI) to the GGSNs concerned. The SGSN shall send the serving network identity to the GGSN. If Direct Tunnel is established the SGSN provides to GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8. NRSN indicates SGSN support of the network requested bearer control. The GGSNs update their PDP context fields and return an Update PDP Context Response (GGSN Tunnel Endpoint Identifier, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\nFor an S4 based interaction with S‑GW and P‑GW procedure step (A) is defined in clause 6.9.2.2.5A.\n4.\tThe SGSN configures the necessary Iu resources for the Target RNC and responds with Enhanced Relocation Complete Response.\n5.\tAfter sending the Enhanced Relocation Complete Response message to the Target RNC the SGSN sends an Iu Release Command message to the source RNC and the source RNC responds with an Iu Release Complete.\n6.\tIf the Routeing Area Identification is different from the old one the MS initiates the Routeing Update procedure. See clause 6.9.2. Like after the relocation procedures described in clauses above e.g. clause 6.9.2.2.1, only a subset of the RA update is performed, since the MS is in PMM-CONNECTED state.\n6.9.2.2.5A\tEnhanced Serving RNS Relocation Procedure using S4\nTwo procedures are defined depending on whether the Serving GW is unchanged or relocated, figures 44b and 44c show only the steps 3 and 4 due to use of S4, which is different from the Gn/Gp variant defined in clause 6.9.2.2.5.\nA1)\tProcedure using S4 without Serving GW relocation\nFigure 44b1: Step 3 for Enhanced Serving RNS Relocation without Serving GW relocation using S4\nNOTE 1:\tSteps A) and B) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8.\nA)\tIf Direct Tunnel was established the SGSN update these EPS Bearer contexts by sending Modify Bearer Request (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, SGSN Address(es) and TEID(s) (if Direct Tunnel is not used) or RNC Address(es) and TEID(s) for User Traffic (if Direct Tunnel is used), PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, DTI). If Direct Tunnel is established the SGSN shall include the DTI to instruct the S‑GW to apply Direct Tunnel specific error handling procedure as described in clause 13.8. The SGSN puts the according NSAPI in the field of EPS Bearer ID.\nB)\tIf MS Info Change Reporting is started, the S‑GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication) messages to the P‑GWs involved.\nC)\tThe P‑GWs acknowledge with sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) messages to S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context.\nD)\tThe Serving GW acknowledges the user plane switch to the SGSN via the message Modify Bearer Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, Protocol Configuration Options, PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action). At this stage the user plane path is established for all EPS Bearer contexts between the UE, target RNC, SGSN in case Direct Tunnel is not used, Serving GW and PDN GW.\nA2)\tProcedure using S4 with Serving GW relocation and Direct Tunnel\nThis procedure is used if the SGSN determines the Serving Gateway is to be relocated.\nFigure 44b2: Step 3 for Enhanced Serving RNS Relocation with Serving GW relocation using S4\nNOTE 2:\tSteps A) and B) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8.\nA)\tThe SGSN selects the new Serving GW as described in TS 23.401 [89] under clause 4.3.8.2 on \"Serving GW selection function\", and sends a Create Session Request message (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, SGSN Address(es) and TEID(s) (if Direct Tunnel is not used) or RNC Address(es) and TEID(s) for User Traffic (if Direct Tunnel is used), PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, DTI). If Direct Tunnel is established the SGSN shall include the DTI to instruct the S‑GW to apply Direct Tunnel specific error handling procedure as described in clause 13.8.\nB)\tThe new S‑GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication) messages to the P‑GWs involved.\nC)\tThe P‑GWs acknowledge with sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) messages to new S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context.\nD)\tThe new Serving GW acknowledges the user plane switch to the SGSN via the message Create Session Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, Protocol Configuration Options, PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action). The SGSN starts timer, to be used in step F.\nE)\tThe SGSN configures the necessary Iu resources for the Target RNC and responds with Enhanced Relocation Complete Response. The SGSN provides to the target RNC the new S‑GW's Address for user Plane and TEID(s) for Uplink data. The target RNC starts using the new Serving GW address and TEID(s) for forwarding subsequent uplink packets.\nF) When the timer has expired after step D, the SGSN releases the bearer(s) in old S‑GW by sending a Delete Session Request message.\nG)\tThe old S‑GW acknowledge bearer deletion.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_13.8",
        "clause_6.9.2.2.5",
        "clause_6.9.2",
        "clause_6.9.2.2.1",
        "ts_23.401_clause_4.3.8.2",
        "figure_44",
        "ts_25.423",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.3",
      "section_id": "6.9.3",
      "section_title": "Periodic RA and LA Updates",
      "content": "All GPRS-attached MSs, except A/Gb mode MSs in class‑B mode of operation engaged in CS communication, shall perform periodic RA updates. MSs that are IMSI-attached and not GPRS-attached shall perform periodic LA updates. Periodic RA updates are equivalent to intra SGSN routeing area updates as described in clause \"Intra SGSN Routeing Area Update\", with Update Type indicating periodic RA update. For MSs that are both IMSI-attached and GPRS-attached, the periodic updates depend on the mode of operation of the network:\n-\tIf the network operates in mode I, periodic RA updates shall be performed, and periodic LA updates shall not be performed. In this case, the MSC/VLR shall disable implicit detach for GPRS-attached MSs and instead rely on the SGSN to receive periodic RA updates. If periodic RA updates are not received in the SGSN and the SGSN detaches the MS, the SGSN shall notify the MSC/VLR by sending an IMSI Detach Indication message.\n-\tIf the network operates in mode II, both periodic RA updates and periodic LA updates shall be performed independently. RA updates are performed towards the SGSN, and LA updates are performed towards the MSC/VLR.\nIn A/Gb mode, the periodic RA update timer in the MS is stopped when an LLC PDU is sent since all sent LLC PDUs set the MM context state to READY. The periodic RA update timer is reset and started when the state returns to STANDBY.\nIn Iu mode, the periodic RA update timer in the MS is stopped when the MM context enters the PMM‑CONNECTED state. The periodic RA update timer is reset and started when the state returns to PMM‑IDLE state.\nIf the MS could not successfully complete the periodic RA update procedure after a retry scheme while the MS was in GERAN/UTRAN PS coverage, the MS shall wait a back-off time equal to the periodic LA update timer broadcast by the network before restarting the periodic RA update procedure.\nNOTE:\tIf ISR is activated, additional handling in MS and SGSN is described in TS 23.401 [89].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.4",
      "section_id": "6.9.4",
      "section_title": "PS Handover Procedure",
      "content": "The PS Handover procedure is used to handover an MS with one or more packet flows from a source cell to a target cell, when at least one of the cells is a GERAN cell. The source and target cells can be located within either the same BSS (Intra BSS HO), different BSSs within the same SGSN (Intra SGSN HO) or belonging to different SGSNs (Inter SGSN HO), or systems with different radio access types (Inter RAT HO, Inter mode HO).\nWhile the MS is still in the source cell:\n-\tRadio resources in the target cell are allocated and signalled to the MS.\n-\tSystem information of the target cell needed for access in the target cell is signalled to the MS.\nAfter handover between GERAN and UTRAN is complete, the RAU procedure is performed even if the RAI has not changed.\nAs specified in clause 5.3.13.8, \"Support for Non-IP data\", with regard to CIoT EPS Optimisations, PDP Contexts of PDN Type \"Non-IP\" and PDN Connection to SCEF may need to be handled during the PS Handover Procedure. For an MS that is using a \"Non-IP\" connection to a GGSN/PGW, or a PDP Context to a SCEF, if these PDP Contexts cannot be supported by the target SGSN, the source SGSN does not attempt to handover those bearers and releases them upon successful completion of the handover. If the MS does not have any PDP Context other than Non-IP or SCEF ones that can be transferred, then the SGSN sends failure message to the source RAN node.\nThe complete PS Handover procedures are defined in TS 43.129 [87].\nThe complete Inter RAT HO between E‑UTRAN and GERAN procedures are defined in TS 23.401 [89].",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.3.13.8",
        "ts_43.129",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.9.5",
      "section_id": "6.9.5",
      "section_title": "UE Radio Capability Match Request",
      "content": "If the SGSN requires more information on the UE capabilities support to be able to set the IMS voice over PS Session Supported Indication (see clause 5.3.8), then the SGSN may send a UE Radio Capability Match Request to the RAN. This procedure is typically used during the Initial Attach procedure, during Routing Area Update procedure for the \"first RAU following GERAN/E-UTRAN Attach\" or for \"UE Capability update\" or when SGSN has not received the Voice Support Match Indicator (as part of the MM Context).\nFigure 6.9.5-1: UE Radio Capability Match Request\n1\tThe SGSN indicates whether the SGSN wants to receive Voice support match indicator.\n2.\tUpon receiving a UE Radio Capability Match Request from the SGSN, if the RAN has not already received the UE capabilities from the MS the RAN requests the MS to upload the UE Capability information by sending the RRC UE Capability Enquiry.\n3.\tThe MS provides the RAN with its UE capabilities sending the RRC UE Capability Information.\n4.\tUpon receiving a UE Radio Capability Match Request from the SGSN, the RAN checks whether the UE capabilities are compatible with the network configuration. The RAN provides a Voice Support Match Indicator to the SGSN to indicate whether the UE capabilities and networks configuration are compatible.\nFor determining the appropriate UE Radio Capability Match Response, the RAN is configured by the operator to check whether the MS supports certain capabilities required for IMS PS Voice continuity. In a shared network, the RAN keeps a configuration separately per PLMN.\nNOTE:\tWhat checks to perform depends on network configuration, i.e. following are some examples of MS capabilities to be taken into account:\n-\tthe SRVCC, and UTRAN/E-UTRAN Voice over PS capabilities;\n-\tthe Radio capabilities for UTRAN/E-UTRAN FDD and/or TDD; and/or\n-\tthe support of UTRAN/E-UTRAN frequency bands.\nThe SGSN stores the received Voice support match indicator in the MM Context and uses it as an input for setting the IMS voice over PS Session Supported Indication.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.8",
        "figure_6.9.5-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.10",
      "section_id": "6.10",
      "section_title": "Tunnelling of non-GSM Signalling Messages Function (A/Gb mode)",
      "content": "Tunnelling of Messages (TOM) is an optional protocol layer that uses the LLC unacknowledged mode procedures to tunnel messages between the MS and the SGSN (see TS 44.064 [15]). TOM uses two LLC SAPs for communication between the MS and the SGSN; one for high-priority messages and one for low-priority messages. A network that supports TIA/EIA‑136 [49] shall support the TOM protocol and the Gs interface.\nUpon receiving a non-GSM signalling message from an MS via the TOM protocol, the SGSN forwards the message to a non-GSM MSC/VLR using the BSSAP+ protocol (see GSM 09.18). The specific Gs interface used by the SGSN is determined by the:\n-\tRAI associated with the current location of the MS when the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the Gs interface; and\n-\tinformation in the TOM protocol header.\nUpon receiving a non-GSM signalling message from a non-GSM MSC/VLR via the BSSAP+ protocol, the SGSN forwards the message to a specific MS using the TOM protocol. The specific MS is determined by the SGSN based on the content of the BSSAP+ header.\nThe control plane between an MS and a non-GSM MSC/VLR that uses tunnelling procedures for non-GSM signalling is shown in Figure 45.\nFigure 45: Control Plane MS - Non-GSM MSC/VLR",
      "chunk_type": "general",
      "cross_references": [
        "figure_45",
        "ts_44.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.10.1",
      "section_id": "6.10.1",
      "section_title": "Uplink Tunnelling of non-GSM Signalling Messages Procedure",
      "content": "The Uplink Tunnelling of non-GSM Signalling Messages procedure is illustrated in Figure 46.\nFigure 46: Uplink Tunnelling of non-GSM Signalling Messages Procedure\n1)\tThe MS sends a TOM Protocol Envelope (Non-GSM Signalling Message) to the SGSN either in ciphered or clear mode. The TOM protocol header contains information about the application using the TOM facility and any other TOM Protocol Discriminator-specific information. The TOM Protocol Envelope is received on one of the two LLC SAPs used for tunnelling of messages.\n2)\tThe SGSN identifies the non-GSM MSC/VLR to which to forward the non-GSM signalling message. It then sends a BSSAP+ Uplink Tunnel Request (IMSI, SGSN Address, TOM Priority, Cipher, Non-GSM Signalling Message) message to the identified non-GSM MSC/VLR. The Cipher parameter is set to cipher if the TOM Protocol Envelope was received in ciphered form by the LLC layer. Otherwise, it is set to not cipher. TOM Priority is set to high priority if the TOM Protocol Envelope was received on the high-priority LLC SAP, Otherwise, it is set to low priority.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_46"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.10.2",
      "section_id": "6.10.2",
      "section_title": "Downlink Tunnelling of non-GSM Signalling Messages Procedure",
      "content": "The Downlink Tunnelling of non-GSM Signalling Messages procedure is illustrated in Figure 47.\nFigure 47: Downlink Tunnelling of non-GSM Signalling Messages Procedure\n1)\tThe non-GSM MSC/VLR sends a BSSAP+ Downlink Tunnel Request (IMSI, VLR Address, TOM Priority, Cipher, Non-GSM Signalling Message) message to the SGSN associated with the MS. TOM Priority indicates whether the SGSN shall select the high-priority or low-priority LLC SAP when forwarding the non-GSM signalling message to the MS. Cipher indicates whether or not the SGSN shall cipher the non-GSM signalling message before forwarding it to the MS.\n2)\tThe SGSN sends a TOM Protocol Envelope (Non-GSM Signalling Message) to the MS using the selected LLC SAP.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_47"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.11",
      "section_id": "6.11",
      "section_title": "Subscriber Management Function",
      "content": "The Subscriber Management function provides a mechanism to inform the nodes about changes of the subscription data for a specific subscriber.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.11.1",
      "section_id": "6.11.1",
      "section_title": "Subscriber Management Procedures",
      "content": "Whenever the GPRS subscription data is changed for a subscriber in the HLR/HSS, and the changes affect the GPRS subscription data stored in the SGSN, the SGSN node shall be informed about these changes by means of the following procedures:\n-\tInsert Subscriber Data procedure, used to add or modify subscription data in the SGSN; or Delete Subscriber Data procedure, used to remove PS subscription data in the SGSN.\n-\tDelete Subscriber Data procedure, used to remove subscription data from the SGSN.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.11.1.1",
      "section_id": "6.11.1.1",
      "section_title": "Insert Subscriber Data Procedure",
      "content": "In addition to the insertion and modification of general subscription data for a PS subscriber, see TS 29.002 [23], the HLR may request the insertion or modification of one or several new or existing PDP subscription contexts in the SGSN. It should be noted that the modification may trigger a PDP Context Modification procedure as described in clause \"Modification Procedures\". In particular, the following PDP context parameters may be modified by the HLR:\n-\tQoS Profile Subscribed;\n-\tSubscribed Evolved ARP; and\n-\tVPLMN Address Allowed.\nThe Insert Subscriber Data procedure is illustrated in Figure 48.\nFigure 48: Insert Subscriber Data Procedure\n1)\tThe HLR sends an Insert Subscriber Data (IMSI, Subscription Data) message to the SGSN.\n2)\tThe SGSN updates its GPRS subscription data and acknowledges the Insert Subscriber Data message by returning an Insert Subscriber Data Ack (IMSI) message. For each PDP context that is included in Subscription Data the SGSN shall check whether it is a new, an active, or an inactive PDP context:\nFor architecture variants using Gn/Gp based interaction with GGSN the PDP contexts are handled as follows:\n-\tFor a new or inactive PDP context, no further action is required except storage in the SGSN.\n-\tFor an active PDP context, the SGSN shall in addition compare the new QoS Subscribed with QoS Negotiated, new Subscribed Evolved ARP with the previously stored Subscribed Evolved ARP, respectively and shall, if necessary and MS is in the READY or PMM CONNECTED State, initiate a PDP Context Modification procedure as described in clause \"Modification Procedures\". If modification is necessary, when MS is not in the READY or PMM CONNECTED State, or the modification is not successful when MS is in the READY or PMM CONNECTED State, the SGSN shall directly delete the concerned PDP context(s).PDP Context Modification due to changes in Subscribed Evolved ARP may be skipped if there is no previously stored value for Subscribed Evolved ARP.\n-\tFor an MS in PMM-CONNECTED State and connected via a CSG or hybrid cell, the SGSN shall check the received CSG subscription data. If the SGSN detects that the UE's CSG membership to that cell has changed or expired, the SGSN initiates the procedure in clause 9.2.3.7.\nFor architecture variants using S4 based interaction with S‑GW and P‑GW, the PDP contexts are handled as follows:\n-\tFor a new or inactive PDP context, no further action is required except storage in the SGSN.\n-\tFor an active PDP context, the SGSN shall in addition compare the new QoS Subscribed with bearer QoS and shall, if necessary and MS is in the READY or PMM CONNECTED State, initiate a PDP Context Modification procedure as described in clause \"Modification Procedures\". If modification is necessary, when MS is not in the READY or PMM CONNECTED State, or the modification is not successful when MS is in the READY or PMM CONNECTED State:\na)\tIf ISR is activated when the next activity from MS is detected the S4-SGSN shall compare the stored updated subscription data with the existing data for that PDP context and initiate modification procedure.\nb)\tIf ISR is not activated, the SGSN shall directly delete the concerned PDP context.\n-\tFor an MS in PMM-CONNECTED State and connected via a CSG or hybrid cell, the SGSN shall check the received CSG subscription data. If the SGSN detects that the UE's CSG membership to that cell has changed or expired, the SGSN initiates the procedure in clause 9.2.3.7.\nFurthermore, if VPLMN Address Allowed is changed, the SGSN shall, if necessary (e.g., if the PDP context is currently routed via a GGSN in the VPLMN and VPLMN Address Allowed is changed to not allowed), initiate a PDP Context Deactivation procedure as explained in clause 9.2.4.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.7",
        "clause_9.2.4",
        "figure_48",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.11.1.2",
      "section_id": "6.11.1.2",
      "section_title": "Delete Subscriber Data Procedure",
      "content": "In addition to the deletion of general subscription data for a subscriber, see TS 29.002 [23], the HLR may request the deletion of one or several PDP contexts from the SGSN.\nThe Delete Subscriber Data procedure is illustrated in Figure 49.\nFigure 49: Delete Subscriber Data Procedure\n1)\tThe HLR sends a Delete Subscriber Data (IMSI, PDP Context Identifiers List) message to the SGSN.\n2)\tThe SGSN acknowledges the Delete Subscriber Data message by returning a Delete Subscriber Data Ack (IMSI) message. For each PDP context identifier included in PDP Context Identifiers List, the SGSN shall check whether it belongs to an active or an inactive PDP context:\n-\tFor an inactive PDP context no further action is required except deletion of the PDP context.\n-\tFor an active PDP context, the SGSN shall initiate the PDP Context Deactivation Initiated by the SGSN procedure as explained in clause \"Deactivation Procedures\" before the PDP context is deleted.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_49",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.11.1.3",
      "section_id": "6.11.1.3",
      "section_title": "Insert CSG Subscriber Data Procedure",
      "content": "The CSS may request insertion of new or modification of existing CSG subscription data in the SGSN. Whenever the CSG subscription data is changed for a user in the CSS, and the changes affect the CSG subscription data stored in the SGSN, the CSS shall inform the SGSN about these changes by the means of the Insert CSG Subscriber Data procedure.\nThe CSS Subscription data is stored and managed in the SGSN independently from the CSG Subscription Data received from the HLR/HSS. The Insert CSG Subscriber Data procedure only affects the CSS Subscription data.\nThe Insert CSG Subscriber Data procedure for the CSS is illustrated in Figure 49a.\nFigure 49a: Insert CSG Subscriber Data Procedure\n1)\tThe CSS sends an Insert CSG Subscriber Data (IMSI, CSG Subscription Data) message to the SGSN.\n2)\tThe SGSN updates the stored CSG Subscription Data and acknowledges the Insert CSG Subscriber Data message by returning an Insert CSG Subscriber Data Ack (IMSI) message to the CSS. The update result should be contained in the Ack message.\nFor an MS in PMM-CONNECTED State and connected via a CSG or hybrid cell, the SGSN shall check the received CSG subscription data. If the SGSN detects that the UE's CSG membership to that cell has changed or expired, the SGSN initiates the procedure in clause 9.2.3.7.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.7",
        "figure_49"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.12.0",
      "section_id": "6.12.0",
      "section_title": "General",
      "content": "The Service Request procedure is used by a 3G‑MS in PMM‑IDLE state to request the establishment of a secure connection to a 3G‑SGSN. The MS in PMM‑IDLE state initiates this procedure in order to send uplink signalling messages (e.g. Activate PDP Context Request), user data, or as paging response, or after the MS has regained UTRAN (or Iu mode GERAN) radio coverage. This procedure is also used by an MS in PMM‑CONNECTED state to request resource reservation for active PDP contexts.\nIn the context of this specification, the terms RNC refer also to a GERAN BSC when serving an MS in Iu mode.\nTS 23.401 [89] (clause 5.3.4.3) includes the description of the network initiated Service Request procedure using S4.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401_clause_5.3.4.3",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.12.1",
      "section_id": "6.12.1",
      "section_title": "MS Initiated Service Request Procedure Using Gn/Gp",
      "content": "The MS in PMM‑IDLE state sends the Service Request message to the 3G‑SGSN in order to establish the PS signalling connection for the upper layer signalling or for the resource reservation for active PDP context(s). After receiving the Service Request message, the 3G‑SGSN may perform authentication, and it shall perform the security mode procedure. After the establishment of the secure PS signalling connection to a 3G‑SGSN, the MS may send signalling messages, e.g. Activate PDP Context Request, to the 3G‑SGSN, or the 3G‑SGSN may start the resource reservation for the active PDP contexts depending on the requested service in the Service Request message. An MS in PMM‑CONNECTED state also requests the resource reservation for the active PDP contexts through this procedure. An MS in PMM CONNECTED state also requests the resource reservation for preserved active PDP contexts that need to transfer data but have not been allocated resources in a previous Service Request.\nFigure 50: MS Initiated Service Request Procedure using Gn/Gp\nNOTE 1:\tAll steps in Figure 50 and 50a, except steps 6, 7 and 8, are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 6.12.1A.\n1)\tThe MS establishes an RRC connection, if none exists for CS traffic.\nThe MS shall signal a cause that indicates emergency when it requests an RRC connection for PS emergency services, as defined in TS 25.331 [52].\n2)\tThe MS sends a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies the requested service. Service Type shall indicate one of the following: Data or Signalling. When the Service Type indicates Data, the UE may also include PDP context activity information to indicate which PDP contexts need to transfer data. At this point, the SGSN may perform the authentication procedure.\nIf Service Type indicates Data, a signalling connection is established between the MS and the SGSN, and resources for active PDP context(s) are allocated, i.e. RAB establishment for the activated PDP context(s).\nIf Service Type indicates Signalling, the signalling connection is established between the MS and the SGSN for sending upper-layer signalling messages, e.g. Activate PDP Context Request. The resources for active PDP context(s) are not allocated.\nCSG ID is provided if the MS sends the Service Request message via a CSG cell or hybrid cell. CSG access mode is provided if the MS sends the Service Request message via a hybrid cell. If the CSG access mode is not provided but the CSG ID is provided, the SGSN shall consider the cell as a CSG cell.\nIf a CSG ID is indicated and CSG access mode is \"closed\" or CSG access mode is not provided, and there is no subscription data for this CSG ID and associated PLMN or the CSG subscription is expired, the SGSN rejects the Service Request with an appropriate cause. The UE shall remove the CSG ID and associated PLMN of the cell where the UE has initiated the service request procedure from the Allowed CSG list, if present.\nFor MSs with emergency PDP contexts, i.e. at least one PDP Context has an ARP value reserved for emergency services, and if CSG access restrictions do not allow the MS to get normal services, the SGSN shall deactivate all non-emergency PDP contexts and accept the Service Request.\nIf LIPA is active for a PDP context and if the cell accessed by the MS does not link to the L-GW where the MS initiated the LIPA PDP context, the SGSN shall not request the establishment of the bearers of the LIPA PDP context from the RNC in step 4 and shall disconnect the LIPA PDP context by means of the SGSN-initiated PDP Context Deactivation Procedure according to clause 9.2.4.2.\n3)\tThe SGSN shall perform the security functions if the MS in PMM-IDLE state initiated the service request.\n4)\tIf the network is in PMM-CONNECTED state and the Service Type indicates Data, the SGSN shall respond with a Service Accept message towards the MS, in case the service request can be accepted. In case Service Type indicates Data, the SGSN sends a Radio Access Bearer Assignment Request (NSAPIRAB ID(s), TEID(s), QoS Profile(s), SGSN IP Address(es), UE-AMBR, CSG Membership Indication, MSISDN, APN, Charging characteristics) message to re-establish radio access bearers for PDP contexts which do not have maximum bit rates for uplink and downlink of 0 kbit/s. If Direct Tunnel is established the SGSN provides to the RNC the GGSN's User Plane Address(es) and TEID(s) for uplink data instead of the SGSN's IP Address(es) and TEID(s). The SGSN may in addition use PDP context activity information provided by the UE in the Service Request to decide which RABs to set up. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps. For RABs belonging to a PDP context/PDN connection for Local IP Access or SIPTO at the Local Network with L-GW function collocated with the HNB, the RAB Assignment Request message includes a Correlation ID for enabling the direct user plane path between the HNB and the L‑GW. For RABs belonging to a PDP context/PDN connection for SIPTO at the Local Network with L-GW function collocated with the HNB, the RAB Assignment Request message includes a SIPTO Correlation ID for enabling the direct user plane path between the HNB and the L-GW.\nNOTE 1:\tIn this release of the 3GPP specification the Correlation ID and SIPTO Correlation ID is set equal to the user plane GGSN TEID that the Gn-SGSN has received in step 4 of clause 9.2.2.1 or the user plane PDN GW TEID that the S4-SGSN has received from the PDN GW.\nNOTE 2:\tWhen using Gn-SGSN, the direct user plane path between the HNB and the L‑GW is enabled with the direct tunnel functionality described in clause 15.6.\nIf the Service Request is performed via a hybrid cell, the CSG Membership Indication indicating whether the UE is a CSG member shall be included. Based on this information, the RAN can perform differentiated treatment for CSG and non-CSG members.\nIf the MS is not allowed to access the cell where the MS initiated the service request due to CSG access restriction, the SGSN shall only request to establish radio access bearers for Emergency PDP contexts.\n5)\tThe RNC indicates to the MS the new Radio Bearer Identity established and the corresponding RAB ID with the RRC radio bearer setup procedure.\n6)\tSRNC responds with the Radio Access Bearer Assignment Response (RAB ID(s), TEID(s), QoS Profile(s), RNC IP Address(es)) message. The GTP tunnel(s) are established on the Iu interface.\n7)\tIf the RNC returns a Radio Access Bearer Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, e.g. \"Requested Maximum Bit Rate not Available\", the SGSN may send a new Radio Access Bearer Assignment Request message with different QoS profile(s). The number of re-attempts, if any, as well as how the new QoS profile(s) values are determined is implementation dependent. For each RAB re-established with a modified QoS profile, the SGSN initiates a PDP Context Modification procedure to inform the MS and the GGSN of the new negotiated QoS profile for the corresponding PDP context. If the SGSN established Direct Tunnel in step 4) it shall initiate a PDP Context Modification procedure to the GGSN and provide to the GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8. If the internal flag Pending Network Initiated PDN Connection Signalling is set, the SGSN indicates MS available for end to end signalling in the PDP Context Modification procedure to the GGSN and reset the flag.\nIf SIPTO at the local network is active for a PDP context and for stand alone GW case, the Local Home Network ID is not the same as where the UE initiated the SIPTO at the local network PDN Connection, the SGSN shall request disconnection of the SIPTO at the Local network PDN connection(s) with the \"reactivation requested\" cause value according to clause 9.2.4.2.\nIf SIPTO at the local network is active for a PDP context and collocated L-GW case, the L-GW CN address of the cell accessed by the UE differs from the L-GW CN address of the cell where the UE initiated the SIPTO at the Local Network PDN Connection, the SGSN shall request disconnection of the SIPTO at the Local network PDN connection(s) with the \"reactivation requested\" cause value according to clause 9.2.4.2.\n8)\tThe MS sends the uplink packet.\nFor Service Type = Signalling, the MS knows that the Service Request message was successfully received in the SGSN when the MS receives the RRC Security Mode Control Command message.\nFor Service Type = Data, in PMM-IDLE, the MS knows that the Service Request was successfully received when the MS receives the RRC Security Mode Control Command message from the RNC; in PMM-CONNECTED state, the MS knows that the Service Request was successfully received when the MS receives the Service Accept message.\nNOTE 2:\tThe reception of the Service Accept message does not imply the successful re-establishment of the RAB(s).\nFor any Service Type, in case the service request cannot be accepted, the network returns a Service Reject message to the MS with an appropriate cause value.\nFor Service Type = Data, in case the SGSN fails to re-establish RAB(s) for the PDP context(s), the SGSN determines if an SM procedure, such as SGSN-Initiated PDP Context Modification or PDP Context Deactivation, should be initiated. The appropriate action depends on the QoS profile of the PDP context and is an operator choice.\nFor each PDP context using streaming or conversational traffic class with maximum bit rate for uplink and downlink of 0 kbit/s the MS starts the MS-Initiated PDP Context Modification procedure or the MS-Initiated PDP Context Deactivation procedure to inform the SGSN whether to re-activate or to delete the PDP contexts. If the PDP context has been deactivated locally in the MS, the MS shall not perform the PDP context deactivation procedure for this PDP context because the list of active and inactive PDP contexts is included in the Service Request Message sent prior to the network.\n6.12.1A\tUE Initiated Service Request Procedure Using S4\nThe procedures described in figure 50a shows only the steps, which are different from the Gn/Gp variant of the procedure described in clause 6.12.1. due to the use of S4.\nFigure 50a: UE Initiated Service Request Procedure using S4\nNOTE 1:\tAll steps in figures 50a and 51a, are common for UE and Network initiated procedure using S4. For a PMIP-based S5/S8, procedure steps (B1) are defined in TS 23.402 [90].\nA) If the RNC returns a Radio Access Bearer Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, e.g. \"Requested Maximum Bit Rate not Available\", the SGSN does not send any new Radio Access Bearer Assignment Request message with different QoS profile(s), the RAB is not established. For each established RABs, the SGSN sends Modify Bearer Request messages to the Serving GW (Downlink S4/S12 TEID). If the S‑GW receives a DL packet for an unaccepted bearer, the S‑GW drops the DL packet and does not send a Downlink Data Notification to the MME. For the established RABs, if the SGSN established Direct Tunnel it includes the RNC's Address for User Plane TEID for downlink data and DTI. If Direct Tunnel is not used, the SGSN includes SGSN Address for User Plane and TEID for downlink data. The Serving GW is now able to transmit downlink data towards the UE. If there is no Direct Tunnel the SGSN sends downlink packet. If the internal flag Pending Network Initiated PDN Connection Signalling is set, the SGSN indicates MS available for end to end signalling in the PDP Context Modification procedure to the GGSN and reset the flag.\nIf any EPS bearers are to be released the SGSN triggers the bearer release procedure as specified in clause 9.2.4.2.\nB)\tIf the RAT Type has changed compared to the last reported RAT Type and/or the indication MS available for end to end signalling is present, the Serving GW shall send the Modify Bearer Request message (RAT Type) to the PDN GW. The PDN GW sends the Modify Bearer Response to the Serving GW. The indication MS available for end to end signalling is also included if the indication was present in step A.\nNOTE 2:\tPCC interactions between the PDN GW and the PCRF are documented in TS 23.401 [89]\nC)\tThe Serving GW acknowledges by sending Modify Bearer Response (SGW address for user plane and uplink S4 GTP-U TEID) to the SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.12.1",
        "clause_9.2.4.2",
        "clause_9.2.2.1",
        "clause_15.6",
        "clause_13.8",
        "figure_50",
        "ts_25.331",
        "ts_23.402",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.12.2",
      "section_id": "6.12.2",
      "section_title": "Network Initiated Service Request Procedure using Gn/Gp",
      "content": "When the 3G‑SGSN receives a downlink packet (e.g. Request PDP Context Activation, Mobile-terminated SMS, user data) for an MS in PMM‑IDLE state, the 3G‑SGSN sends a paging request to RAN. The paging request triggers the Service Request procedure in the MS.\nFigure 51: Network Initiated Service Request Procedure\nNOTE 1:\tAll steps in figure 51, except Procedure steps (A) and (B), are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW.\nNOTE 2:\tProcedure steps B (step 7) in figure 51 above are common for MS and Network initiated service request using S4 and are described in clause 6.12.1A. Procedure steps (A) are defined in clause 8.2.4.1A when S4 is used.\nIf a LIPA or SIPTO at the local network with L-GW function collocated with the HNB PDP context exists, when the L-GW receives the downlink data for an MS in PMM-IDLE state, the L‑GW sends the first downlink user packet to the SGSN and buffers all other downlink user packets. When S4 is used, the L-GW sends the first downlink user packet to Serving GW and the Serving GW will trigger the SGSN to page the UE.\n1)\tThe SGSN receives a downlink PDP PDU for an MS in PMM‑IDLE state.\nA Gn/Gp-SGSN that detects that the MS is in a power saving state (e.g. Power Saving Mode or extended idle mode DRX) and cannot be reached by paging at the moment, shall invoke extended buffering depending on operator configuration, except for cases described in next paragraphs. The Gn/Gp-SGSN derives the expected time before radio bearers can be established to the MS (Iu case) or the MS can be reached (Gb case) and uses this as the buffer time. The Gn/Gp-SGSN stores the buffer time as a new value for the DL Data Buffer Expiration Time in the MM context for the MS and skips the remaining steps of this procedure. The DL Data Buffer Expiration Time is used for MSs using power saving state and indicates that there are buffered data in the Gn/Gp-SGSN and that the user plane setup procedure is needed when the MS makes signalling with the network.\nThe SGSN may use additional information based on a SLA with the MTC user for when to invoke extended buffering, e.g. only invoke it for a certain APN, do not invoke it for certain subscribers, etc.\n2)\tThe SGSN sends a Paging message to the RNC. The RNC pages the MS by sending a Paging message to the MS. See clause \"Paging Initiated by CN\" for details.\n3)\tThe MS establishes an RRC connection if none exists for CS traffic.\n4)\tThe MS sends a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies Paging Response. The Service Request is carried over the radio in an RRC Direct Transfer message and over the Iu interface in the RANAP Initial MS message. At this point, the SGSN may perform the authentication procedure. The SGSN knows whether the downlink packet requires RAB establishment (e.g. downlink PDU) or not (e.g. Request PDP Context Activation or Mobile-terminated SMS).\nCSG ID is provided if the MS attaches via a CSG cell or hybrid cell. CSG access mode is provided if the MS sends the Service Request message via a hybrid cell. If the CSG access mode is not provided but the CSG ID is provided, the SGSN shall consider the cell as a CSG cell.\nIf a CSG ID is indicated and CSG access mode is \"closed\" or CSG access mode is not provided, and there is no subscription data for this CSG ID and associated PLMN or the CSG subscription is expired, the SGSN rejects the Service Request with an appropriate cause. The MS shall remove the CSG ID and associated PLMN of the cell where the MS has initiated the service request procedure from the Allowed CSG list, if present.\nFor MSs with emergency PDP contexts, i.e. at least one PDP Context has an ARP value reserved for emergency services, and if CSG access restrictions do not allow the MS to get normal services, the SGSN shall deactivate all non-emergency PDP contexts and accept the Service Request.\n5)\tThe SGSN shall perform the security mode procedure.\n6)\tIf resources for the PDP contexts are re-established, the SGSN sends a Radio Access Bearer Assignment Request (RAB ID(s), TEID(s), QoS Profile(s), SGSN IP Address(es), UE-AMBR, CSG Membership Indication, MSISDN, APN, Charging characteristics) message to the RNC. If Direct Tunnel is established the SGSN provides to the RNC the GGSN's User Plane Address and TEID for uplink data. The RNC sends a Radio Bearer Setup (RAB ID(s)) to the MS. The MS responds by returning a Radio Bearer Setup Complete message to the RNC. The RNC sends a Radio Access Bearer Assignment Response (RAB ID(s), TEID(s), RNC IP Address(es)) message to the SGSN in order to indicate that GTP tunnels are established on the Iu interface and radio access bearers are established between the RNC and the MS. If the RNC returns a Radio Access Bearer Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, e.g. \"Requested Maximum Bit Rate not Available\", the SGSN may send a new Radio Access Bearer Assignment Request message with different QoS profile(s). The number of re-attempts, if any, as well as how the new QoS profile(s) values are determined is implementation dependent. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps. For RABs belonging to a PDP context/PDN connection for Local IP Access or SIPTO at the Local Network with L-GW function collocated with the HNB, the RAB Assignment Request message includes a Correlation ID for enabling the direct user plane path between the HNB and the L-GW. For RABs belonging to a PDP context/PDN connection for SIPTO at the Local Network with L-GW function collocated with the HNB, the RAB Assignment Request message includes a SIPTO Correlation ID for enabling the direct user plane path between the HNB and the L-GW.\nIf the Service Request is performed via a hybrid cell, the CSG Membership Indication indicating whether the UE is a CSG member shall be included. Based on this information the RAN can perform differentiated treatment for CSG and non-CSG members.\nIf the MS is not allowed to access the cell where the MS initiated the service request due to CSG access restriction, the SGSN shall only request to establish radio access bearers for Emergency PDP contexts.\nNOTE 3:\tIn this Release of the 3GPP specification the Correlation ID and SIPTO Correlation ID is set equal to the user plane GGSN TEID that the Gn-SGSN has received in step 4 of clause 9.2.2.1 or the user plane PDN GW TEID that the S4‑SGSN has received from the PDN GW.\n7)\tFor each RAB re-established with a modified QoS profile, the SGSN initiates a PDP Context Modification procedure to inform the MS and the GGSN of the new negotiated QoS profile for the corresponding PDP context. If SGSN established Direct Tunnel in step 6) it shall initiate a PDP Context Update procedure to the GGSN and provide to the GGSN the RNC's Address for User Plane and TEID for Downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling procedure as described in clause 13.8.\n8)\tThe SGSN sends the downlink packet. For a LIPA or SIPTO at the Local Network with L-GW function collocated with the HNB PDP context, after the MS enters connected mode, the packets buffered in the L-GW are forwarded to the HNB on the direct path. If the MS enters connected mode at a different cell than the one where the L-GW is collocated, for LIPA PDP context the SGSN shall deactivate the LIPA PDP context as defined in clause 6.12.1, step 2, for SIPTO at the Local network with L-GW function collocated with the HNB the SGSN shall trigger the L-GW reallocation as defined in clause 6.12.1 step 7.\nFor Service Type = Page Response, the MS knows that the Service Request message was successfully received in the SGSN when the MS receives the RRC Security Mode Control Command message.\nIf the SGSN fails to re-establish RAB(s) for the PDP context(s), the SGSN determines if an SM procedure, such as SGSN-Initiated PDP Context Modification or PDP Context Deactivation, should be initiated. The appropriate action depends on the QoS profile of the PDP context and is an operator choice.\n6.12.2A\tVoid",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.12.1",
        "clause_8.2.4.1",
        "clause_9.2.2.1",
        "clause_13.8",
        "figure_51"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13",
      "section_id": "6.13",
      "section_title": "Intersystem Change",
      "content": "An intersystem change takes place when an MS changes between Iu mode and A/Gb mode of operation by the Routeing Area Update procedure or by PS handover. A prerequisite for an intersystem change is that the MS is GPRS-attached. The transition of the mobility management states is as specified for the corresponding mobility management procedures.\nThere is no transition of the session management states at an intersystem change.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.13.1",
      "section_id": "6.13.1",
      "section_title": "Intra SGSN Intersystem Change",
      "content": "An SGSN that supports both the Gb and Iu‑PS interfaces may support an intra-SGSN intersystem change if the radio access technology nodes serving the MS before and after the intersystem change are both served by this SGSN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.13.1.1.1",
      "section_id": "6.13.1.1.1",
      "section_title": "Iu mode to A/Gb mode Intra SGSN Change using Gn/Gp",
      "content": "The intersystem change from Iu mode to A/Gb mode takes place when an MS changes from UTRAN or GERAN Iu mode to A/Gb mode. Depending on the PMM state before the intersystem change and whether the RA is changed or not, one of the following procedures is initiated by the MS:\n-\tWhen an MS in PMM‑IDLE state changes to the A/Gb mode without changing the RA, the MS shall follow the selective RA update procedures, see clause \"Selective RA Update\".\n-\tWhen an MS in PMM‑IDLE state changes to the A/Gb mode and the RA changes, the MS shall initiate the GPRS RA update procedure, see clause \"Intra SGSN Routeing Area Update\".\n-\tWhen an MS in PMM‑CONNECTED state changes to the A/Gb mode, the MS shall initiate the GPRS RA update procedure independent of whether the RA has changed or not. The RA update procedure is either combined RA / LA update or only RA update.\nA combined RA / LA update takes place in network operation mode I when the MS enters a new RA or when a GPRS-attached MS performs IMSI attach. The MS sends a Routeing Area Update Request message indicating that an LA update may also need to be performed, in which case the SGSN forwards the LA update to the VLR. This concerns only idle mode (see TS 23.122 [7b]), as no combined RA / LA updates are performed during a CS connection. In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nFigure 52: Iu mode to A/Gb mode Intra SGSN Change\nNOTE:\tAll steps in figure 52 are common for architecture variants using Gn/Gp based interaction with a GGSN and using S4 based interactions with an S‑GW and P‑GW. For S4 based interaction with an S‑GW and P‑GW, procedure step (A) is defined in clause 6.13.1.1.2.\n1)\tThe MS or RAN decides to perform an intersystem change which makes the MS switch to a new cell where A/Gb mode has to be used, and stops transmission to the network.\n2)\tThe MS sends a Routeing Area Update Request (old RAI, old P‑TMSI Signature, Update Type, Voice domain preference and UE's usage setting) message to the 2G+3G‑SGSN. Update Type shall indicate RA update or combined RA / LA-update or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attached requested. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the 2G+3G‑SGSN. The UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nIf there is an ongoing emergency bearer service and a Routing Area Update Request is received the Routing Area Update shall be rejected with a cause code indicating that access to GERAN is not allowed.\n3)\tIf the MS is PMM‑CONNECTED state, the 2G+3G‑SGSN sends an SRNS Context Request (IMSI) message to the SRNS.\nUpon reception of the SRNS Context Request message, the SRNS starts buffering and stops sending downlink PDUs to the MS. The SRNS responds with an SRNS Context Response (GTP‑SNDs, GTP‑SNUs, PDCP-SNDs, PDCP‑SNUs) message. The GTP sequence numbers are included for each PDP context indicating the next in-sequence downlink GTP-PDU to be sent to the MS and the next in-sequence GTP PDU to be tunnelled to the GGSN. For each active PDP context, which uses lossless PDCP, the SRNS also includes the uplink PDCP sequence number (PDCP‑SNU) and the downlink PDCP sequence number (PDCP-SND). PDCP‑SNU is the PDCP sequence number for the next expected in-sequence uplink packet to be received from the MS. PDCP-SND is the PDCP sequence number for the first downlink packet for which successful transmission has not been confirmed. The 2G+3G‑SGSN shall strip off the eight most significant bits of the passed PDCP sequence numbers, thus converting them to SNDCP N‑PDU numbers of the respective 2G GPRS PDP contexts.\n5)\tSecurity functions may be executed.\n6)\tIf the MS is PMM‑CONNECTED, the 2G+3G‑SGSN sends an SRNS Data Forward Command (RAB ID, Transport Layer Address, Iu Transport Association) message to the SRNS. This informs the SRNS that the 2G+3G‑SGSN is ready to receive data packets. Upon reception of SRNS Data Forward Command message from the 2G+3G‑SGSN the SRNS shall start the data-forwarding timer.\n6a)\tIf Direct Tunnel was established in Iu mode the SGSN sends Update PDP Context Request to the GGSN(s) concerned to establish the GTP tunnel between SGSN and GGSN. The GGSN(s) update the address for User Plane and downlink TEID for data and return an Update PDP Context Response. Otherwise, if there were changes of for example the RAT type that e.g. can be used for charging, the SGSN sends Update PDP Context Request (SGSN Address and TEID, QoS Negotiated, RAT type) message to the GGSN.\n7)\tFor each RAB indicated by the SRNS Data Forward Command the SRNS starts duplicating and tunnelling the buffered GTP-PDUs back to the 2G+3G‑SGSN. For each radio bearer which uses lossless PDCP the GTP-PDUs related to transmitted but not yet acknowledged PDCP‑PDUs are duplicated and tunnelled back to the 2G+3G‑SGSN together with their related downlink PDCP sequence numbers. The 2G+3G‑SGSN converts the PDCP sequence numbers to SNDCP sequence number (by stripping off the eight most significant bits of the PDCP sequence numbers).\n8)\tThe 2G+3G‑SGSN sends an Iu Release Command message to the SRNS. When the RNC data-forwarding timer has expired, the SRNS responds with an Iu Release Complete message.\n9)\tIf the association has to be established i.e. if Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, then the 2G+3G‑SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The VLR creates or updates the association with the 2G+3G‑SGSN by storing the SGSN Number.\n10)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the data in the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\n11)\tThe new VLR allocates a new VLR TMSI and responds with Location Update Accept (VLR TMSI) to the 2G+3G‑SGSN. VLR TMSI is optional if the VLR has not changed.\n12)\tThe 2G+3G‑SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the 2G+3G‑SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the 2G+3G‑SGSN updates MM and PDP contexts for the MS. A new P‑TMSI may be allocated. A logical link is established between the new 2G+3G‑SGSN and the MS. 2G+3G-SGSN initiates the establishment procedure. A Routeing Area Update Accept (P‑TMSI, P‑TMSI Signature, Receive N‑PDU Number (= converted PDCP‑SNU), IMS voice over PS Session Supported Indication) message is returned to the MS. Receive N‑PDU Number contains the acknowledgements for each NSAPI which used lossless PDCP before the start of the update procedure, thereby confirming all mobile-originated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms the reception of N‑PDUs, these N‑PDUs shall be discarded by the MS. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\n13)\tThe MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete (Receive N‑PDU Number) message to the SGSN. Receive N‑PDU Number (= converted PDCP‑SND) contains the acknowledgements for each NSAPI which used lossless PDCP before the start of the update procedure, thereby confirming all mobile-terminated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms the reception of N‑PDUs, these N‑PDUs shall be discarded by the 2G+3G-SGSN.The MS deducts Receive N‑PDU Number from PDCP‑SND by stripping off the eight most significant bits. PDCP‑SND is the PDCP sequence number for the next expected in-sequence downlink packet to be received in the MS per radio bearer, which used lossless PDCP. The new 2G-SGSN negotiates with the MS for each NSAPI the use of acknowledged or unacknowledged SNDCP regardless whether the SRNS used lossless PDCP or not.\n14)\tThe 2G+3G‑SGSN sends a TMSI Reallocation Complete message to the VLR if the MS confirms the VLR TMSI.\n15)\tThe 2G+3G‑SGSN and the BSS may execute the BSS Packet Flow Context procedure.\nFor some network sharing scenario (e.g. GWCN) if the PLMN-ID of the RAI supplied by the RNC is different from that of the RAI in the UE's context, then the SGSN shall informs the HLR.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Routeing_Area_Update_Session, CAMEL_PS_Notification and CAMEL_GPRS_Routeing_Area_Update_Context.\n-\tThe procedure CAMEL_GPRS_Routeing_Area_Update_Session is called once per session. In Figure 52, the procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_PS_Notification is called once per session. The procedure returns as result \"Continue\".\n-\tThen, the procedure CAMEL_GPRS_Routeing_Area_Update_Context is called once per PDP context. In Figure 52, the procedure returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13.1.1.2",
        "clause_5.3.15",
        "clause_5.3.8",
        "figure_52",
        "ts_23.122",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.1.1.2",
      "section_id": "6.13.1.1.2",
      "section_title": "Iu mode to A/Gb mode Intra SGSN Change using S4",
      "content": "In this case, clause 6.13.1.1.1 applies except for steps 6a and 7, as well as section specific general statements stated below.\nFigure 52-2: step 6a for Iu mode to A/Gb mode Intra SGSN Change using S4\nNOTE: Steps a) and d) are common for architecture variants with GTP-based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps b) and c) in Figure 52-2 concern GTP-based S5/S8.\na)\tIn this procedure flow the Serving GW is not relocated. If Direct Tunnel was established in Iu mode or if there were changes of for example the RAT type that e.g. can be used for charging, the SGSN sends Modify Bearer Request (SGSN Address and TEID, serving network identity, CN Operator Selection Entity, RAT type) message to the Serving GW.\nb)\tThe Serving GW informs the P‑GW(s) about the change of for example the RAT type that e.g. can be used for charging, by sending the message Modify Bearer Request (Serving GW Address and TEID, RAT type) to the concerned P‑GW(s). If dynamic PCC is deployed, and RAT type information needs to be conveyed from the P‑GW to the PCRF, then the P‑GW sends RAT type information to the PCRF as defined in TS 23.203 [88].\nc)\tEach P‑GW updates its context field and returns a Modify Bearer Response (MSISDN, P‑GW address and TEID) message to the Serving GW. MSISDN is included if available in the stored UE context.\nd)\tThe Serving GW updates the address for User Plane and downlink TEID for data and return a Modify Bearer Response (Serving GW address and TEID, P‑GW address and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic) message.\ne)\tIn case Direct Tunnel in Iu mode was not established, for each RAB indicated by the SRNS Data Forward Command the SRNS starts duplicating and tunnelling the buffered GTP-PDUs back to the 2G+3G SGSN. For each radio bearer which uses lossless PDCP the GTP-PDUs related to transmitted but not yet acknowledged PDCP PDUs are duplicated and tunnelled back to the 2G+3G SGSN together with their related downlink PDCP sequence numbers. The 2G+3G SGSN converts the PDCP sequence numbers to SNDCP sequence number (by stripping off the eight most significant bits of the PDCP sequence numbers).\nIn case Direct Tunnel in Iu mode was established, the packets are forwarded via the S‑GW.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13.1.1.1",
        "figure_52-2",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.1.2.1",
      "section_id": "6.13.1.2.1",
      "section_title": "A/Gb mode to Iu mode Intra-SGSN Change using Gn/Gp",
      "content": "The intersystem change from A/Gb mode to Iu mode takes place when a GPRS-attached MS changes from A/Gb mode to GERAN or UTRAN Iu mode. Depending on the GPRS mobility management state before the intersystem change and whether the RA is changed or not, one of the following procedures is initiated by the MS:\n-\tWhen an MS in STANDBY state changes to Iu mode inside the current RA, the MS shall follow the selective RA update procedures, see clause \"Selective RA Update\".\n-\tWhen an MS in STANDBY state changes to Iu mode and the RA changes, the MS shall initiate the Iu mode RA update procedure, see clause \"Routeing Area Update Procedure\".\n-\tWhen an MS in READY state changes to Iu mode independent of whether the RA has changed or not, the MS shall initiate the Iu mode RA update procedure and afterwards initiate the RABs by the Service Request procedure, see clause \"MS Initiated Service Request Procedure\". The RA update procedure is either combined RA / LA update or only RA update.\nIf the network operates in mode I, an MS that is both PS-attached and CS-attached shall perform the Combined RA / LA Update procedure. This concerns only idle mode (see TS 23.122 [7b]), as no combined RA / LA updates are performed during a CS connection. In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nFigure 53: A/Gb mode to Iu mode Intra SGSN Change\n1)\tThe MS or the RAN decides to perform an intersystem change which makes the MS switch to a new cell where Iu mode has to be used, and stops transmission to the network.\n2)\tThe MS initiates an RRC connection establishment and sends a Routeing Area Update Request (P‑TMSI, Old RA, Old P‑TMSI Signature, Update Type, CM, Voice domain preference and UE's usage setting) message to the combined 2G+3G‑SGSN. Update Type shall indicate RA update or combined RA / LA update or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attach requested and also if the MS has a follow on request, i.e. if there is pending uplink traffic (signalling or data). The SGSN may use, as an implementation option, the follow-on request indication to release or keep the Iu connection after the completion of the RA update procedure. The SRNS shall add an identifier of the area where the message was received before passing the message to the 2G+3G‑SGSN. The 2G+3G‑SGSN stops transmission of N‑PDUs to the MS. The UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\n3)\tSecurity functions may be executed.\n4)\tIf the association has to be established i.e. if Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the 2G+3G‑SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The VLR creates or updates the association with the 2G+3G‑SGSN by storing SGSN Number. In networks that support network sharing, the Location Update Request includes the identity of the selected core network operator if the SGSN has received this information from the RNS, as described in TS 23.251 [83].\n5)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the data in the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\n6)\tThe new VLR allocates a new VLR TMSI and responds with Location Update Accept (VLR TMSI) to the 2G+3G‑SGSN. VLR TMSI is optional if the VLR has not changed.\n7)\tThe 2G+3G‑SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the 2G+3G‑SGSN rejects the routeing area update with an appropriate cause. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the routeing area update. If all checks are successful, the 2G+3G‑SGSN updates MM and PDP contexts for the MS. A new P‑TMSI may be allocated. A Routeing Area Update Accept (P‑TMSI, P‑TMSI Signature, IMS voice over PS Session Supported Indication, Emergency Service Support) message is returned to the MS. The 2G+3G-SGSN derives for this intersystem change the corresponding PDCP sequence numbers from the N‑PDU sequence numbers stored in the SGSN PDP contexts by adding eight most significant bits \"1\". These PDCP sequence numbers are stored in the SGSN PDP contexts. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nThe Emergency Service Support indicator shall be included when going to UTRAN to inform the MS that Emergency PDP contexts are supported, i.e. the MS is allowed to request activation of emergency PDP context when needed.\n8)\tThe MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete message to the SGSN.\n9)\tThe 2G+3G‑SGSN sends a TMSI Reallocation Complete message to the VLR if the MS confirms the VLR TMSI.\n10)\tIf the MS has pending uplink data or signalling, it shall send a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies the requested service. Service Type shall indicate one of the following: Data or Signalling.\n11)\tThe 2G+3G‑SGSN requests the SRNS to establish a radio access bearer by sending a RAB Assignment Request (RAB ID(s), QoS Profile(s), GTP‑SNDs, GTP‑SNUs, PDCP‑SNUs, UE-AMBR, MSISDN, APN, Charging characteristics) message to the SRNS. If Direct Tunnel is established the SGSN provides to the RNC the GGSN's Address for User Plane and TEID for uplink data. The PDCP sequence numbers are derived from the N‑PDU sequence numbers and stored in the PDP contexts in step 7). The SRNS sends a Radio Bearer Setup Request (PDCP‑SNUs) message to the MS. The MS responds with a Radio Bearer Setup Complete (PDCP‑SNDs) message. The SRNS responds with a RAB Assignment Response message. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\nNOTE:\tThe NSAPI value is carried in the RAB ID IE.\n11a)\tIf the SGSN established Direct Tunnel it shall send Update PDP Context Request to the GGSN(s) concerned and include the RNC's Address for User Plane, downlink TEID for data and DTI to instruct the GGSN(s) to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) update the Address for User Plane and TEID for downlink data and return an Update PDP Context Response. Otherwise, if there were changes of for example the RAT type that e.g. can be used for charging, the SGSN sends Update PDP Context Request (SGSN Address and TEID, QoS Negotiated, RAT type) message to the GGSN.\n12)\tTraffic flow is resumed between the 2G+3G‑SGSN and the SRNS. N-PDUs that were already sent to the MS in acknowledged mode SNDCP and that are not yet acknowledged by the MS are tunnelled by the 2G+3G‑SGSN to the SRNS together with their related N-PDU number (SNDCP sequence number). No PDCP sequence numbers shall be indicated for these N-PDUs. The SRNS shall discard all N‑PDUs with N‑PDU sequence numbers older than the eight least significant bits of PDCP-SND received from the MS. Other N‑PDUs shall be transmitted to the MS. The MS shall discard all N‑PDUs with sequence numbers older than the eight least significant bits of the PDCP‑SNU received from the SRNS. All other N‑PDUs shall be transmitted to the SRNS. The SRNS negotiates with the MS for each radio bearer the use of lossless PDCP or not regardless whether the old 2G-SGSN used acknowledged or unacknowledged SNDCP for the related NSAPI or not.\n13)\tThe traffic flow is resumed between the SRNS and the MS.\nFor some network sharing scenario (e.g. GWCN) if the PLMN-ID of the RAI supplied by the RNC is different from that of the RAI in the UE's context, then the SGSN shall informs the HLR.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Routeing_Area_Update_Session, CAMEL_PS_Notification and CAMEL_GPRS_Routeing_Area_Update_Context.\n-\tThe procedure CAMEL_GPRS_Routeing_Area_Update_Session is called once relative to the session. In Figure 53, the procedure returns as result \"Continue\".\n-\tThen the procedures CAMEL_PS_Notification is called once relative to the session. The procedure returns as result \"Continue\".\n-\tThen the procedure CAMEL_GPRS_Routeing_Area_Update_Context is called once per PDP context. In Figure 53, the procedure returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "clause_5.3.8",
        "clause_13.8",
        "figure_53",
        "ts_23.122",
        "ts_23.251",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.1.2.2",
      "section_id": "6.13.1.2.2",
      "section_title": "A/Gb mode to Iu mode Intra-SGSN Change using S4",
      "content": "In this case, clause 6.13.1.2.1 applies except for step 11, as well as clause-specific general statements stated below.\nFigure 53-2: step 11 for A/Gb mode to Iu mode Intra-SGSN Change using S4\nNOTE:\tSteps a) and d) are common for architecture variants with GTP-based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps b) and c) in Figure 53-2 concern GTP-based S5/S8.\na)\tIf the SGSN established Direct Tunnel it shall send Modify Bearer Request (RNC Address and TEID, serving network identity, CN Operator Selection Entity, RAT type) message to the Serving GW and include the RNC's Address for User Plane, downlink TEID for data and DTI to instruct the Serving GW to apply Direct Tunnel specific error handling as described in clause 13.8. Otherwise, if there were changes of for example the RAT type that e.g. can be used for charging, the SGSN shall send Modify Bearer Request (SGSN Address and TEID, serving network identity, CN Operator Selection Entity, RAT type) message to the Serving GW and include the SGSN's Address for User Plane, downlink TEID for data.\nb)\tThe Serving GW informs the P‑GW(s) about the change of for example the RAT type that e.g. can be used for charging, by sending the message Modify Bearer Request (Serving GW Address and TEID, RAT type) to the concerned P‑GW(s). If dynamic PCC is deployed, and RAT type information needs to be conveyed from the P‑GW to the PCRF, then the P‑GW sends RAT type information to the PCRF as defined in TS 23.203 [88].\nc)\tEach P‑GW updates its context field and returns a Modify Bearer Response (MSISDN, P‑GW address and TEID) message to the Serving GW. MSISDN is included if available in the stored UE context.\nd)\tThe Serving GW updates the Address for User Plane and TEID for downlink data and return a Modify Bearer Response (Serving GW address and TEID, P‑GW address and TEIDs (for GTP-based S5/S8) or GRE keys (for PMIP-based S5/S8) at the PDN GW(s) for uplink traffic) message.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13.1.2.1",
        "clause_13.8",
        "figure_53-2",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.1.3",
      "section_id": "6.13.1.3",
      "section_title": "Selective RA Update",
      "content": "The MS shall use the following procedures when in STANDBY or PMM‑IDLE state.\nNote that upon expiry of the periodic RA update timer, the MS shall carry out the periodic routeing area update procedure.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.13.1.3.1",
      "section_id": "6.13.1.3.1",
      "section_title": "Uplink Signalling or Data Transmission",
      "content": "In STANDBY or PMM‑IDLE state the MS shall not perform an RA update procedure until uplink data or signalling information is to be sent from the MS.\nIf the MS is in the same mode (A/Gb mode or Iu mode) as when it last sent data or signalling, the procedures defined for that mode shall be followed. This shall be the sending of an LLC PDU in A/Gb mode, or for example sending of a Service Request message in Iu mode.\nIf the MS is in a different mode (A/Gb mode or Iu mode) as when it last sent data or signalling, the RA update procedure shall be performed before the sending of data or signalling. The RA update procedure needs not be performed if the signalling message is a power-off detach.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.13.1.3.2",
      "section_id": "6.13.1.3.2",
      "section_title": "Downlink Signalling or Data Transmission",
      "content": "If the SGSN receives data for an MS in STANDBY or PMM‑IDLE state or, if the SGSN uses S4 and receives a Downlink Data Notification from the S‑GW, the SGSN shall page in the RA where the MS is located. This may include both A/Gb mode and Iu mode cells.\nIf the MS receives this page in the same mode (A/Gb mode or Iu mode)as when it last sent data or signalling, the procedures defined for that mode shall be followed. This shall be the sending of an LLC PDU in a cell where the MS has to use A/Gb mode or, for example, sending of a Service Request message in a cell where the MS has to use Iu mode. When receiving such trigger from the RAN, if the S4-SGSN has no S4/S12 downlink user plane TEIDs for the UE, it sends Modify Bearer Request (S4/S12 downlink user plane TEIDs and IP address) to the S‑GW, which establishes the downlink user plane towards the S4-SGSN or S12 RNC.\nIf the MS receives this page in a different mode (A/Gb mode or Iu mode) as when it last sent data or signalling, the RA update procedure shall be performed. The SGSN shall accept this RAU as a valid response.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.13.2.1.1",
      "section_id": "6.13.2.1.1",
      "section_title": "Iu mode to A/Gb mode Inter-SGSN Change using Gn/Gp",
      "content": "An inter-SGSN inter-system change from Iu mode to A/Gb mode takes place when an MS in PMM‑IDLE or PMM‑CONNECTED state changes from UTRAN or GERAN Iu mode to A/Gb mode and the A/Gb mode radio access node serving the MS is served by a different SGSN. In this case, the RA changes. Therefore, the MS shall initiate a A/Gb mode RA update procedure. The RA update procedure is either combined RA / LA update or only RA update. These RA update cases are illustrated in Figure 54. In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nA combined RA / LA update takes place in network operation mode I when the MS enters a new RA or when a GPRS-attached MS performs IMSI attach. The MS sends a Routeing Area Update Request indicating that an LA update may also need to be performed, in which case the SGSN forwards the LA update to the VLR. This concerns only idle mode (see TS 23.122 [7b]), as no combined RA / LA updates are performed during a CS connection.\nNOTE:\tDirect Tunnel requires no additional functionality.\nFigure 54: Iu mode to A/Gb mode Inter-SGSN Change\n1)\tThe MS or RAN decides to perform an inter-system change, which makes the MS switch to a new cell where A/Gb mode has to be used, and stops transmission to the network.\n2)\tThe MS sends a Routeing Area Update Request (old RAI, old P‑TMSI Signature, Update Type, MS Network Capability, Voice domain preference and UE's usage setting) message to the new 2G‑SGSN. Update Type shall indicate RA update or combined RA / LA update, or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attach requested. The BSS shall add the Cell Global Identity including the RAC and LAC of the cell where the message was received before passing the message to the new 2G‑SGSN. The UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\nIf there is an ongoing emergency bearer service and a Routing Area Update Request is received the Routing Area Update shall be rejected with a cause code indicating that access to GERAN is not allowed.\n3)\tThe new 2G‑SGSN sends an SGSN Context Request (old RAI, TLLI, old P‑TMSI Signature, New SGSN Address) message to the old 3G‑SGSN to get the MM and PDP contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI (or TLLI) and send the SGSN Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI (or TLLI) and relay the message to that actual old SGSN. The old 3G-SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old 3G‑SGSN. If the received old P-TMSI Signature does not match the stored value, the security functions in the new 2G-SGSN should be initiated. If the security functions authenticate the MS correctly, the new 2G-SGSN shall send an SGSN Context Request (old RAI, TLLI, MS Validated, New SGSN Address) message to the old 3G-SGSN. MS Validated indicates that the new 2G-SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new 2G-SGSN indicates that it has authenticated the MS correctly, the old 3G‑SGSN starts a timer. If the MS is not known in the old 3G‑SGSN, the old 3G‑SGSN responds with an appropriate error cause.\n4)\tIf the MS is PMM‑CONNECTED the old 3G‑SGSN sends an SRNS Context Request (IMSI) message to the SRNS. Upon receipt of this message the SRNS buffers and stops sending downlink PDUs to the MS and returns an SRNS Context Response (GTP‑SNDs, GTP‑SNUs, PDCP-SNDs, PDCP‑SNUs) message. The SRNS shall include for each PDP context the next in-sequence GTP sequence number to be sent to the MS and the GTP sequence number of the next uplink PDU to be tunnelled to the GGSN. For each active PDP context, which uses lossless PDCP, the SRNS also includes the uplink PDCP sequence number (PDCP‑SNU) downlink PDCP sequence number (PDCP-SND). PDCP‑SNU shall be the next in-sequence PDCP sequence number expected from the MS. PDCP-SND is the PDCP sequence number for the first downlink packet for which successful transmission has not been confirmed. The 3G‑SGSN shall strip off the eight most significant bits of the passed PDCP sequence numbers, thus converting them to SNDCP N‑PDU numbers and stores the N-PDU numbers in its PDP contexts..\n5)\tThe old 3G‑SGSN responds with an SGSN Context Response (MM Context, PDP Contexts, Negotiated Evolved ARP) message. For each PDP context the old 3G‑SGSN shall include the GTP sequence number for the next uplink GTP PDU to be tunnelled to the GGSN and the next downlink GTP sequence number for the next in-sequence N‑PDU to be sent to the MS. Each PDP Context also includes the SNDCP Send N‑PDU Number (the value is 0) for the next in-sequence downlink N‑PDU to be sent in SNDCP acknowledged mode to the MS and the SNDCP Receive N‑PDU Number (= converted PDCP‑SNU) for the next in-sequence uplink N‑PDU to be received in SNDCP acknowledged mode from the MS. The new 3G-SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\n6)\tSecurity functions may be executed. If the SGSN Context Response message did not include IMEISV and the ADD function is supported by the new 2G-SGSN, then the IMEISV shall be retrieved from the MS.\n7)\tThe new 2G‑SGSN sends an SGSN Context Acknowledge message to the old 3G‑SGSN. This informs the old 3G‑SGSN that the new 2G‑SGSN is ready to receive data packets belonging to the activated PDP contexts. The old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a RA update procedure back to the old SGSN before completing the ongoing RA update procedure.\n8)\tIf the MS is in the PMM‑CONNECTED state, the old 3G‑SGSN sends an SRNS Data Forward Command (RAB ID, Transport Layer Address, Iu Transport Association) message to the SRNS. For each indicated RAB the SRNS starts duplicating and tunnelling the buffered GTP PDUs to the old 3G‑SGSN. For each radio bearer which uses lossless PDCP the SRNS shall start tunnelling the GTP-PDUs related to transmitted but not yet acknowledged PDCP‑PDUs to the old 3G‑SGSN together with their related downlink PDCP sequence numbers. Upon receipt of the SRNS Data Forward Command message from the 3G‑SGSN, the SRNS shall start the data-forwarding timer.\n9)\tThe old 3G‑SGSN tunnels the GTP PDUs to the new 2G‑SGSN. For GTPv1, the conversion of PDCP sequence numbers to SNDCP sequence numbers (the eight most significant bits shall be stripped off) shall be done in the new SGSN. No N-PDU sequence numbers shall be indicated for these N-PDUs.\n10)\tThe new 2G‑SGSN sends an Update PDP Context Request (new SGSN Address, TEID, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, NRSN) message to each GGSN concerned. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Context Response message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. Each GGSN updates its PDP context fields and returns an Update PDP Context Response (TEID, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\n11)\tThe new 2G‑SGSN informs the HLR of the change of SGSN by sending an Update GPRS Location (SGSN Number, SGSN Address, IMSI, IMEISV, Homogenous Support of IMS Voice over PS Sessions) message to the HLR. IMEISV is sent if the ADD function is supported. For \"Homogenous Support of IMS Voice over PS Sessions\", see clause 5.3.8A.\n12)\tThe HLR sends a Cancel Location (IMSI) message to the old 3G‑SGSN. The old 3G‑SGSN acknowledges with a Cancel Location Ack (IMSI) message. The old 3G‑SGSN removes the MM and PDP contexts if the timer described in step 3 is not running. If the timer is running, the MM and PDP contexts shall be removed when the timer expires.\n13)\tWhen the MS is PMM‑CONNECTED, the old 3G‑SGSN sends an Iu Release Command message to the SRNS. When the RNC data-forwarding timer has expired, the SRNS responds with an Iu Release Complete message.\n14)\tThe HLR sends an Insert Subscriber Data (IMSI, Subscription Data) message to the new 2G‑SGSN. The 2G‑SGSN constructs an MM context and PDP contexts for the MS and returns an Insert Subscriber Data Ack (IMSI) message to the HLR. If the S6d interface is used between S4-SGSN and HSS the messages \"Insert Subscriber Data\" and \"Insert Subscriber Data Ack\" are not used. Instead the Subscription Data is sent by HSS in the message Update Location Ack (Step 15).\n15)\tThe HLR acknowledges the Update GPRS Location by returning an Update GPRS Location Ack (IMSI, GPRS Subscriber Data (only if S6d interface is used)) message to the new 2G‑SGSN.\n16)\tIf the association has to be established i.e. if Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the new 2G‑SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The 2G‑SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 14). The VLR creates or updates the association with the 2G‑SGSN by storing SGSN Number.\n17)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\n18)\tThe new VLR allocates a new TMSI and responds with Location Update Accept (VLR TMSI) to the 2G‑SGSN. VLR TMSI is optional if the VLR has not changed.\n19)\tThe new 2G‑SGSN validates the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the new 2G‑SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the new 2G‑SGSN constructs MM and PDP contexts for the MS. A logical link is established between the new 2G‑SGSN and the MS. 2G-SGSN initiates the establishment procedure. The new 2G‑SGSN responds to the MS with a Routeing Area Update Accept (P‑TMSI, P‑TMSI Signature, Receive N‑PDU Number (= converted PDCP‑SNU), IMS voice over PS Session Supported Indication) message. Receive N‑PDU Number contains the acknowledgements for each NSAPI which used lossless PDCP before the start of the update procedure, thereby confirming all mobile-originated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms the reception of N‑PDUs, the MS shall discard these N‑PDUs. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\n20)\tThe MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete (Receive N‑PDU Number (= converted PDCP‑SND)) message to the SGSN. Receive N‑PDU Number contains the acknowledgements for each lossless PDCP used by the MS before the start of the update procedure, thereby confirming all mobile-terminated N‑PDUs successfully transferred before the start of the update procedure. If Receive N‑PDU Number confirms the reception of N‑PDUs that were forwarded from the old 3G-SGSN, the new 2G-SGSN shall discard these N‑PDUs. The MS deducts Receive N‑PDU number from PDCP‑SND by stripping off the eight most significant bits. PDCP‑SND is the PDCP sequence number for the next expected in-sequence downlink packet to be received in the MS per radio bearer, which used lossless PDCP. The new 2G-SGSN negotiates with the MS for each NSAPI the use of acknowledged or unacknowledged SNDCP regardless whether the SRNS used lossless PDCP or not.\n21)\tThe new 2G‑SGSN sends TMSI Reallocation Complete message to the new VLR if the MS confirms the VLR TMSI.\n22)\tThe 2G‑SGSN and the BSS may execute the BSS Packet Flow Context procedure.\nIf the new SGSN is unable to update the PDP context in one or more GGSN(s), the new SGSN shall deactivate the corresponding PDP contexts as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe PDP Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important PDP Context first in the SGSN Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context from the GGSN and then store the new Maximum APN restriction value.\nIf the new SGSN is unable to support the same number of active PDP contexts as received from old SGSN, the new SGSN should use the prioritisation sent by old SGSN as input when deciding which PDP contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in one or more GGSNs and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. The procedure returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context.\nThis procedure is called several times once per PDP context. It returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "clause_5.3.8",
        "figure_54",
        "ts_23.122",
        "ts_23.401",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.2.1.2",
      "section_id": "6.13.2.1.2",
      "section_title": "Iu mode to A/Gb mode Inter-SGSN Change using S4",
      "content": "In this case, clause 6.13.2.1.1 applies except for steps 3, 5, 7, 9 and 10, as well as clause-specific general statements stated below.\nFigure 54-2: steps 3, 5, 7, 9 for Iu mode to A/Gb mode Inter-SGSN Change using S4\nSteps 3, 5 and 7 are identical to the Gn/Gp case in clause 6.13.2.2.1, except that:\n-\tMessage SGSN Context Request is replaced by message Context Request;\n-\tParameter PDP Contexts is replaced by parameter EPS Bearer Contexts.\nMM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2. For RAU between two S4-SGSNs, the old SGSN shall include the APN Restriction, CGI/SAI/RAI change support indication and Change Reporting Action in the Context Response message.\n9)\tIn case Direct Tunnel in Iu mode was not established, the old 3G SGSN tunnels the GTP PDUs to the new 2G‑SGSN. For GTPv2 or GTPv1 user plane, the conversion of PDCP sequence numbers to SNDCP sequence numbers (the eight most significant bits shall be stripped off) shall be done in the new SGSN. No N‑PDU sequence numbers shall be indicated for these N‑PDUs.\nIn case Direct Tunnel in Iu mode was established, the packets are forwarded via the S‑GW.\n10)\tBox (B)\nFigure 54-3: step 10 for Iu mode to A/Gb mode Inter-SGSN Change using S4\nNOTE:\tSteps a) and d) are common for architecture variants with GTP-based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps b) and c) in Figure 54-3 concern GTP-based S5/S8.\na)\tThe new 2G‑SGSN sends a Modify Bearer Request (new SGSN Address, TEID, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication) message to the Serving GW. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the Serving GW.\nb)\tThe Serving GW informs the P‑GW(s) about the change of Serving GW Address and TEID, as well as about RAT type that e.g. can be used for charging, by sending the message Modify Bearer Request (Serving GW Address and TEID, RAT type) to the concerned P‑GW(s). If dynamic PCC is deployed, and RAT type information needs to be conveyed from the P‑GW to the PCRF, then the P‑GW shall send RAT type information to the PCRF as defined in TS 23.203 [88].\nc)\tEach P‑GW updates its context fields and returns a Modify Bearer Response (MSISDN, P‑GW address and TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) message. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context. MSISDN is included if available in the stored UE context.\nd)\tThe Serving GW updates the Address for User Plane and TEID for downlink data and return a Modify Bearer Response (Serving GW address and TEID, P‑GW address and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, CSG Information Reporting Action) message.\nIf the new SGSN is unable to update the Bearer context in the S‑GW or in one or more P‑GW(s), the new SGSN shall deactivate the corresponding Bearer contexts as described in clause \"SGSN‑initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe Bearer Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important Bearer Context first in the Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each Bearer context from the P‑GW(s) or old S4-SGSN and then store the new Maximum APN restriction value.\nThe bearer contexts shall be prioritized by the new SGSN. If the new SGSN is unable to support the same number of active Bearer contexts as received from old SGSN, the new SGSN should use the prioritisation when deciding which Bearer contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in the S‑GW and in one or more P‑GW(s) and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN‑initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13.2.1.1",
        "clause_6.13.2.2.1",
        "clause_13.2.2",
        "figure_54-2",
        "figure_54-3",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.2.2.1",
      "section_id": "6.13.2.2.1",
      "section_title": "A/Gb mode to Iu mode Inter-SGSN Change using Gn/Gp",
      "content": "The inter-system change from A/Gb mode to Iu mode takes place when a GPRS-attached MS changes from A/Gb mode to UTRAN or GERAN Iu mode and the new RAN node serving the MS is served by a different SGSN. In this case the RA changes. Therefore, the MS shall initiate a Iu mode RA update procedure by establishing an RRC connection and initiating the RA update procedure. The RA update procedure is either combined RA / LA update or only RA update, these RA update cases are illustrated in Figure 55. In the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nIf the network operates in mode I, then an MS, that is both PS-attached and CS-attached, shall perform the Combined RA / LA Update procedures. This concerns only idle mode (see TS 23.122 [7b]), as no combined RA / LA updates are performed during a CS connection.\nFigure 55: A/Gb mode to Iu mode Inter SGSN Change\n1)\tThe MS or RAN decides to perform an inter-system change, which makes the MS switch to a new cell where Iu mode has to be used, and stops transmission to the network.\n2)\tThe MS sends a Routeing Area Update Request (P‑TMSI, old RAI, old P‑TMSI Signature, Update Type, CM, MS Network Capability, Voice domain preference and UE's usage setting) message to the new 3G‑SGSN. Update Type shall indicate RA update or combined RA / LA update, or, if the MS wants to perform an IMSI attach, combined RA / LA update with IMSI attach requested, and also if the MS has a follow-on request, i.e. if there is pending uplink traffic (signalling or data). The SGSN may use, as an implementation option, the follow-on request indication to release or keep the Iu connection after the completion of the RA update procedure. The SRNC shall add the Routeing Area Identity before forwarding the message to the 3G‑SGSN. This RA identity corresponds to the RAI in the MM system information sent by the SRNC to the MS. The UE sets the voice domain preference and UE's usage setting according to its configuration, as described in clause 5.3.15.\n3)\tThe new 3G‑SGSN uses the old RAI received from the MS to derive the old 2G‑SGSN address, and sends an SGSN Context Request (old RAI, old P‑TMSI, New SGSN Address) message to the old 2G‑SGSN to get the MM and PDP contexts for the MS. If the new SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the new SGSN may derive the old SGSN from the old RAI and the old P-TMSI and send the SGSN Context Request message to this old SGSN. Otherwise, the new SGSN derives the old SGSN from the old RAI. In any case the new SGSN will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the P-TMSI and relay the message to that actual old SGSN. The old 2G-SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old 2G‑SGSN. If the received old P-TMSI Signature does not match the stored value, the old 2G-SGSN should initiate the security functions in the new 3G-SGSN. If the security functions authenticate the MS correctly, the new 3G-SGSN shall send an SGSN Context Request (old RAI, IMSI, MS Validated, New SGSN Address) message to the old 2G-SGSN. MS Validated indicates that the new 3G-SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new 3G-SGSN indicates that it has authenticated the MS correctly, the old 2G‑SGSN starts a timer and stops the transmission of N‑PDUs to the MS.\n4)\tThe old 2G‑SGSN responds with an SGSN Context Response (MM Context, PDP Contexts, Negotiated Evolved ARP) message. Each PDP Context includes the GTP sequence number for the next downlink N‑PDU to be sent to the MS and the GTP sequence number for the next uplink N‑PDU to be tunnelled to the GGSN. Each PDP Context also includes the SNDCP Send N‑PDU Number for the next downlink N‑PDU to be sent in acknowledged mode SNDCP to the MS and the SNDCP Receive N‑PDU Number for the next uplink N‑PDU to be received in acknowledged mode SNDCP from the MS. The new 3G-SGSN derives the corresponding PDCP sequence numbers from these N‑PDU sequence numbers by adding eight most significant bits \"1\". These PDCP sequence numbers are stored in the 3G-SGSN PDP contexts. The new 3G-SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\n5)\tSecurity functions may be executed. If the SGSN Context Response message did not include IMEISV and the ADD function is supported by the new 3G-SGSN, then the IMEISV shall be retrieved from the MS.\n6)\tThe new 3G‑SGSN sends an SGSN Context Acknowledge message to the old 2G‑SGSN. This informs the old 2G‑SGSN that the new 3G‑SGSN is ready to receive data packets belonging to the activated PDP contexts. The old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure.\n7)\tThe old 2G‑SGSN duplicates the buffered N‑PDUs and starts tunnelling them to the new 3G‑SGSN. Additional N‑PDUs received from the GGSN before the timer described in step 3 expires are also duplicated and tunnelled to the new 3G‑SGSN. N-PDUs that were already sent to the MS in acknowledged mode SNDCP and that are not yet acknowledged by the MS are tunnelled together with their related SNDCP N-PDU sequence number. No PDCP sequence numbers shall be indicated for these N-PDUs. No N‑PDUs shall be forwarded to the new 3G‑SGSN after expiry of the timer described in step 3.\n8)\tThe new 3G‑SGSN sends an Update PDP Context Request (new SGSN Address, TEID, QoS Negotiated, Negotiated Evolved ARP, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication, NRSN) message to each GGSN concerned. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. NRSN indicates SGSN support of the network requested bearer control. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. If the new SGSN did not receive a Negotiated Evolved ARP IE in the SGSN Context Response message from the old SGSN then the new SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E of TS 23.401 [89]. Each GGSN updates its PDP context fields and returns an Update PDP Context Response (TEID, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, Negotiated Evolved ARP) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN.\n9)\tThe new 3G‑SGSN informs the HLR of the change of SGSN by sending an Update GPRS Location (SGSN Number, SGSN Address, IMSI, IMEISV, Homogenous Support of IMS Voice over PS Sessions) message to the HLR. IMEISV is sent if the ADD function is supported. For \"Homogenous Support of IMS Voice over PS Sessions\", see clause 5.3.8A.\n10)\tThe HLR sends a Cancel Location (IMSI, Cancellation Type) message to the old 2G‑SGSN. The old 2G‑SGSN removes the MM and PDP contexts if the timer described in step 3 is not running. If the timer is running, the MM and PDP contexts are removed when the timer expires. The old 2G‑SGSN acknowledges with a Cancel Location Ack (IMSI) message.\n11)\tThe HLR sends an Insert Subscriber Data (IMSI, Subscription Data) message to the new 3G‑SGSN. The 3G‑SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI) message to the HLR. If the S6d interface is used between S4-SGSN and HSS the messages \"Insert Subscriber Data\" and \"Insert Subscriber Data Ack\" are not used. Instead the Subscription Data is sent by HSS in the message Update Location Ack (Step 15).\n12)\tThe HLR acknowledges the Update GPRS Location by returning an Update GPRS Location Ack (IMSI, GPRS Subscriber Data (only if S6d interface is used)) message to the new 3G‑SGSN.\n13)\tIf the association has to be established, if Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the new SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with IMSI attach requested. Otherwise, Location Update Type shall indicate normal location update. When the SGSN does not provide functionality for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the VLR number is derived from the RAI. When the SGSN provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN uses the RAI and a hash value from the IMSI to determine the VLR number. The 3G‑SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 12). The VLR creates or updates the association with the 3G‑SGSN by storing SGSN Number. In networks that support network sharing, the Location Update Request includes the identity of the selected core network operator if the new 3G-SGSN has received this information from the RNS, as described in TS 23.251 [83].\n14)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the old VLR and inserts subscriber data in the new VLR:\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\n15)\tThe new VLR allocates a new TMSI and responds with Location Update Accept (VLR TMSI) to the 3G‑SGSN. VLR TMSI is optional if the VLR has not changed.\n16)\tThe new 3G‑SGSN validate the MS's presence in the new RA. If due to roaming restrictions or access restrictions the MS is not allowed to be attached in the RA, or if subscription checking fails, the new 3G‑SGSN rejects the routeing area update with an appropriate cause. If the network supports the MOCN configuration for network sharing, the SGSN may, if the MS is not a 'Network Sharing Supporting MS', in this case decide to initiate redirection by sending a Reroute Command to the RNS, as described in TS 23.251 [83] instead of rejecting the routeing area update. If all checks are successful, the new 3G‑SGSN constructs MM and PDP contexts for the MS. The new 3G‑SGSN responds to the MS with a Routeing Area Update Accept (P‑TMSI, P‑TMSI signature, IMS voice over PS Session Supported Indication, Emergency Service Support) message. The IMS voice over PS Session Supported Indication is set as described in clause 5.3.8.\nThe Emergency Service Support indicator shall be included when going to UTRAN to inform the MS that Emergency PDP contexts are supported, i.e. the MS is allowed to request activation of emergency PDP context when needed.\nIf after step 8 the new SGSN receives a Downlink Data Notification message or any other downlink signalling message while the MS is still connected, the new SGSN may prolong the PS signalling connection with the MS.\n17)\tThe MS acknowledges the new P‑TMSI by returning a Routeing Area Update Complete message to the SGSN.\n18)\tThe new 3G‑SGSN sends TMSI Reallocation Complete message to the new VLR, if the MS confirms the VLR TMSI.\n19)\tIf the MS has uplink data or signalling pending it shall send a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies the requested service. Service Type shall indicate one of the following: Data or Signalling.\n20)\tIf the MS has sent the Service Request, the new 3G‑SGSN requests the SRNS to establish a radio access bearer by sending a RAB Assignment Request (RAB ID(s), QoS Profile(s), GTP‑SNDs, GTP‑SNUs, PDCP‑SNUs, UE-AMBR, MSISDN, APN, Charging characteristics) message to the SRNS. If Direct Tunnel is established the SGSN provides to the RNC the GGSN's Address for User Plane and TEID for uplink data. The PDCP sequence numbers are derived from the N‑PDU sequence numbers in step 4) and stored in the SGSN PDP contexts. The SRNS sends a Radio Bearer Setup Request (PDCP‑SNUs) message to the MS. The MS responds with a Radio Bearer Setup Complete (PDCP‑SNDs) message. The MS deducts PDCP-SND from its Receive N‑PDU Number by adding eight most significant bits \"1\". The SRNS responds with a RAB Assignment Response message. The SRNS shall discard all N‑PDUs tunnelled from the SGSN with N‑PDU sequence numbers older than the eight least significant bits of the PDCP‑SNDs received from the MS. Other N‑PDUs shall be transmitted to the MS. The MS shall discard all N‑PDUs with SNDCP sequence numbers older than the eight least significant bits of the PDCP‑SNUs received from the SRNS. Other N‑PDUs shall be transmitted to the SRNS. The SRNS negotiates with the MS for each radio bearer the use of lossless PDCP or not regardless whether the old 2G-SGSN used acknowledged or unacknowledged SNDCP for the related NSAPI or not. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\n20a)\tIf the SGSN established Direct Tunnel in step 20) it shall send Update PDP Context Request to the GGSN(s) concerned and include the RNC's Address for User Plane, downlink TEID for data and DTI to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) update the Address for User Plane and TEID for downlink data and return an Update PDP Context Response.\nNOTE 1:\tThe NSAPI value is carried in the RAB ID IE.\nNOTE 2:\tThe new SGSN may initiate RAB establishment after execution of the security functions (step 5), or wait until completion of the RA update procedure. For the MS, RAB establishment may occur anytime after the RA update request is sent (step 2).\nIf the new SGSN is unable to update the PDP context in one or more GGSNs, the new SGSN shall deactivate the corresponding PDP contexts as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe PDP Contexts shall be sent from old to new SGSN in a prioritized order, i.e. the most important PDP Context first in the SGSN Context Response message. (The prioritization method is implementation dependent, but should be based on the current activity).\nThe new SGSN shall determine the Maximum APN restriction based on the received APN Restriction of each PDP context from the GGSN and then store the new Maximum APN restriction value.\nIf the new SGSN is unable to support the same number of active PDP contexts as received from old SGSN, the new SGSN should use the prioritisation sent by old SGSN as input when deciding which PDP contexts to maintain active and which ones to delete. In any case, the new SGSN shall first update all contexts in one or more GGSNs and then deactivate the context(s) that it cannot maintain as described in clause \"SGSN-initiated PDP Context Deactivation Procedure\". This shall not cause the SGSN to reject the routeing area update.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection, CAMEL_GPRS_Detach and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_PDP_Context_Disconnection procedure is called several times: once per PDP context. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_GPRS_Detach procedure is called once. It returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called once. It returns as result \"Continue\".\nC2)\tCAMEL_GPRS_Routeing_Area_Update_Session and CAMEL_PS_Notification.\nThey are called in the following order:\n-\tThe CAMEL_GPRS_Routeing_Area_Update_Session procedure is called. The procedure returns as result \"Continue\".\n-\tThen the CAMEL_PS_Notification procedure is called. The procedure returns as result \"Continue\".\nC3)\tCAMEL_GPRS_Routeing_Area_Update_Context\nThis procedure is called several times: once per PDP context. It returns as result \"Continue\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.15",
        "clause_5.3.8",
        "clause_13.8",
        "figure_55",
        "ts_23.122",
        "ts_23.401",
        "ts_23.251",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.13.2.2.2",
      "section_id": "6.13.2.2.2",
      "section_title": "A/Gb mode to Iu mode Inter-SGSN Change using S4",
      "content": "In this case, clause 6.13.2.2.1 applies except for steps 3, 4, 6, 7, 8 and 20, as well as clause-specific general statements stated below.\nFigure 55-2: steps 3, 4, 6, 7 for A/Gb mode to Iu mode Inter-SGSN Change using S4\nSteps 3, 4, 6 and 7 are identical to the Gn/Gp case in clause 6.13.2.2.1, except that:\n-\tMessage SGSN Context Request is replaced by message Context Request;\n-\tParameter PDP Contexts is replaced by parameter EPS Bearer Contexts.\n-\tMM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2. For RAU between two S4-SGSNs, the old SGSN shall include the APN Restriction, CGI/SAI/RAI change support indication and Change Reporting Action in the Context Response message.\n8.\tBox (B).\nFigure 55-3: step 8 for A/Gb mode to Iu mode Inter-SGSN Change using S4\nNOTE:\tSteps a) and d) are common for architecture variants with GTP-based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps b) and c) in Figure 55-3 concern GTP-based S5/S8.\na)\tThe new 3G SGSN sends a Modify Bearer Request (new SGSN Address, TEID, serving network identity, CN Operator Selection Entity, CGI/SAI, User CSG Information, RAT type, MS Info Change Reporting support indication) message to the Serving GW. The SGSN shall send the serving network identity and the CN Operator Selection Entity to the Serving GW.\nb)\tThe Serving GW informs the P‑GW(s) about the change of Serving GW Address and TEID, as well as about the RAT type that e.g. can be used for charging, by sending the message Modify Bearer Request (Serving GW Address and TEID, RAT type) to the concerned P‑GW(s). If dynamic PCC is deployed, and RAT type information needs to be conveyed from the P‑GW to the PCRF, then the P‑GW shall send RAT type information to the PCRF as defined in TS 23.203 [88].\nc)\tEach P‑GW updates its context fields and returns a Modify Bearer Response (MSISDN, P‑GW address and TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) message. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context. MSISDN is included if available in the stored UE context.\nd)\tThe Serving GW updates the Address for User Plane and TEID for downlink data and return a Modify Bearer Response (Serving GW address and TEID, P‑GW address and TEIDs (for GTP‑based S5/S8) or GRE keys (for PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, CSG Information Reporting Action) message.\n20.\tBox (C).\nFigure 55-4: step 10 for A/Gb mode to Iu mode Inter-SGSN Change using S4\nStep 10 is identical to the Gn/Gp case in clause 6.13.2.2.1, except that:\n-\tMessage SGSN Context Request is replaced by message Context Request;\n-\tParameter PDP Contexts is replaced by parameter EPS Bearer Contexts.\nMM Context and EPS Bearer Context when used at the S16 interface are defined by clause 13.2.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13.2.2.1",
        "clause_13.2.2",
        "figure_55-2",
        "figure_55-3",
        "figure_55-4",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.14",
      "section_id": "6.14",
      "section_title": "Classmark Handling",
      "content": "To support efficient radio interface usage in GPRS, the MS Classmark is handled differently for SGSN-based services than for MSC-based services. In particular, the Classmark information is sent in MM and Iu mode RRC messages to the network and stored in the network as long as the MS is attached, avoiding redundant Classmark retransmissions over the radio interface. This is sometimes called the \"idle-mode Classmark\" principle.\nIn order to allow introduction of new radio access technologies in the future, the MS Classmark is split into distinct and independent information sets, the radio access Classmark, and the core network capability. The radio access Classmark is split into two information elements, the MS radio access capability (A/Gb mode) and the UE capability (Iu mode). The core network capability is split into two distinct information elements, the MS network capability IE (which shall be common for A/Gb mode and Iu mode) and for E-UTRAN capable MSs, the UE Network Capability IE.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.14.1",
      "section_id": "6.14.1",
      "section_title": "Radio Access Classmark",
      "content": "The MS shall send the MS radio access capability in the GPRS Attach Request message to the SGSN regardless, if the MS is about to attach to A/Gb mode or to Iu mode network, as defined in TS 24.008 [13]. Both the MS radio access capability and the MS network capability contain some information on the UE's support for other RATs. The SGSN uses the information from the MS network capability, and knowledge about the support of Inter-RAT Handover, to request the MS to send information on the MS's other radio capabilities in the Attach Complete/RA Update Complete.\nIf the MS supports SRVCC to GERAN (TS 23.216 [101]), the MS sends the CS domain's Classmark 2 and Classmark 3 information elements to the SGSN in the Attach Request/Routeing Area Update Request messages in both Iu mode and A/Gb mode.\nIf the MS supports SRVCC to UTRAN (TS 23.216 [101]), the MS sends the CS domain's Classmark 2 information element to the SGSN in the Attach Request/Routeing Area Update Request messages in both Iu mode and A/Gb mode.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.008",
        "ts_23.216"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.14.1.1",
      "section_id": "6.14.1.1",
      "section_title": "MS Radio Access Capability (A/Gb mode)",
      "content": "The MS radio access capability information element contains the A/Gb mode radio capabilities of the MS (e.g. multislot capability, power class), and more generally all the information that should be known by the BSS in order to handle radio resources for that MS with GERAN. The UTRAN Inter RAT handover information that can be sent in the Attach Complete/RA Update Complete contains the information that the BSS needs for inter-RAT handover to other RATs.\nThe MS radio access capability is a container for a multiplicity of radio access technology-dependent information, i.e. within the MS radio access capability there are independent sub-fields for various technologies such as GSM 900 and GSM 1800. The coding shall allow a BSS to extract only the sub-fields relevant to it without interpreting the other sub‑fields. This ensures that the MS radio access capability does not need to be interpreted by the NSS, and the full MS radio access capability is always sent by the MS to the SGSN, and thereafter provided to the BSS irrespective of the actual BSS capabilities.\nThe SGSN shall provide the MS radio access capability as an information element on the Gb interface. It is the responsibility of the SGSN to provide the BSS with the most recent MS radio access capability received from the MS. The MS radio access capability information element can be included in a downlink transfer request, or be sent in a specific message that updates the MS radio access capability information in the BSS. The BSS may at any time request the MS radio access capability for a given MS to be transmitted from the SGSN to the BSS.\nTogether with the MS radio access capability, the SGSN shall provide the IMSI of the MS when this is known. For a BSS supporting DTM, the IMSI is stored at the BSS and used for radio resource co-ordination; e.g. for a DTM MS.\nA specific optimisation allows the BSS to receive a reduced MS radio access capability at initial access directly from the MS. This enables the BSS not to wait for the full MS radio access capability to be provided by the SGSN, and is therefore quicker for the initial MS-originated transmission. The reduced MS radio access capability can be carried in several RR messages depending on the access method, e.g. in the initial random access message, or in the first uplink radio block. Details are provided in TS 24.008 [13] and TS 44.060 [77].\nIf stored, the SGSN shall provide the Inter RAT handover information and MS Classmark 2 and MS Classmark 3 as information elements on the Gb interface when a Packet Flow Context is established. MS Classmark 2 and 3 are included to support the case that a SRVCC handover is needed following PS domain handover from GERAN to UTRAN/E-UTRAN.\nWhen the MS performs a Routeing Area Update (e.g. at GERAN-UTRAN change with change of RA in idle mode, and, GERAN-UTRAN Handover) the MS radio access capability shall be sent to the SGSN in the Routeing Area Update Request message. The SGSN then provides the BSS with the MS radio access capability.\nAt inter-RAT Handover, the source, target and all other RATs' MS/UE radio capability (except the UE E-UTRA capability) are exchanged within the container information elements. To support subsequent connections, an A/Gb mode SGSN supporting inter-RAT handover requests the MS to send the Inter RAT handover information in the RA Update Complete message.\nTo allow for the addition of future radio technologies, frequency bands, and other enhancements, the SGSN shall store the Inter RAT handover information even if it is larger than specified in TS 24.008 [13], up to a maximum size of 255 octets.\nTo allow for the addition of future radio technologies, frequency bands, and other enhancements, the SGSN shall store the MS radio access capability even if it is larger than specified in TS 24.008 [13], up to a maximum size of 255 octets.\nNOTE:\tThe 255 octet value comes from the information element encoding rules described in TS 24.007 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.008",
        "ts_44.060",
        "ts_24.007"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.14.1.2",
      "section_id": "6.14.1.2",
      "section_title": "UE Capability (Iu mode)",
      "content": "The UE capability information element contains all the radio capabilities of the MS (power control, code resource, UE mode, ciphering, PDCP capabilities, etc.) that the RNC has to know in order to handle radio resources for this MS.\nThe MS sends the UE capability information element to the serving RNC upon RRC connection establishment, and the RNC stores it. This is done before the Attach Request or Routeing Area Update Request message is sent.\nAt SRNC relocation the source RNC sends the UE capability transparently through the core network to the target RNC. If the RNC has not received the UE capability information it can request the MS to send the information.\nAt inter-system change the UE capability is transferred from the MS to the serving RNC on RRC connection establishment before the Routeing Area Update Request message is sent.\nDetails are provided in TS 25.331 [52] and TS 25.413 [56b].\nThe SGSN may also request for Voice Support Match Indicator. If requested, the RAN shall then derive and provide an indication to the SGSN whether the UE capabilities are compatible with the network configuration as defined in clause 6.9.5.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.9.5",
        "ts_25.331",
        "ts_25.413"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.14.2",
      "section_id": "6.14.2",
      "section_title": "Core Network Capability",
      "content": "The MS network capability IE contains mostly non radio-related capabilities (e.g. the GSM GPRS ciphering, UMTS authentication, and TI extension capabilities) related to GERAN and UTRAN access. In the coding of the information element certain capabilities may be grouped together in a single indicator.\nThe UE network capability IE mostly contains information related to the MS's E-UTRAN core network capabilities.\nThe SGSN stores the MS network capability and UE network capability, which is used both by the local SGSN and for transfer to the new SGSN/MME for any type of inter SGSN/inter-RAT mobility. To avoid interoperability problems when roaming between A/Gb mode and Iu mode, the MS network capability shall be included in the routeing area update request sent by the MS. At inter-SGSN RA update, the network shall use this MS Network Capability and ignore the same IE received in MM Context from the old SGSN/old MME.\nIf the MS's MS network capability and/or UE network capability information changes (including cases of being in E-UTRAN coverage and having ISR activated), the UE shall perform a Routeing Area Update ('type' different to 'periodic') when it next returns to GERAN/UTRAN coverage.\nTo allow for the addition of future features, the SGSN shall store the UE Network Capability and the MS Network Capability even if either or both is larger than specified in TS 24.008 [13]/TS 24.301 [102], up to a maximum size of 32 octets for each IE.\nAn E-UTRAN capable MS notifies the SGSN of its E-UTRAN capability using the MS Network Capability.\nNOTE:\tThe MS Network Capability can contain information relating to the MS's non-E‑UTRAN EPS capabilities.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.008",
        "ts_24.301"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.14.3",
      "section_id": "6.14.3",
      "section_title": "Gb Coverage Class Information",
      "content": "The aim of this procedure is to assist the GERAN in optimising the radio paging and the radio resource assignment procedure.\nThe BSS sends the Gb Coverage Class Information to the SGSN within a BSSGP PDU when reported by the MS. When the MS needs to be paged, the SGSN shall provide the most recently received Gb Coverage Class Information to the BSS as part of the BSSGP Paging Request message. Additionally, the associated cell identity that was indicated in the BSSGP PDU carrying that Gb Coverage Class Information, i.e. the cell identity for which the Coverage Class is reported by the MS, shall also be included. The BSS may use this information to enhance the paging towards the MS.\nFurthermore, while in READY state the MS can be in packet idle mode requiring a radio resource assignment when new downlink BSSGP PDU arrives at the BSS. To ensure a successful radio resource assignment using the required coverage enhancement on the radio interface, the most recently received Gb Coverage Class and the associated cell identity for which that Gb Coverage Class was provided to the SGSN shall be included in all downlink BSSGP PDUs.\nNOTE:\tGiven that the Gb Coverage Class Information is dependent on the radio coverage it is not transferred between CN nodes.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_6.15",
      "section_id": "6.15",
      "section_title": "UE Reachability procedures",
      "content": "There are two procedures necessary for any service related entity that would need to be notified on the reachability of the UE at NAS level:\n-\tUE Reachability Notification Request procedure, and\n-\tUE Activity Notification procedure.\nThe UE Reachability Notification Request procedure is illustrated in Figure 6.15‑1.\nFigure 6.15-1: UE Reachability Notification Request Procedure\n1)\tIf a service-related entity requests the HSS to provide an indication regarding UE reachability, the HSS stores the request in the URRP-SGSN parameter. If the value of URRP-SGSN parameter has changed from \"not set\" to \"set\", the HSS sends a UE-REACHABILITY-NOTIFICATION-REQUEST (URRP-SGSN) to the SGSN. If the SGSN has an MM context for that user, the SGSN stores URRP-SGSN to indicate the need to report to the HSS information regarding changes in UE reachability, e.g. when the next NAS activity with that UE is detected.\nThe UE Activity Notification procedure is illustrated in Figure 6.15‑2.\nFigure 6.15-2: UE Activity Procedure\n1)\tThe SGSN receives an indication regarding UE reachability, e.g. an Routeing Area Update Request message from the UE.\n2)\tIf the SGSN contains an MM context of the UE and if URRP-SGSN for that UE is configured to report once that the UE is reachable, the SGSN shall send a UE-Activity-Notification (IMSI, UE-Reachable) message to the HSS and clears the corresponding URRP-SGSN for that UE.\n3)\tWhen the HSS receives the UE-Activity-Notification (IMSI, UE-Reachable) message or the Update Location message for an UE that has URRP-SGSN set, it triggers appropriate notifications to the entities that have subscribed to the HSS for this notification.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.15",
        "figure_6.15-1",
        "figure_6.15-2"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.16",
      "section_id": "6.16",
      "section_title": "Update CSG Location Procedure",
      "content": "The Update CSG Location procedure takes place when the SGSN/VLR needs to retrieve the CSG subscription information of the MS from the CSS.\nFigure 6.16-1: Update CSG Location Procedure\n1.\tThe SGSN/VLR sends an Update CSG Location Request (SGSN/VLR Number, IMSI, MSISDN) to the CSS. The MSISDN is included if available.\n2.\tThe CSS acknowledges the Update CSG Location message by sending an Update CSG Location Ack (IMSI, CSG Subscription data) message to the SGSN/VLR.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.16-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.17",
      "section_id": "6.17",
      "section_title": "APN information retrieval procedure",
      "content": "This procedure is used by the RCAF to retrieve the APNs of the active PDN connections of the UEs served by a specific (congested) UTRAN cell. The RCAF leverages this information to determine the PCRFs serving these UEs and subsequently report RAN user-plane congestion information (RUCI) to the PCRFs.\nNOTE 1:\tThe details of congestion reporting to the PCRF are specified in TS 23.203 [88].\nThe RCAF determines the SGSNs that are serving the congested UTRAN cell based on the Routing Area Identities served by the congested UTRAN cell. For further details on the related DNS procedure see TS 29.303 [100]. The following steps are applied for all SGSNs serving the congested UTRAN cell.\nNOTE 2:\tIn network sharing scenarios the RCAF belongs to the RAN operator. In this case it is up to inter-operator agreements and operator configuration which sharing partner's SGSNs the RCAF queries APN information from.\nFigure 6.17-1: APN information retrieval procedure\n1.\tThe RCAF sends an APN information request to the SGSN. The request shall include the IMSIs for which the RCAF wants to retrieve APN information.\n2.\tThe SGSN sends the APN information response to the RCAF. The response shall contain the the list of APNs of the active PDN connections of each IMSI.\nNOTE 3:\tIn order for RCAF to maintain the APN information for UEs in a congested cell, the RCAF needs to regularly receive APN information updates from the SGSN. The details of whether the RCAF needs to query the SGSN regularly or whether the SGSN updates the RCAF regularly without further explicit requests from the RCAF is defined in Stage 3.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.17-1",
        "ts_23.203",
        "ts_29.303"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.18.1",
      "section_id": "6.18.1",
      "section_title": "NAS Message Redirection Procedure",
      "content": "This procedure is described in the clause 5.19.1 of TS 23.401 [89].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.401_clause_5.19.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.18.2",
      "section_id": "6.18.2",
      "section_title": "Attach and RAU procedure for Dedicated Core Network",
      "content": "When DCNs are used, modification to the Attach and RAU procedures described in the clause 5.19.2 of TS 23.401 [89] apply to the procedures described in the following clauses of this specification:\n-\t6.5.3\tCombined GPRS / IMSI Attach procedure\n-\t6.9.1.2.2\tInter SGSN Routeing Area Update\n-\t6.9.1.2.2a\tInter SGSN Routeing Area Update and Combined Inter SGSN RA / LA Update using S4\n-\t6.9.1.3.2\tCombined Inter SGSN RA / LA Update\n-\t6.9.2.1\tRouteing Area Update Procedure\n-\t6.13.1.1.1\tIu mode to A/Gb mode Intra SGSN Change using Gn/Gp\n-\t6.13.1.1.2\tIu mode to A/Gb mode Intra SGSN Change using S4\n-\t6.13.2.1.1\tIu mode to A/Gb mode Inter-SGSN Change using Gn/Gp\n-\t6.13.2.1.2\tIu mode to A/Gb mode Inter-SGSN Change using S4\n-\t6.13.2.2.1\tA/Gb mode to Iu mode Inter-SGSN Change using Gn/Gp\n-\t6.13.2.2.2\tA/Gb mode to Iu mode Inter-SGSN Change using S4\n6.18.2a\tImpacts to Relocation Procedures\nWhen DCNs are used, the impacts to the relocation procedures are captured as below.\n-\tForward Relocation Request message: When SGSN changes during relocation, in the step where Forward Relocation Request message is sent from the Source SGSN to Target SGSN, the source SGSN also includes the UE Usage Type, if available, in the message. This change applies to the following clauses and step:\n-\t6.9.2.2.1\tServing RNS Relocation Procedure: Step 3\n-\t6.9.2.2.2\tCombined Hard Handover and SRNS Relocation Procedure: Step 3\n-\t6.9.2.2.3\tCombined Cell / URA Update and SRNS Relocation Procedure: Step 3\n-\tSelection of new SGW: In the step, subsequent to the Forward Relocation Request message, in which the target S4-SGSN determines if the Serving GW is to be relocated, if the target S4-SGSN supports DCN, the target S4-SGWN also determines if the existing Serving GW supports the DCN for the UE based on UE Usage Type of the UE, locally configured operator's policies as well as UE related context information available at the target network, e.g. information about roaming. This applies to the following clauses and step:\n-\t6.9.2.2.1a\tServing RNS Relocation Procedure, Combined Hard Handover and SRNS Relocation Procedure, and Combined Cell / URA Update and SRNS Relocation Procedure Using S4: Step 1\n-\tRelocation from service area where DCN is not used to an area where DCN is supported: When relocation occurs from a service area where DCN is not used to a service area where DCN is supported, the target SGSN obtains the UE usage type information from the HSS during the subsequent RAU procedure. If the target SGSN determines that the Serving GW does not support the UE Usage Type, the target SGSN triggers the Serving GW relocation as part of the handover procedures described in clause 6.9.2. If the target SGSN does not serve the UE Usage type, the relocation procedure should complete successfully and then the target SGSN may use the procedure in TS 23.401 [89] clause 5.19.3 Step 5 onwards, to change the serving DCN of the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.401_clause_5.19.2",
        "clause_6.9.2",
        "ts_23.401_clause_5.19.3",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_6.18.3",
      "section_id": "6.18.3",
      "section_title": "SGSN or HSS initiated Dedicated Core Network Reselection",
      "content": "The HSS initiated core network reselection for DCNs is described in the clause 5.19.3 of TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_5.19.3",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_7",
      "section_id": "7",
      "section_title": "Network Management Functionality",
      "content": "The Network Management function provides mechanisms to support O&M functions related to GPRS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_8.1.1",
      "section_id": "8.1.1",
      "section_title": "Cell Selection and Reselection",
      "content": "An MS (in any mode of operation - A, B, or C) cannot camp on more than one cell. If the MS is in idle mode, see TS 23.122 [7b], it shall use cell selection and reselection procedures as described in TS 43.064 [11] and specified in TS 23.122 [7b] and TS 45.008 [16b].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.122",
        "ts_43.064",
        "ts_45.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.2",
      "section_id": "8.1.2",
      "section_title": "Discontinuous Reception",
      "content": "In A/Gb mode an MS may use discontinuous reception (DRX) or not. If using DRX, the MS shall also be able to specify other DRX parameters that indicate the delay for the network to send a page request or a channel assignment to the MS (see TS 43.064 [11]).\nThe DRX parameters shall be indicated by the MS in the attach procedure. The SGSN shall then send these parameters in each page request to the BSS that uses this information and the IMSI to calculate the correct paging group.\nDRX usage is independent of the MM states IDLE, STANDBY and READY. When a GPRS MS in READY state uses DRX, DRX has to be considered when assigning a packet data channel for downlink transfer. The SGSN shall therefore indicate the DRX parameters for the MS in all packet transmission requests to the BSS.\nIn A/Gb mode an MS shall not apply DRX in READY state during the GPRS attach and routeing area update procedures.\nAt inter SGSN change to an SGSN operating in A/Gb mode, the DRX parameters are sent from the old SGSN to the new SGSN as part of the MM context information. Hence, unless the DRX parameters have been altered, the UE should not include the DRX parameters in the Routing Area Update message sent to an A/Gb mode SGSN.\nIf the UE wishes to alter its GERAN or UTRAN/E-UTRAN DRX Parameters while in A/Gb mode, then it shall send a Routing Area Update Request message to the SGSN containing its new DRX Parameters. If ISR had been activated for the MS, then the MS shall deactivate ISR by setting its TIN to \"P-TMSI\" so that the MS performs a Tracking Area Update when it next enters E-UTRAN coverage. When the UE performs that Tracking Area Update, the MME will receive the updated DRX parameters within the MM context information sent by the old SGSN and hence the UE should not include them again in the Tracking Area Update.\n8.1.2a\tExtended idle mode Discontinuous Reception (DRX)\n8.1.2a.1\tGeneral\nIn A/Gb and Iu mode an MS and the core network may negotiate the use of extended idle mode DRX as described in TS 23.682 [119]. If the MS decides to request for extended idle mode DRX, the MS includes an extended idle mode DRX parameters information element in the attach request and/or RAU request message. The MS shall also include the DRX parameters for regular idle mode DRX in attach request.\nThe SGSN decides whether to accept or reject the MS request for enabling extended idle mode DRX as described in TS 23.682 [119]. In case the SGSN accepts the extended idle mode DRX, the SGSN based on operator policies and, if available, the extended idle mode DRX cycle length value in the subscription data from the HLR/HSS, may also provide different values of the extended idle mode DRX parameters than what was requested by the MS. If the SGSN accepts the use of extended idle mode DRX, the MS shall apply extended idle mode DRX based on the received extended idle mode DRX parameters. If the MS does not receive the extended idle mode DRX parameters information element in the relevant accept message because the SGSN rejected its request or because the request was received by SGSN not supporting extended idle mode DRX, the MS shall apply its regular discontinuous reception.\nNOTE:\tThe extended idle mode DRX cycle length requested by UE takes into account requirements of applications running on the UE. Subscription based determination of eDRX cycle length can be used in those rare scenarios when applications on UE cannot be modified to request appropriate extended idle mode DRX cycle length. The network accepting extended DRX while providing an extended idle mode DRX cycle length value longer than the one requested by the UE, can adversely impact reachability requirements of applications running on the UE.\nWhen the MS has PDP context for emergency bearer services, the MS and SGSN follow regular discontinuous reception as defined in clause 8.1.2/8.2.3 and shall not use the extended idle mode DRX. Extended idle mode DRX parameters may be negotiated while the MS has PDP context for emergency bearer services. When the PDP context for emergency bearer services is deactivated, the MS and SGSN shall reuse the negotiated extended idle mode DRX parameters in the last RAU/Attach procedure.\nThe MS shall include the extended idle mode DRX parameters information element in each RAU message if it still wants to use extended idle mode DRX. At SGSN to SGSN, MME to SGSN and SGSN to MME mobility, the extended idle mode DRX parameters are not sent from the old CN node to the new CN node as part of the MM context information.\nIf the SGSN is requested to monitor Reachability for Data and the UE is about to become reachable for paging, the SGSN sends a Monitoring Report message to the address that was indicated in the related Monitoring Request as described in TS 23.682 [119].\n8.1.2a.2\tPaging group occurrence determination in Gb mode\nTo determine the occurrence of ongoing paging group occurences for a given MS the SGSN uses the extended idle mode DRX parameters and a parameter called \"time remaining until the next paging group occurence\" received from the BSS for that MS see TS 48.018 [78]. If the SGSN needs to page the MS for which the SGSN has received the extended idle mode DRX parameters while the \"time remaining until the next paging group occurence\" parameter is not available, SGSN sends a paging message without concern for the next paging group occurrence. In that case BSS may respond to the SGSN with an indication that the paging message was not sent on the radio interface in which case the BSS includes the \"time remaining until the next paging group occurence\" parameter. The SGSN shall then reattempt the page taking the extended idle mode DRX parameters and the \"time remaining until the next paging group occurence\" parameter of the MS into consideration.\nThe value of the extended idle mode DRX cycle remains valid for the device (unless renegotiated) regardless of whether an SGSN actually triggers the transmission of a page to that device using any of the ongoing paging group occurences.\nAfter reception of a BSS restart indication, the SGSN sends to the BSS a Dummy Paging message including a IMSI and the extended idle mode DRX parameters to the BSS. BSS will for this Dummy Page message calculate the \"time remaining until the next paging group occurence\" and reply back to the SGSN including the \"time remaining until the next paging group occurrence\" in a Dummy Paging response. SGSN will use that \"time remaining until the next paging group occurence\" information to adjust the paging timing for all MSs that are subject to extended Idle mode DRX.\n8.1.2a.3\tPaging coordination between the MS and network in Iu mode\nThe extended idle mode DRX parameters are valid until the next Attach/RAU procedure is conducted and comprise the extended Idle DRX cycle value and Paging Transmission Window.\nThe MS and the SGSN coordinate the start of the Paging Transmission Window as described in TS 23.682 [119].\nThe MS monitors the network for paging messages during the Paging Transmission Window using its regular DRX parameters.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2",
        "ts_43.064",
        "ts_23.682",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.3",
      "section_id": "8.1.3",
      "section_title": "Radio Resource Management",
      "content": "A/Gb mode Radio Resource Management functions are defined in TS 24.007 [12]. The radio interface layer 3 protocol is specified in TS 24.008 [13].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.007",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.3.1",
      "section_id": "8.1.3.1",
      "section_title": "Layer Functions",
      "content": "GPRS radio resource management procedures are required for the following functions:\n-\tallocation and release of physical resources (i.e. timeslots) associated with a GPRS channel;\n-\tmonitoring GPRS channel utilisation to detect under-utilised or congested GPRS channels;\n-\tinitiating congestion control procedures; and\n-\tdistribution of GPRS channel configuration information for broadcasting to the MSs.\nThe radio resource management features that are required for PS handover are detailed in TS 43.129 [87].",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.129"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.3.2.1",
      "section_id": "8.1.3.2.1",
      "section_title": "Dynamic Allocation of Radio Resources",
      "content": "AnA/Gb mode cell may or may not support GPRS.\nA cell supporting GPRS may have GPRS radio resources allocated at a given instance. If no GPRS radio resources are allocated, an MS can request allocation of such resources. MSs may then use these radio resources. The PLMN may dynamically increase, to a PLMN operator-defined maximum, or, decrease to an operator-defined minimum, the radio resources allocated.\nThe network broadcasts GPRS system information on the common control channels.\nA/Gb mode radio resources are dynamically shared between GPRS and CS domain services.\n8.1.3a\tReady to Standby state transition in S4 architecture\nWhen idle mode packet buffering is performed in the S‑GW, the SGSN needs to inform the S‑GW each time that the MS changes from READY state to STANDBY state. The following figure illustrates the procedure between SGSN and S‑GW.\nFigure 55-5: READY to STANDBY transition within the network using S4\n1.\tThe READY timer expires in the SGSN.\n2.\tIf PDP Contexts associated are to be preserved:\n-\tif ISR is activated for that MS, the SGSN shall send a Release Access Bearers Request to the S‑GW to remove the SGSN address for user plane and downlink S4 GTP-U TEID;\n-\tif ISR is not activated for that MS, the SGSN may send a Release Access Bearers Request to the S‑GW to remove the SGSN address for user plane and downlink S4 GTP-U TEID.\n3.\tIf the S‑GW received a Release Access Bearers Request, the S‑GW returns a Release Access Bearers Response to SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "figure_55-5"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.4",
      "section_id": "8.1.4",
      "section_title": "Paging for GPRS Downlink Transfer (A/Gb mode)",
      "content": "An MS in STANDBY state is paged by the SGSN before a downlink transfer to that MS. The paging procedure shall move the MM state to READY to allow the SGSN to forward downlink data to the radio resource. Therefore, any uplink data from the MS that moves the MM context at the SGSN to READY state is a valid response to paging.\nIf extended idle mode DRX is negotiated between the MS and the CN paging requests are buffered in the SGSN until shortly before expiration of the device specific regular idle mode DRX cycle or extended idle mode DRX cycle (see clause 8.1.2a) or the device enters the Ready state. The SGSN sends paging requests to the set of BSSs managing the cells of interest (e.g. the cells in the routing area). The point when these paging requests are sent take into account the largest difference in radio interface synchronization between cells used for paging. More specifically, the set of cells within a routing area in which extended idle mode DRX is supported shall be time coordinated on the radio interface such that the largest difference in radio interface synchronization between any two cells in the set shall not exceed 4 seconds.\nUpon receiving a paging request for a device that is subject to extended idle mode DRX the BSS calculates the precise paging opportunity on the radio interface using IMSI and the extended idle mode DRX value included within paging request. This calculation is performed independent of the number of CCCHs per cell.\nIf the MS included its capability of supporting restriction of use of Enhanced Coverage, the SGSN sends Enhanced Coverage Restricted parameter to the BSS in the Paging message.\nThe SGSN supervises the paging procedure with a timer. If the SGSN receives no response from the MS to the Paging Request message, it shall repeat the paging. The repetition strategy is implementation dependent.\nThe MS shall accept pages also in READY state if no radio resource is assigned. This supports recovery from inconsistent MM states in the MS and the SGSN.\nThe GPRS Paging procedure in A/Gb mode is illustrated in Figure 56.\nFigure 56: GPRS Paging Procedure (A/Gb mode)\nNOTE:\tThe procedure describes the flow when there is an established user plane between SGSN and GGSN with Gn/Gp based SGSN, or between SGSN and S‑GW with S4 based SGSN. In case of an S4 based SGSN, when the S‑GW has no downlink user plane TEIDs, procedure steps (A) and (B) are defined in clause 8.1.4A.\n1)\tThe SGSN receives a DL PDU for an MS in STANDBY state. Downlink signalling to a STANDBY state MS initiates paging as well.\n2)\tThe SGSN sends a BSSGP Paging Request (IMSI, P‑TMSI, Area, Channel Needed, QoS, DRX Parameters, Gb Coverage Class Information, cell associated with the Gb Coverage Class Information) message to the BSS serving the MS. IMSI is needed by the BSS in order to calculate the MS paging group. P‑TMSI is the identifier by which the MS is paged. Area indicates the routeing area in which the MS is paged. Channel Needed indicates GPRS paging. QoS is the negotiated QoS for the PDP context that initiates the paging procedure, and indicates the priority of this Paging Request relative to other Paging Request messages buffered in the BSS. DRX Parameters indicates whether the MS uses discontinuous reception or not. If the MS uses discontinuous reception, DRX Parameters in combination with the IMSI indicate when the MS is in a non-sleep mode able to receive paging requests. Gb Coverage Class Information, and the cell associated with the Gb Coverage Class Information may be used by BSS to optimize the radio paging procedure.\n3)\tThe BSS pages the MS with one Paging Request (P‑TMSI, Channel Needed) message in each cell belonging to the addressed routeing area. This is described in TS 43.064 [11].\n4)\tUpon receipt of a GPRS Paging Request message, the MS shall respond with either any single valid LLC frame (e.g. a Receive Ready or Information frame) that implicitly is interpreted as a page response message by the SGSN. The MS shall not use the LLC NULL frame as a page response. When responding, the MS changes MM state to READY. The Packet Channel Request precedes the response and Packet Immediate Assignment procedures as described in TS 43.064 [11].\n5)\tUpon reception of the LLC frame, the BSS adds the Cell Global Identity including the RAC and LAC of the cell and sends the LLC frame to the SGSN. The SGSN shall then consider the LLC frame to be an implicit paging response message and stop the paging response timer.\n8.1.4A\tPaging response for GPRS Downlink Transfer with no established user plane on S4\nFigure 56a: Paging with no established user plane on S4\nFigure 56b: Paging Response with no established user plane on S4\nNOTE:\tSteps A, B and E are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (C) are defined in TS 23.402 [90]. Steps C and D concern GTP based S5/S8.\nA)\tWhen the S‑GW receives a downlink PDU and no downlink user plane exists for the UE at S4, the S‑GW buffers the downlink data packet and identifies which SGSN is serving that UE.\nIf that SGSN has requested the S-GW to throttle downlink low priority traffic and if the downlink data packet is received on a low priority bearer to be throttled (see clause 5.3.6.5), the SGW drops the downlink data packet. The steps below are not executed.\nOtherwise the S-GW sends a Downlink Data Notification message to the SGSN.\nSteps between A and B are described in clause 8.1.4.\nB)\tUpon reception of the LLC frame in STANDBY state and if the user plane tunnel does not exist, the SGSN shall indicate the paging response from GERAN by sending a Modify Bearer Request (SGSN user plane address, RAT Type, TEID) to the Serving GW. The S‑GW is now able to transmit downlink data towards the UE.\nC)\tIf the RAT Type has changed compared to the last reported RAT Type, the S‑GW shall send the Modify Bearer Request message (RAT Type) to the PDN GW.\nD)\tThe PDN GW sends the Modify Bearer Response to the S‑GW.\nE)\tThe S‑GW sends a Modify Bearer Response to the SGSN.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2",
        "clause_8.1.4",
        "clause_5.3.6.5",
        "figure_56",
        "ts_43.064",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.5.1",
      "section_id": "8.1.5.1",
      "section_title": "General",
      "content": "The RAN Information Management (RIM) procedures provide a generic mechanism for the exchange of arbitrary information between applications belonging to the RAN nodes. The RAN information is transferred via the SGSN core network node(s). In order to make the RAN information transparent for the Core Network, the RAN information is included in a RIM container that shall not be interpreted by the Core Network nodes.\nThe RIM procedures are optional both in the RAN node and in the SGSN. For the Gb interface the use of RIM procedures is negotiated at start/restart of the Gb link. For the Iu interface there is no negotiation of using RIM procedures or not at Iu link start/restart.\nThe RAN information is transferred in RIM containers from the source RAN node to the destination RAN node by use of messages. Each message carrying the RIM container is routed and relayed independently by the SGSN(s). Any relation between messages is transparent for the SGSN, i.e. a request/response exchange between RIM applications, for example, is routed and relayed as two independent messages by the SGSN.\nThe interfaces which will be used are the Gb (BSSGP) , the Iu (RANAP), the Gn (GTPv1) and the S16 (GTPv2) interfaces. The RAN information in the RIM container shall be transparent for the Core Network. An SGSN supporting the RIM procedures provides addressing, routeing and relay functions.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_8.1.5.2.1",
      "section_id": "8.1.5.2.1",
      "section_title": "Addressing",
      "content": "All the messages used for the exchange of RAN information contain the addresses of the source and destination RAN nodes. A BSS is addressed by Routeing Area Identity (RAI) + Cell Identity (CI) of one of its cells. An RNC is addressed by Global RNC-Id.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_8.1.5.2.2",
      "section_id": "8.1.5.2.2",
      "section_title": "Routeing",
      "content": "The following description applies to all the messages used for the exchange of RAN information.\nThe source RAN node sends a message to its SGSN including the source and destination addresses. An RNC sends in addition a RIM routing address, which is a copy of the destination address. From the destination address or from the RIM routing address, the SGSN shall decide whether or not it is connected to the destination RAN node.\nIf the SGSN is not connected to the destination RAN node, then it shall use the destination address or the RIM routing address to route the message encapsulated in a GTP message to the correct SGSN via the Gn interface. If the destination address or RIM routing address identifies an RNC the SGSN includes the RIM routing address in the GTP message. If the SGSN received the message from a BSC it copies the destination address from the message into the RIM routing address.\nThe SGSN connected to the destination RAN node decides which RAN node to send the message to based on the destination address or on the RIM routing address.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_8.1.5.2.3",
      "section_id": "8.1.5.2.3",
      "section_title": "Relaying",
      "content": "The SGSN performs relaying between BSSGP messages, RANAP messages and GTP messages as described in TS 48.018 [78], TS 25.413 [56b] and TS 29.060 [26].",
      "chunk_type": "general",
      "cross_references": [
        "ts_48.018",
        "ts_25.413",
        "ts_29.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.5.5",
      "section_id": "8.1.5.5",
      "section_title": "Applications using the RIM Procedures",
      "content": "The RAN node applications, which use the RIM procedures, are fully transparent for the SGSN. These applications are described in RAN specifications. An example is the Network Assisted Cell Change described in TS 48.018 [78] and TS 25.413 [56b].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_48.018",
        "ts_25.413"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.1.6",
      "section_id": "8.1.6",
      "section_title": "BSS Paging Co-ordination",
      "content": "In Network Operation Mode II, paging from one CN domain is done independently from the state of the MS in the other CN domain, i.e. no paging co-ordination on core network level is done.\nIt is, however, possible to do paging co-ordination on BSS level in these cases. This means that for each paging request received from one CN domain, the BSC determines whether the MS is engaged with the other CN domain or not. In order to achieve this, the context that is prepared within the BSC for an MS engaged with one of the CN domains must contain the IMSI, which is the common MS identity for the two CN domains.\nIf the BSC determines that the MS is engaged with the PS domain, the CS paging will be done on a packet data channel for the MS in question.\nIf the BSC determines that the MS is engaged with the CS domain, the PS paging (packet notification) will be done on a CS dedicated channel for the MS in question.\nIf no context is found for the MS, \"normal CS paging\" is performed on the CCCH paging channel and \"normal PS paging\" is performed on the CCCH paging channel or the packet paging channel (PCCCH shall not be used, see clause 6.3.3.1), as applicable.\nIf BSS paging co-ordination for CS paging is active in a cell or not, shall be indicated as system information to the MSs. For proper operation, the mode should be the same in each cell of a routeing area.\nBSS paging co-ordination for PS paging shall always be active in a cell where DTM is supported and is applicable to MSs supporting DTM.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.1",
      "section_id": "8.2.1",
      "section_title": "Radio Resource Management",
      "content": "UTRAN functions are defined in TS 25.401 [53]. The radio interface protocol architecture is specified in TS 25.301 [50], and the Radio Resource Control protocol is specified in TS 25.331 [52]. TS 43.051 [74] contains an overall description of GSM/EDGE Radio Access Network.\nIn the context of this specification, the term URA refers also to GRA (GERAN Registration Area) when the RAN serving an MS in Iu mode is a GERAN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.401",
        "ts_25.301",
        "ts_25.331",
        "ts_43.051"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.2",
      "section_id": "8.2.2",
      "section_title": "RRC State Machine",
      "content": "The RRC state machine is a description model of how the MS and the Iu mode RAN co-operate regarding RRC functionality. The RRC state describes the MS state in the Iu mode RAN. This clause contains a brief description of the RRC state machine, for more information see TS 25.303 [51].\nThe RRC state machine exists as two peer entities, one in the MS and one in the Iu mode RAN. Apart from transient situations and error cases the two peer entities are synchronised. Figure 57 illustrates the main modes and states of the RRC state machine.\nFigure 57: RRC Modes, Main RRC States and Main Mode and State Transition\nRRC Idle mode: In the Idle mode there is no connection established between the MS and the Iu mode RAN. There is no signalling between RAN and the MS except for system information that is sent from RAN on a broadcast channel to the MS. The MS can also receive paging messages with a CN identity on the PCH. There is no information of the MS stored in RAN in this mode.\nRRC Connected mode: In the Connected mode the main states are Cell Connected state and URA Connected state. In this mode there is one RNC/BSC that is acting as serving RNC/BSC, and an RRC connection is established between the MS and this SRNC/SBSC.\n-\tWhen the MS position is known at the cell level, the MS is in the Cell Connected state. When in Cell Connected state, the RRC connection mobility is handled by handover and cell update procedures.\n-\tWhen the MS position is known at the URA level, the MS is in the URA Connected state. URA updating procedures provide the mobility functionality in this state. No dedicated radio resources are used in the URA Connected state.",
      "chunk_type": "general",
      "cross_references": [
        "figure_57",
        "ts_25.303"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.3",
      "section_id": "8.2.3",
      "section_title": "Discontinuous Reception",
      "content": "An MS can set the DRX cycle length that is specific to the PS domain. TS 25.304 [51b] describes how the MS shall select which DRX cycle length to use with respect to DRX cycle length requirements set by the RAN, CN PS domain and CN CS domain.\nThe DRX parameter information shall be indicated by the MS in the attach procedure and when changing from A/Gb mode to Iu mode also in the routeing area update procedure. The SGSN shall then in each page request send these parameters to the RNC/BSC that uses this information, and the IMSI, to calculate the correct paging group.\nAt inter SGSN change (either RA update or SRNS relocation), the DRX parameters are sent from the old SGSN to the new SGSN as part of the MM context information. Hence, unless the DRX parameters have been altered, the UE should not include the DRX parameters in the Routing Area Update message. There is one other exception to this: in order to support mobility from pre-Release 99 SGSNs, the MS shall include the DRX Parameter IE in a Routing Area Update Request message sent at RA update from GERAN to UTRAN.\nAt inter-SGSN RA update (e.g. from GERAN), if the network receives a DRX parameters IE from the MS in the routeing area update request message, the new SGSN shall use the information provided by the MS and shall ignore the same IE received in MM Context from the old SGSN.\nIf the UE wishes to alter its GERAN or UTRAN/E-UTRAN DRX Parameters while in Iu mode, then it shall send a Routing Area Update Request message to the SGSN containing its new DRX Parameters. If ISR had been activated for the MS, then the MS shall deactivate ISR by setting its TIN to \"P-TMSI\" so that the MS performs a Tracking Area Update when it next enters E-UTRAN coverage. When the UE performs that Tracking Area Update, the MME will receive the updated DRX parameters within the MM context information sent by the old SGSN and hence the UE should not include them again in the Tracking Area Update.\n8.2.3a\tExtended idle mode Discontinuous Reception (DRX)\n8.2.3a.1\tGeneral\nIn Iu mode, extended idle mode DRX may be enabled as described in clause 8.1.2a.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2",
        "ts_25.304"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.4",
      "section_id": "8.2.4",
      "section_title": "Paging Initiated by CN",
      "content": "A CN node requests paging only for MSs in CMM‑IDLE state or PMM‑IDLE state. In the separate CN architecture, paging from a CN node is done independently from the state of the MS in the other CN service domain.\nIn the context of this specification, the terms RNS or RNC refer also to a GERAN BSS or BSC (respectively) when serving an MS in Iu mode.\nIn this alternative with paging co-ordination in the RAN, the MS does not need to listen to the PCH (Paging Channel) in the RRC Connected mode, at least not when MS is allocated a dedicated channel.\nFor each paging request received from a CN node, the RNC determines whether the MS has an established RRC connection or not. In order to achieve this, the context that is prepared within the SRNC for MS in RRC Connected mode must contain the IMSI, which is the common MS identity for the two CN domains.\nIf no context is found for the MS, \"normal PCH paging\" is performed. The paging message is transferred on the paging channel, and it includes the MS paging identity received from the CN and a CN service domain type indication.\nIf a context is found, a \"CN paging message\" is transferred using the existing RRC connection. This message includes a CN service domain type indication. If, potentially after repetition, this transfer is unsuccessful and if the CS domain originally triggered the paging, the RNC should decide whether to attempt \"normal PCH paging\" as described in clause \"Unsynchronous states in the UE and the UTRAN\".",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_8.2.4.1",
      "section_id": "8.2.4.1",
      "section_title": "PS Paging Initiated by SGSN (Iu mode) without RRC Connection for CS",
      "content": "Figure 58: PS Paging by SGSN (Iu mode) Without RRC Connection for CS\nNOTE 1:\tSteps 2‑4 are common for architecture variants using Gn/Gp based interaction with GGSN. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 8.2.4.1A.\n1)\tThe 3G‑SGSN receives a DL PDU or downlink signalling for an MS in PMM Idle state.\n2)\tThe 3G‑SGSN sends a RANAP Paging (IMSI, P‑TMSI, Area, CN Domain Indicator, DRX parameters, list of CSG IDs for paging) message to each RNS belonging to the routeing area in which the MS is located. IMSI is needed by the RNS in order to calculate the MS paging group, and to identify the paged MS. If 3G‑SGSN assigned the P‑TMSI to the MS, P‑TMSI is also included. Area indicates the routeing area in which the MS is paged. CN Domain Indicator indicates which domain (MSC or 3G‑SGSN) initiated the paging message, and it represents \"SGSN\" in this case. DRX Parameters indicates the MS's preferred DRX cycle length. The list of CSG IDs for paging is included when the 3G SGSN is configured to support paging optimisation described in clause 5.3.9. For paging optimisation, the CSG IDs of expired CSG subscriptions and valid CSG subscriptions are both included in the list. If the MS has emergency bearer service the 3G SGSN shall not perform paging optimization.\nNOTE 2:\tAn expired CSG subscription indicates that the MS is not allowed service in the CSG. However, since the removal of the CSG from the MS is pending, it is possible the MS will camp on that CSG and therefore the MS is still paged for the CSG.\n3)\tThe RNS controls whether the MS has an established RRC connection or not. In this case, MS has no RRC connection, so a \"normal PCH paging\" is performed. Paging Type 1(IMSI or P‑TMSI, Paging originator, CN domain ID) is transferred on the Paging channel, IMSI or P‑TMSI identifies the MS. Paging originator indicates whether this is core network originated paging or RAN originated paging, so it represents \"CN\" in this case. And CN domain ID indicates whether this paging message is for CS service or PS service, so it represents \"PS\" in this case.\n4)\tThe paging request triggers the Service Request procedures in the MS. The service request procedures are described in clause \"Service Request Procedure (Iu mode)\".\nOptionally, 3G‑SGSN may include \"Non Searching Indication\" in RANAP Paging message in this case. If a \"Non Searching Indication\" parameter is present, the RNC will not search the established RRC connection, and just initiate \"normal PCH paging\".\n8.2.4.1A\tServing GW Triggered Paging (Iu mode) with S4\nFigure 58a: Serving GW triggered paging with S4\nA)\tIf the S‑GW has no downlink user plane TEIDs for S4 and S12, the S‑GW buffers the DL PDUs and identifies which SGSN is serving that UE.\nIf that SGSN has requested the S-GW to throttle downlink low priority traffic and if the downlink data packet is received on a low priority bearer to be throttled (see clause 5.3.6.5), the S‑GW drops the downlink data packet. The steps below are not executed.\nOtherwise the S‑GW sends a Downlink Data Notification to the SGSN.If the S‑GW has downlink user plane TEIDs for S4 the DL PDUs are transferred to SGSN.",
      "chunk_type": "general",
      "cross_references": [
        "clause_8.2.4.1",
        "clause_5.3.9",
        "clause_5.3.6.5",
        "figure_58"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.4.2",
      "section_id": "8.2.4.2",
      "section_title": "PS Paging Initiated by 3G‑SGSN With RRC Connection for CS",
      "content": "Figure 59: PS Paging by SGSN (Iu mode) With RRC Connection for CS\nNOTE 1:\tSteps 2‑4 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 8.2.4.1A.\n1)\tThe 3G‑SGSN receives a DL PDU or downlink signalling for an MS in PMM Idle state.\n2)\tThe 3G‑SGSN sends a RANAP Paging (IMSI, P‑TMSI, Area, CN Domain Indicator, DRX parameters, list of CSG IDs for paging) message to each RNS belonging to the routeing area in which the MS is located. IMSI is needed by the RNS in order to calculate the MS paging group. If 3G‑SGSN assigned the P‑TMSI to the MS, P‑TMSI is included, and it identifies the MS is paged. Area indicates the routeing area in which the MS is paged. CN Domain Indicator indicates to which domain (MSC or 3G‑SGSN) the paging was initiated, and it represents \"3G‑SGSN\" in this case. DRX Parameters indicates whether or not the MS uses discontinuous reception and the DRX cycle length. The list of CSG IDs for paging is included when the 3G SGSN is configured to support paging optimisation described in clause 5.3.9. For paging optimisation, the CSG IDs of expired CSG subscriptions and valid CSG subscriptions are both included in the list. If the MS has emergency bearer service the 3G SGSN shall not perform paging optimization.\nNOTE 2:\tAn expired CSG subscription indicates that the MS is not allowed service in the CSG. However, since the removal of the CSG from the MS is pending, it is possible the MS will camp on that CSG and therefore the MS is still paged for the CSG.\n3)\tThe RNS controls whether the MS has an established RRC connection or not. In this case, MS has an established RRC connection for CS service, so RNS sends an RRC Paging Type 2 (CN domain ID) message to the MS on established RRC connection. CN Domain ID indicates to which domain (CS or PS) the paging shall be directed, so it represents \"PS\" in this case.\n4)\tThe paging request triggers the Service Request procedures in the MS. The service request procedures are described in clause \"Service Request Procedure (Iu mode)\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_8.2.4.1",
        "clause_5.3.9",
        "figure_59"
      ]
    },
    {
      "chunk_id": "ts_23.060_8.2.5",
      "section_id": "8.2.5",
      "section_title": "Paging Initiated by RAN",
      "content": "An MS in RRC URA/GRA connected state is paged by the RAN before a downlink transfer to that MS. The URA/GRA paging procedure shall move the RRC state to Cell Connected to allow the RAN to forward downlink data or signalling message to the radio resource. Therefore, the RRC: Cell Update message from the MS that moves the RRC State at the RAN to Cell Connected state is a valid response to URA/GRA paging.\nThe RAN supervises the paging procedure with a timer. If the RAN receives no response from the MS to the URA or GRA Paging Request message, it shall repeat the paging. The repetition strategy is implementation dependent. If it is unsuccessful and if the paging was originally triggered by the CS domain, it is the RNC's responsibility to recover this situation by following the \"normal PCH paging\" mechanism (see clause \"Paging Initiated by CN\"). For more information see TS 25.303 [51].\nThe URA/GRA Paging procedure is illustrated in Figure 60.\nFigure 60: URA/GRA Paging Procedure\n1)\tThe RAN receives a downlink PDP PDU for an MS in RRC URA/GRA connected state. Downlink signalling to an MS in RRC URA/GRA connected state initiates URA/GRA paging as well.\n2)\tThe RAN pages the MS with one Paging Type 1 (RNTI, Paging originator) message in each cell belonging to the URA/GRA where the MS exists. RNTI is the identifier by which the MS is paged. Paging originator indicates whether this is the core network originated paging or RAN originated paging, so it represents \"RAN\" in this case.\n3)\tThe paging request triggers the Cell Update procedures in the MS. The Cell Update procedures are described in TS 25.331 [52].",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_60",
        "ts_25.303",
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.1.0",
      "section_id": "9.1.0",
      "section_title": "General",
      "content": "A PS subscription contains the subscription of one or more PDP addresses. Each PDP address is an element of a PDP context. The same PDP address may appear in one or more PDP contexts in the MS, the SGSN, the S‑GW, the P‑GW and the GGSN. Each PDP context may be associated with a TFT. At most one PDP context associated with the same PDP address may exist at any time with no TFT assigned to it. Every PDP context exists independently in one of two PDP states. The PDP state indicates whether data transfer is enabled for that PDP address and TFT or not. In case all PDP contexts associated with the same PDP address are deactivated, data transfer for that PDP address is disabled. Activation and deactivation are described in clause \"PDP Context Activation, Modification, Deactivation, and Preservation Functions\". All PDP contexts of a subscriber are associated with the same MM context for the IMSI of that subscriber.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.1.1",
      "section_id": "9.1.1",
      "section_title": "INACTIVE State",
      "content": "The INACTIVE state characterises the data service for a certain PDP address of the subscriber as not activated. The PDP context contains no routeing or mapping information to process PDP PDUs related to that PDP address. No data can be transferred. A changing location of a subscriber causes no update for the PDP context in INACTIVE state even if the subscriber is GPRS-attached.\nMobile-terminated PDP PDUs received in INACTIVE state by the GGSN may initiate the Network-Requested PDP Context Activation procedure if the GGSN is allowed to initiate the activation of the PDP context for that PDP address. Otherwise, mobile-terminated PDP PDUs received in INACTIVE state invoke error procedures in the P‑GW or GGSN relevant to the packet data network protocol, for example, an IP packet is discarded and an ICMP (see RFC 792 [41]) packet (error notification) is returned to the source of the received packet. Other error procedures may be introduced on the application level, but this is outside the scope of the present document.\nThe MS initiates the movement from INACTIVE to ACTIVE state by initiating the PDP Context Activation procedure.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.1.2",
      "section_id": "9.1.2",
      "section_title": "ACTIVE State",
      "content": "In ACTIVE state, the PDP context for the PDP address in use is activated in the MS, SGSN and GGSN when using Gn/Gp, or in the MS, SGSN, S‑GW and P‑GW when using S4. The PDP context contains mapping and routeing information for transferring PDP PDUs for that particular PDP address between the MS and the P‑GW or GGSN. The PDP state ACTIVE is permitted only when the mobility management state of the subscriber is STANDBY, READY, PMM‑IDLE, or PMM‑CONNECTED. The Iu interface radio access bearer may or may not be established for an active PDP context.\nAn active PDP context for an MS is moved to INACTIVE state when the deactivation procedure is initiated.\nAll active PDP contexts for an MS are moved to INACTIVE state when the MM state changes to IDLE or PMM‑DETACHED.\nFigure 61: Functional PDP State Model",
      "chunk_type": "general",
      "cross_references": [
        "figure_61"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.0",
      "section_id": "9.2.0",
      "section_title": "General",
      "content": "This clause describes the procedures to enable a GPRS-attached MS to initiate the activation, modification, and deactivation functions for a PDP context in the MS, the SGSN, the S‑GW and the P‑GW or GGSN. In addition procedures to enable a P‑GW or GGSN to request the activation, modification and deactivation of a PDP context to a GPRS-attached subscriber are described.\nAn MS that activates Primary PDP Context(s) of PDP Type Non-IP shall not activate Secondary PDP Contexts for such PDP Context(s).\nNOTE 1:\tIf the MS is in PMM‑IDLE state, it needs to perform a service request procedure to enter the PMM‑CONNECTED state before initiating these procedures.\nNOTE 2:\tThere are two procedures specified for GGSN initiated PDP Context Activation; the Network Requested PDP Context Activation Procedure and the Network Requested Secondary PDP Context Activation Procedure. P‑GWs support only the Network Requested Secondary PDP Context Activation Procedure. The network requested bearer control makes use of the Network Requested Secondary PDP Context Activation Procedure only.\nNOTE 3:\tThere is a one-to-one mapping between PDP contexts and EPS bearer contexts. PDP contexts established with the PDP Context Activation Procedure are mapped to default EPS bearer contexts as defined in TS 23.401 [89] and vice versa. PDP contexts established with the Secondary PDP Context Activation Procedure are mapped to dedicated EPS bearer contexts as defined in TS 23.401 [89] and vice versa. The TFT associated with a context is not changed by the mapping.\nUpon receiving an Activate PDP Context Request message or an Activate Secondary PDP Context Request message, the SGSN shall initiate procedures to set up PDP contexts. The first procedure includes subscription checking, APN selection, and host configuration, while the latter procedure excludes these functions and reuses PDP context parameters including the PDP address but except the QoS parameters. Once activated, all PDP contexts that share the same PDP address and APN shall be managed equally. At least one PDP context shall be activated for a PDP address before a Secondary PDP Context Activation procedure may be initiated. When the MS performs an RA update procedure to change from a release 99 to a release 97 or 98 system, only one active PDP context per PDP address and APN shall be preserved. This PDP context is selected taking the QoS profile and NSAPI value into account.\nWhen the SGSN is using the S4‑interface to an S‑GW for a PDP Context, EPS Bearer procedures will be used.\nThe EPS subscription context includes a mandatory EPS subscribed QoS profile for the default bearer of each subscribed APN. If the S4-SGSN has received an EPS subscribed QoS profile and the first PDP context to a given APN is activated, the S4-SGSN disregards the QoS requested by the MS and sends the EPS subscribed QoS profile for this APN to the S‑GW. For MSs, for which the S4-SGSN has not received an EPS subscribed QoS profile per APN, the S4-SGSN treats MS originated QoS requests the same as the Gn/Gp SGSN. For MSs, for which the S4-SGSN has not received a subscribed APN-AMBR per APN, the S4-SGSN provides APN-AMBR to the Serving GW and PDN GW. Details on mapping MBR to APN-AMBR are specified in Annex E of TS 23.401 [89].\nThe E-UTRAN capable MS shall not deactivate the PDP context created by the PDP Context Activation Procedure unless all PDP contexts for the same PDN connection are to be deactivated. The MS shall not modify the QoS of the PDP context created by the PDP Context Activation Procedure.\nWhen the E-UTRAN capable MS is activating the first PDP context with the PDP Context Activation Procedure, the MS shall request for the subscribed QoS profile, but the MS may request for subscribed, interactive or background traffic class. If the EPS subscribed QoS profile information is available to the PDN GW (e.g. if PCC is deployed) and the PDN GW is connected to an Gn/Gp SGSN, the PDN GW shall modify the requested QoS according to the EPS subscribed QoS profile during the PDP Context Activation Procedure.\nNOTE 4:\tAs the Gn/Gp SGSN is not capable of allocating the EPS subscribed QoS profile, the MS and the PDN GW are responsible for this.\nThe non E-UTRAN capable MS should not deactivate the PDP context created by the PDP Context Activation Procedure unless all PDP contexts for the same PDN connection are to be deactivated. The MS should not modify the QoS of the PDP context created by the PDP Context Activation Procedure as long as the MS can achieve the same result using a different PDP context than the PDP context created by the PDP Context Activation Procedure.\nDuring the PDP Context Activation Procedure the bearer control mode, applicable to all PDP Contexts within the activated PDP Address/APN pair, is negotiated. The Bearer Control Mode (BCM) is one of 'MS_only' or 'MS/NW':\n-\tWhen 'MS_only' the MS shall request any additional PDP contexts for the PDP Address/APN pair through the Secondary PDP Context Activation Procedure. Session Management procedures described in 9.2 apply with the following restrictions:\n-\tThe P‑GW or GGSN shall not initiate any Network Requested Secondary PDP Context Activation.\n-\tThe P‑GW or GGSN shall not initiate any TFT operation.\n-\tThe P-GW shall reject any MS request for a secondary PDP context activation that is received without a TFT.\n-\tFor a TFT, when the MS uses the direction attribute, the MS shall ensure that there is at least one packet filter for the uplink direction (unless the TFT is for the PDP context that has been established with the PDP Context Activation Procedure).\n-\tWhen 'MS/NW' both the MS and the P‑GW or GGSN may request additional PDP contexts for the PDP Address/APN pair. The MS shall use the Secondary PDP Context Activation Procedure. The P‑GW or GGSN shall use the Network Requested Secondary PDP Context Activation Procedure. The MS shall, when modifying the QoS of a PDP context, include a TFT with at least packet filter identifiers to indicate which packet filters in the TFT are associated with the QoS change.\nNOTE 5:\tThe MS indicates the packet filters in the TFT so that the network can perform the appropriate authorization, i.e. in-line with a valid state for the TFT settings (as defined in clause 15.3.0).\nFor 'MS/NW' the session Management procedures described in clause 9.2 apply with the following restrictions:\n-\tThe MS shall not modify the QoS of a PDP context until this PDP context is associated with a TFT containing packet filters set by the MS. If the TFT also contains packet filters set by the P‑GW/GGSN, the MS is only allowed to modify the bit rate parameters in the QoS profile of that PDP Context;\n-\tThe MS shall not initiate any Secondary PDP Context Activation without sending a TFT containing at least one packet filter for the uplink direction;\n-\tThe P-GW/GGSN shall not initiate any Network Requested Secondary PDP Context Activation without sending a TFT containing at least one packet filter for the uplink direction;\n-\tThe MS shall not add a TFT to a PDP context that was established without a TFT;\n-\tThe MS shall not delete the TFT from a PDP context that is associated with a TFT;\n-\tThe network shall not delete the TFT from a PDP context that is associated with a TFT unless the PDP context was created by the PDP Context Activation Procedure;\n-\tOnly the entity that sets a packet filter in the TFT (either MS or P‑GW/GGSN) is allowed to modify or delete this packet filter;\n-\tFor each TFT, the MS and the network shall ensure that among the packet filters under own control there is at least one packet filter for the uplink direction, or no own packet filter at all (unless the TFT is for the PDP context that has been established with the PDP Context Activation Procedure);\n-\tFor each packet filter the MS and the network shall indicate whether it corresponds to uplink, downlink or bi-directional traffic flow(s).\nNOTE 6:\tThe restriction below may be relaxed in a future Release. In the restriction below, packet filters without a declared direction are considered to be bi-directional.\n-\tThe P-GW/GGSN shall ensure that for all PDP contexts of the same APN/PDP address pair a valid state for the TFT settings (as defined in clause 15.3.0) is maintained.\nNOTE 7:\tIf a PDP context is to be used for services having downlink IP flows only, then the TFT needs to include a packet filter for the uplink direction that effectively disallows any useful uplink packet flows (see clause 15.3.3.4 for an example of such a packet filter).\nNOTE 8:\tIf the PDP context is to be used for services having uplink IP flows only, the TFT needs no packet filter for the downlink direction.\nThe MS indicates support of the network requested bearer control through the Network Request Support UE (NRSU) parameter, which is applicable to all PDP contexts within the same PDP address / APN pair. The SGSN indicates support of the network requested bearer control through the Network Request Support Network (NRSN) parameter.\nIf the NRSN is not included in the Update PDP Context Request message from the SGSN, or the SGSN does not indicate support of the network requested bearer control, the GGSN or P‑GW shall, following a SGSN-Initiated PDP Context Modification (triggered by SGSN change), perform a GGSN or P‑GW-Initiated PDP Context Modification to change the BCM to 'MS-Only' for all PDP-Address/APN-pairs for which the current BCM is 'MS/NW'.\nNOTE 9:\tAn MS is informed of the change in BCM, by SGSN, via Protocol Configuration Options IE in Modify PDP Context Request. The support for PCO IE in Modify PDP Context Request was introduced during Release 5. Hence, the communication of change in BCM, for some pre-Release 6 deployments which do not support PCO IE in Modify PDP Context Request, to an MS may not be possible.\nNOTE 10:\tChange of BCM from 'MS-Only' to 'MS/NW' has not been supported by the MS and the network since introduction of MS/NW BCM mode in Rel‑7.\nAn S4-based SGSN shall apply the BCM 'MS/NW' whenever the S4 is selected for a certain MS.\nNOTE 11:\tThe S4-SGSN needs to support the network requested bearer control due to the nature of the procedures and thus a dynamic signalling of NRSN and BCM is not necessary.\nNOTE 12:\tThere may be cases where BCM mode in an S4-SGSN is \"MS/NW\" but BCM mode in MS and P-GW is \"MS-Only\", e.g. when the MS does not send NRSU in PCO IE.\nThe MS indicates support of the extended TFT filter format through the Extended TFT Support UE (ETFTU) parameter, which is applicable to all PDP contexts within the same PDP address / APN pair. The network indicates the support of the extended TFT filter format for all PDP contexts within the same PDP address / APN pair through the Extended TFT Support Network (ETFTN) parameter.\nUpon receiving a Deactivate PDP Context Request message, the SGSN shall initiate procedures to deactivate the PDP context. When the last PDP context associated with a PDP address is deactivated, N‑PDU transfer for this PDP address is disabled.\nAn MS does not have to receive the (De‑) Activate PDP Context Accept message before issuing another (De‑)Activate PDP Context Request. However, only one request can be outstanding for every TI.\nBy sending a RAB Release Request or Iu Release Request message to the SGSN, the RAN initiates the release of one or more RABs. The preservation function allows the active PDP contexts associated with the released RABs to be preserved in the CN, and the RABs can then be re-established at a later stage.\nAn S4-based SGSN shall for all active PDN Connections for a certain MS use either S4 or Gn/Gp. This is achieved by the SGSN rejecting a PDP Context activation violating this:\n-\tIf an MS is sending an Activate PDP Context Request for an APN using Gn, the activation will be rejected by the SGSN if a PDP Context using S4 already exists for this MS;\n-\tIf an MS is sending an Activate PDP Context Request for an APN using S4, the activation will be rejected by the SGSN if a PDP Context using Gn already exists for this MS.\nThe list of QoS parameters that the PCEF may change, e.g. ARP or APN-AMBR or both, either based on local policy or based on PCRF interactions is described in clause 9.2.3.\nIn a roaming scenario, based on local configuration, the S4-SGSN may downgrade the ARP or APN-AMBR and/or remap QCI parameter values received from HSS to the value locally configured in S4-SGSN (e.g. when the values received from HSS do not comply with services provided by the visited PLMN). The PCEF may change the QoS parameter values received from the S4-SGSN based on interaction with the PCRF or based on local configuration. Alternatively, the PCEF may reject the bearer establishment.\nNOTE 13:\tFor certain APNs (e.g. the IMS APN defined by the GSMA) the QCI value is strictly defined and therefore remapping of QCI is not permitted.\nNOTE 14:\tIn roaming scenarios, the ARP/APN-AMBR/QCI values provided by the S4-SGSN for a default bearer may deviate from the subscribed values depending on the roaming agreement. If the PCEF (based on interaction with the PCRF or based on local configuration) upgrades the ARP/APN-AMBR/QCI parameter values received from the S4-SGSN, the default bearer establishment may be rejected by the S4-SGSN.\nIf case S4 is selected for a certain MS the SGSN shall not modify the EPS bearer level QoS parameters received from the PDN GW during establishment or modification of a default or dedicated bearer (except when the conditions described in NOTE 14 apply). Based on local configuration, the SGSN may reject the establishment or modification of a default or dedicated bearer only in the case of roaming when the bearer level QoS parameter values do not comply with a roaming agreement.\nNOTE 15:\tFor roaming, the S4-SGSN, based on local policies, can downgrade the ARP pre-emption vulnerability and/or pre-emption capability, APN-AMBR or MBR (for GBR bearers) parameters received over S8 and allow the bearer establishment or modification of a default or dedicated bearer. The HPLMN is expected to set EPS QoS parameters compliant with roaming agreements, therefore the HPLMN is not informed about any downgrade of EPS bearer QoS parameters. The consequences of such a downgrade are that APN-AMBR and MBR enforcement at the HPLMN and at the UE will not be aligned.\n9.2.1A\tPrinciples for mapping between PDP Contexts and EPS Bearers\nThe following text describes the general principles used by an SGSN using S4 when mapping between PDP Contexts and EPS Bearers.\nThe MS is using PDP Context Activation, Modification and Deactivation functions, and PDP Contexts are therefore used between MS and SGSN. An SGSN using Gn/Gp only will use these procedures towards GGSNs as well. An SGSN using S4 will for a specific PDP Context towards an MS map these procedures into equivalent procedures using EPS Bearer towards S‑GW and P‑GW. EPS Bearer procedures will not be used between MS and SGSN.\nThe following principles are to be used:\n-\t1:1 mapping between one PDP context and one EPS Bearer;\n-\t1:1 mapping between NSAPI and EPS Bearer ID;\n-\tThe P‑GW treats an MS-initiated request, e.g. a Secondary PDP Context Activation Request, according to the UE requested bearer resource modification procedures in TS 23.401 [89];\n-\tPDN GW and Serving GW need to be RAT aware to allow for 2G/3G specific handling of EPS bearers, e.g. MS initiated secondary PDP Context activation must make the P‑GW to activate a new EPS bearer.\n-\tThe QoS profiles of the PDP context and EPS bearer are mapped as specified in TS 23.401 [89].\n-\tIf the S4-SGSN receives the EPS subscribed QoS profile per subscribed APN from the HSS, the S4-SGSN enforces this QoS for the first PDP context which is activated to the given APN. Otherwise the S4-SGSN restricts requested QoS according to the QoS Profile Subscribed which defines the maximum QoS per subscribed APN.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_15.3.0",
        "clause_9.2",
        "clause_15.3.3.4",
        "clause_9.2.3",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.1",
      "section_id": "9.2.1",
      "section_title": "Static and Dynamic PDP Addresses",
      "content": "PDP addresses can be allocated to an MS in four different ways:\n-\tthe HPLMN operator assigns a PDP address permanently to the MS (static PDP address);\n-\tthe HPLMN operator assigns a PDP address to the MS when a PDP context is activated (dynamic HPLMN PDP address);\n-\tthe VPLMN operator assigns a PDP address to the MS when a PDP context is activated (dynamic VPLMN PDP address); or\n-\tthe PDN operator or administrator assigns a permanent or dynamic PDP address to the MS (External PDN Address Allocation).\nNOTE 1:\tA PDP address consists of an IPv4 address and/or IPv6 prefix as described in clause 14.5.\nIt is the HPLMN operator that defines in the subscription whether a dynamic HPLMN or VPLMN PDP address can be used. The HPLMN operator may assign a static PDP address in the PDP context subscription record. An MS implemented according to this version of the protocol does not support static PDP addresses, which are permanently configured in the MS and sent by the MS within the PDP context activation request. The handling of static addresses, which are sent by the MS, is retained in the SGSN in order to ensure backwards compatibility for MSs implemented according to earlier protocol releases.\nFor every IMSI, zero, one, or more dynamic PDP addresses per PDP type can be assigned. For every IMSI, zero, one, or more static PDP addresses per PDP type can be subscribed to.\nWhen dynamic addressing from the HPLMN or the VPLMN is used, it is the responsibility of the GGSN or P‑GW to allocate and release the dynamic PDP address.\nWhen External PDN Address Allocation is used, the following applies for GGSN:\n-\tthe PLMN may obtain a PDP address from the PDN and provide it to the MS during PDP context activation, or the MS may directly negotiate a PDP address with the PDN after the PDP context activation procedure is executed. If the PLMN provides the address during PDP context activation in case of External PDN Address Allocation, then it is the responsibility of the GGSN and PDN to allocate, renew and release the dynamic PDP address by means of protocols such as DHCP or RADIUS. If DHCPv4/v6 is used, the GGSN provides the function of a DHCPv4/v6 Client. If RADIUS is used, the GGSN provides the function of a RADIUS Client. If the MS negotiates a PDP address with the PDN after PDP context activation in case of External PDN Address Allocation, it is the responsibility of the MS and the PDN to allocate and release the PDP address by means of protocols such as DHCP or MIP. In case of DHCPv4, the GGSN provides the function of a DHCP Relay Agent as defined in RFC 2131 [47] and RFC 1542 [45]. In case of MIP, the GGSN provides the function of a Foreign Agent as defined in RFC 3344 [46].\nExternal PDN Address Allocation (including DHCP functionality) in P‑GW is specified in TS 23.401 [89].\nOnly static PDP addressing is applicable in the network-requested PDP context activation case.\nPDP types IPv4, IPv6 and IPv4v6 are supported. A PDP Context of PDP type IPv4v6 may be associated with one IPv6 prefix only or with both one IPv4 address and one IPv6 prefix. PDP types IPv4 and IPv6 are utilised in case the MS and/or the GGSN or P‑GW support IPv4 addressing only or IPv6 addressing only; or operator preferences dictate the use of a single IP version type only, or the subscription is limited to IPv4 only or IPv6 only. In addition, PDP types IPv4 and IPv6 are utilised for interworking with nodes of earlier releases.\nThe way that the MS sets the requested PDP type may be pre-configured in the device per APN. Unless otherwise configured (including when the MS does not send any APN), PDP types are set by the MS as follows:\n-\tAn MS, which supports Non-IP data and wants to use Non-IP data, shall request for PDP type Non-IP.\nOtherwise:\n-\tAn MS, which is IPv6 and IPv4 capable, shall request for PDP type IPv4v6.\n-\tAn MS, which supports IPv4 addressing only, shall request for PDP type IPv4.\n-\tAn MS, which supports IPv6 addressing, shall request for PDP type IPv6.\n-\tWhen the IP addressing capability of the MS is not known in the MS (as in the case when the MT and TE are separated and the capability of the TE is not known in the MT), the MS shall request for PDP type IPv4v6.\nDuring the PDP Context Activation procedure the SGSN compares the requested PDP type to the PDP type in the subscription records for the given APN and sets the PDP type as follows:\n-\tIf the requested PDP type is allowed by subscription, the S4-SGSN sets the PDP type as requested.\n-\tIf the requested PDP type is allowed by subscription and if the requested PDP type is IPv4v6, the Gn/Gp SGSN sets the PDP type as requested if the GGSN supports PDP type IPv4v6. Otherwise, the SGSN shall set the PDP type to IPv4 or IPv6 where the selection between IPv4 and IPv6 is based on the result of the check.\nNOTE 2:\tThe check for PDP type IPv4v6 is implementation specific and configuration may be shared in roaming agreements.\nNOTE 3:\tA Gn/Gp SGSN assumes coherent support for PDP type IPv4v6 across all SGSNs in a PLMN.\n-\tIf the requested PDP type is IPv4v6 and subscription data only allows PDP type IPv4 or only allows PDP type IPv6, the SGSN sets the PDP type according to the subscribed value. A reason cause shall be returned to the UE indicating that only the assigned PDP type is allowed. In this case the UE shall not request for another PDP context to the same APN for the other IP version during the existence of the PDP context.\n-\tIf the requested PDP type is IPv4 or IPv6, and either the requested PDP type or PDP type IPv4v6 are subscribed, the SGSN sets the PDP type as requested. Otherwise the PDP context activation request is rejected.\n-\tIf the requested PDP type is IPv4v6, and both IPv4 and IPv6 PDP types are allowed by subscription but not IPv4v6, the SGSN shall set the PDP type to IPv4 or IPv6 where the selection between IPv4 and IPv6 is implementation specific. The MS should then initiate another PDP Context Activation procedure to this APN in order to activate a second PDP context with the other single address PDP type which was not allocated by the network.\nThe GGSN / PDN GW may restrict the usage of PDP type IPv4v6 as follows:\n-\tIf the MS requests PDP type IPv4v6, but the operator preferences dictate the use of a single IP version only, the PDP type shall be changed to a single address PDP type (IPv4 or IPv6) and a reason cause shall be returned to the MS indicating that only the assigned PDP type is allowed. In this case, the MS shall not request another PDP context for the other PDP type during the existence of the PDP context.\n-\tIf the MS requests PDP type IPv4v6, but the operator uses single addressing per PDP context due to interworking with nodes of earlier releases, the PDP type shall be changed to a single address PDP type and a reason cause of \"single address bearers only\" shall be returned to the MS. In this case the MS should request another PDP context for the other PDP type to the same APN with a single address PDP type (IPv4 or IPv6) other than the one already activated.\nNOTE 4:\tIf the MT and TE are separated, the MS might not be able to use reason cause \"single address bearers only\" as a trigger for activating a second single-stack PDP context.\nAn MS of this release may request for PDP type IPv4v6 from a SGSN which does not support this PDP type. The SGSN treats a request for PDP type IPv4v6 as if it were a request for PDP type IPv4. To enable dual-stack connectivity for this case, the MS should request another PDP context for PDP type IPv6 to the same APN.\nNOTE 5:\tIf the MS requests PDP type IPv4v6, and the PDP context is rejected due to \"unknown PDP type\", the MS can attempt to establish dual-stack connectivity by performing two PDP context request procedures to activate an IPv4 PDP context and an IPv6 PDP context, both to the same APN.\nThe mechanism used to allocate an IPv4 address to an MS depends on the MS and the network capabilities. The MS may indicate to the network within the Protocol Configuration Options element that the MS wants to obtain the IPv4 address with DHCPv4 as defined in RFC 2131 [47]:\n-\tthe MS may indicate that it prefers to obtain an IPv4 address as part of the PDP context activation procedure. In such a case, the MS relies on the network to provide an IPv4 address to the MS as part of the PDP context activation procedure.\n-\tthe MS may indicate that it prefers to obtain the IPv4 address after the PDP Context Activation by DHCPv4. That is, the network does not provide the IPv4 address for the MS as part of the PDP context activation procedures but sets the PDP address as 0.0.0.0. After the PDP Context establishment procedure is completed, the MS initiates the IPv4 address allocation by using DHCPv4 (see details in TS 29.061 [27] and RFC 2131 [47]).\nIf the MS does not send such an indication of address allocation preference, the network selects the IPv4 address allocation method based on per APN configuration.\nBoth the network elements and MS may support:\na.\tIPv4 address allocation and IPv4 parameter configuration after the attach procedure via DHCPv4 according to RFC 2131 [47] and RFC 4039 [117];\nb.\tIPv6 parameter configuration via Stateless DHCPv6 according to RFC 3736 [118].",
      "chunk_type": "general",
      "cross_references": [
        "clause_14.5",
        "ts_23.401",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.1.1",
      "section_id": "9.2.1.1",
      "section_title": "Stateless IPv6 Address Autoconfiguration",
      "content": "IPv6 address configuration is somewhat different from the IPv4 address configuration procedure. The address of an IPv6 node is allocated by stateless autoconfiguration.\nThe GGSN informs the MS that it shall perform stateless address autoconfiguration by means of the Router Advertisements, as defined in RFC 4861 [98]. For this purpose, the GGSN shall automatically and periodically send Router Advertisement messages towards the MS after a PDP context of type IPv4v6 or IPv6 is activated.\nIn order to support the standard IPv6 stateless address autoconfiguration mechanism, as defined by the IETF, within the particular context of UMTS (point-to-point connections, radio resource efficiency, etc.), the GGSN shall assign a prefix that is unique within its scope to each PDP context applying IPv6 stateless address autoconfiguration. The size of the prefix is according to the maximum prefix length for a global IPv6 address. This avoids the necessity to perform duplicate address detection at the network level for every address built by the MS. The GGSN shall not use the prefix advertised to the MS to configure an address on any of its interfaces.\nTo ensure that the link-local address generated by the MS does not collide with the link-local address of the GGSN, the GGSN shall provide an interface identifier (see RFC 4862 [99]) to the MS and the MS shall use this interface identifier to configure its link-local address. For stateless address autoconfiguration however, the MS can choose any interface identifier to generate addresses other than link-local, without involving the network. However, the UE shall not use any identifiers defined in TS 23.003 [4] as the basis for generating the interface identifier. For privacy, the UE may change the interface identifier used to generate full IPv6 address as defined in TS 23.221 [80], without involving the network. In particular, the SGSN and the GGSN are not updated with the actual address used by the MS, as the prefix alone identifies the PDP context.\nFigure 62 illustrates the IPv6 stateless autoconfiguration procedure The figure and its description show only the messages and actions specific to the IPv6 stateless address autoconfiguration procedure. For a complete description of the PDP Context Activation Procedure, refer to the corresponding clause.\nFigure 62: IPv6 Stateless Address Autoconfiguration Procedure\nNOTE 1:\tAll steps in Figure 62 except step 2 are common for architecture variants using Gn/Gp based interaction with Gn/Gp-based interaction with a GGSN and using S4-based interaction with an S‑GW and a P‑GW. For a S4-based interaction with a S‑GW and P‑GW, procedure step (A) is defined in clause 9.2.2.1A.\n1)\tThe MS sends an Activate PDP Context Request message to the SGSN as defined in clause \"PDP Context Activation Procedure\". The MS shall leave PDP Address empty and set PDP Type to IPv6 or IPv4v6.\n2)\tUpon reception of the Create PDP Context Request, the GGSN creates an IPv6 address composed of the prefix allocated to the PDP context and an interface identifier generated by the GGSN. This address is then returned in the PDP Address information element in the Create PDP Context Response message. The processing of the Create PDP Context Request and Create PDP Context Response, in both the SGSN and the GGSN, is otherwise as specified in clause \"PDP Context Activation Procedure\".\nNOTE 2:\tSince the MS is considered to be alone on its link towards the GGSN, the interface identifier does not need to be unique across all PDP contexts on any APN.\n3)\tThe MS receives the IPv6 address produced by the GGSN in the Activate PDP Context Accept. The MS extracts the interface identifier from the address received and stores it. The MS shall use this interface identifier to build its link-local address and may also use it for building its full IPv6 address, as describe in step 5. The MS shall ignore the prefix contained in the address received in the Activate PDP Context Accept. The processing of the Activate PDP Context Accept is otherwise as specified in clause \"PDP Context Activation Procedure\".\n4)\tThe MS may send a Router Solicitation message to the GGSN to activate the sending of the Router Advertisement message.\n5)\tThe GGSN sends a Router Advertisement message. The Router Advertisement messages shall contain the same prefix as the one provided in step 2. A given prefix shall not be advertised on more than one PDP context on a given APN, or set of APNs, within the same addressing scope. The GGSN shall be configured to advertise only one prefix per PDP context.\nAfter the MS has received the Router Advertisement message, it constructs its full IPv6 address by concatenating the interface identifier received in step 3, or a locally generated interface identifier, and the prefix received in the Router Advertisement. If the Router Advertisement contains more than one prefix option, the MS shall only consider the first one and silently discard the others.\nNOTE 3:\tThe MS can at any time change the interface identifier used to generate full IPv6 addresses, without involving the network, i.e. without updating the PDP context in the SGSN and the GGSN.\nBecause any prefix that the GGSN advertises in a PDP context is unique within the scope of the prefix (i.e. site-local or global), there is no need for the MS to perform Duplicate Address Detection for this IPv6 address. Therefore, the GGSN shall silently discard Neighbor Solicitation messages that the MS may send to perform Duplicate Address Detection. It is possible for the MS to perform Neighbor Unreachability Detection towards the GGSN, as defined in RFC 4861 [98]; therefore if the GGSN receives a Neighbor Solicitation as part of this procedure, the GGSN shall provide a Neighbor Advertisement as described in RFC 4862 [99].",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.2.1",
        "figure_62",
        "ts_23.003",
        "ts_23.221"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.1.2",
      "section_id": "9.2.1.2",
      "section_title": "IPv6 Prefix Delegation via DHCPv6",
      "content": "Optionally, a single network prefix shorter than the default /64 prefix may be assigned to a PDN connection. In this case, the /64 default prefix used for IPv6 stateless autoconfiguration will be allocated from this network prefix; the remaining address space from the network prefix can be delegated to the PDN connection using prefix delegation after the PDP context activation and IPv6 prefix allocation via IPv6 stateless address autoconfiguration as defined in clause 9.2.1.1. When PLMN based parameter configuration is used, the GGSN provides the requested IPv6 prefix from a locally provisioned pool. When external PDN based IPv6 prefix allocation is used, the GGSN obtains the prefix from the external PDN.\nNOTE 1:\tAllocation of IPv6 prefixes with flexible prefix length can leverage e.g. local configuration on the GGSN or interaction with the AAA server.\nThe address space provided is maintained as an IPv6 address space pool available to the PDN connection for DHCPv6 IPv6 prefix requests with the exclusion of the IPv6 prefix that is allocated to the PDP context during PDP context activation as defined in clause 9.2.1.1. The total IPv6 address space available for the PDP connection (the /64 default prefix and the remaining IPv6 address space pool) shall be possible to aggregate into one IPv6 prefix that will represent all IPv6 addresses that the MS may use. If the MS had indicated that it supports prefix exclusion and the prefix to be delegated to the UE includes the /64 prefix that was allocated to the PDN Connection, the GGSN shall utilise the prefix exclusion feature as specified for DHCPv6 Prefix Delegation in RFC 6603 [113].\nThe MS uses DHCPv6 to request additional IPv6 prefixes (i.e. prefixes in addition to the default prefix) from the GGSN after completing stateless IPv6 address autoconfiguration procedures. The MS acts as a \"Requesting Router\" as described in RFC 3633 [105] and inserts one or more IA_PD option(s) into a DHCPv6 Solicit message sent from the MS to the GGSN. The GGSN acts as the DHCP server and fulfils the role of a \"Delegating Router\" according to RFC 3633 [105]. The MS optionally includes the RAPID_COMMIT option in the DHCPv6 Solicit message to trigger two-message DHCPv6 procedure instead of the four-message DHCPv6 procedure. The MS shall include OPTION_PD_EXCLUDE option code in an OPTION_ORO option to indicate support for prefix exclusion. In response to the DHCPv6 Solicit message, the MS receives a DHCPv6 Reply message with one or more IA_PD prefix(es) for every IA_PD option that it sent in the DHCPv6 Solicit message. The GGSN delegates a prefix excluding the default prefix with help of OPTION_PD_EXCLUDE. Prefix exclusion procedures shall follow RFC 6603 [113].",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.1",
      "section_id": "9.2.2.1",
      "section_title": "PDP Context Activation Procedure",
      "content": "The PDP Context Activation procedure is illustrated in Figure 63 and Figure 64.\nFigure 63: PDP Context Activation Procedure for A/Gb mode\nFigure 64: PDP Context Activation Procedure for Iu mode\nNOTE 1:\tAll steps in figures 63 and 64, except steps 4 and 8, are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4-based interaction with S‑GW and P‑GW, procedure steps (A) and (B) are defined in clause 9.2.2.1A.\nIf Emergency Service is required and an emergency PDP Context is not already active the MS shall request a PDP Context for emergency services via emergency indication in the Activate PDP Context Request message when initiating the PDP Context Request Procedure. An emergency attached MS shall initiate the PDP Context Request procedure directly after the Attach procedure is completed. Any additional emergency PDP Context Activation by an MS shall be rejected by the SGSN if there is already an emergency PDP context activated.\n1)\tThe MS sends an Activate PDP Context Request (NSAPI, TI, PDP Type, PDP Address, Access Point Name, QoS Requested, Protocol Configuration Options, Request Type) message to the SGSN. In this version of the protocol, the MS shall leave PDP Address empty. The MS may use Access Point Name to select a reference point to a certain packet data network and/or to select a service. Access Point Name is a logical name referring to the packet data network and/or to a service that the subscriber wishes to connect to. QoS Requested indicates the desired QoS profile. For an E-UTRAN capable UE, the QoS requested shall indicate subscribed, interactive or background traffic class in this message. If the UE is not E-UTRAN capable, in this release the QoS requested should indicate subscribed, interactive or background traffic class in this message. If the request is as a result of a Network-Requested PDP context activation procedure, the MS shall not set the PDP Type to IPv4v6, but to the value received in the Request PDP Context Activation message: see clause 9.2.2.2.1.\nNOTE 2:\tIn case an S4-SGSN is used in the network the QoS Requested information element shall be ignored in the network.\nProtocol Configuration Options is used to transfer the NRSU, ETFTU, Address Allocation Preference and 3GPP PS Data Off status to the GGSN and may be used to transfer the BCM as well as optional PDP parameters and/or request to the GGSN (see TS 29.060 [26] and TS 24.229 [75]). Protocol Configuration Options is sent transparently through the SGSN. NRSU indicates MS support of the network requested bearer control. ETFTU indicates MS support of the extended TFT filter format. The Protocol Configuration Options may include the Address Allocation Preference indicating that the MS prefers to obtain an IPv4 address only after the PDP Context Accept by means of DHCPv4 as defined in RFC 2131 [47]. 3GPP PS Data Off status indicates whether 3GPP PS Data Off is activated or deactivated in the MS.\nIf the SGSN has stored a value for the Maximum APN restriction and the value indicates the most restrictive type, then the SGSN shall reject any Activate PDP Context requests to a different APN, using the PDP Context Activation Reject message including an appropriate error cause.\nIf the SGSN decides to establish Direct Tunnel between RNC and GGSN, the SGSN provides to the RNC the Direct Tunnel specific parameters in step 5 \"RAB Assignment Procedure\" and shall initiate PDP Context Update procedure in step 8 to update IP Address and TEID for Downlink data.\nRequest Type indicates \"Handover\" when the MS has already an activated PDN GW/HA due to mobility with non-3GPP accesses, and is only interpreted by SGSNs using S4.\nThe PDP context activation for emergency services shall be exempted from the Maximum APN restriction control. If there is already an emergency bearer activated, the SGSN shall reject any PDP context activation request for normal services if the mobility and access restrictions do not allow the MS to access normal services.\nIf the message is being sent via a HNB which has a collocated L-GW, it includes the L-GW address in the Direct Transfer message to the SGSN.\n2)\tIn A/Gb mode, security functions may be executed. These procedures are defined in clause \"Security Function\".\n3)\tIn A/Gb mode and if BSS trace is activated, the SGSN shall send an Invoke Trace (Trace Reference, Trace Type, Trigger Id, OMC Identity) message to the BSS. Trace Reference, and Trace Type are copied from the trace information received from the HLR or OMC.\n4)\tThe SGSN validates the Activate PDP Context Request using PDP Type (optional), PDP Address (optional), and Access Point Name (optional) provided by the MS and the PDP context subscription records. The SGSN shall use the CSG Subscription Data to authorize the LIPA connection to the APN provided by the MS. A PDP Address may only be sent by an MS implemented according to an earlier protocol release. The validation criteria, the APN selection criteria, and the mapping from APN to a GGSN are described in annex A.\nFor an emergency PDP Context Activation the SGSN applies the parameters from SGSN Emergency Configuration Data for the emergency bearer establishment performed in this step and any potentially stored IMSI related subscription data are ignored by the SGSN.\nIf no GGSN address can be derived or if the SGSN has determined that the Activate PDP Context Request is not valid according to the rules described in annex A, the SGSN rejects the PDP context activation request.\nIf a GGSN address can be derived, the SGSN creates a TEID for the requested PDP context. If the MS requests a dynamic address, the SGSN lets a GGSN allocate the dynamic address. The SGSN may restrict the requested QoS attributes given its capabilities and the current load, and it shall restrict the requested QoS attributes according to the subscribed QoS profile. If the UE requests the subscribed MBR and the subscribed MBR is larger than 16 Mbps, the SGSN should restrict the requested MBR to 16 Mbps or lower, if the \"Higher bitrates than 16 Mbps flag\" in the MM Context is set to \"not allowed\".\nIf the subscription context does not indicate that the APN is for a connection to an SCEF the SGSN sends a Create PDP Context Request (PDP Type, PDP Address, Access Point Name, QoS Negotiated, Negotiated Evolved ARP, TEID, NSAPI, MSISDN, Selection Mode, Charging Characteristics, Trace Reference, Trace Type, Trigger Id, OMC Identity, Protocol Configuration Options, serving network identity, CN Operator Selection Entity, Maximum APN Restriction IMEISV, CGI/SAI, User CSG Information, RAT type, S-CDR CAMEL information, MS Info Change Reporting support indication, NRSN, Dual Address Bearer Flag, APN-AMBR) message to the affected GGSN. MSISDN is included if available in the stored UE context otherwise IMSI is included. The Negotiated Evolved ARP IE shall contain the Subscribed Evolved ARP value. If the SGSN did not receive a Subscribed Evolved ARP value in subscription data from the HLR the SGSN shall derive this value from the Allocation/Retention Priority of the QoS profile negotiated according to Annex E in TS 23.401 [89]. The inclusion of the Negotiated Evolved ARP IE indicates that the SGSN supports the Evolved ARP feature. The SGSN shall send the serving network identity serving network identity and the CN Operator Selection Entity to the GGSN. The CN Operator Selection Entity indicates whether the Serving Network has been selected by the UE or by the network. Access Point Name shall be the APN Network Identifier of the APN selected according to the procedure described in Annex A. PDP Address shall be empty if a dynamic address is requested. The GGSN may use Access Point Name to find a packet data network and optionally to activate a service for this APN. Selection Mode indicates whether a subscribed APN was selected, or whether a non-subscribed APN sent by an MS or a non-subscribed APN chosen by the SGSN was selected. Selection Mode is set according to Annex A. The GGSN may use Selection Mode when deciding whether to accept or reject the PDP context activation. For example, if an APN requires subscription, the GGSN is configured to accept only the PDP context activation that requests a subscribed APN as indicated by the SGSN with Selection Mode. Charging Characteristics indicates which kind of charging the PDP context is liable for. The charging characteristics on the subscription and individually subscribed APNs as well as the way the SGSN handles Charging Characteristics and chooses to send them or not to the GGSN is defined in TS 32.251 [70]. The SGSN shall include Trace Reference, Trace Type, Trigger Id, and OMC Identity if GGSN trace is activated. The SGSN shall copy Trace Reference, Trace Type, and OMC Identity from the trace information received from the HLR or OMC. The Maximum APN Restriction denotes the most stringent restriction as required by any already active PDP contexts. If there are no already active PDP contexts, this value is set to the least restrictive type (see clause 15.4). If the GGSN receives the Maximum APN Restriction, then the GGSN shall check if the Maximum APN Restriction value does not conflict with the APN Restriction value associated with this PDP context request. If there is no conflict the request shall be allowed, otherwise the request shall be rejected with the SGSN sending a PDP Context Activation Reject Message to the MS including an appropriate error cause. NRSN indicates SGSN support of the network requested bearer control. The Dual Address Bearer Flag shall be set when the MS requests PDN type IPv4v6 and all SGSNs, which the MS may be handed over to, are Release 8 or above supporting dual addressing, which is determined based on node pre configuration by the operator. For PDN type \"non-IP\", if the APN subscription data indicate a SCEF connection needs to be used, the SGSN establishes a T6b connection as specified in TS 23.682 [119] using the SCEF address indicated in subscription data. Steps 4 and 8 are not further executed, but the rest of the interactions with the MS apply as specified below.\nFor emergency attached UEs IMSI is included if available and if the IMSI cannot be authenticated the IMSI is included and marked as unauthenticated.\nThe GGSN creates a new entry in its PDP context table and generates a Charging Id. The new entry allows the GGSN to route PDP PDUs between the SGSN and the packet data network, and to start charging. The way the GGSN handles Charging Characteristics that it may have received from the SGSN is defined in TS 32.251 [70]. The GGSN may restrict QoS Negotiated given its capabilities and the current load or increase the QoS Negotiated based on any external input (e.g. policy control). The GGSN then returns a Create PDP Context Response (TEID, PDP Type, PDP Address, Protocol Configuration Options, QoS Negotiated, Negotiated Evolved ARP, Charging Id, Prohibit Payload Compression, APN Restriction, Cause, MS Info Change Reporting Action, CSG Information Reporting Action, BCM, APN-AMBR, Delay Tolerant Connection) message to the SGSN. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall apply the Negotiated Evolved ARP if received from the GGSN. If the MS has requested PDP type IPv4v6 and both IPv4 and IPv6 addressing is possible in the PDN but the Dual Address Bearer Flag is not set, or only single IP version addressing is possible in the PDN, the GGSN selects a single IP version (either IPv4 or IPv6). If the MS has requested PDP type IPv4 or IPv6, the GGSN uses the PDP type supplied by the MS in case it is supported in the PDN, otherwise an appropriate error cause will be returned. The GGSN allocates a PDP Address according to the selected PDP type. For PDP Type Non-IP the GGSN performs IPv6 address allocation only if point-to-point tunnelling using UDP/IP encapsulation is used. If no IP address is allocated, no PDP address (or a dummy address) is returned If the GGSN has selected a PDN type different from the one sent by the MS, the GGSN indicates, together with the PDP type IE, a reason cause to the MS why the PDP type has been modified as described in clause 9.2.1. PDP Address is included if the GGSN allocated a PDP address. If the GGSN has been configured by the operator to use External PDN Address Allocation for the requested APN, PDP Address shall be set to 0.0.0.0, indicating that the PDP address shall be negotiated by the MS with the external PDN after completion of the PDP Context Activation procedure. The GGSN shall relay, modify and monitor these negotiations as long as the PDP context is in ACTIVE state, and use the GGSN-Initiated PDP Context Modification procedure to transfer the currently used PDP address to the SGSN and the MS. However, the MS cannot rely on always getting a session management level update of the IP address, which it has negotiated with the external PDN. This is because the P-GW does not update the IP address within the EPS bearer modification procedure, see clause 9.2.3.2A. Protocol Configuration Options contains the BCM, ETFTN as well as optional PDP parameters that the GGSN may transfer to the MS. BCM shall also be sent as a separate IE to the SGSN. The GGSN includes a Delay Tolerant Connection indication if the GGSN supports receiving a rejection cause indicating that the MS is temporarily not reachable due to power saving and holding the mobile terminated procedures, until the GGSN receives a message indicating that the MS is available for end to end signalling. These optional PDP parameters may be requested by the MS in the Activate PDP Context Request message, or may be sent unsolicited by the GGSN. Protocol Configuration Options is sent transparently through the SGSN. The Create PDP Context messages are sent over the backbone network. The BCM is used by the SGSN to handle unexpected session management signalling.\nIf QoS Negotiated received from the SGSN is incompatible with the PDP context being activated, the GGSN rejects the Create PDP Context Request message. The GGSN operator configures the compatible QoS profiles.\nIf an APN Restriction is received from the GGSN for this PDP Context, then the SGSN shall store this value for the PDP Context and the SGSN shall check this received value with the stored value for the Maximum APN Restriction to ensure there are no conflicts between values. If the consequence of this check results in the PDP context being rejected, the SGSN shall initiate a PDP Context Deactivation and return an appropriate error cause. If the PDP Context is accepted, it shall determine a (new) value for the Maximum APN Restriction. If there is no previously stored value for Maximum APN Restriction, then the Maximum APN Restriction shall be set to the value of the received APN Restriction.\nThe emergency PDP context activation shall be exempted from the Maximum APN restriction control.\nIf the MS Info Change Reporting Action and/or the CSG Information Reporting Action are received from the GGSN for this PDP context, then the SGSN shall store this for the PDP context and the SGSN shall report to that GGSN whenever a CGI/SAI/RAI or user CSG information change occurs that meets the GGSN request, as described in clause 15.1.1a.\nThe GGSN derives the BCM based on NRSU, NRSN and operator policy if previously received in the Create PDP Context Request message. The derived BCM is sent to the MS indicating the Bearer Control Mode applicable to all PDP Contexts within the activated PDP Address/APN pair.\nThe GGSN derives the ETFTN based on ETFTU and operator policy if ETFTU was previously received in the Create PDP Context Request message. The derived ETFTN is sent to the MS indicating that the extended TFT filter format can be used on all PDP Contexts within the activated PDP Address/APN pair.\nThe SGSN shall re-verify and may restrict the QoS Negotiated received in the response from the GGSN against the subscribed QoS profile and additionally restrict the QoS negotiated based on its capabilities and current load. The SGSN shall use this updated QoS Negotiated for the subsequent steps.\nThe SGSN shall apply a Negotiated Evolved ARP even if it is different from the Subscribed Evolved ARP.\nThe SGSN determines the UE AMBR to be used by the RAN based on the subscribed UE-AMBR and the APN AMBR for active APNs, see clause 15.2.2.\nIf the 3GPP PS Data Off UE Status was present in the Create PDP Context Request PCO, the GGSN shall include the 3GPP PS Data Off Support Indication in the Create PDP Context Response PCO if it supports the 3GPP PS Data Off feature.\nIf the GGSN detects that the 3GPP PS Data Off UE Status is active, the GGSN shall indicate this to the charging system for offline and online charging.\n5)\tIn Iu mode, RAB setup is done by the RAB Assignment procedure, see clause \"RAB Assignment Procedure\".\n6)\tIn Iu mode and if BSS trace is activated, the SGSN shall send an Invoke Trace (Trace Reference, Trace Type, Trigger Id, OMC Identity) message to the RAN. Trace Reference, and Trace Type are copied from the trace information received from the HLR or OMC.\nNOTE 3:\tStep 6 is applied when the trace activation is triggered by means of signalling. Another alternative is the triggering of trace activation by the OMC. The details of both Trace Activation procedures are described in TS 32.422 [84].\n7)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n8)\tIn case the QoS attributes, used as input to step 5 for Iu mode or step 7 for A/Gb mode, have been downgraded during those steps, the SGSN may inform the GGSN about the downgraded QoS attributes by sending an Update PDP Context Request to the affected GGSN. The GGSN shall not attempt to renegotiate the QoS attributes. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS attributes and that the GGSN shall accept the provided QoS attributes without negotiation. The GGSN confirms the new QoS attributes by sending an Update PDP Context Response to the SGSN. If the SGSN established Direct Tunnel in step 5 it shall send Update PDP Context Request and include the RNC's Address for User Plane, TEID for downlink data, No QoS negotiation indication and the DTI. DTI is used to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. If the No QoS negotiation indication is not set, e.g. by a pre-Rel-7 SGSN and the GGSN includes a PCO in the Update PDP Context Response, it shall contain same information as the Protocol Configuration Options IE sent in the Create PDP Context Response in step 4 above.\nIf the SGSN does not receive PCO in this step and it has received PCO in step 4, then the SGSN shall forward the PCO received in step 4 to the UE.\n9)\tThe SGSN inserts the NSAPI along with the GGSN address in its PDP context. The PDP address received from the GGSN or from HSS subscription records is inserted in the PDP context. The SGSN selects Radio Priority and Packet Flow Id based on QoS Negotiated, and returns an Activate PDP Context Accept (PDP Type, PDP Address, TI, QoS Negotiated, Radio Priority, Packet Flow Id, Protocol Configuration Options, WLAN offloadability indication) message to the MS. If the MS indicated in the MS Network Capability it does not support BSS packet flow procedures, then the SGSN shall not include the Packet Flow Id. In A/Gb mode, the QoS Negotiated shall take into account the Aggregate BSS QoS Profile, if any, returned from the BSS. Protocol Configuration Options are used to transfer the BCM and ETFTN to the UE and may be used to transfer optional PDP parameters to the UE (see TS 29.060 [26] and TS 24.229 [75]). Protocol Configuration Options is sent transparently through the SGSN. The BCM indicates the Bearer Control Mode applicable to all PDP Contexts within the activated PDP Address/APN pair. If the BCM parameter is not included in the message then the MS shall set the Bearer Control Mode to 'MS_Only' for the PDP Address/APN pair (see clause 9.2). If the ETFTN is included in the message then the MS may use the extended TFT filter format in subsequent MS requests. The SGSN is now able to route PDP PDUs between the GGSN and the MS, and to start charging.\nIf the MS is incapable of accepting the new QoS Negotiated, the MS should initiate application level signalling to lower the QoS requirements for the concerned application(s). If this is not possible then the MS shall instead de-activate the PDP context with the PDP Context Deactivation Initiated by the MS procedure.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\nFor each PDP Context a different quality of service (QoS) profile may be requested. For example, some PDP contexts may be associated with E‑mail that can tolerate lengthy response times. Other applications cannot tolerate delay and demand a very high level of throughput, interactive applications being one example. These different requirements are reflected in the QoS profile. The QoS profile is defined in clause \"Quality of Service Profile\". If a QoS requirement is beyond the capabilities of a PLMN, the PLMN negotiates the QoS profile as close as possible to the requested QoS profile. The MS either accepts the negotiated QoS profile, or deactivates the PDP context.\nAfter an SGSN has successfully updated the GGSN, the PDP contexts associated with an MS is distributed as shown in clause \"Information Storage\".\nIf the PDP Context Activation Procedure fails or if the SGSN returns an Activate PDP Context Reject (Cause, Protocol Configuration Options) message, the MS may attempt another activation to the same APN up to a maximum number of attempts.\nIf the MS requested for a dual address PDP type (IPv4v6) to a given APN and was granted a single address PDP type (IPv4 or IPv6) by the network with a reason cause 'single address bearers only', the MS should request for the activation of a parallel PDP Context to the same APN with a single address PDP type (IPv4 or IPv6) other than the one already activated.\nIf the MS requested for a PDP type IPv4v6 to a given APN and was granted PDP type IPv4 with no reason cause indicating that only the assigned PDP type is allowed, the MS should request for the activation of a parallel PDP Context to the same APN with PDP type IPv6.\nIf the MS receives no reason cause in response to an IPv4v6 PDP type and it receives an IPv6 prefix and Interface Identifier apart from the IPv4 address or 0.0.0.0 in the PDP Address field, it considers that the request for a dual address PDP was successful. It can wait for the Router Advertisement from the network with the IPv6 prefix information or it may send Router Solicitation if necessary.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Establishment.\nIn Figure 63 and Figure 64, procedures return as result \"Continue\".\nC2)\tCAMEL_GPRS_PDP_Context_Establishment_Acknowledgement.\nIn Figure 63 and Figure 64, procedures return as result \"Continue\".\n9.2.2.1A\tPDP Context Activation Procedure using S4\nThe procedures described in figures 64a and 64b show only the steps, due to use of S4, which are different from the Gn/Gp variant of the procedure given by clause 9.2.2.1.\nFigure 64a: PDP Context Activation Procedure steps (A) using S4\nNOTE 1:\tSteps A and D are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (A1) are defined in TS 23.402 [90]. Steps B and C concern GTP based S5/S8.\nIf there is already an emergency bearer activated, the SGSN shall reject any PDP context activation request for normal services if the mobility and access restrictions do not allow the MS to access normal services.\nA)\tThe SGSN shall use the HSS provided default APN if no APN is provided by the UE. If the PDN subscription context contains no PDN GW identity for this APN, or the APN has a LIPA permission of \"LIPA Only\" or \"LIPA Conditional\", the SGSN selects a PDN GW as described in clause PDN GW selection function. If the PDN subscription context profile contains a dynamically allocated PDN GW identity and the Request Type does not indicate \"Handover\" the SGSN may select a new PDN GW as described in clause PDN GW selection function, e.g. to allocate a PDN GW that allows for more efficient routing. If a Serving GW is not yet selected for this MS, the SGSN selects a Serving GW as described in clause Serving GW selection function. The SGSN sets the EPS Bearer Identity to an equivalent value as the NSAPI for the Bearer associated with the MS. Then the SGSN shall send a Create Session Request (IMSI, MSISDN, SGSN Control Plane TEID, PDN GW address, APN, RAT type, Default Bearer QoS, PDN Type, APN-AMBR, PDN Address, EPS Bearer Identity, Protocol Configuration Options, Handover Indication, ME Identity, User Location Information, serving network identity, CN Operator Selection Entity, SGSN User Plane TEID, Dual Address Bearer Flag, Protocol Type over S5/S8, Selection Mode, Charging Characteristics, Trace Reference, Trace Type, Trigger Id, OMC Identity, Maximum APN Restrictions, CGI/SAI, User CSG Information, MS Info Change Reporting support indication, DTI) message to the selected Serving GW. MSISDN is included if available in the stored UE context. The RAT type is provided in this message for the later PCC decision. The SGSN may change the requested PDP type according to the subscription data for this APN as described in clause 9.2.1. The Dual Address Bearer Flag shall be set when the MS requests PDN type IPv4v6 and all SGSNs, which the MS may be handed over to, are release 8 or above supporting dual addressing, which is determined based on node pre‑configuration by the operator. SGSN User Plane TEID shall not be sent if the SGSN decides to establish the Direct Tunnel between RNC and Serving GW. DTI is used to instruct the Serving GW that the Direct Tunnel shall be established between RNC and Serving GW.\nFor an emergency PDP Context Activation the SGSN applies the parameters from SGSN Emergency Configuration Data for the emergency bearer establishment performed in this step and any potentially stored IMSI related subscription data are ignored by the SGSN. For emergency attached UEs IMSI is included if available and if the IMSI cannot be authenticated the IMSI is included and marked as unauthenticated.\nThe Protocol Type over S5/S8 is provided to Serving GW which protocol should be used over S5/S8 interface. Handover Indication is included if the Request type indicates handover. Selection Mode indicates whether a subscribed APN was selected, or whether a non‑subscribed APN chosen by the SGSN was selected. Selection Mode is set according to Annex A. The P‑GW may use Selection Mode when deciding whether to accept or reject the default bearer activation. For example, if an APN requires subscription, the P‑GW is configured to accept only the default bearer activation that requests a subscribed APN as indicated by Selection Mode. Charging Characteristics indicates which kind of charging the bearer context is liable for. If there is an EPS subscription context available for the MS, the SGSN shall ignore the QoS requested parameter sent by the MS, and use the EPS subscribed QoS profile as received from the HSS. For MSs, for which the S4-SGSN has not received an EPS subscribed QoS profile, the S4-SGSN treats MS originated QoS requests the same as the Gn/Gp SGSN, i.e. the requested QoS is used when deriving the Default Bearer QoS and the APN-AMBR from the QoS requested parameter sent by the MS. If the \"Higher bitrates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", the S4-SGSN shall restrict the APN-AMBR in the EPS QoS profile to within 16 Mbps.\nThe ARP of the PDP context activated with this procedure should be set appropriately to minimize the risk of unnecessary release.\nThe charging characteristics for the PS subscription and individually subscribed APNs as well as the way of handling Charging Characteristics and whether to send them or not to the P‑GW is defined in TS 32.251 [70]. The SGSN shall include Trace Reference, Trace Type, Trigger Id, and OMC Identity if S‑GW and/or P‑GW trace is activated. The SGSN shall copy Trace Reference, Trace Type, and OMC Identity from the trace information received from the HLR or OMC.\nThe Maximum APN Restriction parameter is used as described for the equivalent step in clause 9.2.2.1.\nB)\tThe Serving GW creates a new entry in its EPS Bearer table and sends a Create Session Request (IMSI, MSISDN, APN, Serving GW Address for the user plane, Serving GW TEID of the user plane, Serving GW TEID of the control plane, RAT type, Default Bearer QoS, PDN Type, PDN Address, APN-AMBR, EPS Bearer Identity, Protocol Configuration Options, Handover Indication, ME Identity, User Location Information, serving network identity, CN Operator Selection Entity, Dual Address Bearer Flag, Selection Mode, Charging Characteristics, Trace Reference, Trace Type, Trigger Id, OMC Identity, Maximum APN Restriction, CGI/SAI, User CSG Information, MS Info Change Reporting support indication) message to the PDN GW indicated by the PDN GW address received in the previous step. MSISDN is included if available in the stored UE context. The PDN GW may interact with PCRF (refer to TS 23.203 [88]).\nFor emergency attached UEs IMSI is included if available and if the IMSI cannot be authenticated the IMSI is included and marked as unauthenticated.\nC)\tThe P‑GW creates a new entry in its EPS bearer context table and generates a Charging Id. The new entry allows the P‑GW to route user plane PDUs between the S‑GW and the packet data network, and to start charging. The way the P‑GW handles Charging Characteristics that it may have received is defined in TS 32.251 [70].\nThe PDN GW may restrict or increase Default Bearer QoS based on external input e.g. PCRF.\nThe PDN GW returns a Create Session Response (PDN GW Address for the user plane, PDN GW TEID of the user plane, PDN GW Address for the control plane, PDN GW TEID of the control plane, PDN Type, PDN Address, APN-AMBR, EPS Bearer Identity, EPS Bearer QoS, Protocol Configuration Options, Charging Id, Prohibit Payload Compression, APN Restriction, Cause, MS Info Change Reporting Action, CSG Information Reporting Action, Presence Reporting Area Action, Delay Tolerant Connection) message to the Serving GW. The PDN GW takes into account the PDN type sent by the MS, the Dual Address Bearer Flag and the policies of operator when the PDN GW selects the PDN type to be used as follows. If the MS has requested PDN type IPv4v6 and both IPv4 and IPv6 addressing is possible in the PDN but the Dual Address Bearer Flag is not set, or only single IP version addressing is possible in the PDN, the PDN GW selects a single IP version (either IPv4 or IPv6). If the MS has requested PDN type IPv4 or IPv6, the PDN GW uses the PDN type supplied by the MS in case it is supported in the PDN, otherwise an appropriate error cause will be returned. The PDN GW allocates a PDN Address according to the selected PDN type. In case the PDN GW has selected a PDN type different from the one sent by the MS, the PDN GW indicates together with the PDN type IE a reason cause to the MS why the PDN type has been modified as described in clause 9.2.1. PDN Address is included if the P‑GW allocated a PDN Address. If the PDN has been configured by the operator so that the PDN addresses for the requested APN shall be allocated by usage of DHCPv4 only, or if the PDN GW allows the MS to use DHCPv4 for address allocation according to the Address Allocation Preference received from the MS, the PDN Address shall be set to 0.0.0.0, indicating that the IPv4 PDN address shall be negotiated by the MS with DHCPv4 after completion of the PDP Context Activation procedure. In case of external PDN addressing for IPv6, the PDN GW obtains the IPv6 prefix from the external PDN using either RADIUS or Diameter client function. In the PDN Address field of the Create Session Response, the PDN GW includes the Interface Identifier and IPv6 prefix. The PDN GW sends Router Advertisement to the UE after default bearer establishment with the IPv6 prefix information for all cases. The IP address allocation details are described in the clause \"Static and Dynamic PDP Addresses\". The PDN GW includes a Delay Tolerant Connection indication if the PDN GW supports receiving a rejection cause from the SGW indicating that the MS is temporarily not reachable due to power saving and holding mobile terminated procedures, until the PDN GW receives a message indicating that the MS is available for end to end signalling.\nWhen the MS negotiates the IPv4 address with DHCPv4, the PDN GW shall relay, modify and monitor these negotiations. However, in contrast to the GGSN procedures, the PDN GW shall not update the IPv4 address to the SGSN nor to the MS.\nThe P‑GW derives the BCM based on NRSU and operator policy if previously received in the Create Default Bearer Request message. The derived BCM is sent to the MS indicating the Bearer Control Mode applicable to all PDP Contexts within the activated PDP Address/APN pair.\nThe P‑GW derives the ETFTN based on ETFTU, if received in the Create PDP Context Request message, and operator policy. The derived ETFTN is sent to the MS indicating whether the extended TFT filter format can be used on all PDP Contexts within the activated PDP Address/APN pair.\nProtocol Configuration Options contains the BCM, ETFTN as well as optional PDN parameters that the P‑GW may transfer to the MS. These optional PDN parameters may be requested by the MS, or may be sent unsolicited by the P‑GW. Protocol Configuration Options are sent transparently through the S‑GW and SGSN.\nWhen the Handover Indication is present, the PDN GW does not yet send downlink packets to the SGW; the downlink path is to be switched at step A1 of Figure 64b.\nIf the 3GPP PS Data Off status is present in PCO, PDN GW behaviour is as specified in TS 23.401 [89].\nD)\tThe Serving GW returns a Create Session Response (PDN Type, PDN Address, Serving GW address for User Plane, Serving GW TEID for User Plane, Serving GW TEID for Control Plane, APN-AMBR, EPS Bearer Identity, EPS Bearer QoS, PDN GW addresses and TEIDs (GTP‑based S5/S8) or GRE keys (PMIP‑based S5/S8) at the PDN GW(s) for uplink traffic, PDN GW Address for Control Plane, PDN GW TEID for Control Plane, Protocol Configuration Options, Charging Id, Prohibit Payload Compression, APN Restriction, Cause, MS Info Change Reporting Action, CSG Information Reporting Action, Presence Reporting Area Action, Delay Tolerant Connection) message to the SGSN. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context.\nIf an APN Restriction is received from the P‑GW for this PDP Context, then the SGSN shall store this value for the PDP Context and the SGSN shall check this received value with the stored value for the Maximum APN Restriction to ensure there are no conflicts between values. If the consequence of this check results in the PDP Context being rejected, the SGSN shall initiate a PDP Context deactivation and return an appropriate error cause. If the PDP Context is accepted, it shall determine a (new) value for the Maximum APN Restriction. If there is no previously stored value for Maximum APN Restriction, then the Maximum APN Restriction shall be set to the value of the received APN Restriction.\nWhen the PDN GW has changed Default Bearer QoS the SGSN shall use the new QoS parameter values during establishment of the PDP Context. However, if the \"Higher bit rates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps.\nIf the MS Info Change Reporting Action and/or the CSG Information Reporting Action are received for this bearer context, then the SGSN shall store this for the bearer context and the SGSN shall report to that P‑GW via the S-GW whenever a CGI/SAI/RAI or user CSG information change occurs that meets the P‑GW request, as described in clause 15.1.1a.\nIf Presence Reporting Area Action is received for this bearer context, the S4-SGSN shall store this for the bearer context and shall report to that P-GW via the S-GW whenever a change of UE presence in Presence Reporting Area is detected, as described in clause 15.1.3.1.\nFigure 64b: PDP Context Activation Procedure steps (B) using S4\nNOTE 3:\tSteps A and B are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8.\nNOTE 4:\tThe steps A1 and A2 are executed only upon handover from non-3GPP access.\nA)\tIn case the QoS attributes, used as input to step 5 for Iu mode or step 7 for A/Gb mode, have been downgraded during those steps, the SGSN rejects the PDP Context Activation and terminates the procedure. If the SGSN established Direct Tunnel in step 5 it shall send Modify Bearer Request and include the RNC's Address for User Plane, TEID for downlink data and DTI. DTI is used to instruct the S‑GW to apply Direct Tunnel specific error handling as described in clause 13.8. An Update Bearer Request shall also be sent to the S‑GW if the UE has indicated Request type \"Handover\" in the Activate PDP Context Request message, and in that case the Handover Indicator shall be included in the message. An Update Bearer Request shall also be sent to the S‑GW if the SGSN has been requested to report a change of UE presence in Presence Reporting Area, and in that case the message shall include the Presence Reporting Area Information comprising the PRA identifier(s) and indication(s) on whether the UE is inside or outside the area(s). When receiving the request for reporting change of UE presence in Presence Reporting Area, and the S4-SGSN decides not to activate reporting UE presence in one or more of the received Presence Reporting Area(s), the S4-SGSN reports also the inactive Presence Reporting Area(s) in this message.\nA1)\tIf the Handover Indication is included in step A, the Serving GW sends a Modify Bearer Request(Handover Indication) message to the PDN to prompt the PDN GW to tunnel packets from non 3GPP IP access to 3GPP access system and immediately start routing packets to the Serving GW for the default and any dedicated EPS bearers established. If Presence Reporting Area Information is included in step A, the Serving GW sends a Modify Bearer Request (Presence Reporting Area Information) message to the PDN GW.\nNOTE 5:\tThe PDN GW forwards the Presence Reporting Area Information to the PCRF and/or the OCS as defined in TS 23.203 [88].\nA2)\tThe PDN GW acknowledges by sending Modify Bearer Response to the Serving GW.\nB)\tThe Serving GW acknowledges by sending Modify Bearer Response to the SGSN. The Serving GW can then send its buffered downlink packets.\nC)\tAfter the SGSN receives Modify Bearer Response in step B, if an EPS bearer was established and if the subscription data indicates that the user is allowed to perform handover to non-3GPP accesses and if the SGSN selected a PDN GW that is different from the PDN GW identity which was indicated by the HSS in the PDN subscription context, the SGSN shall send an Update Location Request including the PDN GW identity, the APN and information identifying the PLMN in which the PDN GW is located to the HSS for mobility with non‑3GPP accesses.\nIf the MS is emergency Attached, SGSN shall not send any Update Location Request to an HSS.\nD)\tThe HSS stores the PDN GW identity and the associated APN, and sends an Update Location Response to the SGSN.\nIf the S6d interface is used between an S4-SGSN and HSS, the messages \"Update Location Request\" and \"Update Location Response\" shall be replaced with \"Notify Request\" and \"Notify Response\".\nIf the MS requested for a dual address PDP type (IPv4v6) to a given APN and was granted a single address PDP type (IPv4 or IPv6) by the network with a reason cause 'single address bearers only', the MS should request for the activation of a parallel PDP Context to the same APN with a single address PDP type (IPv4 or IPv6) other than the one already activated. If the MS receives no reason cause in response to an IPv4v6 PDP type and it receives an IPv6 prefix and Interface Identifier apart from the IPv4 address or 0.0.0.0 in the PDN Address field, it considers that the request for a dual address PDP was successful. The MS shall ignore the IPv6 prefix as described in the step 3 in clause 9.2.1.1. It can wait for the Router Advertisement from the network with the IPv6 prefix information or it may send Router Solicitation if necessary.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.2.1",
        "clause_9.2.2.2.1",
        "clause_15.4",
        "clause_9.2.1",
        "clause_9.2.3.2",
        "clause_15.1.1",
        "clause_15.2.2",
        "clause_13.8",
        "clause_9.2",
        "clause_5.3.21",
        "clause_15.1.3.1",
        "clause_9.2.1.1",
        "figure_63",
        "figure_64",
        "ts_29.060",
        "ts_24.229",
        "ts_23.401",
        "ts_32.251",
        "ts_23.682",
        "ts_32.422",
        "ts_23.078",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.1.1",
      "section_id": "9.2.2.1.1",
      "section_title": "Secondary PDP Context Activation Procedure",
      "content": "The Secondary PDP Context Activation procedure may be used to activate a PDP context while reusing the PDP address and other PDP context information from an already active PDP context, but with a different QoS profile. Procedures for APN selection and PDP address negotiation are not executed. A unique TI and a unique NSAPI shall identify each PDP context sharing the same PDP address and APN.\nAny emergency secondary PDP context activation procedure shall be initiated by the network. An MS with an active emergency PDP context shall not initiate the Secondary PDP Context Activation procedure for the emergency PDN connection unless triggered by the Network Requested Secondary PDP Context Procedure.\nIn the Secondary PDP Context Activation procedure the MS shall provide a TFT. The TFT contains attributes that specify an IP header filter that is used to route downlink N-PDUs to the newly activated PDP context (as described in clause 9.3). The TFT may also contain attributes that specify an IP header filter that is used to identify uplink IP flow(s) to apply policy control functionality as described in TS 23.203 [88].\nThe Secondary PDP Context Activation procedure may only be initiated after a PDP context is already activated for the same PDP address and APN. The procedure is illustrated in Figure 65 and Figure 66.\nFigure 65: Secondary PDP Context Activation Procedure for A/Gb mode\nNOTE 1:\tSteps 1, 2, 5 and 7 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 9.2.2.1.1A and procedure steps (B) are defined in clause 9.2.2.1.1B.\nFigure 66: Secondary PDP Context Activation Procedure for Iu mode\nNOTE 2:\tSteps 1, 4 and 7 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure part (A) is defined in clause 9.2.2.1.1A.\n1)\tThe MS sends an Activate Secondary PDP Context Request (Linked TI, NSAPI, TI, QoS Requested, TFT, Protocol Configuration Options) message to the SGSN. Linked TI indicates the TI value assigned to any one of the already activated PDP contexts for this PDP address and APN. QoS Requested indicates the desired QoS profile. TFT is sent transparently through the SGSN to the GGSN to enable packet classification for downlink data transfer. TI and NSAPI contain values not used by any other activated PDP context. Protocol Configuration Options may be used to transfer optional PDP parameters and/or requests to the GGSN (see TS 29.060 [26] and TS 24.229 [75]). Protocol Configuration Options is sent transparently through the SGSN.\nIf the SGSN decides to establish Direct Tunnel between RNC and GGSN, the SGSN provides to the RNC the Direct Tunnel specific parameters in step 4 \"RAB Assignment Procedure\" and shall initiate PDP Context Update procedure in step 6 to update IP Address and TEID for Downlink data.\n2)\tIn A/Gb mode, security functions may be executed. These procedures are defined in clause \"Security Function\".\n3)\tThe SGSN validates the Activate Secondary PDP Context Request using the TI indicated by Linked TI. The same GGSN address is used by the SGSN as for the already-activated PDP context(s) for that TI and PDP address.\nThe SGSN may restrict the requested QoS attributes given its capabilities and the current load, and it shall restrict the requested QoS attributes according to the subscribed QoS profile, which represents the maximum QoS per PDP context to the associated APN. The GGSN may restrict or increase, and negotiate the requested QoS as specified in clause \"PDP Context Activation Procedure\". The SGSN sends a Create PDP Context Request (QoS Negotiated, TEID, NSAPI, Primary NSAPI, TFT, Protocol Configuration Options, serving network identity, IMEISV, CGI/SAI, RAT type, S-CDR CAMEL information, CGI/SAI/RAI change support indication, Correlation-ID) message to the affected GGSN. The SGSN shall send the serving network identity to the GGSN. Primary NSAPI indicates the NSAPI value assigned to any one of the already activated PDP contexts for this PDP address and APN. TFT is included only if received in the Activate Secondary PDP Context Request message. Protocol Configuration Options is sent transparently through the SGSN if received in the Activate secondary PDP Context Request message. If the Secondary PDP Context Activation Procedure is performed as part of the Network Requested Secondary PDP Context Activation Procedure (clause 9.2.2.3) and if the GGSN included Negotiated Evolved ARP in the Initiate PDP Context Activation then the SGSN shall include the provided negotiated Evolved ARP in the Create PDP Context Request. The Correlation-ID shall only be included if the Secondary PDP Context Activation is performed as part of the Network Requested Secondary PDP Context Activation Procedure (clause 9.2.2.3), and shall be linked to the TI as described in clause 9.2.2.3.\nThe GGSN uses the same packet data network as used by the already activated PDP context(s) for that PDP address, generates a new entry in its PDP context table, and stores the TFT. The new entry will allow the GGSN to route PDP PDUs via different GTP tunnels between the SGSN and the packet data network. The GGSN returns a Create PDP Context Response (TEID, QoS Negotiated, Negotiated Evolved ARP, Cause, Protocol Configuration Options, Prohibit Payload Compression, APN Restriction, CGI/SAI/RAI change report required) message to the SGSN. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. Protocol Configuration Options may be used to transfer optional PDP parameters to the UE (see TS 29.060 [26] and TS 24.229 [75]). The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. If an APN Restriction is received from the GGSN for this PDP Context, then the SGSN shall store this value for the PDP Context.\nIf the CGI/SAI/RAI report required is received from the GGSN for this PDP context, then the SGSN shall store this for the PDP context and the SGSN shall report to that GGSN whenever a CGI/SAI/RAI change occurs that meets the GGSN request.\nThe SGSN shall re-verify and may restrict the QoS Negotiated received from the GGSN against the subscribed QoS profile and additionally restrict the QoS negotiated based on its capabilities and current load. The SGSN shall use this updated QoS Negotiated for the subsequent steps.\nThe SGSN shall apply a Negotiated Evolved ARP even if it is different from the Subscribed Evolved ARP.\nThe GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\n4)\tIn Iu mode, RAB setup is done by the RAB Assignment procedure.\n5)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n6)\tThe SGSN sends an Update PDP Context Request message to the GGSN, including the QoS attributes that have been accepted by the RAN. In case the QoS attributes have been downgraded in step 5 for A/Gb mode or in step 4 for Iu mode, the SGSN may inform the GGSN about the downgraded QoS. The GGSN shall not attempt to renegotiate the QoS attributes. A RAN Procedures Ready flag is included in the Update PDP Context Request. A GGSN that receives an Update PDP Context Request with a RAN Procedures Ready flag set, should start to route downlink PDP PDUs immediately. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS attributes and that the GGSN shall accept the provided QoS attributes without negotiation. The GGSN confirms the reception of the message and the potentially downgraded QoS attributes by sending an Update PDP Context Response to the SGSN. If the SGSN established Direct Tunnel in step 4 it shall send Update PDP Context Request and include the RNC's Address for User Plane and downlink TEID for data, the No QoS negotiation indication and DTI. DTI is used to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. If the No QoS negotiation indication is not set, e.g. by a pre-Rel-7 SGSN and the GGSN includes a PCO in the Update PDP Context Response, it shall contain same information as the Protocol Configuration Options IE sent in the Create PDP Context Response in step 3 above.\nIf the SGSN does not receive PCO in this step and it has received PCO in step 3, then the SGSN shall forward the PCO received in step 3 to the UE.\n7)\tThe SGSN selects Radio Priority and Packet Flow Id based on QoS Negotiated, and returns an Activate Secondary PDP Context Accept (TI, QoS Negotiated, Radio Priority, Packet Flow Id, Protocol Configuration Options, WLAN offloadability indication) message to the MS. If the MS indicated in the MS Network Capability it does not support BSS packet flow procedures, then the SGSN shall not include the Packet Flow Id. In A/Gb mode, the QoS Negotiated shall take into account the Aggregate BSS QoS Profile, if any, returned from the BSS. Protocol Configuration Options is sent transparently through the SGSN if received in the Create PDP Context Response message. The SGSN is now able to route PDP PDUs between the GGSN and the MS via different GTP tunnels and possibly different LLC links.\nIf the MS is incapable of accepting the new QoS Negotiated, the MS should initiate application level signalling to lower the QoS requirements for the concerned application(s). If this is not possible then the MS shall instead de-activate the PDP context with the PDP Context Deactivation Initiated by the MS procedure.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\nFor each additionally activated PDP context a QoS profile and TFT may be requested.\nIf the secondary PDP context activation procedure fails or if the SGSN returns an Activate Secondary PDP Context Reject (Cause, Protocol Configuration Options) message, the MS may attempt another activation with a different TFT, depending on the cause.\nThe CAMEL procedure calls shall be performed, see referenced procedures in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Establishment.\nIn Figure 65 and in Figure 66, procedures return as result \"Continue\".\nC2)\tCAMEL_GPRS_PDP_Context_Establishment_Acknowledgement.\nIn Figure 65 and in Figure 66, procedures return as result \"Continue\".\n9.2.2.1.1A\tSecondary PDP Context Activation Procedure, PDP Creation part, using S4\nThe procedure described in figure 66a shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clause 9.2.2.1.1.\nFigure 66a: Secondary PDP Context Activation Procedure using S4\nNOTE 1:\tSteps A, D and E are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure parts (A1) and (A2) are defined in TS 23.402 [90]. Steps B, C and F concern GTP-based S5/S8.\nA)\tThe SGSN validates the Activate Secondary PDP Context Request using the TI indicated by Linked TI. The same P‑GW and S‑GW addresses are used by the SGSN as for the already-activated PDP context(s) for that TI and PDP address.\nNOTE 2:\tThe EPS Bearer QoS parameters for the traffic flow aggregate are derived from the QoS Release 99 profile.\nThe Procedure Transaction Id, PTI, is dynamically allocated by the SGSN for the Activate Secondary PDP Context procedure when using S4. The SGSN should ensure as far as possible that previously used PTI values are not immediately reused for the same MS. The SGSN shall store the relationship between the assigned PTI and the received Linked TI during the lifetime of the procedure. The PTI is released when the procedure is completed.\nThe SGSN sends the Bearer Resource Command (LBI, PTI, EPS Bearer QoS (excluding ARP), TFT, RAT type, Protocol Configuration Options) message to the selected Serving GW. The same Serving GW is used by the SGSN as for the PDP Context identified by the Linked TI received in the Activate Secondary PDP Context Request message.\nB)\tThe Serving GW sends the Bearer Resource Command (LBI, PTI, EPS Bearer QoS (excluding ARP), TFT, RAT type, Protocol Configuration Options) message to the PDN GW. The Serving GW sends the message to the same PDN GW as for the EPS Bearer identified by the Linked Bearer Id. The PDN GW derives from the RAT type indicating GERAN or UTRAN and the absence of the EPS Bearer Id that a new EPS Bearer needs to be established. The PDN GW may interact with PCRF (refer to TS 23.203 [88]) and provides to the PCRF the TFT operation add together with the new filter(s) and the QCI and/or GBR, if available. The PDN GW shall accept packet filter identifiers specified by the MS in the TFT.\nC)\tIf the request is accepted, the Dedicated Bearer Activation Procedure is invoked to establish a new EPS Bearer by the PDN GW and the PDN GW sends the Create Bearer Request (PTI, EPS Bearer QoS, TFT, S5/S8-TEID, LBI, Protocol Configuration Options) message to the Serving GW. The PTI allocated by the SGSN is used as a parameter in the invoked Dedicated Bearer Activation Procedure to correlate it to the Activate Secondary PDP Context Procedure. The PDN GW shall assign packet filter identifiers as specified in the TFT received with the Bearer Resource Command for the corresponding TFT filters. The PDN GW/PCRF may restrict or increase, and negotiate the requested QoS as specified in clause \"PDP Context Activation Procedure\". If the PCRF was contacted, the EPS Bearer QoS is updated according to the QoS of the received PCC rules. In addition, the PDN GW uses the SDF filter(s) in the PCC rule(s) received from the PCRF to generate the TFT. The PDN GW maintains the relation between the SDF filter identifier in the PCC rule and the packet filter identifier of the TFT.\nIf the request for a specific QoS is not accepted or the request does not include a TFT, or the PCC rule(s) received from the PCRF include any SDF filter (that is to to be provided to the MS) that was not requested by the MS, the PDN GW sends a reject indication, which shall be delivered to the MS. A cause indicates the reason why the request was rejected.\nD)\tThe Serving GW sends the Create Bearer Request (PTI, EPS Bearer QoS, TFT, UL TEID, LBI, Protocol Configuration Options) message to the SGSN. If the \"Higher bit rates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps.\nE)\tThe SGSN acknowledges the bearer activation to the Serving GW by sending a Create Bearer Response (EPS Bearer Identity, DL TEID, User Location Information) message. The SGSN sets the EPS Bearer Identity to the same value as the NSAPI for the Bearer associated with the MS. The DL TEID value can be either the SGSN user plane TEID (2G or non-DT 3G) or the RNC user plane TEID.\nF)\tThe Serving GW acknowledges the bearer activation to the PDN GW by sending a Create Bearer Response (EPS Bearer Identity, S5/S8-TEID, User Location Information) message. The PDN GW may interact with PCRF (refer to TS 23.203 [88]). The PDN GW may deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF (refer to TS 23.203 [88]).\nNOTE 3:\tThe Serving GW determines that a Create Dedicated Bearer Response belongs to a previously sent Create Dedicated Bearer Request based on protocol specific details as described in TS 29.274 [92].\n9.2.2.1.1B\tVoid",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.3",
        "clause_9.2.2.1.1",
        "clause_9.2.2.3",
        "clause_13.8",
        "clause_5.3.21",
        "figure_65",
        "figure_66",
        "ts_23.203",
        "ts_29.060",
        "ts_24.229",
        "ts_23.401",
        "ts_23.078",
        "ts_23.402",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.2",
      "section_id": "9.2.2.2",
      "section_title": "Network-Requested PDP Context Activation Procedure",
      "content": "NOTE:\tThese procedures only apply for SGSNs using Gn/Gp\nThe Network-Requested PDP Context Activation procedure allows the GGSN to initiate the activation of a PDP context. When receiving a PDP PDU the GGSN checks if a PDP context is established for that PDP address. If no PDP context has been previously established, the GGSN may try to deliver the PDP PDU by initiating the Network-Requested PDP Context Activation procedure. The criteria used by the GGSN to determine whether trying to deliver the PDP PDU to the MS may be based on subscription information are outside the scope of GPRS standardisation.\nTo support Network-Requested PDP Context Activation, the GGSN has to have static PDP information about the PDP address. To determine whether Network-Requested PDP Context Activation is supported for a PDP address, the GGSN checks if there is static PDP information for that PDP address.\nOnce these checks have been performed the GGSN may initiate the Network-Requested PDP Context Activation procedure.\nThe network operator may implement the following techniques to prevent unnecessary enquires to the HLR:\n-\tImplementation of the Mobile station Not Reachable for GPRS flag (MNRG) technique in GGSN, SGSN, and HLR (see clause \"Unsuccessful Network-Requested PDP Context Activation Procedure\").\n-\tThe GGSN may reject or discard PDP PDUs after a previous unsuccessful delivery attempt. This systematic rejection of PDP PDUs would be performed during a certain time after the unsuccessful delivery.\n-\tThe GGSN may store the address of the SGSN with which the GGSN established the last PDP context. This would prevent an enquiry to the HLR. This SGSN address would be considered as valid during a certain time.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.2.2.2.1",
      "section_id": "9.2.2.2.1",
      "section_title": "Successful Network-Requested PDP Context Activation Procedure",
      "content": "The Successful Network-Requested PDP Context Activation procedure is illustrated in Figure 67.\nFigure 67: Successful Network-Requested PDP Context Activation Procedure\n1)\tWhen receiving a PDP PDU the GGSN determines if the Network-Requested PDP Context Activation procedure has to be initiated. The GGSN may store subsequent PDP PDUs received for the same PDP address.\n2)\tThe GGSN may send Send Routeing Information for GPRS (IMSI) message to the HLR. If the HLR determines that the request can be served, it returns Send Routeing Information for GPRS Ack (IMSI, SGSN Address, Mobile Station Not Reachable Reason) message to the GGSN. The Mobile Station Not Reachable Reason parameter is included if the MNRG flag is set in the HLR. The Mobile Station Not Reachable Reason parameter indicates the reason for the setting of the MNRG flag as stored in the MNRR record (see GSM 03.40). If the MNRR record indicates a reason other than \"No Paging Response\", the HLR shall include the GGSN number in the GGSN‑list of the subscriber.\nIf the HLR determines that the request cannot be served (e.g. IMSI unknown in HLR), the HLR shall send a Send Routeing Information for GPRS Ack (IMSI, MAP Error Cause) message. Map Error Cause indicates the reason for the negative response.\n3)\tIf the SGSN address is present and either Mobile Station Not Reachable Reason is not present or Mobile Station Not Reachable Reason indicates \"No Paging Response\", the GGSN shall send a PDU Notification Request (IMSI, PDP Type, PDP Address, APN) message to the SGSN indicated by the HLR. Otherwise, the GGSN shall set the MNRG flag for that MS. The GGSN shall not use PDP Type IPv4v6. The SGSN returns a PDU Notification Response (Cause) message to the GGSN in order to acknowledge that it shall request the MS to activate the PDP context indicated with PDP Address.\n4)\tThe SGSN sends a Request PDP Context Activation (TI, PDP Type, PDP Address, APN) message to request the MS to activate the indicated PDP context.\n5)\tThe PDP context is activated with the PDP Context Activation procedure (see clause \"PDP Context Activation Procedure\").",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_67"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.2.2",
      "section_id": "9.2.2.2.2",
      "section_title": "Unsuccessful Network-Requested PDP Context Activation Procedure",
      "content": "If the PDP context requested by the GGSN cannot be established, the SGSN sends a PDU Notification Response (Cause) or a PDU Notification Reject Request (IMSI, PDP Type, PDP Address, Cause) message to the GGSN depending on if the context activation fails before or after the SGSN has sent a Request PDP Context Activation message to the MS. Cause indicates the reason why the PDP context could not be established:\n-\t\"IMSI Not Known\". The SGSN has no MM context for that IMSI (Cause in PDU Notification Response).\n-\t\"MS GPRS Detached\". The MM state of the MS is IDLE (Cause in PDU Notification Response).\n-\t\"MS Not GPRS Responding\". The MS is GPRS-attached to the SGSN but the MS does not respond. This may be due to the lack of a response to a GPRS Paging Request, due to an Abnormal RLC condition, or due to no Activate PDP Context Request message received within a certain time after the Request PDP Context Activation message was delivered to the MS (Cause in PDU Notification Reject Request).\n-\t\"MS Refuses\". The MS refuses explicitly the network-requested PDP context (Cause in PDU Notification Reject Request).\nWhen receiving the PDU Notification Response or the PDU Notification Reject Request message, the GGSN may reject or discard the PDP PDU depending on the PDP type.\nAfter an unsuccessful Network-Requested PDP Context Activation procedure the network may perform some actions to prevent unnecessary enquires to the HLR. The actions taken depend on the cause of the delivery failure.\n-\tIf the MS is not reachable or if the MS refuses the PDP PDU (Cause value \"MS Not GPRS Responding\" or \"MS Refuses\"), the SGSN shall not change the setting of MNRG for this MS. The GGSN may refuse any PDP PDU for that PDP address during a certain period. The GGSN may store the SGSN address during a certain period and send subsequent PDU Notification Request messages to that SGSN.\n-\tIf the MS is GPRS-detached or if the IMSI is not known in the SGSN (Cause value \"MS GPRS Detached\" or \"IMSI Not Known\"), the SGSN, the GGSN, and the HLR may perform the Protection and Mobile User Activity procedures.\nThe Protection procedure is illustrated in Figure 68.\nFigure 68: Protection Procedure\n1)\tIf the MM context of the mobile is IDLE or if the SGSN has no information about that user, the SGSN returns a PDU Notification Response (Cause) message to the GGSN with Cause equal to \"MS GPRS Detached\" or \"IMSI Not Known\". Otherwise, the Cause shall be \"Activation Proceeds\". If the Cause is \"MS GPRS Detached\" or \"IMSI Not Known\" and if the SGSN has an MM context for that user, the SGSN sets MNRG to indicate the need to report to the HLR when the next contact with that MS is performed.\n2)\tIf the MS does not respond or refuses the activation request, the SGSN sends a PDU Notification Reject Request (IMSI, PDP Type, PDP Address, Cause) message to the GGSN with Cause equal to \"MS Not GPRS Responding\" or \"MS Refuses\". The GGSN returns a PDU Notification Reject Response message to the SGSN.\n3)\tIf Cause equals \"IMSI Not Known\", the GGSN may send Send Routeing Information for GPRS (IMSI) message to the HLR. The HLR returns Send Routeing Information for GPRS Ack (IMSI, SGSN Address, Cause) message to the GGSN indicating the address of the SGSN that currently serves the MS. If SGSN Address is different from the one previously stored by the GGSN, then steps 3, 4, and 5 in Figure 67 are followed.\n4)\tIf SGSN Address is the same as the one previously stored in the GGSN, or if the Cause value returned in step 1 equals \"MS GPRS Detached\", then the GGSN sets MNRG for all PDP address(es) for that MS and sends a Failure Report (IMSI, GGSN Number, GGSN Address) message to the HLR to request MNRG to be set in the HLR. The HLR sets (if not already set) MNRG for the IMSI and adds GGSN Number and GGSN Address to the list of GGSNs to report to when activity from that IMSI is detected. GGSN Number is either the number of the GGSN, or, if a protocol-converting GSN is used as an intermediate node, the number of the protocol-converting GSN. GGSN Address is an optional parameter that shall be included if a protocol-converting GSN is used.\nThe Mobile User Activity procedure is illustrated in Figure 69.\nFigure 69: Mobile User Activity Procedure\n1)\tThe SGSN receives an indication that an MS is reachable, e.g., an Attach Request message from the MS.\n2a)\tIf the SGSN contains an MM context of the MS and MNRG for that MS is set, the SGSN shall send a Ready for SM (IMSI, MS Reachable) message to the HLR and clears MNRG for that MS.\n2b)\tIf the SGSN does not keep the MM context of the MS, the SGSN shall send an Update Location message (see clause \"GPRS Attach Function\") to the HLR.\n3)\tWhen the HLR receives the Ready for SM message or the Update Location message for an MS that has MNRG set, it clears MNRG for that MS and sends a Note MS GPRS Present (IMSI, SGSN Address) message to all the GGSNs in the list of the subscriber. (The Ready for SM message also triggers the SMS alert procedure as described in clause \"Unsuccessful Mobile-terminated SMS Transfer\".) SGSN Address field is the address of the SGSN that currently serves the MS. Upon reception of Note MS Present each GGSN shall clear MNRG.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_68",
        "figure_67",
        "figure_69"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.3",
      "section_id": "9.2.2.3",
      "section_title": "Network Requested Secondary PDP Context Activation Procedure using Gn",
      "content": "The Network Requested Secondary PDP Context Activation Procedure allows the GGSN to initiate the Secondary PDP Context Activation Procedure (see clause 9.2.2.1.1). The Network Requested Secondary PDP Context Activation Procedure when using Gn is illustrated in figure 69b.\nFigure 69b: Network Requested Secondary PDP Context Activation Procedure using Gn\n1)\tThe GGSN sends an Initiate PDP Context Activation (Linked NSAPI, QoS Requested, TFT, Protocol Configuration Options, Correlation-ID, Negotiated Evolved ARP)) message to the SGSN. The QoS Requested, TFT, and Protocol Configuration Options are sent transparently through the SGSN. The TFT shall contain uplink packet filter(s) and should contain downlink packet filter(s). The Correlation-ID is used by the GGSN to correlate the subsequent Secondary PDP Context Activation Procedure (as described below) with this message. The Negotiated Evolved ARP may be included if the GGSN supports this IE and if the support of Evolved ARP has been indicated by the SGSN.\nIf the MS is in IDLE state and extended idle mode DRX is enabled for the MS, the SGSN will trigger Network Initiated Service Request Procedure from step 2 (which is specified in clause 6.12.2), and start a timer which is configured to a value smaller than the GTP re-transmission timer. If the SGSN receives no response from the MS before the timer expires, the SGSN rejects the Initiate PDP Context Activation message with a rejection cause indicating that the MS is temporarily not reachable due to power saving and, if a Delay Tolerant Connection indication was set for the PDN connection, the SGSN sets the internal flag Pending Network Initiated PDN Connection Signalling. If the Initiate PDP Context Activation message is rejected with a cause indicating that the MS is temporarily not reachable due to power saving, then the GGSN re-attempts the same procedure after it receives the indication that the UE is available for end to end signalling in a subsequent PDP Context Modification procedure.\n2)\tThe SGSN sends a Request Secondary PDP Context Activation (Linked TI, TI, QoS Requested, TFT, Protocol Configuration Options) message to the MS. The Linked TI indicates the TI value assigned to the Active PDP Context corresponding to the Linked NSAPI previously received as described in step 1 above. The SGSN shall store a linkage between the TI value assigned to the new PDP Context, and the Correlation-ID received from the GGSN in the Initiate PDP Context Activation message.\n3)\tThe MS sends an Activate Secondary PDP Context Request:\na)\tThat initiates the Secondary PDP Context activation procedure as described in 9.2.2.1.1. The Linked TI, TI, QoS Requested, and Protocol Configuration Options sent in the Activate secondary PDP Context Request shall be the same as previously received in step 2 above. The TFT shall contain the packet filters received in the Request Secondary PDP Context Activation message. The MS shall apply the uplink packet filters in the TFT on any uplink traffic, only packets conforming to any of the uplink packet filters in the TFT may be sent on the PDP context. If the MS did not receive a TFT in the Request Secondary PDP Context Activation message (which can only happen in case of a pre-Release 11 GGSN), the MS shall either send the Activate secondary PDP Context Request without a TFT or reject the request.\nThe MS shall maintain the previously negotiated Bearer Control Mode for the PDP Address/APN pair (see clause 9.2) and ignore any BCM parameter, if included in the Request Secondary PDP Context Activation message.\nb)\tThe SGSN returns an Initiate PDP Activation Response (Cause) message to the GGSN. This acknowledges the PDP context activation request towards the GGSN.\n9.2.2.3A\tNetwork Requested Secondary PDP Context Activation Procedure using S4\nThe Network Requested Secondary PDP Context Activation Procedure allows the P‑GW to initiate the Secondary PDP Context Activation Procedure towards the MS. The Network Requested Secondary PDP Context Activation Procedure when using S4 is illustrated in figure 69c.\nFigure 69c: Network Requested Secondary PDP Context Activation Procedure using S4\nNOTE:\tSteps 2‑7 and 9 are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (A) and (B) are defined in TS 23.402 [90]. Steps 1 and 8 concern GTP based S5/S8.\n1.\tThe PDN GW uses the QoS policy to assign the EPS Bearer QoS, i.e., it assigns the values to the bearer level QoS parameters QCI, ARP, GBR and MBR; see TS 23.401 [89]. The PDN GW may have interacted with PCRF beforehand (refer to TS 23.203 [88]). The PDN GW sends a Create Bearer Request message (Bearer QoS, TFT, S5/S8 TEID, LBI, Protocol Configuration Options) to the Serving GW, the Linked EPS Bearer Identity (LBI) is the EPS Bearer Identity of a bearer for this MS and PDN connection.\nThe TFT shall contain uplink packet filter(s) and should contain downlink packet filter(s).\n2.\tThe Serving GW sends the Create Bearer Request (EPS Bearer QoS, TFT, UL TEID, LBI, CGI/SAI/RAI change report required, Protocol Configuration Options) message to the SGSN.\nIf the MS is in IDLE state and extended idle mode DRX is enabled for the MS, the SGSN will trigger Network Initiated Service Request Procedure from step 2 (which is specified in clause 6.12.2), and start a timer which is configured to a value smaller than the GTP re-transmission timer. If the SGSN receives no response from the MS before the timer expires, the SGSN sends a Create Bearer Response with a rejection cause indicating that the MS is temporarily not reachable due to power saving and, if a Delay Tolerant Connection indication was set for the PDN connection, the SGSN sets the internal flag Pending Network Initiated PDN Connection Signalling. The rejection is forwarded by the Serving GW to the PDN GW. In this case, the steps 3-9 are skipped.\n3.\tSame as step 2 in clause 9.2.2.3, where Linked NSAPI equals LBI. The LBI is received from the S‑GW in the Create Bearer Request message.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\n4.\tThe MS initiates the Secondary PDP Context activation procedure as described in clause 9.2.2.1.1.\nThe MS shall maintain the previously negotiated Bearer Control Mode for the PDP Address/APN pair (see clause 9.2) and ignore any BCM parameter, if included in the Request Secondary PDP Context Activation message.\nThe SGSN validates the Activate Secondary PDP Context Request using the TI indicated by Linked TI. The same S‑GW and P‑GW addresses are used by the SGSN as for the already-activated PDP context(s) for that TI and PDP address.\n5.\tIn A/Gb mode, security functions may be executed. These procedures are defined in clause \"Security Function\".\n6a.\tIn Iu mode, RAB setup is done by the RAB Assignment procedure.\n6b.\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n7.\tThe SGSN acknowledges the bearer activation to the Serving GW by sending a Create Bearer Response (EPS Bearer Identity, UL TEID, DL TEID, User Location Information) message. The SGSN sets the EPS Bearer Identity to an equivalent value as the NSAPI for the Bearer associated with the MS. The DL TEID value can be either the SGSN user plane TEID (2G or non-DT 3G) or the RNC user plane TEID.\n8.\tThe Serving GW acknowledges the bearer activation to the PDN GW by sending a Create Bearer Response (EPS Bearer Identity, S5/S8-TEID, User Location Information) message. The PDN GW may interact with PCRF (refer to TS 23.203 [88], e.g. to to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nIf the dedicated bearer activation is rejected with a cause indicating that the MS is temporarily not reachable due to power saving, then the PDN GW re-attempts the same procedure after it receives the indication that the is MS available for end to end signalling in the subsequent Modify Bearer Request message.\n9.\tSame as step 7 in clause 9.2.2.1.1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.2.1.1",
        "clause_6.12.2",
        "clause_9.2",
        "clause_9.2.2.3",
        "clause_5.3.21",
        "figure_69",
        "ts_23.402",
        "ts_23.401",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.2.4",
      "section_id": "9.2.2.4",
      "section_title": "S4-SGSN triggered Serving GW relocation",
      "content": "This procedure is used if the S4-SGSN determines the Serving Gateway is to be relocated due to events other than those described in the mobility events scenarios (see clause 6.9.2.2). Such scenario exists during the establishment of PDN connection for SIPTO at Local Network with standalone L-GW or SIPTO above RAN. The MS sends an Activate PDP Context Request message to the S4-SGSN which determines that the Serving GW should be relocated.\nFigure 9.2.2.4-1: S4-SGSN triggered Serving GW relocation\n1.\tThe Serving GW relocation procedure may be triggered by the S4-SGSN due to events that may benefit from a Serving GW relocation other than the ones described in the mobility procedures.\n2.\tThe SGSN selects the new Serving GW as described in TS 23.401 [89] under clause 4.3.8.2 on \"Serving GW selection function\" and 4.3.15, and sends a Create Session Request message (SGSN Tunnel Endpoint Identifier for Control Plane, EPS Bearer ID(s), SGSN Address for Control Plane, RNC Address(es) and TEID(s) for User Traffic (Direct Tunnel is used), PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication, DTI). If Direct Tunnel is established the SGSN shall include the DTI to instruct the S‑GW to apply Direct Tunnel specific error handling procedure as described in clause 13.8.\n3a.\tThe new Serving GW sends Modify Bearer Request (EPS Bearer ID(s), serving network identity, CGI/SAI, RAT type, MS Info Change Reporting support indication) messages to the P‑GWs involved.\n3b.\tThe P‑GWs acknowledge with sending Modify Bearer Response (TEID, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) messages to new S‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer context.\n4.\tThe new Serving GW acknowledges the user plane switch to the SGSN via the message Create Session Response (Cause, Serving GW Tunnel Endpoint Identifier for Control Plane, Serving GW Address for Control Plane, Protocol Configuration Options, PDN GW addresses and TEIDs (for GTP based S5/S8) or GRE keys (for PMIP based S5/S8) at the PDN GW(s) for uplink traffic, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action). The SGSN starts timer, to be used in step 6a.\n5.\tThe SGSN sends Serving GW Relocation Notification message to the RNC. The SGSN provides to the RNC the new Serving GW's Address for user Plane and TEID(s) for Uplink data. The RNC starts using the new Serving GW address and TEID(s) for forwarding subsequent uplink packets.\nEditor's note:\tIt belongs to Stage 3 domain whether an existing S1-AP message or a new message need to be used for step 5. This specification will be aligned according to Stage 3 specification once available.\n6a.\tWhen the timer has expired after step 5, the SGSN releases the bearer(s) in old S‑GW by sending a Delete Session Request message.\n6b.\tThe old S‑GW acknowledge bearer deletion.\nIf the Serving GW relocation procedure towards a new Serving GW fails, based on operator policy, the S4-SGSN should go back to the old Serving GW and disconnect the PDN connection (e.g. SIPTO at local network) that are not allowed to remain connected.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.9.2.2",
        "ts_23.401_clause_4.3.8.2",
        "clause_13.8",
        "figure_9.2.2.4-1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.0",
      "section_id": "9.2.3.0",
      "section_title": "General",
      "content": "Modification procedures modify parameters that were negotiated during an activation procedure for one or several PDP contexts. An MS, a GGSN, a P‑GW, an SGSN, a PCRF, or an RNC can request or initiate a modification procedure. The Modification procedures may possibly be triggered by the HLR as explained in clause \"Insert Subscriber Data Procedure\" or by an RNC in a RAB Release or an RNC-initiated RAB Modification procedure. An MS and SGSN can also decide about modification procedures after an RNC-initiated Iu release.\nThe following parameters can be modified:\n-\tQoS Negotiated;\n-\tNegotiated Evolved ARP;\n-\tRadio Priority;\n-\tPacket Flow Id;\n-\tPDP Address (in case of the GGSN-initiated modification procedure);\n-\tTFT (in case of MS- or GGSN or PDN GW-initiated modification procedure);\n-\tProtocol Configuration Options (in case of MS and GGSN-initiated modification procedure);\n-\tBCM (in case of GGSN-initiated or PDN GW-initiated modification procedure);\n-\tUsage of Direct Tunnel;\n-\tAPN-AMBR; and\n-\tindication for one or more 3GPP RATs of whether the PDP context can be offloaded to WLAN.\nThe SGSN can request the modification of parameters by sending a Modify PDP Context Request message to the MS.\nA GGSN can request the modification of parameters by sending an Update PDP Context Request message to the SGSN.\nA P‑GW can request the modification of parameters by sending an Update Bearer Request message to the S‑GW.\nAn MS can request the modification of parameters by sending a Modify PDP Context Request message to the SGSN.\nAn RNC can request an Iu release by sending an Iu Release Request message to the SGSN. After Iu release the MS and SGSN shall modify the PDP contexts according to the rules defined in clause \"RNC-Initiated PDP Context Modification Procedure\".\nAn RNC can request the release of a radio access bearer. After RAB release the MS and the SGSN shall locally modify the corresponding PDP context according to rules defined in the clause \"RAB Release-Initiated Local PDP Context Modification Procedure\".\nA trace may be activated while a PDP context is active. To enable trace activation in a GGSN, the SGSN shall send an Update PDP Context Request message to the GGSN. To enable trace activation in a P‑GW, the SGSN shall send an Update Bearer Request message to the S‑GW. If PDP context modification is performed only to activate a trace, the SGSN shall not send a Modify PDP Context Request message to the MS.\nWhen the APN restriction value configured in the GGSN/P‑GW is modified, the GGSN/P-GW applies the new APN restriction value to new PDP contexts/EPS bearers. Existing PDP contexts/EPS bearers continue to use the previous APN restriction value.\nIf the GGSN has stored information that the current SGSN supports the reporting of CGI/SAI/RAI and/or user CSG information changes, to enable or disable CGI/SAI/RAI and/or user CSG information change reporting for an already active PDP context, the GGSN shall send an Update PDP Context Request message to the SGSN. The SGSN shall behave according to clause 15.1.1a.\nIf the P‑GW has stored information that the current S4-SGSN supports the reporting of CGI/SAI/RAI and/or user CSG information changes, to enable or disable CGI/SAI/RAI and/or user CSG information change reporting for an already active EPS Bearer, the P‑GW shall send an Update Bearer Request message to the S‑GW. The S4-SGSN shall behave according to clause 15.1.1a.\nAn RNC may request the modification of some negotiated RAB related QoS parameters by sending a RAB Modify Request.\nFor S4-based SGSNs the SGSN-Initiated PDP Context Modification can be used in the following use case:\n-\tHSS initiated subscribed QoS modification, where typically QoS related parameters are changed. The parameters that may be modified are EPS Bearer QoS of the default bearer and APN-AMBR.\n-\tA handover or RAU from Gn/Gp SGSN to S4-SGSN, if the S4-SGSN detects that the mapped EPS subscribed QoS profile (i.e. the subscribed QoS profile mapped according to TS 23.401 [89], Annex E) of the default bearer is different from the EPS Subscribed QoS profile received from the HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_15.1.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.1",
      "section_id": "9.2.3.1",
      "section_title": "SGSN-Initiated PDP Context Modification Procedure",
      "content": "The SGSN-Initiated PDP Context Modification procedure is illustrated in Figures 70a and 70b.\nFigure 70a: SGSN-Initiated PDP Context Modification Procedure, A/Gb mode\nFigure 70b: SGSN-Initiated PDP Context Modification Procedure, Iu mode\nNOTE 1:\tSteps 3, 4, 6, 7 and 8 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 9.2.3.1A and procedure steps (B) are defined in clause 9.2.3.1B.\n1)\tThe SGSN may send an Update PDP Context Request (TEID, NSAPI, QoS Negotiated, Negotiated Evolved ARP, Trace Reference, Trace Type, Trigger Id, OMC Identity, serving network identity, MS Info Change Reporting support indication, DTI, APN-AMBR, CGI/SAI) message to the GGSN. If the Subscribed Evolved ARP value is changed then it shall be provided to the GGSN in the Negotiated Evolved ARP IE. If Direct Tunnel is established the SGSN provides to the GGSN the RNC's Address for User Plane and TEID for downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The QoS Negotiated may be equal to, an upgrade or a downgrade compared to the current QoS of the PDP context. The SGSN shall send the serving network identity to the GGSN. If QoS Negotiated received from the SGSN is incompatible with the PDP context being modified, the GGSN rejects the Update PDP Context Request. The GGSN operator configures the compatible QoS profiles. The SGSN shall include Trace Reference, Trace Type, Trigger Id, and OMC Identity in the message if GGSN trace is activated while the PDP context is active. The SGSN shall copy Trace Reference, Trace Type, and OMC Identity from the trace information received from the HLR or OMC. If the modification is triggered by a change of the subscribed APN-AMBR only, then only one PDP context associated with that APN shall be modified.\n2)\tThe GGSN may restrict QoS Negotiated given its capabilities and the current load or increase the QoS Negotiated based on any external input (e.g. policy control). The GGSN stores QoS Negotiated and returns an Update PDP Context Response (TEID, QoS Negotiated, Negotiated Evolved ARP, Prohibit Payload Compression, APN Restriction, Cause, MS Info Change Reporting Action, CSG Information Reporting Action, APN-AMBR, PCO) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall re-verify and may restrict the QoS Negotiated received from the GGSN against the subscribed QoS profile and additionally restrict the QoS negotiated based on its capabilities and current load. The SGSN shall use this updated QoS Negotiated for the subsequent steps. The SGSN shall apply a Negotiated Evolved ARP even if it is different from the Subscribed Evolved ARP. The SGSN recalculates the UE-AMBR if the APN-AMBR was received from the GGSN: see clause 15.2.2. Protocol Configuration Options contains the BCM, ETFTN as well as other optional PDP parameters that the GGSN may transfer to the MS.\n3)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n4)\tIn Iu mode, radio access bearer modification may be performed by the RAB Assignment procedure.\n5)\tIn case the QoS profile, used as input to step 4 for Iu mode and step 3 for A/Gb mode, have been downgraded during those steps, the SGSN may inform the GGSN about the downgraded QoS profile by sending an Update PDP Context Request to the affected GGSN. The GGSN shall not attempt to renegotiate the QoS profile. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS profile and that the GGSN shall accept the provided QoS profile without negotiation. The GGSN confirms the new QoS profile by sending an Update PDP Context Response to the SGSN. If the SGSN established Direct Tunnel in step 4 it shall send Update PDP Context Request and include the RNC's Address for User Plane, TEID for downlink data, No QoS negotiation indication and the DTI. DTI is used to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. If the No QoS negotiation indication is not set, e.g. by a pre-Rel-7 SGSN and the GGSN includes a PCO in the Update PDP Context Response, it shall contain same information as the Protocol Configuration Options IE sent in the Update PDP Context Response in step 2 above.\nIf the SGSN does not receive PCO in this step and it has received PCO in step 2, then the SGSN shall forward the PCO received in step 2 to the UE.\n6)\tThe SGSN selects Radio Priority and Packet Flow Id based on QoS Negotiated, and may send a Modify PDP Context Request (TI, QoS Negotiated, Radio Priority, Packet Flow Id, WLAN offloadability indication) message to the MS. If the MS indicated in the MS Network Capability it does not support BSS packet flow procedures, then the SGSN shall not include the Packet Flow Id. In A/Gb mode, the QoS Negotiated shall take into account the Aggregate BSS QoS Profile, if any, returned from the BSS.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\n7)\tThe MS should accept the PDP context modification requested by the network if it is capable of supporting the modified QoS Negotiated. For a successful modification the MS acknowledges by returning a Modify PDP Context Accept message. If the MS is incapable of accepting the new QoS Negotiated, the MS should initiate application level signalling to lower the QoS requirements for the concerned application(s). If this is not possible then the MS shall instead de-activate the PDP context with the PDP Context Deactivation Initiated by the MS procedure.\nAn E-UTRAN capable MS shall set its TIN to \"P-TMSI\" if the modified PDP context was established before ISR activation.\nNOTE 2:\tIn order to facilitate operator control of the QoS an MS should accept a new QoS being assigned by the network even if the QoS is different from the one that the MS uses by default for a particular service type. One reason why the MS may not accept the modified QoS is if it has insufficient internal resources available to support the new QoS.\nIf the BCM parameter is not included in the Modify PDP Context Request message then the MS shall set the Bearer Control Mode to 'MS_only' for the PDP Address/APN pair (see clause 9.2).\nNOTE 3:\tThe logic to fallback to BCM 'MS_only' if the BCM parameter is not included in the Modify PDP Context Request message is an exception and only applies to the Modify PDP Context procedure.\n8)\tIf BSS trace is activated while the PDP context is active, the SGSN shall send an Invoke Trace (Trace Reference, Trace Type, Trigger Id, OMC Identity) message to the RAN. Trace Reference, and Trace Type are copied from the trace information received from the HLR or OMC.\nNOTE 4:\tStep 7 is applied when the trace activation is triggered by means of signalling. Another alternative is the triggering of trace activation by the OMC. The details of both Trace Activation procedures are described in TS 32.422 [84].\nIf an APN Restriction is received from the GGSN for this PDP Context, then the SGSN shall store this value for the PDP Context, replacing any previously stored value for this PDP context. The SGSN shall determine a (new) value for the Maximum APN Restriction using any stored APN Restriction and the received APN Restriction.\nThe GGSN may interact with PCRF (refer to TS 23.203 [88], e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Change_Of_QoS.\nThe procedure returns as result \"Continue\".\n9.2.3.1A\tRequest part of SGSN-Initiated EPS Bearer Modification Procedure using S4\nThe procedure described in Figure 70c shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedures given by clause 9.2.3.1.\nFigure 70c: Request part of SGSN-Initiated EPS Bearer Modification Procedure using S4\nNOTE:\tStep A and B are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Step B and C concern GTP based S5/S8.\nA)\tThe SGSN sends the Modify Bearer Command (EPS Bearer Identity, EPS Bearer QoS, APN AMBR) message to the Serving GW. The EPS Bearer Identity identifies the default bearer. The EPS Bearer QoS contains the EPS subscribed QoS profile to be updated.\nB)\tThe Serving GW sends the Modify Bearer Command (EPS Bearer Identity, EPS Bearer QoS, APN AMBR) message to the PDN GW. If PCC infrastructure is deployed, the PDN GW informs the PCRF about the updated EPS Bearer QoS and APN-AMBR. The PCRF sends new updated PCC decision to the PDN GW. This corresponds to the PCEF-initiated IP‑CAN Session Modification procedure as defined in TS 23.203 [88].\nC)\tThe PDN GW sends the Update Bearer Request (EPS Bearer Identity, EPS Bearer QoS, APN AMBR) message to the Serving GW.\nD)\tThe Serving GW sends the Update Bearer Request (EPS Bearer Identity, EPS Bearer QoS, APN AMBR) message to the SGSN. If the \"Higher bit rates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", then the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps.\n9.2.3.1B\tUpdate part of SGSN-Initiated EPS Bearer Modification Procedure using S4\nThe procedure described in Figure 70d shows only the steps, due to use of S4, which are different from the Gn/Gp variant of the procedures given by clause 9.2.3.1.\nFigure 70d: Update part of SGSN-Initiated EPS Bearer Modification Procedure using S4\nNOTE:\tStep A is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (B1) is defined in TS 23.402 [90]. Step B concern GTP based S5/S8.\nA)\tThe SGSN acknowledges the bearer modification to the Serving GW by sending an Update Bearer Response (TEID, EPS Bearer Identity, RAT type, DL TEID and DL Address, DTI) message. If the S4-SGSN established Direct Tunnel in step 4 it shall send Update Bearer Response and include the RNC's Address for User Plane, TEID for downlink data. DTI is used to instruct the Serving GW to apply Direct Tunnel specific error handling as described in clause 13.8.\nB)\tThe Serving GW acknowledges the bearer modification to the PDN GW by sending an Update Bearer Response (TEID, EPS Bearer Identity, RAT type) message. The PDN GW may interact with PCRF (refer to TS 23.203 [88]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.1",
        "clause_13.8",
        "clause_15.2.2",
        "clause_5.3.21",
        "clause_9.2",
        "figure_70",
        "ts_23.401",
        "ts_32.422",
        "ts_23.203",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.2",
      "section_id": "9.2.3.2",
      "section_title": "GGSN-Initiated PDP Context Modification Procedure",
      "content": "The GGSN-Initiated PDP Context Modification procedure is illustrated in Figures 71a and 71b.\nFigure 71a: GGSN-Initiated PDP Context Modification Procedure, A/Gb mode\nFigure 71b: GGSN-Initiated PDP Context Modification Procedure, Iu mode\nNOTE 1:\tSteps 2‑5 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 9.2.3.2A.\n1)\tThe GGSN sends an Update PDP Context Request (TEID, NSAPI, PDP Address, QoS Requested, Negotiated Evolved ARP, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action, TFT, Protocol Configuration Options, BCM, APN-AMBR, Retrieve Location) message to the SGSN. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. QoS Requested indicates the desired QoS profile. The QoS Requested may be equal to, an upgrade or a downgrade compared to the current QoS of the PDP context. PDP Address is optional. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. If the Bearer Control Mode is set to 'MS/NW', the TFT may be included in order to add, modify or delete the TFT related to the PDP Context (in accordance with the requirements in clauses 9.2.0 and 15.3.0). Protocol Configuration Options may contain the BCM as well as optional PDP parameters that the GGSN may transfer to the MS. BCM shall also be sent as a separate IE to the SGSN. BCM indicates the Bearer Control Mode applicable to all PDP Contexts within the activated PDP Address/APN pair. The GGSN shall only indicate Bearer Control Modes allowed according to the NRSN and NRSU previously indicated by the SGSN and MS respectively. The SGSN may restrict a desired QoS profile given its capabilities, the current load, the current QoS profile, and the subscribed QoS profile. The SGSN shall apply a Negotiated Evolved ARP even if it is different from the Subscribed Evolved ARP. The BCM is used by the SGSN to handle unexpected session management signalling. If the GGSN determines the active APN-AMBR needs to be modified, the APN-AMBR is included in the request message. If the modification is triggered by a change of the APN-AMBR only, then only one PDP context associated with that APN shall be modified. The SGSN recalculates the UE-AMBR if the APN-AMBR was received from the GGSN: see clause 15.2.2. \"Retrieve Location\" is indicated if requested by the PCRF.\nIf the MS is in IDLE state and extended idle mode DRX is enabled for the MS, the SGSN will trigger Network Initiated Service Request Procedure from step 2 (which is specified in clause 6.12.2), and start a timer which is configured to a value smaller than the GTP re-transmission timer. If the SGSN receives no response from the MS before the timer expires, the SGSN rejects the Update PDP Context Request message with a rejection cause indicating that the MS is temporarily not reachable due to power saving and, if a Delay Tolerant Connection indication was set for the PDN connection, the SGSN sets the internal flag Pending Network Initiated PDN Connection Signalling.\n2)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n3)\tIn Iu mode, radio access bearer modification may be performed by the RAB Assignment procedure.\n4)\tThe SGSN selects Radio Priority and Packet Flow Id based on QoS Negotiated, and sends a Modify PDP Context Request (TI, PDP Address, QoS Negotiated, Radio Priority, Packet Flow Id, TFT, PCO, WLAN offloadability indication) message to the MS. PDP Address is optional. If the MS indicated in the MS Network Capability it does not support BSS packet flow procedures, then the SGSN shall not include the Packet Flow Id. In A/Gb mode, the QoS Negotiated shall be included if modified and take into account the Aggregate BSS QoS Profile, if any, returned from the BSS. The TFT is included only if it was received from the GGSN in the Update PDP Context Request message. Protocol Configuration Options contains the BCM as well as optional PDP parameters that the GGSN may transfer to the MS. Protocol Configuration Options is sent transparently through the SGSN. BCM indicates the Bearer Control Mode applicable to all PDP Contexts within the activated PDP Address/APN pair.\nIf only QoS parameter ARP is modified Steps 4, 5 may be skipped unless ISR is activated.\nIf the procedure is performed without steps 4 and 5 and location retrieval is requested and the UE is PMM_CONNECTED and unless the SGSN is configured not to retrieve CGI/SAI from the RNC under this condition, the SGSN uses the Location Reporting Procedure described in clause 12.7.5 to retrieve the SAI from the RNC.\nNOTE 2:\tBased on operator policy and local regulation the SGSN is configured to either use the Location Reporting Procedure described in clause 12.7.5 for retrieving the CGI/SAI from the RNC, or to use the last known User Location information obtained from e.g. GPRS attach procedure, routeing area update procedure, etc.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\n5)\tThe MS should accept the PDP context modification requested by the network if it is capable of supporting any modified QoS Negotiated as well as any modified TFT. For a successful modification the MS acknowledges by returning a Modify PDP Context Accept message. If the MS is incapable of accepting a new QoS Negotiated it shall instead de-activate the PDP context with the PDP Context Deactivation Initiated by MS procedure.\nAn E-UTRAN capable MS shall set its TIN to \"P-TMSI\" if the modified PDP context was established before ISR activation.\nNOTE 3:\tIn order to facilitate operator control of the QoS an MS should accept a new QoS being assigned by the network even if the QoS is different from the one that the MS uses by default for a particular service type. One reason why the MS may not accept the modified QoS is if it has insufficient internal resources available to support the new QoS.\nIf the BCM parameter is not included in the Modify PDP Context Request message then the MS shall set the Bearer Control Mode to 'MS_only' for the PDP Address/APN pair (see clause 9.2).\nNOTE 4:\tThe logic to fallback to BCM 'MS_only' if the BCM parameter is not included in the Modify PDP Context Request message is an exception and only applies to the Modify PDP Context procedure.\n6)\tUpon receipt of the Modify PDP Context Accept message, or upon completion of the RAB modification procedure, the SGSN returns an Update PDP Context Response (TEID, QoS Negotiated, CGI/SAI) message to the GGSN. If the SGSN receives a Deactivate PDP Context Request message, it shall instead follow the PDP Context Deactivation Initiated by MS procedure. The SGSN includes the last known location information.\nIf the Update PDP Context Request message is rejected with a cause indicating that the MS is temporarily not reachable due to power saving, then the GGSN re-attempts the same procedure after it receives the indication that the is UE available for end to end signalling in a subsequent PDP Context Modification procedure.\nThe GGSN may interact with PCRF (refer to TS 23.203 [88], e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nIf an APN Restriction is received from the GGSN for this PDP Context, then the SGSN shall store this value for the PDP Context, replacing any previously stored value for this PDP context. The SGSN shall determine a (new) value for the Maximum APN Restriction using any stored APN Restriction and the received APN Restriction.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Change_Of_QoS.\nThe procedure returns as result \"Continue\".\n9.2.3.2A\tPDN GW Initiated EPS Bearer Modification Procedure, using S4\nThe procedure described in figure 71c shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clause 9.2.3.2.\nFigure 71c: PDN GW-Initiated EPS Bearer Modification Procedure\nNOTE:\tSteps B) and C) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (A1) and (A2) are defined in TS 23.402 [90]. Steps A and D concern GTP based S5/S8.\nA)\tThe P‑GW sends the Update Bearer Request (TEID, EPS Bearer Identity, EPS Bearer QoS, APN-AMBR, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, TFT, Protocol Configuration Options, Retrieve Location) message to the S‑GW.\nPDN Address Information is included if it was provided by the P‑GW. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this EPS Bearer. The TFT is optional and included in order to add, modify or delete the TFT related to the PDP Context (in accordance with the requirements in clauses 9.2.0 and 15.3.0). Protocol Configuration Options optional EPS Bearer parameters that the P‑GW/PCRF may transfer to the MS. The PDN GW may have interacted with PCRF beforehand (refer to TS 23.203 [88]). \"Retrieve Location\" is indicated if requested by the PCRF.\nIf the MS is in IDLE state and extended idle mode DRX is enabled for the MS, the SGSN will trigger Network Initiated Service Request Procedure from step 2 (which is specified in clause 6.12.2) and start a timer which is configured to a value smaller than the GTP re-transmission timer. If the SGSN receives no response from the MS before the timer expires, the SGSN sends an Update Bearer Response with a rejection cause indicating that MS is temporarily not reachable due to power saving and then sets the internal flag Pending Network Initiated PDN Connection Signalling. The rejection is forwarded by the Serving GW to the PDN GW.\nB)\tIf ISR is activated and UE is in PMM_IDLE or STANDBY state, S-GW shall first trigger the Network Triggered Service Request procedure (refer to TS 23.401 [89]).\nThe S‑GW sends the Update Bearer Request (TEID, EPS Bearer Identity, EPS Bearer QoS, APN-AMBR, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action, TFT, Protocol Configuration Options, Retrieve Location) message to the SGSN. If the \"Higher bit rates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", then the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps.\nC)\tThe SGSN acknowledges the bearer modification to the S‑GW by sending an Update Bearer Response (EPS Bearer Identity, User Location Information) message to the S‑GW. If there is no signalling with the MS, e.g. because the MS is in PMM_IDLE or STANDBY state, the SGSN provides the last known location information.\nD)\tThe S‑GW acknowledges the bearer modification to the P‑GW by sending an Update Bearer Response (EPS Bearer Identity, User Location Information) message. The PDN GW may interact with PCRF (refer to TS 23.203 [88]). The P‑GW may interact with PCRF (refer to TS 23.203 [88], e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nIf the bearer modification is rejected with a cause indicating that the MS is temporarily not reachable due to power saving, then the PDN GW re-attempts the same procedure after it receives the indication that MS is available for end to end signalling in the subsequent Modify Bearer Request message.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.2",
        "clause_15.2.2",
        "clause_6.12.2",
        "clause_12.7.5",
        "clause_5.3.21",
        "clause_9.2",
        "figure_71",
        "ts_23.401",
        "ts_23.203",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.3",
      "section_id": "9.2.3.3",
      "section_title": "MS-Initiated PDP Context Modification Procedure",
      "content": "The MS-Initiated PDP Context Modification procedure is illustrated in Figures 72a and 72b.\nFigure 72a: MS-Initiated PDP Context Modification Procedure, A/Gb mode\nFigure 72b: MS-Initiated PDP Context Modification Procedure, Iu mode\nNOTE 1:\tSteps 1, 4, 5 and 7 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 9.2.3.3A, procedure steps (B) are defined in clause 9.2.3.3B and procedure steps (C) are defined in clause 9.2.3.3C.\n1)\tThe MS sends a Modify PDP Context Request (TI, QoS Requested, TFT, Protocol Configuration Options) message to the SGSN. Either QoS Requested or TFT or both may be included. QoS Requested indicates the desired QoS profile, while TFT indicates the TFT that is to be added or modified or deleted from the PDP context. An E-UTRAN capable UE shall not modify the QoS for the first PDP context that was established within the PDN connection. A UE in this release that is not E-UTRAN capable should not modify the QoS for the first PDP context that was established within the PDN connection. Protocol Configuration Options may be used to transfer optional PDP parameters and/or requests to the GGSN.\nThe MS-Initiated PDP Context Modification Procedure is used to indicate the change of 3GPP PS Data Off UE Status to the GGSN via the PCO, only if the UE has been previously informed that the GGSN supports the 3GPP PS Data Off feature.\n2)\tThe SGSN may restrict the desired QoS profile given its capabilities, the current load, and the subscribed QoS profile. The SGSN sends an Update PDP Context Request (TEID, NSAPI, QoS Negotiated, TFT, Protocol Configuration Options, serving network identity, CGI/SAI, MS Info Change Reporting support indication, DTI, CGI/SAI, User CSG Information) message to the GGSN. If Direct Tunnel is established the SGSN provides to the GGSN the RNC's Address for User Plane and TEID for downlink data and shall include the DTI to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The SGSN shall send the serving network identity to the GGSN. If QoS Negotiated and/or TFT received from the SGSN is incompatible with the PDP context being modified (e.g., TFT contains inconsistent packet filters), the GGSN rejects the Update PDP Context Request. The GGSN operator configures the compatible QoS profile. Protocol Configuration Options is sent transparently through the SGSN if received in Modify PDP Context Request message. The GGSN may interact with the PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\n3)\tThe GGSN may further restrict QoS Negotiated given its capabilities, operator policies and the current load or increase QoS Negotiated based on any external input (e.g. policy control). The GGSN stores QoS Negotiated, stores, modifies, or deletes TFT of that PDP context as indicated in TFT, and returns an Update PDP Context Response (TEID, QoS Negotiated, Negotiated Evolved ARP, Protocol Configuration Options, Prohibit Payload Compression, APN Restriction, MS Info Change Reporting Action, CSG Information Reporting Action) message. The GGSN sets the Negotiated Evolved ARP based on local policy or PCC. The Allocation/Retention Priority of the QoS Profile Negotiated is derived from the Evolved ARP according to the mapping principles of TS 23.401 [89], Annex E. Protocol Configuration Options may be used to transfer optional PDP parameters to the UE. The Prohibit Payload Compression indicates that the SGSN should negotiate no data compression for this PDP context. The SGSN shall re-verify and may restrict the QoS Negotiated received from the GGSN against the subscribed QoS profile and additionally restrict the QoS negotiated based on its capabilities and current load. The SGSN shall use this updated QoS Negotiated for the subsequent steps. The SGSN shall apply a Negotiated Evolved ARP even if it is different from the Subscribed Evolved ARP.\nIf the 3GPP PS Data Off UE Status was present in the Update PDP Context Request PCO, the GGSN shall include the 3GPP PS Data Off Support Indication in the Update PDP Context Response PCO if the GGSN supports the 3GPP PS Data Off feature.\nIf the GGSN detects that the 3GPP PS Data Off UE Status has changed, the GGSN shall indicate this event to the charging system for offline and online charging.\n4)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\n5)\tIn Iu mode, radio access bearer modification may be performed by the RAB Assignment procedure. In case the radio access bearer does not exist the RAB setup is done by the RAB Assignment procedure.\n6)\tIn case the QoS profile, used as input to step 5 for Iu mode and step 4 for A/Gb mode, have been downgraded during those steps, the SGSN may inform the GGSN about the downgraded QoS profile by sending an Update PDP Context Request to the affected GGSN. The GGSN shall not attempt to renegotiate the QoS profile. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS profile and that the GGSN shall accept the provided QoS profile without negotiation. The GGSN confirms the new QoS profile by sending an Update PDP Context Response to the SGSN. If the SGSN established Direct Tunnel in step 5 it shall send Update PDP Context Request and include the RNC's Address for User Plane, TEID for downlink data, No QoS negotiation indication and the DTI. DTI is used to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. If the No QoS negotiation indication is not set, e.g. by a pre-Rel-7 SGSN and the GGSN includes a PCO in the Update PDP Context Response, it shall contain same information as the Protocol Configuration Options IE sent in the Update PDP Context Response in step 3 above.\nIf the SGSN does not receive PCO in this step and it has received PCO in step 3, then the SGSN shall forward the PCO received in step 3 to the UE.\n7)\tThe SGSN selects Radio Priority and Packet Flow Id based on QoS Negotiated, and returns a Modify PDP Context Accept (TI, QoS Negotiated, Radio Priority, Packet Flow Id, Protocol Configuration Options, WLAN offloadability indication) message to the MS. If the MS indicated in the MS Network Capability it does not support BSS packet flow procedures, then the SGSN shall not include the Packet Flow Id. In A/Gb mode, the QoS Negotiated shall take into account the Aggregate BSS QoS Profile, if any, returned from the BSS. Protocol Configuration Options is sent transparently through the SGSN if received in Modify PDP Context Response message.\nIf the MS is incapable of accepting the new QoS Negotiated, the MS should initiate application level signalling to lower the QoS requirements for the concerned application(s). If this is not possible then the MS shall instead de-activate the PDP context with the PDP Context Deactivation Initiated by the MS procedure.\nAn E-UTRAN capable MS shall set its TIN to \"P-TMSI\" if the modified PDP context was established before ISR activation.\nNOTE 2:\tIf the SGSN does not accept QoS Requested, then steps 2 and 3 of this procedure are skipped, and the existing QoS Negotiated is returned to the MS in step 4.\nNOTE 3:\tIn this release of the standards no procedure is defined that uses the Protocol Configuration Options in the PDP context modification procedure.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21.\nIf an APN Restriction is received from the GGSN for this PDP Context, then the SGSN shall store this value for the PDP Context, replacing any previously stored value for this PDP context. The SGSN shall determine a (new) value for the Maximum APN Restriction using any stored APN Restriction and the received APN Restriction.\nThe CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_Change_Of_QoS.\nThe procedure returns as result \"Continue\".\n9.2.3.3A\tRequest part of MS-Initiated EPS Bearer Modification Procedure using S4\nThe procedure described in Figure 72c shows only the steps, due to use of S4, which are different from the Gn/Gp variant of the procedures given by clause 9.2.3.3.\nFigure 72c: Request part of MS-Initiated Modification Procedure using S4\nNOTE 1:\tStep A is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Step B concern GTP based S5/S8.\nA)\tThe SGSN identifies the bearer modification scenario that applies and sends the Bearer Resource Command (TEID, LBI, PTI, EPS Bearer QoS (excluding ARP), TFT, RAT type, Protocol Configuration Options, serving network identity, CGI/SAI, User CSG Information, MS Info Change Reporting support indication, DL TEID and DL Address, DTI) message to the selected Serving GW. If Direct Tunnel is established the S4-SGSN provides to the Serving GW the RNC's Address for User Plane and TEID for downlink data and shall include the DTI to instruct the Serving GW to apply Direct Tunnel specific error handling as described in clause 13.8.\nThe Procedure Transaction Id, PTI, is dynamically allocated by the SGSN. The SGSN should ensure as far as possible that previously used PTI values are not immediately reused for the same UE. The SGSN stores the relationship between the assigned PTI and the received Linked TI during the lifetime of the procedure. PTI is used to differentiate between Update Bearer Requests triggered by this procedure, and any Update Bearer Requests initiated by the PDN GW. The PTI is released when the procedure is completed.\nBearer modification scenarios are described by table 3-3 (MS_only mode) and table 3-4 (MS/NW mode).\nNOTE 2:\tBearer modification procedure is also used to report in PCO the 3GPP PS Data Off status change in the MS/UE.\nB)\tThe Serving GW sends the Bearer Resource Command (LBI, PTI, EPS Bearer Id, EPS Bearer QoS (excluding ARP), TFT, RAT type, Protocol Configuration Options, serving network identity, CGI/SAI, User CSG Information, MS Info Change Reporting support indication) message. The Serving GW sends the message to the same PDN GW as for the EPS Bearer identified by the Linked Bearer Id. The EPS Bearer Id identifies the EPS Bearer, for which the modification was requested.\nThe PDN GW may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nWhen interacting with PCRF, the PDN GW provides to the PCRF;\n-\tthe interpretation of the TFT, i.e.:\n-\tthe filter operation;\n-\tthe filter definitions for filters to be added or modified;\n-\tthe SDF filter identifier(s) for filters to be modified or deleted;\n-\tthe SDF filter identifier(s) for unchanged filters targeted with a QoS change;\n-\tthe requested QCI; and\n-\tfor a GBR QCI, the total requested GBR pertaining to (a) the filters added and (b) the set of PCC rules that have one or more SDF filter identifier(s) forwarded to the PCRF in the Gx request.\nThe PDN GW shall calculate the total requested GBR for Gx from the current Bearer GBR, the requested Bearer GBR from the MS and the QoS for the targeted PCC rules. The PDN GW identifies the targeted PCC rules based on the SDF filter identifier(s) corresponding to the packet filter identifier(s) provided by the MS in the parameter list of the TFT. If the MS did not provide any packet filter identifiers, the PDN GW shall use all SDF filter identifier(s), previously assigned on Gx, for this EPS bearer to identify the PCC rules. The total requested GBR is calculated by the following formula:\ntotal requested GBR for Gx = max(0,sum(GBR[targeted PCC rules]) + (requested Bearer GBR - current Bearer GBR))\nEXAMPLE:\tThe targeted GBR bearer has GBR=500 and the MS requests to increase the bearer GBR to 750. The TFT operation is \"No TFT operation\", so the PDN GW considers all the MS-created TFT filters to be targeted and calculates the sum of the GBR values for the targeted PCC rules. The sum is 400 in this example. The formula yields a requested GBR=400+(750-500)=650. The list of targeted SDF filters, the QCI and GBR=650 is provided with the Gx request.\nThe TFT definition includes an operation, a list of packet filter identifiers and conditionally their packet filter definitions as well as an optional parameter list. The PDN GW shall assign packet filter identifiers as specified in the TFT received with the Bearer Resource Command for the corresponding packet filters. The MS use of the TFT parameter list is not specified in this Release for BCM MS-only. Valid combinations are shown in Table 3‑2. The absence of the TFT IE is treated as \"No TFT operation\".\nThe PDN GW shall forward, over Gx, an MS request to change the QCI only if the following prerequisites are fulfilled:\n-\tthere is no NW-initiated TFT filter on the same bearer; and\n-\tthe Gx request includes at least one SDF filter identifier from each of the PCC rules on the same bearer.\nTable 3-2: TFT filter information elements per TFT operation\nTFT operation\nPacket filter(s)\nParameter list\nPrecondition\nidentifier\ndefinition\nCreate new TFT\nM\nM\nN/A\nNo previous TFT on the same bearer\nDelete existing TFT\nN/A\nN/A\nN/A\nPrevious TFT on all bearers\nAdd packet filters to existing TFT\nM\nM\nN/A\nPrevious TFT on the same bearer\nReplace packet filters in existing TFT\nM\nM\nN/A\nPrevious TFT on the same bearer\nDelete packet filters from existing TFT\nM\nN/A\nN/A\nPrevious TFT on the same bearer\nNo TFT operation\nN/A\nN/A\nC1\nC1:\tIf the BCM is MS/NW, then the parameter list shall include the TFT filter identifiers, created by the MS, targeted with a QoS change.\nIf the TFT operation is \"Replace packet filters in existing TFT\", then the PDN GW provides to the PCRF the Gx operation \"modify filters\" and the modified filter(s) and their respective SDF filter identifier(s), previously assigned on Gx, that correspond to the received packet filter identifiers of the EPS bearer together with the requested QCI and/or GBR for the targeted resources, if available.\nIf the TFT operation is \"Delete packet filters from existing TFT\", then the PDN GW provides to the PCRF the Gx operation \"delete filters\" and the SDF filter identifier(s), previously assigned on Gx, that correspond to the received packet filter identifiers of the EPS bearer together with the requested QCI and/or GBR for the targeted resources, if available.\nIf the TFT operation is \"Add packet filters to existing TFT\", then the PDN GW provides to the PCRF the Gx operation \"add filters\" and the new filter(s) together with the requested QCI and/or GBR for the targeted resources, if available. The PDN GW also includes all SDF filter identifier(s), previously assigned on Gx, for this EPS bearer.\nIf the TFT operation is \"Create new TFT\", then the PDN GW provides to the PCRF the Gx operation \"add filters\" and the new filter(s) together with the requested QCI and/or GBR for the targeted resources, if available.\nIf the TFT operation is \"Delete existing TFT\", then the PDN GW provides to the PCRF the Gx operation \"delete filters\" together with the SDF filter identifier(s), previously assigned on Gx, for the filters in the TFT to be deleted together with the requested QCI and/or GBR for the targeted resources, if available.\nNOTE 2:\tThe sending of the QCI/GBR change triggers the PCRF to perform an appropriate PCC rule operation to enable the continuation of the EPS bearer after the removal of the TFT by the UE.\nIf the TFT operation is \"No TFT operation\" or the TFT is missing (allowed in BCM MS-only only) in the Bearer Resource Command, then the PDN GW provides to the PCRF no Gx filter operation together with the requested QCI and/or GBR for the targeted resources. The PDN GW also includes, if BCM is MS-only, all SDF filter identifier(s), previously assigned on Gx, for this EPS bearer. If the BCM is MS/NW, the TFT shall contain packet filter identifiers and PDN GW shall include the SDF filter identifier(s) that correspond to the packet filter identifier(s) in the parameter list of the TFT.\nNOTE 3:\tThe requested modification being translatable to a Gx request is required but not the only condition for the procedure being successful.\nTable 3-3: MS-initiated EPS bearer modification, MS_only mode\nPDP context modificationuse case\nInformation provided by UE and NAS signalling\nInformation provided by SGSN at S4 signalling(refer to TS 23.401 [89])\n1\nAdd TFT filters and increase QoS\nTFT filters added,New QoS of the PDP context (NOTE 1), Linked TI / NSAPI\nQoS related to EPS Bearer,\tTFT filters added,\tTEID, EPS Bearer ID\n2\nIncrease of QoS,TFT filters not specified\nNew QoS of the PDP context (NOTE 1),Linked TI / NSAPI\nQoS related to EPS Bearer, \tTEID, EPS Bearer ID\n3\nAdd/remove TFT filters, no QoS change\nTFT filters added/removed,Linked TI / NSAPI\nTFT filters added/removed,\tTEID, EPS Bearer ID\n4\nRemove TFT filters and decrease QoS\nNew QoS of the PDP context (NOTE 1),TFT filters removed,Linked TI / NSAPI\nQoS related to EPS Bearer,\tTFT filters removed, \tTEID, EPS Bearer ID\n5\nDecrease of QoS,TFT filters not specified\nNew QoS of the PDP context (NOTE 1),Linked TI / NSAPI\nQoS related to EPS Bearer, \tTEID, EPS Bearer ID\nNOTE 1:\tOnly the modified QCI and/or GBR parameters are forwarded by the SGSN.\nTable 3-4: MS-initiated EPS bearer modification, MS/NW mode\nPDP context modification\nuse case\nInformation provided by UE and NAS signalling\nInformation provided by SGSN at S4 signalling(refer to TS 23.401 [89])\n1\nAdd TFT filters and increase QoS\nTFT filters added,\nNew QoS of the PDP context (NOTE 1),\nLinked TI / NSAPI\nQoS related to EPS Bearer,\nTFT filters added,\nTEID, EPS Bearer ID\n2\nIncrease of QoS related to one or more TFT filter(s)\nNew QoS of the PDP context (NOTE 1),\nImpacted TFT filter(s),\nLinked TI / NSAPI\nQoS related to EPS Bearer\tfilters,\tImpacted TFT filters,\tTEID, EPS Bearer ID\n3\nIncrease of QoS,\nTFT filters not specified\nNot allowed in MS/NW mode\nNot allowed in MS/NW mode\n4\nAdd/remove TFT filters, no QoS change\nTFT filters added/removed,\nLinked TI / NSAPI\nTFT filters added/removed,\nTEID, EPS Bearer ID\n5\nDecrease QoS related to one or more TFT filter(s)\nNew QoS of the PDP context (NOTE 1),\nImpacted TFT filter(s),\nLinked TI / NSAPI\nQoS related to EPS Bearer\tfilters,\nImpacted TFT filters,\nTEID, EPS Bearer ID\n6\nRemove TFT filters and decrease QoS\nNew QoS of the PDP context (NOTE 1)\nTFT filters removed,\nLinked TI / NSAPI\nQoS related to EPS Bearer,\tTFT filters removed,\nTEID, EPS Bearer ID\n7\nDecrease of QoS,\nTFT filters not specified\nNot allowed in MS/NW mode\nNot allowed in MS/NW mode\nNOTE 1:\tOnly the modified QCI and/or GBR parameters are forwarded by the SGSN.\n9.2.3.3B\tExecution part of MS-Initiated Modification Procedure using S4\nThe procedure described in Figure 72d shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedures given by clause 9.2.3.3.\nFigure 72d: Execution part of MS-Initiated Modification Procedure using S4\nNOTE:\tStep B is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (B1) is defined in TS 23.402 [90]. Step A concern GTP based S5/S8.\nA)\tIf the request is accepted, the PDN GW Initiated Bearer Modification Procedure is invoked by the PDN GW to modify the EPS Bearer indicated by the TEID.\nThe PDN GW updates the TFT and the EPS Bearer QoS to match the aggregated set of service data flows. If the PCRF was contacted, the PDN GW uses the SDF filter(s) in the PCC rule(s) received from the PCRF to update the TFT. The PDN GW maintains the relation between the SDF filter identifier in the PCC rule received from the PCRF and the packet filter identifier of the TFT.\nThe PDN GW sends an Update Bearer Request (TEID, EPS Bearer Identity, PTI, EPS Bearer QoS, APN-AMBR, TFT, Protocol Configuration Options, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) message to the Serving GW. The Procedure Transaction Id (PTI) parameter is used to link this message to the Request Bearer Resource Modification message received from the Serving GW.\nIf the request for specific QoS is not accepted, or the PCC rule(s) received from the PCRF include any SDF filter (that is to be provided to the MS) that was not introduced by the MS request or which the MS requested to remove, the PDN GW sends a reject indication, which shall be delivered to the MS.\nIf the 3GPP PS Data Off UE Status was present in the Bearer Resource Command PCO, the PDN GW behaviour is as specified in TS 23.401 [89].\nB)\tThe Serving GW sends an Update Bearer Request (PTI, EPS Bearer Identity, EPS Bearer QoS, TFT, APN AMBR, Protocol Configuration Options, Prohibit Payload Compression, MS Info Change Reporting Action, CSG Information Reporting Action) message to the SGSN. If the \"Higher bit rates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps.\n9.2.3.3C\tResponse part of MS-Initiated Modification Procedure using S4\nThe procedure described in Figure 72e shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedures given by clause 9.2.3.3.\nFigure 72e: Response part of MS-Initiated Modification Procedure using S4\nNOTE:\tSteps A is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (C1) is defined in TS 23.402 [90]. Step B concern GTP based S5/S8.\nA)\tThe SGSN acknowledges the bearer modification by sending an Update Bearer Response (TEID, EPS Bearer Identity, DL TEID and DL Address, DTI) message to the Serving GW. If the S4-SGSN established Direct Tunnel in step 5 it shall send Update Bearer Response and include the RNC's Address for User Plane, TEID for downlink data and the DTI. DTI is used to instruct the Serving GW to apply Direct Tunnel specific error handling as described in clause 13.8.\nB)\tThe Serving GW acknowledges the bearer modification by sending an Update Bearer Response (TEID, EPS Bearer Identity) message to the PDN GW. The PDN GW may interact with PCRF (refer to TS 23.203 [88]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.3",
        "clause_13.8",
        "clause_5.3.21",
        "table_3-3",
        "table_3-4",
        "table_3",
        "table_3-2",
        "figure_72",
        "ts_23.203",
        "ts_23.401",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.4",
      "section_id": "9.2.3.4",
      "section_title": "RNC/BSS-Initiated PDP Context Modification Procedure",
      "content": "The RNC can request the release of the Iu connection (see clause \"Iu Release Procedure\"). The BSS may terminate the downlink data transfer to a MS by the Suspend procedure (which is triggered by the MS) or by the Radio Status procedure with cause \"Radio contact lost with MS\" or \"Radio link quality insufficient to continue communication\" both defined in TS 48.018 [78].\nAfter Iu Release in Iu mode, or after termination of the downlink data transfer in A/Gb mode, the PDP contexts for architecture variants using Gn/Gp based interaction with GGSN are handled as follows:\n-\tIn the SGSN, for a PDP context using background or interactive traffic class, the PDP context is preserved with no modifications.\n-\tIn the SGSN, for a PDP context using streaming or conversational traffic class, the PDP context is preserved, but the maximum bit rate is downgraded to 0 kbit/s (for both uplink and downlink). The SGSN sends an Update PDP Context Request (TEID, QoS Negotiated) message to the GGSN to set the maximum bit rate to 0 kbit/s in the GGSN. The value of 0 kbit/s for the maximum bit rate indicates to the GGSN to stop sending packets to the SGSN for this PDP context. For the Iu mode the value of 0 kbit/s for the maximum bit rate for both uplink and downlink indicates to the SGSN that a RAB shall not be re-established for this PDP Context in subsequent Service Request Procedure. For the A/Gb mode the value of 0 kbit/s for the maximum bit rate for both uplink and downlink indicates that the SGSN shall not send any downlink data for this PDP Context. In Iu and A/Gb mode CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]: CAMEL_GPRS_Change_Of_QoS. The procedure returns as result \"Continue\".\nFor architecture variants using S4 based interaction with S‑GW and P‑GW, the PDP contexts are handled as follows:\n-\tIn the SGSN, for a PDP context using streaming or conversational traffic class, the PDP context is deactivated by the SGSN using the SGSN-initiated PDP Context Deactivation procedure.\n-\tIn the SGSN, for all other cases, the PDP context is preserved with no modifications.\nIn Iu mode the following procedures shall be performed in the MS when radio coverage is lost:\n-\tFor a PDP context using background or interactive traffic class, the PDP context is preserved even if RRC re-establishment procedures have failed.\n-\tFor a PDP context using streaming or conversational traffic class and only for the PDP context(s) that have a TFT that includes packet filter(s) set by the MS, the PDP context may be preserved, but the maximum bit rate is downgraded to 0 kbit/s (for both uplink and downlink) when the RRC re-establishment procedure has failed. The PDP contexts that are not preserved are all locally deactivated.\nAfter coverage is regained on the GERAN or the UTRAN and if the MS did not deactivate the PDP Context locally the MS should start MS-initiated PDP Context Modification procedure or the PDP Context Deactivation procedure. The MS shall use the PDP Context Modification procedure to re-activate the PDP context and re-establish the RAB .\nIn A/Gb mode the following procedures shall be performed in the MS when radio coverage is lost, when the radio link quality is insufficient or when the MS suspends GPRS:\n-\tFor a PDP context using background or interactive traffic class, the PDP context is preserved.\n-\tFor a PDP context using streaming or conversational traffic class and only for the PDP context(s) that have a TFT that includes packet filter(s) set by the MS, the PDP context may be preserved, but the maximum bit rate is downgraded to 0 kbit/s (for both uplink and downlink). The PDP Contexts that are not preserved are all locally deactivated.\nAfter coverage or radio link quality is regained on the GERAN or the UTRAN or when GPRS services shall resume and if the MS did not deactivate the PDP Context locally the MS should start MS initiated PDP Context Modification procedure or the PDP Context Deactivation procedure. The MS shall use the PDP Context Modification procedure to re-activate the PDP context.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_48.018",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.5",
      "section_id": "9.2.3.5",
      "section_title": "RAB Release-Initiated Local PDP Context Modification Procedure",
      "content": "The RNC can request a RAB to be released through the RAB Release procedure without releasing the Iu connection.\nAfter the RAB(s) release the SGSN shall handle the PDP context for architecture variants using Gn/Gp based interaction with GGSN as follows:\n-\tIn the SGSN, for a PDP context using background or interactive traffic class, the PDP context is preserved with no modifications.\n-\tIn the SGSN, for a PDP context using streaming or conversational traffic class, the PDP context is preserved, but the maximum bit rate is downgraded to 0 kbit/s (for both uplink and downlink) when the associated RAB is released. The SGSN sends an Update PDP Context Request (TEID, QoS Negotiated) message to the GGSN to set the maximum bit rate to 0 kbit/s in the GGSN. The value of 0 kbit/s for the maximum bit rate indicates to the GGSN to stop sending packets to the SGSN on this PDP context. The value of 0 kbit/s for the maximum bit rate for both uplink and downlink indicates to the SGSN that a RAB shall not be re-established for this PDP Context in subsequent Service Request Procedure. CAMEL procedure calls shall be performed, see referenced procedure in TS 23.078 [8b]: CAMEL_GPRS_Change_Of_QoS. The procedure returns as result \"Continue\".\nFor architecture variants using S4 based interaction with S‑GW and P‑GW, the PDP contexts are handled as follows:\n-\tIn the SGSN, for a PDP context using background or interactive traffic class, the PDP context is preserved with no modifications.\n-\tIn the SGSN, for a PDP context using streaming or conversational traffic class, the PDP context is deactivated by the SGSN using the SGSN-initiated PDP Context Deactivation procedure.\nThe following procedures shall be performed in the MS when the RRC layer indicate to higher layer that a RAB has been released and the RAB release was not initiated due to a PDP Context Deactivation Procedure:\n-\tFor a PDP context using background or interactive traffic class, the PDP context is be preserved with no modifications.\n-\tFor a PDP context using streaming or conversational traffic class and if the TFT include packet filter(s) set by the MS, the PDP context may be preserved, but the maximum bit rate is downgraded to 0 kbit/s (for both uplink and downlink). If the TFT only include packet filter(s) set by the network, or if the TFT include packet filter(s) set by the MS and the PDP context was not preserved, the PDP context is locally deactivated in the MS.\nAt this point or at a later stage (for preserved PDP contexts), the MS may start a PDP Context Deactivation procedure or PDP Context Modification procedure. The MS shall use the PDP context modification procedure to re-activate the PDP context and to re-establish the RAB.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.6",
      "section_id": "9.2.3.6",
      "section_title": "RAN-initiated RAB Modification Procedure (Iu mode)",
      "content": "The RNC-initiated RAB Modification procedure permits an Iu mode RAN to propose modifications to any negotiable RAB parameter for an MS after RAB establishment, TS 25.413 [56b]. RAB parameters are equivalent to RAB attributes as defined in TS 23.107 [58] for each QoS class. The procedure is depicted in the figure below.\nFigure 73: RAN-initiated RAB Modification Procedure\n1)\tThe RAN sends a RAB Modify Request (RAB ID, RAB Parameter Values) message to the SGSN.\n2)\tThe SGSN may decide to ignore the message or to invoke the PDP Context Modification procedure as described in clause 9.2.3.1, which includes the SGSN RAB Modification procedure. For architecture variants using S4 based interaction with S‑GW and P‑GW, the SGSN shall always ignores the message.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.3.1",
        "figure_73",
        "ts_25.413",
        "ts_23.107"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.3.7",
      "section_id": "9.2.3.7",
      "section_title": "SGSN-initiated procedure on UE's CSG membership change",
      "content": "For an MS in PMM-CONNECTED State and connected via a CSG cell, if the SGSN detects that the UE's CSG membership to that cell has expired, the SGSN shall send an appropriate Iu message to the RAN which includes an indication that the CSG membership of the UE has expired. The RAN receiving this indication may initiate a handover to another cell. If the UE is not handed over the RAN should initiate the release of the Iu connection with an appropriate cause. The SGSN initiates Iu release after a configurable time if the UE is not handed over or released by the CSG cell. If the CSG membership expires for a MS with ongoing emergency bearer services, no indication that the CSG membership of the UE has expired is sent to the RAN and the SGSN shall initiate deactivation of all non-emergency PDP connections.\nFor an MS in PMM-CONNECTED State and connected via a hybrid cell, if the SGSN detects that the UE's CSG membership to that cell has changed or expired, the SGSN shall send an appropriate Iu message to the RAN which includes an indication that the CSG membership of the UE has changed. Based on this information the RAN may perform differentiated treatment for CSG and non-CSG members. If the SGSN has been requested to report user CSG information changes to the GGSN/PDN GW for the MS, thea Gn/Gp-SGSN shall send the change notification message to the GGSN with user CSG Information to indicate the CSG membership change and a S4-SGSN shall send the change notification message to the Serving GW with user CSG Information to indicate the CSG membership change. The Serving GW shall send the change notification message with the user CSG Information to the PDN GW. The SGSN shall release the impacted LIPA PDN connection if the LIPA CSG authorization data for this CSG cell is no longer valid due to UE's CSG membership changed or expired.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.2.4.1",
      "section_id": "9.2.4.1",
      "section_title": "MS Initiated PDP Context Deactivation Procedure",
      "content": "The PDP Context Deactivation Initiated by MS procedures for A/Gb mode and Iu mode are illustrated in Figure 74 and Figure 75, respectively.\nFigure 74: MS Initiated PDP Context Deactivation Procedure for A/Gb mode\nNOTE 1:\tSteps 1, 2, 4 and 6 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure step (A) is defined in clause 9.2.4.1A.\nFigure 75: MS Initiated PDP Context Deactivation Procedure for Iu mode\nNOTE 2:\tSteps 1, 4 and 5 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure step (A) is defined in clause 9.2.4.1A.\n1)\tThe MS sends a Deactivate PDP Context Request (TI, Teardown Ind) message to the SGSN. If the MS deactivates the PDP context created by the PDP Context Activation Procedure, the Teardown Ind shall be sent.\n2)\tIn A/Gb mode security functions may be executed. These procedures are defined in clause \"Security Function\".\n3)\tIf the PDP Context was served by a GGSN, the SGSN sends a Delete PDP Context Request (TEID, NSAPI, Teardown Ind, CGI/SAI Information) message to the GGSN. If the MS in the Deactivate PDP Context Request message included Teardown Ind, then the SGSN deactivates all PDP contexts associated with this PDP address and the same APN by including Teardown Ind in the Delete PDP Context Request message. The GGSN removes the PDP context(s) and returns a Delete PDP Context Response (TEID) message to the SGSN. If the MS was using a dynamic PDP address allocated by the GGSN, and if the context being deactivated is the last PDP context associated with this PDP address, then the GGSN releases this PDP address and makes it available for subsequent activation by other MSs. The Delete PDP Context messages are sent over the backbone network. The GGSN may interact with the PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF. For PDP Context using a T6b connection to the SCEF the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\n4)\tThe SGSN returns a Deactivate PDP Context Accept (TI) message to the MS. If this deactivates the last PDP context of the UE then an E-UTRAN capable MS not using CIoT GSM Optimization shall set its TIN to \"P-TMSI\". If PDP contexts remain for the MS, the SGSN recalculates the UE-AMBR and updates the RAN accordingly.\n5)\tIn Iu mode, radio access bearer release is done by the RAB Assignment procedure, if a RAB exists for this PDP context.\n6)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\nAt GPRS detach, all PDP contexts for the MS are implicitly deactivated.\nIf the SGSN receives a Deactivate PDP Context Request (TI) message for a PDP context that is currently being activated, the SGSN shall stop the PDP Context Activation procedure without responding to the MS, and continue with the PDP Context Deactivation initiated by MS procedure.\nThe SGSN determines the Maximum APN Restriction for the remaining PDP contexts and stores this new value for the Maximum APN Restriction.\nThe CAMEL procedure call shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection.\nThe procedure returns as result \"Continue\".\n9.2.4.1A\tMS- and SGSN Initiated Bearer Deactivation Procedure using S4\nWhen MS- and SGSN initiates Bearer Deactivation procedure,\n-\tIf the Tear Down Indicator (Teardown Ind) is set, the procedure in clause 9.2.4.1A.1 is used.\n-\tOtherwise, the procedure in clause 9.2.4.1A.2 is used.\nThe procedures described in figures 74a and figure 74b show only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clauses 9.2.4.1 and 9.2.4.2.\nFor Bearer Deactivation of PDP Context using a T6b connection to the SCEF the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\n9.2.4.1A.1\tMS-and SGSN Initiated PDN connection Deactivation Procedure using S4\nThe procedure described in figure 74a is used when the MS/SGSN initiates PDN connection deactivation.\nFigure 74a: MS- and SGSN Initiated PDN connection Deactivation Procedure using S4\nNOTE 1:\tSteps A) and D) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Steps B and C concern GTP based S5/S8.\nA)\tThe EPS Bearer in the Serving GW regarding this particular MS and the PDN are deactivated by the SGSN by sending Delete Session Request (TEID, EPS Bearer Identity, Teardown Ind, User Location Information), to the Serving GW. This message indicates that all bearers belonging to that PDN connection shall be released.\nNOTE 2:\tThe SGSN does not modify the ISR status even if the last PDP context is deactivated.\nB)\tThe Serving GW sends Delete Session Request (TEID, EPS Bearer Identity, Teardown Ind, User Location Information, User CSG Information) to the PDN GW. This message includes an indication that all bearers belonging to that PDN connection shall be released, i.e. the Teardown Ind. The PDN GW may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\nC)\tThe PDN GW acknowledges the bearer deactivation to the S‑GW by sending a Delete Session Response (TEID).\nD)\tThe Serving GW acknowledges the bearer deactivation to the SGSN with Delete Session Response (TEID).\n9.2.4.1A.2\tMS-and SGSN Initiated Bearer Deactivation Procedure\nThe procedure described in figure 74b is used when the MS/SGSN initiates Bearer Deactivation procedure.\nIn case of RNC Failure, SGSN may based on operator policy either preserve all bearers or initiate the Dedicated Bearer Deactivation procedure, as shown in Figure 74b below. In deactivating the GBR bearers, SGSN may take the EPS bearer QoS into account.\nFigure 74b: MS- and SGSN Initiated Bearer Deactivation Procedure using S4\nNOTE 1:\tSteps A), D) and E) are common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure steps (A1) and (A2) are defined in TS 23.402 [90]. Steps B, C and F concern GTP based S5/S8.\nA)\tThe SGSN sends the Delete Bearer Command (EPS Bearer Identity) message to the Serving GW to deactivate the selected EPS bearer.\nNOTE 2:\tThe SGSN does not modify the ISR status.\nB)\tThe Serving GW sends the Delete Bearer Command (EPS Bearer Identity) message to the PDN GW.\nC)\tThe PDN GW sends a Delete Bearer Request (TEID, EPS Bearer Identity) message to the Serving GW. The PDN GW may have interacted with PCRF beforehand (refer to TS 23.203 [88]).\nIf the bearer deleted is the default bearer (i.e. the UE is not supporting the default bearer concept) it is implementation specific whether the PDN GW keeps the rest of the EPS bearer(s) for the PDN connection or whether the PDN GW initiates a deactivation of the PDN connection.\nD)\tThe Serving GW sends the Delete Bearer Request (TEID, EPS Bearer Identity) message to the SGSN.\nE)\tThe SGSN deletes the bearer contexts related to the deactivated EPS bearer and acknowledges the bearer deactivation to the Serving GW by sending a Delete Bearer Response (TEID, EPS Bearer Identity, User Location Information) message.\nF)\tThe Serving GW deletes the bearer context related to the deactivated EPS bearer and acknowledges the bearer deactivation to the PDN GW by sending a Delete Bearer Response (TEID,EPS Bearer Identity, User Location Information, User CSG Information) message. The PDN GW may interact with the PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.4.1",
        "figure_74",
        "figure_75",
        "ts_23.203",
        "ts_23.682",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.4.2",
      "section_id": "9.2.4.2",
      "section_title": "SGSN-initiated PDP Context Deactivation Procedure",
      "content": "The PDP Context Deactivation Initiated by SGSN procedure is illustrated in Figure 76.\nFigure 76: SGSN-initiated PDP Context Deactivation Procedure\nNOTE 1:\tSteps 2‑4 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure step (A) is defined in clause 9.2.4.1A.\nThis procedure is also used as part of the SIPTO using GW selection function when the SGSN determines that GW relocation is desirable. In this situation the SGSN deactivates the relevant PDN connection(s) using the \"reactivation requested\" cause value, and the UE should then re-establish those PDN connection(s) towards the same APN(s).\n1)\tIf the PDP Context was served by a GGSN, the SGSN sends a Delete PDP Context Request (TEID, NSAPI, Teardown Ind, CGI/SAI) message to the GGSN. If Teardown Ind is included by the SGSN, the GGSN deactivates all PDP contexts associated with this PDP address and the same APN. The GGSN removes the PDP context and returns a Delete PDP Context Response (TEID) message to the SGSN. If the MS was using a dynamic PDP address allocated by the GGSN, and if the context being deactivated is the last PDP context associated with this PDP address, the GGSN releases this PDP address and makes it available for subsequent activation by other MSs. The Delete PDP Context messages are sent over the backbone network. The SGSN may not wait for the response from the GGSN before sending the Deactivate PDP Context Request message. For PDP Context using a T6b connection to the SCEF the SGSN indicates to the SCEF that the connection for the MS is no longer available according to TS 23.682 [119].\nNOTE 2:\tThe CGI/SAI may be outdated as the interaction with MS and RAN happen after step 1.\nThe GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\n2)\tThe SGSN sends a Deactivate PDP Context Request (TI, Teardown Ind, Cause, WLAN offloadability indication) message to the MS. If Teardown Ind is included, all PDP contexts associated with this PDP address and the same APN are deactivated. The MS removes the PDP context(s) and returns a Deactivate PDP Context Accept (TI) message to the SGSN. If this deactivates the last PDP context of the UE then an E-UTRAN capable MS not using CIoT GSM Optimization shall set its TIN to \"P-TMSI\". If PDP contexts remain for the MS, the SGSN recalculates the UE-AMBR and updates the RAN accordingly.\nIf the request is deactivation with reactivation from SGSN, the UE starts MS initiated PDP context Activation Procedure as specified in clauses 9.2.2.1 and 9.2.2.1A by using the same APN of the released PDN connection.\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21 if some PDP contexts associated with this PDP address and the same APN are not deactivated.\n3)\tIn Iu mode, radio access bearer release is done by the RAB Assignment procedure.\n4)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\nThe SGSN determines the Maximum APN Restriction for the remaining PDP contexts and stores this new value for the Maximum APN Restriction.\nThe CAMEL procedure call shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection\nThe procedure returns as result \"Continue\".",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.4.1",
        "clause_5.3.21",
        "figure_76",
        "ts_23.682",
        "ts_23.203",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.4.3",
      "section_id": "9.2.4.3",
      "section_title": "GGSN-initiated PDP Context Deactivation Procedure",
      "content": "The PDP Context Deactivation Initiated by GGSN procedure is illustrated in Figure 77.\nFigure 77: GGSN-initiated PDP Context Deactivation Procedure\nNOTE:\tSteps 2, 4 and ‑5 are common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure step (A) is defined in clause 9.2.4.3A and step (B) is defined in clause 9.2.4.3B.\n1)\tThe GGSN sends a Delete PDP Context Request (TEID, NSAPI, Teardown Ind) message to the SGSN. Teardown Ind indicates whether or not all PDP contexts associated with this PDP address and the same APN shall be deactivated.\nFor an emergency call related PDP address, the GGSN initiates the deactivation of all PDP contexts related to that emergency PDP address when the PDP context is inactive (i.e. not transferring any packets) for a configured period of time or when triggered by dynamic PCC.\n2)\tThe SGSN sends a Deactivate PDP Context Request (TI, Teardown Ind, Cause, WLAN offloadability indication) message to the MS. If Teardown Ind was included by the SGSN, then all PDP contexts associated with this PDP address and the same APN are deactivated. The MS removes the PDP context(s) and returns a Deactivate PDP Context Accept (TI) message to the SGSN. If this deactivates the last PDP context of the UE then an E-UTRAN capable MS shall set its TIN to \"P-TMSI\".\nThe SGSN may include an indication whether the traffic of this PDP context is allowed to be offloaded to WLAN as described in clause 5.3.21 if some PDP contexts associated with this PDP address and the same APN are not deactivated.\n3)\tThe SGSN returns a Delete PDP Context Response (TEID, CGI/SAI) message to the GGSN. If the MS was using a dynamic PDP address allocated by the GGSN, and if the context being deactivated is the last PDP context associated with this PDP address, the GGSN releases this PDP address and makes it available for subsequent activation by other MSs. The Delete PDP Context messages are sent over the backbone network. The SGSN may not wait for the response from the MS before sending the Delete PDP Context Response message. If PDP contexts remain for the MS, the SGSN recalculates the UE-AMBR and updates the RAN accordingly. If there is no signalling with the MS, e.g. because the MS is in PMM_IDLE or STANDBY state, the SGSN provides the last known CGI/SAI.\nIf extended idle mode DRX is enabled, then the SGSN acknowledges the bearer deactivation to the GGSN and at the same time the SGSN initiates the deactivation towards the MS.\nThe GGSN may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.\n4)\tIn Iu mode, radio access bearer release is done by the RAB Assignment procedure.\n5)\tIn A/Gb mode, BSS packet flow context procedures may be executed. These procedures are defined in clause \"BSS Context\".\nThe SGSN determines the Maximum APN Restriction for the remaining PDP contexts and stores this new value for the Maximum APN Restriction.\nThe CAMEL procedure call shall be performed, see referenced procedure in TS 23.078 [8b]:\nC1)\tCAMEL_GPRS_PDP_Context_Disconnection.\nThe procedure returns as result \"Continue\".\n9.2.4.3A\tPDN GW initiated Bearer Deactivation Procedure using S4, part 1\nThe procedure described in figures 77 shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clause 9.2.4.3.\nFigure 77a: PDN GW initiated Bearer Deactivation Procedure using S4, part 1\nNOTE:\tStep B) is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Step A) concern GTP based S5/S8.\nA)\tThe PDN GW sends a Delete Bearer Request (TEID, EPS Bearer Identity, Cause) message to the Serving GW. This message may include an indication that all bearers belonging to that PDN connection shall be released. If the PDN GW deactivates the PDP context created by the PDP Context Activation Procedure, the Teardown Ind shall be sent. The PDN GW may have interacted with PCRF beforehand (refer to TS 23.203 [88]).\nIf the Delete Bearer Request message is sent due to \"handover without optimization from 3GPP to non-3GPP\" then the PDN GW includes the 'Cause' IE set to ' RAT changed from 3GPP to Non-3GPP'.\nFor an emergency PDN connection the PDN GW initiates the deactivation of all bearers of that emergency PDN connection when the PDN connection is inactive (i.e. not transferring any packets) for a configured period of time or when triggered by dynamic PCC.\nB)\tThe Serving GW sends the Delete Bearer Request (TEID, EPS Bearer Identity, Cause) message to the SGSN. This message can include an indication that all bearers belonging to that PDN connection shall be released.\nIf all the bearers belonging to a UE are released due to \"handover without optimization from 3GPP to non-3GPP\", the SGSN changes the MM state of the UE to IDLE (GERAN network) or PMM-DETACHED (UTRAN network).\n9.2.4.3B\tPDN GW initiated Bearer Deactivation Procedure using S4, part 2\nThe procedure described in figures 77b shows only the steps, due to use of S4, that are different from the Gn/Gp variant of the procedure given by clause 9.2.4.3\nFigure 77b: PDN GW initiated Bearer Deactivation Procedure using S4, part 2\nNOTE 1:\tStep A) is common for architecture variants with GTP based S5/S8 and PMIP-based S5/S8. For a PMIP-based S5/S8, procedure step (B1) is defined in TS 23.402 [90]. Step B) concerns GTP-based S5/S8.\nA)\tThe SGSN deletes the bearer context related to the deactivated EPS bearer and acknowledges the bearer deactivation to the Serving GW by sending a Delete Bearer Response (TEID, EPS Bearer Identity, User Location Information) message. If there is no signalling with the MS, e.g. because the MS is in PMM_IDLE or STANDBY state, the SGSN provides the last known CGI/SAI.\nThe SGSN does not modify the ISR status unless the bearer deactivation occurs for the last PDN connection in which case the SGSN deactivates ISR.\nIf extended idle mode DRX is enabled, then the SGSN acknowledges the bearer deactivation to the Serving GW and at the same time the SGSN initiates the deactivation towards the MS.\nB)\tThe Serving GW deletes the bearer context related to the deactivated EPS bearer and acknowledges the bearer deactivation to the PDN GW by sending a Delete Bearer Response (TEID, EPS Bearer Identity, User Location Information) message. The PDN GW may interact with PCRF (refer to TS 23.203 [88]), e.g. to deliver User Location Information and/or UE Time Zone Information if it was requested by the PRCF.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.4.3",
        "clause_5.3.21",
        "figure_77",
        "ts_23.203",
        "ts_23.078",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.5",
      "section_id": "9.2.5",
      "section_title": "Preservation Procedures",
      "content": "By sending a RAB Release Request or Iu Release Request message to the SGSN, an Iu mode RAN initiates the release of one or more RABs. The preservation procedure allows the active PDP contexts associated with the released RABs to be preserved in the CN, and the RABs can then be re-established at a later stage, see clause 9.2.5.2 and clause 9.2.3.5.\nAn Iu mode RAN uses the Iu Release Request to request release of all RABs of an MS, and the RAB Release Request in other cases.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.2.5.2",
        "clause_9.2.3.5"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.5.1.1",
      "section_id": "9.2.5.1.1",
      "section_title": "RAB Release Procedure",
      "content": "An Iu mode RAN initiates a RAB release procedure to release one or several RABs. The RAB Release procedure is described in clause 12.7.2.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.2"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.5.1.2",
      "section_id": "9.2.5.1.2",
      "section_title": "Iu Release Procedure",
      "content": "An Iu mode RAN initiates an Iu release procedure to release all RABs of an MS and the Iu connection. The Iu Release procedure is described in clause 12.7.3.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.3"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.2.5.2",
      "section_id": "9.2.5.2",
      "section_title": "Re-establishment of RABs",
      "content": "The procedure for re-establishment of RABs allows the SGSN to re-establish RABs for active PDP contexts that don't have an associated RAB.\nThe MS initiates the re-establishment of RABs by using the Service Request (Service Type = Data) message. This is described in the clause \"MS Initiated Service Request Procedure\". SGSN shall not establish RABs for PDP contexts with maximum bit rate for uplink and downlink of 0 kbit/s. For these PDP contexts including a TFT with packet filter(s) set by the MS, the MS shall perform a MS-initiated PDP Context Modification or Deactivation procedure. For PDP contexts including a TFT with packet filter(s) set by the network only, the MS does not re-establish the RABs (see clauses 9.2.3.4 and 9.2.3.5).\nWhen RABs for an MS that has no RRC connection needs to be re-established, the CN must first page the MS. The clause \"Network Initiated Service Request Procedure\" describes this.\nWhen RAB(s) are released in S4 SGSN, the received downlink data packet(s) for the preserved EPS bearer(s) may be buffered in the Serving GW. In this case, at reception of the first downlink data packet for one of those EPS bearers, the Serving GW sends a Downlink Data Notification message to the S4 SGSN. When RABs for a UE in PMM-IDLE needs to be re-established, the S4 SGSN must first page the UE. When RAB(s) need to be re-established for a UE that already has an active RRC connection, the S4 SGSN initiates the re-establishment of RABs for all the preserved PDN connections by using the RAB assignment procedure.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.3",
      "section_id": "9.3",
      "section_title": "Packet Routeing and Transfer Function",
      "content": "The packet routeing and transfer function:\n-\troutes and transfers packets between a mobile TE and a packet data network, i.e. between reference point R and reference points Gi or SGi;\n-\troutes and transfers packets between mobile TE across different PLMNs, i.e.:\n-\tbetween reference point R and reference point Gi via interface Gp;\n-\tbetween reference point R and reference point SGi via interface S8;\n-\troutes and transfers packets between TEs, i.e. between the R reference point in different MSs; and\n-\toptionally supports IP Multicast routeing of packets via a relay function in the GGSN and P‑GW.\nThe PDP PDUs shall be routed and transferred between the MS and the GGSN or P‑GW as N‑PDUs. In order to avoid IP layer fragmentation between the MS and the GGSN or P-GW, the link MTU size in the MS should be set to the value provided by the network as a part of the IP configuration. The link MTU size for IPv4 is sent to the MS by including it in the PCO (see TS 24.008 [13]). The link MTU size for IPv6 is sent to the MS by including it in the IPv6 Router Advertisement message (see RFC 4861 [98]).\nWhen using a packet data network connection of type \"non-IP\" (clause 4.3.17.8 of TS 23.401 [89]), the maximum uplink packet size that the MS shall use may be provided by the network as a part of the session management configuration by encoding it within the PCO (see TS 24.008 [13]). To provide a consistent environment for application developers, the network shall use a maximum packet size of at least 128 octets (this applies to both uplink and downlink).\nNOTE 1:\tIdeally the network configuration ensures that for PDP type IPv4v6 the link MTU values provided to the UE via PCO and in the IPv6 Router Advertisement message are the same. In cases where this condition cannot be met, the MTU size selected by the UE is unspecified.\nWhen the MT and the TE are separated, e.g. a dongle based MS, it is not always possible to set the MTU value by means of information provided by the network. The network shall have the capability of transferring N-PDUs containing PDP PDUs, where the PDP PDUs are of 1500 octets, between the MS and GGSN/P-GW.\nNOTE 2:\tThe TE when it is separated from the MT can perform MTU configuration itself and this is out of scope of 3GPP standardization. Thus, when the MT component in the terminal obtains MTU configuration from the network, this does not imply that the behavior of the MS considered as a whole will always employ this MTU. In many terminals having a separated TE, the TE component configured by default to use an MTU of 1500 octets.\nNOTE 3:\tIn network deployments that have MTU size of 1500 octets in the transport network, providing a link MTU value of 1358 octets to the MS as part of the IP configuration information from the network will prevent the IP layer fragmentation within the transport network between the MS and the GGSN/P-GW. Link MTU considerations are discussed further in Annex C.\nNOTE 4:\tAs the link MTU value is provided as a part of the session management configuration information, a link MTU value can be provided during each PDN connection establishments.\nNOTE 5:\tPDP type PPP is supported only when data is routed over a GGSN employing the Gn/Gp interfaces. A P‑GW supports PDP type IPv4, IPv6 and IPv4/v6 only.\nBetween the 2G‑SGSN and the MS, PDP PDUs are transferred with SNDCP. Between the 3G‑SGSN and the MS, PDP PDUs are transferred with GTP‑U and PDCP.\nBetween the SGSN and the GGSN when using Gn/Gp, or between the SGSN and the S‑GW when using S4, PDP PDUs are routed and transferred with the UDP/IP protocols. The GPRS Tunnelling Protocol (GTP) transfers data through tunnels. A tunnel endpoint identifier (TEID) and an IP address identify a GTP tunnel. When a Direct Tunnel is established, PDP PDUs are routed and transferred directly between the UTRAN and the GGSN using Gn or between UTRAN and the S‑GW using S12. On S5/S8 interfaces PMIP may be used instead of GTP (see TS 23.402 [90]).\nWhen multiple PDP contexts exist for the same PDP address/APN pair of an MS, the GGSN routes downlink N‑PDUs to the different GTP tunnels based on the downlink packet filters in the TFTs assigned to the PDP contexts. Upon reception of a PDP PDU, the GGSN evaluates for a match, first the downlink packet filter amongst all TFTs that has the smallest evaluation precedence index and, in case no match is found, proceeds with the evaluation of downlink packet filters in increasing order of their evaluation precedence index. This procedure shall be executed until a match is found, in which case the N‑PDU is tunnelled to the SGSN via the PDP context that is associated with the TFT of the matching downlink packet filter. If no match is found, the N‑PDU shall be sent via the PDP context that does not have a TFT assigned to it; if all PDP contexts have a TFT assigned, the GGSN shall silently discard the PDP PDU.\nWhen multiple PDP contexts exist for the same PDP address/APN pair of an MS, the MS routes uplink PDP-PDUs to the different PDP contexts based on either MS-local mapping for 'MS_only' mode, or based on uplink packet filters in the TFTs assigned to these PDP contexts for 'MS/NW' mode.\nFor 'MS_only' mode (or in 'MS_only' mode after a change from 'MS/NW' mode), upon transmission of a PDP PDU, the MS shall apply local mapping. The MS is responsible for creating or modifying PDP contexts and their QoS. The MS should define TFTs in such a way that downlink PDP PDUs are routed to a PDP context that best matches the QoS requested by the receiver of this PDU (e.g. an application supporting QoS). For each uplink PDP PDU, the MS should choose the PDP context that best matches the QoS requested by the sender of this PDP PDU (e.g. an application supporting QoS). Packet classification and routeing within the MS is an MS-local matter. The GGSN shall not match uplink N‑PDUs against TFTs.\nNOTE 6:\tIf the network applies enforcements of uplink PDP PDUs the network might expect the uplink PDP PDUs to be sent on the same PDP contexts as the corresponding downlink N-PDUs of the same traffic flow i.e. traffic flows might be expected to be bi-directional.\nFor 'MS/NW' mode, upon transmission of a PDP PDU, the MS evaluates for a match, first the uplink packet filter amongst all TFTs that has the smallest evaluation precedence index and, in case no match is found, proceeds with the evaluation of uplink packet filters in increasing order of their evaluation precedence index. This procedure shall be executed until a match is found, or all uplink packet filters have been evaluated. If a match is found, the PDP PDU is transmitted on the PDP context that is associated with the TFT of the matching uplink packet filter. If no match is found, the MS shall send the PDP PDU via the PDP context that has not been assigned any uplink packet filter. If all PDP contexts have been assigned uplink packet filter(s), the MS shall silently discard the PDP PDU.\nNOTE 7:\tIf the MS applies local mapping for an application for 'MS/NW' mode, there is a risk that the PDP PDUs will be dropped by the network as there is no specified way to ensure that there are corresponding PCC rules.\nNOTE 8:\tIf both the MS and the network are compliant to Rel‑11 or a later version of the specification, then the requirements in clause 9.2.0 ensure that only a PDP context that was activated with the PDP Context activation procedure can have a TFT not including any uplink packet filters\nTFTs are used for PDP types IPv4, IPv6, IPv4/v6 and PPP only. For PDP type PPP a TFT is applicable only when PPP is terminated in the GGSN (i.e. GGSN does not provide PDN interworking by means of tunnelled PPP, e.g. by the Layer Two Tunnelling Protocol (L2TP)) and IP traffic is carried over PPP. To support roaming subscribers, and for forward compatibility, the SGSN is not required to know the tunnelled PDP. Every SGSN shall have the capability to transfer PDUs belonging to PDPs not supported in the PLMN of the SGSN.\nIf packet routing and transfer takes place between the SGSN and the S‑GW using S4, or between the UTRAN and the S‑GW using S12, PDP contexts need to be mapped into EPS bearer contexts and vice versa. Context mapping is handled by the SGSN when using S4. This is transparent to the MS.\nThe GGSN and P‑GW could also optionally support IP Multicast: this allows the MSs to join multicast groups and start receiving multicast packets. The GGSN duplicates the incoming multicast packets and relays them to the already active TEIDs. These TEIDs are those of MSs that have joined a multicast group.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401_clause_4.3.17.8",
        "clause_9.2.0",
        "ts_24.008",
        "ts_23.401",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.4",
      "section_id": "9.4",
      "section_title": "Relay Function",
      "content": "The relay function of a network node transfers the PDP PDUs received from the incoming link to the appropriate outgoing link. At the RNC, the SGSN the S‑GW, and the GGSN or P‑GW the relay function stores all valid PDP PDUs until they are forwarded to the next network node or until the maximum holding time of the PDP PDUs is reached. The PDP PDUs are discarded when buffering is longer than their maximum holding time. This maximum holding time is implementation dependent and can be influenced by the PDP type, the QoS of the PDP PDU, the resource load status, and by buffer conditions. The discarding protects resources from useless transfer attempts, especially the radio resource. Impacts on user protocol operation by too short holding time shall be avoided.\nIn A/Gb mode, the SGSN and GGSN or P‑GW relay functions add sequence numbers to PDP PDUs received from SNDCP and from the Gi or SGi reference points, respectively. In Iu mode, the RNC and GGSN or P‑GW relay functions add sequence numbers to PDP PDUs received from PDCP and from the Gi or SGi reference points, respectively.\nPDP PDUs may be re-sequenced in the RNC, the SGSN, and/or in the GGSN depending on the setting of the delivery order attribute in the QoS profile. In A/Gb mode, the SGSN relay function may perform re-sequencing of PDP PDUs before passing the PDP PDUs to SNDCP. In Iu mode, the SGSN relay function may optionally perform re-sequencing of PDP PDUs before passing the PDP PDUs to Iu GTP‑U and before passing the PDP PDUs to Gn GTP‑U. The GGSN relay function may perform re-sequencing of PDP PDUs before passing the PDP PDUs to the Gi reference point. The RNC may perform re-sequencing of PDP PDUs before passing the PDP PDUs to PDCP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.5",
      "section_id": "9.5",
      "section_title": "Packet Terminal Adaptation Function",
      "content": "The Packet Terminal Adaptation function adapts packets received from and transmitted to the Terminal Equipment to a form suitable for transmission within the PLMN.\nA range of MT versions providing different standard interfaces towards the TE can be used, e.g.:\n-\tMT with asynchronous serial interface and PAD (Packet Assembly / Disassembly) support. If the PAD function does not exist in the MT, it exists in the TE.\n-\t\"Embedded MT\" integrated with the TE, possibly via an industry-standard application program interface.\n-\tMT with synchronous serial interface.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.6",
      "section_id": "9.6",
      "section_title": "Encapsulation Function",
      "content": "GPRS transparently transports PDP PDUs between packet data networks and MSs. All PDP PDUs are encapsulated and decapsulated for routeing purposes. Encapsulation functionality exists at the MS, at the RNC, at the Iu mode BSC, at the SGSN, at the S‑GW, and at the GGSN/P‑GW. Encapsulation allows PDP PDUs to be delivered to and associated with the correct PDP context in the MS, the SGSN, or the GGSN/P‑GW. Two different encapsulation schemes are used; one for the backbone network between two GSNs, between SGSNs and S‑GWs, and between an SGSN and an RNC, and one for the A/Gb mode connection between the SGSN and the MS or for the Iu mode RRC connection between the RAN and the MS.\nEncapsulation requires that the MS is attached to GPRS, and that the PDP Context Activation procedure has been executed. If the GPRS Attach or PDP Context Activation procedures cannot be successfully executed, then uplink PDP PDUs are discarded in the MS. If these procedures have not been executed when a downlink PDP PDU arrives in the GGSN /P‑GW, then the downlink PDP PDU shall be discarded, rejected, or the Network-Requested PDP Context Activation procedure shall be initiated. Network-Requested PDP Context Activation is not supported for connectivity over S4.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.6.1",
      "section_id": "9.6.1",
      "section_title": "Encapsulation Between Core Network Nodes",
      "content": "Core network nodes encapsulate a PDP PDU with a GPRS Tunnelling Protocol header, and insert this GTP PDU in a UDP PDU that again is inserted in an IP PDU. The IP and GTP PDU headers contain the core network node addresses and tunnel endpoint identifier necessary to uniquely address a PDP context.\nFor connectivity between SGSNs and between SGSNs and GGSNs based on Gn/Gp, the GTP encapsulation header is defined in TS 29.060 [26]. For connectivity between SGSNs and between SGSNs and S‑GWs based on S16 and S4, respectively, the GTP encapsulation header is defined in TS 29.274 [92].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.060",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.6.2",
      "section_id": "9.6.2",
      "section_title": "Encapsulation Between SGSN and RAN in Iu mode",
      "content": "On the Iu interface, a PDP PDU is encapsulated with a GPRS Tunnelling Protocol header as specified in TS 29.060 [26].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.6.3",
      "section_id": "9.6.3",
      "section_title": "Encapsulation Between SGSN and MS in A/Gb mode",
      "content": "Between an SGSN and an MS in A/Gb mode, an SGSN or MS PDP context is uniquely addressed with a temporary logical link identity and a network layer service access point identifier pair. TLLI is derived from the P‑TMSI. An NSAPI is assigned when the MS initiates the PDP Context Activation function. The relationship between TLLI / NSAPI and LLC / SNDCP is illustrated in Figure 94. TLLI and NSAPI are described in clause \"NSAPI and TLLI for A/Gb mode\".",
      "chunk_type": "general",
      "cross_references": [
        "figure_94"
      ]
    },
    {
      "chunk_id": "ts_23.060_9.6.4",
      "section_id": "9.6.4",
      "section_title": "Encapsulation Between RAN and MS in Iu mode",
      "content": "On the Uu interface, a PDP PDU is encapsulated with PDCP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_9.7",
      "section_id": "9.7",
      "section_title": "Home NodeB Multicast Packet Forwarding Function",
      "content": "A Home NodeB L-GW should receive and process multicast group membership report messages (e.g. according to RFC 3376 [106] / RFC 3810 [107]) sent either by the network accessed by LIPA or by the UE. Based upon these messages, the L-GW should forward multicast IP datagrams messages sent by the UE to the network accessed by LIPA, or from the network accessed by LIPA to the UE, as appropriate.\nThe UE may implement RFC 3376 [106] or RFC 3810 [107] to report multicast groups that the UE seeks to receive.\nTo make UPnP/DLNA service advertisements sent with an IP TTL=1 available to UEs that employ LIPA, a proxying function in the L-GW may be implemented, e.g. to retransmit UPnP service advertisements to UEs after changing the source address. This proxying to the UE shall not be performed if the multicast packet is transmitted with an IPv4 or IPv6 link-local source address, RFC 3927 [108], RFC 4291 [109].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_10",
      "section_id": "10",
      "section_title": "Message Screening Functionality",
      "content": "This screening mechanism may be performed by routers and firewalls, and performs the selection of which packets to allow and which to deny.\nOnly network-controlled message screening shall be supported. Network-controlled screening is used to protect the GPRS packet domain PLMN from known security problems, and the screening provided by a certain PLMN is applied independently of the MS user. Network-controlled screening is outside the scope of this specification.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_11",
      "section_id": "11",
      "section_title": "Compatibility Issues",
      "content": "Non-GPRS MSs in A/Gb mode PLMNs that support GPRS shall, without changes, be able to continue operation.\nPLMNs that do not support GPRS shall, without changes, be able to continue interworking with PLMNs that do support GPRS.\nAn A/Gb mode MS shall be able to access GPRS services with GPRS-aware SIMs, and with SIMs that are not GPRS-aware. A GPRS-aware SIM is able to store information in the elementary files EFKcGPRS and EFLOCIGPRS, as defined in TS 51.011 [28].\nThe compatibility of SIMs and USIMs with A/Gb mode MSs or Iu mode MSs is defined in TS 31.102 [36].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_51.011",
        "ts_31.102"
      ]
    },
    {
      "chunk_id": "ts_23.060_11.1",
      "section_id": "11.1",
      "section_title": "Interaction between Releases 97/98 and 99",
      "content": "NOTE:\tUnless specifically indicated, references to release 97 in this clause refer to both release 97 and release 98.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_11.1.1",
      "section_id": "11.1.1",
      "section_title": "Interactions Between GTP v0 (R97) and GTP v1 (R99)",
      "content": "Support for GTPv0 is removed from 3GPP Rel-8 GTPv1 specification. Therefore, the interactions between GTPv0 (R99) and GTPv1(R99) is not defined and supported, for protocol details see \"Removing support for GTPv1 to GTPv0\" in TS 29.060 [26].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_11.1.2",
      "section_id": "11.1.2",
      "section_title": "Interactions Between MS R97 and CN R99",
      "content": "When an R97 MS activates a PDP context and both the SGSN and the GGSN support R99, the QoS profile shall not be converted to R99.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_11.1.3",
      "section_id": "11.1.3",
      "section_title": "Interactions Between SM R97 and SM R99",
      "content": "The SM protocol shall be backwards compatible.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_11.1.4",
      "section_id": "11.1.4",
      "section_title": "Interactions Between MAP R97 and MAP R99",
      "content": "The MAP protocol shall be backwards compatible to allow interworking between HLRs and SGSNs that support different releases.\n11.1a\tInteractions between Release 7 and earlier Releases\n11.1a.1\tInteractions Between CN (R7) and Iu-mode RAN (pre-R7)\nA Gn/Gp SGSN supporting R7 or later shall be configured with knowledge of the Release supported by the Iu-mode RAN. In addition to the QoS profile negotiation mechanism defined in clause \"Activation Procedures\", the Gn/Gp SGSN shall further select specific values of the QoS profile to be compliant with the Release supported by the Iu-mode RAN, as specified in TS 23.107 [58] for that Release, before contacting the GGSN/P-GW, if appropriate, and performing RAB assignment procedures.\n11.1a.2\tInteractions between CN and RAN to handle Rel‑7 QoS extensions\nTo avoid that bit rates exceeding 16 Mbps are assigned to UEs potentially not capable of handling NAS QoS extensions introduced in Rel‑7, the RNC indicates a \"Higher bitrates than 16 Mbps flag\" in the RANAP Initial UE Message, RANAP Relocation Complete, or RANAP Enhanced Relocation Complete as defined in TS 25.413 [56b] to the SGSN. This flag is set depending on the \"Access stratum release indicator\" defined in TS 25.331 [52]. The \"Higher bitrates than 16 Mbps flag\" is set to \"allowed\" if the \"Access stratum release indicator\" is set to a release of Rel‑7 or higher. Otherwise, it shall be set to \"not allowed\".\nIf the SGSN receives the \"Higher bitrates than 16 Mbps flag\" in RANAP Initial UE Message, RANAP Relocation Complete, or RANAP Enhanced Relocation Complete, it stores it as received in the MM Context of the UE, unless, based on implementation specific logic, the SGSN derives from other information that the UE either supports bitrates higher than 16 MBit/s or not. If \"Higher bitrates than 16 Mbps flag\" is not included by RANAP (since the employed version of the RANAP protocol does not support this feature), the SGSN sets the corresponding flag in the MM Context of the UE depending on implementation.\nNOTE:\tIf the employed RANAP version does not provide the information the SGSN can infer information that the UE is capable of handling NAS QoS extensions introduced in Rel‑7 from MS network capability information, e.g. from information that the UE supports LTE/EPC.\nIf the \"Higher bitrates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\" and if the authorized APN-AMBR is higher than 16 Mbps, the S4-SGSN shall, for non-GBR bearers, restrict the MBR sent to the UE to within 16 Mbps. For GBR bearers, the request shall be rejected if the authorized GBR/MBR is higher than 16 Mbps in the activation and modification procedures.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.107",
        "ts_25.413",
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_11.2",
      "section_id": "11.2",
      "section_title": "Network Configuration for Interaction with E-UTRAN and S4-SGSNs",
      "content": "GPRS idle mode mobility procedures performed by Gn/Gp SGSNs specify a set of sequence number handling functions, e.g. the exchange of sequence numbers during Routing Area Update procedure. E-UTRAN based and S4-SGSN based idle mode mobility procedures don't specify any such sequence number mappings for mobility scenarios. To avoid interoperation issues a network that deploys E-UTRAN and/or S4-SGSNs shall not configure usage of the feature \"delivery order required\" for PDP contexts of PDP type IPv4, IPv6, IPv4v6 or Non-IP. Also the network shall not configure usage of lossless PDCP of UTRAN and the GERAN SGSN shall not configure usage of acknowledged mode LLC/NSAPI/SNDCP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_11.3",
      "section_id": "11.3",
      "section_title": "Interactions between CN and RAN to support higher bit rates",
      "content": "A Gn/Gp SGSN or S4-SGSN supporting QoS extensions available from this release of specification shall be configured with knowledge of the Maximum Bit Rate and Guaranteed Bit Rate supported by the Iu-mode RAN. In addition to the QoS profile negotiation mechanism defined in clause 9.2.2 \"Activation Procedures\", the Gn/Gp SGSN or S4-SGSN shall further select specific values of the QoS profile to be compliant with the Maximum Bit Rate supported by the Iu-mode RAN, as specified in TS 23.107 [58] for that release, before performing RAB assignment procedures.\nFor GBR bearers, the Gn/Gp SGSN shall restrict the Guaranteed Bit Rate in the same way as described for the Maximum Bit Rate above. For GBR bearers, the S4-SGSN shall reject an EPS Bearer Activation or Modification including a Guarantee Bit Rate that is not supported by the Iu-mode RAN. RAB Assignment procedures shall not be initiated in this case.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_9.2.2",
        "ts_23.107"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.1",
      "section_id": "12.1",
      "section_title": "Transmission Modes",
      "content": "In A/Gb mode, the LLC and RLC protocols offer various transmission modes. The combinations of the LLC and RLC transmission modes define the QoS attributes SDU error ratio and residual bit error ratio.\nIn Iu mode, the RLC protocol provides various transmission modes to support user data transmission with different QoS.\nThe RLC protocol for A/Gb mode and the RLC protocol for Iu mode are distinct protocols.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.1.1",
      "section_id": "12.1.1",
      "section_title": "GTP‑U Transmission Modes",
      "content": "One mode of operation of the GTP‑U layer is supported for information transfer between the GGSN and SGSN, unacknowledged (UDP/IP). This is also used between SGSN and S‑GW, between S‑GW and P‑GW, and between RNC and S‑GW. In Iu mode, GTP‑U is also used on the Iu interface for user data transport. Only the unacknowledged mode (UDP/IP) is supported on the Iu interface.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.1.2",
      "section_id": "12.1.2",
      "section_title": "LLC Transmission Modes (A/Gb mode)",
      "content": "Two modes of operation of the LLC layer are defined for information transfer; unacknowledged and acknowledged. The LLC layer shall support both modes simultaneously.\n-\tIn acknowledged mode, the receipt of LL‑PDUs is confirmed. The LLC layer retransmits LL‑PDUs if confirmation has not been received within a timeout period.\n-\tIn unacknowledged mode, there is no confirmation required for LL‑PDUs.\nSignalling and SMS shall be transferred in unacknowledged mode.\nIn unacknowledged mode, the LLC layer shall offer the following two options:\n-\ttransport of \"protected\" information, such that errors within the LLC information field result in the frame being discarded; and\n-\ttransport of \"unprotected\" information, such that errors within the LLC information field do not result in the frame being discarded.\nThe LLC layer shall support several different QoS traffic classes with different transfer delay characteristics.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.1.3",
      "section_id": "12.1.3",
      "section_title": "RLC Transmission Modes",
      "content": "Two modes of operation of the RLC layer are defined for information transfer; unacknowledged and acknowledged. The RLC layer shall support both modes simultaneously.\nThe RLC for A/Gb mode is described in TS 44.060 [77], and for Iu mode in TS 25.322 [55].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_44.060",
        "ts_25.322"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.2",
      "section_id": "12.2",
      "section_title": "Logical Link Control Functionality (A/Gb mode)",
      "content": "The Logical Link Control (LLC) protocol provides a reliable logical link between the MS and its SGSN. As shown in clause \"User and Control Planes\", the LLC layer is situated below the SNDC layer.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.2.1",
      "section_id": "12.2.1",
      "section_title": "Addressing",
      "content": "TLLI is used for addressing at the LLC layer. TLLI is described in clause \"NSAPI and TLLI for A/Gb mode\".",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.2.2",
      "section_id": "12.2.2",
      "section_title": "Services",
      "content": "LLC provides the services necessary to maintain a ciphered data link between an MS and an SGSN. The LLC layer does not support direct communication between two MSs.\nThe LLC connection is maintained as the MS moves between cells served by the same SGSN. When the MS moves to a cell being served by a different SGSN, the existing connection is released and a new logical connection is established with the new SGSN.\nLLC shall be independent of the underlying radio interface protocols. In order to allow LLC to operate with a variety of different radio interface protocols, and to ensure optimum performance, it may be necessary to adjust e.g. the maximum LLC PDU length and the LLC protocol timer values. Such adjustments can be made through negotiation between the MS and the SGSN. The maximum length of an LLC PDU shall not be greater than 1 600 octets minus the BSSGP protocol control information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.2.3",
      "section_id": "12.2.3",
      "section_title": "Functions",
      "content": "The Logical Link Control layer supports:\n-\tservice primitives allowing the transfer of SNDCP Protocol Data Units (SN‑PDUs) between the Subnetwork Dependent Convergence layer and the Logical Link Control layer;\n-\tprocedures for transferring LL‑PDUs between the MS and SGSN, including:\n-\tprocedures for unacknowledged delivery of LL‑PDUs between the MS and the SGSN; and\n-\tprocedures for acknowledged, reliable delivery of LL‑PDUs between the MS and SGSN;\n-\tprocedures for detecting and recovering from lost or corrupted LL‑PDUs;\n-\tprocedures for flow control of LL‑PDUs between the MS and the SGSN; and\n-\tprocedures for ciphering of LL‑PDUs. The procedures are applicable to both unacknowledged and acknowledged LL‑PDU delivery.\nThe layer functions are organised in such a way that ciphering resides immediately above the RLC/MAC layer in the MS, and immediately above the BSSGP layer in the SGSN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.3",
      "section_id": "12.3",
      "section_title": "Subnetwork Dependent Convergence Functionality (A/Gb mode)",
      "content": "The Subnetwork Dependent Convergence (SNDC) protocol is situated below the network layer and above the Logical Link Control layer in the MS and the SGSN, as shown in clause \"User and Control Planes\". A variety of network layers are supported; e.g. IP. The network-layer packet data protocols share the same SNDCP, which performs multiplexing of data coming from the different sources to be sent across the LLC. This is illustrated in Figure 80.\nFigure 80: Multiplexing of Network Protocols\nThe following identities and control information is needed:\n-\tNSAPI identifies the network layer. The SNDCP control part contains compression information.\n-\tTLLI identifies the MS. The LLC control part contains the rest of the LLC protocol header including ciphering information.\nThe Subnetwork Dependent Convergence function is defined in terms of offered services and sub-functions.",
      "chunk_type": "general",
      "cross_references": [
        "figure_80"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.3.1",
      "section_id": "12.3.1",
      "section_title": "Services",
      "content": "The SNDC function provides the following services to the network layer:\n-\tTransmission and reception of N‑PDUs in acknowledged and unacknowledged LLC mode. In acknowledged mode, the receipt of data shall be confirmed at the LLC layer, and the data shall be transmitted and received in order per NSAPI. In unacknowledged mode, the receipt of data shall not be confirmed at the SNDCP layer nor at the LLC layer.\n-\tTransmission and reception between the MS and SGSN of variable-length N‑PDUs.\n-\tTransmission and reception of N‑PDUs between the SGSN and MS according to the negotiated QoS profile.\n-\tTransfer of the minimum amount of data possible between the SGSN and MS through compression techniques.\nThe SNDC function requires the following services from the LLC layer:\n-\tAcknowledged and unacknowledged data transfer.\n-\tCiphered transmission of SN‑PDUs.\n-\tIn-order delivery of SN‑PDUs per LLC SAPI.\n-\tSupport for variable-length SN‑PDUs.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.3.2",
      "section_id": "12.3.2",
      "section_title": "Subfunctions",
      "content": "Figure 81: Sequential Invocation of SNDC Functionality\nSNDCP performs the following subfunctions:\n-\tMapping of SNDC primitives received from the network layer into corresponding LLC primitives to be passed to the LLC layer, and vice versa.\n-\tMultiplexing of N‑PDUs from one or several NSAPIs onto one LLC SAPI. NSAPIs that are multiplexed onto the same SAPI shall use the same radio priority level, and traffic class. In case BSS packet flow contexts are created all NSAPIs that are multiplexed onto the same LLC SAPI shall share the same BSS packet flow context.\n-\tCompression of redundant protocol control information and user data. This may include e.g. TCP/IP header compression and V.42 bis [32] data compression. Compression may be performed independently for each QoS traffic handling priority and traffic class. If several network layers use the same QoS traffic handling priority and traffic class, one common compressor may be used for these network layers. The relationship between NSAPIs, compressors, and SAPIs is defined in TS 44.065 [16]. Compression parameters are negotiated between the MS and the SGSN. Compression is an optional SNDC function. The GGSN may indicate to the SGSN during PDP Context Activation and during Update PDP Context to negotiate no data compression for the PDP context.\n-\tSegmentation and reassembly. The output of the compression subfunctions are segmented to maximum-length LLC frames.",
      "chunk_type": "general",
      "cross_references": [
        "figure_81",
        "ts_44.065"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.4",
      "section_id": "12.4",
      "section_title": "PDCP (Iu mode)",
      "content": "The Packet Data Compatibility Protocol (PDCP) transmission functionality maps network-level characteristics onto the characteristics of the underlying network. PDCP can support several network layer protocols by providing protocol transparency for the users of the service. PDCP provides protocol control information compression. PDCP is located in the MS and the RAN and is described in TS 25.323 [57].",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.323"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.5",
      "section_id": "12.5",
      "section_title": "Point-to-Point Protocol Functionality",
      "content": "The PPP protocol is specified in RFC 1661 [44].\nPDP Type PPP is only supported when using Gn/Gp.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.5.1",
      "section_id": "12.5.1",
      "section_title": "User Plane for PDP Type PPP",
      "content": "The user plane for the PDP type PPP consists of a PPP protocol stack above SNDCP for A/Gb mode or above PDCP for Iu mode in the MS, and above GTP in the GGSN. The GGSN may either terminate the PPP protocol and access the packet data network at the IP level, or further tunnel PPP PDUs via e.g. L2TP.\nIn case the application above PPP uses a different protocol than IP (e.g. IPX or AppleTalk), the interconnection to the packet data network is outside the scope of this specification.\nFigure 82: A/Gb mode User Plane for PDP Type PPP\nFigure 83: Iu mode User Plane for PDP Type PPP",
      "chunk_type": "general",
      "cross_references": [
        "figure_82",
        "figure_83"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.5.2",
      "section_id": "12.5.2",
      "section_title": "Functions",
      "content": "The PPP peers at the MS and the GGSN handle the PPP protocol as specified in RFC 1661 [44]. PPP requires in-sequence packet delivery by the underlying protocols. Concerning GTP, this shall be achieved by negotiation of the delivery order attribute in the QoS profile upon PDP context activation. In A/Gb mode, concerning SNDCP, out-of-sequence packets, that may be present if LLC operates in unacknowledged mode, shall be discarded. SNDCP for A/Gb mode, and PDCP for Iu mode, shall not use TCP/IP header compression because PPP may not carry IP packets at all, or because PPP may carry IP packets with already compressed TCP/IP headers. These PPP options are negotiated during the RFC 1661 [44] Network Control Protocol establishment phase.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.6",
      "section_id": "12.6",
      "section_title": "Gb Interface (A/Gb mode)",
      "content": "The Gb interface connects the BSS and the SGSN, allowing the exchange of signalling information and user data. The Gb interface shall allow many users to be multiplexed over the same physical resource. Resources are given to a user upon activity (when data is sent or received) and are reallocated immediately thereafter. This is in contrast to the A interface where a single user has the sole use of a dedicated physical resource throughout the lifetime of a call irrespective of activity.\nA/Gb mode signalling and user data are sent in the same user plane. No dedicated physical resources are required to be allocated for signalling purposes.\nAccess rates per user may vary without restriction from zero data to the maximum possible line rate (e.g. 1 984 kbit/s for the available bit rate of an E1 trunk).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.6.1",
      "section_id": "12.6.1",
      "section_title": "Physical Layer Protocol",
      "content": "Several physical layer configurations and protocols are possible, as defined in TS 48.014 [19].\nThe physical resources shall be allocated by O&M procedures.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_48.014"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.2",
      "section_id": "12.6.2",
      "section_title": "Link Layer Protocols",
      "content": "Several Gb interface link layer configurations and protocols are possible as defined in TS 48.016 [20].",
      "chunk_type": "general",
      "cross_references": [
        "ts_48.016"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3",
      "section_id": "12.6.3",
      "section_title": "BSS GPRS Protocol",
      "content": "The primary function of BSSGP is to provide the radio-related, QoS, and routeing information that is required to transmit user data between a BSS and an SGSN. In the BSS, it acts as an interface between LLC frames and RLC/MAC blocks. In the SGSN, it forms an interface between RLC/MAC-derived information and LLC frames. A secondary function is to enable two physically distinct nodes, the SGSN and the BSS, to operate node management control functions.\nFigure 84: BSSGP Protocol Position\nThere is a one-to-one relationship between the BSSGP protocol in the SGSN and in the BSS. If one SGSN handles multiple BSSs, the SGSN has to have one BSSGP protocol machine for each BSS. If the BSS applies Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the BSS must have one BSSGP protocol machine for each SGSN to which it applies Intra Domain Connection of RAN Nodes to Multiple CN Nodes.\nThe main functions of the BSSGP protocol are to:\n-\tprovide a connection-less link between the SGSN and the BSS;\n-\ttransfer data unconfirmed between the SGSN and the BSS;\n-\tprovide tools for bi-directional control of the flow of data between the SGSN and the BSS;\n-\thandle paging requests from the SGSN to the BSS;\n-\tgive support for flushing of old messages in the BSS e.g. when an MS changes BSS;\n-\tsupport multiple layer 2 links between the SGSN and one BSS; and\n-\tProvide tools for control of the flow of data between the SGSN and the BSS during PS Handover procedures, as defined in TS 48.018 [78].\nBSSGP is defined in TS 48.018 [78].",
      "chunk_type": "general",
      "cross_references": [
        "figure_84",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.1",
      "section_id": "12.6.3.1",
      "section_title": "Inter-dependency of the BSSGP and LLC Functions",
      "content": "The functions of the BSSGP shall be defined in the context of the LLC function in order to avoid duplication of functions and information flows. The following functional model indicates each layer's functional responsibilities.\nTable 4: Mapping of High-level Functions Across the Gb Architecture\nNetwork Node and Function\nMS\nBSS\nSGSN\nLLC:TS 44.064 [15]\nSame as for the SGSN.\nProvides transfer of frames between the SGSN and MS.\nBSSGP:TS 48.018 [78]\nMS←PLMN:Using BSSGP information, RLC/MAC operations are invoked.MS→PLMN:Using RLC/MAC-derived information, a BSSGP PDU is constructed. An identifier of the cell including RAC and LAC in which an LLC frame was received is in­serted into the BSSGP PDU.Same as for SGSN.\nIndividual MS radio-related information is used by the BSS to transfer LLC frames across the Gb and Um.Provides flow control and unconfirmed data delivery services across the Gb interface (not the Um – this is the function of the LLC and RLC/MAC function).Provides SGSN-BSS node management functions.\nNetwork Service:TS 48.016 [20]\nSame as for SGSN\nProvides a multiplexing, variable-bandwidth, frame-based, link layer transport mechanism across the Gb interface, and load balancing.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_4",
        "ts_44.064",
        "ts_48.018",
        "ts_48.016"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.2",
      "section_id": "12.6.3.2",
      "section_title": "BSSGP Addressing",
      "content": "For information transfer between the SGSN and the BSS, the BSSGP is using a BSSGP Virtual Connection Identifier (BVCI) for addressing. Additionally, QoS profile, and the MS identification, e.g. TLLI, may be used to create queues and contexts in both the SGSN and the BSS. The flow control mechanism is then based on these queues and contexts.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.6.3.3",
      "section_id": "12.6.3.3",
      "section_title": "BVCI Contexts in BSS and in SGSN",
      "content": "A BVCI context in the BSS consists of at least one queue for LLC PDUs and of the radio resource capacity that is available on a radio cell for one SGSN. If the BSS applies Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the BSS must share the total available radio resource capacity for a radio cell between all the BVCI contexts representing this radio cell, where each of these BVCI contexts represents the radio cell for one SGSN.\nThe BVCI context in the BSS is allocated for each cell supporting GPRS. For each new GPRS cell introduced in the BSS area, a new BVCI context shall be allocated. If the BSS applies Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the BSS must have for each cell supporting GPRS and belonging to one pool area, one BVCI context for each of the SGSNs associated with this pool area.\nIn the SGSN, the BVCI context consists of at least one queue for LLC PDUs and the allowed throughput on BSSGP. The allowed throughput is updated by BSSGP flow control messages.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.6.3.4",
      "section_id": "12.6.3.4",
      "section_title": "Flow Control Between SGSN and BSS over the Gb Interface",
      "content": "The flow control mechanism controls the loading of the BSS LLC PDU queues per BVCI, per MS and optionally per one or more PFCs between the SGSN and the BSS in the downlink direction. No flow control is performed in the uplink direction. Buffers and link capacity shall be dimensioned to avoid loss of uplink data.\nThe downlink flow control mechanism is based on the following principles:\n-\tIn the SGSN, queues for LLC PDUs are provided per BVCI. These queues may be split further, e.g. per MS or per packet flow. The SGSN shall pass LLC PDUs to LLC via BSSGP to the BSS as long as the allowed BSSGP throughput is not exceeded. The allowed BSSGP throughput is given per BVCI, for a single MS on that BVCI and optionally for one or more PFCs of a single MS on a certain BVCI. The SGSN schedules the BSSGP downlink traffic of all MSs of a BVCI and, optionally of all PFCs of an MS, according to the maximum and guaranteed bit rate attributes and to the QoS profile related to each LLC PDU. The scheduling algorithm is implementation dependent.\n-\tIn the BSS, queues per BVCI context are provided at the BSSGP level. These queues may be split further, e.g. per MS or per packet flow. Depending on the queuing conditions and the available radio resource capacity in the cell, the BSS indicates the allowed BSSGP throughput per BVCI context and the default allowed BSSGP throughput for each individual MS of that BVCI context by BSSGP flow control messages to the SGSN. Additionally, the BSS may change the allowed BSSGP throughput for one or more PFCs of an individual MS or for an individual MS by a BSSGP flow control message. As more than one SGSN may send downlink data at the same time for a radio cell when the BSS applies Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the BSS has to share the total possible downlink traffic between the SGSNs that can access a radio cell. The BSS should use the existing flow control procedure on BVCI level to control each of the SGSNs in a way not to violate the total possible traffic for the radio cell. How the BSS decides to share the downlink traffic between each of the SGSNs is an implementation specific issue.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.6.3.5",
      "section_id": "12.6.3.5",
      "section_title": "BSS Context",
      "content": "The SGSN may provide a BSS with information related to ongoing user data transmission in A/Gb mode. The information is given as BSS packet flow contexts, which describe QoS characteristics for the data transmission. Network support of BSS packet flow procedures is indicated in the system information as specified in TS 44.060 [77], the MS support is indicated in MS network capability as specified in TS 24.008 [13].\nAll BSS packet flow contexts related to one MS are stored in an MS specific BSS context. The BSS may contain BSS contexts for several MSs. Within a BSS context the BSS packet flow contexts are identified by a packet flow identifier, which is assigned by the SGSN. A BSS packet flow context is shared by one or more LLC SAPIs of the same MS with identical or similar negotiated QoS profiles. The data transfers related to LLC SAPIs that share the same BSS packet flow context constitute one packet flow.\nFour packet flows are pre-defined, and identified by four reserved packet flow identifier values. The BSS shall not negotiate BSS packet flow contexts for these pre-defined packet flows with the SGSN. One pre-defined packet flow is used for best-effort service, one is used for SMS, one is used for TOM (Tunnelling of Messages) and one is used for signalling. The SGSN can assign the best-effort or SMS packet flow identifier to any PDP context. In the SMS case, the BSS shall handle the packet flow for the PDP context with the same QoS with which it handles SMS. A non-reserved packet flow identifier value is only significant for an MS when the SGSN provided the BSS with a packet flow context for this packet flow identifier value for this MS.\nThe combined BSS QoS profile for the PDP contexts that share the same packet flow is called the aggregate BSS QoS profile. The aggregate BSS QoS profile is considered to be a single parameter with multiple data transfer attributes as defined in clause \"Quality of Service Profile\". It defines the QoS that must be provided by the BSS for a given packet flow between the MS and the SGSN, i.e. for the Um and Gb interfaces combined. The aggregate BSS QoS profile is negotiated between the SGSN and the BSS. In order to control UE-AMBR, the SGSN shall group all non-GBR PDP contexts for an MS into a single aggregate BBS QoS profile and set the MBR parameter of that profile to equal the UE-AMBR.\nNOTE:\tIn order to maintain relative priority, associated with PDP contexts, of packets, implementation should ensure that packets are prioritised/scheduled appropriately before being passed into the BSS packet flow context.\nA BSS packet flow timer indicates the maximum time that the BSS may store the BSS packet flow context. The BSS packet flow timer shall not exceed the value of the READY timer for this MS. The BSS packet flow timer is started when the BSS packet flow context is stored in the BSS and when an LLC frame is received from the MS. When the BSS packet flow timer expires, the BSS shall delete the BSS packet flow context.\nWhen a PDP context is activated, modified or deactivated, the SGSN may create, modify, or delete BSS packet flow contexts.\nPS Handover procedure is used to handover an MS with one or more packet flows from a source cell to a target cell. Handling of the BSS packet flows during PS Handover procedures over the BSSGP are described in TS 43.129 [87] and TS 48.018 [78].",
      "chunk_type": "general",
      "cross_references": [
        "ts_44.060",
        "ts_24.008",
        "ts_43.129",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.5.1",
      "section_id": "12.6.3.5.1",
      "section_title": "BSS Packet Flow Context Creation Procedure",
      "content": "On receiving a request to transmit an uplink or downlink LLC PDU for which no BSS packet flow context exists in the BSS, the BSS may request the download of the BSS packet flow context from the SGSN.\nIf MS and BSS supports BSS packet flow procedures the SGSN may at any time request the creation of a BSS packet flow context, e.g. due to the activation of a PDP context.\nIf a request to create a BSS Packet Flow is received in the BSS for an MS during the ongoing PS Handover procedure, then the BSS shall ignore the request and apply the procedures as described in TS 48.018 [78].\nThe BSS Packet Flow Context Creation procedure is illustrated in Figure 85.\nFigure 85: BSS Packet Flow Context Creation Procedure\n1)\tThe BSS receives a request to transfer an uplink or downlink user data LLC PDU for which it currently does not have a BSS packet flow context. In the uplink case, TLLI, Radio Priority, and Packet Flow Id are received from the MS as defined in TS 44.060 [77]. In the downlink case, TLLI and Packet Flow Id are received from the SGSN as defined in TS 48.018 [78]. If Packet Flow Id does not indicate a pre-defined value the BSS sends a Download BSS Packet Flow Context Request (RAI, TLLI, Packet Flow Id) message to the SGSN. Until the BSS receives the BSS packet flow context, the BSS shall handle uplink and downlink transfers according to a default aggregate BSS QoS profile. For uplink transfers, the default profile is specific to the radio priority level.\n2)\tThe SGSN sends a Create BSS Packet Flow Context Request (IMSI, TLLI, Packet Flow Id, Aggregate BSS QoS Profile Requested, BSS Packet Flow Timer) message to the associated BSS. The SGSN derives Aggregate BSS QoS Profile Requested from the QoS profile negotiated for the PDP contexts that share a packet flow as follows: The SGSN shall divide the transfer delay attribute in the QoS profile in one core network part and one BSS part. The SGSN estimates the transfer delay in the core network and subtracts this from the GPRS bearer service transfer delay. The result only covers the delay in the MS to SGSN segment of the GPRS PLMN. Since the BSS transports LLC PDUs obtained after segmentation of SDUs by the SNDCP layer, the SGSN shall convert the values of the GPRS bearer service attributes maximum SDU size, SDU error ratio, residual bit error ration, maximum bit rate, guaranteed bit rate and the resulting transfer delay to values applicable to the LLC PDUs. All other attributes in Aggregate BSS QoS Profile shall be the same as the corresponding GPRS bearer service attribute, see TS 23.107 [58]. The SGSN may also include the Allocation / Retention Priority Information Element in the Create BSS Packet Flow Context Request.\n3)\tThe BSS may restrict the requested aggregate BSS QoS profile given its capabilities and the current load. If the Allocation / Retention Priority Information Element is included by the SGSN in the Create BSS Packet Flow Context Request, the BSS may use it to perform queuing of the packet flow context creation or to pre-empt other packet flow contexts. The BSS creates a BSS packet flow context and inserts the parameters in its BSS context. The BSS returns a Create BSS Packet Flow Context Accept (IMSI, Packet Flow Id, Aggregate BSS QoS Profile Negotiated) message to the SGSN. The BSS uses the negotiated aggregate BSS QoS profile when allocating radio resources and other resources such as buffer capacity. The detailed operation is defined in TS 48.018 [78]. If the SGSN Aggregate BSS QoS Profile requested by the SGSN was restricted by the BSS, the SGSN takes the BSS restriction into account when indicating to the MS the negotiated QoS of the associated PDP context(s).",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_85",
        "ts_48.018",
        "ts_44.060",
        "ts_23.107"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.5.2",
      "section_id": "12.6.3.5.2",
      "section_title": "SGSN-Initiated BSS Packet Flow Context Modification Procedure",
      "content": "The SGSN may at any time request the modification of the contents of an existing BSS packet flow context, e.g. due to the activation, modification, or deactivation of a PDP context, or modification of the UE-AMBR value. The BSS Packet Flow Context Creation procedure shall be used in this case, and the BSS shall instead of creating a BSS packet flow context overwrite the existing parameters with the modified parameters.\nThe BSS Packet Flow Context Modification procedure will never be initiated for an MS during the ongoing PS Handover procedure as described in TS 48.018 [78].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.5.3",
      "section_id": "12.6.3.5.3",
      "section_title": "BSS-Initiated BSS Packet Flow Context Modification Procedure",
      "content": "The BSS can at any time request modification of the contents of an existing BSS packet flow context, e.g. due to a change in the resource availability at the BSS.\nThe BSS-Initiated BSS Packet Flow Context Modification procedure is illustrated in Figure 86.\nFigure 86: BSS-Initiated BSS Packet Flow Context Modification Procedure\n1)\tThe BSS sends a Modify BSS Packet Flow Context Request (IMSI, Packet Flow Id, Aggregate BSS QoS Profile Requested) message to the SGSN.\n2)\tThe SGSN may restrict the requested aggregate BSS QoS profile given its capabilities and the current load. The SGSN returns a Modify BSS Packet Flow Context Accept (IMSI, TLLI, Packet Flow Id, Aggregate BSS QoS Profile Negotiated, BSS Packet Flow Timer) message to the BSS. The BSS inserts the modified parameters in its BSS context.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_86"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.6.3.5.4",
      "section_id": "12.6.3.5.4",
      "section_title": "BSS Packet Flow Context Deletion Procedures",
      "content": "The BSS may, due to e.g. memory restrictions or user inactivity, at any time delete a BSS packet flow context without notifying the SGSN.\nIf the BSS is no longer able to support the aggregate BSS QoS profile of a BSS packet flow context, it may, especially for conversational or streaming traffic class, request the SGSN to delete or modify the BSS packet flow context. The SGSN should either modify or delete the BSS packet flow context. In addition the SGSN may need to initiate the PDP Context Modification or PDP Context Deletion procedure.\nIf a Delete BSS Packet Flow Context Request is received for an MS during the ongoing PS Handover procedure, the procedures applied are described in TS 48.018 [78].\nFigure 86a: BSS-Initiated BSS Packet Flow Context Deletion Procedure\n1)\tThe BSS sends a Delete BSS Packet Flow Context Request (TLLI, Packet Flow Id, Cause) to the SGSN.\n2)\tThe SGSN should start either the SGSN-initiated BSS packet flow context modification procedure or the deletion of the BSS packet flow context. In addition the SGSN may need to initiate the PDP Context Modification or PDP Context Deletion procedure.\nThe SGSN may request the deletion of a BSS packet flow context with the SGSN-Initiated BSS Packet Flow Context Deletion procedure, as illustrated in Figure 87.\nFigure 87: SGSN-Initiated BSS Packet Flow Context Deletion Procedure\n1)\tThe SGSN sends a Delete BSS Packet Flow Context Request (TLLI , Packet Flow Id) message to the BSS. The BSS deletes the corresponding BSS packet flow context from its BSS context.\n2)\tThe BSS returns a Delete BSS Packet Flow Context Accept (TLLI, Packet Flow Id) message to the SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_48.018_figure_86",
        "figure_87",
        "ts_48.018"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7",
      "section_id": "12.7",
      "section_title": "Iu Interface (Iu mode)",
      "content": "The Iu interface connects the UTRAN or Iu mode GERAN and the Core Network allowing the exchange of signalling information and user data. The user plane of the Iu interface shall allow user data from many users to be multiplexed over the same physical resource. Resources are given to a user upon activity (when data is sent or received) and are reallocated immediately thereafter.\nIn Iu mode only user data is transmitted on this shared physical medium. Signalling data is transferred via an SCCP connection. Two different options exist for the transport of signalling and user data over Iu: the ATM transport option and the IP transport option. The different protocol stacks applicable to the Iu interface are described in TS 25.412 [56] for the control plane and TS 25.414 [64] for the user plane.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_25.412",
        "ts_25.414"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.1",
      "section_id": "12.7.1",
      "section_title": "Consistent Sequence Numbering of PDUs on Iu and Gn Interfaces",
      "content": "The GTP‑U PDU sequence numbers allocated by the GGSN (downlink) and SRNS/SBSS (uplink) are kept unchanged irrespective of the number of GTP tunnels the PDU is transferred over. Therefore, SGSN shall use on the Iu interface for downlink PDUs the GTP‑U sequence number received from the GGSN, and shall use on the Gn interface for uplink PDUs the GTP‑U sequence number received from the SRNS/SBSS. In case of SRNS/SBSS relocation and inter-system change, the SRNS/SBSS and SGSN shall tunnel PDUs without changing the GTP‑U sequence numbers.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.7.2.1",
      "section_id": "12.7.2.1",
      "section_title": "RAB Release Procedure using Gn/Gp",
      "content": "UTRAN initiates a RAB release procedure to release one or several RABs. The RAB Release procedure is illustrated in Figure 88a.\nFigure 88a: RAB Release Procedure Using Gn/Gp\n1)\tUTRAN initiates the procedure by sending a RAB Release Request (For each RAB to be released: RAB ID, Cause) message to the SGSN.\n1a)\tIf PDP Contexts associated with the released RABs are using streaming or conversational traffic class and to be preserved, or Direct Tunnel was established the SGSN sends Update PDP Context Request to the GGSN(s) concerned to establish the GTP tunnel between SGSN and GGSN. The GGSN(s) update the Address for User Plane and TEID for downlink data and return an Update PDP Context Response. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS attributes and that the GGSN shall not negotiate the QoS attributes. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. See clause12.7.2.2 when S4 interface is used.\n2)\tThe SGSN sends a RAB Assignment Request (For each RAB to be released: RAB ID, Cause) to the UTRAN.\n3)\tThe Radio Bearer(s) are released if still existing.\n4)\tUTRAN sends a RAB Assignment Response (For each released RAB: RAB ID, GTP SND, GTP SNU) to the SGSN. GTP SND and GTP SNU enable the SGSN to restore the values in case the PDP context is maintained and the RAB is re-established at a later stage.\nIf the RAB for the LIPA PDP Context is released, the HNB informs the collocated L-GW by internal signalling to release the direct user plane path between the L-GW and HNB of the LIPA PDP context.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_88"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.2.2",
      "section_id": "12.7.2.2",
      "section_title": "RAB Release Procedure using S4",
      "content": "The following illustrates the procedure between SGSN and S‑GW when RAB Release Procedures takes place over S4. The procedure between MS and SGSN is same as specified in clause 12.7.2.1.\nFigure 88b: RAB Release Procedure Using S4\nA.\tThe SGSN deactivates affected PDP context using streaming or conversational traffic class as specified in clause 9.2.4.2. For all other traffic classes, the SGSN preserves the affected PDP context.\nIf PDP Contexts associated with the released RAB is to be preserved and Direct Tunnel is established the SGSN sends Release Access Bearers Request to the S‑GW concerned to remove RNC address and TEID.\nB.\tS‑GW sends Release Access Bearers Response to SGSN. The SGSN update the Address for User Plane and TEID for downlink data.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.2.1",
        "clause_9.2.4.2",
        "figure_88"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.3.1",
      "section_id": "12.7.3.1",
      "section_title": "Iu Release Procedure Using Gn/Gp",
      "content": "This procedure is used to release the Iu interface. This procedure also triggers the release of all the Iu connections and changes the 3G‑SGSN PMM state to PMM‑IDLE. Both RAN-initiated and SGSN-initiated Iu release procedures are shown in Figure 89a.\nNOTE 1:\tMessage 1 is only sent when the RAN-initiated Iu release procedure is considered.\nNOTE 2:\tMessage 1 is not sent but message 2 is sent when the SGSN-initiated Iu release procedure is considered.\nFigure 89a: Iu Release Procedure Using Gn/Gp\n1)\tThe RAN notices that the RRC connection has been released or detects a need to release the radio resources. It sends an Iu Release Request (Cause) message to the SGSN. Cause indicates the reason for the release (e.g. O&M Intervention, Unspecified Failure, User Inactivity, Repeated Integrity Checking Failure, or Release due to UE generated signalling connection release). User Inactivity means that the RAN decided to release an MS that shows no more activity, in the case where the MS has only non real-time RABs established, in order to optimise the radio usage after the RRC-Connection-Release timer expired.\n1a)\tIf PDP Contexts associated with the released RABs are using streaming or conversational traffic class and to be preserved, or Direct Tunnel was established the SGSN sends Update PDP Context Request to the GGSN(s) concerned to establish the GTP tunnel between SGSN and GGSN. The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS attributes and that the GGSN(s) shall not negotiate the QoS attributes. The GGSN(s) update the Address for User Plane and TEID for downlink data and return an Update PDP Context Response. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. See clause 12.7.3.2 when S4 interface is used.\n2)\tThe SGSN releases the Iu by sending the Iu Release Command (Cause) message to the RAN. This message may be triggered either by an Iu Release Request message, or by another SGSN event (e.g. authentication failure, detach or the subscription to the CSG ID expires). The SGSN shall take the responsibility to release the Iu interface when the UE has no active PDP context, either immediately or after some timeout. It is optional for the SGSN to send the Iu Release Command message after an Iu Release Request message with Cause set to User Inactivity is received from the RAN.\n3)\tIf the RRC connection is not already released (Cause = User Inactivity), the RAN sends a Release RRC Connection message to the MS.\n4)\tThe MS returns a Release RRC Connection Acknowledge message to the RAN.\n5)\tThe RAN confirms the Iu release by returning an Iu Release Completion (for each released RAB: RAB ID, GTP SND, GTP SNU) message to the SGSN. GTP SND and GTP SNU enable the SGSN to restore the values in case the PDP context is maintained and the RAB is re-established at a later stage.\nIf the RNC does not receive the Release RRC Connection Acknowledge message and if Cause is different from Authentication Failure or Detach, it should send a failure message to the SGSN, and the SGSN should stay in the MM‑CONNECTED state.\nIf LIPA is active for a PDN connection, the HNB informs the collocated L-GW by internal signalling to release the direct user plane path between the L-GW and the HNB.\nAfter Iu release, the MS and the SGSN shall modify PDP context(s) that use streaming or conversational traffic class according to the rules in clause \"RNC-Initiated PDP Context Modification Procedure\".",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.3.2",
        "figure_89"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.3.2",
      "section_id": "12.7.3.2",
      "section_title": "Iu Release Procedure Using S4",
      "content": "The following illustrates the procedure between SGSN and S‑GW when Iu Release Procedures takes place over S4. The procedure between MS and SGSN is same as specified in clause 12.7.3.1.\nFigure 89b: Iu Release Procedure Using S4\nA.\tThe SGSN deactivates the PDP contexts using streaming or conversational traffic class as specified in clause 9.2.4.2. For all other cases, the SGSN preserves the PDP contexts.\nIn case of RNC Failure, SGSN may based on operator policy either preserve all bearers or initiate the Dedicated Bearer Deactivation procedure. See clause 9.2.4.1A.2.\nIf PDP Contexts associated with the released RABs are to be preserved and:\n-\tif ISR is activated or Direct tunnel is established, the SGSN shall send Release Access Bearers Request to the S‑GW. For Direct Tunnel, the S‑GW removes RNC address for user plane and downlink S12 GTP-U TEID. Otherwise the S‑GW removes the SGSN addresses for user plane and downlink S4 GTP-U TEIDs.\n-\tin other cases the SGSN can optionally send a Release Access Bearers Request to the SGW to remove the downlink user plane on S4.\nB.\tThe S‑GW returns a Release Access Bearers Response to SGSN.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.3.1",
        "clause_9.2.4.2",
        "clause_9.2.4.1",
        "figure_89"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.4.1",
      "section_id": "12.7.4.1",
      "section_title": "RAB Assignment Procedure Using Gn/Gp",
      "content": "The purpose of the RAB Assignment procedure is to enable establishment of new RABs for a given MS and/or modification and/or release of already established RABs. When this procedure is executed and if there is any PDP context without radio access bearer assigned, the SGSN will decide which RABs to re-establish. The same messages are used for the three mentioned actions and it is only the content carried by the messages that is different. The RAB Assignment procedure, which is shown below, is specified in TS 25.413 [56b]. The RRC protocol is specified in TS 25.331 [52].\nFigure 90a: RAB Assignment Procedure Using Gn/Gp\nFor LIPA or SIPTO at the local network with L-GW function collocated with the HNB PDN connection, when the L-GW receives the downlink data for an MS after the direct user plane path between the HNB and L-GW is released for that PDP context as defined in clause 12.7.2, the L GW sends the first downlink user packet to the SGSN and buffers all other downlink user packets.\n1)\tThe SGSN sends a RAB Assignment Request (MSISDN, APN, Charging characteristics) message to the RAN to establish, modify, or release one or several RABs. For each requested RAB or modified, if the RAB is allowed for queuing and the resource situation requires it, the RAN may place the RAB in the establishment queue. If Direct Tunnel is used the SGSN provides to the RNC the GGSN's Address(es) for User Plane and TEID(s) for Uplink data. If any Release 7 new QoS IEs i.e. extended maximum bitrate and/or extended guaranteed bitrate are requested, QoS negotiation should be allowed. For RABs belonging to a PDP context/PDN connection for local IP access or SIPTO at the Local Network with L-GW function collocated with the HNB, the RAB Assignment Request message includes a Correlation ID for enabling the direct user plane path between the HNB and the L‑GW. For RABs belonging to a PDP context/PDN connection for SIPTO at the Local Network with L‑GW function collocated with the HNB, the RAB Assignment Request message includes a SIPTO Correlation ID for enabling the direct user plane path between the HNB and the L‑GW.\nNOTE 1:\tIn this release of the 3GPP specification the Correlation ID and SIPTO Correlation ID is set equal to the user plane GGSN TEID that the Gn-SGSN has revceived in step 4 of clause 9.2.2.1 or the user plane PDN GW TEID that the S4-SGSN has received in step D of clause 9.2.2.1A. For more detailed description on the usage of Correlation ID and SIPTO Correlation ID refer to TS 23.401 [89].\nThe SGSN may add, modify or remove the UE-AMBR in parallel to any requested RAB procedures. If the Access Restriction is present in the MM context, the Service Handover related information shall be included by S4-SGSN for the RAB Assignment Request message in order for RNC to restrict the UE in connected mode to handover to the RAT prohibited by the Access Restriction. MSISDN, APN and Charging characteristics are optional parameters and only transferred if SGSN supports SIPTO at Iu-ps.\n2)\tThe RAN establishes, modifies, or releases the appropriate radio bearers.\n3)\tThe RAN returns a RAB Assignment Response message to the SGSN. If the request to establish or modify one or several RABs has been queued, the RAN will report the outcome of the establishment or modification in subsequent RAB Assignment Response messages. The RAN returned MBR and/or GBR shall not exceed the maximum value corresponding to the 3GPP release the UE supports. If the SGSN receives a RAB Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided (e.g. \"Requested Maximum Bit Rate not Available\"), then the SGSN may send a new RAB Assignment Request message with different QoS profile(s). The number of re-attempts, if any, as well as how the new QoS profile(s) values are determined is implementation dependent. If the LIPA or SIPTO at the Local Network with L-GW function collocated with the HNB PDP context is requested in the RAB Assignment, the internal direct user plane path is established between the HNB and L-GW. The downlink packet in the SGSN is forwarded to the HNB and the packets buffered in the L-GW are forwarded to the HNB on the direct user plane path.\n4)\tIf the SGSN established Direct Tunnel it shall send Update PDP Context Request to the GGSN(s) concerned and include the RNC's Address for User Plane, downlink TEID for data, No QoS negotiation indication and the DTI. DTI is used to instruct the GGSN to apply Direct Tunnel specific error handling as described in clause 13.8, The No QoS negotiation indication is set in Update PDP Context Request to indicate to the GGSN that the SGSN does not upgrade the previously negotiated QoS attributes and that the GGSN(s) shall not negotiate the QoS attributes. The GGSN(s) update the Address for User Plane and TEID for downlink data and return an Update PDP Context Response. The GGSN(s) shall not include a PCO in the Update PDP Context Response if the No QoS negotiation indication is set. See clause 12.7.4.2 when S4 interface is used.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.2",
        "clause_9.2.2.1",
        "clause_13.8",
        "clause_12.7.4.2",
        "ts_25.331_figure_90",
        "ts_25.413",
        "ts_25.331",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.4.2",
      "section_id": "12.7.4.2",
      "section_title": "RAB Assignment Procedure Using S4",
      "content": "The following illustrates the procedure between SGSN and S‑GW when RAB Assignment Procedures takes place over S4. The procedure between MS and SGSN is same as specified in clause 12.7.4.1.\nFor LIPA PDN connection, the downlink data handling in the L-GW as described in clause 12.7.4.1 is applied with one difference: If the SGSN established direct tunnel, the L-GW sends the first downlink user packet to the Serving GW. Otherwise, if the SGSN did not establish the direct tunnel, the L-GW sends the first downlink user packet to the SGSN.\nIf the SGSN receives a RAB Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, the SGSN shall not re-attempt to send a new RAB Assignment Request message with different QoS profile(s) and also the step A and B below shall not be performed for the non-established RABs.\nFigure 90b: RAB Assignment Procedure Using S4\nA.\tIf the SGSN established Direct Tunnel it shall send Modify Bearer Request to the S‑GW concerned and include the RNC's Address for User Plane, downlink TEID for data, No QoS negotiation indication and the DTI. DTI is used to instruct the S‑GW to apply Direct Tunnel specific error handling as described in clause 13.8.\nB.\tThe S‑GW update the Address for User Plane and TEID for downlink data and return a Modify Bearer Response to S‑GW.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_12.7.4.1",
        "clause_13.8",
        "figure_90"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.7.5",
      "section_id": "12.7.5",
      "section_title": "Location Reporting Procedure",
      "content": "This procedure is used by an SGSN to request the RAN to report where the MS is currently located, or to report when the MS moves into or out of a given service area. This procedure is defined for Iu mode and may be used for services that require location information (e.g. CAMEL and emergency calls).\nFigure 91: Location Reporting Procedure\n1)\tThe SGSN detects from the subscriber data the need to monitor in which service area an MS in the PMM‑CONNECTED state with an Iu interface connection is located. The SGSN sends a Location Reporting Control (Service Area Code(s), Reporting Type) message to the RAN. The RAN stores the Service Area Code(s) as reporting area(s) for this MS. For example, a service area may be a location area with restricted access. Reporting Type indicates whether the message is intended to start a reporting period or trigger a stand-alone report about the current location of the MS.\n2)\tThe RAN detects that the MS moves into or out of a reporting area. Alternatively, the RAN derives the current location of the MS if this was requested by the SGSN.\n3)\tThe RAN sends a Location Report message informing the SGSN about where the MS is located. When the SGSN has requested the current location of the MS, the RAN shall include the requested location information , i.e. the Service Area Indication, in the Location Report message, if the RAN cannot determine current Service Area of the mobile, it indicates that the request could not be fulfilled, and may report Last Known Service Area with an indication of how long has past since the mobile was known to be in the indicated Service Area. The SGSN may then perform specific actions.\n4)\tThe SGSN can send a Cancel Location Reporting message to inform the RAN that it should terminate location reporting for a given MS. This message is needed only when the reporting was requested for a reporting period.\nThe procedure is implicitly cancelled at SRNC/SBSC relocation. If the service is still required in the new SRNC/SBSC or new SGSN, a new Location Reporting Control message shall be sent.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_91"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.8",
      "section_id": "12.8",
      "section_title": "Abis Interface (A/Gb mode)",
      "content": "When the MAC and RLC layer functions are positioned remote to the BTS, the information between the Channel Codec Unit (CCU) and the remote Packet Control Unit (PCU) is transferred in frames with a fixed length of 320 bits (20 ms). In the present document these frames are denoted \"PCU Frames\" and are an extension to the \"TRAU frames\" defined in TS 48.060 [22]. Within these frames both GPRS data and the RLC/MAC associated control signals are transferred.\nThe Abis interface should be the same if the PCU is positioned at the BSC site (option B in Figure 92) or at the SGSN site (option C in Figure 92). In option B, the PCU could be implemented as an adjunct unit to the BSC. In option C, the BSC should be considered as transparent for 16 kbit/s channels. In configurations B and C the PCU is referred to as being a remote PCU.\nThe remote PCU is considered a part of the BSC, and using BSC internal signals may provide the signalling between the BSC and the PCU. The in-band signalling between the CCU and the PCU functions, using PCU frames is required when the Abis interface is applied (options B and C in Figure 92).\nFigure 92: Remote Packet Control Unit (PCU) Positions\nThe PCU is responsible for the following MAC and RLC layer functions as defined in TS 43.064 [11]:\n-\tLLC layer PDU segmentation into RLC blocks for downlink transmission;\n-\tLLC layer PDU reassembly from RLC blocks for uplink transmissions;\n-\tPDCH scheduling functions for the uplink and downlink data transfers;\n-\tPDCH uplink ARQ functions, including RLC block Ack / Nack;\n-\tPDCH downlink ARQ function, including buffering and retransmission of RLC blocks;\n-\tchannel access control functions, e.g. access requests and grants; and\n-\tradio channel management functions, e.g. power control, congestion control, broadcast control information, etc.\nThe functions inside the Channel Codec Unit (CCU) are:\n-\tthe channel coding functions, including FEC and interleaving;\n-\tradio channel measurement functions, including received quality level, received signal level and information related to timing advance measurements; and\n-\tfor EGPRS, in case of incremental redundancy mode of operation, enhanced channel coding functions.\nThe BSS is responsible for allocation and de-allocation of radio resources. A PCU frame shall be transferred between the PCU and the CCU every 20 ms.",
      "chunk_type": "general",
      "cross_references": [
        "figure_92",
        "ts_48.060",
        "ts_43.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_12.8.1",
      "section_id": "12.8.1",
      "section_title": "Remote Packet Control Unit",
      "content": "When the Packet Control Unit (PCU) is remote to the BTS, the Channel Codec Unit (CCU) in the BTS may control some of the functions in the remote PCU in the BSC. As well, the PCU may control some of the functions of the CCU. Inband signalling provides the remote control by using the control bits (C‑bits) in each PCU frame.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_12.9",
      "section_id": "12.9",
      "section_title": "Gn Interface (A/Gb mode)",
      "content": "During the PS handover procedure the PS Handover Request Context containing packet flow specific information needs to be transferred between SGSNs. The detailed description of the procedures used during PS handover from GERAN A/Gb mode to GERAN A/Gb mode or GERAN A/Gb mode to Iu mode and vice-versa are described in TS 29.060 [26].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_13",
      "section_id": "13",
      "section_title": "Information Storage",
      "content": "This clause describes information storage structures required for GPRS, and the recovery and restoration procedures needed to maintain service if inconsistencies in databases and lost or invalid database information occur.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_13.1",
      "section_id": "13.1",
      "section_title": "HLR/HSS",
      "content": "IMSI is the prime key to the subscription data stored in the HLR/HSS. There may be several sets of PS subscription data per IMSI. This is illustrated in Figure 93.\nFigure 93: Subscription Data\nAs Figure 93 indicates, the PS subscription data is at the same level as basic services. Each PDP subscription is seen as a basic service. Supplementary services are provisioned as part of the overall subscription. Activation of SSs is either at the basic service level (SS1) or at the overall subscription level (SS2).\nTable 5 shows the GPRS/EPS subscription data contained in the HLR/HSS.\nTable 5: HLR/HSS GPRS/EPS Subscription Data\nField\nDescription\nIMSI\nIMSI is the main reference key.\nMSISDN\nThe basic MSISDN of the MS. (Presence of the MSISDN is optional).\nSGSN Number\nThe SS7 number of the SGSN currently serving this MS.\nSGSN Address\nThe IP address of the SGSN currently serving this MS.\nSubscribed Charging Characteristics\nThe charging characteristics for the MS, e.g. normal, prepaid, flat-rate, and/or hot billing subscription.\nTrace Reference\nIdentifies a record or a collection of records for a particular trace.\nTrace Type\nIndicates the type of trace, e.g. MSC/BSS trace, HLR trace, and/or SGSN/GGSN/BSS trace.\nOMC Identity\nIdentifies the OMC that shall receive the trace record(s).\nSMS Parameters\nSMS-related parameters, e.g. operator-determined barring.\nMS PS Purged for GPRS\nIndicates that the MM and PDP contexts of the MS are deleted from the SGSN.\nMNRG\nIndicates that the MS is not reachable through an SGSN, and that the MS is marked as not reachable at the SGSN and possibly at the GGSN.\nGGSN‑list\nThe GSN number and optional IP address pair related to the GGSN that shall be contacted when activity from the MS is detected and MNRG is set. The GSN number shall be either the number of the GGSN or the protocol-converting GSN as described in the clauses \"MAP-based GGSN-HLR Signalling\" and \"GTP and MAP-based GGSN‑HLR Signalling\".\nGPRS‑CSI\nOptional GPRS CAMEL subscription information, see TS 23.016 [5b]\nMG-CSI\nOptional Mobility Management for GPRS CAMEL subscription information, see TS 23.016 [5b].\nAPN-OI Replacement\nIndicates the domain name to replace the APN-OI when constructing the GGSN/PDN GW FQDN upon which to perform a DNS resolution. This replacement applies for all the APNs in the subscriber's profile. See TS 23.003 [4] clause 9.1.2 for more information on the format of domain names that are allowed in this field.\nODB for PS parameters\nIndicates that the status of the operator determined barring for packet oriented services.\nAccess Restriction\nIndicates the access restriction subscription information. (Note, the access restriction applies to both packet and circuit oriented services) and it includes restriction information on the use of NR as a secondary RAT for user plane connectivity.\nIMEI\nInternational Mobile Equipment Identity\nSVN\nSoftware Version Number\nRFSP Index\nAn index to specific RRM configuration in the UTRAN/GERAN\nCSG Subscription Data\nThe CSG Subscription Data is a list of CSG IDs per PLMN and for each CSG ID optionally an associated expiration date which indicates the point in time when the subscription to the CSG ID expires; an absent expiration date indicates unlimited subscription.\nFor a CSG ID that can be used to access specific PDNs via Local IP Access, the CSG ID entry includes the corresponding APN(s).\nVPLMN LIPA Allowed\nSpecifies per PLMN whether the UE is allowed to use LIPA.\nSubscribed UE-AMBR\nThe Maximum Aggregated uplink and downlink MBRs to be shared across all Non-GBR PDP contexts according to the subscription of the user.\nURRP-SGSN UE\nReachability Request Parameter indicating that UE activity notification from SGSN has been requested by the HLR/HSS.\nHomogenous Support of IMS Voice over PS Sessions for SGSN\nIndicates per UE and SGSN if \"IMS Voice over PS Sessions\" is homogeneously supported in all RAs in the serving SGSN or homogeneously not supported, or, support is non-homogeneous/unknown, see clause 5.3.8A.\nSubscribed periodic RAU/TAU Timer\nIndicates a subscribed periodic RAU/TAU timer value.\nExtended idle mode DRX cycle length\nIndicates a subscribed extended idle mode DRX cycle length value.\nUE-SRVCC-Capability\nIndicates whether the UE is UTRAN/GERAN SRVCC capable or not.\nGroup ID-list\nList of the subscribed group(s) that the MS belongs to.\nUE Usage Type\nIndicates the usage characteristics of the UE for use with Dedicated Core Networks (see clause 5.3.23).\nEnhanced Coverage Restricted\nSpecify PLMN(s) with Enhanced Coverage restrictions.\nMonitoring Event Information Data\nDescribes the monitoring event configuration information. See TS 23.682 [119] for more information.\nEach subscription profile may also contain one or more APN configurations:\nPDP/EPS Bearer Context Identifier\nIndex of the PDP/EPS Bearer context (Note 3).\nPDP Type\nPDP type, e.g. PPP, IP (IPv4, IPv6, IPv4v6) or Non-IP.\nPDP Address\nPDP address, e.g., an IP address. This field shall be empty if dynamic addressing is allowed.\nAPN-OI Replacement\nAPN level APN-OI Replacement which has the same role as the UE level APN-OI Replacement but with higher priority than UE level APN-OI Replacement. This is an optional parameter. When available, it shall be used to construct the GGSN/PDN GW FQDN instead of UE level APNOI Replacement. See TS 23.003 [4] clause 9.1.2 for more information on the format of domain names that are allowed in this field.\nAccess Point Name\nA label according to DNS naming conventions describing the access point to the packet data network. For S4-SGSN the APN to be used as default APN is indicated.\nInvoke SCEF Selection\nIndicates whether this APN is used for establishing connection to the SCEF.\nSCEF ID\nIndicates the FQDN or IP address of the SCEF which is to be selected for this APN. It is required if \"Invoke SCEF Selection\" indicator is set.\nSIPTO permissions\nIndicates whether the traffic associated with this APN is prohibited for SIPTO, allowed for SIPTO excluding SIPTO at the local network, allowed for SIPTO including SIPTO at the local network or allowed for SIPTO at the local network only (NOTE 2).\nLIPA permissions\nIndicates whether the PDN can be accessed via Local IP Access. Possible values are: LIPA-prohibited, LIPA-only and LIPA-conditional.\nWLAN offloadability\nIndicates whether the traffic associated with this APN is allowed to be offloaded to WLAN using the WLAN/3GPP Radio Interworking feature or if it shall be kept on 3GPP access (see clause 5.3.21). The indication may contain separate values per RAT (E-UTRA and UTRA).\nQoS Profile Subscribed\nThe quality of service profile subscribed. QoS Profile Subscribed is the default level if a particular QoS profile is not requested. . QoS Profile Subscribed is also the maximum QoS per PDP context to the associated APN.\nSubscribed Evolved ARP\nThe Subscribed Evolved ARP for PDP contexts associated with the APN.\nVPLMN Address Allowed\nSpecifies per VPLMN whether the MS is allowed to use the APN in the domain of the HPLMN only, or additionally the APN in the domain of the VPLMN.\nPDP/EPS Bearer context Charging Characteristics\nThe charging characteristics of this PDP/EPS Bearer context, e.g. normal, prepaid, flat-rate, and/or hot billing.\nEPS subscribed QoS profile\nThe EPS bearer level QoS parameter values for that APN's default bearer (QCI and ARP).\nAPN-AMBR\nThe maximum aggregated uplink and downlink MBR values to be shared across all Non-GBR EPS bearers, which are established for this APN.\nP‑GW/GGSN address\nThe address currently used for the P‑GW/GGSN supporting this APN.\nPDN continuity at inter RAT mobility\nDefines per APN how to handle a PDN connection when the UE moves between \"broadband\" (WB-E-UTRAN and UTRAN) and \"narrowband\" (NB-IoT, GPRS, EC-GSM-IoT). Possible values are: maintain the PDN connection; disconnect the PDN connection with a reactivation request; disconnect PDN connection without reactivation request; or to leave it to local VPLMN policy.\nNOTE 1:\tIMEI and SVN are stored in HLR/HSS when the Automatic Device Detection feature is supported, see clause 15.5.\nNOTE 2:\tIn this specification, the values \"prohibited for SIPTO\" and \"allowed for SIPTO excluding SIPTO at the local network\" correspond to the pre Rel‑12 values \"prohibited for SIPTO\" and \"allowed for SIPTO\". Actual coding of these values belongs to Stage 3 domain.\nNOTE 3:\tFor an S4-SGSN there may be at most two default APNs for a given user. One default APN can belong to either of the three PDN types of \"IPv4\", \"IPv6\", or \"IPv4v6\", and another default APN can belong to PDN type of \"Non-IP\".\nAn expired CSG subscription should not be removed from the HLR/HSS subscription data before it is removed from the MS's Allowed CSG list or Operator CSG list. When a CSG subscription is cancelled it should be handled as an expired subscription in HLR/HSS subscription data to allow for removing it from MS's Allowed CSG list or Operator CSG list first.\nIf the LIPA permission and SIPTO permission flags are both included for a particular APN, they shall be set in a consistent manner, e.g. if the LIPA permission is set to LIPA-only or LIPA-conditional, the SIPTO permission shall be set to SIPTO-prohibited. Conversely, if the SIPTO permission indicates the APN is a SIPTO-allowed APN, the LIPA permission shall be set to LIPA-prohibited. A SIPTO-allowed APN is an APN for which the SIPTO permission is set to allowed for SIPTO excluding SIPTO at the local network, allowed for SIPTO including SIPTO at the local network or allowed for SIPTO at the local network only.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_9.1.2",
        "clause_5.3.8",
        "clause_5.3.23",
        "clause_5.3.21",
        "clause_15.5",
        "table_5",
        "figure_93",
        "ts_23.016",
        "ts_23.003",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.2.1",
      "section_id": "13.2.1",
      "section_title": "General",
      "content": "SGSN maintains MM context and PDP/EPS bearer context information for MSs in the STANDBY, READY, PMM‑IDLE, and PMM‑CONNECTED states. Table 6 shows the context fields for one MS.\nDuring the Intersystem Change, when new Authentication and Key Agreement is not performed, the KSI in the new 3G-SGSN shall be assigned the value of the CKSN, which has been sent by the MS. Similarly, in the new 2G-SGSN, when AKA does not take place, the CKSN shall be assigned the value of the KSI, which has been sent by the MS.",
      "chunk_type": "definition",
      "cross_references": [
        "table_6"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.2.2",
      "section_id": "13.2.2",
      "section_title": "Parameter exchange between S4-SGSNs",
      "content": "The S4-SGSN also maintains parameters related to MME use without interpreting them.\nFor that reason the MM Context and PDP/EPS Bearer Context also includes information that is used by MME but only stored and forwarded by SGSN.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_13.2.3",
      "section_id": "13.2.3",
      "section_title": "Context fields for one MS",
      "content": "Table 6: SGSN MM and PDP/EPS Bearer Contexts\nField\nDescription\nA/Gb mode\nIu mode\nIMSI\nIMSI is the main reference key.\nX\nX\nIMSI-unauthenticated-indicator\nThis is an IMSI indicator to show the IMSI is unauthenticated.\nX\nMM State\nMobility management state, IDLE, STANDBY, READY, PMM‑DETACHED, PMM‑IDLE, or PMM‑CONNECTED.\nX\nX\nP‑TMSI\nPacket Temporary Mobile Subscriber Identity.\nX\nX\nP‑TMSI Signature\nA signature used for identification checking purposes.\nX\nX\nIMEI\nInternational Mobile Equipment Identity\nX\nX\nSVN\nSoftware Version Number (stored by SGSNs supporting the \"Provision of UE Specific Behaviour Information to Network Entities\" feature as defined in TS 23.195 [76].) or the \"Automatic Device Detection\" feature, see clause 15.5.\n3)\nX\nMSISDN\nThe basic MSISDN of the MS. The presence is dictated by its storage in the HLR/HSS.\nX\nX\nRouteing Area\nCurrent routeing area.\nX\nX\nCell Identity\nCurrent cell in READY state, last known cell in STANDBY or IDLE state.\nX\nCell Identity Age\nTime elapsed since the last LLC PDU was received from the MS at the SGSN.\nX\nService Area Code\nLast known SAC when initial UE message was received or Location Reporting procedure was executed.\nX\nService Area Code Age\nTime elapsed since the last SAC was received at the 3G‑SGSN.\nX\nCSG ID\nLast known CSG ID when the UE was active.\nX\nCSG membership\nLast known CSG membership of the MS when the UE was active.\nX\nAccess mode\nAccess mode of last known Cell Identity when the UE was active.\nX\nVLR Number\nThe VLR number of the MSC/VLR currently serving this MS.\nX\nX\nNew SGSN Address\nThe IP address of the new SGSN where buffered and not sent N‑PDUs should be forwarded to.\nX\nX\nAuthentication Vectors\nAuthentication and ciphering parameters (authentication triplets or quintets).\nX\nX\nKc\nCurrently used A/Gb mode ciphering key.\nX\n2)\nCKSN\nCiphering key sequence number of Kc.\nX\n2)\nCiphering algorithm\nSelected ciphering algorithm.\nX\nX\nCK\nCurrently used Iu mode ciphering key.\n1)\nX\nIK\nCurrently used Iu mode integrity key.\n1)\nX\nKSI\nKey Set Identifier.\n1)\nX\nMS Radio Access Capability\nMS, mostly GERAN, radio access capabilities.\nX\nMS Radio Access Capabilities for other RATs\nMS's Radio access capabilities for UTRAN (needed only for PS handover support)\nX\nMS Classmark 2\nGERAN/UTRAN CS domain core network Classmark (used if the MS supports SRVCC to GERAN or UTRAN)\nX\nX\nMS Classmark 3\nGERAN CS domain radio network Classmark (used if the MS supports SRVCC to GERAN)\nX\nX\nSupported Codecs\nList of codecs supported in the CS domain (used if the MS supports SRVCC to GERAN or UTRAN, see TS 23.216 [101])\nX\nX\nMS Network Capability\nMS network capabilities.\nX\nX\nUE Network Capability\nCore network capabilities (stored if the UE supports E-UTRAN)\nX\nX\nHigher bitrates than 16 Mbps flag\nIndicates whether assignment of higher bitrates than 16 Mbps is \"allowed\" (for UE supporting Rel‑7 or higher release) or \"not allowed\" (for UE supporting Rel‑6 or lower release)\nX\nX\nDRX Parameters\nDiscontinuous reception parameters.\nX\nX\nExtended Idle mode DRX parameters\nExended Idle mode DRX parameters provided to the MS\nX\nX\nActive Time value for PSM\nMS specific Active Time value allocated by SGSN for power saving mode handling.\nX\nX\nMNRG\nIndicates whether activity from the MS shall be reported to the HLR.\nX\nX\nNGAF\nIndicates whether activity from the MS shall be reported to the MSC/VLR.\nX\nX\nPPF\nIndicates whether paging for PS and CS services can be initiated.\nX\nX\nSubscribed Charging Characteristics\nThe charging characteristics for the MS, e.g. normal, prepaid, flat-rate, and/or hot billing subscription.\nX\nX\nSelected CN operator id\nSelected core network operator identity (to support network sharing as defined in TS 23.251 [83]).\n4)\nTrace Reference\nIdentifies a record or a collection of records for a particular trace.\nX\nX\nTrace Type\nIndicates the type of trace.\nX\nX\nTrigger Id\nIdentifies the entity that initiated the trace.\nX\nX\nOMC Identity\nIdentifies the OMC that shall receive the trace record(s).\nX\nX\nSMS Parameters\nSMS-related parameters, e.g. operator-determined barring.\nX\nX\nRecovery\nIndicates if HLR/HSS or VLR is performing database recovery.\nX\nX\nRadio Priority SMS\nThe RLC/MAC radio priority level for uplink SMS transmission.\nX\nAccess Restriction\nThe access restriction subscription information. It includes restriction information on the use of NR as secondary RAT.\nX\nX\nGPRS‑CSI\nOptional GPRS CAMEL subscription information, see TS 23.016 [5b]\nX\nX\nMG-CSI\nOptional Mobility Management for GPRS CAMEL subscription information, see TS 23.016 [5b].\nX\nX\nODB for PS parameters\nIndicates that the status of the operator determined barring for packet oriented services.\nX\nX\nAPN-OI Replacement\nIndicates the domain name to replace the APN-OI when constructing the GGSN/PDN GW FQDN upon which to perform a DNS resolution. See TS 23.003 [4] clause 9.1.2 for more information on the format of domain names that are allowed in this field.\nX\nX\nSubscribed UE-AMBR\nThe Maximum Aggregated uplink and downlink MBR values to be shared across all Non-GBR PDP contexts/bearers according to the subscription of the user.\nX\nX\nUE-AMBR\nThe currently used Maximum Aggregated uplink and downlink MBR values to be shared across all Non-GBR PDP context/bearers.\nX\nX\nAPN Subscribed\nThe APN received from the HLR/HSS. For S4-SGSN the APN to be used as default APN is indicated.\nX\nX\nCSG Subscription Data\nThe CSG Subscription Data is associated lists of CSG IDs for the visiting PLMN and the equivalent PLMNs of the visiting PLMN and for each CSG ID optionally an associated expiration date which indicates the point in time when the subscription to the CSG ID expires; an absent expiration date indicates unlimited subscription.\nFor a CSG ID that can be used to access specific PDNs via Local IP Access, the CSG ID entry includes the corresponding APN(s).\nX\nLIPA Allowed\nSpecifies whether the UE is allowed to use LIPA in this PLMN.\nX\nMME IP Address for S3\nIP address of the MME for the MS when connected via E-UTRAN (used if ISR is activated for the MS).\nX\nX\nMME TEID for S3\nTunnel Endpoint Identifier of the MME for the MS when connected via E-UTRAN (used if ISR is activated for the MS).\nX\nX\nURRP-SGSN\nURRP-SGSN indicating that the HSS has requested the SGSN to notify the HSS regarding UE reachability at the SGSN\nX\nX\nDL Data Buffer Expiration Time\nWhen extended buffering of DL data has been invoked for MS that uses power saving functions e.g. PSM, this time is when the buffering will expire.\nX\nX\nSuggested number of buffered downlink packets\nSuggested number of buffered downlink packets at extended buffering. This is an optional parameter.\nX\nX\nSubscribed RFSP Index\nAn index to specific RRM configuration in the UTRAN/GERAN that is received from the HSS.\nX\n5)\nRFSP Index in Use\nAn index to specific RRM configuration in the UTRAN/GERAN that is currently in use.\nX\n5)\nSubscribed Periodic RAU/TAU Timer\nIndicates a subscribed periodic RAU/TAU timer value.\nX\n5)\nVoice Support Match Indicator\nAn indication whether the UE radio capabilities are compatible with the network configuration for PS voice continuity. The SGSN uses it as an input for setting the IMS voice over PS Session Supported Indication.\nX\nHomogenous Support of IMS Voice over PS Sessions\nIndicates per UE if \"IMS Voice over PS Sessions\" is homogeneously supported in all RAs in the serving SGSN or homogeneously not supported, or, support is non-homogeneous/unknown, see clause 5.3.8A.\nX\nX\nGroup ID\nList of the subscribed group(s) that the UE belongs to\nX\nX\nUE Usage Type\nIndicates the usage characteristics of the UE for use with Dedicated Core Networks (see clause 5.3.23).\nX\nX\nMonitoring Event Information Data\nDescribes the monitoring event configuration information. See TS 23.682 [119] for more information.\nX\nX\nGb Coverage Class Information\nInformation that may be used by BSS to optimize the radio paging procedure\nX\nDelay Tolerant Connection\nIndicates that the PDN connection is delay tolerant such that the GGSN supports holding the procedure, after receiving a reject with a cause indicating that MS is temporarily not reachable due to power saving, until the GGSN receives a message indicating that the MS is available for end to end signalling\nX\nX\nEnhanced Coverage Restricted\nSpecifies whether the UE is restricted to use enhanced coverage feature or not.\nX\n> For each active PDN connection with GGSN (using Gn/Gp) or with S‑GW (using S4):\nAPN in Use\nThe APN currently used. This APN shall be composed of the APN Network Identifier and the default APN Operator Identifier as specified in TS 23.003 [4], clause 9.1.2. Any received value in the APN-OI Replacement field in the subscription data is not applied here.\nX\nX\nAPN Restriction\nDenotes the restriction on the combination of types of APN for the APN associated with this PDP Context. (See Note)\nX\nX\nAPN-OI Replacement\nAPN level APN-OI Replacement which has the same role as the UE level APN-OI Replacement but with higher priority than UE level APN-OI Replacement. This is an optional parameter. When available, it shall be used to construct the GGSN/PDN GW FQDN instead of UE level APN-OI Replacement. See TS 23.003 [4] clause 9.1.2 for more information on the format of domain names that are allowed in this field.\nX\nX\nPDN continuity at inter RAT mobility\nDefines per APN how to handle a PDN connection when the UE moves between \"broadband\" (WB-E-UTRAN and UTRAN) and \"narrowband\" (NB-IoT, GPRS, EC-GSM-IoT). Possible values are: maintain the PDN connection; disconnect the PDN connection with a reactivation request; disconnect PDN connection without reactivation request; or to leave it to local VPLMN policy.\nX\nX\nSIPTO permissions\nIndicates whether the traffic associated with this APN is prohibited for SIPTO, allowed for SIPTO excluding SIPTO at the local network, allowed for SIPTO including SIPTO at the local network or allowed for SIPTO at the local network only.\nX\nLocal Home Network ID\nIf SIPTO@LN is enabled for this PDN connection it indicates the identity of the Local Home Network to which the (H)NB/RNC belongs.\nX\nLIPA permissions\nIndicates whether the PDN can be accessed via Local IP Access. Possible values are: LIPA-prohibited, LIPA-only and LIPA-conditional.\nX\nWLAN offloadability\nIndicates whether the traffic associated with this APN is allowed to be offloaded to WLAN using the WLAN/3GPP Radio Interworking feature or if it shall be kept on 3GPP access (see clause 5.3.21). The indication may contain separate values per RAT (E-UTRA and UTRA).\nX\nSubscribed APN-AMBR\nThe maximum aggregated uplink and downlink MBRs to be shared across all Non-GBR PDP contexts/EPS Bearers established for this APN according to the subscription of the user.\nX\nX\nNegotiated APN-AMBR\nThe maximum aggregated uplink and downlink MBRs to be shared across all Non-GBR PDP contexts/EPS Bearers established for this APN according to the GGSN/PGW decision.\nX\nX\nVPLMN Address Allowed\nSpecifies whether the MS is allowed to use the APN in the domain of the HPLMN only, or additionally the APN in the domain of the VPLMN.\nX\nX\nEPS subscribed QoS profile\nThe bearer level QoS parameter values for that APN's default bearer\nX\nX\nSubscribed Evolved ARP\nThe Evolved ARP for this PDN connection according to the subscription of the user\nX\nX\nGGSN or P‑GW TEID on Gn/Gp or S5/S8 (control plane)\nTunnel Endpoint Identifier at the GGSN or P‑GW on the Gn/Gp or S5/S8 interfaces for control plane signalling\nX\nX\nGGSN or P‑GW IP Address in Use (control plane)\nThe IP address of the GGSN (using Gn/Gp) or P‑GW (when using S4) for control plane signalling\nX\nX\nSGSN IP address for Gn/Gp or S4 (control plane)\nSGSN IP address for the Gn/Gp (used by GGSN) or S4 (used by S‑GW) for control plane signalling\nX\nX\nSGSN TEID for Gn/Gp or S4 (control plane)\nSGSN Tunnel Endpoint Identifier for the Gn/Gp used by GGSN) or S4 (used by S‑GW) for control plane signalling.\nX\nX\nS‑GW IP address for S11/S4 (control plane)\nS‑GW IP address for the S11 and S4 interfaces\nX\nX\nS‑GW TEID for S11/S4 (control plane)\nS‑GW Tunnel Endpoint Identifier for the S11 and S4 interfaces.\nX\nX\nlow access priority\nIndicates that the UE requested low access priority when the PDN connection was opened (see Note 6).\nX\nX\n> For each active PDN connection with S‑GW (using S4):\nDefault bearer\nIdentifies the NSAPI of the default bearer, corresponding to the PDP context which was first established within the given PDN connection.\nX\nX\nPDN GW GRE Key for uplink traffic (user plane)\nPDN GW assigned GRE Key for the S5/S8 interface for the user plane for uplink traffic. (For PMIP-based S5/S8 only)\nX\nX\nPresence Reporting Area Action\nDenotes the need to send a change of UE presenence in a Presence Reporting Area. This field denotes separately the PRA identifier(s) and the list(s) of Presence Reporting Area elements (if provided by the PDN GW). The status (i.e. active or inactive) for each Presence Reporting Area is stored in the S4-SGSN when dynamic resource handling for Presence Reporting Area is configured in the S4-SGSN.\nX\nX\nEach MM context contains zero or more of the following PDP/EPS bearer contexts within the PDN connection::\nPDP/EPS bearer Context Identifier\nIndex of the PDP/EPS bearer context.\nX\nX\nPDP State\nPacket data protocol state, INACTIVE or ACTIVE.\nX\nX\nPDP/PDN Type\nPDP type (e.g. PPP) or PDN type (e.g., IPv4, IPv6, IPv4v6 or Non-IP)\nX\nX\nSCEF ID\nThe IP address of the SCEF currently being used for providing connection to the SCEF.\nX\nPDP/PDN Address\nPDP/PDN address, e.g., an IP address.\nX\nX\nNSAPI/EPS bearer ID\nNetwork layer Service Access Point Identifier. There is a 1:1 mapping between the NSAPI and the EPS bearer ID.\nX\nX\nTI\nTransaction Identifier.\nX\nX\nTEID for Iu\nTunnel Endpoint Identifier for the Iu interface.\nX\nGGSN or P‑GW TEID (user plane)\nTunnel Endpoint Identifier of the GGSN or P‑GW for user-plane traffic.\n(NOTE 4)\nX\nX\nGGSN or P‑GW IP address (user plane)\nThe IP address of the GGSN or P‑GW for user-plane traffic.\n(NOTE 5)\nX\nX\nS‑GW IP address (user plane)\nS‑GW IP address for user plane.\nX\nX\nS‑GW TEID (user plane)\nS‑GW Tunnel Endpoint Identifier for user plane.\nX\nX\nSGSN IP address (user plane)\nSGSN IP address used by GGSN for Gn/Gp or by S‑GW for S4 for user plane downlink traffic.\nX\nX\nSGSN TEID (user plane)\nSGSN Tunnel Endpoint Identifier used by GGSN for Gn/Gp or by S‑GW for S4 for user plane downlink traffic.\nX\nX\nQoS Profile Subscribed\nThe quality of service profile subscribed.\nX\nX\nQoS Profile Requested\nThe quality of service profile requested.\nX\nX\nQoS Profile Negotiated\nThe quality of service profile negotiated. This also represents the EPS Bearer QoS parameters QCI and ARP and optionally GBR and MBR in case of GBR bearer\nX\nX\nNegotiated Evolved ARP\nThe evolved ARP to be used for this PDP context as authorized by the GGSN\nX\nX\nRadio Priority\nThe RLC/MAC radio priority level for uplink user data transmission.\nX\nPacket Flow Id\nPacket flow identifier.\nX\nAggregate BSS QoS Profile Negotiated\nThe aggregate BSS quality of service profile negotiated for the packet flow that this PDP context belongs to.\nX\nSend N‑PDU Number\nSNDCP sequence number of the next downlink N‑PDU to be sent to the MS.\nX\nReceive N‑PDU Number\nSNDCP sequence number of the next uplink N‑PDU expected from the MS.\nX\nGTP‑SND\nGTP‑U sequence number of the next downlink N‑PDU to be sent to the MS.\nX\nX\nGTP‑SNU\nGTP‑U sequence number of the next uplink N‑PDU to be sent to the GGSN.\nX\nX\nPDCP‑SND\nSequence number of the next downlink in-sequence PDCP‑PDU to be sent to the MS.\nX\nPDCP‑SNU\nSequence number of the next uplink in-sequence PDCP‑PDU expected from the MS.\nX\nCharging Id\nCharging identifier, identifies charging records generated by SGSN, S‑GW and P‑GW/GGSN.\n(NOTE 3)\nX\nX\nPDP/EPS bearer Context Charging Characteristics\nThe charging characteristics of this PDP/EPS bearer context, e.g. normal, prepaid, flat-rate, and/or hot billing.\nX\nX\nRNC Address in Use\nThe IP address of the RNC/BSC currently used.\nX\nProhibit Payload Compression\nIndicates that the SGSN should negotiate no data compression for this PDP context.\nX\nDTI\nIndicates whether SGSN has established direct user plane tunnel between RNC and GGSN (using Gn/Gp) or between RNC and S‑GW (using S12) for this PDP context.\nX\nMS Info Change Reporting Action\nDenotes the need to send changes in CGI/SAI or RAI to the GGSN (using Gn/Gp) or S‑GW (using S4) associated with this PDP Context. (See Note 2).\nX\nX\nCSG Information Reporting Action\nDenotes the need to send changes in User CSG Information to the GGSN (using Gn/Gp) or S‑GW (using S4) associated with this PDP Context. (See Note 2).\nThis field denotes separately whether the SGSN is requested to send changes in User CSG Information for (a) CSG cells, (b) hybrid cells in which the subscriber is a CSG member, and (c) hybrid cells in which the subscriber is not a CSG member, or any combination of the above.\nX\nX\nCGI/SAI/RAI change support indication\nDenotes the indicated level of support to the GGSN (using Gn/Gp) or S-GW (using S4) associated with this PDP Context\n(See Note 2).\nX\nX\nBCM\nThe negotiated BCM.\nX\nX\n> For each PDP/EPS bearer context with S‑GW (using S4):\nDL TFT\nDownlink Traffic Flow Template. (For PMIP-based S5/S8 only)\nX\nX\nUL TFT\nUplink Traffic Flow Template. (For PMIP-based S5/S8 only)\nX\nX\nNOTE 1:\tThe SGSN might not have information on the allocated IPv4 address. Alternatively, following mobility involving a pre-Release 8 SGSN, this IPv4 address might not be the one allocated to the MS.\nNOTE 2:\tAPN Restriction, CGI/SAI/RAI change support indication, MS Info Change Reporting Action and CSG Information Reporting Action shall not be transferred between SGSNs during mobility management, unless the connectivity between the SGSNs is based on S16..\nNOTE 3:\tWhen the SGSN is connected with a S-GW through S4, then the Charging Id is only applicable for online charging with CAMEL as specified in clause 15.1.0.\nNOTE 4:\tThe PDN GW TEID is needed in SGSN context as S‑GW relocation is triggered without interaction with the source S‑GW. The Target S GW requires this Information Element, so it must be stored by the SGSN.\nNOTE 5:\tThe PDN GW IP address is needed in SGSN context as S‑GW relocation is triggered without interaction with the source. The Target S‑GW requires this Information Element, so it must be stored by the SGSN.\nNOTE 6:\tThe low access priority indicator is only stored for the purpose to be included in charging records.\nThe information marked with a \"1)\" in table 6 may be maintained if authentication is performed by the UMTS authentication procedure.\nThe information marked with a \"2)\" in table 6 may be maintained if authentication is performed by the GSM authentication procedure.\nThe information marked with a \"3)\" in table 6 is optional. It can be sent to a new SGSN at RA update.\nThe information marked with a \"4)\" in table 6 is used in networks that support network sharing as defined in TS 23.251 [83].\nThe information marked with a \"5)\" in table 6 is used in UTRAN only.",
      "chunk_type": "general",
      "cross_references": [
        "clause_15.5",
        "ts_23.003_clause_9.1.2",
        "clause_5.3.8",
        "clause_5.3.23",
        "clause_5.3.21",
        "clause_15.1.0",
        "table_6",
        "ts_23.195",
        "ts_23.216",
        "ts_23.251",
        "ts_23.016",
        "ts_23.003",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.2.4",
      "section_id": "13.2.4",
      "section_title": "SGSN Emergency Configuration Data for Iu Mode",
      "content": "The SGSN Emergency Configuration Data is used instead of UE subscription data received from the HSS or the parameters provided by UE in the PDP context created by the PDP Context Activation Procedure for emergency service.\nTable 6A: SGSN Emergency Configuration Data\nField\nDescription\nEmergency Access Point Name (em APN)\nA label according to DNS naming conventions describing the access point used for Emergency Bearers (wild card not allowed).\nEmergency QoS profile\nThe bearer level QoS parameter values for Emergency APN's PDP context created by the PDP Context Activation Procedure.\nEmergency Evolved ARP\nThe Evolved ARP value to be used for Emergency APN's PDP context created by the PDP Context Activation Procedure\nEmergency APN-AMBR (only for S4-SGSN)\nThe Maximum Aggregated uplink and downlink MBR values to be shared across all Non-GBR bearers, which are established for the Emergency APN, as decided by the PDN GW.\nEmergency PDN GW/GGSN identity\nThe statically configured identity of the PDN GW/GGSN used for emergency APN. The PDN GW/GGSN identity may be either an FQDN or an IP address.\nIf the S4-SGSN is used, the Emergency EPS QoS profile (QCI and ARP) is configured. The ARP is an ARP value reserved for emergency bearers. The QCI for Emergency APN's PDP context created by the PDP Context Activation Procedure is set per operator configuration.\nIf Gn/Gp SGSN is used, the Emergency GPRS QoS profile (Traffic class, Signalling Indication) and Emergency Evolved ARP is used. The Traffic class and Signalling Indication is set per operator configurations. The Emergency Evolved ARP is an Evolved ARP value reserved for emergency bearers.",
      "chunk_type": "general",
      "cross_references": [
        "table_6"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.3",
      "section_id": "13.3",
      "section_title": "GGSN",
      "content": "GGSN maintains activated PDP contexts. Table 7 shows the PDP context fields.\nTable 7: GGSN PDP Context\nField\nDescription\nIMSI\nInternational Mobile Subscriber Identity.\nIMSI-unauthenticated-indicator\nThis is an IMSI indicator to show the IMSI is unauthenticated\nME Identity\nMobile Equipment Identity (e.g. IMEI/IMEISV)\nNSAPI\nNetwork layer Service Access Point Identifier.\nMSISDN\nThe basic MSISDN of the MS. The presence is dictated by its storage in the HLR/HSS.\nPDP Type\nPDP type; e.g. PPP, IP or Non-IP.\nPDP Address\nPDP address(es); e.g. an IP address.\nDynamic Address\nIndicates whether PDP Address is static or dynamic.\nAPN in Use\nThe APN Network Identifier currently used, as received from the SGSN.\nNegotiated APN-AMBR\nThe maximum aggregated uplink and downlink MBRs to be shared across all Non-GBR PDP contexts/EPS Bearers established for this APN according to the GGSN/PGW decision.\nTEID\nTunnel Endpoint Identifier.\nTFT\nTraffic flow template.\nQoS Profile Negotiated\nThe quality of service profile negotiated.\nNegotiated Evolved ARP\nThe evolved ARP authorized by the GGSN\nSGSN Address\nThe IP address of the SGSN currently serving this MS.\nMNRG\nIndicates whether the MS is marked as not reachable for PS at the HLR.\nRecovery\nIndicates if the SGSN is performing database recovery.\nGTP‑SND\nGTP‑U sequence number of the next downlink N‑PDU to be sent to the SGSN.\nGTP‑SNU\nGTP‑U sequence number of the next uplink N‑PDU to be received from the SGSN.\nCharging Id\nCharging identifier, identifies charging records generated by SGSN and GGSN.\nCharging Characteristics\nThe charging characteristics for this PDP context, e.g. normal, prepaid, flat-rate, and/or hot billing.\nAPN-Rate-Control\nThe APN-Rate-Control limits the maximum number of uplink/downlink messages per a specific time unit (e.g. minute, hour, day, week) for this APN. It includes an indication as to whether or not Exception reports may still be sent when the limit has been met.\nTrace Reference\nIdentifies a record or a collection of records for a particular trace.\nTrace Type\nIndicates the type of trace.\nTrigger Id\nIdentifies the entity that initiated the trace.\nOMC Identity\nIdentifies the OMC that shall receive the trace record(s).\nProhibit Payload Compression\nIndicates that the SGSN should negotiate no data compression for this PDP context.\nSGSN support for MS Info Change Reporting\nIndicated that the SGSN serving the MS supports procedures for reporting CGI/SAI/RAI and/or User CSG Information changes according to clause 15.1.1a.\nMS Info Change Reporting Action\nDenotes whether the SGSN is requested to send changes in CGI/SAI or RAI to the GGSN (using Gn/Gp) or S‑GW (using S4) associated with this PDP Context.\nCSG Information Reporting Action\nDenotes whether the SGSN is requested to send changes in User CSG Information to the GGSN (using Gn/Gp) or S‑GW (using S4) associated with this PDP Context.\nThis field denotes separately whether the SGSN is requested to send changes in User CSG Information for (a) CSG cells, (b) hybrid cells in which the subscriber is a CSG member, and (c) hybrid cells in which the subscriber is not a CSG member, or any combination of the above.\nBCM\nThe negotiated Bearer Control Mode.\nDTI\nIndicates whether SGSN has established direct user plane tunnel between RNC and GGSN for this PDP Context.\nIf a PDP context is enabled for network-requested PDP context activation, then IMSI, PDP Type, PDP Address, SGSN Address and MNRG contain valid information also when the PDP context is inactive and when the MS is GPRS-detached.\nFor emergency attached UEs which are not authenticated, IMEI is stored in context.\n13.3a\tServing GW\nThe information storage for the Serving GW to support MS access to the EPC via UTRAN or GERAN is described in TS 23.401 [89].\n13.3b\tPDN GW\nThe information storage for the PDN GW to support MS access to the EPC via UTRAN or GERAN is described in TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "clause_15.1.1",
        "table_7",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.4",
      "section_id": "13.4",
      "section_title": "MS",
      "content": "Each MS supporting GPRS maintains MM and PDP context information in IDLE, STANDBY, READY, PMM‑DETACHED, PMM‑IDLE, and PMM‑CONNECTED states. The information may be contained in the MS and the TE. Table 8 shows the MS context fields. An E-UTRAN capable MS maintains additional information, e.g. a TIN. The additional information is described in TS 23.401 [89].\nTable 8: MS MM and PDP Contexts\nField\nSIM\nDescription\nA/Gb mode\nIu mode\nIMSI\nG, U\nInternational Mobile Subscriber Identity.\nX\nX\nMM State\nMobility management state, IDLE, STANDBY, READY, PMM‑DETACHED, PMM‑IDLE, or PMM‑CONNECTED.\nX\nX\nP‑TMSI\nG, U\nPacket Temporary Mobile Subscriber Identity.\nX\nX\nP‑TMSI Signature\nG, U\nA signature used for identification checking purposes.\nX\nX\nRouteing Area\nG, U\nCurrent routeing area.\nX\nX\nCell Identity\nCurrent cell.\nX\nKc\nG\nCurrent A/Gb mode ciphering key.\nX\n2)\nKSI / CKSN\nG, U\nKey Set Identifier for IK Next, CK Next / key sequence number of Kc.\nX\nX\nCiphering algorithm\nSelected ciphering algorithm.\nX\nX\nCK\nCurrently used Iu mode ciphering key.\n1)\nX\nCK Next\nU\nIu mode ciphering key to be used after the next security mode command.\n1)\nX\nIK\nCurrently used Iu mode integrity key.\n1)\nX\nIK Next\nU\nIntegrity key to be used after the next security mode command.\n1)\nX\nMS Radio Access Capability\nMS radio access capabilities.\nX\nX\nUE Capability\nUE radio capabilities.\nX\nMS Network Capability\nMS network capabilities.\nX\nX\nDRX Parameters\nDiscontinuous reception parameters.\nX\nX\nExtended idle mode DRX parameters\nExtended idle mode DRX parameters received from the SGSN.\nX\nX\nActive Time value for PSM\nMS specific Active Time value allocated by SGSN for power saving mode handling.\nX\nX\nRadio Priority SMS\nThe RLC/MAC radio priority level for uplink SMS transmission.\nX\nAllowed CSG list\nThe Allowed CSG list, which is under both user and operator control, indicates the list of CSG IDs and the associated PLMN where the MS is a member.\nX\nOperator CSG list\nThe Operator CSG list, which is under exclusive Operator control, indicates the list of CSG IDs and the associated PLMN where the MS is a member.\nX\nEach MM context contains zero or more of the following PDP contexts:\nPDP Type\nPDP type, e.g. PPP, IP or Non-IP.\nX\nX\nPDP Address\nPDP address; e.g. an IP address.\nX\nX\nPDP State\nPacket data protocol state, INACTIVE or ACTIVE.\nX\nX\nDynamic Address Allowed\nSpecifies whether the MS is allowed to use a dynamic address.\nX\nX\nAPN Requested\nThe APN requested.\nX\nX\nNSAPI\nNetwork layer Service Access Point Identifier.\nX\nX\nTI\nTransaction Identifier.\nX\nX\nQoS Profile Requested\nThe quality of service profile requested.\nX\nX\nQoS Profile Negotiated\nThe quality of service profile negotiated.\nX\nX\nTFT\nTraffic flow template.\nX\nX\nRadio Priority\nThe RLC/MAC radio priority level for uplink user data transmission.\nX\nPacket Flow Id\nPacket flow identifier.\nX\nSend N‑PDU Number\nSNDCP sequence number of the next uplink N‑PDU to be sent to the SGSN.\nX\nX\nReceive N‑PDU Number\nSNDCP sequence number of the next downlink N‑PDU expected from the SGSN.\nX\nX\nPDCP‑SND\nSequence number of the next downlink in-sequence PDCP‑PDU expected from the RNC.\nX\nPDCP‑SNU\nSequence number of the next uplink in-sequence PDCP‑PDU to be sent to the RNC.\nX\nBCM\nThe negotiated Bearer Control Mode\nX\nX\nWLAN offloadability\nIndicates whether the traffic associated with this PDN Connection is allowed to be offloaded to WLAN using the WLAN/3GPP Radio Interworking feature or if it shall be kept on 3GPP access (see clause 5.3.21). The indication may contain separate values per RAT (E-UTRA and UTRA).\nX\nAPN-Rate-Control\nThe APN-Rate-Control limits the maximum number of uplink messages per a specific time unit (e.g. minute, hour, day, week) for this APN. It includes an indication as to whether or not Exception reports may still be sent when the limit has been met.\nX\nThe information marked with a \"1)\" in table 8 may be maintained if authentication is performed by the UMTS authentication procedure.\nThe information marked with a \"2)\" in table 8 may be maintained if authentication is performed by the GSM authentication procedure.\nThe information marked with a \"U\" in table 8 shall be stored in the USIM.\nThe information marked with a \"G\" in table 8:\n-\tshall be stored in the GSIM if the connected SIM is GPRS-aware; and\n-\tmay be stored in the ME after GPRS detach if the connected GSIM is not GPRS-aware.\nIf the GSIM is GPRS service-aware, then the IMSI, P‑TMSI, P‑TMSI Signature, Routeing Area, Kc, and CKSN stored in the GSIM shall be used for GPRS services.\nIf the GSIM is not GPRS service-aware, the P‑TMSI, P‑TMSI Signature, Routeing Area, Kc, and CKSN stored in the ME shall be used if and only if the IMSI stored in the GSIM is identical to the IMSI image maintained in the ME. If the IMSI stored in the GSIM is different from the IMSI image in the ME, the IMSI image in the ME shall not be used, and the MS shall identify itself with the IMSI stored in the SIM when performing a GPRS attach. IMSI, P‑TMSI, P‑TMSI Signature, Routeing Area, Kc, and CKSN may be stored in the ME after the GPRS attach has been successfully performed.\nWhen using a USIM, the IMSI, P‑TMSI, P‑TMSI Signature, Routeing Area, Kc, CK Next, IK Next, and CKSN / KSI stored in the USIM, and the CK and IK stored in the ME, shall be used for GPRS services.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.21",
        "table_8",
        "ts_23.401_table_8",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.5",
      "section_id": "13.5",
      "section_title": "MSC/VLR",
      "content": "The MSC/VLR may store the SGSN number of GPRS-attached MSs that are also IMSI-attached. Table 9 shows the MSC/VLR association for one MS.\nTable 9: MSC/VLR Association\nField\nDescription\nIMSI\nIMSI is the main reference key.\nSGSN Number\nThe SGSN number of the SGSN currently serving this MS.",
      "chunk_type": "general",
      "cross_references": [
        "table_9"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.6",
      "section_id": "13.6",
      "section_title": "BSS in A/Gb mode",
      "content": "Table 10 shows the BSS context fields for one MS.\nTable 10: BSS Context\nField\nDescription\nIMSI\nIMSI is the main reference key.\nTLLI\nTemporary Logical Link Identity.\nTrace Reference\nIdentifies a record or a collection of records for a particular trace.\nTrace Type\nIndicates the type of trace.\nTrigger Id\nIdentifies the entity that initiated the trace.\nOMC Identity\nIdentifies the OMC that shall receive the trace record(s).\nRFSP Index\nAn index to specific RRM configuration in GERAN\nEach BSS context contains one or more BSS Packet Flow contexts:\nPacket Flow Id\nPacket flow identifier.\nAggregate BSS QoS Profile Negotiated\nThe aggregate BSS quality of service profile negotiated for this packet flow.\nBSS Packet Flow Timer\nBSS packet flow context inactivity timer.",
      "chunk_type": "general",
      "cross_references": [
        "table_10"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.7",
      "section_id": "13.7",
      "section_title": "RNC/BSC for Iu mode",
      "content": "RNC/BSC maintains RNC/BSC Context for CN-related information in PMM‑CONNECTED state. RNC/BSC also contains RAB contexts for activated RABs. Table 11 shows the context fields for one MS.\nFor emergency attached UEs which are not authenticated, IMEI is stored in context.\nTable 11: RNC/BSC Context\nField\nDescription\nIMSI\nIMSI is the main reference key.\nME Identity\nMobile Equipment Identity (e.g. IMEI/IMEISV).\nUE Capability\nUE radio capabilities.\nUESBI-Iu\nStored by an RNC which supports the \"Provision of UE Specific Behaviour Information to Network Entities\" feature defined in TS 23.195 [76].\nUESBI-Uu\nStored by an RNC which supports the \"Provision of UE Specific Behaviour Information to Network Entities\" feature defined in TS 23.195 [76].\nSAI\nCurrent or last known SAI\nSAI age\nTime elapsed since the RNC last established the UE's last known SAI\nTrace Reference\nIdentifies a record or a collection of records for a particular trace.\nTrace Type\nIndicates the type of trace.\nTrigger Id\nIdentifies the entity that initiated the trace.\nOMC Identity\nIdentifies the OMC that shall receive the trace record(s).\nUE-AMBR\nThe currently used Maximum Aggregated uplink and downlink MBR values to be shared across all Non-GBR bearers.\nRFSP Index\nAn index to specific RRM configuration in UTRAN (not defined in GERAN Iu mode)\nEach RNC context contains zero or more RNC RAB contexts:\nRAB ID\nRadio Access Bearer Identifier.\nPDP Type\nPDP type, e.g. PPP or IP.\nTEID\nTunnel Endpoint Identifier.\nSGSN (or GGSN) Address in Use\nThe IP address of the SGSN currently used if Direct Tunnel is not established (or GGSN in case of Direct Tunnel).\nQoS Profile Negotiated\nThe quality of service profile negotiated for this RAB.\nGTP‑SND\nGTP‑U sequence number of the next downlink in-sequence N‑PDU to be sent to the MS.\nGTP‑SNU\nGTP‑U sequence number of the next uplink in-sequence N‑PDU to be sent to the GGSN.\nPDCP‑SND\nSequence number of the next downlink in-sequence PDCP‑PDU to be sent to the MS.\nPDCP‑SNU\nSequence Number of the next uplink in-sequence PDCP‑PDU expected from the MS.",
      "chunk_type": "general",
      "cross_references": [
        "table_11",
        "ts_23.195"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.8",
      "section_id": "13.8",
      "section_title": "Direct Tunnel specific error handling",
      "content": "Like other restoration procedures Direct Tunnel specific error handling is described in TS 23.007 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.007"
      ]
    },
    {
      "chunk_id": "ts_23.060_13.10",
      "section_id": "13.10",
      "section_title": "CSS",
      "content": "Please refer to TS 23.008 [79] for the content of the information storage for the CSS.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.1",
      "section_id": "14.1",
      "section_title": "IMSI",
      "content": "A unique International Mobile Subscriber Identity (IMSI) shall be allocated to each packet-domain subscriber. This is also the case for GPRS-only subscribers. IMSI is defined in TS 23.003 [4].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.2",
      "section_id": "14.2",
      "section_title": "Packet TMSI",
      "content": "A Packet Temporary Mobile Subscriber Identity shall be allocated to each GPRS-attached MS. P‑TMSI is defined in TS 23.003 [4].\n14.2A\tGUTI\nGlobally Unique Temporary Identity (GUTI) is defined in TS 23.401 [89].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.3",
      "section_id": "14.3",
      "section_title": "NSAPI and TLLI for A/Gb mode",
      "content": "The Network layer Service Access Point Identifier (NSAPI) and Temporary Logical Link Identity (TLLI) are used for network layer routeing. An NSAPI / TLLI pair is unambiguous within a routeing area.\nIn the MS, NSAPI identifies the PDP‑SAP. In the SGSN and GGSN, NSAPI identifies the PDP context associated with a PDP address. Between the MS and the SGSN, TLLI unambiguously identifies the logical link. The NSAPI may be related to either one IP address or two IP addresses (one IPv4 and one IPv6 if PDP Type IPv4v6 is supported and used).\nWhen the MS requests the activation of a PDP context, the MS selects one of its unused NSAPIs.\nFor example (shown figuratively below), the MS receives an IP packet from a connected TE at the IP address A SAP. The IP PDU is encapsulated and NSAPI is initialised to NSAPI‑1. TLLI is set to the MS's TLLI before the encapsulated IP packet is passed to the SNDC function. After the IP PDU is received, the SGSN analyses TLLI and NSAPI‑1 and determines that the IP PDU shall be sent to the GGSN associated with IP address A.\nFigure 94: Use of NSAPI and TLLI\nWithin a routeing area, there is a one-to-one correspondence between TLLI and IMSI that is only known in the MS and SGSN. If it is not clear from the context which routeing area a TLLI belongs to, then TLLI is used together with RAI. TLLI is derived from a P‑TMSI, and does then provide user identity confidentiality as described in clause \"User Identity Confidentiality (A/Gb mode)\".\nThe TLLI address range is divided into four ranges: Local, Foreign, Random, and Auxiliary. The TLLI structure allows the MS and SGSN to deduce the range that a TLLI belongs to. A Local TLLI is derived from the P‑TMSI allocated by the SGSN, and is valid only in the RA associated with the P‑TMSI. A Foreign TLLI is derived from a P‑TMSI allocated in another RA. A Random TLLI is selected randomly by the MS, and is used when the MS does not have a valid P‑TMSI available. An Auxiliary TLLI is selected by the SGSN, but is not used in this release of the specifications.\nIf the MS has a valid P‑TMSI associated with the RA where the MS is currently located, the MS shall use a Local TLLI derived from its P‑TMSI, unless the MS performs a GPRS attach.\nIf the MS does not have a valid P‑TMSI associated with the current RA, or if the MS performs a GPRS attach, it shall derive a Foreign TLLI from its P‑TMSI, or allocate a Random TLLI if no valid P‑TMSI is available.\nWhen a TLLI is exchanged between the MS and an SGSN, the TLLI is transmitted at the RLC/MAC layer within the Um protocol stack, and at the BSSGP layer within the Gb protocol stack. NSAPI is transmitted within the SNDCP layer in the user plane, and within the GMM/SM layer in the control plane. In some SM signalling messages, transaction identifier (TI) represents NSAPI . The TI is dynamically allocated by the MS for MS-requested PDP context activation, and by the network for network-requested PDP context activation. The TI is deallocated when a PDP context has been deactivated. TI usage is defined in TS 24.007 [12] and TS 24.008 [13].\nBy default, unless explicitly specified in the procedures, the TLLI transmitted at the RLC/MAC and BSSGP layers shall be used to identify the MS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_94",
        "ts_24.007",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.4",
      "section_id": "14.4",
      "section_title": "NSAPI, RB Identity, and RAB ID for Iu mode",
      "content": "The Network layer Service Access Point Identifier (NSAPI) and IMSI are used for network layer routeing. An NSAPI / IMSI pair is used to assign a Tunnel Endpoint Identifier (TEID).\nIn the MS, NSAPI identifies the PDP‑SAP. In the SGSN and GGSN, NSAPI identifies the PDP context associated with an MM context.\nIn the context of this specification, the term RNC refer also to a GERAN BSC when serving an MS in Iu mode.\nIn communication with the RNC across the Iu‑PS and Uu interfaces, the RAB ID is used to identify the radio access bearer and that information element shall be set identical to the NSAPI value. In the RNC, RAB ID identifies the RAB context. Radio Bearer Identity (RB Identity) is used to identify the Uu interface radio bearer(s) associated with the radio access bearer. The RAB ID shall uniquely identify the RAB for a specific CN domain and a particular MS.\nThere is a one-to-one relationship between NSAPI, Radio Access Bearer, and PDP context. In the packet domain, there is also a one-to-one relationship with Radio Bearer Identity. The NSAPI may be related to either one IP address or two IP addresses (one IPv4 and one IPv6 if PDP Type IPv4v6 is supported and used).\nFigure 95: Use of NSAPI, RB Identity, and RAB ID\nWhen the MS initiates activation of a PDP context, the MS selects one of its unused NSAPIs. When the SGSN initiates a RAB assignment procedure, the SGSN shall include the NSAPI(s) in the RAB ID information element(s).\n14.4A\tEPS Bearer Identity\nAn EPS bearer identity uniquely identifies an EPS bearer for one UE. When there is a mapping between an EPS bearer and a PDP context, the same identity value is used for the EPS bearer ID and the NSAPI/RAB ID. The EPS Bearer Identity is defined in TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "figure_95",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.5",
      "section_id": "14.5",
      "section_title": "PDP Address",
      "content": "A packet-domain subscriber identified by an IMSI, shall have one or more network layer addresses, i.e. PDP addresses, temporarily and/or permanently associated with it that conforms to the standard addressing scheme of the respective network layer service used, e.g.:\n-\tan IP version 4 address; or\n-\tan IP version 6 prefix; or\n-\tan IP version 4 address and an IP version 6 prefix.\nPDP addresses are activated and deactivated through MM procedures described in clause \"PDP Context Activation, Modification, Deactivation, and Preservation Functions\".\nA corresponding identity \"PDN Address\" is used over S-based interfaces using GTP.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.6",
      "section_id": "14.6",
      "section_title": "TEID",
      "content": "A Tunnel Endpoint Identifier (TEID) is used by the GPRS tunnelling protocol between GSNs, between SGSNs and S‑GWs and P‑GWs and between RNCs/BSCs and SGSNs, to identify a tunnel endpoint in the receiving GTP‑C or GTP‑U protocol entity and to identify an EPS Bearer and/or a PDP context (or in the Iu case a Radio Access Bearer). The receiving end side of a GTP-U tunnel locally assigns the TEID value that the transmitting side has to use. The TEID values are exchanged between tunnel endpoints using GTP‑C (or RANAP in the Iu case) messages.\nThe TEID is a unique identifier within one IP address of a logical node, i.e. RNC, BSC, SGSN, S‑GW, P‑GW or GGSN, which has meaning only within the GTP protocol. For the user plane, i.e. GTP-U, each PDP context has a one-to-one relationship between the TEID on one hand and NSAPI and IMSI on the other hand, or in the Iu reference point case, between the TEID and RAB ID and IMSI. When a node releases an EPS Bearer/PDP context, the corresponding TEID shall not be re-used within a significant period of time to ensure a low probability of the TEID being still assigned to an existing EPS Bearer/PDP context in a peer node. However, the algorithm for computing the value of the TEID and the period of time until the re-use of a TEID are implementation dependent.\nThe TEID is forwarded to the S‑GW and P‑GW or GGSN upon PDP Context Activation and it is used in subsequent tunnelling of user data between the GGSN or S‑GW and P‑GW and the SGSN to identify the MS's PDP contexts in the SGSN and GGSN or S‑GW and P‑GW. The TEID is also used to forward N‑PDUs from the old SGSN to the new SGSN at and after an inter-SGSN routeing area update. In Iu mode, the TEID is also forwarded to the RNC upon RAB assignment and it is used in subsequent tunnelling of user data between the SGSN and the RNC/BSC in order to identify the MS's PDP contexts in the SGSN and the MS's RAB contexts in the RNC/BSC. It is also used to forward N‑PDUs from the SRNC/SBSC to the target RNC/BSC at SRNS/SBSS relocation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.7",
      "section_id": "14.7",
      "section_title": "Routeing Area Identity",
      "content": "Routeing Area Identity (RAI), defined by an operator, identifies one or several cells.\nIn A/Gb mode, RAI is broadcast as system information.\nIn Iu mode, RAI is broadcast to MSs in RRC Idle mode, and is notified to MSs in RRC Connected mode on established RRC connections as MM system information.\nThe location of an MS in STANDBY or PMM‑IDLE state is known in the SGSN on an RA level. Cells that do not support packet-domain services within an LA are grouped into a null RA. The MS is paged for packet services in the RA where the MS is located when mobile-terminated traffic arrives in the SGSN. The MS is paged for circuit-switched services by the SGSN in the last known RA plus in the null RA.\nNOTE:\tCells not supporting GPRS and served by a BSC without a Gb interface should not be included in the same location area as cells not supporting GPRS and served by a BSC with a Gb interface.\nA Routeing Area is a subset of one, and only one, Location Area (LA), meaning that an RA cannot span more than one LA. An RA is served by only one SGSN.\nThe following rules apply for the Routeing Area Identity:\n-\tRAC is only unique when presented together with LAI.\n-\tCI is only unique when presented together with LAI or RAI (A/Gb mode only).\n-\tLAI = MCC + MNC + LAC.\n-\tRAI = MCC + MNC + LAC + RAC.\n-\tCGI = LAI + CI (A/Gb mode only).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.8",
      "section_id": "14.8",
      "section_title": "RAN Registration Area Identity (Iu mode)",
      "content": "The UTRAN/GERAN Registration Area Identity (URA/GRA Id) identifies a UTRAN/GERAN Registration Area (URA/GRA) and is defined in TS 25.331 [52]. URA/GRA Id can be used to indicate to the MS which URA/GRA it shall use in case of overlapping URA/GRAs.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.9",
      "section_id": "14.9",
      "section_title": "Cell Identity",
      "content": "In A/Gb mode, Cell Identity (CI) identifies one cell. In Iu mode, Cell Identifier (C‑Id) uniquely identifies a cell within an RNS. CI and C‑Id are defined in TS 23.003 [4].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.10",
      "section_id": "14.10",
      "section_title": "Service Area Identity (Iu mode)",
      "content": "The Service Area Identity (SAI) is used to uniquely identify an area consisting of one or more cells belonging to the same location area. Such an area is called a Service Area and can be used for indicating the location of an MS to the CN.\nThe Service Area Code (SAC) together with the PLMN identity and the LAC constitutes the Service Area Identity:\n-\tSAI = MCC + MNC + LAC + SAC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.11.1",
      "section_id": "14.11.1",
      "section_title": "CN Node Address",
      "content": "Each SGSN, S‑GW, P‑GW and GGSN shall have one or more IP addresses of type IPv4, and optionally of type IPv6, for inter-communication over the backbone network. When an SGSN, S‑GW, P‑GW or a GGSN supports IPv6 in the backbone network, then it shall also support IPv4. The IP addresses of GSNs and other backbone nodes of all PLMNs build a private address space that is not accessible from the public Internet. For the GGSN, S‑GW, P‑GW and SGSN, each of these IP addresses may also correspond to one or more DNS-type logical GSN names.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.11.2",
      "section_id": "14.11.2",
      "section_title": "GSN Number",
      "content": "Each SGSN shall have an SGSN number for communication with e.g. HLR and EIR.\nEach GGSN that supports the optional SS7-based Gc interface shall have a GGSN number for communication with HLRs.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.12.1",
      "section_id": "14.12.1",
      "section_title": "RNC/BSC Address",
      "content": "Each RNC or BSC shall have one or more IP addresses for inter-communication over the Iu interface. When the ATM transport option is applied on the Iu interface, each RNC or BSC shall be able to support addresses of type IPv4 and optionally of type IPv6. When the IP transport option is applied on the Iu interface, each RNC or BSC shall be able to support both IPv6 addresses and IPv4 addresses.\nNOTE:\tThese statements refer to RNC and BSC implementation requirements. When both IP versions are required to be supported in the RNC or BSC, it is still an operational choice whether to configure and use both or only one of the address types in a particular network set-up (i.e. in a network where it is known that all interconnected RNCs and SGSNs support the same IP version, it is legitimate to operate IPv4 only or IPv6 only).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.12.2",
      "section_id": "14.12.2",
      "section_title": "RNC/BSC Number",
      "content": "Each RNC or BSC shall have an RNC/BSC number for inter-communication over the Iu interface.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_14.13",
      "section_id": "14.13",
      "section_title": "Access Point Name",
      "content": "In the backbone, Access Point Name is a reference to the GGSN or P‑GW to be used. In addition, Access Point Name may, in the GGSN or P‑GW, identify the packet data network and optionally a service to be offered. Access Point Name is composed of two parts as defined in TS 23.003 [4].\nThe APN stored in the HLR shall not contain the APN Operator Identifier. A wild card may be stored in the HLR instead of the APN. This wild card indicates that the user may select an APN that is not stored in the HLR. The use of the wild card is described in Annex A.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.060_14.14",
      "section_id": "14.14",
      "section_title": "Closed Subscriber Group ID",
      "content": "A CSG ID is a unique identifier within the scope of PLMN defined in TS 23.003 [4] which identifies a Closed Subscriber Group (CSG) in the PLMN associated with a CSG cell or group of CSG cells.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.1.0",
      "section_id": "15.1.0",
      "section_title": "General",
      "content": "GPRS charging information is collected for each MS by SGSNs, S‑GWs and P‑GWs/GGSNs that are serving the MS. When based on Gn/Gp, the operator can control whether charging information shall be collected in the SGSN and the GGSN on an individual MS and/or PDP context basis by appropriately setting the Subscribed Charging Characteristics and/or PDP context Charging Characteristics in the HLR.\nNOTE 1:\tThe charging requirements for the S‑GW, including connectivity through S4, and the P‑GW are as defined in TS 23.401 [89].\nThe charging characteristics on the subscription and individually subscribed APNs are specified in TS 32.251 [70].\nThe information that the operator uses to generate a bill to a subscriber is operator-specific. Billing aspects, e.g. a regular fee for a fixed period, are outside the scope of the present document.\nEvery operator collects and processes his own charging information.\nThe SGSN, for connectivity through Gn/Gp, collects charging information for each MS related to the radio network usage while the P‑GW/GGSN collect charging information for each MS related to the packet data network usage. All core network nodes also collect charging information on usage of the network resources.\nIf the SGSN is connected through Gn/Gp with a GGSN/P‑GW, charging may be also realised by a CAMEL server using CAMEL interaction procedures, see referenced procedures in TS 23.078 [8b]. Prepaid charging may also be realised by a CAMEL server, which do not rely on receiving a valid Charging Id, when the SGSN is connected through S4 with a P‑GW.\nNOTE 2:\tA network configuration may ensure that the Charging Id is valid, when the SGSN is connected with a S‑GW through S4 and GTP is in use on S5/S8.\nNOTE 3:\tWhen using CAMEL for prepaid charging, the GGSN/P‑GW should not be used for the same purpose.\nCharging may be also realised by Flow Based Charging procedures at the GGSN, see referenced procedures in TS 23.203 [88] and TS 32.251 [70].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.401",
        "ts_32.251",
        "ts_23.078",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.1.1",
      "section_id": "15.1.1",
      "section_title": "Charging Information",
      "content": "Charging information is collected for the GPRS subscriber.\nAs a minimum, the SGSN, when connected through Gn/Gp or through S4 for non-E-UTRAN CAMEL enabled subscribers, shall collect the following charging information for MSs and/or individual PDP contexts that are subject to charging:\n-\tusage of the radio interface: the charging information shall describe the amount of data transmitted in Mobile-originated and Mobile-terminated directions categorised with QoS and user protocols;\n-\tusage of the general GPRS resources: the charging information shall describe the usage of other GPRS-related resources and the MS's network activity (e.g. mobility management); and\n-\tlocation of MS: HPLMN, VPLMN, plus optional higher-accuracy location information.\nWhen connected through Gn/Gp, the SGSN shall in addition collect the following charging information for MSs and/or individual PDP contexts that are subject to charging:\n-\tusage of the packet data protocol addresses: the charging information shall describe how long the MS has used the packet data protocol addresses.\nWhen CSG is deployed in the network, the SGSN shall also collect the following charging information for MSs and/or individual PDP contexts that are subject to charging:\n-\tUser CSG information: CSG ID and access mode of the cell which the MS is accessing, and CSG membership indication of whether the MS is a CSG member in this cell.\nThe valid CSG information shall be available in the SGSN and GGSN in connected mode.\nThe PCRF shall, if deployed, provide User CSG Information reporting rules to the GGSN at Attach and PDP context activation procedure. The GGSN sets the CSG Information Reporting Action IE according to the User CSG Information reporting rules and sends it to SGSN.\nAs a minimum, the GGSN shall collect the following charging information for MSs and/or individual PDP contexts that are subject to charging:\n-\tdestination and source: the charging information shall describe the destination and source addresses with a level of accuracy as defined by the GPRS operator;\n-\tusage of the packet data networks: the charging information shall describe the amount of data sent and received to and from the packet data network; and\n-\tusage of the packet data protocol addresses: the charging information shall describe how long the MS has used the PDP addresses.\nAdditionally, the GGSN may collect the location of an MS: HPLMN, VPLMN, plus optional information i.e. RAI/CGI/SAI and/or CSG information if required for individual MSs.\nFor inter-operator accounting, in the case of home-routed roaming, the GGSN shall collect and report the uplink and downlink data volume (per PDP context) received from and sent to the serving node.\nWhen the SGSN is connected through Gn/Gp or through S4 for non-E-UTRAN CAMEL enabled subscribers, the RNC and the Iu mode BSC shall collect the following charging information for an MS's RABs when instructed by the SGSN:\n-\tamount of not transferred downlink data, i.e. data that the RNC/BSC has either discarded or forwarded to an SGSN or to another RNC/BSC. Partially transferred packets shall be handled as not transferred. The collected charging information shall be sent by the RNC/BSC to the SGSN when a RAB is released, or when explicitly requested by the SGSN. The SGSN shall indicate at RAB setup whether data volume collection and reporting for the particular RAB is required or not.\nWhen the SGSN is connected through S4, the S‑GW collects charging information for MSs and/or individual EPS bearers as described in TS 23.401 [89].\n15.1.1a\tGeneral impacts of applying Flow Based Charging\nTS 23.203 [88] and TS 32.251 [70] define means for providing online and offline charging with IP flow granularity for GPRS based on functionality in the GGSN. If Flow Based Charging functionality is deployed in an operator's GPRS network, end-user charging functionalities are provided by the GGSN.\nNOTE:\tWhen Flow Based Charging is deployed, charging functions in the SGSN and S‑GW are expected to still be used for inter-operator accounting purposes for the scenario where the SGSN or S‑GW (for connectivity through S4) and the GGSN are in different networks. When the SGSN or S‑GW and the GGSN are in the same network and Flow Based Charging is deployed, then the operator may decide to disable the charging functions in the SGSN or S‑GW.\nIn order to allow for disabling of the charging functions in the SGSN, the SGSN shall be able to include extra information in the signalling messages sent to the GGSN/P‑GW, as follows:\na)\tin the Create PDP Context Request message, the IMEISV, the RAT type and the S-CDR CAMEL information shall be sent by the SGSN to the GGSN;\nb)\tin the Update PDP Context Request messages sent due to SGSN change, the RAT type shall be sent by the SGSN to the GGSN; and\nc)\tdependent upon the identity of the GGSN's operator, the SGSN shall send (or omit) the CGI/SAI and User CSG Information in:\ni)\tthe Create PDP Context Request message,\nii)\tthe Update PDP Context Request message sent as part of the MS-Initiated PDP Context Modification procedure\niii)\tthe Update PDP Context Request message sent due to SGSN change.\niv)\tan Change Notification sent when requested to report changes in CGI/SAI and User CSG Information of the MS by the GGSN, see clause 15.1.3.\nd)\tThe SGSN shall send a Change Notification as part of the intra-SGSN Routeing Area Update procedures when requested to report changes in Routeing Area by the GGSN, see clause 15.1.3.\nIn addition:\ne)\tthe SGSN shall send an Update PDP Context Request to the GGSN when the Radio Access Technology changes during an intra SGSN routing area update, if the SGSN is not already reporting changes in RAI, SAI, CGI or User CSG Information, as defined in clause 15.1.3 to that GGSN.\nThe RAT type indicates whether the SGSN serves the UE by GERAN or UTRAN Radio Access Technology.\nAs an implementation option, the SGSN may include these parameters in other situations that cause the Update PDP Context Request message to be sent.\nThe above information elements shall be handled by the GGSN in a transparent manner, i.e. the GGSN copies the information elements without modification into the charging information (see TS 32.251 [70]) and/or (if RADIUS accounting is applied in the operator's network) without modification into the RADIUS accounting messages (see TS 29.061 [27]).",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_15.1.3",
        "ts_23.401",
        "ts_23.203",
        "ts_32.251",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.1.2",
      "section_id": "15.1.2",
      "section_title": "Reverse Charging",
      "content": "It shall be possible to provide reverse charging as a subscription option. However, reverse charging may not be applicable to certain packet data network protocols.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.1.3.1",
      "section_id": "15.1.3.1",
      "section_title": "Basic principles",
      "content": "The GGSN or P‑GW may request for each PDP context independently using the \"MS info change report required\" and/or the \"CSG information change report required\" parameter that the SGSN shall report changes at CGI/SAI/RAI level and/or changes of user CSG information. For GERAN, when SGSN, BSS or MS don't support PFC procedures, the SGSN shall report a CGI/SAI/RAI change as soon as it is detected.\nThe P-GW may also request for each PDP context independently using the Presence Reporting Area Action parameter that the S4-SGSN shall report changes when UE enters/leaves a Presence Reporting Area. The Presence Reporting Area Action contains the PRA identifier(s) and optionally list(s) of Presence Reporting Area elements. This may be controlled through the Policy and Charging Control architecture as defined in TS 23.203 [88].\nA P‑GW may (over S5) control reporting (any combination of \"MS Info Change Reporting Action \" and/or \"Presence Reporting Area Action \" and/or \"CSG Information Reporting Action \") at following procedures:\n-\tPDP Context Activation Procedure using S4,\n-\tRouting Area Update (when inducing a Modify Bearer procedure to the PGW),\n-\tInter RAT Hand-Over to a S4-SGSN (when inducing a Modify Bearer procedure to the PGW),\n-\tSecondary PDP Context Activation Procedure, PDP Creation part, using S4,\n-\tNetwork Requested Secondary PDP Context Activation Procedure using S4\n-\tRequest part of SGSN-Initiated EPS Bearer Modification Procedure using S4\n-\tPDN GW Initiated EPS Bearer Modification Procedure, using S4\n-\tExecution part of MS-Initiated Modification Procedure using S4\nThe \"Presence Reporting Area Action\" and \"Presence Reporting Area Information\" parameters apply to all procedures listed above but within this specification, their usage has only been described in the message flows related with the PDP Context Activation Procedure using S4.\nThe reporting of entering and leaving a Presence Reporting Area (i.e. the Change of UE presence in Presence Reporting Area reporting procedure) is defined in TS 23.401 [89]. The P‑GW may request to Start/Stop reporting of changes of UE presence for one or more Presence Reporting Area(s) by using the Presence Reporting Area Action parameter. When the S4-SGSN receives the request to start reporting changes of UE presence in a Presence Reporting Area for a PDP context, the S4-SGSN shall report in the response message to the P-GW the Presence Reporting Area Information comprising the PRA identifier(s) and indication(s) on whether the UE is inside or outside the Presence Reporting Area(s). The request to Stop a reporting contains the PRA identifier(s).\nThe S4-SGSN may be configured with a PRA identifier which refers to a Set of Core Network predefined Presence Reporting Areas. The P-GW may request Start reporting for this Set of Presence Reporting Areas by only indicating this PRA identifier in the Presence Reporting Area Action. When the Presence Reporting Area(s) to be reported belong to a set of Core Network predefined Presence Reporting Areas in which the S4-SGSN is requested to report on change of UE presence, the S4-SGSN shall additionally add to the report the PRA identifier of the Set of Core Network predefined Presence Reporting Areas.\nThe Online Charging System may provide PRA identifier(s) and additionally for UE-dedicated Presence Reporting Areas the list(s) of the elements comprising each Presence Reporting Area to the P‑GW to subscribe to notifications about changes of UE presence in Presence Reporting Area as defined in TS 23.203 [88].\nDuring both mobility management and session management procedures, the SGSN shall indicate (using the MS Info Change Reporting support indication):\n-\tIf CGI/SAI/RAI information is permitted to be sent to the GGSN/P-GW according to SGSN operator's policy,\n-\tIf CSG information is permitted to be sent to the GGSN/P-GW according to SGSN operator's policy.\nThe SGSN may be configured to report CGI/SAI/RAI changes only when there is a RAB/PFC established for the UE. Otherwise the SGSN shall report CGI/SAI/RAI changes as soon as detected.\nUpon change of serving SGSN, the \"MS info change report required\" is transferred as part of the PDP Context information. If the level of support changes during a mobility management procedure then the target SGSN shall indicate the current level of support to the GGSN/P-GW and shall in addition provide CGI/SAI, even if the GGSN/P-GW has not requested this information and even if the RAB/PFC is not established. This could for example happen during SGSN change when the level of support indicated by the old SGSN is not the same as in the new SGSN.\nNOTE 1:\tThe inclusion of CGI/SAI will trigger a Modify Bearer Request message from S-GW to the P-GW and therefore this will make sure that the new level of support reaches the P-GW.\nAt change of Serving Node (MME/S4-SGSN), the old Serving Node provides the new serving node with \"MS Info Change Reporting Action\" as previously requested by the P-GW. The new Serving Node takes the \"MS Info Change Reporting Action\" immediately into account with the exception that, at mobility between a MME and a S4-SGSN, the new MME (respectively S4-SGSN) does not take into account the \"MS Info Change Reporting Action\" received from the S4-SGSN (respectively MME) but assumes that no ULI change reporting is requested for the target RAT. At a change of RAT type between EUTRAN and UTRAN or between EUTRAN and GERAN, if ULI change reporting is required in the target RAT, the P-GW shall request \"MS Info Change Reporting Action\" from the new Serving Node (MME or S4-SGSN). Upon inter-RAT mobility, if the target MME/S4-SGSN supports location information change reporting, the target MME/S4-SGSN shall include the User Location Information in the Create Session Request / Modify Bearer Request, regardless of whether User Location Information change reporting had been requested in the previous RAT by the P-GW.\nUpon change of serving S4-SGSN, the PRA identifier(s) and if provided by the P-GW the list(s) of Presence Reporting Area elements are transferred for all PDN connections as part of MM Context information to the target S4-SGSN during the mobility procedure. If one or more Presence Reporting Area(s) was set to inactive, the target serving node may decide to reactivate one or more of the inactive Presence Reporting Area(s). The target S4-SGSN indicates per PDN connection to the corresponding P-GW, the PRA identifier(s) and whether the UE is inside or outside the Presence Reporting Area(s).\nNOTE 2:\tReporting of changes of UE presence in a Presence Reporting Area is not supported in case of roaming. For GERAN and UTRAN access, homogeneous support of reporting changes of UE presence in a Presence Reporting Area reporting in a network is assumed and there is no intent to distinguish support by S4-SGSN over GERAN versus support over UTRAN. When the PCRF configuration indicates that this reporting is supported for GERAN and UTRAN access, this means it is supported by all the PGW, all S4-SGSN and all the SGW including the S4-SGSN and SGW working in network sharing mode.\nNOTE 3:\tThe target S4-SGSN cannot set the Presence Reporting Area(s) received from the serving node to inactive.\nThe GGSN/P-GW shall not request the SGSN to report CGI/SAI/RAI and/or user CSG information changes if it has not received the indication for corresponding support from the SGSN. In Iu-mode, the SGSN uses the Location Reporting procedures in clause 12.7.5 to request the RNC to report changes in SAI to the SGSN.\nThe SGSN should report to the GGSN/P-GW per MS in the Change notification message where the report is not combined with other mobility management or session management signalling. The GGSN/P-GW may also request the SGSN to stop reporting CGI/SAI/RAI and/or user CSG information changes. The SGSN obeys the last explicit instruction from the GGSN/P‑GW.\nNOTE 4:\tDue to the increased signalling load, it is recommended that such reporting is only applied for a limited number of subscribers or that the ULI reporting is only performed for changes of UE presence in a Presence Reporting Area.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_12.7.5",
        "ts_23.203",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.1.3.2",
      "section_id": "15.1.3.2",
      "section_title": "Interaction with CGI / SAI / user CSG information reporting",
      "content": "The following procedures in figures 15.1.3‑1, and 15.1.3‑2 represent the notification of the CGI and SAI changes respectively to the GGSN.\nThe procedures only apply when the SGSN has been explicitly requested to report CGI or SAI and/or user CSG information changes.\nFigure 15.1.3-1: Cell Update triggering a report of change in CGI\nFigure 15.1.3-2: Iu-mode Location report triggering a report of change in SAI\nFigure 15.1.3-3: User CSG Information Changes triggering a report of change in user CSG information\nNOTE:\tStep 1 is common for architecture variants using Gn/Gp based interaction with GGSN and using S4 based interaction with S‑GW and P‑GW. For an S4 based interaction with S‑GW and P‑GW, procedure steps (A) are defined in clause 15.1.3.2B.\n1.\tIn Gb-mode, the SGSN receives a Cell Update indication via the mechanisms described in clause 6.9.1.1.\nIn Iu-mode, the SGSN receive a location report message (as per the location reporting procedures in clause 12.7.5)\nThe SGSN detects that the user CSG information has changed by comparing with the SGSN stored user CSG information.\n2.\tIf the SGSN has been requested to report the CGI or SAI and/or user CSG information changes to the GGSN for the MS (under the conditions specified in clause 15.1.3.1), the SGSN shall send the change notification to the GGSN indicating the new cell and/or new user CSG information. The SGSN stores the notified user CSG information. If dynamic PCC is deployed, and CGI or SAI changes need to be conveyed to the PCRF, then the GGSN shall send this information to the PCRF as defined in TS 23.203 [88].\n15.1.3.2a\tInteraction with CGI / SAI / user CSG information reporting using S4\nThe procedures described in figure 15.1.3-4 shows only the steps, due to use of S4, which are different from the Gn/Gp variant of the procedure given by clause 15.1.3.2.\nFigure 15.1.3-4: Cell Update triggering a report of change in CGI, Iu-mode Location report triggering a report of change in SAI and User CSG information change triggering a report of change in user CSG information\nNOTE:\tStep 1 is common for architecture variants with GTP based S5/S8 and PMIP‑based S5/S8. For a PMIP‑based S5/S8, procedure step (A1) is defined in TS 23.402 [90]. Step 2 concerns GTP based S5/S8.\n1.\tIf the SGSN has been requested to report the CGI or SAI and/or user CSG information changes to the P‑GW (via the S‑GW) for the MS (under the conditions specified in clause 15.1.3.1), the SGSN shall send the change notification to the S‑GW indicating the new cell and/or new user CSG information. The SGSN stores the notified user CSG information.\n2.\tThe S‑GW forwards the change notification to the P‑GW. If dynamic PCC is deployed, and CGI or SAI changes need to be conveyed to the PCRF, then the PGW shall send this information to the PCRF as defined in TS 23.203 [88].",
      "chunk_type": "general",
      "cross_references": [
        "clause_15.1.3.2",
        "clause_6.9.1.1",
        "clause_12.7.5",
        "clause_15.1.3.1",
        "figure_15.1.3-1",
        "figure_15.1.3-2",
        "figure_15.1.3-3",
        "figure_15.1.3-4",
        "ts_23.203",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.1.3.3",
      "section_id": "15.1.3.3",
      "section_title": "Reporting of Presence Reporting Area entering and leaving",
      "content": "The following procedure in figure 15.1.3.3-1 represents the notification of a Presence Reporting Area entering and leaving of a UE to the P-GW.\nThe procedures only apply when the S4-SGSN has been explicitly requested to report changes of UE presence in a Presence Reporting Area.\nFigure 15.1.3.3-1: Reporting of Presence Reporting Area entering and leaving\nNOTE:\tSteps 1 and 2 are common for architecture variants with GTP based S5/S8 and PMIP based S5/S8. For a PMIP based S5/S8, procedure step (A) is defined in TS 23.402 [90]. Step 3 concerns GTP based S5/S8.\n1a.\tIn Gb-mode, the S4-SGSN receives a Cell Update indication via the mechanisms described in clause 6.9.1.1.\n1b.\tIn Iu-mode, the S4-SGSN receives a location report message (as per the location reporting procedures in clause 12.7.5).\n2.\tIf the S4-SGSN has been requested to report changes of UE presence in a Presence Reporting Area (under the conditions specified in clause 15.1.3.1) and the S4-SGSN detects that the UE has entered or left a Presence Reporting Area, the S4-SGSN shall send the change notification to the S-GW. No notifications are sent for UE movements inside or outside the Presence Reporting Area. The Presence Reporting Area Information comprising the PRA identifier(s) and indication(s) on whether the UE is inside or outside the area(s) shall be included in this message. If the S4-SGSN decides to reactivate one or more of the inactive Presence Reporting Area(s), the Presence Reporting Area Information also comprises the reactivated PRA identifier(s), and indication(s) on whether the UE is inside or outside the reactivated area(s).\n3.\tThe S‑GW forwards the change notification to the P‑GW. If dynamic PCC is deployed, and changes of UE presence in a Presence Reporting Area need to be conveyed to the PCRF, then the P-GW shall send this information to the PCRF as defined in TS 23.203 [88].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.9.1.1",
        "clause_12.7.5",
        "clause_15.1.3.1",
        "figure_15.1.3.3-1",
        "ts_23.402",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.2.0",
      "section_id": "15.2.0",
      "section_title": "General",
      "content": "A QoS profile is associated with each PDP context. The QoS profile is considered to be a single parameter with multiple data transfer attributes. The definition of the QoS attributes for Gn/Gp can be found in TS 23.107 [58], which also defines the mapping between the Release 99 QoS attributes and the QoS attributes for GPRS Releases 97 and 98. In addition the Evolved ARP is introduced over Gn/Gp from Release 9. If the network supports the Evolved ARP then this parameter shall be used instead of the Allocation/Retention Priority parameter of the QoS profile during resource allocation/modification towards the RAN. The EPS Bearer QoS parameters are defined in TS 23.203 [88] and the mapping between the EPS Bearer QoS parameters and the Release 99 QoS attributes in TS 23.401 [89].\nAt any given time, there should be a maximum of one PDP context, for a particular PDP address, that is not associated with a TFT.\nDuring the QoS profile negotiation defined in clause \"Activation Procedures\", it shall be possible for the MS to request a value for each of the QoS attributes, including the HLR-stored subscribed default values. However if the MS requests the traffic class as 'subscribed', the SGSN will assume a request for Interactive class. When the MS requests a QoS, the HLR-stored subscribed default values shall be interpreted as the maximum QoS per PDP context to the associated APN. However the Evolved ARP shall be interpreted as the default value and an SGSN shall accept to receive a Negotiated Evolved ARP from the GGSN even if it is different from the subscribed Evolved ARP received from the HLR. When the application in the MS requires streaming or conversational QoS, then the MS shall at least explicitly request the traffic class and should explicitly request the guaranteed bit rate and the maximum bit rate.\nFor architecture variants using Gn/Gp based interaction with GGSN, the network shall negotiate each attribute to a level that is in accordance with the available GPRS resources and the known capabilities of the rest of the system. For architecture variants using S4 based interaction with SGW, the network shall not negotiate (either accept or reject) the EPS QoS attributes.\nThe network shall always attempt to provide adequate resources to support the negotiated QoS profiles.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.107",
        "ts_23.203",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.2.1",
      "section_id": "15.2.1",
      "section_title": "Radio Priority Levels (A/Gb mode)",
      "content": "The RLC/MAC layer supports four radio priority levels and an additional level for signalling messages as defined in TS 43.064 [11] and TS 44.060 [77]. Upon uplink access the MS can indicate one of the four priority levels, and whether the cause for the uplink access is user data or signalling message transmission. This information is used by the BSS to determine the radio access precedence (i.e. access priority) and the service precedence (i.e. transfer priority under congested situation), see TS 44.060 [77]. The radio priority levels to be used for transmission of Mobile-originated SMS shall be determined by the SGSN and delivered to the MS in the Attach Accept message. The radio priority level to be used for user data transmission shall be determined by the SGSN based on the negotiated QoS profile and shall be delivered to the MS during the PDP Context Activation and PDP Context Modification procedures.\n15.2.1a\tAPN-AMBR\nAPN-AMBR limits the aggregate bit rate that can be expected to be provided across all non GBR PDP Contexts/bearers and across all PDN connections of the same APN (e.g. excess traffic may get discarded by a rate shaping function). GBR PDP Contexts/bearers are outside the scope of APN AMBR. It has an uplink and a downlink component. The GGSN/PDN-GW enforces the APN AMBR. Each APN configuration, stored in the HSS subscription profile may contain a subscribed APN-AMBR value. The subscribed APN-AMBR is signalled from the HSS via SGSN to the GGSN/PDN-GW. If no subscribed APN-AMBR is received from the HSS, the SGSN shall set the APN-AMBR according to implementation specific policies (e.g. a preconfigured maximum APN-AMBR). The SGSN shall set the negotiated APN-AMBR to the value of the APN-AMBR received from the GGSN/PDN-GW.\nIf the \"Higher bitrates than 16 Mbps flag\" in the MM Context of the UE is set to \"not allowed\", the S4-SGSN shall restrict the APN-AMBR in the EPS QoS profile to within 16 Mbps. The SGSN does not inform the PDN-GW if it applies a MBR restriction of 16 Mbps for non-GBR PDP Contexts/bearers to the UE.\nThe APN-AMBR is a parameter of PDP Context/PDN Connection information and is transferred over the Gn/Gp, S10 or S3 interface.",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.064",
        "ts_44.060"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.2.2",
      "section_id": "15.2.2",
      "section_title": "UE-AMBR",
      "content": "The UE-AMBR denote bit rates of traffic per group of bearers and as such the UE-AMBR is considered outside the scope of the Quality of Service profile. It has an uplink and a downlink component. The UE-AMBR is limited by a subscription parameter stored in the HSS. The SGSN shall set the UE-AMBR to the sum of the APN-AMBR of all active APNs, up to the value of the subscribed UE-AMBR. If no values of UE-AMBR are received from the HSS, the SGSN shall set the UE-AMBR according to implementation specific policies (e.g. a preconfigured maximum UE-AMBR). The UE-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR PDP contexts of a UE (e.g. excess traffic may get discarded by a rate shaping function). Each of those Non-GBR PDP contexts could potentially utilize the entire UE-AMBR, e.g. when the other Non-GBR PDP contexts do not carry any traffic. GBR (real-time) PDP contexts are outside the scope of UE-AMBR. The RAN enforces the UE-AMBR in uplink and downlink.\nThe operation of UE-AMBR in A/Gb mode is described in clause 12.6.3.5 and in Iu mode is described in clause 12.7.4.\nThe UE-AMBR is a parameter of MM Context information and is transferred over the Gn/Gp, S10 or S3 interface.",
      "chunk_type": "general",
      "cross_references": [
        "clause_12.6.3.5",
        "clause_12.7.4"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.2.3.1",
      "section_id": "15.2.3.1",
      "section_title": "General",
      "content": "The rate of user data sent to and from an MS can be controlled by:\n-\tAPN Rate Control. APN Rate Control is intended to allow HPLMN operators to offer customer services such as \"maximum of Y messages per day\". Existing AMBR mechanisms are not suitable for such a service since, for radio efficiency and MS battery life reasons, an AMBR of e.g. > 100kbit/s is desirable and such an AMBR translates to potentially large daily data volume.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.2.3.2",
      "section_id": "15.2.3.2",
      "section_title": "APN Rate Control",
      "content": "The GGSN/PDN GW/SCEF can send an APN Uplink Rate Control command to the MS using the PCO information element. The APN Uplink Rate Control applies to data PDUs sent on that APN.\nThe rate control information is separate for uplink and downlink and in the form of a positive integer number of packets per time unit and an indication as to whether or not exception reports can still be sent if this rate control limit has been met.\nThe MS shall comply with this uplink rate control instruction. The MS shall consider this rate control instruction as valid until it receives a new one from either GGSN, PDN GW or from SCEF. The GGSN, PDN GW or SCEF may enforce the Uplink Rate Control by discarding or delaying packets that exceed the rate that is indicated to the MS. The GGSN, PDN GW or SCEF should enforce the Downlink Rate Control by discarding or delaying packets.\nNOTE:\tIf used, it is assumed that the APN Rate Control rate limit has been set taking the number of simultaneous PDN connections allowed by the subscription into account.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.0",
      "section_id": "15.3.0",
      "section_title": "General",
      "content": "A TFT consists of one or more packet filters, each identified by a unique packet filter identifier. The maximum number of packet filters is specified in TS 24.008 [13]. A packet filter also has an evaluation precedence index that is unique among all packet filters that are associated with the PDP contexts that share the same PDP address and APN. This evaluation precedence index is in the range of 255 (lowest evaluation precedence) down to 0 (highest evaluation precedence). The MS manages packet filter identifiers and their evaluation precedence indexes, and creates the packet filter contents for those packet filters that are created by the MS. In 'MS/NW' mode, the GGSN/P‑GW manages packet filter identifiers and their evaluation precedence indexes for those packet filters that are created by the network. A packet filter has a direction attribute, which indicates the direction of the traffic flow(s), i.e. whether they are uplink, downlink or bi-directional. A packet filter from the MS where the direction attribute is not provided describes desired downlink traffic mapping and the network shall interpret such filter as valid for both directions. For services having no downlink IP flows, the MS shall provide packet filters for uplink IP flows to enable policy control functionality as described in TS 23.203 [88].\nNOTE 1:\tPacket filter direction was introduced together with the support for Network Requested Secondary PDP Context Activation procedure.\nThe state for the TFT and packet filter settings amongst all the PDP Contexts associated with one PDP address/prefix and APN pair is valid if all of the following conditions are fulfilled:\n1)\tthere is at most one PDP Context with no associated TFT; and\n2)\tfor 'MS/NW' mode or when the MS uses the direction attribute in 'MS_only' mode, the PDP Context established with the Secondary PDP Context Activation Procedure always has an associated TFT with at least one packet filter for the uplink direction.\nNOTE 2:\tThe above conditions for the valid TFT and packet filter setting is intended for use with bearers in all types of 3GPP accesses.\nNOTE 3:\tA TFT that does not have any packet filter for the uplink direction is not considered valid (except for the PDP context established with the PDP Context Activation Procedure). By not considering the TFT valid a non-backward compatible change is introduced, but it would otherwise introduce unnecessary complexity to the system and it would still remain ambiguous whether such a TFT would be considered as allowing or not allowing uplink flows from an MS perspective, e.g. if the MS sends uplink packets on such PDP context the network might drop such packets due to lack of of PCC rules with matching filters.\nThe MS shall ensure that for each TFT which includes packet filters under MS control, condition 2 is fulfilled for the packet filters under MS control.\nThe network shall, after conducting any action necessary to recover from a detected TFT status misalignment between the MS and the network, reject any request from the MS that would violate any of these conditions.\nNOTE 4:\tThe network action to recover from a detected TFT status misalignment sometimes include deactivating outdated bearer information remaining after MS and network getting out of synchronization.\nThe network shall ensure that for each TFT which includes packet filters under network control, condition 2 is fulfilled for the packet filters under network control. If the network wants to add a packet filter to the TFT of a PDP context established with the Secondary PDP Context Activation Procedure or to initiate a Network Requested Secondary PDP Context Activation Procedure, and the resulting TFT will not include any uplink packet filter among the packet filters under network control, then the GGSN/P-GW shall add a packet filter that effectively disallows any useful packet flows in uplink direction (see clause 15.3.3.4 for an example of such a packet filter).\nNOTE 5: Ensuring that the own packet filters alone fulfils the conditions ensures that the TFT setting for the PDP Contexts associated with one PDP address/prefix and APN pair remains valid while allowing the MS and the network manipulating their own packet filters independently.\nNOTE 6:\tFor the PDP context established with the PDP Context Activation Procedure a packet filter for the uplink direction is not required for the TFT to maintain a valid state for the TFT settings. If a packet filter which effectively disallows any useful packet flows in uplink direction is added by the GGSN/P-GW as the only uplink packet filter, due to operator configuration, the PDP context would be usable only for the transfer of downlink traffic.\nThe MS may associate a TFT with a PDP context in the Secondary PDP Context Activation procedure or the MS-Initiated PDP Context Modification procedure. The network associates a TFT with a PDP context in the Network Requested Secondary PDP Context Activation Procedure or the GGSN-Initiated PDP Context Modification procedure (if in 'MS/NW' mode). A PDP context can never have more than one associated TFT.\nIn 'MS_only' mode the MS may modify any TFT through the MS-Initiated PDP Context Modification procedure.\nIn 'MS/NW' mode the GGSN and the MS may modify any TFT through the PDP Context Modification Procedure in accordance with the restrictions described in clause 9.2.0.\nA TFT associated with a PDP context is always deleted at PDP context deactivation.\nThe UE may use the TFT to associate the Network Requested Secondary PDP Context Activation Procedure and the GGSN-Initiated PDP Context Modification Procedure to an application and to traffic flow aggregates of the application. Therefore the GGSN shall (in the Network Requested Secondary PDP Context Activation Procedure and the GGSN-Initiated PDP Context Modification Procedure) and the P‑GW shall (in the Create Dedicated Bearer Request and the Update Bearer Request messages) provide all available traffic flow description information applicable for the same EPS Bearer/PDP context (e.g. source and destination IP address and port numbers and the protocol information).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_15.3.3.4",
        "clause_9.2.0",
        "ts_24.008",
        "ts_23.203"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.3.1",
      "section_id": "15.3.1",
      "section_title": "Rules for Operations on TFTs",
      "content": "The MS and GGSN shall use the TFT and packet filter identifiers in each operation for handling of the TFTs and packet filters in accordance with the restrictions described in clause 9.2.0.\nWhen the MS or GGSN creates a new TFT, or modifies an existing TFT, it has to include at least one valid packet filter. If no valid packet filter is included in the newly created or modified TFT, the procedure used for the creation or modification of the TFT shall fail, and an error code shall be returned to the MS or GGSN respectively.\nDuring the modification of a TFT, one or more existing packet filters can be modified or deleted, or a new packet filter can be created. In order to modify an existing packet filter, the new values for the packet filter attributes along with the packet filter identifier is sent from the MS to the GGSN, or from the GGSN to the MS. The MS may also modify the evaluation precedence index only of one or several packet filters by means of the MS-Initiated PDP Context Modification procedure. The GGSN may also modify the evaluation precedence index only of one or several packet filters by means of the GGSN-Initiated PDP Context Modification procedure.\nA TFT is deleted when the associated PDP context is deactivated. For bearer control mode 'MS_only', a TFT can also be deleted by means of the MS-Initiated PDP Context Modification procedure. At any time there may exist only one PDP context with no associated TFT amongst all the PDP contexts associated with one PDP address. An attempt by the MS to delete a TFT, which would violate this rule, shall be rejected by the GGSN.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_9.2.0"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.3.2.0",
      "section_id": "15.3.2.0",
      "section_title": "General",
      "content": "Each valid downlink- and uplink-packet filter contains a unique identifier within a given TFT, an evaluation precedence index that is unique among all packet filters for one PDP address and APN pair, and at least one of the following attributes:\n-\tRemote Address and Subnet Mask.\n-\tProtocol Number (IPv4) / Next Header (IPv6).\n-\tLocal Address and Mask.\n-\tLocal Port Range.\n-\tRemote Port Range.\n-\tIPSec Security Parameter Index (SPI).\n-\tType of Service (TOS) (IPv4) / Traffic class (IPv6) and Mask.\n-\tFlow Label (IPv6).\nIn the list of attributes above 'Remote' refers to the external network entity, and 'Local' to the MS.\nSome of the above-listed attributes may coexist in a packet filter while others mutually exclude each other. In table 12 below, the possible combinations are shown. Only those attributes marked with an \"X\" may be specified for a single packet filter. All marked attributes may be specified, but at least one shall be specified.\nIf the parameters of the header of a received PDP PDU match all specified attribute values in a packet filter, then it is considered that a match is found for this packet filter. In this case, the evaluation procedure is aborted. Other packet filters in increasing order of their evaluation precedence index are evaluated until such match is found.\nThere may be potential conflicts if attribute values are combined in such a way that the defined filter can never achieve a match to a valid IP packet header. However, the determination of such conflicts is outside the scope of GPRS standardization.\nTable 12: Valid Packet Filter Attribute Combinations\nValid combination types\nPacket filter attribute\nI\nII\nIII\nRemote Address and Subnet Mask\nX\nX\nX\nProtocol Number (IPv4) / Next Header (IPv6)\nX\nX\nLocal Address and Mask\nX\nX\nX\nLocal Port Range\nX\nRemote Port Range\nX\nIPSec SPI\nX\nTOS (IPv4) / Traffic Class (IPv6) and Mask\nX\nX\nX\nFlow Label (IPv6)\nX",
      "chunk_type": "definition",
      "cross_references": [
        "table_12"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.3.2.1",
      "section_id": "15.3.2.1",
      "section_title": "Remote Address and Subnet Mask",
      "content": "The Remote Address and Subnet Mask attribute of a valid packet filter shall contain an IPv4 or IPv6 address along with a subnet mask.\nAs an example, the remote address and subnet mask attribute to classify packets coming from all hosts within the IPv4 domain A.B.C.0/24 is {A.B.C.0 [255.255.255.0]}.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.2.2",
      "section_id": "15.3.2.2",
      "section_title": "Protocol Number / Next Header",
      "content": "The Protocol Number / Next Header attribute of a valid packet filter shall contain either an IPv4 Protocol Number or an IPv6 Next Header value. The value range is from 0 to 255.\n15.3.2.2A\tLocal Address and Mask\nThe Local Address and Mask attribute of a valid packet filter shall contain an IP address along with a mask.\nThe Local Address and Mask attribute is optional for both the MS and the network and can be used in case both the MS and network has declared support for the extended TFT filter format in the Protocol Configuration Options.\nNOTE:\tFor IPv4, there is only one local address associated with the bearer. Therefore an IPv4 local address in the TFT filter would be redundant.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.2.3",
      "section_id": "15.3.2.3",
      "section_title": "Port Numbers",
      "content": "The Local Port Range and Remote Port Range attributes of a valid packet filter shall each contain one port number, or a range of port numbers. Port numbers range between 0 and 65 535.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.2.4",
      "section_id": "15.3.2.4",
      "section_title": "IPSec Security Parameter Index",
      "content": "The IPSec SPI attribute of a valid packet filter shall contain one SPI which is a 32‑bit field.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.2.5",
      "section_id": "15.3.2.5",
      "section_title": "Type of Service / Traffic Class and Mask",
      "content": "The Type of Service / Traffic Class and Mask attribute of a valid packet filter shall contain either an IPv4 TOS octet or an IPv6 Traffic Class octet along with a mask defining which of the 8 bits should be used for matching.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.2.6",
      "section_id": "15.3.2.6",
      "section_title": "Flow Label",
      "content": "The Flow Label attribute of a valid packet filter shall contain an IPv6 flow label, which is a 20‑bit field.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.3.0",
      "section_id": "15.3.3.0",
      "section_title": "General",
      "content": "Based on the type of traffic or the packet data network QoS capabilities, different types of packet filters can be used to classify a given PDP PDU in order to determine the right PDP context. Some examples are given below.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.3.1",
      "section_id": "15.3.3.1",
      "section_title": "IPv4 Multi-field Classification",
      "content": "For multi-field classification, the packet filter consists of a number of packet header fields. For example, to classify TCP/IPv4 packets originating from 172.168.8.0/24 destined to port 5 003 at the TE, the following packet filter can be used:\n-\tPacket Filter Identifier = 1;\n-\tIPv4 Source Address = {172.168.8.0 [255.255.255.0]};\n-\tProtocol Number for TCP = 6; and\n-\tDestination Port = 5 003.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.3.2",
      "section_id": "15.3.3.2",
      "section_title": "IPv4 TOS-based Classification",
      "content": "For TOS-based classification, the packet filter consists of only the TOS octet coding. For example to classify IPv4 packets marked with TOS coding 001010xx, the following packet filter can be used:\n-\tPacket Filter Identifier = 3;\n-\tType of Service / Traffic Class = 00101000 and Mask = 11111100.\nNOTE:\tThe TOS-based classification can always be augmented with the source address attribute if it is known that different source domains use different TOS octet codings for the same traffic class.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.3.3",
      "section_id": "15.3.3.3",
      "section_title": "IPv4 Multi-field Classification for IPSec Traffic",
      "content": "For multi-field classification of IPSec traffic, the packet filter contains the SPI instead of the port numbers that are not available due to encryption. If IPSec (ESP) was used with an SPI of 0x0F80F000, then the following packet filter can be used:\n-\tPacket Filter Identifier = 4;\n-\tProtocol Number for ESP = 50; and\n-\tSPI = 0x0F80F000.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.3.3.4",
      "section_id": "15.3.3.4",
      "section_title": "Services with IP flows in only one direction",
      "content": "For services with no uplink IP flows, a dummy uplink packet filter can be provided by the network to avoid that the UE uses the PDP context for uplink traffic that is expected on the PDP context without any uplink packet filter. For example that can be done by assigning the remote port \"9\", which is the \"discard\" port, i.e. the following packet filter can be used:\n-\tPacket Filter Identifier = 5;\n-\tPacket Filter Direction = uplink only; and\n-\tRemote port = 9 (the discard port).",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_15.4",
      "section_id": "15.4",
      "section_title": "APN Restriction",
      "content": "The support for APN Restriction and Maximum APN Restriction at the SGSN is optional and an APN Restriction value may be configured for each APN in the GGSN or PGW. The support for reception, storage, and transfer of APN Restriction is required for an S4-SGSN. It is used to determine, on a per MS basis, whether it is allowed to establish PDP Contexts or EPS bearers to other APNs.\nTable 13: Valid Combinations of APN Restriction\nMaximum APN Restriction Value\nType of APN\nApplication Example\nAPN Restriction Value allowed to be established\n0\nNo Existing Contexts or Restriction\nAll\n1\nPublic-1\nWAP or MMS\n1, 2, 3\n2\nPublic-2\nInternet or PSPDN\n1, 2\n3\nPrivate-1\nCorporate (e.g. who use MMS)\n1\n4\nPrivate-2\nCorporate (e.g. who do not use MMS)\nNone\nDuring the PDP Context Activation procedure or the default bearer activation (for connectivity through S4), the GGSN or PGW may compare the APN Restriction of the PDP Context being set up with the Maximum APN Restriction received from the SGSN to decide whether this activation is accepted. The Maximum APN Restriction is the most restrictive value of the APN Restriction (highest number) from all already active PDP Contexts. The APN Restriction is transferred at PDP Context activation to the SGSN.\nThe APN Restriction for each PDP context, if available, shall be transferred either from the GGSN or PGW to the new SGSN during inter-SGSN changes (e.g. SRNS Relocation and Routeing Area Update) or from the old SGSN in case both SGSNs use S16 for connectivity. The new SGSN determines the maximum APN Restriction using the APN Restriction contained in the Update PDP Context Response message(s) received from the GGSN(s) or PGW(s).\nDuring the PDP Context Modification procedure (via the APN Restriction received from the GGSN or PGW) and inter-SGSN changes, the SGSN shall verify if there are PDP contexts to different APNs that violate valid combinations based on the APN Restriction. If a violation is detected, the SGSN shall release PDP contexts until a valid combination results and shall send appropriate error causes to the MS. Which PDP contexts are released is network operator configurable and the SGSN may perform one of the following actions, using the SGSN-Initiated PDP Context Deactivation procedures in clause 9.2.4.2, until a valid combination remains or no further actions are possible:\n1.\tDeactivate the most restrictive, as dictated by the APN Restriction value, PDP Context sending an appropriate error cause to the MS,\n2.\tDeactivate the least restrictive, as dictated by the APN Restriction value, PDP Context sending an appropriate error cause to the MS,\n3.\tDeactivate PDP Contexts in no particular order sending an appropriate error cause to the MS.\nDuring PDP Context Activation procedure or default bearer activation (for connectivity through S4) for emergency, GGSN or PGW shall ignore APN Restriction. During PDP Context Modification procedure (via the APN Restriction received from the GGSN or PGW) and inter SGSN changes, the SGSN shall not deactivate bearer(s) with emergency ARP, if any, to maintain valid APN combination. Same restriction also applies to procedures in TS 23.401 [89].",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.4.2",
        "table_13",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.5",
      "section_id": "15.5",
      "section_title": "Automatic Device Detection",
      "content": "The Automatic Device Detection (ADD) function is an optional feature that allows the network to be updated with the current User Equipment identity (IMEISV). This, for example, enables the network to configure the subscriber's equipment. A device management system can retrieve the IMEISV either from SGSN or from HLR, or be triggered by a changed IMEISV in either SGSN or HLR. However, the device management system and the mechanism to send the configuration to the terminal are outside the scope of 3GPP specifications.\nWhen the ADD function is supported, the SGSN obtains and stores the IMEISV from the MS at GPRS Attach and at Inter-SGSN Routing Area Update procedures when the old SGSN does not provide the IMEISV. The SGSN uses either the GMM Identification procedure or the GMM Authentication and Ciphering procedure to obtain the IMEISV (TS 24.008 [13]). Equipment checking is independent from IMEISV retrieval for ADD. If the IMSI was not previously registered in the SGSN, the SGSN includes the IMEISV in the Update Location message to the HLR. If the IMSI was already registered, the SGSN compares the IMEISV retrieved from the UE with the one stored in SGSN MM context and sends the IMEISV in the Update Location to the HLR if these are different. The MAP parameter Skip Subscriber Data Update should be included in this case to avoid unnecessary signalling, i.e. Cancel Location and Insert Subscriber Data unnecessarily being sent to SGSN.\nFor the purposes of ADD the IMEISV is transferred on the Gs interface as part of the combined GPRS/IMSI attach procedure.\nFor further information on the Automatic Device Detection function, please refer to TS 22.101 [82] and TS 23.012 [81].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.008",
        "ts_22.101",
        "ts_23.012"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.6",
      "section_id": "15.6",
      "section_title": "Direct Tunnel Functionality",
      "content": "Direct Tunnel is an optional function in Iu mode that allows the SGSN to establish a direct user plane tunnel between RAN and GGSN (for connectivity with GGSN through Gn/Gp) or S‑GW (for connectivity through S4) within the PS domain.\nA Direct Tunnel capable SGSN shall have the capability to be configured on a per RNC and per GGSN or S‑GW basis whether or not it can use a direct user plane connection.\nThe SGSN handles the control plane signalling and makes the decision when to establish Direct Tunnel. When the RAB assigned for a PDP context is released (i.e. the PDP context is preserved) the GTP-U tunnel is established between the GGSN (for connectivity with GGSN through Gn/Gp) and SGSN in order to be able to handle the downlink packets.\nFigure 15.6-1: IDLE mode handling for Gn/Gp connectivity\nFigure 15.6-1: IDLE mode handling for S4 connectivity\nDirect Tunnel shall not be used in following traffic cases:\n1)\tIn roaming case for connectivity with GGSN through Gn/Gp only\n-\tThe SGSN needs to know whether the GGSN is in the same or different PLMN.\n2)\tIf the SGSN is connected with a GGSN through Gn/Gp and the SGSN has received CAMEL Subscription Information in the subscriber profile from the HLR.\n-\tIf Direct Tunnel is established then volume reporting from SGSN is not possible as the SGSN no longer has visibility of the User Plane. Since a CAMEL server can invoke volume reporting at anytime during the life time of a PDP Context, the use of Direct Tunnel shall be prohibited for a subscriber whose profile contains CAMEL Subscription Information.\n3)\tGGSN does not support GTP protocol version 1.",
      "chunk_type": "general",
      "cross_references": [
        "figure_15.6-1"
      ]
    },
    {
      "chunk_id": "ts_23.060_15.7",
      "section_id": "15.7",
      "section_title": "HPLMN Notification with specific indication due to SGSN initiated Bearer removal",
      "content": "When initiating a Delete PDP context procedure, the SGSN shall add an appropriate cause code facilitating the operator of the GGSN/P-GW to take appropriate action (e.g. Alarm, O&M action by operator's management network) if needed.\nNOTE:\tThis is for the HPLMN operator to be able to differentiate Delete PDP context procedures due to a failure case (e.g. due to a QoS parameter mismatch at Initial Attach) from Delete PDP context procedures that are executed in cases not related to any failure conditions (e.g. due to a Routing Area Update). Action taken by the HPLMN operator is outside the scope of 3GPP specification.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.0",
      "section_id": "16.0",
      "section_title": "General",
      "content": "This clause describes the interaction between packet-domain services and the following other services for a GPRS-attached MS which is in GERAN/UTRAN PS coverage:\n-\tpoint-to-point Short Message Service (SMS);\n-\tcircuit-switched services;\n-\tsupplementary services; and\n-\tCAMEL services.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.1",
      "section_id": "16.1",
      "section_title": "Point-to-point Short Message Service",
      "content": "It shall be possible for a GPRS-attached MS to send and receive short messages over the PS domain when it is in GERAN/UTRAN PS coverage. An MS that is GPRS-attached and not IMSI-attached shall transfer SMs over the PS domain. MSs that are both GPRS-attached and IMSI-attached shall transfer SMs over the PS domain or over the CS domain (if the CS domain is used, then paging for Mobile-terminated SMS may go through the SGSN).\nThe following two clauses define the operation of mobile-terminated and mobile-originated SMS routeing and transfer over the PS domain. More detailed definitions are contained in TS 23.040 [8]. They apply to SGSNs supporting the Gd or the Gdd interface.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.1.1",
      "section_id": "16.1.1",
      "section_title": "Mobile-terminated SMS Transfer",
      "content": "Figure 96 and the description below show an example of a successful delivery of an SM to an MS in GERAN/UTRAN PS coverage over the PS domain.\nMS\nRAN\nSGSN\nGGSN/\nPGW\nMSC/VLR\nHLR/\nHSS\nSMS-G\nSM-SC\n<\nMessage Transfer\n1\n(SM, MS Address)\n<\nSend Routeing Info For Short Message\n2\n>\nSend Routeing Info For Short Message Result\n3\n(SGSN Number, SGSN Diameter Identity, MSC Number)\n<\nForward Short Message\n4\n(SM)\nC1\n<\n>\nMessage Transfer\n5\n(SM)\nC2\n>\nForward Short Message Result\n6\n>\nDelivery Report\n7\nFigure 96: Mobile-terminated SMS Transfer, Successful\n1)\tThe short message service centre determines it shall send an SM to an MS. SM‑SC forwards the SM to an SMS gateway MSC (SMS‑GMSC).\n2)\tSMS‑GMSC examines the destination MS Address, and sends a Send Routeing Info For Short Message message to the relevant HLR/HSS.\n3)\tHLR/HSS checks the subscriber data (e.g. ODB data and Call Barring Info) for the MS and determines that the MS is allowed to receive the SMS. The HLR/HSS returns a Send Routeing Info For Short Message Result message to the SMS‑GMSC. The result may contain the MS's current SGSN Number, the MSC Number, or both. The result also contains the SGSN Diameter identity if the SGSN number is present and if Gdd is supported. If the result does not contain an SGSN Number (i.e., the HLR/HSS knows that the MS is not reachable via an SGSN), and if the result does contain an MSC Number, non-GPRS SMS delivery procedures are followed. If the result contains an SGSN Number, the SMS transfer proceeds according to the following events.\nNOTE:\tSMS delivery via the SGSN is normally more radio resource efficient than SMS delivery via the MSC/VLR. The preferred delivery path is selected by SMS‑GMSC operator-specific action.\n4)\tSMS‑GMSC forwards the SM to the SGSN.\n5)\tSGSN transfers the SM to the MS on the RP and CP layers, as defined in TS 24.011 [13b].\n6)\tSGSN returns a Forward Short Message Result message to the SMS‑GMSC indicating successful delivery of the SM.\n7)\tSMS‑GMSC returns a Delivery Report to the SM‑SC indicating successful delivery of the SM.\nCAMEL is not supported by SGSNs using EPS interfaces; otherwise CAMEL procedure calls shall be performed according to TS 23.078 [8b]:\nC1)\tCAMEL_T_SMS_INIT.\nThe procedure returns as result \"Continue\".\nC2)\tCAMEL_T_SMS_DELIVERED.\nThis procedure does not return a result.",
      "chunk_type": "general",
      "cross_references": [
        "figure_96",
        "ts_24.011",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.1.1.1",
      "section_id": "16.1.1.1",
      "section_title": "Unsuccessful Mobile-terminated SMS Transfer",
      "content": "The SGSN or the HLR/HSS may not be able to deliver the SM to the MS. This may for example happen when the MS is not attached to GPRS, when the radio channel conditions are bad, or when the Mobile-terminated SMS is barred.\nWhen the SGSN cannot deliver the SM to the MS, the SGSN sets the Mobile station Not Reachable for GPRS flag (MNRG), and returns a failure report to the SMS‑GMSC. Based on the routeing information received from the HLR/HSS, the SMS‑GMSC shall do one of the following:\n-\tIf an MSC/VLR is available for the MS, the SM is forwarded to the MS via the MSC/VLR. A successful delivery report shall be returned to the SM‑SC.\n-\tIf an MSC/VLR is not available for the MS, the Message Waiting Indication information in the HLR/HSS shall be updated and an unsuccessful delivery report shall be returned to the SM‑SC.\nFigure 97 illustrates one possible traffic scenario when neither the SGSN nor the MSC is able to deliver the SM.\nMS\nRAN\nSGSN\nGGSN/\nPGW\nMSC/VLR\nHLR/\nHSS\nSMS-G\nSM-SC\n<\nMessage Transfer\n1\n(SM, MS Address)\n<\nSend Routeing Info For Short Message\n2\n>\nSend Routeing Info For Short Message Result\n3\n(SGSN Number, SGSN Diameter Identity, MSC Number)\n<\nForward Short Message\n4\n(SM)\nC1\n<\n>\nMessage Transfer: Failure\n5\n(SM)\nC2\n>\nForward Short Message Result\n6\n<\nForward Short Message\n7\n(SM)\nC3\n<\n>\nMessage Transfer: Failure\n8\nC4\n<\nAlert Request\n9\n>\nForward Short Message Result\n10\n<\nReport SM Delivery Status\n11\n>\nReport SM Delivery Status Result\n12\n>\nFailure Report\n13\nFigure 97: Mobile-terminated SMS Transfer, Unsuccessful\n1)\tThe short message service centre determines it shall send an SM to an MS. SM‑SC forwards the SM to a SMS‑GMSC.\n2)\tSMS‑GMSC examines the destination MS Address, and sends a Send Routeing Info For Short Message message to the relevant HLR/HSS.\n3)\tHLR/HSS checks the subscriber data (e.g. ODB data and Call Barring Info) for the MS to determine whether the MS is allowed to receive the SMS. If the Mobile-terminated SMS is barred, the HLR/HSS returns a Send Routing Info for Short Message Error message with an appropriate cause. If the Mobile-terminated SMS is not barred, the HLR returns a Send Routeing Info For Short Message Result message to the SMS‑GMSC. The Result contains an SGSN Number and an MSC Number. The result also contains the SGSN Diameter identity if Gdd is supported.\n4)\tSMS‑GMSC forwards the SM to the SGSN.\n5)\tSGSN attempts to transfer the SM to the MS, but fails.\n6)\tSGSN sets MNRG and returns a Forward Short Message Result message to SMS‑GMSC indicating unsuccessful delivery of the SM.\n7)\tSMS‑GMSC selects an alternative route for the SMS, and forwards the SM to the MSC/VLR.\n8)\tMSC/VLR attempts to transfer the SM to the MS, but fails.\n9) The MSC/VLR requests the setting of the NGAF at the SGSN.\n10)\tVLR sets MNRF and returns a Forward Short Message Result message to the SMS‑GMSC indicating unsuccessful delivery of the SM.\n11)\tSMS‑GMSC sends a Report SM Delivery message to the HLR/HSS.\n12)\tHLR/HSS updates its Message Waiting Indication fields and returns a Report SM Delivery Result message to the SMS‑GMSC.\n13)\tSMS‑GMSC returns a Failure Report to the SM‑SC indicating unsuccessful delivery of the SM.\nCAMEL is not supported by SGSNs using EPS interfaces; otherwise CAMEL procedure calls shall be performed according to TS 23.078 [8b]:\nC1)\tCAMEL_T_SMS_INIT.\nThe procedure returns as result \"Continue\".\nC2)\tCAMEL_T_SMS_FAILURE.\nThis procedure does not return a result.\nC3)\tCAMEL_T_SMS_INIT.\nThe procedure returns as result \"Continue\".\nC4)\tCAMEL_T_SMS_FAILURE.\nThis procedure does not return a result.\nFigure 69 shows that the SGSN sends a Ready for SM (MS Reachable) message to the HLR/HSS when the MS becomes reachable and MNRG is set in the SGSN. The SGSN indicates also to the MSC/VLR when the MS becomes reachable and NGAF is set in the SGSN. If the MNRF is set at the MSC/VLR, the MSC/VLR sends a Ready for SM (MS Reachable) message to the HLR/HSS. Reception of a Ready for SM message or Update Location message when MNRG is set in the HLR/HSS shall trigger the SMS alert procedure as defined in TS 23.040 [8].\nMNRG remains set in the SGSN independently of whether the MSC/VLR was successful in delivering the SM or not.This means that the SGSN in certain cases sends a Ready for SM message to the HLR/HSS when an MS becomes reachable via the SGSN, even if no SM is waiting. This causes a small amount of duplicate signalling between the SGSN and the HLR/HSS only.",
      "chunk_type": "general",
      "cross_references": [
        "figure_97",
        "figure_69",
        "ts_23.078",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.1.2",
      "section_id": "16.1.2",
      "section_title": "Mobile-originated SMS Transfer",
      "content": "Figure 98 and the description below explain the steps involved in sending an SM from an MS in GERAN/UTRAN PS coverage over the PS domain.\nMS\nRAN\nSGSN\nGGSN/\nPGW\nMSC/VLR\nHLR/\nHSS\nSMS-IW\nSM-SC\n<\n>\nMessage Transfer\n1\n(SM)\nC1\n>\nForward Short Message\n2\n(SM)\n>\nMessage Transfer\n3\n(SM)\n<\nDelivery Report\n4\n<\nForward Short Message Result\n5\nC2\n<\nDelivery Report\n6\nFigure 98: Mobile-originated SMS Transfer, Successful\n1)\tThe MS has an SM to send, and transfers the SM to the SGSN via RP and CP.\n2)\tSGSN checks the MS subscription data (e.g. ODB data and Call Barring Info), and determines that the MS is allowed to originate the SMS. SGSN forwards the SM to a SMS interworking MSC (SMS‑IWMSC). If the MS is not allowed to originate the SMS, the SGSN returns an RP Error message with an appropriate cause.\n3)\tSMS‑IWMSC passes the SM to the addressed SM‑SC.\n4)\tSM‑SC returns a Delivery Report to the SMS‑IWMSC indicating successful delivery of the SM.\n5)\tSMS‑IWMSC returns a Forward Short Message Result message to the SGSN indicating successful delivery of the SM.\n6)\tSGSN returns a Delivery Report to the MS indicating successful delivery of the SM.\nCAMEL is not supported by SGSNs using EPS interfaces; otherwise; otherwise CAMEL procedure calls shall be performed according to TS 23.078 [8b].\nC1)\tCAMEL_O_SMS_INIT.\nThe procedure returns as result \"Continue\".\nC2)\tCAMEL_O_SMS_SUBMITTED\nThis procedure does not return a result.",
      "chunk_type": "general",
      "cross_references": [
        "figure_98",
        "ts_23.078"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2",
      "section_id": "16.2",
      "section_title": "Circuit-switched Services (A/Gb mode)",
      "content": "The ability for a GPRS user to access circuit-switched services depends on the subscription held, the network capabilities, and the MS capabilities. Interaction between GPRS and circuit-switched services is described in clause \"Interactions Between SGSN and MSC/VLR\".",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.2.1",
      "section_id": "16.2.1",
      "section_title": "Suspension of GPRS Services",
      "content": "The MS shall request the network for suspension of GPRS services when the MS or the network limitations make it unable to communicate on GPRS channels in one or more of the following scenarios:\n1\tWhen a GPRS-attached MS enters dedicated mode and the support of Class A mode of operation is not possible (e.g. the MS only supports DTM (see TS 43.064 [11]) and the network only supports independent CS and PS).\n2\tDuring CS connection, the MS performs handover from Iu mode to A/Gb mode, and the MS or the network limitations make it unable to support CS/PS mode of operation, e.g. an MS in CS/PS mode of operation in Iu mode during a CS connection reverts to class‑B mode of operation in A/Gb mode.\n3\tWhen an MS in class A mode of operation is handed over to a cell where the support of Class A mode of operation is not possible (e.g. a DTM mobile station entering a cell not supporting DTM).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_43.064"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.1",
      "section_id": "16.2.1.1",
      "section_title": "Suspend and Resume procedure (A/Gb mode)",
      "content": "In the following procedures, when a suspended MS is resumed, the MS should either deactivate the PDP context of streaming or conversational traffic class, or the MS should modify the PDP context of streaming or conversational traffic class to reset the maximum bit rate to a proper value (see clause \"RNC/BSS-Initiated PDP Context Modification Procedure\").",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.2.1.1.1",
      "section_id": "16.2.1.1.1",
      "section_title": "Intra-SGSN Suspend and Resume procedure",
      "content": "The Suspend and Resume procedure for intra-SGSN is illustrated in Figure 99.\nFigure 99: Suspend and Resume Procedure for intra SGSN\n1)\tThe MS enters dedicated mode and the MS or the network limitations make it unable to support Class A mode of operation, or during CS connection, a DTM MS performs handover from a cell supporting DTM to a cell not supporting DTM.\n2)\tThe MS sends an RR Suspend (TLLI, RAI) message to the BSS. The BSS may terminate any ongoing GPRS traffic for this TLLI.\n3)\tThe BSS sends a Suspend (TLLI, RAI) message to the SGSN, and the SGSN acknowledges by returning Suspend Ack. The BSS shall store TLLI and RAI in order to be able to request the SGSN to resume GPRS services when the MS leaves dedicated mode.\n4)\tEventually, the BSS may determine that the conditions for the GPRS suspension have disappeared. If the BSS is able to request the SGSN to resume GPRS services, the BSS shall send a Resume (TLLI, RAI) message to the SGSN. The SGSN acknowledges the successful outcome of the resume by returning Resume Ack.\n5)\tIf the circuit switched radio channel is to be released, the BSS sends an RR Channel Release (Resume) message to the MS. The Resume message indicates whether the BSS has successfully requested the SGSN to resume GPRS services for the MS, i.e., whether Resume Ack was received in the BSS before the RR Channel Release message was transmitted. The MS leaves dedicated mode.\n6)\tThe MS shall resume GPRS services by sending a Routeing Area Update Request message to the SGSN:\n-\tif the BSS did not successfully request the SGSN to resume GPRS services,\n-\tif the RR Channel Release message was not received before the MS left dedicated mode,\n-\tif the MS locally determines that the conditions for the GPRS suspension have disappeared\nThe Update Type depends on the mode of operation of the network in use e.g. in mode I Combined RA/LA Update is made and in mode II Routeing Area Update is made.\nThe full handling of suspended MSs in the BSS and the SGSN is implementation dependent. Typically, the SGSN should not page suspended MSs.\nIf the MS performs an inter-BSC handover while suspended, the TLLI and RAI should be transferred as BSC-to-BSC information in the Handover Required and Handover Request messages, see TS 48.008 [18]. This allows the new BSC to initiate the Resume request procedure to the SGSN. If the BSC-to-BSC information was not transferred or not understood, the MS doesn't receive an indication that resumption has been successful, and the MS shall resume GPRS services by initiating a Routeing Area Update or Combined RA/LA Updating procedure as described in step 6.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_99",
        "ts_48.008"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.1.2",
      "section_id": "16.2.1.1.2",
      "section_title": "Inter-SGSN Suspend and Resume procedure",
      "content": "The Suspend and Resume procedure for inter-SGSN is illustrated in Figure 100.\nThis describes the scenario where the old cell and the new cell are handled by different SGSN's, i.e. suspend message is received in an SGSN that is different from the SGSN currently handling the packet data transmission.\nFigure 100: Suspend and Resume Procedure for inter-SGSN\n1)\tDuring CS connection, a DTM MS performs handover from a cell supporting DTM to a cell not supporting DTM.\n2)\tThe MS sends an RR Suspend (TLLI, RAI) message to the BSS.\n3)\tThe BSS sends a Suspend (TLLI, RAI) message to the SGSN.\n-\tSince the SGSN that receives the Suspend message is not the one currently handling the packet data transmission, an indication to perform suspend will be sent to the old SGSN by means of a SUSPEND REQUEST message on the Gn interface. The address of the old SGSN is derived by \"old RAI\" received in Suspend message. If the SGSN that receives the Suspend message provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN that receives the Suspend message from the BSS may derive the old SGSN from the old RAI and the old TLLI and send the Suspend Request message to this old SGSN. Otherwise, the SGSN that receives the Suspend message from the BSS derives the old SGSN from the old RAI. In any case the SGSN that receives the Suspend message from the BSS will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the TLLI and relay the Suspend Request message to that actual old SGSN.\n-\tThe Old SGSN returns a SUSPEND RESPONSE.\n-\tThe new SGSN then returns Suspend Ack to the BSS.\n4)\tAfter CS connection is terminated, the BSS may send a Resume (TLLI, RAI) message to the new SGSN, but since resume is not needed against the old SGSN, the new SGSN acknowledges the resume by Resume Nack.(Resume is not needed against the old SGSN since the MS in this case always will perform an RA Update for updating of GPRS services when the CS connection is terminated and the MM context will be moved from the old to the new SGSN.)\n5)\tThe BSS sends an RR Channel Release message to the MS, indicating that the BSS has not successfully requested the SGSN to resume GPRS services for the MS. The MS leaves dedicated mode.\n6)\tThe MS shall resume GPRS services by sending a Routeing Area Update Request message to the SGSN. The Update Type depends on the mode of operation of the network in use e.g. in mode I Combined RA/LA Update is made and in mode II Routeing Area Update is made.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_100"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.2.1",
      "section_id": "16.2.1.2.1",
      "section_title": "Intra-SGSN Suspend and Resume procedure",
      "content": "The Suspend and Resume procedure for intra SGSN is illustrated in Figure 101.\nFigure 101: Suspend and Resume Procedure for intra-SGSN\n1)\tDuring CS connection, the MS performs handover from Iu mode to A/Gb mode and the MS or the network limitations are unable to support CS/PS mode of operation.\n2)\tThe MS sends an RR Suspend (TLLI, RAI) message to the BSS.\n3)\tThe BSS sends a Suspend (TLLI, RAI) message to the SGSN and:\n-\tThe SGSN may request the SRNS to stop sending downlink PDU's by the SRNS Context Request message. The SRNS then starts buffering the downlink PDUs.\n-\tThe SRNS responds with an SRNS Context Response message.\n-\tThe SGSN then returns Suspend Ack to the BSS.\n4)\tAfter CS connection is terminated, the BSS may send a Resume (TLLI, RAI) message to the SGSN, but resume is not possible since the MS has changed the radio system, so the SGSN acknowledges the resume by Resume Nack.\n5)\tThe BSS sends an RR Channel Release message to the MS, indicating that the BSS has not successfully requested the SGSN to resume GPRS services for the MS.\n6)\tThe MS shall resume GPRS services by sending a Routeing Area Update Request message to the SGSN. The Update Type depends on the mode of operation of the network in use e.g. in mode I Combined RA/LA Update is made and in mode II Routeing Area Update is made.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_101"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.2.2",
      "section_id": "16.2.1.2.2",
      "section_title": "Inter-SGSN Suspend and Resume procedure",
      "content": "The Suspend and Resume procedure for inter SGSN is illustrated in Figure 102.\nThis describes the scenario when the suspend message is received in an SGSN that is different from the SGSN currently handling the packet data transmission and would be valid for at least the following cases:\n-\tMS performs inter-system handover from Iu mode to A/Gb mode during CS connection and the SGSN handling the A/Gb mode cell is different from the SGSN handling the Iu mode cell, i.e. the 2G and 3G SGSNs are separated.\nFigure 102: Suspend and Resume Procedure for inter-SGSN\n1)\tDuring CS connection, the MS performs handover from Iu mode to A/Gb mode, and the MS or the network limitations make it unable to support CS/PS mode of operation.\n2)\tThe MS sends an RR Suspend (TLLI, RAI) message to the BSS.\n3)\tThe BSS sends a Suspend (TLLI, RAI) message to the SGSN.\n-\tSince the SGSN that receives the Suspend message is not the one currently handling the packet data transmission, an indication to perform suspend will be sent to the 3G SGSN by means of a SUSPEND REQUEST message on the Gn interface. The address of the old SGSN is derived by \"old RAI\" received in the Suspend message. If the SGSN that receives the Suspend message provides functionality for Intra Domain Connection of RAN Nodes to Multiple CN Nodes, the SGSN that receives the Suspend message from the BSS may derive the old SGSN from the old RAI and the old TLLI and send the Suspend Request message to this old SGSN. Otherwise, the SGSN that receives the Suspend message from the BSS derives the old SGSN from the old RAI. In any case the SGSN that receives the Suspend message from the BSS will derive an SGSN that it believes is the old SGSN. This derived SGSN is itself the old SGSN, or it is associated with the same pool area as the actual old SGSN and it will determine the correct old SGSN from the TLLI and relay the Suspend Request message to that actual old SGSN.\n-\tThe 3G SGSN may request the SRNS to stop sending downlink PDU's by the SRNS Context Request message. Upon reception of the SRNS Context Request message, the SRNS starts buffering the downlink PDUs.\n-\tThe SRNS responds with an SRNS Context Response message.\n-\tThe 3G SGSN return a SUSPEND RESPONSE.\n-\tThe 2G SGSN then returns Suspend Ack to the BSS.\n4)\tAfter CS connection is terminated, the BSS may send a Resume (TLLI, RAI) message to the 2G SGSN, but since resume is not needed against the 3G SGSN the 2G SGSN acknowledges the resume by Resume Nack.(Resume is not needed in this case since the MS always will perform an RA Update for updating of GPRS services when the CS connection is terminated and the MM context will be moved from 3G to 2G SGSN.)\n5)\tThe BSS sends an RR Channel Release message to the MS, indicating that the BSS has not successfully requested the SGSN to resume GPRS services for the MS.\n6)\tThe MS shall resume GPRS services by sending a Routeing Area Update Request message to the SGSN. The Update Type depends on the mode of operation of the network in use e.g. in mode I Combined RA/LA Update is made and in mode II Routeing Area Update is made.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_102"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.3",
      "section_id": "16.2.1.3",
      "section_title": "Inter System Resume procedure",
      "content": "The resume procedure is only applicable in case of A/Gb mode to Iu mode handover.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.2.1.3.1",
      "section_id": "16.2.1.3.1",
      "section_title": "Intra-SGSN Resume procedure",
      "content": "The procedure for resume of GPRS traffic at intra SGSN case is illustrated in Figure 103.\nFigure 103: Resume of GPRS traffic at intra SGSN\n1)\tThe MS in A/Gb mode class-B mode of operation during CS connection performs handover to CS/PS mode of operation in Iu mode;or the MS in class-A mode of operation capable of DTM performs handover during CS connection from an A/Gb mode cell not supporting DTM to an Iu mode cell.\n2)\tThe MS shall resume GPRS services, directly after the CS handover is completed, by sending a Routeing Area Update Request message to the SGSN, as described in clause \" Inter System Change Procedure\".",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_103"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.1.3.2",
      "section_id": "16.2.1.3.2",
      "section_title": "Inter-SGSN Resume procedure",
      "content": "The procedure for resuming GPRS traffic at inter-SGSN case is illustrated in Figure 104.\nFigure 104: Resume of GPRS traffic at inter SGSN\n1)\tThe MS in A/Gb mode class-B mode of operation during CS connection performs a handover to CS/PS mode of operation in Iu mode;or the MS in class-A mode of operation capable of DTM performs a handover during CS connection from an A/Gb mode cell not supporting DTM to an Iu mode cell.\nThe MS shall resume GPRS services, directly after the CS handover is completed, by sending a Routeing Area Update Request message to the SGSN, as described in clause \" Inter System Change Procedure\".",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_104"
      ]
    },
    {
      "chunk_id": "ts_23.060_16.2.2",
      "section_id": "16.2.2",
      "section_title": "GPRS and Dedicated Mode Priority Handling",
      "content": "An MS in class‑B mode of operation that communicates on GPRS radio channels when a dedicated channel is needed, shall immediately abort the GPRS communication and trigger the Suspend and Resume procedure.\nResponse to circuit-switched paging, non-emergency Mobile-originated circuit-switched calls, Mobile-originated SMS, and Mobile-originated supplementary services are exceptions to the above rule. In these cases, it is an implementation choice whether to immediately abort GPRS communication or to delay the dedicated mode establishment.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.3",
      "section_id": "16.3",
      "section_title": "Supplementary Services",
      "content": "For SMS over GPRS, only the invocation of Call Barring Supplementary Service is supported. The user control by using the Supplementary Service protocol is not supported over GPRS.\nOther supplementary services are not defined for GPRS. Supplementary services may be available in the interworked packet data networks, but this is outside the scope of this specification.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.060_16.4",
      "section_id": "16.4",
      "section_title": "CAMEL Services",
      "content": "CAMEL may be used for session and cost control. It may also be used for other operator-specific services. Subscription data received over Gr, as described in TS 23.078 [8b], enables CAMEL interactions. In this Release of the specification CAMEL Services are not applicable to subscriptions without MSISDN as existing messages have unresolved MSISDN references.\nNOTE:\tCost control with ability to correlate, using the Charging Id, with charging information from a GGSN/P‑GW depends on GGSN (Gn/Gp) or S‑GW (S4) providing a Charging Id that is unique for the PDP context. For S4, such uniqueness requires the S5/S8 to be GTP.\nAnnex A (normative):APN and P-GW/GGSN Selection\nA.0\tGeneral\nThis annex contains the rules applied by the SGSN upon PDP context activation to determine the APN and the corresponding P-GW/GGSN.\nThe selection process used by the SGSN to select P-GW and GGSN is described in clause 5.3.7.1. The procedures specified in TS 29.303 [100] apply to DNS-based P-GW selection.\nAPN selection refers to the process of selection and construction of the full APN (APN-NI + APN-OI). This full APN is then employed for interrogation of the DNS server to obtain the GGSN or P-GW address.\nA.1\tDefinitions\nThe SGSN knows from the subscription data the following parameters (S for Subscribed): PDP type (S), PDP address (S), APN (S), and VPLMN address allowed. In addition, the S4-SGSN and MME receive a PDN subscription context that is marked as default (and associated default APN) for E-UTRAN UEs.\nThe SGSN may know from configuration the Local APN supporting a given PDP type. This APN is called APN (SGSN) and does not include an APN Operator Identifier. APN (SGSN) shall not be an APN with LIPA permisssions set to \"LIPA-only\" or \"LIPA-conditional\".\nThe SGSN knows the parameters requested by the MS (R for Requested): PDP type (R), PDP address (R), and APN (R). APN (R) is the APN Network Identifier requested by the MS.\nIn case of \"an APN chosen by the SGSN\" the activated PDP context is always linked with a dynamic PDP address.\nAn MS may have multiple subscription records for the same PDP type and the same PDP address, but with different APNs.\nAn MS may have one or two subscription records with the same PDP type and the same APN: one with a static PDP address, one with a dynamic PDP address.\nAn MS may have multiple subscription records with the same APN, but with different PDP types.\nWhen the MS is in its HPLMN, if the MS requests an APN that does not correspond to any GGSN or P-GW of its HPLMN, the request shall be rejected by the SGSN. When the MS is in a VPLMN, if the MS requests an APN that does not correspond to any GGSN or P-GW of its HPLMN nor of this VPLMN or any of its associated PLMNs when the VPLMN is a shared network, the request shall be rejected by the SGSN.\nIf APN (S) = wild card (see TS 23.003 [4]), it means either:\n-\tthat a Local APN (a locally defined PDN) has to be chosen by the SGSN (APN (SGSN)) if no APN (R) has been provided; or\n-\tthat a PDP context with dynamic PDP address may be activated towards any APN requested by the MS.\nThe PDN subscription context that is marked as default for the default bearer activation, defines a Default APN that takes precedence over the locally defined APN for the S4-SGSN and MME.\nIn order to derive APN (R) from the APN sent by the MS, the SGSN shall check if the APN sent by the user ends with \".gprs\". If not, then APN (R) is equal to APN sent by the MS. If yes, then APN (R) is the APN sent by the MS without the three last labels.\nNOTE 1:\tIf yes, then the APN-OI shall be saved for later use, see Figure A.4.\nNOTE 2:\tIf the APN OI Replacement field in the subscriber's profile is present, then the default APN-OI is overwritten before performing a DNS look-up on the full APN.\nNOTE 3:\tThe APN as constructed by the SGSN for GGSN resolution takes into account the APN-OI Replacement field. This differs from the APN that is provided in charging data and to another SGSN and MME over the Gn, S3 and S16 interfaces as well as to the Serving GW and PDN GW over the S4 and S5/S8 interface, in that the APN-OI Replacement field is not applied. See clause 13.2 of the present document for more details.\nNOTE 4:\tThe UE should not be provisioned with the APN-OI Replacement FQDN, otherwise APN resolution might fail.\nFor deriving a GGSN by the procedure defined in the SDL Diagram, PDPtype(R) shall be assumed equal to PDPtype(S) if PDPtype(R) is IPv4 or IPv6 and PDPtype(S) is IPv4v6.\nA.2\tSelection Rules\nThe SGSN shall select the APN to be used to derive the GGSN or P-GW address, and set the selection mode parameter according to the rules in the SDL diagrams in this clause. The following definitions apply to the SDL diagrams:\nAddrMode: Addressing Mode, temporary parameter set in the selection process to either of:\nAddrMode := static\nAddrMode := dynamic\nAPN‑OI: APN Operator Identifier.\nHPLMN AP: HPLMN Access Point.\nHPLMN OI-1: HPLMN APN Operator Identifier type 1 (derived from the APN OI Replacement field in the subscriber's profile).\nHPLMN‑OI-2: HPLMN APN Operator Identifier type 2 (derived from IMSI).\nNumber <condition>: determines the PDP context subscription records that satisfy the given condition.\nODB parameter: Operator Determined Barring parameter configured in subscriber data to one of:\nAll Packet Oriented Services barred\nRoamer Access to HPLMN-AP barred\nRoamer Access to VPLMN-AP barred\nPDPaddr: PDP address.\nSelMode: APN selection mode, temporary parameter set in the selection process to either of:\nSelMode := ChosenBySGSN: Network-provided APN, subscription not verified.\nSelMode := SentByMS: MS-provided APN, subscription not verified.\nSelMode := Subscribed: MS or Network-provided APN, subscription verified.\nVPLMN AP: VPLMN Access Point.\nVPLMN‑OI: VPLMN APN Operator Identifier or the APN Operator Identifier of an associated PLMN when the VPLMN is a shared network.\nPDN GW allocation type: PDN GW allocation type is not for the GGSN selection but only for the PDN GW selection. It is either static or dynamic.\nStatic: for the determined APN, the selected PDN GW has been statically allocated.\nDynamic: for the determined APN, the selected PDN GW can be dynamically allocated.\n+: concatenation operation.\nThe subscription data may contain the information whether SIPTO is allowed or prohibited for each subscribed APN or the SGSN may know from configuration whether SIPTO is allowed or prohibited for a given APN. An indication that SIPTO is allowed or prohibited for the wild card APN allows or prohibits SIPTO for any APN that is not present in the subscription data. When a PDP context for SIPTO is established, the SGSN uses either the RAI (Routing Area Identity) and/or the serving RNC identifier depending on the operator's configuration during the DNS interrogation as specified in TS 29.303 [100]. In roaming scenario the GW selection for a PDP context with SIPTO is only possible when a GGSN or a P-GW in the visited PLMN is selected. Therefore in a roaming scenario with home routed traffic, GW selection for SIPTO is not performed. When the UE is in a network with A/Gb mode and SIPTO is allowed for the given APN, the RAI may also be used for PGW/GGSN selection. In this way when the UE enters UTRAN or E-UTRAN the PDP context deactivation with reactivation request to find an optimal PGW/GGSN for SIPTO may not be needed.\nThe subscription data may also contain the information on whether:\na)\tan APN is LIPA-conditional, LIPA-prohibited, or LIPA-only;\nb)\ta CSG in the UE's CSG subscription data supports APN(s) that are LIPA-only or LIPA-conditional; and\nc)\tLIPA is allowed in a list of VPLMNs when roaming.\nWhen a PDP context for a LIPA APN is established, the SGSN uses the L-GW address included by HNB in RANAP messages as the GGSN/PGW address to be used, instead of DNS interrogation for GGSN/PGW selection. If no collocated L-GW address is included by the HNB and the UE requested a LIPA only APN, the request shall be rejected. If no collocated L-GW address is included by the HNB and the UE requested a LIPA conditional APN, the SGSN uses DNS interrogation for GGSN/PGW selection to establish a non-LIPA PDP context. The subscription data for an APN with LIPA permissions set to \"LIPA-only\" shall not contain a statically configured PDP address or a statically allocated PDN GW. A static PDP address or a static PDN GW address, if configured by HSS for an APN with LIPA permissions set to \"LIPA-conditional\", is ignored by SGSN when the APN is established as a LIPA PDP context. When establishing a PDP context for a LIPA APN, the VPLMN Address Allowed flag is not considered.\nIn the procedure denoted \"Interface and protocol selection\" in Figure A.8, the SGSN shall select one of the configurations listed in Table A.1.\nThe SGSN may use the UE capability (indicated as part of the MS Network Capability) and roaming agreement as indicated in clause 5.3.7.1 as input to select between configurations using GGSN or P-GW as well as the interface type (Gp or S4/S8). The SGSN may give priority for a configuration using P-GW for E-UTRAN capable UEs, and GGSN for non E-UTRAN capable UE.\nIf the SGSN supports Gn/Gp only, selection between the configurations indexed 1 and 2 are applicable. If the SGSN supports both Gn/Gp and S4, any of the configurations in Table A.1 apply. In case of P-GW selection, the service parameter shall be set as given in the respective column of Table A.1 and applied as defined in TS 29.303 [100].\nIf the HLR/HSS provides a subscription context that allows for allocation of a GGSN/PGW from the visited PLMN for this APN and, optionally, the SGSN is configured to know that the visited VPLMN has a suitable roaming agreement with the HPLMN of the UE, the GGSN/PGW selection function derives a GGSN/PGW from the VPLMN. If a visited GGSN/PGW cannot be derived, the APN is used to derive a GGSN/PGW from the HPLMN.\nDNS interrogation in Figure A.8 shall be performed based on the full APN (APN-NI +APN-OI). For index of 2, 3, or 4 DNS interrogation procedure is defined by TS 29.303 [100]. For index 1 the DNS interrogation is a DNS A query and/or DNS AAAA query at the full APN exactly as in pre-Release 8 networks. Fall back to the legacy procedure (i.e. index 1) is required for indexes 2, 3, and 4 if they fail since the APN may represent a pre-Release 8 network.\nTable A.1: Gateway interface and protocol configurations\nIndex\nGateway node\nInterface type\nProtocol on S5/S8\nService parameter\n1\nGGSN\nGn/Gp\nn.a.\nno\n2\nP-GW\nGn/Gp\nn.a.\nyes\n3\nP-GW\nS4\nGTPv2\nyes\n4\nP-GW\nS4\nPMIP\nyes\nFigure A.1: APN selection-Null Parameter present\nFigure A.2: APN selection-PDPtype(R) present\nFigure A.3: APN selection- APN(R) not present or PDPaddr(R) present\nFigure A.4: LIPA authorization\nFigure A.5: APN PLMN selection-APN from subscription or MS\nFigure A.6: APN PLMN selection-APN chosen by SGSN\nNOTE:\tThis process is only applied by an SGSN when S4 is used.\nFigure A.7: APN selection-Dynamic stored PGW selection\nFigure A.8: APN DNS query\nAnnex B (informative):Selected IP Traffic Offload at Iu-PS\nB.1\tSIPTO with Traffic Offload Function\nThis clause describes one way to perform Selected IP Traffic Offload by the Traffic Offload Function at Iu-PS for UMTS network.\nFigure B.1: Selected IP Traffic Offload from Traffic Offload Function (TOF) deployed at Iu-PS\nTOF may include the following functions:\n-\tNAS and RANAP message inspection to build/remove local UE context and local session context;\n-\tPacket Inspection and Selected IP Traffic Offload enforcement;\n-\tUplink traffic offloaded by removing GTP-U header and performing IPv4-IPv4 Network Address Translation;\n-\tDownlink traffic offloaded by reverse IPv4-IPv4 Network Address Translation and adding GTP-U header;\n-\tCharging for offloaded traffic;\n-\tLI for offloaded traffic;\n-\tOffload traffic service continuity during intra-TOF mobility;\n-\tPaging.\nIn this implementation example a deployment is needed that assures that all PS domain signalling from a UE goes through the same TOF instance. The TOF inspects the NAS and RANAP messages to build the local UE context and local session context. When a RAB is requested to be set up and should be offloaded, the SGSN includes the MSISDN, APN and the Charging Characteristics for the requested RAB to enable Iu-ps offload. The details of how the SGSN transfers these RANAP parameters to the TOF are described in the following clause B.2. The TOF records any necessary information e.g. the RAB ID/NSAPI, uplink TEID and downlink TEID, APN, etc. in its local context.\nDuring the data transfer procedure, the TOF performs IPv4-IPv4 Network Address Translation for uplink offload traffic which matches the offload policies, and transparently transfers the non-offload traffic to the CN. The TOF adds the corresponding GTP-U header to the downlink offload traffic which has no GTP-U header, and then sends the downlink traffic to the RNC/HNB GW in the same way as would an SGSN.\nWhen the TOF detects an Iu release message it could start an inactivity timer, which is longer than the RAU Timer. When this inactivity timer expires and the Iu connection is not re-established, the TOF deletes related UE context. The inactivity timer is stopped when the Iu connection is re-established for the UE.\nWhen the TOF is configured to perform paging, the TOF pages a UE in idle mode for downlink offload traffic arriving at the TOF, and when the UE sends a Service Request message as the paging response, the TOF modifies the Service type IE in the Service Request message to indicate \"Data\" and sends it to the SGSN. When the TOF is configured not to perform paging, the TOF discards the received downlink offload packets for a UE in idle mode.\nB.2\tSupport for SIPTO at Iu-ps\nThis clause describes the functionality that an SGSN provides if the SGSN supports the \"SIPTO at Iu-ps\" function. Support for the \"SIPTO at Iu-ps\" function is optional in the SGSN.\nDuring the SRNS Relocation Procedures (in clauses 6.9.2.2.1, 6.9.2.2.2 and 6.9.2.2.3):\n-\tIf the SGSN has valid subscriber data before it sends Relocation Request message to the target RNC, and SIPTO function should be activated for the APN of the RAB to be setup according to the subscriber data and operator policies, the SGSN shall include the MSISDN in the Relocation Request message (in step 4), and include the APN and the Charging characteristics in the RABs to be setup IE for the RAB to be offloaded to enable Iu-ps traffic offload and charging for the offload traffic.\n-\tIf the SRNS Relocation is inter-SGSN and the new SGSN does not have valid subscriber data before it sends Relocation Request message to the target RNC, and SIPTO function should be activated for the APN of the RAB to be setup according to the subscriber data and operator policies, the new SGSN shall initiate a RAB assignment procedure after Routing Area Update procedure (after step 15) to enable Iu-ps offload and transfer the charging parameters to the Traffic Offload Function. The SGSN includes MSISDN in the RAB Assignment Request message, and includes the APN and the Charging characteristics in the RABs to be setup IE for the RAB to be offloaded.\nDuring Service Request Procedures (in clauses 6.12.1 and 6.12.2):\n-\tIf SIPTO function should be activated for the APN of the RAB to be setup according to the subscriber data and operator policies, the SGSN shall include the MSISDN in the RAB Assignment Request message (in step 4 of clause 6.12.1, step 6 of clause 6.12.2), and include the APN and the Charging characteristics in the RABs to be setup IE for the RAB to be offloaded to enable Iu-ps traffic offload and charging for the offload traffic.\nDuring the intersystem change procedures from A/Gb mode to Iu mode (in clauses 6.13.1.2.1 and 6.13.2.2.1):\n-\tIf SIPTO function should be activated for the APN of the RAB to be setup according to the subscriber data and operator policies, the SGSN shall include the MSISDN in the RAB Assignment Request message (step 11 of clause 6.13.1.2.1, step 20 of clause 6.13.2.2.1), and include the APN and the Charging characteristics in the RABs to be setup IE for the RAB to be offloaded to enable Iu-ps traffic offload and charging for the offload traffic.\nDuring RAB Assignment procedure (in clause 12.7.4.1):\n-\tIf SIPTO function should be activated for the APN of the RAB to be setup according to the subscriber data and operator policies, the SGSN shall include the MSISDN in the RAB Assignment Request message (step 1), and include the APN and the Charging characteristics in the RABs to be setup IE for the RAB to be offloaded to enable Iu-ps traffic offload and charging for the offload traffic.\nAnnex C (informative):Link MTU considerations\nAccording to clause 9.3 networks can provide link MTU size for MSs. A purpose of the link MTU size provisioning is to limit the size of the packets sent by the MS to avoid packet fragmentation in the backbone network between the MS and the GGSN/PGW (and/or across the (S)Gi reference point) when some of the backbone links does not support packets larger then 1500 octets. Fragmentation within the backbone network creates a significant overhead. Therefore, operators might desire to avoid it. This Annex presents an overhead calculation that can be used by operators to set the link MTU size provided by the network. A MS may not employ the provided link MTU size, e.g. when the MT and TE are separated, as discussed in clause 9.3. Therefore, providing an MTU size does not guarantee that there will be no packets larger than the provided value. However if MSs follow the provided link MTU value operators will benefit from reduced transmission overhead within backbone networks.\nOne of the worst case scenarios is when GTP packets, e.g., between a RAN node and the core network, are transferred over IPSec tunnel in an IPv6 deployment. In that case the user packet first encapsulated in a GTP tunnel which results the following overhead:\n-\tIPv6 header, which is 40 octets;\n-\tUDP overhead, which is 8 octets;\n-\tExtended GTP-U header, which is 16 octets.\nNOTE:\tThe sending of SCI in the GTP-U header will increase the GTP-U header size (see TS 29.281 [120]).\nIn this scenario the GTP packet then further encapsulated to an IPSec tunnel. The actual IPSec tunnel overhead depends on the used encryption and integriry protection algorithms. TS 33.210 [114] mandates the support of AES-CBC with a key length of 128 bits and the use of HMAC_SHA-1 for integrity protection. Therefore the overhead with those algorithms is calculated in this Annex:\n-\tIPv6 header, which is 40 octets;\n-\tIPSec Security Parameter Index and Sequence Number overhead, which is 4+4 octets;\n-\tInitialization Vector for the encryption algorithm, which is 16 octets;\n-\tPadding to make the size of the encrypted payload a multiple of 16;\n-\tPadding Length and Next Header octets (2 octets);\n-\tIntegrity Check Value, which is 12 octets.\nIn order to make the user packet size as large as possible a padding of 0 octet is assumed. With this zero padding assumption the total overhead is 144 octets, which results a maximum user packet size of 1358 octets. Note that this user packet size will result in a 1424 octets payload length to be ciphered, which is a multiple of 16, thus the assumption that no padding is needed is correct (see Figure C.1).\nFigure C.1: Overhead for MTU calculation\nThe link MTU value that can prevent fragementation in the backbone network between the MS and GGSN/PGW depends on the actual deployement. Based on the above calculation a link MTU value of 1358 is small enough in most of the network deployements.\nNote that using a link MTU value smaller than necessary would decrease the efficiency in the network. Moreover a UE may also apply some tunnelling (e.g., DSMIPv6 or VPN). and it is desired to use a link MTU size that assures at least 1280 octets, which is the minimum MTU size in case of IPv6, within the UE tunnel to avoid the fragmentation of the user packets within the tunnel applied in the UE.\nAnother aspect of the dynamic link MTU provisioning is that in the future when all network links support larger packet sizes than 1500 octets, operators can send a value larger than 1500 octets as a link MTU size to MSs. This option is useful for operators as if an MS uses large packets then it will increase the transport efficiency in the network.\nThe above methodology can be modified for calculation of the UE's link MTU when a PDN GW has MTU limits on the SGi reference point and is offering a \"non-IP\" connection between the PDN GW and the UE,\nAnnex D (informative):Change History\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n12/2011\nSA#54\nSP-110734\n1502\n2\nF\nRelationship between LIPA permissions and SIPTO permissions\n10.6.0\n12/2011\nSA#54\nSP-110732\n1508\n1\nA\nPre-Rel‑7 QoS description correction\n10.6.0\n12/2011\nSA#54\nSP-110737\n1509\n-\nF\nPDP Context Activation of pre-Rel‑7 UEs\n10.6.0\n12/2011\nSA#54\nSP-110736\n1510\n1\nF\nThrottling of Downlink Data Notification Request when ISR is activated\n10.6.0\n12/2011\nSA#54\nSP-110732\n1514\n1\nA\nRestriction on inter-PLMN handover to a CSG cell\n10.6.0\n12/2011\nSA#54\nSP-110736\n1519\n1\nF\nMS initiates detach procedure when MM backoff timer is running\n10.6.0\n12/2011\nSA#54\nSP-110736\n1520\n2\nF\nAPN based Session Management congestion control correction\n10.6.0\n12/2011\nSA#54\nSP-110737\n1522\n2\nF\nISR handling at SGSN\n10.6.0\n12/2011\nSA#54\nSP-110736\n1537\n1\nF\nEmergency attach when MM back-off timer is running\n10.6.0\n12/2011\nSA#54\nSP-110736\n1548\n2\nF\nBack-off timer handling in READY or PMM-CONNECTED state\n10.6.0\n12/2011\nSA#54\nSP-110732\n1563\n2\nA\nHandover to CSG cell with emergency bearer\n10.6.0\n12/2011\nSA#54\nSP-110749\n1469\n2\nB\nIntroducing CSS for VPLMN autonomous CSG roaming\n11.0.0\n12/2011\nSA#54\nSP-110749\n1470\n2\nB\nCSS information storage\n11.0.0\n12/2011\nSA#54\nSP-110749\n1471\n2\nB\nInsert CSG subscriber data procedure in 23.060\n11.0.0\n12/2011\nSA#54\nSP-110749\n1482\n2\nB\nRetrieval of VPLMN CSG subscription information during MM procedures\n11.0.0\n12/2011\nSA#54\nSP-110748\n1515\n1\nC\nInter-PLMN Handover to a CSG cell based on the associated CSG white lists\n11.0.0\n03/2012\nSA#55\nSP-120066\n1571\n2\nA\nS4-SGSN procedure clarifications\n11.1.0\n03/2012\nSA#55\nSP-120074\n1576\n1\nA\nAlignment of the clause on MTC with GERAN specifications\n11.1.0\n03/2012\nSA#55\nSP-120075\n1588\n1\nA\nClarify reference point used inter-PLMN and intra-PLMN\n11.1.0\n03/2012\nSA#55\nSP-120075\n1600\n1\nA\nPS Domain Overload Control when using Network Mode of Operation II\n11.1.0\n03/2012\nSA#55\nSP-120073\n1618\n-\nA\nLIPA PDN connection handling when the UE's CSG membership changes\n11.1.0\n03/2012\nSA#55\nSP-120090\n1467\n2\nF\nCorrect the behaviour upon receipt of Teardown Indication\n11.1.0\n03/2012\nSA#55\nSP-120089\n1506\n4\nB\nSM-Backoff timer for NW initiated bearer deactivation\n11.1.0\n03/2012\nSA#55\nSP-120090\n1564\n1\nF\nIndication of Change in BCM by GGSN/PDN-GW to UE\n11.1.0\n03/2012\nSA#55\nSP-120090\n1565\n1\nF\nAlignment of S4-SGSN behaviour for PDP Ctx involving streaming or conversational traffic class\n11.1.0\n03/2012\nSA#55\nSP-120089\n1566\n1\nD\nEditorial corrections to 23.060\n11.1.0\n03/2012\nSA#55\nSP-120089\n1567\n1\nF\nIETF references update for 23.060\n11.1.0\n03/2012\nSA#55\nSP-120090\n1582\n1\nD\nMinor Corrections - References and Abbreviations\n11.1.0\n03/2012\nSA#55\nSP-120089\n1583\n-\nF\nBarring sub-categories\n11.1.0\n03/2012\nSA#55\nSP-120090\n1593\n2\nF\nCorrection on Update Location at Attachment\n11.1.0\n03/2012\nSA#55\nSP-120090\n1599\n1\nF\nRAU trigger upon receipt of paging in congestion\n11.1.0\n03/2012\nSA#55\nSP-120090\n1602\n3\nF\nSupport BCM Upgrade from MS-Only to MS/NW\n11.1.0\n03/2012\nSA#55\nSP-120080\n1607\n1\nC\nInclude support of other media for IMS Emergency Session\n11.1.0\n03/2012\nSA#55\nSP-120090\n1608\n1\nB\nLocal address and IP address type in the TFT filter\n11.1.0\n03/2012\nSA#55\nSP-120089\n1609\n1\nB\nDeclaring support for extended TFT filter format\n11.1.0\n03/2012\nSA#55\nSP-120081\n1613\n2\nB\nNetwork Provided Location Information Retrieval via Session Management Procedures\n11.1.0\n03/2012\nSA#55\nSP-120089\n1614\n2\nB\nEAB for UTRAN\n11.1.0\n03/2012\nSA#55\nSP-120086\n1616\n3\nB\nNormative documentation for PS Only subscriptions in GPRS Service Description\n11.1.0\n03/2012\nSA#55\nSP-120090\n1617\n2\nF\nQoS for default bearer\n11.1.0\n03/2012\nSA#55\nSP-120086\n1620\n4\nB\nSupport of PS-only service provision\n11.1.0\n06/2012\nSA#56\nSP-120236\n1603\n3\nA\nFix wrong statement for the Reporting Action related storage\n11.2.0\n06/2012\nSA#56\nSP-120250\n1635\n2\nF\nCorrection of the wrong descritpion about emergency ARP value\n11.2.0\n06/2012\nSA#56\nSP-120239\n1639\n4\nF\nCorrection of PS-only Feature Description\n11.2.0\n06/2012\nSA#56\nSP-120243\n1640\n1\nF\nCorrection of Procedures for Netloc Location Retrieval by Modification Procedure\n11.2.0\n06/2012\nSA#56\nSP-120250\n1645\n2\nF\nEAB overload control from CN to RAN for UTRAN\n11.2.0\n06/2012\nSA#56\nSP-120250\n1646\n3\nF\nUE AS capability request over Iu\n11.2.0\n06/2012\nSA#56\nSP-120243\n1649\n-\nF\nRemoval of CSG ID as a network provided location information parameter\n11.2.0\n06/2012\nSA#56\nSP-120236\n1659\n1\nA\nISR deactivation for PGW-initiated Bearer Deactivation Procedure\n11.2.0\n06/2012\nSA#56\nSP-120243\n1671\n-\nF\nCorrection of Network Provided Location Information Retrieval on GGSN-Initiated PDP Context Modification Procedure\n11.2.0\n06/2012\nSA#56\nSP-120252\n1680\n2\nB\nIntroduction of SIRIG\n11.2.0\n09/2012\nSA#57\nSP-120485\n1684\n5\nF\nAppropriate Cause value from the SGSN in roaming case\n11.3.0\n09/2012\nSA#57\nSP-120485\n1688\n1\nF\nRA update after Cell Change Order (CCO) to GERAN\n11.3.0\n09/2012\nSA#57\nSP-120485\n1689\n2\nF\nClarification on handling of Homogenous Support of IMS Over PS Sessions\n11.3.0\n09/2012\nSA#57\nSP-120482\n1693\n4\nF\nCorrection of PS-only Feature Description\n11.3.0\n09/2012\nSA#57\nSP-120485\n1703\n3\nC\nRemoving NMO-III\n11.3.0\n09/2012\nSA#57\nSP-120483\n1707\n3\nF\nCorrection of SIRIG to cope with mix of standardised/non-standardised SCIs, and, roamers using V-GGSN, while avoiding impact to LTE/UMTS users\n11.3.0\n09/2012\nSA#57\nSP-120477\n1685\n2\nF\nInteractions between SGSN and RAN not supporting bit rates higher than 256 Mbps\n11.3.0\n09/2012\nSA#57\nSP-120477\n1709\n1\nA\nRemoval of Maximum MBR/APN-AMBR\n11.3.0\n12/2012\nSA#58\nSP-120717\n1654\n3\nF\nClarification of UE behaviour that needs PS only services and NAS based SMS\n11.4.0\n12/2012\nSA#58\nSP-120710\n1666\n4\nA\nRestriction of Inter RAT handover/release with redirection between E-UTRAN and UTRAN/GERAN\n11.4.0\n12/2012\nSA#58\nSP-120726\n1676\n4\nF\nSecondary PDP context activation without TFT\n11.4.0\n12/2012\nSA#58\nSP-120717\n1691\n7\nF\nCorrection of indication of \"SMS support\"\n11.4.0\n12/2012\nSA#58\nSP-120715\n1699\n2\nA\nCorrection on existence of uplink packet filter in TFT\n11.4.0\n12/2012\nSA#58\nSP-120717\n1702\n6\nB\nMS supporting dual priority\n11.4.0\n12/2012\nSA#58\nSP-120721\n1716\n-\nF\nRoaming support in SIRIG\n11.4.0\n12/2012\nSA#58\nSP-120726\n1719\n1\nF\nCorrection of priority services\n11.4.0\n12/2012\nSA#58\nSP-120717\n1722\n2\nF\nCorrection of network stored back-off after addition of Dual priority\n11.4.0\n12/2012\nSA#58\nSP-120726\n1731\n-\nF\nRemove the RAN3 reference for EAB\n11.4.0\n03/2013\nSA#59\nSP-130083\n1733\n4\nF\nUser Location Information Age\n11.5.0\n03/2013\nSA#59\nSP-130078\n1743\n-\nA\nRestricting Inter RAT handover and release-with-redirection from GERAN to E-UTRAN\n11.5.0\n03/2013\nSA#59\nSP-130088\n1744\n2\nF\nAlignment with Stage 3 of 3G DT handling at PDP Context Activation to avoid IOT problem\n11.5.0\n03/2013\nSA#59\nSP-130089\n1751\n2\nB\nExtension of SIPTO permission for SIPTO at the local network\n12.0.0\n03/2013\nSA#59\nSP-130089\n1756\n2\nB\nSupport of SIPTO at the Local Network\n12.0.0\n03/2013\nSA#59\nSP-130093\n1757\n3\nB\nClarifying inter-operator charging requirements\n12.0.0\n06/2013\nSA#60\nSP-130225\n1762\n2\nA\nClarification that IMSVoPS is MMTEL\n12.1.0\n06/2013\nSA#60\nSP-130225\n1764\n2\nA\nImmediate Cancel Location ACK during HSS-initiated detach procedure\n12.1.0\n06/2013\nSA#60\nSP-130213\n1768\n2\nA\nConsistent description of allowed packet filter configurations\n12.1.0\n06/2013\nSA#60\nSP-130225\n1773\n1\nA\nGateway selection by SGSN depending on E-UTRAN roaming agreement\n12.1.0\n06/2013\nSA#60\nSP-130324\n1775\n2\nC\nDirect user plane path establishment for SIPTO at local network on HNB\n12.1.0\n06/2013\nSA#60\nSP-130320\n1777\n2\nA\nCorrection on the definition of packet filter evaluation precedence index\n12.1.0\n06/2013\nSA#60\nSP-130319\n1779\n4\nA\nIntroduction of Operator Group GGSN\n12.1.0\n06/2013\nSA#60\nSP-130232\n1781\n5\nD\nCorrect inconsistency with Stage 1 regarding support for emergency bearer services in the serving network\n12.1.0\n06/2013\nSA#60\nSP-130324\n1791\n2\nF\nCorrection to PDN Deactivation for SIPTO@LN\n12.1.0\n06/2013\nSA#60\nSP-130232\n1793\n2\nB\nIndividual subscription migration and subscriber troubleshooting\n12.1.0\n06/2013\nSA#60\nSP-130310\n1795\n-\nF\nCorrection on the applicability of SIPTO@LN at a CSG cell\n12.1.0\n06/2013\nSA#60\nSP-130232\n1797\n2\nF\nUse of MM backoff timer for voice centric devices\n12.1.0\n06/2013\nSA#60\nSP-130242\n1798\n-\nA\nIncomplete specification text on link MTU size for IPv6\n12.1.0\n09/2013\nSA#61\nSP-130374\n1802\n2\nA\nClarifications on QoS and roaming\n12.2.0\n09/2013\nSA#61\nSP-130384\n1804\n2\nB\nGTP-C overload/load handling\n12.2.0\n09/2013\nSA#61\nSP-130379\n1805\n1\nF\nCorrection of Sipto at Local Network\n12.2.0\n09/2013\nSA#61\nSP-130384\n1806\n1\nC\nRemoval of GERAN Iu mode\n12.2.0\n09/2013\nSA#61\nSP-130379\n1807\n2\nF\nCorrection of Local Home Network\n12.2.0\n12/2013\nSA#62\nSP-130524\n1801\n5\nA\nDefinition for a valid state of the TFT setting\n12.3.0\n12/2013\nSA#62\nSP-130535\n1810\n1\nB\nAddition of Diameter Gdd interface for SMS with SGSN\n12.3.0\n12/2013\nSA#62\nSP-130529\n1814\n9\nB\nIntroducing UE Power Saving Mode\n12.3.0\n12/2013\nSA#62\nSP-130526\n1815\n1\nF\nCorrection of SIPTO at Local Network in Handover procedures\n12.3.0\n12/2013\nSA#62\nSP-130534\n1819\n3\nF\nCore Network Operator selection origin\n12.3.0\n12/2013\nSA#62\nSP-130526\n1820\n1\nF\nCorrection in Local Home Network ID definition\n12.3.0\n12/2013\nSA#62\nSP-130526\n1821\n2\nF\nClarification on the RA provisioning when SIPTO@LN with stand-alone L-GW is used\n12.3.0\n12/2013\nSA#62\nSP-130534\n1822\n2\nF\nUse of LAPI for MME/SGSN selection during handover\n12.3.0\n12/2013\nSA#62\nSP-130533\n1825\n-\nB\nHPLMN Notification with specific indication due to SGSN initiated Bearer removal\n12.3.0\n12/2013\nSA#62\nSP-130584\n1826\n5\nB\nIntroduction of ULI reporting at PCC area level\n12.3.0\n12/2013\nSA#62\nSP-130585\n1827\n3\nB\nIntroduction of ULI reporting only when the UE is in 'CONNECTED' state\n12.3.0\n12/2013\nSA#62\nSP-130534\n1830\n-\nF\nCorrection to Gn SGSN behavior during SRNS relocation procedure\n12.3.0\n03/2014\nSA#63\nSP-140108\n1829\n3\nF\nAddition of a note addressing the behavior of network side during inter-RAT 3GPP PS Handover\n12.4.0\n03/2014\nSA#63\nSP-140100\n1832\n1\nA\nCorrections to TFT packet filter related descriptions\n12.4.0\n03/2014\nSA#63\nSP-140106\n1833\n1\nF\nCorrections for presence reporting area based location reporting\n12.4.0\n03/2014\nSA#63\nSP-140106\n1834\n2\nB\nPresence Reporting Area provided by OCS\n12.4.0\n03/2014\nSA#63\nSP-140104\n1835\n3\nF\nPower Saving Mode applicability\n12.4.0\n03/2014\nSA#63\nSP-140111\n1837\n1\nF\nClarify the APN selection when the user locates in HPLMN\n12.4.0\n03/2014\nSA#63\nSP-140104\n1840\n1\nF\nClarification on PSM\n12.4.0\n06/2014\nSA#64\nSP-140251\n1845\n-\nA\nCorrection of IETF reference on prefix delegation\n12.5.0\n06/2014\nSA#64\nSP-140256\n1847\n2\nA\nCorrections to TFT packet filter related descriptions\n12.5.0\n06/2014\nSA#64\nSP-140272\n1848\n1\nF\nCorrection of possible PGW actions during PDN connection termination\n12.5.0\n06/2014\nSA#64\nSP-140377\n1853\n2\nF\nBCM handling in NW init procedures\n12.5.0\n06/2014\nSA#64\nSP-140257\n1858\n2\nF\nDeferred ULI reporting\n12.5.0\n06/2014\nSA#64\nSP-140257\n1862\n5\nF\nClarifying when the PGW can set ULI reporting, CSG reporting and PRA reporting\n12.5.0\n06/2014\nSA#64\nSP-140257\n1863\n1\nF\nClarifications for presence reporting area based location reporting\n12.5.0\n06/2014\nSA#64\nSP-140263\n1864\n2\nF\nClarifications for Power Savings Mode\n12.5.0\n06/2014\nSA#64\nSP-140256\n1866\n2\nA\nClarification on SGSN behaviour on roaming situation\n12.5.0\n06/2014\nSA#64\nSP-140270\n1867\n2\nB\nIntroduction of traffic steering for RAN-based WLAN interworking solution\n12.5.0\n06/2014\nSA#64\nSP-140377\n1868\n3\nF\nCorrection to the SGSN initiated bearer setup during the RAU procedure\n12.5.0\n06/2014\nSA#64\nSP-140257\n1869\n3\nF\nCorrection of ULI reporting only when the UE is in 'CONNECTED' state\n12.5.0\n09/2014\nSA#65\nSP-140490\n1878\n8\nF\nClarifications for PRA reporting\n12.6.0\n09/2014\nSA#65\nSP-140424\n1880\n-\nF\nProviding WLAN offloading indication in UTRAN\n12.6.0\n09/2014\nSA#65\nSP-140424\n1883\n2\nF\nLimiting update of 'WLAN offloadability' to session management procedures\n12.6.0\n09/2014\nSA#65\nSP-140417\n1886\n1\nA\nRemoval of extended wait timers in RR signalling to align with GERAN specifications\n12.6.0\n09/2014\nSA#65\nSP-140428\n1879\n3\nB\nIntroducing RAN Congestion Awareness Function\n13.0.0\n09/2014\nSA#65\nSP-140428\n1882\n-\nB\nIntroduction of User plane congestion management function\n13.0.0\n12/2014\nSA#66\nSP-140689\n1892\n2\nB\nNq' interface support for Gn/Gp-SGSN\n13.1.0\n12/2014\nSA#66\nSP-140675\n1896\n1\nA\nHandling of E-UTRAN Inter RAT Handover information in Gb mode\n13.1.0\n12/2014\nSA#66\nSP-140684\n1904\n-\nA\nSupport of non-seamless offloading with RAN rules\n13.1.0\n12/2014\nSA#66\nSP-140684\n1906\n1\nA\nClarification on the RAN assistance parameters based on RAN WGs agreements\n13.1.0\n12/2014\nSA#66\nSP-140674\n1907\n4\nA\nClarifications for TFT handling\n13.1.0\n12/2014\nSA#66\nSP-140684\n1909\n1\nA\nClarification of WLAN offload indication from SGSN in UTRAN\n13.1.0\n12/2014\nSA#66\nSP-140685\n1918\n1\nA\nCorrection to the Low Access Priority Indication use by the network\n13.1.0\n12/2014\nSA#66\nSP-140674\n1924\n1\nA\nRequiring to always have TFT in Secondary PDP context for E-UTRAN capable device\n13.1.0\n12/2014\nSA#66\nSP-140673\n1929\n-\nA\nUse of low access priority for GERAN access\n13.1.0\n12/2014\nSA#66\nSP-140689\n1932\n1\nC\nSGSN - RCAF interface\n13.1.0\n12/2014\nSA#66\nSP-140674\n1935\n2\nA\nAlign the UE uplink traffic mapping for 'MS/NW' with the TS 23.401\n13.1.0\n12/2014\nSA#66\nSP-140717\n1942\n-\nA\nCorrection of S4-SGSN-Initiated PDP Context Modification Procedure\n13.1.0\n03/2015\nSA#67\nSP-150025\n1943\n4\nB\nGroup specific NAS level congestion control\n13.2.0\n03/2015\nSA#67\nSP-150021\n1948\n1\nA\nClarify handling of \"MS Info Change Reporting Action\" at change of Serving Node for an UE.\n13.2.0\n06/2015\nSA#68\nSP-150239\n1893\n5\nC\nEnable ISR for PS-only UE\n13.3.0\n06/2015\nSA#68\nSP-150230\n1951\n1\nA\nCorrecting SM re-activation attempts at PLMN change when only one IP version is supported by the network\n13.3.0\n06/2015\nSA#68\nSP-150234\n1953\n7\nB\nIntroduce the Dedicated Core Network (DECOR) feature\n13.3.0\n06/2015\nSA#68\nSP-150237\n1956\n2\nB\nAPN and group specific NAS level congestion control\n13.3.0\n06/2015\nSA#68\nSP-150236\n1960\n2\nB\nUpdate to PSM to support monitoring events\n13.3.0\n06/2015\nSA#68\nSP-150236\n1961\n5\nB\nSupport for Monitoring Events\n13.3.0\n06/2015\nSA#68\nSP-150238\n1965\n3\nB\nIntroducing functions for High latency communication\n13.3.0\n06/2015\nSA#68\nSP-150237\n1967\n3\nF\nGroup specific NAS level congestion control for multiple APNs\n13.3.0\n06/2015\nSA#68\nSP-150236\n1968\n2\nB\nMonitoring event configuration in the HSS and SGSN\n13.3.0\n06/2015\nSA#68\nSP-150237\n1971\n2\nF\nClarification of Group specific NAS Level congestion control\n13.3.0\n09/2015\nSA#69\nSP-150502\n1972\n3\nB\nIntroducing eDRX for High latency communicationMCC note: '(see clause 5.3.Y)' not implemented as the clause could not be found.\n13.4.0\n09/2015\nSA#69\nSP-150502\n1973\n1\nF\nNon-Applicability of HLCom Monitoring Events feature to Gn/Gp-SGSN\n13.4.0\n09/2015\nSA#69\nSP-150501\n1974\n2\nB\nIntroducing extended Idle mode DRX feature\n13.4.0\n09/2015\nSA#69\nSP-150505\n1976\n-\nF\nAdd reference to the SGSN selection function\n13.4.0\n09/2015\nSA#69\nSP-150490\n1978\n1\nA\nAdding PSM parameters in the SGSN/MS contexts\n13.4.0\n09/2015\nSA#69\nSP-150502\n1979\n1\nF\nClarification of High latency communication\n13.4.0\n09/2015\nSA#69\nSP-150505\n1981\n2\nB\nPaging for MTC in GERAN\n13.4.0\n09/2015\nSA#69\nSP-150501\n1982\n3\nB\nIntroduction of support for extended Idle mode DRX for Gb mode\n13.4.0\n09/2015\nSA#69\nSP-150501\n1983\n-\nB\nIntroducing the solution for S/P-GW retransmissions when handling Network originated control plane procedure\n13.4.0\n12/2015\nSA#70\nSP-150614\n1984\n1\nF\nAddition of Coverage Class Information (CCI) to downlink BSSGP PDU\n13.5.0\n12/2015\nSA#70\nSP-150611\n1985\n2\nB\nPaging coordination between CN and UE\n13.5.0\n12/2015\nSA#70\nSP-150611\n1986\n2\nF\nFurther clarifications to extended DRX in Idle mode for Gb\n13.5.0\n12/2015\nSA#70\nSP-150606\n1988\n4\nF\nUE Usage Type in handovers\n13.5.0\n12/2015\nSA#70\nSP-150602\n1990\n2\nA\nS4-SGSN-Initiated PDP Context Modification Procedure\n13.5.0\n12/2015\nSA#70\nSP-150774\n1992\n3\nF\nClarification of QoS modifications restrictions\n13.5.0\n12/2015\nSA#70\nSP-150611\n1993\n1\nF\nClarification on using eDRX in case of emergency bearer services\n13.5.0\n03/2016\nSA#71\nSP-160163\n1996\n1\nF\nAdd missing text for DNS procedure for DECOR\n13.6.0\n06/2016\nSA#72\nSP-160286\n1999\n4\nF\nMTU for non-IP PDN connection\n13.7.0\n06/2016\nSA#72\nSP-160298\n2001\n1\nF\n'UE reachability' event reports for UEs using extended idle mode DRX\n13.7.0\n06/2016\nSA#72\nSP-160289\n2003\n2\nF\nPending data and user inactivity\n13.7.0\n06/2016\nSA#72\nSP-160295\n2000\n2\nB\nIntroducing support for Non-IP data for GPRS\n14.0.0\n06/2016\nSA#72\nSP-160303\n2004\n1\nB\nUE assisted DCN selection\n14.0.0\n09/2016\nSA#73\nSP-160653\n2006\n7\nB\nSupport of Multiple PRAs\n14.1.0\n09/2016\nSA#73\nSP-160648\n2007\n2\nB\nIntroduction and update of CIoT GSM Optimization\n14.1.0\n09/2016\nSA#73\nSP-160659\n2011\n1\nC\nOperator management of eDRX parameters\n14.1.0\n09/2016\nSA#73\nSP-160644\n2013\n1\nA\nGGSN selection for DECOR at PDP Context Activation\n14.1.0\n09/2016\nSA#73\nSP-160649\n2014\n-\nC\nDCN Congestion Control\n14.1.0\n12/2016\nSA#74\nSP-160822\n2015\n4\nB\nAuthorization of use of Coverage Enhancement\n14.2.0\n12/2016\nSA#74\nSP-160826\n2016\n4\nB\nIntroduction of PS Data Off feature\n14.2.0\n12/2016\nSA#74\nSP-160818\n2017\n2\nF\nS4-SGSN report for set of PRA\n14.2.0\n12/2016\nSA#74\nSP-160822\n2018\n1\nB\nInter-RAT idle mode mobility to and from NB-IoT\n14.2.0\n2017-03\nSA#75\nSP-170050\n2019\n1\nF\nSupport for restriction of Enhanced coverage restriction per RAT\n14.3.0\n2017-03\nSA#75\nSP-170050\n2021\n1\nF\nCorrections on restriction of use of Coverage Enhancement\n14.3.0\n2017-03\nSA#75\nSP-170050\n2022\n1\nF\nRestriction of use of Coverage Enhancement clarification for roaming UEs\n14.3.0\n2017-06\nSA#76\nSP-170370\n2023\n4\nF\nClarification for PGW/GGSN handling of IMS services at 3GPP PS Data Off activation\n14.4.0\n2017-06\nSA#76\nSP-170367\n2026\n3\nF\nHandling of emergency call numbers received from WLAN\n14.4.0\n2017-09\nSA#77\nSP-170719\n2028\n2\nF\nCorrections to Dataoff Support\n14.5.0\n2017-09\nSA#77\nSP-170729\n2029\n2\nB\n23.060 PCEF Support for Data Off phase 2\n15.0.0\n2017-12\nSA#78\nSP-170921\n2032\n-\nC\nClarification on MS behavior when receiving single list of Exempt Services - TS 23.060\n15.1.0\n2017-12\nSA#78\nSP-170915\n2034\n2\nA\nClarification on PS Data Off status reporting - TS 23.060\n15.1.0\n2018-03\nSA#79\nSP-180090\n2035\n1\nF\nUse of identifiers for mobility between GERAN/UTRAN and 5GS\n15.2.0\n2018-06\nSA#80\nSP-180472\n2037\n1\nA\n3GPP PS Data Off Clarification\n15.3.0\n2018-09\nSA#81\nSP-180729\n2038\n1\nF\nNegotiation of long periodic RAU timer value\n15.4.0\n2018-12\nSA#82\nSP-181079\n2040\n1\nA\nPS data off for non-IP data\n15.5.0\n2018-12\nSA#82\nSP-181080\n2044\n1\nA\nReporting PS Data Off status change when SM back off timer is running\n15.5.0\n2019-03\nSA#83\nSP-190175\n2045\n2\nF\nTS 23.060 update for Dual Connectivity with NR\n16.0.0\n2022-03\nSA#95E\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.7.1",
        "clause_13.2",
        "clause_6.12.1",
        "clause_6.12.2",
        "clause_6.13.1.2.1",
        "clause_6.13.2.2.1",
        "clause_12.7.4.1",
        "clause_9.3",
        "clause_5.3",
        "ts_23.078",
        "ts_29.303",
        "ts_23.003",
        "ts_29.281",
        "ts_33.210",
        "ts_11.0",
        "ts_12.0",
        "ts_13.1",
        "ts_23.401",
        "ts_13.3",
        "ts_13.4",
        "ts_23.060"
      ]
    }
  ]
}