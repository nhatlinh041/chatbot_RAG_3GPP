{
  "metadata": {
    "specification_id": "ts_23.236",
    "version": "18.0.0",
    "title": "3GPP TS 23.236",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23236-i00/23236-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:36:24.108575",
    "total_chunks": 46
  },
  "chunks": [
    {
      "chunk_id": "ts_23.236_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "This document covers the details for the Intra Domain Connection of RAN Nodes to Multiple CN Nodes for GERAN and UTRAN based systems. In particular, it details the impacts to GSM and UMTS systems and the stage 2 procedures for the support of connecting a RNC or BSC to multiple MSC servers or SGSNs. The overall solution is described, and the detailed impacts on the existing specifications are identified. The description of a broadly similar concept for E-UTRAN based systems is not described in the document: instead, it is described in TS 23.401 [22].\nNOTE:\tThe specified solution impacts RAN nodes. In case an upgrade of radio networks is not performed, the solutions for deploying NNSF functionality above RAN nodes described in TR 23.924 [23] may be used as a guideline for connecting RAN nodes to multiple MSC servers.\nThe reference model to which these procedures apply can be found within TS 23.002 [1]. Detailed architectural requirements within the subsystems are contained within the remainder of the 23 series of specifications e.g. the requirements for the Packet Switched (PS) domain are contained within TS 23.060 [2] and the requirements for the Bearer Independent CS Core Network are contained in TS 23.205 [14].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401",
        "ts_23.924",
        "ts_23.002",
        "ts_23.060",
        "ts_23.205"
      ]
    },
    {
      "chunk_id": "ts_23.236_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 23.002: \"Network Architecture\".\n[2]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS) Service description; Stage 2\".\n[3]\t3GPP TS 23.012: \"Location management procedures\".\n[5]\t3GPP TS 25.331: \"Radio Resource Control (RRC) Protocol Specification\".\n[6]\t3GPP TS 25.301: \"Radio interface protocol architecture\".\n[7]\t3GPP TS 25.303: \"UE functions and inter-layer procedures in connected mode\".\n[8]\t3GPP TR 21.905: \"3G Vocabulary\".\n[9]\t3GPP TS 25.413: \"UTRAN Iu interface RANAP signalling\".\n[10]\t3GPP TS 25.410: \"UTRAN Iu Interface: General Aspects and Principles\".\n[11]\t3GPP TS 23.228: \"IP Multimedia Subsystem – Stage 2\".\n[12]\t3GPP TS 43.051: \"GSM/EDGE Radio Access Network (GERAN) overall description (Stage 2)\".\n[13]\t3GPP TS 23.153: \"Out of Band Transcoder Control - Stage 2\".\n[14]\t3GPP TS 23.205: \"Bearer Independent CS Core Network – Stage 2\".\n[15]\t3GPP TR 25.931: \"UTRAN Functions, examples on signalling procedures\".\n[16]\tGSM 08.18: \"General Packet Radio Service (GPRS);Base Station System (BSS) -Serving GPRS Support Node (SGSN); BSS GPRS Protocol (BSSGP)\".\n[17]\t3GPP TS 48.008: \"Mobile-services Switching Centre - Base Station System (MSC - BSS) interface; Layer 3 specification\".\n[18]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[19]\t3GPP TS 43.068: \"Voice Group Call Service (VGCS); Stage 2\".\n[20]\t3GPP TS 43.069: \"Voice Broadcast Service (VBS); Stage 2\".\n[21]\t3GPP TS 23.251: \"Network Sharing; Architecture and functional description\".\n[22]\t3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".\n[23]\t3GPP TS 924: \"Feasibility Study on NAS Node Selection Function above BSC/RNC\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.002",
        "ts_23.060",
        "ts_23.012",
        "ts_25.331",
        "ts_25.301",
        "ts_25.303",
        "ts_21.905",
        "ts_25.413",
        "ts_25.410",
        "ts_23.228",
        "ts_43.051",
        "ts_23.153",
        "ts_23.205",
        "ts_25.931",
        "ts_48.008",
        "ts_23.003",
        "ts_43.068",
        "ts_43.069",
        "ts_23.251",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.236_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms defined in TR 21.905 [8] apply:\nCN node: for the purpose of this specification, and unless otherwise stated, a CN node is either an MSC or an SGSN.\nNAS node selection Function: The function used to assign specific network resources (i.e. MSC or SGSN) to serve a mobile station and subsequently route the traffic to the assigned network resource.\nNetwork Resource Identifier: A specific parameter used to identify the CN node assigned to serve a mobile station.\nNon-broadcast LAI/RAI: Each CN node in a pool have to be assigned one unique non-broadcast LAI/RAI that it use in case it want to be offloaded. Each CN node in the pool has to be aware of the non-broadcast LAI/RAI assigned to the other CN nodes in the pool, because in case of re-distribution the 'target CN node' will retrieve data (e.g. IMSI, security context, MM & PDP contexts) from the 'offloaded CN node' based on non-broadcast LAI/RAI.\nNull-NRI: A 'null-NRI' indicates to a radio node (BSC/RNC) that the NAS Node Selection Function shall be used for selecting a CN node to receive a message. There is one unique 'null-NRI' in a PLMN supporting pool functionality. In MOCN shared networks (see TS 23.251 [21]) with multiple CN Operators, there is one unique 'null-NRI' per CN operator. That is, in MOCN networks the RAN Operator handles multiple 'null-NRIs'.\nPool-area: A pool area is an area within which a MS may roam without need to change the serving CN node. A pool area is served by one or more CN nodes in parallel. All the cells controlled by a RNC or BSC belong to the same one (or more) pool area(s).\nRAN node: for the purpose of this specification, and unless otherwise stated, a RAN node is either an RNC or a BSC.\nRAN node service area: This area contains all the cells controlled by the RNC or BSC.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905",
        "ts_23.251"
      ]
    },
    {
      "chunk_id": "ts_23.236_3.2",
      "section_id": "3.2",
      "section_title": "Symbols",
      "content": "For the purposes of the present document, the following symbols apply:",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_3.3",
      "section_id": "3.3",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [8] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [8].\nAS\tAccess Stratum\nBSC\tBase Station Controller\nBVCI\tBSSGP Virtual Connection Identifier\nCN\tCore Network\nCS\tCircuit Switched\nCS-MGW\tCircuit Switched Media Gateway\nDCN\tDedicated Core Network\nDNS\tDirectory Name Server\nIDNNS\tIntra Domain NAS Node Selector\nLA\tLocation Area\nLAI\tLocation Area Identity\nMOCN\tMulti-Operator Core Network\nMS\tMobile Station\nMSC\tMobile Switching Centre\nNAS\tNon Access Stratum\nNRI\tNetwork Resource Identifier\nO&M\tOperation and Maintenance\nPS\tPacket Switched\nRA\tRouting Area\nRAI\tRouting Area Identity\nRAN\tRadio Access Network\nRNC\tRadio Network Controller\nSRNS\tServing Radio Network Subsystem\nTMSI\tTemporary Mobile Station Identity\nTLLI\tTemporary Logical Link Identifier\nUE\tUser Equipment",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.1",
      "section_id": "4.1",
      "section_title": "Iu Flex Technical Requirements",
      "content": "This provides a (non-exhaustive) set of technical requirements:\n1.\tIu Flex capable RAN nodes such as the RNC/BSC shall be able to select any CN node such as the SGSN/MSC-Server within a pool area\n2.\tIu Flex capable RAN nodes and CN nodes shall be able to co-exist with pre Release 5 RAN nodes and pre Release 5 CN nodes.\n3.\tThe network shall provide the CN node routing information to the UE and the UE shall store it.\n4.\tThe UE shall provide the routing information received from the serving CN node to the RAN node. In some cases, this serving CN node may be an Evolved Packet Core MME.\n5.\tThe solution shall enable the reduction of signalling within the core network (e.g. reduction of the HLR signalling traffic).\n6.\tThe solution shall enable an improved scaling between radio access nodes and the core network nodes.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_4.2",
      "section_id": "4.2",
      "section_title": "Overview",
      "content": "Editor's Note:\tClarification is required in order to remove RAN nodes and CN node terminology and to capture that this is referring to the control signalling aspects.\nThe Intra Domain Connection of RAN Nodes to Multiple CN Nodes overcomes the strict hierarchy, which restricts the connection of a RAN node to just one CN node. This restriction results from routing mechanisms in the RAN nodes which differentiate only between information to be sent to the PS or to the CS domain CN nodes and which do not differentiate between multiple CN nodes in each domain. The Intra Domain Connection of RAN Nodes to Multiple CN Nodes introduces a routing mechanism (and other related functionality), which enables the RAN nodes to route information to different CN nodes within the CS or PS domain, respectively.\nThe Intra Domain Connection of RAN Nodes to Multiple CN Nodes introduces further the concept of \"pool-areas\" which is enabled by the routing mechanism in the RAN nodes. A pool-area is comparable to an MSC or SGSN service area as a collection of one or more RAN node service areas. In difference to an MSC or SGSN service area a pool-area is served by multiple CN nodes (MSCs or SGSNs) in parallel which share the traffic of this area between each other. Furthermore, pool-areas may overlap which is not possible for MSC or SGSN service areas. From a RAN perspective a pool-area comprises all LA(s)/RA(s) of one or more RNC/BSC that are served by a certain group of CN nodes in parallel. One or more of the CN nodes in this group may in addition serve LAs/RAs outside this pool-area or may also serve other pool-areas. This group of CN nodes is also referred to as MSC pool or SGSN pool respectively.\nThe Intra Domain Connection of RAN Nodes to Multiple CN Nodes enables a few different application scenarios with certain characteristics. The service provision by multiple CN nodes within a pool-area enlarges the served area compared to the service area of one CN node. This results in reduced inter CN node updates, handovers and relocations and it reduces the HLR update traffic. The configuration of overlapping pool-areas allows to separate the overall traffic into different MS moving pattern, e.g. pool-areas where each covers a separate residential area and all the same city centre. Other advantages of multiple CN nodes in a pool-area are the possibility of capacity upgrades by additional CN nodes in the pool-area or the increased service availability as other CN nodes may provide services in case one CN node in the pool-area fails.\nAn MS is served by one dedicated CN node of a pool-area as long as it is in radio coverage of the pool-area. Figure 1 shows most of the possible pool-area configurations. It contains CS pool-area 1 (RAN area 1, 2, 5, 6 served by MSCs 1, 2, 3), CS pool-areas 2 (RAN area 2, 3, 6, 7 served by MSCs 4, 5, 6), PS pool-area 1 (RAN area 1, 5 served by SGSNs 1, 2) and PS pool-area 2 (RAN area 2, 3, 6, 7 served by SGSNs 3, 4, 5). In addition the RAN areas 4 and 8 are served by MSC 7 and SGSN 6 without any usage of the Intra Domain Connection of RAN Nodes to Multiple CN Nodes. The possibility to configure overlapping pool-areas is shown by the CS pool-areas 1 and 2. The PS pool-areas 1 and 2 are configured non-overlapping. The pool-areas of the CS and the PS domain may be configured identical as CS pool-area 2 and PS pool-area 2 or they may be configured differently as shown by CS pool-area 1 and PS pool-area 1. The number or capacity of CN nodes is configured independently for each pool-area. The usage of the Intra Domain Connection of RAN Nodes to Multiple CN Nodes may be configured in parts of the network only. It co-exists with other areas not using this feature as shown in the figure with RAN areas 4 and 8 which are served by MSC 7 and SGSN 6.\nFigure 1: Pool-area configuration example",
      "chunk_type": "definition",
      "cross_references": [
        "figure_1"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.3",
      "section_id": "4.3",
      "section_title": "Pool-Area and Network Resource Identification",
      "content": "A pool-area is an area within which an MS may roam without a need to change the serving CN node. A pool-area is served by one or more CN nodes in parallel. The complete service area of a RAN node (RNC or BSC) belongs to the same one or more pool-area(s). A RAN node service area may belong to multiple pool-areas, which is the case when multiple overlapping pool-areas include this RAN node service area. The pool-areas of the CS and of the PS domain are configured independently with the granularity of RAN node service areas. Therefore, all uniqueness statements below apply to each of the domains (CS/PS) separately. If LAs or RAs span over multiple RAN node service areas then all these RAN node service areas have to belong to the same pool-area.\nThe Network Resource Identifier (NRI) identifies uniquely an individual CN node out of all CN nodes, which serve in parallel a pool-area. The length of the NRI shall be the same in all nodes of a domain in one pool-area. In areas where pool-areas overlap the NRI identifies uniquely a CN node out of all CN nodes, which serve all these overlapping pool-areas, i.e. an NRI identifies uniquely a CN node within a RAN node. In case of overlapping pool-areas the NRI length shall be configured to be the same in all the nodes of a specific domain serving these pool-areas. Note again, that the NRIs of the CS and the PS domain are independent of each other as the PS and the CS domain CN nodes are addressed independently. More than one NRI may be assigned to a CN node.\nThe NRI is part of the temporary identity TMSI (CS domain) or P-TMSI (PS domain), which is assigned by the serving CN node to the MS. Each CN node which supports the \"Intra Domain Connection of RAN Nodes to Multiple CN Nodes\" is configured with its specific one or more NRI(s). The (P-)TMSI allocation mechanism in the CN node generates (P-)TMSIs which contain a configured NRI in the relevant bit positions. The NRI has a flexible length between 10 and 0 bits (0 bits means the NRI is not used and the feature is not applied).\nIn Iu mode the MS provides an Intra Domain NAS Node Selector (IDNNS) TS 25.331 [5] in the AS part of the RRC-Initial-direct-transfer message to the RAN node (RNC or BSC). The IDNNS contains a routing parameter with a fixed length of 10 bits. This routing parameter transports the NRI value. In addition the IDNNS contains an indication from which identity (TMSI, IMSI, IMEI, ...) the routing parameter is derived. The RAN node masks the significant bits out of the routing parameter part of the IDNNS to determine the NRI which is relevant to identify the CN node. The most significant bit of the NRI shall correspond with the most significant bit of the routing parameter in the IDNNS. When the IDNNS is derived from the IMSI, the IDNNS has a value (V) from the range 0 to 999 as defined in TS 25.331 [5]. The RAN node shall be configured to use the value (V) to select a CN node. Each value (V) corresponds a single CN node. Typically many values of (V) may point to the same CN node. In A/Gb mode.\nIn A/Gb-mode for the A interface the RAN node derives the NRI from any initial NAS signalling message. The RAN node masks the significant bits out of the TMSI to determine the NRI, which identifies the CN node. In A/Gb-mode for the Gb interface the RAN node derives the NRI from the TLLI. The RAN node masks the significant bits out of the TLLI to determine the NRI, which identifies the CN node.\nFor all three cases, Iu, A interface and Gb mode, it is configured in the RAN node which bits out of the information elements provided by the MS are significant for the NRI The NRI is coded in bits 23 to 14 of TMSI or P-TMSI. Regardless of the NRI length the most significant bit of the NRI is always in bit 23 of TMSI or P-TMSI(examples of NRI position are given in annex A.2), see also TS 23.003 [18].\nThe whole network may be configured as one pool-area, a network may configure multiple pool-areas and the configuration of pool-areas may be combined with MSC or SGSN service areas which are not belonging to pool-areas. The change of a pool-area is not visible to the MS. In general there is no need to detect a pool-area change. It may be advantageous for load balancing purposes to detect pool-area changes in the network to distribute MSs entering a pool-area to CN nodes with an appropriate load status. MSs changing a pool-area may be detected by configuration of different NRI values for adjacent pool-areas. The pool-area change information potentially provided in the IDNNS by an MS in Iu mode is ignored by the network.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.4",
      "section_id": "4.4",
      "section_title": "NAS Node Selection Function",
      "content": "This function is used in RAN nodes and potentially in CN nodes. In the RAN node the function selects the specific CN node (i.e. MSC or SGSN) to which initial NAS signalling messages or LLC frames are routed. The NRI identifies the specific CN node. If the NAS Node Selection Function has a CN node address configured for the NRI derived from the initial NAS signalling message or from the LLC frame then this message or frame is routed to this address. If no CN node address is configured for the derived NRI or if no NRI can be derived (e.g. the MS indicated an identity which contains no NRI) then the NAS Node Selection Function selects an available CN node (e.g. according to load balancing) and routes the message or LLC frame to the selected CN node.\nThe pool-area has no influence on the decisions of the NAS Node Selection Function as pool-areas may overlap. The NAS Node Selection Function in the RAN node derives the NRI from the IDNNS when the MS is supported in Iu mode. When the MS is supported in Gb mode the NRI is derived from the TLLI and for A interface mode the NRI is derived from the TMSI.\nNOTE:\tA routing-area update after SRNS relocation is not an initial NAS signalling message, thus it is routed along the existing Iu-connection to the SGSN.\nIn A/Gb mode in case a MSC/VLR sends a paging-request/paging with IMSI (i.e. the paging message does not contain a TMSI), the NAS node selection function in the BSC shall upon reception temporarily store the Global-CN- ID of the node that issued the paging-request/paging message. If the NAS node selection function in A/Gb mode receives a paging-response with an IMSI then it should check the temporarily stored Global-CN-ID on entries matching this IMSI and forward the paging-response to the node identified by this Global-CN-ID.\nIn Iu mode in case a MSC/VLR sends a paging-request/paging with IMSI (i.e. the paging message does not contain a TMSI), the NAS node selection function in the BSC/RNC may upon reception temporarily store the Global-CN-ID of the node that issued the paging-request/paging message. If the NAS node selection function in Iu mode receives an Initial Direct Transfer message with an IDNNS derived from IMSI as a result of IMSI paging:\n-\tand if BSC/RNC has temporarily stored the Global-CN-ID then it should check the temporarily stored Global-CN-ID on entries matching this IDNNS and forward the paging-response to the node identified by this Global-CN-ID or\n-\tthe BSC/RNC shall use the IDNNS derived from IMSI to select a CN node. In this case the IDNNS has a value (V) from the range 0 to 999 as defined in TS 25.331 [5]. The RAN node shall be configured to use the value (V) to select a CN node. Each value (V) corresponds a single CN node. Typically many values of (V) may point to the same CN node.\nIn UMTS, an MS answering a paging with IMSI includes in its response an IDNNS derived from its TMSI, if the MS has a valid TMSI. Temporarily storing the IMSI in the RNC increases the success rate to reach the MS that have both lost their TMSI and are paged with IMSI. In GSM, an MS paged with IMSI always answers with IMSI.\nIf the MSC/VLR initiates the paging procedure via Gs-interface the SGSN has to add the MSC/VLR-identity to the paging-request/paging message.\nAn MS will return an Attach Request containing the IMSI parameter as a response to a PS IMSI paging. Also, a PS IMSI paging is not time supervised from the SGSN sending the message. Therefore the RAN node receiving such a paging request does not have to buffer the associated SGSN identity. This again means that the NAS Node Selection Function in the RAN node selects an available SGSN (e.g. according to load balancing) when it receives an Attach Request containing the IMSI parameter.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.5",
      "section_id": "4.5",
      "section_title": "Load Balancing",
      "content": "Preferably, the NAS Node Selection Function in the RAN node balances the load between the available CN nodes. This is performed by an appropriate selection of the CN node for an MS which was not yet assigned to a CN node, i.e. when there is no CN node configured for the NRI indicated by the MS, when a 'random TLLI' is received (Gb-mode BSC), when no NRI can be derived or in exceptional cases, e.g. when the CN node corresponding to an NRI cannot be reached.\nThe load-balancing algorithm is implementation specific.\nWhen the NAS Node Selection Function in the RAN (or, if using Network Mode of Operation I, the SGSN) receives an indication that the MS is configured for low access priority (e.g. because it is used for Machine Type Communication), the NAS Node Selection Function may take this indication into account when selecting the CN node (e.g. to select an MSC that has a particularly large VLR capacity or an SGSN that is optimized to handle UEs configured for low access priority).\nIn case of handover/relocation into a pool-area a load balancing between all the target CN nodes serving this pool-area is gained by configuration. Source CN nodes which support Intra Domain Connection of RAN Nodes to Multiple CN Nodes may be configured with all possible target CN nodes for each handover/relocation target. Source CN nodes which do not support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes can configure only one target CN node per handover/relocation target. In this case each of source CN nodes which handover/relocate to the same pool-area may be configured with another target CN node out of all target CN nodes serving the same handover/relocation target. The mechanism for distribution of the traffic between the handover/relocation target CN nodes is implementation specific. This load balancing is complemented by the NAS Node selection Function in the RAN, which distributes MSs between the CN nodes when these MSs enter the pool-area in idle mode.\nAs more than one SGSN may send downlink data at the same time for a cell or a BVCI the total possible downlink traffic has to shared between the SGSNs as described in clause 5.3.2.\nWhen dedicated core networks (DCNs) are used, load balancing by RNC/BSC is only performed between SGSNs that belong to the same DCN within the same SGSN pool area. Load balancing may also be performed per DCN in the case of an SGSN serving multiple DCNs when one DCN is supported by multiple SGSNs. The DCN Load Balancing functionality permits UEs that are entering into a pool area and being re-directed to an appropriate DCN to be distributed in a manner that achieves load balancing between the core network nodes of the same DCN within the same SGSN pool area. An example of NRI configuration that can achieve this is when DCNs are used is provided in clause A.3.\nIn case of CS domain subsequent handover/relocation, if the controlling MSC supports Intra Domain Connection of RAN Nodes to Multiple CN Nodes then it should check the target indicated by the serving MSC. If it is in its own pool area then the handover/relocation is handled as one back to the controlling MSC (the target MSC indicated by the serving MSC is not taken into account). If the target location is not in its own pool area then the target MSC indicated by the serving MSC is taken into account as normal (handover/relocation to a third MSC).\nIf the controlling (anchor) MSC is not in the same pool as target third MSC and if the controlling MSC does not support Intra Domain Connection of RAN Nodes to Multiple CN nodes, because the serving MSC can select any third MSC in the target pool area, the operator should configure the addresses of all possible third MSCs within the controlling MSC.\n4.5a\tLoad Re-Distribution\n4.5a.1\tGeneral\nThere are situations where a network operator will wish to remove load from one CN node in an orderly manner (e.g. to perform scheduled maintenance, or, to perform load re-distribution to avoid overload) with minimal impact to end users and/or additional load on other entities. The re-distribution procedure does not require any new functionality in the terminal, that is, all terminals can be moved.\nRe-distribution of UEs is initiated via an O&M command in the CN node, which needs to be off-loaded. In a first phase (a couple of Periodic LU/RAU periods long), UEs doing LU/RAU or Attach are moved to other CN nodes in the pool. When the CN node receives the Location Update, Routing Area Update or Attach request, it returns a new TMSI/P-TMSI with a null-NRI, and a non-broadcast LAI/RAI in the accept message.\nIn CS domain the non-broadcast LAI will cause the terminal to immediately send a new Location Update, which the RAN node then will route to a new MSC due to the null-NRI. In the PS domain, a new Routing Area Update is triggered by setting the periodic routing area update timer to a sufficiently low value (recommended value is 4 seconds) in the accept message. The UE will shortly after send a new Routing Area Update that the RAN node then will route to a new SGSN due to the presence of a null-NRI.\nIn a second phase (PS domain specific), the SGSN requests all UEs trying to set up PDP Contexts to detach & reattach. When they reattach, the SGSN moves them as in the first phase described above.\nA third phase includes scanning through remaining UEs and initiating a move of them to other CN nodes. In the PS domain UEs are requested to detach and reattach, which will cause them to be moved. In case of CS domain a new TMSI is allocated to these UEs using the TMSI re-allocation procedure (with null-NRI and non-broadcast LAI) so that a Location Update is triggered when the ongoing CM transaction ends, which will cause them to be moved.\nUEs being moved from one CN node are stopped from registering to the same CN node again by an O&M command in BSCs and RNCs connected to the pool. UEs moving into a pool area may also be stopped from registering into a CN node being off-loaded in the same manner.\nIn network configurations using MOCN network sharing, re-distribution is always done between CN nodes within the same CN Operator. This is ensured by each CN Operator using his own unique null-NRI. The RAN node is preconfigured with the null-NRIs for the different CN Operators, and it uses the null-NRI to select a CN node within the same CN Operator.\nWhen dedicated core networks (DCNs) are used, re-distribution of UEs is always done to core network nodes of the same DCN as the node being off-loaded. The details are as follows:\n-\tIf null-NRI is used to identify the group of SGSNs that belong to a DCN within a PLMN (see TS 23.401 [22], clause 4.3.25), then the procedure stated in the clause above may be used. The null-NRI corresponds to the DCN of the node being off-loaded.\n-\tIf either \"SGSN group ID\" or null-NRI is used to identify the group of SGSNs that belong to a DCN within a PLMN, then the following procedure may instead be used:\n-\tTo off-load UEs in PMM-IDLE/STANDBY state that perform RAU Updates or Attaches, the SGSN uses the NAS Message Redirection Procedure (see TS 23.401 [22], clause 5.19.1) to redirect the UE to another SGSN within the same DCN. To off-load UEs in PMM-IDLE/STANDBY state without waiting for the UE to perform a RAU procedure, the SGSN first pages the UE to bring it to PMM-CONNECTED/READY state and then proceeds as below.\n-\tTo off-load UEs in PMM-CONNECTED/READY state, the SGSN first performs P-TMSI reallocation procedure, includes the UEs unchanged P-TMSI and a non-broadcast RAI, and sets the periodic routing area update timer to a sufficiently low value (recommended value is 4 seconds) and forces the UE to change state to PMM-IDLE/STANDBY state. The UE shortly performs a RAU procedure, during which the SGSN uses the NAS Message Redirection Procedure (see TS 23.401 [22] clause 5.19.1) to redirect the UE to another SGSN within the same dedicated CN.\nA CN node should ensure that move operations does not overload the network. BSCs and RNCs shall be able to handle situations where several CN nodes are off-loaded simultaneously.\n4.5a.2\tNetwork Mode of Operation = 1\nIf an operator is using Network Mode of Operation = 1 (i.e. using combined MM and GMM procedures and the Gs interface), then redistribution of MSC load needs to be handled in a special way.\nRedistribution of UEs is initiated by O&M command in the SGSN providing the Gs interface to the MSC to be off-loaded. The corresponding NRI distribution or IMSI Hash table is reconfigured to reflect the redistribution. If the SGSNs are also configured in a pool, this is repeated for any SGSN connected to that MSC. The NRI distribution or IMSI Hash table shall have a consistent configuration in all SGSNs in the pool (to ensure that a redistribution of SGSN load doesn't affect the MSC registration of UEs).\nThe redistribution is done in two phases. During the first phase, the UEs that are performing combined RA/LA updates are moved to a new MSC. When the SGSN receives a Routing Area Update Request (combined RA/LA updating), it checks if the particular UE shall be moved (i.e. it has a Gs association with the MSC being off-loaded). If the UE shall be moved, the SGSN invokes the MSC selection function (NRI distribution or IMSI Hash) to decide where the UE should be distributed. SGSN sends the (BSSAP+) Location-Update-Request (IMSI attach) to the new selected MSC where the UE is registered. Stationary UEs (i.e. UEs not performing RA/LA updates) are not moved during this first phase.\nDuring the second phase, the SGSN scans its Gs associations to find out which UEs shall be moved. For each UE with an association to the MSC being off-loaded, the SGSN sends a Detach Request (indicating IMSI detach). The UE is forced to re-attach to non-GPRS service (note that there is no impact on PDP contexts in this case). The UE sends a RAU request (combined RA/LA updating with IMSI Attach). SGSN checks if the UE shall be moved. If the UE shall be moved, the SGSN invokes the MSC selection function (NRI distribution or IMSI Hash) to select another MSC. SGSN sends the (BSSAP+) Location-Update-Request (IMSI attach) to the new MSC where the UE is registered.\nDuring the redistribution, incoming IMSI Detach messages are (as during normal operation) routed to respective existing associated MSC. That is, the reconfigured NRI distribution or IMSI Hash doesn't affect the routing of IMSI Detach messages.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.2",
        "ts_23.401_clause_4.3.25",
        "ts_23.401_clause_5.19.1",
        "ts_23.401"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.6",
      "section_id": "4.6",
      "section_title": "Mobility Management",
      "content": "An MS performs LA or RA Updates and Attachments, which may result in a change of the serving CN node. In these procedures the new CN node requests from the old CN node MS specific parameters. If multiple CN nodes are configured in the new CN node for the old RA or LA indicated by the MS then the new CN node derives the NRI from the old (P-)TMSI indicated by the MS. The new CN node uses the old RA or LA together with the NRI to derive the signalling address of the old CN node from its configuration data. If the network contains nodes that cannot derive the old CN node from LAI/RAI and NRI a default CN node for each RA or LA (as described below) shall be used to resolve the ambiguity of the multiple CN nodes serving the same area.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_4.7",
      "section_id": "4.7",
      "section_title": "Default CN node and Backwards Compatibility",
      "content": "CN nodes that can only derive one CN node from the LAI or RAI (e.g. because they do not support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes, or no detailed knowledge of the NRIs is configured) are not aware, that multiple CN nodes may serve a LA or RA. These nodes can therefore contact only one CN node per LA or RA, respectively. This node will further on be referred to as default node.\nA default node resolves the ambiguity of the multiple CN nodes per LA or RA by deriving the NRI from the TMSI and P-TMSI. The default node relays the signalling between the new CN node and the old CN node.\nNote that the default node is configured per LA or RA. So different CN nodes in a network might have configured different default nodes for a LA or RA. With this approach more than one of the CN nodes that serve a pool-area can be used as default-node, so load concentration on one node and a single point of failure can be avoided.\nNote further, that it may be required to keep information on ongoing MAP/GTP dialogues in the default nodes.\nThe handover/relocation from CN nodes which do support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes to CN nodes not supporting this features does not need a NAS Node Selection Function in the originating CN node as there is only one target CN node. The originating CN node discovers from its configuration data, that there is only one target CN node for the requested handover/relocation target ID. See clause 4.5 for handling of subsequent handover/relocation in the controlling CN node.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.5"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.8.1",
      "section_id": "4.8.1",
      "section_title": "Attach",
      "content": "In case of 'combined GPRS/IMSI attach' or 'GPRS attach when already IMSI attached', the SGSN sends the Location Update Request message to the MSC/VLR. The SGSN selects an MSC/VLR from the available MSC/VLRs which serve the current LA of the MS. The selection is based on the TMSI based NRI as provided by the UE or a hash value derived from the IMSI. It is configured in the SGSN which NRI values and range of the hash values relates to which MSC/VLR. This selection mechanism avoids a random change of the MSC/VLR for MSs using combined procedures when an SGSN fails. The new SGSN will select the same MSC/VLR.\nIn some networks, the SGSN may be configured to select the MSC/VLR for \"MSs configured for low access priority\" with a different load balance to that used for MSC/VLR selection for other UEs. In this case the SGSN maintains a separate NRI and hash value function for \"MSs configured for low access priority\".",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_4.8.2",
      "section_id": "4.8.2",
      "section_title": "Routing area update",
      "content": "The CN node changes in the following considerations result from pool-area changes (when pool-areas are configured) or from CN node service area changes (when no pool-areas are configured). For each domain (PS or CS) it is configured independently whether pool-areas are used or not.\nWhen neither the MSC nor the SGSN are changed, the association for an MS between both CN nodes will also not change.\nWhen the MSC changes but the SGSN does not change, the SGSN selects a new MSC because the new LA is not served by the old MSC/VLR. The selection mechanism is as described for the attach above.\nWhen the SGSN changes but the MSC does not change, the new SGSN selects the old MSC to establish a Gs association because the new SGSN uses the same selection mechanism as described above for the attach with the same parameters as configured in the old SGSN.\nWhen both the MSC and the SGSN change, the new SGSN selects a new MSC to establish a Gs association. The selection mechanism is as described for the attach above.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_4.9",
      "section_id": "4.9",
      "section_title": "VGCS/VBS Compatibility Issues",
      "content": "Voice Group Call Services, TS 43.068 [19], as well as Voice Broadcast Service, TS 43.069 [20], are specified for A-interface only. Architectural enhancements and procedures needed to support these services in an area where Intra Domain Connection of RAN Nodes to Multiple CN Nodes is applied on the A-interface are specified in TS 43.068 [19] and TS 43.069 [20].",
      "chunk_type": "general",
      "cross_references": [
        "ts_43.068",
        "ts_43.069"
      ]
    },
    {
      "chunk_id": "ts_23.236_4.10",
      "section_id": "4.10",
      "section_title": "Interactions with E-UTRAN",
      "content": "The MS has separate core network temporary identities for GERAN/UTRAN (the RAI plus P‑TMSI in the packet domain) and E‑UTRAN (the GUTI).\nFollowing movement between GERAN/UTRAN and E‑UTRAN the MS will have both a P‑TMSI and a GUTI. Independent of whether the Idle mode Signalling Reduction (ISR) feature is active, one or both of the P‑TMSI and GUTI may be valid. If the MS is E UTRAN capable, then TS 23.401 [22], TS 23.060 [2] and TS 23.003 [18] define rules as to how the MS shall select and encode the identity to place in the P‑TMSI/TLLI parameters used in the Routing Area Update procedure.\nNOTE:\tISR is specified and described in TS 23.401 [22].\nIn some network deployments the MME and SGSN may be combined in the same physical platform (while in other deployments they may be separated).\nTS 23.003 [18] specifies a mapping from the E‑UTRAN core network temporary identity (the GUTI) to the TLLI that facilitates the BSC to route an RA update caused by movement from E‑UTRAN to GERAN to an SGSN that is on the same physical platform as the MME.\nTS 23.003 [18] and TS 25.331 [5] specify a mapping from the E‑UTRAN core network temporary identity (the GUTI) to the IDNNS that facilitates the RNC to route an RA update caused by movement from E‑UTRAN to UTRAN to an SGSN that is on the same physical platform as the MME.\nTS 23.003 [18] also specifies a mapping from the RAI and P‑TMSI to the GUTI that facilitates the E‑UTRAN to route to an MME that is on the same physical platform as the SGSN. For this mapping function to work correctly when using combined MME/SGSNs, the effective maximum length of the NRI is reduced from 10 bits to 8 bits.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.401",
        "ts_23.060",
        "ts_23.003",
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.236_5.1",
      "section_id": "5.1",
      "section_title": "MS Functions",
      "content": "In Iu mode the MS provides the IDNNS to the RNC in the access stratum part of the RRC_initial_DT message as described in TS 25.331 [5].\nIf the MS is E‑UTRAN capable, then TS 23.401 [22], TS 23.060 [2] and TS 23.003 [18] define rules as to how the MS shall select and encode the identity to place in the P‑TMSI/TLLI parameters used in the Routing Area Update procedure. For the PS domain, the E‑UTRAN capable MS shall use this P‑TMSI parameter to derive the UTRAN IDNNS parameter. For the CS domain, the E‑UTRAN temporary identities shall not be used to derive the IDNNS: instead the MS shall use its (MSC supplied) TMSI, if that TMSI is valid, to derive the IDNNS.\nNOTE:\tmovement of an E‑UTRAN capable MS between GERAN/UTRAN and E‑UTRAN accesses does not cause the TMSI to be marked as invalid or deleted.\nWhen the MS in Iu mode replies to IMSI paging, it shall derive IDNNS from (P)TMSI if a valid one is available. If (P)TMSI is not available, the MS shall derive IDNNS from IMSI.\nNo further changes are expected in the MS for Gb or A interface mode.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331",
        "ts_23.401",
        "ts_23.060",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_23.236_5.2",
      "section_id": "5.2",
      "section_title": "RNC Functions",
      "content": "The RNC provides the NAS Node Selection Function. It masks the significant number of bits out of the IDNNS provided by the MS together with the initial NAS signalling message. The significant number of bits is configured in the RNC. The NAS Node Selection Function derives from the NRI the address of the specific CN node for the relevant domain (CS or PS). The association between NRI values and CN node addresses is configured in the RNC (O&M).\nThe RNC routes the initial NAS signalling messages according to the NRI and the \"domain indicator\" (CS or PS) to the relevant CN node if a CN node address is configured in the RNC for the specific NRI and the requested domain (CS or PS).\nWhen IDNNS is derived from the IMSI, the IDNNS has a value (V) from the range 0 to 999 as defined in TS 25.331 [5]. The RAN node shall be configured to use the value (V) to select a CN node. Each value (V) corresponds a single CN node. Typically many values of (V) may point to the same CN node. In some networks, the RAN node may be configured to select the MSC/VLR or SGSN for \"UEs configured for low access priority\" with a different load balance to that used for MSC/VLR or SGSN selection for other UEs. In this case the RAN node maintains a second, separate mapping table between value (V) and CN node for \"UEs configured for low access priority\".\nIf the selected CN node is not available or if no CN node address is configured in the RNC for the requested NRI or if the provided identity contains no NRI then the RNC routes the initial NAS signalling message to a CN node selected from the available CN nodes which serve the related domain (CS or PS). The selection mechanism is implementation dependent and should enable load balancing between the available CN nodes. In some networks, the RNC may be configured to select the MSC/VLR or SGSN for \"UEs configured for low access priority\" with a different load balance to that used for MSC/VLR or SGSN selection for other UEs.\nNOTE 1:\tA routing-area update after SRNS relocation is not an initial NAS signalling message, thus it is routed along the existing Iu-connection to the SGSN.\nNOTE 2:\tThe RAN can determine whether or not the \"MS is configured for low access priority\" from information received in the RRC establishment signalling.\nIn case a MSC sends a paging with IMSI (i.e. the paging message does not contain a TMSI), the RNC may, for purposes to increase the paging success rate, upon reception temporarily store the Global-CN-ID of the node that issued the paging message. If the MSC/VLR initiates the paging procedure via Gs-interface the SGSN has to add the Global-CN-ID to the paging message.",
      "chunk_type": "general",
      "cross_references": [
        "ts_25.331"
      ]
    },
    {
      "chunk_id": "ts_23.236_5.2.1",
      "section_id": "5.2.1",
      "section_title": "Load Re-Distribution function in RNC",
      "content": "When the RNC receives a message with a 'null-NRI' it uses the NAS Node Selection Function for selecting a CN node where to forward the message. CN node(s) with re-distribution in progress should be excluded from the NAS Node Selection algorithm in the RNC. This is done by O&M configuration in the RNC.\nIn network configurations using MOCN network sharing, the RNC is preconfigured with a null-NRI for each CN Operator in the MOCN. The RNC selects a CN node belonging to a CN Operator based on what 'null-NRI' is received.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.3.1",
      "section_id": "5.3.1",
      "section_title": "A interface mode",
      "content": "The BSC provides the NAS Node Selection Function. It is aware whenever a new RR connection is established. In particular, the BSC always examines the content of the Initial Layer 3 message sent by the MS in order to determine the position of the MS Classmark and to extract its contents. The examination of the Initial Layer 3 message content allows the BSC to observe the TMSI+LAI or IMSI or IMEI.\nThe BSC derives from Initial Layer 3 messages the NRI from the TMSI. It is configured in the BSC (O&M) which bits of the TMSI are significant for the NRI. The BSC routes the Initial Layer 3 message according to the NRI to the relevant MSC if an MSC address is configured in the BSC for the specific NRI. The association between NRI values and MSC addresses is configured in the BSC (O&M).\nIf no MSC address is configured in the BSC for the requested NRI, or if no TMSI is sent by the MS (e.g. an IMSI or IMEI), then the BSC routes the initial NAS signalling message to an MSC selected from the available MSCs. In addition, the BSC may route the initial NAS signalling message to an MSC selected from the available MSCs if this message is a Location Update Request messages and the PLMN ID in the LAI is not one of the PLMN IDs served by the BSC (FFS). The selection mechanism is implementation dependent and should enable load balancing between the available MSCs. In some networks, the BSC may be configured to select the MSC/VLR for \"MSs configured for low access priority\" with a different load balance to that used for MSC/VLR selection for other MSs.\nNOTE:\tThe BSC can determine whether or not the \"MS is configured for low access priority\" from information contained in the Initial Layer 3 message. Using a different load balance for \"MSs configured for low access priority\" might be useful if some MSCs have a particularly large VLR capacity compared to their relative processing power.\nIn case a MSC sends a paging-request with IMSI, the NAS node selection function in the BSC shall upon reception temporarily store the MSC/VLR-identity of the node that issued the paging-request message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.3.2",
      "section_id": "5.3.2",
      "section_title": "Gb mode",
      "content": "The BSC provides the NAS Node Selection Function. The MS sends the TLLI to the BSC. The NRI is part of the P-TMSI and therefore also contained in the 'local TLLI' or in the 'foreign TLLI'. The number of bits out of the TLLI which are significant for the NRI is configured in the BSC (O&M).\nA 'local TLLI' indicates to the BSC that the TLLI is derived from a P-TMSI which was assigned for the current RA, i.e. the 'local TLLI' contains an NRI which is valid for routing to an SGSN. A 'foreign TLLI' indicates to the BSC that the TLLI is derived from a P-TMSI which was assigned for another RA than the current RA. The BSC does not know whether the other RA and therefore the related P-TMSI belongs to the same pool-area or not unless this is configured in the BSC (which is not intended). Consequently, the BSC assumes, that the 'foreign TLLI' contains a NRI which is valid for routing to an SGSN.\nFor 'local TLLIs' and for 'foreign TLLIs' the BSC masks the NRI out of the TLLI. The BSC routes the uplink LLC frame to the relevant SGSN if an SGSN address is configured in the BSC for the specific NRI. The association between NRI values and SGSN addresses is configured in the BSC (O&M).\nIf no SGSN address is configured in the BSC for the requested NRI, which may happen for NRIs masked out of a 'foreign TLLI', or if the BSC received a 'random TLLI' which contains no NRI at all then the RNC routes the uplink LLC frame to an SGSN selected from the available SGSNs. The selection mechanism is implementation dependent and should enable load balancing between the available SGSNs. In some networks, the BSC may be configured to select the SGSN for \"MSs configured for low access priority\" with a different load balance to that used for SGSN selection for other MSs. In this case, until TLLI re-allocation occurs, the BSC shall remember which TLLIs are from \"MSs configured for low access priority\" and which are not.\nNOTE 1:\tFor the selection mechanism in the BSC it is probably sufficient, that the algorithm is 'slow moving'. If the selection algorithm changes the SGSN to be assigned for 'random TLLIs' or for 'foreign TLLIs' whose NRI value is not used in the current SGSN pool area during a MS's Attach procedure or RA update procedure, then the Attach procedure or RA update procedure is likely to fail, but the MS will reattempt the procedure at T3310/T3330 expiry (=15 seconds).\nNOTE 2:\tThe BSC can determine whether or not the \"MS is configured for low access priorityC\" from information contained in the RR Channel Request message.\nNOTE 3:\tWhen performing special SGSN selection for \"MSs configured for low access priority\", it is necessary to ensure that all the Mobility Management signalling for that MS is routed to that special SGSN and not routed to any other SGSN. Hence the requirement for the BSC to remember the \"TLLI to SGSN\" relationship until the new SGSN has reallocated the TLLI.\nAs more than one SGSN may send downlink data at the same time for a cell or a BVCI, the BSC has to share the total possible downlink traffic between the SGSNs that can access a cell. The BSC should use the existing flow control procedure on cell level to control each of the SGSNs in a way not to violate the total possible traffic for the cell. How the BSC decides to share the downlink traffic between each of the SGSNs is an implementation specific issue; e.g. the possible downlink traffic can be equally shared between the SGSNs, or the share of each SGSN can be proportional to the capacity of the SGSN. In case a MSC sends a paging-request with IMSI via Gs-interface the SGSN has to add the MSC/VLR-identity to the paging-request message. The NAS node selection function in the BSC/RNC shall upon reception temporarily store the MSC/VLR-identity.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.3.3",
      "section_id": "5.3.3",
      "section_title": "Iu mode",
      "content": "To support MSs in Iu mode the BSC provides the same functionality as described under \"RNC Functions\".",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.3.4",
      "section_id": "5.3.4",
      "section_title": "Load Re-Distribution function in BSC",
      "content": "When the BSC receives a message with a 'null-NRI' it uses the NAS Node Selection Function for selecting a CN node where to forward the message. This is also done for all messages with 'random TLLIs' (Gb-mode). CN node(s) with re-distribution in progress should be excluded from the NAS Node Selection algorithm in the BSC. This is done by O&M configuration in the BSC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.4.1",
      "section_id": "5.4.1",
      "section_title": "TMSI Allocation",
      "content": "Every MSC is configured with its one or more specific NRI (O&M). One of these specific NRIs is part of every temporary identity (TMSI) which the MSC assigns to an MS. The TMSI allocation mechanism in the MSC generates TMSIs which contain one of the specific NRIs in the relevant bit positions. An NRI has a flexible length between 10 and 0 bits (0 bits means the NRI is not used and the feature is not applied). The use of the bits not used to encode the NRI is implementation dependent (e.g. to extent the TMSI space). An MSC applying \"Intra Domain Connection of RAN nodes to multiple CN nodes\" shall allocate TMSIs to the served MSs.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.4.2",
      "section_id": "5.4.2",
      "section_title": "Mobility Management and Handover/Relocation",
      "content": "For MAP signalling between two MSCs which both support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes the new MSC derives the address of the old MSC from the old LAI and the NRI contained in the old TMSI. The MSC addresses for each LAI and NRI combination are configured in the MSC (O&M). If the network contains MSCs that cannot derive the old MSC from LAI and NRI the default MSC per LAI as described below shall be used (e.g. to reduce the configuration effort). Some redundancy may be required as the default MSC is a single point of failure.\nThe load balancing between multiple target MSCs at handover/relocation into a pool area is described in \"4.5\tLoad Balancing\". The handover/relocation from an MSC that supports the Intra Domain Connection of RAN Nodes to Multiple CN Nodes to an MSC not supporting the feature needs no new functionality, as there is only one MSC that serves the handover/relocation target.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.4.3",
      "section_id": "5.4.3",
      "section_title": "Backward Compatibility and Default MSC",
      "content": "If a default MSC that is serving a pool-area receives MAP signalling (e.g. to fetch the IMSI or to get unused cipher parameters) it has to resolve the ambiguity of the multiple MSCs per LAI by deriving the NRI from the TMSI. The MSC relays the MAP signalling to the old MSC identified by the NRI in the old TMSI unless the default MSC itself is the old MSC. For every NRI value that is used in the pool-area an MSC address is configured in the default MSC (O&M).\nNOTE:\tIt might be required to keep information on ongoing MAP dialogues in the default MSC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.4.4",
      "section_id": "5.4.4",
      "section_title": "Support of Combined Procedures",
      "content": "If the SGSN does not support the Intra Domain Connection of RAN Nodes to Multiple CN Nodes then only one default out of the MSCs serving the related LA can be used for the combined procedures. A relaying or diverting from the default MSC to another is FFS. Distributing the associations of the combined procedures according to the LAs would result in MSC changes when the MS is still in the old MSC service area.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.4.5",
      "section_id": "5.4.5",
      "section_title": "Load Re-Distribution function in MSC",
      "content": "The MSC needs to ensure that the RR-connection is released immediately after the Location Update response message is returned to the UE, i.e. the follow-on proceed flag shall be cleared.\nFor the special case when an MSC in a pool also serves a BSC or RNC that is not part of the pool (e.g. a BSC or RNC that does not support pool functionality), an MSC should not try to re-distribute UEs connected to that BSC or RNC.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.1",
      "section_id": "5.5.1",
      "section_title": "P-TMSI Allocation",
      "content": "Every SGSN is configured with its specific one or more NRI (O&M). One of these specific NRIs is part of every temporary identity (P-TMSI) which the SGSN assigns to an MS. The P-TMSI allocation mechanism in the SGSN generates P-TMSIs which contain one of the specific NRIs in the relevant bit positions. An NRI has a flexible length between 10 and 0 bits (0 bits means the NRI is not used and the feature is not applied). The use of the bits not used to encode the NRI is implementation dependent (e.g. to extent the TMSI space). An SGSN applying \"Intra Domain Connection of RAN nodes to multiple CN nodes\" shall allocate P-TMSIs to the served MSs.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.2",
      "section_id": "5.5.2",
      "section_title": "Mobility Management and Handover/Relocation",
      "content": "For the GTP signalling between two SGSNs supporting the Intra Domain Connection of RAN Nodes to Multiple CN Nodes the new SGSN derives the address of the old SGSN from the old RAI and the NRI contained in the old P-TMSI/TLLI. The SGSN addresses are configured in the SGSN (O&M) or in DNS for each RAI and NRI combination. If the network contains SGSNs that cannot derive the old SGSN from RAI and NRI the default SGSN per RAI as described below shall be used (e.g. to reduce the configuration effort).\nThe load balancing between multiple target SGSNs at handover/relocation into a pool area is described in \"4.5: Load Balancing\". The handover/relocation from an SGSN that supports the Intra Domain Connection of RAN Nodes to Multiple CN Nodes to an SGSN not supporting the feature needs no new functionality, as there is only one SGSN that serves the handover/relocation target.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.3",
      "section_id": "5.5.3",
      "section_title": "Backward Compatibility and Default SGSN",
      "content": "If a default SGSN that is serving a pool-area receives GTP signalling (e.g. to fetch the IMSI or to get unused cipher parameters) it has to resolve the ambiguity of the multiple SGSNs per RAI by deriving the NRI from the P-TMSI. The SGSN relays the GTP signalling to the old SGSN identified by the NRI in the old P-TMSI unless the default SGSN itself is the old SGSN. For every NRI value that is used in the pool-area an SGSN address is configured in the relaying SGSN (O&M) or in DNS.\nNOTE:\tIt might be required to keep information on ongoing GTP dialogues in the default SGSN.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.4",
      "section_id": "5.5.4",
      "section_title": "Support of Combined Procedures",
      "content": "The SGSN has to select an MSC at the Gs interface for the combined procedures if multiple MSCs are configured for the relevant LAI. The MSC out of the available MSCs is selected based on the TMSI based NRI as provided by the UE or on the IMSI, and optionally, whether the \"MS is configured for low access priority\". Use of the TMSI based NRI as provided by the UE prevents an MSC change for UEs when UEs register first via normal procedures, and later by combined procedures. Use of the TMSI based NRI as provided by the UE or IMSI hash prevents an MSC change for many MSs if an SGSN fails and the re-attaching MSs would get assigned another MSC by the new SGSN. Two HLR updates instead of one would be the result.\nFrom the LAI and the TMSI based NRI as provided by the UE, the SGSN can select a VLR from the available VLRs. The NRI length and the selected VLR per NRI value shall be the same as for the CN Node selection for the CS Domain in the RNC and BSC nodes.\nFrom the IMSI the SGSN derives a value (V) using algorithm [(IMSI div 10) modulo 1000]. Every value (V) from the range 0 to 999 corresponds to a single MSC node. Typically many values of (V) may point to the same MSC node. The configuration of the MSC node should be the same in the same RNC area.\nIn some networks, the SGSN may be configured to select the MSC/VLR for \"MSs configured for low access priority\" with a different load balance to that used for MSC/VLR selection for other UEs. In this case the SGSN maintains a second set of tables of NRI to MSC mappings, and of value (V) to MSC mappings.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.5",
      "section_id": "5.5.5",
      "section_title": "CS Paging",
      "content": "If a CS paging is received via the Gs interface from MSC with mobile identity type IMSI then the SGSN should include the MSC/VLR-id in the paging / paging-request message to RNC/BSC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_5.5.6",
      "section_id": "5.5.6",
      "section_title": "Load Re-Distribution function in SGSN",
      "content": "On the Iu-ps interface the SGSN needs to ensure that the Iu-connection is released immediately after the Routing Area Update response message is returned to the UE, i.e. the follow-on flag shall be cleared.\nOn the Gb interface the SGSN needs to force the UE to standby after the Routing Area Update response message is returned to the UE, i.e. the force to standby indication shall be set. This ensures the Periodic Routing Area Update timer to start as quickly as possible.\nFor the special case when an SGSN in a pool also serves a BSC or RNC that is not part of the pool (e.g. a BSC or RNC that does not support pool functionality), an SGSN should not try to re-distribute UEs connected to that BSC or RNC.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_6",
      "section_id": "6",
      "section_title": "Application Examples",
      "content": "This clause describes some application examples for networks using the intra domain NAS node selection. In these examples, pool-areas are depicted by boxes or ellipses, while the core network elements which serve the pool-areas are depicted by the NRIs they have been assigned.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_6.1",
      "section_id": "6.1",
      "section_title": "Network configuration example 1",
      "content": "This example configures 9 pool-areas each with 3 CN nodes serving within a pool-area. When a MS moves from one (NRI:1,2,3) to another pool-area (NRI:4,5,6). It indicates the old NRI (3) derived from its old TMSI to the RNC in the new pool-area (NRI:4,5,6). This NRI 3 is not configured in the RNC of the pool-area (NRI:4,5,6). The RNC selects a CN node out of the available NRIs 4,5,6 and establishes the signalling connection for the MS with the selected CN node. This new CN nodes allocates a new TMSI to the MS and thereby the new NRI for the new pool-area.\nIn this example, the NRIs can be re-used in a pattern where adjacent pool areas do not use the same NRI. Every pool area change will initiate a new selection of a new CN node.\nFigure 2: Network configuration example 1",
      "chunk_type": "general",
      "cross_references": [
        "figure_2"
      ]
    },
    {
      "chunk_id": "ts_23.236_6.2",
      "section_id": "6.2",
      "section_title": "Network configuration example 2",
      "content": "This example shows a network covering one city centre surrounded by residential areas. The city centre is covered by all 4 pool-areas while each of the residential areas is covered by one pool-area only. Once a MS „found\" its pool-area, it will not change the pool-area while commuting between the city centre and its residential area. Each of the pool-areas is served by 5 MSCs, indicated by the 5 NRI values in the figure below, which share the load within the pool-area. Only distinct NRI values are used for the overlapping pool-areas. Therefore, a MS changing between these pool-areas will always be allocated to a new MSC by the NAS node selection function. In addition it is shown, that the NRIs can be re-used in other pool-areas as indicated in the figure by the smaller areas with only one NRI. Also at a change to these areas the MSs will always be allocated to a new MSC by the NAS node selection function as adjacent areas do not use the same NRI values.\nA calculation for the possible number of subscribers in this scenario is in Annex A.1: One city centre surrounded by residential areas\nFigure 3: Network configuration example 3",
      "chunk_type": "general",
      "cross_references": [
        "figure_3"
      ]
    },
    {
      "chunk_id": "ts_23.236_7",
      "section_id": "7",
      "section_title": "Specific Examples",
      "content": "This clause describes specific examples of Iu Flex. First, building blocks of Iu Flex are described in 7.1. These building blocks are then used in signalling flows starting from 7.2.\nThe changes to the signalling flows are indicated in italic.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_7.1.4",
      "section_id": "7.1.4",
      "section_title": "New CN node selecting old CN node",
      "content": "This building block describes how a new CN node selects the old CN node which was previously serving the MS. The new CN node has been allocated to serve the MS, and it may have to communicate with the old CN node e.g. in order to get IMSI of the MS or to get MM and PDP contexts of the MS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_7.1.5",
      "section_id": "7.1.5",
      "section_title": "Old CN node selecting new CN node",
      "content": "This building block describes how the old CN node selects a new CN node which starts to serve the MS. The old CN node has to select a new CN node e.g. when performing handover.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_7.2",
      "section_id": "7.2",
      "section_title": "Signalling flow for Attach (Iu interface mode)",
      "content": "At attach, the RNC selects an SGSN to serve the MS. The attach procedure is shown in the figure below.\nFigure 4: Signalling flow for Attach (Iu interface mode)\n1)\tThe Attach Request (old P-TMSI, old RAI, old P-TMSI Signature) is carried in the Initial Direct Transfer message (RRC) from the MS to the RNC. The RNC selects an SGSN to serve the MS as described in clause 7.1.3 and relays the Attach Request to the SGSN in the Initial UE message (RANAP).\n2)\tIf the MS identifies itself with P‑TMSI and the SGSN has changed since detach, the new SGSN sends an Identification Request (P‑TMSI, old RAI, old P‑TMSI Signature) to the old SGSN to request the IMSI. The new SGSN selects the old SGSN as described in clause 7.1.4. The old SGSN responds with Identification Response (IMSI, Authentication Triplets (for GPRS) or Authentication Vectors (for UMTS)). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN also validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN.\n3)\tIf the MS is unknown in both the old and new SGSN, the SGSN sends an Identity Request (Identity Type = IMSI) to the MS. The MS responds with Identity Response (IMSI).\n4)\tThe authentication functions are defined in the clause \"Security Function\" of TS 23.060 [2]. If no MM context for the MS exists anywhere in the network, then authentication is mandatory. Ciphering procedures are described in clause \"Security Function\" of TS 23.060 [2]. If P‑TMSI allocation is going to be done and the network supports ciphering, the network shall set the ciphering mode.\n5)\tThe equipment checking functions are defined in the clause \"Identity Check Procedures\" of TS 23.060 [2]. Equipment checking is optional.\n6)\tIf the SGSN number has changed since the GPRS detach, or if it is the very first attach, then the SGSN informs the HLR:\na)\tThe SGSN sends an Update Location (SGSN Number, SGSN Address, IMSI) to the HLR.\nb)\tThe HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN with Cancellation Type set to Update Procedure.\nc)\tThe old SGSN acknowledges with Cancel Location Ack (IMSI). If there are any ongoing procedures for that MS, the old SGSN shall wait until these procedures are finished before removing the MM and PDP contexts.\nd)\tThe HLR sends Insert Subscriber Data (IMSI, GPRS Subscription Data) to the new SGSN.\ne)\tThe new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions the MS is not allowed to attach in the RA, the SGSN rejects the Attach Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If subscription checking fails for other reasons, the SGSN rejects the Attach Request with an appropriate cause and returns an Insert Subscriber Data Ack (IMSI, Cause) message to the HLR. If all checks are successful then the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI) message to the HLR.\nf)\tThe HLR acknowledges the Update Location message by sending an Update Location Ack to the SGSN after the cancelling of old MM context and insertion of new MM context are finished. If the Update Location is rejected by the HLR, the SGSN rejects the Attach Request from the MS with an appropriate cause.\n7)\tIf Attach Type in step 1 indicated GPRS Attach while already IMSI attached, or combined GPRS / IMSI attached, then the VLR shall be updated if the Gs interface is installed. The VLR number is determined as described in 7.1.6. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 6d). This operation marks the MS as GPRS-attached in the VLR.\na)\tThe SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) message to the VLR. Location Update Type shall indicate IMSI attach if Attach Type indicated combined GPRS / IMSI attach. Otherwise, Location Update Type shall indicate normal location update. The VLR creates an association with the SGSN by storing SGSN Number.\nb)\tIf the LA update is inter-MSC, the new VLR sends Update Location (IMSI, new VLR) to the HLR.\nc)\tIf the LA update is inter-MSC, the HLR sends a Cancel Location (IMSI) to the old VLR.\nd)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\ne)\tIf the LA update is inter-MSC, the HLR sends Insert Subscriber Data (IMSI, GSM subscriber data) to the new VLR.\nf)\tThe VLR acknowledges with Insert Subscriber Data Ack (IMSI).\ng)\tAfter finishing the inter-MSC location update procedures, the HLR responds with Update Location Ack (IMSI) to the new VLR.\nh)\tThe VLR responds with Location Update Accept (VLR TMSI) to the SGSN. An Iu Flex aware VLR includes one of its (CS-)NRIs as part of VLR TMSI. The SGSN creates an association with the VLR by storing VLR number.\n8)\tThe SGSN selects Radio Priority SMS, and sends an Attach Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature, Radio Priority SMS) message to the MS. P‑TMSI is included if the SGSN allocates a new P‑TMSI. An Iu Flex aware SGSN includes one of its (PS-)NRIs as part of P-TMSI.\n9)\tIf P‑TMSI or VLR TMSI was changed, the MS acknowledges the received TMSI(s) by returning an Attach Complete message to the SGSN.\n10)\tIf VLR TMSI was changed, the SGSN confirms the VLR TMSI re-allocation by sending a TMSI Reallocation Complete message to the VLR.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_7.1.3",
        "clause_7.1.4",
        "figure_4",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_23.236_7.3",
      "section_id": "7.3",
      "section_title": "Signalling flows for Service Request (Iu interface mode)",
      "content": "When performing service request, the signalling connection between the MS and the SGSN is re-established.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.236_7.3.1",
      "section_id": "7.3.1",
      "section_title": "Service Request initiated by MS",
      "content": "The service request procedure initiated by the MS is shown in the figure below.\nFigure 5: Signalling flows for Service Request initiated by MS (Iu interface mode)\n1)\tThe MS establishes an RRC connection, if none exists for CS traffic.\n2)\tThe MS sends a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies the requested service. Service Type shall indicate one of the following: Data or Signalling. The Service Request is carried in the Initial Direct Transfer message (RRC) from the MS to the RNC. The RNC selects an SGSN to serve the MS as described in 7.1.3 and relays the Service Request to the SGSN in the Initial UE message (RANAP). At this point, the SGSN may perform the authentication procedure.\n-\tIf Service Type indicates Data, a signalling connection is established between the MS and the SGSN, and resources for active PDP context(s) are allocated, i.e., RAB establishment for the activated PDP context(s).\n-\tIf Service Type indicates Signalling, the signalling connection is established between the MS and the SGSN for sending upper-layer signalling messages, e.g., Activate PDP Context Request. The resources for active PDP context(s) are not allocated.\n3)\tThe SGSN shall perform the security functions if the MS in PMM-IDLE state initiated the service request.\n4)\tIf the network is in PMM-CONNECTED state and the Service Type indicates Data, the SGSN shall respond with a Service Accept message towards the MS, in case the service request can be accepted. In case Service Type indicates Data, the SGSN sends a Radio Access Bearer Assignment Request (NSAPIRAB ID(s), TEID(s), QoS Profile(s), SGSN IP Address(es)) message to re-establish radio access bearer for every activated PDP context.\n5)\tThe RNC indicates to the MS the new Radio Bearer Identity established and the corresponding RAB ID with the RRC radio bearer setup procedure.\n6)\tSRNC responds with the Radio Access Bearer Assignment Response (RAB ID(s), TEID(s), QoS Profile(s), RNC IP Address(es)) message. The GTP tunnel(s) are established on the Iu interface. If the RNC returns a Radio Access Bearer Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, e.g., \"Requested Maximum Bit Rate not Available\", the SGSN may send a new Radio Access Bearer Assignment Request message with different QoS profile(s). The number of re-attempts, if any, as well as how the new QoS profile(s) values are determined is implementation dependent.\n7)\tFor each RAB re-established with a modified QoS profile, the SGSN initiates a PDP Context Modification procedure to inform the MS and the GGSN of the new negotiated QoS profile for the corresponding PDP context.\n8)\tThe MS sends the uplink packet.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5"
      ]
    },
    {
      "chunk_id": "ts_23.236_7.3.2",
      "section_id": "7.3.2",
      "section_title": "Service Request initiated by network",
      "content": "The service request procedure initiated by the network is shown in the figure below.\nFigure 6: Signalling flows for Service Request initiated by network (Iu interface mode)\n1)\tThe SGSN receives a downlink PDP PDU for an MS in PMM‑IDLE state.\n2)\tThe SGSN sends a Paging message to the RNC. The RNC pages the MS by sending a Paging message to the MS. See clause \"PS Paging Initiated by 3G‑SGSN without RRC Connection for CS\" of TS 23.060 [2] for details.\n3)\tThe MS establishes an RRC connection if none exists for CS traffic.\n4)\tThe MS sends a Service Request (P‑TMSI, RAI, CKSN, Service Type) message to the SGSN. Service Type specifies Paging Response. The Service Request is carried over the radio in an RRC Direct Transfer message. The RNC selects an SGSN to serve the MS as described in 7.1.3 and relays the Service Request to the SGSN in the Initial UE message (RANAP). At this point, the SGSN may perform the authentication procedure. The SGSN knows whether the downlink packet requires RAB establishment (e.g., downlink PDU) or not (e.g., Request PDP Context Activation or MT SMS).\n5)\tThe SGSN shall perform the security mode procedure.\n6)\tIf resources for the PDP contexts are re-established, the SGSN sends a Radio Access Bearer Assignment Request (RAB ID(s), TEID(s), QoS Profile(s), SGSN IP Address(es)) message to the RNC. The RNC sends a Radio Bearer Setup (RAB ID(s)) to the MS. The MS responds by returning a Radio Bearer Setup Complete message to the RNC. The RNC sends a Radio Access Bearer Assignment Response (RAB ID(s), TEID(s), RNC IP Address(es)) message to the SGSN in order to indicate that GTP tunnels are established on the Iu interface and radio access bearers are established between the RNC and the MS. If the RNC returns a Radio Access Bearer Assignment Response message with a cause indicating that the requested QoS profile(s) can not be provided, e.g., \"Requested Maximum Bit Rate not Available\", the SGSN may send a new Radio Access Bearer Assignment Request message with different QoS profile(s). The number of re-attempts, if any, as well as how the new QoS profile(s) values are determined is implementation dependent.\n7)\tFor each RAB re-established with a modified QoS profile, the SGSN initiates a PDP Context Modification procedure to inform the MS and the GGSN of the new negotiated QoS profile for the corresponding PDP context.\n8)\tThe SGSN sends the downlink packet.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_23.236_7.4",
      "section_id": "7.4",
      "section_title": "Signalling flow for Routing Area Update (Iu interface mode)",
      "content": "The routing area update procedure is shown in the figure below.\nFigure 7: Signalling flow for Routing Area Update (Iu interface mode)\n1)\tThe RRC connection is established, if not already done. The Routeing Area Update Request (old P-TMSI, old RAI, old P-TMSI Signature) is carried in the Initial Direct Transfer message (RRC) from the MS to the RNC. The RNC selects an SGSN to serve the MS as described in 7.1.3 and relays the Routeing Area Update Request to the SGSN in the Initial UE message (RANAP).\n2)\tIf the RA update is an Inter-SGSN Routeing area update and if the MS was in PMM‑IDLE state, the new SGSN sends an SGSN Context Request message (old P‑TMSI, old RAI, old P‑TMSI Signature) to the old SGSN to get the MM and PDP contexts for the MS. The new SGSN selects the old SGSN as described in 7.1.4. The old SGSN validates the old P‑TMSI Signature and responds with an appropriate error cause if it does not match the value stored in the old SGSN. This should initiate the security functions in the new SGSN. If the security functions authenticate the MS correctly, the new SGSN shall send an SGSN Context Request (IMSI, old RAI, MS Validated) message to the old SGSN. MS Validated indicates that the new SGSN has authenticated the MS. If the old P‑TMSI Signature was valid or if the new SGSN indicates that it has authenticated the MS, the old SGSN responds with SGSN Context Response (Cause, IMSI, MM Context, PDP contexts). If the MS is not known in the old SGSN, the old SGSN responds with an appropriate error cause. The old SGSN starts a timer. The new SGSN shall ignore the MS Network Capability contained in MM Context of SGSN Context Response only when it has previously received an MS Network Capability in the Routeing Area Request.\na)\tIf the MS is PMM‑CONNECTED in the old 3G‑SGSN, the old SGSN shall send an SRNS Context Request (IMSI) message to the old SRNS to retrieve the sequence numbers for the PDP context for inclusion in the SGSN Context Response message from the SRNS. Upon reception of this message, the SRNS buffers and stops sending downlink PDUs to the MS and returns an SRNS Context Response (IMSI, GTP‑SNDs, GTP‑SNUs, PDCP‑SNUs) message. The SRNS shall include for each PDP context the next in-sequence GTP sequence number to be sent to the MS and the GTP sequence number of the next uplink PDU to be tunnelled to the GGSN. For each active PDP context using acknowledged mode, the SRNS also includes the uplink PDCP sequence number (PDCP‑SNU). PDCP‑SNU shall be the next in-sequence PDCP sequence number expected from the MS (per each active radio bearer).\n3)\tSecurity functions may be executed. These procedures are defined in clause \"Security Function\" of TS 23.060 [2]. If the security functions do not authenticate the MS correctly, the routeing area update shall be rejected, and the new SGSN shall send a reject indication to the old SGSN. The old SGSN shall continue as if the SGSN Context Request was never received.\n4)\tIf the RA update is an Inter-SGSN Routeing area update, the new SGSN sends an SGSN Context Acknowledge message to the old SGSN. The old SGSN marks in its context that the MSC/VLR association and the information in the GGSNs and the HLR are invalid. This triggers the MSC/VLR, the GGSNs, and the HLR to be updated if the MS initiates a routeing area update procedure back to the old SGSN before completing the ongoing routeing area update procedure.\n5)\tIf the RA update is an Inter-SGSN RA Update and if the MS was in PMM‑IDLE state, the new SGSN sends Update PDP Context Request (new SGSN Address, QoS Negotiated, Tunnel Endpoint Identifier) to the GGSNs concerned. The GGSNs update their PDP context fields and return an Update PDP Context Response (Tunnel Endpoint Identifier). Note: If the RA update is an Inter-SGSN routeing area update initiated by an MS in PMM‑CONNECTED state, the Update PDP Context Request message is sent as described in clause \"Serving RNS Relocation Procedures\" of TS 23.060 [2].\n6)\tIf the RA update is an Inter-SGSN RA Update, the new SGSN informs the HLR of the change of SGSN by sending Update Location (SGSN Number, SGSN Address, IMSI) to the HLR.\n7)\tIf the RA update is an inter-SGSN RA Update, the HLR sends Cancel Location (IMSI, Cancellation Type) to the old SGSN with Cancellation Type set to Update Procedure. If the timer described in step 2 is not running, the old SGSN removes the MM context. Otherwise, the contexts are removed only when the timer expires. It also ensures that the MM context is kept in the old SGSN in case the MS initiates another inter SGSN routeing area update before completing the ongoing routeing area update to the new SGSN. The old SGSN acknowledges with Cancel Location Ack (IMSI).\na)\tIf the MS is PMM‑CONNECTED in the old 3G‑SGSN, the old 3G‑SGSN sends an Iu Release Command message to the old SRNC. The SRNC responds with an Iu Release Complete message.\n8)\tIf the RA update is an inter-SGSN RA Update, the HLR sends Insert Subscriber Data (IMSI, subscription data) to the new SGSN. The new SGSN validates the MS's presence in the (new) RA. If due to regional subscription restrictions the MS is not allowed to be attached in the RA, the SGSN rejects the Routeing Area Update Request with an appropriate cause, and may return an Insert Subscriber Data Ack (IMSI, SGSN Area Restricted) message to the HLR. If all checks are successful, the SGSN constructs an MM context for the MS and returns an Insert Subscriber Data Ack (IMSI) message to the HLR.\n9)\tIf the RA update is an Inter-SGSN RA Update, the HLR acknowledges the Update Location by sending Update Location Ack (IMSI) to the new SGSN.\n10)\tIf Update Type indicates combined RA / LA update with IMSI attach requested, or if the LA changed with the routeing area update, the association has to be established. The VLR number is determined as described in 7.1.6. The new SGSN sends a Location Update Request (new LAI, IMSI, SGSN Number, Location Update Type) to the VLR. Location Update Type shall indicate IMSI attach if Update Type in step 1 indicated combined RA / LA update with ISI attach requested. Otherwise, Location Update Type shall indicate normal location update. The SGSN starts the location update procedure towards the new MSC/VLR upon receipt of the first Insert Subscriber Data message from the HLR in step 8). The VLR creates or updates the association with the SGSN by storing SGSN Number.\n11)\tIf the subscriber data in the VLR is marked as not confirmed by the HLR, the new VLR informs the HLR. The HLR cancels the old VLR and inserts subscriber data in the new VLR (this signalling is not modified from existing GSM signalling and is included here for illustrative purposes):\na)\tThe new VLR sends an Update Location (new VLR) to the HLR.\nb)\tThe HLR cancels the data in the old VLR by sending Cancel Location (IMSI) to the old VLR.\nc)\tThe old VLR acknowledges with Cancel Location Ack (IMSI).\nd)\tThe HLR sends Insert Subscriber Data (IMSI, GSM subscriber data) to the new VLR.\ne)\tThe new VLR acknowledges with Insert Subscriber Data Ack (IMSI).\nf)\tThe HLR responds with Update Location Ack (IMSI) to the new VLR.\n12)\tThe new VLR allocates a new TMSI and responds with Location Update Accept (VLR TMSI) to the SGSN. VLR TMSI is optional if the VLR has not changed. An Iu Flex aware VLR includes one of its (CS-)NRIs as part of VLR TMSI. The SGSN creates an association with the VLR by storing VLR number.\n13)\tThe new SGSN validates the MS's presence in the new RA. If due to roaming restrictions the MS is not allowed to be attached in the SGSN, or if subscription checking fails, the SGSN rejects the routeing area update with an appropriate cause. If all checks are successful, the new SGSN establishes MM context for the MS. The new SGSN responds to the MS with Routeing Area Update Accept (P‑TMSI, VLR TMSI, P‑TMSI Signature). An Iu Flex aware SGSN includes one of its (PS-)NRIs as part of P-TMSI.\n14)\tThe MS confirms the reallocation of the TMSIs by returning a Routeing Area Update Complete message to the SGSN.\n15)\tThe new SGSN sends a TMSI Reallocation Complete message to the new VLR if the MS confirms the VLR TMSI.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_7",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_23.236_7.5",
      "section_id": "7.5",
      "section_title": "IMSI attach procedure / Location area update with IMSI",
      "content": "This signalling flow shows the basic IMSI attach or location update procedure when a UMTS UE registers to a pool-area by mobile identity type IMSI.\nFigure 8: IMSI attach procedure / Location area update with IMSI\n1)\tUE requests the setup of the RRC connection and sends the Initial_DT including the Intra Domain NAS Node Selector (IDNNS). The IDNNS indicates that the routing parameter is derived from IMSI.\n2)\tThe RNC selects the MSC as described in 7.1.3. The Initial-UE message is generated on RANAP and sent via Iu-CS to the selected MSC/VLR.\n3)\tThe optional security functions can be executed.\n4)\tSince the UE wasn't registered in the MSC before the Map Update-location procedure to HLR is invoked by the MSC:\na)\tThe update-location is sent to HLR;\nb)\tIn case the UE was registered in another VLR the HLR sends cancel location procedure to old VLR;\nc)\tThe old VLR acknowledges with Cancel location Ack;\nd)\tThe HLR sends insert-subscriber data to the new VLR;\ne)\tThe new VLR acknowledges with insert-subscriber data Ack;\nf)\tAfter finishing the location update procedure the HLR responds with Update-location to the new VLR.\n5)\tThe MSC/VLR assigns a new TMSI to the UE and sends this TMSI value in the location-update accept to the UE. The TMSI contains the NRI of the VLR. The location update accept is carried in the NAS-PDU of the RANAP direct-transfer over Iu interface.\n6)\tThe RNC transparently forwards the NAS-PDU to the UE in the RRC downlink-DT message.\n7)\tIn the UE the new TMSI (including the NRI) and the LA are stored on SIM and the TMSI-reallocation complete is generated. This NAS message is returned to CN in the Uplink-DT via RRC. The mobile shall use this new TMSI next time it performs a mobile originating procedure.\n8)\tThe RNC forwards the NAS-PDU transparently to the MSC/VLR in the NAS-PDU of a Direct-transfer on Iu interface. If the TMSI-reallocation complete is received in the MSC/VLR the TMSI is considered as valid for the UE. From then on the UE will be addressed using this TMSI value.\nAnnex A (informative):Network configuration examples\nEditor's note:\tThis annex contains the examples for network configurations that have been discussed during the drafting meetings.\nA.1\tOne city centre surrounded by residential areas\nA.1.1\tAssumptions\nThis example shows a network covering one city centre surrounded by residential areas. The city centre is covered by all 4 pool-areas while the residential areas are covered by one pool-area only. Once a subscriber „found\" its pool-area, he will not change the pool-area while commuting between the city centre and his residential area.Each of the pool-areas is served by 5 MSCs, indicated by the 5 NRI values in the figure below.\nThe example in the figure configures 4 overlapping pool-areas:\n-\tCity centre with 12 Mio subscribers (with context in VLR, attached or detached);\n-\tOne switch office/building with 5 MSCs (5 NRIs) per pool-area;\n-\tCapacity of one MSC/VLR up to 1 Mio subscribers in VLR;\n-\t4 bits are assumed for the VLR-restart counter;\n-\tOnly distinct NRI values are used, so a UE changing between pool-areas will always be allocated to a new MSC by the NAS node selection function.\nFigure 9: One city centre surrounded by residential areas\nA.1.2\tTMSI calculation\nFor addressing in the CS domain 30 bits for can be used (Bit 30&31 are reserved):\n-\tThe assumption is that 4 bits are used for the restart counter;\n-\tTo differentiate the 20 MSC in the city area 5 bits are needed for the NRI (12 NRI values remain unused; these 12 NRIs are left for additional MSCs in the whole area, NRIs can also be re-used as indicated in the figure);\n-\tThis leaves 30-4-5 = 21 bits for every MSC to address the subscriber data records in the VLR. (This give address space for 2 Mio TMSIs unique over all LAs of the MSC);\n-\tThe 4 pool-areas sum up to 20 Mio subscriber, allowing for some unbalanced load distribution.\nA.2\t3 Neighbouring large city centres\nThis documents provides some calculations for 'pool-identification alternative B' in case that 3 huge city centres are covered by pool-areas with direct contacts.\nAssumptions:\nThe calculations are based on the following assumptions:\n-\t3 neighbouring pools with capacity of 32 M non-purged subscribers each.\n-\tMaximum capacity of a paging channel is 1 M pagings/hour per LA.\n-\t0.25 pagings / hour are assumed per subscriber 🡪 2M TMSI/LA can be realized.\n-\tFor the 'VLR-restart' counters a number of bits need to be reserved. Working assumption is that 5 bit should be sufficient for any implementation, in the examples these 5 bits are reserved on the upper part of the TMSI. (This is of course implementation specific and not part of Iu Flex).\n-\tThe calculations are based on a node capacity of up to 1M (2^20) non-purged subscribers this results in:\n-\tMinimum 32 nodes are needed per pool-area (5-bit NRI).\n-\tMinimum is 16 LA's per pool-area.\nBasic configuration needed for 1 pool:\n-\tTo address the 32M TMSI per pool the total number of 25 bits are needed in the TMSI.\n-\tFor a node capacity of 1M non-purged TMSIs 20 Bits have to be reserved for TMSI per NRI and 5 bit for the NRI value.\n-\tThe NRI is located bit 14-23 (configurable). It is assumed that the bits 19-23 are used for the NRI.\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 10: Example of a TMSI structure with 5 bit 'VLR-restart counter' and 5 bits NRI-length\n'3 pool configuration' – no sharing of NRI values:\n-\tThis example assumes that the 3 pool-areas have independent NRI values, so the available TMSI range has to be shared between the pools. All TMSI's from other pool-areas can be detected - best load distribution in the pools.\n-\tSo 3*32 = 96 NRI values are needed for all 3 pools. The NRI-length has to be increased to 7 bit. (not an optimum configuration since 32 NRI values are unused). In the example the NRI now uses bits 23-17.\n-\tSince still for each NRI value 20 bits are needed to address 1M TMSIs there is a conflict with the assumed VLR-restart field length of 5 bit. The VLR-restart field has to be reduced to a 3 bit field in order to free sufficient addressing space in the TMSI structure!\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 11: Modified TMSI structure 7 bits NRI-length; VLR-restart field must be reduced to 3 bit\n-\tIn this example configuration 32M TMSI values are wasted! So it would be more efficient to assign these TMSI ranges to the 3 pools rather than leave them unused. Alternatively these values could be used for sharing with nodes in the 'outside world'.\n-\tThe major drawback of this solution is the reduction of the VLR-restart field to 3 bits only!\n'3 pool configuration' – 25% of NRI values shared between the pools:\n-\tNow the pool configurations are changed in a way that 25% of the NRI values are the same in all the 3 pools. This means that for ¼ of subscribers pool-changes cannot be detected. The traffic generated by these subscribers will not be distributed, but is routed by the NAS node selection function to the specific node with this NRI value in the new pool.\n-\tThe total range of needed NRI values is reduced by this to:8 (the shared NRI's) + 3 * 24 = 80\n-\tTo code this NRI's still 7 bit are needed. So there is no gain in terms of addressing space in this example.\n-\tIn the example the NRI values 0..7 are shared and so are the TMSI ranges x0000000xx .. x0000111x\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 12: Modified TMSI structure 7 bits NRI-length; VLR-restart field must remain 3 bit\n'3 pool configuration' – 50% of NRI values shared between the pools:\n-\tThe percentage of the shared NRIs is now increased to 50%. So ½ of the NRI values are the same in all the 3 pools. This means that for ½ of subscribers pool-changes cannot be detected. The traffic generated by these subscribers will not be distributed, but is routed by the NAS node selection function to the specific node with this NRI value in the new pool.\n-\tThe total range of needed NRI values is reduced by this to:16 (the shared NRI's) + 3 * 16 = 64.\n-\tThis reduction of NRI saves 1 bit in NRI length. So the VLR-restart can be slightly increased to 4 bit (still 1 bit less than in the original assumption).\n-\tIn the example the NRI values 0..15 are shared and so are the TMSI ranges x000000xx .. x001111x.\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 13: NRI-length can be reduced by 1 bit; VLR-restart field can increase to 4 bit\n'3 pool configuration' – 75% of NRI values shared between the pools:\n-\tNext step is to even increase the shared part of the NRI to ¾. This means that only 25% of the incoming traffic in a pool-area is distributed.\n-\tThe total range of needed NRI values is reduced by this to:24 (the shared NRI's) + 3 * 8 = 48.\n-\tLike the first step this doesn't free any addressing space in the TMSI. But some NRI values are now available in case it is wanted to share them with other nodes outside the '3 pool area'.\n-\tIn the example the NRI values 0..23 are shared and so are the TMSI ranges x000000xx .. x010111x.\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 14: NRI-length can be reduced by 1 bit; VLR-restart field can increase to 4 bit\n'3 pool configuration' – full sharing of NRIs between the pools:\n-\tThe last variant of these configurations is a full sharing is all NRI values between all neighbouring pools. In this case no detection of pool area changes is possible. Consequently no distribution of load can be achieved. This results necessarily in the need to have a 'forced redistribution' mechanism to resolve heavy unbalance of load.\n-\tThe NRI and TMSI ranges will then be the same as in the 'single pool' example in the beginning.\nResult:\nThe examples above show that it is basically not possible to configure the example configuration (32M non-purged subscribers; 1M per MSC) with a VLR-restart field as put in the assumptions, except that the full range of NRI is shared between the pools.Taking it literally it could be possible with 3 pools when sharing the remaining quarter of the NRI (the part that would be unused otherwise), but latest if 4 pool-areas with this capacity have to be supported this reaches the limit.\nAn alternative to overcome this could be to apply the TMSI's on a per LA basis as it is already foreseen on the A/Iu interface specifications.\nTMSI per LA:\nTaking the example configuration mentioned above but changing the TMSI allocation per LA would result in an increase of the addressing space. Then the same TMSI value can be used multiple times in the same VLR. A specific subscriber data record can then only be addressed by LA&TMSI.\nFor the 32 MSCs this means that that each of them supports an equal share of TMSI of a LA. So each MSC handles 2M/32 = 32k TMSI of a specific LA.\nThe required TMSI addressing space id thereby reduced to 15 bit per MSC.\nIf, like before, 96 NRI values are needed to address all nodes in the 3 pools then 7 bit are needed for this. This leaves 5 bit for the VLR-restart counters (plus 3 unused bits).\n31\n30\n29\n28\n27\n26\n25\n24\n23\n22\n21\n20\n19\n18\n17\n16\n15\n14\n13\n12\n11\n10\n9\n8\n7\n6\n5\n4\n3\n2\n1\n0\nCS/PS\n'VLR-restart'\nused NRI range\nFigure 15: TMSI example for TMSI allocation per VLR; 32M TMSI/pool;\nWithout sharing NRI values the pool size can even be increased (Factor 8 – since 3 bit spare).\nA number of aspects however remain to be looked at with this TMSI per LA approach:\n-\tIt requires an equal distribution of UE's of a certain LA over all nodes in the pool. This contradicts the wish for a flexible routing where e.g. a new attach should be routed to the closest node in order to save transmission resources.\n-\tAttach requests in a LA may be rejected by one node because this node has already a fully booked TMSI table for this LA. At the same time the node may have in total still capacity left to serve subscribers.\n-\tThe total load of TMSI re-allocations may increase since every change of LA must result in a TMSI reallocation.\n-\tMAP on VLR-VLR I/F must be updated, otherwise subscriber confidentially decreases because for every change to other MSCs the IMSI has to be fetched via the air I/F. (At the same time node changes should only occur when changing the pool-area – so maybe never?).\n-\tCan it happen that if NRI are shared there are several subscribers with the same TMSI in a certain LA? FFSIf yes then a paging-request there will trigger several page-response messages per LA.\nA.3\tSupport of Dedicated Core Networks\nAn overview of dedicated core network (DCN) feature is provided in TS 23.401 [22]. This annex provides an example of NRI configuration for supporting DCNs.\nThe following example shows a split of NRI values between operators A (0..99) and B (100..199). Each operator has a separate core network. Furthermore, each operator has two DCNs (A1, A2) and (B1, B2).\nTwo pool/deployment areas are shown below.\nFigure A.3-1: Example NNSF configuration to support DCN\nThe figure above shows how the NNSF of pool 1 is configured to select the same operator and same DCN when a UE moves in from neighbour pool area 2. This configuration avoids redirection procedure for UEs that move in idle mode between the pool areas.\nWith the NNSF configured above, there are NRIs available that may be re-used for redistribution of UEs within the pool without requiring reservation of extra NRIs for redistribution i.e. the NRI allocated to a neighbouring pool area and not allocated in this pool area may be used as a Null-NRI for the pool area. This also avoids the need for additional configuration in NNSF.\nIn the example above, all A1 nodes of pool 1 may use NRI 4 as Null-NRI for redistributing UEs between A1 nodes of pool 1. The NNSFs of pool 1 are configured to select a new node from nodes belonging to A1, when a UE indicates an IDNNS with NRI 4 or NRI 4 is provided as the Null-NRI in the NAS message redirection procedure by an SGSN (see TS 23.401 [22]).\nAnnex B (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2010-03\nSA#47\nSP-100162\n0039\n1\nF\nInclusion of informative reference to FS_IDC study work\n10.0.0\n2010-09\nSA#49\nSP-100553\n0041\n1\nB\nM2M related updates\n10.1.0\n2010-12\nSA#50\nSP-100688\n0042\n1\nF\nExtra text on NNSF for MTC\n10.2.0\n2010-12\nSA#50\nSP-100691\n0046\n2\nF\nIu/A Flex - Subsequent Inter-MSC Handover Interactions\n10.2.0\n2011-01\n-\n-\n-\n-\n-\nUpdate of LTE logo to LTE-Advanced logo\n10.2.1\n2012-03\nSA#55\nSP-120074\n0048\n2\nF\nCorrected MTC terminology\n10.3.0\n2012-06\nSA#57\nSP-120486\n0049\n3\nF\nGs Support for MSC in Pool to avoid dual VLR registration.\n11.0.0\n2013-06\nSA#60\nSP-130232\n0050\n3\nC\nUse of Low Access Priority Indication (LAPI) to select SGSN for PS domain\n12.0.0\n2015-06\nSA#68\nSP-150234\n0051\n3\nB\nUpdate of MME load balancing for Dedicated Core Networks\n13.0.0\n2015-06\nSA#68\nSP-150234\n0053\n2\nB\nLoad re-balancing for SGSNs with Dedicated Core Networks\n13.0.0\n2016-09\nSA#73\nSP-160649\n0054\n1\nC\nLoad balancing for SGSNs with multiple DCN support\n14.0.0\n2018-06\nSP-80\n-\n-\n-\n-\nUpdate to Rel-15 version (MCC)\n15.0.0\n2020-07\nSP-88E\n-\n-\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2022-03\nSP-95E\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_8",
        "figure_9",
        "figure_10",
        "figure_11",
        "figure_12",
        "figure_13",
        "figure_14",
        "figure_15",
        "ts_23.401"
      ]
    }
  ]
}