{
  "metadata": {
    "specification_id": "ts_23.304",
    "version": "18.8.0",
    "title": "3GPP TS 23.304",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23304-i80/23304-i80.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:32:59.281436",
    "total_chunks": 222
  },
  "chunks": [
    {
      "chunk_id": "ts_23.304_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document specifies the Stage 2 of the Proximity based Services (ProSe) features in 5GS. 5G ProSe features consist of: 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay and 5G ProSe UE-to-UE Relay.\n5G ProSe Direct Discovery identifies that 5G ProSe-enabled UEs are in proximity using NR.\n5G ProSe Direct Communication enables establishment of communication paths between two or more 5G ProSe-enabled UEs that are in direct communication range using NR.\n5G ProSe UE-to-Network Relay enables indirect communication between the 5G network and UEs (e.g. for UEs that are out of coverage of the network).\n5G ProSe UE-to-UE Relay enables indirect communication between two 5G ProSe End UEs.\nSecurity aspects of ProSe in 5GS are defined in TS 33.503 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support Vehicle-to-Everything (V2X) services\".\n[3]\t3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".\n[4]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[5]\t3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".\n[6]\t3GPP TS 22.261: \"Service requirements for next generation new services and markets; Stage 1\".\n[7]\t3GPP TS 22.278: \"Service requirements for the Evolved Packet System (EPS)\".\n[8]\t3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support network data analytics services\".\n[9]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System\".\n[10]\tVoid.\n[11]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[12]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".\n[13]\t3GPP TS 38.304: \"NR; User Equipment (UE) procedures in idle mode\".\n[14]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station in idle mode\".\n[15]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[16]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol Specification\".\n[17]\tIETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".\n[18]\tIETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".\n[19]\tIETF RFC 826: \"An Ethernet Address Resolution Protocol\".\n[20]\tVoid.\n[21]\t3GPP TR 23.752: \"Study on system enhancement for Proximity based Services (ProSe) in the 5G System (5GS)\".\n[22]\t3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".\n[23]\t3GPP TS 24.554: \"Proximity-services (ProSe) in 5G System (5GS) protocol aspects; Stage 3\".\n[24]\tIETF RFC 2131: \"Dynamic Host Configuration Protocol\".\n[25]\tIETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration Protocol version 4 (DHCPv4)\".\n[26]\tVoid.\n[27]\tVoid.\n[28]\t3GPP TS 38.351: \"NR; Sidelink Adaptation Layer Protocol\".\n[29]\t3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in the 5G System (5GS)\".\n[30]\t3GPP TS 29.500: \"5G System; Technical Realization of Service Based Architecture; Stage 3\".\n[31]\t3GPP TS 23.167: \"3rd Generation Partnership Project; Technical Specification Group Services and Systems Aspects; IP Multimedia Subsystem (IMS) emergency sessions\".\n[32]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[33]\t3GPP TS 22.268: \"Public Warning System (PWS) requirements\".\n[34]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_23.287",
        "ts_23.303",
        "ts_23.501",
        "ts_23.502",
        "ts_22.261",
        "ts_22.278",
        "ts_23.288",
        "ts_23.503",
        "ts_36.300",
        "ts_38.300",
        "ts_38.304",
        "ts_23.122",
        "ts_36.331",
        "ts_38.331",
        "ts_23.752",
        "ts_32.277",
        "ts_24.554",
        "ts_38.351",
        "ts_33.503",
        "ts_29.500",
        "ts_23.167",
        "ts_23.041",
        "ts_22.268",
        "ts_38.413"
      ]
    },
    {
      "chunk_id": "ts_23.304_3.1",
      "section_id": "3.1",
      "section_title": "Terms",
      "content": "For the purposes of the present document, the terms given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n5G ProSe-enabled UE: A UE that supports 5G ProSe requirements and associated procedures.\n5G ProSe Direct Discovery: A procedure employed by a 5G ProSe-enabled UE to discover other 5G ProSe-enabled UEs in its vicinity based on direct radio transmissions between the two UEs with NR technology.\n5G ProSe Direct Communication: A communication between two or more UEs in proximity that are 5G ProSe-enabled, by means of user plane transmission using NR technology via a path not traversing any network node.\n5G ProSe UE-to-Network Relay: A 5G ProSe-enabled UE that provides functionality to support connectivity to the network for 5G ProSe Remote UE(s).\n5G ProSe Remote UE: A 5G ProSe-enabled UE that communicates with a DN via a 5G ProSe UE-to-Network Relay.\n5G ProSe UE-to-UE Relay: A 5G ProSe-enabled UE that provides functionality to support connectivity between 5G ProSe End UEs.\n5G ProSe End UE: A 5G ProSe-enabled UE that connects with another 5G ProSe-enabled UE(s) via a 5G ProSe UE-to-UE Relay.\nApplication Layer ID: An identifier identifying a 5G ProSe-enabled UE within the context of a specific application. The format of this identifier is outside the scope of 3GPP.\nDirect Network Communication: One mode of network communication, where there is no 5G ProSe UE-to-Network Relay between a UE and the 5G network.\nIndirect Network Communication: One mode of network communication, where there is a 5G ProSe UE-to-Network Relay between a UE and the 5G network.\nMember ID: An identifier uniquely identifying a member in the Application Layer managed group and that is managed by the ProSe application layer.\nMode of communication: Mode of communication to be used by the 5G ProSe-enabled UE over PC5 reference point, i.e. broadcast mode, groupcast mode or unicast mode.\nOpen ProSe Discovery: ProSe Direct Discovery without explicit permission from the 5G ProSe-enabled UE being discovered, according to TS 22.278 [7].\nProSe identifier: A globally unique identifier used to identify the ProSe Application associated with the ProSe operation in 5G ProSe Direct Discovery and 5G ProSe Direct Communication. In this Release, the \"Application ID\" defined in TS 23.303 [3] can be used as the ProSe identifier in 5G ProSe Direct Discovery and in a consequent 5G ProSe Direct Communication.\nRestricted ProSe Discovery: ProSe Direct Discovery that only takes place with explicit permission from the 5G ProSe-enabled UE being discovered, according to TS 22.278 [7].\nRelay Service Code: A Relay Service Code is used for the case of UE-to-Network Relay as well as for the case of UE-to-UE Relay. The definition for the case of UE-to-Network Relay is in TS 23.303 [3]. For the case of UE-to-UE Relay, the Relay Service Code is used to identify a connectivity service the 5G ProSe UE-to-UE Relay provides and the authorized users the 5G ProSe UE-to-UE Relay would offer service to. The definition of values of Relay Service Code for the case of UE-to-UE Relay is out of scope of this specification.\nUser Info ID: The User Info ID is configured for Model A or Model B Group Member Discovery, 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery, either for public safety or commercial applications based on the policy of the HPLMN or via the ProSe application server that allocates it. The definition of values of User Info ID is out of scope of this specification.\nFor the purposes of the present document, the following term and definition given in TS 23.303 [3] apply:\nApplication Layer Group ID\nDestination Layer-2 ID\nDiscovery Entry ID\nDiscovery Filter\nDiscovery Query Filter\nDiscovery Response Filter\nGeographical Area\nLocal PLMN\nModel A\nModel B\nMetadata Index Mask\nProSe Application ID\nProSe Application Code\nProSe Application Mask\nProSe Query Code\nProSe Response Code\nProSe Restricted Code\nProSe Restricted Code Prefix\nProSe Restricted Code Suffix\nProSe Discovery UE ID\nProSe Layer-2 Group ID\nRestricted ProSe Application User ID\nSource Layer-2 ID\nFor the purposes of the present document, the following term and definition given in TS 23.287 [2] apply:\nNR Tx Profile",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_22.278",
        "ts_23.303",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\n5G DDNMF\t5G Direct Discovery Name Management Function\nAS layer\tAccess Stratum layer\nNCGI\tNR Cell Global ID\nPDUID\tProSe Discovery UE ID\nPFI\tPC5 QoS Flow Identifier\nPQI\tPC5 5QI\nProSe\tProximity based Services\nRPAUID\tRestricted ProSe Application User ID\nRSC\tRelay Service Code\nRSD\tRule Selection Descriptor\nTAI\tTracking Area Identity",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.1",
      "section_id": "4.1",
      "section_title": "General concept",
      "content": "Proximity based Services (ProSe) are services that can be provided by the 5GS based on UEs being in proximity to each other.\nThe 5GS enablers for ProSe include the following functions:\n-\t5G ProSe Direct Discovery;\n-\t5G ProSe Direct Communication;\n-\t5G ProSe UE-to-Network Relay;\n-\t5G ProSe UE-to-UE Relay.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_4.2.1",
      "section_id": "4.2.1",
      "section_title": "Non-roaming reference architecture",
      "content": "Figure 4.2.1-1 shows the high-level view of the non-roaming 5G System architecture for Proximity-based Services (ProSe) with service-based interfaces within the Control Plane. In this figure, UE A and UE B use a subscription of the same PLMN.\nFigure 4.2.1-1: Non-roaming 5G System architecture for Proximity-based Services\nFigure 4.2.1-2 shows the high-level view of the non-roaming 5G System architecture for Proximity-based Services (ProSe) in reference point representation. In this figure, UE A and UE B use a subscription of the same PLMN.\nFigure 4.2.1-2: Non-roaming 5G System architecture for Proximity-based Services in reference point representation",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.1-1",
        "figure_4.2.1-2"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.2",
      "section_id": "4.2.2",
      "section_title": "Roaming reference architecture",
      "content": "Figure 4.2.2-1 shows the high-level view of the roaming 5G System architecture for Proximity-based Services (ProSe) with service-based interfaces within the Control Plane. In the figure, UE A uses a subscription of HPLMN.\nFigure 4.2.2-1: Roaming 5G System architecture for Proximity-based Services",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.3",
      "section_id": "4.2.3",
      "section_title": "Inter-PLMN reference architecture",
      "content": "The following figure 4.2.3-1 shows the high level view of the non-roaming inter-PLMN architecture with service-based interfaces within the Control Plane. In this figure, PLMN A is the HPLMN of UE A and PLMN B is the HPLMN of UE B.\nFigure 4.2.3-1: Non-roaming Inter-PLMN 5G System architecture for Proximity-based Services\nFigure 4.2.3-2 shows the high level view of the roaming architecture with service-based interfaces within the Control Plane. In this figure, UE A uses a subscription of PLMN A and UE B uses a subscription of PLMN B; UE A is roaming in PLMN C while UE B is not roaming.\nFigure 4.2.3-2: Roaming Inter-PLMN 5G System architecture for Proximity-based Services",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.3-1",
        "figure_4.2.3-2"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.4",
      "section_id": "4.2.4",
      "section_title": "AF-based service parameter provisioning",
      "content": "The 5G System provides NEF services to enable communication between NFs in the PLMN and a ProSe Application Server. Figure 4.2.4-1 shows the high level view of AF-based service parameter provisioning for 5G ProSe communications. The ProSe Application Server may provide ProSe service parameters to the PLMN via NEF. The NEF stores the ProSe service parameters in the UDR.\nFigure 4.2.4-1: 5G System architecture for AF-based service parameter provisioning for 5G ProSe communications",
      "chunk_type": "parameter",
      "cross_references": [
        "figure_4.2.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.5",
      "section_id": "4.2.5",
      "section_title": "Reference points",
      "content": "PC1:\tThe reference point between the ProSe application in the UE and in the ProSe Application Server. It is used to define application level signalling requirements. This reference point is not specified in this release of the specification.\nPC3a:\tThe reference point between the UE and the 5G DDNMF. PC3a relies on 5GC user plane for transport (i.e. an \"over IP\" reference point). It is used to authorise 5G ProSe Direct Discovery request and perform allocation of ProSe Application Codes / ProSe Restricted Codes corresponding to ProSe Application Identities used for 5G ProSe Direct Discovery.\nPC5:\tThe reference point between ProSe-enabled UEs used for control and user plane for 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay and 5G ProSe UE-to-UE Relay.\nPC8:\tThe reference point between the UE and the 5G ProSe Key Management Function (5G PKMF). The details are defined in TS 33.503 [29].\nNpc2:\tThe reference point between the ProSe Application Server and the 5G DDNMF. It is used to define the interaction between ProSe Application Server and 5G DDNMF for 5G ProSe Direct Discovery.\nNpc4:\tThe reference point between the UDM and 5G DDNMF. It is used to provide subscription information in order to authorise 5G ProSe Direct Discovery request.\nNpc6:\tThe reference point between the 5G DDNMF in the HPLMN and the 5G DDNMF in a Local PLMN (5G ProSe Direct Discovery). This reference point is used for HPLMN control of ProSe service authorization.\nNpc7:\tThe reference point between the 5G DDNMF in the HPLMN and the 5G DDNMF in the VPLMN. It is used for HPLMN control of ProSe service authorization.\nNpc8:\tThe reference point between the PCF and the 5G DDNMF. It is used to define the interactions between the 5G DDNMF and the PCF to e.g. get a PDUID from the PCF.\nNpc9:\tThe reference point between the 5G PKMF of the 5G ProSe Remote UE and the 5G PKMF of the 5G ProSe UE-to-Network Relay and between the 5G PKMF of the 5G ProSe End UE and the 5G PKMF of the 5G ProSe UE-to-UE Relay. The details are defined in TS 33.503 [29].\nNpc10:\tThe reference point between the 5G PKMF and UDM. The details are specified in TS 33.503 [29].\nNpc11:\tThe reference point between the AUSF and Prose Anchor Function (PAnF). The details are specified in TS 33.503 [29].\nNpc12:\tThe reference point between the PAnF and UDM. The details are specified in TS 33.503 [29].\nNpc13:\tThe reference point between the SMF and PKMF. The details are specified in TS 33.503 [29].\nNpc14:\tThe reference point between the SMF and PAnF. The details are specified in TS 33.503 [29].\nNOTE:\tNpc2, Npc4, Npc6, Npc7, Npc8, Npc9, Npc10, Npc11, Npc12, Npc13 and Npc14 show the interactions that exist between the NF services in the NFs. These reference points are realised by corresponding NF service-based interfaces and by specifying the identified consumer and producer NF service as well as their interaction in order to realize a particular system procedure.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.6",
      "section_id": "4.2.6",
      "section_title": "Service-based interfaces",
      "content": "N5g-ddnmf:\tServices provided by 5G DDNMF to manage inter-PLMN 5G ProSe Direct Discovery operations.\nNpkmf:\tService provided by 5G PKMF to support inter-PLMN ProSe security management. The function of Npkmf is defined in TS 33.503 [29].\nIn addition to the relevant services defined in TS 23.501 [4] for the following service-based interfaces, in the case of ProSe Service, the services can be provided by corresponding NF are as follows:\nNudm:\tServices provided by UDM are used to get 5G ProSe Service related subscription information to the AMF during Initial Registration procedure or UE Configuration Update (UCU) procedure to inform the AMF the subscription information has changed and to provide ProSe Service related subscription information to 5G DDNMF for the authorisation of 5G ProSe Direct Discovery requests. The subscription information is described in TS 23.502 [5]. Services provided by UDM may also be used by the 5G PKMF for relay service authorisation, see TS 33.503 [29].\nNpcf:\tServices provided by H-PCF are used to provide 5G ProSe Service related parameters to V-PCF for the UE and NG-RAN in the roaming case and to enable the 5G DDNMF to get a PDUID or be notified of PDUID change.\nNudr:\tServices provided by UDR are used to notify the PCF and the UDM of the update of the 5G ProSe Service related information as described in TS 23.502 [5].\nNnef:\tServices provided by NEF are used by the ProSe Application Server to update 5G ProSe Service related information of 5GC.\nNamf:\tServices provided by AMF are consumed by PCF to provide the 5G ProSe Service related parameters for the UE and the NG-RAN to the AMF and to enable the AMF create or update the UE context related to 5G ProSe service.\nNnrf:\tServices provided by NRF are used to discover the PCF that supports 5G ProSe service and for 5G DDNMF in HPLMN to discover other 5G DDNMFs in VPLMN or local PLMN.\nNaf:\tServices provided by AF are consumed by the DDNMF to request authorization for Discovery Request. The AF may update the authorization information to revoke the Restricted ProSe Direct Discovery permission.",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.503",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.7.1",
      "section_id": "4.2.7.1",
      "section_title": "5G ProSe Layer-3 UE-to-Network Relay reference architecture",
      "content": "The following figure 4.2.7.1-1 shows the high level reference architecture for 5G ProSe Layer-3 UE-to-Network Relay. In this figure, the 5G ProSe Layer-3 UE-to-Network Relay may be in the HPLMN or a VPLMN.\nFigure 4.2.7.1-1: Reference architecture for 5G ProSe Layer-3 UE-to-Network Relay\nThe following figure 4.2.7.1-2 shows the non-roaming reference architecture for 5G ProSe Layer-3 UE-to-Network Relay when N3IWF is supported. In this figure, the PLMN A and PLMN B may be the same or different. When the 5G ProSe Layer-3 Remote UE may connect to NG-RAN directly to access PLMN B and in that case it would take the role of UE in the figure. The N3IWF may be connected to Relay UE UPF via a Data Network.\nFigure 4.2.7.1-2: Non-roaming architecture model for 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support\nThe following figure 4.2.7.1-3 shows the roaming reference architecture for 5G ProSe Layer-3 UE-to-Network Relay. In this figure, the PLMN A and PLMN B may be the same or different and/or the PLMN A and PLMN C may be the same or different. The N3IWF may be connected to Relay UE UPF via a Data Network.\nFigure 4.2.7.1-3: Roaming architecture model for 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.7.1-1",
        "figure_4.2.7.1-2",
        "figure_4.2.7.1-3"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.7.2",
      "section_id": "4.2.7.2",
      "section_title": "5G ProSe Layer-2 UE-to-Network Relay reference architecture",
      "content": "Figure 4.2.7.2-1 shows the 5G ProSe Layer-2 UE-to-Network Relay reference architecture. The 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay may be served by the same or different PLMNs. If the serving PLMNs of the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2UE-to-Network Relay are different then NG-RAN is shared by the serving PLMNs, see the 5G MOCN architecture in clause 5.18 of TS 23.501 [4].\nFigure 4.2.7.2-1: 5G ProSe Layer-2 UE-to-Network Relay reference architecture\nNOTE 1:\tUu between the 5G ProSe Layer-2 Remote UE and NG-RAN consists of RRC, SDAP and PDCP.\nNOTE 2:\tThe 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay are served by the same NG-RAN. The Core Network entities (e.g., AMF, SMF, UPF) serving the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 UE-to-Network Relay can be the same or different.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.18",
        "figure_4.2.7.2-1",
        "ts_23.501_figure_4.2.7.2-1",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.2.8",
      "section_id": "4.2.8",
      "section_title": "5G ProSe UE-to-UE Relay reference architecture",
      "content": "Figure 4.2.8-1 shows the Layer-2 and Layer-3 5G ProSe UE-to-UE Relay reference architecture. The 5G ProSe End UEs communicate with each other via a 5G ProSe UE-to-UE Relay.\nFigure 4.2.8-1: Reference architecture for 5G ProSe UE-to-UE Relay\nEach 5G ProSe End UE and the 5G ProSe UE-to-UE Relay may have subscriptions from the same PLMN or different PLMNs.",
      "chunk_type": "general",
      "cross_references": [
        "figure_4.2.8-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.1",
      "section_id": "4.3.1",
      "section_title": "UE",
      "content": "Any 5G ProSe-enabled UE may support the following functions:\n-\tExchange of information for 5G ProSe Direct Discovery between 5G ProSe-enabled UE and the 5G DDNMF over PC3a reference point.\n-\tProcedures for 5G ProSe Direct Discovery of other 5G ProSe-enabled UEs over PC5 reference point.\n-\tProcedures for 5G ProSe Direct Communication over PC5 reference point, including Broadcast, Groupcast and Unicast mode 5G ProSe Direct Communication.\n-\tProcedures to act as a 5G ProSe Layer-2 UE-to-Network Relay.\n-\tProcedures to act as a 5G ProSe Layer-3 UE-to-Network Relay.\n-\tProcedures to act as a 5G ProSe Layer-2 Remote UE.\n-\tProcedures to act as a 5G ProSe Layer-3 Remote UE.\n-\tProcedures to act as a 5G ProSe Layer-2 UE-to-UE Relay.\n-\tProcedures to act as a 5G ProSe Layer-3 UE-to-UE Relay.\n-\tProcedures to act as a 5G ProSe Layer-2 End UE.\n-\tProcedures to act as a 5G ProSe Layer-3 End UE.\n-\tProcedures for communication path switching between PC5 and Uu reference points.\n-\tProcedures for Multi-path communication via Uu and via 5G ProSe UE-to-Network Relay.\n-\tIndicating UE Policy Provisioning Request in UE Policy Container for UE triggered 5G ProSe Policy provisioning, which requests one or multiple types of policies/parameters as listed below:\n-\tPolicy/parameters for 5G ProSe Direct Discovery;\n-\tPolicy/parameters for 5G ProSe Direct Communication;\n-\tPolicy/parameters for 5G ProSe Layer-2 Remote UE;\n-\tPolicy/parameters for 5G ProSe Layer-3 Remote UE;\n-\tPolicy/parameters for 5G ProSe Layer-2 UE-to-Network Relay;\n-\tPolicy/parameters for 5G ProSe Layer-3 UE-to-Network Relay;\n-\tPolicy/parameters for 5G ProSe Layer-2 End UE;\n-\tPolicy/parameters for 5G ProSe Layer-3 End UE;\n-\tPolicy/parameters for 5G ProSe Layer-2 UE-to-UE Relay;\n-\tPolicy/parameters for 5G ProSe Layer-3 UE-to-UE Relay.\n-\tReceiving the 5G ProSe Policy from 5GC over N1 reference point.\n-\tConfiguration of parameters for 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay (e.g. including IP addresses, ProSe Layer-2 Group IDs, see clause 5.1) and 5G ProSe UE-to-UE Relay. These parameters can be pre-configured in the UE, or, if in coverage, provisioned or updated by signalling over the N1 reference point from the PCF in the HPLMN or over PC1 reference point from the ProSe Application Server.\n-\tReporting the following capabilities to 5GC over the N1 reference point:\n-\t5G ProSe Capability.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.2.1",
      "section_id": "4.3.2.1",
      "section_title": "General",
      "content": "The 5G DDNMF is the logical function handling network related actions required for dynamic 5G ProSe Direct Discovery. In this version of the specification, it is assumed that there is only one logical 5G DDNMF in each PLMN that supports 5G ProSe Direct Discovery service.\nNOTE:\tIf multiple 5G DDNMFs are deployed within the same PLMN (e.g., for load reasons), the method to locate the 5G DDNMF that has allocated a specific ProSe Application Code or ProSe Restricted Code (e.g. through a database lookup, etc.) is not defined in this version of the specification.\nThe 5G DDNMF interacts with the 5G ProSe-enabled UE using procedures over PC3a reference point defined in clause 6.3.1 to allocate and resolve the mapping of ProSe Applications IDs and ProSe Application Codes used in 5G ProSe Direct Discovery. It uses ProSe related subscriber data stored in UDM for the authorisation of each discovery request. It also provides the UE with the necessary security material in order to protect discovery messages transmitted over the air. In restricted 5G ProSe Direct Discovery, it also interacts with the Application Server via Npc2 reference points or with other 5G DDNMFs via Npc6/Npc7 reference points for the authorization of the discovery requests.\nThe 5G ProSe-enabled UE use procedure defined in clause 4.3.2.2 to discovery the 5G DDNMF in the HPLMN. Based on the UE Local Configuration or URSP as defined in TS 23.503 [9], an existing PDU session is selected or a new PDU session is established, to carry the control signalling between the UE and the 5G DDNMF in the HPLMN.\nThe 5G DDNMF provides the necessary charging functionality or charging information for the usage of 5G ProSe Direct Discovery and/or ProSe Direct Communication to interact with CHF or for the provision to CEF.\nThe 5G DDNMF in the HPLMN may interact with the 5G DDNMF in a VPLMN or Local PLMN in order to manage the 5G ProSe Direct Discovery service.\nThe 5G DDNMF gets the address of the PCF for the UE from the BSF.\nThe 5G DDNMF gets the PDUID from the PCF and subscribes to notifications on Change of PDUID.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.3.1",
        "clause_4.3.2.2",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.2.2",
      "section_id": "4.3.2.2",
      "section_title": "5G DDNMF Discovery",
      "content": "The 5G DDNMF of HPLMN is discovered through interaction with the Domain Name Service function. The UE may have the 5G DDNMF address in the Home PLMN (either as a FQDN or an IP address) pre-configured or provisioned as specified in clause 5.1.2.1. If it is not pre-configured or provisioned then the UE self-constructs the FQDN for it using e.g. the PLMN ID of the HPLMN.\nThe 5G DDNMF in the HPLMN uses the NRF to discovery other 5G DDNMFs in a VPLMN or local PLMN.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.3",
      "section_id": "4.3.3",
      "section_title": "PCF",
      "content": "In addition to the functions defined in TS 23.501 [4] and TS 23.503 [9], the PCF includes functions to provision the UE with necessary policies and parameters to use 5G ProSe services, as part of the UE ProSe Policy information as defined in TS 23.503 [9] clause 4.2.2:\n-\tPC5 usage reporting configuration.\n-\tAuthorization policy and parameters for 5G ProSe Direct Discovery and Communication.\n-\tAuthorization policy and parameters for 5G ProSe UE-to-Network Relay Discovery and Communication (i.e. as 5G ProSe Layer-2 Remote UE, as 5G ProSe Layer-3 Remote UE, as 5G ProSe Layer-2 UE-to-Network Relay, as 5G ProSe Layer-3 UE-to-Network Relay).\n-\tPDUID allocation with its validity timer.\n-\tAuthorization policy and parameters for 5G ProSe UE-to-UE Relay Discovery and Communication.\nThe PCF may update the 5G ProSe policy and parameters to the UE under certain conditions.\nWhen receiving the 5G ProSe Capability in Npcf_UEPolicyControl_Create Request from the AMF or when receiving the updated subscription data from UDR, the PCF generates the PC5 QoS parameters used by NG-RAN corresponding to a UE as defined in clause 5.4.2 of TS 23.287 [2].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.503_clause_4.2.2",
        "ts_23.287_clause_5.4.2",
        "ts_23.501",
        "ts_23.503",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.4",
      "section_id": "4.3.4",
      "section_title": "AMF",
      "content": "In addition to the functions defined in TS 23.501 [4], the AMF performs the following functions:\n-\tSelect a PCF supporting 5G ProSe Policy/Parameter provisioning based on indication of 5G ProSe Capability as part of the \"5GMM capability\" in the Registration Request.\n-\tStore the 5G ProSe Capability.\n-\tForward the 5G ProSe Capability to PCF in Npcf_UEPolicyControl_Create Request.\n-\tObtain from UDM the subscription information related to 5G ProSe and store them as part of the UE context data.\n-\tObtain PC5 QoS parameters from the PCF and store them as part of the UE context data.\n-\tProvision the NG-RAN with indication about the UE authorization status about the following:\n-\t5G ProSe Direct Discovery and 5G ProSe Direct Communication (i.e. as 5G ProSe-enabled UE for ProSe Direct Discovery, as 5G ProSe-enabled UE for ProSe Direct Communication);\n-\t5G ProSe UE-to-Network Relay Discovery and Communication (i.e. as 5G ProSe Layer-2 Remote UE, as 5G ProSe Layer-2 UE-to-Network Relay, as 5G ProSe Layer-3 UE-to-Network Relay);\n-\tMulti-path communication via direct Uu path and via 5G ProSe Layer 2 UE-to-Network Relay as a 5G ProSe Layer-2 Remote UE;\n-\t5G ProSe UE-to-UE Relay Discovery and Communication (i.e. as 5G ProSe Layer-2 End UE, as 5G ProSe Layer-2 UE-to-UE Relay).\n-\tProvision the NG-RAN with PC5 QoS parameters related to 5G ProSe Direct Communication.\n-\tOptionally support security procedures over Control Plane for 5G ProSe UE-to-Network relaying as defined in TS 33.503 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.5",
      "section_id": "4.3.5",
      "section_title": "UDM",
      "content": "In addition to the functions defined in TS 23.501 [4], the UDM performs the following functions:\n-\tSubscription management for 5G ProSe Direct Discovery and Communication.\n-\tSubscription management for 5G ProSe UE-to-Network Relay Discovery and Communication.\n-\tSubscription management for multi-path communication via direct Uu path and via 5G ProSe Layer 2 UE-to-Network Relay as a 5G ProSe Layer-2 Remote UE.\n-\tSubscription management for 5G ProSe UE-to-UE Relay Discovery and Communication.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.6",
      "section_id": "4.3.6",
      "section_title": "UDR",
      "content": "In addition to the functions defined in TS 23.501 [4], the UDR performs the following functions:\n-\tStores a path preference for ProSe services provided by the AF.\n-\tStores ProSe service parameters.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.7",
      "section_id": "4.3.7",
      "section_title": "NRF",
      "content": "In addition to the functions defined in TS 23.501 [4], the NRF performs the following functions:\n-\tPCF discovery by considering 5G ProSe Capability.\n-\t5G DDNMF Discovery.\nSimilar procedure can be used for 5G DDNMF discovery across PLMNs as specified in clause 4.17.5 of TS 23.502 [5] with the difference as below:\n-\tThe serving PLMN is replaced by home PLMN and home PLMN is replaced by local PLMN or serving PLMN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.17.5",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.8",
      "section_id": "4.3.8",
      "section_title": "ProSe Application Server",
      "content": "The ProSe Application Server supports the following functionalities.\nFor 5G ProSe Direct Discovery:\n-\tMaintains permission information for the restricted 5G ProSe Direct Discovery using RPAUIDs;\n-\tStorage of ProSe Discovery UE IDs and metadata;\n-\tMapping of RPAUID and PDUID for restricted 5G ProSe Direct Discovery;\n-\tProvisioning parameters for Group Member Discovery to UE.\n-\tInteraction with 5G DDNMF for 5G ProSe Direct Discovery, including:\n-\tAllocation of the ProSe Restricted Code Suffix pool, if restricted Direct Discovery with application-controlled extension is used;\n-\tAllocation of the mask(s) for ProSe Restricted Code Suffix, if restricted Direct Discovery with application-controlled extension is used;\n-\tAllocation of the ProSe Application Code Suffix pool, if open Direct Discovery with application-controlled extension is used;\n-\tAllocation of the mask(s) for ProSe Application Code Suffix, if open Direct Discovery with application-controlled extension is used.\nFor 5G ProSe Direct Communication:\n-\tProvisioning a path preference for 5G ProSe Services to UDR;\n-\tProvisioning parameters for 5G ProSe Direct Communication to UE.\nFor 5G ProSe UE-to-Network Relay service:\n-\tProvisioning parameters for 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-Network Relay Communication to UDR.\nFor 5G ProSe UE-to-UE Relay service:\n-\tProvisioning parameters for 5G ProSe UE-to-UE Relay Discovery and 5G ProSe UE-to-UE Relay Communication to UDR.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_4.3.9.1",
      "section_id": "4.3.9.1",
      "section_title": "General",
      "content": "Both 5G ProSe Layer-2 and Layer-3 UE-to-Network Relay entity provides the relaying functionality to support connectivity to the network for 5G ProSe Remote UEs. It can be used for both public safety services and commercial services (e.g. interactive service).\nBoth 5G ProSe Layer-2 and Layer-3 UE-to-Network Relay supports the following functions to enable connectivity to the network:\n-\t5G ProSe UE-to-Network Relay Discovery service as defined in clause 6.3.2.3, to allow discovery by the 5G ProSe Remote UE;\n-\taccess the 5GS as a UE as defined in TS 23.501 [4] with the enhancements as specified in clauses 6.2 and 6.6;\n-\trelays unicast traffic (uplink and downlink) between the 5G ProSe Remote UE and the network, supporting IP, Ethernet or Unstructured traffic type.\nNOTE:\tRelaying MBS traffic to a 5G ProSe Remote UE by a 5G ProSe UE-to-Network Relay is not supported in this release of the specification.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.3.2.3",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.9.2",
      "section_id": "4.3.9.2",
      "section_title": "5G ProSe Layer-3 UE-to-Network Relay",
      "content": "In addition to the common 5G ProSe UE-to-Network Relay functions defined in clause 4.3.9.1, 5G ProSe Layer-3 UE-to-Network Relay supports the following functions to enable connectivity to the network:\n-\t5G ProSe Direct Communication via 5G ProSe Layer-3 UE-to-Network Relay as specified in clause 6.5.1, for the communication with the 5G ProSe Layer-3 Remote UEs for the relay operations;\n-\tend-to-end QoS treatment for the 5G ProSe Layer-3 Remote UE's traffic without N3IWF as defined in clause 5.6.2.1 and when accessing via an N3IWF as defined in clause 5.6.2.2;\n-\tIP address management for the 5G ProSe Layer-3 Remote UE as defined in clause 5.5.1.3 in case the 5G ProSe Layer-3 Remote UE uses IP traffic type.\n-\tEmergency PDU Session establishment for 5G ProSe Layer-3 Remote UE via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF support.\nNOTE:\tFor emergency service via N3IWF, see clause 5.4.4.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.9.1",
        "clause_6.5.1",
        "clause_5.6.2.1",
        "clause_5.6.2.2",
        "clause_5.5.1.3",
        "clause_5.4.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.9.3",
      "section_id": "4.3.9.3",
      "section_title": "5G ProSe Layer-2 UE-to-Network Relay",
      "content": "In addition to the common 5G ProSe UE-to-Network Relay functions defined in clause 4.3.9.1, 5G ProSe Layer-2 UE-to-Network Relay supports the following functions to enable connectivity to the network:\n-\t5G ProSe Direct Communication via 5G ProSe Layer-2 UE-to-Network Relay as specified in clause 6.5.2, for the communication with the 5G ProSe Layer-2 Remote UEs for the relay operations;\n-\tQoS handling for 5G ProSe Layer-2 UE-to-Network Relay and end-to-end QoS treatment as defined in clause 5.6.2.3.\n-\tFor a 5G ProSe Layer-2 UE-to-Network Relay to participate in the 5G ProSe UE-to-Network Relay Discovery procedure for emergency service (i.e. sending the UE-to-Network Relay Discovery Announcement message or UE-to-Network Relay Discovery Response message), the serving NG-RAN support of emergency services is required as the Layer-2 Remote UE may select a different PLMN from the Layer-2 Relay.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.9.1",
        "clause_6.5.2",
        "clause_5.6.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.10",
      "section_id": "4.3.10",
      "section_title": "SMF",
      "content": "In addition to the functions defined in TS 23.501 [4], the SMF supports the following function:\n-\tReceiving 5G ProSe Layer-3 Remote UE report and maintaining the information of 5G ProSe Layer-3 Remote UE(s) handled by a 5G ProSe Layer-3 UE-to-Network Relay in the 5G ProSe Layer-3 UE-to-Network Relay's SM context for the PDU Session associated with the relay.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.11",
      "section_id": "4.3.11",
      "section_title": "NEF",
      "content": "In addition to the functions defined in TS 23.501 [4], the NEF supports the following:\n-\tTo enable AFs to provide service specific information to the 3GPP network, the NEF supports additional service parameters for ProSe policy as specified in clause 6.2.5.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2.5",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.12.1",
      "section_id": "4.3.12.1",
      "section_title": "General",
      "content": "Both 5G ProSe Layer-2 and Layer-3 UE-to-UE Relay provides the relaying functionality to support connectivity between 5G ProSe End UEs. 5G ProSe UE-to-UE Relay can be used for both public safety services and commercial services (e.g. interactive service).\nBoth 5G ProSe Layer-2 and Layer-3 UE-to-UE Relay supports the following functions to enable connectivity between 5G ProSe End UEs:\n-\t5G ProSe UE-to-UE Relay Discovery service as defined in clause 6.3.2.4, to allow discovery by the 5G ProSe End UE;\n-\t5G ProSe Discovery integrated into PC5 unicast link establishment as specified in clause 6.7.3;\n-\tAccess 5GS as a UE as defined in TS 23.501 [4] with the enhancements as specified in clauses 6.2;\n-\tRelay unicast traffic between the 5G ProSe End UEs, supporting IP, Ethernet or Unstructured traffic type.\nNOTE:\tRelaying groupcast and broadcast traffic to a 5G ProSe End UE by a 5G ProSe UE-to-UE Relay is not supported in this release of the specification.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.3.2.4",
        "clause_6.7.3",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.12.2",
      "section_id": "4.3.12.2",
      "section_title": "5G ProSe Layer-3 UE-to-UE Relay",
      "content": "In addition to the common 5G ProSe UE-to-UE Relay functionality defined in clause 4.3.12.1, a 5G ProSe Layer-3 UE-to-UE Relay supports the following functions:\n-\t5G ProSe Direct Communication via 5G ProSe Layer-3 UE-to-UE Relay as specified in clause 6.7.1, for the communication between 5G ProSe Layer-3 End UEs for relay operations;\n-\tQoS handling and end-to-end QoS treatment for the 5G ProSe Layer-3 End UE's traffic as defined in clause 5.6.3.1;\n-\tIP address management for the 5G ProSe Layer-3 End UE as defined in clause 5.5.1.4 when the 5G ProSe Layer-3 End UE uses IP traffic type;\n-\t5G ProSe UE-to-UE Relay reselection as specified in clause 6.7.4.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.12.1",
        "clause_6.7.1",
        "clause_5.6.3.1",
        "clause_5.5.1.4",
        "clause_6.7.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_4.3.12.3",
      "section_id": "4.3.12.3",
      "section_title": "5G ProSe Layer-2 UE-to-UE Relay",
      "content": "In addition to the common 5G ProSe UE-to-UE Relay functions defined in clause 4.3.12.1, 5G ProSe Layer-2 UE-to-UE Relay supports the following functions:\n-\t5G ProSe Direct Communication via 5G ProSe Layer-2 UE-to-UE Relay as specified in clause 6.7.2, for the communication between 5G ProSe Layer-2 End UEs for relay operations;\n-\tQoS handling and end-to-end QoS treatment for 5G ProSe Layer-2 End UE's traffic as defined in clause 5.6.3.2;\n-\t5G ProSe UE-to-UE Relay reselection as specified in clause 6.7.4.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.12.1",
        "clause_6.7.2",
        "clause_5.6.3.2",
        "clause_6.7.4.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.1",
      "section_id": "5.1.1",
      "section_title": "General",
      "content": "In 5GS, the parameters for 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay and 5G ProSe UE-to-UE Relay services may be made available to the UE in following ways:\n-\tprovisioned in the ME; or\n-\tconfigured in the UICC; or\n-\tprovisioned in the ME and configured in the UICC; or\n-\tprovided or updated by the ProSe Application Server via PCF and/or PC1 reference point; or\n-\tprovided or updated by the PCF to the UE.\nIf the same parameters described in clauses 5.1.2.1, 5.1.3.1, 5.1.4.1 and 5.1.5.1 are provided by different sources, the UE shall consider them in the following priority order:\n-\tprovided or updated by the PCF (including parameters determined by the PCF itself and parameters provided by the ProSe Application Server to the PCF as specified in clause 6.2.5);\n-\tprovided or updated by the ProSe Application Server via PC1 reference point;\n-\tconfigured in the UICC;\n-\tprovisioned in the ME.\nThe parameters provided or updated by the ProSe Application Server via PC1 reference point may need to be complemented with configuration data from other sources listed above.\nNOTE:\tThe ProSe Application Server can provision the same ProSe parameters via 5GC as specified in clause 6.2.5 or directly to the UE via PC1 reference point and can revoke (e.g. delete) the ProSe parameters via 5GC as specified in clause 6.2.5 in order for the provisioning via PC1 reference point to take effect.\nThe basic principles of service authorization and provisioning for 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay and 5G ProSe UE-to-UE Relay services are as follows:\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorized to use 5G ProSe Direct Discovery.\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorised to use 5G ProSe Direct Communication.\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorised to act as 5G ProSe UE-to-Network Relay. Authorisation for 5G ProSe Layer-2 UE-to-Network Relay and 5G ProSe Layer-3 UE-to-Network Relay are independent of each other.\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorised to access 5GC via 5G ProSe UE-to-Network Relay (i.e. to act as 5G ProSe Remote UE). Authorisation to access via 5G ProSe Layer-2 UE-to-Network Relay and via 5G ProSe Layer-3 UE-to-Network Relay are independent of each other.\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorised to act as 5G ProSe UE-to-UE Relay. Authorisation for 5G ProSe Layer-2 UE-to-UE Relay and 5G ProSe Layer-3 UE-to-UE Relay are independent of each other.\n-\tThe PCF in the HPLMN may configure a list of PLMNs where the UE is authorised to access 5G ProSe UE-to-UE Relay (i.e. to act as 5G ProSe End UE). Authorisation to access via 5G ProSe Layer-2 UE-to-UE Relay and via 5G ProSe Layer-3 UE-to-UE Relay are independent of each other.\n-\tThe PCF in the HPLMN merges authorization information from home and other PLMNs and provides the UE with the final authorization information.\n-\tThe PCF in the VPLMN or HPLMN may revoke the authorization (via H-PCF when roaming) at any time by using the UE Configuration Update procedure for transparent UE Policy delivery procedure defined in clause 4.2.4.3 of TS 23.502 [5].\n-\tThe ProSe Policy/parameters provisioning to UE is controlled by the PCF and may be triggered by UE. The PCF provisions one or more of the following ProSe Policy/parameters:\n-\tProSe Policy/parameters for 5G ProSe Direct Discovery as specified in clause 5.1.2.1;\n-\tProSe Policy/parameters for 5G ProSe Direct Communications as specified in clause 5.1.3.1;\n-\tProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 UE-to-Network Relay as specified in clause 5.1.4.1;\n-\tProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 Remote UE as specified in clause 5.1.4.1.\n-\tProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 UE-to-UE Relay as specified in clause 5.1.5.1.\n-\tProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 End UE as specified in clause 5.1.5.1.\n-\tThe PCF includes the 5G ProSe Policy/parameters in a Policy Section identified by a Policy Section Identifier (PSI) as specified in clause 6.1.2.2.2 of TS 23.503 [9].\nIn addition to the above, ProSe usage reporting configuration and rules for charging can be (pre)configured in the UE or provided by the PCF.\nIn addition to the above, the path selection policy can be (pre)configured in the UE or provided by the PCF as defined in clause 5.11. A path preference for ProSe Services can be provided by ProSe Application Server to UDR and may be used by PCF for path selection policy generation and update.\nWhen a 5G ProSe Layer-3 Remote UE is using a 5G ProSe Layer-3 UE-to-Network Relay without involving N3IWF, the PCF based provisioning and update of 5G ProSe Policy/parameters to the 5G ProSe Layer-3 Remote UE are not supported.\n5.1.1a\tGeneral principles for applying policy/parameters\nFor services (i.e. 5G ProSe Direct Discovery, 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay discovery, 5G ProSe UE-to-Network Relay communication, 5G ProSe UE-to-UE Relay discovery and 5G ProSe UE-to-UE Relay communication) over PC5 reference point, the operator may pre-configure the UEs with the required provisioning parameters for the service, without the need for the UEs to connect to the 5GC to get this initial configuration. The following apply:\n-\tThe provisioning parameters for the service could be from different sources and their priorities are described in clause 5.1.1.\n-\tThe ME provisioning parameters shall not be erased when a USIM is deselected or replaced.\n-\tThe UE shall use radio resources for the service as follows:\n-\tWhile a UE has a serving cell and is camped on a cell and the UE intends to use for 5G ProSe the radio resources (i.e. carrier frequency) operated by this cell, then the UE shall use the radio resource description indicated by this cell the UE is camped on and ignore any radio resource description of the same radio resource provisioned in the ME or the UICC. If the cell does not provide radio resources for ProSe, the UE shall not perform ProSe message transmission and reception on radio resources operated by this cell. The UE is allowed to perform the service with another UE not served by the same PLMN;\n-\tIf the UE intends to use \"operator-managed\" radio resources (i.e. carrier frequency) for 5G ProSe that are not operated by the UE's serving cell, as specified in the related Policy/Parameter provisioning, or if the UE is out of coverage, the UE shall search for a cell in any PLMN that is operating the provisioned radio resources (i.e. carrier frequency) as defined in TS 38.300 [12] and TS 38.304 [13]; and:\n-\tIf the UE finds such a cell in the registered PLMN or a PLMN equivalent to the registered PLMN and authorization for the service to this PLMN is confirmed, the UE shall use the radio resource description indicated by that cell. If that cell does not provide radio resources for ProSe, the UE shall not perform ProSe message transmission and reception on those radio resources;\n-\tIf the UE finds such a cell but not in the registered PLMN or a PLMN equivalent to the registered PLMN and that cell belongs to a PLMN authorized for the service and provides radio resources for ProSe then the UE shall perform PLMN selection triggered by the service as defined in TS 23.122 [14];\n-\tIf the UE finds such cell but not in a PLMN authorized for the service the UE shall not use the service;\n-\tIf the UE does not find any such cell in any PLMN, then the UE shall consider itself \"not served by NG-RAN\" and use radio resources provisioned in the ME or the UICC. If no such provision exists in the ME or the UICC or the provision does not authorize the service, then the UE is not authorized to transmit;\n-\tThe UE is allowed to use \"operator-managed\" radio resources (i.e. carrier frequency) provisioned in the ME or the UICC for the service if the UICC indicates it is authorized;\n-\tIf the UE intends to use \"non-operator-managed\" radio resources (i.e. carrier frequency) for 5G ProSe, according to TS 36.331 [15] or TS 38.331 [16] and as specified in clause 5.1.2.1, then the UE shall perform the service using resource provisioned in the ME or the UICC. If no such provision exists in the ME or the UICC or the provision does not authorize the service, then the UE is not authorized to transmit;\nNOTE 1:\tIt is possible for operators to configure UEs (e.g. Public Safety UEs) to use only \"operator-managed\" radio resources (i.e. carrier frequency) for the service when the UE is \"not served by NG-RAN\".\n-\tThe UE provisioning shall support setting Geographical Areas;\nNOTE 2:\tIt is possible for a UE to use other radio resources for 5G ProSe based on the Geographical Area instead of those operated by the serving NG-RAN cell, when provisioned in the UE, even if the UE's serving cell offers normal service and the SIBs for NR Sidelink communication defined in TS 38.331 [16] indicates that the service (the service) is available. This is to cover the scenario when e.g. the radio resources used for the service are not owned by the serving network of the UE.\nNOTE 3:\tWhen cross-carrier operation is supported, according to TS 36.331 [15] or TS 38.331 [16], a UE can be instructed by its serving cell to perform the service over a different carrier frequency. The UE is still considered as \"served by NG-RAN\" in this case.\nNOTE 4:\tThe scenario that a cell is detected and the cell does not provide support for the service when the UE attempts to use a carrier frequency configured for the service, is considered a configuration error. Therefore, the UE does not transmit on that frequency to avoid interference to the network.\n-\tThe service is only specified for NR.\nNOTE 5:\tIt is out of scope of the present specification to define how the UE can locate itself in a specific Geographical Area. When the UE is in coverage of a 3GPP RAT, it can for example, use information derived from the serving PLMN. When the UE is not in coverage of a 3GPP RAT, it can use other techniques, e.g. Global Navigation Satellite System (GNSS). User provided location is not a valid input.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.2.5",
        "ts_23.502_clause_4.2.4.3",
        "clause_5.1.2.1",
        "clause_5.1.3.1",
        "clause_5.1.4.1",
        "clause_5.1.5.1",
        "ts_23.503_clause_6.1.2.2.2",
        "clause_5.11",
        "clause_5.1.1",
        "ts_23.502",
        "ts_23.503",
        "ts_38.300",
        "ts_38.304",
        "ts_23.122",
        "ts_36.331",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.2.1",
      "section_id": "5.1.2.1",
      "section_title": "Policy/Parameter provisioning for 5G ProSe Direct Discovery",
      "content": "The following sets of information for 5G ProSe Direct Discovery over PC5 reference point is provisioned to the UE:\n1)\tAuthorization policy for 5G ProSe Direct Discovery:\n-\tWhen the UE is \"served by NG-RAN\":\n-\tFor open 5G ProSe Direct Discovery:\na)\topen 5G ProSe Direct Discovery Model A monitoring authorization policy:\n-\tPLMNs in which the UE is authorised to perform 5G ProSe Direct Discovery monitoring.\nb)\topen 5G ProSe Direct Discovery Model A announcing authorization policy:\n-\tPLMNs in which the UE is authorized to perform announcing.\n-\tFor restricted 5G ProSe Direct Discovery:\na)\trestricted 5G ProSe Direct Discovery Model A monitoring authorization policy:\n-\tPLMNs in which the UE is authorised to perform restricted 5G ProSe Direct Discovery Model A monitoring.\nb)\trestricted 5G ProSe Direct Discovery Model A announcing authorization policy:\n-\tPLMNs in which the UE is authorized to perform restricted 5G ProSe Direct Discovery Model A announcing.\nc)\trestricted 5G ProSe Direct Discovery Model B Discoverer operation authorization policy:\n-\tPLMNs in which the UE is authorized to perform Model B Discoverer operation.\nd)\trestricted 5G ProSe Direct Discovery Model B Discoveree operation authorization policy:\n-\tPLMNs in which the UE is authorized to perform Model B Discoveree operation.\nNOTE 1:\tIn this specification, [When the UE is \"served by NG-RAN\"] and [When the UE is \"not served by NG-RAN\"] have similar meaning as in \"served by E-UTRAN\" and \"not served by E-UTRAN\" in TS 23.303 [3], but applied to 5G ProSe Direct discovery/communications over NR PC5 reference point.\n-\tWhen the UE is \"not served by NG-RAN\":\n-\tIndicates whether the UE is authorized to perform 5G ProSe Direct Discovery for Model A and Model B when \"not served by NG-RAN\".\nNOTE 2:\tIf both Model A and Model B are authorized for 5G ProSe Direct Discovery, it is up to UE and application implementation to select a discovery model or perform both models simultaneously.\n2)\tParameters used for 5G ProSe Direct Discovery:\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to Destination Layer-2 ID(s) for sending/receiving initial signalling of discovery messages.\nNOTE 3:\tThe same Destination Layer-2 ID for 5G ProSe Direct Discovery can be mapped to more than one ProSe services.\nNOTE 4:\tThe values provisioned for the Destination Layer-2 ID(s) for 5G ProSe Direct Discovery, for Destination Layer-2 ID(s) for 5G ProSe Direct Communication, defined in clause 5.1.3.1, for Destination Layer-2 ID(s) for 5G ProSe UE-to-Network Relay Discovery defined in clause 5.1.4.1 and for Destination Layer-2 ID(s) for 5G ProSe UE-to-UE Relay Discovery defined in clause 5.1.5.1, are different from each other.\nNOTE 5:\tA \"catch all\" entry with the lowest priority can be used for the ProSe services that do not have explicit mapping to the Destination Layer-2 ID(s) for sending/receiving initial signalling of discovery messages.\n-\tApplication identifiers to be used for 5G ProSe Direct Discovery over PC5 interface.\nNOTE 6:\tThe Security parameters for 5G ProSe Direct Discovery can be provisioned by 5G DDNMF as defined in TS 33.503 [29].\n3)\tRadio parameters when the UE is \"not served by NG-RAN\":\n-\tIncludes the radio parameters per NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform 5G ProSe Direct Discovery over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\nNOTE 7:\tWhether a frequency band is \"operator managed\" or \"non-operator managed\" in a given Geographical Area is defined by local regulations.\n-\tDefault PC5 DRX configuration (see TS 38.331 [16]).\nNOTE 8:\tRadio parameters for 5G ProSe UE-to-UE Relay Discovery when the UE is not \"served by NG-RAN\" in clause 5.1.5.2.1 and Radio parameters when the UE is \"not served by NG-RAN\" for 5G ProSe Direct Discovery are expected to be aligned for direct and relayed discovery for UE to UE communication.\n4)\tRestricted ProSe Discovery UE ID for Restricted Direct Discovery:\n-\tProSe Discovery UE ID.\n5)\tGroup Member Discovery parameters:\n-\tFor each discovery group that the UE belongs to include the following parameters that enable the UE to perform Group Member Discovery when provided by PCF or provisioned in the ME or configured in the UICC:\n-\tApplication Layer Group ID: Identifies an application layer group or a discovery group that the UE belongs to;\n-\tLayer-2 Group ID: layer-2 ID for Application Layer Group ID;\n-\tUser Info ID: For Model A, this corresponds to the Announcer Info parameter when the UE is acting as an announcing UE. For Model B, this corresponds to the Discoverer Info in Solicitation messages and the Discoveree Info in Response messages, when the UE is acting as a discoverer or discoveree UE respectively.\nNOTE 9:\tUser Info ID is expected to be assigned uniquely to a user within the discovery group.\n6)\tOptionally, the 5G DDNMF address (either FQDN or IP address) in the Home PLMN.\n7)\tValidity timer indicating the expiration time of the Policy/Parameter for 5G ProSe Direct Discovery.\nThe above parameter sets bullet 2), bullet 3), bullet 5) and bullet 7) may be provided or updated to the UE by the ProSe Application Server, except for the Security parameters in bullet 2).",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.3.1",
        "clause_5.1.4.1",
        "clause_5.1.5.1",
        "clause_5.1.5.2.1",
        "ts_23.303",
        "ts_33.503",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.2.2",
      "section_id": "5.1.2.2",
      "section_title": "Principles for applying parameters for 5G ProSe Direct Discovery",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe Direct Discovery service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.3.1",
      "section_id": "5.1.3.1",
      "section_title": "Policy/Parameter provisioning for 5G ProSe Direct Communication",
      "content": "The following sets of information for 5G ProSe Direct Communications over PC5 reference point is provisioned to the UE:\n1)\tAuthorization policy:\n-\tWhen the UE is \"served by NG-RAN\":\n-\tPLMNs in which the UE is authorized to perform 5G ProSe Direct Communications over PC5 reference point when \"served by NG-RAN\".\n-\tWhen the UE is \"not served by NG-RAN\":\n-\tIndicates whether the UE is authorized to perform 5G ProSe Direct Communications over PC5 reference point when \"not served by NG-RAN\".\nNOTE 1:\tIn this specification, [When the UE is \"served by NG-RAN\"] and [When the UE is \"not served by NG-RAN\"] are relevant to 5G ProSe Direct Communications over NR PC5 reference point.\n2)\tGroupcast mode 5G ProSe Direct Communication policy/parameters:\n-\tFor each application layer group supported include the parameters that enable the UE to perform Groupcast mode 5G ProSe Direct Communication when provided by PCF or provisioned in the ME or configured in the UICC:\n-\tApplication Layer Group ID: Identifies an application layer group that the UE belongs to.\n-\tProSe Layer-2 Group ID: Destination Layer-2 ID applicable only when the Application Layer Group ID is provided by the application layer\n-\tProSe Group IP multicast address\n-\tIndication whether the UE should use IPv4 or IPv6 for that group\n-\tFor a specific Group configured to operate using IPv4, optionally an IPv4 address to be used by the UE as a source address. If none is provisioned, then the UE shall use Dynamic Configuration of IPv4 Link-Local Addresses RFC 3927 [18] to obtain a link local address for the Group.\n3)\tRadio parameters when the UE is \"not served by NG-RAN\":\n-\tIncludes the radio parameters NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform ProSe Direct Communications over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\nNOTE 2:\tWhether a frequency band is \"operator managed\" or \"non-operator managed\" in a given Geographical Area is defined by local regulations.\nNOTE 3:\tRadio parameters for 5G ProSe Direct Communication when the UE is not \"served by NG-RAN\" in clause 5.1.5.2.1 and Radio parameters when the UE is \"not served by NG-RAN\" for 5G ProSe UE-to-UE Relay communication are expected to be aligned for direct and relayed UE to UE communication.\n4)\tPolicy/parameters related to privacy:\n-\tThe list of ProSe services (i.e. ProSe identifiers) with Geographical Area(s) that require privacy support.\n-\tA privacy timer value indicating the duration after which the UE shall change each source Layer-2 ID self-assigned by the UE when privacy is required.\n5)\tPolicy/parameters when NR PC5 is selected:\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to radio frequencies with Geographical Area(s).\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to Destination Layer-2 ID(s) for broadcast.\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to Destination Layer-2 ID(s) for groupcast.\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to default Destination Layer-2 ID(s) for initial signalling to establish unicast connection.\nNOTE 4:\tThe same default Destination Layer-2 ID for unicast initial signalling can be mapped to more than one ProSe service. In the case where different ProSe services are mapped to distinct default Destination Layer-2 IDs, when the UE intends to establish a single unicast link that can be used for more than one ProSe service, the UE can select any of the default Destination Layer-2 IDs to use for the initial signalling.\nNOTE 5:\tSecurity policies for Unicast mode 5G ProSe Direct Communication can be provisioned by PCF as defined in TS 33.503 [29].\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to PC5 QoS parameters defined in clause 5.6.1 (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.).\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to the corresponding NR Tx Profiles for broadcast and groupcast (see TS 38.300 [12] and TS 38.331 [16] for further information).\nNOTE 6:\tA \"catch all\" entry with the lowest priority in each above mapping can be used for the ProSe services that do not have explicit policy/parameters mapping above.\n-\tAS layer configurations (see TS 38.331 [16]), i.e. the mapping of PC5 QoS profile(s) to radio bearer(s), when the UE is \"not served by NG-RAN\".\n-\tThe PC5 QoS profile contains PC5 QoS parameters described in clause 5.4.2 of TS 23.287 [2] and value for the QoS characteristics regarding Priority Level, Averaging Window, Maximum Data Burst Volume if default value is not used as defined in Table 5.4.4-1 of TS 23.287 [2] and in Table 5.6.1-1.\n-\tFor broadcast, groupcast and initial signalling to establish unicast connection, PC5 DRX configuration (see TS 38.331 [16]), e.g. the mapping of PC5 QoS profile(s) to PC5 DRX cycle(s), default PC5 DRX configuration, when the UE is \"not served by NG-RAN\".\n6)\tPath selection policy:\n-\tThe mapping of ProSe services (i.e. ProSe identifiers) to path preference (i.e. PC5 preferred, Uu preferred, or no preference) as defined in clause 5.11.\nNOTE 7:\tThe path selection policy can be a one mapping for all ProSe services, i.e. same path preference for all ProSe services.\n7)\tValidity time indicating the expiration time of the Policy/Parameter for 5G ProSe Direct Communication.\nThe above parameter sets from bullet 2) to 7) may be provided or updated to the UE by the ProSe Application Server.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.5.2.1",
        "clause_5.6.1",
        "ts_23.287_clause_5.4.2",
        "clause_5.11",
        "ts_23.287_table_5.4.4-1",
        "ts_23.287_table_5.6.1-1",
        "ts_33.503",
        "ts_38.300",
        "ts_38.331",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.3.2",
      "section_id": "5.1.3.2",
      "section_title": "Principles for applying parameters for 5G ProSe Direct Communication",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe Direct Communication service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.1",
      "section_id": "5.1.4.1",
      "section_title": "Policy/Parameter provisioning for 5G ProSe UE-to-Network Relay",
      "content": "The following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe UE-to-Network Relay:\n1)\tAuthorisation policy for acting as a 5G ProSe Layer-3 and/or Layer-2 UE-to-Network Relay when \"served by NG-RAN\":\n-\tPLMNs in which the UE is authorized to relay traffic for 5G ProSe Layer-3 and/or Layer-2 Remote UEs.\nThe authorisation for a UE to act as a 5G ProSe UE-to-Network Relay also authorizes the use of 5G ProSe UE-to-Network Relay Discovery with Model A and Model B.\nNOTE 1:\tIt is up to UE and application implementation to select a discovery model or whether to perform both models simultaneously.\n2)\tProSe Relay Discovery policy/parameters for 5G ProSe UE-to-Network Relay:\n-\tIncludes the parameters that enable the UE to perform 5G ProSe UE-to-Network Relay Discovery when provided by PCF or provisioned in the ME or configured in the UICC:\n-\t5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay Service Code(s), UE-to-Network Relay Layer Indicator per RSC, optional Control Plane Security Indicator per RSC). The UE-to-Network Relay Layer Indicator indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-Network Relay service. If the Control Plane Security Indicator is provided for a RSC, then the Control Plane based security procedure as described in clause 5.1.4.3.2 is performed for UE-to-Network Relay Communication for that RSC, otherwise if it is not provided for a RSC, then the User Plane based security procedure as described in clause 5.1.4.3.3 is performed for that RSC. RSC dedicated for emergency service may also be provisioned.\n-\tDefault Destination Layer-2 ID(s) for sending Relay Discovery Announcement and Relay Discovery Additional Information messages and receiving Relay Discovery Solicitation messages;\n-\tFor 5G ProSe Layer-3 UE-to-Network Relay, the PDU Session parameters (PDU Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference) to be used for the relayed traffic for each ProSe Relay Service Code;\n-\tIncludes security related content for 5G ProSe UE-to-Network Relay, see TS 33.503 [29].\nNOTE 2:\t5G ProSe Relay Discovery policy/parameters can be provided from ProSe Application Server to the 5G ProSe UE-to-Network Relay, except for the Security parameters in bullet 2).\n3)\tFor 5G ProSe Layer-3 UE-to-Network Relay, QoS mapping(s):\n-\tEach QoS mapping entry includes:\n-\ta mapping between a 5QI value and a PQI value;\n-\ta PQI PDB adjustment factor, for the PC5 communication for the 5G ProSe Layer-3 UE-to-Network Relay operation;\n-\toptional the Relay Service Code(s) associates with the QoS mapping entry.\n4)\tFor 5G ProSe Layer-3 UE-to-Network Relay to relay Ethernet or Unstructured traffic from 5G ProSe Layer-3 Remote UE by using IP type PDU Session:\n-\tMapping of ProSe Service(s) to ProSe Application Server address information (consisting of IP address/FQDN and transport layer port number).\n5)\tParameters to broadcast warning messages:\n-\tConfigured Destination Layer-2 ID(s);\n-\tPC5 QoS parameters defined in clause 5.6.1;\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nNOTE 3:\tIt is up to inter operator alignment and network configuration whether a common Destination Layer-2 ID or IDs are used for all UEs cross PLMNs in a particular region for Public Warning Notification Relaying.\n6)\tValidity time indicating the expiration time of the Policy/Parameter for 5G ProSe UE-to-Network Relay discovery and communication.\nThe following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe Remote UE and thereby enabling the use of a 5G ProSe UE-to-Network Relay:\n1)\tAuthorisation policy for using a 5G ProSe Layer-3 and/or Layer-2 UE-to-Network Relay:\n-\tFor 5G ProSe Layer-3 Remote UE, indicates whether the UE is authorised to use a 5G ProSe Layer-3 UE-to-Network Relay.\n-\tFor 5G ProSe Layer-2 Remote UE, indicates the PLMNs in which the UE is authorized to use a 5G ProSe Layer-2 UE-to-Network Relay.\nThe authorisation for a UE to act as a 5G ProSe Remote UE also authorizes the use of 5G ProSe UE-to-Network Relay discovery with Model A and Model B.\nNOTE 4:\tIt is up to UE and application implementation to select a discovery model or whether to perform both models simultaneously.\n2)\tPolicy/parameters for 5G ProSe UE-to-Network Relay Discovery:\n-\tIncludes the parameters for 5G ProSe Relay Discovery and for enabling the UE to connect to the 5G ProSe UE-to-Network Relay after discovery when provided by PCF or provisioned in the ME or configured in the UICC:\n-\t5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay Service Code(s), UE-to-Network Relay Layer indicator per RSC, optional Control Plane Security Indicator per RSC). The UE-to-Network Relay Layer Indicator indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-Network Relay service. If the Control Plane Security Indicator is provided for a RSC, then the Control Plane based security procedures as described in clause 5.1.4.3.2 is performed for UE-to-Network Relay Communication for that RSC, otherwise if it is not provided for a RSC, then the User Plane based security procedures as described in clause 5.1.4.3.3 is performed for that RSC. RSC(s) dedicated for emergency service may be provisioned to enable the support of emergency services for UE-to-Network Relaying.\n-\tDefault Destination Layer-2 ID(s) for sending Relay Discovery Solicitation messages and receiving Relay Discovery Announcement and Relay Discovery Additional Information messages;\n-\tFor 5G ProSe Layer-3 UE-to-Network Relay, the PDU Session parameters (PDU Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference) to be used for the relayed traffic without using N3IWF access, or an indication of N3IWF access, for each ProSe Relay Service Code;\n-\tFor 5G ProSe Layer-3 UE-to-Network Relay, optionally the ProSe application Traffic Descriptor(s) (as defined in TS 23.503 [9]) to be used for the relayed traffic for each ProSe Relay Service Code;\n-\tIncludes security related content for 5G ProSe UE-to-Network Relay, see TS 33.503 [29].\n3)\tPolicy/parameters for N3IWF selection for 5G ProSe Layer-3 Remote UE:\n-\tN3IWF identifier configuration for 5G ProSe Layer-3 Remote UE (either FQDN or IP address) in the HPLMN.\n-\t5G ProSe Layer-3 UE-to-Network Relay access node selection information - a prioritized list of PLMNs for N3IWF selection. It also indicates if selection of an N3IWF in a PLMN should be based on Tracking Area Identity FQDN or on Operator Identifier FQDN.\nNOTE 5:\t5G ProSe Relay Discovery policy/parameters can be provided from ProSe Application Server to the 5G ProSe Remote UE, except for the Security parameters in bullet 2).\n4)\tParameters to receive warning messages:\n-\tConfigured Destination Layer-2 ID(s);\n-\tPC5 QoS parameters defined in clause 5.6.1;\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nNOTE 6:\tIt is up to inter operator alignment and network configuration whether a common Destination Layer-2 ID or IDs are used for all UEs cross PLMNs in a particular region for Public Warning Notification Relaying.\n5)\tValidity time indicating the expiration time of the Policy/Parameter for 5G ProSe UE-to-Network Relay discovery and communication.\nThe following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe UE-to-Network Relay as well as in the UE in support of the UE assuming the role of a 5G ProSe Remote UE and thereby enabling the use of a 5G ProSe UE-to-Network Relay:\n1)\tRadio parameters for 5G ProSe UE-to-Network Relay Discovery when the UE is not \"served by NG-RAN\":\n-\tIncludes the radio parameters NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform 5G ProSe Direct Discovery over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\n-\tDefault PC5 DRX configuration (see TS 38.331 [16]).\n2)\tRadio parameters for 5G ProSe UE-to-Network Relay communication when the UE is not \"served by NG-RAN\":\n-\tIncludes the radio parameters NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform 5G ProSe Direct Communication over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\nNOTE 7:\tThe validity time of these radio parameters is the same as the validity time of the Policy/Parameter listed above for 5G ProSe UE-to-Network Relay or 5G ProSe Remote UE.\n3)\tPolicy/parameters related to privacy:\n-\tA privacy timer value indicating the duration after which the UE shall change each source Layer-2 ID self-assigned by the UE when privacy is required.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.4.3.2",
        "clause_5.1.4.3.3",
        "clause_5.6.1",
        "clause_5.1.3.1",
        "ts_33.503",
        "ts_23.503",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.2.1",
      "section_id": "5.1.4.2.1",
      "section_title": "Principles for applying parameters for ProSe UE-to-Network Relay discovery",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe UE-to-Network Relay discovery service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.2.2",
      "section_id": "5.1.4.2.2",
      "section_title": "Principles for applying parameters for 5G ProSe UE-to-Network Relay communication",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe UE-to-Network Relay communication service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.3.1",
      "section_id": "5.1.4.3.1",
      "section_title": "General",
      "content": "Security procedures over Control Plane and User Plane are specified for 5G ProSe UE-to-Network relaying in TS 33.503 [29].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.3.2",
      "section_id": "5.1.4.3.2",
      "section_title": "Control Plane based security procedures for 5G ProSe UE-to-Network Relay",
      "content": "Control Plane-based security procedures for 5G ProSe UE-to-Network Relay call flow and procedure are defined in TS 33.503 [29], characterised by the following principles:\n-\t5G ProSe UE-to-Network Relay's NAS signalling is used for the control plane based security procedure to authenticate and authorize a 5G ProSe Remote UE.\n-\tA UE assuming the role of 5G ProSe UE-to-Network Relay can be configured to use a set of slices supporting Control Plane based security procedure. An AMF supporting Control Plane based security procedure for a 5G ProSe UE-to-Network Relay is selected as part of the slice. The 5G ProSe UE-to-Network Relay shall include in discovery messages the RSCs with the Control Plane Security Indicator set, as specified in clause 5.1.4.1, when the requested slice(s) corresponds to Control Plane based security procedure is(are) accepted. In addition, the 5G ProSe UE-to-Network Relay shall includes in discovery messages the RSCs without Control Plane Security Indicator as specified in clause 5.1.4.1.\n-\tA 5G ProSe-enabled UE shall use Control Plane based security procedures if a RSC with Control Plane Security Indicator set is used by the Remote UE to establish the connection. Otherwise, if a RSC without Control Plane Security Indicator is used by the Remote UE to establish the connection, the 5G ProSe-enabled UEs shall use User Plane based security procedures as specified in clause 5.1.4.3.3.\n-\tThe AMF serving the 5G ProSe UE-to-Network Relay selects AUSF as specified in clause 6.3.4 of TS 23.501 [4] using the identification information the 5G ProSe Remote UE provided as specified in clause 6.3.3.3.2 of TS 33.503 [29].\n-\tIf the 5G ProSe Remote UE is configured by HPLMN to use control plane security procedure, the 5G ProSe Remote UE's HPLMN AUSF shall support control plane based security procedure.\n-\tIf a network intends to use control plane security procedure, then all the AMFs within the network slices that the 5G ProSe UE-to-Network Relay uses shall support the control plane based security procedures.\nNOTE:\tIf the control plane security procedure is not supported, then the 5G ProSe Remote UE can select another 5G ProSe UE-to-Network Relay or user plane based security can be used.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.1.4.1",
        "clause_5.1.4.3.3",
        "ts_23.501_clause_6.3.4",
        "ts_33.503_clause_6.3.3.3.2",
        "ts_33.503",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.4.3.3",
      "section_id": "5.1.4.3.3",
      "section_title": "User Plane based security procedures",
      "content": "User Plane-based security procedures for 5G ProSe UE-to-Network Relay are defined in TS 33.503 [29].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.5.1",
      "section_id": "5.1.5.1",
      "section_title": "Policy/Parameter provisioning for 5G ProSe UE-to-UE Relay",
      "content": "The following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe UE-to-UE Relay:\n1)\tAuthorisation policy for acting as a 5G ProSe Layer-3 and/or Layer-2 UE-to-UE Relay:\n-\twhen the UE is \"served by NG-RAN\":\n-\tPLMNs in which the UE is authorized to relay traffic for 5G ProSe Layer-3 and/or Layer-2 End UEs accessing 5G ProSe UE-to-UE Relays over PC5 reference point.\n-\twhen the UE is not \"served by NG-RAN\":\n-\tIndicates whether the UE is authorized to relay traffic for 5G ProSe Layer-3 and/or Layer-2 End UEs accessing 5G ProSe UE-to-UE Relays over PC5 reference point.\n-\tThe authorisation for a UE to act as a 5G ProSe UE-to-UE Relay also authorizes the use of 5G ProSe UE-to-UE Relay Discovery with Model A and Model B.\nNOTE 1:\tIt is up to UE and application implementation to select a discovery model, or whether to perform both models simultaneously.\n2)\tProSe Relay Discovery policy/parameters for 5G ProSe UE-to-UE Relay:\n-\tIncludes the parameters that enable the UE to perform 5G ProSe UE-to-UE Relay Discovery when provided by PCF or provisioned in the ME or configured in the UICC:\n-\t5G ProSe UE-to-UE Relay Discovery parameters (User Info ID, Relay Service Code(s), UE-to-UE Relay Layer indicator, Network Assistance Security Indicator). The UE-to-UE Relay Layer indicator indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-UE Relay service. Network Assistance Security Indicator indicates whether the associated RSC is offering security procedures with or without network assistance when the 5G ProSe UE-to-UE Relay is served by NG-RAN.\n-\tDefault Destination Layer-2 ID(s) for sending Relay Discovery Announcement message and sending/receiving Relay Discovery Solicitation messages;\n-\tDefault Destination Layer-2 ID(s) for sending/receiving Direct Communication Request message for ProSe UE-to-UE Relay Communication with integrated Discovery;\n-\tFor 5G ProSe Layer-3 UE-to-UE Relay, the traffic type (IP, Ethernet, Unstructured) to be used for the relayed traffic for each Relay Service Code;\n-\tIncludes security related content for 5G ProSe UE-to-UE Relay, see TS 33.503 [29].\nNOTE 2:\tThe security mechanism selection according to Network Assistance Security Indicator is specified in TS 33.503 [29].\n3)\tValidity time indicating the expiration time of the Policy/Parameter for 5G ProSe UE-to-UE Relay discovery and communication.\nThe following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe End UE and thereby enabling the use of a 5G ProSe UE-to-UE Relay:\n1)\tAuthorisation policy for using a 5G ProSe Layer-3 and/or Layer-2 UE-to-UE Relay:\n-\tWhen the UE is \"served by NG-RAN\":\n-\tPLMNs in which the UE is authorized to use a 5G ProSe Layer-3 and/or Layer-2 UE-to-UE Relay.\n-\tWhen the UE is \"not served by NG-RAN\":\n-\tIndicates whether the UE is authorised to use a 5G ProSe Layer-3 and/or Layer-2 UE-to-UE Relay.\nThe authorisation for a UE to act as a 5G ProSe End UE also authorizes the use of 5G ProSe UE-to-UE Relay discovery with Model A and Model B.\nNOTE 3:\tIt is up to UE and application implementation to select a discovery model, or whether to perform both models simultaneously.\n2)\tPolicy/parameters for 5G ProSe UE-to-UE Relay Discovery:\n-\tIncludes the parameters for 5G ProSe UE-to-UE Relay Discovery as a 5G ProSe End UE and for enabling the UE to connect to the 5G ProSe UE-to-UE Relay after discovery when provided by PCF or provisioned in the ME or configured in the UICC:\n-\t5G ProSe UE-to-UE Relay Discovery parameters (Relay Service Code(s), UE-to-UE Relay Layer indicator, Network Assistance Security Indicator). The UE-to-UE Relay Layer indicator indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-UE Relay service. Network Assistance Security Indicator indicates whether the associated RSC is offering security procedures with or without network assistance when the 5G ProSe UE-to-UE Relay is served by NG-RAN.\n-\tDefault Destination Layer-2 ID(s) for sending/receiving Relay Discovery Solicitation messages and receiving Relay Discovery Announcement message;\n-\tDefault Destination Layer-2 ID(s) for sending/receiving Direct Communication Request message for ProSe UE-to-UE Relay Communication with integrated Discovery;\n-\tFor 5G ProSe Layer-3 UE-to-UE Relay, the traffic type (IP, Ethernet, Unstructured) to be used for the relayed traffic for each Relay Service Code;\n-\tIncludes security related content for 5G ProSe UE-to-UE Relay, see TS 33.503 [29].\nNOTE 4:\tThe security mechanism selection according to Network Assistance Security Indicator is specified in TS 33.503 [29].\n3)\tValidity time indicating the expiration time of the Policy/Parameter for 5G ProSe UE-to-UE Relay discovery and communication.\nThe following information is provisioned in the UE in support of the UE assuming the role of a 5G ProSe UE-to-UE Relay as well as in the UE in support of the UE assuming the role of a 5G ProSe End UE and thereby enabling the use of a 5G ProSe UE-to-UE Relay:\n1)\tRadio parameters for 5G ProSe UE-to-UE Relay Discovery when the UE is not \"served by NG-RAN\":\n-\tIncludes the radio parameters NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform 5G ProSe Direct Discovery over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\n-\tDefault PC5 DRX configuration (see TS 38.331 [16]).\nNOTE 5:\tRadio parameters for 5G ProSe UE-to-UE Relay Discovery when the UE is not \"served by NG-RAN\" and Radio parameters when the UE is \"not served by NG-RAN\" for 5G ProSe Direct Discovery in clause 5.1.2.1 are expected to be aligned for direct and relayed discovery for UE to UE communication.\n2)\tRadio parameters for 5G ProSe UE-to-UE Relay communication when the UE is not \"served by NG-RAN\":\n-\tIncludes the radio parameters NR PC5 with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". The UE uses the radio parameters to perform 5G ProSe Direct Communication over PC5 reference point when \"not served by NG-RAN\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\nNOTE 6:\tRadio parameters for 5G ProSe UE-to-UE Relay communication when the UE is not \"served by NG-RAN\" and Radio parameters when the UE is \"not served by NG-RAN\" for 5G ProSe Direct Communication in clause 5.1.3.1 are expected to be aligned for direct and relayed UE to UE communication.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.2.1",
        "clause_5.1.3.1",
        "ts_33.503",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.5.2.1",
      "section_id": "5.1.5.2.1",
      "section_title": "Principles for applying parameters for ProSe UE-to-UE Relay discovery",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe UE-to-UE Relay discovery service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.1.5.2.2",
      "section_id": "5.1.5.2.2",
      "section_title": "Principles for applying parameters for 5G ProSe UE-to-UE Relay communication",
      "content": "The general principles for applying policy/parameters defined in clause 5.1.1a apply to the 5G ProSe UE-to-UE Relay communication service.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.2.1",
      "section_id": "5.2.1",
      "section_title": "General",
      "content": "5G ProSe Direct Discovery is defined as the process that detects and identifies another UE in proximity via NR PC5 reference point. As defined in clause 5.3.1.1 in TS 23.303 [3], 5G ProSe Direct Discovery can be open or restricted; it can be standalone or used for subsequent actions e.g. to initiate 5G ProSe Direct Communication.\nIn the case of inter-PLMN ProSe discovery and communication over PC5 reference point, the PC5 parameters need to be configured in a consistent way among the UEs within a certain region. The architecture for the Inter-PLMN PC5 case is defined in clause 4.2.3.\nThe UEs may use the PC5 DRX mechanism to perform 5G ProSe Direct Discovery and 5G ProSe UE-to-Network Relay Discovery over PC5 reference point as specified in clause 5.13.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.303_clause_5.3.1.1",
        "clause_4.2.3",
        "clause_5.13",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.2.2",
      "section_id": "5.2.2",
      "section_title": "5G ProSe Direct Discovery Models",
      "content": "There are two models for 5G ProSe Direct Discovery: Model A and Model B which are defined in clause 5.3.1.2 in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303_clause_5.3.1.2",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.2.3",
      "section_id": "5.2.3",
      "section_title": "5G ProSe UE-to-Network Relay Discovery",
      "content": "For 5G ProSe UE-to-Network Relay discovery, both Model A and Model B discovery are supported:\n-\tModel A uses a single discovery protocol message (Announcement).\n-\tModel B uses two discovery protocol messages (Solicitation and Response).\nFor Relay Discovery Additional Information, only Model A discovery is used.\nThe procedures for 5G ProSe UE-to-Network Relay discovery are defined in clause 6.3.2.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.2.4",
      "section_id": "5.2.4",
      "section_title": "5G ProSe Direct Discovery Characteristics",
      "content": "5G ProSe Direct Discovery over the PC5 reference point has the following characteristics:\n-\tPC5 communication channel is used to carry the discovery message over PC5. The discovery message over PC5 is differentiated with other PC5 messages by AS layer.\n-\tProSe layer shall indicate to AS layer whether the signalling is discovery message or PC5-S message.\nNOTE 1:\tThe discovery message format is defined in stage 3.\nGroup discovery/management to support on demand-based group communication for commercial services has the following characteristics:\n-\tThe group discovery/formation/management can be carried out in the Application layer in coordination with the Application Server.\n-\tApplication layer signalling between the UE and the Application Server is out of scope of this specification.\n5G ProSe Direct Discovery with 5G DDNMF has the following characteristics:\n-\t5G DDNMF in the 5GS is used for 5G ProSe Discovery Direct Code management (including allocation and resolution). The 5G DDNMF gets the PDUID from the PCF and subscribes to notifications on Change of PDUID.\n-\t5G DDNMF is defined in clause 4.3.2 and the detail procedure for 5G ProSe Direct Discovery with 5G DDNMF is defined in clause 6.3.\nGroup discovery/management to support public safety has the following characteristics:\n-\tPre-configured or provisioned information can be used for the 5G ProSe Direct Discovery procedure as defined in clause 5.1.2.\nThe information elements included in the 5G ProSe Direct Discovery messages are described in clause 5.8.1 and clause 6.3.2.\nNOTE 2:\tBased on UE implementation, the application layer discovery messages are exchanged either as user traffic over PC5 or alternatively as part of metadata in PC5 Direct Discovery message as specified in clause 6.3.2.1 and clause 6.4.2. In the latter case, the PC5 Direct Discovery message can contain additional field carrying application layer metadata information, e.g., the Application layer discovery messages for group discovery. The format and contents of this additional field is out of scope of 3GPP. Performance of the PC5 Direct Discovery message including the application layer information will be affected if the resulted PC5 Direct Discovery message size is too big, e.g. longer delay and lower reliability.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3.2",
        "clause_6.3",
        "clause_5.1.2",
        "clause_5.8.1",
        "clause_6.3.2",
        "clause_6.3.2.1",
        "clause_6.4.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.2.5",
      "section_id": "5.2.5",
      "section_title": "5G ProSe UE-to-UE Relay Discovery",
      "content": "For 5G ProSe UE-to-UE Relay Discovery, both Model A and Model B discovery are supported:\n-\tModel A uses a single discovery protocol message (Announcement).\n-\tModel B uses two discovery protocol messages (Solicitation and Response).\nThe procedures for 5G ProSe UE-to-UE Relay Discovery with Model A/Model B are defined in clause 6.3.2.4.\n5G ProSe UE-to-UE Relay Communication with integrated Discovery is also supported as specified in clause 6.7.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2.4",
        "clause_6.7.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.3.1",
      "section_id": "5.3.1",
      "section_title": "General",
      "content": "5G ProSe Direct Communication over PC5 reference point is supported when the UE is \"served by NG-RAN\" or when the UE is \"not served by NG-RAN\". A UE is authorized to perform 5G ProSe Direct Communication when it has valid authorization and configuration as specified in clause 5.1.3. 5G ProSe Direct Communication supports both the cases of public safety and commercial service.\n5G ProSe Direct Communication over NR based PC5 reference point supports broadcast mode, groupcast mode and unicast mode.\nFor broadcast and groupcast mode 5G ProSe Direct Communication, the following data unit types are supported: IPv4, IPv6, Ethernet, Unstructured and Address Resolution Protocol (see RFC 826 [19]).\nFor unicast mode 5G ProSe Direct Communication, the following data unit types are supported: IPv4, IPv6, Ethernet and Unstructured.\nThe identifiers used in the 5G ProSe Direct Communication over PC5 reference point are described in clause 5.8.2.\nThe QoS handling and procedures for the 5G ProSe Direct Communication over PC5 reference point are defined in clauses 5.6 and 6.4.\nThe UEs may use the PC5 DRX mechanism to perform 5G ProSe Direct Communication over PC5 reference point as specified in clause 5.13.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.3",
        "clause_5.8.2",
        "clause_5.13"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.3.2",
      "section_id": "5.3.2",
      "section_title": "Broadcast mode 5G ProSe Direct Communication",
      "content": "Broadcast mode of 5G ProSe direct communication is supported over NR based PC5 reference point. The transmitting UE in broadcast communication determines the destination Layer-2 ID for broadcast as specified in clause 5.8.2 and assigns itself a source Layer-2 ID. The receiving UE determines the destination Layer-2 ID for broadcast reception as specified in clause 5.8.2. The transmitting UE determines the PC5 QoS parameters for this broadcast as specified in clause 5.6.1. The transmitting UE sends the service data using the source Layer-2 ID and the destination Layer-2 ID.\nFor IP type 5G ProSe direct communication over PC5 reference point, the mechanism for IP address allocation is described in clause 5.5.1.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.6.1",
        "clause_5.5.1.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.3.3",
      "section_id": "5.3.3",
      "section_title": "Groupcast mode 5G ProSe Direct Communication",
      "content": "Groupcast mode of 5G ProSe direct communication is supported over NR based PC5 reference point. Group management is carried out by the application layer in coordination with Application Server and is out of scope of this specification. For commercial services, the Application Layer Group ID is provided by Application Server; and for public safety services, the pre-configured or provisioned Application Layer Group ID will be used for groupcast communication. The group size and member ID information could be used for groupcast control if it is provided by the application layer.\nThe transmitting UE in groupcast communication determines a source Layer-2 ID and a destination Layer-2 ID and the receiving UE determines destination Layer-2 ID, as specified in clause 5.8.2. The transmitting UE determines the PC5 QoS parameters for this groupcast as specified in clause 5.6.1. The transmitting UE sends the service data using the source Layer-2 ID and the destination Layer-2 ID.\nFor IP type 5G ProSe direct communication over PC5 reference point, the mechanism for IP address allocation is described in clause 5.5.1.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.6.1",
        "clause_5.5.1.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.3.4",
      "section_id": "5.3.4",
      "section_title": "Unicast mode 5G ProSe Direct Communication",
      "content": "Unicast mode of 5G ProSe direct communication is supported over NR based PC5 reference point. A PC5 unicast link between two UEs is established for the 5G ProSe direct communication; and the PC5 unicast link could be maintained, modified and released according to the application layer requests or communication requirements.\nFor the PC5 unicast link of the 5G ProSe direct communication, the principal for the PC5 unicast link of V2X communication described in TS 23.287 [2] clause 5.2.1.4 is reused with the following differences:\n-\tV2X service is replaced by ProSe Application;\n-\tV2X service type is replaced by ProSe identifier;\n-\tNew data unit types are supported (including IPv4, Ethernet and Unstructured).\nFor IP type 5G ProSe direct communication over PC5 reference point, the mechanism for IP address/prefix allocation is described in clause 5.5.1.1. The PC5 QoS handling for the unicast mode 5G ProSe direct communication is specified in clause 5.6.1.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_5.2.1.4",
        "clause_5.5.1.1",
        "clause_5.6.1",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.1.1",
      "section_id": "5.4.1.1",
      "section_title": "General",
      "content": "The 5G ProSe Layer-3 UE-to-Network Relay shall provide generic function that can relay any IP, Ethernet or Unstructured traffic:\n-\tFor IP traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay uses IP type PDU Session towards 5GC.\n-\tFor Ethernet traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay can use Ethernet type PDU Session or IP type PDU Session towards 5GC.\n-\tFor Unstructured traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay can use Unstructured type PDU Session or IP type PDU Session (i.e. IP encapsulation/de-capsulation by 5G ProSe Layer-3 UE-to-Network Relay) towards 5GC.\nThe type of traffic supported over PC5 reference point is indicated by the 5G ProSe Layer-3 UE-to-Network Relay e.g. using the corresponding RSC. The 5G ProSe Layer-3 UE-to-Network Relay determines the PDU Session Type based on configuration of the mapping between PDU Session parameters and RSC, as specified in clause 5.1.4.1.\nIP type PDU Session and Ethernet type PDU Session can be used to support more than one 5G ProSe Layer-3 Remote UEs while Unstructured type PDU Session can be used to support only one 5G ProSe Layer-3 Remote UE.\nNOTE:\tThe maximum number of PDU Sessions can affect the maximum number of 5G ProSe Layer-3 Remote UEs that the 5G ProSe UE-to-Network Relay can support.\nThe 5G ProSe Layer-3 UE-to-Network Relay provides the functionality to support indirect connectivity to the 5GS for 5G ProSe Layer-3 Remote UEs. A 5G ProSe Layer-3 Remote UE can be located within NG-RAN coverage or outside of NG-RAN coverage.\nThe 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay may use the PC5 DRX mechanism to perform 5G ProSe UE-to-Network Relay Communications over PC5 reference point as specified in clause 5.13.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.4.1",
        "clause_5.13"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.1.2",
      "section_id": "5.4.1.2",
      "section_title": "5G ProSe Layer-3 UE-to-Network Relay with N3IWF support",
      "content": "To support 5G ProSe Layer-3 Remote UE services with end-to-end confidentiality and IP address preservation requirements, the 5G ProSe Layer-3 UE-to-Network Relay with N3IWF shall provide access to the 5GC for the 5G ProSe Layer-3 Remote UE via N3IWF using the features defined in clause 4.2.8 of TS 23.501 [4].\n5G ProSe Layer-3 UE-to-Network Relay is provisioned with RSC(s) and the corresponding PDU session parameters (e.g. S-NSSAI) to support N3IWF access as part of 5G ProSe Layer-3 UE-to-Network Relay Policy/parameters. When a 5G ProSe Layer-3 Remote UE connects with the corresponding RSC, the 5G ProSe Layer-3 UE-to-Network Relay determines the corresponding PDU session parameters based on the requested RSC.\nNOTE:\tThe 5G ProSe Layer-3 UE-to-Network Relay only includes a RSC in discovery message when the corresponding PDU session parameters (e.g. S-NSSAI) are authorized to be used in the accessed network.\nThe 5G ProSe Layer-3 Remote UE selects N3IWF as specified in clause 6.5.1.2.2. The selection of N3IWF follows the regulatory rules of the country where it is located and when required by the regulations the 5G ProSe Layer-3 Remote UE only selects a N3IWF within the local country. QoS differentiation can be provided on per-IPsec Child Security Association basis and the details are provided in clause 5.6.2.2.\nThe 5GC to which the 5G ProSe Layer-3 UE-to-Network Relay registers and the 5GC to which the 5G ProSe Layer-3 Remote UE registers may be in the same PLMN or different PLMN.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.501_clause_4.2.8",
        "clause_6.5.1.2.2",
        "clause_5.6.2.2",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.1.3",
      "section_id": "5.4.1.3",
      "section_title": "Policy control and session binding to support 5G ProSe Layer-3 UE-to-Network Relay without N3IWF",
      "content": "To enable support for policy control for 5G ProSe Layer-3 Remote UEs accessing 5GC via a 5G ProSe Layer-3 UE-to-Network Relay without involving N3IWF, the policy control functionality specified in TS 23.503 [9] is applied with the following functionalities:\n-\tFor non-emergency service over the 5G ProSe Layer-3 UE-to-Network Relay, the SMF and PCF shall be configured with DNN(s) dedicated for UE-to-Network Relay connectivity, as specified in clause 5.1.4.1.\nNOTE 1:\tIf Local Breakout configuration is supported for relay connectivity, the DNN dedicated for UE-to-Network Relay connectivity needs to be well-known DNN to allow seamless operation across various operators' networks.\nNOTE 2:\tFor emergency service over the 5G ProSe Layer-3 UE-to-Network Relay (as specified in clause 5.4.4.3), emergency DNN configured in the Relay's AMF (as specified in clause 5.16.4 of TS 23.501 [4]) is used.\n-\tThe AF discovers the PCF serving the 5G ProSe Layer-3 UE-to-Network Relay PDU Session as specified in clause 6.1.1.2 of TS 23.503 [9].\n-\tThe PCF may validate any 5G ProSe Layer-3 Remote UE related service information from the AF based on roaming agreement and the DNN dedicated for UE-to-Network Relay connectivity for non-emergency service from the 5G ProSe Layer-3 Remote UE or emergency DNN for emergency service from the 5G ProSe Layer-3 Remote UE.\nNOTE 3:\tFor 5G ProSe Layer-3 UE-to-Network Relay connectivity, the UE identity that the SMF has provided (i.e. 5G ProSe Layer-3 UE-to-Network Relay Identity) and a UE identity provided by the AF (i.e. 5G ProSe Layer-3 Remote UE Identity) can be different, while the Session binding with the PDU Session is valid.\n-\tThe 5G ProSe Layer-3 Remote UEs may be assigned a /64 IPv6 Prefix from a shorter IPv6 prefix by the 5G ProSe Layer-3 UE-to-Network Relay. A /64 IPv6 Prefix from a shorter IPv6 prefix needs to be assigned to support policy control and session binding of a 5G ProSe Layer-3 Remote UE behind a 5G ProSe Layer-3 UE-Network Relay.\n-\tFor a PDU Session to the DNN dedicated for 5G ProSe Layer-3 UE-to-Network Relay connectivity and using IPv6 prefix delegation (i.e. the assigned IPv6 network prefix is shorter than 64), the PCF shall perform session binding based on the IPv6 network prefix only. A successful session binding occurs whenever a longer prefix received from an AF matches the prefix value of the PDU Session. PCF shall not use the UE Identity for session binding for this PDU Session.\nNOTE 4:\tSupport for policy control of Remote UEs behind a 5G ProSe Layer-3 UE-Network Relay using IPv4 is not available.\nNOTE 5:\tIf a /64 IPv6 Prefix from a shorter IPv6 prefix is not assigned to the 5G ProSe Layer-3 Remote UE by the 5G ProSe Layer-3 UE-Network Relay then support for policy control and session binding of 5G ProSe Layer-3 Remote UE behind a 5G ProSe Layer-3 UE-Network Relay is not available.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.4.1",
        "clause_5.4.4.3",
        "ts_23.501_clause_5.16.4",
        "ts_23.503_clause_6.1.1.2",
        "ts_23.503",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.2",
      "section_id": "5.4.2",
      "section_title": "5G ProSe Layer-2 UE-to-Network Relay",
      "content": "The 5G ProSe Layer-2 UE-to-Network Relay provides forwarding functionality that can relay any type of traffic over the PC5 link.\nThe 5G ProSe Layer-2 UE-to-Network Relay provides the functionality to support connectivity to the 5GS for 5G ProSe Layer-2 Remote UEs. A UE is considered to be a 5G ProSe Layer-2 Remote UE if it has successfully established a PC5 link to the 5G ProSe Layer-2 UE-to-Network Relay. A 5G ProSe Layer-2 Remote UE can be located within NG-RAN coverage or outside of NG-RAN coverage.\nFor PLMN selection and relay selection in the 5G ProSe Layer-2 Remote UE:\n-\tThe 5G ProSe Layer-2 Remote UE checks whether the PLMN(s) within the RRC Container (see clause 5.8.3.3) obtained from the 5G ProSe Layer-2 UE-to-Network Relay(s) during 5G ProSe UE-to-Network Relay Discovery in clause 6.3.2.3 are authorized to be connected to via a 5G ProSe Layer-2 UE-to-Network Relay(s) and only the authorized PLMN(s) are then available PLMNs for NAS PLMN selection;\n-\tThe 5G ProSe Layer-2 Remote UE selects the 5G ProSe Layer-2 UE-to-Network Relay considering the selected PLMN by NAS layer.\nNOTE:\tA Layer-2 Remote UE can select a PLMN different from the 5G ProSe Layer-2 UE-to-Network Relay's serving PLMN to access emergency and non-emergency services.\nThe 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay may use the PC5 DRX mechanism to perform 5G ProSe UE-to-Network Relay Communications over PC5 reference point as specified in clause 5.13.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.3.3",
        "clause_6.3.2.3",
        "clause_5.13"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.3",
      "section_id": "5.4.3",
      "section_title": "Mobility Restrictions for 5G ProSe UE-to-Network Relaying",
      "content": "The handling of Mobility Restrictions for 5G ProSe enabled UE follows the principles as specified in clause 5.3.4.1 of TS 23.501 [4] with the following additions and clarifications:\n-\tForbidden Area:\n-\tIn a Forbidden Area, a 5G ProSe enabled UE is not allowed to perform the Relay operation. If the 5G ProSe UE-to-Network Relay operates in a Forbidden Area of the 5G ProSe Remote UE, the 5G ProSe Remote UE is not allowed to access the network via this 5G ProSe UE-to-Network Relay unless the 5G ProSe Remote UE is attempting for emergency service.\n-\tService Area Restriction:\n-\tService Area Restriction is not applicable to 5G ProSe Layer-3 Remote UE.\n-\tService Area Restriction is not applicable to 5G ProSe enabled MCX-subscribed UEs as defined in clause 5.3.4.1 of TS 23.501 [4].\nNOTE 1:\tIt is expected that all 5G ProSe enabled Public Safety UEs are MCX-subscribed as defined in clause 5.16.6 of TS 23.501 [4].\n-\tIn a Non-Allowed Area, a 5G ProSe enabled UE follows the principles of a UE in limited service state as specified in clause 5.9. It cannot perform the Relay operation as 5G ProSe Layer-2 UE-to-Network Relay or 5G ProSe Layer-3 UE-to-Network Relay based on the conditions described in clause 5.9 except for emergency service from the 5G ProSe Remote UE as specified in clause 5.4.4.\n-\tIn a Non-Allowed Area, a 5G ProSe Layer-2 Remote UE follows the principles as specified in clause 5.3.4.1 of TS 23.501 [4], for communication with the network via the 5G ProSe Layer-2 UE-to-Network Relay.\n-\tCore Network type restriction, RAT type restriction:\nIn these cases, a 5G ProSe enabled UE is not able to register in the network for normal service and stays in limited service state and the principles in clause 5.9 shall apply. The 5G ProSe Layer-2 Remote UE is allowed to register to the network via the 5G ProSe UE-to-Network Relay for emergency service.\nNOTE 2:\tClosed Access Group information is not specified for 5G ProSe.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.3.4.1",
        "ts_23.501_clause_5.16.6",
        "clause_5.9",
        "clause_5.4.4",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.4.1",
      "section_id": "5.4.4.1",
      "section_title": "General",
      "content": "When a 5G ProSe enabled UE does not have direct connection to the network for emergency service, the UE may attempt to obtain emergency service via 5G ProSe Layer-2 or Layer-3 UE-to-Network Relay.\nNOTE:\tDirect connection refers to the UE connected to the network via Uu or WLAN. No direct connection to the network for emergency service includes also the case that the RAN broadcast SIB indicates no emergency support as specified in TS 23.122 [14].\nA 5G ProSe enabled UE acting as 5G ProSe UE-to-Network Relay shall have a normal registration (including also normal registration for a 5G ProSe Relay enabled UE in Non-Allowed Area). A 5G ProSe enabled UE in limited-service state shall not act as 5G ProSe UE-to-Network Relay. Mobility Restrictions that are overruled for UE requesting direct emergency service are overruled also for 5G ProSe UE-to-Network Relay that is relaying emergency service as specified in clause 5.4.3.\nA 5G ProSe enabled UE acting as 5G ProSe UE-to-Network Relay shall only advertise its support for relaying emergency services as defined in clause 5.4.4.2 and clause 5.4.4.3 during 5G ProSe UE-to-Network Relay Discovery.\nDedicated RSC(s) for emergency service needs to be provisioned in the 5G ProSe enabled UEs with capability of 5G ProSe UE-to-Network Relay and/or 5G ProSe Remote UE as specified in clause 5.1.4.\nThe dedicated RSC(s) for emergency service are used by the 5G ProSe UE-to-Network Relay and 5G ProSe Remote UE during 5G ProSe UE-to-Network Relay Discovery and PC5 link establishment.\nA PC5 link associated with a dedicated emergency RSC shall be used for emergency service and for emergency service only.\nIf the 5G ProSe UE-to-Network Relay needs to establish RRC Connection when the 5G ProSe Remote UE has requested emergency service over the PC5 link, the 5G ProSe UE-to-Network Relay shall use RRC establishment cause \"emergency\".\nThe existing positioning function as applicable is reused for the 5G ProSe Remote UE. If no other information is available, the location of the 5G ProSe UE-to-Network Relay can be used as Remote UE location estimate.\nFor more information on UE specific behaviour and location handling, refer to TS 23.167 [31].\nPC5 link for emergency services over 5G ProSe UE-to-Network Relay can be established with or without PC5 security; how to establish PC5 security link for emergency service is specified in TS 33.503 [29].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4.3",
        "clause_5.4.4.2",
        "clause_5.4.4.3",
        "clause_5.1.4",
        "ts_23.122",
        "ts_23.167",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.4.2",
      "section_id": "5.4.4.2",
      "section_title": "Emergency service from 5G ProSe Remote UE via via 5G ProSe Layer-2 UE-to-Network Relay",
      "content": "For a 5G ProSe Layer-2 UE-to-Network Relay to participate in the 5G ProSe UE-to-Network Relay Discovery procedure for emergency service (i.e. sending the UE-to-Network Relay Discovery Announcement message or UE-to-Network Relay Discovery Response message), the serving NG-RAN support of emergency services is required, indicated by it broadcasting ims-EmergencySupport in system information as specified in TS 38.300 [12] and TS 38.331 [16]. The 5G ProSe Layer-2 Remote UE may select a different PLMN from the 5G ProSe Layer-2 UE-to-Network Relay. The 5G ProSe Layer-2 Remote UE may select any PLMN within the RRC Container (see clause 5.8.3.3) obtained from any 5G ProSe Layer-2 UE-to-Network Relay(s) which has announced the RSC dedicated for emergency service during 5G ProSe UE-to-Network Relay Discovery in clause 6.3.2.3.\nNOTE:\tWhen emergency support is indicated by RAN, 5G ProSe Layer-2 UE-to-Network Relay can participate in the 5G ProSe UE-to-Network Relay Discovery procedure for emergency service (i.e. sending the UE-to-Network Relay Discovery Announcement message or UE-to-Network Relay Discovery Response message) even if its serving PLMN does not support emergency service.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.3.3",
        "clause_6.3.2.3",
        "ts_38.300",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.4.4.3",
      "section_id": "5.4.4.3",
      "section_title": "Emergency service from 5G ProSe Remote UE via 5G ProSe Layer-3 UE-to-Network Relay",
      "content": "A 5G ProSe Layer-3 UE-to-Network Relay participates in the 5G ProSe UE-to-Network Relay Discovery procedure (i.e., sending the UE-to-Network Relay Discovery Announcement message or UE-to-Network Relay Discovery Response message) for emergency service only when it has received the Emergency Service Support indicator in its latest Registration Accept from the AMF.\nIf PC5 connection is requested using dedicated RSC for emergency service, then the 5G ProSe Layer-3 UE-to-Network Relay sets the RRC Establishment cause to \"emergency\" when establishing an RRC connection.\nFor 5G ProSe Layer-3 UE-to-Network Relay without N3IWF:\n-\tthe 5G ProSe Layer-3 UE-to-Network Relay sets up an emergency PDU Session to support the 5G ProSe Remote UE's emergency service.\n-\tA 5G ProSe Layer-3 UE-to-Network Relay shall only serve emergency services for either itself or for one 5G ProSe Layer-3 Remote UE but not for more than one UE at the same time. In possible conflict case, the prioritisation between the emergency calls is determined by the local regulations, if available. In the absence of local regulations, prioritisation between the emergency calls is 5G ProSe Layer-3 UE-to-Network Relay implementation specific.\n-\tIf a 5G ProSe Layer-3 UE-to-Network Relay is not able to handle relayed emergency services due to having an active emergency service (of its own or for a 5G ProSe Layer-3 Remote UE emergency service), the 5G ProSe Layer-3 UE-to-Network Relay shall not advertise its support of emergency service and shall not respond to any new 5G ProSe Layer-3 Remote UE's requests for relaying emergency services.\nNOTE:\tThe 5G ProSe Layer-3 Remote UE's requests refers to either 5G ProSe UE-to-Network Relay Discovery Solicitation message with model B, or Direct Communication Request message including the dedicated RSC for emergency service.\nWhen a 5G ProSe Layer-3 Remote UE needs to initiate emergency service, it should attempt to use 5G ProSe Communication for emergency service via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF procedures before attempting to establish an emergency PDU Session via 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support.\nFor information on the handling of emergency number, P-CSCF address and access type setting, refer to TS 23.167 [31].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.5.1.1",
      "section_id": "5.5.1.1",
      "section_title": "IP address allocation for unicast mode of 5G ProSe direct communication",
      "content": "For unicast mode of 5G ProSe direct communication, the following mechanism for IP address/prefix allocation may be used:\na)\tDHCP-based IPv4 address allocation with one of the two UEs acting as a DHCP server.\nb)\tIPv6 Stateless Address auto configuration specified in RFC 4862 [17] for assignment of IPv6 prefix, with one of the two UEs acting as IPv6 default router.\nNOTE:\tWhich UE acts as a DHCPv4 server or IPv6 default router is negotiated during secure layer-2 link establishment by exchanging the IP Address Configuration as described in clause 6.4.3.\nc)\tIPv6 link-local addresses as defined in RFC 4862 [17] are formed by UEs locally. The IPv6 link-local addresses are exchanged during the establishment of a secure layer-2 link over PC5. The UEs shall disable duplicate address detection after the layer-2 link is established.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.5.1.2",
      "section_id": "5.5.1.2",
      "section_title": "IP address allocation for broadcast and groupcast modes of 5G ProSe direct communication",
      "content": "For broadcast and groupcast modes of 5G ProSe direct communication, the following source IP address management applies:\na)\tthe UE configures a link local IPv4 address to be used as the source IP address, as defined in clause 4.5.3 of TS 23.303 [3]. If it is not configured with an address, it uses Dynamic Configuration of IPv4 Link-Local Addresses RFC 3927 [18].\nb)\tthe UE configures a link local IPv6 address to be used as the source IP address, as defined in clause 4.5.3 of TS 23.303 [3]. The UE may use this IP address for direct communication without sending Neighbour Solicitation and Neighbour Advertisement message for Duplicate Address Detection.\nNOTE:\tThe destination IP address management for broadcast and groupcast modes of ProSe direct communication is left to UE implementation.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303_clause_4.5.3",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.5.1.3",
      "section_id": "5.5.1.3",
      "section_title": "IP address allocation for communication with a 5G ProSe Layer-3 ProSe UE-to-Network Relay",
      "content": "For communication with a 5G ProSe Layer-3 UE-to-Network Relay, the following mechanism for IP address/prefix allocation applies:\n-\tThe PDU Session Type used for the relay traffic shall support the IP version used by the 5G ProSe Layer-3 Remote UE. If the 5G ProSe Layer-3 Remote UE initiates an allocation of IPv4 address or an IPv6 prefix when the requested IP version is not supported in the corresponding PDU Session then IP address/prefix allocation fails.\na)\tWhen the 5G ProSe Layer-3 Remote UE uses IPv4 to access the external DN:\na1)\tThe IPv4 address allocation and IPv4 parameter configuration via DHCPv4 are performed according to RFC 2131 [24] and RFC 4039 [25] procedures. The IPv4 address provided to the 5G ProSe Layer-3 Remote UE from the 5G ProSe Layer-3 UE-to-Network Relay by DHCPv4 procedure shall correspond to a local IPv4 address range configured in the 5G ProSe Layer-3 UE-to-Network Relay.\na2)\tThe DHCPv4 request from the 5G ProSe Layer-3 Remote UE is always sent subsequent to the establishment of the one-to-one 5G ProSe Direct Communication between the 5G ProSe Layer-3 Remote UE and the 5G ProSe Layer-3 UE-to-Network Relay, see details for the IPv4 address allocation in clause 5.4.4.3 of TS 23.303 [3] with the following difference:\n-\tThe ProSe Relay UE ID of the ProSe UE-to-Network Relay is replaced by the source Layer-2 ID of the 5G ProSe UE-to-Network Relay for PC5 unicast communication.\nb)\tWhen the 5G ProSe Layer-3 Remote UE uses IPv6 to access the external DN:\nb1)\tIPv6 network prefix allocation via IPv6 Stateless Address auto-configuration. Router solicitation from the 5G ProSe Layer-3 Remote UE is always sent subsequent to the establishment of the one-to-one ProSe Direct Communication between the 5G ProSe Layer-3 Remote UE and the 5G ProSe Layer-3 UE-to-Network Relay, see details for IPv6 prefix allocation in clause 5.4.4.2 of TS 23.303 [3] with the following differences:\n-\tThe 5G ProSe Layer-3 UE-to-Network Relay shall obtain the IPv6 prefix assigned to the 5G ProSe Layer-3 Remote UE via prefix delegation function from the network as defined in clause 5.5.2.\n-\tThe ProSe Relay UE ID of the ProSe UE-to-Network Relay is replaced by the source Layer-2 ID of the 5G ProSe UE-to-Network Relay for PC5 unicast communication.\n-\tPDN connection is replaced by PDU Session.\nb2)\tIPv6 parameter configuration via Stateless DHCPv6: The UE may use stateless DHCPv6 for additional parameter configuration.\nb3)\tThe 5G ProSe Layer-3 UE-to-Network Relay assigns IPv6 prefixes from IPv6 prefix range that have been assigned to the PDU Session used for the relay traffic via IPv6 prefix delegation.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.303_clause_5.4.4.3",
        "ts_23.303_clause_5.4.4.2",
        "clause_5.5.2",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.5.1.4",
      "section_id": "5.5.1.4",
      "section_title": "IP address allocation for communication with a 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "For communication with a 5G ProSe Layer-3 UE-to-UE Relay, the following mechanism for IP address/prefix allocation applies:\n-\tIP address allocation mechanisms of unicast mode of 5G ProSe direct communication as described in clause 5.5.1.1 can be reused on each hop between a 5G ProSe End UE and the 5G ProSe Layer-3 UE-to-UE Relay.\n-\tThe 5G ProSe Layer-3 UE-to-UE Relay may provide the IP address of the target 5G ProSe End UE to the source 5G ProSe End UE in the Direct Communication Accept message, if the target 5G ProSe End UE IP address is available at the time.\n-\tThe 5G ProSe End UE may obtain the IP address of other 5G ProSe End UEs via the 5G ProSe Layer-3 UE-to-UE Relay using DNS query.\nNOTE:\t5G ProSe Layer-3 UE-to-UE Relay may support 5G ProSe End UEs of different IP versions by performing IP conversions.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.5.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.5.2",
      "section_id": "5.5.2",
      "section_title": "IPv6 Prefix Delegation via DHCPv6 for 5G ProSe Layer-3 UE-to-Network Relay",
      "content": "IPv6 Prefix Delegation via DHCPv6 for 5G ProSe Layer-3 UE-to-Network Relay is defined in clause 5.8.2.2.4 of TS 23.501 [4].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.8.2.2.4",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.1",
      "section_id": "5.6.1",
      "section_title": "QoS handling for 5G ProSe Direct Communication",
      "content": "In order to support QoS handling for 5G ProSe Direct Communication, the mechanism defined in clause 5.4 of TS 23.287 [2] is reused with the following differences:\n-\tOnly NR PC5 QoS model is used.\n-\tPC5 Packet Filter Set supports three types of packet filters, i.e. the Prose IP Packet Filter Set, ProSe Ethernet Packet Filter Set and the Prose Packet Filter Set. Each PC5 QoS Rule additionally contains the ProSe identifier when the ProSe identifier is not included in the PC5 Packet Filter Set.\n-\tV2X IP Packet Filter Set is replaced by ProSe IP Packet Filter Set.\n-\tV2X Packet Filter Set is replaced by ProSe Packet Filter Set. ProSe Packet Filter Set shall support Packet Filters based on at least any combination of:\n-\tProSe identifier;\n-\tSource/Destination Layer-2 ID;\n-\tApplication Layer ID.\n-\tProSe Ethernet Packet Filter Set that has the same format as the Ethernet Packet Filter Set defined in clause 5.7.6.3 of TS 23.501 [4] is additionally defined.\n-\tV2X application layer is replaced by ProSe application layer.\n-\tV2X layer is replaced by ProSe layer.\n-\tV2X service type is replaced by ProSe identifier.\n-\tUE-PC5-AMBR is only applied for NR PC5.\n-\tThe PQI values are additionally defined. The one-to-one mapping of standardized PQI values that are additionally defined to PC5 QoS characteristics is specified in table 5.6.1-1.\nTable 5.6.1-1: Standardized PQI values that are additionally defined to QoS characteristics mapping\nPQI\nValue\nResource Type\nDefault Priority Level\nPacket Delay Budget\nPacket Error\nRate\nDefault Maximum Data Burst Volume\nDefault\nAveraging Window\nExample Services\n24\nGBR\n(NOTE 1)\n1\n150 ms\n10-2\nN/A\n2000 ms\nMission Critical user plane Push To Talk voice (e.g. MCPTT)\n25\n2\n200 ms\n10-2\nN/A\n2000 ms\nNon-Mission-Critical user plane Push To Talk voice, Conversational Voice\n26\n2\n200 ms\n10-3\nN/A\n2000 ms\nMission Critical Video user plane\n32\n4\n300 ms\n10-3\nN/A\n2000 ms\nConversational Video (Live Streaming)\n33\n3\n100 ms\n10-3\nN/A\n2000 ms\nReal Time Gaming, Process automation monitoring\n34\n5\n600 ms\n10-6\nN/A\n2000 ms\nNon-Conversational Video (Buffered Streaming)\n60\nNon-GBR\n1\n120 ms\n10-6\nN/A\nN/A\nMission Critical delay sensitive signalling (e.g. MC-PTT signalling)\n61\n6\n400 ms\n10-6\nN/A\nN/A\nMission Critical Data (e.g. example services are the same as 5QI 6/8/9 as specified in TS 23.501 [4])\n70\n7\n200 ms\n10-3\nN/A\nN/A\nVoice,\nVideo (Live Streaming)\nInteractive Gaming\n71\n7\n20 ms\n10-6\nN/A\nN/A\nLow Latency eMBB applications Augmented Reality\n92\nDelay Critical GBR\n(NOTE 1)\n5\n5ms\n10-4\n20000 bytes\n2000 ms\nInteractive service - consume VR content with high compression rate via tethered VR headset (See TS 22.261 [6])\n93\n6\n10ms\n10-4\n20000 bytes\n2000 ms\ninteractive service - consume VR content with low compression rate via tethered VR headset;\nGaming or Interactive Data Exchanging (See TS 22.261 [6])\nNOTE 1:\tGBR and Delay Critical GBR PQIs can only be used for unicast PC5 communications.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_5.4",
        "ts_23.501_clause_5.7.6.3",
        "table_5.6.1-1",
        "ts_23.287",
        "ts_23.501",
        "ts_22.261"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.2.1",
      "section_id": "5.6.2.1",
      "section_title": "QoS handling for 5G ProSe Layer-3 UE-to-Network Relay without N3IWF",
      "content": "For a 5G ProSe Layer-3 Remote UE accessing network via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF, the QoS requirement of the relay traffic between 5G ProSe Layer-3 Remote UE and UPF can be satisfied by the corresponding QoS control for the PC5 link between 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay (PC5 QoS control) and the QoS control for the PDU session established between 5G ProSe Layer-3 UE-to-Network Relay and UPF (i.e. Uu QoS control). The PC5 QoS is controlled with PC5 QoS rules and PC5 QoS parameters (e.g. PQI, GFBR, MFBR, PC5 LINK-AMBR) as specified in clause 5.4 of TS 23.287 [2]. The QoS for the PDU session established between the 5G ProSe Layer-3 UE-to-Network Relay and UPF (i.e. Uu QoS control) is controlled with QoS rules and 5G QoS parameters (e.g. 5QI, GFBR, MFBR) as specified in clause 5.7 of TS 23.501 [4].\nAs shown in figure 5.6.2.1-1 below, the end-to-end QoS can be met only when the QoS requirements are properly translated and satisfied over the two legs respectively.\nFigure 5.6.2.1-1: End-to-End QoS translation for 5G ProSe Layer-3 UE-to-Network Relay  operation\nTo achieve this, the QoS mapping can be pre-configured or provided to the 5G ProSe Layer-3 UE-to-Network Relay by the PCF using Prose Policy as specified in clause 5.1.4.1. The QoS mapping includes combinations of the 5QIs and PQIs mapping as entries. The PQI shall have standardized values as defined in Table 5.6.1-1 and in Table 5.4.4-1 of TS 23.287 [2]. The 5QI shall have standardized values as defined in TS 23.501 [4] clause 5.7.4. The QoS mapping also includes an adjustment factor for the PQI's PDB, e.g. 1/5 of the standardized PDB value in Table 5.6.1-1 and Table 5.4.4-1 of TS 23.287 [2].\nIf the QoS Flows setup are initiated by network, the SMF can base on the PCC rules or its local configuration to generates the QoS rules and QoS Flow level QoS parameters (e.g. 5QI, GFBR, MFBR) and signal to the 5G ProSe Layer-3 UE-to-Network Relay using PDU Session Establishment/Modification procedure. For the PDU sessions used for relaying, the SMF always provides the QoS Flow level QoS parameters to the 5G ProSe Layer-3 UE-to-Network Relay when establishes a QoS Flow. Then the 5G ProSe Layer-3 UE-to-Network Relay decides the PC5 QoS parameters for the corresponding PC5 QoS Flow by determining the PQI based the QoS mapping and the GFBR and MFBR values for the PC5 GBR QoS Flow are set equal to the GFBR and MFBR values for the GBR QoS Flow respectively. The PCF differentiates the relay traffic based on either local configuration, e.g.by a dedicated DNN or S-NSSAI used for relay traffic or by the traffic filters.\nNOTE:\tSeparate QoS mappings can be configured for different RSCs.\nIf the 5G ProSe Layer-3 Remote UE initiates PC5 QoS Flows setup or modification during the Layer-2 link establishment or modification procedure, the 5G ProSe Layer-3 Remote UE provides the QoS Info as described in clause 6.4.3.6 to the 5G ProSe Layer-3 UE-to-Network Relay. The received PC5 QoS parameters of the QoS Info (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) are interpreted as the end-to-end QoS requirements by the 5G ProSe Layer-3 UE-to-Network Relay for the traffic transmission between 5G ProSe Layer-3 Remote UE and UPF. If the end-to-end QoS requirements can be supported by an entry in QoS mapping, the 5G ProSe Layer-3 UE-to-Network Relay uses the 5QI of the entry for the Uu QoS control and uses the PQI of the entry for the PC5 QoS control. If the end-to-end QoS requirements cannot be supported by any entries in QoS mapping, the 5G ProSe Layer-3 UE-to-Network Relay, based on its implementation, decides the 5QI for the Uu QoS control and PQI for the PC5 QoS control. The 5G ProSe Layer-3 UE-to-Network Relay provides the QoS Info (including PQI value chosen by the 5G ProSe Layer-3 UE-to-Network Relay) as part of the Accept message to the 5G ProSe Layer-3 Remote UE. If the 5G ProSe Layer-3 Remote UE performs the Layer-2 link modification procedure to add new PC5 QoS Flow(s) or modify the existing PC5 QoS Flow(s) for IP traffic or Ethernet traffic over PC5 reference point, the 5G ProSe Layer-3 Remote UE may also provide the PC5 QoS Rule(s) for the PC5 QoS Flow(s) to be added or modified to the 5G ProSe Layer-3 UE-to-Network Relay. The 5G ProSe Layer-3 UE-to-Network Relay may generate the Packet Filters used over Uu reference point based on the received PC5 QoS Rule(s).\nThe 5G ProSe Layer-3 UE-to-Network Relay performs the UE requested PDU session Modification as defined in TS 23.502 [5], clause 4.3.3 for authorizing the requested QoS including the 5QI and the Packet Filters. If the PCF authorizes the requested QoS with a different 5QI value, the 5G ProSe Layer-3 UE-to-Network Relay may further update the PQI value based on the authorized 5QI value and the 5G ProSe Layer-3 UE-to-Network Relay performs the Layer-2 link modification procedure as defined in clause 6.4.3.6 to update the corresponding PC5 QoS Flow with the updated PQI value.\nAlternatively, reflective QoS control over Uu as defined in TS 23.501 [4], clause 5.6.5.3 can be leveraged for dynamic QoS handling of 5G ProSe Layer-3 Remote UE to save on signalling between SMF and 5G ProSe Layer-3 UE-to-Network Relay. Upon reception of a DL packet with RQI on the Uu for the 5G ProSe Layer-3 Remote UE, based on the indicated QFI, the 5G ProSe Layer-3 UE-to-Network Relay creates a new derived QoS rule or updates existing derived QoS rule corresponding to the remote UE, as defined in TS 23.501 [4]. The derived QoS rule is for UL packets from the 5G ProSe Layer-3 Remote UE at Uu interface.\nBased on signalled QoS rules (via SMF) or derived QoS rules (Uplink Uu via reflective QoS), the 5G ProSe Layer-3 UE-to-Network Relay may generate the Packet Filters used over PC5 reference point and use the L2 Link Modification procedures as defined in clause 6.4.3.6 to either update existing PC5 QoS Flow(s) or to set up new PC5 QoS Flow(s) (when the QFI to PC5 QoS Flow mapping does not exist). The 5G ProSe Layer-3 UE-to-Network Relay may also provide the PC5 QoS Rule(s) for the PC5 QoS Flow(s) to be added or modified to the 5G ProSe Layer-3 Remote UE.\nWhen the 5G ProSe Layer-3 UE-to-Network relay deletes the derived QoS rule e.g. after the RQ Timer expires, the 5G ProSe Layer-3 UE-to-Network Relay may perform L2 Link Modification procedures defined in clause 6.4.3.6 accordingly using the PQI mapped from the 5QI of the currently used QoS rule after the deletion of the derived QoS rule(s).",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_5.4",
        "ts_23.501_clause_5.7",
        "clause_5.1.4.1",
        "ts_23.501_clause_5.7.4",
        "clause_6.4.3.6",
        "ts_23.502_clause_4.3.3",
        "ts_23.501_clause_5.6.5.3",
        "table_5.6.1-1",
        "ts_23.287_table_5.4.4-1",
        "ts_23.287_table_5.6.1-1",
        "ts_23.501_figure_5.6.2.1-1",
        "figure_5.6.2.1-1",
        "ts_23.287",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.2.2",
      "section_id": "5.6.2.2",
      "section_title": "QoS handling for 5G ProSe Layer-3 UE-to-Network relay with N3IWF",
      "content": "When accessing 5GS via a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF, the 5G ProSe Layer-3 Remote UE can request for PDU Session establishment or handover an existing PDU session to the N3IWF using UE requested PDU Session Establishment procedure defined in TS 23.502 [5] clause 4.12.5.\nFigure 5.6.2.2-1: End-to-End QoS support via Layer-3 UE-to-Network Relay with N3IWF\nFor the 5G ProSe Layer-3 Remote UE's PDU session(s) established via N3IWF, QoS differentiation can be provided on per-IPsec Child Security Association basis. N3IWF determines the IPsec child SAs as defined in TS 23.502 [5] clause 4.12. The N3IWF is preconfigured to allocate different IPsec child SAs for QoS Flows with different QoS profiles.\nBased on configuration, the N3IWF can use one of the options below for QoS support in 5G ProSe Layer-3 UE-to-Network Relay UE's serving PLMN:\n-\ta static QoS mapping mechanism;\n-\ta dynamic QoS signalling based mechanism.\nFor the static QoS mapping mechanism, a SLA is established to govern the QoS handling between the 5G ProSe Layer-3 Remote UE's 5GC and the 5G ProSe Layer-3 UE-to-Network Relay UE's 5GC, e.g. when the RSC is configured. The SLA can include the mapping between the DSCP markings for the IPsec child SAs with the Remote UE and the corresponding QoS and N3IWF IP address(es). The non-alteration of the DSCP field between N3IWF and the 5G ProSe Layer-3 UE-to-Network Relay UE's UPF is also assumed to be governed by an SLA and by transport-level arrangements that are outside of 3GPP scope. The packet detection filters at the 5G ProSe Layer-3 UE-to-Network Relay UE's UPF can be based on the N3IWF IP address and the DSCP markings.\nWhen the dynamic QoS signalling based mechanism is used by N3IWF, it works as follows:\n-\tWhen the 5G ProSe Layer-3 Remote UE establishes or handovers a PDU session via the N3IWF as described in clause 4.12.5 of TS 23.502 [5], the PCF serving the PDU Session in the 5G ProSe Layer-3 Remote UE's 5GC detects need for specific QoS and provides corresponding PCC rules to SMF in the 5G ProSe Layer-3 Remote UE's 5GC. The resulted QoS information is provided to N3IWF in step 2b of clause 4.12.5 of TS 23.502 [5]. The N3IWF determines the IPSec Child SA(s) and signals to the 5G ProSe Layer-3 Remote UE, as in step 4 of clause 4.12.5 of TS 23.502 [5] via IKE signalling including the PDU Session ID, the QFI(s), optionally a DSCP value and optionally the Additional QoS Information specified in clause 4.12.5 of TS 23.502 [5]. The PDU Session Establishment Accept message will be sent to the 5G ProSe Layer-3 Remote UE as in step 5 of clause 4.12.5 of TS 23.502 [5].\n-\tBased on Additional QoS Information received from the N3IWF, the 5G ProSe Layer-3 Remote UE determines whether it is necessary to request for QoS session modification for the dedicated QoS Flows toward the 5G ProSe Layer-3 UE-to-Network Relay as described in clause 5.6.2.1. The 5G ProSe Layer-3 Remote UE also provides the N3IWF address, DSCP and the SPI as the traffic filter to enable filtering and mapping of DL traffic towards the right PDU Session/QoS Flow within the 5G ProSe Layer-3 UE-to-Network Relay UE's 5GC.\nNOTE:\tThis mechanism allows to communicate GBR related parameters such as GFBR and MFBR from the PCF of the 5G ProSe Layer-3 Remote UE via the N3IWF and the 5G ProSe Layer-3 Remote UE to the 5G ProSe Layer-3 UE-to-Network Relay UE. The 5G ProSe Layer-3 UE-to-Network Relay UE would be able to request the GBR resources from its serving network using UE requested PDU session modification as in clause 4.3.3. of TS 23.502 [5].\n-\tIf the 5G ProSe Layer-3 UE-to-Network Relay performs the PDU Session Modification procedure, the PCF in the 5G ProSe Layer-3 UE-to-Network Relay UE's 5GC authorizes the QoS parameters. If the PDU Session Modification procedure authorized the requested QoS parameters, the 5G ProSe Layer-3 UE-to-Network Relay acknowledges the 5G ProSe Layer-3 Remote UE over PC5. The 5G ProSe Layer-3 UE-to-Network Relay also provides the traffic filter provided by the 5G ProSe Layer-3 Remote UE to the SMF during the PDU Session Modification procedure and the SMF updates the PSA UPF with DL Packet Detection Rules.\n-\tThe PSA UPF in the 5G ProSe Layer-3 UE-to-Network Relay UE's 5GC maps the DL traffic from IPSec Child SA tunnel to appropriate PDU Session/QoS Flow considering SPI and N3IWF address (filters provided by the 5G ProSe Layer-3 Remote UE).\n-\tThe 5G ProSe Layer-3 Remote UE's or the 5G ProSe Layer-3 Remote UE's 5GC may initiated PDU Session Modification procedures as specified in clause 4.12.6 of TS 23.502 [5]. When the 5G ProSe Layer-3 Remote UE received QoS information from the N3IWF, the same interactions between the 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay and between the 5G ProSe Layer-3 UE-to-Network Relay and its 5GC as described above apply.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.12.5",
        "ts_23.502_clause_4.12",
        "clause_5.6.2.1",
        "ts_23.502_clause_4.3.3",
        "ts_23.502_clause_4.12.6",
        "ts_23.502_figure_5.6.2.2-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.2.3",
      "section_id": "5.6.2.3",
      "section_title": "QoS handling for 5G ProSe Layer-2 UE-to-Network Relay",
      "content": "For a 5G ProSe Layer-2 Remote UE accessing network via 5G ProSe Layer-2 UE-to-Network Relay, the existing 5G QoS control is reused between the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 Remote UE's core network. The 5G ProSe Layer-2 Remote UE's SMF provides QoS profiles to NG-RAN, how NG-RAN performs QoS enforcement for PC5 interface (between the 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay) and Uu interface (between the 5G ProSe Layer-2 UE-to-Network Relay and RAN) is specified in TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.3.1",
      "section_id": "5.6.3.1",
      "section_title": "QoS handling for 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "For a 5G ProSe Layer-3 End UE connecting with another 5G ProSe Layer-3 End UE(s) via 5G ProSe Layer-3 UE-to-UE Relay, the QoS requirement of the relay traffic between the peer 5G ProSe Layer-3 End UE(s) can be satisfied by the corresponding QoS control for the PC5 link between source 5G ProSe Layer-3 End UE and 5G ProSe Layer-3 UE-to-UE Relay (i.e. first hop PC5 QoS control) and the QoS control for the PC5 link between 5G ProSe Layer-3 UE-to-UE Relay and target 5G ProSe Layer-3 End UE (i.e. second hop PC5 QoS control). The first hop PC5 QoS and second hop PC5 QoS is controlled with PC5 QoS rules and PC5 QoS parameters (e.g. PQI, GFBR, MFBR, PC5 LINK-AMBR) as specified in clause 5.6.1.\nAs shown in figure 5.6.3.1-1 below, the end-to-end QoS is met only when the QoS requirements are properly translated and satisfied over the two legs respectively.\nFigure 5.6.3.1-1: End-to-End QoS for 5G ProSe Layer-3 UE-to-UE Relay operation\nTo achieve this, the source 5G ProSe Layer-3 End UE initiates PC5 QoS Flows setup or modification during the Layer-2 link establishment or modification procedure, the source 5G ProSe Layer-3 End UE provides the QoS Info as described in clause 6.4.3.7.3 to the 5G ProSe Layer-3 UE-to-UE Relay. The received PC5 QoS parameters of the QoS Info (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) are interpreted as the end-to-end QoS requirements by the 5G ProSe Layer-3 UE-to-UE Relay for the traffic transmission between source 5G ProSe Layer-3 End UE and target 5G ProSe Layer-3 End UE. The source 5G ProSe Layer-3 End UE derives the end-to-end QoS parameters as defined in clause 5.6.1. The 5G ProSe Layer-3 UE-to-UE Relay, based on its implementation, decides the PQI for the first hop PC5 QoS control and the PQI for the second hop PC5 QoS control, by considering the received PC5 QoS parameters from the source 5G ProSe Layer-3 End UE. The 5G ProSe Layer-3 UE-to-UE Relay provides the QoS Info (including PQI value chosen by the 5G ProSe Layer-3 UE-to-UE Relay for the second hop) to the target 5G ProSe Layer-3 End UE. After accepted QoS Info of the second hop QoS from the target 5G ProSe Layer-3 End UE is received, 5G ProSe Layer-3 UE-to-UE Relay provides the QoS Info (including PQI value chosen by the 5G ProSe Layer-3 UE-to-UE Relay for the first hop) to the source 5G ProSe Layer-3 End UE with considering the received second hop QoS. If the source 5G ProSe Layer-3 End UE performs the Layer-2 link modification procedure to add new PC5 QoS Flow(s) or modify the existing PC5 QoS Flow(s) for IP traffic or Ethernet traffic over PC5 reference point, the source 5G ProSe Layer-3 End UE may also provide the PC5 QoS Rule(s) for the PC5 QoS Flow(s) to be added or modified to the 5G ProSe Layer-3 UE-to-UE Relay. The 5G ProSe Layer-3 UE-to-UE Relay may generate the Packet Filters used over the second hop based on the received PC5 QoS Rule(s).",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6.1",
        "clause_6.4.3.7.3",
        "figure_5.6.3.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.6.3.2",
      "section_id": "5.6.3.2",
      "section_title": "QoS handling for 5G ProSe Layer-2 UE-to-UE Relay",
      "content": "For a 5G ProSe Layer-2 End UE connecting with another 5G ProSe Layer-2 End UE(s) via 5G ProSe Layer-2 UE-to-UE Relay, the source 5G ProSe Layer-2 End UE and the target 5G ProSe Layer-2 End UE negotiate the end-to-end QoS for the traffic transmission between source 5G ProSe Layer-2 End UE and target 5G ProSe Layer-2 End UE. The QoS enforcement for first hop PC5 interface (between the source 5G ProSe Layer-2 End UE and 5G ProSe Layer-2 UE-to-UE Relay) and second hop PC5 interface (between the 5G ProSe Layer-2 UE-to-UE Relay and the target 5G ProSe Layer-2 End UE) is specified in TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.7",
      "section_id": "5.7",
      "section_title": "Subscription to 5G ProSe",
      "content": "The subscription information in the UDM contains information to give the user permission to use 5G ProSe.\nAt any time, the operator can amend or remove the ProSe UE subscription rights from subscription information in the UDM, or to revoke the user's permission to use 5G ProSe.\nThe following subscription information is defined for 5G ProSe:\n-\tsubscription for open 5G ProSe Direct Discovery for NR PC5:\n-\topen 5G ProSe Direct Discovery Model A.\n-\tsubscription for restricted 5G ProSe Direct Discovery for NR PC5:\n-\trestricted 5G ProSe Direct Discovery Model A;\n-\trestricted 5G ProSe Direct Discovery Model A with application-controlled extension;\n-\trestricted 5G ProSe Direct Discovery Model A with \"on demand\" announcing;\n-\trestricted 5G ProSe Direct Discovery Model B.\n-\tsubscription for Broadcast, Groupcast and Unicast mode 5G ProSe Direct Communication for NR PC5.\n-\tsubscription for 5G ProSe UE acting as 5G ProSe Layer-2 UE-to-Network Relay.\n-\tsubscription for 5G ProSe UE acting as 5G ProSe Layer-3 UE-to-Network Relay.\n-\tsubscription for 5G ProSe Layer-2 Remote UE access via 5G ProSe Layer-2 UE-to-Network Relay.\n-\tsubscription for 5G ProSe Layer-3 Remote UE access via 5G ProSe Layer-3 UE-to-Network Relay.\n-\tsubscription for multi-path communication via direct Uu path and via 5G ProSe Layer 2 UE-to-Network Relay as a 5G ProSe Layer-2 Remote UE.\n-\tsubscription for 5G ProSe UE acting as 5G ProSe Layer-2 UE-to-UE Relay.\n-\tsubscription for 5G ProSe UE acting as 5G ProSe Layer-3 UE-to-UE Relay.\n-\tsubscription for 5G ProSe Layer-2 End UE access via 5G ProSe Layer-2 UE-to-UE Relay.\n-\tsubscription for 5G ProSe Layer-3 End UE access via 5G ProSe Layer-3 UE-to-UE Relay.\n-\tUE-PC5-AMBR for NR PC5.\n-\tPC5 QoS parameters as defined in clause 5.6.1 used by NG-RAN.\n-\tthe list of the PLMNs authorized for 5G ProSe services, including:\n-\tthe list of the PLMNs where the UE is authorised for open 5G Direct Discovery Model A, i.e. to announce or monitor or both.\n-\tthe list of the PLMNs where the UE is authorised for restricted 5G ProSe Direct Discovery Model A, i.e. to announce or monitor or both.\n-\tthe list of the PLMNs where the UE is authorised for restricted 5G ProSe Direct Discovery Model B, i.e. to perform Discoverer operation or Discoveree operation or both.\n-\tthe list of the PLMNs where the UE is authorised to perform Broadcast, Groupcast and Unicast mode 5G ProSe Direct Communication for NR PC5.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-2 UE-to-Network Relay.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-3 UE-to-Network Relay.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-2 Remote UE.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-2 UE-to-UE Relay.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-3 UE-to-UE Relay.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-2 End UE.\n-\tthe list of the PLMNs where the UE is authorised to act as a 5G ProSe Layer-3 End UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.0",
      "section_id": "5.8.1.0",
      "section_title": "General",
      "content": "NOTE:\tThe 5G DDNMF takes the role of \"ProSe Function\" if it exists in the following definitions in TS 23.303 [3].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.1",
      "section_id": "5.8.1.1",
      "section_title": "ProSe Application ID",
      "content": "ProSe Application ID is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.2",
      "section_id": "5.8.1.2",
      "section_title": "Destination Layer-2 ID",
      "content": "Destination Layer-2 ID is defined in clause 5.6.1 of TS 23.287 [2].\nThe Destination Layer-2 ID for 5G ProSe Direct Discovery with Model A is selected based on the configuration as described in clause 5.1.2.1. The Destination Layer-2 ID for a Solicitation message for Model B is selected based on the configuration as described in clause 5.1.2.1. The Destination Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery is selected as described in clause 5.8.4.2.\nFor Group member discovery:\n-\tIf an Application Layer Group ID has a configured Layer-2 Group ID, which is provisioned as specified in clause 5.1.2.1, the UE uses this Layer-2 Group ID as the Destination Layer-2 ID,\n-\totherwise, the UE converts the Application Layer Group ID into a Destination Layer-2 ID.\nNOTE:\tThe mechanism for converting the application layer provided Application Layer Group ID to the Destination Layer-2 ID is defined in Stage 3.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_5.6.1",
        "clause_5.1.2.1",
        "clause_5.8.4.2",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.3",
      "section_id": "5.8.1.3",
      "section_title": "Source Layer-2 ID",
      "content": "Source Layer-2 ID is defined in clause 5.6.1 of TS 23.287 [2].\nThe UE self-selects a Source Layer-2 ID for 5G ProSe Direct Discovery and Group member discovery. The Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery is selected as described in clause 5.8.4.2.\nNOTE:\tThe UE implementation needs to ensure that when the UE self-selects Source Layer-2 IDs, the self-selected Source Layer-2 IDs are different between 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery) in clause 6.3.2 and 5G ProSe Direct Communication (including 5G ProSe UE-to-Network Relay Communication and 5G ProSe UE-to-UE Relay Communication) in clauses 6.4, 6.5 and 6.7 and are different from any other provisioned Destination Layer-2 IDs as described in clause 5.1 and any other self-selected Source Layer-2 IDs used in a simultaneous 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery) with a different discovery model.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_5.6.1",
        "clause_5.8.4.2",
        "clause_6.3.2",
        "clause_5.1",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.4",
      "section_id": "5.8.1.4",
      "section_title": "ProSe Application Code",
      "content": "ProSe Application Code is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.5",
      "section_id": "5.8.1.5",
      "section_title": "ProSe Restricted Code",
      "content": "ProSe Restricted Code is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.6",
      "section_id": "5.8.1.6",
      "section_title": "ProSe Query Code",
      "content": "ProSe Query Code is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.7",
      "section_id": "5.8.1.7",
      "section_title": "ProSe Response Code",
      "content": "ProSe Response Code is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.8",
      "section_id": "5.8.1.8",
      "section_title": "User Info ID",
      "content": "User Info ID (including Announcer Info, Discoverer Info, Discoveree Info) is defined in clause 3.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_3.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.9",
      "section_id": "5.8.1.9",
      "section_title": "ProSe Discovery UE ID",
      "content": "ProSe Discovery UE ID is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.10",
      "section_id": "5.8.1.10",
      "section_title": "Restricted ProSe Application User ID",
      "content": "Restricted ProSe Application User ID is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.11",
      "section_id": "5.8.1.11",
      "section_title": "Announcing PLMN ID",
      "content": "Announcing PLMN ID is defined in TS 32.277 [22].",
      "chunk_type": "general",
      "cross_references": [
        "ts_32.277"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.12",
      "section_id": "5.8.1.12",
      "section_title": "Announcer Info",
      "content": "Announcer Info is one of the uses of User Info ID as described in clause 5.8.1.8.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.1.8"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.13",
      "section_id": "5.8.1.13",
      "section_title": "Discoverer Info",
      "content": "Discoverer Info is one of the uses of User Info ID as described in clause 5.8.1.8.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.1.8"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.14",
      "section_id": "5.8.1.14",
      "section_title": "Target Info",
      "content": "Target Info provides information about the targeted discoveree in the Group Member Discovery Solicitation message specified in clause 6.3.2.2.3 and in the 5G ProSe UE-to-Network Relay Discovery Solicitation message specified in clause 6.3.2.3.3. The Target Info is the User Info ID of the discoveree.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2.2.3",
        "clause_6.3.2.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.15",
      "section_id": "5.8.1.15",
      "section_title": "Discoveree Info",
      "content": "Discoveree Info is one of the uses of User Info ID as described in clause 5.8.1.8.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.1.8"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.16",
      "section_id": "5.8.1.16",
      "section_title": "Application Layer Group ID",
      "content": "Application Layer Group ID is defined in TS 23.303 [3].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.1.17",
      "section_id": "5.8.1.17",
      "section_title": "Monitored PLMN ID",
      "content": "Monitored PLMN ID is defined in TS 32.277 [22].",
      "chunk_type": "general",
      "cross_references": [
        "ts_32.277"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.2.1",
      "section_id": "5.8.2.1",
      "section_title": "General",
      "content": "Each UE has one or more Layer-2 IDs for 5G ProSe direct communication over PC5 reference point, consisting of:\n-\tSource Layer-2 ID(s); and\n-\tDestination Layer-2 ID(s).\nSource and Destination Layer-2 IDs are included in layer-2 frames sent on the layer-2 link of the PC5 reference point identifying the layer-2 source and destination of these frames. Source Layer-2 IDs are always self-assigned by the UE originating the corresponding layer-2 frames.\nThe selection of the Source and Destination Layer-2 ID(s) by a UE depends on the communication mode of 5G ProSe direct communication over PC5 reference point for this layer-2 link, as described in clauses 5.8.2.2, 5.8.2.3 and 5.8.2.4. The Source Layer-2 IDs may differ between different communication modes.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_5.8.2.2",
      "section_id": "5.8.2.2",
      "section_title": "Identifiers for broadcast mode 5G ProSe direct communication",
      "content": "For broadcast mode of 5G ProSe direct communication over PC5 reference point, the UE is configured with the Destination Layer-2 ID(s) to be used for ProSe applications. The Destination Layer-2 ID for a 5G ProSe direct communication is selected based on the configuration as described in clause 5.1.3.1.\nThe UE self-selects a Source Layer-2 ID.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.2.3",
      "section_id": "5.8.2.3",
      "section_title": "Identifiers for groupcast mode 5G ProSe direct communication",
      "content": "For groupcast mode of 5G ProSe direct communication over PC5 reference point, the application layer may provide Application Layer Group ID.\nThe UE determines a Destination Layer-2 ID as below:\n-\tWhen the Application Layer Group ID is provided by the application layer,\n-\tand when ProSe Layer-2 Group ID is configured for the Application Layer Group ID provided by the application layer as specified in clause 5.1.3.1, the UE uses the ProSe Layer-2 Group ID as the Destination Layer-2 ID; or\n-\tand when ProSe Layer-2 Group ID is not configured for the Application Layer Group ID provided by the application layer, the UE converts the Application Layer Group ID into a Destination Layer-2 ID.\n-\tWhen the Application Layer Group ID is not provided by the application layer, the UE determines the Destination Layer-2 ID based on configuration of the mapping between ProSe Identifier and Layer-2 ID, as specified in clause 5.1.3.1.\nNOTE:\tThe mechanism for converting the application layer provided Application Layer Group ID to the Destination Layer-2 ID is defined in Stage 3.\nThe UE self-selects a Source Layer-2 ID.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.2.4",
      "section_id": "5.8.2.4",
      "section_title": "Identifiers for unicast mode 5G ProSe direct communication",
      "content": "For unicast mode of 5G ProSe direct communication over PC5 reference point, the Destination Layer-2 ID used depends on the communication peer. The Layer-2 ID of the communication peer, identified by the peer's Application Layer ID, may be discovered during the establishment of the PC5 unicast link, or known to the UE via prior ProSe direct communications, e.g. existing or prior unicast link to the same Application Layer ID, or obtained from 5G ProSe direct discovery process. The initial signalling for the establishment of the PC5 unicast link may use the known Layer-2 ID of the communication peer, or a default destination Layer-2 ID associated with the ProSe service (i.e. ProSe identifier) configured for PC5 unicast link establishment, as specified in clause 5.1.3.1. During the PC5 unicast link establishment procedure, Layer-2 IDs are exchanged and should be used for future communication between the two UEs, as specified in clause 6.4.3.\nThe UE maintains a mapping between the Application Layer IDs and the source Layer-2 IDs used for the PC5 unicast links, as the ProSe application layer does not use the Layer-2 IDs. This allows the change of source Layer-2 ID without interrupting the ProSe applications.\nWhen Application Layer IDs change, the source Layer-2 ID(s) of the PC5 unicast link(s) shall be changed if the link(s) was used for 5G ProSe communication with the changed Application Layer IDs.\nBased on privacy configuration as specified in clause 5.1.3.1, the update of the new identifiers of a source UE to the peer UE for the established unicast link may cause the peer UE to change its Layer-2 ID and optionally IP address/prefix if IP communication is used as defined in clause 6.4.3.2.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.3.1",
        "clause_6.4.3",
        "clause_6.4.3.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.3.1",
      "section_id": "5.8.3.1",
      "section_title": "Common identifiers for 5G ProSe UE-to-Network Relay",
      "content": "The following parameters are used for the 5G ProSe UE-to-Network Relay Discovery Announcement message (Model A), where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and Announcer Info and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery is selected based on the configuration as described in clause 5.1.4.1.\n-\tAnnouncer Info: provides information (i.e. User Info ID) about the announcing user.\n-\tRelay Service Code: parameter identifying a connectivity service the 5G ProSe UE-to-Network Relay provides to a 5G ProSe Remote UE. The Relay Service Codes are configured in a 5G ProSe UE-to-Network Relay for advertisement. Additionally, the Relay Service Code may also identifies authorized users the 5G ProSe UE-to-Network Relay would offer service to and may be used to select the related security policies or information e.g. necessary for authentication and authorization between the 5G ProSe Remote UE and the 5G ProSe UE-to-Network Relay (e.g. a Relay Service Code for relays for police members only would be different than a Relay Service Code for relays for Fire Fighters only, even though potentially they provided connectivity to same DN e.g. to support Internet Access).\nThe following parameters are used for the 5G ProSe UE-to-Network Relay Discovery Solicitation message (Model B), where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and Discoverer Info and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe Remote-UE self-selects a Source Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery is selected based on the configuration as described in clause 5.1.4.1.\n-\tDiscoverer Info: provides information (i.e. User Info ID) about the discoverer user.\n-\tTarget Info: provides information (i.e. User Info ID) about the targeted discoveree user.\n-\tRelay Service Code: information about connectivity that the discoverer UE is interested in. The Relay Service Codes are configured in the 5G ProSe Remote UEs interested in related connectivity services.\nThe following parameters are used in the 5G ProSe UE-to-Network Relay Discovery Response message (Model B), where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and Discoveree Info and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery.\n-\tDestination Layer-2 ID: set to the Source Layer-2 ID of the received 5G ProSe UE-to-Network Relay Discovery Solicitation message.\n-\tRelay Service Code: identifies the connectivity service the 5G ProSe UE-to-Network Relay provides to 5G ProSe Remote UEs that matches the Relay Service Code from the corresponding Discovery Solicitation message.\n-\tDiscoveree Info: provides information (i.e. User Info ID) about the discoveree.\nThe following parameters may be used in the Relay Discovery Additional Information message (using Model A) based on the procedure defined in clause 6.5.1.3 for 5G ProSe UE-to-Network Relay where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and the other parameters are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source Layer-2 ID to send the Relay Discovery Additional Information message.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID to send the Relay Discovery Additional Information message is selected based on the configuration as described in clause 5.1.4.1.\n-\tRelay Service Code: the Relay Service Code associated with the message. The Relay Service Code is used to identify the security parameters needed by the receiving UE to process the discovery message.\n-\tAnnouncer Info: provides information about the announcing user.\n-\tAdditional parameters: the additional parameters for 5G ProSe Layer-3 UE-to-Network Relay (when applicable) are defined in clause 5.8.3.2.\nNOTE 1:\tThe UE implementation needs to ensure that when the UE self-selects Source Layer-2 IDs, the self-selected Source Layer-2 IDs are different between 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery) in clause 6.3.2 and 5G ProSe Direct Communication (including 5G ProSe UE-to-Network Relay Communication) in clause 6.4 and are different from any other provisioned Destination Layer-2 IDs as described in clause 5.1 and any other self-selected Source Layer-2 IDs used in a simultaneous 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery) with a different discovery model.\nNOTE 2:\tIf a 5G ProSe UE-to-Network Relay and 5G ProSe Remote UE from different PLMNs discover each other, it means that the Relay Service Code is associated with the same connectivity service, and the same Relay Service Code is provisioned based on Service Level Agreement among PLMNs.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.4.1",
        "clause_6.5.1.3",
        "clause_5.8.3.2",
        "clause_6.3.2",
        "clause_6.4",
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.3.2",
      "section_id": "5.8.3.2",
      "section_title": "Identifiers for 5G ProSe Layer-3 UE-to-Network Relay",
      "content": "For 5G ProSe Layer-3 UE-to-Network relay, a Relay Service Code in the Announcement Message is associated with a set of PDU session parameters (e.g. PDU Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference). The Relay Service Code may also represent if the relay UE can provide secure N3IWF connection.\nFor 5G ProSe Layer-3 Remote UE discovering 5G ProSe Layer-3 UE-to-Network relay, the Relay Service Code in the Solicitation Message represents the PDU session parameters that a PDU session of the relay should be able to support. The Relay Service Code may also represent if the remote UE requires secure N3IWF connection.\nThe following additional parameters may be used in the Relay Discovery Additional Information message (using Model A) for 5G ProSe Layer-3 UE-to-Network Relay:\n-\tNCGI: indicates the NCGI of the serving cell of the 5G ProSe Layer-3 UE-to-Network Relay. This parameter may be requested by application running on 5G ProSe Layer-3 Remote UE.\n-\tTAI: indicates the Tracking Area Identity of the serving cell of the 5G ProSe Layer-3 UE-to-Network Relay. This parameter may be used by 5G ProSe Layer-3 Remote UE to select a N3IWF.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_5.8.3.3",
      "section_id": "5.8.3.3",
      "section_title": "Identifiers for 5G ProSe Layer-2 UE-to-Network Relay",
      "content": "The following parameters may be used in Announcement message (Model A) or Response message (Model B) in addition to the parameters as specified in clause 5.8.3.1:\n-\tNCGI: indicates the NCGI of the serving cell of the 5G ProSe Layer-2 UE-to-Network Relay for 5G ProSe Layer-2 UE-to-Network Relay (re)selection.\n-\tRRC Container: An RRC container, as defined in TS 38.331 [16], which includes the cell access related information for the serving cell of the 5G ProSe Layer-2 UE-to-Network Relay.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.8.3.1",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.4.1",
      "section_id": "5.8.4.1",
      "section_title": "General",
      "content": "The 5G ProSe UE-to-UE Relay Discovery message contains two sets of identifiers, a Direct Discovery set and a UE-to-UE Relay Discovery set.\n-\tThe Direct Discovery set of identifiers are part of the contents of the 5G ProSe Direct Discovery message as defined in clause 5.8.1. This set of identifiers provides information about the 5G ProSe End UE(s) (e.g. user info (i.e. Application Layer ID)) to be discovered via 5G ProSe UE-to-UE Relay.\n-\tThe UE-to-UE Relay Discovery set of identifiers as defined in clause 5.8.4.2 contain information to support the discovery of the 5G ProSe UE-to-UE Relay and extensions of the Direct Discovery.\n5G ProSe UE-to-UE Relay shall modify the UE-to-UE Relay Discovery set of identifiers and forward the Direct Discovery set and the UE-to-UE Relay Discovery set of identifiers during the discovery procedures. The Direct Discovery set can be protected using different keys as used to protect the UE-to-UE Relay Discover set according to TS 33.503 [29].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.8.1",
        "clause_5.8.4.2",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.4.2",
      "section_id": "5.8.4.2",
      "section_title": "Common identifiers for 5G ProSe UE-to-UE Relay Discovery",
      "content": "The following parameters are used as UE-to-UE Relay Discovery set of identifiers for the 5G ProSe UE-to-UE Relay Discovery Announcement message (Model A), where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and User Info ID and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-UE Relay self-selects a Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Announcement message.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Announcement message is selected based on the configuration as described in clause 5.1.5.1.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay: provides information about the 5G ProSe UE-to-UE Relay.\n-\tRelay Service Code: information to indicate the connectivity service the 5G ProSe UE-to-UE Relay provides to 5G ProSe End UEs.\nThe following parameters are used as UE-to-UE Relay Discovery set of identifiers for the 5G ProSe UE-to-UE Relay Discovery Solicitation message (Model B) between discoverer 5G ProSe End UE and 5G ProSe UE-to-UE Relay, where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and User Info ID and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the discoverer 5G ProSe End UE self-selects a Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Solicitation message.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Solicitation message is selected based on the configuration as described in clause 5.1.5.1.\n-\tRelay Service Code: information about connectivity service that the discoverer 5G ProSe End UE is interested in.\nThe following parameters are used as UE-to-UE Relay Discovery set of identifiers in the 5G ProSe UE-to-UE Relay Discovery Response message (Model B) between discoverer 5G ProSe End UE and 5G ProSe UE-to-UE Relay, where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and User Info ID and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-UE Relay self-selects a Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Response message.\n-\tDestination Layer-2 ID: set to the Source Layer-2 ID of the received 5G ProSe UE-to-UE Relay Discovery Solicitation message.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay: provides information about the 5G ProSe UE-to-UE Relay.\n-\tRelay Service Code: identifies the connectivity service the 5G ProSe UE-to-UE Relay provides to 5G ProSe End UEs that matches the Relay Service Code from the corresponding Discovery Solicitation message.\nThe following parameters are used as UE-to-UE Relay Discovery set of identifiers for the 5G ProSe UE-to-UE Relay Discovery Solicitation message (Model B) between 5G ProSe UE-to-UE Relay and discoveree 5G ProSe End UE, where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and User Info ID and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the 5G ProSe UE-to-UE Relay self-selects a Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Solicitation message.\nWhen a 5G ProSe UE-to-UE Relay self-selects a Source Layer-2 ID for a received 5G ProSe UE-to-UE Relay Discovery Solicitation message, it selects a different Source Layer-2 ID values for each 5G ProSe UE-to-UE Relay Discovery Solicitation message, so that the 5G ProSe UE-to-UE Relay can correlate the 5G ProSe UE-to-UE Relay Discovery Response message with the 5G ProSe UE-to-UE Relay Discovery Solicitation message. The 5G ProSe UE-to-UE Relay can determine the discoverer 5G ProSe End UE that triggered the 5G ProSe UE-to-UE Relay Discovery Solicitation based on the destination Layer-2 ID of the received 5G ProSe UE-to-UE Relay Discovery Response message.\n-\tDestination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Solicitation message is selected based on the configuration as described in clause 5.1.5.1.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay: provides information about the 5G ProSe UE-to-UE Relay.\n-\tRelay Service Code: identifies the connectivity service the 5G ProSe UE-to-UE Relay provides to 5G ProSe End UEs.\nThe following parameters are used as UE-to-UE Relay Discovery set of identifiers in the 5G ProSe UE-to-UE Relay Discovery Response message (Model B) between 5G ProSe UE-to-UE Relay and discoveree 5G ProSe End UE, where Source Layer-2 ID and Destination Layer-2 ID are used for sending and receiving the message and User Info ID and Relay Service Code are contained in the message:\n-\tSource Layer-2 ID: the discoveree 5G ProSe End UE self-selects a Source Layer-2 ID for 5G ProSe UE-to-UE Relay Discovery Response message.\n-\tDestination Layer-2 ID: set to the Source Layer-2 ID of the received 5G ProSe UE-to-UE Relay Discovery Solicitation message.\n-\tRelay Service Code: identifies the connectivity service the 5G ProSe UE-to-UE Relay provides to 5G ProSe End UEs that matches the Relay Service Code from the corresponding Discovery Solicitation message.\nNOTE 1:\tThe UE implementation needs to ensure that when the UE self-selects Source Layer-2 IDs, the self-selected Source Layer-2 IDs are different between 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery) in clause 6.3.2 and 5G ProSe Direct Communication (including 5G ProSe UE-to-Network Relay Communication and 5G ProSe UE-to-UE Relay Communication) in clause 6.4, 6.5 and 6.7 and are different from any other provisioned Destination Layer-2 IDs as described in clause 5.1 and any other self-selected Source Layer-2 IDs used in a simultaneous 5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery) with a different discovery model.\nNOTE 2:\tIf a 5G ProSe UE-to-UE Relay and 5G ProSe End UEs from different PLMNs discover each other, it means that the Relay Service Code is associated with the same connectivity service, and the same Relay Service Code is provisioned based on Service Level Agreement among PLMNs.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1.5.1",
        "clause_6.3.2",
        "clause_6.4",
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.8.5",
      "section_id": "5.8.5",
      "section_title": "Identifiers for 5G ProSe UE-to-UE Relay Communication with integrated Discovery",
      "content": "For the broadcast Direct Communication Request message over the first hop PC5 reference point, the Source Layer-2 ID is self-selected by the source 5G ProSe End UE and the Destination Layer-2 ID is selected based on the configuration as described in clause 5.1.\nFor the broadcast Direct Communication Request message over the second hop PC5 reference point, the Source Layer-2 ID is self-selected by the 5G ProSe UE-to-UE Relay and the Destination Layer-2 ID is selected based on the configuration as described in clause 5.1.\n5G ProSe UE-to-UE Relay may send a unicast Direct Communication Request message to the target 5G ProSe End UE by setting the Destination Layer-2 ID with a received unicast Destination Layer-2 ID of the target 5G ProSe End UE as specified in clause 6.4.3.7. The Source Layer-2 ID is self-selected by the 5G ProSe UE-to-UE Relay.\nFor unicast Direct Communication Accept message, the Source Layer-2 ID is self-selected by the target 5G ProSe End UE or 5G ProSe UE-to-UE Relay.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_5.1",
        "clause_6.4.3.7"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.9",
      "section_id": "5.9",
      "section_title": "Support for 5G ProSe for UEs in limited service state",
      "content": "For UE in limited service state, as defined in TS 23.122 [14], 5G ProSe can be used over PC5 reference point with the following considerations.\nUEs that are authorized to use 5G ProSe over PC5 reference point according to clause 5.1 shall be able to use the corresponding services following the principles defined in clause 5.1.2.2 for 5G ProSe Direct Discovery, clause 5.1.3.2 for 5G ProSe Direct Communication, clause 5.1.4.2 for 5G ProSe UE-to-Network Relay and clause 5.1.5.2 for 5G ProSe UE-to-UE Relay when the UE enters in limited service state in 5GS:\n-\tbecause UE cannot find a suitable cell of the selected PLMN as described in TS 23.122 [14]; or\n-\tas the result of receiving one of the following reject reasons defined in TS 23.122 [14]:\n-\ta \"PLMN not allowed\" response to a registration request or;\n-\ta \"5GS services not allowed\" response to a registration request or service request.\nA UE in limited service state shall only use the radio resources and procedure available in CM-IDLE mode for ProSe over PC5 reference point, for details see TS 36.300 [11] and TS 38.300 [12].\nUEs shall not use 5G ProSe over PC5 reference point using the \"operator-managed\" radio resources, as specified in clauses 5.1.2.1, 5.1.3.1, 5.1.4.1 and 5.1.5.1, if the UE has entered in limited service state due to all other situations (e.g. no SIM in the MS, an \"illegal MS\" or \"illegal ME\" response to a registration request, or an \"IMSI unknown in HLR\" response to a registration request) defined in TS 23.122 [14], where the UE is unable to obtain normal service from a PLMN. The UEs may use ProSe over PC5 reference point using the \"non-operator-managed\" radio resources, as specified in clauses 5.1.2.1, 5.1.3.1, 5.1.4.1 and 5.1.5.1, according to the corresponding principles defined in clauses 5.1.2.2, 5.1.3.2, 5.1.4.2 and 5.1.5.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "clause_5.1.2.2",
        "clause_5.1.3.2",
        "clause_5.1.4.2",
        "clause_5.1.5.2",
        "ts_23.122",
        "ts_36.300",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.10",
      "section_id": "5.10",
      "section_title": "PC5 operation in EPS for Public Safety UE",
      "content": "When the UE is in EPS, the UE shall use the valid ProSe policy and parameters provisioned by the ProSe Function in EPC for ProSe Direct Discovery and Prose Direct Communication. If the UE does not have valid ProSe policy and parameters, the UE shall request the network to provision the ProSe policy and parameters.\nThe UE that is authorized to perform ProSe Direct Discovery and/or ProSe Direct Communication in EPS can perform the authorized PC5 operation in EPS as specified in TS 23.303 [3].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.11",
      "section_id": "5.11",
      "section_title": "Communication path selection between PC5 and Uu reference points",
      "content": "The \"communication path selection between PC5 and Uu reference points\" refers to the procedure on how a UE selects a communication path between PC5 reference point and Uu reference point before it communicates with another UE. The communication path over PC5 reference point means that the communication with another UE is performed by using 5G ProSe Direct Communication only. The communication path over Uu reference point means that the communication with another UE is performed via the network.\nNOTE 1:\tThe communication via 5G ProSe UE-to-Network Relay (Layer-2 or Layer-3) can be considered as the communication path over Uu reference point, as it involves communication via the network.\nPath selection policy is provided to the UE to indicate which path(s) is preferred for all or specific ProSe services (i.e. PC5 preferred, Uu preferred or no preference indicated) as specified in clause 5.1.3.1.\nThe ProSe Application Server can provide a path preference for ProSe Services to UDR as specified in clause 6.2.5 and this may be used by PCF for path selection policy generation and update as specified in clause 6.2.2.\nNOTE 2:\tProSe Application Server can use QoS Sustainability analytics defined in TS 23.288 [8] to determine the path preference.\nThe UE may use the provisioned path selection policy to select the appropriate communication path for all or specific ProSe services.\nUE operation related to the path selection for ProSe service is as follows:\n-\tThe UE evaluates the path selection policy in the policy and parameters for ProSe Direct Communication applicable to the ProSe service and selects the communication path as below:\n-\tIf PC5 preferred is indicated, the UE should prefer to use the PC5 for communication path for the ProSe service.\n-\tIf Uu preferred is indicated, the UE should prefer to use the Uu for communication path for the ProSe service.\n-\tIf no preference is indicated or no path selection policy is provisioned, the UE selects either a Uu or PC5 communication path based on its pre-configuration or implementation for the ProSe service.\nNOTE 3:\tWhen either PC5 preferred or Uu preferred is indicated, the UE can still select the other non-preferred path, e.g. because the peer UE is not in proximity.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.3.1",
        "clause_6.2.5",
        "clause_6.2.2",
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.12",
      "section_id": "5.12",
      "section_title": "NAS level congestion control for 5G ProSe UE-to-Network Relay",
      "content": "The 5G ProSe UE-to-Network Relay may be subject to NAS level congestion control, as specified in clause 5.19.7 of TS 23.501 [4].\nBoth 5G ProSe Layer-2 UE-to-Network Relays and Layer-3 UE-to-Network Relays, when NAS Mobility Management congestion control as specified in clause 5.19.7.2 of TS 23.501 [4] is activated, i.e. the 5G ProSe UE-to-Network Relay receives a Mobility Management back-off timer from the AMF, the 5G ProSe UE-to-Network Relay is not able to serve the 5G ProSe Remote UE after the 5G ProSe UE-to-Network Relay enters CM_IDLE state. If the 5G ProSe UE-to-Network Relay has a Mobility Management back-off timer when it enters CM_IDLE state the 5G ProSe UE-to-Network Relay releases the PC5 connections with its 5G ProSe Remote UEs indicating it is temporarily not available, so the Remote UE can (re)select another 5G ProSe UE-to-Network Relay. The 5G ProSe UE-to-Network Relay does not perform UE-to-Network Relay Discovery as described in clause 6.3.2.3 and does not accept any PC5 connections for relaying until the back-off timer expires if the 5G ProSe UE-to-Network Relay is in CM_IDLE state.\nA Remote UE may also be subject to NAS level congestion control as specified in TS 23.501 [4].\nNOTE:\tThe form of the temporarily not available indication will be determined by stage 3.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.19.7",
        "ts_23.501_clause_5.19.7.2",
        "clause_6.3.2.3",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.13.1",
      "section_id": "5.13.1",
      "section_title": "General",
      "content": "PC5 DRX operations are supported to enable 5G ProSe-enabled UE power saving for the following functions:\n-\t5G ProSe Direct Discovery;\n-\tUnicast, groupcast and broadcast mode 5G ProSe Direct Communication;\n-\t5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-Network Relay Communication;\n-\t5G ProSe UE-to-UE Relay Discovery and 5G ProSe UE-to-UE Relay Communication.\nSupport for PC5 DRX operations in the AS layer is specified in TS 38.300 [12].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.13.2",
      "section_id": "5.13.2",
      "section_title": "PC5 DRX operations for 5G ProSe Direct Discovery, 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery",
      "content": "For 5G ProSe Direct Discovery, 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-UE Relay Discovery when the UE is \"not served by NG-RAN\", the UE uses the provisioned default PC5 DRX configuration for PC5 DRX operation as specified in clause 5.1.2.1, clause 5.1.4.1 and clause 5.1.5.1, respectively.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.2.1",
        "clause_5.1.4.1",
        "clause_5.1.5.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.13.3",
      "section_id": "5.13.3",
      "section_title": "PC5 DRX operations for 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay Communication and 5G ProSe UE-to-UE Relay Communication",
      "content": "The ProSe layer determines the respective ProSe services (i.e. ProSe identifiers) and derives the corresponding PC5 QoS parameters based on either the mapping of ProSe services (i.e. ProSe identifiers) to PC5 QoS parameters, or the ProSe Application Requirements for the ProSe services (i.e. ProSe identifiers) provided by the application layer. For broadcast and groupcast, the ProSe layer also determines the NR Tx Profile based on the mapping of ProSe services (i.e. ProSe identifiers) to NR Tx Profiles as described in clause 5.1.3.1. The ProSe layer passes the PC5 QoS parameters and destination Layer-2 ID to the AS layer as specified in clauses 6.4.1, 6.4.2 and 6.4.3. The ProSe layer also passes the corresponding NR Tx Profile to the AS layer, if the ProSe layer has determined the corresponding NR Tx Profile.\nNOTE:\tFor broadcast and groupcast, the AS layer needs PC5 QoS parameters as well to determine the PC5 DRX parameter values for reception operation over PC5 reference point. Therefore, the ProSe layer determines the interested ProSe services (i.e. ProSe identifiers) and derives the PC5 QoS parameters based on its reception needs besides the transmission needs. How to derive the PC5 QoS parameters based on its reception needs (e.g. without establishing the PC5 QoS Flows) depends on UE implementation.\nFor broadcast or groupcast, the ProSe layer maintains a list of all ProSe services (i.e. ProSe identifiers), i.e. activated ProSe services and/or ProSe services that the UE is interested for reception, for a given destination Layer-2 ID and determines the NR Tx Profile to be mapped for the respective ProSe service based on the configuration described in clause 5.1.3.1. Whenever the list of the ProSe services for a given destination Layer-2 ID changes, the ProSe layer updates the AS layer for the NR Tx Profiles information by providing all the mapped NR Tx Profiles to the AS layer for the given destination Layer-2 ID, e.g. when providing other information such as the destination Layer-2 ID, PC5 QoS parameters.\nFor broadcast, the mapping from destination Layer-2 ID to NR Tx Profile is configured in the NG-RAN. The NG-RAN may derive the NR Tx Profile from the destination Layer-2 ID to perform the network scheduled operation mode, alignment of Uu DRX and PC5 DRX, etc.\nWhen the PC5 DRX operation is needed, the AS layer determines the PC5 DRX parameter values for 5G ProSe Direct Communication or 5G ProSe UE-to-Network Relay Communication over PC5 reference point, taking into account, e.g., PC5 QoS parameters and/or destination Layer-2 ID provided by the ProSe layer.\nFor broadcast and groupcast, the UE enables the PC5 DRX based on the NR Tx Profile.\nFor unicast mode 5G ProSe Direct Communication, 5G ProSe UE-to-Network Relay Communication and 5G ProSe UE-to-UE Relay Communication, two UEs may negotiate the PC5 DRX configuration in the AS layer and the PC5 DRX parameter values can be configured per pair of source and destination Layer-2 IDs in the AS layer. For transmitting and receiving Direct Communication Request messages, a default PC5 DRX configuration may be used (see TS 38.300 [12]).\nFor broadcast and groupcast when the UE is \"not served by NG-RAN\", the UE uses the provisioned PC5 DRX configuration for PC5 DRX operation as specified in clause 5.1.3.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.3.1",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.14.1",
      "section_id": "5.14.1",
      "section_title": "5G ProSe Layer-3 UE-to-UE Relay Communication",
      "content": "The 5G ProSe Layer-3 UE-to-UE Relay shall provide generic function that can relay any IP, Ethernet or Unstructured traffic.\nThe 5G ProSe Layer-3 UE-to-UE Relay provides the functionality to support connectivity between 5G ProSe Layer-3 End UEs. A 5G ProSe Layer-3 UE-to-UE Relay and 5G ProSe Layer-3 End UEs can be located within NG-RAN coverage or outside of NG-RAN coverage.\nThe type of traffic supported over PC5 reference point is indicated by the 5G ProSe Layer-3 UE-to-UE Relay e.g. using the corresponding RSC.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_5.14.2",
      "section_id": "5.14.2",
      "section_title": "5G ProSe Layer-2 UE-to-UE Relay Communication",
      "content": "The 5G ProSe Layer-2 UE-to-UE Relay provides forwarding functionality that can relay any type of traffic over the PC5 link.\nThe 5G ProSe Layer-2 UE-to-UE Relay provides the functionality to support connectivity between 5G ProSe Layer-2 End UEs. A 5G ProSe Layer-2 UE-to-UE Relay and 5G ProSe Layer-2 End UEs can be located within NG-RAN coverage or outside of NG-RAN coverage.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_5.15",
      "section_id": "5.15",
      "section_title": "Path switching between two UE-to-Network Relays",
      "content": "If relay reselection has been triggered (see clause 6.5.3), the 5G ProSe Remote UE performs the path switching between two UE-to-Network Relays based on the URSP rules of the 5G ProSe Remote UE traffic handling described in clause 6.5.4, 5G ProSe Policy in clause 5.1.4, or information from application layer (if available) with following considerations:\n-\tThe 5G ProSe Remote UE shall first select the target path which has same type with the original path (i.e. 5G ProSe Layer-2 UE-to-Network Relay, 5G ProSe Layer-3 UE-to-Network Relay with N3IWF and 5G ProSe Layer-3 UE-to-Network Relay without N3IWF), by using the RSC associated with the original path.\n-\tIf the same type target path is not available, then this 5G ProSe Remote UE re-evaluates the URSP as specified in clause 6.5.4, or 5G ProSe Policy in clause 5.1.4 for the target path selection.\nNOTE:\tIf there is the information from the application layer (e.g. provided by an application server), the 5G ProSe Remote UE can use this information to discover the target 5G ProSe UE-to-Network Relay UE. If there are multiple discovered 5G ProSe UE-to-Network Relay UEs, the 5G ProSe Remote UE selects the target 5G ProSe UE-to-Network Relay based on the priority, if any, in the information from the application layer.\nThe principles from the 5G ProSe Policy in clause 5.1.4 and URSP rules of the 5G ProSe Remote UE traffic handling described in clause 6.5.4 take the higher priority than the information from the application layer.\nThe path switching procedures between two indirect network communication paths are as described in clause 6.5.5.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.5.3",
        "clause_6.5.4",
        "clause_5.1.4",
        "clause_6.5.5"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.16",
      "section_id": "5.16",
      "section_title": "Communication path switching between PC5 and Uu reference points",
      "content": "The \"communication path switching between PC5 and Uu reference points\" refers to the procedure on how a UE switches between Uu communication path and direct PC5 communication path when it is communicating with another UE as illustrated in Figure 5.16-1. The direct communication path over PC5 reference point means that the communication with another UE is performed by using 5G ProSe Direct Communication only. The communication path over Uu reference point means that the communication with another UE is performed via the network.\nFigure 5.16-1: Example scenario of communication path switching between PC5 and Uu reference points (i.e. switching between Figure a and Figure b)\nCommunication path switching between PC5 and Uu reference points is performed at ProSe service level, e.g. some of ProSe services of PC5 unicast link or PDU Session, all ProSe services of PC5 unicast link or PDU Session.\nThe UE takes the path selection policy into account to determine whether and for which ProSe service(s) to switch the communication path. UE operation related to the path switch for ProSe service is as follows:\n-\tThe UE evaluates the path selection policy in the policy and parameters for ProSe Direct Communication applicable to the ProSe service and switches the communication path as below:\n-\tIf the Uu path is used and PC5 preferred is indicated, the UE should prefer to switch to the PC5 communication path for the ProSe service.\n-\tIf the PC5 path is used and Uu preferred is indicated, the UE should prefer to switch to the Uu communication path for the ProSe service.\n-\tIf no preference is indicated or no path selection policy is provisioned, the UE switches between Uu and PC5 communication path based on its pre-configuration or implementation for the ProSe service.\nNOTE 1:\tWhen either PC5 preferred or Uu preferred is indicated, the UE can still switch to the other non-preferred path, e.g. signal strength of any path below a certain configured signal strength threshold.\nThe UE may decide to perform path switching from Uu path to PC5 path, e.g. because the peer UE is in proximity or for offloading some traffic from the network. The UE may decide to perform path switching from PC5 path to Uu path, e.g. when the PC5 signal strength of the unicast link with the peer UE becomes weak.\nAt path switching, the same traffic type between for PDU Session and for PC5 unicast link is maintained, i.e. IP type, Ethernet type and Unstructured type.\nFor communication path switching from PC5 to Uu reference point, the Uu QoS parameters of each UE are decided based on PC5 QoS parameters and negotiated via the existing PC5 connection between two UEs. Each UE may perform the UE requested PDU Session Modification as defined in TS 23.502 [5] clause 4.3.3 to request the Uu QoS parameters. For IP type traffic, the IP addresses/prefixes of the peer UEs over the Uu reference point can be shared via the existing PC5 connection between the UEs by using application layer signalling to assist them to establish communication with each other via the communication path over the Uu reference point.\nWhen both Uu path and PC5 path are available, a make-before-break mechanism is used when switching between PC5 path and Uu path. That is, the UEs first prepare the target path to communicate with each other and then perform the path switching and communicate over the target path and after this the former path may be released.\nNOTE 2:\tIt is not targeted to support session continuity (e.g. IP address preservation) during path switching between PC5 and Uu reference points.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.3.3",
        "figure_5.16-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.17.1",
      "section_id": "5.17.1",
      "section_title": "General",
      "content": "Multi-path communication uses one direct network communication path and one indirect network communication path with UE-to-Network Relay as illustrated in Figure 5.17.1-1, where path #1 shows the direct communication path via Uu and path #2 is shows the indirect communication path via 5G ProSe UE-to-Network Relay.\nFigure 5.17.1-1: Multi-path communication via Uu and via 5G ProSe UE-to-Network Relay\nThe indirect communication path may be via a 5G ProSe Layer-2 UE-to-Network Relay, or via a 5G ProSe Layer-3 UE-to-Network Relay with or without N3IWF.",
      "chunk_type": "definition",
      "cross_references": [
        "figure_5.17.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.17.2",
      "section_id": "5.17.2",
      "section_title": "Multi-path communication via direct Uu path and via 5G ProSe Layer-3 UE-to-Network Relay",
      "content": "A 5G ProSe Layer-3 Remote UE may access the network via a 5G ProSe Layer-3 UE-to-Network Relay with or without N3IWF.\nWhen a 5G ProSe Layer-3 Remote UE accesses the network via a 5G ProSe Layer-3 UE-to-Network Relay without N3IWF, the multi-path communication via direct Uu path and via the UE-to-Network Relay may be applied to the application traffic.\nWhen a 5G ProSe Layer-3 Remote UE accesses the network via a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF, the Layer-3 Remote UE connection via Layer-3 UE-to-Network Relay with N3IWF is considered as \"untrusted non-3GPP access to 5GC via N3IWF\", therefore the multi-path communication can be achieved using MA PDU Session in ATSSS features specified in clause 5.32 of TS 23.501 [4].\nNOTE:\tMA PDU Session requires ATSSS Information in SM subscription data as specified in TS 23.502 [5].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.32",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_5.18",
      "section_id": "5.18",
      "section_title": "Support of Public Warning Notification Relaying",
      "content": "As specified in TS 22.268 [33], if UE that is authorised to act as 5G ProSe UE-to-Network Relay receives Public Warning Notification from the network and the UE is configured to perform Public Warning relaying, it shall handle the Public Warning message acting in the role of 5G ProSe UE-to-Network Relay.\nThe 5G ProSe UE-to-Network Relay broadcasts the warning message i.e. SIB 6/7/8 received from the network to the 5G ProSe Remote UE(s) by using Broadcast mode of 5G ProSe direct communication as specified in clause 5.3.2. The 5G ProSe UE-to-Network Relay uses a configured Destination Layer-2 ID(s) as specified in clause 5.1.4.1 when broadcasting the warning message and the 5G ProSe Remote UE receives warning messages broadcasted over PC5 reference point by using a configured Destination Layer-2 ID(s) as specified in clause 5.1.4.1. The PC5 QoS parameters as specified in clause 5.1.4.1 are used to broadcast and receive the warning message for the 5G ProSe UE-to-Network Relay and the 5G ProSe Remote UE, respectively.\nA 5G ProSe Remote UE can receive the broadcasted warning message without establishing a connection to the 5G ProSe UE-to-Network Relay.\nThe 5G ProSe UE-to-Network Relay performs the duplication detection function as specified in TS 23.041 [32] to suppress the received duplicated warning messages over Uu. The 5G ProSe UE-to-Network Remote UE performs the duplication detection function as specified in TS 23.041 [32] to detect duplicated warning messages received over PC5 and/or Uu.\nNOTE:\tThe duplication detection function in the 5G ProSe UE-to-Network Relay avoids broadcasting the duplicated warning message over PC5.\nIf the 5G ProSe Layer-2 UE-to-Network Relay does not have Destination Layer-2 ID to broadcast Public Warning messages, the 5G ProSe Layer-2 UE-to-Network Relay forwards the PWS SIBs (i.e. SIB 6/7/8) to a connected 5G ProSe Layer-2 Remote UE over the unicast link as specified in TS 38.300 [12].\nThe Public Warning System architecture for 5G System is specified in TS 23.041 [32].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.2",
        "clause_5.1.4.1",
        "ts_22.268",
        "ts_23.041",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.1",
      "section_id": "6.1.1.1",
      "section_title": "General",
      "content": "The control plane stack consists of protocols for controlling:\n-\t5G ProSe Direct Discovery, specified in clause 6.1.1.2.1, clause 6.1.1.3, clause 6.1.1.4, clause 6.1.1.5 and clause 6.1.1.6;\n-\t5G ProSe Direct Communication, specified in clause 6.1.1.2.2;\n-\t5G ProSe UE-to-Network Relay, specified in clause 6.1.1.7;\n-\t5G ProSe UE-to-UE Relay, specified in clause 6.1.1.8.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.1.1.2.1",
        "clause_6.1.1.3",
        "clause_6.1.1.4",
        "clause_6.1.1.5",
        "clause_6.1.1.6",
        "clause_6.1.1.2.2",
        "clause_6.1.1.7",
        "clause_6.1.1.8"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.2.1",
      "section_id": "6.1.1.2.1",
      "section_title": "Discovery plane PC5 interface",
      "content": "The PC5 communication channel is used to carry the discovery messages over PC5 which are differentiated from other PC5 messages by the AS layer.\nFigure 6.1.1.2.1-1 depicts a discovery plane for NR PC5 reference point.\nLegend:\n-\tPC5-D: The PDCP/RLC/MAC/PHY functionality is specified in TS 38.300 [12].\n-\tThe \"ProSe Discovery protocol\" is used for handling ProSe Direct Discovery as specified in clause 6.3.2.\nFigure 6.1.1.2.1-1: Discovery Plane PC5 Interface",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2",
        "figure_6.1.1.2.1-1",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.2.2",
      "section_id": "6.1.1.2.2",
      "section_title": "PC5 Signalling Protocol",
      "content": "The PC5 Signalling Protocol stack specified in clause 6.1.2 of TS 23.287 [2] is used. The protocol used for the control plane signalling over the PC5 reference point for the secure layer-2 link is specified in clauses 6.4.3, 6.5.1 and 6.5.2.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.287_clause_6.1.2",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.3",
      "section_id": "6.1.1.3",
      "section_title": "UE - 5G DDNMF",
      "content": "Legend:\n-\tProSe Control Signalling between UE and 5G DDNMF is carried over the user plane and using the PC3a protocol as specified in TS 24.554 [23].\nNOTE 1:\tPC3a may be realized with one or more protocols.\nNOTE 2:\tIf 5G DDNMF is integrated with ProSe Application Server, 5G DDNMF provides PC3a interface towards UE and ProSe Application Server provides PC1 interface towards UE.\nFigure 6.1.1.3-1 Control Plane for PC3a Interface",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.1.1.3-1",
        "ts_24.554"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.4",
      "section_id": "6.1.1.4",
      "section_title": "5G DDNMF – UDM",
      "content": "5G DDNMF uses Nudm interface defined in TS 23.501 [4] to obtain the UE's subscription information for the authorization of the 5G ProSe Direct Discovery requests.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.5",
      "section_id": "6.1.1.5",
      "section_title": "5G DDNMF – 5G DDNMF",
      "content": "The control plane protocol(s) between 5G DDNMFs are defined in TS 29.500 [30].\nThe 5G DDNMFs uses N5g-ddnmf 5G DDNMF services defined in clause 7.1 to access the services provided by the other 5G DDNMF(s). The 5G DDNMF in HPLMN uses NRF to discover the 5G DDNMFs in VPLMN and Local PLMNs.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.1",
        "ts_29.500"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.6",
      "section_id": "6.1.1.6",
      "section_title": "5G DDNMF – ProSe Application Server",
      "content": "The 5G System architecture supports the service based Npc2 interface between 5G DDNMF and ProSe Application Server and optionally supports PC2 interface between 5G DDNMF and ProSe Application Server, to enable Proximity Services. See TS 23.501 [4] and TS 23.303 [3].\nNOTE:\tPC2 support between 5G DDNMF and ProSe Application Server is for backwards compatibility for early deployments using Diameter. PC2 interface is used for 5G ProSe Direct Discovery authorization.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.7.1",
      "section_id": "6.1.1.7.1",
      "section_title": "5G ProSe Layer-3 UE-to-Network Relay",
      "content": "The UE-UE protocol stacks for discovery and PC5 link management as defined in clause 6.1.1.2 apply to 5G ProSe Remote UE and 5G ProSe Layer-3 UE-to-Network Relay.\nAdditionally, when N3IWF is supported by the 5G ProSe Layer-3 UE-to-Network Relay, the following control plane protocol stack apply.\nLegend:\n-\tNAS, EAP-5G and IKEv2 between the Remote UE and the N3IWF are defined in clause 8.2.4 of TS 23.501 [4].\nFigure 6.1.1.7.1-1: Control plane protocol stacks between 5G ProSe Layer-3 Remote UE and N3IWF over 5G ProSe Layer-3 UE-to-Network Relay before the signalling IPSec SA is established\nLegend:\n-\tNAS, TCP and IPsec between the Remote UE and the N3IWF are defined in TS 23.501 [4] clause 8.2.4.\nFigure 6.1.1.7.1-2: Control plane protocol stacks between 5G ProSe Layer-3 Remote UE and N3IWF over 5G ProSe Layer-3 UE-to-Network Relay after the signalling IPSec SA is established",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.1.2",
        "ts_23.501_clause_8.2.4",
        "ts_23.501_figure_6.1.1.7.1-1",
        "ts_23.501_figure_6.1.1.7.1-2",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.7.2",
      "section_id": "6.1.1.7.2",
      "section_title": "5G ProSe Layer-2 UE-to-Network Relay",
      "content": "The UE-UE protocol stacks for discovery and PC5 signalling defined in clause 6.1.1.2 apply to 5G ProSe Remote UE and 5G ProSe Layer-2 UE-to-Network Relay.\nFigure 6.1.1.7.2-1 illustrates the protocol stack of the NAS connection for the 5G ProSe Layer-2 Remote UE for NAS-MM and NAS-SM. The NAS messages are transparently transferred between the 5G ProSe Layer-2 Remote UE and NG-RAN over the 5G ProSe Layer-2 UE-to-Network Relay using:\n-\tPDCP end-to-end connection between the 5G ProSe Layer-2 Remote UE and NG-RAN, where the role of the 5G ProSe Layer-2 UE-to-Network Relay is to relay the PDUs over the signalling radio bear without any modifications and using the functionality of the adaptation layer as specified in TS 38.300 [12].\n-\tConnection between NG-RAN and AMF over N2.\n-\tConnection between AMF and SMF over N11.\nFigure 6.1.1.7.2-1: End-to-End Control Plane for a Remote UE using Layer-2 UE-to-Network Relay\nThe control plane protocol stack used by the 5G ProSe Layer-2 UE-to-Network Relay is defined in clause 8.2.2 of TS 23.501 [4].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.1.2",
        "ts_23.501_clause_8.2.2",
        "figure_6.1.1.7.2-1",
        "ts_38.300",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.8.1",
      "section_id": "6.1.1.8.1",
      "section_title": "5G ProSe Layer-2 UE-to-UE Relay",
      "content": "Figure 6.1.1.8.1-1 illustrates control plane protocol stacks using a 5G ProSe Layer-2 UE-to-UE Relay. Security is established end-to-end between 5G ProSe End UEs as shown by the PDCP layer terminating in the 5G ProSe End UEs.\nFigure 6.1.1.8.1-1: End-to-End Control Plane protocol stacks using a 5G ProSe Layer-2 UE-to-UE Relay\nNOTE 1:\tOnly the End-to-End control plane protocol stack is shown. The control plane protocol stack of the per-hop PC5 unicast link between 5G ProSe End UEs and 5G ProSe Layer-2 UE-to-UE Relay reuses the PC5-S protocol stack defined in clause 6.1.1.2.\nNOTE 2:\tPC5-S messages over per-hop PC5 unicast links and over End-to-End PC5 unicast links are supported. A End-to-End PC5-S message is the message transferred between the 5G ProSe End UEs and a direct PC5-S message is the message transferred between a 5G ProSe End UE and a 5G ProSe Layer-2 UE-to-UE Relay.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.1.2",
        "figure_6.1.1.8.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.1.8.2",
      "section_id": "6.1.1.8.2",
      "section_title": "5G ProSe Layer-3 UE-to-UE Relay",
      "content": "The control plane protocol stack of the PC5 unicast link between 5G ProSe End UEs and 5G ProSe Layer-3 UE-to-UE Relay reuses the PC5-S protocol stack defined in clause 6.1.1.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.1.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.1",
      "section_id": "6.1.2.1",
      "section_title": "General",
      "content": "The user plane stack consists of protocols for data transmission via:\n-\t5G ProSe Direct Communication, specified in clause 6.1.2.2;\n-\t5G ProSe UE-to-Network Relay, specified in clause 6.1.2.3;\n-\t5G ProSe UE-to-UE Relay, specified in clause 6.1.2.4.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.1.2.2",
        "clause_6.1.2.3",
        "clause_6.1.2.4"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.2",
      "section_id": "6.1.2.2",
      "section_title": "UE - UE",
      "content": "Figure 6.1.2.2-1 depicts a user plane for NR PC5 reference point, i.e. PC5 User Plane Protocol stack.\nLegend:\n-\tPC5-U: The SDAP/PDCP/RLC/MAC/PHY functionality is specified in TS 38.300 [12].\nFigure 6.1.2.2-1: User Plane for NR PC5 reference point\nPDCP SDU types of IP, Ethernet, Unstructured and Address Resolution Protocol are supported. For IP PDCP SDU type, both IPv4 and IPv6 are supported.\nNOTE:\tAddress Resolution Protocol is only supported for broadcast and groupcast mode 5G ProSe Direct Communication.\nThe packets from ProSe application layer are handled by the ProSe layer before transmitting them to the AS layer, e.g. ProSe layer maps the IP, Ethernet and Unstructured packets to PC5 QoS Flow and marks the corresponding PFI.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.1.2.2-1",
        "ts_38.300_figure_6.1.2.2-1",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.3.1",
      "section_id": "6.1.2.3.1",
      "section_title": "5G ProSe Layer-3 UE-to-Network Relay",
      "content": "Legend:\n-\tGPRS Tunnelling Protocol for the user plane (GTP‑U): This protocol tunnels user data between NG-RAN node and UPF as well as between the UPFs in the backbone network (not shown in the figure). GTP-U shall encapsulate all end user PDU packets.\n-\tSMF controls the user plane tunnel establishment and establishes User Plane Bearers between NG-RAN node and UPF.\n-\tUDP/IP: These are the backbone network protocols used for routing user data and control signalling.\n-\tUu: The NR Uu radio protocols of NG-RAN between the UE-to-Network Relay and the NG-RAN node are specified in TS 38.300 [12].\n-\tPC5-U: The radio protocols between the UE and the UE-to-Network Relay are specified in clause 6.1.2.2.\nFigure 6.1.2.3.1-1: User plane protocol stack for Layer-3 UE-to-Network Relay\nLegend:\n-\tIPSec, Inner IP and GRE between the UE and the N3IWF are defined in TS 23.501 [4] clause 8.3.2.\nFigure 6.1.2.3.1-2: User plane protocol stacks for Layer-3 UE-to-Network Relay with N3IWF support",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2.2",
        "ts_23.501_clause_8.3.2",
        "figure_6.1.2.3.1-1",
        "ts_23.501_figure_6.1.2.3.1-2",
        "ts_38.300",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.3.2",
      "section_id": "6.1.2.3.2",
      "section_title": "5G ProSe Layer-2 UE-to-Network Relay",
      "content": "Figure 6.1.2.2.2-1 illustrates the protocol stack for the user plane transport, related to a PDU Session, including a 5G ProSe Layer 2 UE-to-Network Relay. The PDU layer corresponds to the PDU carried between the 5G ProSe Layer-2 Remote UE and the Data Network (DN) over the PDU session. The SDAP and PDCP protocols are specified in TS 38.300 [12]. PDCP end-to-end connection is between the 5G ProSe Layer-2 Remote UE and NG-RAN. The functionality of the adaptation layer is specified in TS 38.351 [28].\nFigure 6.1.2.3.2-1: End-to-End User Plane Stack for a 5G ProSe Remote UE using 5G ProSe Layer-2 UE-to-Network Relay",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.1.2.2.2-1",
        "ts_38.351_figure_6.1.2.3.2-1",
        "ts_38.300",
        "ts_38.351"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.4.1",
      "section_id": "6.1.2.4.1",
      "section_title": "5G ProSe Layer-2 UE-to-UE Relay",
      "content": "Figure 6.1.2.4.1-1 illustrates user plane protocol stacks using a 5G ProSe Layer-2 UE-to-UE Relay. Security is established end-to-end between 5G ProSe End UEs as shown by the PDCP layer terminating in the 5G ProSe End UEs.\nFigure 6.1.2.4.1-1: End-to-End User Plane protocol stacks using a 5G ProSe Layer-2 UE-to-UE Relay\nNOTE:\tIP, Ethernet and Unstructured traffic types are supported.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.1.2.4.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.1.2.4.2",
      "section_id": "6.1.2.4.2",
      "section_title": "5G ProSe Layer-3 UE-to-UE Relay",
      "content": "The user plane protocol stack of the PC5 unicast link between 5G ProSe End UEs and 5G ProSe Layer-3 UE-to-UE Relay reuses the user plane protocol stack defined in clause 6.1.2.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.2.1",
      "section_id": "6.2.1",
      "section_title": "General",
      "content": "The procedures for service authorization and provisioning to UE may be initiated by the PCF (as described in clause 6.2.2), by the UE (as described in clause 6.2.4), or by the AF (as described in clause 6.2.5).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.2.2",
        "clause_6.2.4",
        "clause_6.2.5"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.2.2",
      "section_id": "6.2.2",
      "section_title": "PCF based Service Authorization and Provisioning to UE",
      "content": "For PCF based Service Authorization and Provisioning to UE, the Registration procedures as defined in clause 4.2.2.2 of TS 23.502 [5], UE Policy Association Establishment procedure as defined in clause 4.16.11 of TS 23.502 [5] and UE Policy Association Modification procedure as defined in clause 4.16.12 of TS 23.502 [5] apply with the following additions:\n-\tIf the UE indicates 5G ProSe Capability in the Registration Request message and if the UE is authorized to use 5G ProSe service based on subscription data, the AMF selects the PCF which supports 5G ProSe Policy/Parameter provisioning as described in clause 6.2.3 and establishes a UE policy association with the PCF for 5G ProSe Policy/Parameter delivery. The AMF reports the authorized 5G ProSe Capability to the selected PCF, which may determine the 5G ProSe Policy/Parameter based on the UE's authorized 5G ProSe Capability.\nThe PCF may update the 5G ProSe Policy/parameters to the UE in following conditions:\n-\tUE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved by using the procedure of UE Policy Association Modification initiated by the AMF, as defined in clause 4.16.12.1 of TS 23.502 [5].\n-\tWhen there is a subscription change in the list of PLMNs where the UE is authorized to perform 5G ProSe services. This is achieved by using UE Policy Association Modification initiated by the PCF procedure as defined in clause 4.16.12.2 of TS 23.502 [5].\n-\tWhen there is a change of service specific parameter (including path selection policy) as described in clause 6.2.5 (performing the procedure in clause 4.15.6.7 of TS 23.502 [5]).\n-\tWhen the timer associated with some Policy/parameter expires.\n-\tWhen the UE determines that the ProSe Policy/parameter(s) is invalid and performs UE triggered Policy Provisioning procedure to the PCF.\nIf the serving PLMN is removed from the list of PLMNs in the service authorization parameters, the service authorization is revoked in the UE.\nWhen the UE is roaming, the change of subscription resulting in updates of the service authorization parameters are transferred to the UE by H-PCF via V-PCF.\nThe UE may perform ProSe UE triggered Policy Provisioning procedure to the PCF, after Registration procedure has been completed, as specified in clause 6.2.4 when the UE determines the 5G ProSe Policy/Parameter is invalid (e.g. Policy/Parameter is outdated, missing or invalid).\nWhen the UE disables a ProSe capability, the PCF may stop updating the corresponding ProSe Policy/parameter(s) and when the UE enables a ProSe capability the PCF may need to provide or update the corresponding ProSe Policy/parameter(s).\nWhen a 5G ProSe Layer-3 Remote UE is accessing to 5GC via a 5G ProSe Layer-3 UE-to-Network Relay without involving N3IWF, the PCF based provisioning and update of 5G ProSe Policy/parameters to the 5G ProSe Layer-3 Remote UE are not supported.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.2.2.2",
        "ts_23.502_clause_4.16.11",
        "ts_23.502_clause_4.16.12",
        "clause_6.2.3",
        "ts_23.502_clause_4.16.12.1",
        "ts_23.502_clause_4.16.12.2",
        "clause_6.2.5",
        "ts_23.502_clause_4.15.6.7",
        "clause_6.2.4",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.2.3",
      "section_id": "6.2.3",
      "section_title": "PCF discovery",
      "content": "PCF discovery and selection mechanism defined in clause 6.3.7.1 of TS 23.501 [4] applies with the following addition to enable a PCF instance is selected for 5G ProSe service and for UE:\n-\tBased on the indication from the UE and/or UE subscription data during the Registration procedure as specified in clause 6.2.2, the AMF may include the 5G ProSe Capability indication in the Nnrf_NFDiscovery_Request message as the optional input parameter. If provided, the NRF takes the information into account for discovering the PCF instance.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_6.3.7.1",
        "clause_6.2.2",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.2.4",
      "section_id": "6.2.4",
      "section_title": "Procedure for UE triggered ProSe Policy provisioning",
      "content": "The UE triggered Policy Provisioning procedure is initiated by the UE to request ProSe Policy/Parameter from the PCF when UE determines the 5G ProSe Policy/Parameter is invalid in the following cases:\n-\tif the validity timer indicated in the 5G ProSe Policy/Parameter expires;\n-\tif there are no valid parameters, e.g. for the 5G ProSe Identifier a UE wants to use, for current area, or due to abnormal situation.\nFigure 6.2.4-1: UE triggered 5G ProSe Policy provisioning procedure\n1.\tThe UE sends the UL NAS TRANSPORT message carrying the UE Policy Container (UE Policy Provisioning Request to request 5G ProSe policies) to the AMF.\n2.\tThe AMF sends Namf_Communication_N1MessageNotify request to the PCF including the UE Policy Container received from UE.\n3.\tThe PCF receives UE Policy Container which indicates UE Policy Provisioning Request to request 5G ProSe policies. If the 5G ProSe policies are authorized based on AMF input, the PCF performs the UE Policy delivery procedure as defined in clause 4.2.4.3 of TS 23.502 [5].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.2.4.3",
        "figure_6.2.4-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.2.5",
      "section_id": "6.2.5",
      "section_title": "AF-based service parameter provisioning for ProSe over control plane",
      "content": "For 5G ProSe service parameter provisioning (i.e. creating, updating and deleting), the procedure defined in clause 4.15.6.7 of TS 23.502 [5] is performed with the following considerations:\n-\tThe AF in TS 23.502 [5] is considered as ProSe Application Server in this specification.\n-\tService Description indicates 5G ProSe service domain information.\n-\tService Parameters include parameters for 5G ProSe Direct Discovery and 5G ProSe Direct Communications. The detailed information on the parameters is described in clause 5.1.2.1 and clause 5.1.3.1.\n-\tService Parameters for 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-Network Relay Communications. The detailed information on the parameters is described in clause 5.1.4.1.\n-\tService Parameters for 5G ProSe UE-to-UE Relay Discovery and 5G ProSe UE-to-UE Relay Communications. The detailed information on the parameters is described in clause 5.1.5.1.\nNOTE:\tIt is assumed that the ProSe service domain information is set based on the Service Level Agreement with the operator.",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_23.502_clause_4.15.6.7",
        "clause_5.1.2.1",
        "clause_5.1.3.1",
        "clause_5.1.4.1",
        "clause_5.1.5.1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.1",
      "section_id": "6.3.1.1",
      "section_title": "Overview",
      "content": "5G ProSe Direct Discovery is defined as the process that detects and identifies another UE in proximity using NR radio signals. There are two types of 5G ProSe Direct Discovery supported over PC3a reference point: open and restricted, as defined in TS 23.303 [3]. 5G ProSe Direct Discovery can be a standalone service or can be used for subsequent actions e.g. to initiate 5G ProSe Direct Communication.\nProSe-enabled UEs which have obtained authorization to participate in 5G ProSe Direct Discovery shall not continue in participating in 5G ProSe Direct Discovery procedures over PC3a reference point defined in clause 6.3.1 when they detect loss of NG-RAN coverage in the serving PLMN.\nWith 5G ProSe Direct Discovery, the UE can use inter-PLMN discovery transmission based on the indication from the serving NG-RAN or the provisioned radio resource on the UE. How the serving cell authorizes the UE to use inter-PLMN radio resource is specified in TS 38.331 [16].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.3.1",
        "ts_23.303",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.2",
      "section_id": "6.3.1.2",
      "section_title": "Overall procedure for 5G ProSe Direct Discovery (Model A)",
      "content": "Figure 6.3.1.2-1: Overall procedure for Model A 5G ProSe Direct Discovery\nThis procedure is applied for open and restricted 5G ProSe Direct Discovery when the ProSe enabled UE is served by NG-RAN.\n1.\tService authorisation for 5G ProSe Direct Discovery services is performed for as defined in clause 6.2.\nIf the UE is authorised to announce:\n2a.\tWhen the UE is triggered to announce, then it sends a discovery request for announcing to the 5G DDNMF in HPLMN as defined in clause 6.3.1.4. In addition, for restricted 5G ProSe Direct Discovery, the 5G DDNMF further interacts with the ProSe Application server for the authorization of the discovery request.\n3a.\tIf the request is successful and is provided with ProSe Application Code/ProSe Restricted Code, it starts announcing on PC5 interface.\nFor ProSe restricted discovery and UE requests \"on demand\" announcing, ProSe Restricted Code may be provided to UE after this procedure. In this case, UE waits for the ProSe Restricted Code allocation and starts to announce the ProSe Restricted Code on PC5 after receiving it in Announcing Alert procedure specified in clause 6.3.1.6.\nNOTE 1:\tMore details on the Access Stratum protocol of this step are provided in RAN specifications.\nIf the UE is authorised to monitor:\n2b.\tWhen the UE is triggered to monitor, it sends a discovery request for monitoring to the 5G DDNMF as defined in clause 6.3.1.4. In addition, for restricted 5G ProSe Direct Discovery, the 5G DDNMF further interacts with the ProSe Application server for the authorization of the discovery request.\n3b.\tIf the request is successful and the UE is provided with a Discovery Filter consisting of ProSe Application Code(s)/ProSe Restricted Code(s) and/or ProSe Application Mask(s), it starts monitoring for these ProSe Application Codes/ProSe Restricted Codes on the PC5 interface.\nNOTE 2:\tMore details on the Access Stratum protocol of this step are provided in RAN specifications.\n4b.\tWhen the UE detects that one or more ProSe Application Code(s)/ProSe Restricted Code(s) that match the filter (see clause 5.8.1), it reports the ProSe Application Code(s)/ProSe Restricted Code(s) to the 5G DDNMF as defined in clause 6.3.1.5.\nNon-roaming direct discovery procedures cover the case where both the \"announcing UE\" and \"monitoring UE\" are served by their respective HPLMN. Roaming direct discovery procedures cover the other cases.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.2",
        "clause_6.3.1.4",
        "clause_6.3.1.6",
        "clause_5.8.1",
        "clause_6.3.1.5",
        "figure_6.3.1.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.3",
      "section_id": "6.3.1.3",
      "section_title": "Overall procedure for 5G ProSe Direct Discovery (Model B)",
      "content": "Figure 6.3.1.3-1: Overall procedure for Model B 5G ProSe Direct Discovery\nThis procedure is applied for restricted 5G ProSe Direct Discovery when the ProSe enabled UE is served by NG-RAN.\n1.\tService authorisation for 5G ProSe Direct Discovery services is performed as defined in clause 6.2.\nIf the UE is authorised to perform restricted 5G ProSe Direct Discovery, Model B, as a Discoveree UE, the following steps take place:\n2a.\tWhen the UE is triggered to perform restricted 5G ProSe Direct Discovery, Model B, it sends a discovery request to the 5G DDNMF in the HPLMN to obtain a ProSe Response Code as defined in clause 6.3.1.4. The 5G DDNMF further interacts with ProSe Application Server for the authorization of the discovery request.\n3a.\tIf the request is successful and the UE is provided with a ProSe Response Code and an associated Discovery Query Filter(s), then the UE starts monitoring for the ProSe Query Code on PC5 interface.\n4a.\tIf a received ProSe Query Code matches any of the Discovery Query Filter(s), the UE announces the associated ProSe Response Code on the PC5 interface.\nNOTE 1:\tMore details on the Access Stratum protocol of this step are provided in RAN specifications.\nIf the UE is authorised to perform restricted 5G ProSe Direct Discovery, Model B, as a Discoverer UE, the following steps take place:\n2b.\tWhen the UE is triggered to perform restricted 5G ProSe Direct Discovery, Model B, it sends a discovery request to the 5G DDNMF in the HPLMN for a ProSe Query Code as defined in clause 6.3.1.4. The 5G DDNMF further interacts with ProSe Application Server for the authorization of the discovery request.\n3b.\tIf the request is successful and the UE is provided with a ProSe Query Code and the Discovery Response Filter(s) consisting of ProSe Response Code(s) and ProSe Application Mask(s), the UE announces the ProSe Query Code on the PC5 interface.\n4b.\tThe UE starts to monitor on PC5 interface for any ProSe Response Code(s) that might match the Discovery Response Filter(s).\nNOTE 2:\tMore details on the Access Stratum protocol of this step are provided in RAN specifications.\n5b.\tWhen the UE detects a match for one or more ProSe Response Code(s), it reports the ProSe Response Code to the 5G DDNMF as defined in clause 6.3.1.5.\nNon-roaming direct discovery procedures cover the case where both the Discoveree UE and Discoverer UE are served by their respective HPLMN. Roaming direct discovery procedures cover the other cases.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.2",
        "clause_6.3.1.4",
        "clause_6.3.1.5",
        "figure_6.3.1.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.4",
      "section_id": "6.3.1.4",
      "section_title": "Discovery Request procedures",
      "content": "The Discovery Request procedure can be used by the \"announcing UE\" or \"monitoring UE\" in order to be authorised to access the discovery resources and perform 5G ProSe Direct Discovery. The exact signalling procedures involving the UE, the 5G DDNMFs and the ProSe Application Server are specified in TS 23.303 [3] clause 5.3.3, with the following modifications:\n-\tthe 5G DDNMF takes the role of \"ProSe Function\" in the procedure;\n-\tUpon receiving a Discovery Request for restricted discovery from a UE, if the 5G DDNMF does not have a valid PDUID for that UE, the 5G DDNMF searches the PCF for the UE using Nbsf_Management_Subscribe Request and BSF provides the address of the PCF for the UE in Nbsf_Management_Subscribe Response as defined in the clause 5.2.13.2.6 in TS 23.502 [5]. The 5G DDNMF gets the PDUID and subscribes to notifications on Change of PDUID using Npcf_AMPolicyAuthorization_Subscribe from the PCF for the UE as defined in the clause 5.2.5.8.6 in TS 23.502 [5], including the SUPI, Event ID set to \"Change of PDUID\" and immediate reporting flag to indicate that the current PDUID value should be provided to the consumer. The PCF provides the PDUID and its validity timer.\nNOTE:\tIf the address of the PCF for the UE is changed, the BSF notifies the 5G DDNMF of the changed PCF address in Nbsf_Management_Notify as defined in the clause 5.2.13.2.8 in TS 23.502 [5].\n-\tAt the time the PCF generates a new PDUID, if the subscription to \"Change of PDUID\" is active it sends Npcf_AMPolicyAuthorization_Notify to the 5G DDNMF to report a new PDUID and its validity timer.\n-\tthe HSS is replaced by UDM;\n-\tthe E-UTRAN is replaced by NG-RAN and E-UTRA is replaced with NR;\n-\tcorresponding 5GS identifiers replace the EPS identifiers, e.g. use SUPI instead of IMSI and use GPSI instead of MSISDN;\n-\tPC5_tech parameter is omitted and the intended PC5 radio technology is NR.\nThe Discovery Request procedure can also be used by the Discoveree UE or the Discoverer UE in order to be authorised to access the discovery resources and perform 5G ProSe Direct Discovery, Model B. The exact signalling procedures are defined in TS 23.303 [3] clause 5.3.3A, with the same modifications as in the above list apply.\nThe events reported by the PCF, described in clause 6.1.3.18 in TS 23.503 [9] are extended to report \"Change of PDUID\" to the 5G DDNMF.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.303_clause_5.3.3",
        "ts_23.502_clause_5.2.13.2.6",
        "ts_23.502_clause_5.2.5.8.6",
        "ts_23.502_clause_5.2.13.2.8",
        "ts_23.503_clause_6.1.3.18",
        "ts_23.303",
        "ts_23.502",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.5",
      "section_id": "6.3.1.5",
      "section_title": "Discovery Reporting procedures",
      "content": "The Discovery Reporting procedure can be used by the \"monitoring UE\" (in Model A) and Discoverer UE (in Model B) to request the 5G DDNMF to resolve a matched ProSe Discovery Code(s) (ProSe Application Code for open discovery and ProSe Restricted Code for restricted discovery) and obtain the corresponding ProSe Application ID(s) or RPAUID and additional information, e.g. metadata.\nThe signalling procedures for the \"monitoring UE\" (in Model A) is specified in TS 23.303 [3] clause 5.3.4 and the signalling procedures for the Discoverer UE (in Model B) is specified in TS 23.303 [3] clause 5.3.4A, with the following modifications:\n-\tthe 5G DDNMF takes the role of \"ProSe Function\" in the procedure;\n-\tthe HSS is replaced by UDM;\n-\tcorresponding 5GS identifiers replace the EPS identifiers, e.g. use SUPI instead of IMSI and use GPSI instead of MSISDN;\n-\tPC5_tech parameter is omitted and the intended PC5 radio technology is NR.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.303_clause_5.3.4",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.6",
      "section_id": "6.3.1.6",
      "section_title": "Announcing Alert Procedures for restricted discovery",
      "content": "When supported by the 5G DDNMF and the UE, the Announcing Alert procedure allows the 5G DDNMF to postpone the ProSe Restricted Code allocation, so that the announcing UE would be only triggered by this procedure to announce when the 5G DDNMF receives a Monitor Request from a UE in the vicinity of the announcing UE. This procedure is an optional step of the Discovery Request procedure defined in clause 6.3.1.4.\nThe signalling procedure of Announcing Alert Procedure is specified in TS 23.303 [3] clause 5.3.5, with the same modifications listed in clause 6.3.1.4.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.3.1.4",
        "ts_23.303_clause_5.3.5",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.1.7",
      "section_id": "6.3.1.7",
      "section_title": "Direct Discovery Update Procedures",
      "content": "The 5G DDNMF can at any time update/revoke a previously allocated ProSe Application Code, or Discovery Filters. The UE can decide at any time to stop announcing a ProSe Application Code or monitoring set of Discovery Filter(s). The Direct Discovery Update procedure as specified in TS 23.303 [3] clause 5.3.6A.1 allows both the 5G DDNMF and the UE to update or revoke the previously authorized discovery. In the defined signalling procedures, the 5G DDNMF(s) takes the role of the \"ProSe Function\".\nA user may decide at any time to change the discovery permissions relating to other users in a ProSe Application Server; then the corresponding ProSe Application Server triggers the procedure as specified in clause 5.3.6A.2 of TS 23.303 [3] towards the affected 5G DDNMF(s) to update/revoke the discovery permissions. In the defined signalling procedures, the 5G DDNMF(s) takes the role of the \"ProSe Function\".",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.303_clause_5.3.6",
        "ts_23.303"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.1",
      "section_id": "6.3.2.1",
      "section_title": "General",
      "content": "A PC5 communication channel is used to carry the discovery message over PC5 and the discovery message over PC5 is differentiated from other PC5 messages by AS layer.\nBoth Model A and Model B discovery as defined in TS 23.303 [3] are supported:\n-\tModel A uses a single discovery protocol message (Announcement).\n-\tModel B uses two discovery protocol messages (Solicitation and Response).\nDepicted in figure 6.3.2.1-1 is the procedure for 5G ProSe Direct Discovery with Model A.\nFigure 6.3.2.1-1: 5G ProSe direct discovery with Model A\n1.\tThe Announcing UE sends an Announcement message. The Announcement message may include the Type of Discovery Message, ProSe Application Code or ProSe Restricted Code, security protection element, [metadata information]. The Application layer metadata information may be included as metadata in the Announcement message.\nThe Destination Layer-2 ID and Source Layer-2 ID used to send the Announcement message are specified in clause 5.8.1.2 and clause 5.8.1.3.\nThe Monitoring UE determines the Destination Layer-2 ID for signalling reception. The Destination Layer-2 ID is configured with the UE(s) as specified in clause 5.8.1.2.\nDepicted in figure 6.3.2.1-2 is the procedure for 5G ProSe Direct Discovery with Model B.\nFigure 6.3.2.1-2: 5G ProSe direct discovery with Model B\n1.\tThe Discoverer UE sends a Solicitation message. The Solicitation message may include Type of Discovery Message, ProSe Query Code, security protection element.\nThe Destination Layer-2 ID and Source Layer-2 ID used to send the Solicitation message are specified in clause 5.8.1.2 and clause 5.8.1.3.\nHow the Discoveree UE determines the Destination Layer-2 ID for signalling reception is specified in clause 5.8.1.2.\n2.\tThe Discoveree UE that matches the solicitation message responds to the Discoverer UE with the Response message. The Response message may include Type of Discovery Message, ProSe Response Code, security protection element, [metadata information]. The Application layer metadata information may be included as metadata in the Response message.\nThe Source Layer-2 ID used to send the Response message is specified in clause 5.8.1.3. The Destination Layer-2 ID is set to the Source Layer-2 ID of the received Solicitation message.\nNOTE:\tDetails of security protection element are specified in TS 33.503 [29].",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.8.1.2",
        "clause_5.8.1.3",
        "figure_6.3.2.1-1",
        "figure_6.3.2.1-2",
        "ts_23.303",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.2.1",
      "section_id": "6.3.2.2.1",
      "section_title": "General",
      "content": "Group Member Discovery is applicable to public safety use and commercial services. To perform Group Member Discovery, the UE is configured with the related information as described in clause 5.2.\nGroup Member Discovery is a form of restricted discovery in that only users that are affiliated with each other can discover each other (e.g. only users sharing the same Application Layer Group ID).\nIn the case of Public Safety use, the ProSe Restricted Code is not used for Group Member Discovery and pre-configured or provisioned information for the Discovery procedures as defined in clause 5.2 is used.\nNOTE:\tThe Group Member Discovery performed by Application Layer in coordination with Application Server is out of scope of this specification.\nBoth Model A and Model B discovery are supported:\n-\tModel A uses a single discovery protocol message (Announcement).\n-\tModel B uses two discovery protocol messages (Solicitation and Response).",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.2.2",
      "section_id": "6.3.2.2.2",
      "section_title": "Procedure for Group Member Discovery with Model A",
      "content": "Depicted in Figure 6.3.2.2.2-1 is the procedure for Group Member Discovery with Model A.\nFigure 6.3.2.2.2-1: Group Member Discovery with Model A\n1.\tThe announcing UE sends a Group Member Discovery Announcement message. The Group Member Discovery Announcement message includes the Type of Discovery Message, Announcer Info and Application Layer Group ID (See clause 5.8.1).\nThe Destination Layer-2 ID and Source Layer-2 ID used to send the Group Member Discovery Announcement message are specified in clause 5.8.1.2 and clause 5.8.1.3.\nThe Monitoring UE determines the Destination Layer-2 ID for signalling reception as specified in clause 5.8.1.2.\nNOTE:\tA UE may send multiple Group Member Discovery Announcement messages (Model A) if the UE belongs to more than one discovery group.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.1",
        "clause_5.8.1.2",
        "clause_5.8.1.3",
        "figure_6.3.2.2.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.2.3",
      "section_id": "6.3.2.2.3",
      "section_title": "Procedure for Group Member Discovery with Model B",
      "content": "Depicted in Figure 6.3.2.2.3-1 is the procedure for Group Member Discovery with Model B.\nFigure 6.3.2.2.3-1: Group Member Discovery with Model B\n1.\tThe discoverer UE sends a Group Member Discovery Solicitation message. The Group Member Discovery Solicitation message includes the Type of Discovery Message, Discoverer Info, Application Layer Group ID and optionally Target Info (see clause 5.8.1).\nThe Destination Layer-2 ID and Source Layer-2 ID used to send the Group Member Discovery Solicitation message are specified in clause 5.8.1.2 and clause 5.8.1.3.\nHow the Discoveree UE determines the Destination Layer-2 ID for signalling reception is specified in clause 5.8.1.2.\n2.\tThe discoveree UEs that match the values of the parameters (including Application Layer Group ID and Target Info) contained in the solicitation message, responds to the discoverer UE with a Group Member Discovery Response message. The Group Member Discovery Response message includes the Type of Discovery Message, Discoveree Info and Application Layer Group ID (see clause 5.8.1).\nThe Source Layer-2 ID used to send the Group Member Discovery Response message is specified in clause 5.8.1.3. The Destination Layer-2 ID is set to the Source Layer-2 ID of the received Group Member Discovery Solicitation message.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.1",
        "clause_5.8.1.2",
        "clause_5.8.1.3",
        "figure_6.3.2.2.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.3.1",
      "section_id": "6.3.2.3.1",
      "section_title": "General",
      "content": "5G ProSe UE-to-Network Relay Discovery is applicable to both 5G ProSe Layer-3 and Layer-2 UE-to-Network relay discovery for public safety use and commercial services. To perform 5G ProSe UE-to-Network Relay Discovery, the 5G ProSe Remote UE and the 5G ProSe UE-to-Network Relay are pre-configured or provisioned with the related information as described in clause 5.1.\nIn 5G ProSe UE-to-Network Relay Discovery, the UEs use pre-configured or provisioned information for the relay discovery procedures as defined in clause 5.1.4.1.\nThe Relay Service Code (RSC) is used in the 5G ProSe UE-to-Network Relay discovery, to indicate the connectivity service the 5G ProSe UE-to-Network Relay provides to the 5G ProSe Remote UE. The RSCs (including the dedicated one(s) for emergency service) are configured on the 5G ProSe UE-to-Network Relay and the 5G ProSe Remote UE as defined in clause 5.1.4. The 5G ProSe UE-to-Network Relay and the 5G ProSe Remote UE are aware of whether a RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-Network Relay service and whether a RSC is for emergency service, based the policy as specified in clause 5.1.4. A 5G ProSe UE-to-Network Relay supporting multiple RSCs can advertise the RSCs using multiple discovery messages, with one RSC per discovery message.\nNOTE:\tWhen the 5G ProSe UE-to-Network Relay can advertise the emergency RSC(s) is specified in clause 5.4.4.\nAdditional information not directly used for discovery can also be advertised using the PC5-D protocol stack in single or separate discovery messages of type \"Relay Discovery Additional Information\" as defined in clause 5.8.3.1.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1",
        "clause_5.1.4.1",
        "clause_5.1.4",
        "clause_5.4.4",
        "clause_5.8.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.3.2",
      "section_id": "6.3.2.3.2",
      "section_title": "Procedure for 5G ProSe UE-to-Network Relay Discovery with Model A",
      "content": "Depicted in Figure 6.3.2.3.2-1 is the procedure for 5G ProSe UE-to-Network Discovery with Model A.\nFigure 6.3.2.3.2-1: 5G ProSe UE-to-Network Relay Discovery with Model A\n1.\tThe 5G ProSe UE-to-Network Relay sends a UE-to-Network Relay Discovery Announcement message. The UE-to-Network Relay Discovery Announcement message contains the Type of Discovery Message, Announcer Info and RSC and is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.3.\nFor 5G ProSe Layer-3 UE-to-Network Relay, the 5G ProSe Layer-3 UE-to-Network Relay shall only include a RSC in the UE-to-Network Relay Discovery Announcement when the S-NSSAI associated with that RSC belongs to the Allowed NSSAI of the UE-to-Network Relay.\nThe 5G ProSe Remote UE (1 to 3) determines the Destination Layer-2 ID for signalling reception. The Destination Layer-2 ID is configured with the UE(s) as specified in clause 5.1.4.1.\n5G ProSe Remote UE (1 to 3) monitors announcement messages with the 5G ProSe UE-to-Network RSC corresponding to the desired services.\nOptionally, the 5G ProSe UE-to-Network Relay may also send Relay Discovery Additional Information messages as defined in clause 6.5.1.3. The parameters contained in this message and the Source Layer-2 ID and Destination Layer-2 ID used for sending and receiving the message are described in clause 5.8.3.\nThe 5G ProSe Remote UE selects the 5G ProSe UE-to-Network Relay based on the information received in step 1.\nNOTE:\tAccess Stratum layer information used for 5G ProSe UE-to-Network Relay selection is specified in RAN specifications.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.3",
        "clause_5.1.4.1",
        "clause_6.5.1.3",
        "figure_6.3.2.3.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.3.3",
      "section_id": "6.3.2.3.3",
      "section_title": "Procedure for 5G ProSe UE-to-Network Relay Discovery with Model B",
      "content": "Depicted in Figure 6.3.2.3.3-1 is the procedure for 5G ProSe UE-to-Network Relay Discovery with Model B.\nFigure 6.3.2.3.3-1: 5G ProSe UE-to-Network Relay Discovery with Model B\n1.\tThe 5G ProSe Remote UE sends a 5G ProSe UE-to-Network Relay Discovery Solicitation message. The 5G ProSe UE-to-Network Discovery Solicitation message contains the Type of Discovery Message, Discoverer Info, RSC and optionally Target Info and is send using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.3. The 5G ProSe Remote UE discovering a 5G ProSe UE-to-Network Relay sends a solicitation message with the RSC which is associated to the desired connectivity service. The RSC is based on the Policy/Parameters specified in clause 5.1.4.1.\nHow the 5G ProSe UE-to-Network Relays (1 to 3) determine the Destination Layer-2 ID for signalling reception is specified in clause 5.8.3. The Destination Layer-2 ID is configured with the UE(s) as specified in clause 5.1.4.1.\n2.\tIf the RSC contained in the solicitation message matches any of the (pre)configured RSC(s), as specified in clause 5.1.4.1, of a 5G ProSe UE-to-Network Relay, and the Target Info contained in the solicitation message, if any, matches the 5G ProSe UE-to-Network Relay, the 5G ProSe UE-to-Network Relays (e.g. 1 and 2) respond to the 5G ProSe Remote UE with a UE-to-Network Relay Discovery Response message. The 5G ProSe UE-to-Network Relay Discovery Response message contains the Type of Discovery Message, Discoveree Info and RSC and is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.3.\nFor 5G ProSe Layer-3 UE-to-Network Relay, the 5G ProSe UE-to-Network Relay shall only respond to a matching RSC in the UE-to-Network Relay Discovery Solicitation message when the S-NSSAI associated with that RSC belongs to the Allowed NSSAI of the 5G ProSe UE-to-Network Relay.\nThe 5G ProSe Remote UE selects the 5G ProSe UE-to-Network Relay based on the information received in step 2.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.3",
        "clause_5.1.4.1",
        "figure_6.3.2.3.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.4.1",
      "section_id": "6.3.2.4.1",
      "section_title": "General",
      "content": "5G ProSe UE-to-UE Relay Discovery is applicable to both 5G ProSe Layer-3 and Layer-2 UE-to-UE Relay Discovery for public safety use and commercial services. To perform 5G ProSe UE-to-UE Relay Discovery, the 5G ProSe End UE and the 5G ProSe UE-to-UE Relay are pre-configured or provisioned with the related information as described in clause 5.1.\nA Relay Service Code (RSC) is used in the 5G ProSe UE-to-UE Relay Discovery, to indicate the connectivity service the 5G ProSe UE-to-UE Relay provides to 5G ProSe End UEs. The RSCs are pre-configured or provisioned on the 5G ProSe UE-to-UE Relay and the 5G ProSe End UE as defined in clause 5.1. The 5G ProSe UE-to-UE Relay and the 5G ProSe End UE are aware of whether a RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-UE Relay service based on the UE-to-UE Relay Layer indicator as specified in clause 5.1. A 5G ProSe UE-to-UE Relay supporting multiple RSCs advertises the RSCs using multiple discovery messages, with one RSC per discovery message.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.4.2",
      "section_id": "6.3.2.4.2",
      "section_title": "Procedure for 5G ProSe UE-to-UE Relay Discovery with Model A",
      "content": "Depicted in Figure 6.3.2.4.2-1 is the procedure for 5G ProSe UE-to-UE Discovery with Model A.\nFigure 6.3.2.4.2-1: 5G ProSe UE-to-UE Relay Discovery with Model A\n1.\tThe 5G ProSe UE-to-UE Relay has discovered other UEs in proximity and obtains the Direct discovery set from other UEs in proximity per RSC. (e.g. via a previous 5G ProSe UE-to-UE Relay Discovery or via secure PC5 connection between 5G ProSe U2U Relay and 5G ProSe End UE (refer to TS 33.503 [29])).\n2.\tThe 5G ProSe UE-to-UE Relay sends a UE-to-UE Relay Discovery Announcement message. The UE-to-UE Relay Discovery Announcement message contains the Type of Discovery Message, User Info ID of the 5G ProSe UE-to-UE Relay, RSC and Direct discovery set including list of protected user info (i.e. Application Layer ID) received from the 5G ProSe End UEs supporting the RSC. The UE-to-UE Relay Discovery Announcement message is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.4.\nThe 5G ProSe UE-to-UE Relay shall only announce user info (i.e. Application Layer ID) of other UEs in proximity that did not include an Announce Prohibited Indication when they were previously discovered.\nNOTE:\t5G ProSe UE-to-UE Relay announces Direct discovery set from other UEs in proximity only if their PC5 signal strength measured by the 5G ProSe UE-to-UE Relay is above configured signal strength threshold as specified in TS 38.331 [16].\nA 5G ProSe End UE monitors announcement messages from a 5G ProSe UE-to-UE Relay. The 5G ProSe End UEs determine the Destination Layer-2 ID for signalling reception as specified in clause 5.1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.4",
        "clause_5.1",
        "figure_6.3.2.4.2-1",
        "ts_33.503",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.4.3",
      "section_id": "6.3.2.4.3",
      "section_title": "Procedure for 5G ProSe UE-to-UE Relay Discovery with Model B",
      "content": "Depicted in Figure 6.3.2.4.3-1 is the procedure for 5G ProSe UE-to-UE Relay Discovery with Model B.\nFigure 6.3.2.4.3-1: 5G ProSe UE-to-UE Relay Discovery with Model B\n1.\tThe discoverer 5G ProSe End UE (UE-1) sends a 5G ProSe UE-to-UE Relay Discovery Solicitation message. The 5G ProSe UE-to-UE Relay Discovery Solicitation message contains the Type of Discovery Message, RSC and the Direct Discovery set which includes the protected user info (i.e. Application Layer ID) of the discoverer 5G ProSe End UE (UE-1) and the discoveree 5G ProSe End UE (UE-2). The 5G ProSe UE-to-UE Relay Discovery Solicitation message is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.4.\nA 5G ProSe UE-to-UE Relay determines the Destination Layer-2 ID for signalling reception as specified in clause 5.1.\nThe discoverer 5G ProSe End UE may include an Announce Prohibited Indication in the UE-to-UE Relay Discovery Solicitation message. If a 5G ProSe UE-to-UE Relay receives a Relay Discovery Solicitation message with an Announce Prohibited Indication it does not consider the 5G ProSe End UE as discovered during this procedure for inclusion in 5G ProSe UE-to-UE Relay Discovery with Model A, see clause 6.3.2.4.2, step 1.\n2.\tIf the RSC contained in the solicitation message matches any of the (pre)configured RSC(s), as specified in clause 5.1.5.1, of a 5G ProSe UE-to-UE Relay, the 5G ProSe UE-to-UE Relay sends a 5G ProSe UE-to-UE Relay Discovery Solicitation message. The 5G ProSe UE-to-UE Relay Discovery Solicitation message contains the Type of Discovery Message, the Direct Discovery set which includes the list of protected user info (i.e. Application Layer ID) of the discoverer 5G ProSe End UE (UE-1) and the discoveree 5G ProSe End UE (UE-2), User Info ID of UE-to-UE Relay, RSC. 5G ProSe UE-to-UE Relay Discovery Solicitation message is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.4.\nA 5G ProSe End UE determines the Destination Layer-2 ID for signalling reception as specified in clause 5.1.\nThe 5G ProSe UE-to-UE Relay self-selects the Source Layer-2 ID as specified in clause 5.8.4.2.\n3.\tIf the RSC contained in the solicitation message matches any of the (pre)configured RSC(s), as specified in clause 5.1.5.1, of the discoveree 5G ProSe End UE (UE-2), and the discoveree 5G ProSe End UE (UE-2) matches the user info (i.e. Application Layer ID) of the discoveree 5G ProSe End UE (UE-2) contained in the solicitation message, then the discoveree 5G ProSe End UE (UE-2) responds to the 5G ProSe UE-to-UE Relay with a 5G ProSe UE-to-UE Relay Discovery Response message. The 5G ProSe UE-to-UE Relay Discovery Response message contains the Type of Discovery Message, RSC, the Direct Discovery set which includes the protected user info (i.e. Application Layer ID) of the discoverer 5G ProSe End UE (UE-1) and the discoveree 5G ProSe End UE (UE-2). The 5G ProSe UE-to-UE Relay Discovery Response message is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.4. If the discoveree 5G ProSe End UE (UE-2) receives multiple UE-to-UE Relay Discovery Solicitation messages from different 5G ProSe UE-to-UE Relays with the same RSC and the user info (i.e. Application Layer ID) of the discoveree 5G ProSe End UE (UE-2), it may choose to respond or not to a 5G ProSe UE-to-UE Relay (e.g. based on the PC5 signal strength of each message received).\nThe discoveree 5G ProSe End UE may include an Announce Prohibited Indication in the UE-to-UE Relay Discovery Response message. If a 5G ProSe UE-to-UE Relay receives a Relay Discovery Response message with an Announce Prohibited Indication it does not consider the 5G ProSe End UE as discovered during this procedure for inclusion in 5G ProSe UE-to-UE Relay Discovery with Model A, see clause 6.3.2.4.2, step 1.\n4.\tThe 5G ProSe UE-to-UE Relay sends a 5G ProSe UE-to-UE Relay Discovery Response message. The 5G ProSe UE-to-UE Relay Discovery Response message contains the Type of Discovery Message, User Info ID of UE-to-UE Relay, RSC, the Direct Discovery set which includes the list of protected user info (i.e. Application Layer ID) of the discoverer 5G ProSe End UE (UE-1) and the discoveree 5G ProSe End UE (UE-2). The 5G ProSe UE-to-UE Relay Discovery Response message is sent using the Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.4.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.4",
        "clause_5.1",
        "clause_6.3.2.4.2",
        "clause_5.1.5.1",
        "clause_5.8.4.2",
        "figure_6.3.2.4.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.4.4",
      "section_id": "6.3.2.4.4",
      "section_title": "Candidate 5G ProSe UE-to-UE Relay Discovery",
      "content": "This procedure for candidate 5G ProSe UE-to-UE Relay Discovery to support the negotiated Relay reselection as described in clause 6.7.4 when the discoverer End UE discovers a candidate 5G ProSe UE-to-UE Relay.\nThe procedure for 5G ProSe UE-to-UE Relay Discovery with Model B (see clause 6.3.2.4.3) is used with the following differences:\n-\tStep 1: In the 5G ProSe UE-to-UE Relay Discovery Solicitation message the RSC and the User Info ID of a candidate 5G ProSe UE-to-UE Relay are included in the UE-to-UE Relay Discovery set and the Direct Discovery set is not included. If the 5G ProSe End UE receives the Layer-2 ID of the candidate 5G ProSe UE-to-UE Relay in a Link Modification Request message, it may set the Layer-2 ID of the candidate 5G ProSe UE-to-UE Relay as the Destination Layer-2 ID.\nNOTE:\tThe User Info ID of the candidate 5G ProSe UE-to-UE Relay and the user info (i.e. Application Layer ID) of the discoveree 5G ProSe End UE can be distinguished by the 5G ProSe UE-to-UE Relay as different IEs in the message.\n-\tStep 2 and step 3 are skipped because Direct Discovery set is absent, and the User Info ID of the candidate 5G ProSe UE-to-UE Relay in the received 5G ProSe UE-to-UE Relay Discovery Solicitation message matches that of the 5G ProSe UE-to-UE Relay.\n-\tStep 4: If a 5G ProSe UE-to-UE Relay matches the User Info ID of a candidate 5G ProSe UE-to-UE Relay received in the 5G ProSe UE-to-UE Relay Discovery Solicitation then it sends the 5G ProSe UE-to-UE Relay Discovery Response (with the RSC received in step 1) and does not include the Direct Discovery set.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.4",
        "clause_6.3.2.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.3.2.4.5",
      "section_id": "6.3.2.4.5",
      "section_title": "Acquiring Direct discovery set by model A discovery",
      "content": "The 5G ProSe UE-to-UE Relay may monitor Announcement messages from the 5G ProSe End UEs.\nWhen receiving an Announcement message from a 5G ProSe End UE, the 5G ProSe UE-to-UE Relay may include the received protected user info (i.e. Application Layer ID) in the UE-to-UE Relay Discovery Announcement message as specified in clause 6.3.2.4.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2.4.2"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.1",
      "section_id": "6.4.1",
      "section_title": "Broadcast mode 5G ProSe Direct Communication",
      "content": "To perform 5G ProSe direct communication over PC5 reference point in broadcast mode operation, the UE is configured with the related information as described in clause 5.1.3.\nFigure 6.4.1-1 shows the procedure for broadcast mode of 5G ProSe direct communication over PC5 reference point.\nFigure 6.4.1-1: Procedure for Broadcast mode of 5G ProSe direct communication over PC5 reference point\n1.\tThe ProSe layer of receiving UE(s) determines the following for the broadcast mode communication reception:\n-\tthe destination Layer-2 ID for broadcast reception as specified in clause 5.8.2.2;\n-\tthe PC5 QoS parameters for this broadcast ProSe service as specified in clause 5.6.1; and\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nThe destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are passed down to the AS layer of receiving UE(s) for the reception.\nThe AS layer of receiving UE(s) determines the PC5 DRX parameter values as specified in clause 5.13.\n2.\tThe transmitting UE ProSe application layer provides data unit and may provide ProSe Application Requirements specified in clause 5.6.1 to ProSe layer.\n3.\tThe ProSe layer of transmitting UE determines the following for the broadcast mode communication transmission:\n-\tthe destination Layer-2 ID for broadcast as specified in clause 5.8.2.2;\n-\tthe PC5 QoS parameters for this broadcast ProSe service as specified in clauses 5.6.1; and\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nThe transmitting UE self-assigns the source Layer-2 ID as specified in clause 5.8.2.2.\nThe source Layer-2 ID, the destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are passed down to the AS layer of transmitting UE for the transmission.\nThe AS layer of transmitting UE determines the PC5 DRX parameter values as specified in clause 5.13.\n4.\tThe transmitting UE sends the ProSe data using the source Layer-2 ID and the destination Layer-2 ID.\nNOTE:\tIn step 4, there is only one broadcast message from the transmitting UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.3",
        "clause_5.8.2.2",
        "clause_5.6.1",
        "clause_5.1.3.1",
        "clause_5.13",
        "figure_6.4.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.2",
      "section_id": "6.4.2",
      "section_title": "Groupcast mode 5G ProSe Direct Communication",
      "content": "Figure 6.4.2-1 shows the procedure for groupcast mode of 5G ProSe Direct Communication.\nFigure 6.4.2-1: Procedure for groupcast mode 5G ProSe Direct communication\nSteps 1 to 3 are optional, e.g. applicable for Application Layer managed group. Groupcast mode ProSe Direct communication can be performed without steps 1 to 3 based on the provisioned parameters as defined in clause 5.1.3.1.\n1.\tProSe Group management is carried out at ProSe application layer. This may be performed in coordination with ProSe Application Server.\nGroup Member Discovery parameters as specified in clause 5.1.2.1 can be provisioned in ME from PCF or configured in UICC or provided from ProSe Application Server to the UE.\n2.\tEach UE may perform a ProSe group member discovery (similar to the procedures in clause 6.3.2.2) that is restricted only to users sharing the same Application Layer Group ID obtained in step 1.\nThe Application layer discovery messages including the Application Layer Group ID for Application Layer managed group may be exchanged between UEs to discover each other sharing the same Application Layer Group ID. When the group is formed, the Application layer discovery message including group size and member ID may be provided by one UE to all other UEs. The Application layer discovery messages may be included as metadata in a PC5 direct discovery message.\n3.\tThe ProSe Application layer may provide group identifier information (i.e. the Application Layer Group ID discovered based on discovery messages exchanged in step 2) as specified in clause 5.8.2.3.\nThe ProSe application layer may also provide ProSe Application Requirements for this communication.\nIf the ProSe application layer does not provide ProSe Application Requirements, the ProSe layer determines the PC5 QoS parameters based on the mapping of ProSe service to PC5 QoS parameters as specified in clause 5.1.3.1.\nThe ProSe application layer may provide a group size and a member ID (optionally based on discovery messages exchanged in step 2) as specified in clause 5.3.3 for Application Layer managed group.\n4.\tThe ProSe layer of transmitting UE self-assigns a source Layer-2 ID and determines the following for the groupcast mode communication transmission:\n-\ta destination Layer-2 ID as specified in clauses 5.8.2.1 and 5.8.2.3.\n-\tThe PC5 QoS parameters for this groupcast mode communication as specified in clause 5.6.1.\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nThe source Layer-2 ID, destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are passed down to the AS layer of transmitting UE for the groupcast mode communication transmission.\nThe ProSe layer of receiving UE(s) determines the following for the groupcast mode communication reception:\n-\tdestination Layer-2 ID as specified in clauses 5.8.2.1 and 5.8.2.3;\n-\tthe PC5 QoS parameters for this groupcast mode communication as specified in clause 5.6.1; and\n-\tthe NR Tx Profile based on the configuration as specified in clause 5.1.3.1.\nThe destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are passed down to the AS layer of receiving UE(s) for the reception.\nIf the group size and the member ID for Application Layer managed group are provided by the ProSe application layer, the ProSe layer passes them to the AS layer as described in clause 5.3.3.\nThe AS layer of transmitting UE and the AS layer of receiving UE(s) determine the PC5 DRX parameter values as specified in clause 5.13.\n5.\tTransmitting UE sends the ProSe data using the source Layer-2 ID and the destination Layer-2 ID.\nNOTE:\tIn step 5, there is only one groupcast message from the transmitting UE. That is, all receiving UEs can receive the groupcast message directly from the transmitting UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.3.1",
        "clause_5.1.2.1",
        "clause_6.3.2.2",
        "clause_5.8.2.3",
        "clause_5.3.3",
        "clause_5.6.1",
        "clause_5.13",
        "figure_6.4.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.1",
      "section_id": "6.4.3.1",
      "section_title": "Layer-2 link establishment over PC5 reference point",
      "content": "To perform unicast mode of ProSe Direct communication over PC5 reference point, the UE is configured with the related information as described in clause 5.1.3.\nFigure 6.4.3.1-1 shows the layer-2 link establishment procedure for the unicast mode of ProSe Direct communication over PC5 reference point.\nFigure 6.4.3.1-1: Layer-2 link establishment procedure\n1.\tThe UE(s) determine the destination Layer-2 ID for signalling reception for PC5 unicast link establishment as specified in clause 5.8.2.4.\n2.\tThe ProSe application layer in UE-1 provides application information for PC5 unicast communication. The application information includes the ProSe Service Info, UE's Application Layer ID. The target UE's Application Layer ID may be included in the application information.\nThe ProSe application layer in UE-1 may provide ProSe Application Requirements for this unicast communication. UE-1 determines the PC5 QoS parameters and PFI as specified in clause 5.6.1.\nIf UE-1 decides to reuse the existing PC5 unicast link as specified in clause 5.3.4, the UE triggers the Layer-2 link modification procedure as specified in clause 6.4.3.4.\n3.\tUE-1 sends a Direct Communication Request message to initiate the unicast layer-2 link establishment procedure. The Direct Communication Request message includes:\n-\tSource User Info: the initiating UE's Application Layer ID (i.e. UE-1's Application Layer ID).\n-\tIf the ProSe application layer provided the target UE's Application Layer ID in step 2, the following information is included:\n-\tTarget User Info: the target UE's Application Layer ID (i.e. UE-2's Application Layer ID).\n-\tProSe Service Info: the information about the ProSe identifier(s) requesting Layer-2 link establishment.\n-\tSecurity Information: the information for the establishment of security.\nNOTE 1:\tThe Security Information and the necessary protection of the Source User Info and Target User Info are defined in TS 33.503 [29].\nThe source Layer-2 ID and destination Layer-2 ID used to send the Direct Communication Request message are determined as specified in clauses 5.8.2.1 and 5.8.2.4. The destination Layer-2 ID may be broadcast or unicast Layer-2 ID. When unicast Layer-2 ID is used, the Target User Info shall be included in the Direct Communication Request message.\nUE-1 sends the Direct Communication Request message via PC5 broadcast or unicast using the source Layer-2 ID and the destination Layer-2 ID.\nA default PC5 DRX configuration may be used for transmitting and receiving of this message (see TS 38.300 [12]).\n4.\tSecurity with UE-1 is established as below:\n4a.\tIf the Target User Info is included in the Direct Communication Request message, the target UE, i.e. UE-2, responds by establishing the security with UE-1.\n4b.\tIf the Target User Info is not included in the Direct Communication Request message, the UEs that are interested in using the announced ProSe Service(s) over a PC5 unicast link with UE-1 responds by establishing the security with UE-1.\nNOTE 2:\tThe signalling for the Security Procedure is defined in TS 33.503 [29].\nWhen the security protection is enabled, UE-1 sends the following information to the target UE:\n-\tIf IP communication is used:\n-\tIP Address Configuration: For IP communication, IP address configuration is required for this link and indicates one of the following values:\n-\t\"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by the initiating UE, i.e., acting as a DHCPv4 server; or\n-\t\"IPv6 Router\" if only IPv6 address allocation mechanism is supported by the initiating UE, i.e., acting as an IPv6 Router; or\n-\t\"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation mechanism are supported by the initiating UE; or\n-\t\"address allocation not supported\" if neither IPv4 nor IPv6 address allocation mechanism is supported by the initiating UE.\n-\tLink-Local IPv6 Address: a link-local IPv6 address formed locally based on RFC 4862 [17] if UE-1 does not support the IPv6 IP address allocation mechanism, i.e. the IP Address Configuration indicates\" address allocation not supported\".\n-\tQoS Info: the information about PC5 QoS Flow(s). For each PC5 QoS Flow, the PFI and the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe identifier(s).\n-\tOptional PC5 QoS Rule(s).\nThe source Layer-2 ID used for the security establishment procedure is determined as specified in clauses 5.8.2.1 and 5.8.2.4. The destination Layer-2 ID is set to the source Layer-2 ID of the received Direct Communication Request message.\nUpon receiving the security establishment procedure messages, UE-1 obtains the peer UE's Layer-2 ID for future communication, for signalling and data traffic for this unicast link.\n5.\tA Direct Communication Accept message is sent to UE-1 by the target UE(s) that has successfully established security with UE-1:\n5a.\t(UE oriented Layer-2 link establishment) If the Target User Info is included in the Direct Communication Request message, the target UE, i.e. UE-2 responds with a Direct Communication Accept message if the Application Layer ID for UE-2 matches.\n5b.\t(ProSe Service oriented Layer-2 link establishment) If the Target User Info is not included in the Direct Communication Request message, the UEs that are interested in using the announced ProSe Service(s) respond to the request by sending a Direct Communication Accept message (UE-2 and UE-4 in Figure 6.4.3.1-1).\nThe Direct Communication Accept message includes:\n-\tSource User Info: Application Layer ID of the UE sending the Direct Communication Accept message.\n-\tQoS Info: the information about PC5 QoS Flow(s). For each PC5 QoS Flow, the PFI and the corresponding PC5 QoS parameters requested by UE-1 (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe identifiers(s).\n-\tOptional PC5 QoS Rule(s).\n-\tIf IP communication is used:\n-\tIP Address Configuration: For IP communication, IP address configuration is required for this link and indicates one of the following values:\n-\t\" DHCPv4 server \" if only IPv4 address allocation mechanism is supported by the target UE, i.e., acting as a DHCPv4 server; or\n-\t\"IPv6 Router\" if only IPv6 address allocation mechanism is supported by the target UE, i.e., acting as an IPv6 Router; or\n-\t\"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation mechanism are supported by the target UE; or\n-\t\"address allocation not supported\" if neither IPv4 nor IPv6 address allocation mechanism is supported by the target UE.\n-\tLink-Local IPv6 Address: a link-local IPv6 address formed locally based on RFC 4862 [17] if the target UE does not support the IPv6 IP address allocation mechanism, i.e. the IP Address Configuration indicates \"address allocation not supported\" and UE-1 included a link-local IPv6 address in the security establishment in step 4. The target UE shall include a non-conflicting link-local IPv6 address.\nIf both UEs (i.e. the initiating UE and the target UE) are selected to use link-local IPv6 address, they shall disable the duplicate address detection defined in RFC 4862 [17].\nNOTE 3:\tWhen either the initiating UE or the target UE indicates the support of IPv6 routing, the corresponding address configuration procedure would be carried out after the establishment of the layer 2 link and the link-local IPv6 addresses are ignored.\nThe ProSe layer of the UE that established PC5 unicast link passes the PC5 Link Identifier assigned for the unicast link and the PC5 unicast link related information down to the AS layer. The PC5 unicast link related information includes Layer-2 ID information (i.e. source Layer-2 ID and destination Layer-2 ID). This enables the AS layer to maintain the PC5 Link Identifier together with the PC5 unicast link related information.\nTwo UEs may negotiate the PC5 DRX configuration in the AS layer and the PC5 DRX parameter values can be configured per pair of source and destination Layer-2 IDs in the AS layer.\n6.\tProSe data is transmitted over the established unicast link as below:\nThe PC5 Link Identifier and PFI are provided to the AS layer, together with the ProSe data.\nOptionally in addition, the Layer-2 ID information (i.e. source Layer-2 ID and destination Layer-2 ID) is provided to the AS layer.\nNOTE 4:\tIt is up to UE implementation to provide the Layer-2 ID information to the AS layer.\nUE-1 sends the ProSe data using the source Layer-2 ID (i.e. UE-1's Layer-2 ID for this unicast link) and the destination Layer-2 ID (i.e. the peer UE's Layer-2 ID for this unicast link).\nNOTE 5:\tPC5 unicast link is bi-directional, therefore the peer UE of UE-1 can send the ProSe data to UE-1 over the unicast link with UE-1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.3",
        "clause_5.8.2.4",
        "clause_5.6.1",
        "clause_5.3.4",
        "clause_6.4.3.4",
        "figure_6.4.3.1-1",
        "ts_33.503",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.2",
      "section_id": "6.4.3.2",
      "section_title": "Link identifier update for a unicast link",
      "content": "Figure 6.4.3.2-1 shows the link identifier update procedure for a unicast link. When privacy requirements are configured for a ProSe Identifier associated with the unicast link, identifiers used for the unicast mode of 5G ProSe communication over PC5 reference point (e.g. Application Layer ID, Source Layer-2 ID and IP address/prefix) shall be changed over time as specified in clauses 5.8.2.1 and 5.8.2.4. A UE may decide to change the identifiers for other reasons, e.g. application layer requirement. This procedure is used to update and exchange new identifiers between the source and the peer UEs for a unicast link before using the new identifiers, to prevent service interruptions. When there are privacy requirements as indicated above, this procedure is executed over a security protected unicast link.\nIf a UE has multiple unicast links using the same Application Layer IDs or Layer-2 IDs, the UE needs to perform the link identifier update procedure over each of the unicast links.\nFigure 6.4.3.2-1: Link identifier update procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.4.3.1.\n1.\tUE-1 decides to change its identifier(s), e.g. due to the Application Layer ID change or upon expiry of a timer. UE-1 generates its new Layer-2 ID and sends a Link Identifier Update Request message to UE-2 using the old identifiers.\nThe Link Identifier Update Request message includes the new identifier(s) to use (including the new Layer-2 ID, Security Information, optionally the new Application Layer ID and optionally new IP address/prefix if IP communication is used). The new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. After sending the Link Identifier Update Request message, if the UE-1 has data to send, UE-1 keeps sending data traffic to UE-2 with the old identifiers until UE-1 sends the Link Identifier Update Ack message to UE-2.\nNOTE 1:\tThe timer is running on per Source Layer-2 ID.\nNOTE 2:\tWhen one of the two UEs acts as IPv6 router as described in clause 5.5.1.1 and the IP address/prefix also needs to be changed, the corresponding address configuration procedure would be carried out after the Link Identifier update procedure.\n2.\tUpon reception of the Link Identifier Update Request message, UE-2 changes its identifier(s). UE-2 responds with a Link Identifier Update Response message which includes the new identifier(s) to use (including the new Layer-2 ID, Security Information, optionally the new Application Layer ID and optionally a new IP address/prefix if IP communication is used). The new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. The Link Identifier Update Response message is sent using the old identifiers. UE-2 continues to receive traffic with the old Layer-2 ID from UE-1 until UE-2 receives traffic with the new Layer-2 ID from UE-1. After sending the Link Identifier Update Response message, UE-2 keeps sending data traffic to UE-1 with the old identifier, if UE-2 has data to send, until UE-2 receives the Link Identifier Update Ack message from UE-1.\n3.\tUpon reception of the Link Identifier Update Response message, UE-1 responds with a Link Identifier Update Ack message. The Link Identifier Update Ack message includes the new identifier(s) from UE-2, as received on the Link Identifier Update Response message. The Link Identifier Update Ack message is sent using the old identifiers. UE-1 continues to receive traffic with the old Layer-2 ID from UE-2 until UE-1 receives traffic with the new Layer-2 ID from UE‑2.\n4.\tThe ProSe layer of UE-1 passes the PC5 Link Identifier for the unicast link and the updated Layer-2 IDs (i.e. new Layer-2 ID for UE-1 for the source and new Layer-2 ID of UE-2 for the destination) down to the AS layer. This enables the AS layer to update the provided Layer-2 IDs for the unicast link.\nUE-1 starts using its new identifiers and UE-2's new identifiers for this unicast link.\n5.\tUpon reception of the Link Identifier Update Ack message, the ProSe layer of UE-2 passes the PC5 Link Identifier for the unicast link and the updated Layer-2 IDs (i.e. new Layer-2 ID of UE-2 for the source and new Layer-2 ID for UE-1 for the destination) down to the AS layer. This enables the AS layer to update the provided Layer-2 IDs for the unicast link.\nUE-2 starts using its new identifiers and UE-1's new identifiers for this unicast link.\nNOTE 3:\tThe Security Information in the above messages also needs to be updated at the same time as the Layer-2 IDs. This is defined in TS 33.503 [29].",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_6.4.3.1",
        "clause_5.5.1.1",
        "figure_6.4.3.2-1",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.3",
      "section_id": "6.4.3.3",
      "section_title": "Layer-2 link release over PC5 reference point",
      "content": "Figure 6.4.3.3-1 shows the layer-2 link release procedure over PC5 reference point.\nFigure 6.4.3.3-1: Layer-2 link release procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.4.3.1.\n1.\tUE-1 sends a Disconnect Request message to UE-2 in order to release the layer-2 link and deletes all context data associated with the layer-2 link. The Disconnect Request message includes Security Information.\n2.\tUpon reception of the Disconnect Request message, UE-2 shall respond with a Disconnect Response message and deletes all context data associated with the layer-2 link. The Disconnect Response message includes Security Information.\nThe ProSe layer of each UE informs the AS layer that the unicast link has been released. The ProSe layer uses PC5 Link Identifier to indicate the released unicast link. This enables the AS layer to delete the context related to the released unicast link.\nNOTE:\tThe Security Information in the above messages is defined in TS 33.503 [29].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3.1",
        "figure_6.4.3.3-1",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.4",
      "section_id": "6.4.3.4",
      "section_title": "Layer-2 link modification for a unicast link",
      "content": "Figure 6.4.3.4-1 shows the layer-2 link modification procedure for a unicast link. This procedure is used to:\n-\tadd new PC5 QoS Flow(s) in the existing PC5 unicast link.\n-\tThis covers the case for adding new PC5 QoS Flow(s) to the existing ProSe service(s) as well as the case for adding new PC5 QoS Flow(s) to new ProSe service(s).\n-\tmodify existing PC5 QoS Flow(s) in the existing PC5 unicast link.\n-\tThis covers the case for modifying the PC5 QoS parameters for existing PC5 QoS Flow(s).\n-\tThis also covers the case for removing the associated ProSe service(s) from existing PC5 QoS Flow(s) as well as the case for associating new ProSe service(s) with existing PC5 QoS Flow(s).\n-\tremove existing PC5 QoS Flow(s) in the existing PC5 unicast link.\nFigure 6.4.3.4-1: Layer-2 link modification procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.4.3.1.\n1.\tThe ProSe application layer in UE-1 provides application information for PC5 unicast communication. The application information includes the ProSe Service Info and the initiating UE's Application Layer ID. The target UE's Application Layer ID may be included in the application information. If UE-1 decides to reuse the existing PC5 unicast link as specified in clause 5.3.4, so decides to modify the unicast link established with UE-2, UE-1 sends a Link Modification Request to UE-2.\nThe Link Modification Request message includes:\na)\tTo add new PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tQoS Info: the information about PC5 QoS Flow(s) to be added. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe identifier(s).\n-\tOptional PC5 QoS Rule(s).\nb)\tTo modify PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tQoS Info: the information about PC5 QoS Flow(s) to be modified. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe identifier(s).\n-\tOptional PC5 QoS Rule(s).\nc)\tTo remove PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tPFIs.\n2.\tUE-2 responds with a Link Modification Accept message.\nThe Link Modification Accept message includes:\n-\tFor case a) and case b) described in step 1:\n-\tQoS Info: the information about PC5 QoS Flow(s) requested by UE-1. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe identifier(s).\n-\tOptional PC5 QoS Rule(s).\nThe ProSe layer of each UE provides information about the unicast link modification to the AS layer. This enables the AS layer to update the context related to the modified unicast link.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3.1",
        "clause_5.3.4",
        "figure_6.4.3.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.5",
      "section_id": "6.4.3.5",
      "section_title": "Layer-2 link maintenance over PC5 reference point",
      "content": "The PC5 Signalling Protocol shall support keep-alive functionality that is used to detect if a particular PC5 unicast link is still valid. Either side of the PC5 unicast link can initiate the layer-2 link maintenance procedure (i.e. keep-alive procedure), based on for example triggers from the AS layer or internal timers. The UEs shall minimize the keep-alive signalling, e.g. cancel the procedure if data are successfully received over the PC5 unicast link.\nFigure 6.4.3.5-1: Layer-2 link maintenance procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.4.3.1.\n1.\tBased on trigger conditions, UE-1 sends a Keep-alive message to UE-2 in order to determine the status of the PC5 unicast link.\nNOTE 1:\tIt is left to Stage 3 to determine the exact triggers for the keep-alive messages. For example, the trigger can be based on a timer associated with the Layer-2 link. The timer can be reset with a successful reception event defined by TS 38.300 [12].\n2.\tUpon reception of the Keep-alive message, UE-2 responds with a Keep-alive Ack message.\nThe UE initiating the keep-alive procedure shall determine the follow-up actions based on the result of the signalling, e.g. proceed with implicit layer-2 link release.\nNOTE 2:\tIt is left to Stage 3 to determine the follow-up actions. For example, a successful reception event can also cancel the layer-2 link release if received in time.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.4.3.1",
        "figure_6.4.3.5-1",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.6",
      "section_id": "6.4.3.6",
      "section_title": "Layer-2 link management over PC5 reference point for 5G ProSe UE-to-Network Relay",
      "content": "The Layer-2 link procedures over PC5 reference point for unicast mode 5G ProSe Direct Communication as depicted from clause 6.4.3.1 to clause 6.4.3.5 can be used for the PC5 reference point between 5G ProSe Remote UE and 5G ProSe UE-to-Network Relay, with the following differences and clarifications:\n-\tThe Layer-2 link modification procedure is applicable to ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay, other procedures are applicable to both ProSe Communication via 5G ProSe Layer-2 UE-to-Network Relay and ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay.\n-\tThe UE oriented Layer-2 link establishment is used with UE-1 representing the 5G ProSe Remote UE and UE-2 representing the 5G ProSe UE-to-Network Relay. For other procedures either UE-1 represents the 5G ProSe Remote UE and UE-2 represents the 5G ProSe UE-to-Network Relay, or UE-1 represents the 5G ProSe UE-to-Network Relay and UE-2 represents the 5G ProSe Remote UE. I.e. the Layer-2 link establishment is initiated by the 5G ProSe Remote UE, while other procedures may be initiated either by the 5G ProSe Remote UE or by the 5G ProSe UE-to-Network Relay.\nFor the UE oriented Layer-2 link establishment as described in the clause 6.4.3.1,\n-\tIn step 1, the 5G ProSe Remote UE determines the destination Layer-2 ID for PC5 unicast link establishment based on the unicast source Layer-2 ID of the selected 5G ProSe UE-to-Network Relay (as specified in clause 5.8.3) during UE-to-Network Relay discovery as specified in clause 6.3.2.3.\n-\tIn step 2, 5G ProSe Remote UE (UE-1) determines the Relay Service Code to be used. The Relay Service Code to be used is selected from the received Relay Service Code(s) during UE-to-Network Relay discovery as specified in clause 6.3.2.3.\n-\tIn step 3, 5G ProSe Remote UE (UE-1) sends a unicast Direct Communication Request message to the selected 5G ProSe UE-to-Network Relay. The destination Layer-2 ID used to send the Direct Communication Request message shall be unicast Layer-2 ID as determined in step 1. The Direct Communication Request message includes:\n-\tSource User Info: the identity of the Remote UE requesting relay operation (i.e. User Info ID).\nNOTE 1:\tThe details of which additional identity/identities of the Remote UE to be included during Layer-2 link establishment are specified in TS 33.503 [29].\n-\tTarget User Info: the identity of the UE-to-Network Relay provided to the 5G ProSe Remote UE during UE-to-Network Relay Discovery procedure (i.e. User Info ID).\n-\tRelay Service Code: indicates the connectivity service (which may be non-emergency or emergency) provided by the 5G ProSe UE-to-Network Relay as requested by the 5G ProSe Remote UE.\n-\tSecurity Information: the information for the establishment of security.\nNOTE 2:\tPC5 link for emergency RSC can be established with or without PC5 security; how to establish PC5 security link for emergency service is specified in TS 33.503 [29].\n-\tIn step 4 and step 5, step 4a and step 5a are performed if the 5G ProSe UE-to-Network Relay's identity matches the Target User Info and the Relay Service Code is one of the Relay Service Codes included during UE-to-Network Relay discovery as specified in clause 6.3.2.3. The Source User Info in the Direct Communication Accept message is the identity of the UE-to-Network Relay (i.e. User Info ID). In the case of 5G ProSe Layer-2 UE-to-Network Relay, the Remote UE does not send the IP Address Configuration, Link-Local IPv6 Address and QoS Info to the 5G ProSe Layer-2 UE-to-Network Relay and the Direct Communication Accept message does not include IP Address Configuration, Link-Local IPv6 Address and QoS Info. In the case of 5G ProSe Layer-3 UE-to-Network Relay, the Direct Communication Accept message does not include the IP Address Configuration indicating the value \"address allocation not supported\".\n-\tIn the case of 5G ProSe Layer-2 UE-to-Network Relay, step 6 is not performed.\nFor the link identifier update as described in the clause 6.4.3.2,\n-\tApplication Layer ID is replaced by User Info ID.\n-\tIn the case of 5G ProSe Layer-2 UE-to-Network Relay, the changed identifiers do not include IP address/prefix.\nFor the Layer-2 link release as described in the clause 6.4.3.3,\n-\tIn step1, if the Layer-2 link release procedure is initiated by the 5G ProSe UE-to-Network Relay, the Disconnect Request message may indicate the 5G ProSe UE-to-Network Relay is temporarily not available as described in clause 5.12.\nNOTE 3:\tThe form of the temporarily not available indication will be determined by stage 3.\n-\tIf the service authorization for acting as a 5G ProSe Remote UE or as a 5G ProSe UE-to-Network Relay is revoked, the 5G ProSe Remote UE or the 5G ProSe UE-to-Network Relay should initiate the release of the layer-2 link that the revoked authorization affects.\n-\tA 5G ProSe Layer-2 Remote UE or a 5G ProSe Layer-2 UE-to-Network Relay initiates the release of the layer-2 link upon receiving an indication from its AS layer to trigger PC5 unicast link release as specified in TS 38.331 [16].\nNOTE 4:\tThe timing to initiates layer-2 link release is up to UE implementation.\nA 5G ProSe Remote UE and a 5G ProSe UE-to-Network Relay shall set up a separate PC5 unicast links if an existing unicast link(s) was established with a different Relay Service Code or without a Relay Service Code.\nNOTE 5:\tA single PC5 unicast link is established between a 5G ProSe Layer-2 UE-to-Network Relay and a 5G ProSe Layer-2 Remote UE, as specified in TS 38.300 [12], for supporting PDU sessions of the 5G ProSe Layer-2 Remote UE.\nEach PC5 unicast link for 5G ProSe UE-to-Network Relay is associated with a Unicast Link Profile, which includes:\n-\tUser Info ID and Layer-2 ID of 5G ProSe Remote UE; and\n-\tUser Info ID and Layer-2 ID of 5G ProSe UE-to-Network Relay; and\n-\tRelay Service Code; and\n-\tIn the case of 5G ProSe Layer-3 UE-to-Network Relay, the network layer protocol and the information about PC5 QoS Flow(s).\nThe Unicast Link Profile shall be updated accordingly after a Layer-2 link modification or Layer-2 link identifier update.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3.1",
        "clause_6.4.3.5",
        "clause_5.8.3",
        "clause_6.3.2.3",
        "clause_6.4.3.2",
        "clause_6.4.3.3",
        "clause_5.12",
        "ts_33.503",
        "ts_38.331",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.7.1",
      "section_id": "6.4.3.7.1",
      "section_title": "Common part for Layer-2 link management over PC5 reference point for 5G ProSe UE-to-UE Relay",
      "content": "For the 5G ProSe Communication via 5G ProSe UE-to-UE Relay as described in clause 6.7.1 and clause 6.7.2:\n-\tThe Direct Communication Request message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of source 5G ProSe End UE: the identity of the source 5G ProSe End UE requesting relay operation.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay: the identity of the UE-to-UE Relay provided to the source 5G ProSe End UE during 5G ProSe UE-to-UE Relay Discovery procedure.\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE: the identity of the target 5G ProSe End UE provided to the source 5G ProSe End UE during UE-to-UE Relay Discovery procedure.\n-\t(optional) Destination Layer-2 ID of target 5G ProSe End UE: the unicast destination Layer-2 ID of the target 5G ProSe End UE determined by the source 5G ProSe End UE as specified in clause 5.8.2.4.\n-\tProSe Service Info: the information about the ProSe identifier(s) requesting Layer-2 link establishment.\n-\tRSC: the connectivity service provided by the 5G ProSe UE-to-UE Relay as requested by the source 5G ProSe End UE.\n-\tSecurity Information: the information for the establishment of security for the first hop PC5 link establishment (see TS 33.503 [29]).\nThe Direct Communication Request message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of source 5G ProSe End UE.\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay.\n-\tProSe Service Info: the information about the ProSe identifier(s).\n-\tRSC: the connectivity service provided by the 5G ProSe UE-to-UE Relay as requested by the source 5G ProSe End UE.\n-\tSecurity Information: the information for the establishment of security for the second hop PC5 link establishment (see TS 33.503 [29]).\nThe Direct Communication Accept message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\nThe Direct Communication Accept message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay.\nThe Link Modification Request message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE: the identity of the target 5G ProSe End UE provided to the source 5G ProSe End UE during UE-to-UE Relay Discovery procedure.\n-\t(optional) Destination Layer-2 ID of target 5G ProSe End UE: the unicast destination Layer-2 ID of the target 5G ProSe End UE determined by the source 5G ProSe End UE as specified in clause 5.8.2.4.\nThe Link Modification Request message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of source 5G ProSe End UE.\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\nThe Link Modification Accept message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\nThe Link Modification Accept message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\nEach end-to-end unicast link for 5G Layer-2 ProSe UE-to-UE Relay is associated with a Unicast Link Profile, which includes:\n-\tuser info (i.e. Application Layer ID) and Layer-2 ID of source 5G ProSe End UE; and\n-\tuser info (i.e. Application Layer ID) and Layer-2 ID of target 5G ProSe End UE; and\n-\tRelay Service Code; and\n-\tinformation about PC5 QoS Flow(s).\nEach PC5 unicast link for 5G Layer-3 ProSe UE-to-UE Relay over the first hop is associated with a Unicast Link Profile, which includes:\n-\tuser info (i.e. Application Layer ID) and Layer-2 ID of the 5G ProSe End UE; and\n-\tUser Info ID and Layer-2 ID of 5G ProSe UE-to-UE Relay; and\n-\tRelay Service Code; and\n-\tthe network layer protocol and the information about PC5 QoS Flow(s).\nEach PC5 unicast link for 5G Layer-3 ProSe UE-to-UE Relay over the second hop is associated with a Unicast Link Profile, which includes:\n-\tUser Info ID and Layer-2 ID of 5G ProSe UE-to-UE Relay; and\n-\tuser info (i.e. Application Layer ID) and Layer-2 ID of the 5G ProSe End UE; and\n-\tRelay Service Code; and\n-\tthe network layer protocol and the information about PC5 QoS Flow(s).\nThe Unicast Link Profile shall be updated accordingly after a Layer-2 link modification or Layer-2 link identifier update.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.1",
        "clause_6.7.2",
        "clause_5.8.2.4",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.7.2",
      "section_id": "6.4.3.7.2",
      "section_title": "Layer-2 link management over PC5 reference point for 5G ProSe Layer-2 UE-to-UE Relay",
      "content": "For the 5G ProSe Communication via 5G ProSe Layer-2 UE-to-UE Relay as described in clause 6.7.2, the description in clause 6.4.3.7.1 applies. In the case of ProSe communication via 5G ProSe Layer-2 UE-to-UE Relay, an end-to-end Direct Communication Request message between the source 5G ProSe End UE and the target 5G ProSe End UE is transmitted after the per-hop connections have been established. The information from end-to-end unicast link profile in clause 6.4.3.7.1 is used for mapping of the destination Layer-2 ID as specified in TS 38.300 [12] and TS 38.331 [16].\nThe message contents over PC5 reference point for unicast mode 5G ProSe Direct Communication as depicted from clause 6.4.3.1 to clause 6.4.3.5 are same for the end-to-end connection between peer 5G ProSe End UEs.\nWhen the 5G ProSe End UEs initiate End-to-End PC5-S signalling to release an end-to-end ProSe link via 5G ProSe Layer 2 UE-to-UE relay, the 5G ProSe End UE which has initiated the PC5-S release procedure triggers Layer-2 link modification or a Layer-2 link release procedure as described in clause 6.4.3.7 towards 5G ProSe Layer-2 UE-to-UE relay.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.2",
        "clause_6.4.3.7.1",
        "clause_6.4.3.1",
        "clause_6.4.3.5",
        "clause_6.4.3.7",
        "ts_38.300",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.7.3",
      "section_id": "6.4.3.7.3",
      "section_title": "Layer-2 link management over PC5 reference point for 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "For the 5G ProSe Communication via 5G ProSe Layer-3 UE-to-UE Relay as described in clause 6.7.1, the description in clause 6.4.3.7.1 applies with following differences and clarifications:\n-\tIn the Security Procedure of the first hop PC5 reference point, the source 5G ProSe Layer-3 End UE provides the IP Address Configuration or Link-Local IPv6 Address and QoS Info of the end-to-end QoS to the 5G ProSe Layer-3 UE-to-UE Relay. If the PC5 link is used for transferring Ethernet traffic, the source 5G ProSe Layer-3 End UE provides its Ethernet MAC address instead of IP related information.\n-\tIn the Security Procedure of the second hop PC5 reference point, the 5G ProSe Layer-3 UE-to-UE Relay provides the IP Address Configuration or Link-Local IPv6 Address and QoS Info of the second hop QoS to the target 5G ProSe End UE. If the PC5 link is used for transferring Ethernet traffic, the 5G ProSe Layer-3 UE-to-UE Relay provides the Ethernet MAC address of the source 5G ProSe Layer-3 End UE instead of IP related information.\n-\tThe Direct Communication Accept message over the second hop PC5 reference point additionally includes IP Address Configuration or Link-Local IPv6 Address and QoS Info of the second hop QoS. If the PC5 link is used for transferring Ethernet traffic, the target 5G ProSe Layer-3 End UE provides its Ethernet MAC address instead of IP related information.\n-\tThe 5G ProSe Layer-3 UE-to-UE Relay decides the QoS Info of the first hop QoS with considering the received second hop QoS, the Direct Communication Accept message over the first hop PC5 reference point additionally includes IP Address Configuration or Link-Local IPv6 Address, QoS Info of the first hop QoS and may include IP address of the target 5G ProSe End UE. If the PC5 link is used for transferring Ethernet traffic, 5G ProSe Layer-3 UE-to-UE Relay provides the Ethernet MAC address of the target 5G ProSe Layer-3 End UE instead of IP related information.\n-\tFor adding new end-to-end QoS flow or modifying existing end-to-end QoS flow, in the Link Modification Request message over the first hop PC5 reference point, the source 5G ProSe End UE additionally includes QoS Info of the end-to-end QoS as described in the clause 6.4.3.4. For removing end-to-end QoS flows(s), in the Link Modification Request message over the first hop PC5 reference point, the source 5G ProSe End UE includes PFI(s) of the QoS flow(s) of the first hop as described in the clause 6.4.3.4. If the PC5 link is used for transferring Ethernet traffic, the source 5G ProSe Layer-3 End UE may provide its Ethernet MAC address.\n-\tFor adding new end-to-end QoS flow or modifying existing end-to-end QoS flow, in the Link Modification Request message over the second hop PC5 reference point, the 5G ProSe Layer-3 UE-to-UE Relay additionally includes QoS Info of the second hop QoS to the target 5G ProSe End UE. For removing end-to-end QoS flow(s), in the Link Modification Request message over the second hop PC5 reference point, the 5G ProSe Layer-3 UE-to-UE Relay includes PFI(s) of the QoS flow(s) of the second hop. If the PC5 link is used for transferring Ethernet traffic, the 5G ProSe Layer-3 UE-to-UE Relay provides the Ethernet MAC address of the source 5G ProSe Layer-3 End UE.\n-\tFor adding new end-to-end QoS flow or modifying existing end-to-end QoS flow, the Link Modification Accept message over the second hop PC5 reference point additionally includes QoS Info of the second hop QoS. If the PC5 link is used for transferring Ethernet traffic, the target 5G ProSe Layer-3 End UE may provide its Ethernet MAC address.\n-\tFor adding new end-to-end QoS flow or modifying existing end-to-end QoS flow, the 5G ProSe Layer-3 UE-to-UE Relay decides the QoS Info of the first hop QoS with considering the received second hop QoS, the Link Modification Accept message over the first hop PC5 reference point additionally includes QoS Info of the first hop QoS and may include IP address of the target 5G ProSe End UE. If the PC5 link is used for transferring Ethernet traffic, 5G ProSe Layer-3 UE-to-UE Relay provides the Ethernet MAC address of the target 5G ProSe Layer-3 End UE instead of IP related information.\nWhen the PC5 link between a 5G ProSe Layer-3 End UE and the 5G ProSe Layer-3 UE-to-UE Relay is released, the 5G ProSe Layer-3 UE-to-UE Relay may initiate the PC5 link release to the peer 5G ProSe Layer-3 End UE(s) or notify the peer 5G ProSe Layer-3 End UE(s) the peer PC5 link is released.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.1",
        "clause_6.4.3.7.1",
        "clause_6.4.3.4"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.4.3.7.4",
      "section_id": "6.4.3.7.4",
      "section_title": "Layer-2 link management over PC5 reference point for 5G ProSe UE-to-UE Relay Communication with integrated Discovery",
      "content": "This clause is for the 5G ProSe UE-to-UE Relay Communication with integrated Discovery procedure as described in clause 6.7.3.\nThe Direct Communication Request message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of source 5G ProSe End UE.\n-\t(optional) user info (i.e. Application Layer ID) of target 5G ProSe End UE: the identity of the target 5G ProSe End UE if provided from the ProSe application layer.\n-\t(optional) Destination Layer-2 ID of target 5G ProSe End UE: the unicast destination Layer-2 ID of the target 5G ProSe End UE determined by the source 5G ProSe End UE as specified in clause 5.8.2.4.\n-\tProSe Service Info: the information about the ProSe identifier(s) requesting Layer-2 link establishment.\n-\tRSC: the connectivity service provided by the 5G ProSe UE-to-UE Relay as requested by the source 5G ProSe End UE.\n-\tRelay_indication: indicates whether a 5G ProSe UE-to-UE Relay can send a Direct Communication Request message based on the received Direct Communication Request message which contains the relay_indication.\n-\tSecurity Information: the information for the establishment of security for the first hop PC5 link establishment (see TS 33.503 [29]).\nThe Direct Communication Request message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of source 5G ProSe End UE.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay.\n-\t(optional) user info of target 5G ProSe End UE.\n-\tProSe Service Info: the information about the ProSe identifier(s).\n-\tRSC: the connectivity service provided by the 5G ProSe UE-to-UE Relay as requested by the source 5G ProSe End UE.\n-\tSecurity Information: the information for the establishment of security for the second hop PC5 link establishment (see TS 33.503 [29]).\nThe Direct Communication Accept message over the second hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\nThe Direct Communication Accept message over the first hop PC5 reference point includes:\n-\tuser info (i.e. Application Layer ID) of target 5G ProSe End UE.\n-\tUser Info ID of 5G ProSe UE-to-UE Relay.\nFor the 5G ProSe Communication via 5G ProSe Layer-3 UE-to-UE Relay, additional clarifications are as following:\n-\tIn the Security Procedure of the second hop PC5 reference point, the 5G ProSe Layer-3 UE-to-UE Relay provides the IP Address Configuration or Link-Local IPv6 Address to the target 5G ProSe End UE.\n-\tThe Direct Communication Accept message over the second hop PC5 reference point additionally includes IP Address Configuration or Link-Local IPv6 Address (if IP communication is used), Ethernet MAC address of target 5G ProSe End UE (if Ethernet communication is used). QoS Info is not included in the Security Procedure or Direct Communication Accept message of the second hop PC5 reference point.\n-\tIn the Security Procedure of the first hop PC5 reference point, the source 5G ProSe End UE provides the IP Address Configuration, Link-Local IPv6 Address and QoS Info of the end-to-end QoS to the 5G ProSe Layer-3 UE-to-UE Relay.\n-\tThe 5G ProSe Layer-3 UE-to-UE Relay provides the QoS info of the second hop QoS to the target 5G ProSe End UE using the Layer-2 link modification as described in the clause 6.4.3.4.\n-\tThe 5G ProSe Layer-3 UE-to-UE Relay decides the QoS Info of the first hop QoS with considering the received second hop QoS from the target 5G ProSe End UE, the Direct Communication Accept message over the first hop PC5 reference point additionally includes IP Address Configuration or Link-Local IPv6 Address, QoS Info of the first hop QoS and may include IP address of the target 5G ProSe End UE (if IP communication is used) or Ethernet MAC address of target 5G ProSe End UE (if Ethernet communication is used).\nFor the 5G ProSe Communication via 5G ProSe Layer-2 UE-to-UE Relay, the message contents over PC5 reference point for unicast mode 5G ProSe Direct Communication as depicted from clause 6.4.3.1 to clause 6.4.3.5 are same for the end-to-end connection between peer 5G ProSe End UEs.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.3",
        "clause_5.8.2.4",
        "clause_6.4.3.4",
        "clause_6.4.3.1",
        "clause_6.4.3.5",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.0",
      "section_id": "6.5.1.0",
      "section_title": "General",
      "content": "5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay may be performed with or without involving N3IWF for non-emergency service and for emergency service as specified in clause 5.4.4.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4.4"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.1",
      "section_id": "6.5.1.1",
      "section_title": "5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF",
      "content": "A 5G ProSe Layer-3 UE-to-Network Relay registers to the network (if not already registered). 5G ProSe Layer-3 UE-to-Network Relay establishes a PDU Session(s) or modifies an existing PDU Session(s) in order to provide relay traffic towards 5G ProSe Layer-3 Remote UE(s). PDU Session(s) supporting 5G ProSe Layer-3 UE-to-Network Relay shall only be used for 5G ProSe Layer-3 Remote UE(s) relay traffic.\nThe PLMN serving the 5G ProSe Layer-3 UE-to-Network Relay and the PLMN to which the 5G ProSe Layer-3 Remote UE registers can be the same PLMN or two different PLMNs.\nFigure 6.5.1.1-1: 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF\n1.\tService authorization and provisioning are performed for the 5G ProSe Layer-3 UE-to-Network Relay (step 1a) and 5G ProSe Layer-3 Remote UE (step 1b) as described in clause 6.2.\n2.\tThe 5G ProSe Layer-3 UE-to-Network Relay may establish a PDU Session for relaying. In the case of IPv6, the 5G ProSe Layer-3 UE-to-Network Relay obtains the IPv6 prefix via prefix delegation function from the network as defined in TS 23.501 [4].\nNOTE 1:\t5G ProSe Layer-3 UE-to-Network Relay can establish a PDU Session for any Relay Service Code it supports before the connection is established with the 5G ProSe Layer-3 Remote UE.\n3.\tThe 5G ProSe Layer-3 Remote UE performs discovery of a 5G ProSe Layer-3 UE-to-Network Relay as described in clause 6.3.2.3. As part of the discovery procedure the 5G ProSe Layer-3 Remote UE learns about the connectivity service the 5G ProSe Layer-3 UE-to-Network Relay provides.\n4.\tThe 5G ProSe Layer-3 Remote UE selects a 5G ProSe Layer-3 UE-to-Network Relay and establishes a connection for unicast mode communication as described in clause 6.4.3.6. If there is no PDU Session associated with the Relay Service Code or a new PDU Session for relaying is needed, the 5G ProSe Layer-3 UE-to-Network Relay initiates a new PDU Session establishment procedure for relaying before completing the PC5 connection establishment.\nWhen the 5G ProSe Layer-3 Remote UE sends the Direct Communication Request message including the dedicated emergency RSC, the 5G ProSe Layer-3 UE-to-Network Relay sets up an emergency PDU session for relaying the emergency service if there is not an emergency PDU Session established in step 2.\nNOTE 2:\tIf the 5G ProSe Layer-3 UE-to-Network Relay has its own emergency service ongoing, how to handle the conflict case is specified in clause 5.4.4.3.\nThe network decides that the PDU Session to be established is for relay traffic and then generates the QoS rules and QoS Flow level QoS parameters to 5G ProSe Layer-3 UE-to-Network Relay with relay consideration and can initiate the setup of QoS flows as specified in clause 5.6.2.1. The Remote UE can also initiate the setup of QoS flows by providing PC5 QoS info and (optionally) PC5 QoS rule(s) to the 5G ProSe Layer-3 UE-to-Network Relay during connection setup, according to the procedure as specified in clause 5.6.2.1.\nThe 5G ProSe Layer-3 UE-to-Network Relay determines the PDU Session type for relaying as specified in clause 5.4.1.1.\nAccording to the PDU Session Type for relaying, the 5G ProSe Layer-3 UE-to-Network Relay performs relaying function at the corresponding layer as follows:\n-\tWhen the IP type PDU Session is used for IP traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay acts as an IP router. For IPv4, the 5G ProSe Layer-3 UE-to-Network Relay performs IPv4 NAT between IPv4 addresses assigned to the 5G ProSe Layer-3 Remote UE and the IPv4 address assigned to the PDU Session used for the relay traffic.\n-\tWhen the Ethernet type PDU Session is used for Ethernet traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay acts as an Ethernet switch.\n-\tWhen the Unstructured type PDU Session is used for Unstructured traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay performs traffic relaying based on a mapping between the PC5 Link Identifier and the PDU Session ID and a mapping between PFI for PC5 Layer-2 link and the QFI for the PDU Session. These mappings are created when the Unstructured type PDU Session is established for the 5G ProSe Layer-3 Remote UE.\n-\tWhen the IP type PDU Session is used for Ethernet or Unstructured traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay uses IP tunneling. For this IP tunnelling, the 5G ProSe Layer-3 UE-to-Network Relay locally assigns an IP address/prefix for the 5G ProSe Layer-3 Remote UE and uses it on the Uu reference point to encapsulate and decapsulate the uplink and downlink traffic for the 5G ProSe Layer-3 Remote UE. The tunnelled traffic over Uu reference point is transported over the PC5 reference point as Ethernet or Unstructured traffic.\n5.\tFor IP PDU Session Type and IP traffic over PC5 reference point, IPv6 prefix or IPv4 address (including NAT case) is allocated for the 5G ProSe Layer-3 Remote UE as defined in clause 5.5.1.3.\n6.\tThe 5G ProSe Layer-3 Remote UE may provide PC5 QoS Info and PC5 QoS rule(s) to the 5G ProSe Layer-3 UE-to-Network Relay using Layer-2 link modification procedure as specified in clause 6.4.3.4. The 5G ProSe Layer-3 UE-to-Network Relay generates the Packet Filters used over Uu interface based on the received PC5 QoS Info and QoS Rule(s) as described in clause 5.6.2.1 and may perform the UE requested PDU Session Modification as defined in TS 23.502 [5] clause 4.3.3 to setup a new QoS Flow or bind the traffic to an existing QoS Flow.\nFrom this point the uplink and downlink relaying can start. For downlink traffic forwarding, the PC5 QoS Rule is used to map the downlink packet to the PC5 QoS Flow. For uplink traffic forwarding, the 5G QoS Rule is used to map the uplink packet to the Uu QoS Flow.\n7.\tThe 5G ProSe Layer-3 UE-to-Network Relay shall send a Remote UE Report (Remote User ID, Remote UE info) message to the SMF for the PDU Session associated with the relay. The Remote User ID, as defined in TS 33.503 [29], is an identity of the 5G ProSe Layer-3 Remote UE user that was successfully connected in step 4. The Remote UE info is used to assist identifying the 5G ProSe Layer-3 Remote UE in the 5GC. For IP PDU Session Type, the Remote UE info is Remote UE IP info. For Ethernet PDU Session Type, the Remote UE info is Remote UE MAC address which is detected by the 5G ProSe Layer-3 UE-to-Network Relay. For Unstructured PDU Session Type, the Remote UE info is not included. The SMF stores the Remote User IDs and the related Remote UE info in the 5G ProSe Layer-3 UE-to-Network Relay's SM context for this PDU Session associated with the relay.\nThe Remote UE Report is N1 SM NAS message sent with the PDU Session ID to the AMF, in turn delivered to the SMF.\nNOTE 3:\tThe privacy protection for Remote User ID is specified in TS 33.503 [29].\nFor IP info the following principles apply:\n-\tfor IPv4, the 5G ProSe Layer-3 UE-to-Network Relay shall report TCP/UDP port ranges assigned to individual 5G ProSe Layer-3 Remote UE(s) (along with the Remote User ID);\n-\tfor IPv6, the 5G ProSe Layer-3 UE-to-Network Relay shall report IPv6 prefix(es) assigned to individual 5G ProSe Layer-3 Remote UE(s) (along with the Remote User ID).\nIf the PDU Session for relaying is released by the UE-to-Network Relay or the network as described in clause 4.3.4 of TS 23.502 [5], the UE-to-Network Relay should initiate the release of the layer-2 links associated with the released PDU Session using the procedure defined in clause 6.4.3.3.\nThe PDU Session(s) used for relaying should be released as described in clause 4.3.4 of TS 23.502 [5] (e.g. by 5G ProSe Layer-3 UE-to-Network Relay), if the service authorization for acting as a 5G ProSe Layer-3 UE-to-Network Relay in the serving PLMN is revoked.\nThe 5G ProSe Layer-3 UE-to-Network Relay shall send the Remote UE Report message when the 5G ProSe Layer-3 Remote UE disconnects from the 5G ProSe Layer-3 UE-to-Network Relay (e.g. upon explicit layer-2 link release or based on the absence of keep alive messages over PC5) to inform the SMF that the 5G ProSe Layer-3 Remote UE(s) have left.\nNOTE 4:\tIn order for the SMF to have the 5G ProSe Layer-3 Remote UE(s) information, the HPLMN and the VPLMN where the 5G ProSe Layer-3 UE-to-Network Relay is authorised to operate, needs to support the transfer of the 5G ProSe Layer-3 Remote UE related parameters if the SMF is in the HPLMN.\nIt is up to 5G ProSe Layer-3 UE-to-Network Relay implementation how PDU Session(s) used for relaying are released or QoS Flow(s) used for relaying are removed by the 5G ProSe Layer-3 UE-to-Network Relay when 5G ProSe Layer-3 Remote UE(s) disconnect from the 5G ProSe Layer-3 UE-to-Network Relay.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2",
        "clause_6.3.2.3",
        "clause_6.4.3.6",
        "clause_5.4.4.3",
        "clause_5.6.2.1",
        "clause_5.4.1.1",
        "clause_5.5.1.3",
        "clause_6.4.3.4",
        "ts_23.502_clause_4.3.3",
        "ts_23.502_clause_4.3.4",
        "clause_6.4.3.3",
        "figure_6.5.1.1-1",
        "ts_23.501",
        "ts_23.502",
        "ts_33.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.2.1",
      "section_id": "6.5.1.2.1",
      "section_title": "Connection management via 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support",
      "content": "In order to relay 5G ProSe Layer-3 Remote UE's traffic via N3IWF (see clause 6.5.1.2.2 for N3IWF selection), the 5G ProSe Layer-3 UE-to-Network Relay needs suitable ProSe Policies configured for establishing a PDU Session associated with a UPF that conveys the traffic towards the N3IWF. A 5G ProSe Layer-3 UE-to-Network Relay registers to the network as specified in clause 6.5.1.1. Based on configuration and authorization, the 5G ProSe Layer-3 UE-to-Network Relay is provisioned with PDU Session parameters in the ProSe Policy allowing the access to the N3IWF. When the corresponding PDU Session is established, the 5GS, e.g. SMF, based on the parameters (i.e. DNN, S-NSSAI) selects the UPF that ensures the connection to the N3IWF. The UPF for the 5G ProSe UE-to-Network Relay and the N3IWF may be collocated.\nA 5G ProSe Layer-3 UE-to-Network Relay with a PDU Session providing access via N3IWF may also have other PDU Sessions for supporting access from the 5G ProSe Layer-3 Remote UE without going through a N3IWF.\nNOTE 1:\tWhether a different PDU Sessions need to be established to serve traffics for Layer-3 Remote UE with or without going through a N3IWF is determined by Layer-3 Relay UE per TS 23.503 [9].\nFigure 6.5.1.2.1-1: Connection establishment over 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support\n1.\t5G ProSe Layer-3 UE-to-Network Relay performs Registration procedures and obtains the ProSe Policy that corresponds to the operation supporting the access to N3IWF. The ProSe Policy includes the RSC and PDU Session parameters allowing the access to the N3IWF.\nThe 5G ProSe Layer-3 Remote UE is configured with the corresponding ProSe Policy and URSP rules. The URSP policy indicates if a particular service needs to be accessed within a PDU Session and thus should use a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support as described in clause 6.5.4.\n2-4.\tA 5G ProSe Layer-3 UE-to-Network Relay and 5G ProSe Layer-3 Remote UE follow the procedures described in steps 3-5 in clause 6.5.1.1 using the RSC configured for making the 5G ProSe Layer-3 Remote UE access to 5GC via N3IWF.\nNOTE 2:\tThe services requiring the access via N3IWF can be configured with the RSC(s) that can be served by the same 5G ProSe UE-to-Network Relay.\n5.\tThe 5G ProSe Layer-3 Remote UE that connects to a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support selects an N3IWF and determines the N3IWF IP address. The 5G ProSe Layer-3 Remote UE follows the N3IWF selection procedure as described in clause 6.5.1.2.2.\n6.\tThe 5G ProSe Layer-3 Remote UE establishes a signalling IPsec tunnel using IKE procedures with a N3IWF and performs NAS Registration as shown in Figure 4.12.2.2-1 of TS 23.502 [5]. After the IPSec tunnel is established, the 5G ProSe Layer-3 Remote UE can perform any of the NAS procedures (incl. PDU Session establishment for the 5G ProSe Layer-3 UE-to-Network Relay PDU Sessions) as specified in clause 4.12 of TS 23.502 [5].\n7.\tAfter the PDU session(s) and associated QoS Flows are established in the 5G ProSe Layer-3 Remote UE's 5GC, the N3IWF determines the number of IPsec Child SA(s) that is needed and initiates the creation of the Child SA(s) as specified in clause 4.12.5 of TS 23.502 [5]. Once the Child SA(s) has been created the 5G ProSe Layer‑3 Remote UE will have the mapping between the DSCP markings for the IPsec Child SA(s), the corresponding QoS and N3IWF IP address(es) and provides this information, if needed, to the 5G ProSe Layer-3 UE-to-Network Relay as specified in clause 5.6.2.2. If needed, the 5G ProSe Layer-3 UE-to-Network Relay performs the PDU Session Modification procedure to request QoS flow(s) configuration that maps to the 5G ProSe Layer-3 Remote UE's Child SA(s).\nIKE keep alive(s) between the 5G ProSe Layer-3 Remote UE and the N3IWF are used for detecting possible path failure. The 5G ProSe Layer-3 Remote UE may change 5G ProSe Layer-3 UE-to-Network Relay(s) while maintain the session with the N3IWF when the 5G ProSe Layer-3 Remote UE and the N3IWF support MOBIKE. This is negotiated between the 5G ProSe Layer-3 Remote UE and the N3IWF as specified in TS 23.502 [5], clause 4.12.2.2). When IKE keep alive(s) are used, the 5G ProSe Layer-3 Remote UE needs to keep the PC5 connection and 5G ProSe Layer-3 UE-to-Network Relay keeps the PDU Session.\nWhen 5G ProSe Remote UE is in CM-CONNECTED state, the 5G ProSe Remote UE keeps the PC5 link. When the 5G ProSe Remote UE is in CM-IDLE state, it may either release the PC5 link for relaying or not.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.5.1.2.2",
        "clause_6.5.1.1",
        "clause_6.5.4",
        "ts_23.502_clause_4.12",
        "ts_23.502_clause_4.12.5",
        "clause_5.6.2.2",
        "ts_23.502_clause_4.12.2.2",
        "ts_23.503_figure_6.5.1.2.1-1",
        "ts_23.502_figure_4.12.2.2-1",
        "ts_23.503",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.2.2",
      "section_id": "6.5.1.2.2",
      "section_title": "N3IWF selection for 5G ProSe Layer-3 Remote UE procedure",
      "content": "When the 5G ProSe Layer-3 Remote UE relays traffic over 5G ProSe Layer-3 UE-to-Network Relay that supports N3IWF, the 5G ProSe Layer-3 Remote UE selects the N3IWF using the N3IWF selection procedure that is specified in clause 6.3.6.2 of TS 23.501 [4] for untrusted non-3GPP access with the following differences.\nTo support the N3IWF selection for 5G ProSe Layer-3 Remote UE, a 5G ProSe Layer-3 Remote UE is configured by HPLMN with N3IWF identifier configuration for 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay access node selection information as described in clause 5.1.4.1.\nWhen the 5G ProSe Layer-3 Remote UE decides to select an N3IWF in the HPLMN, the 5G ProSe Layer-3 Remote UE uses the N3IWF identifier configuration for 5G ProSe Layer-3 Remote UE, if configured, to find the IP address of the N3IWF in the HPLMN. Otherwise, 5G ProSe Layer-3 Remote UE constructs N3IWF FQDN based on either the Tracking Area Identity FQDN or on Operator Identifier FQDN of the 5G ProSe Layer-3 UE-to-Network Relay node selection information.\nTo assist the 5G ProSe Layer-3 Remote UE with N3IWF selection, the 5G ProSe Layer-3 UE-to-Network Relay supporting N3IWF access advertises the 5GS TAI corresponding to the serving cell, as defined in clause 5.8.3.2, in the 5G ProSe UE-to-Network Relay Discovery procedure as defined in clause 6.3.2.3.\nA 5G ProSe Layer-3 Remote UE constructs the FQDN using either Tracking Area Identity FQDN or on Operator Identifier FQDN and selects the N3IWF using the procedures of N3IWF selection in clause 6.3.6.2 of TS 23.501 [4].\nWhen the 5G ProSe Layer-3 Remote UE relays traffic over 5G ProSe Layer-3 UE-to-Network Relay using N3IWF for emergency services, the 5G ProSe Layer-3 Remote UE selects the N3IWF using the N3IWF selection procedure that is specified in clause 6.3.6.4.2 of TS 23.501 [4].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.501_clause_6.3.6.2",
        "clause_5.1.4.1",
        "clause_5.8.3.2",
        "clause_6.3.2.3",
        "ts_23.501_clause_6.3.6.4.2",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.2.3",
      "section_id": "6.5.1.2.3",
      "section_title": "Mobility of 5G ProSe Layer-3 Remote UE between Direct and Indirect Network communication path",
      "content": "When 5G ProSe Layer-3 Remote UE changes from Direct Network Communication to Indirect Network Communication path, TS 23.502 [5] clause 4.9.2.2 applies after the 5G ProSe Layer-3 Remote UE establishes PC5 connection to the 5G Layer-3 UE-to-Network Relay.\nWhen 5G ProSe Layer-3 Remote UE changes from Indirect Network Communication path to Direct Network Communication, the 5G ProSe Layer-3 Remote UE follows TS 23.502 [5] clause 4.9.2.1.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.9.2.2",
        "ts_23.502_clause_4.9.2.1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.1.3",
      "section_id": "6.5.1.3",
      "section_title": "Additional parameters announcement procedure",
      "content": "Additional parameters announcement procedure outlined in figure 6.5.1.3-1 is used by a 5G ProSe Remote UE to request a 5G ProSe UE-to-Network Relay to announce additional parameters (using Model A) as defined in clause 5.8.3.\nFigure 6.5.1.3-1: Additional parameters announcement procedure\n1.\t5G ProSe Remote UE has discovered a 5G ProSe UE-to-Network Relay and requires additional parameters.\n2.\tThe 5G ProSe Remote UE sends to the 5G ProSe UE-to-Network Relay an Additional Parameters Announcement Request to obtain additional parameters.\n3.\tThe 5G ProSe UE-to-Network Relay acknowledges receipt of the request in step 2 with an Additional Parameters Announcement Response (Additional_Parameters_Announcement_Request_Refresh Timer). The Additional_Parameters_Announcement_Request_Refresh Timer (configurable in the 5G ProSe UE-to-Network Relay), is provided to the 5G ProSe Remote UE so that when this timer expires the 5G ProSe Remote UE repeats the Additional Parameters Announcement Request procedure if it still needs to obtain the additional parameters. If the 5G ProSe Remote UE does not initiate new Additional Parameters Announcement Request procedure when this Additional_Parameters_Announcement_Request_Refresh Timer expires and no other UE request additional parameters announcement before the Additional_Parameters_Announcement_Request_Refresh timer expires in the 5G ProSe UE-to-Network Relay, then the relay shall stop announcing the addtional parameters.\n4.\tThe 5G ProSe UE-to-Network Relay announces the additional parameters by sending Relay Discovery Additional Information message as defined in clause 5.8.3. This is repeated periodically with a configurable frequency (normally higher than the one related to the Additional_Parameters_Announcement_Request_Refresh Timer) until there is no UE requesting to announce the additional parameters as determined by the Additional_Parameters_Announcement_Request_Refresh Timer running in the 5G ProSe UE-to-Network Relay.\nNOTE:\tBased on UE implementation, the 5G ProSe UE-to-Network Relay can send the Relay Discovery Additional Information message several times consecutively in step 4 if there are other 5G ProSe Remote UE(s) that have connected to the 5G ProSe UE-to-Network Relay but not yet requested any additional parameters. This ensures the other 5G ProSe Remote UE(s) obtain such additional parameters without invoking any new request(s).\n5.\tThe 5G ProSe UE-to-Network Relay detects new or updated additional parameters.\n6.\tDetection of new or updated additional parameters in step 5 triggers the 5G ProSe UE-to-Network Relay to announce the additional parameters by sending a Relay Discovery Additional Information Message immediately and to repeat it periodically with a configurable frequency as in step 4 until there are no UEs requesting to announce the additional parameters, i.e. until the Additional_Parameters_Announcement_Request_Refresh Timer expires in the 5G ProSe UE-to-Network Relay.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.3",
        "figure_6.5.1.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.2.1.1",
      "section_id": "6.5.2.1.1",
      "section_title": "Registration Management",
      "content": "Registration Management for the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 UE-to-Network Relay follows the principles and procedures defined in TS 23.501 [4] and TS 23.502 [5]. The 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 UE-to-Network Relay may be served by the same AMF or different AMFs.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.2.1.2",
      "section_id": "6.5.2.1.2",
      "section_title": "Connection Management",
      "content": "Connection Management for the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 UE-to-Network Relay follows the principles and procedures defined in TS 23.501 [4] and TS 23.502 [5] with the following modifications.\nThe 5G ProSe Layer-2 UE-to-Network Relay may only relay data/signalling for the 5G ProSe Layer-2 Remote UE(s) when the 5G ProSe Layer-2 UE-to-Network Relay is in CM-CONNECTED state. If the 5G ProSe Layer-2 UE-to-Network Relay is in CM_IDLE state and receives a connection request from the 5G ProSe Layer-2 Remote UE for relaying, the 5G ProSe Layer-2 UE-to-Network Relay shall trigger Service Request procedure to enter CM_CONNECTED state before relaying the 5G ProSe Layer-2 Remote UEs traffic. If the 5G ProSe Layer-2 UE-to-Network Relay in RRC_IDLE receives a connection request from the 5G ProSe Layer-2 Remote UE using emergency RSC, then 5G ProSe Layer-2 UE-to-Network Relay sets the establishment cause to \"emergency\".\nThe state of 5G ProSe UE-to-Network Relay is controlled by NG-RAN with the following:\n-\tIf any 5G ProSe Layer-2 Remote UE connected to the 5G ProSe Layer-2 UE-to-Network Relay is in CM-CONNECTED with RRC Connected state, the 5G ProSe Layer-2 UE-to-Network Relay shall remain CM-CONNECTED state with RRC Connected state unless the network needs to release the connection.\n-\tIf all 5G ProSe Layer-2 Remote UEs connected to the 5G ProSe Layer-2 UE-to-Network Relay enter CM-IDLE or CM-CONNECTED with RRC Inactive state, the 5G ProSe Layer-2 UE-to-Network Relay may enter CM-IDLE state or CM-CONNECTED with RRC Inactive state, or may remain CM-CONNECTED with RRC Connected state.\nWhen 5G ProSe Layer-2 Remote UE is in CM-CONNECTED state, the 5G ProSe Layer-2 UE-to-Network Relay and 5G ProSe Layer-2 Remote UE keep the PC5 link. When the 5G ProSe Remote UE is in CM-IDLE state, it may either release the PC5 link for relaying or not.\nFor paging a 5G ProSe Layer-2 Remote UE, it follows the principles and procedures defined in TS 23.501 [4] and TS 23.502 [5] and the paging message delivery from NG-RAN to 5G ProSe Layer-2 Remote UE is specified in TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501",
        "ts_23.502",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.2.2",
      "section_id": "6.5.2.2",
      "section_title": "Connection establishment",
      "content": "Figure 6.5.2.2-1: Connection Establishment for 5G ProSe Layer-2 UE-to-Network Relay\n0.\tIf in coverage, the 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay may independently perform the initial registration to the network according to registration procedures in TS 23.502 [5].\n1.\tIf in coverage, the 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay independently get the service authorization for 5G ProSe Layer-2 UE-to-Network Relay operation from the network. Service authorization and parameters provisioning for 5G ProSe Layer-2 UE-to-Network Relay operation are performed for the 5G ProSe Layer-2 UE-to-Network Relay and 5G ProSe Layer-2 Remote UE as specified in clause 5.1.4.\nIf the 5G ProSe Layer-2 Remote UE is \"not served by NG-RAN\", the pre-configured parameters are used and the service authorization and parameters may be updated after step 6.\nIf the 5G ProSe Layer-2 Remote UE has not performed Initial Registration, the 5G ProSe Layer-2 Remote UE may perform the Initial Registration in step 6.\n2.\tThe 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay perform 5G ProSe UE-to-Network Relay Discovery and selection, as specified in clause 6.3.2.3.\n3.\tThe 5G ProSe Layer-2 Remote UE initiates a one-to-one communication connection with the selected 5G ProSe Layer-2 UE-to-Network Relay over PC5 using the procedure as described in clause 6.4.3.\n4.\tThe 5G ProSe Layer-2 Remote UE establishes an RRC Connection with the same NG-RAN serving the selected 5G ProSe Layer-2 UE-to-Network Relay, specified in TS 38.300 [12]. The 5G ProSe Layer-2 Remote UE sets the RRC Establishment Cause as defined in TS 38.331 [16].\n5.\tDuring step 4, if the 5G ProSe Layer-2 UE-to-Network Relay is in CM_IDLE state and receives a trigger from the AS layer to enter CM-CONNECTED state due to Remote UE's AS layer connection set up with the NG-RAN, the 5G ProSe Layer-2 UE-to-Network Relay performs Service Request procedure in the clause 4.2.3.2 of TS 23.502 [5].\n6.\tThe 5G ProSe Layer-2 Remote UE sends a NAS message to the serving AMF. The NAS message is encapsulated in an Uu RRC message that is sent over PC5 to the 5G ProSe Layer-2 UE-to-Network Relay and the 5G ProSe Layer-2 UE-to-Network Relay forwards the Uu RRC message to the NG-RAN specified in TS 38.300 [12]. NG-RAN selects the 5G ProSe Layer-2 Remote UE's serving AMF and forwards the NAS message to this AMF.\nIf 5G ProSe Layer-2 Remote UE has not performed the initial registration, the NAS message is an initial Registration message. Otherwise, the NAS message is either a service request message, or a mobility or periodic Registration message taking into account the TAI in the RRC container received from the 5G ProSe Layer-2 UE-to-Network Relay during Relay Discovery (see clause 5.8.3.3) or PC5-RRC message, as specified in TS 38.300 [12].\n7.\tThe 5G ProSe Layer-2 Remote UE may trigger the PDU Session Establishment procedure as defined in clause 4.3.2.2 of TS 23.502 [5].\n8.\tThe data is transferred between the 5G ProSe Layer-2 Remote UE and UPF via the 5G ProSe Layer-2 UE-to-Network Relay and NG-RAN. The 5G ProSe Layer-2 UE-to-Network Relay forwards all the data messages between the 5G ProSe Layer-2 Remote UE and NG-RAN, as specified in TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.4",
        "clause_6.3.2.3",
        "clause_6.4.3",
        "ts_23.502_clause_4.2.3.2",
        "clause_5.8.3.3",
        "ts_23.502_clause_4.3.2.2",
        "figure_6.5.2.2-1",
        "ts_23.502",
        "ts_38.300",
        "ts_38.331"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.2.3",
      "section_id": "6.5.2.3",
      "section_title": "Path switching between direct network communication path and indirect network communication path via 5G ProSe Layer-2 UE-to-Network Relay",
      "content": "Xn based (as defined in clause 4.9.1.2 of TS 23.502 [5]) and N2 based (as defined in clause 4.9.1.3 of TS 23.502 [5]) Handover procedure is used for inter-gNB indirect-to-direct path switching for 5G ProSe Layer-2 Remote UE in CM-CONNECTED with RRC_CONNECTED state.\nXn based (as defined in clause 4.9.1.2 of TS 23.502 [5]) and N2 based (as defined in clause 4.9.1.3 of TS 23.502 [5]) Handover procedure is used for inter-gNB direct-to-indirect path switching for 5G ProSe Layer-2 Remote UE in CM-CONNECTED with RRC_CONNECTED state with following modification:\n-\tthe Source to Target transparent container is modified as specified in clause 9.3.1.29 of TS 38.413 [34].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.9.1.2",
        "ts_23.502_clause_4.9.1.3",
        "ts_38.413_clause_9.3.1.29",
        "ts_23.502",
        "ts_38.413"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.3",
      "section_id": "6.5.3",
      "section_title": "5G ProSe UE-to-Network Relay reselection",
      "content": "After being connected to the 5G ProSe UE-to-Network Relay, the 5G ProSe Remote UE keeps performing the measurement of the signal strength of PC5 unicast link with the 5G ProSe UE-to-Network Relay for relay reselection.\nThe 5G ProSe UE-to-Network Relay discovery procedures defined in clause 6.3.2.3 are used to discover available 5G ProSe UE-to-Network Relays for 5G ProSe UE-to-Network Relay reselection.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.4",
      "section_id": "6.5.4",
      "section_title": "5G ProSe Remote UE traffic handling for 5G ProSe UE-to-Network Relay support",
      "content": "For the 5G ProSe Remote UE to access the service via 5G ProSe UE-to-Network Relay, the following apply:\n-\tThe application traffic on the 5G ProSe Remote UE is managed by URSP rules (with consideration of local configurations), following the procedure defined in clauses 6.1.2.2.1 and 6.6.2.3 of TS 23.503 [9]. The URSP rules defined in clause 6.6.2.1 of TS 23.503 [9] applies for the 5G ProSe Remote UE, with RSD enhanced to include:\n-\ta \"ProSe Layer-3 UE-to-Network Relay Offload indication\"; or\n-\ta \"ProSe Multi-path Preference\".\n-\tIf an application or application traffic matches a URSP rule, corresponding RSDs shall be used to evaluate the existing PDU sessions, or establish a new PDU session, or determine to offload outside of a PDU session, or multi-path communication via 5G ProSe Layer-3 UE-to-Network Relay outside of a PDU session and a PDU Session over Uu reference point.\n-\tIf the selected RSD contains \"ProSe Layer-3 UE-to-Network Relay Offload indication\":\n-\tThe 5G ProSe Remote UE will route the traffic to the 5G ProSe Layer-3 UE-to-Network Relay connection without establishing a PDU session, when such connection is available.\nThis may trigger the 5G ProSe Remote UE to start 5G ProSe UE-to-Network Relay discovery if it is not yet started. The discovery and establishment of the connection with the 5G ProSe Layer-3 UE-to-Network Relay is controlled by the ProSe Policy (pre-) configured on the 5G ProSe Remote UE.\n-\tIf the matched URSP rule contains both a RSD with ''Non-Seamless Offload indication\" and a RSD with \"ProSe Layer-3 UE-to-Network Relay Offload indication\", whether to offload the traffic to non-3GPP access or the 5G ProSe Layer-3 UE-to-Network Relay connection depends on the priority of the RSDs and the availability of the connections, as specified in the clause 6.6.2.3 of TS 23.503 [9].\n-\tIf the selected RSD does not contain the \"ProSe Layer-3 UE-to-Network Relay Offload indication\" or, \"Non-Seamless Offload indication\", the 5G ProSe Remote UE shall use a PDU session to route the corresponding application traffic.\nIf configured in the ProSe Policy, the 5G ProSe Remote UE may attempt the discovery of a Relay Service Code corresponding to a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support in the discovery procedure, when the non-3GPP access type is preferred in the selected RSD. The 5G ProSe Remote UE may attempt the discovery of a Relay Service Code corresponding to a 5G ProSe Layer-2 UE-to-Network Relay in the discovery procedure, when the 3GPP access type is preferred in the selected RSD.\n-\tIf the selected RSD contains \"ProSe Multi-path Preference\":\n-\tThe 5G ProSe Remote UE is preferred to route the traffic over a PC5 connection with a 5G ProSe Layer-3 UE-to-Network Relay and a PDU Session matched to other components (e.g., Network Slice Selection) in the selected RSD. If either connection is not available then the traffic may be routed via a PC5 connection with a 5G ProSe Layer-3 UE-to-Network Relay or a PDU Session matched to other components.\n-\tIf the PC5 connection with 5G ProSe Layer-3 UE-to-Network Relay associated with the desired RSC is not available, this may trigger the 5G ProSe Remote UE to start 5G ProSe UE-to-Network Relay discovery and connection establishment, controlled by the ProSe Policy configured on the 5G ProSe Remote UE. If the PC5 connection with 5G ProSe Layer-3 UE-to-Network Relay associated with the desired RSC is available, this may trigger Layer-2 link modification to associate the corresponding ProSe service into the PC5 connection. Determination on the desired RSC is based on the Policy/Parameters specified in clause 5.1.4.1.\n-\tIf the PDU Session matched to other components in the selected RSD is not available, this may trigger the establishment of a new PDU Session over Uu reference point using the values specified by the selected RSD.\n-\tIf the 5G ProSe Remote UE has an indirect connection via a 5G ProSe Layer-2 UE-to-Network Relay connection available, it will be treated as the \"3GPP\" access type. If the 5G ProSe Remote UE has an indirect connection via a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support available, it will be treated as the \"non-3GPP\" access type. The URSP handling as defined in TS 23.503 [9] applies.\nFor the 5G ProSe Layer-3 UE-to-Network Relay and 5G ProSe Layer-2 UE-to-Network Relay, the URSP handling does not apply to the relayed traffic from the 5G ProSe Remote UE.\nFor the 5G ProSe Layer-3 UE-to-Network Relay, the PDU session established for relaying the 5G ProSe Remote UE's traffic is controlled by the ProSe Policy.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.503_clause_6.6.2.1",
        "ts_23.503_clause_6.6.2.3",
        "clause_5.1.4.1",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.5.5.1",
      "section_id": "6.5.5.1",
      "section_title": "General",
      "content": "The communication path switching between two UE-to-Network Relays includes the following scenarios:\n-\tLayer-3 UE-to-Network Relay with N3IWF switching from/to Layer-3 UE-to-Network Relay with N3IWF.\n-\tLayer-3 UE-to-Network Relay without N3IWF switching from/to Layer-3 UE-to-Network Relay without N3IWF.\n-\tLayer-3 UE-to-Network Relay without N3IWF switching from/to Layer-3 UE-to-Network Relay with N3IWF.\n-\tLayer-2 UE-to-Network Relay switching from/to Layer-2 UE-to-Network Relay.\n-\tLayer-2 UE-to-Network Relay switching from/to Layer-3 UE-to-Network Relay without N3IWF.\n-\tLayer-2 UE-to-Network Relay switching from/to Layer-3 UE-to-Network Relay with N3IWF.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_6.5.5.2",
      "section_id": "6.5.5.2",
      "section_title": "Procedures for Communication Path Switching between UE-to-Network Relays",
      "content": "This clause specifies the communication path switching procedures between two UE-to-Network Relays.\nWhen performing the path switching between two 5G ProSe Layer-3 UE-to-Network Relay without N3IWF, or between 5G ProSe Layer-3 UE-to-Network Relay without N3IWF and 5G ProSe Layer-2 UE-to-Network Relay, or between 5G ProSe Layer-3 UE-to-Network Relay without N3IWF and 5G ProSe Layer-3 UE-to-Network Relay with N3IWF, the application layer procedures are used for service continuity support which is out of scope of this specification.\nPath switching between two 5G ProSe Layer-3 UE-to-Network Relay with N3IWF is performed using the mechanism specified for Local mobility anchor within untrusted non-3GPP access networks using MOBIKE in clause 6.2.9 of TS 23.501 [4].\nWhen a 5G ProSe-enabled UE as a 5G ProSe Layer-2 Remote UE in CM-CONNECTED state switches the communication path to Layer-3 UE-to-Network Relay with N3IWF, 5G ProSe-enabled UE's PDU session(s) can handover to the indirect path via Layer-3 UE-to-Network Relay with N3IWF by reusing the procedures specified in clause 4.9.2 of TS 23.502 [5].\nWhen a 5G ProSe-enabled UE as a 5G ProSe Layer-3 Remote UE switches the communication path from Layer-3 UE-to-Network Relay with N3IWF to an indirect path via Layer-2 UE-to-Network Relay, 5G ProSe-enabled UE's PDU session(s) can handover to the indirect path via Layer-2 UE-to-Network Relay by reusing the procedures specified in clause 4.9.2 of TS 23.502 [5].\nProcedure on Path switching between two 5G ProSe Layer-2 UE-to-Network Relays is specified in TS 38.300 [12]. Xn based (as defined in clause 4.9.1.2 of TS 23.502 [5]) and N2 based (as defined in clause 4.9.1.3 of TS 23.502 [5]) Handover procedure is used for inter-gNB indirect-to-indirect path switching for 5G ProSe Layer-2 Remote UE in CM-CONNECTED with RRC_CONNECTED state with following modification:\n-\tthe Source to Target transparent container is modified as specified in clause 9.3.1.29 of TS 38.413 [34].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.501_clause_6.2.9",
        "ts_23.502_clause_4.9.2",
        "ts_38.300_clause_4.9.1.2",
        "ts_23.502_clause_4.9.1.3",
        "ts_38.413_clause_9.3.1.29",
        "ts_23.502_clause_4.9.1.2",
        "ts_23.501",
        "ts_23.502",
        "ts_38.300",
        "ts_38.413"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.1",
      "section_id": "6.6.1",
      "section_title": "General",
      "content": "In order to support PC5 radio resource control in NG-RAN, ProSe service Authorisation information and PC5 QoS parameters for ProSe need to be made available in NG-RAN. This clause describes the corresponding procedures and aspects.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_6.6.2",
      "section_id": "6.6.2",
      "section_title": "Registration procedure",
      "content": "The Registration procedure for UE is performed as defined in TS 23.502 [5] clause 4.2.2.2 with the following additions:\n-\tThe UE includes the 5G ProSe Capability as part of the \"5GMM capability\" in the Registration Request message. The AMF stores the 5G ProSe Capability for 5G ProSe operation.\n-\tThe 5G ProSe Capability indicates whether the UE supports one or more of the following ProSe capabilities:\n-\t5G ProSe Direct Discovery;\n-\t5G ProSe Direct Communication;\n-\t5G ProSe Layer-2 UE-to-Network Relay;\n-\t5G ProSe Layer-3 UE-to-Network Relay;\n-\t5G ProSe Layer-2 Remote UE;\n-\t5G ProSe Layer-3 Remote UE;\n-\t5G ProSe Layer-2 UE-to-UE Relay;\n-\t5G ProSe Layer-3 UE-to-UE Relay;\n-\t5G ProSe Layer-2 End UE; and\n-\t5G ProSe Layer-3 End UE.\n-\tThe AMF obtains the 5G ProSe subscription data as part of the user subscription data from UDM during UE Registration procedure using Nudm_SDM service as defined in clause 4.2.2.2.2 of TS 23.502 [5].\n-\tThe AMF determines whether the UE is authorised to use 5G ProSe services based on UE's 5G ProSe Capability and the ProSe Service Authorisation included in the subscription data received from UDM as specified in clause 5.7. ProSe NR UE-PC5-AMBR is also provided to the AMF as part of the subscription data for 5G ProSe services. The AMF stores the authorized 5G ProSe Capability.\n-\tThe AMF sends the authorized 5G ProSe Capability for 5G ProSe operation to PCF. Based on the received 5G ProSe Capability from the AMF, the PCF provides the PC5 QoS parameters for 5G ProSe to AMF. The AMF stores such information as part of the UE context.\n-\tIf the UE is authorised to use 5G ProSe services, then the AMF shall include in a NGAP message sent to NG-RAN:\n-\t\"5G ProSe authorised\" information, including one or more of the following:\n-\twhether the UE is authorized to use 5G ProSe Direct Discovery;\n-\twhether the UE is authorized to use 5G ProSe Direct Communication;\n-\twhether the UE is authorized to act as a 5G ProSe Layer-2 UE-to-Network Relay;\n-\twhether the UE is authorized to act as a 5G ProSe Layer-3 UE-to-Network Relay;\n-\twhether the UE is authorized to act as a 5G ProSe Layer-2 Remote UE;\n-\twhether the UE is authorized to use multi-path communication via direct Uu path and via 5G ProSe Layer-2 UE-to-Network Relay as a 5G ProSe Layer-2 Remote UE;\n-\twhether the UE is authorized to act as a 5G ProSe Layer-2 UE-to-UE Relay;\n-\twhether the UE is authorized to act as a 5G ProSe Layer-2 End UE.\nNOTE:\tThe authorization for \"5G ProSe Direct discovery\" and \"5G ProSe Direct communication\" can be used for 5G ProSe Layer-3 UE-to-UE Relay and 5G ProSe Layer-3 End UE.\n-\tProSe NR UE-PC5-AMBR, used by NG-RAN for the resource management of UE's PC5 transmission for 5G ProSe services in network scheduled mode.\n-\tthe PC5 QoS parameters for 5G ProSe used by the NG-RAN for the resource management of UE's PC5 transmission for ProSe services in network scheduled mode.\n-\tIf the UE is authorised to use 5G ProSe services, then the AMF should not initiate the release of the signalling connection after the completion of the Registration procedure. The release of the signalling connection relies on the decision of NG-RAN, as specified in TS 23.502 [5].",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.2.2.2",
        "ts_23.502_clause_4.2.2.2.2",
        "clause_5.7",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.3",
      "section_id": "6.6.3",
      "section_title": "Service Request procedure",
      "content": "The Service Request procedures for UE in CM-IDLE state are performed as defined in TS 23.502 [5] clause 4.2.3.2 and clause 4.2.3.3 with the following additions:\n-\tIf the UE is authorised to use ProSe services, then the AMF shall include \"ProSe authorised\" information in the NGAP message, indicating which of the ProSe services the UE is authorised to use as described in clause 6.6.2.\n-\tThe AMF includes the ProSe NR UE-PC5-AMBR in the NGAP message to the NG-RAN as part of the UE context and NG-RAN may use in resource management of UE's PC5 transmission for ProSe services in network scheduled mode.\n-\tThe AMF sends the PC5 QoS parameters for ProSe to NG-RAN via N2 signalling. The PC5 QoS parameters for ProSe may be stored in the UE context after the registration procedure. If the UE is authorised to use ProSe services but AMF does not have PC5 QoS parameters for ProSe available, the AMF fetches the PC5 QoS parameters for ProSe from the PCF.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.2.3.2",
        "clause_4.2.3.3",
        "clause_6.6.2",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.4",
      "section_id": "6.6.4",
      "section_title": "N2 Handover procedure",
      "content": "The N2 based handover procedures for UE are performed as defined in TS 23.502 [5] clause 4.9.1.3 with the following additions:\n-\tIf the UE is authorised to use ProSe services, then the target AMF shall send the \"ProSe authorised\" information, ProSe NR UE-PC5-AMBR and PC5 QoS parameters for ProSe to the target NG-RAN in the NGAP Handover Request message.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.9.1.3",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.5",
      "section_id": "6.6.5",
      "section_title": "Xn Handover procedure",
      "content": "The Xn based handover procedures for UE are performed as defined in TS 23.502 [5] clause 4.9.1.2 with the following additions:\n-\tIf the \"ProSe authorised\" information is included in the UE context, then the source NG-RAN shall include a \"ProSe authorised\" information, ProSe NR UE-PC5-AMBR and PC5 QoS parameters for ProSe in the XnAP Handover Request message to the target NG-RAN.\n-\tIf the \"ProSe authorised\" information is included in the UE context, then the AMF shall send the \"ProSe authorised\" information, the ProSe NR UE-PC5-AMBR and PC5 QoS parameters for ProSe to the target NG-RAN in the Path Switch Request Acknowledge message.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.9.1.2",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.6",
      "section_id": "6.6.6",
      "section_title": "Subscriber Data Update Notification to AMF",
      "content": "The procedure of Subscriber Data Update Notification to AMF is performed as defined in TS 23.502 [5] clause 4.5.1 with the following additions:\n-\tThe Nudm_SDM_Notification service operation may contain the ProSe Service Authorisation or the ProSe NR UE-PC5-AMBR or any combination.\n-\tThe AMF updates the UE Context with the above new ProSe subscription data.\n-\tWhen the AMF updates UE context stored at NG-RAN, the UE context contains the ProSe subscription data.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.5.1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.6.7",
      "section_id": "6.6.7",
      "section_title": "Delivery of PC5 QoS parameters for ProSe to NG-RAN",
      "content": "The UE Policy Association Establishment procedure and UE Policy Association Modification procedure, as defined in TS 23.502 [5], is used to provide the AMF with PC5 QoS parameters used by NG-RAN. When receiving the 5G ProSe Capability in Npcf_UEPolicyControl_Create Request from the AMF or when receiving the updated subscription data from UDR, the PCF generates the PC5 QoS parameters used by NG-RAN corresponding to a UE as defined in clause 5.4.2 of TS 23.287 [2].\nThe (V-)PCF provides the information to the AMF as follows:\n-\tIn the roaming case, the H-PCF includes the PC5 QoS parameters used by NG-RAN in the Npcf_UEPolicyControl_Create Response message or Npcf_UEPolicyControl UpdateNotify Request message sent to V-PCF in an N2 PC5 policy container and V-PCF relays this N2 PC5 policy container as the N2 container in the Namf_Communication_N1N2MessageTransfer message sent to AMF.\n-\tIn the non-roaming case, the PCF includes the PC5 QoS parameters used by NG-RAN in an N2 container in Namf_Communication_N1N2MessageTransfer message sent to AMF.\nWhen the AMF receives the N2 PC5 policy container from (V-)PCF, the AMF stores such information as part of the UE context.\nIn the UE Configuration Update procedure triggered by UE Policy Association Establishment or UE Policy Association Modification:\n-\tThe AMF forwards the PC5 QoS parameters in the NGAP message to the NG-RAN if a N2 PC5 policy container is received in the Namf_Communication_N1N2MessageTransfer message.\nNOTE 1:\tIf the PC5 QoS parameters are provided to both NG-RAN and UE, both the N2 PC5 Policy Container and the UE Policy Container are included in the Namf_Communication_N1N2MessageTransfer message.\nNOTE 2:\tNon-UE specific PC5 QoS parameters, e.g. default PC5 QoS parameters, can also be locally configured in NG-RAN. How such configuration is performed is out of scope of this specification.",
      "chunk_type": "parameter",
      "cross_references": [
        "ts_23.287_clause_5.4.2",
        "ts_23.502",
        "ts_23.287"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.1.1",
      "section_id": "6.7.1.1",
      "section_title": "Layer-2 link establishment for PC5 communication via 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "Figure 6.7.1.1-1 shows the procedure for Layer-2 link establishment via 5G ProSe Layer-3 UE-to-UE Relay.\nFigure 6.7.1.1-1: Layer-2 link establishment via 5G ProSe Layer-3 UE-to-UE Relay\n1.\tService authorization and provisioning are performed for source 5G ProSe Layer-3 End UE, target 5G ProSe Layer-3 End UE and 5G ProSe Layer-3 UE-to-UE Relay as described in clause 6.2.\n2.\tThe source 5G ProSe Layer-3 End UE performs discovery of a 5G ProSe Layer-3 UE-to-UE Relay as described in clause 6.3.2.4.\n3.\tThe source 5G ProSe Layer-3 End UE sends a Direct Communication Request message to initiate the unicast Layer-2 link establishment procedure with the 5G ProSe Layer-3 UE-to-UE Relay. The parameters included in the Direct Communication Request message are described in clause 6.4.3.7.\nThe Source Layer-2 ID of the Direct Communication Request message is self-assigned by the source 5G ProSe Layer-3 End UE and the Destination Layer-2 ID is set to the Source Layer-2 ID of the discovery message of the 5G ProSe Layer-3 UE-to-UE Relay.\nThe source 5G ProSe Layer-3 End UE gets application information and optional ProSe Application Requirements from ProSe application layer, and determines the end-to-end QoS parameters as described in clause 5.6.3.1.\n4.\tIf the User Info ID of 5G ProSe Layer-3 UE-to-UE Relay in the Direct Communication Request message matches the 5G ProSe UE-to-UE Relay's User Info ID and the RSC in the Direct Communication Request matches one RSC that the relay is (pre)configured with, as specified in clause 5.1.5.1, the 5G ProSe Layer-3 UE-to-UE Relay responds by establishing the security with the source 5G ProSe Layer-3 End UE. When the security protection is enabled, the source 5G ProSe Layer-3 End UE sends the parameters as described in clause 6.4.3.7 to the 5G ProSe Layer-3 UE-to-UE Relay.\nIf the Ethernet MAC address of source 5G ProSe Layer-3 End UE is already used by another 5G ProSe Layer-3 End UE, then the 5G ProSe Layer-3 UE-to-UE Relay rejects the direct link establishment indicating that the MAC address is not unique.\nThe Source Layer-2 ID used for the security establishment procedure is self-assigned by the 5G ProSe Layer-3 UE-to-UE Relay and the Destination Layer-2 ID is set to the Source Layer-2 ID of the received Direct Communication Request message.\nThe 5G ProSe Layer-3 UE-to-UE Relay shall choose different Source Layer-2 IDs for PC5 links of different types of traffic, i.e., IP traffic, Ethernet traffic and Unstructured traffic.\nIf the PC5 link is used for transferring Unstructured traffic, the 5G ProSe Layer-3 UE-to-UE Relay shall choose different Source Layer-2 IDs for different pair of source and target 5G ProSe Layer-3 End UEs.\nUpon receiving the security establishment procedure messages, the source 5G ProSe Layer-3 End UE obtains the 5G ProSe Layer-3 UE-to-UE Relay's Layer-2 ID for future communication, for signalling and data traffic for this unicast link.\n5.\tAfter the Security Establishment procedure in step 4 is completed, the 5G ProSe Layer-3 UE-to-UE Relay decides whether to use an existing unicast Layer-2 link between itself and the target 5G ProSe End UE for the required service. If there is no existing unicast Layer-2 link of the required RSC with the target 5G ProSe Layer-3 End UE, the 5G ProSe Layer-3 UE-to-UE Relay sends a Direct Communication Request message to initiate the unicast Layer-2 link establishment procedure with the target 5G ProSe Layer-3 End UE. The parameters included in the Direct Communication Request message are described in clause 6.4.3.7.\nThe Source Layer-2 ID of the Direct Communication Request message is self-assigned by the 5G ProSe Layer-3 UE-to-UE Relay and the Destination Layer-2 ID may be broadcast or unicast Layer-2 ID. Unicast Layer-2 ID is used only if the Layer-2 ID of the target 5G ProSe Layer-3 End UE associated with the user info (i.e. Application Layer ID) is known to the 5G ProSe Layer-3 UE-to-UE Relay.\nThe 5G ProSe Layer-3 UE-to-UE Relay shall choose different Source Layer-2 IDs for PC5 links of different types of traffic, i.e., IP traffic, Ethernet traffic and Unstructured traffic.\nIf the PC5 link is used for transferring Unstructured traffic, the 5G ProSe Layer-3 UE-to-UE Relay shall choose different Source Layer-2 IDs for different pair of source and target 5G ProSe Layer-3 End UEs.\n6.\tIf the RSC included in the Direct Communication Request matches the target UE's RSC that the target UE is (pre)configured with as specified in clause 5.1.5.1 and if the user info included in the Direct Communication Request matches the target UE's user info, the target 5G ProSe Layer-3 End UE responds by establishing the security with the 5G ProSe Layer-3 UE-to-UE Relay. When the security protection is enabled, the 5G ProSe Layer-3 UE-to-UE Relay sends the parameters as described in clause 6.4.3.7 to the target 5G ProSe Layer-3 End UE.\nThe Source Layer-2 ID used for the security establishment procedure is self-assigned by the target 5G ProSe Layer-3 End UE and the Destination Layer-2 ID is set to the Source Layer-2 ID of the received Direct Communication Request message.\nUpon receiving the security establishment procedure messages, the 5G ProSe Layer-3 UE-to-UE Relay obtains the target 5G ProSe Layer-3 End UE's Layer-2 ID for future communication, for signalling and data traffic for this unicast link.\n7.\tThe target 5G ProSe Layer-3 End UE sends a Direct Communication Accept message to the 5G ProSe Layer-3 UE-to-UE Relay that has successfully established security with. The parameters included in the Direct Communication Accept message are described in clause 6.4.3.7.\nNOTE:\tThe 5G ProSe Layer-3 UE-to-UE Relay can detect that the Ethernet MAC address of target 5G ProSe Layer-3 End UE is already used by another 5G ProSe Layer-3 End UE when it receives the Direct Communication Accept message.\n8.\tFor IP traffic, IPv6 prefix or IPv4 address is allocated for the target 5G ProSe Layer-3 End UE as defined in clause 5.5.1.4.\n9.\tAfter receiving the Direct Communication Accept message from the target 5G ProSe Layer-3 End UE, the 5G ProSe Layer-3 UE-to-UE Relay sends a Direct Communication Accept message to the source 5G ProSe Layer-3 End UE that has successfully established security with. The parameters included in the Direct Communication Accept message are described in clause 6.4.3.7.\n10.\tFor IP traffic, IPv6 prefix or IPv4 address is allocated for the source 5G ProSe Layer-3 End UE as defined in clause 5.5.1.4.\n11.\tFor IP communication, the 5G ProSe Layer-3 UE-to-UE Relay may store an association of user info (i.e. Application Layer ID) and the IP address of target 5G ProSe Layer-3 End UE into its DNS entries and the 5G ProSe Layer-3 UE-to-UE Relay may act as a DNS server to other UEs. The source 5G ProSe Layer-3 End UE may send a DNS query to the 5G ProSe Layer-3 UE-to-UE Relay to request IP address of target 5G ProSe Layer-3 End UE after step 10 if the IP address of target 5G ProSe Layer-3 End UE is not received in step 9 and the 5G ProSe Layer-3 UE-to-UE Relay returns the IP address of the target 5G ProSe Layer-3 End UE to the source 5G ProSe Layer-3 End UE.\nWhen handling DNS query, the 5G ProSe Layer-3 UE-to-UE Relay should only use the DNS entry associated to the related RSC, i.e. the UE-to-UE Relay determines the RSC based on local information (e.g. link profile including RSC, Layer-2 ID, User Info, etc.) corresponding to the PC5 link that the DNS query message is received.\nFor Ethernet communication, the 5G ProSe Layer-3 UE-to-UE Relay maintains the association between PC5 links and Ethernet MAC addresses received from the 5G ProSe Layer-3 End UE.\nFor Unstructured traffic communication, for each pair of source and target 5G ProSe Layer-3 End UEs, the 5G ProSe Layer-3 UE-to-UE Relay maintains the 1:1 mapping between the PC5 link with source 5G ProSe Layer-3 End UE and the PC5 link with target 5G ProSe Layer-3 End UE.\n12.\tThe source 5G ProSe Layer-3 End UE communicates with the target 5G ProSe Layer-3 End UE via the 5G ProSe Layer-3 UE-to-UE Relay.\nIn the case of one source 5G ProSe Layer-3 End UE communicates with multiple target 5G ProSe Layer-3 End UEs, the PC5 link between the source 5G ProSe Layer-3 End UE and the 5G ProSe Layer-3 UE-to-UE Relay can be shared for multiple target 5G ProSe Layer-3 End UEs per RSC while the PC5 links may be established individually between the 5G ProSe Layer-3 UE-to-UE Relay and target 5G ProSe Layer-3 End UEs per RSC. For the shared PC5 link, the Layer-2 link modification procedure shall be used, replacing the step 3 to 4 and 9 to 10 of the procedure in Figure 6.7.1.1-1. The parameters used in the Layer-2 link modification procedure are described in clause 6.4.3.7.\nIn the case of multiple source 5G ProSe Layer-3 End UEs communicate with one target 5G ProSe Layer-3 End UE, the PC5 link between the 5G ProSe Layer-3 UE-to-UE Relay and the target 5G ProSe Layer-3 End UE can be shared per RSC while the PC5 links may be established individually between the source 5G ProSe Layer-3 End UEs and the 5G ProSe Layer-3 UE-to-UE Relay per RSC. For the shared PC5 link, the Layer-2 link modification procedure shall be used, replacing the step 5 to 8 of the procedure in Figure 6.7.1.1-1. The parameters used in the Layer-2 link modification procedure are described in clause 6.4.3.7.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2",
        "clause_6.3.2.4",
        "clause_6.4.3.7",
        "clause_5.6.3.1",
        "clause_5.1.5.1",
        "clause_5.5.1.4",
        "figure_6.7.1.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.1.2",
      "section_id": "6.7.1.2",
      "section_title": "Link identifier update for PC5 communication via 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "The Link Identifier Update procedure as defined in clause 6.4.3.2 is reused between source 5G ProSe Layer-3 End UE and 5G ProSe Layer -3 UE-to-UE Relay to perform a link identifier update. When the IP address/prefix is changed, the new one is shared between source 5G ProSe Layer-3 End UE and target 5G ProSe Layer-3 End UE as depicted in Figure 6.7.1.2-1.\nFigure 6.7.1.2-1: Link Identifier Update and IP address/prefix sharing via 5G ProSe Layer-3 UE-to-UE Relay\n0.\tA PC5 link is established between a source 5G ProSe Layer-3 End UE (i.e. UE1) and a 5G ProSe Layer-3 UE-to-UE Relay (i.e. UE-to-UE Relay). Another PC5 link is established between the UE-to-UE Relay and the target 5G ProSe Layer-3 End UE (i.e. UE2). IP data may be exchanged between UE1 and UE2 via the UE-to-UE Relay over the PC5 links. During the link establishment, UE1 informs the UE-to-UE Relay that the link requires privacy.\n1.\tAs stated in clause 6.4.3.2, according to the privacy requirement, UE1 may trigger link identifier update procedure. UE1 sends a Link Identifier Update Request message to the UE-to-UE Relay including the following parameters:\n-\tits new Layer-2 ID, new security information, new Application layer ID (if provided by the upper layer).\n-\tIf UE1's IP address/prefix needs to be changed:\n-\tif UE 1's IP address/prefix is allocated by the UE-to-UE Relay, UE1 includes \"new IP address needed\" indication.\n-\tif UE1 self-assign its IP address/prefix, UE1 includes its new IP address/prefix.\n-\tits peer UEs information (e.g. UE2's IP address, UE2's Application layer ID), allowing the UE-to-UE Relay to inform UE1's peer UEs (e.g. UE2) about UE1's new allocated IP address/prefix.\n2.\tUE-to-UE Relay self-assigns a new L2 ID, new security information and possibly new IP address/prefix for PC5 link with UE1.\na.\tIf a \"new IP address needed\" indication is received, UE-to-UE Relay assigns a new IP address/prefix to UE1 and saves it locally.\nBased on peer UE's information, UE-to-UE Relay then sends a PC5 Relay Update Request message to each peer UE (e.g. UE2), including: UE1's old IP address/prefix, UE1's old and new Application layer ID, UE1's new IP address/prefix.\n3.\tUE2 receives the PC5 Relay Update Request message and saves UE1's new IP address/prefix. UE2 sends a PC5 Relay Update Response message to the UE-to-UE Relay including all parameters received on the PC5 Relay Update Request message.\nUE2 continues to receive IP data with UE1's old IP address (transit packets sent prior to UE1's receiving its new IP address) until an IP packet using UE1's new IP address is received. At this point, UE2 starts using UE1's new IP address and may forget UE1's old IP address.\n4.\tUE-to-UE Relay sends a Link Identifier Update Response message to UE1 including UE1's new IP address/prefix, UE-to-UE Relay's new Layer-2 ID, new security information and possibly new IP address/prefix and/or new Application layer ID.\n5.\tUE1 saves its new IP address/prefix and UE-to-UE Relay's new parameters and sends a Link Identifier Update ACK message to the UE-to-UE Relay, including its new IP address received on the Link Identifier Update Response message. UE1 and UE-to-UE Relay start using the new Layer-2 IDs and new security information for PC5 communication. UE1 starts using its new IP address for IP data exchange with UE2.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_6.4.3.2",
        "figure_6.7.1.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.1.3",
      "section_id": "6.7.1.3",
      "section_title": "Layer-2 link release for PC5 communication via 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "Figure 6.7.1.3-1 shows the Layer-2 link release procedure via 5G ProSe Layer-3 UE-to-UE Relay.\nFigure 6.7.1.3-1: Layer-2 Link Release procedure via 5G ProSe Layer-3 UE-to-UE Relay\n0.\tThe source 5G ProSe Layer-3 End UE and the 5G ProSe Layer-3 UE-to-UE Relay and the 5G ProSe Layer-3 UE-to-UE Relay and the target 5G ProSe Layer-3 End UE have a unicast link established as described in clause 6.7.1.1.\n1.\tThe source 5G ProSe Layer-3 End UE sends a Disconnect Request message to the 5G ProSe Layer-3 UE-to-UE Relay in order to release the layer-2 link and deletes all context data associated with the layer-2 link.\n2.\tUpon reception of the Disconnect Request message, the 5G ProSe Layer-3 UE-to-UE Relay shall respond with a Disconnect Response and deletes all context data associated with the layer-2 link.\n3a.\tUpon reception of the Disconnect Request message, the 5G ProSe Layer-3 UE-to-UE Relay sends a Disconnect Request message to the target 5G ProSe Layer-3 End UE(s), which has a unicast link for the communication with the source 5G ProSe Layer-3 End UE if there are no other UEs using the layer-2 link.\n4a.\tUpon reception of the Disconnect Request message, the target 5G ProSe Layer-3 End UE shall respond with a Disconnect Response message.\n3b.\tUpon reception of the Disconnect Request message, the 5G ProSe Layer-3 UE-to-UE Relay sends a Link Modification Request message to the target 5G ProSe Layer-3 End UE(s), which has a unicast link for the communication with the source 5G ProSe Layer-3 End UE if there are other UEs using the layer-2 link in order to release the PC5 QoS Flow(s) and deletes the context data associated with the PC5 QoS Flow(s).\n4b.\tUpon reception of the Link Modification Request message, the target 5G ProSe Layer-3 End UE shall respond with a Link Modification Accept message and deletes the context data associated with the PC5 QoS Flow(s) used for the communication with the source 5G ProSe Layer-3 End UE.\nThe ProSe layer of the 5G ProSe Layer-3 UE-to-UE Relay and the target 5G ProSe Layer-3 End UE provides information about the unicast link modification to the AS layer, which enables the AS layer to update the context related to the modified unicast link.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.1.1",
        "figure_6.7.1.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.1.4",
      "section_id": "6.7.1.4",
      "section_title": "Layer-2 link modification for PC5 communication via 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "Figure 6.7.1.4-1 shows the Layer-2 link modification procedure via Layer-3 UE-to-UE Relay. This procedure is used to add/modify/remove PC5 QoS Flow(s) in the existing PC5 unicast link as described in clause 6.4.3.7.3.\nFigure 6.7.1.4-1: Layer-2 link modification procedure via Layer-3 UE-to-UE Relay\n0.\tUE-1 and UE-to-UE Relay and UE-to-UE Relay and UE-2 have a unicast link established as described in clause 6.7.1.1.\n1.\tUE-1 sends a Link Modification Request to UE-to-UE Relay as described in clause 6.4.3.7.3.\n2.\tUpon reception of the Link Modification Request message from UE-1, the UE-to-UE Relay sends a Link Modification Request to UE-2 as described in clause 6.4.3.7.3.\n3.\tUE-2 responds with a Link Modification Accept message to the UE-to-UE Relay as described in clause 6.4.3.7.3.\n4.\tUpon reception of the Link Modification Accept message from UE-2, the UE-to-UE Relay responds with a Link Modification Accept message to the UE-1 as described in clause 6.4.3.7.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3.7.3",
        "clause_6.7.1.1",
        "figure_6.7.1.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.1.5",
      "section_id": "6.7.1.5",
      "section_title": "Layer-2 link maintenance for PC5 communication via 5G ProSe Layer-3 UE-to-UE Relay",
      "content": "The Layer-2 link maintenance over the PC5 reference point procedure as described in clause 6.4.3.5 can be used for the Layer-2 link established between the source 5G ProSe Layer-3 End UE and the 5G ProSe Layer-3 UE-to-UE Relay and between the 5G ProSe Layer-3 UE-to-UE Relay and the target 5G ProSe Layer-3 End UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4.3.5"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.2",
      "section_id": "6.7.2",
      "section_title": "5G ProSe Communication via 5G ProSe Layer-2 UE-to-UE Relay",
      "content": "This procedure applies to 5G ProSe Layer-2 UE-to-UE Relay.\nFigure 6.7.2-1: 5G ProSe Communication via 5G ProSe Layer-2 UE-to-UE Relay\nService authorization and provisioning has been performed for the 5G ProSe Layer-2 UE-to-UE Relay and the 5G ProSe End UEs as described in clause 6.2 before this procedure.\n1.\tModel A or Model B 5G ProSe UE-to-UE Relay Discovery as described in clause 6.3.2.4 is performed and a source 5G ProSe End UE selects a suitable 5G ProSe Layer-2 UE-to-UE Relay for the communication with a target 5G ProSe End UE.\n2.\tThe source 5G ProSe End UE decides whether to use an existing PC5 link with the 5G ProSe UE-to-UE Relay for the required service. If an existing PC5 link is used then the Layer-2 link modification procedure as specified in clause 6.4.3.7 is used towards a 5G ProSe UE-to-UE Relay, otherwise a Layer-2 link establishment procedure is used towards a 5G ProSe UE-to-UE Relay.\nThis procedure is towards the selected 5G ProSe UE-to-UE Relay and for Layer-2 link establishment, the security establishment is performed before step 3 is initiated.\nNOTE:\tThe source 5G ProSe Layer-2 End UE does not initiate any Layer-2 link establishment or Layer-2 link modification procedure towards the same 5G ProSe Layer-2 UE-to-UE Relay for a different target 5G ProSe Layer-2 End UE unless the current Layer-2 link establishment or Layer-2 link modification procedure has been completed including reception of the PC5-RRC message from the 5G ProSe Layer-2 UE-to-UE Relay as specified in TS 38.300 [12]. Therefore, the source 5G ProSe Layer-2 End UE can recognize the target 5G ProSe Layer-2 End UE of the Layer-2 ID provided by the 5G ProSe Layer-2 UE-to-UE Relay.\n3.\tThe 5G ProSe Layer-2 UE-to-UE Relay decides whether to use an existing PC5 link between the 5G ProSe UE-to-UE Relay and the target 5G ProSe End UE for the required service and initiates Layer-2 link establishment procedure or Layer-2 link modification procedure as specified in clause 6.4.3.7 with the target 5G ProSe End UE.\nIf the Layer-2 link establishment procedure is performed towards the target 5G ProSe End UE then either a broadcast or a unicast Layer-2 ID is used as the Destination Layer-2 ID. A Unicast Layer-2 ID is used if the Layer-2 ID of the target 5G ProSe Layer-2 End UE associated with the user info (i.e. Application Layer ID) of target 5G ProSe Layer-2 End UE is known to the 5G ProSe Layer-2 UE-to-UE Relay.\nIf the Layer-2 link modification procedure is performed towards the target 5G ProSe End UE, it uses the unicast Layer-2 ID of target 5G ProSe End UE as the Destination Layer-2 ID.\nThe 5G ProSe Layer-2 UE-to-UE Relay sends a Direct Communication Accept message or Link Modification Accept message to the source 5G ProSe End UE after step 3 is completed.\n4.\tThe source 5G ProSe End UE establishes an end-to-end connection for unicast mode communication with the target 5G ProSe End UE as described in clause 6.4.3.7.\nThe data and End-to-End PC5-S signalling are transferred between the source 5G ProSe End UE and the target 5G ProSe End UE via the 5G ProSe Layer-2 UE-to-UE Relay. The 5G ProSe Layer-2 UE-to-UE Relay forwards all the data traffic and End-to-End PC5-S signalling between the source 5G ProSe End UE and the target 5G ProSe End UE, as specified in TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2",
        "clause_6.3.2.4",
        "clause_6.4.3.7",
        "table_5",
        "figure_6.7.2-1",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.3.1",
      "section_id": "6.7.3.1",
      "section_title": "General",
      "content": "5G ProSe Communication via 5G ProSe UE-to-UE Relay with integrated Discovery is supported.\nFor 5G ProSe UE-to-UE Relay Communication with integrated Discovery, when a UE allows a UE-to-UE relay to be involved in the Direct Communication Request to the other UE, the UE indicates it by including a relay_indication in the broadcasted Direct Communication Request message.\nWhen a UE-to-UE relay receives a Direct Communication Request including a relay_indication, it decides whether to send a Direct Communication Request message including its own User Info according to e.g. Relay Service Code if there is any, ProSe Service Info, operator policy per Relay Service Code, signal strength and local policy.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_6.7.3.2",
      "section_id": "6.7.3.2",
      "section_title": "Procedure for Communication via Layer-3 UE-to-UE Relay",
      "content": "Figure 6.7.3.2-1: 5G ProSe UE-to-UE Relay Communication with integrated Discovery via Layer-3 UE-to-UE Relay\n0.\t5G ProSe End UEs are authorized and provisioned with parameters to use the service provided by the 5G ProSe UE-to-UE Relays. 5G ProSe UE-to-UE Relays are authorized and provisioned with parameters to provide service of relaying traffic among 5G ProSe End UEs.\n1.\tThe source 5G ProSe End UE (i.e. UE-1) wants to establish a unicast communication with the target 5G ProSe End UE (i.e. UE-2) and broadcasts a Direct Communication Request. The parameters included in the Direct Communication Request message are described in clause 6.4.3.7.\nThe relay_indication in the Direct Communication Request is used to indicate whether 5G ProSe UE-to-UE Relay can forward the Direct Communication Request message (i.e. send a Direct Communication Request based on the received Direct Communication Request message) or not. It is also used to limit the number of hops of 5G ProSe UE-to-UE Relay by removing relay_indication in the Direct Communication Request message from the 5G ProSe UE-to-UE Relay.\nThe Source Layer-2 ID and Destination Layer-2 ID used for the Direct Communication Request message are defined in clause 5.8.5.\nThe source 5G ProSe End UE gets application information and optional ProSe Application Requirements from ProSe application layer, and determines the end-to-end QoS parameters as described in clause 5.6.3.1.\nNOTE 1:\tThe data type of relay_indication can be determined in Stage 3.\n2.\tWhen receiving Direct Communication Request with relay_indication from UE-1, the 5G ProSe UE-to-UE Relay (i.e. Relay-1 and Relay-2) may decide to participate in the procedure and broadcast a Direct Communication Request message in its proximity without relay_indication. The parameters included in the Direct Communication Request message are described in clause 6.4.3.7.\nThe Source Layer-2 ID and Destination Layer-2 ID used for the Direct Communication Request message are defined in clause 5.8.5.\n3.\tWhen UE-2 receives a Direct Communication Request from one or multiple 5G ProSe UE-to-UE Relays, UE-2 select a 5G ProSe UE-to-UE Relay which UE-2 will respond. UE-2 may select the 5G ProSe UE-to-UE Relay according to e.g. the signal strength, local policy, operator policy per Relay Service Code if any.\n4.\tThe security establishment happens between UE-2 and the selected 5G ProSe UE-to-UE Relay (here Relay-1), if needed.\nIf the existing PC5 link can be reused, Link Modification Request and Link Modification Accept messages are used.\nNOTE 2:\tThe conflict between Link Modification Request and Direct Communication Request can be determined in Stage 3.\n5.\tUE-2 replies Direct Communication Accept message to Relay-1. The parameters included in the Direct Communication Accept message are described in clause 6.4.3.7.\n6.\tFor IP traffic, IPv6 prefix or IPv4 address is allocated for the target 5G ProSe Layer-3 End UE as defined in clause 5.5.1.4.\n7.\tSecurity establishment happens between UE-1 and Relay-1, if needed.\n8.\tFor 5G ProSe UE-to-UE Relay Communication with integrated Discovery, after receiving QoS Info of the end-to-end QoS from UE-1, Relay-1 provides the QoS info of the second hop QoS to UE-2 with Link Modification Request message.\n9.\tFor 5G ProSe UE-to-UE Relay Communication with integrated Discovery, UE-2 responds with a Link Modification Accept message.\n10.\tRelay-1 responds with Direct Communication Accept to the UE-1. The parameters included in the Direct Communication Accept message are described in clause 6.4.3.7.\n11.\tFor IP traffic, IPv6 prefix or IPv4 address is allocated for the source 5G ProSe Layer-3 End UE as defined in clause 5.5.1.4.\n12.\tFor IP communication, the 5G ProSe Layer-3 UE-to-UE Relay may store an association of user info (i.e. Application Layer ID) and the IP address of target 5G ProSe Layer-3 End UE into its DNS entries and the 5G ProSe Layer-3 UE-to-UE Relay may act as a DNS server to other UEs. The source 5G ProSe Layer-3 End UE may send a DNS query to the 5G ProSe Layer-3 UE-to-UE Relay to request IP address of target 5G ProSe Layer-3 End UE after step 11 if the IP address of target 5G ProSe Layer-3 End UE is not received in step 10 and the 5G ProSe Layer-3 UE-to-UE Relay returns the IP address of the target 5G ProSe Layer-3 End UE to the source 5G ProSe Layer-3 End UE.\nFor Ethernet communication, the 5G ProSe Layer-3 UE-to-UE Relay is acting as an Ethernet switch by maintaining the association between PC5 links and Ethernet MAC addresses received from the 5G ProSe Layer-3 End UE.\nFor Unstructured traffic communication, for each pair of source and target 5G ProSe Layer-3 End UEs, the 5G ProSe Layer-3 UE-to-UE Relay maintains the 1:1 mapping between the PC5 link with source 5G ProSe Layer-3 End UE and the PC5 link with target 5G ProSe Layer-3 End UE.\nThe source 5G ProSe Layer-3 End UE communicates with the target 5G ProSe Layer-3 End UE via the 5G ProSe Layer-3 UE-to-UE Relay.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.4.3.7",
        "clause_5.8.5",
        "clause_5.6.3.1",
        "clause_5.5.1.4",
        "figure_6.7.3.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.3.3",
      "section_id": "6.7.3.3",
      "section_title": "Procedure for Communication via Layer-2 UE-to-UE Relay",
      "content": "Figure 6.7.3.3-1: 5G ProSe UE-to-UE Relay Communication with integrated Discovery via Layer-2 UE-to-UE Relay\n0-5.\tIt is the same as steps 0-5 of Figure 6.7.3.2-1.\n6.\tIt is the same as step 7 of Figure 6.7.3.2-1.\n7.\tIt is the same as step 10 of Figure 6.7.3.2-1.\nThe parameters included in the above messages are described in clause 6.4.3.7.4.\n8.\tFor 5G ProSe UE-to-UE Relay Communication via Layer-2 UE-to-UE Relay, UE-1 establishes an end-to-end connection for unicast mode communication with UE-2.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.4.3.7.4",
        "figure_6.7.3.3-1",
        "figure_6.7.3.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.4.1",
      "section_id": "6.7.4.1",
      "section_title": "General",
      "content": "After being connected to the 5G ProSe UE-to-UE Relay, the 5G ProSe End UEs may trigger the 5G ProSe UE-to-UE Relay reselection based on conditions (e.g. the measured signal strength of PC5 unicast link with the 5G ProSe UE-to-UE Relay) as specified in TS 38.300 [12].\nFor 5G ProSe UE-to-UE Relay reselection, a 5G ProSe UE-to-UE Relay may be discovered by either the discovery procedures defined in clause 6.3.2.4 or by the negotiated 5G ProSe UE-to-UE Relay reselection procedure defined in clause 6.7.4.2 or clause 6.7.4.3.\nIn the negotiated UE-to-UE Relay reselection defined in clause 6.7.4.2 or clause 6.7.4.3, one 5G ProSe End UE initiates the UE-to-UE Relay reselection procedure, the 5G ProSe End UEs can negotiate a new 5G ProSe UE-to-UE Relay using the existing connection and to establish the communication via the reselected 5G ProSe UE-to-UE Relay prior to releasing the communication via the current 5G ProSe UE-to-UE Relay.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.3.2.4",
        "clause_6.7.4.2",
        "clause_6.7.4.3",
        "ts_38.300"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.4.2",
      "section_id": "6.7.4.2",
      "section_title": "Negotiated 5G ProSe Layer-2 UE-to-UE Relay reselection",
      "content": "Depicted in Figure 6.7.4.2-1 is the procedure for the negotiated 5G ProSe Layer-2 UE-to-UE Relay reselection.\nFigure 6.7.4.2-1: Negotiated 5G ProSe Layer-2 UE-to-UE Relay reselection\n1.\tA PC5 unicast link is established between the 5G ProSe End UEs via a 5G ProSe UE-to-UE Relay, based on the procedure defined in clause 6.7.2.\n2.\tThe initiating 5G ProSe End UE determines, e.g. based on PC5 signal strength, to perform UE-to-UE Relay reselection and obtains a list of candidate UE-to-UE Relays per RSC. The initiating 5G ProSe End UE may receive UE-to-UE Relay Discovery Announcement messages from 5G ProSe UE-to-UE Relays or initiate the 5G ProSe UE-to-UE Relay discovery procedures to find the candidate 5G ProSe UE-to-UE Relays. The initiating 5G ProSe End UE determines the candidate 5G ProSe UE-to-UE Relays e.g., based on the PC5 signal strength of the received UE-to-UE Relay Discovery Announcement message, RSC within the UE-to-UE Relay Discovery Announcement message. The candidate 5G ProSe UE-to-UE Relays support the same RSC which is associated with the PC5 unicast link between the initiating 5G ProSe End UE and the 5G ProSe UE-to-UE Relay.\n3.\tThe initiating 5G ProSe End UE sends a Link Modification Request message to the responding 5G ProSe End UE which includes a Relay re-selection indication, the User Info ID(s) of the candidate 5G ProSe UE-to-UE Relay(s) and optionally the Layer-2 ID(s) of the candidate 5G ProSe UE-to-UE Relay(s) and security information.\n4.\tThe responding 5G ProSe End UE selects a new 5G ProSe UE-to-UE Relay from the candidate 5G ProSe UE-to-UE Relays per RSC, based on the Relay re-selection indication in the Link Modification Request message. If the responding 5G ProSe End UE has not received a UE-to-UE Relay Discovery Announcement message from a candidate 5G ProSe UE-to-UE Relay (e.g. during a previous 5G ProSe UE-to-UE Relay Discovery procedure) or does not have a PC5 connection with the candidate 5G ProSe UE-to-UE Relay associated with the same RSC, then the responding 5G ProSe End UE may perform the Candidate 5G ProSe UE-to-UE Relay Discovery procedure defined in clause 6.3.2.4.4. The responding 5G ProSe End UE sets the candidate relay User Info ID to that of a candidate 5G ProSe UE-to-UE Relay in the discovery message and may set the Layer-2 ID of the candidate 5G ProSe UE-to-UE Relay, if received at step 3, as the Destination Layer-2 ID to carry the discovery message. The PC5 signal strength of the UE-to-UE Relay Discovery Announcement message or UE-to-UE Relay Discovery Response message may be used to select the new 5G ProSe UE-to-UE Relay.\n5.\tThe responding 5G ProSe End UE sends a Link Modification Accept message to the initating 5G ProSe End UE, including the User Info ID of the new 5G ProSe UE-to-UE Relay and security information.\n6.\t5G ProSe End UEs set up PC5 unicast links, if not already set up, with the new 5G ProSe UE-to-UE Relay, by reusing the procedure defined in clause 6.7.2 and the PC5 unicast is link established between 5G ProSe End UEs via the new 5G ProSe UE-to-UE Relay. The 5G ProSe End UEs switch the data traffic via the new 5G ProSe UE-to-UE Relay. The security information is used to verify that the new link has been set up successfully.\nNOTE 1:\tThe security information contents and usage will be defined by SA WG3.\nNOTE 2:\tWhether a 5G ProSe End UE releases a PC5 unicast link with the original 5G ProSe UE-to-UE Relay after reselection depends on whether the PC5 unicast link is still required and UE implementation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.2",
        "clause_6.3.2.4.4",
        "figure_6.7.4.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.7.4.3",
      "section_id": "6.7.4.3",
      "section_title": "Negotiated 5G ProSe Layer-3 UE-to-UE Relay reselection",
      "content": "Depicted in Figure 6.7.4.3-1 is the procedure for the negotiated 5G ProSe Layer-3 UE-to-UE Relay reselection.\nFigure 6.7.4.3-1: Negotiated 5G ProSe Layer-3 UE-to-UE Relay reselection\n1.\t5G ProSe End UEs have set up PC5 unicast links with a 5G ProSe UE-to-UE Relay, based on the procedure defined in clause 6.7.1.\n2.\tThe 5G ProSe End UEs have additionally set up PC5 unicast links with a 5G ProSe UE-to-UE Relay, based on the procedure defined in clause 6.7.1.\n3.\tThe 5G ProSe End UEs are transferring traffic via the 5G ProSe UE-to-UE Relay.\n4.\tThe initiating 5G ProSe End UE determines, e.g. based on PC5 signal strength, to perform UE-to-UE Relay reselection and obtains a list of candidate UE-to-UE Relays per RSC. The initiating 5G ProSe End UE may receive UE-to-UE Relay Discovery Announcement messages from 5G ProSe UE-to-UE Relays or initiate the 5G ProSe UE-to-UE Relay discovery procedures to find the candidate 5G ProSe UE-to-UE Relays. The initiating 5G ProSe End UE determines the candidate 5G ProSe UE-to-UE Relays e.g., based on the PC5 signal strength of the received UE-to-UE Relay Discovery Announcement message, RSC within the UE-to-UE Relay Discovery Announcement message. The candidate 5G ProSe UE-to-UE Relays support the same RSC which is associated with the PC5 unicast link between the initiating 5G ProSe End UE and the 5G ProSe UE-to-UE Relay.\n5.\tThe initiating 5G ProSe End UE sends a Link Modification Request message to the responding 5G ProSe UE-to-UE Relay, which includes a Relay re-selection indication, the User Info ID(s) of the candidate 5G ProSe UE-to-UE Relay(s), the IP addresses of the responding 5G ProSe End UEs and optionally the Layer-2 ID(s) of the candidate 5G ProSe UE-to-UE Relay(s).\nMultiple 5G ProSe End UEs IP addresses may be included when the initiating 5G ProSe End UE is communicating with multiple 5G ProSe End UEs via the 5G ProSe UE-to-UE Relay.\n6.\t5G ProSe UE-to-UE Relay determines the responding 5G ProSe End UE based on the IP address received from the initiating 5G ProSe End UE and sends a Link Modification Request message to the responding 5G ProSe End UE. The Link Modification Request message includes a Relay re-selection indication, User Info ID(s) of the candidate 5G ProSe UE-to-UE Relay(s), IP address of the initiating 5G ProSe End UE and optionally the Layer-2 ID(s) of the candidate 5G ProSe UE-to-UE Relay(s).\nIf multiple 5G ProSe End UEs are specified in the Link Modification Request message received from the initiating 5G ProSe End UE, the 5G ProSe UE-to-UE Relay sends a PC5 Link Modification Request to each of the 5G ProSe End UEs.\n7.\tThe responding 5G ProSe End UE selects a new 5G ProSe UE-to-UE Relay from the candidate 5G ProSe UE-to-UE Relays per RSC, based on the Relay re-selection indication in the Link Modification Request message. If the responding 5G ProSe End UE has not received a UE-to-UE Relay Discovery Announcement message from a candidate 5G ProSe UE-to-UE Relay (e.g. during a previous 5G ProSe UE-to-UE Relay Discovery procedure) or does not have a PC5 connection with the candidate 5G ProSe UE-to-UE Relay associated with the same RSC, then the responding 5G ProSe End UE may perform the Candidate 5G ProSe UE-to-UE Relay Discovery procedure defined in clause 6.3.2.4.4. The responding 5G ProSe End UE sets the candidate relay User Info ID to that of a candidate 5G ProSe UE-to-UE Relay in the discovery message and may set the Layer-2 ID of the candidate 5G ProSe UE-to-UE Relay, if received at step 6, as the Destination Layer-2 ID to carry the discovery message. The responding 5G ProSe End UE may initiate the procedure to set up PC5 unicast links with the new 5G ProSe UE-to-UE Relay, by reusing the procedure defined in clause 6.7.1. The PC5 signal strength of the UE-to-UE Relay Discovery Announcement message or UE-to-UE Relay Discovery Response message may be used to select the new 5G ProSe UE-to-UE Relay.\n8.\tThe responding 5G ProSe End UE sends a Link Modification Accept message to the 5G ProSe UE-to-UE Relay, including the User Info ID of the new 5G ProSe UE-to-UE Relay, IP address of the initiating 5G ProSe End UE, IP address of the responding 5G ProSe End UE for communication via the newly selected 5G ProSe UE-to-UE Relay and Relay re-selection indication.\n9.\t5G ProSe UE-to-UE Relay sends a Link Modification Accept message to the initating 5G ProSe End UE, including the User Info ID of the new 5G ProSe UE-to-UE Relay, IP address of the responding 5G ProSe End UE, IP address of the responding 5G ProSe End UE for communication via the newly selected 5G ProSe UE-to-UE Relay and Relay re-selection indication.\n10-11.\tLink Modification Ack is sent from the initating 5G ProSe End UE to the responding the 5G ProSe End UE via the 5G ProSE UE-to-UE Relay, including the IP address of the initiating 5G ProSe End UE for communication via the newly selected 5G ProSe UE-to-UE Relay, the IP address of the responding 5G ProSe End UE and Relay re-selection indication.\n12.\tThe 5G ProSe End UEs transfer traffic via the newly selected 5G ProSe UE-to-UE Relay.\nNOTE:\tWhether a 5G ProSe End UE releases a PC5 unicast link with the original 5G ProSe UE-to-UE Relay after reselection depends on whether the PC5 unicast link is still required and UE implementation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.1",
        "clause_6.3.2.4.4",
        "figure_6.7.4.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.8.1",
      "section_id": "6.8.1",
      "section_title": "Procedure for communication path switching from Uu reference point to PC5 reference point",
      "content": "Figure 6.8.1-1 depicts the procedure for communication path switching from Uu reference point to PC5 reference point.\nFigure 6.8.1-1: Procedure for communication path switching from Uu reference point to PC5 reference point\n1.\tUE-1 and UE-2 communicate with each other via Uu path, i.e. by using established PDU Sessions.\n2.\tUE-1 decides to perform path switching for ProSe service(s) from Uu path to PC5 path, e.g. because UE-1 and UE-2 are in proximity each other or for offloading some traffic from the network.\nNOTE 1:\tUE-1 can perform ProSe discovery to determine whether UE-2 is in proximity using the User Info of UE-2 provided by the application layer.\nUE-1 determines whether and which ProSe service(s) can be switched to PC5 path based on the path selection policy.\n3.\tUE-1 triggers the establishment of a PC5 unicast link by using the Layer-2 link establishment procedure as specified in clause 6.4.3.1. The PC5 unicast link is established including the ProSe service(s) that can be switched to PC5 path. If any Layer-2 link already established between UE-1 and UE-2 can be used for this path switching, the Layer-2 link modification as specified in clause 6.4.3.4 is used.\n4.\tTraffic for the ProSe service(s) is switched from Uu path to PC5 path.\n5a.\tUE-1 may release its PDU Session, e.g. if no traffic transmitted over the PDU Session, or modify its PDU Session, e.g. only part of the services is switched.\n5b.\tUE-2 may release its PDU Session, e.g. if no traffic transmitted over the PDU Session, or modify its PDU Session, e.g. only part of the services is switched.\nNOTE 2:\tSteps 5a and 5b can be executed in parallel.\nNOTE 3:\tAs an alternative to steps 5a and 5b, the UP connection of the relevant PDU Sessions can be deactivated as specified in clause 4.3.7 of TS 23.502 [5].",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.4.3.1",
        "clause_6.4.3.4",
        "ts_23.502_clause_4.3.7",
        "figure_6.8.1-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.8.2",
      "section_id": "6.8.2",
      "section_title": "Procedure for communication path switching from PC5 reference point to Uu reference point",
      "content": "Figure 6.8.2-1 depicts the procedure for communication path switching from PC5 reference point to Uu reference point.\nFigure 6.8.2-1: Procedure for communication path switching from PC5 reference point to Uu reference point\n1.\tUE-1 and UE-2 communicate with each other via PC5 path, i.e. by using the established PC5 unicast link between them.\n2.\tUE-1 decides to path switch ProSe service(s) from PC5 path to Uu path, e.g. if the PC5 signal strength of the unicast link with UE-2 reaches or below certain configured signal strength threshold.\nUE-1 determines whether and which ProSe service(s) can be switched to Uu path based on e.g. the availability of the Uu path, the path selection policy, etc.\nUE-1 sends a Path Switch Request message to UE-2 to negotiate the ProSe service(s) to be switched. UE-1 includes the ProSe service(s) that can be switched to Uu path in the Path Switch Request message.\nOptionally, UE-1 can decide the Uu QoS parameters of each UE based on PC5 QoS parameters for each ProSe service. UE-1 may include Uu QoS parameters used for UE-2's Uu path for the ProSe service(s) that can be switched to a Uu path in the Path Switch Request message.\n3.\tUE-2 responds with a Path Switch Response message.\nUE-2 determines whether and which ProSe service(s) can be switched to Uu path based on e.g., the path selection policy, availability of Uu path, etc.\nIf UE-2 accepts the path switch request from UE-1, UE-2 includes the accepted ProSe service(s) to be switched to Uu path in the Path Switch Response message from those indicated by UE-1. Otherwise, UE-2 rejects the path switch request with the appropriate cause (e.g. path switching to Uu path for the ProSe service(s) is not permitted, Uu path is not available) in the Path Switch Response message.\n4a.\tUE-1 may establish or modify PDU Session by using the PDU session establishment procedure as specified in clause 4.3.2 or the PDU session modification procedure as specified in clause 4.3.3 of TS 23.502 [5]. UE-1 may set the Requested QoS as the Uu QoS parameters used for UE-1's Uu path for the specific accepted ProSe service in the PDU Session Modification Request. The PDU Session needs to support QoS requirements for the ProSe service(s) to be switched from PC5 path.\n4b.\tUE-2 may establish or modify PDU Session by using the PDU session establishment procedure as specified in clause 4.3.2 or the PDU session modification procedure as specified in clause 4.3.3 of TS 23.502 [5]. UE-2 may set the Requested QoS as the Uu QoS parameters used for UE-2's Uu path for the specific accepted ProSe service in the PDU Session Modification Request. The PDU Session needs to support QoS requirements for the ProSe service(s) to be switched from PC5 path.\nNOTE 1:\tSteps 4a and 4b can be executed in parallel and step 4b can be performed before step 3.\n5.\tTraffic for the accepted ProSe service(s) is switched from PC5 path to Uu path.\n6.\tThe PC5 unicast link may be released, e.g. if no more ProSe services over the PC5 unicast link.\nNOTE 2:\tThe UEs can agree to maintain the PC5 unicast link after path switching from PC5 path to Uu path. In this case, the UEs can determine to switch back to PC5 path from Uu path based on e.g. the path selection policy, the PC5 signal level of the maintained unicast link (e.g. the measured link quality is good).\nNOTE 3:\tWhen the UEs cannot successfully exchange Path Switch Request/Response due to, e.g. the PC5 unicast link suddenly breaks, whether to perform path switching to Uu path is left to UE implementation.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.3.2",
        "ts_23.502_clause_4.3.3",
        "figure_6.8.2-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.9.1",
      "section_id": "6.9.1",
      "section_title": "General",
      "content": "This clause describes the procedures to support multi-path communication via direct Uu path and via 5G ProSe UE-to-Network Relay.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_6.9.2",
      "section_id": "6.9.2",
      "section_title": "Multi-path communication via direct Uu path and via 5G ProSe Layer-3 UE-to-Network Relay",
      "content": "When a 5G ProSe enabled UE accesses the network, if the UE decides to establish multi-path via direct Uu path and via the 5G ProSe Layer-3 UE-to-Network Relay without N3IWF based on \"ProSe Multi-path Preference\" in the selected RSD of the matched URSP rule for the application traffic as specified in clause 6.5.4, the following is performed:\n-\tThe UE may establish a new PDU Session as specified in clause 4.3.2 of TS 23.502 [5] or modify an existing PDU Session as specified in clause 4.3.3 of TS 23.502 [5] for the direct Uu path.\n-\tThe UE takes the role of 5G ProSe Layer-3 Remote UE either establishes 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay without N3IWF as specified in clause 6.5.1.1 or modifies an existing PC5 connection with a 5G ProSe Layer-3 UE-to-Network Relay as specified in clause 6.4.3.6.\nNOTE 1:\tHow to make use of the multi-path communication via direct Uu path and via a 5G ProSe Layer-3 UE-to-Network Relay for redundant or split traffic delivery is out of scope of this specifications.\nWhen a 5G ProSe enabled UE accesses the network, if the UE decides to establish multi-path via direct Uu path and via the 5G ProSe Layer-3 UE-to-Network Relay with N3IWF based on the \"multi-access\" Access Type of the selected RSD, the UE establishes a MA PDU Session as specified in clause 4.22 of TS 23.502 [5], the following is performed:\n-\tThe UE sets up path over Uu by establishing a MA PDU session using the procedures for 3GPP access in clause 4.22 of TS 23.502 [5].\n-\tThe UE taking the role of 5G ProSe Layer-3 Remote UE, if not connected and registered to the network via a Layer-3 UE-to-Network Relay with N3IWF, performs Relay (re)selection and performs registration with 5GC as specified in clause 6.5.1.2 and then performs MA PDU Session Establishment procedure or adds the user plane resources over the path via 5G ProSe Layer-3 UE-to-Network Relay with N3IWF using the procedures for non-3GPP access in clause 4.22 of TS 23.502 [5].\nNOTE 2:\tThe Remote UE may establish MA PDU session over the path via 5G ProSe Layer-3 UE-to-Network Relay with N3IWF before the direct Uu path. The sequence could be arbitrary.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.5.4",
        "ts_23.502_clause_4.3.2",
        "ts_23.502_clause_4.3.3",
        "clause_6.5.1.1",
        "clause_6.4.3.6",
        "ts_23.502_clause_4.22",
        "clause_6.5.1.2",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_6.9.3",
      "section_id": "6.9.3",
      "section_title": "Multi-path communication via direct Uu path and via 5G ProSe Layer-2 UE-to-Network Relay",
      "content": "Procedures for Multi-path communication via direct Uu path and via 5G ProSe Layer-2 UE-to-Network Relay is specified in TS 38.300 [12].\nIn the case that the direct Uu path and indirect path via 5G Prose Layer-2 UE-to-Network Relay connect via different cells of the same NG-RAN, the NG-RAN shall provide the cell ID of the direct path in the ULI information. The same applies to NG-RAN Location reporting procedures defined in clause 4.10 of TS 23.502 [5] if AMF enables location reporting towards NG-RAN.\nPath management of the 5G ProSe Layer-2 Remote UE is specified in clause 16.21 of TS 38.300 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.10",
        "ts_38.300_clause_16.21",
        "ts_38.300",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.304_7.1.1",
      "section_id": "7.1.1",
      "section_title": "General",
      "content": "The following table illustrates the 5G DDNMF Services.\nTable 7.1.1-1: Services provided by 5G DDNMF\nService Name\nService Operations\nOperation Semantics\nExample Consumer(s)\nN5g-ddnmf_Discovery\nAnnounceAuthorize\nRequest/Response\n5G DDNMF\nAnnounceUpdate\nRequest/Response\n5G DDNMF\nMonitorAuthorize\nRequest/Response\n5G DDNMF\nMonitorUpdate\nRequest/Response\n5G DDNMF\nMonitorUpdateResult\nNotify\n5G DDNMF\nDiscoveryAuthorize\nRequest/Response\n5G DDNMF\nMatchReport\nRequest/Response\n5G DDNMF\nMatchInformation\nNotify\n5G DDNMF",
      "chunk_type": "definition",
      "cross_references": [
        "table_7.1.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_7.1.2.1",
      "section_id": "7.1.2.1",
      "section_title": "General",
      "content": "Service description: This service enables a 5G DDNMF to manage inter-PLMN ProSe Direct Discovery operations.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.2",
      "section_id": "7.1.2.2",
      "section_title": "N5g-ddnmf_Discovery_AnnounceAuthorize service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_AnnounceAuthorize\nDescription: The consumer NF obtains the authorization from the 5G DDNMF for announcing in the PLMN.\nInput, Required: Discovery type (\"open\" or \" restricted \") and\n-\t(for \"open\" discovery type:) ProSe Application ID, ProSe Application Code/Prefix, UE Identity, validity timer, Discovery Entry ID,\n-\t(for \"restricted\" discovery type:) RPAUID, Application ID, ProSe Restricted Code/Prefix, UE Identity, Discovery Entry ID,\nInput, Optional: metadata, Application Code Suffix pool, Restricted Code Suffix pool.\nOutput, Required: authorization result.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.3",
      "section_id": "7.1.2.3",
      "section_title": "N5g-ddnmf_Discovery_AnnounceUpdate service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_AnnounceUpdate\nDescription: The consumer NF updates or revoke the authorization from the 5G DDNMF for announcing in the PLMN.\nInput, Required: Discovery type = \"open\", UE Identity, validity timer, Discovery Entry ID\nInput, Optional: ProSe Application Code\nOutput, Required: result.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.4",
      "section_id": "7.1.2.4",
      "section_title": "N5g-ddnmf_Discovery_MonitorAuthorize service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_MonitorAuthorize\nDescription: The consumer NF obtains the authorization from the 5G DDNMF for monitoring in the PLMN.\nInput, Required: Discovery type (\"open\" or \" restricted \") and\n-\t(for \"open\" discovery type:) ProSe Application ID Name(s), UE Identity, Discovery Entry ID;\n-\t(for \"restricted\" discovery type:) RPAUID, UE Identity, Target PDUID, Application ID, Target RPAUID, Discovery Entry ID,\nInput, Optional: None,\nOutput, Required: (for \"open\" discovery) ProSe Application Code(s)/Prefix, ProSe Application Mask(s), TTL; or (for \"restricted\" discovery) ProSe Restricted Code(s)/Prefix, validity timer\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.5",
      "section_id": "7.1.2.5",
      "section_title": "N5g-ddnmf_Discovery_MonitorUpdate service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_MonitorUpdate\nDescription: The consumer NF updates or revoke the authorization for the indicated UE to monitor in the PLMN.\nInput, Required: Discovery type (\"open\" or \"restricted\"); and\n-\t(for \"open\" discovery type:) ProSe Application ID name, UE Identity, TTL, Discovery Entry ID;\n-\t(for \"restricted\" discovery type:) ProSe Restricted Code, Application ID, Banned RPAUID, Banned PDUID.\nInput, Optional: None.\nOutput, Required: Result.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.6",
      "section_id": "7.1.2.6",
      "section_title": "N5g-ddnmf_Discovery_MonitorUpdateResult service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_MonitorUpdateResult\nDescription: The consumer NF informs the 5G DDNMF of the monitoring revocation results.\nInput, Required: Discovery type = \"restricted\", ProSe Restricted Code, Application ID, Banned RPAUID, Banned PDUID, Result.\nInput, Optional: None.\nOutput, Required: None.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.7",
      "section_id": "7.1.2.7",
      "section_title": "N5g-ddnmf_Discovery_DiscoveryAuthorize service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_DiscoveryAuthorize\nDescription: The consumer NF obtains the authorization from the 5G DDNMF for a discoverer UE in the PLMN to operate Model B restricted discovery.\nInput, Required: Discovery type = \"restricted\", Restricted ProSe App User ID, UE Identity, Target PDUID, Application ID, Target RPAUID, Discovery Entry ID.\nInput, Optional: None.\nOutput, Required: ProSe Query Code(s), ProSe Response Code, validity timer.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.8",
      "section_id": "7.1.2.8",
      "section_title": "N5g-ddnmf_Discovery_MatchReport service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_MatchReport\nDescription: The consumer NF obtains the information about the indicated discovery code from the 5G DDNMF.\nInput, Required: Discovery type = \"open\", ProSe Application Code(s), UE identity, Monitored PLMN ID.\nInput, Optional: None.\nOutput, Required: ProSe Application ID Name(s), validity timer(s).\nOutput, Optional: Metadata, Metadata Index Mask(s).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.1.2.9",
      "section_id": "7.1.2.9",
      "section_title": "N5g-ddnmf_Discovery_MatchInformation service operation",
      "content": "Service operation name: N5g-ddnmf_Discovery_MatchInformation\nDescription: The consumer NF receives from the 5G DDNMF of a matching result and the information can be used for charging purpose.\nInput, Required: Discovery type (\"open\" or \"restricted\"); and\n-\t(for \"open\" type:) ProSe Application ID(s), UE Identity;\n-\t(for \"restricted\" type:) RPAUID, Target RPAUID, UE Identity, ProSe Restricted Code.\nInput, Optional: None.\nOutput, Required: None.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.2.1",
      "section_id": "7.2.1",
      "section_title": "General",
      "content": "This service enables consumer NF to request authorization for Discovery Request. This service is also used by producer NF to update the authorization of discovery request.\nTable 7.2.1-1: Services provided by AF\nService Name\nService Operations\nOperation Semantics\nExample Consumer(s)\nNaf_ProSe\nDiscoveryAuthorization\nRequest/Response\n5G DDNMF\nDiscoveryAuthorizationUpdateNotify\nSubscribe/Notify\n5G DDNMF\nDiscoveryAuthorizationResultUpdate\nRequest/Response\n5G DDNMF",
      "chunk_type": "definition",
      "cross_references": [
        "table_7.2.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.304_7.2.2.1",
      "section_id": "7.2.2.1",
      "section_title": "General",
      "content": "Service description: This service enables consumer NF to request authorization for Discovery Request. The AF may update the authorization information to revoke the Restricted ProSe Direct Discovery permission.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.2.2.2",
      "section_id": "7.2.2.2",
      "section_title": "Naf_ProSe_DiscoveryAuthorization service operation",
      "content": "Service operation name: Naf_ProSe_DiscoveryAuthorization\nDescription: Authorize Discovery Request from the consumer NF.\nInput, Required: Request type (\"open\" or \" restricted \") and:\n-\t(for \"open\" discovery type): ProSe Application ID;\n-\t(for \"restricted\" discovery type): RPAUID.\nInput, Optional: Application Level Container, Allowed number of suffixes, Target RPAUID.\nOutput, Required: Response Type, PDUID(s).\nOutput, Optional: Target PDUID, ProSe Application Code Suffix pool, ProSe Restricted Code Suffix pool, Mask(s) for the ProSe Application Code Suffix(es) corresponding to ProSe Application ID, Mask(s) for the ProSe Restricted Code Suffix(es) corresponding to RPAUID, N sets of Target PDUID - Target RPAUID - Metadata Indicator, Application Level Container.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.2.2.3",
      "section_id": "7.2.2.3",
      "section_title": "Naf_ProSe_DiscoveryAuthorizationUpdateNotify service operation",
      "content": "Service operation name: Naf_ProSe_DiscoveryAuthorizationUpdateNotify\nDescription: The AF update the authorization information to revoke discovery permissions relating to some other users in the NF consumer.\nInput, Required: Discovery type = \"restricted\", RPAUID, Banned RPAUID, Banned PDUID.\nInput, Optional: None.\nOutput, Required: Result.\nOutput, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.304_7.2.2.4",
      "section_id": "7.2.2.4",
      "section_title": "Naf_ProSe_DiscoveryAuthorizationResultUpdate service operation",
      "content": "Service operation name: Naf_ProSe_DiscoveryAuthorizationResultUpdate\nDescription: The NF consumer informs the AF of the revocation result because of update in authorization information.\nInput, Required: Discovery type = \"restricted\", RPAUID, Banned RPAUID, Banned PDUID.\nInput, Optional: None.\nOutput, Required: Result.\nOutput, Optional: None.\nAnnex A (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2021-03\nSA2#143e\nSkeleton for this TS (approved in S2-2101633)\n0.0.0\n2021-06\nSA#92-e\nSP-210367\n-\n-\n-\nMCC editorial update for presentation to TSG SA#92E for information\n1.0.0\n2021-09\nSA#93-e\nSP-210940\n-\n-\n-\nMCC editorial update for presentation to TSG SA#92E for approval\n2.0.0\n2021-09\nSA#93-e\n-\n-\n-\n-\nMCC editorial update for publication after TSG SA#92E approval\n17.0.0\n2021-12\nSA#94-e\nSP-211281\n0001\n-\nF\nEN resolution about U2N Relay reselection\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0002\n1\nF\nCorrection on IP address allocation for U2N Relay\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0003\n1\nF\nClarification on scope\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0004\n-\nF\nCorrection to UE triggered Policy provisioning Procedure\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0005\n1\nF\nPC5 Discovery Model Selection\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0012\n2\nF\nClarification for the PC5 QoS parameters and PC5 QoS rule\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0013\n1\nF\nRemoving the EN of policy control for L3 U2N Relay\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0014\n1\nF\nN3IWF connection via data network\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0015\n1\nF\nClarification on Parameters Provided by ProSe Application Server\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0016\n1\nF\nClarification on Discovery Request Procedure\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0017\n-\nF\nChange ProSe Service Type to ProSe Identifier\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0018\n1\nF\nClarification on Layer-2 Relay selection\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0019\n4\nF\nClarification on Relay Discovery Additional Information message\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0020\n1\nB\nIdentifiers for Layer-2 UE-to-Network Relay discovery\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0021\n1\nB\nRemove ENs on RAN2 dependency issues\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0022\n-\nF\nMega Editorial CR on 5G ProSe\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0023\n1\nF\nDDNMF stack\n17.1.0\n2021-12\nSA#94-e\nSP-211281\n0026\n1\nF\nClarifications on QoS handling for L3 relay\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0029\n1\nF\nCorrections on 5G ProSe UE-to-Network Relay\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0030\n1\nF\nCorrections on ProSe Direct Discovery with 5G DDNMF\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0031\n1\nF\nPDU Session release for L3 U2N Relay on authorisation revocation\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0037\n1\nF\nUpdate to ProSe identifier definition\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0038\n2\nF\nUpdate to Groupcast mode 5G ProSe Direct Communication\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0039\n-\nF\nterminology correction\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0049\n1\nF\nMiscellaneous clarifications and corrections\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0050\n1\nF\nClarification on the ID for Group discovery\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0051\n1\nF\nPC5 link release and CM state update for L2 U2N relay\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0054\n1\nF\nUpdates and alignments based on further RAN2 feedback\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0055\n-\nF\nUpdate on Unicast link profile for UE-to-Network Relay\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0056\n1\nF\nClarification on subscription information to 5G ProSe\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0057\n1\nF\nN3IWF connection via Dual PDU sessions\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0058\n1\nF\nClarification about path selection policy\n17.1.0\n2021-12\nSA#94-e\nSP-211282\n0059\n1\nF\nUser Info ID clarifications\n17.1.0\n2022-01\n-\n-\n0020\n1\nB\nCorrection of CR0020R1 implementation: Removal of editor's notes in clause 5.8.3.3\n17.1.1\n2022-03\nSA#95-e\nSP-220050\n0024\n2\nB\nDRX support for direct discovery and communication and L3 relay\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0060\n1\nF\nClarification on QoS handling for Layer-3 Relay with N3IWF\n17.2.0\n2022-03\nSA#95-e\nSP-220354\n0061\n4\nF\nResolve EN for Mobility Restriction\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0063\n1\nF\nCapture the reference point of PKMF\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0064\n1\nF\nResolve ENs for Security Parameters Provisioning\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0065\n-\nF\nHigh-level description of UE-to-Network Relay discovery\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0066\n1\nF\nEditorial fixes related to referred clauses\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0067\n1\nF\nUpdate to metadata in PC5 Direct Discovery message\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0070\n-\nF\nRemoval of discovery range\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0072\n1\nF\nNAS message type determination\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0074\n1\nF\nUser info in discovery message\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0075\n1\nF\nHandling on discovery and data associated to different L2 IDs\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0079\n1\nF\nSupport of RAN Sharing for L2 Relay\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0080\n1\nB\nRSC Determination by a Layer-3 Remote UE\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0081\n1\nB\nSecurity procedures for L3 relaying\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0082\n1\nF\nUse of discovery Model A and Model B\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0086\n1\nF\nClarification on privacy timer\n17.2.0\n2022-03\nSA#95-e\nSP-220050\n0087\n1\nF\nClarification on Remote UE providing QoS Info\n17.2.0\n2022-03\nSA#95-e\nSP-220354\n-\n-\n-\nMCC implementation correction of CR0061R4\n17.2.1\n2022-06\nSA#96\nSP-220393\n0088\n1\nF\nClarify for security procedure for UE-to-Network Relaying\n17.3.0\n2022-06\nSA#96\nSP-220393\n0089\n1\nF\nAdding reference point between 5G PKMF and UDM\n17.3.0\n2022-06\nSA#96\nSP-220393\n0090\n1\nF\nMobility restrictions for MCX cleanup\n17.3.0\n2022-06\nSA#96\nSP-220393\n0091\n1\nF\nClarifications on PC5 DRX operations\n17.3.0\n2022-06\nSA#96\nSP-220393\n0093\n1\nF\nTAI delivery\n17.3.0\n2022-06\nSA#96\nSP-220393\n0094\n1\nF\nRemove ENs on Security Parameters Provisioning for UE-NW Relay\n17.3.0\n2022-06\nSA#96\nSP-220393\n0098\n1\nF\nMiscellaneous corrections and alignments\n17.3.0\n2022-06\nSA#96\nSP-220393\n0099\n-\nF\nModify description in clause 4.3.9.3\n17.3.0\n2022-06\nSA#96\nSP-220393\n0100\n1\nF\nClarification on DRX handling for unicast communication procedures\n17.3.0\n2022-06\nSA#96\nSP-220713\n0102\n7\nF\nAMF and AUSF selection for CP authentication and authorisation\n17.3.0\n2022-09\nSA#97E\nSP-220773\n0107\n1\nF\nCP and UP-based security procedures for 5G ProSe UE-to-Network Relay\n17.4.0\n2022-09\nSA#97E\nSP-220773\n0109\n1\nF\nClarfication on a single L2 link between L2 remote UE and L2 U2N relay UE for supporting PDU sessions of the L2 remote UE\n17.4.0\n2022-09\nSA#97E\nSP-220773\n0110\n1\nF\nClarification on PDCP SDU Types\n17.4.0\n2022-09\nSA#97E\nSP-220773\n0111\n-\nF\nSL DRX for L2 U2N Relay\n17.4.0\n2022-09\nSA#97E\nSP-220773\n0114\n1\nF\nUpdates to Policy/Parameter provisioning for CP authentication and authorisation\n17.4.0\n2022-12\nSA#98E\nSP-221065\n0118\n1\nF\nClarifications on PC5 DRX operations\n17.5.0\n2022-12\nSA#98E\nSP-221065\n0119\n-\nF\nAdd 5G DDNMF Address in Parameter Provisioning for 5G ProSe Direct Discovery\n17.5.0\n2022-12\nSA#98E\nSP-221065\n0120\n1\nF\nCorrection on PC5 link release indication\n17.5.0\n2022-12\nSA#98E\nSP-221082\n0124\n4\nB\nLayer-2 link management over PC5 reference point for U2U Relay\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0125\n2\nB\n5G ProSe Communication via U2U Relay\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0126\n1\nB\nQoS handling for U2U Relay\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0129\n1\nB\nTerms related to U2U relaying\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0130\n2\nB\nIntroduction of UE-to-UE Relay\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0131\n2\nB\nUE-to-UE Relay Discovery\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0132\n2\nB\nLayer-3 UE-to-UE Relay Communication\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0135\n3\nB\nSupport path switching for U2N relay\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0139\n3\nB\nProcedures for Communication Path Switching between Two UE-to-Network Relays\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0144\n3\nB\n5G ProSe UE-to-UE Relay reference architecture\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0148\n3\nB\n5G ProSe UE-to-UE Relay reselection\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0150\n3\nB\nUE-to-UE Relay with Integrated Discovery\n18.0.0\n2022-12\nSA#98E\nSP-221082\n0155\n5\nB\n5.2.X 5G ProSe UE-to-UE Relay Discovery\n18.0.0\n2023-03\nSA#99\nSP-230036\n0157\n-\nA\nRemoval of ProSe policy request during registration procedure\n18.1.0\n2023-03\nSA#99\nSP-230036\n0159\n-\nA\nDedicated DNN for 5G ProSe L3 UE-to-Network Relay connectivity without N3IWF\n18.1.0\n2023-03\nSA#99\nSP-230047\n0161\n1\nB\n5G ProSe Layer-3 UE-to-UE Relay Communication for Non-IP Traffic\n18.1.0\n2023-03\nSA#99\nSP-230047\n0162\n5\nB\nIntroducing 5G ProSe ph2 function for KI#7 (Support of Emergency for UE-to-Network Relaying)\n18.1.0\n2023-03\nSA#99\nSP-230081\n0164\n-\nB\nIPv6 prefix delegation in 5GS\n18.1.0\n2023-03\nSA#99\nSP-230047\n0168\n1\nB\nAuthorization information about multi-path transmission for L2 Remote UE\n18.1.0\n2023-03\nSA#99\nSP-230047\n0169\n13\nB\nPath switching between PC5 path and Uu path\n18.1.0\n2023-03\nSA#99\nSP-230047\n0170\n1\nB\nRSC for UE-to-UE relaying\n18.1.0\n2023-03\nSA#99\nSP-230047\n0172\n1\nB\nLayer-2 link management for 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230047\n0173\n1\nC\nUpdate for 5G ProSe UE-to-UE Relay Communication with integrated Discovery\n18.1.0\n2023-03\nSA#99\nSP-230047\n0174\n1\nB\nIdentifiers for 5G ProSe UE-to-UE Relay Discovery\n18.1.0\n2023-03\nSA#99\nSP-230047\n0175\n1\nB\nIdentifiers for Discovery integrated into PC5 unicast link establishment\n18.1.0\n2023-03\nSA#99\nSP-230047\n0177\n1\nB\nPath switching between direct and indirect path for Layer-2 UE-to-Network Relay\n18.1.0\n2023-03\nSA#99\nSP-230047\n0180\n1\nC\nUpdate on path switching between different U2N relays\n18.1.0\n2023-03\nSA#99\nSP-230036\n0185\n1\nA\nDefault configuration for ProSe Policy/Parameter\n18.1.0\n2023-03\nSA#99\nSP-230047\n0186\n-\nB\nUpdates to U2U relay link management\n18.1.0\n2023-03\nSA#99\nSP-230047\n0195\n1\nB\nProtocol Stacks for 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230047\n0196\n3\nB\n5G ProSe Remote UE traffic handling for multipath transmission via Layer-3 UE-to-Network Relay\n18.1.0\n2023-03\nSA#99\nSP-230047\n0201\n4\nB\nUpdate on UE-to-UE Relay reselection\n18.1.0\n2023-03\nSA#99\nSP-230048\n0202\n1\nB\nSupport of UE-to-UE Relay operation during ProSe Direct Discovery\n18.1.0\n2023-03\nSA#99\nSP-230048\n0205\n1\nB\nAuthorization and Provisioning for 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230048\n0208\n1\nB\nLink Management over PC5 reference point for 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230036\n0211\n1\nA\nAlignment on Remote User ID for L3 U2N Relay w/o N3IWF\n18.1.0\n2023-03\nSA#99\nSP-230048\n0212\n1\nB\nIP address allocation for communication with a 5G ProSe Layer-3 UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230036\n0214\n1\nA\nClarification of out-of-coverage operation_R18\n18.1.0\n2023-03\nSA#99\nSP-230048\n0215\n1\nF\nClarification of out-of-coverage operation for U2U Relays\n18.1.0\n2023-03\nSA#99\nSP-230048\n0216\n2\nB\nSupport of multi-path transmission for U2N Relay (KI#5): structure for high level description and procedures\n18.1.0\n2023-03\nSA#99\nSP-230048\n0218\n2\nC\nLink sharing for UE-to-UE Relay with Integrated Discovery\n18.1.0\n2023-03\nSA#99\nSP-230048\n0224\n1\nB\nGeneral description of 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230048\n0225\n1\nB\nPrinciples for applying parameters for 5G ProSe UE-to-UE Relay\n18.1.0\n2023-03\nSA#99\nSP-230048\n0226\n1\nF\nCorrection on Procedure for 5G ProSe UE-to-UE Relay Discovery with Model A\n18.1.0\n2023-03\nSA#99\nSP-230048\n0227\n1\nF\nClarification on Path switching between PC5 path and Uu path\n18.1.0\n2023-06\nSA#100\nSP-230449\n0141\n10\nB\nSupport of Public Warning Notification Relaying by 5G ProSe UE-to-Network Relay\n18.2.0\n2023-06\nSA#100\nSP-230448\n0235\n1\nA\nCorrection to the way that security function is described\n18.2.0\n2023-06\nSA#100\nSP-230449\n0236\n4\nF\nUpdate to 5G ProSe Layer-3 UE-to-UE Relay Communication for Ethernet Traffic\n18.2.0\n2023-06\nSA#100\nSP-230449\n0237\n1\nF\nKI#5 Resolve EN for authorization of multi-path via Uu and via L3 U2N Relay\n18.2.0\n2023-06\nSA#100\nSP-230449\n0238\n1\nF\nKI#5 Resolve EN for term of multi-path via Uu and via U2N Relay\n18.2.0\n2023-06\nSA#100\nSP-230449\n0240\n1\nF\nENs resolution for path switching between PC5 path and Uu path\n18.2.0\n2023-06\nSA#100\nSP-230449\n0242\n1\nB\nResolve EN on parameter provisioning for U2U Relay communication with integrated discovery\n18.2.0\n2023-06\nSA#100\nSP-230449\n0243\n1\nB\nUpdate of U2U Relay Communication with integrated Discovery procedure\n18.2.0\n2023-06\nSA#100\nSP-230449\n0248\n-\nF\nProvisioning for traffic type of L3 U2U Relay\n18.2.0\n2023-06\nSA#100\nSP-230449\n0249\n1\nF\nEmergency Priority Handling for 5G ProSe Layer-3 Relay\n18.2.0\n2023-06\nSA#100\nSP-230449\n0250\n1\nF\nIndication of Support for Emergency Relaying\n18.2.0\n2023-06\nSA#100\nSP-230449\n0252\n1\nF\nEmergency service via N3IWF\n18.2.0\n2023-06\nSA#100\nSP-230449\n0253\n1\nF\nAlignment of policy for U2U and Direct Discovery and Communication\n18.2.0\n2023-06\nSA#100\nSP-230449\n0255\n2\nF\nClarification of multi-path communication\n18.2.0\n2023-06\nSA#100\nSP-230449\n0256\n3\nB\nUpdate of U2U Relay discovery to support negotiated Relay reselection\n18.2.0\n2023-06\nSA#100\nSP-230449\n0259\n3\nF\nUpdate on emergency service over U2N Relay\n18.2.0\n2023-06\nSA#100\nSP-230449\n0261\n-\nB\nU2U relay capabilities and subscription\n18.2.0\n2023-06\nSA#100\nSP-230449\n0264\n3\nB\nKI#7_IP address allocation by Layer 3 Relay UE for emergency service\n18.2.0\n2023-06\nSA#100\nSP-230448\n0266\n1\nA\nCatch all entry for discovery\n18.2.0\n2023-06\nSA#100\nSP-230450\n0270\n-\nB\nMA PDU Session in multi-path transmission for L3 U2N Relay with N3IWF\n18.2.0\n2023-06\nSA#100\nSP-230450\n0272\n1\nB\nClarification on 5G ProSe UE-to-Network Relay Reselection and Path Switching\n18.2.0\n2023-06\nSA#100\nSP-230450\n0273\n1\nF\nClarification on AF-based Service Parameter Provisioning\n18.2.0\n2023-06\nSA#100\nSP-230450\n0276\n1\nF\nPLMN selection for L2 remote UE for emergency service\n18.2.0\n2023-06\nSA#100\nSP-230450\n0277\n3\nF\nDNN for emergency service\n18.2.0\n2023-06\nSA#100\nSP-230450\n0279\n1\nB\nLink Modification Procedure with L3 UE-to-UE Relay\n18.2.0\n2023-06\nSA#100\nSP-230450\n0286\n1\nF\nClarification of 5G ProSe UE-to-UE Relay reselection\n18.2.0\n2023-06\nSA#100\nSP-230450\n0288\n2\nF\nLayer-3 U2U Relay link release and maintenance procedures\n18.2.0\n2023-06\nSA#100\nSP-230450\n0292\n2\nF\nClarification on QoS handling for 5G ProSe Layer-3 UE-to-UE Relay\n18.2.0\n2023-06\nSA#100\nSP-230450\n0302\n2\nF\nL2 Remote UE RRC Establishment Cause\n18.2.0\n2023-06\nSA#100\nSP-230450\n0303\n-\nF\nUse of emergency RSC\n18.2.0\n2023-06\nSA#100\nSP-230450\n0304\n-\nF\nAdding new PQIs to support path switching between PC5 and Uu\n18.2.0\n2023-09\nSA#101\nSP-230840\n0306\n1\nF\nProSe Authorization info for Layer-2 U2U Relay operation\n18.3.0\n2023-09\nSA#101\nSP-230832\n0311\n1\nA\nReference point alignment with TS33.503\n18.3.0\n2023-09\nSA#101\nSP-230840\n0313\n2\nF\nClarification on 5G ProSe UE-to-UE Relay Discovery with Model A\n18.3.0\n2023-09\nSA#101\nSP-230840\n0315\n2\nF\nModification on Relay Discovery Additional Information Message\n18.3.0\n2023-09\nSA#101\nSP-230840\n0322\n2\nF\nClarification on 5G ProSe UE-to-UE Relay Discovery\n18.3.0\n2023-09\nSA#101\nSP-230840\n0329\n2\nF\nU2U relay authorization updates\n18.3.0\n2023-09\nSA#101\nSP-230840\n0334\n1\nF\nClarification on RSC usage during relay discovery and relay reselection\n18.3.0\n2023-09\nSA#101\nSP-230840\n0338\n-\nF\nClarifications on U2U Relay reselection relay discovery\n18.3.0\n2023-09\nSA#101\nSP-230840\n0348\n1\nF\nCorrections on procedures for 5G ProSe UE-to-UE Relay Discovery\n18.3.0\n2023-12\nSA#102\nSP-231247\n0321\n6\nF\nCorrections to UE-to-UE Relay Discovery\n18.4.0\n2023-12\nSA#102\nSP-231247\n0330\n3\nF\nU2U relay features complement\n18.4.0\n2023-12\nSA#102\nSP-231247\n0331\n3\nF\nMulti-path communication complement\n18.4.0\n2023-12\nSA#102\nSP-231247\n0335\n3\nF\nClarifications on U2U Relay and message handling\n18.4.0\n2023-12\nSA#102\nSP-231247\n0336\n3\nF\nClarifications on Relay discovery for emergency service\n18.4.0\n2023-12\nSA#102\nSP-231247\n0341\n4\nF\nRelay UE requirement to forward PWS messages\n18.4.0\n2023-12\nSA#102\nSP-231247\n0350\n-\nF\nClarification on Layer-2 link management on UE-to-UE Relay\n18.4.0\n2023-12\nSA#102\nSP-231247\n0352\n3\nF\nUpdate Terminologies\n18.4.0\n2023-12\nSA#102\nSP-231247\n0355\n1\nF\nCorrection on Layer-2 U2U Relay Communication with integrated Discovery\n18.4.0\n2023-12\nSA#102\nSP-231247\n0356\n1\nF\nCorrection on Layer-3 U2U Relay link identifier update procedure\n18.4.0\n2023-12\nSA#102\nSP-231247\n0358\n1\nF\nRemoval of ENs having RAN dependency\n18.4.0\n2023-12\nSA#102\nSP-231247\n0359\n1\nF\nSupport for U2U Relay for UEs in limited service state\n18.4.0\n2023-12\nSA#102\nSP-231247\n0362\n-\nF\nCorrection on link-local IPv6 address in DCA message\n18.4.0\n2023-12\nSA#102\nSP-231247\n0364\n1\nF\nIssue on U2U relay reselection triggered by PC5 RLF or PC5 link release\n18.4.0\n2023-12\nSA#102\nSP-231248\n0369\n1\nF\nFixing reference and editorial errors\n18.4.0\n2023-12\nSA#102\nSP-231247\n0375\n2\nF\nClarification on RSC and Target Info matching\n18.4.0\n2023-12\nSA#102\nSP-231247\n0376\n2\nF\nCorrection on relay_Indication\n18.4.0\n2023-12\nSA#102\nSP-231247\n0377\n1\nF\nResolve the EN on PC5 Security Used for Emergency Services\n18.4.0\n2023-12\nSA#102\nSP-231247\n0381\n1\nF\nParameter update for Link Modification with L3 U2U Relay\n18.4.0\n2023-12\nSA#102\nSP-231247\n0382\n2\nF\nCorrection on UE-to-UE Relay discovery procedures\n18.4.0\n2023-12\nSA#102\nSP-231247\n0401\n2\nF\nRejection of L3 U2U Connection Setup when Ethernet MAC address conflict is detected\n18.4.0\n2024-03\nSA#103\nSP-240088\n0339\n3\nF\nClarification on IPv6 only for policy control and session binding for L3 N3IWF Relay\n18.5.0\n2024-03\nSA#103\nSP-240088\n0340\n2\nF\nClarification on how path type is selected when switching between U2N relays\n18.5.0\n2024-03\nSA#103\nSP-240115\n0370\n2\nF\nClarification of Relay Service Code used by UEs from different PLMNs\n18.5.0\n2024-03\nSA#103\nSP-240088\n0402\n1\nF\nClarification on Cell Reporting in multi-path L2 U2N case\n18.5.0\n2024-03\nSA#103\nSP-240088\n0404\n4\nF\nCorrection on Layer-2 ID for UE-to-UE Relay Discovery\n18.5.0\n2024-03\nSA#103\nSP-240088\n0409\n1\nF\nUpdate on UE-to-UE Relay Discovery and Link Establishment/Modification for alignment with SA3\n18.5.0\n2024-03\nSA#103\nSP-240088\n0410\n1\nF\nUpdate on U2U Identifiers and Candidate U2U Relay Discovery for alignment with SA3\n18.5.0\n2024-03\nSA#103\nSP-240088\n0416\n1\nF\nAlignment with RAN for path switching\n18.5.0\n2024-03\nSA#103\nSP-240088\n0418\n-\nF\nEN removal for L2 U2U QoS handling\n18.5.0\n2024-03\nSA#103\nSP-240088\n0420\n1\nF\nUpdates to default L2 ID usage for discovery message\n18.5.0\n2024-03\nSA#103\nSP-240088\n0422\n1\nF\nUpdate policy parameter provisioning for U2U relay\n18.5.0\n2024-03\nSA#103\nSP-240088\n0423\n3\nF\nUpdate procedure for 5G ProSe UE-to-UE Relay Discovery with Model A\n18.5.0\n2024-03\nSA#103\nSP-240088\n0424\n1\nF\nClarifications on Layer-2 IDs used in UE-to-UE Relay link establishment procedure\n18.5.0\n2024-03\nSA#103\nSP-240088\n0426\n-\nF\nENs Removal for Layer-2 UE-to-UE Relay\n18.5.0\n2024-03\nSA#103\nSP-240115\n0429\n2\nF\nClarification of Direct Discovery\n18.5.0\n2024-03\nSA#103\nSP-240088\n0430\n1\nF\nRAN alignment for SL DRX\n18.5.0\n2024-03\nSA#103\nSP-240088\n0431\n2\nF\nSecurity aspects alignment for U2U relay\n18.5.0\n2024-03\nSA#103\nSP-240088\n0432\n2\nF\nClarification on multi-path communication via Uu and via 5G ProSe UE-to-Network Relay\n18.5.0\n2024-03\nSA#103\nSP-240088\n0433\n2\nF\nUpdate on 5G ProSe Layer-2 U2U Relay Link Establishment\n18.5.0\n2024-04\nSA#103\n-\n-\n-\n-\nImplementation Correction of CR0404r4, in clause 5.8.4.2\n18.5.1\n2024-06\nSA#104\nSP-240588\n0435\n-\nF\nClarification on triggering PC5 connection setup procedure via same U2U Relay\n18.6.0\n2024-06\nSA#104\nSP-240588\n0443\n1\nF\nAlignment with stage 3 specification on End UE user info and Direct discovery set\n18.6.0\n2024-09\nSA#105\nSP-241255\n0442\n4\nF\nClarification for end-to-end PC5 link management for L2 U2U Relay\n18.7.0\n2024-09\nSA#105\nSP-241255\n0472\n1\nF\nClarification on 5G ProSe U2U Communication with integrated Discovery\n18.7.0\n2024-09\nSA#105\nSP-241255\n0474\n2\nF\nUpdate on Unicast link profile for UE-to-UE Relay\n18.7.0\n2025-03\nSA#107\nSP-250032\n0526\n-\nF\nClarification on DNS query during Layer-2 link establishment via 5G ProSe Layer-3 UE-to-UE Relay\n18.8.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.3.3",
        "clause_4.3.9.3",
        "clause_5.8.4.2",
        "ts_17.3"
      ]
    }
  ]
}