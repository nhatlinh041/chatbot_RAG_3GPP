{
  "metadata": {
    "specification_id": "ts_23.153",
    "version": "18.0.0",
    "title": "3GPP TS 23.153",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23153-i00/23153-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:39:19.203936",
    "total_chunks": 98
  },
  "chunks": [
    {
      "chunk_id": "ts_23.153_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document specifies the stage 2 description of the Out-of-Band Transcoder Control for speech services. It describes the principles and procedures to support Transcoder Free Operation, Tandem Free Operation and the interworking between TrFO and TFO. Transcoder at the edge is also part of the present document.\nThe present document specifies functions, procedures and information which apply to GERAN Iu mode. However, functionality related to GERAN Iu mode is neither maintained nor enhanced.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TS 23.107: \"QoS Concept and Architecture\".\n[2]\t3GPP TS 24.008: \"Mobile radio interface layer 3 specification Core Network Protocols –Stage 3\".\n[3]\t3GPP TS 25.413: \"UTRAN Iu Interface RANAP Signalling\".\n[4]\t3GPP TS 25.415: \"UTRAN Iu Interface User Plane Protocols\".\n[5]\t3GPP TS 26.103: \"Speech codec list for GSM and UMTS\".\n[6]\t3GPP TS 29.205: \"3rd Generation Partnership Project; Technical Specification Group CoreNetwork; Application of Q.1900 series to Bearer Independent circuit-switched core Network architecture; Stage 3\".\n[7]\tITU‑T Recommendation Q.765.5: \"Signalling system No. 7; Application transport mechanism: Bearer Independent Call Control (BICC)\".\n[8]\t3GPP TS 23.205: \"Bearer-independent CS Core Network.\".\n[9]\t3GPP TS 33.106: \"3GPP Security; Lawful Interception Requirements\".\n[10]\t3GPP TS 28.062: \"Inband Tandem Free Operation (TFO) of Speech Codecs; Service Description; Stage 3\".\n[11]\t3GPP TS 23.009: \"Handover Procedures\".\n[12]\t3GPP TS 29.232: \"Media Gateway Controller (MGC) – Media Gateway (MGW) interface; Stage 3\".\n[13]\tITU-T H.248: \"Gateway Control Protocol\".\n[14]\t3GPP TS 29.415: \"Customised Applications for Mobile network Enhanced Logic (CAMEL) Phase 3; CAMEL Application Part (CAP) specification\".\n[15]\t3GPP TS 48.008: \"Mobile-services Switching Centre – Base Station System (MSC – BSS) interface; layer 3 specification\"\n[16]\t3GPP TS 43.051: \"Technical Specification Group GSM/EDGE; Radio Access Network; Overall description - Stage 2; \"\n[17]\t3GPP TS 23.172: \"Technical realization of Circuit Switched (CS) multimedia service; UDI/RDI fallback and service modification - Stage 2\".\n[18]\t3GPP TS 34.108: \"Common test environments for User Equipment (UE) conformance testing\".\n[19]\t3GPP TS 29.007: \"General requirements on interworking between the Public Land Mobile Network (PLMN) and the Integrated Services Digital Network (ISDN) or Public Switched Telephone Network (PSTN)\".\n[20]\t3GPP TS 23.231: \"SIP-I Based Circuit-Switched Core Network; Stage 2\".\n[21]\t3GPP TS 29.231: \" Application of SIP-I Protocols to Circuit Switched (CS) core network architecture; Stage 3\".\n[22]\tIETF RFC 4733 \"RTP Payload for DTMF Digits, Telephony Tones and Telephony Signals\".\n[23]\tIETF RFC 3389: \" Real-time Transport Protocol (RTP) Payload for Comfort Noise (CN)\".\n[24]\tIETF RFC 3264: \"An Offer/Answer Model with the Session Description Protocol (SDP)\".\n[25]\tIETF RFC 4040: \"RTP Payload Format for a 64 kbit/s Transparent Call\"\n[26]\tITU-T Recommendation T.38: \"Procedures for real-time Group 3 facsimile communication over IP networks\"\n[27]\tIETF RFC 3362: \"Real-time Facsimile (T.38) - image/t38 MIME Sub-type Registration\"",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.107",
        "ts_24.008",
        "ts_25.413",
        "ts_25.415",
        "ts_26.103",
        "ts_29.205",
        "ts_23.205",
        "ts_33.106",
        "ts_28.062",
        "ts_23.009",
        "ts_29.232",
        "ts_29.415",
        "ts_48.008",
        "ts_43.051",
        "ts_23.172",
        "ts_34.108",
        "ts_29.007",
        "ts_23.231",
        "ts_29.231"
      ]
    },
    {
      "chunk_id": "ts_23.153_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the following definitions apply:\nCodec: device to encode information from its original representation into an encoded form and to decode encoded information into its original representation\nCodec Lists, Selected Codecs: The OoBTC procedures pass a number of codec lists created by comparing the capabilities of the different nodes or equipment involved. For the different interfaces involved during call setup, handover, and relocation, the following codec lists and selected codecs need to be distinguished - where codec lists are ordered, \"ordered\" is included in the description:\n1)\tSupported Codecs List (DTAP) – this is the list of codecs supported by the UE. It is subdivided into codecs supported for the currently used radio access and codecs that can be used for other radio accesses supported by the UE. The list contains only the codec types, but not the individual configuration, as the UE is mandated to support all configurations for a given codec type.\n2)\tSupported Codecs List (BSSMAP) - \"BSC-SCL\" - this is the list of codecs supported by the BSS (BSS-SCL). The list contains the codec types as well as the individual codec configurations supported by the radio access at the very moment of call setup.\n3)\tSupported Codecs List (BICC) – this ordered list is used on NNI (BICC) OoBTC signalling. At call setup it is sent forward by the node originating the OoBTC signalling and contains the default PCM codec and a set of codecs that is common to the nodes and the equipment involved in setting up the call. For a mobile originating call, these are the UE and the MGWs involved in the connection and, for UTRAN, GERAN Iu-mode and GERAN AoIP mode, also the originating radio access. At inter-MSC relocation and inter-MSC handover, the Supported Codecs List (BICC) is sent forward by the anchor MSC towards the target MSC and contains the default PCM codec and a set of codecs that is common to the anchor MSC and the nodes involved in setting up the new call leg towards the target MSC. For UDI/RDI multimedia calls with fallback and service change according to 3GPP TS 23.172 [17], the multimedia dummy codec will be included (see 3GPP TS 26.103 [5]).\n4)\tAvailable Codecs List (BICC) – this is the list of codecs available for the NNI connection. It is returned in the backward signalling to the node that originated the OoBTC and is a subset of the Supported Codecs List (BICC) sent forward. At call setup the Available Codecs List (BICC) contains the default PCM codec and a common set of codecs that can be supported by all nodes and, if Transcoder Free Operation has been achieved end-to-end, also by the UEs and the radio access networks that are involved in the call. At inter-MSC relocation and inter-MSC handover to UMTS, the Available Codecs List (BICC) contains the default PCM codec and a set of codecs that can be supported by all nodes involved in setting up the new call leg towards the target MSC and, if Transcoder Free Operation can be maintained end-to-end after the handover or relocation, also by the UE and the target radio access network.\n5)\tSelected Codec (BICC) – this is the codec selected to be used on the NNI connection. It is one of the codecs contained in the Available Codecs List (BICC) and may be different from the codec that is used on the radio interface, but if end-to-end Transcoder Free Operation has been achieved, this will be the common codec for all nodes, the UEs, and the radio accesses.\n6)\tIu-Supported Codecs List (MAP) – this ordered list is used for MAP signalling from the anchor MSC to the target MSC. It is subdivided into lists for UTRAN and GERAN Iu-mode and contains the codecs common to the UE and to the anchor MGW for each radio access supported by the UE. The codec capabilities of the serving radio access, i.e. the radio access used prior to the inter-MSC handover or relocation, are not taken into account. Codecs that are only applicable to the NNI, e.g. the default PCM codec or the multimedia dummy codec (see 3GPP TS 26.103 [5]), are not included.\n7)\tIu-Available Codecs List (MAP) – this is the list of codecs available for the target Iu interface. When returned by the target MSC to the anchor MSC in response to an initial Prepare Handover message it is the Iu-Supported Codecs List (MAP) reduced according to the capabilites of the target MGW and the target radio access. After a subsequent intra-MSC handover or relocation, the target MSC may update the Iu-Available Codecs List (MAP) according to the capabilites of its associated MGW and the new target radio access, if necessary.\n8)\tIu-Selected Codec (MAP) – this is the codec selected for the target Iu interface. It is one of the codecs contained in the Iu-Available Codecs List (MAP). In response to a Prepare Handover request message this is the codec selected by the target MSC and indicated back to the anchor MSC. When sent from the anchor MSC in a Forward Access Signalling request message during a codec modification, it contains the codec type and configuration chosen by the anchor MSC.\n9)\tIu-Currently Used Codec (MAP) – this is the codec in use on the serving Iu interface prior to an inter-MSC handover.\n10)\tTFO Codec List (H.248) – this is the list of codecs for use by the MGW during TFO in-band negotiations with a distant node. The list is passed via the Mc interface from the server to the MGW. The first entry of the TFO Codec List (H.248) is to be used by the MGW as the 'Local Used Codec' (see [10]).\n11)\tDistant Codec List (H.248) – this is the list of codecs received by the MGW from a distant node during TFO in-band negotiations. The list is passed via the Mc interface from the MGW to the server. The first entry of the Distant Codec List (H.248) is the 'Distant Used Codec' received by the MGW (see [10]).\n12)\tCodec (H.248) – this is the codec for use on a certain MGW termination. It is passed via the Mc interface from the server to the MGW.\n13)\tMSC Preferred Codec List (BSSMAP) – \"MSC-PCL\" - this is the list of codecs supported by both the MSC and the MS as allowed by the MSC for this assignment or handover, ordered by the MSC with the most preferred Codec Types first (e.g. the ones that may enable TrFO or TFO).\n14)\tAoIP-Supported Codecs List (Anchor) (MAP) - this ordered list is used for MAP signalling from the anchor MSC to the target MSC if anchor MSC supports GERAN AoIP mode. It contains codecs supported by the UE and by the anchor MSC for GSM access. Codecs that are only applicable to the NNI, e.g. the default PCM codec or the CSData Dummy Codec (see 3GPP TS 26.103 [5]), are not included.\n15)\tAoIP-Selected Codec (Target) (MAP) - the codec selected by the target BSS, to be used by the UE/MS in GERAN A/Gb mode after the handover to the BSS using A interface over IP. This is the Speech Codec (BSS chosen) as returned by the Target BSS in BSSAP.\n16)\tAoIP-Available Codecs List (MAP) - a list of codecs for GERAN A/Gb mode available for the target AoIP interface signalled via MAP. This is the Codec List (BSS Supported) returned by the Target BSS in BSSAP reduced according to the capabilities of the Target MSC.\nWithin the ordered codec lists, the codecs are ordered in decreasing order of priority, the first entry in the list being the highest priority codec (preferred codec).\nTandem Free Operation: configuration of a connection with two transcoders that support TFO protocol and whose external coding schemes are compatible, thus enabling compressed speech to pass between them\nNOTE 1:\tWhen the TFO protocol is not supported by both transcoders or the coding schemes are not compatible then normal \"Tandem\" operation occurs and PCM encoded speech is passed between them.\nTranscoder: device to change the encoding of information from one particular encoding scheme to a different one, most commonly to/from a compressed speech algorithm from/to PCM.\nTranscoder Free Operation: configuration of a speech or multimedia call for which no transcoder device is physically present in the communication path and hence no control or conversion or other functions can be associated with it\nOut of Band Transcoder Control: capability of a system to negotiate the types of codecs and codec modes on a call per call basis through out-of-band signalling, required to establish Transcoder Free Operation.\nDefault PCM Codec: network default 64kb/s codec for speech in PCM domain\nNOTE 2:\tFor example ITU G.711 A-law.\nTranscoding free link (TrFL): bearer link, where compressed voice is being carried between bearer endpoints\nNOTE 3:\tWithin the UMTS network, the compressed voice is transmitted in Iu/ Nb User Plane format, depending on the related interface.\nTandem free link (TFOL): bearer link between transcoders that are operating in Tandem Free Operation mode, i.e. bypassing the transcoding functions\nNOTE 4:\tThe involved transcoders can be a UMTS transcoder or a GSM TRAU with TFO functionality.\nTranscoder free operation (TrFO): calls that have no transcoders involved in the connection between the source codecs\nNOTE 5:\tFor mobile to mobile calls this is UE to UE, although the connection could be UE to another type of terminal. TrFO operation is considered a concatenation of TrFLs between RNCs.\nNOTE 6:\tIn case of mobile to fixed network calls the term \"Transcoder free operation\" is applicable for the TrFLs carrying compressed speech. The TrFO usually ends at the Gateway to the PSTN where the speech is transcoded e.g. to G.711.\nTandem free and Transcoding free operation (TaTrFO): concatenation of \"transcoding free links\" and \"tandem free links\"\nIu Framing: framing protocol used for the speech packets on both the Iu User Plane interface and the Nb User Plane interface\nNOTE 7:\tThe Iu framing protocol is specified by [4].\nIn addition, the definitions of ACS, SCS, OM, and MACS provided in [5] apply.\nDirect Codec: is a codec that can be used without any additional transcoding stage inserted at the MGW that is offering the codec list. E.g., a direct codec can be AMR or another mobile codec when the end terminal is a mobile station, or G.711 when interworking with the PSTN.\nIndirect Codec: is a codec that requires transcoding at the MGW providing the codec list.\nAuxiliary RTP payload type: is a  payload type used in combination with a speech codec to transmit some non-spech  audio via RTP. The Telephony Event RTP Payload Type and the , Comfort Noise Codec are the only \"Auxiliary\" RTP payload type defined in the present Release.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.172",
        "ts_26.103"
      ]
    },
    {
      "chunk_id": "ts_23.153_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations defined in GSM 01.04 and the following apply:\nACS\tActive Codec mode Set\nAPM\tApplication Transport Mechanism\nBC\tBearer Control\nBICC\tBearer Independent Call Control\nCC\tCall Control\nCCD\tConference Call Device\nCFNRc\tCall Forward Not Reachable\nCFNRy\tCall Forward on No Reply\nEVS\tEnhanced Voice Services\nIN\tIntelligent Network\nIuFP\tIu Framing Protocol\nMACS\tMaximal number of codec modes in the ACS\nOM\tOptimization Mode\nOoBTC\tOut-of-Band Transcoder Control\nQoS\tQuality of Service\nRAB\tRadio Access Bearer\nSCS\tSupported Codec mode Set\nTFO\tTandem Free Operation\nTICC\tTransport Independent Call Control\nTrFO\tTranscoder Free Operation\nUP\tUser Plane",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_4",
      "section_id": "4",
      "section_title": "Out-of-Band Transcoder control functionality",
      "content": "Cellular networks depend heavily on codecs to provide their services. Codecs are necessary to compress speech in order to utilise efficiently the expensive bandwidth resources both in the radio interface and in the transmission networks.\nUnnecessary transcoding of speech significantly degrades quality and, therefore, cellular systems try to avoid it for mobile-to-mobile calls when both UEs and the network support a common codec type.\nAlthough the main reason for avoiding transcoding in mobile-to-mobile calls has been speech quality, the transmission of compressed information in the CN and CN-CN interface of the cellular network also offers the possibility of bandwidth savings. Therefore Out-of-Band Transcoder Control is not limited to mobile-to-mobile calls but can be applied for calls to or from an external network as well.\nDigital cellular systems support an increasing number of codec types. As a result, in order to allocate transcoders for a call inside the network, and to select the appropriate codec type inside the UEs, signalling procedures are defined to convey the codec type selected for a call to all the affected nodes (UEs and (potential) transcoding points inside the network). Also, codec negotiation capabilities are being defined to enable the selection of a codec type supported in all the affected nodes, i.e. to resolve codec mismatch situations. This codec negotiation maximises the chances of operating in compressed mode end-to-end for mobile-to-mobile calls.\nTo allow transport of information in a compressed way in transmission networks, these networks make use of the transport -independent call control protocol as specified in [8] that provides means for signalling codec information, negotiation and selection of codecs end-to-end.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_4.1",
      "section_id": "4.1",
      "section_title": "OoBTC Requirements",
      "content": "The OoBTC mechanism shall support the following:\n-\tThe capability to negotiate the preferred codec type to be used between two end nodes and to avoid the use of transcoders in the network at call set-up.\nThe originating UE indicates the list of its supported codec types for codec negotiation. This list shall be conveyed to the terminating MSC. The terminating UE indicates its list of supported codec types to the terminating MSC. The terminating MSC shall convey the selected codec to the originating MSC, which then indicates the selected codec to the originating UE.\nWhere no compatible codec type can be selected between the UEs then the default PCM coding shall be selected. Therefore, the default PCM codec shall always be included in the codec list for OoBTC. The originating MSC shall insert a transcoder in the path from the originating UE. Codec selection for the terminating UE is then performed within the terminating MSC, independently of the originating MSC.\nNOTE:\tFor a codec type supporting various modes, the described functionality shall also be applicable to negotiate the set of codec modes common to originating and terminating UEs. Other negotiations such as Initialisation and Rate control are performed at a later point in time by the Iu framing protocol.\n-\tThe capability to control the presence of transcoders in the network after call set-up.\nWhere a change to the call state of a transcoder free connection occurs, such that compressed speech cannot be maintained, it shall be possible to insert a transcoder or pair of transcoders where needed in the path. If this results in change to the encoding of the speech in other nodes then it shall be possible to inform the end points of this segment that the speech coding is changed. Such examples where this could occur are:\n-\tSS interruptions (e.g. A to B call connection becomes to multiparty call connection.)\n-\tHandover to an incompatible partner.\n-\tSynchronisation loss\nWhere a change in call state as described above is temporary then it shall be possible to return to a transcoder free connection by removing the inserted transcoders and informing the endpoints that the connection has resumed to compressed speech encoding.\n-\tThe codec types comprise codecs for speech in the first phase of the present document. The transcoder control should have enough expandability to support future enhancements of codec types.\n-\tThe transcoder control procedure shall not cause a perceivable time lag in the cases of establishing transcoder free connection and reverting to normal (double transcoded) call connection in the cases described above for control of the presence of transcoders.\n-\tThe capability to insert transcoder (in cases where a TrFO connection is not possible) at the most appropriate location, i.e. to save bandwidth it should be located at the CN edge between an ATM or IP transport network and a STM network. When Transcoders are inserted, the OoBTC procedures shall provide support for TFO for inband codec negotiation and transmission of compressed speech.\nWhen a transport network cannot maintain compressed voice then reversion to the default PCM coding shall occur. A transcoder shall be inserted at that point and OoBTC procedures terminated. TrFO link is then possible between that point and the preceding nodes.\nWhen a Non-TrFO call reaches the UMTS CN then OoBTC procedures are initiated from that point and after codec negotiation has been performed, if compressed voice can be supported through the CN then a transcoder is inserted at the edge of the CN.\n-\tThe OoBTC signalling procedures shall be supported by the call control protocol on the Nc interface, for example codec negotiation, codec modification, codec list modification, codec renegotiation, and codec list re-negotiation. BICC CS2 (see 3GPP TS 29.205 [6]) supports such a mechanism, through the APM procedures defined by [7].\n-\tIf TMR = 3.1Khz Audio is set for incoming calls, this shall be kept if OoBTC is intiated at the edge of the PLMN.\nFor mobile originating calls, TMR=speech shall be used for speech calls with OoBTC. For other TMR values OoBTC shall not be used.\n-\tThe OoBTC signalling procedures shall be supported by the bearer control protocol on the Iu and Nb interfaces, for example to increase the bandwidth of the bearer (if needed) in the procedures for the codec modification.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.205"
      ]
    },
    {
      "chunk_id": "ts_23.153_4.2",
      "section_id": "4.2",
      "section_title": "Relationship between OoBTC and In-band TFO",
      "content": "OoBTC is used before call set-up to attempt to establish an UE-UE transcoder free connection. If successful the result is a saving of transcoding equipment in the path and provides a cost efficient transmission.The In-band TFO protocol (described in [10]) is activated after call set-up only if transcoders are inserted in the path. In case two transcoders in tandem (a pair of transcoders with PCM coding between them) are able to communicate to each other (both support TFO), then the inband TFO protocol allows the transcoders to compare coding schemes. If compatible codec types exist, the transcoders are able to overwrite the PCM coding with the pure compressed speech (effectively bypassing the transcoding functions). In-band TFO provides fast fallback mechanisms in case the TFO connection can not be maintained (insertion of CCD, DTMF, tones, etc). In-band TFO provides no direct saving of transmission costs.\nIf the OoBTC fails to establish the TrFO and transcoders are required, then in-band TFO may be used after call set-up. Inband TFO shall be the fallback mechanism when transcoders cannot be avoided, either at set-up or during the communication phase. In-band TFO shall be used for interworking with the 2G systems (e.g. GSM) using PCM coding.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_4.3",
      "section_id": "4.3",
      "section_title": "Lawful interception",
      "content": "The TrFO shall be maintained if the interception is made due to the lawful interception. Two decoders are needed to monitor the TrFO call.\nLawful interception shall not have any influence on the establishment or maintenance of the TrFO connection in order to avoid any audible effect in speech quality or noticeable effect in speech delay to the end users.\nThe existing requirements for lawful interception shall be considered, these are described in [9].",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_5.1",
      "section_id": "5.1",
      "section_title": "Network Model",
      "content": "The codec negotiation mechanism (OoBTC) is designed to work in the general situation where more than two call control (CC) nodes need to participate in the codec negotiation. The codec negotiation mechanism works as follows:\n-\tOriginating CC node: sends its list of supported codec types and options, listed in order of preference.\n-\tTransit CC nodes: if needed, analyse the received list of options, delete unsupported options from the list and forward the list. No modification is done to the preference levels of any of the listed codecs.\n-\tTerminating CC node: analyse the received list of options with their associated priorities and selects the supported option with highest indicated priority appropriate for the call.\nFigure 5.1/1 illustrates the architecture for Rel-4 for UMTS to UMTS TrFO connection. The transit network may exist for calls between PLMNs or between islands of mobile CNs separated by transit networks. This figure is a basic illustration, OoBTC shall apply to other access technologies where the OoBTC procedures are supported, i.e. not limited to this figure. The negotiation occurs at call set-up phase, and possibly later on in the call due to other changes such as handover or relocation. However, as described in the next clause, it shall be possible to modify the selected codec at any moment during the active phase of the call.\nFurther detail of the Call & Bearer Separation for 3GPP is described in [8].\nFigure 5.1/1. Basic Architecture for UMTS to UMTS TrFO Connection\nThe following clauses describe successful call establishment scenarios using the codec negotiation mechanism.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.2",
      "section_id": "5.2",
      "section_title": "Simple call set-up",
      "content": "The signalling flow for the simple call set-up case is illustrated in figure 5.2/1. Codec negotiation is done prior to the establishment of bearer connections, so that appropriate bearer resources are committed to the call. In the proposed sequence, the codec negotiation starts with the IAM message containing the list of supported codec types (in this example v, w, x, y, z), sent by the Originating MSC (O-MSC). Transit nodes may puncture out (i.e. delete) codec types from the list (in this example y). The terminating MSC (T-MSC) selects the codec type (here v) The selected codec is conveyed in an APM message, together with the remaining list of alternative, but currently not selected codec types (here v, x, z).\nFigure 5.2/1. Basic Codec Negotiation Sequence\nThe codec list for BICC is specified according to [7], where each 3GPP codec entry is defined according to [5].",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.3",
      "section_id": "5.3",
      "section_title": "Media Gateway Control for Codec Handling",
      "content": "The general handling of MGW control procedures are detailed in [8]. Specific handling related to the control of the speech encoding is detailed in Figure. 5.3/1. The terms context, termination, streams and stream properties are described in the ITU-T H.248 \"Media Gateway Control Protocol\" [13].\nFigure 5.3/1. MGW control for speech codec\nThe handling of transcoding between one codec type (media stream property applied at one termination) and another codec type (media stream property at other termination) is a function of the MGW. The media stream property for Audio Codec Type is defined in Annex C of the ITU-T MGW control protocol, H.248.\nIf TFO-incompatible codec types are applied at different terminations of the same context, the MGW shall insert a transcoder. For the definition of TFO-compatibility between 3GPP codec types and codec configurations see [10], clauses 11 and 12.\nBetween codecs of the AMR type, the MGW need not insert a transcoder, if the codec types are TFO- compatible according to [10], table 11-1, and\n-\tthe codecs use the same ACS; or\n-\tthe ACSs are TFO-compatible and the use of codec modes is restricted to a common subset of the ACSs by means of maximum rate control. In this case the MGW shall coordinate the rate control request.\nBetween codecs of the AMR-WB type, the MGW need not insert a transcoder, if\n-\tthe codecs use the same ACS; or\n-\tthe use of codec modes is restricted to a common subset of the ACSs by means of maximum rate control. In this case the MGW shall coordinate the rate control request.\nBetween codecs of the EVS type, the MGW need not insert a transcoder, if\n-\tthe codecs use the same ACS; or\n-\tthe use of codec modes is restricted to a common subset of the ACSs by means of maximum rate control. In this case the MGW shall coordinate the rate control request.\nBetween codecs of the AMR-WB type and codecs of the EVS type, the MGW need not insert a transcoder, if\n-\tthe codecs of the EVS family are operating in AMR-WB IO mode; and\n-\tthe codecs use the same ACS or the use of codec modes is restricted to a common subset of the ACSs by means of maximum rate control. In the latter case the MGW shall coordinate the rate control request.",
      "chunk_type": "general",
      "cross_references": [
        "table_11-1",
        "figure_5.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.4.1",
      "section_id": "5.4.1",
      "section_title": "Framing Protocol Initialisation",
      "content": "For TrFO calls the compressed speech is carried end to end (RNC to RNC or between RNC and other compressed voice terminal). In 3GPP Core Networks compressed voice framing protocol shall be specified by the Nb User Plane specification. The specification for Iu interface is defined in [4], the specification for the Nb interface is defined in [12]. The framing protocol for these interfaces is the same, Iu framing and is thus described as such, for both the Iu interface and the Nb interface. For compressed voice only the support mode is used, thus for TrFO the UP Initialisation procedure defined for the Nb UP shall be supported by the CN, when a CN MGW is required to establish a connection.\nWhen negotiating TrFO OoB, a given serving MSC server shall consider the capabilities of the RNCs and MGWs, which are candidates to handle the TrFO call and which are controlled by this MSC server via an Iu/Mc interface. For TrFO, the selected RNC and MGW have to be able to support at least one Iu/Nb UP version with TrFO capabilities. Each MGW and RNC that supports TrFO shall support Iu/Nb UP version 2. If an RNC only supports Iu UP version 1 without TrFO capabilities, the MSC server shall insert a transcoder at the MGW that is connected to this RNC. For a TrFO call, each MSC server shall indicate in the \"RAB assignment\"/\"Add request\" only UP versions with TrFO capabilities. In the inband UP framing protocol version negotiation during framing protocol initialisation, the informed RNCs/MGW shall only offer and/or accept UP version listed in the \"RAB assignment\"/\"Add request\".\nThe Iu framing Protocol is established through the CN in a forward direction, independently of the bearer establishment direction. The Notify message to indicate bearer establishment shall not be sent until the Iu framing has been initialised. The continuity message (COT) shall not be sent forward until the Notify message has been received from the MGW and also the COT from the previous server has been received. The sequences for mobile originated calls are shown in figures 5.4/1 and 5.4/2 for forward bearer and backward bearer establishment, respectively. The parameters in the Add Request messages in the Figures are described in further detail in clause 5.4.5.\nFigure 5.4.1/1: Iu Framing Protocol Establishment, Forward Bearer\nFigure 5.4.1/2: Iu Framing Protocol Establishment, backward bearer.\nThe transport independent call control procedures in [8] shall support a continuity mechanism, as described above.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.5",
        "figure_5.4.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.4.2",
      "section_id": "5.4.2",
      "section_title": "RFCI Storage",
      "content": "The RNC shall allocate RAB Subflow Combination Indicators to the SDU formats (SDU formats sent to the RNC by the MSC in the RAB Assignment). This allocation is then sent in the Iu Framing Initialisation PDU by the RNC in the User Plane. For further details see [3] and [4].\nDuring the TrFO call establishment each MGW linked into the call shall store the RFCIs received from Iu Framing PDU Type 14. The first subflow combination in the initialisation frame corresponds to an Initial Rate Control, i.e. indicates the highest rate for the first speech mode to be used in the direction of the Initialisation Acknowledgement frame.\nAfter the out of band codec negotiation has been performed, if the originating side is a UTRAN, then on request from the MSC for a RAB Assignment, it shall initiate the Iu user plane. If the originating side is a network that does not support Iu Framing then the Iu Framing initialisation is initiated by the GMSC, as described in detail in Clause 6.7. An Initialisation Protocol Data Unit (PDU) shall be sent to the first MGW in the call connection. Each initialisation leg is acknowledged per TrFO Link, i.e. per MGW-MGW interface. The subsequent initialisation is performed using the same RFCI set as received from the preceding node, independently of the Stream mode directions (i.e. if the terminations are not through connected).\nThis is shown figure 5.4.2/1.\nFigure 5.4.2/1: RFCI Storage and subsequent initialisation in MGW\nWhen the MGW terminations are through-connected and the RFCIs at both terminations are matching, then the MGW may revert to transparent mode; the RNCs shall not perform any subsequent Iu Framing initialisations without explicit request by the serving MSCs.\nAll succeeding MGWs in the path shall behave in a similar way as described above.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_6.7",
        "figure_5.4.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.4.3",
      "section_id": "5.4.3",
      "section_title": "RFCI Value Correction",
      "content": "At the terminating end of a TrFO connection with Iu Framing initialised to the terminating MGW, the originating RFCI allocation is stored. The terminating RNC is then requested to perform a RAB Assignment towards the terminating MGW. This results in an Iu Framing initialisation, where the allocation of the RFCI values is independent from the Originating RNC's allocation. These values may then be different to the originating RNC's set.\nThe terminating MGW shall acknowledge the Iu Framing Initialisation and compare the RFCI values stored from the originating side. If the allocated index values do not match, then the MGW shall perform one of the following procedures:\n1)\tinitiate an Iu Framing Initialisation PDU towards the terminating RNC with the RFCI allocation as defined by the preceding node (previously stored in the MGW. This behavior is shown in figure 5.4.3/1 and termed \"RFCI value correction\") As the first Subflow combination received from the terminating RNC corresponds to an initial (maximum) rate control the MGW shall send a Rate Control PDUindicating this maximum speech mode back to the preceeding node in the core-network.\n2)\tmap the RFCI indices of the incoming side to the corresponding RFCI indices at the outgoing side for all SDUs passed between the Iu Framing protocol terminations. As the first Subflow combination in the IuUP initialisation corresponds to an initial rate control, i.e. indicates maximum rate for the mode to be used (in direction of Initialisation acknowledgement frame) it is treated as the initial maximum rate control (see [4]) the MGW shall initiate a Rate Control PDU indicating this maximum speech mode toward the terminating RNC. Similarly as the first Subflow combination received from the terminating RNC corresponds to an initial (maximum) rate control the MGW shall send a Rate Control PDUindicating this maximum speech mode back to the preceding node in the core-network. For further details on the rate control see clause 5.7.\nFigure 5.4.3/1:RFCI Value Correction\nFurther details of the TrFO call establishment are described in clause 6.\nThis resolution handling is required also during RNC relocation; further details are described in clause 6.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.7",
        "clause_6",
        "figure_5.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.4.4",
      "section_id": "5.4.4",
      "section_title": "TrFO Break",
      "content": "The event and procedure when a TrFO connection must be interrupted at a certain point in the path, e.g. due to a supplementary service invocation or for handover/relocation, is termed \"TrFO Break\". A TrFO Break may occur at a MGW as a consequence of a command directed by the associated Server. During this period the Iu User Plane protocol is terminated by this MGW, in general at both sides of the MGW. This means that it must respond to new Initialisation PDUs and Inband Rate Control PDUs. The MGW inserts a TrFO Break Function, which then makes use of the stored RFCI values, in order to perform the required Iu Framing protocol functions and interpret the payload. Further call scenarios for specific services that incur a TrFO break are described in clause 6..",
      "chunk_type": "general",
      "cross_references": [
        "clause_6"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.4.5",
      "section_id": "5.4.5",
      "section_title": "TrFO Break Recovery",
      "content": "During the TrFO break situation the individual connections are free to change, the RFCIs may have changed and also the rate control (maximum rate, current rate). After the service that caused the TrFO break is complete, the MGW shall check if TrFO.can be re-established. If the coding schemes are matching but the RFCI's have changed then RFCI value correction can be performed at the RNC side. In order to correct any changes in rate control between two RNCs, the MGW shall send a rate control request from each Termination, with the current rate and maximum rate applied at the other Termination. This will then result in the Distributed Rate Decision between the two RNCs in the call.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_5.4.6",
      "section_id": "5.4.6",
      "section_title": "MGW Control Protocol Iu Framing Package properties",
      "content": "The following is a summary of the Iu Framing H.248 requirements; the procedures are described in [12] and are valid for Iu Framing in Support Mode:\nAdditional Package Properties:\nIu Framing Termination Type: Values -\tIu-RAN\t(Iu Framing Protocol on Iu Interface)\n-\tIu-CN\t\t(Iu Framing Protocol on Nb Interface)\nIu Framing Initialisation Procedure:\tValues – Incoming (For Iu-CN: the Iu Framing Protocol initialisation is received by the media gateway and used for subsequent initialisation from this MGW. For Iu-RAN this indicates the originating RNC interface).\n-\tOutgoing (For Iu-CN the Iu Framing Protocol is generated by the core network MGW, i.e. initialised on the Nb Interface. For the Iu-RAN interface this specifies the terminating RNC Interface)",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_5.5",
      "section_id": "5.5",
      "section_title": "TrFO/TFO Codec Negotiation Harmonisation",
      "content": "When OoBTC procedures are initiated to a node where compressed voice cannot be supported (either at the node or to the preceding node) then a transcoder is inserted. This can be due to the transport technology (e.g. TDM) or due to the access technology (e.g. GSM with TDM based A-interface). The OoBTC procedures can result in the following call scenarios:\nFigure 5.5/1: Cascaded TrFO & Transcoding\nIn Figure 5.5/ 1 the OoBTC cannot proceed as the call crosses a transit network that does not support compressed voice. The same could occur if the transit network did not support out of band codec negotiation (Support in BICC is optional).\nIn Figure 5.5/2 the OoBTC procedures result in the call terminating to a TDM based GSM access. As the GSM radio access transcodes to default PCM codec, the OoBTC results in default PCM selected. The reply is passed back to the originating network, which then inserts a transcoder from default PCM to AMR or EVS for the UMTS radio access.\nFigure 5.5/2: UMTS to GSM interworking\nIn a similar situation to that described in Figure 5.5/2, it is also possible that the OoBTC procedures result in UMTS_AMR_2 as the selected codec, as this is compatible with FR_AMR codec.  This is the optimal codec selection for speech quality purposes.  In this case, the transcoder shall be inserted at the terminating MGW in order to transcode between PCM and UMTS_AMR_2, and UMTS_AMR_2 shall be signalled back to the originating UE.  TFO can then be used on the terminating A-interface to allow FR_AMR to be passed between the tandemed codecs, allowing the best speech quality in the core network.\nFurther to the scenario described above in Figure 5.5/2, where there is no TFO compatible codec between the UMTS UE and the GSM MS it is also possible that the OoBTC procedures result in UMTS_AMR or UMTS_EVS as the selected codec.  In this case, the transcoder shall be inserted at the terminating MGW in order to transcode between PCM and UMTS_AMR (as an example), and UMTS_AMR shall be signalled back to the originating UE.  Bandwidth savings and avoiding degradation in speech quality are then achieved in the core network.\nFor TFO to establish between the transcoders in the above scenarios, each TRAU must send a codec list inband after the call has been established. If a common codec type is available (determined by pre-defined rules, described in TFO specification [10]) then the OoBTC procedures need to be informed so that a codec modification can be performed. This is shown in Figure 5.5/3. Note – a modification could also be required when a common codec type has been selected but the ACS is not common.\nFigure 5.5/3: TFO support by OoBTC signalling\nIn H.248, the vertical MG control protocol, the coding types are specified by Media Stream Property, as defined by Annex C of H.248 specification. A specific package is used for TFO (see [12]).\nThe basic requirements are listed below:\ni)\tProperty for TFO Codec List (same format as for [5])\nii)\tEvent for Optimal Codec, as determined by TFO in-band protocol\niii)\tEvent for Distant Codec List sent by the distant TFO partner\niv) Event for TFO status\nv)\tProcedures to define and enable TFO\nThe TFO package allows the Server to request the MGW to initiate the TFO in-band protocol towards a far end transcoder. The package includes a property to turn on/off the TFO (tfoenable); this may be required prior to TrFO break situations such as handover.\nThe TFO Codec List (H.248) is passed via the Mc interface from the Server to the MGW. The first entry of the TFO Codec List (H.248) shall be used by the MGW as the 'Local Used Codec' (see 3GPP TS 28.062[10]). All the entries of the TFO Codec List (H.248) shall be used by the MGW as Local Codec List in the TFO in-band negotiation. For adaptive multi-rate codecs (AMR and AMR-WB codecs) some control of the level of negotiation is performed by the \"Optimization Mode\" parameter in the respective Single Codec information element in the TFO Codec List (H.248) (see [5] and [12]). This allows a node to indicate if the offered ACS may be modified or not during TFO procedures, and this is mapped to the appropriate parameter in the TFO protocol by the MGW. If for a Single Codec information element in the TFO Package from the Server to the MGW the OM is set to \"Optimization of the ACS not supported\", then the TFO Negotiation shall not change the offered ACS of the respective Single Codec information element.\nThe MGW returns Notification Events for the Distant Codec List sent by the far end and the Optimal Codec Type as selected by the Codec Selection mechanism in TFO. The first entry of the Distant Codec List (H.248) is the 'Distant Used Codec' (see 3GPP TS 28.062[10]) as received by the MGW during TFO in-band negotiations. All the entries of the Distant Codec List (H.248) are the entries of the Distant Codec List as received by the MGW from the distant TFO Partner. The Server then compares the Distant Codec List (H.248) with its previously negotiated Available Codec List (BICC). If the lists are not the same then an OoBTCCodec List Modification or Mid-call Codec Negotiation may be performed. If for a Single Codec information element in the TFO Package from the MGW to the Server the OM is set to \"Optimization of the ACS not supported\", then the offered ACS of the respective Single Codec information element shall not be changed during OoBTC procedures.\nIf the TFO Status event is supported by the MGW and has been configured by the MSC Server, the MGW shall return notification indicating whether a TFO link has been established or broken. The MGW should not report transient TFO status change.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.5",
        "ts_28.062"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.6.1",
      "section_id": "5.6.1",
      "section_title": "Signalling between UE and MSC",
      "content": "The default Codec Type for \"R99 UMTS only\" terminals is UMTS_AMR, the default Codec Type for all terminals supporting GSM and UMTS radio access is UMTS_AMR_2, (see [5] for the detailed description). The UMTS_AMR_2 is a superset of the UMTS_AMR. It behaves as a FR_AMR codec in the UL and as a UMTS_AMR codec in the DL. This allows all UMTS terminals, except R99 UMTS only terminals, to operate in TFO with GSM terminals. The UMTS_AMR_2 is fully compatible with R99 CN nodes (TC in MGW). In any multi-mode configuration the UMTS_AMR shall be treated as only TFO and TrFO compatible to itself, not to any other AMR codec Type, to avoid incompatibilities in TFO-TrFO-TFO interworking scenarios. In single mode configuration, UMTS_AMR and UMTS_AMR_2 are TFO and TrFO compatible, when both codec types use the same single rate ACS, (see [10]).\nDuring call setup, a UE supporting Rel-4 or later releases will indicate to the MSC the codecs supported by the UE in the Supported Codecs List (DTAP) (see [2]). For the codecs in this Supported Codecs List (DTAP), no order of priority is defined.\nIf no Supported Codecs List (DTAP) is received and the UE is \"UMTS only\", then the MSC shall assume UMTS_AMR as supported Codec Type.  If no Supported Codecs List (DTAP) is received, but the UE is \"dual system\", then the MSC shall assume UMTS_AMR_2 as the supported codec type. The MSC shall assume \"dual system\" support only if the UE indicates at least one GSM speech version in Octet 3a etc. of the Bearer Capability.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_5.6.2",
      "section_id": "5.6.2",
      "section_title": "Node originating the OoBTC codec negotiation",
      "content": "The node originating the OoBTC codec negotiation shall implement the procedures described in Q.1902.4, clause 8.3.1 [6]. Additionally, the following applies:\nIn UTRAN, GERAN Iu mode or GERAN AoIP mode, when constructing the list of codecs (and configurations for AMR, AMR-WB or EVS codecs) for the Supported Codecs List (BICC), the MSC Server should take the codec types and codec configurations supported by the RNC or BSC into account (see clause 5.6.6 for UTRAN or GERAN Iu mode and clause 5.6.7 for GERAN AoIP mode). The MSC may include more than one Single codec element indicating the same codec type, but different configurations, in the Supported Codecs List (BICC) (see [5]).\nNOTE 1:\tThis may be necessary, e.g. if the RNC supports for an AMR codec different sets of codec modes, e.g., (a, b, c, d) and (e, f, g), which are not subsets of each other, and the RNC does not support combinations of these sets, e.g.  (a, b, c, d, e, f, g).\nFor AMR codecs the originating CN node shall use the \"Optimization Mode\" parameter in the Single Codec information element in the Supported Codec List (BICC) (see [5]) to indicate whether or not other nodes may change the offered ACS.\nEXAMPLE:\tAn RNC implementing only the prioritised RABs for interoperability testing specified in [18] will support for the UMTS_AMR_2 codec e.g. the set of codec modes (12.2, 7.4, 5.9, 4.75), but none of its subsets containing 2 or 3 codec modes. If the MSC Server connected to this RNC includes the codec configuration (12.2, 7.4, 5.9, 4.75) in the Supported Codecs List (BICC), it will therefore set the OM parameter of the respective Single Codec information element to \"Optimization of the ACS not supported\".\nFor AMR codecs, if the OM is set to \"Optimization of the ACS supported\", the originating CN node shall indicate the maximum number of codec modes (MACS) that may be selected for the ACS during speech codec negotiation. This maximum number of codec modes may depend on optimization strategies applied by the originating CN node. The recommended value is 4 (see [10]).\nFor AMR-WB codecs the \"Optimization Mode\" is defined implicitly by the configuration parameter \"Config-WB-Code\" in the Single Codec information element (see [5]). If for a configuration the OM is set to \"Optimization of the ACS supported\", then the configuration may be changed to any other allowed configuration specified in [5].\nNOTE 2:\tFor the UMTS_EVS codec type, there is no \"Optimization Mode\" parameter included in the Single Codec information element or in the allowed configurations (see [5]). The \"Optimization Mode\" parameter is not used.\nFor the UMTS_EVS codec type, the originating CN node shall include at least configuration 0, 1 or 2 (see [5], table 5.7A-1) in the Single Codec information element, and it may also include configuration 3, as follows:\n-\tif only one configuration is included, it shall be configuration 0, 1 or 2 in octet Config-EVS, and octet Config-EVS2 shall not be included; and\n-\tif two configurations are included, configuration 3 shall be included in octet Config-EVS, and configuration 0, 1 or 2 shall be included in octet Config-EVS2.\nIn order to support interworking with 2G systems it is recommended that MGWs support 2G codecs (GSM_HR, GSM_FR, GSM_EFR, PDC_EFR, TDMA_EFR). In order to avoid modifications during handover between 2G and 3G systems the MSC nodes may give preference to a suitable 2G codec.\nWhenever one or several TrFO links have been already established and initialised, the CN node (e.g. the serving CN in case of Call Hold scenarios, the visited CN node in case of Call Forwarding scenarios, etc.) initiating a subsequent codec negotiation on a new call leg or a mid-call codec negotiation on an established and initialised TrFO link, should give the already negotiated Selected Codec (BICC), including its ACS, highest preference to reduce the probability of having to perform a bearer re-establishment or UP re-initialisation of the already established and initialised TrFO links.\nThe creation of a \"structured\" Supported codec list shall be as described for SIP-I (see Clause 9.7.2).\nNOTE 3:\tThe auxiliary payload types do not apply to BICC.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.3.1",
        "clause_5.6.6",
        "clause_5.6.7",
        "clause_9.7.2",
        "table_5.7",
        "table_2"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.6.3",
      "section_id": "5.6.3",
      "section_title": "Intermediate node",
      "content": "An intermediate node taking part in an OoBTC codec negotiation shall implement the procedures described in Q.1902.4, clause 8.3.2 [6]. Additionally, the following applies:\nIf a Single Codec information element for an AMR codec is included in the Supported Codecs List (BICC), with the OM set to \"Optimization of the ACS not supported\", the intermediate node shall delete the Single Codec information element\n1)\tif the codec type is not supported; or\n2)\tif one or more codec modes of the offered ACS are not supported.\nIf a Single Codec information element for an AMR codec is included in the Supported Codecs List (BICC), with the OM set to \"Optimization of the ACS supported\", the intermediate node\n1)\tshall delete the Single Codec information element, if the codec type is not supported;\n2)\tshall delete codec modes from the offered SCS and ACS, if they are not supported. If the last codec mode is deleted from the offered SCS, the Single Codec information element shall be deleted from the Supported Codecs List (BICC);\n3)\tshall reduce MACS to a locally supported value, if necessary;\n4)\tmay change the ACS to a different ACS within the offered SCS; and\n5)\tshall change the OM parameter from \"Optimization of the ACS supported\" to \"not supported\", if necessary.\nNOTE:\tIn interworking scenarios with TFO, step (iv) may prevent the establishment of an end-to-end tandem free and transcoder free connection; therefore, the intermediate node should not do this without a good reason.\nDuring the processing of a Single Codec information element of an AMR codec with the OM set to \"Optimization of the ACS supported\", the intermediate node may replace the original Single Codec information element by two or more new Single Codec information elements, which can be derived from the original Single Codec information element by the steps (i) to (v) listed above.\nIf a Single Codec information element for an AMR-WB codec is included in the Supported Codecs List (BICC), the intermediate node shall\n1)\tdelete the Single Codec information element, if the codec type or codec configuration is not supported; or\n1)\treplace a Single Codec information element with configuration 1, 3, or 5 (see [5], table 5.7-1) by a Single Codec information element with configuration 0 and, optionally, another Single Codec information element with configuration 2 or 4, if configuration 3 or 5 is not supported.\nIf a Single Codec information element for the UMTS_EVS codec type is included in the Supported Codecs List (BICC), the intermediate node shall:\n1)\tdelete the Single Codec information element, if the codec type or codec configuration is not supported;\n2)\treplace the Single Codec information element with configuration 2 (see [5], table 5.7A-1) by the Single Codec information element with configuration 0 or 1, if configuration 2 is not supported;\n3)\treplace the Single Codec information element with configuration 1 (see [5], table 5.7A-1) by the Single Codec information element with configuration 0, if configuration 1 is not supported; or\n4)\treplace configuration 3 (see [5], table 5.7A-1) with configuration 0, 1 or 2 in octet Config-EVS of the Single Codec information element, and remove octet Config-EVS2 from the Single Codec information element, if configuration 3 is not supported.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.3.2",
        "table_5.7-1",
        "table_5.7"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.6.4",
      "section_id": "5.6.4",
      "section_title": "Node terminating the OoBTC codec negotiation",
      "content": "The node terminating the OoBTC codec negotiation shall implement the procedures described in Q.1902.4, clause 8.3.3 [6]. Additionally, the following procedures apply:\nThe terminating node shall process the Supported Codecs List (BICC) as described for the intermediate node in clause 5.6.3.\nIn UTRAN, GERAN Iu mode or GERAN AoIP mode, when processing the codec types (and configurations for AMR, AMR-WB or EVS codecs) in the Supported Codecs List (BICC), the terminating MSC Server should take the codec types and codec configurations supported by the terminating RNC or BSC into account (see clause 5.6.6 for UTRAN or GERAN Iu mode and clause 5.6.7 for GERAN AoIP mode).\nFor the selection of the Selected Codec (BICC) from the Supported Codecs List (BICC), the following additional procedures apply:\nIf an adaptive multi-rate codec is selected, then the decision about the actual codec modes to be included in the selected ACS shall also be made by the terminating CN node. If the OM of the offered configuration is set to \"Optimization of the ACS supported\", the selected ACS may be different from the offered ACS, but it shall be a subset of the offered SCS and be consistent with MACS.\nIn order to provide harmonisation of out of band codec negotiation (for TrFO) and inband codec negotiation (for TFO) similar codec type and codec configuration selection mechanisms as those being defined for TFO should be applied for TrFO (see [10]).\nNOTE 1:\tFor TrFO codec negotiation, besides the speech quality additional aspects may be considered which are not applicable to TFO, e.g. the location of the transcoder that may need to be inserted or possible bandwidth savings in the core network.\nIf an adaptive multi-rate codec is selected, the terminating MSC Server shall exactly specify the ACS in the Selected Codec (BICC) and set the OM to \"Optimization of the ACS not supported\".\nIn the Available Codecs List (BICC), sent back to the originating node, the terminating MSC server may include more than one Single Codec information element indicating the same codec type, but different configurations. Single Codec information elements for adaptive multi-rate codecs may also be included with the OM set to \"Optimization of the ACS supported\" and the ACS being a subset of the SCS.\nAccording to Q.1902.4, clause 8.3.3 [6], the terminating node shall include the Selected Codec (BICC) in the Available Codecs List (BICC). For AMR, AMR-WB and EVS codecs, the following applies:\nIf the Selected Codec (BICC) is an AMR codec, it shall be considered as included in the Available Codecs List (BICC), if the Available Codecs List (BICC) contains a Single Codec information element with the same codec type and:\n-\texactly the same configuration, i.e. the same ACS and the OM set to \"Optimization of the ACS not supported\"; or\n-\tthe Selected Codec (BICC) is consistent with the Single Codec information element, i.e. the selected ACS is a subset of the SCS of the Single Codec information element, the Number of codec modes in the selected ACS is less or equal to the MACS parameter of the Single Codec information element, and the OM of the Single Codec information element is set to \"Optimization of the ACS supported\".\nIf the Selected Codec (BICC) is an AMR-WB codec, it shall be considered as included in the Available Codecs List (BICC), if the Available Codecs List (BICC) contains a Single Codec information element with the same codec type and:\n-\texactly the same configuration, i.e. the same the configuration parameter \"Config-WB-Code\"; or\n-\tany configuration for which the OM is set to \"Optimization of the ACS supported\".\nIf the Selected Codec (BICC) is an EVS codec, it shall be considered as included in the Available Codecs List (BICC), if the Available Codecs List (BICC) contains a Single Codec information element with the same codec type and exactly the same configuration, i.e. the same the configuration in parameter \"Config-EVS-Code\" or parameter \"Config-EVS-Code 2\".\nAdditionally, if the Selected Codec (BICC) is an EVS codec, the terminating MSC Server shall specify exactly one configuration as per the rules specified in [5], table 5.7A-3, and indicate this configuration in octet Config-EVS of the Selected Codec (BICC).\nThe creation of a \"structured\" Available codec list shall be as described for SIP-I (see Clause 9.7.3).\nNOTE 2:\tThe auxiliary payload types do not apply to BICC.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.3.3",
        "clause_5.6.3",
        "clause_5.6.6",
        "clause_5.6.7",
        "clause_9.7.3",
        "table_5.7"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.6.5",
      "section_id": "5.6.5",
      "section_title": "Signalling between server and MGW",
      "content": "According to Q.1902.4, clause 8.3 [6], during the OoBTC codec negotiation a server can provide its associated MGW with the preferred codec from the Supported Codecs List (BICC), and as a result of the negotiation the server will provide its associated MGW with the Selected Codec (BICC). The information is sent via the Mc interface as Codec (H.248).\nIf the Codec (H.248) is an adaptive multi-rate codec, the server shall exactly specify the ACS in the respective Single Codec information element and set the OM to \"Optimization of the ACS not supported\", both for the preferred codec and the Selected Codec (BICC).\nFor the Single Codec information elements of adaptive multi-rate codecs in the TFO Codec List (H.248), the OM may be set to \"Optimization of the ACS supported\", and the ACS may be a subset of the SCS. This applies also to the first entry in the TFO Codec List (H.248), the Local Used Codec.\nNOTE:\tIn some scenarios the flexible configuration of the Local Used Codec may be used for a faster TFO establishment (see [10]).",
      "chunk_type": "general",
      "cross_references": [
        "clause_8.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.6.6",
      "section_id": "5.6.6",
      "section_title": "Signalling between MSC and UTRAN or GERAN Iu-mode",
      "content": "The MSC Server shall know the codec types and codec configurations supported by the RNC. The MSC Server shall select only from these configurations for the RAB assignment.\nFor GERAN Iu-mode the MSC Server receives a list of codec types (for definition see [15]) as well as the supported codec modes (for an adaptive multi-rate codec type) within the RANAP INITIAL UE MESSAGE, indicating the GERAN capabilities, which will be available at the RAB establishment procedure. With this information the MSC Server shall delete those codec types and codec modes (for an adaptive multi-rate codec type) from the Supported Codecs List (BICC) which are not supported by the GERAN, taking into account the GERAN classmark and the MS capabilities. This possibly reduced list shall be used by the MSC Server during the codec negotiation procedure. The value of the maximum number of supported codec modes shall be set to 4 (see [10]).\nWhen the MSC node requests a RAB assignment the Subflow Combinations provided shall either all be initialised by the RNC or all rejected with appropriate cause code.\nThe MSC shall always assume \"Discontinuous Transmission (DTX)\" as mandatory and shall define \"SID\" SDUs in addition to the negotiated speech codec modes. This is because for TrFO the RAB requested by one RNC must match that requested by the peer RNC – they are effectively the same RAB. If one MSC requires DTX support then the RAB requested by the far end MSC must also support DTX (even if it is not desired by that MSC). As no Out Of Band negotiation for DTX is supported nor DTX control to the UE, DTX shall be mandatory for TrFO connections.\nOnce an adaptive multi-rate codec with an ACS has been selected as Selected Codec (BICC), the MSCs shall indicate in the RAB Assignment parameters [3] for the Guaranteed Bitrate the lowest speech mode in the ACS (assuming any SID frames are smaller than the SDU for lowest speech mode, otherwise the Guaranteed Bitrate shall be set to the largest SID frame). The Maximum bitrate shall correspond to the highest mode in the ACS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_5.6.7",
      "section_id": "5.6.7",
      "section_title": "Signalling between MSC and GERAN AoIP-mode",
      "content": "In both mobile originating and mobile terminating calls the MSC Server receives the Supported Codecs List (BSSMAP) – \"BSC-SCL\" - containing a list of Codec types (for definition see 3GPP TS 48.008 [15]) as well as the codec configurations (for adaptive multi-rate codec types) within the BSSMAP COMPLETE LAYER 3 INFORMATION message, indicating the temporary GERAN capabilities for this call in this cell.\nThe Codec Types within this BSC-SCL can be viewed as divided into three different A-Interface types:\n1)\tCodecs with PCM only on the A-Interface – transcoding always occurs inside the BSS.\n2)\tCodecs with transcoding inside the BSS, but supported with TFO on the A-Interface.\n3)\tCodecs supported with \"Full IP\" for the A-Interface – no transcoding inside the BSS.\nThese are described in detail in 3GPP TS 48.008 [15], clause 3.2.2.103.\nThese A-Interface types may then be used by the MSC to create a structured \"Supported Codec List\", with Direct Codecs and Indirect Codecs, as described in clause 9.7.2.\nWhen creating  the Supported Codecs List (BICC or SIP-I), only codecs supported in GERAN with either \"Full IP\" or TFO shall be included in the \"direct\" part of the Supported Codecs List (BICC or SIP-I), if also the MS and the MGW support them in this way. Codec types and codec configurations not supported in GERAN (with either Full IP or TFO) or MS, but supported by the MGW with transcoding,  may be negotiated as \"indirect\" codec types.\nThis potentially reduced direct codec list and potentially increased indirect codec list shall be used by the MSC Server during the codec negotiation procedure.\nDuring the Assignment procedure, the MSC server shall include the MSC-Preferred-Codec-List (BSSMAP) as defined in 3GPP TS 48.008 [15] clause 3.2.2.103.",
      "chunk_type": "general",
      "cross_references": [
        "ts_48.008_clause_3.2.2.103",
        "clause_9.7.2",
        "ts_48.008"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.7",
      "section_id": "5.7",
      "section_title": "Inband Rate Control",
      "content": "Inband rate control shall only allow the RNCs to set the maximum codec mode (maximum bitrate) from the set of codec modes that have been negotiated out of band. This procedure is called Maximum Rate Control. The final maximum mode selected results from a rate control request from one side and the maximum rate supported at the receiving side; the lower rate of these is selected. This is known as Distributed Rate Decision. In TrFO maximum rate control shall be supported through the Iu Framing protocol and through transit networks supporting compressed voice. The maximum rate control procedures are further defined within the Iu Framing protocol [4].\nWhen the MSC requests for a RAB to be assigned, it shall always define 1 speech mode SDU (lowest rate), and DTX SDU as non-rate controllable. Other SDU formats for higher rates shall be defined as rate controllable. The first subflow combination in the IuUP initialisation shall be treated as an initial maximum rate control.  Where a node is in TrFO break (e.g. the terminating MGW) this initial maximum rate control received at a given MGW/IuUP termination shall be signalled to the other TrFO link using the IuUP Rate Control PDU unless the IuUP Initialisation frame is to be sent on to the next link as in RFCI Value Correction (see clause 5.4.3).\nAt SRNS relocation the new RNC shall send a rate control frame at Relocation Detect indicating its current maximum rate, it will receive in the acknowledgement the current maximum rate from the far end. This procedure is called Immediate Rate Control. Again the distributed rate decision means both RNCs will operate within a common limit.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.4.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8",
      "section_id": "5.8",
      "section_title": "Modification Procedures",
      "content": "The OoBTC procedures shall support the following modification mechanisms:\ni)\tModification of Selected Codec. (The codec type of the Selected Codec (BICC) may be switched to another type within the Available Codecs List (BICC), and/or the Active Codec mode Set of the Selected Codec (BICC) may be modified, and/or the Supported Codec mode Set of the Selected Codec (BICC) may be reduced.)\nii)\tModification of Available Codecs List(The Available Codecs List (BICC) may be reduced by removing codec types and modes)\niii)\tMid-call Codec Negotiation(The Available Codec List (BICC) is re-negotiated, allowing the addition and removal of codec types and modes compared to the previous Available Codec List (BICC), and a new Selected Codec (BICC) is chosen out of the new Available Codec List (BICC))\nThe specific call flows when such procedures may be required are detailed in Clause 6. Further information on the Available Codecs List (BICC) and the Selected Codec (BICC) is provided in clause 5.2. Further information on codec types, codec modes, a Supported Codec mode Set and an Active Codec mode Set is provided in TS 26.103 [5].  The basic codec negotiation principles are defined by the BICC Call Control Procedures (see [6]) but the explicit Mc interface procedures are added.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6",
        "clause_5.2",
        "ts_26.103"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8.1",
      "section_id": "5.8.1",
      "section_title": "Modification of Selected Codec",
      "content": "The codec modification procedures shall support the following changes:\n1)\tchange of the  codec type or codec configuration of the current Selected Codec (BICC) to another codec type or codec configuration within the Available Codecs List (BICC);\n2)\tmodification of the Available Codecs List (BICC) according to clause 5.8.2, (i) to (v), in combination with any change of the codec type or codec configuration of the current Selected Codec (BICC) to another codec type or codec configuration within the new Available Codecs List (BICC). The modification of the Available Codecs List (BICC) may include removal of the current Selected Codec (BICC) from the list.\nThe procedures described in Q.1902.4, clauses 10.4.1 to 10.4.3 [6] shall apply.\nThe new codec type and codec configuration may be selected freely from the Available Codecs List (BICC). For an AMR codec, AMR-WB or EVS codec, a codec configuration may be selected if it is considered to be included in the Available Codecs List (BICC) according to the criteria specified at the end of clause 5.6.4.\nFor the coding of the new Selected Codec (BICC), the new Available Codecs List (BICC), and the new Codec (H.248), the same rules apply as specified in clauses 5.6.4 and 5.6.5.\nIn Figure 5.8.1/1 and 5.8.1/2 the basic codec modification procedure is shown. This Figure is an example; the codec modification procedure may be initiated by any node within the call.\nUpon Reception of a Modify Codec message (action 5 and 9 in Figure 5.8.1/1), a server node shall check if the Selected Codec is altered according to the criteria above. If the Selected Codec is not altered, the procedures in clause 5.8.2 (Modification of the Available Codec List) apply, otherwise the server node shall send a \"Reserve Characteristics\" procedure to the attached MGW for the corresponding termination (action 6 and 10 in Figure 5.8.1/1\nTo perform a modification of the selected codec at an Iu interface, the MSC server shall send a \"Modify Bearer Characteristics\" procedure to the attached MGW (action 1 and 12 in Figure 5.8.1/1). Upon completion of the \"Modify Bearer Characteristics\" procedure, the server node shall send a \"RAB Assignment Request\" to the radio access network (action 2 and 13 in Figure 5.8.1/1). The MSC server shall then wait to receive a corresponding \"RAB Assignment Response\" message from the radio access network (action 3 and 14 in Figures 5.8.1/2 and 5.8.1/3) before continuing the modification procedure.\nAn MSC server shall use the \"Reserve Characteristic\" procedure for the termination towards the preceeding node (with respect to the Modify Codec message) to perform the necessary bearer level modification. The MGW shall respond for that termination with the \"Bearer Modified\" procedure to indicate that the possible bearer modification to increase bandwidth was successful. The MGW shall not wait until the Iu UP initialisation is complete before replying with the \"Bearer Modified\" procedure.  Each server shall not send forward the modify request to the succeeding node until the indication from its MGW that any necessary bearer level modification has been completed (BNC_Modified notification). The MSC server shall use the \"Confirm Characteristics\" procedure to confirm the modification at that termination.\nAn MSC server shall use the \"Modify Characteristic\" procedure for the termination towards the succeeding node (with respect to the Modify Codec message) to confirm the codec modification.\nThe specific handling of the Iu UP initialisation is described in clause 5.8.4.\nError Cases are described in clause 5.8.5.\nFigure 5.8.1/1: Codec Modification Control Procedures\nFigure 5.8.1/2: Codec Modification acknowledgement",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.6.4",
        "clause_5.8.4",
        "clause_5.8.5",
        "figure_5.8.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8.2",
      "section_id": "5.8.2",
      "section_title": "Modification of Available Codecs List",
      "content": "The modification of the Available Codecs List (BICC) shall support the following changes:\n1)\treduction of the ACS of any Single Codec information element in the Available Codecs List (BICC) for which OM is set to \"Optimization of the ACS supported\";\n2)\treduction of the SCS of any Single Codec information element in the Available Codecs List (BICC) for which OM is set to \"Optimization of the ACS supported\";\n3)\treduction of the MACS of any Single Codec information element in the Available Codecs List (BICC) for which OM is set to \"Optimization of the ACS supported\";\n4)\tchange of the OM of any Single Codec information element in the Available Codecs List (BICC) from \"Optimization of the ACS supported\" to \"not supported\"; and\n5)\tdeletion of one or more Single Codec information elements from the Available Codecs List (BICC).\nThis shall not include the removal of the Selected Codec (BICC) or of modes from the ACS of the Selected Codec (BICC), as this would require a Modification of Selected Codec as described in 5.8.1.\nThe procedures described in Q.1902.4, clauses 10.4.1 to 10.4.3 [6] shall apply.\nFor the coding of the new Available Codecs List (BICC), the same rules apply as specified in clause 5.6.4.\nNo modification of the user plane and signalling towards the MGWs and radio access network is required.\nIn Figure 5.8.2/1 the basic \"modification of available codec list\" procedure is shown. This Figure is an example; the codec modification procedure may be initiated by any node within the call.\nFigure 5.8.2/1: Modification of Available Codec List",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.6.4",
        "figure_5.8.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8.3",
      "section_id": "5.8.3",
      "section_title": "Mid-call Codec negotiation",
      "content": "The Selected Codec (BICC) and the Available Codecs List (BICC) can be (re-) negotiated during the call using the \"Mid Call Codec Negotiation\" mechanism. The Mid-Call Codec Negotiation mechanism results in a new Available Codecs List (BICC), where new codec types or modes not within the previous Available Codecs List (BICC) may be included. The codec negotiation procedure is performed as for call set-up.\nThe procedures described in Q.1902.4, clauses 10.4.4 to 10.4.6 [6] shall apply.\nThe sequence is shown in Figure 5.8.3/1. Starting with the Modify to Selected Codec message, the remaining sequence is the same as for the Codec Modification in clause 5.8.1 except that the message name for the modify request is \"Modify To Selected Codec\" (instead of \"Modify Codec\") in order to allow collisions between the two procedures to be resolved. Everything stated in clause 5.8.1 shall also apply for the Mid-Call Codec Negotiation procedure.\nThe node initiating the \"Mid Call Codec Negotiation\" mechanism (MSC Server A in Figure 5.8.3/1) shall select a Preferred Codec and a Supported Codecs List (BICC), which may contain new codecs and also may not contain codecs from the previous Available Codecs List (BICC). If the list no longer contains the previous Selected Codec (BICC), then a new codec shall be selected as Preferred Codec. If the previous Selected Codec (BICC) exists within the Supported Codecs List (BICC), this codec should be selected as the Preferred Codec.\nIf a server node removes the Preferred Codec, from the Supported Codecs List (BICC), the node shall select a new Preferred Codec.\nFigure 5.8.3/1: Mid Call Codec Negotiation",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.1",
        "figure_5.8.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8.4",
      "section_id": "5.8.4",
      "section_title": "Detailed Procedures For Iu Framing Protocol & Codec Modification",
      "content": "The IuFP must be initialised sequentially from one end to the other in order to store new RFCIs in each node to allow TrFO to resume. The IuFP shall be initialised in the backward direction with respect to the Codec Modification/Modify To Selected Codec message as shown in Figure 5.8.4/1.\nFigure 5.8.4/1: Successful Codec Modification including IuFP\nA MGW receiving a Modify Bearer Characteristics procedure shall be prepared to receive an incoming modify bearer procedure, this may be to increase the bandwidth prior to IuUP Initialisation or to reduce the bandwidth after the IuUP Intialisation.  The new codec indicated in the Modify Bearer Characteristics procedure shall always result in the MGW being prepared to receive an Iu UP initialisation for the new codec, even if the SDU format is unchanged. The MSC shall send the RAB Parameters IE and NAS Synchronisation Indicator IE to the RNC to indicate that the codec has changed and IuUP Initialisation shall be generated..\nEach termination receiving a Reserve_Char will initiate bearer level modification to the preceeding node if needed  - i.e. if the bandwidth needs to be increased to support the new IuUP. No IuUP initialisation occurs at this point in time. If the Codec Modification Request is terminated by a MGW the IuUP init through the core-network is triggered by the setting of the 3GUP package property \"initialisation direction\" to \"OUT\" in either the Reserve_Char or the Confirm_Char procedure; the MGW shall then start the IuUP Initialisation out from that Termination. If the node terminating the modification is an RNC then it will generate a new IuUP Initialisation toward its access MGW, each Termination shall have the initialisation direction set to \"IN\". Each MGW shall in turn acknowledge the IuUP Init to the succeeding node (with respect to the modification request) and forward the RFCIs in an IuUP Initialisation to the preceding MGW (as for call set-up). After completing the Iu UP initialisation and receiving the\"Confirm Characteristics\" procedure, the MGW may decrease the bandwidth of the corresponding bearer performing the \"Modify Bearer\" procedure (if needed) - no bearer bandwidth reduction shall be initiated while the UP is still initialised for the old codec.\nAn example call sequence is shown in Figures 5.8.4/2 and 5.8.4/3.\nFigure 5.8.4/2: Mid Call Codec Negotiation Call Sequence. Call Flow Part 1\nFigure 5.8.4/3: Mid Call Codec Negotiation Call Sequence. Call Flow Part 2",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_5.8.4"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.8.5",
      "section_id": "5.8.5",
      "section_title": "Unsuccessful Codec Modification",
      "content": "If the Codec Modification is unsuccessful at a certain node in the connection (due to the MGW rejecting a request to reserve the resources or a server rejecting the request to modify the codec) the Confirm_Char message shall be sent to a termination that previously performed a successful Reserve_Char Procedure to change the bearer back to its original bandwidth (if needed) and free up any reserved resources. However as the IuUP has not been modified, the Confirm_Char shall not trigger an IuFP re-initialisation. The basic sequence is shown in Figure 5.8.5/1 and a detailed call flow is described in Figure 5.8.5/2. A server that performed a Modify Bearer Characteristics procedure to a termination with the new codec shall perform a subsequent Modify Bearer Characteristics procedure to that termination with the old codec in the failure case. As no IuFP initialisation occurs in the unsuccessful case the IuFP currently intialised will then match the old codec restored by the subsequent Modify Bearer Char; the MGW then knows that it can return to TrFO.\nThe Codec Modification Failure message shall not be returned to a preceding node until notification of the bearer level modification (BNC_Modified).\nRAB Assigment Modification Failure\nIf the reason for failed codec modification is due to an unsuccessful RAB Modification Request then the MSC shall assume that the old RAB is resumed and thus shall restore the old codec.\nFigure 5.8.5/1: Unsuccessful Codec Modification\nIuUP Initialisation Unsuccessful\nIf the IuUP initialisation fails (this must be due to some protocol error or transmission error because the resources have already been successfully reserved) then the UP protocol is cleared by the peers (see TS 25.415) and therefore the MGW shall notify the Server with a Bearer_Released notification, the call shall be cleared (normal MGW initiated call clearing applies – see TS 23.205 clause 7.4 [8]).\nFigure5.8.5/2: Call Sequence for Unsuccessful Modification. Call Flow Part 1\nFigure5.8.5/2: Call Sequence for Unsuccessful Modification. Call Flow Part 2",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.205_clause_7.4",
        "figure_5.8.5",
        "ts_25.415",
        "ts_23.20"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.9",
      "section_id": "5.9",
      "section_title": "DTMF Handling For TrFO Connections",
      "content": "DTMF from the UE is sent via DTAP procedures out-band. For a TrFO call the Originating MSC shall use an out-band DTMF procedure, all CN nodes shall support this procedure in their call control protocol. The out-band DTMF procedure shall also be used when TrFO is not achieved in order that TFO is possible. Insertion of DTMF in the PCM payload can result in the break of the TFO connection.\nFor terminating calls DTMF may need to be received by the core network (for voice-prompted services, voicemail control procedures etc). If the DTMF is received out-band then out-band procedures shall be maintained in core network.\nIf the DTMF is received for a TrFO call from an external network inband, in I.366.2 profile or RTP payload type, then the gateway MGW which interworks between Iu Framing and the external framing protocol shall report the DTMF tones via H.248 procedures to its server. The server shall then use out-band procedures to pass the DTMF through the CN. See Figure 5.9/1.\nThe same shall apply if a DTMF tone is received for a TrFO call from an external network inband in a PCM coded stream. The DTMF tone shall be detected by the MGW and reported via H.248 procedures to its server. In order to prevent duplication of DTMF tones due to subsequent PCM legs in the call, when encoding to compressed codecs the detected tones shall not be allowed to continue in the compressed stream; the DTMF Digits shall be deleted by the MGW before entering the speech encoding stage.\nThe MGW may also optionally pass DTMF inband where such an option exists for the Nb interface, and is supported by the proceeding MGW.\nTranscoding to default PCM to send DTMF tones shall be avoided for TrFO connections.\nFigure 5.9/1:DTMF received inband from external network",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_5.9"
      ]
    },
    {
      "chunk_id": "ts_23.153_5.10",
      "section_id": "5.10",
      "section_title": "Framing Protocol for GERAN AoIP mode",
      "content": "AoIP user plane does not use IuFP framing protocol or associated 3GUP procedures. Rate control procedures are performed within RTP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_6.1",
      "section_id": "6.1",
      "section_title": "Mobile to Mobile TrFO Call Establishment",
      "content": "Figure 6.1/1: Configuration during Call Setup of a Mobile to Mobile Call\nFollowing network and protocol entities are involved in the scenario, outlined in Figure 6.1/1:\nRNC-T, RNC-O: terminating/originating RNCs.\nMSC Server-T, MSC Server-O: MSC Servers, performing service, i.e. codec negotiation.\nMGW-T, MGW-O: terminating/originating MGWs with the optional capability to insert/remove so called.\nTrFO break equipment: (TBEs), i.e. contexts containing an UTRAN- and a CN side IU Framing termination (T1 – T4), inter-working in a distinct manner on control level. [Note: context is meant to be the H.248 specific throughout the document]. It is aimed to design protocols for TrFO in a way, that these pieces of HW can be removed after call setup phase to allow to revert to \"simple\" AAL2 switching in case of ATM transport.\nIU FP term.T, IU FP term.O: Terminating- and originating-side TrFO peers (IU Framing terminations in RNC's in Figure 6.1/1).\nRANAP, TICC:C-plane protocol incarnations, responsible for codec negotiation, controlling the respective interfaces (IU, NC), creating, modifying, removing etc. terminations and contexts.\nThe final configuration is (at least logically) an end to end TrFO relation between RNC-T and RNC-O with the option to remove the TBEs from the user data path, i.e. to revert to pure AAL2 switching in case of ATM Transport.\nFigure 6.1/2: Call Setup. Mobile to Mobile Call. Message Flow part 1\nFigure 6.1/3: Call Setup. Mobile to Mobile Call. Message Flow part 2\nFigure 6.1/4: Call Setup. Mobile to Mobile Call. Message Flow part 3\nCodec negotiation\nSteps 1. to 6. give the codec negotiation phase. The mobiles inform the network about their capabilities (1. and 4.). Afterwards the MSC-Server performs codec negotiation according to clause 5.6.\nNetwork side bearer establishment\nMSC-T/MSC-O shall request seizure of network side bearer terminations with IuFP properties (see steps 5. and 7.). Intermediate CN nodes that may perform certain service interactions (e.g. IN nodes) have to seize terminations with IuFP properties as well.\nRAB Assignment\nRAN side terminations with IuFP property have to be seized (9. and 17.) before sending RAB Assignment (steps 10. and 18.), that contains RAB parameters according to the selected codec and the negotiated ACS. In addition, the respective NAS synchronisation indicator shall be included.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2",
      "section_id": "6.2",
      "section_title": "SRNS Relocation during TrFO",
      "content": "In order to maintain TrFO connection in SRNS Relocation, procedures specified in 3GPP TS 23.205 [8] and 3GPP TS 23.009 [11] for \"Intra-MSC SRNS Relocation\" or \"Inter-MSC SRNS Relocation\" shall be followed. Note that the \"Intra-MSC SRNS Relocation\" procedure can also be used for relocation between RNCs connected to different 3G MSCs (see  3GPP TS 23.009 [11], clause 1, \"Flexible Iu interface for handover/relocation\" option and \"Intra domain connection of RAN nodes to multiple CN nodes\" option).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.009_clause_1",
        "ts_23.205",
        "ts_23.009"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2.1",
      "section_id": "6.2.1",
      "section_title": "Intra-MSC SRNS Relocation",
      "content": "Figure 6.2/1: Configuration during intra-MSC SRNS Relocation\nFigure 6.1/1 shows the configuration during intra-MSC SRNS relocation. After setting up the new IU interface (towards RNC-A') until releasing the old one, the original TrFO relation (A⇔B) and the target TrFO relation (A'⇔B) exist in parallel. Within the respective context (TBE) interworking between T1, T2 and T3 is necessary:\nT3 will receive initialisation from RNC-A'.\nT2 shall hide initialisation performed on IU,A' from RNC-B.\nIf the option to remove the TBE was applied after call setup, the whole context (TBE) needs to be inserted prior to performing SRNS Relocation. Initialisation data need to be available within MGW-A. After Relocation, the context (TBE) may be removed again, i.e. the MGW-A again acts as a pure AAL2 switch.\nFigure 6.2/2: Intra-MSC SRNS Relocation and TrFO. Flow chart part 1\nFigure 6.2/3: Intra-MSC SRNS Relocation and TrFO. Flow chart part 2\nFigure 6.2/3: Intra-MSC enhanced SRNS Relocation and TrFO. Flow chart\nRAB Assignment on the new Iu leg:\nA RAN side terminations with IuFP property (T3) has to be added to the already seized call context (step 2.) before sending Relocation Request (4.), that contains all the RAB parameters already applied on the Iu leg towards RNC-A.\nUP initialisation\nRNC-A' shall accept the requested set of codec modes and is not allowed to puncture out any negotiated mode. The INIT frames shall be according to the RAB parameters received.\nAt reception of an INIT frame from the new RNC, the termination at MGW-A shall not perform forwarding of the IuFP initialisation. The MGW shall check whether the received RFCI allocations match the stored RFCI allocation. If it does not match, it may re-initialise the IuFP towards RNC-A' at this point in time.\nRemoval of TrFO Break Equipment (TBE)\nIf the MGW supports the removal of TBEs, it shall insert the TBE before seizing the additional termination. It may again remove the TBE after performing RFCI matching and through-connection of the new termination and the termination to the far end party.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.2",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2.2",
      "section_id": "6.2.2",
      "section_title": "Inter-MSC SRNS Relocation",
      "content": "The following figures are describing inter-MSC SRNS relocation. The figures are a combination of figure 6.2/1 for intra-MSC SRNS relocation and of figures 8.4/1 and 8.4/2 in 3GPP TS 23.205 [8].\nFigure 6.2/4: Configuration during inter-MSC SRNS Relocation\nFigure 6.2/4 shows the configuration during inter-MSC SRNS relocation. After setting up the new IU interface (towards RNC-A') until releasing the old one, the original TrFO relation (A⇔B) and the target TrFO relation (A'⇔B) exist in parallel. Within the respective contexts (TBE) interworking between T4and T5 at MGW-A' and T1, T2 and T3 at MGW-A are necessary:\nT3 (MGW-A) shall perform initialisation towards MGW-A'.\nT4 (MGW-A') will receive initialisation from RNC-A'.\nT5 (MGW-A') shall hide initialisation performed on IU,A' from MGW-A and RNC-B.\nIf the option to remove the TBE was applied in MGW-A after call setup, the whole context (TBE) needs to be inserted prior to performing inter-MSC SRNS Relocation. Initialisation data need to be available within MGW-A. After Relocation, the context (TBE) may be removed again.\nFigure 6.2/5: Inter-MSC SRNS Relocation and TrFO. Flow chart part 1\nNote: There can be interim network transit nodes between MSC-A and MSC-A'\nFigure 6.2/6: Inter-MSC SRNS Relocation and TrFO. Flow chart part 2\nRAB Assignment on the new Iu leg:\nA RAN side termination with IuFP property (T4 (MSC-A')) has to be seized (step 3.) before sending Relocation Request (4.), that contains all the RAB parameters already applied on the Iu leg towards RNC-A.\nMAP signalling for handover and codec negotiation\nThe MSC-A server shall include an Iu-Supported Codecs List and an Iu-Currently Used Codec in the MAP Prepare Handover request. When selecting the order of priority for the codecs within the Iu-Supported Codecs List, MSC-A shall take the Available Codecs List (BICC) negotiated with the far end party into account.\nIf the MSC-A server supports GERAN AoIP-mode then it may insert an AoIP-Supported Codecs List (Anchor) (MAP) in the MAP Prepare Handover Request message to allow MSC-A' to use this information during a subsequent intra-MSC handover to GERAN AoIP-mode, see Clause  6.14.1.\nNOTE:      the full list of codec types supported by the UE and the anchor MSC for GERAN access is included  in Radio Resource Information IE in MAP Prepare Handover Request message.\nMSC-A' shall include in the MAP Prepare Handover response the Iu-Selected codec and the Iu-Available Codecs List, i.e. the list of codecs available at the Iu interface in MSC-A' after handover.\nNetwork side bearer establishment and codec handling\nThe handling of the bearer establishment between MSC-A and MSC-A' shall be performed as for a normal call with OoBTC. For a speech bearer, the MSC-A server shall perform a call set-up with codec negotiation towards the MSC-A' server, using a Supported Codec List (BICC) containing:\na)\toptionally, the Iu-Selected codec (MAP) (negotiated with MSC-A' during the MAP E-interface signalling) if it is different from list item b;\nNOTE 1:\tThis codec can be included as the preferred codec, if MSC-A knows by means of configuration information that all nodes of the network support OoBTC, or TrFO/TFO interworking and TFO, including codec mismatch resolution. If this codec does not match the Selected Codec (BICC), but is eventually selected for the network side bearer to the target MSC (MSC-A'), then either MSC-A must transcode at the anchor MGW or MSC-A will need to trigger a codec modification to the far end. Given that the anchor MSC cannot trigger all these changes at once, it must first establish the network side bearer – i.e. insert a transcoder at the anchor MGW and then trigger the codec modification to the far end as a second step.\nb)\t\tthe Selected codec (BICC), previously selected for the leg towards the far end party;\nNOTE 2:\tThis codec is preferred, if the anchor MSC-A does not know by means of configuration information if all nodes in the network support OoBTC, or TrFO/TFO interworking and TFO, including codec mismatch resolution. This is also the best codec to be selected if the goal is to avoid additional transcoding in MSC-A or a codec modification from MSC-A towards the far end party.\nc)\tthe default PCM codec;\nd)\toptionally, further codecs from the Iu-Supported Codecs List (MAP) that are applicable to the target radio access, e.g. the Iu-Selected codec (MAP), if it is not already included according to list item a or b; and\ne)\toptionally, for subsequent inter-RAT intra MSC-A' handover further codecs from the Available Codec List (BICC) that are applicable to other radio access types.\nFor UDI/RDI multimedia calls with fallback and service change according to 3GPP TS 23.172 [17], the Supported Codecs List (BICC) shall contain the multimedia dummy codec and the Available Codecs List (BICC) can contain this codec (see [17], clause 4.3.7). If the MSC-A server wants to establish a bearer for the multimedia dummy codec, it shall include this codec as the preferred codec.\nIf MSC-A' receives a Supported Codec List (BICC) with the IAM message, MSC-A' shall select a codec from this list, taking the Iu-Selected codec and the priorities expressed by the order of the codecs in the Supported Codec List (BICC) into account.\nNOTE 3:\tUsually, selection of the preferred codec of the Supported Codec List (BICC) will result in the best speech quality or best transcoder location or both; however, e.g. if MSC-A' knows by means of configuration information that OoBTC is not supported on some links in the network, and some nodes in the network are not supporting the creation of a \"structured\" Supported Codec List (BICC) as specified in clause 9.7.2, MSC-A' can select another codec, e.g. the Iu-Selected codec or the default PCM codec.\nIf MSC-A' selects the default PCM codec, or if MSC-A' receives an IAM message without a Supported Codec List (BICC), MSC-A' shall insert a transcoder in MGW-A'.\nIf the Selected Codec (BICC) received by MSC-A in response to the BICC codec negotiation towards the target MSC (MSC-A') is different from the current Selected Codec (BICC) used towards the far end, the MSC-A shall insert a transcoder in MGW-A.\nMSC-A/MSC-A' shall request seizure of network side bearer terminations with IuFP properties (see steps 10. and 12.). MSC-A' shall send the Address Complete message only after MGW-A' has indicated the successful initialisation of the IuFP (step 15.).\nAdditionally, when the bearer between MGW-A and MGW-A' was established successfully, MSC-A may initiate a codec modification or mid-call codec negotiation as described in Annex A.\nUP initialisation\nRNC-A' shall accept the requested set of codec modes and is not allowed to puncture out any negotiated mode. The INIT frames shall be according to the RAB parameters received.\nMSC-A' shall request seizure of network side bearer terminations with IuFP properties.\nAt reception of an INIT frame from the new RNC, the termination at MGW-A' shall not perform forwarding of the IuFP initialisation. When the NbFP has been initialised from MGW-A towards MGW-A', the MGW-A' shall check whether the received RFCI allocations match the stored RFCI allocation. If it does not match, the MGW-A' may re-initialise the IuFP towards RNC-A' at this point in time.\nRemoval of TrFO Break Equipment (TBE)\nIf the MGW-A supports the removal of TBEs, it shall insert the TBE before seizing the additional termination. It may again remove the TBE after through-connection of the new termination and the termination to the far end party.\nIf the MGW-A' supports the removal of TBEs, it may remove the TBE after performing RFCI matching and through-connection of the terminations.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14.1",
        "clause_4.3.7",
        "clause_9.7.2",
        "figure_6.2",
        "ts_23.205_figure_6.2",
        "ts_23.205",
        "ts_23.172"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2.3.1",
      "section_id": "6.2.3.1",
      "section_title": "Codec Modification Initiated by the Far End Side",
      "content": "Modification of Available Codec List\nIf after inter-MSC SRNS relocation the anchor MSC (MSC-S-A) receives a \"Modification of Available Codec List\" procedure from the far end side as described in clause 5.8.2, i.e. the Available Codecs List (BICC) is reduced, the anchor MSC may terminate the procedure at that point or forward the \"Modification of Available Codec List\" procedure to the serving MSC (MSC-S-A'). I.e. for a modification of the Available Codec List (BICC) without modification of the Selected codec, no MAP signalling is used.\nModification of Selected Codec\nIf after inter-MSC SRNS relocation the anchor MSC (MSC-S-A) receives a \"Modification of Selected Codec\" procedure from the far end side as described in clause 5.8.1, and both the old and the new Selected Codec (BICC) are speech codecs, the anchor MSC may terminate the codec modification procedure, inserting a transcoder if required. Alternatively, the anchor MSC may forward the request to modify the codec to the serving MSC (MSC-S-A'), using the procedure described below.\nNOTE:\tThe anchor MSC may decide to forward the request to the serving MSC (MSC-S-A'), e.g. when the new Selected Codec (BICC) for the call leg between the anchor MSC and the far end side was included in the Iu-Available Codec List previously received from the serving MSC, and it is possible to (re-)establish TrFO end-to-end from the far end side up to the serving MSC.\nIf the anchor MSC (MSC-S-A) receives a \"Modification of Selected Codec\" procedure from the far end side as described in clause 5.8.1, and either the old or the new Selected Codec (BICC) is the multimedia dummy codec, i.e. the far end side requests a service change between speech and multimedia, and the Available Codecs List (BICC) previously negotiated between the anchor MSC and the serving MSC (MSC-S-A') indicates that the service change is supported end-to-end, the anchor MSC shall forward the request to modify the radio access bearer to the serving MSC (MSC-S-A') and then perform a codec modification procedure for the Nb/Nc interface towards the serving MSC (MSC-S-A'). If the service change cannot be performed successfully, the anchor MSC shall reject the request for codec modification towards the far end party.\nAn example call sequence for the modification of the selected speech codec is shown in figures 6.2/7 and 6.2/8. The configuration depicted in figure 6.2/4 applies.\nFigure 6.2/7: Codec modification after Inter-MSC SRNS Relocation. Flow Chart Part 1.\nNote: There can be interim network transit nodes between MSC-A and MSC-A'\nFigure 6.2/8: Codec modification after Inter-MSC SRNS Relocation. Flow Chart Part 2.\nIf the anchor MSC (MSC-S-A) wants to forward the modification of the codec used towards the UE and the serving MSC (MSC-S-A') from one speech codec to another speech codec within the Iu-Available Codecs List, it shall apply the following procedure:\nThe anchor MSC shall send a MAP Forward Access Signalling request (3) containing the new Iu-Selected Codec and the corresponding RAB Assign Modify Request message to the serving MSC (MSC-S-A').\nOn reception of the MAP Forward Access Signalling request (3) the serving MSC (MSC-S-A') shall configure the attached MGW-A' for the new codec and trigger the \"RAB Assign Modify\" procedure (5-8) towards the RNC-A'. When the serving MSC receives the RAB Assign Modify Response message (8), it shall send a MAP Process Access Signalling Request (9) containing the RAB Assign Modify Response and the Iu-Selected codec to the anchor MSC (MSC-S-A).\nWhen the anchor MSC (MSC-S-A) receives the MAP Process Access Signalling Request (9), it shall start the codec modification procedure (11-19) for the Nb/Nc interface towards the serving MSC (MSC-S-A'), as described in clause 5.8.1. If the anchor MSC needs to change also the Available Codecs List (BICC), it shall additionally initiate a procedure as described in clause 5.8.2.\nWhen receiving the \"Modify Codec\" request (11), the serving MSC (MSC-S-A') shall not reconfigure the RAN and shall configure the attached MGW-A' to initate an Nb framing protocol initiation towards MGW-A.\nIf the anchor MSC (MSC-S-A) needs to perform a service change from multimedia to speech, it shall send a MAP Forward Access Signalling request (3) containing the Iu-Supported Codecs List and the corresponding RAB Assign Modify Request message to the serving MSC (MSC-S-A'). After successful modification of the RAB, on reception of the MAP Process Access Signalling Request (9) the anchor MSC (MSC-S-A) shall start the codec modification procedure (11-19) for the Nb/Nc interface towards the serving MSC (MSC-S-A'), as described in clause 5.8.1.\nIf the anchor MSC (MSC-S-A) needs to perform a service change from speech to multimedia, it shall send a MAP Forward Access Signalling request (3) containing the corresponding RAB Assign Modify Request message for a data bearer, but no Iu-Selected Codec to the serving MSC (MSC-S-A'). After successful modification of the RAB, on reception of the MAP Process Access Signalling Request (9) the anchor MSC (MSC-S-A) shall start the codec modification procedure (11-19) for the Nb/Nc interface towards the serving MSC (MSC-S-A'), as described in clause 5.8.1.\nUnsuccessful Codec Modification in the Serving MSC\nAfter receipt of MAP Forward Access Signalling request (3), if the modification to the new Iu-Selected codec is not possible, e.g. because necessary resources are temporarily unavailable in the serving cell or in MGW-A', or the RAN does not support the \"RAB Assign Modify\" procedure, the serving MSC (MSC-S-A') shall keep the old codec and the corresponding RAB configuration and shall send a MAP Process Access Signalling request, containing a RAB Assign Modify Response (\"failed to modify\") message, to the anchor MSC (MSC-S-A). If the anchor MSC detects that the RAB modification failed, it shall abort the codec modification procedure towards the serving MSC and shall complete the codec modification procedure towards the far end side.\nUnsuccessful BICC Codec Modification between Anchor MSC and Serving MSC\nAfter receipt of a MAP Process Access Signalling Request, containing a RAB Assign Modify Response (\"success\") message, if the subsequent BICC codec modification procedure between anchor MSC and serving MSC fails due to a MGW rejecting a request to reserve the resources or a server rejecting the request to modify the codec, the anchor MSC shall change the codec used at the Iu interface back by sending a MAP Forward Access Signalling request containing the previous Iu-Selected Codec to the serving MSC (MSC-S-A'). After receipt of the confirmation that the previous codec has been restored at the Iu interface, the anchor MSC shall complete the codec modification procedure towards the far end side.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.8.1",
        "figure_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2.3.2",
      "section_id": "6.2.3.2",
      "section_title": "Mid-Call Codec Negotiation Initiated by the Far End Side",
      "content": "If after inter-MSC SRNS relocation the anchor MSC receives a \"Mid-call Codec Negotiation\" procedure from the far end side as described in clause 5.8.3, and both the old and the new Selected Codec (BICC) are speech codecs, the anchor MSC may terminate the mid-call codec negotiation procedure, inserting a transcoder if required. Alternatively, if the new Selected Codec (BICC) was included in the last Iu-Available Codec List sent by the serving MSC (MSC-S-A') the anchor MSC may forward the request to the serving MSC (MSC-S-A'), using the procedure described below.\nIf the anchor MSC (MSC-S-A) receives a \"Mid-call Codec Negotiation\" procedure from the far end side as described in clause 5.8.3, and either the old or the new Selected Codec (BICC) is the multimedia dummy codec, i.e. the far end side requests a service change between speech and multimedia, and the Available Codecs List (BICC) previously negotiated between the anchor MSC and the serving MSC (MSC-S-A') indicates that the service change is supported end-to-end, the anchor MSC shall forward the request to modify the radio access bearer to the serving MSC (MSC-S-A') and then perform a mid-call codec negotiation procedure for the Nb/Nc interface towards the serving MSC (MSC-S-A'). If the service change between speech and multimedia cannot be performed successfully, the anchor MSC shall reject the request for mid-call codec negotiation towards the far end party.\nAn example call sequence for the mid-call codec negotiation of speech codecs is shown in figures 6.2/9 and 6.2/10. The configuration depicted in figure 6.2/4 applies.\nFigure 6.2/9: Mid-call codec negotiation after Inter-MSC SRNS Relocation. Flow Chart Part 1.\nNote: There can be interim network transit nodes between MSC-A and MSC-A'\nFigure 6.2/10: Mid-call codec negotation after Inter-MSC SRNS Relocation. Flow Chart Part 2.\nIf the anchor MSC (MSC-S-A) wants to forward the (re-)negotiation of the selected codec and the Available Codecs List (BICC) towards the UE and the serving MSC (MSC-S-A'), it shall apply the following procedure:\nThe anchor MSC shall send a MAP Forward Access Signalling request (2) containing the new Iu-Supported Codecs List and the corresponding RAB Assign Modify Request to the current serving MSC (MSC-S-A'). When selecting the order of priority for the codecs within the new Iu-Supported Codecs List, the anchor MSC shall take the new Available Codecs List (BICC) negotiated with the far end party into account.\nOn reception of the MAP Forward Access Signalling request (2) the serving MSC (MSC-S-A') shall select a codec from the Iu-Supported Codecs List, configure the attached MGW-A' for the new codec, and trigger the \"RAB Assign Modify\" procedure (4-7) towards the RNC-A'. For details concerning the handling of the RAB Assign Modify Request message by MSC-S-A' see 3GPP TS 23.009 [11], clause 13.4.1. When the serving MSC receives the RAB Assign Modify Response message (7), it shall send a MAP Process Access Signalling Request (10) containing the RAB Assign Modify Response, the Iu-Selected codec, and the Iu-Available Codecs List to the anchor MSC (MSC-S-A).\nWhen the anchor MSC (MSC-S-A) receives the MAP Process Access Signalling Request (8), it shall start the mid-call codec negotiation procedure (9-25) for the Nb/Nc interface towards the serving MSC (MSC-S-A'), as described in clause 5.8.\nWhen receiving the \"Mid-call codec negotiation\" procedure (9), the serving MSC (MSC-S-A') shall not reconfigure the RAN and shall configure the attached MGW-A' to wait for an Nb framing protocol initiation from MGW-A.\nUnsuccessful Codec Modification in the Serving MSC\nAfter receipt of MAP Forward Access Signalling request (3), if the modification to the new Iu-Selected codec is not possible, e.g. because necessary resources are temporarily unavailable in the serving cell or in MGW-A', or the RAN does not support the \"RAB Assign Modify\" procedure, the serving MSC (MSC-S-A') shall keep the old codec and the corresponding RAB configuration and shall send a MAP Process Access Signalling request, containing a RAB Assign Modify Response (\"failed to modify\") message, to the anchor MSC (MSC-S-A). If the anchor MSC detects that the RAB modification failed, it shall abort the mid-call codec negotiation procedure towards the serving MSC and complete the mid-call codec negotiation procedure towards the far end side.\nUnsuccessful BICC Mid-call Codec Negotiation between Anchor MSC and Serving MSC\nIf after a successful modification of the Iu-Selected Codec (MAP) the subsequent BICC codec mid-call codec negotiation procedure between anchor MSC and serving MSC fails due to a MGW rejecting a request to reserve the resources or a server rejecting the request to (re-)negotiate the codecs, the anchor MSC shall change the codec used at the Iu interface back by sending a MAP Forward Access Signalling request containing the previous Iu-Selected Codec to the serving MSC (MSC-S-A'). After receipt of the confirmation that the previous codec has been restored at the Iu interface, the anchor MSC shall complete the mid-call codec negotiation procedure towards the far end side.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.3",
        "ts_23.009_clause_13.4.1",
        "clause_5.8",
        "figure_6.2",
        "ts_23.009"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.2.3.3",
      "section_id": "6.2.3.3",
      "section_title": "Modification Procedure after Codec Change in the Serving MSC",
      "content": "According to 3GPP TS 23.009 [11], clause 4.4.1, the serving MSC (MSC-S-A') will inform the anchor MSC (MSC-S-A) when the Iu-Selected codec was changed during a subsequent intra-MSC handover/relocation by sending a MAP Process Access Signalling request. If the Iu-Available Codecs List was changed during the handover/relocation, the serving MSC shall send a MAP Process Access Signalling request including the new Iu-Available Codecs List.\nOn reception of the MAP Process Access Signalling request the anchor MSC may initiate one of the modification procedures as described in clauses 5.8.1, 5.8.2, and 5.8.3 towards the serving MSC and/or towards the far end side. I.e. towards the serving MSC no MAP signalling is used. Besides, towards the serving MSC (MSC-A') the procedures described in clauses 5.8.1, 5.8.2, and 5.8.3 are applicable with the modification that the serving MSC shall not modify the radio access bearer.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.009_clause_4.4.1",
        "ts_23.009"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.3",
      "section_id": "6.3",
      "section_title": "IN and Call Forward SS",
      "content": "In some cases, IN services (e.g. voice prompting) are triggered at CC-IN nodes that require the establishment of an UP bearer for tones or announcements to be sent to the calling party. In order to establish this bearer, it is necessary that the CC-IN node temporarily selects one codec from the codec list sent from the initiating node, and informs the initiating node about the selected codec. Afterwards, the call may continue its establishment to the another node, which may not support the selected codec but requests that another one in the list be selected instead.\nA similar situation arises with the CFNRy supplementary service. A UP connection needs to be established between the originating and \"provisional\" terminating CC nodes to enable ringing tones to be sent to the calling party. The type of codec must be agreed prior to the establishment of the bearer connection. Afterwards, the call is redirected to another node that may not support the selected code but requests the selection of another one.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_6.3.1",
      "section_id": "6.3.1",
      "section_title": "TrFO interworking with SS (VMSC = service interworking node)",
      "content": "Figure 6.3.1/1. Codec Modification in case of SS interworking\nIn case of supplementary service interworking, it may become necessary to apply codec modification out of band. Figure 6.3.1/1 shows the network model, that may apply for a certain set of SS's (call deflection (CD), call forwarding on no reply (CFNRy), CF on user determined busy (CFUB), etc.). Common to these scenarios is:\n-\tthe service interworking is controlled by the VMSC (this is common to all SSs).\n-\tMSC-T extends the call towards MSC-T' according to the forwarded-/deflected-to-number.\nAn intermediate TrFO relation will in general already exist between two RNC's (RNC-O and RNC-T in figure 6.3.1/1) before the call is diverted to another node, as the ringing tone was applied in backward direction.\nIn order to perform codec negotiation with the third node (MSC-T') as well it is necessary to forward the supported codec list from MSC-O. MSC-T' signals back the codec it selected and the available codec list. If the codec negotiation result is different from the previously performed codec negotiation between MSC-O and MSC-T, MSC-O shall be informed. MSC-O shall be able to decide based on the received modified codec type whether Iu Framing re-initialisation and bearer modification is required. This scenario is depicted in Figure 6.3.1/2 below. If no codec modification has to be applied, MSC-T(B) shall extend the UP initialisation towards MSC-T'(C), i.e. MSC-T(B) shall initialise a termination (TD) with the property Initialisation Procedure = outgoing. MSC-T' (C) shall also initialise a termination TE with the property Initialisation Procedure = incoming. Further call handling follows the mobile to mobile call establishment (see clause 6.1).\nFigure 6.3.1/2: Codec Modification for SS-interworking & UP re-initialisation",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "figure_6.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.3.2",
      "section_id": "6.3.2",
      "section_title": "IN interworking (VMSC ≠ service interworking node)",
      "content": "Figure 6.3.2/1. Codec Modification in case of IN interworking\nCommon to IN interworking scenarios is that service interworking is controlled by an IN service node that is generally not the VMSC.\nIN interworking (i.e. in case of a separate IN service node, this is often a Gateway-MSC) may interrupt call establishment and apply an intermediate announcement back to the originating side. This means, that codec negotiation was in fact performed between the IN service node and the MSC-O.\nWhen performing further call establishment, it is necessary to proceed with codec negotiation towards MSC-T. The codec negotiation process shall consider the capabilities of MGW-IN.\nIN services, similar to call forwarding SS, are possible. The fact that this service interworking is controlled by an IN service node, may cause, that the leg towards MSC-T has to be released and a new leg towards MSC-T' will be established. Codec negotiation is again necessary from MSC-IN on.\nThe sequence chart given in figure 6.3.1/2 applies in principle for the 1st and the 2nd negotiation scenarios with following modifications:\n-\tas MSC-IN may be involved in subsequent service interworking again, the capabilities of MGW-IN shall be taken into account during codec negotiation with MSC-T or MSC-T'. This means, that the codec list forwarded to the succeeding nodes is in fact the available codec list of the 1st negotiation.\n-\tFor the 3rd negotiation scenario, the leg between MSCIN(B) and MSC-T (C) has to be released and a new leg toward MSC-T'(D) has to be setup.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.3.2",
        "figure_6.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.4",
      "section_id": "6.4",
      "section_title": "Information flow for interaction with Multiparty SS",
      "content": "Figure 6.4/1: Multi-party Call\nThe operation of the MGW for conference calls is implementation dependent. The sequence in Figure 6.4/1 shows three connections to the MGW, where two were configured TrFO and have matching codecs but the third connection could not be made with the same codec type.\nThe Iu Framing connections for each multi-party call leg shall be terminated in the MGW where the multi-party call is controlled. The MGW shall control each connection independently during the multi-party call.\nWhen the multi-party call is released, if two parties remain in the connection it shall be possible to either revert directly to a TrFO connection if both codecs match or OoBTC procedures could be performed to modify one or both of the codec types to achieve a TrFO connection. However, if the Server does not perform this then the MGW shall continue to resolve the difference in codecs by internal transcoding procedures.\nCodec modification procedures may be employed (see clause 5.8.1) if a common codec exists, this is shown in Figure 6.4/2, where codec v is common to all parties.\nFigure 6.4/2: Multi-party Call, with codec modification",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.8.1",
        "figure_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.5",
      "section_id": "6.5",
      "section_title": "Information flow for handover from UMTS to GSM after TrFO establishment",
      "content": "Inter-system handover procedures are described at call control level in [11] and details for bearer independent architecture is described in [8]. For TrFO connected UMTS call, when a handover occurs to GSM radio access, by definition the A-interface to the BSC shall be default PCM. Prior to receipt of Handover Detect the Anchor MGW has one leg (A-interface) stream mode as default PCM and two terminations with compressed voice codec properties. It is recommended that after the Handover Complete procedure, the network property is maintained as compressed. Thus the Anchor MGW inserts a \"TFO Partner\" transcoder. Thus no modification to the compressed bearer to 64k PCM is required. TFO procedures may then ensure that speech quality is maintained by avoiding transcoding.\nIn the Intra-MSC case shown in Figure 6.5/1 the MSC controlling the handover has both codec lists for each radio access. The codec negotiation for the UMTS call was performed end to end with UMTS list. If this negotiation resulted in a codec being selected that is also included in the GSM list then at handover the MSC shall indicate this codec as the current speech version to the BSC and TFO can be achieved. If the selected codec is not supported for the GSM radio access but the GSM list contains a codec that is also in the Available Codecs list then the MSC has the option to perform codec modification to ensure TFO can be achieved. The MSC may also perform codec list modification by sending forward the GSM list to update nodes in the network of the change to the Available Codecs List.\nFigure 6.5/1: UMTS to GSM Inter-System Handover\nIf the Inter-system handover is an inter-MSC handover then the Anchor MSC sends the current speech version and the supported speech versions in the Prepare Handover Request message to the MSC-B. If the anchor MSC supports GERAN AoIP mode then the Prepare Handover Request message may contain AoIP-Supported Codecs List (Anchor) (MAP), see Clause 6.14.1.\nIf the current speech version (codec selected for UMTS call) is not included in the GSM list then the MSC-A shall indicate a preferred codec in the current speech version parameter. The speech version for the GSM access that is finally selected by the MSC-B's BSS, is returned to MSC-A in the Prepare Handover Response message. If the following are satisfied:\n-\ttarget MSC and BSC support GERAN AoIP mode;\n-\tAoIP-Supported Codecs List (Anchor) (MAP) was received in MAP Prepare Handover Request; and\n-\ttarget MSC supports AoIP codec selection based on received AoIP-Supported Codecs List (Anchor) (MAP),\nthen the Prepare Handover Response message shall contain the AoIP-Selected Codec (Target) (MAP) and AoIP-Available Codecs List (MAP).\nThe MSC-A can then decide if codec modification or codec re-negotiation shall be performed as described for the intra-MSC case. For further details on the inter-MSC signalling see clause 6.11. The connections are shown in Figure 6.5/2.\nFigure 6.5/2: Inter-MSC, UMTS to GSM handover, with TDM transport between anchor MSC (MSC‑A) and target MSC (MSC-B)",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.14.1",
        "clause_6.11",
        "figure_6.5"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.6",
      "section_id": "6.6",
      "section_title": "Call Hold/Call Wait",
      "content": "Figure 6.6/1: Configuration during Call Hold/Call Wait scenario\nThis scenario assumes subscriber C (served by RNC-O'') calls subscriber B (served by RNC-T), currently in communication with subscriber A. Subscriber C receives a tone/announcement, applied by terminating side. Then subscriber B puts subscriber A on Hold and A receives an announcement (applied again by terminating side.)\nMGW-O has to establish an originating side call context (T4, T5), MGW-T the respective terminating one (T3 only, T1 from subscriber will be moved to it during the scenario), the B party context has to be inserted into path again (if TBE was removed).\nFigure 6.6/2: Call Hold/Call Wait and TrFO. Message flow part 1\nFigure 6.6/3: Call Hold/Call Wait and TrFO. Message flow part 2\nFigure 6.6/4: Call Hold/Call Wait and TrFO. Message flow part 3\nFigure 6.6/5: Call Hold/Call Wait and TrFO. Message flow part 4",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.6"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.7",
      "section_id": "6.7",
      "section_title": "External Network to Mobile TrFO Call Establishment",
      "content": "Figure 6.7/1. Configuration during Call Setup of a External Network to Mobile Call\nThe description of Figure 6.1/1 (Configuration during Call Setup of a Mobile to Mobile Call) within clause 6.1 applies for the network and protocol entities involved in the External Network to Mobile Call scenario with following modifications:\nNo RNC-O is present – a party served by an external network originates the call instead.\nThe originating CN nodes are Gateway nodes (Gateway MSC Server/Gateway MGW).\nThe Gateway MGW call context is no TrFO break equipment in general, i.e. T1 in general do not support the IuFP framing protocol. Appropriate interworking (in some cases transcoding) has to be performed between T1 and T2.\nTherefore Figures 6.1/2 to 6.1/4. (the respective message flows for mobile to mobile call setup) apply in principle as well with appropriate modifications outlined below:\nCodec negotiation\nStep 1. Until 6., that give the codec negotiation phase in Figure 6.1/2, shall be applied with following modifications:\nThere is no originating UE involved in this negotiation phase\nIf the preceding node of the Gateway MSC-Server doesn't support OoBTC procedures for compressed voice types, the Gateway MSC-Server shall initiate OoBTC procedures in order to enable transcoders placement at the edge gateway node.\nThe edge gateway node shall always send the complete list of the codec types and modes it supports for this type of call setup.\nUP initialisation\nThe main difference compared to the Mobile to Mobile call setup is, that the CN side termination of the Gateway MGW (T2 in figure 6.7/1) shall start the initialisation of the IuFP according to the result of the codec negotiation. The forward initialisation principle shall be followed in any setup scenario.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "figure_6.7",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.8",
      "section_id": "6.8",
      "section_title": "Mobile to External Network TrFO Call Establishment",
      "content": "Figure 6.8/1. Configuration during Call Setup of a Mobile to External Network Call\nThe description of Figure 6.1/1 (Configuration during Call Setup of a Mobile to Mobile Call) within clause 6.1 applies for the network and protocol entities involved in the External Network to Mobile Call scenario with following modifications:\nNo RNC-T is present – a party served by an external network is the terminating side of the call instead.\nThe terminating side CN nodes are Gateway nodes (Gateway MSC Server/Gateway MGW).\nThe Gateway MGW call context is no TrFO break equipment in general, i.e. T4 in general do not support the IuFP framing protocol. Appropriate interworking (in some cases transcoding) has to be performed between T3 and T4.\nTherefore Figures 6.1/2 to 6.1/4. (the respective message flows for mobile to mobile call setup) apply in principle as well with appropriate modifications outlined below:\nCodec negotiation\nStep 1. Until 6., that give the codec negotiation phase in Figure 6.1/2, shall be applied with following modifications:\nThere is no terminating UE involved in this negotiation phase.\nIf the succeeding node of the Gateway MSC-Server doesn''t support OoBTC procedures for compressed voice types, the Gateway MSC-Server terminates the OoBTC procedures in order to enable transcoder placement at the edge gateway node.\nThe edge gateway node should accept the Codec Type MSC-O prefers and should not puncture out any Codec Mode. If TFO is to be supported then the Gateway MSC-Server shall supply the MGW with the codec list and the selected Codec Type in order that inband TFO negotiation may be performed. For further details see clause 5.5.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "clause_5.5",
        "figure_6.8",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.9",
      "section_id": "6.9",
      "section_title": "Mobile to Mobile TrFO Call Establishment for GERAN Iu-mode",
      "content": "Figure 6.9/1: Configuration during Call Setup of a Mobile to Mobile Call for GERAN Iu-mode\nThe description of Figure 6.1/1 (Configuration during Call Setup of a Mobile to Mobile Call) within clause 6.1 applies for the network and protocol entities involved in the Mobile to Mobile Call for GERAN Iu-mode scenario with following modifications:\nBSC-T acts as a RNC-T.\nBSC-O acts as a RNC-O.\nTherefore Figures 6.1/2 to 6.1/4. (the respective message flows for mobile to mobile call setup) apply as well with the appropriate modifications outlined below:\nCodec negotiation\nStep 1. until 6., that give the codec negotiation phase in Figure 6.1/2, shall be applied with following modifications:\nBefore step 1 (BSC-O to MSC-S-O) and step 4 (BSC-T to MSC-S-T) the RANAP Initial UE message will be sent indicating the GERAN capabilities, which will be available at the RAB establishment procedure. The IE describing the  GERAN capabilities contains a list of codec types as well as the supported codec modes (for an adaptive multi-rate codec type), which will be available at the RAB establishment procedure. With this information the MSC Server shall puncture out (i.e. delete) those codec types and codec modes (for an adaptive multi-rate codec type) from the supported codec list  taking into account the GERAN classmark and the MS capabilities which are not supported by the GERAN. This possibly reduced list shall be used by the MSC Server during the negotiation procedure (step 2 and step 6). For definition of list of  supported codec types see [15].\nThe MSC-Server performs codec negotiation according to clause 5.6 with the following modifications:\nThe value of the maximum number of supported codec modes shall be set to \"four\" (see [10]).\nRAB Assignment\nRAB Assignment shall be performed as described in clause 6.1 with following modifications:\nAdditionally, the MSC Server shall include the selected codec type within RAB Assignment.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "clause_5.6",
        "figure_6.9",
        "figure_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.10",
      "section_id": "6.10",
      "section_title": "Relocation during TrFO towards GERAN Iu-mode",
      "content": "Figure 6.10/1: Configuration during intra-MSC SRNS Relocation towards GERAN Iu-mode\nThe description of Figure 6.2/1 (Configuration during intra-MSC SRNS Relocation) within clause 6.2 applies for the network and protocol entities involved in the Relocation towards GERAN Iu-mode scenario with following modifications:\nRAN node A either is a RNC or a BSC. In the latter case BSC-A acts as a RNC-A.\nBSC-A' acts as a RNC-A'.\nTherefore Figures 6.2/2 to 6.2/3. (the respective message flows for SRNS Relocation and TrFO) apply as well with the appropriate modifications outlined below:\nRelocation Initiation\nIf the MSC-Server-A received the GERAN capabilities of the target cell within the RANAP Relocation Required message (for details when the capabilities are  included see [16]), MSC-Server-A shall compare these capabilities with the current  Selected Codec (BICC) and the Available Codecs List (BICC), taking into account Supported Codec Set and Active Codec Set for adaptive multimode codecs. If the GERAN capabilities in terms of codec types and modes for adaptive multimode codecs do not include all codes types and modes in the Available Codecs List (BICC) and all modes and the type of the Selected Codec (BICC), MSC Server A shall invoke the appropriate of the modification procedures in clause 5.8. Criteria for the selection of the appropriate procedure are given in clause 5.8. Upon completion of this procedure, or if no modification procedure is required, MSC server A shall proceed with the Relocation procedure as described in Figure 6.2/2 to 6.2/3 (Step 2. to 17.).\nRAB Assignment on the new Iu leg:\nRAB Assignment on the new Iu leg shall be performed as described in clause 6.2 with following modifications:\nThe Relocation Request (Step 3.) contains possibly new RAB parameters depending on the actions executed as outlined above during the Relocation Initiation phase according to the decision on the selected codec as well as on the selected codec modes (for an adaptive multi-rate codec type). In addition, the MSC-Server-A shall include the selected codec type within Relocation Request message. For definition of list of supported codec type see [15].",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2",
        "clause_5.8",
        "figure_6.10",
        "figure_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.11.1",
      "section_id": "6.11.1",
      "section_title": "Inter-MSC Handover",
      "content": "If MSC-A supports GERAN AoIP-mode then it may insert AoIP-Supported Codecs List (Anchor) (MAP) in the MAP  Prepare Handover Request message to allow MSC-A' to use this information if target radio access is GERAN AoIP-mode, or during a subsequent intra-MSC handover to GERAN AoIP-mode. The detailed procedure is described in clause 6.14.1.\nIn order to enable the use of Tandem free and Transcoder free operation after inter-MSC handover, the procedures specified in 3GPP TS 23.205 [8] and 3GPP TS 23.009 [11] for \"Inter-MSC Handover\" shall be followed. For the handling of the codec lists and selected codecs the following rules apply:\nThe Prepare Handover request message shall include the Iu-Supported Codecs List (MAP).\nNOTE 1:\tThe codec types listed in the Channel Type Information Element included in the BSSMAP HANDOVER REQUEST message in the MAP  Prepare Handover request are the full list of codec types supported by the UE (as recognized by the Anchor MSC-A); this list is not affected by the Available Codecs List (BICC).\nIf the serving radio access is UTRAN or GERAN Iu-mode, the Prepare Handover request message shall contain the Iu-Currently Used Codec (MAP). Otherwise, if the serving radio access is A/Gb mode, the currently used codec is indicated by the Speech Version (Chosen) in the BSSMAP Handover Request message included in the Prepare Handover request message.\nIf the target radio access is UTRAN or GERAN Iu-mode, the Prepare Handover response message shall contain the Iu-Selected Codec (MAP) and the Iu-Available Codecs List (MAP). Otherwise, if the target radio access is A/Gb mode, the selected codec is indicated by the Speech Version (Chosen) in the BSSMAP Handover Request Ack message included in the Prepare Handover response message.\nIf the target radio access is UTRAN or GERAN Iu-mode, then for a speech bearer, the MSC-A server shall perform a call set-up with codec negotiation towards the MSC-A' server, using a Supported Codecs List (BICC) as specified in clause 6.2.2. When MSC-A' receives a Supported Codecs List (BICC) with the IAM message, it shall follow the procedures specified in clause 6.2.2.\nIf the target radio access is GERAN A/Gb mode, then for a speech bearer the anchor MSC shall perform a call set-up with codec negotiation towards the target MSC, using a Supported Codec List (BICC) ordered as:\na)\toptionally, the GSM codec indicated by the serving MSC during the MAP E-interface signalling as Speech Version (Chosen), if it is different from list item b and if supported on Nb bearer;\nNOTE 2:\tThis codec can be included as the preferred codec, if MSC-A knows by means of configuration information that all nodes of the network support TrFO/TFO interworking and TFO, including codec mismatch resolution. If this codec does not match the Selected Codec (BICC), but is eventually selected for the network side bearer to the target MSC (MSC-A'), then either MSC-A must transcode at the anchor MGW or MSC-A will need to trigger a codec modification to the far end. Given that the anchor MSC cannot trigger all these changes at once, it must first establish the network side bearer – i.e. insert a transcoder at the anchor MGW and then trigger the codec modification to the far end as a second step.\nb)\tthe Selected codec (BICC), previously selected for the leg towards the far end party;\nNOTE 3:\tThis codec is preferred, if the anchor MSC-A does not know by means of configuration information if all nodes in the network support OoBTC, or TrFO/TFO interworking and TFO, including codec mismatch resolution. This is also the best codec to be selected if the goal is to avoid additional transcoding in MSC-A or a codec modification from MSC-A towards the far end party.\nc)\tthe default PCM codec;\nd)\toptionally, further GSM codecs that are supported by its associated MGW, e.g. the GSM codec indicated by the serving MSC during the MAP E-interface signalling as Speech Version (Chosen), if it is not already included according to list item a or b and if supported on Nb bearer; and\ne)\toptionally, for subsequent inter-RAT intra MSC-A' handover further codecs from the Available Codec List (BICC) that are applicable to other radio access types.\nFor UDI/RDI multimedia calls with fallback and service change according to 3GPP TS 23.172 [17], the Supported Codecs List (BICC) shall contain the multimedia dummy codec and the Available Codecs List (BICC) can contain this codec (see [17], clause 4.3.7). If the MSC-A server wants to establish a bearer for the multimedia dummy codec, it shall include this codec as the preferred codec.\nIf the target radio access is GERAN A/Gb mode and MSC-A' receives a Supported Codec List (BICC) with the IAM message, MSC-A' shall select a codec from this list, taking the Speech Version (Chosen) and the priorities expressed by the order of the codecs in the Supported Codec List (BICC) into account.\nNOTE 4:\tUsually, selection of the preferred codec of the Supported Codec List (BICC) will result in the best speech quality or best transcoder location or both; however, e.g. if MSC-A' knows by means of configuration information that OoBTC is not supported on some links in the network, and some nodes in the network are not supporting the creation of a \"structured\" Supported Codec List (BICC) as specified in clause 9.7.2, MSC-A' can select another codec, e.g. the codec corresponding to the Speech Version (Chosen) or the default PCM codec.\nNOTE 5:\tIf the procedure specified in this clause is followed for AoIP (e.g. if the AoIP MAP codec negotiation is not supported by MSC-A or MSC-A'), the selection of the Speech Version (Chosen) when not the Selected Codec (BICC) will result in transcoding in the anchor MSC or codec modification to the far end. If the MSC-A' selects the preferred codec in the Supported Codec List (BICC) above and this codec is not equal to the Speech Version (Chosen), this will result in transcoding in the non-anchor MGW.\nIf the Selected Codec (BICC) received by MSC-A in response to the BICC codec negotiation towards the target MSC (MSC-A') is different from the current Selected Codec (BICC) used towards the far end, the MSC-A shall insert a transcoder in MGW-A.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14.1",
        "clause_6.2.2",
        "clause_4.3.7",
        "clause_9.7.2",
        "ts_23.205",
        "ts_23.009",
        "ts_23.172"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.11.2.1",
      "section_id": "6.11.2.1",
      "section_title": "Codec Modification/Mid-Call Codec Negotiation Initiated by the Far End Side",
      "content": "If the serving radio access after inter-MSC handover is GERAN A/Gb mode, and the anchor MSC (MSC-S-A) receives a \"Modification of Selected Codec\" procedure or a \"Mid-Call Codec Negotiation\" procedure from the far end side the MAP signalling between the anchor MSC (MSC-S-A) and the serving MSC (MSC-S-A') shall be performed only, if the old or the new Selected Codec (BICC) is the multimedia dummy codec.\nIf both the old and the new Selected Codec (BICC) are speech codecs, the anchor MSC may terminate the codec modification or mid-call negotiation procedure, inserting a transcoder if required. Alternatively, the anchor MSC may forward the request to the serving MSC (MSC-S-A'), using the procedures as described in clause 5.8.\nNOTE:\tThe anchor MSC may decide to forward the request to the serving MSC (MSC-S-A'), e.g. when it is  possible to (re-)establish Tandem free and Transcoder free operation end-to-end from the far end side up to the serving TRAU.\nIf either the old or the new Selected Codec (BICC) is the multimedia dummy codec, i.e. the far end side requests a service change between speech and multimedia, and the Available Codecs List (BICC) previously negotiated between the anchor MSC and the serving MSC (MSC-S-A') indicates that the service change is supported end-to-end, the anchor MSC shall forward the request to modify the radio access bearer to the serving MSC (MSC-S-A') and then perform a codec modification or mid-call negotiation for the Nb/Nc interface towards the serving MSC (MSC-S-A'), using the procedures as described in clause 5.8. If the service change between speech and multimedia cannot be performed successfully, the anchor MSC shall reject the request for codec modification or mid-call negotiation towards the far end party.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.11.2.2",
      "section_id": "6.11.2.2",
      "section_title": "TFO Codec Mismatch Resolution in the Serving MSC",
      "content": "If the serving radio access after inter-MSC handover is GERAN A/Gb mode, and TrFO has been established between the anchor MSC and the serving MSC, the serving MSC may detect a TFO codec mismatch between the Selected Codec (BICC) used on the TrFO link and the GSM speech codec chosen by the serving BSC.\nIf the serving MSC supports the codec mismatch resolution procedure (see 3GPP TS 28.062 [10], clause 6.3) and wants to change the Selected Codec (BICC) due to this procedure, the serving MSC shall initiate a codec modification or mid-call codec negotiation procedure towards the anchor MSC as described in clauses 5.8.1, 5.8.2 and 5.8.3.\nIn the event of a collision of codec modification/mid-call codec negotiation procedures initiated by the anchor MSC and the serving MSC, the procedures described in Q.1902.4, clause 10.4.7.5 [6] shall apply, with the following modification of the first sentence in clause 10.4.7.5 [6], list item 2:\nCodec modification/mid-call codec negotiation requests initiated in the direction towards the serving MSC shall take precedence over codec modification/mid-call codec negotiation requests initiated in the direction towards the anchor MSC.",
      "chunk_type": "general",
      "cross_references": [
        "ts_28.062_clause_6.3",
        "clause_10.4.7.5",
        "ts_28.062"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.11.2.3",
      "section_id": "6.11.2.3",
      "section_title": "Modification Procedure after Codec Change in the Serving MSC",
      "content": "The procedures as specified in clause 6.2.3.3 apply.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.2.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.12",
      "section_id": "6.12",
      "section_title": "Incoming data call from PSTN",
      "content": "For incoming calls from PSTN, the TMR may not allow to identify  the requested service, since the same value may be used to identify both voice and data calls.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_6.12.1",
      "section_id": "6.12.1",
      "section_title": "Identification of data call at Visited MSC",
      "content": "An incoming data call from the PSTN may be identified as data call using signalling interaction with the terminating UE at the Visited MSC. The following procdures are recommended in a network supporting TrFO to allow the Visited MSC to identify the data call using interactions with the terminating UE:\nThe GMSC includes a G.711(and possibly other codecs) in the BICC supported codec list.\nIf the Visited MSC determines that an incoming call is a data call, it shall select G.711 as codec.\nNote:\tA 64 kbit/s bearer, as required for data calls, will be set up if G.711 is selected.\nFigure 6.12.1/1.Identification of incoming data call at Visited MSC",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.12.1"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.12.2",
      "section_id": "6.12.2",
      "section_title": "Handling at transit exchange in inhomogenous networks",
      "content": "If a transit exchange connecting a packet backbone and a TDM backbone in an inhomogenous network is not able to determine if an incoming call from the packet backbone side is a data call or a speech call (e.g. TMR=3.1kHz is received), it may select G.711 as codec to enable possible data calls.\nNote:\tA 64 kbit/s bearer, as required for data calls, will be set up if G.711 is selected.\nFigure 6.12.2/1.Handling of possible data call at transit exchange between TDM and packet backbone",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.12.2"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.12.3",
      "section_id": "6.12.3",
      "section_title": "Identification of data call at G-MSC using multi-numbering",
      "content": "If the called mobile subscriber is configured with multinumbering service, the GMSC may use the GSM Bearer Capability that may be received from the HLR during the Send Routing Information procedure to identify the requested service and select directly a codec transparent for data call. It may also pass the bearer capability information to subsequent nodes to allow them to select a codec transparent for data call as well (see 3GPP TS 29.007 [19]). This may be particularly usefull in configurations where the terminating MSC does not participate to the codec negotiation procedure, as illustrated in figures 6.12/1 and 6.12/2.\nFigure 6.12.3/1.Use of the GSM Bearer Capability by TDM GMSC for incoming data call from PSTN\nFigure 6.12.3/2.Use of the GSM Bearer Capability by GMSC for incoming data call from PSTN",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.12.3",
        "ts_29.007"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.13",
      "section_id": "6.13",
      "section_title": "Mobile to Mobile TrFO Call Establishment in GERAN AoIP mode",
      "content": "Figure 6.13/1: Configuration during Call Setup of a Mobile to Mobile Call in GERAN AoIP mode\nFigure 6.13/1 shows the configuration for mobile to mobile call establishment in GERAN AoIP mode.\nFollowing network and protocol entities are involved in the scenario, outlined in Figure 6.z/1:\nBSC-T, BSC-O: terminating/originating BSCs.\nMSC Server-T, MSC Server-O: MSC Servers, performing service, i.e. codec negotiation.\nMGW-T, MGW-O: terminating/originating MGWs.\nBSSAP, TICC:C-plane protocol incarnations, responsible for codec negotiation, controlling the respective interfaces (A, NC), creating, modifying, removing etc. terminations and contexts.\nNOTE:\tThe following sequences are examples, further detailed call flows are described in TS 23.205 [6].\nFigure 6.13/2: Call Setup. Mobile to Mobile Call in GERAN AoIP mode. Message Flow part 1\nFigure 6.13/3: Call Setup. Mobile to Mobile Call in AoIP mode. Message Flow part 2\nFigure 6.13/4: Call Setup. Mobile to Mobile Call in AoIP mode. Message Flow part 3\nCodec negotiation\nSteps 1. to 8. give the codec negotiation phase. The BSCs inform the MSC servers their capabilities (1. and 5.). The mobiles inform the network about their capabilities (2. and 6.). The MSC-Server performs codec negotiation according to clause 5.6.\nAssignment procedure\nRAN side terminations have to be seized (9. and 17.) before sending Assignment Request message (steps 10. and 18.). Assignment Request message contains the MSC server preferred codec list. BSC retains the decision to choose the final codec for the radio access and informs the MSC server about the codec to be used in the radio access in Assignment Complete message. Step 20 may then be required to modify the selected codec (SDP) if different from the preferred codec included at step 17.\nNOTE:\tThe BSC should offer codecs that it can support for the call and should therefore under normal circumstances select the MSC preferred codec.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.6",
        "figure_6.13",
        "figure_6",
        "ts_23.205_figure_6.13",
        "ts_23.205"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.14.1",
      "section_id": "6.14.1",
      "section_title": "Inter-MSC Handover in GERAN AoIP mode",
      "content": "The following figures are describing inter-MSC handover in GERAN AoIP mode.\nFigure 6.14/1: Configuration during inter-MSC Handover in GERAN AoIP mode\nFigure 6.14/1 shows the configuration during inter-MSC Handover in GERAN AoIP mode. After setting up the new AoIP interface (towards BSC-A') until releasing the old one, the original TrFO relation (A⇔B) and the target TrFO relation (A'⇔B) exist in parallel. Within the respective contexts interworking between T4 and T5 at MGW-A' and T1, T2 and T3 at MGW-A are necessary:\nT3 (MGW-A) shall perform initialisation towards MGW-A'.\nFigure 6.14/2: Inter-MSC Handover in GERAN AoIP mode and TrFO. Flow chart part 1\nNote: There can be interim network transit nodes between MSC-A and MSC-A'\nFigure 6.14/3: Inter-MSC Handover in GERAN AoIP mode and TrFO. Flow chart part 2\nMAP signalling for handover and codec negotiation\nThe MSC-A server may include an AoIP-Supported Codecs List (Anchor) (MAP) in the MAP Prepare Handover request if MSC-A supports GERAN AoIP mode. Only GSM codecs supported both by the UE and by the anchor MSC may be included in this list. The codec capabilities of the serving radio access, i.e. the radio access used prior to the inter-MSC handover or relocation, need not be taken into account.\nThe anchor MSC-A may decide to include in the AoIP-Supported Codecs List (Anchor) (MAP) only codecs that are also included in the Available Codecs List (BICC) or that are TrFO compatible to codecs in this list.\nNOTE 1:\tThe codec types listed in the Channel Type Information Element are the full list of codec types supported by the UE (as recognised by the Anchor MSC); this list is not affected by the Available Codecs List (BICC) or any resultant AoIP-Supported Codecs List (Anchor) (MAP) IE.\nNOTE 2:\tIf the Available Codecs List (BICC) is kept up-to-date by the far end side by means of modifications of the Available Codecs List (BICC), and the target BSC selects one of the codecs from this list, it may be possible to achieve TrFO after the inter-MSC handover by performing a codec modification to the far end instead of a mid-call codec negotiation.\nWhen selecting the order of priority for the codecs within the AoIP-Supported Codecs List (Anchor) (MAP), MSC-A shall take the Selected Codec (BICC) and the Available Codecs List (BICC) negotiated with the far end party into account.\n-\tIf it is desired to achieve immediate TrFO upon completion of the inter-MSC handover, then the MSC-A server shall include the codec type and configuration of the Selected Codec (BICC) negotiated with the far end or a TrFO compatible codec type and configuration as preferred codec in the AoIP-Supported Codecs List (Anchor) (MAP).\n-\tIf the anchor MSC-A prefers a codec different from the Selected Codec (BICC), then the MSC-A server shall include this other codec as the preferred codec in the AoIP-Supported-Codecs List (Anchor) (MAP). If the preferred codec is selected by the target BSC, transcoding will be required after the inter-MSC handover. The location of the transcoder will be determined during the network side codec negotiation.\nNOTE 3:\tThe anchor MSC-A can select the second alternative e.g. if a subsequent codec modification or mid-call codec negotiation towards the far end is intended.\nIf the target MSC-A' receives the AoIP-Supported Codecs List (Anchor) (MAP) and supports AoIP codec selection based on this list, it shall remove from the AoIP-Supported Codecs List (Anchor) (MAP) and from the BSSMAP Channel Type IE any codecs not supported by its own MGW-A' or by local policy. MSC-A' shall include the remaining codecs in the MSC Preferred Codec List (BSSMAP).\nMSC-A' shall ensure consistency between the contents of the MSC Preferred Codec List (BSSMAP) and the BSSMAP Channel Type IE sent to the target BSS (see 3GPP TS 48.008 [15], clause 3.2.1.8). To this purpose MSC-A' may add codecs to the MSC Preferred Codec List (BSSMAP), if the codec type is also included in the Channel Type IE. For the added codecs MSC-A' shall select a codec configuration supported by MGW-A' and according to preferences configured locally in the target MSC-A'. MSC-A' shall remove any codec types from the BSSMAP Channel Type IE that are not included in the resultant MSC Preferred Codec List (BSSMAP).\nIf MSC-A does not include an AoIP-Supported Codecs List (Anchor) (MAP) in the MAP Prepare Handover request then MSC-A' shall proceed with the handover as described in clause 6.11.1.\nMSC-A' shall include in the MAP Prepare Handover response the AoIP-Selected codec (Target) (MAP) and the AoIP-Available Codecs List (MAP), i.e. the BSS Supported Codecs list returned by BSS-A', if:\n-\tthe target access is GERAN AoIP mode;\n-\tthe target MSC received the AoIP-Supported Codecs List (Anchor) (MAP) in MAP Prepare Handover Request; and\n-\tthe target MSC supports AoIP codec selection based on the received AoIP-Supported Codecs List (Anchor) (MAP).\nIf MSC-A' does not include the AoIP-Selected Codec (Target) (MAP) and the AoIP-Available Codecs List (MAP) IEs in the MAP Prepare Handover response, both MSC-A and MSC-A' shall proceed as described in clause 6.11.1.\nNetwork side bearer establishment and codec handling\nThe handling of the bearer establishment between MSC-A and MSC-A' shall be performed as for a normal call with OoBTC. For a speech bearer, the MSC-A server shall perform a call set-up with codec negotiation towards the MSC-A' server, using a Supported Codec List (BICC) containing:\na)\toptionally, the AoIP-Selected Codec (Target) (MAP) (negotiated with MSC-A' during the MAP E-interface signalling), if it is not already included according to list item b;\nNOTE 3:\tThis codec can be included as the preferred codec, if MSC-A knows by means of configuration information that all nodes of the network support TrFO/TFO interworking and TFO, including codec mismatch resolution. If this codec does not match the Selected Codec (BICC), but is eventually selected for the network side bearer to the target MSC (MSC-A'), then either MSC-A must transcode at the anchor MGW or MSC-A will need to trigger a codec modification to the far end. Given that the anchor MSC cannot trigger all these changes at once it must first establish the network side bearer – i.e. insert a transcoder at the anchor MGW and then trigger the codec modification to the far end as a second step.\nb)\tthe Selected codec (BICC), previously selected for the leg towards the far end party;\nNOTE 4:\tThis codec is preferred, if the anchor MSC-A does not know by means of configuration information if all nodes in the network support OoBTC, or TrFO/TFO interworking and TFO, including codec mismatch resolution. This is also the best codec to be selected if the goal is to avoid additional transcoding in MSC‑A or a codec modification from MSC-A towards the far end party.\nc)\tthe default PCM codec;\nd)\toptionally, further codecs from the AoIP-Supported Codecs List (Anchor) (MAP) that are applicable to the target radio access, e.g. the AoIP-Selected Codec (Target) (MAP), if it is not already included according to list item a or b; and\ne)\toptionally, for subsequent inter-RAT intra MSC-A' handover further codecs from the Available Codec List (BICC) that are applicable to other radio access types.\nFor UDI/RDI multimedia calls with fallback and service change according to 3GPP TS 23.172 [17], the Supported Codecs List (BICC) shall contain the multimedia dummy codec and the Available Codecs List (BICC) can contain this codec (see [17], clause 4.3.7).\nIf MSC-A' receives a Supported Codec List (BICC) with the IAM message, MSC-A' shall select a codec from this list, taking the AoIP-Selected codec (Target) (MAP) and the priorities expressed by the order of the codecs in the Supported Codec List (BICC) into account.\nNOTE 5:\tUsually, selection of the preferred codec of the Supported Codec List (BICC) will result in the best speech quality or best transcoder location or both; however, e.g. if MSC-A' knows by means of configuration information that OoBTC is not supported on some links in the network, and some nodes in the network are not supporting the creation of a \"structured\" Supported Codec List (BICC) as specified in clause 9.7.2, MSC-A' can select another codec, e.g. the AoIP-Selected codec (Target) (MAP) or the default PCM codec.\nIf MSC-A' selects a codec different from the AoIP-Selected codec (Target) (MAP) or if MSC-A' receives an IAM message without a Supported Codec List (BICC), MSC-A' shall insert a transcoder in MGW-A'.\nIf the Selected Codec (BICC) received by MSC-A in response to the BICC codec negotiation towards the target MSC (MSC-A') is different from the current Selected Codec (BICC) used towards the far end, the MSC-A shall insert a transcoder in MGW-A.\nSubsequent inter MSC handover to a third MSC\nThe anchor MSC (MSC-A) server may include AoIP-Supported Codecs List (Anchor) (MAP) in the MAP Prepare Handover request towards the third MSC.",
      "chunk_type": "general",
      "cross_references": [
        "ts_48.008_clause_3.2.1.8",
        "clause_6.11.1",
        "clause_4.3.7",
        "clause_9.7.2",
        "figure_6.14",
        "ts_48.008",
        "ts_23.172"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.14.2.1",
      "section_id": "6.14.2.1",
      "section_title": "Codec Modification Initiated by the Far End Side",
      "content": "Modification of Available Codec List\nIf after inter-MSC handover in GERAN AoIP mode the anchor MSC (MSC-S-A) receives a \"Modification of Available Codec List\" procedure from the far end side as described in clause 5.8.2, i.e. the Available Codecs List (BICC) is reduced, the anchor MSC may terminate the procedure at that point or forward the \"Modification of Available Codec List\" procedure to the serving MSC (MSC-S-A'). I.e. no MAP signalling is used.\nModification of Selected Codec\nIf after inter-MSC handover in GERAN AoIP mode the anchor MSC (MSC-S-A) receives a \"Modification of Selected Codec\" procedure from the far end side as described in clause 5.8.1, and both the old and the new Selected Codec (BICC) are speech codecs, the anchor MSC may terminate the codec modification procedure, inserting a transcoder if required. Alternatively, the anchor MSC may forward the request to modify the codec to the serving MSC (MSC-S-A'), using the procedures as described in clause 5.8.1. I.e. no MAP signalling is used.\nNOTE:\tThe anchor MSC may decide to forward the request to the serving MSC (MSC-S-A'), e.g. when the new Selected Codec (BICC) for the call leg between the anchor MSC and the far end side is TrFO compatible to a codec that was included in the AoIP-Available Codecs List (MAP) previously received from the serving MSC, and it is possible to (re‑)establish TrFO end-to-end from the far end side up to the serving MSC.\nIf the serving MSC (MSC-S-A') receives a request to modify the codec, both the old and the new Selected Codec (BICC) are speech codecs, and the new Selected Codec (BICC) is TrFO compatible to a codec sent by the serving BSC‑A' in the latest Supported Codecs List (BSSMAP) – \"BSC-SCL\", then the serving MSC (MSC-S-A') may initiate an internal handover procedure towards the serving BSC to modify the A interface used codec as specified in 3GPP TS 23.009 [11], clause 6.3, and 3GPP TS 23.205 [8], clause 8.4.6. Upon completion of the internal handover procedure, the serving MSC (MSC-S-A') shall proceed with the codec modification procedure towards the anchor MSC (MSC-S-A).\nIf the anchor MSC (MSC-S-A) receives a \"Modification of Selected Codec\" procedure from the far end side as described in clause 5.8.1, and the new Selected Codec (BICC) is the multimedia dummy codec, i.e. the far end side requests a service change from speech to multimedia then the anchor MSC shall reject the request for codec modification towards the far end party.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.8.2",
        "clause_5.8.1",
        "ts_23.009_clause_6.3",
        "ts_23.205_clause_8.4.6",
        "ts_23.009",
        "ts_23.205"
      ]
    },
    {
      "chunk_id": "ts_23.153_6.14.2.2",
      "section_id": "6.14.2.2",
      "section_title": "Mid-Call Codec Negotiation Initiated by the Far End Side",
      "content": "Support of this procedure is FFS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_6.14.2.3",
      "section_id": "6.14.2.3",
      "section_title": "Modification Procedure after Codec Change in the Serving MSC",
      "content": "According to 3GPP TS 23.009 [11], after a subsequent intra-MSC handover, the serving MSC (MSC-S-A') informs the anchor MSC (MSC-S-A) by sending a MAP Process Access Signalling request including a BSSMAP Handover Performed message. As specified in 3GPP TS 23.009 [11], clause 6.1 and 6.3.2, the serving MSC (MSC-S-A') may inform the anchor MSC (MSC‑S-A) about a change of the AoIP-Selected codec Target (MAP) during the subsequent intra-MSC handover by including the new AoIP-Selected codec Target (MAP) in the MAP Process Access Signalling request. If the AoIP-Available Codecs List (MAP) was changed during the handover, the serving MSC may insert the new AoIP-Available Codecs List (MAP) into MAP Process Access Signalling request.\nNOTE 1:\tIf the codec type or codec configuration used at the AoIP interface was changed and TrFO was established between the serving MSC/MGW and the anchor MSC/MGW before the handover, the serving MSC will insert a transcoder to maintain an end-to-end voice connection before informing the anchor MSC about the handover.\nOn reception of the MAP Process Access Signalling request the anchor MSC may initiate one of the modification procedures as described in clauses 5.8.1, 5.8.2, and 5.8.3 towards the serving MSC and/or towards the far end side. I.e. towards the serving MSC no MAP signalling is used.\nNOTE 2:\tThe anchor MSC can initiate the codec modification procedure as a result of the change of the codec type or codec configuration used at the AoIP interface, if MSC-A knows by means of configuration information that all nodes of the network support TrFO/TFO interworking and TFO, including codec mismatch resolution. The intention of that codec modification procedure is to remove the transcoder inserted by the serving MSC according to NOTE 1 and not to trigger a new change of the radio access bearer.\nAlternatively the serving MSC may initiate one of the modification procedures as described in clauses 5.8.1, 5.8.2, and 5.8.3 towards the anchor MSC.\nIn the event of a collision of codec modification/mid-call codec negotiation procedures initiated by the anchor MSC and the serving MSC, the procedures as specified in clause 6.11.2.2 apply.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.009_clause_6.1",
        "clause_6.11.2.2",
        "ts_23.009"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.1",
      "section_id": "7.1",
      "section_title": "Call Deflection service (GSM 23.072)",
      "content": "In order to apply the confirmation tone to the originating party, the speech insertion procedure described in clause 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.2.1",
      "section_id": "7.2.1",
      "section_title": "Calling Line Identification Presentation (CLIP)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.2.2",
      "section_id": "7.2.2",
      "section_title": "Calling Line Identification Restriction (CLIR)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.2.3",
      "section_id": "7.2.3",
      "section_title": "Connected Line Identification Presentation (COLP)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.2.4",
      "section_id": "7.2.4",
      "section_title": "Connected Line Identification Restriction (COLR)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.3.1",
      "section_id": "7.3.1",
      "section_title": "Call Forwarding Unconditional (CFU)",
      "content": "In order to apply the confirmation tone to the originating party, the speech insertion procedure described in clause 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.3.2",
      "section_id": "7.3.2",
      "section_title": "Call Forwarding on mobile subscriber Busy (CFB)",
      "content": "In order to apply the confirmation tone to the originating party, the speech insertion procedure described in clause 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.3.3",
      "section_id": "7.3.3",
      "section_title": "Call Forwarding on No Reply (CFNRy)",
      "content": "In order to apply the confirmation tone to the originating party, the speech insertion procedure described in clauses 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.3.4",
      "section_id": "7.3.4",
      "section_title": "Call Forwarding on mobile subscriber Not Reachable (CFNRc)",
      "content": "In order to apply the confirmation tone to the originating party, the speech insertion procedure described in clauses 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.4",
      "section_id": "7.4",
      "section_title": "Call wait (GSM 23.083)",
      "content": "In order to apply the notice tone to the interjected party, the speech insertion procedure described in clause 6.4 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.5",
      "section_id": "7.5",
      "section_title": "Call hold (GSM 23.083)",
      "content": "In order to apply the notice tone to the held party, the speech insertion procedure described in clause 6.4 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.6",
      "section_id": "7.6",
      "section_title": "Multiparty (GSM 23.084)",
      "content": "In order to mix calls, the speech insertion procedure described in clause 6.4 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.7",
      "section_id": "7.7",
      "section_title": "Closed user group (GSM 23.085)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.8",
      "section_id": "7.8",
      "section_title": "Advice of charge (GSM 23.086)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.9",
      "section_id": "7.9",
      "section_title": "Userto-user signalling (GSM 23.087)",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.10.1",
      "section_id": "7.10.1",
      "section_title": "Barring of outgoing calls",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.10.2",
      "section_id": "7.10.2",
      "section_title": "Barring of incoming calls",
      "content": "No impact.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_7.11",
      "section_id": "7.11",
      "section_title": "Explicit Call Transfer (GSM 23.091)",
      "content": "In case that a call A-B is transferred to C by B (A-C as result), A-B may use codec x, A-C may use codec y, the procedure described in clause 6.3 is applied.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3"
      ]
    },
    {
      "chunk_id": "ts_23.153_7.12",
      "section_id": "7.12",
      "section_title": "Completion of Calls to Busy Subscriber (3G TS 23.093)",
      "content": "Within CCBS there exists an option for CCBS calls where a bearer can be established before setup in the state \"CC-establishment confirmed\". If the selected codec after setup is different to the one which was used to establish the bearer, RAB assignment (modify) may be required when RAB parameters are different.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_8",
      "section_id": "8",
      "section_title": "Charging",
      "content": "The selected codec shall be included in all the call data records of the call legs involved in out-band codec negotiation belonging to a particular subscriber.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.1",
      "section_id": "9.1",
      "section_title": "General",
      "content": "Codec negotiation procedures for SIP-I are described in the following clauses, where additions or exclusions to the general procedures and principles described in the previous clauses for BICC are required; otherwise it shall be assumed that the others clauses in this specification shall apply to SIP-I on Nc. Normal call handling procedures for SIP-I on Nc are described in 3GPP TS 23.231 [20].\nSIP-I codec negotiation procedures defined in the present specification extend the normal Offer/Answer rules defined by IETF RFC 3264 [24].  In order to identify the compliance to these enhancements, the 3GPP OoBTC Indicator is defined, see 3GPP TS 29.231 [21].\nNOTE:\tNon-speech RTP payload types may also need to be negotiated within the offer/answer procedures , e.g.  the Telephony Event RTP payload type or the ClearMode codec. This is further described in specific clauses in other specifications such as 3GPP TS 23.231 [20] and 3GPP TS 29.007 [19].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.231",
        "ts_29.231",
        "ts_29.007"
      ]
    },
    {
      "chunk_id": "ts_23.153_9.2",
      "section_id": "9.2",
      "section_title": "Framing Protocol",
      "content": "SIP-I user plane does not use IuFP framing protocol or associated 3GUP procedures. Rate control procedures are performed within RTP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.3.0",
      "section_id": "9.3.0",
      "section_title": "Applicability",
      "content": "The procedures in the subsequent clauses 9.3.1 to 9.3.4 are applicable for speech calls and SCUDIF calls. Procedures for SCUDIF calls are further specified in 3GPP TS 23.172 [17]. Procedures to establish data calls are specified in 3GPP TS 23.231 [20] and 3GPP TS 29.007 [19].\nNOTE:\tFor SCUDIF, a Multimedia Dummy Codec is offered together with a speech codec in a single SDP m-line.\nIf an offerer is not able to determine if a call is a data call or a speech call, it shall only offer speech codecs including the PCM codec and apply the procedures in clause 6.12. If codecs other than PCM are also offered, it shall also apply the procedures specified in clauses 9.3.1 to 9.3.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.12",
        "ts_23.172",
        "ts_23.231",
        "ts_29.007"
      ]
    },
    {
      "chunk_id": "ts_23.153_9.3.1",
      "section_id": "9.3.1",
      "section_title": "3GPP Node Originating SDP Offer",
      "content": "-\tAn MSC-S initiating an offer shall include the OoBTC Indicator in the offer.\n-\tIf the offering MSC-S receives an answer without the OoBTC Indicator, the codec list shall be interpreted in accordance with the IETF codec rules. If the answer contains multiple codecs, the MSC-S shall initiate a second offer with the selected codec and may include the OoBTC Indicator or leave it out.\n-\tIf the offering MSC-S receives an answer with the OoBTC Indicator, then the codec list contains the 3GPP Selected Codec and Available Codec List and shall be interpreted to be in accordance with the codec negotiation procedures described in this specification.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.3.2",
      "section_id": "9.3.2",
      "section_title": "3GPP Node Terminating SDP Offer",
      "content": "-\tIf the 3GPP MSC-S terminating the codec negotiation receives an offer with the OoBTC Indicator, it shall include the OoBTC Indicator in the Answer. The returned codec list shall be formatted as a 3GPP Selected Codec List and Available Codec List.\n-\tIf the 3GPP MSC-S terminating the codec negotiation receives an offer without the OoBTC Indicator, the codec list shall be interpreted in accordance with the IETF codec rules and the MSC-S shall initiate an answer with a single codec. It may include the OoBTC Indicator in the Answer or leave it out.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.3.3",
      "section_id": "9.3.3",
      "section_title": "3GPP Intermediate Node Receiving SDP Offer",
      "content": "-\tA 3GPP intermediate node receiving an offer with the OoBTC Indicator shall forward the OoBTC Indicator in the Offer to the succeeding node.\n-\tA 3GPP intermediate node receiving an offer without the OoBTC Indicator shall behave according to two options dependent on implementation option:\n1.\tThe 3GPP intermediate node may forward the (IETF type) codec list to the succeeding node without the OoBTC Indicator.\n2.\tThe 3GPP intermediate node may include the OoBTC indicator in the offer it sends to the succeeding node.\nNOTE:\tThe intermediate node may forward an INVITE for a call that was initiated by the external network (External NW -> intermediate node(s) -> external NW), in which case the offer received from the preceding node may not contain the OoBTC Indicator.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.3.4",
      "section_id": "9.3.4",
      "section_title": "3GPP Intermediate Node Receiving SDP Answer",
      "content": "-\tA 3GPP intermediate node receiving an answer with the OoBTC Indicator shall behave according to the presence of the OoBTC Indicator in the initial offer received from the preceding node.\n1.\tIf the Initial Offer included the OoBTC Indicator, the 3GPP intermediate node shall forward the Answer with the OoBTC Indicator to the preceding node. The codec list shall be formatted as a 3GPP Selected Codec and Available Codec List.\n2.\tIf the Initial Offer did not include the OoBTC Indicator, the 3GPP intermediate node shall forward the Answer without the OoBTC Indicator to the preceding node. The answer shall contain a single codec (mapped from the 3GPP Selected Codec).\n-\tA 3GPP intermediate node receiving the answer with multiple codecs and without the OoBTC Indicator shall behave according to the three options below, dependent on implementation option:\n1.\tThe 3GPP intermediate node may forward the (IETF type) codec list to the preceding node, regardless of whether the preceding node included the OoBTC Indicator in the offer. The answer shall not contain the OoBTC Indicator.\nNOTE:\tThis may be permitted when the intermediate node can support multiple speech codecs during a given session; if this is not the case then option 3 shall be performed.\n2.\tIf the initial offer received by the intermediate node contained the OoBTC Indicator, the 3GPP intermediate node may map the (IETF type) codec list into a 3GPP Selected Codec and Available Codec List and forward this to the preceding node with the OoBTC Indicator. This exchange concludes the offer/answer from the perspective of the preceding node. If the answer contains multiple codecs, the 3GPP intermediate node shall initiate a second offer toward the succeeding node with a single codec (same as the 3GPP Selected Codec) without the OoBTC Indicator.\n3.\tIf the initial offer received by the intermediate node did not contain the OoBTC Indicator the 3GPP intermediate node may signal back to the preceding node a single codec (it shall select the most appropriate codec from the list of received codecs). This exchange concludes the offer/answer from the perspective of the preceding node. The 3GPP intermediate node shall initiate a second offer toward the succeeding node with a single codec (same as the 3GPP Selected Codec) without the OoBTC Indicator.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.4",
      "section_id": "9.4",
      "section_title": "Semantics of 3GPP OoBTC Indicator",
      "content": "After the 3GPP OoBTC Indicator has been negotiated, i.e. the 3GPP OoBTC indicator has been included in both SDP offer and corresponding SDP answer the following rules apply. for both offerer and answerer:\n-\tA change from the Selected Codec to a codec within the Available Codec List (ACL) in the answer, is only permitted using a new SDP offer-answer exchange to re-negotiate the Selected Codec. Inband switching of speech codec types (by sending the new codec with corresponding RTP payload type) is not permitted, and no resources for these codecs need to be reserved e.g. at a MGW.\n-\tCodecs in the Available Codec List indicate codecs that are supported. This information may be used by an MSC to decide if a change of the Selected Codec to some other codec using a new SDP offer-answer exchange is attempted.\nNOTE:\tThe Available Codec List may be used by a (G)MSC as decision criterion if a codec re-negotiation is attempted. However, this does not preclude that an (G)MSC offers codecs not included in the previous ACL in a codec re-negotiation.\n-\tA change from the Selected Codec in the answer to an \"auxiliary\" payload type within the answer, i.e. the RTP Telephony Event (see IETF RFC 4733 [22]) or the comfort noise codec (see IETF RFC3389 [yx]), and vice versa is permitted without new SDP offer-answer exchange by \"Inband\" switching, i.e. by simply sending the other RTP payload type.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.5",
      "section_id": "9.5",
      "section_title": "Handling of Auxiliary Payload types",
      "content": "If auxiliary payload types are negotiated the MSC Server shall configure the MGW to support the multiple payload types for a given termination/stream where applicable (i.e. for speech codec and for RTP Telephony Event and/or comfort noise codec) with the following condition:\n-\tResources for a possible comfort noise codec (RFC3389) within the answer codec shall only be reserved in the MGW by the MSC Server if the comfort noise codec (RFC3389) is applicable for the selected codec. For instance, AMR does contain an internal comfort noise mode and is not used in combination with the comfort noise codec (see IETF RFC3389 [23]).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.6",
      "section_id": "9.6",
      "section_title": "Codec Negotiation Example Sequences",
      "content": "The following figures show examples of codec negotiation for a selection of common call scenarios to highlight the principles agreed in the preceding clause; the sequences are not exhaustive.\nFigure 9.6.1: Mobile Originating Codec Negotiation\nFigure 9.6.2: Mobile Terminating Codec Negotiation – External Node supports OoBTCIndicator\nFigure 9.6.3: Mobile Terminating Codec Negotiation – External Node does not support OoBTCIndicator\nFigure 9.6.4: Codec Negotiation during call forwarding outside of PLMN – external incoming node does not support 3G OoBTCIndicator\nFigure 9.6.5: Codec Negotiation during call forwarding outside of PLMN – external node supports 3G extension\nFigure 9.6.6: Mobile Originating Codec Negotiation with specific codec examples\nFigure 9.6.7: Mobile Terminating Codec Negotiation with specific codec examples",
      "chunk_type": "general",
      "cross_references": [
        "figure_9.6.1",
        "figure_9.6.2",
        "figure_9.6.3",
        "figure_9.6.4",
        "figure_9.6.5",
        "figure_9.6.6",
        "figure_9.6.7"
      ]
    },
    {
      "chunk_id": "ts_23.153_9.7.1",
      "section_id": "9.7.1",
      "section_title": "General",
      "content": "The following are rules that are applied when populating a Session Description Protocol (SDP) media offer or an SDP media answer for 3GPP SIP-I OoBTC. A SIP-I signalling endpoint shall initiate an SDP Offer/Answer exchange during call establishment and may initiate an SDP Offer/Answer exchange at any time that the bearer configuration changes, e.g., during handover or invocation of a supplementary service such as 3pty.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.7.2",
      "section_id": "9.7.2",
      "section_title": "Rules for Constructing an Offer",
      "content": "The Codec List/SDP in the Offer shall contain codecs/payload types defined as follows:\n-\t\"Direct Codec\" payload types that can be used between bearer endpoints without any additional transcoding stage;\n-\t\"Indirect Codec\" payload types that can be used between bearer endpoints with an additional transcoding stage; and\n-\t\"Auxiliary\" payload types unrelated to the primary codec selection process may be included.\nThe Offered Codec List shall contain two sub-lists ordered as: zero or more \"Direct Codecs\" plus zero or more \"Indirect Codecs\". A list of zero or more \"auxiliary\" payload types, e.g., RTP Telephony Events, CN (comfort noise), which are not used in the process of selecting the primary codec, may follow after the direct and indirect codec types.\nThe direct and indirect codec sub-lists shall be ordered in decreasing preference.\nG.711 shall always be included either as direct or indirect codec. When present, the indirect codec sub-list shall always start with G.711, if G.711 is not a direct codec. However, an entry for G.711 shall appear only once in the offered codec list.\nThe offer may contain a list of several direct and indirect codec types.\nNOTE:\tThese rules for constructing an SDP Offer enable TrFO in the network by assuring that the network configures the minimum number of transcoders for each session. These rules are needed to enable TrFO in the network and are consistent with IETF RFC 3264 [24], but are not part of IETF RFC 3264 [24]. Other SIP endpoints may not follow the same conventions for prioritizing codecs. As an exception to the aforementioned rules, the offerer could choose to construct an Offered Codec List in a different order from the one described in the above rules, but this is not recommended as the answerer may select a codec that does not minimize the number of transcoders for the session and does not enable TrFO.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.7.3",
      "section_id": "9.7.3",
      "section_title": "Rules for Constructing an Answer",
      "content": "The answering signalling endpoint shall, before processing the Offer and before populating the Answer, structure the available codec types on its access into \"Direct Codecs,\" \"Indirect Codecs\", and \"auxiliary\" payload types.\nThe answering signalling endpoint shall then take both structured Codec Lists, the one received in the Offer and the one created locally, into account and shall select the \"optimal\" codec type for the Answer, which shall be the first codec type in the Answer; the Selected Codec. The Answer shall contain at least one direct or indirect codec from among those listed in the Offer. The criteria for selecting the \"optimal\" codec may depend on operator choices and preferences (local policy), such as Speech Quality, Bit Rate on transport or DSP load (for transcoding) or other.\nIf the Answer to a subsequent Offer comprises all or a subset of the Direct and Indirect codecs in the preceding Answer within the dialog, then the IP address, and port information in the SDP Answer should remain the same.\nIdeally the Selected \"optimal\" Codec is a direct codec type on both accesses, which results in no transcoding being necessary.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.153_9.8",
      "section_id": "9.8",
      "section_title": "Void",
      "content": "Annex A (informative):Codec Re-negotiation\nA node may perform a procedure (e.g. handover) that results in a completely new list from that which was originally negotiated. Assuming that the current Selected Codec is still common (no Selected Codec Modification or re-negotiation) then the node shall send a Re-negotiation Request with the new Supported Codec List. The Supported codec list may then be punctured by nodes in the network in the same was as for the basic Codec Negotiation procedure and a new Available Codecs List returned.\nIf a node performs a procedure (e.g. handover) that results in both a completely new list and also the need for a new codec then Codec Re-negotiation may be performed with a request for a new codec selection. The procedure is then the same as for an initial codec negotiation.\nAnnex B (normative):Wideband Speech Service\nSupport Of WB speech service\nSeveral compatible Codec Types to enable wideband (WB) speech service are defined in 3G TS 26.103 v.5.0.0. Support of these Codec Typess by a UE is indicated to the MSC by inclusion in the Supported Codecs IE. Note, for GERAN there is also a specific classmark, which includes the radio access' support of WB Codec Typess. Normal TrFO signalling shall apply, where wideband Codec Types may be given preference in the codec list if the wideband service is available to that user.\nCall Establishment\nWhere end-to-end TrFO cannot be achieved (e.g. the external network does not support OoBTC procedures) a decision whether to accept the WB codec type at the interworking point and transcode to  narrowband PCM (G.711) or to remove the wideband codec type from the codec list and only allow narrowband service to continue has to be made. The decision making factors are:\n1)\tIs TFO supported? TFO allows the WB service to be negotiated inband and if successful allow end-to-end WB speech.\n2)\tIf TFO is supported then a NB speech Codec Type may be selected as the initial codec type. If the TFO inband protocol resolves that end-to-end WB speech is possible then mid-call codec negotiation/modification procedures shall be employed to switch to WB service. Alternatively if AMR-WB or EVS is proposed then codec modification will be required if TFO can be successful in NB but cannot be successful in WB. The decision on which Type to select initially should be based on the probability of acceptance of the service.\n3)\tWhich WB Codec Modes shall be permitted? AMR-WB has 3 mandatory modes for all RANs (6.60, 8.85, 12.65) and 2 optional modes for UTRAN & GERAN-8PSK_FR (15.85, 23.85). If transcoding from a WB mode to G.711 then only narrowband speech quality will result. Therefore no gain is obtained by allowing the higher modes whereas additional radio access bandwidth is used.\nEditor's note: [EVSoCS-CT, CR 0130] A description of the mandatory modes and of the optional modes for EVS will be added once SA4 has added the allowed configurations for EVS in 3GPP TS 26.103 [5].\n4)\tDecision rules for codec type selection and AMR-WB codec mode selection are described in TFO specification TS 28.062.\n5)\tIs charging applied to use of higher modes?\nNote:\tTranscoding between WB source encoding and default PCM/G.711 provides similar quality (but no better) as would be achieved by NB source encoding. Thus in many cases avoiding modification back to NB codec (when TrFO cannot be achieved) is preferred. On the other hand the WB Codec Types require slightly higher bit rates and thus are slightly less error robust.\nHandover between WB and NB speech\nHandover of a successfully established WB speech call to a radio access that cannot guarantee the support of WB speech again requires a decsion whether to transcode or modify.\nIf the call has been established end-to-end in WB TrFO, or end-to-end in WB quality including TFO links, then a modification to NB speech on the TrFO link may be preferrable – to avoid inserting of 2 transcoders (one transcoding between WB speech and NB speech). It depends on the possibility to get WB TFO support on that NB radio access. In general the same decision rules apply as for call establishment described above.\nInterworking with external networks (PSTN/ISDN)\nIn ITU-T a WB speech codecalgorithm is defined based on the 3GPP AMR-WB codec algorithm: G.722.2.\nNote:\tIt is desired that all Codec Types based on that WB algorithm are exactly compatible with the 3GPP AMR-WB Codec Types to enable end-to-end WB speech between fixed and mobile. This means that all configuration parameters must be compatible, for example codec mode change in sending direction (encoder side) should adhere to the 40ms interval required for GERAN radio access.\nProvided that G.722.2 is directly compatible interworking to external networks should indicate support for this codec type in the Supported Codec List when AMR-WB codec is received from the UE. Receipt of G.722.2 from an external network shall be translated to support of AMR-WB by the PLMN nodes.\nMulti-party Calls\nA decision whether to modify any WB legs to NB source encoding may be made based on similar decisions as for the call establishment when TrFO is not successful.\nNote:\tThe conference bridge is assumed to convert any WB call leg into NB speech. Calls established in WB that result in subsequent parties being joined in conference or calls being established toward a specific conference bridge will under the existing conferencing technology result in NB speech quality.\nLawful Interception\nLawful Interception of AMR WB speech service or EVS speech service shall be in accordance with clause 4.3.\nAnnex C (informative):Change history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nSubject/Comment\nNew\nSep 1999\nFirst draft prepared by the rapporteur\n0.0.0\nOct 1999\n2nd draft prepared by the rapporteur (Updated version from Abiko.)\n0.1.0\nNov 1999\n3rd draft prepared by the rapporteur\n0.2.0\nDec 1999\nSubmitted to CN#06 for information\n1.0.0\nFeb 2000\n4th draft prepared by the rapporteur\n1.1.0\nFeb 2000\n5th draft prepared by the rapporteur (Updated version from Milan.)\n1.2.0\nFeb 2000\n6th draft prepared by the rapporteur (Updated version from Milan.)\n1.3.0\nFeb 2000\n7th draft prepared by the rapporteur (Updated version from Milan.)\n1.4.0\nFeb 2000\n8th draft prepared by the rapporteur (Updated version from Milan.)\n1.5.0\nMar 2000\nSubmitted to TSG CN#07 for approval\n2.0.0\nOct 2000\n9th draft prepared by the rapporteur (Updated version from Windsor)\n2.0.3\nNov 2000\n10th draft accepted, input to TrFO workshop #5, Stockholm\n2.1.0\nNov 2000\n11th draft, workshop #5 interim editors document.\n2.1.1\nNov 2000\nFinal Draft for approval at CN4 WG #5 (Paris)\n2.2.0\nNov 2000\nFinal Clean version for Approval CN TSG (Bangkok)\n2.3.0\nDec 2000\nCN#10\nNP-000653\nTS 23.153 Out of Band Transcoder Control - Stage 2 approved as version 4.0.0\n4.0.0\nMar 2001\nCN#11\nNP-010084\n001\n1\nCorrect wording of Nb/Iu UP protocol\n4.1.0\nMar 2001\nCN#11\nNP-010084\n003\n1\nAlignment of codec modification procedures with current BICC CS2 procedures\n4.1.0\nMar 2001\nCN#11\nNP-010084\n004\n1\nAlignment of codec modification procedures with current BICC CS2 procedures\n4.1.0\nMar 2001\nCN#11\nNP-010084\n005\n1\nAlignment of codec modification procedures with current BICC CS2 procedures\n4.1.0\nMar 2001\nCN#11\nNP-010084\n006\n1\nInteraction with CCBS\n4.1.0\nMar 2001\nCN#11\nNP-010084\n007\n2\nClause 5.6, establishment of additional calls\n4.1.0\nMar 2001\nCN#11\nNP-010084\n009\n1\nEditorials and minor corrections\n4.1.0\nMar 2001\nCN#11\nNP-010084\n012\n2\nChange of terminology from \"Node X\" to \"MSC Server X\"\n4.1.0\nMar 2001\nCN#11\nNP-010084\n014\n1\nAlignment of codec modification procedures with current BICC CS2 procedures\n4.1.0\nMar 2001\nCN#11\nNP-010084\n015\nAlignment of SRNS Relocation with 3G TS 23.205\n4.1.0\nMar 2001\nCN#11\nNP-010084\n016\nInter-MSC Serving Area SRNS Relocation\n4.1.0\nMar 2001\nCN#11\nNP-010084\n017\n1\nGeneral Improvements\n4.1.0\nMar 2001\nCN#11\nNP-010084\n020\nReference to Q.2630 in certain diagrams should be bearer independent\n4.1.0\nMar 2001\nCN#11\nNP-010084\n021\n1\nInitialisation Issues\n4.1.0\nMar 2001\nCN#11\nNP-010084\n022\n2\nAvoiding double description of Iu framing package procedure\n4.1.0\nJun 2001\nCN#12\nNP-010284\n024\n1\nRole of MSC server in FP UP version negotiation for TrFO\n4.2.0\nJun 2001\nCN#12\nNP-010297\n025\nDefault Codec For UMTS & GSM dual systems\n4.2.0\nSep 2001\nCN#13\nNP-010457\n026\nOptional FRCI value Correction\n4.3.0\nSep 2001\nCN#13\nNP-010532\n027\n1\nDefault Codec Types For \"UMTS only\" and \"UMTS & GSM dual system\" UEs\n4.3.0\nSep 2001\nCN#13\nEditorial clean up\n4.3.0\nDec 2001\nCN#14\nNP-010620\n028\nRemoval of \"No Data\" SDUs\n4.4.0\nDec 2001\nCN#14\nNP-010620\n029\nClarification for Codec Modification in case of SS/IN interworking\n4.4.0\nMar 2002\nCN#15\nNP-020066\n030\n2\nCodec fallback in TrFO Call Establishment to External Network\n5.0.0\nJun 2002\nCN#16\nNP-020247\n033\n2\nIntroduction of AMR-WB\n5.1.0\nSep 2002\nCN#17\nNP-020458\n031\n4\nIntroduction of GERAN Iu-mode\n5.2.0\nSep 2002\nCN#17\nNP-020444\n041\nInitial Bitrate For TrFO\n5.2.0\nSep 2002\nCN#17\nNP-020444\n043\n1\nHandling of UMTS_AMR & UMTS_AMR_2 codecs in OoBTC\n5.2.0\nDec 2002\nCN#18\nNP-020578\n039\n2\nCorrection/clarification to Codec Modification Procedures\n5.3.0\nDec 2002\nCN#18\nNP-020578\n049\n2\nAlignment on the optionality on usage of Global Titel Translation in case of relocation between RNC's connected to different 3G MSC's\n5.3.0\nMar 2003\nCN#19\nNP-030097\n053\nGuaranteed Bitrate & Maximum Bitrate settings for TrFO\n5.4.0\nJun 2003\nCN#20\nNP-030222\n051\nInter-MSC SRNS relocation with TrFO\n5.5.0\nJun 2003\nCN#20\nNP-030211\n055\n2\nClarification of use of Default PCM codec and handling of the Codec List\n5.5.0\nJun 2003\nCN#20\nNP-030211\n057\nClarification of handling of DTMF in TrFO\n5.5.0\nJun 2003\nCN#20\nNP-030211\n059\n1\nClarification of use of TMR for codec negotiation\n5.5.0\nSep 2003\nCN#21\nNP-030380\n063\n1\nClarification on codec modification\n5.6.0\nSep 2003\nCN#21\nNP-030380\n067\n1\nClarification of IuUP Initialisation during codec modification\n5.6.0\nSep 2003\nCN#23\nNP-040053\n068\n5\nCodec Modification/ Mid-Call Codec Negotiation after Inter-MSC Relocation\n5.7.0\nSep 2003\nCN#23\nNP-040053\n069\n4\nCorrection of Inter-MSC SRSN Relocation procedure\n5.7.0\nJun 2004\nCN#24\nNP-040214\n071\n1\nCorrection of Codec Negotiation and supported codec mode configurations\n5.8.0\nJun 3004\nCN#24\nNP-040219\n072\nCorrection to clause 6.5 on information flow after UMTS to GSM handover\n5.8.0\nDec 2004\nCN#26\nNP-040520\n076\nTFO/TrFO compatibility of UMTS_AMR and UMTS_AMR2\n5.9.0\nDec 2004\nCN#26\nNP-040520\n078\n1\nDetailed description of the handling of codec negotiation parameters\n5.9.0\nDec 2004\nCN#26\nNP-040520\n080\n3\nAddition of missing condition for transcoder free operation in the MGW\n5.9.0\nDec 2004\nCN#26\nNP-040528\n081\nCorrection of the inter-MSC handover during TrFO\n5.9.0\nDec 2004\nCN#26\nNP-040548\n074\n1\n3GUP properties correction\n6.0.0\nMar 2005\nCN#27\nNP-050053\n085\n2\nNew ‘TFO status' event\n6.1.0\nMar 2005\nCN#27\nNP-050034\n089\nCorrection of the condition for the insertion of a transcoder\n6.1.0\nJun 2005\nCT#28\nCP-050079\n092\n1\nCodec Selection at Terminating Call Control Node for OoBTC\n6.2.0\nSep 2005\nCT#29\nCP-050285\n095\n2\nTrFO/TFO Codec Negotiation\n6.3.0\nSep 2005\nCT#29\nCP-050316\n098\n2\nCS data Mobile Terminating calls from PSTN\n7.0.0\nDec 2005\nCT#30\nCP-050628\n0099\n2\nHandling of CS data calls in inhomogeneous networks\n7.1.0\nMar 2007\nCT#35\nCP-070014\n0100\nCodec negotiation during Inter-MSC handover\n7.2.0\nDec 2007\nCT#38\nCP-070752\n0101\n3\nAddition of Codec Negotiation for SIP-I\n8.0.0\nSep 2008\nCT#41\nCP-080466\n0106\n1\nAoIP impacts to OoBTC procedures\n8.1.0\nSep 2008\nCT#41\nCP-080464\n0107\n1\nAddition of CS data call related codec considerations\n8.1.0\nDec 2008\nCT#42\nCP-080710\n0108\nEnhanced SRNS relocation\n8.2.0\nDec 2008\nCT#42\nCP-080710\n0110\n1\nOoBTC BICC Codec List\n8.2.0\nDec 2008\nCT#42\nCP-080686\n0111\n1\nRemoval of SDP offer/answer requirements for CSD calls\n8.2.0\nDec 2008\nCT#42\nCP-080697\n0112\n1\nCorrection to Codec lists definitions\n8.2.0\nDec 2008\nCT#42\nCP-080697\n0114\n2\nSignalling between MSC and GERAN AoIP-mode\n8.2.0\nMar 2009\nCT#43\nCP-090030\n0115\n2\nClarification of MSC-PCL contents\n8.3.0\n2009-12\n-\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\nDec 2010\nCT#50\nCP-100682\n0116\n10\nAoIP – MAP level codec negotiation for GSM codecs\n9.1.0\nMar 2011\nCT#51\nCP-110050\n0118\n1\nCodec modification after inter-MSC handover\n9.2.0\nMar 2011\n-\n-\n-\n-\nUpdate to Rel-10 version (MCC)\n10.0.0\nDec 2011\nCT#54\nCP-110813\n0119\n1\nUsage of TFO Codec List\n11.0.0\nJun 2012\nCT#56\nCP-120268\n0122\n4\nCorrection of codec modification after inter-MSC handover\n11.1.0\nSep 2013\nCT#61\nCP-130462\n0129\n1\nGERAN Iu Mode\n12.0.0\nJun 2015\nCT#68\nCP-150272\n0130\n1\nAdding support for the EVS codec over UMTS CS\n13.0.0\nMar 2016\nCT#71\nCP-160027\n0131\n1\nResolution of Editor's notes on EVS over UMTS CS\n13.1.0\n2016-12\nCT#74\nCP-160662\n0133\n1\nUpdates to OoBTC codec negotiation procedures for EVS\n13.2.0\n2017-03\nCT#75\n-\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2018-06\n-\n-\n-\n-\nUpdate to Rel-15 version (MCC)\n15.0.0\n2020-07\nCT#88e\n-\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2022-03\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.3",
        "clause_5.6",
        "clause_6.5",
        "ts_26.103",
        "ts_28.062",
        "ts_23.153",
        "ts_23.205",
        "ts_4.1",
        "ts_8.3"
      ]
    }
  ]
}