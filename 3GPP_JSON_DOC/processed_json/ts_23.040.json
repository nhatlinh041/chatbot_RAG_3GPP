{
  "metadata": {
    "specification_id": "ts_23.040",
    "version": "18.0.0",
    "title": "3GPP TS 23.040",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23040-i00/23040-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:43:39.063961",
    "total_chunks": 146
  },
  "chunks": [
    {
      "chunk_id": "ts_23.040_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document describes the Short Message Service (SMS) for GSM/UMTS/EPS/5GS networks. It defines:\n-\tthe services and service elements;\n-\tthe network architecture;\n-\tthe Service Centre functionality;\n-\tthe SMS Router functionality;\n-\tthe MSC functionality (with regard to the SMS);\n-\tthe SGSN functionality (with regard to the SMS);\n-\tthe MME functionality (with regard to the SMS);\n-\tthe SMSF functionality;\n-\tthe routing requirements;\n-\tthe protocols and protocol layering;\nfor the Mobile Originated and Mobile Terminated Short Message Service Teleservices, as specified in  3GPP TS 22.003 [2] and 3GPP TS 22.105 [32].\nThe use of radio resources for the transfer of short messages between the MS and the MSC or the SGSN or the MME is described in 3GPP TS 24.011 [13].\nThe present document also describes the Short Message Service (SMS) for EPS networks supported via \"SMS in MME\" (see 3GPP TS.23.272 [45], annex C).\nThe present document also describes the SGSN supporting Diameter based protocol for SMS between the SGSN and the central SMS functions (SMS-GMSC, SMS-IWMSC, SMS-Router) in annex J.\nThe present document also describes SMS for 5GS networks (see 3GPP TS 23.501 [51] and 3GPP TS 23.502 [52]).\nThe network aspects of Short Message Service provision are outside the scope of the present document (i.e. the provision of network connectivity between the PLMN subsystems). There is no technical restriction within the present document for the transfer of short messages between different PLMNs. Any such restriction is likely to be subject to commercial arrangements and PLMN operators must make their own provision for interworking or for preventing interworking with other PLMNs as they see fit.\nThe required and assumed network service offered to the higher layers is defined in the present document.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.003",
        "ts_22.105",
        "ts_24.011",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.040_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\tVoid\n[2]\t3GPP TS 22.003: \"Circuit Teleservices supported by a Public Land Mobile Network (PLMN)\".\n[3]\t3GPP TS 22.004: \"General on supplementary services\".\n[4]\t3GPP TS 22.041: \"Operator Determined Barring (ODB)\".\n[5]\t3GPP TS 23.002: \"Network architecture\".\n[6]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[7]\t3GPP TS 23.011: \"Technical realization of supplementary services\".\n[8]\t3GPP TS 23.015: \"Technical realization of Operator Determined Barring (ODB)\".\n[9]\t3GPP TS 23.038: \"Alphabets and language‑specific information\".\n[10]\t3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".\n[11]\tVoid\n[12]\t3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core Network Protocols; Stage 3\".\n[13]\t3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support on mobile radio interface\".\n[14]\t3GPP TS 27.005: \"Use of Data Terminal Equipment ‑ Data Circuit terminating Equipment (DTE ‑ DCE) interface for Short Message Service (SMS) and Cell Broadcast Service (CBS)\".\n[15]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[16]\t3GPP TS 51.011 Release 4 (version 4.x.x): \"Specification of the Subscriber Identity Module ‑ Mobile Equipment (SIM‑ ME) interface\".\n[17]\tCCITT Recommendation E.164 (Blue Book): \"The international public telecommunication numbering plan\".\n[18]\tCCITT Recommendation E.163 (Blue Book): \"Numbering plan for the international telephone service\".\n[19]\tCCITT Recommendation Q.771: \"Specifications of Signalling System No.7; Functional description of transaction capabilities\".\n[20]\tCCITT Recommendation T.100 (Blue Book): \"International information exchange for interactive videotex\".\n[21]\tCCITT Recommendation T.101 (Blue Book): \"International interworking for videotex services\".\n[22]\tCCITT Recommendation X.121 (Blue Book): \"International numbering plan for public data networks\".\n[23]\tCCITT Recommendation X.400 (Blue Book): \"Message handling services: Message handling system and service overview\".\n[24]\tISO/IEC10646: \"Universal Multiple‑Octet Coded Character Set (USC); UCS2, 16 bit coding\".\n[25]\t3GPP TS 22.022: \"Personalisation of Mobile Equipment (ME); Mobile functionality specification\".\n[26]\t3GPP TS 23.042: \"Compression Algorithm for Text Messaging Services\".\n[27]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[28]\t3GPP TS 31.115: \"Secured packet structure for (U)SIM toolkit application\".\n[29]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[30]\t3GPP TS 31.102: \"Characteristics of the USIM application\".\n[31]\t3GPP TS 31.101: \"UICC – Terminal interface; Physical and logical characteristics\".\n[32]\t3GPP TS 22.105: \"Services and Service Capabilites\".\n[33]\tInfrared Data Association. Specifications for Ir Mobile Communications (IrMC).iMelody.\n[34]\tIETF RFC 5322 (October 2008): \"Internet Message Format\".\n[35]\tVoid\n[36]\t\"vCard - The Electronic Business Card\", version 2.1,The Internet Mail Consortium (IMC), September 18, 1996, URL:http://www.imc.org/pdi/vcard-21.doc\".\n[37]\t\"vCalendar - the Electronic Calendaring and Scheduling Format\", version 1.0,The Internet Mail Consortium (IMC), September 18, 1996,URL:http://www.imc.org/pdi/vcal-10.doc\n[38]\tScalable Polyphony MIDI Specification, MIDI Manufacturers Association (2002); http://www.midi.org\n[39]\tScalable Polyphony MIDI Device 5-to-24 Note Profile for 3GPP, MIDI Manufacturers Association (2002); http://www.midi.org\n[40]\tThe Complete MIDI 1.0 Detailed Specification, Incorporating all Recommended Practices, MIDI Manufacturers Association, Document version 96.1, 1996; http://www.midi.org\n[41]\t3GPP TS 23.097: Multiple Subscriber Profile (MSP) (Phase 2) - Stage 2\n[42]\t3GPP TS 23.204: \"Support of SMS over generic 3GPP IP access; Stage 2\".\n[43]\tIETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".\n[44]\tIETF RFC 3428 (December 2002): \"Session Initiation Protocol (SIP) Extension for Instant Messaging\".\n[45]\t3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System (EPS); Stage 2\".\n[46]\t3GPP TS 29.272: \"Evolved Packet System (EPS); Mobility Management Entity (MME) and Serving GPRS Support Node (SGSN) related interfaces based on Diameter protocol\".\n[47]\t3GPP TS 29.118: \"Mobility Management Entity (MME) – Visitor Location Register (VLR) SGs interface specification\".\n[48]\t3GPP TS 23.682: \"Architecture enhancements to facilitate communications with packet data networks and applications\".\n[49]\tVoid.\n[50]\t3GPP TS 29.338: \"Diameter based protocols to support of SMS capable MMEs\".\n[51]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[52]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[53]\t3GPP TS 23.540: \"5G System; Technical realization of Service Based Short Message Service; Stage 2\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.003",
        "ts_22.004",
        "ts_22.041",
        "ts_23.002",
        "ts_23.008",
        "ts_23.011",
        "ts_23.015",
        "ts_23.038",
        "ts_23.041",
        "ts_24.008",
        "ts_24.011",
        "ts_27.005",
        "ts_29.002",
        "ts_51.011",
        "ts_22.022",
        "ts_23.042",
        "ts_23.060",
        "ts_31.115",
        "ts_21.905",
        "ts_31.102",
        "ts_31.101",
        "ts_22.105",
        "ts_23.097",
        "ts_23.204",
        "ts_23.272",
        "ts_29.272",
        "ts_29.118",
        "ts_23.682",
        "ts_29.338",
        "ts_23.501",
        "ts_23.502",
        "ts_23.540"
      ]
    },
    {
      "chunk_id": "ts_23.040_2.1.1",
      "section_id": "2.1.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the following terms and definitions apply:\nNOTE 1:\tThe term \"mobile station\" (MS) in the present document is synonymous with the term \"user equipment\" (UE) in UMTS terminology as defined in 3GPP TR 21.905 [29].\nactive MS: switched‑on mobile station with a SIM/UICC see 3GPP TS 31.101 [31] module attached\nalert‑SC: service element provided by a GSM/UMTS PLMN to inform an SC which has previously initiated unsuccessful short message delivery attempt(s) to a specific MS, that the MS is now recognized by the PLMN to have recovered operation\nstatus report: SC informing the originating MS of the outcome of a short message submitted to an SME\nGateway MSC For Short Message Service (SMS‑GMSC): function of an MSC capable of receiving a short message from an SC, interrogating an HLR for routing information and SMS info, and delivering the short message to the VMSC or the SGSN of the recipient MS\nInterworking MSC For Short Message Service (SMS‑IWMSC): function of an MSC capable of receiving a short message from within the PLMN and submitting it to the recipient SC\nIP-Short-Message-Gateway (IP-SM-GW): function responsible for protocol interworking between the IP-based UE and the SC\nLoop Prevention (LP): information element that allows SMS applications to inhibit forwarding or automatic message generation that could cause infinite looping.\nMessages‑Waiting (MW): ervice element that makes a PLMN store information (Messages‑Waiting‑Indication), listing those SCs that have made unsuccessful short message delivery attempts to MSs in that PLMN\nMessages‑Waiting‑Indication (MWI): data to be stored in the HLR and VLR with which an MS is associated, indicating that there is one or more messages waiting in a set of SCs to be delivered to the MS (due to unsuccessful delivery attempt(s))\nMessages‑Waiting‑Data (MWD): part of the MWI to be stored in the HLR. MWD consists of an address list of the SCs which have messages waiting to be delivered to the MS\nMobile Management Entity (MME): exchange which performs packet switching functions for mobile stations located in a geographical area designated as the MME area.\nMobile-services Switching Centre (MSC): exchange which performs switching functions for mobile stations located in a geographical area designated as the MSC area\nMobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF): part of the MWI to be stored in the HLR\nNOTE 2:\tMCEF is a Boolean parameter indicating if the address list of MWD contains one or more entries because an attempt to deliver a short message to an MS has failed with a cause of MS Memory Capacity Exceeded\nMobile‑Station‑Not‑Reachable‑Flag (MNRF): part of the MWI to be stored in the VLR, the MME, and the HLR. The MME supports all the requirements specified in the present document for the VLR with regard to the MNRF.\nNOTE 3:\tMNRF is a Boolean parameter indicating if the address list of MWD contains one or more entries because an attempt to deliver a short message to an MS has failed with a cause of Absent Subscriber.\nMobile‑station‑Not-Reachable-for-GPRS (MNRG): part of the MWI to be stored in the SGSN and the HLR\nNOTE 4:\tMNRG is a Boolean parameter indicating if the address list of MWD contains one or more entries because an attempt to deliver a short message to an MS has failed with a cause of Absent Subscriber.\nMobile‑Station‑Not‑Reachable-via-the-MSC-Reason (MNRR-MSC): part of the MWI in the HLR which stores the reason for an MS being absent when an attempt to deliver a short message to an MS fails at the MSC with a cause of Absent Subscriber\nMobile‑Station‑Not‑Reachable-via-the-SGSN-Reason (MNRR-SGSN): part of the MWI in the HLR which stores the reason for an MS being absent when an attempt to deliver a short message to an MS fails at the SGSN with a cause of Absent Subscriber\nMore‑Messages‑To‑Send (MMS): information element offering an MS receiving a short message from an SC the information whether there are still more messages waiting to be sent from that SC to the MS\nNOTE 5:\tThe TP‑MMS element (conveyed in the Transfer layer) is copied into the RP‑MMS element (conveyed in the Relay layer). It is possible with Phase 2 and later versions of MAP (3GPP TS 29.002 [15]) for the RP‑MMS element to keep a short message transaction open between the SMS-GMSC and the MS in the case where there are more‑messages‑to‑send. Earlier versions of MAP support the transport of the TP‑MMS element.\npriority: service element enabling the SC or SME to request a short message delivery attempt to an MS irrespective of whether or not the MS has been identified as temporarily absent\nprotocol‑identifier: information element by which the originator of a short message (either an SC or an MS) may refer to a higher layer protocol\nreceiving MS: the mobile station to which an MT short message is destined.\nreply path procedure: mechanism which allows an SME to request that an SC should be permitted to handle a reply sent in response to a message previously sent from that SME to another SME\nNOTE 6:\tThis may happen even though the SC may be unknown to the SME which received the initial message.\nreport: response from either the network or the recipient upon a short message being sent from either an SC or an MS\nNOTE 7:\tA report may be a delivery report, which confirms the delivery of the short message to the recipient, or it may be a failure report, which informs the originator that the short message was never delivered and the reason why.\nWhen issued by the Service Centre, the delivery report confirms the reception of the Short Message by the SC, and not the delivery of the Short Message to the SME.\nWhen issued by the Mobile Station, the delivery report confirms the reception of the Short Message by the Mobile Station, and not the delivery of the Short Message to the user.\nreplace short message type: range of values in the Protocol Identifier which allows an indication to be sent with a short message (MT or MO) that the short message is of a particular type allowing the receiving MS or the SC to replace an existing message of the same type held in the SC, the ME or on the SIM/UICC, provided it comes:\n‑\tin MT cases:\tfrom the same SC and originating address;\n‑\tin MO cases:\tfrom the same MS.\nsending MS: the mobile station from which an MO short message is sourced.\nService Centre (SC): function responsible for the relaying and store‑and‑forwarding of a short message between an SME and an MS\nNOTE 8:\tThe SC is not a part of the GSM/UMTS PLMN, however MSC and SC may be integrated.\nServing GPRS Support Node (SGSN): exchange which performs packet switching functions for mobile stations located in a geographical area designated as the SGSN area\nshort message (SM): information that may be conveyed by means of the Short Message Service\nNOTE 9:\tAs described in the present document.\nShort Message Entity (SME): entity which may send or receive Short Messages\nNOTE 10:\tThe SME may be located in a fixed network, an MS, or an SC.\nSMS‑STATUS‑REPORT: short message transfer protocol data unit informing the receiving MS of the status of a mobile originated short message previously submitted by the MS, i.e. whether the SC was able to forward the message or not, or whether the message was stored in the SC for later delivery\nSMS‑COMMAND: short message transfer protocol data unit which enables an MS to invoke an operation at the SC\nNOTE 11:\tAn MS may then, for example, delete a short message, cancel a TP-Status-Report-Request, enquire about the status of a short message or request another function to be performed by the SC.\nNOTE 12:\tThe type of operation is indicated by the TP‑Command‑Type and the particular short message to operate on is indicated by the TP‑Message‑Number and the TP‑Destination‑Address. Receipt of an SMS‑COMMAND is confirmed by an RP‑ACK or RP‑ERROR. In the case of certain SMS‑COMMANDs, an SMS‑STATUS‑REPORT may be sent, where the outcome of the SMS‑COMMAND is passed in its TP‑Status field.\nSMS‑DELIVER: short message transfer protocol data unit containing user data (the short message), being sent from an SC to an MS\nSMS‑SUBMIT: short message transfer protocol data unit containing user data (the short message), being sent from an MS to an SC\nService‑Centre‑Time‑Stamp (SCTS): information element offering the recipient of a short message the information of when the message arrived at the SM‑TL entity of the SC\nNOTE 13:\tThe time of arrival comprises the year, month, day, hour, minute, second and time zone.\nsingle-shot short message (Single-shot SM): the short message contains an indication for the SC to attempt delivery only once.\nUE‑Not-Reachable-for-IP (UNRI): part of the MWI to be stored in the IP-SM-GW and the HSS/HLR\nNOTE 14:\tUNRI is a Boolean parameter indicating if the address list of MWD contains one or more entries because an attempt to deliver a short message to an UE has failed with a cause of Absent Subscriber.\nUE‑Not‑Reachable-Reason (UNRR): part of the MWI in the HSS/HLR which stores the reason for an UE being absent when an attempt to deliver a short message to an UE fails at the IP-SM-GW.\nValidity‑Period (VP): information element enabling the originator MS to indicate the time period during which the originator considers the short message to be valid.\nFor the purposes of the present document, the following terms and definitions given in 3GPP TS 23.038 [9] apply:\nNational Language Identifier\nNational Language Locking Shift Table\nNational Language Single Shift Table",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905",
        "ts_31.101",
        "ts_29.002",
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_2.1.2",
      "section_id": "2.1.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations defined in 3GPP TR 21.905 [29] and the following apply:\nSM MO\tShort Message Mobile Originated\nSM MT\tShort Message Mobile Terminated\nSM‑AL\tShort Message Application Layer\nSM‑LL\tShort Message Lower Layers\nSM‑RL\tShort Message Relay Layer\nSM‑RP\tShort Message Relay Layer Protocol\nSM‑RS\tShort Message Relay Service\nSM‑TL\tShort Message Transfer Layer\nSM‑TP\tShort Message Transfer Layer Protocol\nSM‑TS\tShort Message Transfer Service\nSSN\tSub‑System Number\nTPDU\tTransfer protocol data unit",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.040_3",
      "section_id": "3",
      "section_title": "Services and service elements",
      "content": "The SMS provides a means to transfer short messages between a GSM/UMTS MS and an SME via an SC. The SC serves as an interworking and relaying function of the message transfer between the MS and the SME.\nThe present document describes only the short message services between the MS and SC. It may, however, refer to possible higher layer applications.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.1",
      "section_id": "3.1",
      "section_title": "Basic services",
      "content": "The Short Message Service comprise two basic services:\nSM MT\t(Short Message Mobile Terminated);\nSM MO\t(Short Message Mobile Originated).\nSM MT denotes the capability of the GSM/UMTS system to transfer a short message submitted from the SC to one MS, and to provide information about the delivery of the short message either by a delivery report or a failure report with a specific mechanism for later delivery; see figure 1.\nSM MO denotes the capability of the GSM/UMTS system to transfer a short message submitted by the MS to one SME via an SC, and to provide information about the delivery of the short message either by a delivery report or a failure report. The message shall include the address of that SME to which the SC shall eventually attempt to relay the short message; see figure 2.\nThe text messages to be transferred by means of the SM MT or SM MO contain up to 140 octets.\nShort message delivery\nReport\nFigure 1: The Short Message Service mobile terminated\nShort message submission\nReport\nFigure 2: The Short Message Service mobile originated\nAn active MS shall be able to receive a short message TPDU (SMS‑DELIVER) at any time, independently of whether or not there is a speech or data call in progress. A report shall always be returned to the SC; either confirming that the MS has received the short message, or informing the SC that it was impossible to deliver the short message TPDU to the MS, including the reason why.\nAn active MS shall be able to submit a short message TPDU (SMS‑SUBMIT) at any time, independently of whether or not there is a speech or data call in progress. A report shall always be returned to the MS; either confirming that the SC has received the short message TPDU, or informing the MS that it was impossible to deliver the short message TPDU to the SC, including the reason why.\nNOTE:\tWhen the transmission or reception of a short message coincide with a change of state in the MS, i.e. from busy to idle or from idle to busy, or during a handover, the short message transfer may be aborted.\nIt is also possible for two short messages to be received in sequence having the same originating address and identification, i.e. message reference number (MO) or SC Timestamp (MT). Such a situation may be due to errors at the RP or CP layers (e.g. during inter MSC handover) where it may be a duplicated message or otherwise it may be a valid new message.The receiving entity should therefore make provision to check other parameters contained in the short message to decide whether the second short message is to be discarded.",
      "chunk_type": "general",
      "cross_references": [
        "figure_1",
        "figure_2"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.0",
      "section_id": "3.2.0",
      "section_title": "Introduction",
      "content": "The SMS comprises 8 elements particular to the submission and reception of messages:\nValidity‑Period;\tService‑Centre‑Time‑Stamp;\tProtocol‑Identifier;\tMore‑Messages‑to‑Send;\tPriority;\tMessages‑Waiting;\tAlert‑SC. \tMT Correlation ID.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.2.1",
      "section_id": "3.2.1",
      "section_title": "Validity‑Period",
      "content": "The Validity‑Period is the information element which gives an MS submitting an SMS‑SUBMIT to the SC the possibility to include a specific time period value in the short message (TP‑Validity‑Period field, see clause 9). The TP‑Validity‑Period parameter value indicates the time period for which the short message is valid, i.e. for how long the SC shall guarantee its existence in the SC memory before delivery to the recipient has been carried out.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.2",
      "section_id": "3.2.2",
      "section_title": "Service‑Centre‑Time‑Stamp",
      "content": "The Service‑Centre‑Time‑Stamp is the information element by which the SC informs the recipient MS about the time of arrival of the short message at the SM‑TL entity of the SC. The time value is included in every SMS‑DELIVER (TP‑Service‑Centre‑Time‑Stamp field, see clause 9) being delivered to the MS.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.3",
      "section_id": "3.2.3",
      "section_title": "Protocol‑Identifier",
      "content": "The Protocol‑Identifier is the information element by which the SM‑TL either refers to the higher layer protocol being used, or indicates interworking with a certain type of telematic device.\nThe Protocol‑Identifier information element makes use of a particular field in the message types SMS‑SUBMIT, SMS‑SUBMIT-REPORT for RP-ACK, SMS‑DELIVER DELIVER, SMS-DELIVER-REPORT for RP-ACK, SMS_STATUS_REPORT and SMS‑COMMAND TP‑Protocol‑Identifier (TP‑PID).",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.2.4",
      "section_id": "3.2.4",
      "section_title": "More‑Messages‑to‑Send",
      "content": "The More‑Messages‑to‑Send is the information element by which the SC informs the MS that there is one or more messages waiting in that SC to be delivered to the MS. The More‑Messages‑to‑Send information element makes use of a Boolean parameter in the message SMS‑DELIVER, TP‑More‑Messages‑to‑Send (TP‑MMS).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.2.5",
      "section_id": "3.2.5",
      "section_title": "Delivery of Priority and non‑Priority Messages",
      "content": "Priority is the information element provided by an SC or SME to indicate to the PLMN whether or not a message is a priority message.\nDelivery of a non‑priority message shall not be attempted if the MS has been identified as temporarily absent (see clause 3.2.6).\nDelivery of a non‑priority message shall be attempted if the MS has not been identified as temporarily absent irrespective of whether the MS has been identified as having no free memory capacity (see clause 3.2.6).\nDelivery of a priority message shall be attempted irrespective of whether or not the MS has been identified as temporarily absent, or having no free memory capacity.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_3.2.6"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.6",
      "section_id": "3.2.6",
      "section_title": "Messages‑Waiting",
      "content": "The Messages‑Waiting is the service element that enables the PLMN to provide the HLR, SGSN and VLR with which the recipient MS is associated with the information that there is a message in the originating SC waiting to be delivered to the MS. The service element is only used in case of previous unsuccessful delivery attempt(s) for non Single-short SM due to temporarily absent mobile or MS memory capacity exceeded. This information, denoted the Messages‑Waiting‑Indication (MWI), consists of Messages‑Waiting‑Data (MWD), the Mobile-station-Not-Reachable-for-GPRS (MNRG), the UE-Not-Reachable-for-IP (UNRI), the Mobile‑Station‑Not‑Reachable‑Flag (MNRF), the Mobile-Not-Reachable-via-the-MSC-Reason (MNRR-MSC), the Mobile-Not-Reachable-via-the-SGSN-Reason (MNRR-SGSN), the UE Not Reachable-Reason (UNRR) and the Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) located in the HLR; the Mobile-station-Not Reachable-for-GPRS (MNRG) located in the SGSN, and the Mobile‑Station‑Not‑Reachable‑Flag (MNRF) located in the VLR. Figure 3 shows an example.\nFigure 3: Example of how information on one MS can be put in relation to SC(s)in order to fulfil the requirement of Alert‑SC mechanism\nThe MWD shall contain a list of addresses (SC‑Addr) of SCs which have made previous unsuccessful delivery attempts of a message (see clause 5). In order to be able to send alert messages to every SC which has made unsuccessful delivery attempts for a non Single-shot SM to an MS, the HLR shall store the MSIsdn‑Alert or IMSI-Alert (see clause 3.2.7) together with references to the SC addresses. The requirements placed upon the HLR are specified in GSM TS 03.08 [6]. The description of how the HLR is provided with SC and MS address information is given in 3GPP TS 29.002 [15].\nThe Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) within the HLR is a Boolean parameter with the value TRUE an attempt to deliver a short message to an MS has failed with a cause of MS Memory Capacity Exceeded, and with the value FALSE otherwise.\nThe Mobile‑station‑Not Reachable-for-GPRS (MNRG) within the HLR and the SGSN is a Boolean parameter with the value TRUE when an attempt to deliver a short message to an MS has failed with a cause of Absent Subscriber, and with the value FALSE otherwise (except as described in note 1 below).\nThe Mobile‑Station‑Not‑Reachable‑Flag (MNRF) within the HLR and the VLR is a Boolean parameter with the value TRUE when the list MWD contains one or more list elements because an attempt to deliver a short message to an MS has failed with a cause of Absent Subscriber, and with the value FALSE otherwise.\nThe UE‑Not‑Reachable‑for-IP (UNRI) within the HLR/HSS and IP-SM-GW is a Boolean parameter with the value TRUE when the list MWD contains one or more list elements because an attempt to deliver a short message to an UE has failed with a cause of Absent Subscriber, and with the value FALSE otherwise.\nThe Mobile-Station-Not-Reachable-via-the-MSC-Reason (MNRR-MSC) within the HLR stores the reason for the MS being absent when an attempt to deliver a short message to an MS fails at the MSC with the cause Absent Subscriber. The HLR updates the MNRR-MSC with the reason for absence when an absent subscriber diagnostic information is received from the SMS-GMSC and the MNRF is set. The HLR clears the MNRR-MSC when the MNRF is cleared. If the MNRF is set due to a failure at the MSC with cause Absent Subscriber and information pertaining to the absence of the MS is not available from the SMS-GMSC, the MNRR-MSC shall remain in a cleared state. The MNRR-MSC shall either be in a cleared state or contain one of the following reasons:\nNo Paging Response via the MSC;\nIMSI Detached.\nThe Mobile-Station-Not-Reachable-via-the-SGSN-Reason (MNRR-SGSN) within the HLR stores the reason for the MS being absent when an attempt to deliver a short message to an MS fails at the SGSN with the cause Absent Subscriber. The HLR updates the MNRR-SGSN with the reason for absence when an absent subscriber diagnostic information is received from the GMSC and the MNRG is set. The HLR clears the MNRR-SGSN when the MNRG is cleared. If the MNRG is set due to a failure at the SGSN with cause Absent Subscriber and information pertaining to the absence of the MS is not available from the GMSC, the MNRR-SGSN shall remain in a cleared state. The MNRR-SGSN shall either be in a cleared state or contain one of the following reasons:\nNo Paging Response via the SGSN;\nGPRS Detached.\nNOTE 1:\tThe MNRG can also be set in the HLR and in the SGSN after an unsuccessful attempt to invoke the network requested PDP-Context Activation procedure. In this case, no SC address is stored in MWD list (see 3GPP TS 23.060 [27]).\nNOTE 2:\tWhen a short message delivery attempt fails at the HLR due to Roaming being Restricted, the MS being deregistered in HLR or the MS being Purged the absent subscriber diagnostic reason is returned to the SC, however the reason is not stored in the MNRR-MSC or MNRR-SGSN.\nThe UE-Station-Not-Reachable-Reason (UNRR) within the HSS/HLR stores the reason for the UE being absent when an attempt to deliver a short message to an UE fails at the IP-SM-GW with the cause Absent Subscriber. The HSS/HLR updates the UNRR with the reason for absence when an absent subscriber diagnostic information is received from the IP-SM-GW and the UNRI is set. The HSS/HLR clears the UNRR when the UNRI is cleared. If the UNRI is set due to a failure at the IP-SM-GW with cause Absent Subscriber, the UNRR shall remain in a cleared state. The UNRR shall either be in a cleared state or contain one of the following reasons:\nNo Response via the IP-SM-GW;\nUE deregistered.\nThe MWD, MCEF, MNRR-MSC, MNRR-SGSN, MNRG, MNRF, UNRI and UNRR are updated in the following way:\n1a)\tWhen a mobile terminated short message delivery fails at the MSC due to the MS being temporarily absent (i.e. either IMSI DETACH flag is set or there is no response from the MS to a paging request via the MSC), the SC address is inserted into the MWD list (if it is not already present), the MNRF is set (if it is not already set) and the MNRR-MSC is updated (if the information is available), as described in clause 10.\n1b)\tWhen a mobile terminated short message delivery fails at the SGSN due to the MS being temporarily absent (i.e. either GPRS DETACH flag is set or there is no response from the MS to a paging request via the SGSN), the SC address is inserted into the MWD list (if it is not already present), the MNRG is set (if it is not already set) and the MNRR-SGSN is updated (if the information is available), as described in clause 10.\n1c)\tWhen a mobile terminated short message delivery fails at the MSC due to the MS memory capacity being exceeded, the SC address is inserted into the MWD list (if it is not already present),the MCEF is set (if it is not already set), the MNRF is cleared and the MNRR-MSC is cleared.\n1d)\tWhen a mobile terminated short message delivery fails at the SGSN due to the MS memory capacity being exceeded, the SC address is inserted into the MWD list (if it is not already present), the MCEF is set (if it is not already set), the MNRG is cleared and the MNRR-SGSN is cleared.\n1e)\tWhen a mobile terminated short message delivery fails due to the UE memory capacity via the IP-SM-GW being exceeded, the SC address is inserted into the MWD list (if it is not already present), the MCEF is set (if it is not already set), the UNRI is cleared and the UNRR is cleared.\n1f)\tIf the MSIsdn or IMSI used by the SC to address the recipient MS for alerting purposes is different from the MSIsdn‑Alert or IMSI-Alert of the MS (see clause 3.2.7), the HLR returns the MSIsdn‑Alert or IMSI-Alert to the SC within the failure report, see \"1c Failure report\" in figures 15 and 16.\n2a)\tWhen either the HLR or VLR detects that the MS has recovered operation (e.g. has responded to a paging request over MSC), the HLR directly or on request of the VLR shall clear MNRF and MNRR-MSC. Then, if with a non empty MWD list and the MCEF clear, the HLR shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted by the HLR, the address for that SC shall be deleted from the MWD. If the MCEF is set in the HLR, the HLR shall not invoke operations to alert the SCs within the MWD and data are not cleared from the MWD.\n2b)\tWhen either the HLR or SGSN detects that the MS has recovered operation (e.g. has responded to a paging request via the SGSN), the HLR directly or on request of the SGSN shall clear MNRG and MNRR-SGSN. Then, if with a non empty MWD list and the MCEF clear, the HLR shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted by the HLR, the address for that SC is deleted from the MWD. If the MCEF is set in the HLR, the HLR shall not invoke operations to alert the SCs within the MWD and data are not cleared from the MWD.\n2c)\tWhen the IP-SM-GW informs the HLR/HSS that the UE is reachable for SMS over IP, either due to an IMS registration or due to the UE becoming available again, the HLR/HSS shall clear the UNRI and UNRR. Then, if with a non empty MWD list and the MCEF clear, the HLR/HSS shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). After each SC is alerted by the HLR/HSS, the address for that SC is deleted from the MWD. If the MCEF is set in the HLR/HSS, the HLR/HSS shall not invoke operations to alert the SCs within the MWD and data are not cleared from the MWD.\n2d)\tWhen the HLR receives (via the MSC and the VLR) a notification that the MS (with a non‑empty MWD and the MCEF set in the HLR) has memory capacity available to receive one or more short messages, the HLR shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC operations have been invoked, the MNRF is cleared in the VLR and the MCEF, MNRF and MNRR-MSC are cleared in the HLR. After each SC is alerted by the HLR, the address for that SC is deleted from the MWD.\n2e)\tWhen the HLR receives (via the SGSN) a notification that the MS (with a non‑empty MWD and the MCEF set in the HLR) has memory capacity available to receive one or more short messages, the HLR shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC operations have been invoked, the MNRG is cleared in the SGSN and the MCEF, MNRG and MNRR-SGSN are cleared in the HLR. After each SC is alerted by the HLR, the address for that SC is deleted from the MWD.\n2f)\tWhen the HLR/HSS receives (via the IP-SM-GW) a notification that the UE (with a non‑empty MWD and the MCEF set in the HLR/HSS) has memory capacity available to receive one or more short messages, the HLR/HSS shall invoke operations to alert the SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC operations have been invoked, the UNRI and UNRR are cleared in the HLR/HSS. After each SC is alerted by the HLR/HSS, the address for that SC is deleted from the MWD.\n2g)\tWhen the HLR receives from the SMS‑GMSC a notification that a short message has been successfully delivered from an SC to an MS via the MSC for which the MCEF is set and the MWD are not empty, the HLR shall invoke operations to alert other SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC operations have been invoked, the MCEF, MNRF and MNRR-MSC are cleared in the HLR. After each SC is alerted by the HLR, the address for that SC is deleted from the MWD. The SC which successfully delivered the message is also deleted from the MWD, if present.\n2h)\tWhen the HLR receives from the SMS‑GMSC a notification that a short message has been successfully delivered from an SC to an MS via the SGSN for which the MCEF is set and the MWD are not empty, the HLR shall invoke operations to alert other SCs within the MWD (see clause 3.2.7 and clause 10). Once the Alert SC operations have been invoked, the MCEF, MNRG and MNRR-SGSN are cleared in the HLR. After each SC is alerted by the HLR, the address for that SC is deleted from the MWD. The SC which successfully delivered the message is also deleted from the MWD, if present.\n2i)\tWhen the HLR receives (via the MSC and the VLR, or the SGSN) a notification that the MS has memory capacity available to receive one or more short messages but the MCEF is not set and the MWD are empty, the HLR acknowledges the notification but does not alert any service centre.\nNOTE 3:\tThe HLR can be in a situation where the MWD list is empty but where either MNRF or MNRG (with the related MNRR-MSC or MNRR-SGSN) is still set. This enables the HLR to return the correct address (MSC or SGSN address) at the next Send Routing Information Request from the SMS-GMSC.\nNOTE 4:\tIf the SMS delivery failed on first attempt via the MSC or the SGSN (see cases 1a for IMSI Detach and 1b for GPRS Detach), and is successful on the second attempt (see cases 2e and 2f), the SC address shall not be inserted into the MWD list",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "clause_3.2.7",
        "clause_10",
        "figure_3",
        "ts_03.08",
        "ts_29.002",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.7",
      "section_id": "3.2.7",
      "section_title": "Alert‑SC",
      "content": "The Alert‑SC is the service element, which may be provided by some GSM/UMTS PLMNs, to inform the SC that an MS:\n1)\tto which a delivery attempt has failed because the MS is not reachable or because the MS memory capacity was exceeded; and\n2)\twhich is now recognized by the PLMN:\na)\tto have resumed operation (e.g. to have responded to a paging request); or\nb)\tto have memory newly available (which implies that the mobile is reachable).\nis again ready to receive one or more short messages. The SC may ‑ on reception of an Alert‑SC ‑ initiate the delivery attempt procedure for the queued messages destined for this MS.\nTo each MS there may be allocated one or more MSIsdns or External-Identifier(s). When the HLR is to alert an SC that an MS is again attainable it shall use a specific MSIsdn or IMSI corresponding to the External-Identifier for this purpose; in the present document called MSIsdn‑Alert or IMSI-Alert.\nNOTE 5:\tRepeated delivery attempts from the SC may be of two types:\ni)\tA repeated delivery attempt because the SC has been informed that the MS is active and available to receive short messages.\nii)\tAn autonomous repeated delivery attempt by the SC.\nThe application of these two options is defined by the providers of the SC and the network.\n3.2.7a\tMT Correlation ID\nThe MT Correlation ID is a service element used only when the HPLMN of the receiving MS is using an SMS Router or an IP-SM-GW. It is used to correlate a Forward SM operation to a previous Info Retrieval operation.\nUse of the MT Correlation ID enhances security. By analysing the Correlation ID received in a Forward Short message operation, it can be easily checked from where the associated Info Retrieval operation originated, thus resulting in detection of \"fake\" and \"spoofed\" SMs.\nThe MT Correlation ID is used in place of the IMSI in the IMSI IE at the protocol layer. Hence, its structure is defined to be exactly the same as this element.\nNOTE:\tUsing an MT Correlation ID in place of the real IMSI has the added benefit of enhancing subscriber privacy in that the full IMSI is not shared with the HPLMN of the sending MS.\nThe MT Correlation ID shall be composed as shown in figure 3a below.\nFigure 3a: Structure of the MT Correlation ID\nThe MT Correlation ID is composed of three parts:\n1)\tMobile Country Code (MCC) of the HPLMN of the receiving MS. It consists of three decimal digits.\n2)\tMobile Network Code (MNC) of the HPLMN of the receiving MS. It consists of three decimal digits. If the MNC of the HPLMN of the receiving MS is 2 digits only in length, the first digit of the MSIN shall be appended to the right‑hand side.\n3)\tSender ID. It consists of nine decimal digits and shall be unique for its lifetime. For security purposes, its value shall be a number allocated at random, rather than sequentially.\nAn example of the MT Correlation ID is:\nSender ID: 569123006\nIMSI in use: 234151234567890\nWhere:\nMCC = 234;\nMNC = 15;\nMSIN = 1234567890,\nWhich gives the MT Correlation ID: 234151569123006.",
      "chunk_type": "general",
      "cross_references": [
        "figure_3"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.8",
      "section_id": "3.2.8",
      "section_title": "Options concerning MNRG, MNRF, UNRI, MNRR-MSC, MNRR-SGSN, UNRR, MCEF and MWD",
      "content": "Setting the Mobile‑Station‑Not‑Reachable‑Flag (MNRF) in the VLR is mandatory. Setting the Mobile‑station‑Not-Reachable-for-GPRS (MNRG) in the SGSN is mandatory. It is mandatory for the VLR or the SGSN to send the \"MS Reachable\" message (see clause 10) to the HLR when the MS has been detected as becoming active and then to clear MNRF in the VLR or the MNRG in SGSN.\nThe Messages‑Waiting‑Data (MWD), the Mobile‑Station‑Not‑Reachable‑Flag (MNRF), the Mobile‑station‑Not-Reachable-for-GPRS (MNRG), the Mobile-Station-Not-Reachable-via-the-MSC-Reason (MNRR-MSC), the Mobile-Station-Not-Reachable-via-the-SGSN-Reason (MNRR-SGSN), and the Mobile‑Station‑Memory‑Capacity‑Exceeded‑Flag (MCEF) within the HLR are optional, but if one is implemented all must be implemented (except MNRG and MNRR-SGSN if the HLR does not support GPRS). This is linked to the transmission of the \"Alert SC\" message.\nThe following describes what happens when a delivery fails.\nCase 1: MWD, MNRF, MNRG, UNRI, MNRR-MSC, MNRR-SGSN, UNRR,and MCEF are implemented in the HLR.\nIn the case of a delivery failure (to an MS) with cause Absent Subscriber, the SMS-GMSC requests the HLR to add, if needed, a new entry in the MWD with cause Absent Subscriber. This new entry contains the SC address. The HLR sets its copy of the MNRF, MNRG or both and updates the MNRR-MSC, MNRR-SGSN or both (if the information is available). The SC is notified of the failure, the reason for the MS being absent and also of the MWD setting in the HLR within the Report message (see clause 10).\nIf a delivery through an IP-SM-GW fails (to an MS) with cause Mobile Station Memory Capacity Exceeded via the SGSN, IP-SM-GW, or the MSC, the IP-SM-GW requests the HSS to add, if needed, a new entry in the MWD with cause Mobile Station Memory Capacity Exceeded. This new entry contains the SC address. The HLR sets the MCEF and resets MNRF, MNRG, or UNRI. The SC is notified of the failure and also of the MWD setting in the HLR within the Report message (see clause 10).\nIn the case of a delivery failure (to an MS) with cause Mobile Station Memory Capacity Exceeded via the SGSN or the MSC, the SMS-GMSC or SMS Router requests the HLR to add, if needed, a new entry in the MWD with cause Mobile Station Memory Capacity Exceeded. This new entry contains the SC address. The HLR sets the MCEF and resets MNRF or MNRG. The SC is notified of the failure and also of the MWD setting in the HLR within the Report message (see clause 10).\nIf the HLR indicates that it is able to store the SC address, then the SC shall receive an Alert SC message when the MS becomes active.\nIf the HLR indicates that it is unable to store the SC address (e.g. because MWD is full), then the only way to ensure delivery is for the SC to try to retransmit the message periodically.\nWhen the HLR receives the MS Reachable message, if the MCEF is clear it sends an Alert SC message to the concerned SC, updates MWD and clears MNRF (if the MS is reachable via the MSC) or MNRG (if the MS is reachable via the SGSN) or UNRI (if the MS is reachable via the IP-SM-GW).\nWhen the HLR receives the MS Memory Capacity Available message, it sends an Alert SC message to the concerned SC, updates MWD, clears the MCEF and clears MNRF (if the MS is reachable via the MSC), UNRI (if the UE is reachable via the IP-SM-GW) or MNRG (if the MS is reachable via the SGSN).\nCase 2: MWD, MNRF, MNRG, MNRR-MSC, MNRR-SGSN and MCEF are not implemented in the HLR.\nNOTE:\tHLRs supporting SMSIP and having implemented MWD, MNRF, MNRG, MNRR, MCEF shall also implement UNRI and UNRR\nIn the case of a delivery failure, the SC is notified that the HLR is unable to store its address in the MWD. In case of a delivery failure (to a MS) with cause Absent Subscriber, the SC is notified of the reason for the MS being absent (if the information is available). The SC must retransmit the short message periodically in order to ensure delivery.\nThe HLR discards the MS Reachable message received from the VLR or SGSN without any failure or error report.\nThe HLR discards the MS Memory Capacity Available message received from the MS via the MSC and the VLR or SGSN without any failure or error report.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.2.9",
      "section_id": "3.2.9",
      "section_title": "Status report capabilities",
      "content": "The SMS also offers to the SC the capabilities of informing the MS of the status of a previously sent mobile originated short message. The status of the message can be:\n‑\tSuccessfully delivered to the SME;\n‑\tThe SC was not able to forward the message to the SME. The reason can be an error of permanent or temporary nature. Permanent errors can be e.g. validity period expired, invalid SME address. Errors of temporary nature can be e.g. SC‑SME connection being down, SME temporarily unavailable.\nThis is achieved by the SC returning a status report TPDU (SMS‑STATUS‑REPORT) to the originating MS when the SC has concluded the status of the short message. The status report may be initiated by a status report request within the mobile originated short message. The status report TPDU is treated as an SMS‑DELIVER TPDU by the SC when it comes to delivery procedures e.g. the alerting mechanism.\nThe SC may also return to a non‑MS SME the status of a mobile terminated short message. This is however outside the scope of the present document.\nThe status report capabilities of the SMS are optional, i.e. the choice of whether to offer status report or not is left to the SC operator.\nFor reasons of resilience and/or load sharing architecture of SMSC's by network operators, the SMSC address (the RP‑OA) used by the SMSC to send the Status Report to the MS cannot be guaranteed to be the same SMSC address (RP-DA) used by the MS to submit the SM to which the Status Report refers. Where an MS wishes to implement a check that these addresses correlate, a means of disabling the correlation check shall be provided at the MS through MMI.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.2.10",
      "section_id": "3.2.10",
      "section_title": "Reply Path",
      "content": "Reply Path specified in the present document provides a way of both requesting and indicating a service centre's commitment to deliver a reply from the replying MS to the originating SME.\nAnnex D deals with MS procedures, which in general are outside the scope of GSM/UMTS specifications. However, for advanced use of the SMS, including both application level protocols and human responses, it is of vital importance to guarantee that a reply‑supporting MS is able to reply on every SM, to every SME capable of receiving such reply short messages.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.3.0",
      "section_id": "3.3.0",
      "section_title": "General",
      "content": "Unsuccessful message transfer SC ‑> MS may be caused by a variety of different errors. The description of the occurrence of the different errors and how to handle and transfer the error indications is given in 3GPP TS 24.008 [12], 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15].\nThe different error indications which the SMS‑GMSC shall be capable of returning to the SC following an unsuccessful short message TPDU transfer SC ‑> MS, are given in table 1. In some cases, additional diagnostic information may be provided.",
      "chunk_type": "definition",
      "cross_references": [
        "table_1",
        "ts_24.008",
        "ts_24.011",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.3.1",
      "section_id": "3.3.1",
      "section_title": "Errors occurring during transfer of TPDU to MS",
      "content": "These errors are generally due to barring or unsupported service in the PLMN or MS. An error indication is returned to the SC from the SMS‑GMSC, but further diagnostic information from the MS shall not be available.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.3.2",
      "section_id": "3.3.2",
      "section_title": "Errors occurring after TPDU arrives at MS",
      "content": "These errors may occur due to the MS not supporting optional short message service features, or in connection with a short message application. An error indication shall be returned to the SC from the SMS‑GMSC. Additionally, a TPDU (SMS‑DELIVER‑REPORT) containing diagnostic information may be conveyed from the MS to the originating SC, transparently through the PLMN, by means defined in 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15]. The sending of the diagnostic information is optional at the MS, but when it is sent, the PLMN shall convey the information to the SC, and the SC shall support reception of the information.\nTable 1: Error indications related to mobile terminated short message transfer which may be transferred to the originating SC\nError indication\nS1)\nMeaning\nUnknown subscriber\nP\nThe PLMN rejects the short message TPDU because there is not allocated an IMSI or a directory number for the mobile subscriber in the HLR (see 3GPP TS 29.002 [15]).\nTeleservice not provisioned\nP\nThe PLMN rejects the short message TPDU because the recipient MS has no SMS subscription (see 3GPP TS 29.002 [15]).\nCall barred\nT\nThe PLMN rejects the short message TPDU due to barring of the MS (see 3GPP TS 29.002 [15], description of the Barring supplementary service, 3GPP TS 22.004 [3] and 3GPP TS 23.011[7]), description of Call barred due to Unauthorised Message Originator, 3GPP TS 29.002 [15], and description of Operator Determined Barring, 3GPP TS 22.041 [4] and 3GPP TS 23.015 [8]).\nFacility not supported\nT\nThe VPLMN rejects the short message TPDU due to no provision of the SMS in the VPLMN (see 3GPP TS 29.002 [15]).\nAbsent subscriber\nT\nThe PLMN rejects the short message TPDU because\n-\tthere was no paging response via the SGSN, MSC or both (see 3GPP TS 24.008 [12] & 3GPP TS 29.002 [15])\n‑\tthe IMSI GPRS or both records are marked detached (see 3GPP TS 29.002 [15]);\n‑\tthe MS is subject to roaming restrictions (see \"Roaming not allowed\", 3GPP TS 29.002 [15]);\n-\tderegistered in the HLR. The HLR does not have an MSC, SGSN or both numbers stored for the target MS, (see 3GPP TS 29.002 [15]);\n-\tUnidentified subscriber (see 3GPP TS 29.002 [15]);\n-\tMS purged (see 3GPP TS 29.002 [15]) ;\n-\tthe MS is not registered in the HSS/HLR for IMS;\n-\tthere was no SIP response received by the IP-SM-GW;\n-\tthe MS is temporarily unavailable (e.g. in power saving mode due to eDRX).\n(The reasons for absence are assigned integer values in table 1a. The appropriate integer value is sent with the absent subscriber error indication as defined in 3GPP TS 29.002 [15])\nMS busy for MT SMS\nT\nThe PLMN rejects the short message TPDU because of congestion encountered at the visited MSC or the SGSN. Possible reasons include any of the following events in progress:\n-\tshort message delivery from another SC;\n-\tIMSI or GPRS detach\n-\tLocation Update or Inter SGSN Routing Area Update;\n-\tpaging;\n-\temergency call;\n-\tcall setup.\nSMS lower layerscapabilities not provisioned\nT\nThe PLMN rejects the short message TPDU due to MS not being able to support the Short Message Service.\nThe short message transfer attempt is rejected either due to information contained in the class‑mark, or the MSC not being able to establish connection at SAPI = 3 (see 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15]).\nError in MS\nT\nThe PLMN rejects the short message TPDU due to an error occurring within the MS at reception of a short message, e.g. protocol error.\nIllegal Subscriber\nP\nThe PLMN rejects the short message TPDU because the MS failed authentication.\nIllegal Equipment\nP\nThe PLMN rejects the short message TPDU because the IMEI of the MS was on the prohibited list in the EIR.\nSystem failure\nT\nThe PLMN rejects the short message TPDU due to network or protocol failure others than those listed above (see 3GPP TS 29.002 [15]).\nMemory Capacity Exceeded\nT\nThe MS rejects the short message since it has no memory capacity available to store the message.\n1)\t: Status (Permanent or Temporary)\nThe relation between the two sets of error indications is given in the table 1. Each error is classified as either \"Temporary\" or \"Permanent\". This classification gives an indication of whether or not it is probable that the MS becomes attainable within a reasonable period, and so provides the recommended action to be taken by the SC, i.e. either to store the message for later transfer, or to discard it.\nTable 1a: Assignment of values to reasons for absence(values must be in the range of 0 to 255, see 3GPP TS 29.002 [15])\nValues\nReason for absence\n0\n-\tno paging response via the MSC\n1\n-\tIMSI detached\n2\n-\troaming restriction\n3\n-\tderegistered in the HLR for non GPRS\n4\n-\tMS purged for non GPRS\n5\n-\tno paging response via the SGSN\n6\n-\tGPRS detached\n7\n-\tderegistered in the HLR for GPRS\n8\n-\tMS purged for GPRS\n9\n-\tUnidentified subscriber via the MSC\n10\n-\tUnidentified subscriber via the SGSN\n11\n-\tderegistered in the HSS/HLR for IMS\n12\n-\tno response via the IP-SM-GW\n13\nthe MS is temporarily unavailable\nAll 'non GPRS' reasons (except for roaming restriction) can be combined with all 'GPRS' reasons and vice-versa\nAll other integer values are reserved.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_1",
        "ts_24.011",
        "ts_29.002",
        "ts_22.004",
        "ts_23.011",
        "ts_22.041",
        "ts_23.015",
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.4",
      "section_id": "3.4",
      "section_title": "Unsuccessful short message TPDU transfer MS ‑> SC",
      "content": "The error indications related to mobile originated short message transfer which may be transferred to the originating MS are given in 3GPP TS 24.011 [13]. In some cases, additional diagnostic information may be provided.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.4.1",
      "section_id": "3.4.1",
      "section_title": "Errors occurring during transfer of TPDU to SC",
      "content": "These errors are generally due to barring or unsupported service in the PLMN. An error indication is returned to the MS from the MSC or the SGSN, but further diagnostic information from the SC shall not be available.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.4.2",
      "section_id": "3.4.2",
      "section_title": "Errors occurring after TPDU arrives at SC",
      "content": "These errors may occur due to the SC not supporting optional short message service features, or in connection with a short message application. An error indication shall be returned to the MS from the MSC or from the SGSN. Additionally, a TPDU (SMS‑SUBMIT‑REPORT) containing diagnostic information may be conveyed from the SC to the originating MS, transparently through the PLMN, as defined in 3GPP TS 29.002 [15] and 3GPP TS 24.011 [13]. The sending of the diagnostic information is optional at the SC, but when it is sent, the PLMN shall convey the information to the MS, and the MS shall support reception of the information.\nNote:\tThe SMS‑SUBMIT‑REPORT is part of the negative acknowledgement to the mobile originated short message, and is not part of the status report capabilities described in clause 3.2.9.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_3.2.9",
        "ts_29.002",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.5",
      "section_id": "3.5",
      "section_title": "Use of Supplementary Services in combination with the Short Message Service",
      "content": "Only a sub‑set of the Supplementary Services defined in 3GPP TS 22.004 [3]and 3GPP TS 23.011 [7] may be used in combination with the Short Message Service. This sub‑set comprises the following Supplementary Services:\nAll the 5 Barring services.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.004",
        "ts_23.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.6",
      "section_id": "3.6",
      "section_title": "Applicability of Operator Determined Barring to the Short Message Service",
      "content": "The network feature Operator Determined Barring (see 3GPP TS 22.041 [4]) applies to the Short Message Service.\nIf a short message fails due to operator determined barring then an appropriate error cause is returned to the originator.",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.041"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.7",
      "section_id": "3.7",
      "section_title": "Multiple short message transfer",
      "content": "To avoid the need for a mobile to be paged, authenticated etc. for each message waiting in the Service Centre, the SC may indicate to the SMS-GMSC that there are more messages to send. When this indication is given, MAP procedures are invoked such that this indication is passed to the VMSC, and the VMSC does not release the MS until all short messages waiting in the SC have been transferred.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8",
      "section_id": "3.8",
      "section_title": "SMS and Internet Electronic Mail interworking",
      "content": "The interworking between Internet electronic mail and SMS is offered in both directions which enables new and old mobiles to send/receive Internet electronic mails via SMS. The interworking is according to the following procedures:\n-\tAn SMS message which is required to interwork with Internet email may have its TP‑PID value set for Internet electronic mail;\nNOTE:\tThere is an alternative mechanism described in clause 9.2.3.24 providing full RFC 5322 [34] internet electronic mail interworking.\n-\tEither single or concatenated SMS can be used to transport the email;\n-\tConcatenation may be achieved by the TPUDH mechanism, in which case the concatenation is carried out at a lower level to the formats specified in clauses 3.8.1 and 3.8.2. Alternatively, concatenation may be achieved using the text‑based means described below;\n-\tEmail cc fields are not supported;\n-\tWhere multiple fields are present, additional spaces may be inserted by the sender to improve presentation of the message. Spaces may not be inserted into the actual email address (e.g. user@domain1.domain2).",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.8.1",
      "section_id": "3.8.1",
      "section_title": "Basic Format",
      "content": "The basic format for transferring email in either direction consists of the following:\nMT SMS:\n[<from‑address><space>]<message>\nMO SMS:\n[<to‑address><space>]<message>\nwhere [] denote optional fields and <> delimit fields.\nThe to‑address or from address may take the form:\nuser@domain1.domain2\nor\nUser Name <user@domain1.domain2>\nIn the latter case the angle brackets <> are part of the address and are actually transmitted.\nDepending on the nature of the gateway, the destination/origination address is either derived from the content of the SMS TP‑OA or TP‑DA field, or the TP‑OA/TP‑DA field contains a generic gateway address and the to/from address is added at the beginning as shown above.\nMultiple addresses may be identified in MO messages by separating each address by a comma like this:\naddress1,address2,address3<space><message>\nIt is optional for the receiving gateway to support this. If the receiving gateway does not support multiple messages then it shall reject the original message by returning an appropriate error in a text message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8.2",
      "section_id": "3.8.2",
      "section_title": "Optional Fields",
      "content": "The following further optional fields are supported. An email <‑> SMS gateway may insert additional spaces in the MT message for presentation to the user, and must accept additional spaces in the MO message from the user.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8.2.1",
      "section_id": "3.8.2.1",
      "section_title": "Subject",
      "content": "The subject is placed between the address and the message, delimited by round brackets () or preceded by ##, for example:\n[<to‑address>](<subject>)<message>\nor\n[<to‑address>]##<subject>#<message>\nAn MO message may contain either format. An MT message may contain either format. Developers must ensure that both forms are supported for full compatibility.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8.2.2",
      "section_id": "3.8.2.2",
      "section_title": "Real Name",
      "content": "The Real Name field contains the real name of the sender and is used only in MO messages. The SC or email gateway shall generate an email message according to standard email procedures containing Real Name <user@domain1.domain2> (the angle brackets being part of the address and hence transmitted). If a subject is to be included with the Real Name then only the ## prefix is used.\nThe syntax is:\n[<to‑address>]#<real‑name>[##<subject>]#<message>",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8.2.3",
      "section_id": "3.8.2.3",
      "section_title": "Optional Control Flag",
      "content": "An optional control flag may be added to the start of the message in MO messages only. This consists of a single character <CF> following a # symbol as follows:\n[#<CF>#][<to‑address>]<space><message>\nThis may also be used in combination with the above fields. It is intended for use where a particular SC or email gateway specific function is required to be invoked. For example, the control flag #A# might add a particular (pre‑stored) signature to the end of the message or #R# might change the from‑address to a pre‑stored value or #5# might add the text \"Please phone me at the office\". All of these functions are open for definition by Service Centre or email gateway operators.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.8.3",
      "section_id": "3.8.3",
      "section_title": "Text concatenation",
      "content": "If the concatenation mechanism described in clause 9.2.3.24.1 is not supported by the transmitting or receiving entity, the following textual concatenation mechanism may be used. The first message is ended with a + sign, and each subsequent message start and end with + signs until the final message which starts with a + sign but does not end with a + sign.\n<message1>+\n+<message2>+\n+<message3>\nAny header fields placed on the front of an MO or MT message are not added to the second and subsequent messages.\nThis provides a simple mechanism which is completely backward compatible. There is no indication of the number of messages and should a message be lost by the system or arrive out of sequence then the original message cannot be reconstructed. Therefore, wherever possible the concatenation mechanism specified in clause 9.2.3.24.1 should be used instead.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24.1"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.8.4",
      "section_id": "3.8.4",
      "section_title": "Alternative characters for Internet email addresses in MO SMS.",
      "content": "It is difficult or impossible to generate some characters on a mobile phone and so the following alternatives may be used:\n@ may be replaced by *\n_ (underscore) may be replaced by $",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.9",
      "section_id": "3.9",
      "section_title": "SMS COMPRESSION",
      "content": "Short Messages may be compressed in accordance with the compression algorithm described in 3GPP TS 23.042 [26].\nCompression and Decompression may take place between SME's or between an SME and the SC.\nThe compression only applies to the TP-User-Data part of the TPDU and excludes any TP-User-Data-Header which may be present. The Compression Header (see 3GPP TS 23.042 [26]) must commence at the first octet of the TP‑User‑Data field immediately following any TP-User-Data-Header field which may be present.\nThe TP-UDL value must be set in accordance with that value defined for the compressed TP-User-Data case in clause 9.2.3.16.\nThe TP-DCS parameter indicates whether or not a short message is compressed. If the TP-DCS parameter indicates that the short message is compressed then the alphabet encoding values (bits 2 and 3 in 3GPP TS 23.038 [9]) must be ignored by the receiving entity.\nIn the case where a short message after compression is greater than 140 octets (including the Compression Header and Footer (see 3GPP TS 23.042 [26]) and any TP-User-Data-Header which may be present) then the sending entity must concatenate the short message in the normal way as described in clause 9.2.3.24.1 if it wishes to continue to send the short message. Only the first segment of the concatenated short message must contain the Compression Header defined in 3GPP TS 23.042 [26]. All segments other than the final segment must be 140 octets in length. Only the final segment contains the Compression Footer (see 3GPP TS 23.042 [26]).\nFor mobile terminated compressed messages, where the MMI or the Message Class indicated in the TP-DCS requires the message to be stored in the MS then the MS shall store the compressed message as received. In the case where the MS is capable of decompression then the MS may display the decompressed message. Such an MS may optionally store the message in decompressed form subject to the MS being configured to do this via MMI. However, prior to storing the message in decompressed form, the MS may have to create a concatenated SM and carry out component modification on the TP-UDL and TP-DCS values to indicate the correct length values and that the message is no longer compressed. Transfer of messages direct from the radio interface or those stored in the MS to a TE is according to the procedure defined in 3GPP TS 27.005 [14] and is independent of whether the message is compressed or uncompressed.\nFor mobile originated compressed messages, an MS capable of compression may compress a short message generated within the MS itself prior to sending it to the radio interface. An MS capable of compression may optionally compress an uncompressed message received from a TE subject to the MS being configured to do this via MMI. In such a case the MS would have to carry out component modification on the TP-UDL and TP-DCS values to indicate the correct length values and that the message is compressed. A TE may send a message (compressed or uncompressed) to the MS using the procedures defined in 3GPP TS 27.005 [14]. The MS shall store the compressed message as received and/or transfer it directly to the radio interface.\nIn addition for the compression method described above, it may be possible to compress certain Information Elements of the User Data Header of a TPDU. The compression method is defined in clause 9.2.3.24.10.1.13.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.16",
        "clause_9.2.3.24.1",
        "clause_9.2.3.24.10.1.13",
        "ts_23.042",
        "ts_23.038",
        "ts_27.005"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.10",
      "section_id": "3.10",
      "section_title": "Enhanced Messaging Service",
      "content": "The Enhanced Messaging Service (EMS) is based upon the standard SMS, but with formatting added to the text. The formatting may permit the message to contain animations, pictures, melodies, formatted text, and vCard and vCalendar objects. Objects may be mixed together into one message. This clause overviews the supported features. The coding mechanisms and formats are specified in clause 9.2.3.24.10.\nThe following sub clauses describe a number of features of EMS. The data formats in the features below shall be supported (ie the UE shall behave in a predictable manner when receiving such data) but the features are supported subject to the capabilities of the UE. However, it is highly recommended that all of these features are implemented otherwise interoperability problems at the application level may result.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24.10"
      ]
    },
    {
      "chunk_id": "ts_23.040_3.10.1",
      "section_id": "3.10.1",
      "section_title": "Text formatting",
      "content": "The following text formatting features are supported:\nAlignment\n-\tLeft\n-\tCentre\n-\tRight\n-\tDefault (Language dependent)\nFont size\n-\tNormal\n-\tLarge\n-\tSmall\nStyle\n-\tNormal\n-\tBold\n-\tItalic\n-\tUnderlined\n-\tStrikethrough\n-\tText Colour\n-\tText Background Colour",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.2",
      "section_id": "3.10.2",
      "section_title": "Pictures",
      "content": "Basic Pictures\nIt is possible to include either a small (16*16 pixels), large (32*32 pixels) or pictures of variable size. These pictures have neither animation nor grey scale; they are plain black and white. All pictures are user defined.\nExtended Pictures\nIt is possible to include extended pictures. These pictures may be black and white, greyscale or colour bit maps. The picture size is a maximum of 255 x 255 pixels. These pictures may be transmitted in a compressed form.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.3",
      "section_id": "3.10.3",
      "section_title": "Animations",
      "content": "Predefined\nThere are number of predefined animations. These animations are not sent as animation over the air interface, only the identification of them. As soon as the position of the animation in the SM data is reached, the animation corresponding to the received number shall be displayed in a manner which is manufacturer specific.\nUser Defined\nThe user-defined animations consist of 4 pictures and there are two different sizes of these animations. The picture size of the small animations are 8*8 pixels and the large 16*16 pixels. These animations are sent over the air interface.\nExtended Animations\nIt is possible to include extended animations. These may be black and white, greyscale or colour bit maps. The maximum size of a single animated frame is 255 x 255 pixels. The repetition of these animations may be controlled by the originator. These animations may be transmitted in a compressed form.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.4",
      "section_id": "3.10.4",
      "section_title": "Sound",
      "content": "Predefined\nThere are a number of predefined sounds. These sounds are not transferred over the air interface, only the identification of them. There are 10 different sounds that can be added in the message, and as soon as the sound mark is in focus (on the display), the sound will be played.\nUser Defined\nThe sender can define own melodies according to the iMelody format [33]. These melodies are transferred in the SM and can take up to 128 bytes.\nExtended Sounds\nMonophonic melodies may be transferred using the iMelody format [33]. These may be transmitted in a compressed form.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.5",
      "section_id": "3.10.5",
      "section_title": "vCard and vCalendar",
      "content": "A message may contain vCard and vCalendar objects as specified in [36][37]. These may be transmitted in a compressed form.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.6",
      "section_id": "3.10.6",
      "section_title": "WVG (Wireless Vector Graphics) Object",
      "content": "A message may contain one or more WVG objects. A WVG object is a vector graphics picture or animation and is scalable. Two subtypes of WVG objects are supported; Standard WVG object and Character Size WVG object. Actual display size of a Standard WVG object depends on display screen size and MMI implementation on terminals. A Character Size WVG object has a height that equals or is similar to the height of message text but with variable width. Character Size WVG object may be edited in the same way as standard text, e.g. insertion deletion and text wrapping.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_3.10.6.1",
      "section_id": "3.10.6.1",
      "section_title": "Overview of WVG Graphical Primitives",
      "content": "The WVG element is used to describe vector graphics objects. The vector graphics format is used to allow the creation of small pictures which may include simple animation or the creation small handwritten sketches. WVG makes use of the following graphical primitives (full detail is listed in annex G.2) These primitives can be used to describe a compact drawing.\nList of Graphical Primitives:\n-\tPolylines (G2.1)\n-\tSimple Line Polyline (G.2.1.1)\n-\tCircular Polyline (G.2.1.2)\n-\tBezier lines (G.2.1.3)\n-\tPolygons (G.2.2)\n-\tArbitrary Polygon (G.2.2)\n-\tRegular Polygon (G.2.4)\n-\tStar Shaped Polygon (G.2.4)\n-\tRegular Grid Element (G.2.4)\n-\tEllipses (G.2.3.1)\n-\tRectangles (G.2.3.2)\n-\tText Element (G.2.5)\n-\tGrouping Element (G.2.6)\n-\tReuse Element (G.2.7)\n-\tAnimations Elements (G.2.8)\n-\tFrame Element (G.2.9)\n-\tLocal Element (G.2.10)",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_4.1",
      "section_id": "4.1",
      "section_title": "Basic network structure",
      "content": "The exchange of messages between an MS and an SME involves the entities shown in figure 4.\nThe architecture for providing SMS over a generic IP CAN is described in 3GPP TS 23.204 [42] (see clause 5).\nThe basic network structure of the SMS is depicted in figure 5.\n*):\tSMS‑GMSC when the short message is transferred from the SC to the MS, SMS‑IWMSC when the short message is transferred from the MS to the SC. The SC may be integrated with the SMS‑GMSC/SMS‑IWMSC.\n**):\tSGSN is used in place of the MSC for SMS transfer over GPRS.\n***):\tThe SMS Router is an optional functional entity, and is used only in the MT case.\nFigure 4: Entities involved in the provision of SM MT and SM MO\nThe reference points of figure 5 support the short message transfer in the following way:\n‑\tmessage transfer on reference point 1 is described in clause 5;\n‑\tthe operations performed on reference point 2 are described in 3GPP TS 29.002 [15] for MAP based interface and in 3GPP TS 29.338 [50] for Diameter based interface (S6c);\n‑\tthe operations performed on reference point 4 are described in 3GPP TS 29.002 [15] for MAP based interface;\n‑\tmessage transfer on reference point 3 is described in clause 4.2;\n‑\tmessage transfer on reference point 5 is supported by the protocol described in 3GPP TS 24.011 [13].\n‑\tthe operations performed on reference points 6 are described in 3GPP TS 29.118 [47].\nNOTE 1:\tReference point 4 is not used for SMS transfer via the SGSN\nNOTE 2:\tThe SMS Router is an optional entity that may be present in the MT case only. If it is not present, reference point 3 extends from the SMS-GMSC directly to the MSC/SGSN.\nNOTE 3:\tReference point 6 is used for SMS transfer when SMS over SGs is used and the MME is used to tunnel SMS messages.\nFigure 5: The main network structure serving as a basis for the short message transfer",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.204_clause_5",
        "clause_5",
        "clause_4.2",
        "figure_4",
        "figure_5",
        "ts_23.204",
        "ts_29.002",
        "ts_29.338",
        "ts_24.011",
        "ts_29.118"
      ]
    },
    {
      "chunk_id": "ts_23.040_4.2",
      "section_id": "4.2",
      "section_title": "Transfer on reference point 3",
      "content": "Reference point 3 is used to support communications between:\n-\tMSC <-> SMS‑GMSC / SMS‑IWMSC;\n-\tSGSN <-> SMS-GMSC / SMS-IWMSC;\n-\tSMS Router <-> SMS‑GMSC;\n-\tSMS Router <-> MSC;\n-\tSMS Router <-> SGSN.\nIf any of the above two end nodes are in the same PLMN, the definition of this reference point is left to the operators. For example, this reference point may use:\n‑\tPSPDN; or\n‑\tCCITT SS no 7 (according to 3GPP TS 29.002 [15]).\nIf any of the above two end nodes are in different PLMNs, this reference point shall use CCITT SS no 7 according to 3GPP TS 29.002 [15], unless otherwise bilaterally agreed.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_5",
      "section_id": "5",
      "section_title": "Service Centre and PLMN interconnection",
      "content": "The present document deals with the SC only with regard to the interchange of messages between SC and MS. Only the requirements put upon the SC by the SMS functionality are specified in the present document.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_5.1",
      "section_id": "5.1",
      "section_title": "Service centre connection",
      "content": "One SC may be connected to several PLMNs, and may be connected to several MSCs (SMS‑GMSCs or SMS‑IWMSCs) within one and the same PLMN.\nThe SC is addressed from the mobile by an E.164 [17] number in the numbering plan of the PLMN to which the SC is connected. This E.164 [17] number shall uniquely identify the SC to that PLMN.\nThere may be an intermediate network between the PLMN and the SC; in this case the PLMN must autonomously make a connection to the SC using the SC address in this intermediate network.\nNo mandatory protocol between the SC and the MSC below the transfer layer is specified by GSM/UMTS; this is a matter for agreement between SC and PLMN operators. However, annex A provides an example protocol stack which could be used.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_5.2.1",
      "section_id": "5.2.1",
      "section_title": "Mobile terminated short message",
      "content": "The SC sends the short message to the SMS‑GMSC. The SMS‑GMSC interrogates the HLR to retrieve routing information necessary to forward the short message, and then sends the message to the relevant MSC or SGSN, transiting other networks if necessary and transiting an SMS Router in the HPLMN of the receiving MS if this is deployed. The MSC or SGSN then sends the short message to the MS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_5.2.2",
      "section_id": "5.2.2",
      "section_title": "Mobile originated short message",
      "content": "The MS sends the short message to the MSC or the SGSN. The MS shall always address the required SC by an E.164 [17] address. The visited PLMN shall route the message to the appropriate SMS‑IWMSC in the SC's PLMN, transiting other networks if necessary.\nAs an operator option, the SMS-IWMSC may interrogate the HLR to retrieve the recipient's IMSI in order to check that an SMS Interworking agreement exists between the two networks.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_6",
      "section_id": "6",
      "section_title": "Service Centre functionality",
      "content": "In the present document, only the SC functionality related to the short message service between the SC and the MS is specified.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_6.1",
      "section_id": "6.1",
      "section_title": "Service Centre capabilities",
      "content": "The SC should be capable of:\n‑\tsubmitting a short message to an MS, retaining the responsibility of the message until\n1)\tthe report has been received; or\n2)\tthe Validity‑Period expires.\n‑\treceiving a report from the PLMN;\n‑\treceiving a short message from an MS;\n‑\treturning a report to the PLMN for a previously received short message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_6.2",
      "section_id": "6.2",
      "section_title": "SC functional requirements",
      "content": "The detailed functionality of the SC is outside the scope of the present document, and is for the SC operator to define. However, the following functional requirements are mandatory for all SCs in order to support the SM‑TP (see clause 9) towards the PLMN:\n1)\tTo identify each SMS‑DELIVER sent to an MS in a unique way, a time stamp value is included in the field TP‑Service‑Centre‑Time‑Stamp, TP‑SCTS, of the SMS‑DELIVER. The time stamp gives the time when the message arrived at the SC with the accuracy of a second. If two or more messages to the same MS arrive at the SC within one second, the SC shall modify the time stamp of those messages in such a way that:\na)\tall messages to the MS contain different time stamps;\nb)\tthe modification of the time stamps is kept to a minimum.\n2)\tThe SC is only allowed to have one outstanding SMS‑DELIVER (i.e. a message for which a report has not been received) to a specific MS at a given time.\n3)\tThe SC shall be able to initiate overwriting of short messages previously received by the SC if requested by the same originating address (MS or any other source) by use of the same message type.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9"
      ]
    },
    {
      "chunk_id": "ts_23.040_6.2.1",
      "section_id": "6.2.1",
      "section_title": "Subaddressing support",
      "content": "Support for subaddressing is an optional functional requirement for an SC. If it is supported, subaddressing information shall be conveyed from SME to SME according the following rules:\n-\tA SME may send a SM with '*'s or '#'s included in the TP-DA field. The first '#' encountered in TP-DA indicates where the address for SC routing purposes is terminated. Additional '*'s or '#'s can be present in the following digits, and all these digits including the first '#' are subaddress digits.\n-\tWhen the SC receives a SM to convey with such a subaddress information, it should deliver the SM to the destination SME with the same subaddress digits copied in the TP-OA field.\nThis subaddressing mechanism does not apply when the TON is alphanumeric\nExample:\nSME with number 987654321 sends a SM with TP-DA = 1234#56#789*\nSME with number 1234 will receive the SM with TP-OA = 987654321#56#789*",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_6.2.2",
      "section_id": "6.2.2",
      "section_title": "Support for trigger SMS filtering for Tsms submissions",
      "content": "Support for trigger SMS filtering for Tsms submissions is an optional functional requirement for an SC as specified in 3GPP TS 23.682 [48]. If it is supported, the SC uses the TP-Protocol-Identifier containing a Device Triggering Short Message code as an indication of trigger SMS and compare list of known SME against the SME in the RP-OA field of received short message to filter and block all short messages that do not originate from trusted SMEs.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.040_6.3",
      "section_id": "6.3",
      "section_title": "SC EMS Extended Object Data Request Command Feature",
      "content": "An SME has the ability of determining which data formats within the Extended Object IE are supported by a specific terminal. The SC has the option of supporting this feature using an SMS-DELIVER PDU. This SMS-DELIVER PDU shall contain the EMS Data Format Delivery Request IE, and be marked for automatic deletion by the mobile station.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_7",
      "section_id": "7",
      "section_title": "MS functionality",
      "content": "In the present document, only the MS functionality related to the short message service between the SC and the MS is specified.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_7.1",
      "section_id": "7.1",
      "section_title": "MS capabilities",
      "content": "The MS, when equipped for SMS, should be capable of:\n‑\tsubmitting a short message TPDU to an SC, retaining the responsibility of the message until:\n1)\tthe report arrives from the network; or\n2)\ta timer expires.\n‑\treceiving a short message TPDU from an SC;\n‑\treturning a delivery report to the network for a previously received short message;\n‑\treceiving a report from the network;\n‑\tnotifying the network when it has memory capacity available to receive one or more short messages when it has previously rejected a short message because its memory capacity was exceeded;\n‑\tnotifying the SC when a short message is intended to replace a short message the MS has previously submitted to the same destination address.\nIt is recommended that an MS supporting both replying and automatic SC selection (as specified in clause D.2 of annex D) follows procedures specified in annex D when replying to MT short messages with MO short messages.\nIt is recommended that an MS supporting a capability for requesting a reply path follows procedures specified in annex D.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_7.2",
      "section_id": "7.2",
      "section_title": "MS configuration",
      "content": "The reference configuration is assumed as in figure 6, i.e. only the case where the terminal is integrated in the MS is considered.\nFigure 6: Reference configuration of the MS which apply to the SMS\nNOTE:\tIt is foreseen that a terminal interface may be offered, e.g. for higher layer protocols, memory capacity reasons or to be able to type in mobile originated messages. This terminal interface is regarded as an implementation option, although, where offered, it must be based upon an R‑ or S‑reference point. 3GPP TS 27.005 [14] provides an example based on the R reference point.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6",
        "ts_27.005"
      ]
    },
    {
      "chunk_id": "ts_23.040_8",
      "section_id": "8",
      "section_title": "Node functionality",
      "content": "The overall requirements to the MSC, SMS-GMSC, SMS-IWMSC, SGSN and SMS Router with respect to handling of the Short Message Service is to cater for the routing and necessary intermediate buffering of the short messages.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_8.1.1",
      "section_id": "8.1.1",
      "section_title": "Functionality of the SMS‑GMSC",
      "content": "When receiving a short message TPDU from the SC, the SMS‑GMSC is responsible for the following operations:\n‑\treception of the short message TPDU;\n‑\tinspection of the parameters.\nNOTE 1:\tThe SMS‑GMSC may be identical to the MSC.\nif parameters are incorrect:\n‑\treturning the appropriate error information to the SC in a failure report (see clauses 9 and 10);\nif errors are not found within parameters:\n‑\tinterrogating the HLR (\"sendRoutingInfoForShortMsg\", see clause 10); retrieving routing information or possible error information;\nNOTE 2:\tThe SMS-GMSC indicates if the short message is a Single-shot SM by setting an indication in the \"sendRoutingInfoForShortMsg\" as specified in 3GPP TS 29.002 [15].\nif HLR is returning error information:\n‑\treturning the appropriate error information to the SC in a failure report (see clauses 9 and 10);\nif no errors are indicated by the HLR:\n‑\ttransferring the short message TPDU to the MSC or SGSN using the routing information obtained from the HLR (\"forwardShortMessage\", see clause 10);\nNOTE 3:\tIn case where two addresses (SGSN and MSC) are received from HLR, the SMS-GMSC may choose (operator dependant) via which nodes (SGSN or MSC) the SMS is first to be sent. The SMS delivery via the SGSN is normally more radio resource efficient than the SMS delivery via the MSC.\nif one address (SGSN or MSC) is received from HLR:\n-\tWhen receiving the report associated with the short message from the MSC or SGSN (positive or negative outcome of \"forwardShortMessage\", see clause 10), the SMS‑GMSC is responsible for the following operations;\nif the report indicates successful delivery:\n‑\tnotifying the HLR of the successful delivery via the MSC or the SGSN, which shall cause the HLR to alert any service centres whose addresses are stored in the MWD for the MS;\n‑\tcreating and sending the successful report to the SC;\nif the report is a failure report indicating \"absent subscriber\" via the MSC or the SGSN (see clause 3.3):\n‑\trequesting the HLR to insert the address of the originating SC into the MWD (if implemented) with cause Absent Subscriber (\"SM_DeliveryReportStatus\", see clauses 9 and 10) for non Single-shot SM;\nNOTE 4:\tThe SMS-GMSC indicates if the short message is a Single-shot SM by setting an indication in the \"SM_DeliveryReportStatus\" as specified in 3GPP TS 29.002 [15].\n-\tinforming the HLR of the reason for the MS being absent via the MSC or the SGSN (if this information is available);\n‑\testablishing, where necessary, a link with the addressed SC (see clause 5);\n‑\tcreating and sending the negative report to the SC which should include the reason for the MS being absent (if this information is available) so that the SC may adjust any retry algorithm appropriately (see clauses 9 and 10);\nif the report is a failure report indicating \"MS memory capacity exceeded\" via the MSC or the SGSN (see clause 3.3):\n‑\trequesting the HLR to insert the address of the originating SC into the MWD (if implemented) with cause MS Memory Capacity Exceeded via the MSC or the SGSN (\"SM_DeliveryReportStatus\" , see clauses 9 and 10) for non Single-shot SM;\n‑\testablishing, where necessary, a link with the addressed SC (see clause 5);\n‑\tcreating and sending the report to the SC (see clauses 9 and 10).\nif two addresses (SGSN and MSC) are received from HLR:\n-\tWhen receiving the first report associated with the short message from the MSC or SGSN (positive or negative outcome of \"forwardShortMessage\", see clause 10), the SMS‑GMSC is responsible for the following operations:\nif the first report indicates successful delivery:\n‑\tnotifying the HLR of the successful delivery via the MSC or the SGSN, which shall cause the HLR to alert any service centres whose addresses are stored in the MWD for the MS;\n‑\tcreating and sending the successful report to the SC;\nif the first report is a failure report indicating:\n-\tUnidentified subscriber;\n-\tFacility not supported;\n-\tAbsent subscriber with indication: GPRS or IMSI Detach;\n-\tSystem failure;\n-\tUnexpected data value;\n-\tData missing;\n-\tGPRS connection suspended (see 3GPP TS 29.002 [15]);\n-\tSM Delivery Failure with indication: equipment Not SM Equipped:\n‑\ttransferring the short message TPDU to the second path using the routing information obtained from HLR.\nif the second report indicates successful delivery:\n‑\tnotifying the HLR of the successful delivery of the second transfer via the MSC or SGSN, which shall cause the HLR to alert any service centres whose addresses are stored in the MWD for the MS;\n-\tnotifying the HLR of the unsuccessful delivery at first transfer only with cause \"absent subscriber\";\n-\tnotifying the HLR of the reason for the MS being absent via the MSC or the SGSN (if this information is available);\n-\testablishing, when necessary, a link with the addressed SC (see clause 5);\n‑\tcreating and sending the successful report to the SC;\nif the second report is a failure report:\n‑\trequesting the HLR to insert the address of the originating SC into the MWD (if implemented) only if at least one of the first or second report failed due to \"MS Memory Capacity Exceeded\" or \"Absent Subscriber\" (\"SM_DeliveryReportStatus\", see clauses 9 and 10) for non Single-shot SM;\n-\tnotifying the HLR only with the causes \"Absent Subscriber\", \"Memory Capacity Exceeded\" via the MSC or the SGSN, or both;\n-\tnotifying the HLR of the reason for the MS being absent via the MSC, SGSN or both (if this information is available);\n‑\testablishing, where necessary, a link with the addressed SC (see clause 5);\n‑\tcreating and sending the negative report to the SC with errors from first and second path (see clauses 9 and 10).",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "clause_3.3",
        "clause_5",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.1.2",
      "section_id": "8.1.2",
      "section_title": "Functionality of the MSC",
      "content": "When receiving a short message TPDU from the SMS‑GMSC (\"forwardShortMessage\", see clause 10), the MSC is responsible for the following operations:\n‑\treception of the short message TPDU;\n-\tthe receiving network may verify if the received SM-SC address (contained in RP-OA IE) and SCCP Calling Party Address are of the same PLMN;\n‑\tretrieving information from the VLR (\"sendInfoFor‑MT‑SMS\", see clause 10); location area address and, when appropriate, error information;\nif errors are indicated by the VLR:\n‑\treturning the appropriate error information to the SMS‑GMSC in a failure report (negative outcome of \"forwardShortMessage\" see clauses 10 and 11);\nif no errors are indicated by the VLR:\n‑\ttransferring the short message to the MS (see 3GPP TS 24.011 [13]).\nWhen receiving a confirmation that the message is received by the MS (see 3GPP TS 24.011 [13]):\n‑\trelaying the delivery confirmation to the SMS‑GMSC in a delivery report (positive outcome of \"forwardShortMessage\", see clauses 10 and 11).\nWhen receiving a failure report of the short message transfer to the MS (see 3GPP TS 24.011 [13]):\n‑\treturning the appropriate error information to the SMS‑GMSC in a failure report (negative outcome of \"forwardShortMessage\", see clause 10).\nWhen receiving a notification from the MS that it has memory available to receive one or more short messages (see 3GPP TS 24.011 [13]):\n‑\trelaying the notification to the VLR (\"mSMemoryCapacityAvailable\", see clause 10);\nif errors are indicated by the VLR:\n‑\treturning the appropriate error information to the MS in a failure report (negative outcome of \"ReadyForSM\", see clauses 10 and 11).\nWhen there is an ongoing MT-SMS transfer to the MS (see 3GPP TS 24.011 [13]), or other busy condition for MT-SMS, the MSC has the option to store the TPDU in a queue for a short time (which must be shorter than the supervision timer defined in 3GPP TS 29.002 [15]). The maximum time that a message may be queued is related to the permitted delay for the MSC to respond to the SMS-GMSC. When the MS becomes available for MT-SMS transfer, the stored TPDUs are delivered to the MS on a first-in first-out basis. If a message is not successfully transferred to the MS within the permitted time, the MSC returns an appropriate error to the SMS-GMSC.\nNOTE:\tThe reaction of MSC when the message verification failed is operator specific and not specified in 3GPP specifications.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_24.011",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.1.3",
      "section_id": "8.1.3",
      "section_title": "Functionality of the SGSN",
      "content": "When receiving a short message TPDU from the SMS‑GMSC (\"forwardShortMessage\", see clause 10), the SGSN is responsible for the following operations:\n‑\treception of the short message TPDU;\n-\tthe receiving network may verify if the received SM-SC address (contained in RP-OA IE) and SCCP Calling Party Address are of the same PLMN.\nif errors are detected by the SGSN:\n‑\treturning the appropriate error information to the SMS‑GMSC in a failure report (negative outcome of \"forwardShortMessage\" see clauses 10 and 11);\nif no errors are detected by the SGSN:\n‑\ttransferring the short message to the MS (see 3GPP TS 24.011 [13]).\nWhen receiving a confirmation that the message is received by the MS (see 3GPP TS 24.011 [13]):\n‑\trelaying the delivery confirmation to the SMS‑GMSC in a delivery report (positive outcome of \"forwardShortMessage\", see clauses 10 and 11).\nWhen receiving a failure report of the short message transfer to the MS (see 3GPP TS 24.011 [13]):\n‑\treturning the appropriate error information to the SMS‑GMSC in a failure report (negative outcome of \"forwardShortMessage\", see clause 10).\nWhen receiving a notification from the MS that it has memory available to receive one or more short messages (see 3GPP TS 24.011 [13]):\nif errors are detected by the SGSN:\n‑\treturning the appropriate error information to the MS in a failure report (negative outcome of \"ReadyForSM\", see clauses 10 and 11).\nif no errors are detected by the SGSN:\n-\tnotifying the HLR of memory available in the MS via the SGSN with \"ReadyForSM\" (see clauses 10 and 11).\nWhen the MS is becoming reachable again (see 3GPP TS 24.008 [12]):\n-\tnotifying the HLR of MS being reachable via the SGSN (and via the MSC if any) with \"ReadyForSM\" (see clauses 10).\nWhen there is an ongoing MT-SMS transfer to the MS (see 3GPP TS 24.011 [13]), or other busy condition for MT-SMS, the SGSN has the option to store the TPDU in a queue for a short time (which must be shorter than the supervision timer defined in 3GPP TS 29.002 [15]). The maximum time that a message may be queued is related to the permitted delay for the SGSN to respond to the SMS-GMSC. When the MS becomes available for MT-SMS transfer, the stored TPDUs are delivered to the MS on a first-in first-out basis. If a message is not successfully transferred to the MS within the permitted time, the SGSN returns an appropriate error to the SMS-GMSC.\nNOTE:\tThe reaction of SGSN when the message verification failed is operator specific and not specified in 3GPP specifications.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_24.011",
        "ts_24.008",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.1.4",
      "section_id": "8.1.4",
      "section_title": "Functionality of the SMS Router",
      "content": "When receiving a routing information retrieval (\"sendRoutingInfoForShortMsg\", see clause 10), the SMS Router is responsible for the following operations:\n‑\tinterrogating the HLR (\"sendRoutingInfoForShortMsg\", see clause 10); retrieving routing information or possible error information. This interrogation may be omitted if a parameter within the \"sendRoutingInfoForShortMsg\" explicitly indicates that delivery of a short message is not intended and only MCC+MNC are requested.\nif HLR is returning error information:\n‑\tforwarding the returned error information transparently to the SMS-GMSC;\nif no errors are indicated by the HLR:\n‑\tcreating an MT Correlation ID;\n-\tstoring against the MT Correlation ID: the IMSI, the MSC address and/or the SGSN address. The address of the SMS‑GMSC and the destination MSISDN may also be stored. Creating an MT Correlation ID and storing these data against the MT Correlation ID may be omitted if a parameter within the \"sendRoutingInfoForShortMsg\" explicitly indicates that delivery of a short message is not intended;\n-\tforwarding the returned information to the SMS-GMSC populating the IMSI IE with the MT Correlation ID and either:\na)\tthe MSC address and/or SGSN address with the address of the SMS Router; or\nNOTE 1:\tIn this case if two addresses (SGSN and MSC) are received from HLR, the SMS-GMSC chooses (operator dependant) via which node (SGSN or MSC) the SM is first to be sent, not the SMS Router.\nb)\tthe address of the SMS Router. In this case the SMS Router delivers the SM as described in 3GPP TS 23.204 [42] for the IP-SM-GW. This option is mandatory when the SMS Router is deployed together with an IP-SM-GW.\nNOTE 2:\tIn this case if two addresses (SGSN and MSC) are received from HLR, the SMS Router chooses via which node (SGSN or MSC) the SM is first to be sent, i.e. the SMS Router delivers the SM as an IP-SM-GW.\nIf a parameter within the \"sendRoutingInfoForShortMsg\" explicitly indicates that delivery of a short message is not intended and that only IMSI or only MCC+MNC are requested, the IMSI IE may be populated with IMSI or MCC+MNC+dummy MSIN, respectively, and the MSC address and/or SGSN address with a dummy network node address.\nif HLR is returning an Inform-Service-Centre information:\n-\tfowarding the received information transparently to the SMS-GMSC.\nWhen receiving a short message TPDU from the SMS‑GMSC (\"forwardShortMessage\", see clause 10), the SMS Router is responsible for the following operations:\n‑\treceiving the short message TPDU;\n‑\tforwarding the trigger SMS to filtering infrastructure to filter and block all trigger SMS that does not originate from SMS-GMSC in the HPLMN;\n-\tchecking validity of the MT Correlation ID received in the IMSI field\nSMS Router can use the TP-Protocol-Identifier containing a Device Triggering Short Message code as an indication of trigger SMS and compare list of known SMS-GMSC against the SMS-GMSC in the RP-OA field of received short message to filter and block all short messages that do not originate from SMS-GMSC in the HPLMN.\nThe MT Correlation ID shall be considered invalid if the MT Correlation ID is unknown. Optionally, the MT Correlation ID may also be considered invalid if the CC and NDC of the address of the SMS-GMSC from which the forwardShortMessage was received is different from the CC and NDC of the SMS‑GMSC address stored above i.e. the forwardShortMessage has originated from a different network than that which issued the sendRoutingInfoForShortMsg.\nIf the received MT Correlation ID is deemed invalid by the SMS Router:\n‑\treturning the error \"System failure\" to the SMS‑GMSC in a failure report (negative outcome of \"forwardShortMessage\" see clauses 10 and 11).\nIf the received MT Correlation ID is deemed valid by the SMS Router:\n‑\ttransferring the short message TPDU to the MSC (if the called party SSN in the received message is for MSC) or to the SGSN (if the called party SSN in the received message is for SGSN) using the stored routing information and replacing the MT Correlation ID with the stored IMSI (obtained from the HLR, above);\n-\tsupport for service execution, lawful interception, and number portability if required;\n-\tforwarding the delivery confirmation or failure report from the MSC or SGSN (which may have originally come from the MS) transparently to the SMS-GMSC; and\n-\tif the SMS Router finds that SMS delivery is to be performed towards serving MSC or SGSN in a different PLMN, the SMS Router may replace the SMS-SC address in RP OA with an address containing the PLMN ID of the PLMN in which the SMS-Router is located before the SMS router forwards the request to the serving MSC or SGSN.\nNOTE 3:\tThis option can be used if the PLMN that deploys the SMS-router wants to ensure the delivery of a MT-SMS to a UE roaming in a different PLMN and this PLMN is known to deploy PLMN ID check on both RP-OA IE and SCCP Global Title.\nNOTE 4:\tWhen using this functionality, the PLMN deploying the SMS-Router must be aware that reply path functionality offered by the originating SMS-SC cannot be used.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_23.204"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.1.5",
      "section_id": "8.1.5",
      "section_title": "Functionality of the IP-SM-GW",
      "content": "The IP-SM-GW is described in 3GPP TS 23.204 [42], it provides:\n-\tprotocol interworking for delivery of short message between the IP-based UE and the SMSC;\n-\tdelivery of short message to the IP-based UE for cases with or without MSISDN;\n-\tdelivery of the SM to the MSC/SGSN if needed as described in 3GPP TS 23.204 [42]; and\n-\tsupport for service execution, lawful interception, and number portability if required.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.204"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.2.1",
      "section_id": "8.2.1",
      "section_title": "Functionality of the MSC",
      "content": "When receiving a short message TPDU from the MS, the MSC is responsible for the following operations:\n‑\treception of the short message TPDU (see 3GPP TS 24.011 [13]);\n‑\tretrieving information from the VLR (\"sendInfoForMO‑SMS\", see clause 10); the MSISDN of the MS and, when appropriate, error information. The retrieval of information from the VLR is followed by the VLR investigating the MNRF (to be used in the alerting procedure, see clause 10)\nif errors are indicated by the VLR:\n‑\treturning the appropriate error information to the MS in a failure report (negative outcome of \"sendInfoForMO‑SMS\" see clauses 10 and 11);\nif no errors are indicated by the VLR:\n‑\tinspection of the RP-DA parameter;\nif parameters are incorrect:\n‑\treturning the appropriate error information to the MS in a failure report (see 3GPP TS 24.011 [13]);\nif no parameter errors are found:\nNOTE:\tThe SMS‑IWMSC may be identical to the MSC.\n‑\ttransferring the short message TPDU to the SMS‑IWMSC (\"forwardShortMessage\", see clause 10).\nWhen receiving the report of the short message from the SMS‑IWMSC (positive or negative outcome of the \"forwardShortMessage\", see clause 10), the MSC is responsible for the following operations:\n‑\trelaying the report to the MS (see 3GPP TS 24.011 [13]).",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.2.2",
      "section_id": "8.2.2",
      "section_title": "Functionality of the SMS‑IWMSC",
      "content": "When receiving a short message TPDU from the MSC, IP-SM-GW or SGSN (\"forwardShortMessage\", see clause 10), the SMS‑IWMSC is responsible for the following operations:\n‑\treception of the short message TPDU;\n‑\toptionally, interrogating the HLR (\"sendRoutingInfoForShortMsg\", see clause 10); retrieving the recipient's IMSI in order to check for the existence of an SMS Interworking agreement before establishing a link with the addressed SC;\nif HLR returns error information:\n‑\treturning the appropriate error information to the MSC or SGSN in a failure report (negative outcome of \"forwardShortMessage\", see clause 10);\nif no errors are indicated by the HLR:\n‑\tinspecting the IMSI parameter and ignoring the other routing information;\nif the received parameter is unacceptable to the SMS-IWMSC (due to lack of an SMS Interworking agreement):\n‑\treturning SM Delivery Failure with indication: invalid SME-address to the MSC or SGSN;\nif the parameter is acceptable to the SMS-IWMSC (due to the existence of an SMS Interworking agreement) or the SMS-IWMSC didn't apply the optional HLR interrogation:\n‑\testablishing, where necessary, a link with the addressed SC (see clause 5);\n‑\ttransferring the short message TPDU to the SC (if the address is valid);\nif a report associated with the short message is received from the SC, the SMS‑IWMSC is responsible for the following operations:\n‑\trelaying of the report to the MSC or SGSN (positive or negative outcome of \"forwardShortMessage\", see clause 10);\nif a report associated with the short message is not received from the SC before a timer expires or if the SC address is invalid, the SMS‑IWMSC is responsible for the following operations:\n‑\treturning the appropriate error information to the MSC or SGSN in a failure report (negative outcome of \"forwardShortMessage\", see clause 10).\nThe value of the timer is dependent on the protocol between the SC and the SMS‑IWMSC.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "clause_5"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.2.3",
      "section_id": "8.2.3",
      "section_title": "Functionality of the SGSN",
      "content": "When receiving a short message TPDU from the MS, the SGSN is responsible for the following operations:\n‑\treception of the short message TPDU (see 3GPP TS 24.011 [13]);\n‑\tinspection of the RP-DA parameter;\nif parameters are incorrect:\n‑\treturning the appropriate error information to the MS in a failure report (see 3GPP TS 24.011 [13]);\nif no parameter errors are found:\n‑\ttransferring the short message TPDU to the SMS‑IWMSC (\"forwardShortMessage\", see clause 10).\nWhen receiving the report of the short message from the SMS‑IWMSC (positive or negative outcome of the \"forwardShortMessage\", see clause 10), the SGSN is responsible for the following operations:\n‑\trelaying the report to the MS (see 3GPP TS 24.011 [13]).",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.2.4",
      "section_id": "8.2.4",
      "section_title": "Functionality of the IP-SM-GW",
      "content": "The IP-SM-GW is described in 3GPP TS 23.204 [42], it provides:\n-\tSuccessful SM MO delivery procedure with IP-SM-GW is described in 3GPP TS 23.204 [42] (see clause 6.3); and\n-\tSuccessful SM MO delivery procedure with IP-SM-GW, without MSISDN (see clause 6.3a).",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.204_clause_6.3",
        "clause_6.3",
        "ts_23.204"
      ]
    },
    {
      "chunk_id": "ts_23.040_8.3",
      "section_id": "8.3",
      "section_title": "SMS‑IWMSC functionality related to alerting",
      "content": "When receiving an alert from the HLR (\"alertServiceCentre\", see clause 10), the SMS‑IWMSC is responsible for the following operations:\n‑\tinspect the SC address;\n‑\tgenerate an RP‑Alert‑SC (see clause 9);\n‑\ttransferring the RP‑Alert‑SC to the SC.\nNOTE:\tIf the SC address is not valid, then no further action shall be taken.",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "clause_9"
      ]
    },
    {
      "chunk_id": "ts_23.040_9",
      "section_id": "9",
      "section_title": "Protocols and protocol architecture",
      "content": "The protocol layers of the SMS are structured as shown in figure 7.\nNOTE:\tThe SMS Router is an optional functional entity, and is used only in the MT case.\nFigure 7: Protocol layer overview for the Short Message Service\nThe present document specifies the protocol at the SM‑TL, the service offered by the SM‑TL at the MS and the SC, and the service offered by the SM‑RL at the SC.\nNote that while normally SM-TL terminates at the SC in SM MO, the SMS-IWMSC may inspect TP-DA in SMS-SUBMIT for the purpose of checking the existence of an SMS interworking agreement (see clause 8.2.2).",
      "chunk_type": "general",
      "cross_references": [
        "clause_8.2.2",
        "figure_7"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.1.1",
      "section_id": "9.1.1",
      "section_title": "Octet and Bit transmission order",
      "content": "The octets are transmitted according to their individual numbering; the octet with the lowest number being transmitted first. The bits within each octet are transmitted according to their individual numbering also; the bits with the lowest internal number being transmitted first.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.1.2",
      "section_id": "9.1.2",
      "section_title": "Numeric and alphanumeric representation",
      "content": "For parameters within the TPDUs, there are four ways of numeric representation: Integer representation, octet, semi‑octet and alphanumeric representation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.1.2.1",
      "section_id": "9.1.2.1",
      "section_title": "Integer representation",
      "content": "Wherever the bits from a number of octets, complete or in fractions, are to represent an integer, the interpretation shall be according to the following:\n1)\tBetween octets: the octets with the lowest octet numbers shall contain the most significant bits, i.e. the byte order shall be big endian.\n2)\tWithin an octet: the bits with the highest bit numbers shall be the most significant.\nBelow is given an example of octet and bit representation and transmission order of an integer represented field.\nLet the 2 rightmost bits of octet no 5, the complete octet no 6 and 7, and the 3 leftmost bits of octet no 8 represent an integer, as shown in figure 8.\n*): Bits not representing the integer.\nFigure 8: 21 bits from the octets 5, 6, 7, and 8 in a short message α) shall represent an integer as shown in β), and shall be transmitted in an order as shown in Γ)",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_8"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.1.2.2",
      "section_id": "9.1.2.2",
      "section_title": "Octet representation",
      "content": "A field which is octet represented, shall always consist of a number of complete octets. Each octet within the field represents one decimal digit. The octets with the lowest octet numbers shall contain the most significant decimal digits.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.1.2.3",
      "section_id": "9.1.2.3",
      "section_title": "Semi‑octet representation",
      "content": "A field which is semi‑octet represented, shall consist of a number of complete octets and ‑ possibly ‑ one half octet. Each half octet within the field represents one decimal digit. The octets with the lowest octet numbers shall contain the most significant decimal digits. Within one octet, the half octet containing the bits with bit numbers 0 to 3, shall represent the most significant digit.\nIn the case where a semi‑octet represented field comprises an odd number of digits, the bits with bit numbers 4 to 7 within the last octet are fill bits and shall always be set to \"1111\".\nIf a mobile receives an address field containing non‑integer information in the semi‑octets other than \"1111\" (e.g. 1110) it shall display the semi‑octet as the representation given in 3GPP TS 24.008 [12] under \"called BCD number\", viz 1010=\"*\", 1011=\"#\", 1100=\"a\", 1101=\"b\", 1110=\"c\". In the event of a discrepancy between the values quoted here and the values specified in 3GPP TS 24.008 [12] then 3GPP TS 24.008 [12] shall take precedence. If a mobile receives \"1111\" in a position prior to the last semi‑octet then processing shall commence with the next semi‑octet and the intervening semi‑octet shall be ignored.\nWithin each semi octet, the bits with the highest bit numbers shall be the most significant.\nBelow is given an example:\nOctet no:",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.008"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.1.2.4",
      "section_id": "9.1.2.4",
      "section_title": "Alphanumeric representation",
      "content": "A field which uses alphanumeric representation shall consist of a number of 7‑bit characters represented as the default alphabet defined in 3GPP TS 23.038 [9].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.1.2.5",
      "section_id": "9.1.2.5",
      "section_title": "Address fields",
      "content": "Address fields used by SM‑RL are specified in 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15].\nEach address field of the SM‑TL consists of the following sub‑fields: An Address‑Length field of one octet, a Type‑of‑Address field of one octet, and one Address‑Value field of variable length; as shown below:\nThe Address‑Length field is an integer representation of the number of useful semi‑octets within the Address‑Value field, i.e. excludes any semi octet containing only fill bits.\nThe Type‑of‑Address field format is as follows:\nType‑of‑number:\nBits    6 5 4\n0 0 0\tUnknown 1)0 0 1\tInternational number 2)0 1 0\tNational number 3)0 1 1\tNetwork specific number 4)1 0 0\tSubscriber number 5)1 0 1\tAlphanumeric, (coded according to 3GPP TS 23.038 [9] GSM 7‑bit default alphabet)1 1 0\tAbbreviated number1 1 1\tReserved for extension\nThe MS shall interpret reserved values as \"Unknown\" but shall store them exactly as received.\nThe SC may reject messages with a type of number containing a reserved value or one which is not supported.\nReserved values shall not be transmitted by an SC conforming to this version of the specification.\n1)\t\"Unknown\" is used when the user or network has no a priori information about the numbering plan. In this case, the Address‑Value field is organized according to the network dialling plan, e.g. prefix or escape digits might be present.\n2)\tThe international format shall be accepted also when the message is destined to a recipient in the same country as the MSC or as the SGSN.\n3)\tPrefix or escape digits shall not be included.\n4)\t\"Network specific number\" is used to indicate administration/service number specific to the serving network, e.g. used to access an operator.\n5)\t\"Subscriber number\" is used when a specific short number representation is stored in one or more SCs as part of a higher layer application. (Note that \"Subscriber number\" shall only be used in connection with the proper PID referring to this application).\nNumbering‑plan‑identification\nBits     3 2 1 0\n0 0 0 0\tUnknown0 0 0 1\tISDN/telephone numbering plan (E.164 [17]/E.163[18])0 0 1 1\tData numbering plan (X.121)0 1 0 0\tTelex numbering plan0 1 0 1\tService Centre Specific plan 1)0 1 1 0\tService Centre Specific plan 1)1 0 0 0\tNational numbering plan1 0 0 1\tPrivate numbering plan1 0 1 0\tERMES numbering plan (ETSI DE/PS 3 01‑3)1 1 1 1\tReserved for extensionAll other values are reserved.\n1)\t\"Service Centre specific number\" is used to indicate a numbering plan specific to External Short Message Entities attached to the SMSC.\nFor Type‑of‑number = 101 bits 3,2,1,0 are reserved and shall be transmitted as 0000. Note that for addressing any of the entities SC, MSC, SGSN or MS, Numbering‑plan‑identification = 0001 shall always be used. However, for addressing the SME, any specified Numbering‑plan‑identification value may be used.\nThe MS shall interpret reserved values as \"Unknown\" but shall store them exactly as received.\nThe SC may reject messages with a type of number containing a reserved value or one which is not supported.\nReserved values shall not be transmitted by an SC conforming to this version of the specification.\nWithin the Address‑Value field, either a semi‑octet or an alphanumeric1) representation applies.\nThe maximum length of the full address field (Address‑Length, Type‑of‑Address and Address‑Value) is 12 octets.\n1)\tApplies only to addressing at the SM‑TL.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.011",
        "ts_29.002",
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.1",
      "section_id": "9.2.1",
      "section_title": "General",
      "content": "The Short Message Transfer Layer (SM‑TL) provides a service to the Short Message Application Layer (SM‑AL). This service enables the SM‑AL to transfer short messages to its peer entity, receive short messages from its peer entity and receive reports about earlier requests for short messages to be transferred.\nIn order to keep track of messages and reports about those messages, primitives between the SM‑AL and SM‑TL contain a Short Message Identifier (SMI), which is a reference number for the message associated with the primitive. This Short Message Identifier is mapped to and from the Short Message Identifier used between the SM‑TL and the Short Message Relay Layer (SM‑RL). The Short Message Identifier is not carried between entities and therefore a given message may have different SMIs at the MS and SC sides (see clause 9.3.1 below).\nThe SM‑TL communicates with its peer entity by the protocol described in the following clauses.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_9.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.2",
      "section_id": "9.2.2",
      "section_title": "PDU Type repertoire at SM‑TL",
      "content": "The SM‑TL comprises the following six PDUs:\nSMS‑DELIVER, conveying a short message from the SC to the MS;\nSMS‑DELIVER‑REPORT, conveying;\na) a failure cause (if necessary);\nb) information as part of a positive or negative acknowledgement to an SMS-DELIVER or SMS-STATUS-REPORT;\nSMS‑SUBMIT, conveying a short message from the MS to the SC;\nSMS‑SUBMIT‑REPORT, conveying;\na) a failure cause (if necessary);\nb) information as part of a positive or negative acknowledgement to an SMS-SUBMIT or SMS-COMMAND;\nSMS‑STATUS‑REPORT, conveying a status report from the SC to the MS;\nSMS‑COMMAND, conveying a command from the MS to the SC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.2.1",
      "section_id": "9.2.2.1",
      "section_title": "SMS‑DELIVER type",
      "content": "Basic elements of the SMS‑DELIVER type:\nAbbr.\nReference\nP1)\nR2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the message type.\nTP‑MMS\nTP‑More‑Messages‑to‑Send\nM\nb\nParameter indicating whether or not there are more messages to send\nTP-LP\nTP-Loop-Prevention\nO\nb\nParameter indicating that SMS applications should inhibit forwarding or automatic message generation that could cause infinite looping.\nTP‑RP\nTP‑Reply‑Path\nM\nb\nParameter indicating that Reply Path exists.\nTP‑UDHI\nTP‑User‑Data‑Header‑Indicator\nO\nb\nParameter indicating that the TP‑UD field contains a Header\nTP‑SRI\nTP‑Status‑Report‑Indication\nO\nb\nParameter indicating if the SME has requested a status report.\nTP‑OA\nTP‑Originating‑Address\nM\n2‑12o\nAddress of the originating SME.\nTP‑PID\nTP‑Protocol‑Identifier\nM\no\nParameter identifying the above layer protocol, if any.\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nM\no\nParameter identifying the coding scheme within the TP‑User‑Data.\nTP‑SCTS\nTP‑Service‑Centre‑Time‑Stamp\nM\n7o\nParameter identifying time when the SC received the message.\nTP‑UDL\nTP‑User‑Data‑Length\nM\nI\nParameter indicating the length of the TP‑User‑Data field to follow.\nTP‑UD\nTP‑User‑Data\nO\n3)\n1)\tProvision;\tMandatory (M) or Optional (O).\n2)\tRepresentation;\tInteger (I), bit (b), 2 bits (2b), Octet (o), 7 octets (7o), 2‑12 octets (2‑12o).\n3)\tDependent on the TP‑DCS.\nLayout of SMS‑DELIVER:\nBit no.\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP-MTI, TP-MMS, TP-LP, TP-SRI, TP-UDHI, TP-RP\nNumber of\noctets\n1\n2\n2 to\n12\nTP-OA\n1\nTP-PID\n1\nTP-DCS\nTP-SCTS\n1\nTP-UDL\n1\nTP-UD\nNOTE:\tAny unused bits shall be set to zero by the sending entity and shall be ignored by the receiving entity.\n9.2.2.1a\tSMS‑DELIVER‑REPORT type\nAn SMS‑DELIVER‑REPORT TPDU is carried as a RP‑User‑Data element within an RP‑ERROR PDU and is part of the negative acknowledgement to an SMS‑DELIVER or SMS‑STATUS‑REPORT.\nAn SMS‑DELIVER‑REPORT TPDU is also carried as a RP‑User‑Data element within an RP‑ACK PDU and is part of a positive acknowledgement to a SMS‑DELIVER or SMS‑STATUS REPORT.\n(i)   SMS‑DELIVER‑REPORT for RP‑ERROR\nBasic elements of the SMS‑DELIVER‑REPORT type:\nAbbr.\nReference\nP1)\nP2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the message type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-UD field contains a Header\nTP‑FCS\nTP‑Failure‑Cause\nM\nI\nParameter indicating the reason for SMS‑DELIVER failure\nTP‑PI\nTP‑Parameter‑Indicator\nM\no\nParameter indicating the presence of any of the optional parameters which follow\nTP‑PID\nTP‑Protocol‑Identifier\nO\no\nsee clause 9.2.3.9\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nO\no\nsee clause 9.2.3.10\nTP‑UDL\nTP‑User‑Data‑Length\nO\no\nsee clause 9.2.3.16\nTP‑UD\nTP‑User‑Data\nO\n3) 4)\nsee clause 9.2.3.24\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), bit (b), 2bits (2b), octet (o).\n3)\tDependent upon the TP‑DCS.\n4)\tThe TP‑User‑Data field in the SMS‑DELIVER‑REPORT is only available for use by the MT.\nLayout of SMS‑DELIVER‑REPORT:\nBit Number\nNumber of Octets\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP‑MTI, TP-UDHI\n1\nTP-FCS\n1\nTP‑PI\n0,1\nTP‑PID\n0,1\nTP‑DCS\n0,1\nTP‑UDL\n0 to 158\nTP‑UD\nBits 7 and 5 ‑ 2 in octet 1 are presently unused and the sender shall set them to zero. If any of these bits is non‑zero, the receiver shall not examine the other field and shall treat the TP‑Failure‑Cause as \"Unspecified error cause\".\n(ii)  SMS‑DELIVER‑REPORT for RP‑ACK\nBasic elements of the SMS‑DELIVER‑REPORT type:\nAbbr\nReference\nP1)\nP2)\nDescription\nTP‑MTI\nTP‑Message Type Indicator\nM\n2b\nParameter describing the message type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-UD field contains a Header\nTP‑PI\nTP‑Parameter‑Indicator\nM\no\nParameter indicating the presence of any of the optional parameters which follow\nTP‑PID\nTP‑Protocol‑Identifier\nO\no\nsee clause 9.2.3.9\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nO\no\nsee clause 9.2.3.10\nTP‑UDL\nTP‑User‑Data‑Length\nO\no\nsee clause 9.2.3.16\nTP‑UD\nTP‑User‑Data\nO\n3) 4)\nsee clause 9.2.3.24\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), Bit (b), 2 bits (2b), octet (o).\n3)\tDependent upon the TP‑DCS.\n4)\tThe TP‑User‑Data field in the SMS‑DELIVER‑REPORT is only available for use by the MT.\nLayout of SMS‑DELIVER‑REPORT:\nBit Number\nNumber of Octets\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP‑MTI, TP-UDHI\n1\nTP‑PI\n0,1\nTP‑PID\n0,1\nTP‑DCS\n0,1\nTP‑UDL\n0 to 159\nTP‑UD\nBits 7 and 5 ‑ 2 in octet 1 are presently unused in the SMS‑DELIVER‑REPORT and the sender shall set them to zero. If any of these bits is non‑zero, the receiver shall ignore them.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.9",
        "clause_9.2.3.10",
        "clause_9.2.3.16",
        "clause_9.2.3.24"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.2.2",
      "section_id": "9.2.2.2",
      "section_title": "SMS‑SUBMIT type",
      "content": "Basic elements of the SMS‑SUBMIT type:\nAbbr.\nReference\nP1)\nP2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the message type.\nTP‑RD\nTP‑Reject‑Duplicates\nM\nb\nParameter indicating whether or not the SC shall accept an SMS‑SUBMIT for an SM still held in the SC which has the same TP‑MR and the same TP‑DA as a previously submitted SM from the same OA\nTP‑VPF\nTP‑Validity‑Period‑Format\nM\n2b\nParameter indicating whether or not the TP‑VP field is present.\nTP‑RP\nTP‑Reply‑Path\nM\nb\nParameter indicating the request for Reply Path.\nTP‑UDHI\nTP‑User‑Data‑Header‑Indicator\nO\nb\nParameter indicating that the TP‑UD field contains a Header.\nTP‑SRR\nTP‑Status‑Report‑Request\nO\nb\nParameter indicating if the MS is requesting a status report.\nTP‑MR\nTP‑Message‑Reference\nM\nI\nParameter identifying the SMS‑SUBMIT.\nTP‑DA\nTP‑Destination‑Address\nM\n2‑12o\nAddress of the destination SME.\nTP‑PID\nTP‑Protocol‑Identifier\nM\no\nParameter identifying the above layer protocol, if any.\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nM\no\nParameter identifying the coding scheme within the TP‑User‑Data.\nTP‑VP\nTP‑Validity‑Period\nO\no/7o\nParameter identifying the time from where the message is no longer valid.\nTP‑UDL\nTP‑User‑Data‑Length\nM\nI\nParameter indicating the length of the TP‑User‑Data field to follow.\nTP‑UD\nTP‑User‑Data\nO\n3)\n1)\tProvision;\tMandatory (M) or Optional (O).\n2)\tRepresentation;\tInteger (I), bit (b), 2 bits (2b), Octet (o), 7 octets (7o), 2‑12 octets (2‑12o).\n3)\tDependent on the TP‑DCS.\nLayout of SMS‑SUBMIT:\nBit no\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP-MTI, TP-RD, TP-VPF TP-SRR, TP-UDHI, TP-RP\n1\nTP-MR\nNumber of\n1\noctets\n2\n2 to\n12\nTP-DA\n1\nTP-PID\n1\nTP-DCS\n1\n0, 1\nor 7\nTP-VP\n1\nTP-UDL\n1\n0 to\n140\nTP-UD\nNOTE:\tAny unused bits shall be set to zero by the sending entity and shall be ignored by the receiving entity.\n9.2.2.2a\tSMS‑SUBMIT‑REPORT type\nAn SMS‑SUBMIT‑REPORT TPDU is carried as a RP‑User‑Data element within an RP‑ERROR PDU and is part of the negative acknowledgement to an SMS‑SUBMIT or SMS‑COMMAND.\nAn SMS‑SUBMIT‑REPORT TPDU is also carried as a RP‑User‑Data element with an RP‑ACK PDU and is part of a positive acknowledgement to a SMS‑SUBMIT or SMS‑COMMAND.\n(i)  SMS‑SUBMIT‑REPORT for RP‑ERROR\nBasic elements of the SMS‑SUBMIT‑REPORT type:\nAbbr.\nReference\nP1)\nP2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the message type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-UD field contains a Header\nTP‑FCS\nTP‑Failure‑Cause\nM\nI\nParameter indicating the reason for SMS‑SUBMIT failure\nTP‑PI\nTP‑Parameter‑Indicator\nM\no\nParameter indicating the presence of any of the optional parameters which follow\nTP‑SCTS\nTP‑Service‑Centre‑Time‑Stamp\nM\n7o\n5)\nParameter identifying the time when the SC received the SMS‑SUBMIT\nSee clause 9.2.3.11\nTP‑PID\nTP‑Protocol‑Identifier\nO\no\nSee clause 9.2.3.9\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nO\no\nsee clause 9.2.3.10\nTP‑UDL\nTP‑User‑Data‑Length\nO\no\nsee clause 9.2.3.16\nTP‑UD\nTP‑User‑Data\nO\n3) 4)\nsee clause 9.2.3.24\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), bit (b), 2bits (2b), octet (o).\n3)\tDependent upon the TP‑DCS.\n4)\tThe TP‑User‑Data field in the SMS‑SUBMIT‑REPORT is only available for use by the SC.\n5)\tThis same time value shall also be carried in the SMS‑STATUS‑REPORT relating to a particular SM. See clause 9.2.2.3. This shall allow the submitting SME to associate a particular SMS‑SUBMIT with a subsequent SMS‑STATUS‑REPORT by correlating the TP‑SCTS values.\nLayout of SMS‑SUBMIT‑REPORT:\nBit Number\nNumber of Octets\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP‑MTI, TP-UDHI\n1\nTP-FCS\n1\nTP‑PI\n7\nTP‑SCTS\n0,1\nTP‑PID\n0,1\nTP‑DCS\n0,1\nTP‑UDL\n0 to 151\nTP‑UD\nBits 7 and 5 ‑ 2 in octet 1 are presently unused and the sender shall set them to zero. If any of these bits is non‑zero, the receiver shall not examine the other field and shall treat the TP‑Failure‑Cause as \"Unspecified error cause\".\n(ii)  SMS‑SUBMIT‑REPORT for RP‑ACK\nBasic elements of the SMS‑SUBMIT_REPORT type:\nAbbr\nReference\nP1)\nP2)\nDescription\nTP‑MTI\nTP‑Message Type‑Indicator\nM\n2b\nParameter describing the message type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-UD field contains a Header\nTP‑PI\nTP‑Parameter‑Indicator\nM\no\nParameter indicating the presence of any of the optional parameters which follow\nTP‑SCTS\nTP‑Service‑Centre‑Time‑Stamp\nM\n7o\n5)\nParameter identifying the time when the SC received the SMS‑SUBMIT\nSee clause 9.2.3.11\nTP‑PID\nTP‑Protocol‑Identifier\nO\no\nSee clause 9.2.3.9\nTP‑DCS\nTP‑Data‑Coding‑Scheme\nO\no\nsee clause 9.2.3.10\nTP‑UDL\nTP‑User‑Data‑Length\nO\no\nsee clause 9.2.3.16\nTP‑UD\nTP‑User‑Data\nO\n3) 4)\nsee clause 9.2.3.24\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), Bit (B), 2bits (2b), octet (o).\n3)\tDependent upon the TP‑DCS.\n4)\tThe TP‑User‑Data field in the SMS‑SUBMIT‑REPORT is only available for use by the SC.\n5)\tThis same time value shall also be carried in the SMS‑STATUS‑REPORT relating to a particular SM. See clause 9.2.2.3. This shall allow the submitting SME to associate a particular SMS‑SUBMIT with a subsequent SMS‑STATUS‑REPORT by correlating the TP‑SCTS values.\nLayout of SMS‑SUBMIT REPORT\nBit Number\nNumber of Octets\n7\n6\n5\n4\n3\n2\n1\n0\n1\nTP‑MTI, TP-UDHI\n1\nTP‑PI\n7\nTP‑SCTS\n0,1\nTP‑PID\n0,1\nTP‑DCS\n0,1\nTP‑UDL\n0 to 152\nTP‑UD\nBits 7 and 5 ‑ 2 in octet 1 are presently unused in the SMS‑SUBMIT‑REPORT and the sender shall set them to zero. If any of these bits is non‑zero, the receiver shall ignore them.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.11",
        "clause_9.2.3.9",
        "clause_9.2.3.10",
        "clause_9.2.3.16",
        "clause_9.2.3.24",
        "clause_9.2.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.2.3",
      "section_id": "9.2.2.3",
      "section_title": "SMS‑STATUS‑REPORT type",
      "content": "Basic elements of the SMS‑STATUS‑REPORT type:\nAbbr.\nReference\nP1)\nR2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the message type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-UD field contains a Header\nTP‑MMS\nTP‑More‑Messages‑to‑Send\nM\nb\nParameter indicating whether or not there are more messages to send\nTP-LP\nTP-Loop-Prevention\nO\nb\nParameter indicating that SMS applications should inhibit forwarding or automatic message generation that could cause infinite looping.\nTP‑SRQ\nTP‑Status‑Report‑Qualifier\nM\nb\nParameter indicating whether the previously submitted TPDU was an SMS-SUBMIT or an SMS‑COMMAND\nTP‑MR\nTP‑Message‑Reference 3)\nM\nI\nParameter identifying the previously submitted SMS‑SUBMIT or SMS‑COMMAND\nTP‑RA\nTP‑Recipient‑Address\nM\n2‑12o\nAddress of the recipient of the previously submitted mobile originated short message\nTP‑SCTS\nTP‑Service‑Centre‑Time‑Stamp\nM\n7o\nParameter identifying time when the SC received the previously sent SMS‑SUBMIT\nTP‑DT\nTP‑Discharge‑Time\nM\n7o\nParameter identifying the time associated with a particular TP‑ST outcome\nTP‑ST\nTP‑Status\nM\no\nParameter identifying the status of the previously sent mobile originated short message\nTP-PI\nTP-Parameter-Indicator\nO4)\no\nParameter indicating the presence of any of the optional parameters which follow\nTP-PID\nTP-Protocol-Identifier\nO\no\nsee clause 9.2.3.9. TP-PID of original SMS-SUBMIT\nTP-DCS\nTP-Data-Coding-Scheme\nO\no\nsee clause 9.2.3.10\nTP-UDL\nTP-User-Data-Length\nO\no\nsee clause 9.2.3.16\nTP-UD\nTP-User-Data\nO\n5)\nsee clause 9.2.3.24\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), bit (b), 2 bits (2b), Octet (o), 7 octets (7o), 2‑12 octets (2‑12o).\n3)\tWhere the SMS‑STATUS‑REPORT is the result of an SMS‑COMMAND and the TP‑Command‑Type was an Enquiry, the TP‑MR returned in the SMS‑STATUS‑REPORT shall be the TP‑MN which was sent in the SMS‑COMMAND (i.e. the TP‑MR of the previously submitted SM to which the Enquiry refers).\n4)\tMandatory if any of the optional parameters following TP-PI is present, otherwise optional.\n5)\tTP-UD contains information related to a SMS-DELIVER; can contain information transported in the TP-UD of SMS-DELIVER-REPORT, and information inserted by the SMSC. The length of the TP-UD field is limited and might not be long enough to fit information both from the original receiving terminal (as included into the SMS-DELIVER-REPORT) and information added by the SMSC. In these cases the former information has higher priority, and the latter shall be truncated.\nLayout of SMS‑STATUS‑REPORT:\nBit no.\n7\n6\n5\n4\n3\n2\n1\n0\nNumber of\noctets\n1\nTP-MTI, TP-MMS, TP-LP, TP-SRQ, TP-UDHI\n1\nTP-MR\n1\n2\nTP-RA\n2 to\n12\n7\nTP-SCTS\n7\nTP-DT\n1\nTP-ST\n1\nTP-PI\n1\nTP-PID\n1\nTP-DCS\n1\n.\n.\n.\n.\n.\n.\nTP-UDL\n1\n0 to\n143\n.\n.\n.\n.\n.\n.\n.\n.\nTP-UD\nNOTE:\tAny unused bits shall be set to zero by the sending entity and shall be ignored by the receiving entity.\nThe maximum guaranteed length of TP-UD is 131 octets. In order to achieve the maximum stated above (143 octets), the TP-RA field must have a length of 2 octets and TP-PID and TP-DCS must not be present.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.9",
        "clause_9.2.3.10",
        "clause_9.2.3.16",
        "clause_9.2.3.24"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.2.4",
      "section_id": "9.2.2.4",
      "section_title": "SMS‑COMMAND type",
      "content": "Basic elements of the SMS‑COMMAND type:\nAbbr.\nReference\nP1)\nR2)\nDescription\nTP‑MTI\nTP‑Message‑Type‑Indicator\nM\n2b\nParameter describing the type\nTP-UDHI\nTP-User-Data-Header-Indication\nO\nb\nParameter indicating that the TP-CD field contains a Header\nTP‑SRR\nTP‑Status‑Report‑ Request\nO\nb\nParameter indicating if the SMS Command is requesting a status report.\nTP‑MR\nTP‑Message Reference\nM\nI\nParameter identifying the SMS‑COMMAND\nTP‑PID\nTP‑Protocol‑ Identifier\nM\no\nParameter identifying the above layer protocol, if any\nTP‑CT\nTP‑Command‑Type\nM\no\nParameter specifying which operation is to be performed on a SM\nTP‑MN\nTP‑Message‑Number\nM3)\no\nParameter indicating which SM in the SC to operate on\nTP‑DA\nTP‑Destination‑Address\nM4)\n2‑12o\nParameter indicating the Destination Address to which the TP‑Command refers\nTP‑CDL\nTP‑Command‑Data‑Length\nM\no\nParameter indicating the length of the TP‑CD field in octets\nTP‑CD\nTP‑Command‑Data\nO\no\nParameter containing user data\n1)\tProvision:\tMandatory (M) or Optional (O).\n2)\tRepresentation:\tInteger (I), bit (b), 2bits (2b), octet (o).\n3)\tFor TP‑Command‑Types which are not for a specific SM this field shall be ignored when received. Its value is of no concern but the field must be present to maintain the structure.\n4)\tFor certain TP‑Command‑Types which operate on a specific SM (e.g. Enquire, Delete etc.) the full TP‑DA must be specified. For TP‑Command‑Types which do not operate on a specific SM, the address length must be set to zero indicating that the Address‑Value fields are not present. The Type‑of‑Address field must be present (see 9.1.2.5) and shall be set to zero and ignored.\nLayout of SMS-COMMAND:\nBit no.\n7\n6\n5\n4\n3\n2\n1\n0\nNumber\n1\nTP-MTI, TP-SRR, TP-UDHI\nof octets\n1\nTP-MR\n1\nTP-PID\n1\nTP-CT\n1\nTP-MN\n2 to 12\nTP-DA\n………….…………………….\n1\nTP-CDL\n………….…………………….\n0 to 156\nTP-CD\nNOTE:\tThe maximum guaranteed length of TP-CD is 146 octets. In order to achieve the maximum stated above (156 octets), the TP-DA field must have a length of 2 octets.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.1",
      "section_id": "9.2.3.1",
      "section_title": "TP‑Message‑Type‑Indicator (TP‑MTI)",
      "content": "The TP-Message-Type-Indicator is a 2-bit field, located within bits no 0 and 1 of the first octet of all PDUs which can be given the following values:\nbit1\tbit0\tMessage type\n0\t0\tSMS‑DELIVER (in the direction SC to MS)\t\t0\t0\tSMS‑DELIVER REPORT (in the direction MS to SC)\t\t1\t0\tSMS‑STATUS‑REPORT (in the direction SC to MS)\t\t1\t0\tSMS‑COMMAND (in the direction MS to SC)\t\t0\t1\tSMS‑SUBMIT (in the direction MS to SC)\t\t0\t1\tSMS‑SUBMIT‑REPORT (in the direction SC to MS)\t\t1\t1\tReserved\nIf an MS receives a TPDU with a \"Reserved\" value in the TP‑MTI it shall process the message as if it were an \"SMS‑DELIVER\" but store the message exactly as received.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.2",
      "section_id": "9.2.3.2",
      "section_title": "TP‑More‑Messages‑to‑Send (TP‑MMS)",
      "content": "The TP‑More‑Messages‑to‑Send is a 1‑bit field, located within bit no 2 of the first octet of SMS‑DELIVER and SMS‑STATUS‑REPORT, and to be given the following values:\nBit no 2:\t0\tMore messages are waiting for the MS in this SC\n1\tNo more messages are waiting for the MS in this SC\nNote:\tIn the case of SMS‑STATUS‑REPORT this parameter refers to messages waiting for the mobile to which the status report is sent. The term message in this context refers to SMS‑messages or status reports.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.3",
      "section_id": "9.2.3.3",
      "section_title": "TP‑Validity‑Period‑Format (TP‑VPF)",
      "content": "The TP‑Validity‑Period‑Format is a 2‑bit field, located within bit no 3 and 4 of the first octet of SMS‑SUBMIT, and to be given the following values:\nbit4\tbit3\n0\t0\tTP‑VP field not present\t\t1\t0\tTP‑VP field present - relative format\t\t0\t1\tTP-VP field present - enhanced format\t\t1\t1\tTP‑VP field present - absolute format\nAny unsupported value may be rejected by the SC by returning the \"TP-VPF not supported\" TP-FCS value in the SMS Submit Report for RP-Error.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.4",
      "section_id": "9.2.3.4",
      "section_title": "TP‑Status‑Report‑Indication (TP‑SRI)",
      "content": "The TP‑Status‑Report‑Indication is a 1‑bit field, located within bit no. 5 of the first octet of SMS‑DELIVER, and to be given the following values:\nBit no. 5:\t0\tA status report shall not be returned to the SME\t\t1\tA status report shall be returned to the SME",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.5",
      "section_id": "9.2.3.5",
      "section_title": "TP‑Status‑Report‑Request (TP‑SRR)",
      "content": "The TP‑Status‑Report‑Request is a 1‑bit field, located within bit no. 5 of the first octet of SMS‑SUBMIT and SMS‑COMMAND, and to be given the following values:\nBit no. 5:\t0\tA status report is not requested\t\t1\tA status report is requested",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.6",
      "section_id": "9.2.3.6",
      "section_title": "TP‑Message‑Reference (TP‑MR)",
      "content": "The TP‑Message‑Reference field gives an integer representation of a reference number of the SMS‑SUBMIT or SMS‑COMMAND submitted to the SC by the MS. The MS increments TP‑Message‑Reference by 1 for each SMS‑SUBMIT or SMS‑COMMAND being submitted. The value to be used for each SMS‑SUBMIT is obtained by reading the Last‑Used‑TP‑MR value from the SMS Status data field in the (U)SIM (see GSM TS 51.011 [16] and 3GPP TS 31.102 [30]) and incrementing this value by 1. After each SMS‑SUBMIT has been submitted to the network, the Last‑Used‑TP‑MR value in the (U)SIM is updated with the TP‑MR that was used in the SMS‑SUBMIT operation. The reference number may possess values in the range 0 to 255. The value in the TP‑MR assigned by the MS is the same value which is received at the SC.\nIn the case where no response or an RP-ERROR with an appropriate cause value (see 3GPP TS 24.011 [13]) is received in response to an SMS‑SUBMIT, then the MS shall automatically repeat the SMS‑SUBMIT but must use the same TP‑MR value and set the TP-RD bit to 1 (see 9.2.3.25). The number of times the MS automatically repeats the SMS‑SUBMIT shall be in the range 1 to 3 but the precise number is an implementation matter. The automatic repeat mechanism should be capable of being disabled through MMI.\nIf all automatic attempts fail (or in the case of no automatic attempts the first attempt fails), the user shall be informed. The failed message shall be stored in the mobile in such a way that the user can request a retransmission using the same TP‑MR value, without the need to re‑enter any information. Such storage need only be provided for a single failed message, i.e. the one most recently attempted.\nThe SC should discard an SMS‑SUBMIT which has the TP-RD bit set to a 1 and which has the same TP‑MR value as the previous SMS‑SUBMIT received from the same originating address. In the case of a discarded SMS-SUBMIT, the SC should respond with an RP-ERROR, in which case the RP-ERROR shall include a SMS-SUBMIT-REPORT with TP-FCS indicating “SM Rejected – Duplicate SM”. In some cases, for backward compatibility with earlier phases and versions of this specification, the SC may be configured to respond with an RP-ACK.\nThe SMS‑STATUS‑REPORT also contains a TP‑Message‑Reference field. The value sent to the MS shall be the same as the TP‑Message‑Reference value generated by the MS in the earlier SMS‑SUBMIT or SMS‑COMMAND to which the status report relates.",
      "chunk_type": "general",
      "cross_references": [
        "ts_51.011",
        "ts_31.102",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.7",
      "section_id": "9.2.3.7",
      "section_title": "TP‑Originating‑Address (TP‑OA)",
      "content": "The TP‑Originating‑Address field is formatted according to the formatting rules of address fields.\nThe first '#' encountered in TP-OA indicates where the address for SMSC routing purposes is terminated. Additional '*'s or '#'s can be present in the following digits, and all these digits including the first '#' are subaddress digits.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.8",
      "section_id": "9.2.3.8",
      "section_title": "TP‑Destination‑Address (TP‑DA)",
      "content": "The TP‑Destination‑Address field is formatted according to the formatting rules of address fields.\nThe first '#' encountered in TP-DA indicates where the address for SMSC routing purposes is terminated. Additional '*'s or '#'s can be present in the following digits, and all these digits including the first '#' are subaddress digits.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.9",
      "section_id": "9.2.3.9",
      "section_title": "TP‑Protocol‑Identifier (TP‑PID)",
      "content": "The TP‑Protocol‑Identifier parameter serves the purposes indicated in clause 3.2.3. It consists of one octet, and the bits in the octet are used as follows:\nThe MS shall interpret reserved, obsolete, or unsupported values as the value 00000000 but shall store them exactly as received.\nThe SC may reject messages with a TP‑Protocol‑Identifier containing a reserved value or one which is not supported.\nbits\tusage\n7   60   0\tAssigns bits 0..5 as defined below0   1\tAssigns bits 0..5 as defined below1   0\treserved1   1\tAssigns bits 0‑5 for SC specific use\nIn the case where bit 7 = 0 and bit 6 = 0,\nbit 5\tindicates telematic interworking:\tvalue = 0  : no interworking, but SME‑to‑SME protocol\tvalue = 1  : telematic interworking\nIn the case of telematic interworking, the following five bit patterns in bits 4..0 are used to indicate different types of telematic devices:\n4..   .0\n00000\timplicit ‑ device type is specific to this SC, or can be concluded on the basis of the address\n00001\ttelex (or teletex reduced to telex format)\n00010\tgroup 3 telefax\n00011\tgroup 4 telefax\n00100\tvoice telephone (i.e. conversion to speech)\n00101\tERMES (European Radio Messaging System)\n00110\tNational Paging system (known to the SC)\n00111\tVideotex (T.100 [20] /T.101 [21])\n01000\tteletex, carrier unspecified\n01001\tteletex, in PSPDN\n01010\tteletex, in CSPDN\n01011\tteletex, in analog PSTN\n01100\tteletex, in digital ISDN\n01101\tUCI (Universal Computer Interface, ETSI DE/PS 3 01‑3)\n01110..01111\t(reserved, 2 combinations)\n10000\ta message handling facility (known to the SC)\n10001\tany public X.400‑based message handling system\n10010\tInternet Electronic Mail\n10011..10111\t(reserved, 5 combinations)\n11000..11110\tvalues specific to each SC, usage based on mutual agreement between the SME and the SC\t(7 combinations available for each SC)\n11111\tA GSM/UMTS mobile station. The SC converts the SM from the received\tTP‑Data‑Coding‑Scheme to any data coding scheme supported by that MS (e.g. the default).\nIf bit 5 has value 1 in an SMS‑SUBMIT PDU, it indicates that the SME is a telematic device of a type which is indicated in bits 4..0, and requests the SC to convert the SM into a form suited for that device type. If the destination network is ISDN, the SC must also select the proper service indicators for connecting to a device of that type.\nIf bit 5 has value 1 in an SMS‑DELIVER PDU, it indicates that the SME is a telematic device of a type which is indicated in bits 4..0.\nIf bit 5 has value 0 in an SMS‑DELIVER PDU, the value in bits 4..0 identifies the SM‑AL protocol being used between the SME and the MS.\nNote that for the straightforward case of simple MS‑to‑SC short message transfer the Protocol Identifier is set to the value 0.\nIn the case where bit 7 = 0, bit 6 = 1, bits 5..0 are used as defined below\n5 ..  . .0\n000000\tShort Message Type 0\n000001\tReplace Short Message Type 1\n000010\tReplace Short Message Type 2\n000011\tReplace Short Message Type 3\n000100\tReplace Short Message Type 4\n000101\tReplace Short Message Type 5\n000110\tReplace Short Message Type 6\n000111\tReplace Short Message Type 7\n001000\tDevice Triggering Short Message\n001001..011101\tReserved\n011110\tEnhanced Message Service (Obsolete)\n011111\tReturn Call Message\n100000..111011\tReserved\n111100\tANSI-136 R-DATA\n111101\tME Data download\n111110\tME De‑personalization Short Message\n111111\t(U)SIM Data download\nA short message type 0 indicates that the ME must acknowledge receipt of the short message but shall discard its contents. This means that\n-\tthe MS shall be able to receive the type 0 short message irrespective of whether there is memory available in the (U)SIM or ME or not,\n-\tthe MS shall not indicate the receipt of the type 0 short message to the user,\n-\tthe short message shall neither be stored in the (U)SIM nor ME.\nThe Replace Short Message feature is optional for the ME and the (U)SIM but if implemented it shall be performed as described here.\nFor MT short messages, on receipt of a short message from the SC, the MS shall check to see if the associated Protocol Identifier contains a Replace Short Message Type code.\nIf such a code is present, then the MS shall check the originating address and replace any existing stored message having the same Protocol Identifier code and originating address with the new short message and other parameter values. If there is no message to be replaced, the MS shall store the message in the normal way. The MS may also check the SC address as well as the Originating Address. However, in a network which has multiple SCs, it is possible for a Replace Message type for a SM to be sent via different SCs and so it is recommended that the SC address should not be checked by the MS unless the application specifically requires such a check.\nIf a Replace Short Message Type code is not present then the MS shall store the message in the normal way.\nIn MO short messages the SC reacts similarly but only the address of the originating MS or any other source is checked.\nThe Device Triggering Short Message feature is optional for the MS, but if implemented it shall be performed as described here.\nFor MT short messages, on receipt of a short message from the SC, the MS can check to see if the associated Protocol Identifier contains a Device Triggering Short Message code.\nIf such a code is present, then the MS shall interpret the short message as a device triggering short message. The value contained in the Application Port Addressing information element identifies the application to receive the trigger.\nMO short messages with a Protocol Identifier containing a Device Triggering Short Message code are not supported and shall be discarded by the SC.\nA Return Call Message indicates to the MS to inform the user that a call (e.g. a telephone call) can be established to the address specified within the TP‑OA. The RP‑OA contains the address of the SC as usual. The message content (if present) gives displayable information (e.g. the number of waiting voice messages). The message is handled in the same way as all other messages of the Replace Short Message Types.\nThe ME De‑personalization Short Message is a ME‑specific message which instructs the ME to de‑personalities the ME (see 3GPP TS 22.022 [25]). The TP‑DCS shall be set to Uncompressed, Default Alphabet, and Message Class 1 (ME‑specific), which corresponds to a bit coding of 00010001. The TP‑UD field contains de‑personalization information coded according to 3GPP TS 22.022 [25]. This information shall not be displayed by an ME which supports the scheme. The acknowledgement to this message is a SMS‑DELIVER‑REPORT for RP‑ACK in which the TP‑User‑Data shall be coded according to 3GPP TS 22.022 [25].\n(U)SIM Data download is a facility whereby the ME must pass the short message in its entirety including all SMS elements contained in the SMS deliver to the (U)SIM using the mechanism described in GSM TS 51.011 [16] and 3GPP TS 31.102 [30]. The DCS shall be set to message class 2. The entire user data field is available for (U)SIM Data download. If the DCS is not set to message class 2 then the message shall be handled in the normal way by the ME. However it has to be noted that MEs based on releases of this specification earlier than REL-5 may allow only 8 bit message class 2 with bit coding 11110110 or 00010110 for (U)SIM Data download.\nME Data download is a facility whereby the ME shall process the short message in its entirety including all SMS elements contained in the SMS deliver to the ME. The DCS should normally be set to message class 1. If the DCS is set to message class 1 and no application in the ME exists, which is able to process the short message, the ME may discard the short message. The entire user data field is available for ME data download. The TPDU parameters required for the SMS-DELIVER should be passed transparently by all involved SCs, so no TPDU parameter in the entire short message is modified, other than the changes required to convert an SMS-SUBMIT into an SMS-DELIVER.\nANSI-136 R-DATA is a facility whereby the ME must pass the short message in its entirety, including all elements contained in the SMS DELIVER, to the (U)SIM using the mechanism described in GSM TS 11.14 [16] and 3GPP TS 31.102 [30]. The DCS shall be set to message class 2. If the DCS is not set to message class 2 then the message shall be handled in the normal way by the ME. However it has to be noted that MEs based on  releases of this specification earlier than REL-5 may allow only 8 bit message class 2 with bit coding 11110110 or 00010110 for ANSI-136 R-DATA.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_3.2.3",
        "ts_22.022",
        "ts_51.011",
        "ts_31.102",
        "ts_11.14"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.10",
      "section_id": "9.2.3.10",
      "section_title": "TP‑Data‑Coding‑Scheme (TP‑DCS)",
      "content": "The TP‑Data‑Coding‑Scheme is defined in 3GPP TS 23.038 [9].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.11",
      "section_id": "9.2.3.11",
      "section_title": "TP‑Service‑Centre‑Time‑Stamp (TP‑SCTS)",
      "content": "The TP‑Service‑Centre‑Time‑Stamp field is given in semi‑octet representation, and represents the local time in the following way:\nYear:\nMonth:\nDay:\nHour:\nMinute:\nSecond:\nTime Zone\nDigits:(Semi‑octets)\n2\n2\n2\n2\n2\n2\n2\nThe Time Zone indicates the difference, expressed in quarters of an hour, between the local time and GMT. In the first of the two semi‑octets, the first bit (bit 3 of the seventh octet of the TP‑Service‑Centre‑Time‑Stamp field) represents the algebraic sign of this difference (0: positive, 1: negative).\nThe Service‑Centre‑Time‑Stamp, and any other times coded in this format that are defined in the present document, represent the time local to the sending entity.\nIf the MS has knowledge of the local time zone, then any time received (e.g. Service‑Centre‑Time‑Stamp) at the MS may be displayed in the local time rather than the time local to the sending entity. Messages shall be stored as received without change to any time contained therein.\nThe Time Zone code enables the receiver to calculate the equivalent time in GMT from the other semi‑octets in the Service‑Centre‑Time‑Stamp, or indicate the time zone (GMT, GMT+1H etc.), or perform other similar calculations as required by the implementation. The value contained in the Time Zone field must take into account daylight saving time, such that when the sending entity changes from regular (winter) time to daylight saving (summer) time, there is a change to the value in the Time Zone field, for example in the UK the winter setting is 00000000 and the summer setting is 01000000.\nIf the MS receives a non‑integer value in the SCTS, it shall assume that the digit is set to 0 but shall store the entire field exactly as received.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.12.1",
      "section_id": "9.2.3.12.1",
      "section_title": "TP-VP (Relative format)",
      "content": "The TP‑Validity‑Period comprises 1 octet in integer representation, giving the length of the validity period, counted from when the SMS‑SUBMIT is received by the SC.\nThe representation of time is as follows:\nTP‑VP value\nValidity period value\n0 to 143\n(TP‑VP + 1) x 5 minutes (i.e. 5 minutes intervals up to 12 hours)\n144 to 167\n12 hours + ((TP‑VP ‑143) x 30 minutes)\n168 to 196\n(TP‑VP ‑ 166) x 1 day\n197 to 255\n(TP‑VP ‑ 192) x 1 week",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.12.2",
      "section_id": "9.2.3.12.2",
      "section_title": "TP-VP (Absolute format)",
      "content": "The TP-Validity Period comprises 7 octets in semi octet representation giving the absolute time of the validity period termination.\nThe representation of time is identical to the representation of the TP‑Service‑Centre‑Time‑Stamp.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.12.3",
      "section_id": "9.2.3.12.3",
      "section_title": "TP-VP (Enhanced format)",
      "content": "The TP-Validity Period comprises 7 octets. The presence of all octets is mandatory although they may not all be used. The first octet indicates the way in which the following 6 octets are used. Any reserved/unused bits or octets must be set to zero.\nOctet 1\tTP-VP functionality indicator\nbit 7\tExtension bitSet to 1 if the TP-VP functionality indicator is to be extended to another octet. A setting of 0 indicates that there are no more TP-VP functionality indicator extension octets to follow.Any such extension octet shall immediately follow the previous TP-VP functionality indicator.\nbit 6\tSingle shot SM.Set to 1 if the SC is required to make up to one delivery attempt. The TP-Validity Period, where present, shall be applicable to the Single shot SM.\nbits 5, 4, 3\tReserved\nbits 2, 1, 0\tValidity Period Format.\nValue bits\n2   1   0\n0   0   0\nNo Validity Period specified\n0   0   1\nValidity Period is as specified for the relative case. The following octet contains the TP-VP value as described in 9.2.3.12.1\n0  1  0\nValidity period is relative in integer representation and the following octet contains the TP-VP value in the range 0 to 255 representing 0 to 255 seconds. A TP-VP value of zero is undefined and reserved for future use.\n0  1  1\nValidity period is relative in semi-octet representation. The following 3 octets contain the relative time in Hours, Minutes and Seconds giving the length of the validity period counted from when the SMS-SUBMIT is received by the SC. The representation of time uses the same representation as the Hours, Minutes and Seconds in the TP‑Service‑Centre‑Time‑Stamp.\n1   0   0\nReserved\n1   0   1\nReserved\n1   1   0\nReserved\n1   1   1\nReserved\nThe SC shall reject any Unsupported/ Reserved values received by returning the 'TP-VP not supported' TP-FCS value in the Submit SM Report for RP-Error.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.13",
      "section_id": "9.2.3.13",
      "section_title": "TP‑Discharge‑Time (TP‑DT)",
      "content": "The TP‑Discharge‑Time field indicates the time at which a previously submitted SMS‑SUBMIT was successfully delivered to or attempted to deliver to the recipient SME or disposed of by the SC.\nIn the case of \"transaction completed\" the time shall be the time of the completion of the transaction. In the case of \"SC still trying to transfer SM\" the time shall be the time of the last transfer attempt. In the case of \"permanent or temporary error ‑ SC not making any more transfer attempts\" the time shall be the time of either the last transfer attempt or the time at which the SC disposed of the SM according to the Status outcome in TP‑ST.\nThe TP‑Discharge‑Time is given in semi‑octet representation in a format identical to the TP‑SCTS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.14",
      "section_id": "9.2.3.14",
      "section_title": "TP‑Recipient‑Address (TP‑RA)",
      "content": "The TP‑Recipient‑Address field indicates the address of the SME that was the destination of the previously submitted mobile originated short message being subject to the status report. The field is formatted according to the formatting rules of address fields.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.15",
      "section_id": "9.2.3.15",
      "section_title": "TP‑Status (TP‑ST)",
      "content": "The TP‑Status field indicates the status of a previously submitted SMS‑SUBMIT and certain SMS COMMANDS for which a Status ‑Report has been requested. It consists of one octet and the bits in the octet are used as follows.\nThe MS shall interpret any reserved values as \"Service Rejected\" (01100011) but shall store them exactly as received.\nbits\tvalue/usage\n7\t0\tBits 0..6 as defined below:\n6....0\tIndicate whether the previously submitted short message was successfully forwarded to the SME, or whether an error condition has been encountered, as follows:\nShort message transaction completed\n0000000\t\tShort message received by the SME0000001\t\tShort message forwarded by the SC to the SME but the SC is \t\tunable to confirm delivery0000010\t\tShort message replaced by the SC\n0000011..0001111\tReserved0010000..0011111\tValues specific to each SC\nTemporary error, SC still trying to transfer SM\n0100000\t\tCongestion0100001\t\tSME busy0100010\t\tNo response from SME0100011\t\tService rejected0100100\t\tQuality of service not available0100101\t\tError in SME\n0100110..0101111\tReserved0110000..0111111\tValues specific to each SC\nPermanent error, SC is not making any more transfer attempts\n1000000\t\tRemote procedure error1000001\t\tIncompatible destination1000010\t\tConnection rejected by SME1000011\t\tNot obtainable1000100\t\tQuality of service not available1000101\t\tNo interworking available1000110\t\tSM Validity Period Expired1000111\t\tSM Deleted by originating SME1001000\t\tSM Deleted by SC Administration1001001\t\tSM does not exist (The SM may have previously existed in the SC but the SC\t\tno longer has knowledge of it or the SM \t\tmay never have previously existed in the SC)1001010..1001111\tReserved1010000..1011111\tValues specific to each SC\nTemporary error, SC is not making any more transfer attempts\n1100000\t\tCongestion1100001\t\tSME busy1100010\t\tNo response from SME1100011\t\tService rejected1100100\t\tQuality of service not available1100101\t\tError in SME1100110..1101001\tReserved1101010..1101111\tReserved1110000..1111111\tValues specific to each SC\nbits\t\tvalue/usage\n7\t\t1\t\tBits 0..6\treserved",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.16",
      "section_id": "9.2.3.16",
      "section_title": "TP‑User‑Data‑Length (TP‑UDL)",
      "content": "If the TP‑User‑Data is coded using the GSM 7 bit default alphabet, the TP‑User‑Data‑Length field gives an integer representation of the number of septets within the TP‑User‑Data field to follow. If the 7bit default-alphabet extension mechanism is used within the TP‑User‑Data (see 3GPP TS 23.038 [9]), the actual number of characters in the message shall be less than the number of septets. If a TP‑User‑Data‑Header field is present, then the TP‑User‑Data‑Length value is the sum of the number of septets in the TP‑User‑Data‑Header field (including any padding) and the number of septets in the TP‑User‑Data field which follows. See figure 9.2.3.24 (a). If the TP‑User‑Data is coded using 8‑bit data, the TP‑User‑Data‑Length field gives an integer representation of the number of octets within the TP‑User‑Data field to follow. If a TP‑User‑Data‑Header field is present, then the TP‑User‑Data‑Length value is the sum of the number of octets in the TP‑User‑Data‑Header field and the number of octets in the TP‑User‑Data field which follows. See figure 9.2.3.24 (b).\nIf the TP‑User‑Data is coded using UCS2 [24] data, the TP‑User‑Data‑Length field gives an integer representation of the number of octets within the TP‑User‑Data field to follow. If a TP‑User‑Data‑Header field is present, then the TP‑User‑Data‑Length value is the sum of the number of octets in the TP‑User‑Data‑Header field and the number of octets in the TP‑User‑Data field which follows. See figure 9.2.3.24 (b).\nIf the TP‑User‑Data is coded using compressed GSM 7 bit default alphabet or compressed 8 bit data or compressed UCS2 [24] data, the TP‑User‑Data‑Length field gives an integer representation of the number of octets after compression within the TP‑User‑Data field to follow. If a TP‑User‑Data‑Header field is present, then the TP‑User‑Data‑Length value is the sum of the number of uncompressed octets in the TP‑User‑Data‑Header field and the number of octets in the compressed TP‑User‑Data field which follows. See figure 9.2.3.24 (c).\nFor other Data Coding Schemes, see 3GPP TS 23.038 [9]. If this field is zero, the TP‑User‑Data field shall not be present.",
      "chunk_type": "general",
      "cross_references": [
        "figure_9.2.3.24",
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.17",
      "section_id": "9.2.3.17",
      "section_title": "TP‑Reply‑Path (TP‑RP)",
      "content": "The TP‑Reply‑Path is a 1‑bit field, located within bit no 7 of the first octet of both SMS‑DELIVER and SMS‑SUBMIT, and to be given the following values:\nBit no 7:\t0\tTP‑Reply‑Path parameter is not set in this SMS‑SUBMIT/DELIVER\n1\tTP‑Reply‑Path parameter is set in this SMS‑SUBMIT/DELIVER\nPlease refer to annex D for details about the Reply procedures.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.18",
      "section_id": "9.2.3.18",
      "section_title": "TP‑Message‑Number (TP‑MN)",
      "content": "The TP‑Message‑Number is an 8‑bit field allowing an MS to refer uniquely to an SM in the SC which that MS has previously submitted. The TP‑MN value is the TP‑MR value of a previously submitted SM.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.19",
      "section_id": "9.2.3.19",
      "section_title": "TP‑Command‑Type (TP‑CT)",
      "content": "The TP‑Command‑Type is an 8‑bit field specifying the type of operation that the SC is to perform. It has the following values:\nValue (bit 7 .. 0)\nCommand Description\nStatus Report Request Value\n00000000\nEnquiry relating to previously submitted short message\n1\n00000001\nCancel Status Report Request relating to previously submitted short message\n0\n00000010\nDelete previously submitted Short Message\n0\n00000011\nEnable Status Report Request relating to previously submitted short message\n0\n00000100..00011111\nReserved\nunspecified\n11100000..11111111\nValues specific for each SC\n1 or 0\nThe SC shall return an RP‑Error with an appropriate TP‑Failure‑Cause for any TP‑Command value which is reserved, unsupported or invalid or the actioning of the command has failed.\nThe SC shall return an RP‑ACK if the actioning of the Command has succeeded.\nA successful Enquiry shall result in the SC sending a SMS‑STATUS‑REPORT for the SM to which the Enquiry refers. In the case where the SC has a number of SMs which have the same TP‑MR, the same TP‑DA and have come from the same originating address the SC shall send a SMS‑STATUS‑REPORT for each SM.\nIn the case where a TP‑Command is to Delete a previously submitted short message, the SC shall send a Status Report indicating that the SM has been deleted if the original Submit SM request requested a status Report.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.20",
      "section_id": "9.2.3.20",
      "section_title": "TP‑Command‑Data‑Length (TP‑CDL)",
      "content": "The TP‑Command‑Data‑Length field is used to indicate the number of octets contained within the TP‑Command‑Data‑field. If this field is set to zero, the TP‑Command‑Data field shall not be present.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.21",
      "section_id": "9.2.3.21",
      "section_title": "TP‑Command‑Data (TP‑CD)",
      "content": "The TP‑Command‑Data field contains data relating to the operation requested by the MS which is to be performed at the SC. The maximum length of this field is 157 octets. The usage and provision of the optional TP‑Command‑Data field shall be determined by the function selected by the TP‑Command‑Type field.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.22",
      "section_id": "9.2.3.22",
      "section_title": "TP‑Failure‑Cause (TP‑FCS)",
      "content": "The TP‑Failure‑Cause field is used to report the reason for failure to transfer or process a short message. It consists of a single octet used as follows:\nTP-FCS\nValue\n(Hex)\nMeaning\nWhen used\nMO\nMT\n00 - 7F\nReserved\n80 - 8F\nTP-PID errors\n80\nTelematic interworking not supported\nx\n81\nShort message Type 0 not supported\nx\nx\n82\nCannot replace short message\nx\nx\n83 - 8E\nReserved\n8F\nUnspecified TP-PID error\nx\nx\n90 - 9F\nTP-DCS errors\n90\nData coding scheme (alphabet) not supported\nx\n91\nMessage class not supported\nx\n92 - 9E\nReserved\n9F\nUnspecified TP-DCS error\nx\nx\nA0 - AF\nTP-Command Errors\nA0\nCommand cannot be actioned\nx\nA1\nCommand unsupported\nx\nA2 - AE\nReserved\nAF\nUnspecified TP-Command error\nx\nB0\nTPDU not supported\nx\nx\nB1 - BF\nReserved\nC0\nSC busy\nx\nC1\nNo SC subscription\nx\nC2\nSC system failure\nx\nC3\nInvalid SME address\nx\nC4\nDestination SME barred\nx\nC5\nSM Rejected-Duplicate SM\nx\nC6\nTP-VPF not supported\nX\nC7\nTP-VP not supported\nX\nC8 - CF\nReserved\nD0\n(U)SIM SMS storage full\nx\nD1\nNo SMS storage capability in (U)SIM\nx\nD2\nError in MS\nx\nD3\nMemory Capacity Exceeded\nX\nD4\n(U)SIM Application Toolkit Busy\nx\nD5\n(U)SIM data download error\nx\nD6 - DF\nReserved\nE0 - FE\nValues specific to an application\nx\nx\nFF\nUnspecified error cause\nx\nx\nNOTE:\tAny reserved codes which are received should be treated as an unspecified error cause.\tMT and MO refer to the overall mobile terminated and mobile originated services; not the direction of transmission of TP‑FCS.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.23",
      "section_id": "9.2.3.23",
      "section_title": "TP‑User‑Data‑Header‑Indicator (TP‑UDHI)",
      "content": "The TP‑User‑Data‑Header‑Indicator is a 1 bit field within bit 6 of the first octet of the following six PDUs:\n-\tSMS‑SUBMIT,\n-\tSMS-SUBMIT-REPORT,\n-\tSMS‑DELIVER,\n-\tSMS-DELIVER-REPORT,\n-\tSMS-STATUS-REPORT,\n-\tSMS-COMMAND.\nTP-UDHI has the following values.\nBit no. 6\t0\tThe TP‑UD field contains only the short message\n1\tThe beginning of the TP‑UD field contains a Header in addition to the short message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24",
      "section_id": "9.2.3.24",
      "section_title": "TP‑User Data (TP‑UD)",
      "content": "The length of the TP-User-Data field is defined in the PDU's of the SM-TL (see clause 9.2.2).\nThe TP‑User‑Data field may comprise just the short message itself or a Header in addition to the short message depending upon the setting of TP‑UDHI.\nWhere the TP‑UDHI value is set to 0 the TP‑User‑Data field comprises the short message only, where the user data can be 7 bit (default alphabet) data, 8 bit data, or 16 bit (UCS2 [24]) data.\nWhere the TP‑UDHI value is set to 1 the first octets of the TP‑User‑Data field contains a Header in the following order starting at the first octet of the TP‑User‑Data field.\nIrrespective of whether any part of the User Data Header is ignored or discarded, the MS shall always store the entire TPDU exactly as received.\nFIELD\t\t\t\tLENGTH\nLength of User Data Header\t\t1 octet\nInformation‑Element‑Identifier \"A\"\t1 octet\nLength of Information‑Element \"A\"\t1 octet\nInformation‑Element \"A\" Data\t\t0 to \"n\" octets\nInformation‑Element‑Identifier \"B\"\t\t1 octet\nLength of Information‑Element \"B\"\t1 octet\nInformation‑Element \"B\" Data\t\t0 to \"n\" octets\nInformation‑Element‑Identifier \"X\"\t\t1 octet\nLength of Information‑Element \"X\"\t\t1 octet\nInformation‑Element \"X\" Data\t\t0 to \"n\" octets\nThe diagram below shows the layout of the TP-User-Data-Length and the TP-User-Data for uncompressed GSM 7 bit default alphabet data. The UDHL field is the first octet of the TP-User-Data content of the Short Message.\nFigure 9.2.3.24 (a)\nThe diagram below shows the layout of the TP-User-Data-Length and the TP-User-Data for uncompressed 8 bit data or uncompressed UCS2 data. The UDHL field is the first octet of the TP-User-Data content of the Short Message.\nFigure 9.2.3.24 (b)\nThe diagram below shows the layout of the TP-User-Data-Length and the TP-User-Data for compressed GSM 7 bit default alphabet data, compressed 8 bit data or compressed UCS2 data. The UDHL field is the first octet of the TP‑User-Data content of the Short Message.\nFigure 9.2.3.24 (c)\nThe definition of the TP‑User‑Data‑Length field which immediately precedes the \"Length of User Data Header\" is unchanged and shall therefore be the total length of the TP‑User‑Data field including the Header, if present. (see 9.2.3.16).\nThe \"Length‑of‑Information‑Element\" fields shall be the integer representation of the number of octets within its associated \"Information‑Element‑Data\" field which follows and shall not include itself in its count value.\nThe \"Length‑of‑User‑Data‑Header\" field shall be the integer representation of the number of octets within the \"User‑Data‑Header\" information fields which follow and shall not include itself in its count or any fill bits which may be present (see text below).\nInformation Elements may appear in any order and need not follow the order used in the present document. Information Elements are classified into 3 categories as described below.\n-\tSMS Control – identifies those IEIs which have the capability of dictating SMS functionality.\n-\tEMS Control – identifies those IEIs which manage EMS Content IEIs.\n-\tEMS Content – identifies those IEIs containing data of a unique media format.\nIt is permissible for certain IEs to be repeated within a short message, or within a concatenated message. There is no restriction on the repeatability of IEs in the EMS Content classification. The repeatability of SMS Control and EMS Control IEs is determined on an individual basis. See the IE table below for the repeatability of each IE.\nIn the event that IEs determined as not repeatable are duplicated, the last occurrence of the IE shall be used. In the event that two or more IEs occur which have mutually exclusive meanings (e.g. an 8bit port address and a 16bit port address), then the last occurring IE shall be used.\nIf the length of the User Data Header is such that there are too few or too many octets in the final Information Element then the whole User Data Header shall be ignored.\nIf any reserved values are received within the content of any Information Element then that part of the Information Element shall be ignored.\nThe support of any  Information Element Identifier is optional unless otherwise stated.\nThe Information Element Identifier octet shall be coded as follows:\nVALUE (hex)\nMEANING\nClassification\nRepeatability\n00\nConcatenated short messages, 8-bit reference number\nSMS Control\nNo\n01\nSpecial SMS Message Indication\nSMS Control\nYes\n02\nReserved\nN/A\nN/A\n03\nValue not used to avoid misinterpretation as <LF> character\nN/A\nN/A\n04\nApplication port addressing scheme, 8 bit address\nSMS Control\nNo\n05\nApplication port addressing scheme, 16 bit address\nSMS Control\nNo\n06\nSMSC Control Parameters\nSMS Control\nNo\n07\nUDH Source Indicator\nSMS Control\nYes\n08\nConcatenated short message, 16-bit reference number\nSMS Control\nNo\n09\nWireless Control Message Protocol\nSMS Control\nNote 3\n0A\nText Formatting\nEMS Control\nYes\n0B\nPredefined Sound\nEMS Content\nYes\n0C\nUser Defined Sound (iMelody max 128 bytes)\nEMS Content\nYes\n0D\nPredefined Animation\nEMS Content\nYes\n0E\nLarge Animation (16*16 times 4 = 32*4 =128 bytes)\nEMS Content\nYes\n0F\nSmall Animation (8*8 times 4 = 8*4 =32 bytes)\nEMS Content\nYes\n10\nLarge Picture (32*32 = 128 bytes)\nEMS Content\nYes\n11\nSmall Picture (16*16 = 32 bytes)\nEMS Content\nYes\n12\nVariable Picture\nEMS Content\nYes\n13\nUser prompt indicator\nEMS Control\nYes\n14\nExtended Object\nEMS Content\nYes\n15\nReused Extended Object\nEMS Control\nYes\n16\nCompression Control\nEMS Control\nNo\n17\nObject Distribution Indicator\nEMS Control\nYes\n18\nStandard WVG object\nEMS Content\nYes\n19\nCharacter Size WVG object\nEMS Content\nYes\n1A\nExtended Object Data Request Command\nEMS Control\nNo\n1B-1F\nReserved for future EMS features (see clause 3.10)\nN/A\nN/A\n20\nRFC 5322 E-Mail Header\nSMS Control\nNo\n21\nHyperlink format element\nSMS Control\nYes\n22\nReply Address Element\nSMS Control\nNo\n23\nEnhanced Voice Mail Information\nSMS Control\nNo\n24\nNational Language Single Shift\nSMS Control\nNo\n25\nNational Language Locking Shift\nSMS Control\nNo\n26\nFiller\nSMS Control\nYes\n27 – 6F\nReserved for future use\nN/A\nN/A\n70 – 7F\n(U)SIM Toolkit Security Headers\nSMS Control\nNote 1\n80 – 9F\nSME to SME specific use\nSMS Control\nNote 2\nA0 – BF\nReserved for future use\nN/A\nN/A\nC0 – DF\nSC specific use\nSMS Control\nNote 2\nE0 – FF\nReserved for future use\nN/A\nN/A\nNote 1:\tThe functionality of these IEIs is defined in 3GPP TSG 31.115 [28], and therefore, the repeatability is not within the scope of this document and will not be determined here.\nNote 2:\tThe functionality of these IEIs  is used in a proprietary fashion by different SMSC vendors, and therefore, are not within the scope of this technical specification.\nNote 3:\tThe functionality of these IEIs is defined by the WAP Forum and therefore the repeatability is not within the scope of this document and will not be determined here.\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) any information element where the IEI is Reserved or not supported. The receiving entity calculates the start of the next information element by looking at the length of the current information element and skipping that number of octets.\nThe SM itself may be coded as 7, 8 or 16 bit data.\nIf 7 bit data is used and the TP‑UD‑Header does not finish on a septet boundary then fill bits are inserted after the last Information Element Data octet up to the next septet boundary so that there is an integral number of septets for the entire TP‑UD header. This is to ensure that the SM itself starts on an septet boundary so that an earlier Phase mobile shall be capable of displaying the SM itself although the TP‑UD Header in the TP‑UD field may not be understood.\nIt is optional to make the first character of the SM itself a Carriage Return character encoded according to the default 7 bit alphabet so that earlier Phase mobiles, which do not understand the TP‑UD‑Header, shall over‑write the displayed TP‑UD‑Header with the SM itself.\nIf 16 bit (USC2) data is used then padding octets are not necessary. The SM itself shall start on an octet boundary.\nIf 8 bit data is used then padding is not necessary. An earlier Phase mobile shall be able to display the SM itself although the TP‑UD header may not be understood.\nIt is also possible for mobiles not wishing to support the TP‑UD header to check the value of the TP‑UDHI bit in the SMS‑Deliver PDU and the first octet of the TP‑UD field and skip to the start of the SM and ignore the TP‑UD header.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.2",
        "clause_3.10",
        "figure_9.2.3.24"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.1",
      "section_id": "9.2.3.24.1",
      "section_title": "Concatenated Short Messages",
      "content": "This facility allows short messages to be concatenated to form a longer message.\nIn the case of uncompressed 8‑bit data, the maximum length of the short message within the TP‑UD field is 134 (140‑6) octets.\nIn the case of uncompressed GSM 7 bit default alphabet data, the maximum length of the short message within the TP‑UD field is 153 (160‑7) characters. A character represented by an escape-sequence shall not be split in the middle.\nIn the case of 16 bit uncompressed USC2 data, the maximum length of the short message within the TP‑UD field is 67 ((140‑6)/2) characters. A UCS2 character shall not be split in the middle; if the length of the User Data Header is odd, the maximum length of the whole TP-UD field is 139 octets.\nIn the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2 the maximum length of the compressed short message within the TP-UD field is 134 (140-6) octets including the Compression Header and Compression Footer, both or either of which may be present (see clause 3.9).\nThe maximum length of an uncompressed concatenated short message is 39015 (255*153) default alphabet characters, 34170 (255*134) octets or 17085 (255*67) UCS2 characters.\nThe maximum length of a compressed concatenated message is 34170 (255*134) octets including the Compression Header and Compression Footer (see clause 3.9 and figure 9.2.3.24.1(a) below).\nFigure 9.2.3.24.1 (a): Concatenation of a Compressed short message\nThe Information‑Element‑Data field contains information set by the application in the SMS‑SUBMIT so that the receiving entity is able to re‑assemble the short messages in the correct order. Each concatenated short message contains a reference number which together with the originating address and Service Centre address allows the receiving entity to discriminate between concatenated short messages sent from different originating SMEs and/or SCs. In a network which has multiple SCs, it is possible for different segments of a concatenated SM to be sent via different SCs and so it is recommended that the SC address should not be checked by the MS unless the application specifically requires such a check.\nThe TP elements in the SMS‑SUBMIT PDU, apart from TP‑MR, TP-SRR, TP‑UDL and TP‑UD, should remain unchanged for each SM which forms part of a concatenated SM, otherwise this may lead to irrational behaviour. TP-MR must be incremented for every segment of a concatenated message as defined in clause 9.2.3.6. A SC shall handle segments of a concatenated message like any other short message. The relation between segments of a concatenated message is made only at the originator, where the message is segmented, and at the recipient, where the message is reassembled. SMS‑COMMANDs identify messages by TP-MR and therefore apply to only one segment of a concatenated message. It is up to the originating SME to issue SMS-COMMANDs for all the required segments of a concatenated message.\nThe Information‑Element‑Data octets shall be coded as follows.\nOctet 1\tConcatenated short message reference number.\nThis octet shall contain a modulo 256 counter indicating the reference number for a particular concatenated short message. This reference number shall remain constant for every short message which makes up a particular concatenated short message.\nOctet 2\tMaximum number of short messages in the concatenated short message.\nThis octet shall contain a value in the range 0 to 255 indicating the total number of short messages within the concatenated short message. The value shall start at 1 and remain constant for every short message which makes up the concatenated short message. If the value is zero then the receiving entity shall ignore the whole Information Element.\nOctet 3\tSequence number of the current short message.\nThis octet shall contain a value in the range 0 to 255 indicating the sequence number of a particular short message within the concatenated short message. The value shall start at 1 and increment by one for every short message sent within the concatenated short message. If the value is zero or the value is greater than the value in octet 2 then the receiving entity shall ignore the whole Information Element.\nThe IEI and associated IEI length and IEI data shall be present in every segment of the concatenated SM.",
      "chunk_type": "general",
      "cross_references": [
        "clause_3.9",
        "clause_9.2.3.6",
        "figure_9.2.3.24.1"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.2",
      "section_id": "9.2.3.24.2",
      "section_title": "Special SMS Message Indication",
      "content": "There are three levels of \"Message Waiting\" indication provided within the present document. The first level is to set the Protocol Identifier to \"Return Call message\", which indicates that a message is waiting and relies on the text of the message to supply the detail. The second level uses the Data Coding Scheme with or without Return Call Message (see 3GPP TS 23.038 [9]) to indicate the type of message waiting and whether there are some messages or no messages. The third level is described here, and provides the maximum detail level for analysis by the mobile, i.e. an indication of the number and type of messages waiting in systems connected to the PLMN.\nThis information shall be stored by the ME in the Message Waiting Indication Status on the SIM (see 3GPP TS 51.011 [16]) or USIM (see 3GPP TS 31.102 [30]) when present or otherwise should be stored in the ME. In case there are multiple records of EFMWIS this information shall be stored within the record according to the profile if available – or otherwise within the first record.\nThe number of messages shall be stored in Message Waiting Indication Status and an indicator should be shown if the number of messages is non‑zero or removed if the number of messages is zero. The ME may also provide some MMI to indicate and access the actual number of messages waiting. Text may be included by the SMS Service Centre for backward compatibility with the earliest Phase mobiles and the Data Coding Scheme may also be used to convey this information in parallel for backward compatibility with \"middle\" Phase mobiles (which support the use of Data Coding Scheme for Message Waiting Indication but not the use of TP‑UDH for Message Waiting Indication).\nThe information‑Element octets shall be coded as follows:\nOctet 1\tMessage Indication type and Storage.\nBit 7 Indicates whether or not the message shall be stored.\nBit 7\n0\tDiscard message after updating indication\n1\tStore message after updating indication\nIn the event of a conflict between this setting and the setting of the Data Coding Scheme (see 3GPP TS 23.038 [9]) then the message shall be stored if either the DCS indicates this, or Octet 1 above indicates this.\nBits 0 and 1 indicate the basic message indication type.\n00\tVoice Message Waiting01\tFax Message Waiting10\tElectronic Mail Message Waiting11\tExtended Message Type Waiting (equivalent to \"other\" in 3GPP TS 23.038 [9])\nBits 432 indicate the extended message indication type.\n000\tNo extended message indication type.001\tVideo Message Waiting\nOther values of bits 432 where bits 0 and 1 are '11' are Reserved for future use in the present document.\nValues of bits 432 where bits 0 and 1 are '00', '01' or '10' are Reserved for future use in the present document.\nNOTE:\tValues using bits 432 where bits 0 and 1 are '11' should be exhausted before using the remaining codespace due to existing early implementations erroneously using parts of this codespace.\nBits 6 and 5 indicate the profile ID of the Multiple Subscriber Profile (see 3GPP TS 23.097 [41]).\n00\tprofile ID 101\tprofile ID 210\tprofile ID 311\tprofile ID 4\nTerminals should be capable of receiving any values in octet 1, including those marked as Reserved.  Terminals may add the Message Count of all unknown Message Waiting Indication types received within the same TP-UDH and indicate this result to the user.\nOctet 2\tMessage Count.\nThis octet shall contain a value in the range 0 to 255 indicating the number of messages of the type specified in Octet 1 waiting. The value 255 shall be taken to mean 255 or greater. In the event of a conflict between this setting and the setting of the Data Coding Scheme (see 3GPP TS 23.038 [9]) then the Message Count in the TP‑UDH shall override the indication in the TP‑DCS.\nIf more than one type of message is required to be indicated within one SMS message, then further octets must be used, as in the following example:\n[00]\tTP‑UDL [1E] (30 decimal septets)\n[01]\tLength of TP‑UDH [08]\n[02]\tIEI = Special SMS Message Indication [01]\n[03]\tLength = 02\n[04]\tOctet 1 = Voice Mail, do not store [00]\n[05]\tOctet 2 = 04 Messages\n[06]\tIEI = Special SMS Message Indication [01]\n[07]\tLength = 02\n[08]\tOctet 1 = Fax Mail, Store [81]\n[09]\tOctet 2 = 02 Messages\n+ 5 Fill bits\n+ 19 seven‑bit character message text\nThe Total number of bits is 210.\nIn the case where this IEI is to be used in a concatenated SM then the IEI, its associated IEI length and IEI data shall be contained in the first segment of the concatenated SM. The IEI, its associated IEI length and IEI data should also be contained in every subsequent segment of the concatenated SM although this is not mandatory. However, in the case where these elements are not contained in every subsequent segment of the concatenated SM and where an out of sequence segment delivery occurs or where the first segment is not delivered then processing difficulties may arise at the receiving entity which may result in the concatenated SM being totally or partially discarded.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.038",
        "ts_51.011",
        "ts_31.102",
        "ts_23.097"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.3",
      "section_id": "9.2.3.24.3",
      "section_title": "Application Port Addressing 8 bit address",
      "content": "This facility allows short messages to be routed to one of multiple applications, using a method similar to TCP/UDP ports in a TCP/IP network. An application entity is uniquely identified by the pair of TP-DA/TP-OA and the port address. The port addressing is transparent to the transport, and also useful in Status Reports.\nThe total length of the IE is 2 octets:\noctet 1\tDestination port.\nThis octet contains a number indicating the receiving port, i.e. application, in the receiving device.\noctet 2\tOriginator port.\nThis octet contains a number indicating the sending port, i.e. application, in the sending device.\nThe port range is up to 255 using 8 bit addressing space. The Integer value of the port number is presented as in 3GPP TS 23.040 clause 9.1.2.1.\nVALUE (port number)\t\tMEANING\n0 ‑ 239\t\t\tReserved240 ‑ 255\t\t\tAvailable for allocation by applications\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) any information element where the value of the Information-Element-Data is Reserved or not supported.\nIn the case where this IE is to be used in a concatenated SM then the IEI, its associated IEI length and IEI data shall be contained in the first segment of the concatenated SM. The IEI, its associated IEI length and IEI data shall also be contained in every subsequent segment of the concatenated SM.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.040_clause_9.1.2.1",
        "ts_23.04"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.4",
      "section_id": "9.2.3.24.4",
      "section_title": "Application Port Addressing 16 bit address",
      "content": "This facility allows short messages to be routed to one of multiple applications, using a method similar to TCP/UDP ports in a TCP/IP network. An application entity is uniquely identified by the pair of TP-DA/TP-OA and the port address. The port addressing is transparent to the transport, and also useful in Status Reports.\nThe total length of the IE is 4 octets:\noctet 1,2\tDestination port.\nThese octets contain a number indicating the receiving port, i.e. application, in the receiving device.\noctet 3,4\tOriginator port.\nThese octets contain a number indicating the sending port, i.e. application, in the sending device.\nThe port range is up to 65535 using 16 bit addressing space. The Integer value of the port number is presented as in 3GPP TS 23.040 clause 9.1.2.1.\nVALUE (port number)\t\tMEANING\n0 ‑ 15999\t\t\tUDP/TCP port numbers assigned by IANA without the need to refer to 3GPP. For the procedure, use and assignment of port numbers in this range – refer to the IANA database. (http://www.IANA.com/). See Note 1.\n16000 ‑ 16999\t\tAvailable for allocation by SMS applications without the need to refer to 3GPP or IANA. See Note 2.\n17000 ‑ 49151\t\tUDP/TCP port numbers assigned by IANA. For the procedure, use and assignment of port numbers in this range – refer to the IANA database. (http://www.IANA.com/). See Note 1.\n49152\t\t\tTrigger to establish a PDN connection of non-IP PDN type using the default APN.\n49153 – 65535\t\tReserved for future allocation by 3GPP. For a port number in this range an application must be made to 3GPP.\nNOTE 1: The value used for this field by a particular application is the same value that the application would use when using a UDP or a TCP transport. Therefore, applications that register a UDP or TCP port with the IANA need to use the same registered value for this field. UDP and TCP ports are registered separately. Therefore, it is necessary to check the application since the fact that a particular TCP port is registered (e.g., for HTTP) does not mean that its corresponding UDP port will be also registered for the same application.\nNOTE 2: Port numbers in the range 16000 – 16999 are assigned by IANA for UDP and TCP transport. The range is not allocated by 3GPP and is available for any SMS application. There is a risk of port numbers in this range having conflicting applications. If it is desirable to avoid such a conflict then an application for a port number in the range 49152 – 65535 is to be made to 3GPP.\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) any information element where the value of the Information-Element-Data is Reserved or not supported.\nIn the case where this IE is to be used in a concatenated SM then the IEI, its associated IEI length and IEI data shall be contained in the first segment of the concatenated SM. The IEI, its associated IEI length and IEI data shall also be contained in every subsequent segment of the concatenated SM.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.040_clause_9.1.2.1",
        "ts_23.04"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.5",
      "section_id": "9.2.3.24.5",
      "section_title": "SMSC Control Parameters",
      "content": "The facility enables the SMS protocol headers to be expanded using a flexible method. It may be used to control the SMSC, but is also passed transparently to the receiving mobile. The Information Element must be present in every short message affected by it, i.e. in every short message in a concatenated message.\nThe Information Element data octets shall be coded as follows:\noctet 1\tSelective Status Report.\nThis facility is used to control the creation of Status Reports, depending on the error code of the particular message. It is also used by the sending entity to request inclusion of the original UDH into the Status Report. In this case the original UDH must be separated from the rest of the UDH using the Source Indicator. The TP-SRR must be set in order for the Selective Status Report to be enabled. The bits are defined as follows:\nbit 0\n0\tNo Status Report for short message transaction completed\n1\tStatus Report for short message transaction completed\nbit 1\n0\tNo Status Report for permanent error when SC is not making any more transfer attempts\n1\tStatus Report for permanent error when SC is not making any more transfer attempts\nbit 2\n0\tNo Status Report for temporary error when SC is not making any more transfer attempts\n1\tStatus Report for temporary error when SC is not making any more transfer attempts\nbit 3\n0\tNo Status Report for temporary error when SC is still trying to transfer SM\n1\tStatus Report for temporary error when SC is still trying to transfer SM\nbits 4 and 5\nreserved for future use.\nbit 6\n0\tNo activation\n1\tA Status Report generated by this Short Message, due to a permanent error or last temporary error, cancels the SRR of the rest of the Short Messages in a concatenated message. This feature can only be used where a SC is aware of the segmentation of a concatenated SM and is therefore an implementation matter.\nbit 7\n0\tDo not include original UDH into the Status Report\n1\tInclude original UDH into the Status Report",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.6",
      "section_id": "9.2.3.24.6",
      "section_title": "UDH Source Indicator",
      "content": "The facility is used to separate the UDH of the original message, a UDH created by the SMSC, and a UDH provided by the original receiving entity. The Source Indicator is placed in front of the content inserted by the source. The indicated content (one or more Information-Elements) ends at the next UDH-Source-Indicator, or at the end of the UDH. The Separator is intended to be used especially in Status Reports, but can also be used by the SMSC to add information into Short Message (for example Message waiting). The default content for a UDH in a SMS-DELIVERY is the headers inserted by the sending device, and the default content for a UDH in a SMS-STATUS-REPORT is the headers copied from the SMS-DELIVERY-REPORT.\nValues of octet:\n01\tThe following part of the UDH is created by the original sender (valid in case of Status Report)\n02\tThe following part of the UDH is created by the original receiver (valid in case of Status Report)\n03\tThe following part of the UDH is created by the SMSC (can occur in any message or report)\nIn the case where this IEI is to be used in a concatenated SM then the IEI, its associated IEI length and IEI data shall be contained in the first segment of the concatenated SM. The IEI, its associated IEI length and IEI data should also be contained in every subsequent segment of the concatenated SM although this is not mandatory. However, in the case where these elements are not contained in every subsequent segment of the concatenated SM and where an out of sequence segment delivery occurs or where the first segment is not delivered then processing difficulties may arise at the receiving entity which may result in the concatenated SM being totally or partially discarded.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.7",
      "section_id": "9.2.3.24.7",
      "section_title": "(U)SIM Toolkit Security Headers",
      "content": "There are no IEI data values associated with these IEI values and so the associated Length of Information element field is present but set to zero.\nThese IEI values implicitly define that a Security Header is always present at the start of the TP-User-Data field which immediately follows the TP-User-Data-Header. Details of the Security Header will be found in TS 31.115 [28].\nIn the case where a concatenated message contains a Security Header then the Security Header will only be present in the first segment of a concatenated message.\nIn the case where SMS compression is applied to a TP-User-Data field which contains a Security Header then the SMS compression header (3GPP TS 23.042 [26]) shall immediately precede the Security Header.",
      "chunk_type": "general",
      "cross_references": [
        "ts_31.115",
        "ts_23.042"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.8",
      "section_id": "9.2.3.24.8",
      "section_title": "Concatenated short messages, 16-bit reference number",
      "content": "This facility is an enhanced variant of the Concatenated Short Message facility (see clause 9.2.3.24.1). The enhancement is a 16-bit reference number, instead of the short 8-bit reference number. The larger reference number reduces the probability that two different concatenated messages are mistakenly sent with identical reference numbers to a receiver. Except for the size of the reference number this facility is identical to the Concatenated Short Message facility (see clause 9.2.3.24.1).\nIn the case of uncompressed 8‑bit data, the maximum length of the short message within the TP‑UD field is 133 (140‑7) octets.\nIn the case of uncompressed GSM 7 bit default alphabet data, the maximum length of the short message within the TP‑UD field is 152 (160‑8) characters. A character represented by an escape-sequence shall not be split in the middle.\nIn the case of 16 bit uncompressed USC2 data, the maximum length of the short message within the TP‑UD field is 66 ((140‑7)/2) characters. A UCS2 character shall not be split in the middle; if the length of the User Data Header is odd, the maximum length of the whole TP-UD field is 139 octets.\nIn the case of compressed GSM 7 bit default alphabet data, 8 bit data or UCS2 the maximum length of the compressed short message within the TP-UD field is 133 (140‑7) octets including the Compression Header and Compression Footer, both or either of which may be present (see clause 3.9).\nThe relation between compression and concatenation is the same as for Concatenated Short Messages (see clause 9.2.3.24.1).\nThe Information‑Element‑Data field contains information set by the application in the SMS‑SUBMIT so that the receiving entity is able to re‑assemble the short messages in the correct order. Each concatenated short message contains a reference number which together with the originating address and Service Centre address allows the receiving entity to discriminate between concatenated short messages sent from different originating SMEs and/or SCs. In a network which has multiple SCs, it is possible for different segments of a concatenated SM to be sent via different SCs and so it is recommended that the SC address should not be checked by the MS unless the application specifically requires such a check.\nThe TP elements in the SMS‑SUBMIT PDU, apart from TP‑MR, TP‑UDL and TP‑UD, should remain unchanged for each SM which forms part of a concatenated SM, otherwise this may lead to irrational behaviour. TP-MR must be incremented for every segment of a concatenated message as defined in clause 9.2.3.6. A SC shall handle segments of concatenated message like any other short message. The relation between segments of a concatenated message is made at the originator, where the message is segmented, and at the recipient, where the message is reassembled. SMS-COMMANDs identify messages by TP-MR and therefore apply to only one segment of a concatenated message. It is up to the originating SME to issue SMS-COMMANDs for all the required segments of a concatenated message.\nThe Information‑Element‑Data octets shall be coded as follows:\nOctet 1-2\tConcatenated short messages, 16-bit reference number.\nThis octet shall contain a modulo 65536 counter indicating the reference number for a particular enhanced concatenated short message. This reference number shall remain constant for every short message which makes up a particular enhanced concatenated short message.\nOctet 3\tMaximum number of short messages in the enhanced concatenated short message.\nThis octet shall contain a value in the range 0 to 255 indicating the total number of short messages within the concatenated short message. The value shall start at 1 and remain constant for every short message which makes up the enhanced concatenated short message. If the value is zero then the receiving entity shall ignore the whole Information Element.\nOctet 4\tSequence number of the current short message.\nThis octet shall contain a value in the range 0 to 255 indicating the sequence number of a particular short message within the concatenated short message. The value shall start at 1 and increment by one for every short message sent within the concatenated short message. If the value is zero or the value is greater than the value in octet 3 then the receiving entity shall ignore the whole Information Element.\nThe IEI and associated IEI length and IEI data shall be present in every segment of the concatenated SM.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24.1",
        "clause_3.9",
        "clause_9.2.3.6"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.9",
      "section_id": "9.2.3.24.9",
      "section_title": "Wireless Control Message Protocol",
      "content": "The Wireless Control Message Protocol (WCMP) is part of the WAP suite of protocols; an open standard specified by the WAP Forum Ltd.\nThe protocol specifies a set of messages that can be used by the receiver to notify the sender if an error occurs. This can be due to routing problems, no application listening at the destination port number, or due to insufficient buffer capacity. The error messages can be used by the sender to avoid retransmitting packets, that can not be properly handled at the receiver. WCMP can also be used for diagnostics and informational purposes. WCMP messages are usually generated by a datagram transport layer or a management entity.\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1-n\tProtocol Data Unit of WCMP.\nThis octet(s) shall contain a WCMP protocol data unit.\nIn the case where this IE is to be used in a concatenated SM then the IEI, its associated IEI length and IEI data shall be contained in the first segment of the concatenated SM. The IEI, its associated IEI length and IEI data shall also be contained in every subsequent segment of the concatenated SM.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.10",
      "section_id": "9.2.3.24.10",
      "section_title": "Enhanced Messaging Service",
      "content": "9.2.3.24.10.1\tEMS Coding\nEnhanced Messaging is based on standard mechanism in GSM SMS messaging. The first mechanism is called user data header (TP-UDH), which makes it possible to include binary data in a normal SM prior the text message itself (clause 9.2.3.24). The binary data is in the TP-UD field (message), which means that it steels a part of the 140 bytes.Each object within the SM shall be identified by a IE in the TP-UD Header. The IE will contain a octet (refer to clause 9.2.3.24.10.1) that identifies the absolute position of the object within and from the beginning of the SM data. In case of formatting text, an additional octet will give the number of characters for which the formatting applies. Next mechanism that is used is concatenation, see clause 9.2.3.24.1. This mechanism permits longer messages than 140 bytes, in fact 255 messages a 140 bytes each can be concatenated to one message up to about 38k bytes.\nEMS IEs of the same type may occur more than once in a single message or one segment of a concatenated SM.\n9.2.3.24.10.1.1\tText Formatting\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tStart position of the text formatting. Set to the number of characters after the formatting shall be applied from the beginning of the SM data.\nThis octet shall be coded as an integer value in the range 0 (beginning of the SM data) to the maximum number of characters included in the SM data of one single SM or one segment of a concatenated SM.\nOctet 2\tText formatting length. Gives the number of formatted characters or sets a default text formatting.\nThis octet shall be coded as an integer value in the range 1 to the maximum number of characters for which the formatting applies in one single SM or one segment of a concatenated SM.\nA text formatting length value of 0 indicates that the text format shall be used as a default text format for the current SM. The default text format shall be used for all text in a concatenated SM unless temporarily overridden by a text formatting IE with a non-zero text format length field.\nIt shall be possible to re-define the default text formatting to be applied to all subsequent text in the current SM by sending a new Text Format IE with text format length zero.\nConflicting overlapping text formatting instructions shall be resolved by applying the formatting instructions in their sequential order.\nOctet 3\tformatting mode value coded as following:\nOctet 3:\tBit 7\tBit 6\tBit 5\tBit 4\tBit 3\tBit 2\tBit 1\tBit 0\nBit 1\tBit 0\t*Alignment0\t0\tLeft0\t1\tCenter1\t0\tRight1\t1\tLanguage dependent (default)\n*in case formatting text is inserted on the same line as previous non formatting text or with a different mode value, the alignment value shall be set to the same value as the previous formatted predefined object.\nAlignment may affect object placement.\nBit 3\tBit 2\tFont Size0\t0\tNormal (default)0\t1\tLarge1\t0\tSmall1\t1\treserved\nBit 4\t\tStyle bold1\t\tBold on0\t\tBold off\nBit 5\t\tStyle Italic1\t\tItalic on0\t\tItalic off\nBit 6\t\tStyle Underlined1\t\tUnderlined on0\t\tUnderlined off\nBit 7\t\tStyle Strikethrough1\t\tStrikethrough on0\t\tStrikethrough off\nIf bit 4,5,6 and 7 are set to 0, it will mean normal style (default).\nOctet 4\tText Colour.\nThis Octet may be omitted by setting the IED length accordingly.\nBits 0..3 define the Text Foreground Colour\nBits 4..7 define the Text Background Colour\nEach colour is defined in a semi octet according to the table below. The actual colours displayed may vary between ME's depending on the display device used.\nThe colour values defined are simple primary and secondary colours plus four levels of grey. Bright colours have a higher intensity than dark colours.\nNibble Value\t\tColour\n(msb…lsb)\n0000\t\t\tBlack\n0001\t\t\tDark Grey\n0010\t\t\tDark Red\n0011\t\t\tDark Yellow\n0100\t\t\tDark Green\n0101\t\t\tDark Cyan\n0110\t\t\tDark Blue\n0111\t\t\tDark Magenta\n1000\t\t\tGrey\n1001\t\t\tWhite\n1010\t\t\tBright Red\n1011\t\t\tBright Yellow\n1100\t\t\tBright Green\n1101\t\t\tBright Cyan\n1110\t\t\tBright Blue\n1111\t\t\tBright Magenta\n9.2.3.24.10.1.2\tPredefined Sound\nThe Information‑Element‑Data octet(s) shall be coded as follows.\nOctet 1\tposition indicating in the SM data the instant after which the sound shall be played. It will be set to the number of characters from the beginning of the SM data after which the sound shall be played.\nThis octet shall be coded as an integer value in the range 0 (beginning of the SM data) to the maximum number of characters included in the SM data of one single SM or one segment of a concatenated SM.\nOctet 2\tsound number. Shall be encoded as a integer value.\n9.2.3.24.10.1.3\tUser Defined Sound\nThe Information‑Element‑Data octet(s) shall be coded as follows.\nOctet 1\tposition indicating in the SM data the instant the after which the sound shall be played (refer to clause \t9.2.3.24.10.1.2).\nOctet 2-n\tProtocol Data Unit as described in clause 9.2.3.24.10.3.1.\nThis octet(s) shall contain a User Defined Sound.\n9.2.3.24.10.1.4\tPredefined Animation\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating in the SM data the instant the animation shall be displayed. Set to the number of characters from the beginning of the SM data after which the animation shall be displayed.\nThis octet shall be coded as an integer value in the range 0 (beginning of the SM data) to the maximum number of characters included in the SM data of one single SM or one segment of a concatenated SM.\nOctet 2\tanimation number. Shall be encoded as an integer value.\n9.2.3.24.10.1.5\tLarge Animation\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating the instant the animation shall be displayed in the SM data \t(refer clause 9.2.3.24.10.1.4).\nOctet 2-n\tProtocol Data Unit as described in clause 9.2.3.24.10.3.3.\nThis octet(s) shall contain a Large Animation.\n9.2.3.24.10.1.6\tSmall Animation\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating the instant the animation shall be displayed in the SM data \t(refer clause 9.2.3.24.10.1.4).\nOctet 2-n\tProtocol Data Unit as described in clause 9.2.3.24.10.3.3.\nThis octet(s) shall contain a Small Animation.\n9.2.3.24.10.1.7\tLarge Picture\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating in the SM data the instant the picture shall be displayed. Set to the number of \tcharacters from the beginning of the SM data after which the picture shall be displayed. This octet shall be\tcoded as an integer value in the range 0 (beginning of the SM data) to the maximum number of characters\tincluded in the SM data of one single SM or one segment of a concatenated SM.\nOctet 2-n\tProtocol Data Unit as described in 9.2.3.24.10.3.2.\nThis octet(s) shall contain a Large Picture.\n9.2.3.24.10.1.8\tSmall Picture\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating in the SM data the instant the picture shall be displayed in the SM data \t(refer clause 9.2.3.24.10.1.7).\nOctet 2-n\tProtocol Data Unit as described in clause 9.2.3.24.10.3.2.\nThis octet(s) shall contain a Small Picture.\n9.2.3.24.10.1.9\tVariable Picture\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tposition indicating in the SM data the instant the picture shall be displayed in the SM data \t(refer clause 9.2.3.24.10.1.7).\nOctet 2\tHorizontal dimension of the picture.\nThis octet shall contain the horizontal number of 8 pixels i.e. this value shall be multiplied by 8 to get the whole number of horizontal pixels.\nOctet 3\tVertical dimension of the picture.\nThis octet shall contain the vertical number of pixels.\nOctet 4-n\tProtocol Data Unit as described in clause 9.2.3.24.10.3.2.\nThis octet(s) shall contain a Variable Picture line by line from top left to bottom right.\nThe values of the horizontal and vertical dimensions must be chosen properly by the sending entity. If the calculated size of this IE exceeds the limits of a single SM or segment it shall be discarded by the receiving entity.\nExamples of EMS coding\nAll IE values in the TP-UD are hexadecimal values.\n9.2.3.24.10.1.10\tUser Prompt Indicator\nWith the User Prompt Indicator a sending entity is able to indicate to the receiving entity, that the following object is intended to be handled at the time of reception, e.g. by means of user interaction. The object may be a picture, an animation, a User Defined Sound or a combination of these.\nFor example the User Prompt Indicator may be used when sending an operators logo to the ME that should be displayed instead of the operators name in standby mode.\nWhen receiving the object the user shall be prompted to accept or discard the object. After this user interaction the SM may be discarded.\nThe User Prompt Indicator IE shall immediately precede the corresponding object IE(s).\nIf a User Prompt Indicator IE is not followed by a corresponding object IE it shall be discarded.\nThe Information‑Element‑Data octet(s) shall be coded as follows:\nOctet 1\tNumber of corresponding objects.\nThis octet shall contain the number of corresponding objects as an integer value.\nWhere Octet 1 indicates that the User Prompt Indicator refers to more than one object, the ME should check the validity of the objects referenced for stitching together. The objects should be considered for stitching if they are either Images (Small, Large, Variable Pictures) or User Defined Sounds, and all of the objects referenced by the User Prompt Indicator IE are of the same type. Animations, Text formatting and pre-defined sound IE's are not suitable for stitching.\nUser defined sounds may be stitched by concatenating the data contained within each User Defined Sound IE into a single melody object, this may be achieved by ignoring the iMelody header and footer information of the second and subsequent User Defined Sound IE's referenced from the User Prompt Indicator.\nImages may be joined along their vertical edges, to form a single \"wide\" image, the resulting image will have a width equal to the sum of the widths of all the images defined in the User Prompt Indicator.\n9.2.3.24.10.1.11\tStandard WVG Object\nThe Standard WVG object as defined by IEI 18 is structured as follows:\nOctet 1\tposition indicating in the SM data the instant the object shall be displayed in the SM data\nOctet 2..n\tStandard WVG object bit stream\nThe unused bits in the last octet will be filled with 0\nThe detailed data format and attributes of Standard WVG object are defined in Annex G.\nThe bit order is defined as follows:\nThe octet with a smaller octet number stores the bits appearing in the front position in the bit stream; the most significant bit in an octet stores the first bit in position in a 8-bit segment in the bit stream.\nA Standard WVG object may or may not have fixed size. In either case, display size should be determined by the terminal implementation. Recommended display size is a largest possible size on terminal screen while aspect ratio shall be maintained.\n9.2.3.24.10.1.12\tCharacter Size WVG Object\nThe Character Size WVG object as defined by IEI 19 is structured as follows:\nOctet 1\tposition indicating in the SM data the instant the object shall be displayed in the SM data\nOctet 2..n\tCharacter Size WVG bit stream\nThe unused bits in the last octet will be filled with 0\nThe detailed data format and attributes of Character Size WVG object are defined in Annex G.\nThe bit order is defined as follows:\nThe octet with a smaller octet number stores the bits appearing in the front position in the bit stream; the most significant bit in an octet stores the first bit in position in a 8-bit segment in the bit stream.\nA Character Size WVG object is a small graphics similar to the size of a typed character. The display height for a Character Size WVG object is decided by the terminal implementation. Recommended Character Size WVG object height is to be similar to the message text font height. The width of a Character Size WVG object is variable depending on the aspect ratio defined in the object. Character Size WVG objects can appear more than one time in one message.\nExample:\nDad, I  you!\nIn the above example, the “heart” is a Character Size WVG object at the position in between the letter “I” and “y”.\nIn the above example, there are 4 Character Size WVG objects, each representing a Chinese character.\n9.2.3.24.10.1.13\tExtended Object\nThe Extended Object allows an extended code range for format types. The Extended Object may extend across segment boundaries of a concatenated short message. Octets 1 through 7 of the first Extended Object IE shall be contained in a single segment. A single segment may include one or more Extended Object IEs.\nIf multiple SMs are concatenated and at least one of them contains an Extended Object information element, then concatenation of the SMs shall be done using the 'Concatenated short messages, 16-bit reference number', verses the 'Concatenated short messages, 8-bit reference number' information element. The re-assembly of the Extended Object segments shall be done according to the sequence number of the associated Concatenation IE.\nOne or more Extended Objects may be compressed using a compression algorithm as indicated in the Compression Control IE (see clause 9.2.3.24.10.1.13).\nAn SME implementing the Extended Object IE shall be capable of interpreting an uncompressed concatenated message composed of at least min_eo_msg short messages which have been received. According to current content provider requirements and handset manufacturer constraints, variable min_eo_msg is set to 8.\nThe first Extended Object IE of an Extended Object contains a reference number, length, control data, type and position. The subsequent Extended Object IEs shall only contain Extended Object data as illustrated in Figure 9.2.24.10.11.\nThe IE length is variable.\nOctet 1\tExtended Object reference number.A modulo 256 counter indicating the reference number for the Extended Object. Two different Extended Objects in a single concatenated message shall have different reference numbers.\nOctet 2..3\tExtended Object length in number of octets (integer representation) as shown in Figure 9.2.3.24.10.1.11.\nOctet 4\tControl data. Bit 0\tObject distribution\n0\tObject may be forwarded\n1\tObject shall not be forwarded by SMS\nBit 1\tUser Prompt Indicator\n0\tObject shall be handled normally1\tObject shall be handled as a User Prompt (see 9.2.3.24.10.1.10)\nBit 2..7\treserved\nAny reserved values shall be set to 0.\nOctet 5\tExtended Object Type.This octet indicates the format of the Extended Object from the table below.If the value is reserved or if the associated format is not supported then the receiving entity shall ignore the Extend Object.\nFormat Type\nFormat Description\n0x00\nPredefined sound as defined in annex E.\n0x01\niMelody as defined in annex E.\n0x02\nBlack and white bitmap as defined in annex E.\n0x03\n2-bit greyscale bitmap as defined in annex E.\n0x04\n6-bit colour bitmap as defined in annex E.\n0x05\nPredefined animation as defined in annex E.\n0x06\nBlack and white bitmap animation as defined in annex E.\n0x07\n2-bit greyscale bitmap animation as defined in annex E.\n0x08\n6-bit colour bitmap animation as defined in annex E.\n0x09\nvCard as defined in annex E.\n0x0A\nvCalendar as defined in annex E.\n0x0B\nStandard WVG object as defined in annex E\n0x0C\nPolyphonic melody as defined in annex E.\n0x0D.. 0xFE\nReserved\n0xFF\nData Format Delivery Request as defined in annex E.\nOctet 6..7\tExtended Object Position (integer representation).The Extended Object Position indicates the absolute character position within the message text after which the object shall be played or displayed. The absolute character position relates to the entire text within the concatenated message, the first character is numbered character 1.\nNOTE:\tAlthough this is an absolute value, for concatenated messages, it is suggested the positions used are those that lie within the text of short message segments that have the sequence number equal to or higher than the one that contains the Extended Object IE.\nIf more than one Extended Object is located at the same position then they may be played or displayed in sequence or simultaneously.\nOctet 8..n\tExtended Object Data.This sequence of octets is structured as illustrated in the figure below and defined annex E.  This figure illustrates the construction of a number of SMs containing a large Extended Object which crosses a SM boundary and is encoded into 2 SM TPDUs. The figure illustrates only the User Data field of the SM (TPDUs). For a description of concatenation of SM refer to Figures 9.2.3.24 (a, b and c)\nFigure 9.2.3.24.10.1.13\n9.2.3.24.10.1.14\tReused Extended Object\nThis facility is used to reuse an Extended Object in a message which has already been defined in the same message.\nOctet 1\tReference number of the Extended Object to be reused.\nNOTE:\tThe suggested reference numbers are those of Extended Objects that are contained in short messages that have the sequence number equal to or lower than the one that contains the Reused Extended Object IE.\nOctet 2..3\tindicates in the concatenated message the absolute character position after which the object shall be played or displayed.\nNOTE:\tAlthough this is an absolute value, for concatenated messages, the suggested positions that lie within the text of short message segments that have the sequence number equal to or higher than the one that contains the Extended Object IE.\n9.2.3.24.10.1.15\tCompression Control\nThis information element is used to indicate a compressed octet sequence. The compression control is only used in association with one or more Extended Objects and/or Reused Extended Objects. The compressed data may extend across sequential short messages within a concatenated short message as illustrated by Figure 9.2.24.10.1.15. The first Compression Control IE of a compressed data sequence contains one octet of Compression Information and a 2-octet length field.\nThe SME shall support decompression if the Extended Object IE is implemented. An SME implementing the Extending Object IE shall be capable of decompressing a received stream for which the original uncompressed information fits into 1 to min_eo_msg messages. An SME may be capable of decompressing a received stream for which the original uncompressed information fits into more than min_eo_msg short messages. Variable min_eo_msg is defined in clause 9.2.3.24.10.1.11.\nThe IE length is variable.\nOctet 1\tCompression information.\nBits 0..3 represent the compression algorithm and bits 4..7 represent compression algorithm specific parameters.\nBit 0..3\tCompression algorithm\n0000\t\tLZSS Compression according to clause 9.2.3.24.10.1.15.1\nBit 4..7\tShall be set 0.\n0001..1111\treserved for future use; reserved bits shall be transmitted 0.\nBit 4..7\treserved\nOctets 2..3\tLength of the compressed data in octets (integer representation).The length indicates the length of the compressed data that may extend across several compression control IEs.\nOctets 4..n\tCompressed data may contain one or more compressed Extended Objects. Figure 9.2.3.24.10.1.15 is an example and illustrates the assembly of a series of SM TPDUs from a sequence of concatenated and compressed extended objects. Each Extended Object is preceded by its IEI (Extended Object or Reused Extended Object). A series of Extended Objects is then compressed into a single buffer and this is split into several SM TPDUs as illustrated.\n*E.O Means Extended Object.\n*R.E.O means Reused Extended Object.\nC.C. means compression.\nFigure 9.2.3.24.10.1.15\n9.2.3.24.10.1.15.1\tLZSS Implementation for EMS extended object compression\nLZSS compression uses two tokens to identify either literal strings (byte-sequences) or references to repeated sequences. These tokens (for EMS extended-object compression) are described in this clause of the document. A more general introduction to LZSS compression together with an informative example (based upon the tokens described below) is provided in Annex F (informative).\nThe compressed data stream consists of any combination of literal data blocks and slice descriptor sequences.\nThe format of the compressed data stream is illustrated as follows: -\nCompressed data stream (initial section) …..\n1\n2\n3\n4\n5\n.\n.\n.\n.\n.\n.\n.\n.\n.\nLiteral data block\nSlice descriptor\nLiteral data block\nSlice descriptor\nSlice descriptor\nFigure 9.2.3.24.10.1.15.1.a\tLZSS compressed data format\nThis diagram represents the structure of a compressed byte stream using LZSS. The stream contains a mixture of literal octets from the input buffer and slice descriptors representing the re-occurrence of an octet sequence together with a length and index for the matching octet sequence. The initial octets of a compressed buffer will always be a sequence of literal octets. The structures of the literal data blocks and slice descriptors are given below.\nBit 7\nBit 6\nBit 5\nBit 4\nBit 3\nBit 2\nBit 1\nBit 0\n1\nNumber literal bytes to follow.\nFigure 9.2.3.24.10.1.15.1.b\tLiteral block identifier\nWhen literal octets are written into the compression buffer (for instance during the initial phases of compression) they are preceded by a literal block identifier. The most significant bit (bit 7) of this block shall be set 1. Bits 6-0 indicate the length of the literal block which follows (up to 127 octets).  If no match can be found in an octet sequence of greater that 127 octets then 2 (or more) literal blocks shall be written sequentially.\nOctet 1\nOctet 2\nBit 15\nBit 14\nBit 13\nBit 12\nBit 11\nBit 10\nBit 9\nBit 8\nBit 7\nBit 6\nBit 5\nBit 4\nBit 3\nBit 2\nBit 1\nBit 0\n0\nSlice Length\nSlice Offset\nFigure 9.2.3.24.10.1.15.1.c\tSlice Descriptor\nAs can be seen from the above table, the slice descriptor sequence length is two octets, hence only repeating slices of data longer than two octets are extracted. The “slice length” is contained in the descriptor high octet and describes a data slice length of up to 63 octets. The “slice offset index” to the start of the slice is contained in the lower 9 bits and limits the window to 511 octets. The “slice offset index” gives the start position of the source slice measured backwards from the current writing position in the output decoded message data buffer, expressed as a positive number.\n9.2.3.24.10.1.15.2\tData Compression\nThe compressed data output stream is constructed by repeating the following process until the end of the input data buffer is reached.\nThe input data buffer is scanned, from the current reading position (minus 1) through to a position 511 bytes back from current reading position (the window) looking for the maximum (but limited to 63 octets) length matching data slice contained that matches the data starting at the current reading position (the look ahead buffer).\nIf no matching data slice, longer than two octets, is found then the input data octet at the current reading position is written to a literal buffer. Both the current reading position in the input data buffer and the current writing position in the output data buffer are incremented by one.\nIf a matching slice is found then a slice descriptor is written to the output data buffer at the current writing position in the output data buffer and the current writing position is incremented by two. The current reading position in the input data buffer is incremented by the length of the newly found matching data slice.\nIf the next read octet results in a matching slice being found then the literal buffer is written out. The literal block header, containing a count of the number of literals in the block, is written out first. (If more than 127 literal octets exist in the literal buffer, then it is split into multiple blocks).\nThe above sequence is repeated until the current reading position reaches the end of the input data buffer.\nWhen encoding (compressing), it is the input data buffer, up to the current reading position, that is used to search for already known matching data slices, as this represents, and is equal to, the reconstructed output data buffer of the decoder at the receiving end.\n9.2.3.24.10.1.15.3\tData De-compression\nThe following sequence is repeated until the end of the input data buffer.\nThe data octet at the current reading position in the input data buffer is tested for either 0 or 1 in bit 7.\nIf the bit is set (bit 7 = 1), then the number of literal octets that follow is determined from the lower 7 bits of the header octet (this one).\nThe literal octet block is written to the output data buffer at the current writing position and both the output data writing position and the input data reading position pointers are incremented by the block size.\nIf the bit is clear (bit 7 = 0), then the “slice length” and “slice offset index” are extracted from the two octet slice descriptor.\nThe data slice is copied from within the output data buffer to the end of the output data buffer, where the start of the source slice is at a position “slice offset index” back from the current output data writing position and the destination start position of the slice is the current output buffer writing position. The input data buffer reading position is incremented by two and the output data writing position is incremented by the “slice length”.\n9.2.3.24.10.1.15.4\tTest Vectors\nIn order to assist implementers of the compression algorithm described in this specification, a suite of test vectors and 'help' information are available in electronic format. The test vectors are supplied with this specification.\nThese test vectors provide checks for most of the commonly expected parameter value variants in this specification and may be updated as the need arises.\nIn addition Annex F contains an introduction to LZ-type compression algorithms and also has a brief informative example.\n9.2.3.24.10.1.16\tObject Distribution Indicator\nThis facility allows a level of control to be requested over the distribution of objects contained within selected information elements in short messages.\nIf no Object Distribution Indicator is specified for an information element in which an object is received, then that object may be freely distributed.\nIf a MS provides facilities to modify an object, then the Distribution Attributes (see below) shall be maintained; i.e. an object that is not allowed to be distributed cannot become so after modification.\nThe use of the Object Distribution Indicator in conjunction with a TE is beyond the scope of the present document.\nWhere the Object Distribution Indicator is applied to object IE's that are also addressed by an IE which affects or controls them in some other way (such as User Prompt Indicator IE (see clause 9.2.3.24.10.1.10)), then it shall precede all of the IE's including the other controlling IE's.\nOctet 1\tNumber of Information Elements.\nThis octet specifies the number of information elements from 1-255 for which the Distribution Attributes in the next octet shall apply. The affected objects shall be contained in Information Elements immediately following this IE and may be contained in subsequent short message segments within a concatenated short message.\nIf the Object Distribution Indicator is applied to the same object IE's as addressed by an IE which affects or controls them in some other way (such as the User Prompt Indicator IE), then value of this field shall reflect the total number of all the object IE's and all of the controlling IE's.\nIf set to 0 the Distribution Attributes shall apply to all information elements until either the end of the message or another Object Distribution Indicator IE is received.\nOctet 2\tDistribution Attributes.\nBit 0\n0\tthe associated object(s) may be forwarded\n1\tthe associated object(s) shall not be forwarded by SMS\nbit 1..7\nreserved for future use.\n9.2.3.24.10.1.17\tReply Address Element\nOnly one alternate Reply Address Element can be integrated in a message. In the case the Reply Address Element is part of a Concatenated SM this IE shall occur in its first segment only.\nOctet 1..n\tAlternate Reply Address encoded as specified for address fields in clause 9.1.2.5\nWhen this IE is received in a message, replies to this message should take place by default using the address specified in this IE instead of the regular message TP-OA.\nNOTE:\tDespite the fact that MMI aspects of the ME are out of the scope of the present document, it must be mentioned that this mechanism might open the door to potential abuse. It is desirable that the user is made aware in some way that the reply address of the incoming message is different from the originator's one, and that the user is presented with the original TP-OA address to identify the sender of the SM .\n9.2.3.24.10.1.18\tExtended Object Data Request Command\nThere is no data element associated with this IE. The associated Information Element Length field is present but set to zero.\nUpon receiving this IE in an SMS-DELIVER PDU, if an MS supports this request and the corresponding response, it shall respond with an SMS-DELIVER-REPORT PDU containing a Data Format Delivery Request as defined in the Extended Object IE. This SMS-DELIVER PDU may be discarded.\n9.2.3.24.10.2.1\tExample of Basic text formatting and predefined EMS coding\nAn example of the basic concept of coding is given as follows:\nTP-UDHI=1\nSMS User Data Header: UDHL=05, IEI=0A, IEDL=03, IED1=0F, IED2=12, IED3=10\nSMS User Data: This is a text with bold option on following with normal text.\nShould be displayed as:\nThis is a text with bold option on following with normal text.\nIt is also possible to add predefined sounds in the message.\nExample:\nTP-UDHI=1\nSMS User Data Header: UDHL=08, IEI=0B, IEDL=02, IED1=09,<sound5>, IEI=0B, IEDL=2, IED1=1C,                        <sound7>\nSMS User Data: This is a message with two different sounds.\nThe sound nr5 shall be played after the 9th received character (\"a\") and sound nr7 shall be played after the 28th received character (\"e\").\n9.2.3.24.10.2.2\tExample of User defined Objects EMS coding\nExample of a message including one small picture is coded as follows:\nTP UDHI=1\nSMS User Data Header: UDHL=24, IEI=11, IEIDL=22, IED1=08, <  (small picture 32bytes)>\nSMS User Data: Hello!<CR><LF><CR><LF>One small picture in here\nShould be displayed as:\nHello!\nOne small picture in here\nIf the message starts with <CR>, then the \"unreadable\" data in an old terminal will be overwritten by the text, and the user will not see any strange characters. It is possible to insert the same picture several times in the same message. In that case, the TP-UD header shall contain as many IE as the number of occurrences contained in the SM or one segment of a concatenated message. Using defined elements will normally imply that more than one SM is required and therefore concatenation is required.\n9.2.3.24.10.2.3\tConcatenation of SMS messages\nConcatenated messages are required in most cases required when using several types of EMS elements, since it is only possible to send one large picture/large animation/melody in one single SM. After including either of these elements, there are only 4 (or 9 if no concatenation is used) characters left to the text part, and this is usually too little.\nIf one or more objects are embedded in one segment of a concatenated message, the IE octet indicating its/their position within the SM data cannot be set to a value that would refer to a position in the next segment(s) so that received segments should be processed before all of them have been received. It means that a formatting text that could not be conveyed in one segment shall be split in as many segments as necessary. In that case, the IE relating to the formatting shall be repeated in all the segments in which it will apply.\nExample of a message including 2 Large Pictures, 4 Small animations and 2 User defined Melodies together with some text.\nThe EMS message: <Large Picture1> <User Defined Melody 1> Hello All, This is a real Enhanced Message <Small Animation 1>. I can send <Small Animation 2> and receive <Small Animation 3> really advanced EMS messages <Animation 4> Isn't it impressive? /Lars <User Defined Melody2> <Large Picture 2>\nThis EMS message has to use concatenated messages and the SM will typically contain the following data:\nSM\nUser Data Header\nUser Data\n1\nIEI=10 (Large Picture)IED1=00 (beginning of the SM)  <Large Picture 1 (128 bytes)>\n[<CR><LF>]\n2\nIEI=0C (User Defined Sound)IED1=00 (beginning of the SM)  <User Melody 1 (129bytes max)>\nHello\n3\nIEI=0F (Small Animation)IED1=24 (36th position) <Small Animation 1 (32 bytes)>\nIEI=0F (Small Animation)IED1=2F (47th position) <Small Animation 2 (32 bytes)>\nAll, This is a real Enhanced Message. I can send and\n4\nIEI=0F (Small Animation)IED1=07 (7th position) <Small Animation 3 (32 bytes)>\nIEI=0F (Small Animation)IED1=25 (37th position)  <Small Animation 4 (32 bytes)>\nreceive really advanced EMS messages. Isn't it impressive? /Lars.\n5\nIEI=0C (User Defined Sound)IED1=00 (beginning of the SM)  <User Melody 1 (128 bytes max)>\n[<CR><LF>]\n6\nIEI=10 (Large Picture)IED1=00 (beginning of the SM) <Large Picture 2 (128 bytes)>\n9.2.3.24.10.3\tEMS Formats\n9.2.3.24.10.3.1\tSounds\nPredefined Sounds\nThere are a number of fixed predefined sounds. Each sound nr corresponds to a specific sound according to the table below. The presentations of these sounds are manufacturer specific.\nSound nr\nDescription\n0\nChimes high\n1\nChimes low\n2\nDing\n3\nTaDa\n4\nNotify\n5\nDrum\n6\nClaps\n7\nFanFar\n8\nChord high\n9\nChord low\nUser defined sounds\nThe user defined sounds are coded according to the iMelody format[33]. The maximum length of a sound is 128 bytes.\n9.2.3.24.10.3.2\tPictures\nPictures are coded from upper left to lower right and in each byte the most significant bit represent the pixel at the left. The pictures are plain black and white, no colours or grey scales are supported. The bitvalue \"0\" represents a white pixel and the bitvalue \"1\" represents a black pixel.\nExample 16*16 picture\nByte 1\nByte 2\nByte 3\nByte 4\n…\n…\n…\n…\nByte 31\nByte 32\n9.2.3.24.10.3.3\tAnimation\nPredefined\nThere are a number of predefined animations. Each animation nr corresponds to a specific animation according to the table below. The way of displaying the animation is manufacturer specific.\nAnimation nr\nDescription\n0\nI am ironic, flirty\n1\nI am glad\n2\nI am sceptic\n3\nI am sad\n4\nWOW!\n5\nI am crying\n6\nI am winking\n7\nI am laughing\n8\nI am indifferent\n9\nIn love/Kissing\n10\nI am confused\n11\nTongue hanging out\n12\nI am angry\n13\nWearing glasses\n14\nDevil\nUser Defined\nAnimations are coded as 4 sequential pictures, with the first picture sent first.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24",
        "clause_9.2.3.24.10.1",
        "clause_9.2.3.24.1",
        "clause_9.2.3.24.10.1.2",
        "clause_9.2.3.24.10.3.1",
        "clause_9.2.3.24.10.1.4",
        "clause_9.2.3.24.10.3.3",
        "clause_9.2.3.24.10.1.7",
        "clause_9.2.3.24.10.3.2",
        "clause_9.2.3.24.10.1.13",
        "clause_9.2.3.24.10.1.11",
        "clause_9.2.3.24.10.1.15.1",
        "clause_9.2.3.24.10.1.10",
        "clause_9.1.2.5",
        "figure_9.2.24.10.11",
        "figure_9.2.3.24.10.1.11",
        "figure_9.2.3.24.10.1.13",
        "figure_9.2.24.10.1.15",
        "figure_9.2.3.24.10.1.15",
        "figure_9.2.3.24.10.1.15.1",
        "ts_9.2"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.11",
      "section_id": "9.2.3.24.11",
      "section_title": "IETF RFC 5322 E-Mail Header",
      "content": "This information element is used to indicate the existence of an IETF RFC 5322 Internet electronic mail in the data part of the short message. Both, E-Mail Header and (optional) E-Mail Body shall be parts of the SM's data and shall be compliant with the syntax specified in IETF RFC 5322 [34]. The character set used for encoding of E-Mail Header and E-Mail body, however, shall be according to 3GPP TS 23.038 [9]. Encoding of E-Mail Header and E-Mail Body shall be done using the same character set.\nIn compliance with IETF RFC 5322 [34] the E-Mail Header shall always be located at the very beginning of the SM's data part. It shall always be present in the \"unfolded\" format as it is specified in IETF RFC 5322 [34]. Not the <CRLF> character defined in IETF RFC 5322 [34] but the <LF> character according to 3GPP TS 23.038 [9] shall be used for the separation of different E-Mail Header fields.\nIf an RFC 5322 E-Mail Body exists, it shall immediately follow the E-Mail Header in the SM's data part.\nNOTE 1:\tThe null line defined in IETF RFC 5322 [34] for the separation of E-Mail Header and E-Mail Body may be discarded.\nNOTE 2:\tThe sending of extended SMTP headers is allowed and the MS should not reject the message if there are header fields in the email header part that are not specified in IETF RFC 5322 [34].\nIn case of an IETF RFC 5322 [34] E-Mail Header exceeding the data part of a single SM, concatenation shall be used. In this case the E-Mail Header starts in the first segment of a concatenated SM and continues in one or several subsequent segments. The IETF RFC 5322 [34] E-Mail Body shall immediately follow the final fraction of the IETF RFC 5322 [34] E-Mail Header and may also be spread over several segments of the concatenated SM.\nIn case where this IEI is to be used in a concatenated SM then the IEI, its associated IEDL, and IED fields shall be contained in the first segment of the concatenated SM and shall also be contained in every subsequent segment of the concatenated SM.\nThe Information‑Element‑Data octet shall be coded as follows:\nOctet 1\tIETF RFC 5322[34] E-Mail Header length indicator.\nThis octet shall indicate the length of the IETF RFC 5322 [34] E-Mail Header that is located at the beginning of the data part of the SM. In case of an E-Mail Header exceeding the data part of a single SM, this octet shall indicate the length of that fraction of the IETF RFC 5322 [34] E-Mail Header that is located at the beginning of the data part of the current segment of the concatenated SM.\nIf the user data is coded using the GSM 7 bit default alphabet, this IED octet shall give an integer representation of the number of septets within (that fraction of) the IETF RFC 5322 [34] E-Mail Header that is located at the beginning of the data part of the current (segment of the concatenated) SM. See figure 9.2.3.24.11 (a).\nIf the user data is coded using 8‑bit data, this IED octet shall give an integer representation of the number of octets within (that fraction of) the IETF RFC 5322 E-Mail Header that is located at the beginning of the data part of the current (segment of the concatenated) SM. See figure 9.2.3.24.11 (b).\nIf the user data is coded using UCS2 [24] data, this IED octet shall give an integer representation of the number of UCS2 characters (consisting of 2 octets) within (that fraction of) the RFC 822 E-Mail Header that is located at the beginning of the data part of the current (segment of the concatenated) SM. See figure 9.2.3.24.11 (c).\nNOTE 3:\tIf the user data is coded using compressed GSM 7 bit default alphabet or compressed 8 bit data or compressed UCS2 [24] data the RFC 822 E-Mail Header length indicator's value shall be based on the amount of uncompressed data, i.e. before compression is performed.\nThe diagram below shows the layout of the IED for GSM 7 bit default alphabet data.\nFigure 9.2.3.24.11 (a)\nThe diagram below shows the layout of the IED for 8 bit data.\nFigure 9.2.3.24.11 (b)\nThe diagram below shows the layout of the IED for UCS2 data.\nFigure 9.2.3.24.11 (c)",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_9.2.3.24.11",
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.12",
      "section_id": "9.2.3.24.12",
      "section_title": "Hyperlink format element",
      "content": "A hyperlink format element shall be structured as follows:\nOctet 1 and 2\tAbsolute Element Position (integer representation).\nThe Absolute Element Position indicates the absolute character position within the message text. The absolute character position relates to the entire text within the concatenated message, the first character is numbered character 1.\nOctet 3\tHyperlink Title length: an integer representation of the number of characters in the hyperlink title.\nOctet 4\tURL length: an integer representation of the number of characters in the URL.\nA space character shall be inserted between the hyperlink title and the URL. The hyperlink title can be a mixture of text, animations and pictures. Elements (text, animations and pictures) for which the position is included in the range [Absolute hyperlink position…Absolute hyperlink position+hyperlink title length] are part of the hyperlink title. The string of text in the range [Absolute hyperlink position+hyperlink title length+1…Absolute hyperlink position+hyperlink title length+1+URL length] is to be interpreted as a URL.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.13",
      "section_id": "9.2.3.24.13",
      "section_title": "Enhanced Voice Mail Information",
      "content": "Enhanced Voice Mail Information allows a Voice Mail system to convey to a mobile subscriber, comprehensive information regarding individual voice mail messages and mailbox status.\nEnhanced Voice Mail Information has two types of Information Element Data\n-\tEnhanced Voice Mail Notification which conveys to the MS information regarding newly deposited Voice Mail messages and Voice Mailbox Status\n-\tEnhanced Voice Mail Delete Confirmation which allows an MS to maintain Voice mailbox status information synchronisation between the MS and the Voice Mailbox in the event of Voice Mail Message deletion.\nThe first 'bit' of the Enhanced Voice Mail Information Element Data is known as Enhanced Voice Mail PDU Type and  discriminates between  whether the Enhanced Voice Mail Information PDU is an Enhanced Voice Mail Notification or an Enhanced Voice Mail Delete Confirmation.\n9.2.3.24.13.1\tEnhanced Voice Mail Notification\nThe Enhanced Voice Mail Notification Information Element Data has the following format where the parameters are in strict order following the IEDL. The Enhanced Voice Mail Notification IEI and its associated IEDL and  IED shall be complete within a single UDH.\nIn the event of a contradiction between Enhanced Voice Mail Notification and either the DCS (23.038) [9] indicating Voicemail Message Waiting or the Special SMS Message Indication  (9.2.3.24.2) indicating Voice Message Waiting or both then the Enhanced Voice Mail Notification specified here shall take precedence.\nParameter\nParameter Length\nMandatory/Optional/Conditional\nENHANCED_VOICE_MAIL_PDU_TYPE\nBit 0 Octet 1\nM\nRESERVED_FOR_FUTURE_USE\nBit 1 Octet 1\nM\nMULTIPLE_SUBSCRIBER_PROFILE\nBits 2..3 Octet 1\nM\nSM_STORAGE\nBit 4 Octet 1\nM\nVM_MAILBOX_ALMOST_FULL\nBit 5 Octet 1\nM\nVM_MAILBOX_FULL\nBit 6 Octet 1\nM\nVM_MAILBOX_STATUS_EXTENSION_INDICATOR\nBit 7 Octet 1\nM\nVM_MAILBOX_ACCESS_ADDRESS\nOctets 2… n+2 (NOTE 2)\nM\nNUMBER_OF_VOICE_MESSAGES\nBits 0..7  Octet n+3\nM\nNUMBER_OF_VM_NOTIFICATIONS\nBits 0..4 Octet n+4\nM\nRESERVED_FOR_FUTURE_USE\nBits 5..7 Octet n+4\nM\nVM_MAILBOX_STATUS_EXTENSION_LENGTH\n1 Octet (NOTE 3)\nC\nVM_MAILBOX_STATUS_EXTENSION_DATA\n1 or more Octets (NOTE 3)\nC\nVM_MESSAGE_ID (NOTE 1)\nBits 0..15 Octets n+5..n+6\nM\nVM_ MESSAGE_LENGTH (NOTE 1)\nBits 0..7 Octet n+7\nM\nVM_ MESSAGE_RETENTION_DAYS (NOTE 1)\nBits 0..4 Octet n+8\nM\nRESERVED_FOR_FUTURE_USE (NOTE 1)\nBit 5  Octet n+8\nM\nVM_MESSAGE_PRIORITY_INDICATION (NOTE 1)\nBit 6 Octet n+8\nM\nOCTET_VM_MESSAGE_EXTENSION_INDICATOR (NOTE 1)\nBit  7 Ocet n+8\nM\nVM_MESSAGE_CALLING_LINE_IDENTITY (NOTE 1)\nOctets n+9.. n+9+m (NOTE 2)\nM\nVM_MESSAGE_EXTENSION_LENGTH (NOTE 1)\n1 Octet (NOTE 3)\nC\nVM_MESSAGE_EXTENSION_DATA (NOTE 1)\n1 or more Octets (NOTE 3)\nC\nNOTE 1:\tThis sequence of parameters are repeated a number of times according to the number of Voice Mail notifications conveyed in this  IE.\nNOTE 2:\t'n' and 'm' denote the number of octets required for the VM_MAILBOX_ACCESS_ADDRESS and the VM_CALLING_LINE_IDENTITY as appropriate including the Address-Length, Type-of-address and Address-value (see 9.1.2.5).\nNOTE 3:\tThe Conditional Octets are excluded from the Octet count in the table in this release because no extensions are defined in this release.\nENHANCED_VOICE_MAIL_PDU_TYPE\tThis parameter shall be set to 0 to specify that the following Information Element Data Parameters is an Enhanced Voice Mail Notification.\nRESERVED_FOR_FUTURE_USE\tThis parameter is set to 0 and is reserved for future use.\nMULTIPLE_SUBSCRIBER_PROFILE\tThis parameter shall indicate the Multiple Subscriber Profile (see 3GPP TS 23.097 [41]):\n00\tprofile ID 1\n10\tprofile ID 2\n01\tprofile ID 3\n11\tprofile ID 4\nSM_STORAGE\tThis parameter shall be set to 0 to indicate that this SM shall be discarded after evaluating its contents; otherwise it shall be set to a 1 to indicate to the MS that this SM shall be stored in the ME or the USIM.\nVM_MAILBOX_ALMOST_FULL\tThis parameter shall be set to 1 if the Voice Mailbox in the Voice Mail system is almost full; otherwise this field shall be set to 0.  The point at which the voice mailbox is considered almost full is Voice Mail System specific.\nVM_MAILBOX_FULL\tThis parameter shall be set to 1 if the Voice Mailbox in the Voice Mail system is full; otherwise this field shall be set to 0.\nVM_MAILBOX_STATUS_EXTENSION_INDICATOR In this release, this parameter shall be set to 0. This parameter shall be set to 1 to indicate that  a VM_MAILBOX_STATUS_EXTENSION_LENGTH parameter is present in this PDU.\nVM_MAILBOX_ACCESS_ADDRESS\tThis parameter shall contain the Voice Mailbox number. It shall be coded according to section 9.1.2.5. In case of contradiction between this parameter and the Mailbox Dialing Numbers stored on (U)SIM this parameter shall take precedence and the MS may try to update EFMBDN on (U)SIM.\nNUMBER_OF_VOICE_MESSAGES\tThis octet shall contain a value in the range 0 to 255 indicating the current number of Voice Mail messages that are unread. The value 255 shall be taken to mean 255 or greater. The NUMBER_OF_VOICE_MESSAGES shall be stored on the (U)SIM in accordance with the procedure for storage of Message Waiting Indication Status described in Special SMS Message Indication (9.2.3.24.2).\nNUMBER_OF_VM_NOTIFICATIONS\tThis parameter has a range 0 to 15. This parameter shall indicate the number of specific Voice Message notifications to follow within this IE.\nRESERVED_FOR_FUTURE_USE\tThis parameter shall be set to 0 and is reserved for future use.\nVM_MAILBOX_STATUS_EXTENSION_LENGTH This parameter shall be set to the number of additional octets that immediately follow. This parameter has a value in the range 0 to 255.  The presence of this parameter is conditional on the setting of VM_MAILBOX_STATUS_EXTENSION_INDICATOR in this PDU.\nVM_MAILBOX_STATUS_EXTENSION_DATA This parameter comprises a number of additional octets allowing additional VM mailbox generic status parameters to be conveyed in this PDU. Additional octets are not defined in this release but may be defined later by 3GPP. This parameter is conditional on the presence of VM_MAILBOX_EXTENSION_LENGTH\nVM_MESSAGE_ID\tThis parameter shall be set to the message ID of the Voice Mail message in this specific Voice Message notification. This parameter is binary and has a range 0 to 65535, modulus 65536.  It is the responsibility of the Voice Mail system to set this parameter to uniquely identify a Voice Mail message within the modulus.\nVM_ MESSAGE_LENGTH\tThis parameter shall be set to the length of the Voice Mail message in this notification in seconds. This parameter has a range 0 to 255. For voice mail messages that are longer than 255 seconds, this parameter shall be set to its maximum 255.\nVM_ MESSAGE_RETENTION_DAYS\tThis parameter shall be set to the number of days after which the specific Voice Mail message in this notification is anticipated to be automatically deleted from the Voice Mail system timed from the GSM Timestamp (TP-SCTS 9.2.3.11) for this Enhanced Voice Mail Notification. This parameter has a range 0 to 31. For Voice Mail messages that have a longer retention time than 31 days, this parameter shall be set to its maximum 31.\nNOTE:\tThe GSM Timestamp is the time that the SC received the SM from the Voice Mail system which is not necessarily the time that the voice message was deposited into the Voice Mail system.\nRESERVED_FOR_FUTURE_USE\tThis parameter is set to 0 and is reserved for future use.\nVM_ MESSAGE_PRIORITY_INDICATION\tThis parameter shall be set to 1 to indicate that the specific Voice Mail message in this notification held in the Voice Mailbox is urgent; otherwise the parameter shall be set to 0.\nVM_MESSAGE_EXTENSION_INDICATOR\tIn this release, this parameter shall be set to 0.  This parameter shall be set to a 1 to indicate that a VM_MESSAGE_EXTENSION_LENGTH parameter is present in this PDU.\nVM_MESSAGE_CALLING_LINE_IDENTITY\tThis parameter shall contain the address to be used by the mobile subscriber to contact the originator of the specific Voice Mail message in this notification. Where the CLI is not available then the coding of this parameter shall indicate that there is no address. i.e The length indicator in this parameter shall be set to 0.\nThis parameter coding shall comply with the the SM-TL address format specified in 9.1.2.5 above.\nVM_MESSAGE_EXTENSION_LENGTH\tThis parameter shall be set to the number of additional octets that immediately follow. This parameter has a value in the range 0 to 255. The presence of this parameter is conditional on the setting of  VM_MESSAGE_EXTENSION_INDICATOR in this PDU.\nVM_MESSAGE_EXTENSION_DATA\tThis parameter comprises a number of additional octets allowing additional voicemail message specific parameters to be conveyed in this PDU. Additional octets are not defined in this release but may be defined later by 3GPP. This parameter is conditional on the presence of VM_MESSAGE_EXTENSION_LENGTH.\n9.2.3.24.13.2\tEnhanced Voice Mail Delete Confirmation\nThe Enhanced Voice Mail Delete Confirmation Information Element Data contains synchronization information. A Voice Mail system may send an Enhanced Voice Mail Delete Confirmation in order to indicate to the ME that certain voice mail messages that have been deleted and to indicate the updated status of the Voice Mailbox.\nThe Enhanced Voice Mail Delete Confirmation Information Element Data has the following format where the parameters are in strict order following the IEDL. The Enhanced Voice Mail Delete Confirmation IEI and its associated IEDL and  IED shall be complete within a single UDH.\nParameter\nParameter Length\nMandatory/Conditional/Optional\nENHANCED_VOICE_MAIL_PDU_TYPE\nBit 0 Octet 1\nM\nRESERVED_FOR_FUTURE_USE\nBit 1 Octet 1\nM\nMULTIPLE_SUBSCRIBER_PROFILE\nBits 3..2 Octet 1\nM\nSM_STORAGE\nBit 4 Octet 1\nM\nVM_MAILBOX_ALMOST_FULL\nBit 5 Octet 1\nM\nVM_MAILBOX_FULL\nBit 6 Octet 1\nM\nVM_MAILBOX_STATUS_EXTENSION_INDICATOR\nBit 7 Octet 1\nM\nVM_MAILBOX_ACCESS_ADDRESS\nOctets 2..n+2 (NOTE 2)\nM\nNUMBER_OF_VOICE_MESSAGES\nBits 0..7 Octet n+3\nM\nNUMBER_OF_VM_DELETES\nBits 0..4 Octet n+4\nM\nRESERVED_FOR_FUTURE_USE\nBits 5..7 Octet n+4\nM\nVM_MAILBOX_STATUS_EXTENSION_LENGTH\n1 Octet (NOTE 3)\nC\nVM_MAILBOX_STATUS_EXTENSION_DATA\n1 or more Octets (NOTE 3)\nC\nVM_MESSAGE_ID (NOTE 1)\nOctets n+5..n+6\nM\nRESERVED_FOR_FUTURE_USE (NOTE 1)\nBits 0..6 Octet n+7\nM\nVM_MESSAGE_EXTENSION_INDICATOR (NOTE 1)\nBit 7 Octet n+7\nM\nVM_MESSAGE_EXTENSION_LENGTH (NOTE 1)\n1 Octet (NOTE 3)\nC\nVM_MESSAGE_EXTENSION_DATA (NOTE 1)\n1 or more Octets (NOTE 3)\nC\nNOTE 1:\tThis sequence of parameters are repeated a number of times according to the number of Voice Mail Delete Confirmations conveyed in this IE.\nNOTE 2:\t'n' denotes the number of octets required for the VM_MAILBOX_ACCESS_ADDRESS including the Address-Length, Type-of-address and Address-value (see 9.1.2.5).\nNOTE 3:\tThe Conditional Octets are excluded from the Octet count in the table in this release because no extensions are defined in this release.\nENHANCED_VOICE_MAIL_PDU_TYPE\tThis parameter shall be set to 1 to specify that the following Information Element Data  is an Enhanced Voice Mail Delete Confirmation.\nRESERVED_FOR_FUTURE_USE\tThis parameter is set to 0 and is reserved for future use.\nMULTIPLE_SUBSCRIBER_PROFILE\tSee clause 9.2.3.24.13.1\nSM_STORAGE\tSee clause 9.2.3.24.13.1\nVM_MAILBOX_ALMOST_FULL\tSee clause 9.2.3.24.13.1\nVM_MAILBOX_FULL\tSee clause 9.2.3.24.13.1\nVM_MAILBOX_STATUS_EXTENSION_INDICATOR\tIn this release, this parameter shall be set to 0. This parameter shall be set to 1 to indicate that a VM_MAILBOX_STATUS_EXTENSION_LENGTH parameter is present in this PDU.\nVM_MAILBOX_ACCESS_ADDRESS\tSee clause 9.2.3.24.13.1\nNUMBER_OF_VOICE_MESSAGES\tSee clause 9.2.3.24.13.1\nNUMBER_OF_VM_DELETES\tThis parameter has a range 0 to 63. This parameter shall indicate the number of VM_MESSAGE_ID's that follow in this IE\nRESERVED_FOR_FUTURE_USE\tThis parameter is set to 0 and is reserved for future use.\nVM_MAILBOX_STATUS_EXTENSION_LENGTH This parameter shall be set to the number of additional octets that immediately follow. This parameter has a value in the range 0 to 255.  The presence of this parameter is conditional on the setting of VM_MAILBOX_STATUS_EXTENSION_INDICATOR in this PDU.\nVM_MAILBOX_STATUS_EXTENSION_DATA This parameter comprises a number of additional octets allowing additional VM mailbox generic status parameters to be conveyed in the PDU. Additional octets are not defined in this release but may be defined later by 3GPP. This parameter is conditional on the presence of VM_MAILBOX_EXTENSION_LENGTH\nVM_MESSAGE_ID\tThis parameter shall be set to the message ID of the specific voice mail message(s) whose deletion is being confirmed. The range of this parameter is defined in clause 9.2.3.24.13.1 and for a specific voice mail message the value of this parameter shall be identical to that used for the VM Notification. This parameter is repeated according to the number of voice mail message deletions being confirmed.\nRESERVED_FOR_FUTURE_USE\tThis parameter is set to 0 and is reserved for future use. This parameter is repeated according to the number of voice mail message deletions being confirmed.\nVM_MESSAGE_EXTENSION_INDICATOR\tIn this release, this parameter shall be set to 0.This parameter shall be set to a 1 to indicate that a VM_MESSAGE_EXTENSION_LENGTH parameter is present in this PDU.\nVM_MESSAGE_EXTENSION_LENGTH\tThis parameter shall be set to the number of additional octets that immediately follow. This parameter has a value in the range 0 to 255. The presence of this parameter is conditional on the setting of  VM_MESSAGE_EXTENSION_INDICATOR in this PDU\nVM_MESSAGE_EXTENSION_DATA\tThis parameter comprises a number of additional octets allowing additional voicemail message specific parameters to be conveyed in this PDU. Additional octets are not defined in this release but may be defined later by 3GPP. This parameter is conditional on the presence of VM_MESSAGE_EXTENSION_LENGTH",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.1.2.5",
        "clause_9.2.3.24.13.1",
        "ts_23.097",
        "ts_9.2"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.14",
      "section_id": "9.2.3.24.14",
      "section_title": "Identification of a directory number within the User Data Field",
      "content": "A directory number may, as an optional feature, be identified within the User Data Field.\nThis allows, for example, a receiving entity to automatically identify a string of digits in the User Data Field as being a telephone number in order to facilitate easy call back by user action.\nThis shall be implemented by enclosing the directory number in inverted commas (character 0100010 from the 7 bit default alphabet in 3GPP TS 23.038 [9] or its equivalent in other character sets).\nUnspecified address formats or International address formats (using + symbol) may be used for the directory number.\nSpaces may be included with the directory number inside the inverted commas.  E.g. “+1 234 567 8901”\nThe User Data Field displayed to the recipient may contain more than one directory number, in which case it is for the user to select the one required.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.15",
      "section_id": "9.2.3.24.15",
      "section_title": "National Language Single Shift",
      "content": "This information element is used to indicate which National Language Single Shift Table is used instead of the GSM 7 bit default alphabet extension table specified in 3GPP TS 23.038 [9].\nThe total length of the IE is 1 octet:\noctet 1\tNational Language Identifier.\nThe National Language Identifier values and Language tables are defined in 3GPP TS 23.038 [9].\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) this information element if the value of the National Language Identifier is not described in 3GPP TS 23.038 [9].\nIf this IE is duplicated within different segments of a concatenated message then a receiving entity shall process each segment individually.\nIf this IE is not included within a segment of a concatenated message then the receiving entity shall use the GSM 7 bit default alphabet extension table for this segment.\nIn the event that this IE is duplicated within one segment of a concatenated message or a single message then a receiving entity shall use the last occurrence of the IE.\nIn the event that this IE is received within a single message or a segment of a concatenated message, in which the DCS has indicated UCS-2 encoding, then the receiving entity shall ignore this IE.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.16",
      "section_id": "9.2.3.24.16",
      "section_title": "National Language Locking Shift",
      "content": "This information element is used to indicate which National Language Locking Shift Table is used instead of the GSM 7 bit default alphabet specified in 3GPP TS 23.038 [9].\nThis IE is coded in the same way as the National Language Single Shift IE in clause 9.2.3.24.15.\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) this information element if the value of the National Language Identifier is not described in 3GPP TS 23.038 [9].\nIf this IE is duplicated within different segments of a concatenated message then a receiving entity shall process each segment individually.\nIf this IE is not included within a segment of a concatenated message then the receiving entity shall use the GSM 7 bit default alphabet table for this segment.\nIn the event that this IE is duplicated within one segment of a concatenated message or a single message then a receiving entity shall use the last occurrence of the IE.\nIn the event that this IE is received within a single message or a segment of a concatenated message, in which the DCS has indicated UCS-2 encoding, then the receiving entity shall ignore this IE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.3.24.15",
        "ts_23.038"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.24.17",
      "section_id": "9.2.3.24.17",
      "section_title": "Filler",
      "content": "This information element shall be used when there is a requirement to replace IEs in the User Data Header while retaining the original TP-User-Data-Header-Length (UDHL) and TP‑User‑Data‑Length (TP-UDL) values.\nWhen the Filler IE is used, the information element data octets shall be set to 0. The length field of the Filler IE shall be set to the same value of the length field of the IE it is replacing.\nA receiving entity shall ignore (i.e. skip over and commence processing at the next information element) the content of this IE.\nMultiple occurrences of this IE may occur.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.25",
      "section_id": "9.2.3.25",
      "section_title": "TP‑Reject‑Duplicates (TP‑RD)",
      "content": "The TP‑Reject‑Duplicates is a 1 bit field located within bit 2 of the first octet of SMS‑SUBMIT and has the following values.\nBit no. 2:\t0\tInstruct the SC to accept an SMS‑SUBMIT for an SM still held in the\tSC which has the same TP‑MR and the same TP‑DA as a previously\tsubmitted SM from\tthe same OA.\n1\tInstruct the SC to reject an SMS‑SUBMIT for an SM still held in the\tSC which has the same TP‑MR and the same TP‑DA as the\tpreviously submitted SM\tfrom the same OA. In this case the response returned by the SC is as specified in 9.2.3.6..",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.26",
      "section_id": "9.2.3.26",
      "section_title": "TP‑Status‑Report‑Qualifier (TP‑SRQ)",
      "content": "The TP‑Status‑Report‑Qualifier is a 1 bit field located within bit 5 of the first octet of SMS‑STATUS‑REPORT and has the following values\nBit no. 5:\t0\tThe SMS‑STATUS‑REPORT is the result of a SMS‑SUBMIT.\n1\tThe SMS‑STATUS‑REPORT is the result of an SMS‑COMMAND e.g.\nan Enquiry.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.2.3.27",
      "section_id": "9.2.3.27",
      "section_title": "TP‑Parameter‑Indicator (TP‑PI)",
      "content": "The TP‑Parameter‑Indicator comprises a number of octets between 1 and n where each bit when set to a 1 indicates that a particular optional parameter is present in the fields which follow. The TP‑PI is present as part of the RP‑User‑Data in the RP‑ACK or the RP-ERROR as indicated in clauses 9.2.2.1a and 9.2.2.2a or the RP-DATA as indicated in clause 9.2.2.3.\nThe structure of the TP‑PI is as follows:\nOctet 1:\nbit 7\nbit 6\nbit 5\nbit 4\nbit 3\nbit 2\nbit 1\nbit 0\nExtension bit\nReserved\nReserved\nReserved\nReserved\nTP‑UDL\nTP‑DCS\nTP‑PID\nThe most significant bit in octet 1 and any other TP‑PI octets which may be added later is reserved as an extension bit which when set to a 1 shall indicate that another TP‑PI octet follows immediately afterwards.\nIf the TP‑UDL bit is set to zero then by definition neither the TP‑UDL field or the TP‑UD field can be present. If the TP-UDL bit is set to “1” but the TP-DCS bit is set to “0” then the receiving entity shall for TP-DCS assume a value of 0x00, i.e. the 7bit default alphabet.\nIf a Reserved bit is set to \"1\" then the receiving entity shall ignore the setting. The setting of this bit shall mean that additional information will follow the TP‑User‑Data, so a receiving entity shall discard any octets following the TP‑User‑Data.",
      "chunk_type": "parameter",
      "cross_references": [
        "clause_9.2.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.2.3.28",
      "section_id": "9.2.3.28",
      "section_title": "TP‑Loop-Prevention (TP‑LP)",
      "content": "The TP‑Loop-Prevention is a 1‑bit field, located within bit no 3 of the first octet of the SMS‑Deliver and SMS-Status-Report, and to be given the values in the table below.\nIn the following description, a 'spawned' message refers to an application-generated message (e.g. an auto-reply or a copy to a second subscription) generated in response to a received SMS-Deliver or SMS-Status-Report. In order to prevent message loops, only a single off-net forwarding operation shall be permitted on any SMS-Deliver or SMS-Status-Report, and a spawned message shall not spawn a further message. To achieve this, spawned messages and forwarded messages (but not the original message) shall be marked using the TP-LP bit so that further spawning or further off-net forwarding of these messages is inhibited.\nA network entity (e.g. an SC) that generates or transports SMS-Deliver or SMS-Status-Report shall set this bit in the forwarded message when forwarding to a destination other than that specified in the received SMS-Deliver or SMS-Status-Report.\nA network entity (e.g. an SC) that implements SMS forwarding shall inhibit off-net forwarding of SMS-Deliver or SMS-Status-Report if this bit is already set in the SMS-Deliver or SMS-Status-Report received from another network.\nIf an implementation does not prevent on-net message looping by other means, a network entity (e.g. an SC) that implements SMS forwarding may inhibit on-net forwarding of SMS-Deliver or SMS-Status-Report if this bit is already set in the received SMS-Deliver or SMS-Status-Report.\nA network entity (e.g. an SC) that spawns an additional message from a received SMS-Deliver or SMS-Status-Report shall set the TP-LP bit in the spawned message.\nA network entity (e.g. an SC) shall inhibit generation of a spawned message if this bit is already set in the received SMS-Deliver or SMS-Status-Report from which the spawned message would otherwise be generated.\nTP-LP Value\nDescription\n0\nThe message has not been forwarded and is not a spawned message (or the sending network entity (e.g. an SC) does not support the setting of this bit.)\n1\nThe message has either been forwarded or is a spawned message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.1",
      "section_id": "9.3.1",
      "section_title": "General",
      "content": "The Short Message Relay Layer (SM‑RL) provides a service to the Short Message Transfer Layer (SM‑TL). This service enables the SM‑TL to send Transfer Protocol Data Units (TPDUs) to its peer entity, receive TPDUs from its peer entity and receive reports about earlier requests for TPDUs to be transferred.\nIn order to keep track of TPDUs and reports about those TPDUs, primitives between the SM‑TL and SM‑RL contain a Short Message Identifier (SMI), which is a reference number for the TPDU associated with the primitive. This Short Message Identifier is not carried via the SM‑RL protocol of clause 9.3.2. It is carried via the relay layer service between the SC and GMSC. It is also carried by SM‑RL of 3GPP TS 24.011 [13], between the visited MSC and MS. The parameter is not carried by MAP but is mapped to and from the TCAP dialogue Identifier (see CCITT Recommendation Q.771, \"Blue Book\" [19]) at the GMSC and the visited MSC (therefore the Message Identifier at the SC/GMSC interface is not the same as at the visited MSC/MS interface).\nThe SM‑RL communicates with its peer entity by the protocol described in the following clauses.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_9.3.2",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.3.2",
      "section_id": "9.3.2",
      "section_title": "Protocol element repertoire at SM‑RL",
      "content": "Different protocols are required between different pairs of SM‑RL entities. Those are described in other GSM/UMTS specifications. This clause gives a survey of the different information elements which have to be conveyed between those entities. (Note that the notation of the protocol and information elements may vary between different GSM/UMTS specifications).\nThe SM‑RL comprises the following 6 protocol elements:\nRP‑MO‑DATA\tfor transferring a TPDU from MS to SC\nRP‑MT‑DATA\tfor transferring a TPDU from SC to MS\nRP‑ACK\tfor acknowledging an RP‑MO‑DATA, an RP‑MT‑DATA or an \tRP‑SM‑MEMORY‑AVAILABLE\nRP‑ERROR\tfor informing of an unsuccessful RP‑MO‑DATA or an RP‑MT‑DATA transfer attempt\nRP‑ALERT‑SC\tfor alerting the SC that the MS has recovered operation (information\nsent from the HLR to the SC)\nRP‑SM‑MEMORY‑AVAILABLE\tfor notifying the network that the MS has memory available to\naccept one or more short messages (information sent from the MS to\nthe HLR)",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.2.1",
      "section_id": "9.3.2.1",
      "section_title": "RP‑MO‑DATA",
      "content": "Basic elements of the RP‑MO‑DATA type.\nAbbr.\nReference\nP1)\nDescription\nRP‑OA\nRP‑Originating‑Address\n++‑\nAddress of the originating MS.\nRP‑DA\nRP‑Destination‑Address\n‑++\nAddress of the destination SC.\nRP‑UD\nRP‑User‑Data\n+++\nParameter containing the TPDU\n1)\tProvision on the links SC<‑>MSC, MSC<‑>MSC or MSC<->SGSN, and MSC<‑>MS or SGSN<->MS indicated by \"xxx\", where x may be either \"+\" or \"‑\", dependent on whether the parameter is mandatory or not on the respective link.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.2.2",
      "section_id": "9.3.2.2",
      "section_title": "RP‑MT‑DATA",
      "content": "Basic elements of the RP‑MT‑DATA type.\nAbbr.\nReference\nP1)\nDescription\nRP‑PRI\nRP‑Priority‑Request\n+‑‑\nParameter indicating whether or not the short message transfer should be stopped if the originator SC address is already contained in the MWD.\nRP‑MMS\nRP‑More‑Messages‑To‑Send\nOO‑\nParameter indicating that there are more messages waiting in the SC\nRP‑OA\nRP‑Originating‑Address\n+++\nAddress of the originating SC.\nRP‑DA\nRP‑Destination‑Address\n++‑\nAddress of the destination MS.\nRP‑UD\nRP‑User‑Data\n+++\nParameter containing the TPDU\nRP-MTI\nRP-Message Type Indicator\nO--\nParameter indicating if the TPDU is a SMS Deliver or a SMS Status Report 2)\nRP-SMEA\nRP-originating SME-Address\nO--\nAddress of the originating SME 2)\n1)\tProvision on the links SC<‑>MSC, MSC<‑>MSC or MSC<->SGSN, and MSC<‑>MS or SGSN<->MS\tindicated by \"xxx\", where x may be \"+\", \"‑\" or \"O\", dependent on whether the parameter is mandatory, not present\tor optional on the respective link.\n2)\tThese information elements may be included in the \"Send Routing Information for SM\" sent by the SMS-GMSC to the HLR.\nWhen transmitted, the RP-SMEA shall take the TP-OA value.\nWhen transmitted, the RP-MTI shall be given the following values:\n0\tSMS Deliver.\n1\tSMS Status Report.\nThis may be used by the HLR to distinguish the two cases in order not to apply any filtering mechanism based on the RP-SMEA value in case of a SMS-Status Report transmission.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.2.3",
      "section_id": "9.3.2.3",
      "section_title": "RP‑ACK",
      "content": "The RP‑ACK contains the RP‑User‑Data which is a parameter containing the TPDU (see clauses 9.2.2.1a and 9.2.2.2a).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.2.4",
      "section_id": "9.3.2.4",
      "section_title": "RP‑ERROR",
      "content": "Basic elements of the RP‑ERROR type.\nAbbr.\nReference\nP1)\nDescription\nRP‑MSI\nRP‑MW‑Set‑Indication\n+‑‑\nParameter indicating whether or not the MWI has been up‑dated. 2)\nRP‑CS\nRP‑Cause\n+++\nParameter identifying the error type. The RP‑Cause parameter gives the reason why a short message transfer attempt fails. In practice three relay layer protocols are used ‑ SC to GMSC/IWMSC (see Annex A), MAP (see 3GPP TS 29.002 [15]) and via the radio interface (see 3GPP TS 24.011 [13])\nRP‑MSIsdn\nRP‑international‑‑MS‑ISDN‑number\n+‑‑\nMSIsdn‑Alert or IMSI-Alert of the MS, see clause 3.2.7 3)\nRP-UD\nRP-User-Data\nOO O\nParameter containing a TPDU\n1)\tProvision on the links SC<->MSC, MSC<->MSC or MSC<->SGSN, and MSC<->MS or SGSN<->MS indicated by \"xxx\", where x may be \"+\", \"-\" or \"O\" dependent on whether the parameter is mandatory, not present or optional on the respective link.\n2)\tOnly present when the RP‑ERROR is transferred from the SMS‑GMSC to the SC.\n3)\tOnly present when the RP‑MT‑DATA transfer attempt failed because the MS is not reachable or because the MS memory capacity was exceeded and the MSIsdn‑Alert or IMSI-Alert is different from the MSIsdn or IMSI used by the SC to address the recipient MS.",
      "chunk_type": "general",
      "cross_references": [
        "clause_3.2.7",
        "ts_29.002",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_9.3.2.5",
      "section_id": "9.3.2.5",
      "section_title": "RP‑ALERT‑SC",
      "content": "Basic elements of the RP‑ALERT‑SC type:\nAbbr.\nReference\nP1)\nDescription\nRP‑MSIsdn\nRP‑International‑MS‑ISDN‑Number\nO\nMSIsdn of the MS.\nRP‑IMSI\nRP‑International‑Mobile‑Subscriber‑Identity\nO\nIMSI of the MS\n1)\tProvision;\tOptional (O).\n2)\tIt is mandatory to include either RP-MSIsdn or RP-IMSI.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_9.3.2.6",
      "section_id": "9.3.2.6",
      "section_title": "RP‑SM‑MEMORY‑AVAILABLE",
      "content": "Basic elements of the RP‑SM‑MEMORY‑AVAILABLE type:\nAbbr.\nReference\nP1)\nDescription\nRP‑IMSI\nRP‑International‑Mobile‑Subscriber‑Identity\n++‑\nIMSI of the MS.\n1)\tProvision on the links HLR<‑>VLR or HLR<->SGSN, VLR<‑>MSC and MSC<‑>MS or SGSN<->MS indicated by \"xxx\", where x may be either \"+\" or \"‑\", dependent on whether the parameter is mandatory or not present on the respective link.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_10",
      "section_id": "10",
      "section_title": "Fundamental procedures within SMS",
      "content": "The procedures for providing SMS over a generic IP CAN is described in 3GPP TS 23.204 [42] (see clause 6).\nThe SMS comprises 3 fundamental procedures:\n1)\tShort message mobile terminated. This procedure consists of all necessary operations to:\na)\ttransfer a short message or status report from the SC to the MS;\nb)\treturn a report to the SC, containing the result of the message transfer attempt.\n2)\tShort message mobile originated. This procedure consists of all necessary operations to:\na)\ttransfer a short message from the MS to the SC;\nb)\treturn a report to the MS, containing the result of the message transfer attempt.\n3)\tTransfer of an Alert. This procedure consists of all necessary operations for an HLR or a VLR to initiate a transfer of an Alert to a specific SC, informing the SC that the MS has recovered operation.\n3GPP TS 29.002 [15] defines operations necessary for the provision of the Short Message Service. The operations defined in clause 10 describe the requirement that the Short Message Service puts upon the network functionality. If discrepancies exist in nomenclature, it is the 3GPP TS 29.002 [15] that shall be the reference.\nAnnex C indicates the flow of primitives and parameters during the short message transfer between the SC and the MS. Both the Mobile terminated and the Mobile originated cases are covered.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.204_clause_6",
        "clause_10",
        "ts_23.204",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_10.1",
      "section_id": "10.1",
      "section_title": "Short message mobile terminated",
      "content": "The entities involved in this procedure are depicted in figure 14.\nNOTE 1:\tThe SMS Router is an optional entity. If it is not present, the two interfaces extending from the right side of the SMS‑GMSC extend directly to the SGSN and MSC, respectively.\nNOTE 2:\tSince the short message mobile terminated procedure covers the functionality required at SM‑RL for transferring TPDUs from SC to MS, the procedure described covers both short message (SMS‑DELIVER) and status report (SMS‑STATUS‑REPORT) transfer. The term \"short message transfer\" therefore, in this clause, covers both cases.\nFigure 14: Interfaces involved in the Short message mobile terminated procedure. GSM TS 43.002 [5]. X is the interface between an MSC and an SC as defined in clause 5\nIn figure 15, sequence diagrams are shown for the following basic situations of short message mobile terminated transfer attempt:\n‑\tSuccessful short message transfer via the MSC or the SGSN;\n-\tSuccessful short message transfer via the SMS Router, and the MSC or SGSN;\n‑\tShort message transfer attempt failing due to error at the SMS‑GMSC;\n‑\tShort message transfer attempt failing due to negative outcome of HLR information retrieval;\n-\tShort message transfer attempt via the SMS Router failing due to negative outcome of HLR information retrieval;\n‑\tShort message transfer attempt failing due to error at the MSC or SGSN;\n‑\tShort message transfer attempt failing due to negative outcome of VLR information retrieval;\n‑\tShort message transfer attempt failing due to erroneous message transfer on the radio path;\n‑\tShort message transfer attempt failing over the first path (e.g. SGSN) and succeeding over the second path (e.g. MSC);\n-\tShort message transfer attempt via the SMS Router failing over the first path (e.g. SGSN) and succeeding over the second path (e.g. MSC);\n‑\tShort message transfer attempt failing over the first path (e.g. SGSN) and over the second path (e.g. MSC).\nReferences to the relevant specifications of the different operations are given in clause 4.\nNOTE 1):\tThis operation is not used by the SGSN.\nFigure 15a): Successful short message transfer attempt via the MSC or the SGSN\nOperation 4a: The SMS-GMSC indicates in the ForwardShortMessage the time until which it waits for receiving the Delivery Report.\nOperations 4b to 6: If the MS is using extended idle mode DRX and the MS is expected to respond to paging before the time indicated by the SMS-GMSC, the MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]) or SGSN (or the MME for the SMS in MME feature) may buffer and send the Short Message to the MS until that time.\nNOTE 1:\tOperation 5 is not used by the SGSN.\nFigure 15aa): Successful short message transfer attempt via the SMS Router, and the MSC or SGSN\nOperation 4a: The SMS-GMSC indicates in the ForwardShortMessage the time until which it waits for receiving the Delivery Report.\nOperations 4b to 6: If the MS is using extended idle mode DRX and the MS is expected to respond to paging before the time indicated by the SMS-GMSC, the MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]) or SGSN(or the MME for the SMS in MME feature) may buffer and send the Short Message to the MS until that time.\nFigure 15b): Short message transfer attempt failing due to error at the SMS‑GMSC\nFigure 15c): Short message transfer attempt failing due to negative outcome of HLR information retrieval\nFigure 15ca) Short message transfer attempt via the SMS Router failing due to negative outcome of HLR information retrieval\nNOTE:\tIf an SMS Router is present, the message flow in 15aa is used, except that a 4c Failure Report message is transparently transferred to the SMS‑GMSC from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.\nFigure 15d): Short message transfer attempt failing due to error at the MSC or SGSN\nNOTE:\tIf an SMS Router is present, the message flow in 15aa is used, except that a 4c Failure Report message is transparently transferred to the SMS‑GMSC from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.\nFigure 15e): Short message transfer attempt failing due to negative outcome of VLR information retrieval\nNOTE 1:\tThis operation is not used by the SGSN.\nNOTE 2:\tIf an SMS Router is present, the message flow in 15aa is used, except that a 4c Failure Report message is transparently transferred to the SMS‑GMSC from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.\nFigure 15f): Short message transfer attempt failing due to erroneous message transferon the radio path\nNOTE 1:\tThis operation is not used by the SGSN.\nNOTE 2:\tTwo addresses (SGSN and MSC) are received from HLR.\nNOTE 3:\tBoth successful transfer over second path and unsuccessful transfer over first path (e.g. Absent subscriber) are sent to HLR.\nNOTE 4:\tThe SMS transfer towards the second path is only triggered by the reception of some MAP errors on the first path as described in clause 8.1.1.\nFigure 15g): Short message transfer attempt failing over the first path (e.g. SGSN) andsucceeding over the second path (e.g. MSC)\nNOTE 1:\tOperation 5 is not used by the SGSN.\nNOTE 2:\tIn Operation 2b, two addresses are received from the SMS Router by the SMS‑GMSC. Both contain the address of the SMS Router, however, each address identifies delivery to the MS via the MSC or via the SGSN.\nNOTE 3:\tIn Operation 3, both successful transfer over second path and unsuccessful transfer over first path (e.g. Absent subscriber) are sent to the HLR.\nNOTE 4:\tThe SMS transfer towards the second path is only triggered by the reception of some MAP errors on the first path as described in clause 8.1.1.\nFigure 15ga): Short message transfer attempt via the SMS Router failing over the first path (e.g. SGSN) and succeeding over the second path (e.g. MSC)\nNOTE 1:\tThis operation is not used by the SGSN.\nNOTE 2:\tTwo addresses (SGSN and MSC) are received from HLR.\nNOTE 3:\tUnsuccessful transfer over the second path (e.g. MemoryCapacityExceeded) and over the first path (e.g. Absent subscriber) are sent to HLR.\nNOTE 4:\tThe SMS transfer towards the second path is only triggered by the reception of some MAP errors on the first path as described in clause 8.1.1.\nNOTE 5:\tIf an SMS Router is present, the message flow in 15ga is used, except that a 4c Failure Report message is transparently transferred to the SMS‑GMSC from the MSC or SGSN by the SMS Router instead of a 4b Delivery Report.\nFigure 15h): Short message transfer attempt failing over the first path (e.g. SGSN) andover the second path (e.g. MSC)\nOperation 1: Message transfer SC ‑> SMS‑GMSC.\nThis operation is used to transfer a short message from an SC to an SMS‑GMSC.\nThe operation consists of:\n‑\tthe transfer of a message containing the TPDU from the SC to the SMS‑GMSC (see \"1a. Message transfer\" in figure 15); and\n‑\tthe return of either a \"Failure report\" (see 1c. in figure 15) or a \"Delivery report\" (see 1b. in figure 15).\n\"Failure report\" is returned to the SC when the SMS‑GMSC has received indication from another entity (MSC, SGSN or HLR) the procedure was unsuccessful. The error indications which the SMS‑GMSC may receive from the MSC, SGSN, HLR, VLR or MS enable the SMS‑GMSC to return one of the error indications given in clause 3.3 back to the SC.\nOperation 2: sendRoutingInfoForShortMsg.\nThe operation is an interrogation of the HLR by the SMS‑GMSC or the SMS Router to retrieve information necessary to deliver the short message.\nThe result may contain the MSC, SGSN, both MSC and SGSN addresses, or the address of the SMS Router. It shall also indicate which address belongs to the MSC and the SGSN, however, it shall not indicate if the address belongs to an SMS Router (as the SMS Router poses as either an MSC or an SGSN or both to the SMS-GMSC).\nOperation 3: SM-DeliveryReportStatus.\nThe operation provides a means for the SMS‑GMSC to request the HLR to add an SC address to the MWD, and is activated when the SMS‑GMSC receives an absent subscriber indication from the MSC, SGSN or both, and/or when the SMS‑GMSC receives a failure report for a short message transfer with cause MS Memory Capacity Exceeded via the MSC or SGSN. The Return Result optionally contains the MSIsdn‑Alert or IMSI-Alert.\nThis operation is also activated at successful delivery short message when the MNRF, MNRG or both are set in HLR.\nThe operation consists of:\n‑\tthe transfer of a message, containing the MSISDN or IMSI of the MS to which the short message was addressed, the SC‑address, the successful outcome and/or the causes (Absent Subscriber, MS memory capacity exceeded or both) for updating the MWD, from the SMS‑GMSC to the HLR (see 3. in figure 15).\nOperation 4: forwardShortMessage.\nThe operation provides a means for the SMS‑GMSC to transfer a short message to the MSC or to the SGSN at which the MS is currently located, via an SMS Router if deployed by the HPLMN of the receiving MS.\nThe operation works in tandem with the forwarding of the short message from the MSC or from the SGSN to the MS. Thus, the outcome of the operation comprises either success, i.e. that the message has been delivered to the MS; or a failure that may be caused by several reasons, e.g. failure in the transfer SMS‑GMSC ‑> MSC or SMS-GMSC -> SGSN, MS being detached, MS being temporarily unreachable (e.g. due to eDRX), or no paging response.\nIt should be noted that the MNRG setting is implicitly carried out in the SGSN when the message transfer is denied due to GPRS DETACH.\nOperation 5: sendInfoForMT‑SMS.\nThe operation provides a means for the MSC to retrieve subscriber information from VLR for mobile terminated short message transfer. The operation may be associated with an authentication procedure, as shown in figure 16. Unsuccessful retrieval (e.g. absent subscriber) is indicated by a cause indication to the SMS‑GMSC.\nAn overall depiction of how operation 5 interacts with signalling on the radio path is given in figure 16.\nIt should be noted that the MNRF setting is implicitly carried out when the message transfer is denied due to IMSI DETACH.\nNOTE:\tThis operation is not used by the SGSN.\nOperation 6: Message transfer MSC ‑> MS.\nThe operation is used to transfer a short message from the MSC to the MS.\nIf the transfer is not successful, e.g. due to the MS losing radio coverage after having successfully authenticated, a failure report (RP‑ERROR) is returned to the SMS‑GMSC. In this case, MWD and MCEF in the HLR shall be updated only for the case where the transfer fails with cause MS Memory Capacity Exceeded.\nIf the MS notifies the network that the MS has been unable to accept a short message because its memory capacity has been exceeded, then the ME shall set the memory capacity Exceeded Notification flag if present.\nOperation 7: InformSC.\nThe operation is used to transfer the MSIsdn‑Alert or IMSI-Alert from the HLR to the SMS‑GMSC if the error Absent Subscriber or a positive result is given as an answer to the operation SendRoutingInfoForSM.\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer incl. report\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nIf the SGSN is used, Paging and Authentication are performed from SGSN.\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tIf an SMS Router is present, the message 4a forwardShortMessage and 4b Delivery report are transparently transferred from/to the SMS‑GMSC to/from the MSC or SGSN by the SMS Router.\nFigure 16a): \"Send information for MT SMS\" procedure; error free case\n:\tOperation invocation or message transfer\n:\tError report\nNOTE 1:\tThe GPRS DETACH information is in the SGSN.\nThis operation is not used by the SGSN.\nNOTE 2:\tIf an SMS Router is present, the message 4a forwardShortMessage and 4c Failure report are transparently transferred from/to the SMS‑GMSC to/from the MSC or SGSN by the SMS Router.\nFigure 16b): \"Send information for MT SMS\" procedure;erroneous case: absent subscriber (e.g. IMSI DETACH or GPRS DETACH)\n:\tOperation invocation or message transfer\n:\tError report\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nIf the SGSN is used, Paging is performed from SGSN.\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tIf an SMS Router is present, the message 4a forwardShortMessage and 4c Failure report are transparently transferred from/to the SMS‑GMSC to/from the MSC or SGSN by the SMS Router.\nFigure 16c): \"Send information for MT SMS\" procedure;erroneous case: Absent subscriber (e.g. no paging response)\n:\tOperation invocation or message transfer\n:\tError report\n:\tUnsuccessful operation invocation or message transfer including error report\n(or with missing confirmation)\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nIf the SGSN is used, Paging and Authentication are performed from SGSN.\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tIf an SMS Router is present, the message 4a forwardShortMessage and 4c Failure report are transparently transferred from/to the SMS‑GMSC to/from the MSC or SGSN by the SMS Router.\nFigure 16d): \"Send information for MT SMS\" procedure; incorrect authentication\nNOTE 1):\tThis operation is not used by the SGSN or MME.\nFigure 17a): Successful short message transfer attempt via the MSC, SGSN or MME, with short message retransmission by the SMS-GMSC at the time requested by the MSC, SGSN or MME\nOperation 4a: the SMS-GMSC indicates in the ForwardShortMsg that it is capable to retransmit the Short Message until a maximum retransmission time.\nOperation 4c: If the MS is using extended idle mode DRX, and if the ForwardShortMsg includes a maximum retransmission time, the MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]), SGSN or MME may return a Delivery Report with a cause indicating that the user is temporarily unreachable and with an indication requesting the SMS-GMSC to retransmit the Short Message at a later requested retransmission time prior to the maximum retransmission time. In that case, the MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]), SGSN or MME shall not set the MNRF, MNRG or MNRF flag respectively. The SMS-GMSC shall not send an SM-Delivery Report Status to the HLR or HSS.\nOperation 5a: the SMS-GMSC retransmits the Short Message at the requested retransmission time.\nNOTE:\tThis procedure does not cause additional signalling to the HSS to retransmit the Short Message.\nNOTE 1):\tThis operation is not used by the SGSN or MME.\nFigure 17b: Successful short message transfer attempt via the MSC, SGSN or MME, with short message retransmission by the SMS-GMSC upon MS originated signalling prior to the retransmission time requested by the MSC, SGSN or MME\nOperation 4a: same as for Figure 17a).\nOperation 4c: same as for Figure 17a).\nOperation 5b: Upon MS originated signalling to the same MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]), SGSN or MME, the MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]), SGSN or MME sends an Alert Service Center to the SMS-GMSC to trigger the immediate retransmission of the Short Message.\nOperation 6a: the SMS-GMSC retransmits the Short Message immediately.\nFigure 17c): Successful short message transfer attempt via the MSC, SGSN or MME, with short message retransmission by the SMS-GMSC upon MS mobility to a new serving node prior to the retransmission time requested by the MSC, SGSN or MME.\nOperation 4a: same as for Figure 17a).\nOperation 4c: same as for Figure 17a).\nOperation 5c: Upon MS mobility to a new SGSN or MME prior to the retransmission time requested by the old SGSN or MME, the old SGSN or MME signals to the new SGSN or MME (in the Context Response during a RAU or TAU procedure or in the Forward Relocation Request during a Handover procedure), that there is a pending MT Short Message to be sent to the MS.\nOperation 5d: if so, the new SGSN or MME signals its MAP or Diameter address for MT SMS to the old SGSN or MME (in the Context Acknowledge during a RAU or TAU procedure or in the Forward Relocation Response during a Handover procedure). The new SGSN or MME also maintains the signalling connection with the MS for a longer time to enable the retransmission of the Short Message.\nOperation 5e: Based on Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]), upon receipt of a Cancel Location Request the old MSC sends an Alert Service Center message to the SMS-GMSC with an indication that the MS has moved to another serving node, to trigger the immediate retransmission of the Short Message towards the new serving node. Upon mobility to a new MME without MSC change (for SMS over SGs), the MSC sends an Alert Service Center message to the SMS-GMSC with an indication that the MS is available for MT SMS to trigger the immediate retransmission of the Short Message to the MSC.\nUpon receipt of a Cancel Location Request, Context Acknowledge or Forward Relocation Response, the old SGSN or MME sends an Alert Service Center message to the SMS-GMSC, with an indication that the MS has moved to another serving node, and with the new serving node's address if received at step 5d, to trigger the immediate retransmission of the Short Message towards the new serving node.\nOperation 6a: If the Alert Service Center message indicates that that the MS has moved to another serving node but the message does not contain the new serving node's address, the SMS-GMSC retrieves the new serving node's address from the HLR or HSS.\nOperation 6c: the SMS-GMSC retransmits the Short Message immediately towards the new serving node.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "clause_4",
        "ts_23.272_clause_8.2.4",
        "clause_8.1.1",
        "clause_3.3",
        "figure_14",
        "figure_15",
        "figure_16",
        "figure_17",
        "ts_43.002",
        "ts_23.272",
        "ts_24.008",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_10.2",
      "section_id": "10.2",
      "section_title": "Short message mobile originated",
      "content": "The entities involved in this procedure is depicted in figure 17.\nFigure 17: Interfaces involved in the Short message mobile originated procedure\nGSM TS 43.002 [5]. X is the interface between an MSC or an SGSN and an SC as defined in clause 5.\nNote that since the short message mobile originated procedure covers the functionality required at SM‑RL for transferring TPDUs from SC to MS, the procedure described covers both short message (SMS‑SUBMIT) and command (SMS‑COMMAND) transfer. The term \"short message transfer\" therefore in this clause, covers both cases.\nIn figure 18, sequence diagrams for the following basic situations of short message mobile terminated transfer attempt:\n‑\tSuccessful short message transfer;\n‑\tShort message transfer attempt failing due to error at the MSC or SGSN;\n‑\tShort message transfer attempt failing due to negative outcome of VLR information retrieval;\n‑\tShort message transfer attempt failing due to error at the SMS‑IWMSC;\n‑\tShort message transfer attempt failing due to error at the SC;\n-\tShort Message transfer attempt successful due to the existence of an SMS Interworking agreement;\n-\tShort Message transfer attempt failing due to non-existence of an SMS Interworking agreement;\n-\tShort Message transfer attempt failing due to negative outcome of HLR information retrieval.\nReferences to the relevant specifications of the different operations are given in clause 4.\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\nNOTE 1):\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2):\tThis operation is not used by the SGSN.\nFigure 18a): Successful short message transfer attempt\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\nNOTE 1):\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nFigure 18b): Short message transfer attempt failing due to error at the MSC or SGSN\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\n:\tUnsuccessful operation invocation or message transfer incl. error report\n(or with missing confirmation)\nNOTE 1):\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2):\tThis operation is not used by the SGSN.\nFigure 18c): Short message transfer attempt failing due to negative outcome ofVLR information retrieval\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\nNOTE 1):\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2):\tThis operation is not used by the SGSN.\nFigure 18d): Short message transfer attempt failing due to error at the SMS‑IWMSC\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\nNOTE 1):\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2):\tThis operation is not used by the SGSN.\nFigure 18e): Short message transfer attempt failing due to error at the SC\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tHLR that terminated user belongs to.\nAfter completing operation 2, SMS-IWMSC could check whether SMS interworking agreement exists or not based on IMSI. In this figure 18f case, there is an SMS interworking agreement between operators.\nFigure 18f): Short Message transfer Successful due to the existenceof an SMS Interworking agreement\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tHLR that terminated user belongs to.\nNOTE 4:\tThe lack of an SMS interworking agreement can not be conveyed in the Failure Report as a specific indication.\nAfter completing operation 2, SMS-IWMSC could check whether SMS interworking agreement exists or not based on IMSI. In this figure18g case, there is no SMS Interworking agreement between operators.\nFigure 18g): Short Message transfer attempt failing due to non-existenceof an SMS Interworking agreement\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\n:\tError report\nNOTE 1:\tDescribed in 3GPP TS 24.008 [12] and 3GPP TS 29.002 [15].\nNOTE 2:\tThis operation is not used by the SGSN.\nNOTE 3:\tHLR that terminated user belongs to.\nNOTE 4:\tThe lack of an SMS interworking agreement can not be conveyed in the Failure Report as a specific indication.\nIf SMS-IWMSC receives an informSC Message, then this message shall be ignored by the SMS-IWMSC.\nFigure 18h: Short Message transfer attempt failing due to negative outcomeof HLR information retrieval\nIf a failure report is indicated by the HLR after invocation of the \"sendRoutingInfoForShortMsg\" operation, the SMS‑IWMSC shall return the appropriate error information to the MSC/SGSN with the error cause coded as follows:\nReturn error from SendRoutingInfoForSM\nError mapping to ForwardShortMessage\nsystem Failure\nsystem Failure\ndata Missing\nsystem Failure\nUnexpected Data Value\nsystem Failure\nfacility Not supported\nSM Delivery Failure\ncause: invalid SME-address\nunknown Subscriber\nSM Delivery Failure\ncause: invalid SME-address\nteleservice Not provisioned\nSM Delivery Failure\ncause: invalid SME-address\nCall barred\nSM Delivery Failure\ncause: invalid SME-address\nAbsent Subscriber SM\nSM Delivery Failure\ncause: invalid SME-address\nOperation 2: sendRoutingInfoForShortMsg.\nThe operation is an interrogation of the HLR by the SMS-IWMSC to retrieve information necessary to forward the short message.\nThe outcome of the operation comprises either success, where the result contains the IMSI for terminated UE, or failure, which may be caused by several reasons.\nOperation 7: Message transfer MS ‑> MSC or MS -> SGSN.\nThe operation is used to transfer a short message from the MS to the MSC or to the SGSN.\nOperation 8: sendInfoForMO‑SMS.\nThe operation provides a means for the MSC to verify from the VLR that the mobile originated short message transfer does not violate supplementary services invoked or restrictions imposed using the network feature Operator Determined Barring.\nA successful VLR response carries the MSIsdn of the originating MS being transferred to the SC at SM‑RL.\nNOTE:\tThis operation is not used by SGSN.\nOperation 9: forwardShortMessage.\nThe operation provides a means for the MSC or for the SGSN to transfer a short message to the SMS‑IWMSC.\nThe procedure is required if the serving MSC or SGSN cannot access the SC directly, e.g. because it has no connection to SC (see clause 5).\nThe procedure works in tandem with the forwarding of the short message from the SMS‑IWMSC to the SC. Thus, the outcome of the operation comprises either success, i.e. that the message has been delivered to the SC; or a failure that may be caused by several reasons, e.g. failure in the transfer MSC ‑‑> SMS‑IWMSC or SGSN ‑‑> SMS‑IWMSC, SC does not comply.\nOperation 10: Message transfer SMS‑IWMSC ‑> SC.\nThe operation is used to transfer a short message from an SMS‑IWMSC to an SC, and consists of:\n‑\tthe transfer of a message containing the TPDU from the SMS‑IWMSC to the SC (see \"10a. Message transfer\" in figure 18); and\n‑\tthe return of either a \"Failure report\" (see 10c. in figure 18) or a \"Delivery report\" (see 10b. in figure 18).\n\"Failure report\" is returned to the MS when the SMS‑IWMSC has received indication from the network or the SC that the procedure was unsuccessful.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "clause_4",
        "figure_17",
        "figure_18",
        "ts_24.008_figure_18",
        "ts_43.002",
        "ts_24.008",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.040_10.3",
      "section_id": "10.3",
      "section_title": "Alert transfer",
      "content": "The entities involved in this procedure are depicted in figure 19.\nFigure 19: Interfaces involved in the Alert procedure. X is the interface between an SC andan MSC as defined in clause 5\nThis procedure consists of the operations shown in figure 20.\nThree cases are distinguished:\n‑\tthe MS becomes reachable when the MNRF, MNRG or both are set but the MCEF is not set (figure 20a);\n‑\tthe MS becomes reachable when the MNRF, MNRG or both, and the MCEF are set (figure 20b);\n‑\tthe MS notifies the network that it has memory available to receive one or more short messages when the MCEF is set (figure 20c).\nThe operations between MSC and VLR, between HLR and VLR or SGSN and between HLR and SMS‑IWMSC are specified in 3GPP TS 29.002 [15]. The operation between MS and MSC or SGSN is specified in 3GPP TS 24.011 [13]. References to specifications of other operations are given in clause 4.\n:\tOperation invocation or message transfer\nNOTE 1):\tIn case ReadyForSM is sent by the SGSN, the reason may be MS reachable via the SGSN, or MS reachable via the SGSN and the MSC (see3GPP TS 23.060 [27]).\nFigure 20a: The alert procedure when the MS becomes reachable,MNRF, MNRG or both are set and MCEF is not set\n:\tOperation invocation or message transfer\nNOTE 1):\tIn case ReadyForSM is sent by the SGSN, the reason may be MS reachable via the SGSN, or MS reachable via the SGSN and the MSC (see 3GPP TS 23.060 [27]).\nFigure 20b: The alert procedure when the MS becomes reachable,MNRF, MNRG or both are set and MCEF is set\n:\tOperation invocation or message transfer\n:\tSuccessful operation invocation or message transfer including report\nNOTE 1):\tDescribed in 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15].\nFigure 20c: The alert procedure when the MS notifies the network that it hasmemory available to receive one or more short messages and MCEF is set\nOperation 11: ReadyForSM (MS reachable).\nThe operation provides a means to transfer alert information from VLR or SGSN to HLR. The MSC in Deployment Option 2 (see clause 8.2.4a.1 of 3GPP TS 23.272 [45]) or SGSN(or the MME for  the SMS in MME feature) may provide together with the alert information the time until when an MS using extended idle mode DRX is expected to be reachable, so as to allow the SC to prioritize the retransmission of pending Mobile Terminated Short Messages to this MS.\nThe procedure is activated when the VLR or the SGSN detects that the MS is active, i.e. when the MS responds to a paging request.\nOperation 12: alertServiceCentre.\nThe operation provides a means to transfer alert information from HLR to SMS-IWMSC. The HLR may provide with the alert information the time until when an MS using extended idle mode DRX is expected to be reachable, if this information is available.\nOperation 13: ServiceCentrealert.\nThe operation provides a means to transfer alert information from an SMS‑IWMSC to an SC. The SMS-IWMSC may provide with the alert information the time until when an MS using extended idle mode DRX is expected to be reachable, if this information is available.\nThe operation consists of transfer of a message (\"RP‑ALERT‑SC\") from the SMS‑IWMSC to the SC.\nOperation 14: ReadyForSM (smMemoryCapacityAvailable).\nThe operation provides a means for the MS to notify the network that it has memory available to receive one or more short messages.\nThe following applies if the memory capacity available notification flag is implemented in the (U)SIM.\nThe operation consists of transfer of a message (\"RP‑SM‑MEMORY‑AVAILABLE\") from the MS to the HLR, and the return of an acknowledgement to the MS. When the MS rejects a short message due to lack of available memory capacity the need to transfer notification shall be stored in the (U)SIM. After a attempt to transfer the RP‑SM‑Memory‑Available message the following applies:\nIf the MS receives a positive acknowledgement it shall unset the memory capacity exceeded notification flag in the (U)SIM and exit this procedure.\nIf the MS receives a negative acknowledgement indicating a permanent failure condition (as specified in 3GPP TS 24.011 [13]) it shall unset the memory capacity exceeded notification flag in the (U)SIM and exit the procedure.\nIf the MS receives a negative acknowledgement indicating a temporary failure condition (as specified in 3GPP TS 24.011 [13]) or receives no acknowledgement or an indication of failure by lower layers, it shall repeat the attempt to transfer the message in accordance with procedures defined in 3GPP TS 24.011 [13]. If these repeat procedures fail, the mobile shall unset the memory capacity exceeded notification flag in the (U)SIM and exit this procedure.\nIf memory capacity has become available because memory is cleared, the value of the memory capacity exceeded notification flag is read. If the flag is set, the MS notifies the network that memory capacity is now available as described above.\nWhen the mobile is powered up or the SIM/UICC is inserted, the mobile shall check the memory capacity exceeded notification flag in the (U)SIM; if the flag is set and the MS has memory available to receive a short message the mobile shall attempt to notify the network that it has memory available, as described above.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5",
        "clause_4",
        "ts_23.272_clause_8.2.4",
        "figure_19",
        "figure_20",
        "ts_23.060_figure_20",
        "ts_24.011_figure_20",
        "ts_29.002",
        "ts_24.011",
        "ts_23.060",
        "ts_23.272"
      ]
    },
    {
      "chunk_id": "ts_23.040_11",
      "section_id": "11",
      "section_title": "Mapping of error causes between RP layers",
      "content": "This clause describes the interworking between the relay layers on the radio interface (i.e. between the servicing MSC/SGSN and the mobile station), and within the network (i.e. between servicing MSC/SGSN, VLR, HLR, or GMSC).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.040_11.1",
      "section_id": "11.1",
      "section_title": "Mobile Terminated short message transfer",
      "content": "If errors are indicated by the VLR after invocation of the \"sendInfoFor‑MT‑SMS\" operation, the appropriate error information is returned to the SMS‑GMSC in a failure report as specified in 3GPP TS 29.002 [15] (negative outcome of \"forwardShortMessage\" see clause 10).\nIf errors are detected by the MSC or by the SGSN during the transfer on the radio interface, or by the IP-SM-GW, the error cause returned in the return error of the MAP procedure ForwardShortMessage shall be set as follows:\nFailure at the MSC , SGSN or IP-SM-GW\nReturn error to be included in the MAP‑proc\nRP‑ERROR message with error cause:\n22 Memory capacity exceeded\nSM_DeliveryFailure with\ncause \"MemoryCapacityExceeded\"1)\nOther error causes\nSM_DeliveryFailure with\ncause \"equipmentProtocolError\"1)\nCP or lower layer error\n(e.g. RR, layer 2 failure)2)\nSM_DeliveryFailure with\ncause \"equipmentProtocolError\"1)\nMobile has no SM capability\nSM_DeliveryFailure with\ncause \"equipmentNotSM‑Equipped\"1)0\nTR1N timeout 2)\nMNSMS‑error‑ind (No SAPI 3)\nSM_DeliveryFailure with\ncause \"equipmentProtocolError\"1)\nSIP transaction timeout in IP-SM-GW\nSM_DeliveryFailure with\ncause \"absentSubscriber\"1)\nSIP transport error (e.g. SIP failure response message) 3)\nSM_DeliveryFailure with\ncause \"equipmentProtocolError\"1)\n1)\tFor definition of MAP error SM_DeliveryFailure and its parameter \"cause\" see 3GPP TS 29.002 [15].\n2)\tThe error causes of the RP‑ERROR message, the CP layer and timer TR1N are defined in 3GPP TS 24.011 [13].\n3)\tThe failure response codes for the SIP MESSAGE request are defined in IETF RFC 3428 [44], and the failure response codes for SIP transaction timeout in IETF RFC 3261 [43].",
      "chunk_type": "general",
      "cross_references": [
        "clause_10",
        "ts_29.002",
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_11.2",
      "section_id": "11.2",
      "section_title": "Memory available notification",
      "content": "If errors are indicated by the HLR (via the VLR, the IP-SM-GW, or the SGSN) after invocation of the \"ReadyForSM\" operation, the MSC, the IP-SM-GW, or the SGSN shall return the appropriate error information to the MS in a failure report (i.e. a RP‑ERROR message) containing the following error cause:\nReturn error from ReadyForSM\n(Alert Reason is \"memory available\")\nCause value in the RP‑ERROR message\nDataMissing\nUnexpectedDataValue\nUnknownSubscriber\nFacilityNotSupported\nSystem Failure\n38 Network out of order\n38 Network out of order\n30 Unknown Subscriber\n69 Requested facility not implemented\n38 Network out of order\nLocal or lower layer failure\n(e.g. reject condition, timer expired or transaction abort)\n38 Network out of order\nNOTE:\tThe coding and the use of the RP‑ERROR message is specified in 3GPP TS 24.011 [13].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.011"
      ]
    },
    {
      "chunk_id": "ts_23.040_11.3",
      "section_id": "11.3",
      "section_title": "Mobile Originated short message transfer",
      "content": "If errors are indicated by the VLR after invocation of the \"sendInfoForMO‑SMS\" operation.(see clause 10), the MSC shall return the appropriate error information to the MS in a failure report (i.e. a RP‑ERROR message) containing the following error cause:\nReturn error from SendInfoForMO‑SMS\nCause value in the RP‑ERROR message\nDataMissing\n38 Network out of order\nUnexpectedDataValue\n38 Network out of order\nTeleserviceNotProvisioned\n50 Requested facility not subscribed\nCallBarred\n‑ barringServiceActive\n10 Call barred\n‑ operatorBarring\n8 Operator determined barring\nNOTE:\tThe coding and the use of the RP‑ERROR message is specified in 3GPP TS 24.011 [13]. The operation SendInfoForMO-SMS is not used by the SGSN.\nIf errors are indicated by the SMS‑IWMSC (negative outcome of the \"forwardShortMessage),) the MSC, the IP-SM-GW, or the SGSN shall send a failure report (i.e. a RP‑ERROR message) to the MS, with the error cause coded as follows:\nReturn error from ForwardShortMessage\nCause value in the RP‑ERROR message\nSystem Failure\n38 Network out of order\nFacilityNotSupported\n69 Requested facility not implemented\nUnexpectedDataValue\n38 Network out of order\nSM‑DeliveryFailure\ncause: unknownSC\n1 Unassigned number\nSM‑DeliveryFailure\ncause: SC‑Congestion\n42 Congestion\nSM‑DeliveryFailure\ncause: invalidSME‑Addr (NOTE 1)\n21 Short message transfer rejected\nSM‑DeliveryFailure\ncause: subscriberNotSC‑Subscriber\n28 Unidentified subscriber\nLocal or lower layer failure\n(e.g. reject condition,\ntimer expired or transaction abort)\n38 Network out of order\nNOTE 1:\tThis cause includes the case when the outcome of optional HLR interrogation is unacceptable (see clause 8.2.2)\nNOTE:\tThe coding and the use of the RP‑ERROR message is specified in 3GPP TS 24.011 [13].\nAnnex A (informative):Protocol stacks for interconnecting SCs and MSCs\nNo mandatory protocol between the Service Centre (SC) and the Mobile Switching Centre (MSC) below the transfer layer is specified by GSM/UMTS specifications; this is a matter of agreement between SC and PLMN operators. However, SC and PLMN operators can base these protocols on the following principles:\na)\tprovide the service defined for SM‑RL (see clause 9.3);\nb)\tbe based on widely accepted telecommunications protocols in the public domain;\nc)\tpermit open interconnection.\nAnnex B (informative):Information now contained in 3GPP TS 23.038 [9]\nAnnex B held information that is now contained in 3GPP TS 23.038 [9].\nAnnex C (informative):Short message information flow\nThe diagrams in this annex describe the flow of primitives and parameters during the short message transfer. These diagrams refer to specifications 3GPP TS 23.040, 3GPP TS 24.011 [13] and 3GPP TS 29.002 [15]. The parameters in dotted lines are optional. The abbreviations used in diagrams are listed below. The relevant specifications are given in parentheses. (*) stands for a common GSM/UMTS abbreviations and (‑) for a general abbreviation.\nCM\tCall Management (*)\nCS\tCauSe (‑)\nDA\tDestination Address (‑)\nDCS\tData Coding Scheme (3GPP TS 23.040)\nDI\tDialogue Identifier TCAP\nGMSCA\tGateway MSC Address\nGPRS\tGeneral Packet Radio Services 3GPP TS 23.060 [27])\nHLR\tHome Location Register (*)\nIMSI\tInternational Mobile Subscriber Identity (*)\nMAL\tMSIsdn‑Alert or IMSI-Alert (3GPP TS 23.040)\nMMS\tMore Messages to Send (3GPP TS 23.040)\nMR\tMessage Reference (3GPP TS 23.040)\nMS\tMobile Station (*)\nMSC\tMobile services Switching Centre (*)\nMSCA\tMSC Address\nMSI\tMobile waiting Set Indication (3GPP TS 23.040)\nMSIsdn\tMobile Station ISDN number (*)\nMSM\tMore Short Messages (3GPP TS 29.002 [15])\nMSRN\tMobile Station Roaming Number (*)\nMT\tMessage Type (3GPP TS 24.011[13])\nMTI\tMessage Type Indicator (3GPP TS 24.011[13])\nMWS\tMessage Waiting Set (3GPP TS 23.040)\nOA\tOriginating Address (‑)\nOC\tOperation Code (3GPP TS 29.002 [15])\nPCI\tProtocol Control Information (‑)\nPDI\tProtocol DIscriminator (*)\nPRI\tPRIority (3GPP TS 23.040)\nRCT\tReCeption Time (3GPP TS 23.040)\nREA\tREcipient Address (3GPP TS 23.040)\nRL\tReLay function (3GPP TS 24.011[13])\nRP\tReply Path (3GPP TS 23.040)\nSC\tService Centre (3GPP TS 23.040)\nSCA\tService Centre Address (3GPP TS 23.040)\nSCTS\tService Centre Time Stamp (3GPP TS 23.040)\nSGSN\tServing GPRS Support Node (3GPP TS 23.060 [27]\nSM\tShort Message (3GPP TS 23.040)\nSM‑AL\tShort Message Application Layer (3GPP TS 23.040)\nSME\tShort Message Entity (3GPP TS 23.040)\nSMI\tShort Message Identifier (3GPP TS 23.040)\nSM‑RL\tShort Message Relay Layer (3GPP TS 23.040, 24.011[13])\nSMS‑GMSC\tShort Message Service Gateway MSC (3GPP TS 23.040)\nSMS‑IWMSC\tShort Message Service Interworking MSC (3GPP TS 23.040)\nSoR\tStatus of Report (3GPP TS 23.040)\nSM‑TL\tShort Message Transfer Layer (3GPP TS 23.040)\nSRI\tStatus Report Indication (3GPP TS 23.040)\nSRR\tStatus Report Request (3GPP TS 23.040)\nTCAP\tTransaction Capabilities Application Part (‑)\nTID\tTransaction Identifier (*)\nUD\tUser Data (‑)\nUDL\tUser Data Length (3GPP TS 23.040)\nVLR\tVisitor Location Register (*)\nVP\tValidity Period (3GPP TS 23.040)\nVPF\tValidity Period Format (3GPP TS 23.040)\nNOTE:\tSMI is not carried via SM-RL of clause 9.3.5 but is carried via the relay service between the SC and GMSC (see clause 9.3.4.1).\nFigure C.1: Mobile terminated short message\nNOTE:\tA sequence of short messages shall have MMS set to 1 in each RP-MT-DATA except the last (last shall have MMS set to 0). Each RP-MT-DATA shall be carried via FORWARD SHORT MESSAGE via TCAP and shall be assigned the same Dialogue Identifier as previous RP-MT-DATAS in the sequence.\nFigure C.2: Mobile terminated short message\nNOTE:\tMR is of local significance to the MSC/MS interface and is not the value supplied to the MSC.\nFigure C.3: Mobile terminated short message\nFigure C.4: Mobile terminated short message\nFigure C.5: Acknowledgement in the MT case\nNOTE:\tThe cause carried via UD of TCAP is not the cause supplied via RP-ERROR but is the cause resulting from application of the mapping specified by table 8.5 of 24.011[13].\nFigure C.6: Acknowledgement in the MT case\nNOTE 1:\tThe MAP operation \"SetMessageWaitingData\" is invoked only if a cause \"Absent Subscriber\" is carried in TCAP UD.\nNOTE 2:\tThe cause delivered to the SC is not necessarily the cause carried via TCAP but is one of the set specified by table 03.40/1.\nFigure C.7: Acknowledgement in the MT case\nFigure C.8: Acknowledgement in the MT case\nNOTE:\tThe mapping of SMI to MR by the MS is a local matter.\nFigure C.9: Mobile originated short message\nFigure C.10: Mobile originated short message\nNOTE:\tMR is of local significance to the IWMSC/SC interface and is not the value supplied by the MS via the MS/MSC interface.\nFigure C.11: Mobile originated short message\nFigure C.12: Mobile originated short message\nFigure C.13: Acknowledgement in the MO case\nFigure C.14: Acknowledgement in the MO case\nFigure C.15: Acknowledgement in the MO case\nFigure C.16: Acknowledgement in the MO case\nAnnex D (informative):Mobile Station reply procedures\nD.1\tIntroduction\nThe reply procedures specified in this annex should be followed by a mobile station when replying to a short message, i.e. when generating a MO SM in response to a received MT SM, addressed to the originator of that MT SM. The main purpose of this annex is to specify how the MS selects the service centre for delivering that MO SM: an arbitrary SME may only be reached by submitting the reply SM to a specific SC, known to be able of delivering to that SME.\nD.2\tThe scope of applicability\nThe reply procedures in clauses 5 and 6 of this annex should be followed by every MS which fulfils the following criteria:\n1)\tThe MS automatically selects the value for the RP‑Destination‑Address parameter in RP‑MO‑DATA, or the MS has the SC address within the SM‑RL entity. (That is to say: the human user is not obliged to manually key in the SC address for every MO short message).\n2)\tThe MS or an application within it supports some form of replying to a MT SM with a MO SM. (That is to say: in the process of generating the reply MO SM, any reference whatsoever, implicit or explicit, is made to the original MT SM).\n3)\tThe replying support of (2) is to be equally available towards every SME.\nWhen an SME submits an SM to an SC for delivery, it may request that the SC sets the TP‑Reply‑Path parameter in the SM to be delivered. If the submitting SME is an MS, the reply path requesting procedure; in clause 4 of this annex may be applied. However, an SC may support the reply procedures without supporting the reply path requesting procedure; in that case, the SC sets the TP‑Reply‑Path parameter on another basis, which must be the case if the SM originates from an SME which is not an MS.\nD.3\tTerminology\nAn originating SME submits an original SM to an original SC, which delivers the original MT SM to a replying MS. The replying MS sends back a reply MO SM, a MO SM which is generated (automatically or by human operations) in response to the original MT SM, and which is addressed to the originating SME.\nIf the originating SME is an MS, the original MT SM is submitted within an SMS‑SUBMIT PDU; we say that reply path is requested if the TP‑Reply‑Path parameter is set in the SMS‑SUBMIT PDU of the original MT SM.\nWe say that reply path exists if the TP‑Reply‑Path parameter was set in the SMS‑DELIVER PDU of the original MT SM; we say that reply path does not exist otherwise.\nThe replying MS may have a default SC which is normally used for delivering all the MO short messages originated from the replying MS. Alternatively, a human user or automatic application may specify a selected SC for delivering a particular SM (thus the term selected SC refers to an SC address selected for one short message only).\nD.4\tThe reply path requesting procedure\nThe discussion in this clause applies to cases when the originating SME is a mobile station only. The reply procedures discussed in the clauses to follow this one are independent of the type of the originating SME.\nThe reply path is requested by the originating SME (an MS) by setting the TP‑Reply‑Path parameter in the SMS SUBMIT PDU of the original SM. If the original SC supports reply path requesting for the originating SME (an MS), it shall take notice of the TP‑Reply‑Path parameter in the SMS‑SUBMIT PDU and set the TP‑Reply‑Path parameter in the SMS‑DELIVER PDU of the original MT SM towards the replying MS. Hence, reply path exists for the replying MS towards the originating SME (an MS).\nD.5\tThe reception of an original MT SM\nWhen a replying MS receives an original MT SM, it then has:\n1)\toriginating SME = TP‑Originating‑Address in the SMS‑DELIVER PDU,\n2)\toriginal SC = RP‑Originating‑Address in RPS‑MT‑DATA, and\n3)\treply path exists/reply path does not exist = TP‑Reply‑Path in SMS‑DELIVER PDU (set/not set).\nD.6\tThe submission of the reply MO SM\nAccording to clause 5, the replying MS knows if:\na)\treply path exists; or\nb)\treply path does not exist.\nWe then specify that when submitting the reply MO SM, the replying MS should use parameters as follows:\n1)\tTP‑Destination‑Address in SMS‑SUBMIT PDU = originating SME,\n2a)\tIf reply path exists:\nRP‑Destination‑Address in RP‑MO‑DATA = original SC,\n2b)\tIf reply path does not exist:\nRP‑Destination‑Address in RS‑MO‑DATA = selected SC or default SC or original SC,\n3a)\tIf reply path exists:\nafter submitting one reply MO SM, the reply path does not exist any more.\nIn case (2b), it is allowed to use the original SC or the default SC, but then there is no guarantee that the original/default SC shall deliver the reply MO SM. (The original SC may refuse to deliver, if the replying MS is not its subscriber; the default SC may be unable to deliver, if it has no access path to the originating SME.)\nRequirement (3a) states that the case (a), reply path exists, holds for one reply MO SM only (per original MT SM).\nD.7\tUsage of SCs for replying\nThe specification in this annex supports the following way of replying.\nThe original MT SM and the reply MO SM are delivered by the same SC, the original SC. This principle maximizes the probability that the SC can e.g. route the reply MO SM to the proper data network for reaching the originating SME; this principle is a must, if the originating SME is integrated within the original SC.\nIf the original SC by any means whatsoever knows that it is both willing and able to deliver one (potential) reply MO SM, it may indicate this fact by setting the TP‑Reply‑Path parameter in the original MT SM. The original SC thus commits itself to delivering one reply MO SM; let us call this reply delivery commitment.\nOne reason for the SC to make the reply delivery commitment may be the reply path requesting procedure specified in clause 4 on this annex.\nThe reply path commitment is not valid forever, but the original SC may have e.g. a time limit for maintaining this commitment.\nD.8\tReplying possibilities for Phase 1 mobile stations\nThe Phase 2 mobile stations should support the procedures in this annex (if they fulfil the criteria in clause 2 of it). Yet, Phase 1 mobile stations, too, may apply steps (1) and (2a) in clause 6 of this annex, i.e. reply via the original SC, automatically or manually (by choosing selected SC = original SC), despite the fact that the TP‑Reply‑Path parameter shall be ignored by them. The delivery of the reply MO SM cannot be guarantied in this case, yet the possibility of delivery may be improved (especially if the originating SME is not an MS).\nD.9\tThe resulting service for originating SMEs\nAs the consequence of the replying procedures specified in this annex, all SMEs and applications within them may assume that replying from all mobile stations is always possible, provided that the mobile stations do support the proper replying mechanism itself (human response in context with the original MT SM, automatic replying by an application, application level protocols, etc.).\nAnnex E (normative):Extended Object Format Type\nE.1\tPredefined Sound\nThe predefined sound as integrated in the Extended Object IE is structured as follows:\nOctet 8\tSound number as defined in table of clause 9.2.3.24.10.3.1.\nE.2\tiMelody\nAn iMelody object [33] can be integrated in an Extended Object IE with the following structure:\nOctet 8..n\tiMelody object coded according to the iMelody format [33].\nE.3\tBlack and white bitmap\nThe user-defined black and white bitmap as integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10..n\tPicture data, pixel by pixel from top left to bottom right. The picture data is encoded as a continuous sequence of bits. There shall be no fill bits at the end of each row of data, Fill bits may only be used in the last octet of the picture data if needed. The fill bits in the last octet shall be ignored. Within each octet the MSB represents the leftmost pixel.\nThe colour values are encoded as follows:\nBit Value\tColour0\t\tWhite1\t\tBlack\nE.4\t2-bit greyscale bitmap\nThe user-defined 2-bit greyscale bitmap as integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10..n\tPicture data, pixel by pixel from top left to bottom right. The picture data is encoded as a continuous sequence of bits. There shall be no fill bits at the end of each row of data, Fill bits may only be used in the last octet of the picture data. The fill bits in the last octet shall be ignored.The pair of bits at the MSB represents the leftmost pixel of the four defined in an octet.\nThe colour values are encoded as follows:\nBit Value\t\tColour00\t\tBlack01\t\tDark Grey10\t\tLight Grey11\t\tWhite\nE.5\t6-bit colour bitmap\nThe user-defined 6-bit colour bitmap as integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10..n.\nPicture data, pixel by pixel from top left to bottom right. The picture data is encoded as a continuous sequence of bits. There shall be no fill bits at the end of each row of data, Fill bits may only be used in the last octet of the picture data. The fill bits in the last octet shall be ignored.\nEach pixel colour is represented by 6-bits of data, giving a total of 64 colours. (2 bits of data define the levels of each red, green and blue). The overall pixel colour is a composite of the three RGB values.\nThe first pair of bits of picture data define the level of red of the topmost, leftmost pixel, the next pair of bits the level of green for this pixel, and the third pair the level of blue for the pixel. The first bit of a pair defining a colour level is the MSB. This is illustrated below.\nOctet 1\nBit 7\nBit 6\nBit 5\nBit 4\nBit 3\nBit 2\nBit 1\nBit 0\nMSB Red\nPixel 1\nLSB RedPixel 1\nMSB Green\nPixel 1\nLSB Green\nPixel 1\nMSB BluePixel 1\nLSB BluePixel 1\nMSB RedPixel 2\nLSB Red\nPixel 2\nOctet 2\nBit 7\nBit 6\nBit 5\nBit 4\nBit 3\nBit 2\nBit 1\nBit 0\nMSB Green\nPixel 2\nLSB Green\nPixel 2\nMSB BluePixel 2\nLSB BluePixel 2\nMSB RedPixel 3\nLSB Red\nPixel 3\nMSB Green\nPixel 3\nLSB Green\nPixel 3\nE.6\tPredefined animation\nThe predefined animation as integrated in the Extended Object IE is structured as follows:\nOctet 8\tAnimation number as defined in table of clause 9.2.3.24.10.3.3.\nE.7\tBlack and white bitmap animation\nThe user-black and white animation is integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels.\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10\tThe number of frames in the animation.\nOctet 11\tAnimation control byte.\nBits\nMeaning\n7 – 4\nFrame display. The value (in tenths of a second) that is requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e. 1.6 s)\n3 – 0\nRepeat value. The requested number of repetitions of the animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions\nOctet 12..n\tContains a series of bitstreams encoding 1 bit pixel depth bitmaps as defined in F.3. If a frame in the animation would require fill bits (as described in F.3) these shall be contained at the end of the frame such that the bit-stream for the next frame begins on an octet boundary.\nE.8\t2-bit greyscale bitmap animation\nThe user-black and white animation is integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels.\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10\tThe number of frames in the animation.\nOctet 11\tAnimation control byte.\nBits\nMeaning\n7 – 4\nFrame display. The value (in tenths of a second) that is requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e. 1.6 s)\n3 – 0\nRepeat value. The requested number of repetitions of the animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions\nOctet 12..n\tContains a series of bitstreams encoding 2 bit pixel depth bitmaps as defined in F.4. If a frame in the animation would require fill bits (as described in F.4) these shall be contained at the end of the frame such that the bit-stream for the next frame begins on an octet boundary.\nE.9\t6-bit colour bitmap animation\nThe user-black and white animation is integrated in the Extended Object IE is structured as follows:\nOctet 8\tHorizontal dimension of picture.This octet shall contain the horizontal number of pixels.\nOctet 9\tVertical dimension of picture.This octet shall contain the vertical number of pixels.\nOctet 10\tThe number of frames in the animation.\nOctet 11\tAnimation control byte.\nBits\nMeaning\n7 – 4\nFrame display. The value (in tenths of a second) that is requested between each frame: 0000 1 tenth (i.e. 0.1s) 1111 16 tenths (i.e. 1.6 s)\n3 – 0\nRepeat value. The requested number of repetitions of the animation: 0000 Unlimited repetition 0001 1 repetition 1111 15 repetitions\nOctet 12.n\tContains a series of bitstreams encoding 6 bit pixel depth bitmaps as defined in F.5. If a frame in the animation would require fill bits (as described in F.5) these shall be contained at the end of the frame such that the bit-stream for the next frame begins on an octet boundary.\nE.10\tvCard\nA vCard object [36] can be integrated in a Extended Object IE with the following structure:\nOctet 8.n\tvCard object as defined in [36]. The UTF-8 encoding is used instead of the default 7-bit ASCII. For certain vCard properties, other encoding can be used by setting the CHARSET property parameter to the appropriate character set.\nE.11\tvCalendar\nA vCalendar object [37] can be integrated in a Extended Object IE with the following structure:\nOctet 8..n\tvCalendar object as defined in [37]. The UTF-8 encoding is used instead of the default 7-bit ASCII. For certain vCalendar properties, other encoding can be used by setting the CHARSET property parameter to the appropriate character set.\nE.12\tData Format Delivery Request\nThis Data Format Delivery Request is an optional feature used by an SME to indicate which Extended Object data formats, listed in clause 9.2.3.24.10.1.11, it is requesting for delivery. This Data Format Delivery Request may be included by an SME in a MO SM containing other EMS related data, or in a MO SM independently. Processing of this data format is optional in a MT short message.\nThe information in this data format represents an extensible bit field with the first bit being mapped to the first Extended Object (EO) data format defined in the table in clause 9.2.3.24.10.1.11.\nOctet 8\nBit 0: If set to 1 indicates support for EO data format 00\nBit 1: If set to 1 indicates support for EO data format 01\nBit 2: If set to 1 indicates support for EO data format 02\n……\n……\nOctet n\nBit 0: If set indicates support for EO data format ((n – 8) * 8)\nBit 1: If set indicates support for EO data format ((n – 8) * 8) + 1\nBit 2: If set indicates support for EO data format ((n – 8) * 8) + 2\n…….\nAny unused bits in the last octet shall be set to zero.\nE.13\tStandard WVG Object\nThe Standard WVG object as defined by Format Type 0x0B in the Extended Object IE is as follows.\nOctet 8..n\tStandard WVG object bit stream\nThe unused bits in the last octet will be filled with 0\nThe detailed data format and attributes of Standard WVG object are defined in Annex G.\nThe bit order is defined as follows:\nThe octet with a smaller octet number stores the bits appearing in the front position in the bit stream; the most significant bit in an octet stores the first bit in position in a 8-bit segment in the bit stream.\nA Standard WVG object may or may not have fixed size. In either case, display size should be determined by the terminal implementation. Recommended display size is a largest possible size on terminal screen while aspect ratio shall be maintained.\nE.14\tPolyphonic melody\nA Polyphonic melody can be integrated as an extended object in one or more short messages. Informative guidelines for the creation of polyphony content using SP-MIDI [38] are listed in Annex H.\nHowever, in order to guarantee the interoperability with legacy mobile devices which are not able to interpret specific SP-MIDI content, the following considerations shall be taken into account for content creation:\n-\tWhen content is not provided in SP-MIDI format the presence of the MIP table in polyphonic extended objects is not mandatory. Since a receiving SME supporting polyphonic extended objects may decide to ignore and skip the content of a MIP message by implementing its own note stealing or channel masking strategy when played. However, when SP-MIDI format data is present and the message is stored and subject to potential forwarding, the specific SP-MIDI content shall be kept as received by the SME.\n-\tthe additional rhythm channel as specified in clause 3.2 in [38] might not be supported by the receiving SME.\nOctet 8..n\tSMF as defined in [38], [40]\nAnnex F (informative) : Compression methods for EMS\nF.1\tLZSS compression\nF.1.1\tIntroduction\nThe LZSS compression algorithm is one of a number of compression algorithms generally referred to as “Dictionary Methods”.  These algorithms rely upon the fact that (in general) an input data buffer will contain repeating “patterns” or matching sequences of bytes.\nThe algorithms fall into 2 groups.  Systems like LZ78 and LZW scan an input buffer and construct a “dictionary” of the most commonly occurring byte sequences or “phrases”.  This dictionary is pre-pended with the compressed data and the compressed data comprises an array of indices into the dictionary.\nA second set is a modification of this in that the data dictionary is implicit in the uncompressed data buffer. All are based upon an algorithm developed and published in 1977 by Abraham Lempel and Jakob Ziv LZ77.  A refinement of this algorithm, which is the basis for practically all the later methods in this group, is the LZSS algorithm developed in 1982 by Storer and Szymanski.  These methods try to find if the character sequence currently being compressed has already occurred earlier in the input data and then, instead of repeating it, output only a pointer to the earlier occurrence. This is illustrated in the following diagram:\nFigure F.1\tIllustration of  “Implicit Dictionary” compression methods\nF.1.2\tLZSS Basic Algorithm\nThe algorithm searches the window (a buffer moving back from the current position in the input data). It searches for the longest match with the beginning of the look-ahead buffer (a buffer moving forward from the current position in the input data) and outputs a pointer to that match.  This pointer indicates a position and length of that data match.  It is referred to here as a “Slice Descriptor”.\nSince it is possible that not even a one-character match can be found, the output cannot contain just pointers.  Accordingly at times it is necessary to write literal octets into the output buffer.  A block of literal octets is preceded by a “Literal Block Identifier” which indicates the length of the literal octet sequence that follows.\nF.1.3\tInformative Example.\nThe following is provided as an informative example using the input buffer shown below.\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n0x01\n0x02\n0x03\n0x01\n0x02\n0x03\n0x04\n0x01\n0x02\n0x03\n0x01\n0x02\n0x03\n0x01\n0x02\n0x03\nFigure F.2\tSample input buffer (16 octets long)\nStep 1:\nStarting position is byte 1 in the input buffer.  For octets 1 to 3 there are no octet matches in the window for the look-ahead buffer.  So write a literal octet sequence of 3 octets following a literal block header.\n1\n2\n3\n4\n0x83\n0x01\n0x02\n0x03\nFigure F.3\tOutput buffer after initial literal block is written\nStep 2:\nCurrent position is octet 4.  Examining the look-ahead buffer and the window a 3 octet match is found beginning 3 octets before (octet 1) and of 3 octets in length.  A 2 octet slice descriptor is added to the output buffer. The current position moves to octet 7 of the input buffer.\n1\n2\n3\n4\n5\n6\n0x83\n0x01\n0x02\n0x03\n0x06\n0x03\nFigure F.4\tOutput buffer after the first slice descriptor is written\nStep 3:\nCurrent position is octet 7 in the input buffer  (0x04).  There are no matches in the window for this value so a 2 octet literal sequence is written to the end of the output buffer.  The current position moves to octet 8 of the input buffer.\n1\n2\n3\n4\n5\n6\n7\n8\n0x83\n0x01\n0x02\n0x03\n0x06\n0x03\n0x81\n0x04\nFigure F.5\tSecond literal block is written into output buffer\nStep 4:\nCurrent position is octet 8 of the input buffer.  Comparing the window with the look-ahead buffer reveals a octet match from the current position with octets 1 to 6 of the input buffer.  That is a 6 octet sequence beginning 7 octets back from the current position..  A two-octet slice descriptor for this match is added to the output buffer.  The current position moves to octet 14 of the input buffer (6 octets further on).\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n0x83\n0x01\n0x02\n0x03\n0x06\n0x03\n0x81\n0x04\n0x0C\n0x07\nFigure F.6\tOctet match slice descriptor is written into output buffer\nStep 5:\nCurrent position is octet 14 of the input buffer.  Comparing the window with the look-ahead buffer reveals another 3 octet sequence match (0x01, 0x02, 0x03).  This octet sequence occurs several times in the window within the 511 octets that the slice descriptor allows.  Therefore several different (but valid) slice descriptors could be written (this would be implementation dependent).  However in this example we will reference the initial 3 octets of the input buffer and write a slice descriptor indicating a 3 octet match beginning 13 octets behind the current position.\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n0x83\n0x01\n0x02\n0x03\n0x06\n0x03\n0x81\n0x04\n0x0C\n0x07\n0x06\n0x0D\nFigure F.7\tOctet match slice descriptor is written into output buffer: the final output buffer\nAnnex G (normative): WVG (Wireless Vector Graphics) data format\nWVG (Wireless Vector Graphics) is a compact binary data format for vector graphics. WVG data is represented by a bit stream, composed of a header, codec parameters and graphical elements. The bit representation of the drawing and contained graphical elements is designed such that the bit stream can be optimized for smallest possible size.\nG.1\tIntroduction\nG.1.1\tStandard and Character Size WVG elements\nA Standard WVG element is defined by the complete WVG specification. Using a set of the WVG specification with a set of default values, a simplified vector graphics can be used to represent a simple and small vector graphics or glyph. Character Size WVG elements can be included in normal text to represent a handwritten character or symbols that are not supported by character coding system and the font library.\nG.1.2\tCompression methods\nA combination of compression methods is used in the WVG to achieve the best compression ratio for simple vector graphics and animations. They include:\n-\tswitchable linear or non-linear coordination system: when graphical elements in a drawing are not evenly distributed, the representation of coordinates can be optimized using a non-linear coordinate system (uneven coordinates)\n-\tbit packing: variable number of bits to represent a number. The number of bits used in WVG can vary from 1 bit to 16 bits.\n-\tlocal envelope: use a dedicated coordinate system to describe elements in a small area using relatively small coordinate numbers\n-\tvariable resolution: in coordinates, sizes, angles, scale and etc, different resolutions can be used for a graphical element to save the number of bits needed for representing a value.\n-\tpalettes: color and element ID can be mapped using a palette defined in the drawing header. This also saves the number of bits for representing a color value and an element ID.\n-\tdefault values: many values can be omitted to use default values. E.g. when no color scheme is defined, the data describes a mono drawing\n-\tdefault animation timing: in addition to standard time based animation, WVG uses a simplified animation model. In Simple Animation mode, no timing is needed for describing animations. Instead, a cycle is defined to describe the timing for these animations.\nG.1.3\tCoordinate Systems\nThere are two coordinate systems used in WVG, namely Compact Coordinate System and Flat Coordinate System.\nG.1.3.1\tCompact Coordinate System\nIn compact coordinate system, a drawing area is defined as rectangle area called envelope. There are two types of envelopes, global envelope and local envelope. The global envelope is a base area in which the drawing is contained. There is only one global envelope. A local envelope is a square area completely or partially within the global envelope. There is no specific global envelope size specified in the data format. The physical display size is decided at rendering time.\nThe aspect ratio and orientation are defined in the data header and should be maintained when the drawing is displayed.\nAspect ratios include 1:1, 4:3, 16:9 up to 1024: 729 (height:width), in both portrait and landscape orientation. Aspect ratio for Characters Size WVG elements only has landscape orientation.\nIn Compact Coordinate System, coordinates are restricted to certain positions which are the cross points of a grid. The grid is defined in the WVG data header, set by a group of parameters. The grid lines along with x axis or y axis may be unevenly distributed.\nThe global grid can be described using a curve shown above.\nThere are one peak and two valleys in the curve. The definition of the curve is:\n-\tpeak position: the central position of a peak;\n-\tpeak value: a value equal or larger than 1,0;\n-\tpeak width: a value less than 1,0.\nAll valleys should have the same value.\nThe total area enclosed by the curve and the x-axis from 0,0 to 1,0 is always equating to 1,0.\nThe curve can be uniquely defined by peak position, peak value and peak width. Once the parameters are determined, other values such as valley value can be calculated. Once a curve is given, grid line positions can be calculated according to the following function:\n=\nWhere Xk is the position of the kth grid line, where n is total number of grid lines. d(x) is the curve function described in the present document.\nIn standard WVG, the curve parameters are preset as follows.\nVariable parameters:\n-\tnumber of grid lines: 15, 31, 63 or 127;\n-\tpeak value: 1,0, 1,5, 2,0 and 2,5;\n-\tpeak position: 13 options from 0,0 (0/12), 0,083333 (1/12), 0,166667 (2/12) to 1,0 (12/12);\n-\tpeak width: 0,3, 0,4, 0.5 and 0,6.\nWhen a portion of a peak exceeds the global envelope only the part within the global envelope is valid.\nFor Character Size WVG or glyph, the parameters are set as follows.\nPredefined parameters:\n-\tpeak width: 0,4.\nVariable parameters:\n-\tnumber of grid lines: 7, 15, 31 or 63;\n-\tpeak value: 1,0 or 1,5;\n-\tpeak position: 0,3333 (1/3), 0,5, 0,6667 (2/3).\nWhen using relative coordinates in Compact Coordinate System (refer to clause G 1.3.3), some elements may be specified with specific resolution, which is independent of the global resolution. There are 8 predefined resolutions available for \"re-definition resolution\", there are 1/27, 1/38, 1/48, 1/64, 1/85, 1/128 and 1/160 of the length of the shorter global envelope edge. Re-definition of resolution only applies to elements in global scope.\nG.1.3.2\tFlat Coordinate System\nThe Flat Coordinate System is a 16 bit signed coordinate system with the top left coordinate of the screen being defined as (x=0,y=0) and the bottom right coordinate being described as (x=2^15, y = 2^15). Note that this expresses the dynamic range of the coordinate system, however it does not mean that all drawings are of this size.\nG.1.3.3\tCoordinate values\nCoordinate values may be represented using two methods: absolute coordinate and relative coordinate.\nAbsolute Coordinate: an absolute coordinate is a pair of x and y coordinate number. In WVG Compact Coordinate System, absolute coordinate values are the coordinate grid line numbers and are always positive.\nRelative Coordinate: the relative coordinate is used only in lines and transform. If the start point is defined by an absolute coordinate, subsequent points can be described by relative coordinates, which are relative grid units from the previous point. A relative coordinate is signed, and it may be positive or negative. A relative coordinate may be used in both global and local coordinate systems. A relative coordinate may exceed the scope of the local envelope that defines the start point of the line.\nG.1.4\tColor schemes\nWVG supports the following color schemes.\n-\tBlack and white (2 Colors): black and white color.\n-\t2-bit grayscales: four grayscales are defined as (0,0,0), (85,85,85), (170,170,170) and (255,255,255) in 24-bit RGB color format.\n-\t4 default colors.\n-\t6-bit RGB color: it is similar to 24-bit RGB color definition but uses only 2 bits to represent a single color, in which value 0, 1, 2 and 3 represent 8-bit color value 0, 85, 170 and 255 respectively.\n-\t6-bit RGB color using 2nd palette.\n-\t8-bit websafe color.\n-\t12-bit and 24-bit RGB color.\nThere are 2 optional drawing pens in WVG, stroke pen and fill pen. Stroke pen and fill pen can be specified with one of the colors defined using the scheme. When the stroke pen is not defined, BLACK should be used for strokes. When the fill pen is not defined, no fill should be applied.\nG.1.5\tRendering model\nWVG uses painter model. The elements appears in the later position in the WVG bit stream will overrides the overlapped portion of the elements which appear in the front in the bit stream.\nG.2\tGraphical elements\nWVG defines a set of graphical and animation elements. Among them, line, shape and text elements are the building blocks to form a drawing. These elements can be transformed, grouped and animated. There are also special elements that are auxiliary.\nG.2.1\tLine elements\nThere are 3 types of lines: polyline, circular polyline and bezier polyline. A polyline can represent a dot when there is only a start point defined.\nA line element has its reference point at the starting point. A reference point of an element specifies the location of the element.\nG.2.1.1\tPolyline\nPolyline is a set of straight lines connecting a sequence of points. When there is only one point, it is defined as a dot.\nG.2.1.2\tCircular Polyline\nCircular Polyline is a line that contains at least one circular curve segment. The curve segment connects two adjacent points by a circular arc. The curve segment is determined by the two adjacent points and a curve offset (the perpendicular distance from the center of the line connecting the adjacent points to the circular arc).\nCurve offset values are within the range – 0,5 to 0,5, inclusive. A value of 0,5 or – 0,5 identifies that the curve offset equals half of length of the connecting line. The value indicates that the curve is close to a half circle. A positive value indicates that the curve is at the left side of the base line viewed from the curve direction. A negative value indicates that the curve is at the right side of the base line viewed from the curve direction.\nG.2.1.3\tBezier Polyline\nA Bezier Polyline contains one or more off curve control points in between on curve points. Bezier curves can be filled to create curved shapes and are common in generalized font representations.\nAll line elements have direction from the start point to the end point.\nColor fill may apply to a line. Refer to clause G.2.1.4.\nG.2.1.4\tAuto-closure of a line\nWhen a line is specified with the fill attribute, the line is considered as a closed line, which connects the start point and the end point using a straight line. The enclosed area of a closed line can be used for color fill.\nThe enclosed area is based on nonzero fill rule. Following are two examples in which the light color indicates the enclosed area.\nG.2.2\tPolygon elements\nPolygon elements are closed representations of polyline, circular polyline and Bezier polyline elements. Polygons may have separate line and fill colors or may not be filled at all.\nPolygon elements use the nonzero fill rule for enclosed areas and can be used for color file.\nA polygon element has its reference point at the starting point.\nG.2.3\tSimple shape elements\nSimple Shapes are rectangles and ellipses. A simple shape is defined by width, height, center point, and angle of rotation. The angle parameter defines how much the shape should be rotated about its center from a horizontal axis drawn through its center.  Note that angle units are specified in the main header.\nG.2.3.1\tEllipse\nEllipses are defined by their major axis, minor axis, center and angle of rotation. Circles are considered a special case of ellipse in which the major and minor axis are the same length.\nG.2.3.2\tRectangle\nRectangles are represented by their center, width, height, and rotation angle. Squares are considered special rectangles in which the width and height are identical.\nWhen the \"round corner\" indicator is set, the corner of the rectangle should be rounded. There is no specific radius of the round corner is defined. The recommended radius of the rounded corner should be 20% of the length of the shorter edge of the rectangle or the square.\nA simple shape element has its reference point at its center.\nG.2.4\tSpecial shape elements\nThere are 3 types of special shapes. These shapes are Regular Polygons, Stars, and Grids. Each shape has a reference point that determines its position for the purpose of transformations such as detailed in G2,8,1 and G,4. Shapes may have other parameters. These shapes include:\n-\tRegular polygon: a regular polygon has equal length of all its edges. In its original position, the bottom edge of the regular polygon should be aligned horizontally. A rotate angle can be optionally specified. Regular polygon parameters include the number of vertex, the diameter of the reference circle and angle of rotation.\n-\tStar: a star is defined by the number of corner vertex, the diameter of the reference circle, vertex angle and angle of rotation. In its original position, the bottom edge, which formed by two vertexes of the star, should be aligned horizontally. A rotate angle can be optionally specified. Vertex angles are predefined as 0, 36, 60, 90 degrees.\nIf the vertex angle is 0, a single line from center to vertex shall be drawn.\n-\tGrid: a grid is a number of evenly distributed perpendicular lines. Its parameters include height, width, angle and number of rows and columns (up to 16).\nA special shape element has its reference point at its center.\nG.2.5\tText element\nWVG supports text display inside the drawing. However it supports only the default font. To avoid inconsistency on different terminals, it is recommended to use vector based font. Text can be placed in a drawing with position, font size and rotate angle. Like other elements, text has attributes of line style, line color, line width. It can also be animated.\nControl characters are ignored when the text is rendered except for the CR (Carriage Return). The CR indicates the text followed by should be displayed at the next line position. Multi-line text should be left aligned. There is no character spacing and line spacing defined. Recommended character spacing is 10% of the text height. Recommended line spacing is 20% of the text height.\nA text element has its reference point at top-left corner.\nG.2.6\tGroup elements\nA set of elements can be grouped together.\nThe Group element is used to mark the start and end of grouped elements. A group of elements starts with a Group element which has the end-group indicator off, followed by a list of  elements in the group, and ends with an Group element which has the end-group indicator on. Groups can be nested. Implementation must support at least 2 levels of nested group.\nGroup (start)\nElement 1\nElement 2\n……\nGroup (start)\nElement a\nElement b\n……\nGroup (end)\nElement n\nElement n+1\n…..\nGroup (end)\nG.2.7\tReuse element\nReuse element can be used to display an element or a group of elements with a transform and/or changed attributes and/or display an array. Whether a reuse element references a group or a basic element depends on the element type that the element_index in the reuse element points to. When reuse array is specified, the referenced element or group of elements is duplicated in rows and columns. The reference point of a reused array is at the reference point of the top-left element in the array.\nG.2.8\tAnimation elements\nThere are two types of animation elements, Simple Animation Element and Standard Animation Element. In the data format, a simple animation element is followed by another element or a group element that the animation applies to. A standard animation element has pointer or index that points to another element or a group element.\nG.2.8.1\tSimple animation elements\nSimple animation is defined for WVG. All animation timing is based on an \"Animation Cycle\". WVG animation is repetitive. After completion of playing one cycle, a subsequent cycle play commences immediately.\nThere are two types of animation cycles defined, short cycle and long cycle. The time length of animation cycles are not defined. The time length of a long cycle should be twice the length of a short cycle. Recommended short cycle should collapses for 1 second and long cycle pay for 2 seconds.\nThere are two types of animations.\nVisibility: an element can be visible or invisible during a specific cycle segments. A short cycle is divided into 4 time segments equally and a long cycle is divided into 8 time segments equally.\nIn the following example, a visibility for short cycle animation is defined. The element to be animated will blink following the pattern defined in the Visibility field below. Bit 1 indicates the element should be displayed during the time segment. Bit 0 indicates it should not be displayed during the time segment.\n0\n1\n0\n1\nIn the following example, a visibility for long cycle animation is defined. The element to be animated will blink following the pattern defined in the visibility field below.\n1\n0\n1\n0\n1\n1\n1\n1\nRound Rotation: an element can be rotated at clockwise or counter-clockwise directions.\nTransform: a start and an end transform can be applied to an element to describe the start and end position of a rotate, a scale, a translate animation or any combination of these action. When a transform element is omitted, it defaults to use the element's original position. An animation element must include at least one transform element. The animated element can also be a group to allow the animation action applied to a group of elements.\nIn simple animation, a transform from start position to end position should be completed in one cycle. A bounced flag can be turned on to allow \"bouncing\" animation. A bounced transform transforms the element from start position to end position in one cycle.\nTransform in a short cycle:\nstart status\t\tend status\nBounced Transform in a short cycle:\nstart\t   end\t\tstart\nstatus\t   status\tstatus\nTransform in a long cycle:\nstart status\t\t\t\t\tend status\nBounced Transform in a long cycle:\nstart\t\t\tend\t\t\tstart\nstatus\t\t\tstatus\t\t\tstatus\nVisibility and transform animation can be applied to the same element.\nG.2.8.2\tStandard Animation Element\nA Standard Animation Element contains animation information such as begin transform position, end transform position, begin color, end color, begin time, end time, etc. This allows one animation element to represent a series of related images, which results in significant compression of the data stream. The WVG player interpolates between the beginning state and end state to achieve animation.\nAnimation elements are not allowed inside groups. Animation rotation ranges from 0 to 360 degrees in both clockwise and counter-clockwise directions.\nG.2.9\tFrame Element\nFrame Element is as a marker of the start of a new frame. All elements before a frame element belong to previous frame. The delay between two frames is defined as an infinite time interval. This means says that once a frame marker is reached, the elements that have been displayed on the screen at this time will stay on the screen until the user requests that the next frame should be displayed. The idea is that one can have multiple \"pages\" of graphics, such as a multi-page cartoon. The user can then study the first page and when finish can press a button (or trigger some other event) to see the next page of the cartoon. The mechanism of the user event is not defined and is left up to the application developer.\nHere are parameters of a frame element:\n-\tkeep last frame contents (or not). Zero means not keeping last frame contents, otherwise all the contents of previous frame will be kept.\n-\tfill in a new background color (or not). Zero means no new fill color is needed for this frame, otherwise a new background color will be used.\n-\tnew background color.\nA frame element cannot appear in an element group. Reuse and animation elements can not apply to a frame element.\nG.2.10\tLocal Element\nThis element defines the size and position of a local envelope.\nThe local envelope is a square area whose top-left corner is defined as the origin for its x and y-axis. The number of grid lines are pre-defined to 7, 15, 31 and 63. The resolution is constant in a local grid which is pre-defined at 1/27, 1/32, 1/48, 1/64, 1/85, 1/128, and 1/160 of the local envelope width. Actual envelope size can be determined by number of grid lines and grid resolution. The position of the local envelope is determined by the local envelope origin that falls at a coordinate within the global envelope.\nA local element cannot appear in between another local start and local end element.\nG.2.11\tExtended Element\nThe Extended Element is defined to create objects which are not part of the base parsing level of defined objects in the present document and as a future proof method of expansion as defined by 3GPP technical committees. The extended element is intended for resolving problems in the current release. It may also be possible to use the extended element for potential enhancements in future releases. If the decoder encounters an extended element and the extended element type is unrecognized, it can gracefully skip this element by seeking past it in the bitstream, and continuing decoding at the next element in the bitstream.\nAn extended element contains the size of the extended element, the extended element type, and a series of bytes representing the payload data. The size field represents the payload data size in bytes. Note that when reading the payload data, bit alignment should be assumed (not byte alignment).\nG.3\tElement attributes\nEach element has a number of attributes such as pen color, fill color and line width used for stroking. The following elements Line, polygon, shape and text elements have the listed attributes.\n-\tLine width: 3 levels (fine, medium, thick). Default is fine.\n-\tLine style: 4 types (solid, dash, dot and reserved). Default is solid.\n-\tPencolor and fill color.\nLine Width:\nThere are 4 line width settings defined, namely \"No Line\", \"Fine\", \"Medium\" and \"Thick\". No specific width is defined for \"Fine\", \"Medium\" and \"Thick\". Recommended line widths are 1% or one pixel, 2% and 4% of the shorter dimension of the drawing. Line width for \"Fine\", \"Medium\" and \"Thick\" should be at least 1 pixel. E.g., in a 120 x 80 pixel screen, the line width may appear as 1 pixel, 2 pixels and 3 pixels.\nLine Type:\nDash Line: a dash line should start with a solid segment of the line. The length of the solid segments is recommended to be 4 to 6 times of the line width. The space between two solid segments is recommended to be 3-4 times of the line width.\nDotted Line: a dotted line is a string of circular dot on the path of a line. It is recommended that the diameter of rounded dot is same as the line width. The space between two dots shall be between 1 to 2 dot diameters.\nLine Cap:\nLine cap is Circular.\nLine Joint:\nLine joint is Round for line joint.\nG.4\tElement Transform\nThe Transform element is used to scale, rotate, or translate any single element or group of elements. Multiple transforms may be applied in succession to any element by standard matrix concatenation. The transform element may be included in Group, Reuse and Animation elements and applied to line, polygon, shape, text and group elements.  The sequence of applying transform operations is scale->rotate->translate.\nG.5\tCharacter Size WVG Element\nThe character size WVG, or glyph is a subset variation of WVG. Character Size WVG uses a compact coordinate system with a half resolution global grid (7, 15, 31 and 63 grid lines), default color (monochrome), line elements (polyline, circular polyline and Bezier polyline) and a simplified drawing header.\nG.6\tData Format BNF\nThe following notation is used in the present document for BNF syntax:\n< >\nEnclose term names\n|\nSeparates alternatives (exclusive OR)\n[ ]\nSquare brackets enclose optional items in syntax descriptions.\n{ }\n{} Term enclosed is used zero or more times\n()\n() Enclose groups of alternative terms\n…\nFrom … to\n;\nStart with comments\n0\nBit value 0 in bit stream\n1\nBit value 1 in bit stream\n' '\nTerminator described by enclosed text\nNotes for reading the BNF:\nNOTE 1:\tThe bit value appearing at the left in the BNF indicates it is arranged in the front in the bit stream.\nNOTE 2:\tNotation 00…11 is equivalent to ( 00 | 01 | 10 | 11).\nNOTE 3:\tNotation ( 0 | 1 <val> ) is used in the BNF in many occurrences for optionally omitting a value. In this example, it indicates either a specific value <val> can be used, or it can be omitted when default value can be used. The bit value 0 or 1 indicates if <val> is specified.\nNOTE 4:\tSigned integers use Two's Complement representation.\nWVG (Wireless Vector Graphics)\n<WVG> ::= ( 0 <character size WVG>)  | ( 1 <standard WVG> )\n<character size WVG> ::= <character size WVG header> <line elements>\n<standard WVG> ::= <standard WVG header> <elements>\nCommon\n<text code mode> ::= 0 | 1\t\t; 0 for 7-bit GSM character set. 1 for 16-bit UCS-2\n<string length> ::= 'unsigned 8-bit integer'\t; number of GSM or UCS-2 characters\n; GSM extension characters are counted as one character\n; <string length> = 0 means null string\n<char> ::=\t'unsigned 7 bit integer'\t; 7-bit GSM character value\n; Extension table are supported but the Another Extension; and the\n; Page Break are not supported.\n|\tunsigned 16 bit integer'\t; 16-bit UCS-2 value\n; CR is supported but other control characters are not supported\n; (ignored when processed).\n<mask> :=\t0 | 1\t\t; 0 for false, 1 for true\n<hint> :=\t0 | 1\t\t; 0 for false, 1 for true\nCharacter Size WVG Header\n<character size WVG header> ::=\t( 0  ( <aspect ratio> <line element mask> <relative use>\n<parameters X-0> <parameters Y-0> )\t)\n; standard header\n|\t( 1 ( <line element mask> <relative use> <MaxXYInBits0> ) )\n; compact header. In this case, x and y grid are same,\n; default peak value 1.0, default aspect ratio1:1.\n; Note: character size WVG always use compact coordinate mode\n<line element mask> ::= <mask>\t; true for at least one polyline element in the drawing\n<mask>\t; true for at least one circular polyline element in the drawing\n<mask>\t; true for at least one Bezier polyline element in the drawing\n<relative use> ::= 0 | 1\t\t; 0 for all points use absolute coordinates,\n; 1 for at least one point uses relative coordinate (offset mode)\n<parameters X-0> ::= <MaxXInBits0> <peak description>\n<parameters Y-0> ::= <MaxYInBits0> <peak description>\n<MaxXInBits0> ::= <bits indicator >\n<MaxXInBits0> ::= <bits indicator >\n<MaxXYInBits0> ::= <bits indicator >\n<bits indicator> ::= 00…11\t; 00 for 3 bits (max value 7), 01 for 4 bits (max value 15)\n;10 for 5 bits (max value 31), 11 for 6 bits (max value 63)\n<peak description> ::= 00…11\t; 00:  peak value 1.0, no peak position required\n; 01: peak value 1.5, peak position 0.5\n; 10: peak value 1.5, peak position 0.3333\n; 11: peak value 1.5, peak position 0.6667\nCharacter Size WVG Elements\n<line elements> ::= <number of line elements> <line element> { <line element> }\n<number of line elements> ::= 'unsigned 7-bit integer'\t; maximum 127 elements\n<line element> ::= <line header>\n( <polyline element> | <circular polyline element> |<Bezier polyline element> )\n<line header> ::= <line element type> [ <point mode> ] \t; appear when <relative use> = 1\n<line element type> ::=\t\t; empty, when <line element mask> = 100, 010 or 100\n0 | 1\t; when <line element mask> = 011, 110, 110 or 101\n; 0 for the firstelement with mask value 1 in the <line element mask>\n; 1 for the second element with mask value 1 in <line element mask>\n00..11\t; 00 for polyline, 01 for circular polyline, 10 for Bezier polyline\n; ( when <line element mask> = 111>)\n<point mode> ::= 0 | (1 <offset bit use>)\t; 0 for use of absolute coordinate for <Next Point>\n; 1 for using relative coordinate (offset mode) for <Next Point>\nStandard WVG Header\n<standard WVG header> ::= <general info> <color configuration> <codec parameters> <animation settings>\n<general info> ::= <version> 0 | ( 1 <text code mode> <author string> <title string> <time stamp> )\n<version> ::= 0000…1111\n<author string> ::= 0 | (1 <string length> <char> { <char> } )\n<title string>  := 0 | (1 <string length> <char> { <char> } )\n<time stamp> ::= 0 | (1 <year> <month> <day> <hour> <minute> <second> )\n<year> ::='signed_13_bit_integer'\n<month> ::='unsigned_4_bit_integer' ; range 1-12\n<day> ::= 'unsigned_5_bit_integer' ; range 1-31\n<hour>  ::= 'unsigned_5_bit_integer' ; range 0-23\n<minute> ::= 'unsigned_6_bit_integer' ; range 0-59\n<second> ::= 'unsigned_6_bit_integer' ; range 0-59>\nColor\n<color configuration> ::= <color scheme> <default colors>\n<color scheme> ::=\t00\t\t; black and white\n|\t010\t\t; 2-bit gray scale\n|\t011\t\t; 2-bit predefined color. 4 color value 00, 01, 10, 11 are\n; mapped to RGB color (255,255,255), (255,0,0),\n; (0,255,0) and  (0,0,255) respectively\n|\t100\t\t; 6-bit RGB color\n|\t101\t\t; websafe color\n|\t1100 <6-bit color palette>\t; 6-bit RGB color using 2nd color palette\n|\t1101 <8-bit color palette>\t; websafe color using 2nd  palette\n|\t1110\t\t; for 12 bits color mode\n|\t1111\t\t; for 24 bits color mode\n<6-bit color palette> ::= 00000…11111\t\t; A value equal to “number of color” - 1.\n;\nMaximum 32 color entries\n{<6-bit RGB color>}\t; specify color value from 0 to “number of color”-1\n<8-bit color palette> ::= 0000000…1111111\t; A value equal to “number of color” - 1.\n; Maximum 128 color entries\n{ <8-bit websafe color> }\t;specify color value from 0 to “number of color”-1\n; Note: the decoder will decide number of bits used by <indexed\n; RGB/websafe color> <indexed color> use 1 to 7 bits if <number of\n; color> is  2, 3…4, 5…8, 9…16, 17…32, 33…64, 65…128.\n<draw color> ::=\t<b/w color>\t\t; when color scheme is 00\n|\t<grayscale>\t\t; when color scheme is 010\n|\t<2-bit predefined color>\t; when color scheme is 011\n|\t<6-bit RGB color>\t\t; when color scheme is 100\n|\t<8-bit websafe color>\t; when color scheme is 101\n|\t<indexed RGB color>\t; when color scheme is 1100\n|\t<indexed websafe color>\t; when color scheme is 1101\n|\t<12 bit RGB color>\t\t; when color scheme is 1110\n|\t<24 bit RGB color>\t\t; when color scheme is 1111\n<b/w color> ::= 0 |\t; white\n1\t; black\n<grayscale> ::= 00…11\t; 00 for 24-bit RGB color (0,0,0),\t        01 for 24-bit RGB color (85,85,85)\n; 10 for 24-bit RGB color (170,170,170), 11 for 24-bit RGB color (255,255,255)\n<2-bit predefined color> ::= 00…11\t;00 for 24-bit RGB color (255,255,255), 01 for 24-bit RGB color (255,0,0)\n;10 for 24-bit RGB color (0,255,0), 11 for 24-bit RGB color (0,0,255)\n<6-bit RGB color> ::= <2-bit R> <2-bit G> <2-bit B>\n<indexed RGB color> ::= (0 | 1) | 00…11 | 000…111 | 0000…1111 | 00000…11111\n; map to 6-bit RGB color value defined in <6-bit color palette>\n<8-bit websafe color> ::= 00000000…11111111\n; See G.7 for websafe color palette definition\n<indexed websafe color> ::= (0 | 1) | 00…11 | 000…111 | 0000…1111 |\n00000…11111 | 000000…111111 | 0000000…1111111\n; map to 8-bit websafe color value defined in <8-bit color palette>\n<2-bit R> ::= <2-bit color value>\t\t; Red color value\n<2-bit G> ::= <2-bit color value>\t\t; green color value\n<2-bit B> ::=  <2-bit color value>\t; blue color value\n<2-bit color value> ::= 00…11\t; 00, 01, 10 and 11  for color value 0, 85, 170 and 255\n; defined in 0-255 color range respectively\n<12-bit RGB color> ::= <4-bit R> <4-bit G> <4-bit B>\t;\n<4-bit R> ::= <4-bit color value>\t\t; Red color value\n<4-bit G> ::= <4-bit color value>\t\t; green color value\n<4-bit B> ::=  <4-bit color value>\t; blue color value\n<4-bit color value> ::= 0000…1111\t; multiply by 17 to convert to 8 bit color value\n<24-bit RGB color> ::= <8-bit R> <8-bit G> <8-bit B>\t;\n<8-bit R> ::= <8-bit color value>\t\t; Red color value\n<8-bit G> ::= <8-bit color value>\t\t; green color value\n<8-bit B> ::=  <8-bit color value>\t; blue color value\n<8-bit color value> ::= 00000000…1111111\t; intensity value of color value\n<default colors> :=\t( 0 | (1 <default line color>))    ; use black  when first bit is 0\n( 0 | (1 <default fill color>))          ; use black  when first bit is 0\n( 0 | (1 <background color>))       ; use white  when first bit is 0\n;  If above color(s) are not\n; specified, use BLACK as <default line color> and <default fill color>, and use\n; WHITE as <background color>.\n<default line color> ::= <draw color>\n<default fill color> ::= <draw color>\n<background color> ::= <draw color>\nCodec Parameters\n<codec parameters> ::= <element mask> <attribute mask> <generic parameters>\n<coordinate parameters>\n<coordinate parameters> ::=  ( 0 <flat coordinate parameters> )\t; flat coordinate mode\n|  (1 <compact coordinate parameters> )\t; compact coordinate mode\n<element mask> ::=\t<mask>\t; true for at least one local envelope element in the drawing\n<mask>\t; true for at least one polyline element in the drawing\n<mask>\t; true for at least one circular polyline element in the drawing\n<mask>\t; true for at least one Bezier polyline element in the drawing\n<mask>\t; true for at least one simple shape element in the drawing\n<mask>\t; true for at least one reuse element in the drawing\n<mask>\t; true for at least one group element in the drawing\n<mask>\t; true for at least one animation element in the drawing\n(0 | (1\t\t; extension bit. 1 for rare masks are followed by\n<mask>\t; true for at least one polygon element in the drawing\n<mask>\t; true for at least one special shape element in the drawing\n<mask>\t; true for at least one frame element in the drawing\n<mask>\t; true for at least one text element in the drawing\n<mask>\t; true for at least one extended element in the drawing\n)\t;The decoder should decide how many bits to be used by <element type>\n)\t; according to number of “1”s in the <element mask>. Number of bits\n; used by <element type> can be 0 (if only one “1” in <element mask>),\n; 1 (if 2 “1”s), 2 (if  3 or 4 “1”s), 3 (if 5-8 “1”s) or 4(if more than 8\n; “1”s). Value of <element type> that is to represent a specific element\n;  type is same as the order of  the specific mask  in the <element mask>\n; that represents this type of element. For example, if <element mask> is\n; 011000010, <element  type> will use 2 bits and value 00, 01, 10\n;  (11 is not used) represent polyline, circular polyline and animation\n;  elements respectively.\n; Note that <mask> for local envelope has no meanings when in flat\n; coordinate mode but still\n; exists\n<attribute masks> ::= <line type mask> <line width mask> <line color mask> <fill mask>\n<line type mask> ::= <mask>\t; true when at least one element uses line type attribute\n<line width mask> ::= <mask>\t; true when at least one element uses line width attribute\n<fill mask> ::= <mask>\t\t; true when at least one element uses fill attribute\n<line color mask> ::= <mask>\t; true when at least one element uses line color\nGeneric Parameters\n<generic parameters> ::= (0 | (1 <angle resolution> <angle in bits> )\t; 0 for default (22.5 degree, 3 bits)\n(0 | (1 <scale resolution> <scale in bits> )\t; 0 for default (1/4, 3 bits)\n(0 | (1 <index in bits> )\t; 0 for default (both  3 bits)\n[<curve offset in bits> ]\n; <curve offset in bits> appear when <mask> for <circular polyline element>\n; or <polygon element> is true\n<angle resolution> ::= 00…11\t; 00  for angle unit is 1.40625  degree; 01 for angle unit is 5.625 degree\n; 10  for angle unit is 11.25 degree; 11 for angle unit is 22.5 degree\n<angle in bits> ::= 000…111\t; number of bits used by <angle value> is from 1 to 8 bits\n<angle value> ::= 'signed angleInBits+1-bit integer'\n; angle unit is decided by <angle resolution>\n;0  degree is defined as positive direction of the X axis and\n; positive angle value is clockwise.\n; -180 degree is represented by maximum negative digit\n<scaleresolution> ::= 00..11\t; 00 for 1/4 as scale unit.  01 for 1/16 as scale unit\n; 10  for 1/64 as scale unit; 11 for 1/256 as scale unit\n<scale in bits> ::= 0000…1111\t; number of bits used by <scale value> is from 1 to 16 bits\n<scale value> ::=  'signed scaleInBits+1-bits integer'\n; scale unit is decided by <scale resolution>\n; negative scale value means scaling at\n; opposite direction\n<index in bits> ::= 0000…1111\t; number of bits used by <index> are from 1 to 16 bits\n<index> ::= <index value>\n<index value> ::= 'unsigned IndexInBits+1-bit integer'\n<curve offset in bits> ::= 0 | 1\t; 0 for using 4 bits (15 levels)\n; 1 for using 5 bits (31 levels)\nCompact Coordinate Parameters\n<compact coordinate parameters> ::= <aspect ratio> <TransXYInBits1>\n<parameters X-1> <parameters Y-1> <redefine resolution hint>\n<aspect ratio> ::=    00 |\t\t\t; aspect ratio = 1:1\n( (  01\t\t\t; aspect ratio = 4:3\n| 10\t\t\t; aspect ratio = 16:9\n| 1100\t\t\t; aspect ratio = 64:27\n| 1101\t\t\t; aspect ration = 256:81\n| 1110\t\t\t; aspect ration = 1024:243\n| 1111\t\t\t; aspect ration = 4096:729\n) [ <display orientation> ]\t; <display orientation> appears in standard WVG\n)\t\t\t; character size WVG uses landscape only\n<display orientation > ::= 0 | 1\t\t; 0 for landscape, 1 for portrait\n<parameters X-1> ::= <MaxXInBits1> <coordinate parameters>\n<parameters Y-1> ::= <MaxYInBits1> <coordinate parameters>\n<coordinate parameters> ::= 00 | ( <peak value> <peak position> <peak width> )\n; peak value default to 1.0 when 00 is defined\n<MaxXInBits1> ::= 00…11\t\t; Number of bits used by <X>.\n; This determines the number of grid lines in the X direction.\n<MaxYInBits1> ::= 00…11\t\t; Number of bits used by <Y>.\n; This determines the number of grid lines in the Y direction.\n; 00 for 15, 01 for 31,10 for 63, 11 for 127\n<peak value> ::= 01…11\t\t;  01 for 1.5, 10  for 2.0, 11 for 2.5\n<peak position> ::=\t0000…1100\t; 0-12. Peak position = value/12 from envelope left.\n|\t1101\t\t; reserved\n|\t1110\t\t; reserved\n|\t1111\t\t; reserved\n<peak width> ::= 00…11\t\t; 00 for 0.3, 01 for 0.4, 10 for 0.5, 11 for 0.6\n;<peak width> value are to the scale of total global envelope width.\n; 10 (0.5) and 11 (0.6) are not allowed when <peak value> is 11 (2.5)\n; 11 (0.6) is not allowed when <peak value> is 10 (2.0)\n<redefine resolution hint> ::= <hint>\t; true when at least one element uses 'redefine resolution'attribute\n<TransXYInBits1> ::= 00..11\t; number of bits to encode translation and center of transform\n; 00 for 5 bits, 01 for 6 bits, 10 for 7 bits, 11 for 8 bits\n; In global scope and at X axis, it uses unit of (global envelope width/ (number of X grid lines –1 ))\n; In global scope and at Y axis, it uses unit of (global envelope height/ (number of Y grid lines –1 ))\t; In local scope, its unit is same as local coordinate unit.\nFlat Coordinate Parameters\n<flat coordinate parameters> ::= <drawing width> ( 0 | 1 (<drawing height>))\t; 0 means height = width\n<MaxXInBits2><MaxYInBits2> < XYAllPositive>\n<TransXYInBits2>  <NumPointsInBits>\n<OffsetXInBitsLevel1> <OffsetYInBitsLevel1>\n<OffsetXInBitsLevel2> <OffsetYInBitsLevel2>\n<drawing width> ::= 'unsigned 16-bit integer'\n<drawing height> ::= 'unsigned 16-bit integer'\n<MaxXInBits2> ::= 'unsigned_4_bit_integer'\n; number of bits to encode X coordination\n<MaxYInBits2> ::= 'unsigned_4_bit_integer'\n; number of bits to encode Y coordination\n<XYAllPositive> ::= ”unsigned_1_bit_integer'\n; 0 means not all x/y are positive\n; 1 means all x/y are positive\n<TransXYInBits2> ::= 'unsigned_4_bit_integer'\t; number of bits to encode translation and center of transform\n<OffsetXInBitsLevel1> ::= 'unsigned_4_bit_integer'\n<OffsetYInBitsLevel1> ::= 'unsigned_4_bit_integer'\n<OffsetXInBitsLevel2> ::= 'unsigned_4_bit_integer'\n<OffsetYInBitsLevel2> ::= 'unsigned_4_bit_integer'\n<NumPointsInBits> ::= 'unsigned_4_bit_integer'\nAnimation Settings\n<animation settings> ::= [ <animation mode> ]\t;appear when <animation element> exist\n<animation mode> ::= 0 | 1\t; 0 for simple animation;  1 for standard animation\nElement\n<elements> := <number of elements> <element> { <element> }\n<number of elements> ::= (0 'unsigned 7-bit integer')\n|   (1 'unsigned 15-bit integer')\n<element> :=\t<element type> ( <basic element> |\n<frame element> | <group element> | <re-use element> |\n<animation element> | <extended element> | <local envelope element> )\n<element type> ::=  | 0…1 | 00..11 | 000…111 | 0000…1111\t; empty is allowed\n; decided by <element mask>. Please refer to <element mask>\n<animation element> :=\t<simple animation element> | <standard animation element>\n; if <animation mode> is 0, all animation elements in the drawing are <simple animation element>\n; if <animation mode> is 1, all animation elements in the drawing are <standard animation element>\n<basic element>::= <basic element header> ( <polyline element> | <circular polyline element>\n| <Bezier polyline element> | <polygon element> | <simple shape element>\n| <special shape element> | <text element> )\nBasic Element Header\n<basic element header> ::= ( <offset bit use>\t; when in flat coordinate mode\n| <resolution and offset bit> )\t; when in compact coordinate mode\n[ 0 | (1<attributes set> ) ]\t\t; appears when <attribute masks> does not equal\n; to 0000\n; 0 for using default attributes defined in <drawing header>\n; 1 for using the following specific attributes\n<Offset Bit Use> ::= <Offset X Use><Offset Y Use>\n<Offset X Use> ::= 0 | 1\n; when in compact coordinate mode, 0 means offset X will use 3 bits.,\n;\t\t\t1 means use 4 bits\n; when in flat coordinate mode, 0 means offset X will use <OffsetXInBitsLevel1>,\n;\t\t\t1 means use <OffsetXInBitsLevel2>\n<Offset Y Use> ::= 0 | 1\n; when in compact coordinate mode, 0 means offset X will use 3 bits,\n;\t\t\t1 means use 4 bits\n; when in flat coordinate mode, 0 means offset X will use <OffsetYInBitsLevel1>,\n;\t\t\t1 means use <OffsetYInBitsLevel2>\n<resolution and offset bit>::=\t(0 |  (1<offset bit use> )\n; only when <redefine resolution hint> is false or in local scope\n; 0 for absolute coordinate, 1 for relative coordinates\n|\t(0  (0 |  (1<offset bit use> ))\n; when <redefine resolution hint> is true and in global scope\n; 0 for absolute coordinate, 1 for relative coordinates\n|\t( 1 <coordinate resolution> <offset bit use> )\n; when <redefine resolution hint>  is true and in global scope\n; redefine resolution, always use relative coordinates\n<coordinate resolution> ::= 000…111\t; decide the grid line interval by a scale of width\n; or height of the global envelope whichever is short.\n; 0-7 for 1/27, 1/32, 1/38, 1/48, 1/64,\n;\t 1/85, 1/128 and 1/160 respectively\nElement Attributes\n<attribute set> ::=\t[ <line type> ]\t; appear when <line type  mask> is true\n[ <line width> ]\t; appear when <line width mask> is true\n[ 0 | (1 <line color>) ]\t; appear when <line color mask> is true and\n;  <line width> is not zero\n; 0 for <default line color>, 1 for specified color\n[ 0 | (1\t\t; 0 for no fill; 1 for with fill\n(0 | (1 <fill color>))\t; 0 for <default fill color>, 1 for specified color\n)\t\t; appear when <fill mask> is true\n]\t; Note: line type and line width are not used by <text element> but\n;  still exist here. If not filled, then background of text output will\n; be transparent. If filled, then fill color will be used as text background.\n<line width> ::= 00…11\t\t; 00 for no line, 01 for Fine, 10 for medium, 11 for thick\n; 00 is only valid with fill\n<line type> ::= 00…11\t\t; 0 for solid, 1 for dash line, 2 for dotted line\n<fill color > ::= <draw color>\n<line color> ::= <draw color>\n<OverrideAttributeSet> ::= 0 | (1 <line type>)\n0 | (1 <line width>)\n0 | (1 <line color>)\n0 | (1 <fill> )\n0 | (1 <fill color>)\n; 0 for no overriding, 1 for overriding with specified attribute\n<fill> ::= 0 | 1\t\t\t; 0 means no fill, 1 means fill\nTransform\n<Transform> ::= <TranslateX><TranslateY>\n0 | (1 <Angle> <ScaleX><ScaleY> < CX>< CY>) ; optional other transforms\n<Angle> ::= 0 | (1 <Angle Value> )\t; 0 means angle will use default value which is 0\n<TranslateX> ::= 0 | (1 <TranslateX Value> )\t; 0 means translate x  will use default value which is 0\n<TranslateX Value> ::= 'signed_TransXYInBits2_bit integer'\t; when in flat coordinate mode\n| 'signed TransXYInBits1+5 bit integer'\t; when in compact coordinate mode\n<TranslateY> ::= 0 | (1 <TranslateY Value> )\t; 0 means translate y will use default value which is 0\n<TranslateY Value> ::= 'signed_TransXYInBits2_bit integer'\t; when in flat coordinate mode\n| 'signed TransXYInBits1+5-bit integer'\t; when in compact coordinate mode\n<ScaleX> ::= 0 | (1<Scale value> )\t; 0 means scale will use default value which is 1.0\n<ScaleY>::= 0 | (1 <Scale value> )\t; 0 means scale will use default value which is same as\n; absolute value of <ScaleX>\n<CX> ::= 0 | (1 <CX value> )\t; translation of rotation and scale center; 0 means it will use default\n; value which is at the left border of the drawing (x=0 in  the flat\n; coordinate system or the global envelope)\n<CX value> ::= 'signed_TransXYInBits2_bit integer'\t; when in flat coordinate mode\n| <X>\t\t; when in compact coordinate mode\n<CY> ::= 0 | (1 <CY value> )\t; 0 means it will use default value which is\n; (y=0 in  the flat coordinate system or the global envelope)\n<CY value> ::= 'signed_TransXYInBits2_bit integer'\t; when in flat coordinate mode\n| <Y>\t\t; when in compact coordinate mode\nPolyline Element\n<polyline element> ::= [ <numberOfPoints> ] <First Point> { <Next Point> } [ <point terminator> ]\n; specifies a start point, zero or many intermediate points and an end point.\n; <numberOfPoints> appears only when in flat coordinate mode\n; <point terminator> appears only when in compact coordinate mode\n<point terminator> ::=\t111…111111\t; Absolute mode in character size WVG. Same number of\n; bits of <MaxXInBits0> or <MaxXYInBits0>\n|\t1111…1111111\t; Absolute mode in standard WVG. Same number of bits of\n; <MaxXInBits1>or <MaxLocalXYInBits>\n|\t( 100  | 1000 )\t; Offset mode (relative).\n; use 100 when <Offset X Use> = 0\n; use 1000 when <Offset X Use> = 1\nCircular Polyline Element\n<circular polyline element> ::=\t<curve hint> [ <numberOfPoints> ] <FirstPoint> <curve offset> <point>\n{ <curve offset> <NextPoint> } [ <offset terminator> ]\n; <numberOfPoints> appears only when use\n; flat coordinate  mode\n; <offset terminator> appears only when use\n; compact coordinate mode\n<curve hint> ::= <hint>\n<curve offset> ::=\t( 0 | (1 <curve offset value>) )\t; when <curve hint> is true\n|\t<curve offset value>\t\t; when <curve hint> is false\n<offset value> ::=\t'signed 4-bit integer'\t; when <curve offset in bits> = 0\n; or in character size WVG\n|\t'signed 5-bit integer'\t; when <curve offset in bits> = 1\n; Curve offset ratio r = e/L\n; Where e is actual curve offset(can be positive or negative),\n; L is distance between adjacent nodes\n; We use a signed integer value v to represent. v = round(r*k);\n; Where k = 2^n - 2  (n is number of bits used for <offset value>)\n<offset terminator> ::=\t( 1 <curve offset bits>)\t; when <curve hint> is true\n|\t< curve offset bits >\t\t; when <curve hint> is false\n<curve offset bits> ::=\t1000\t\t; when <curve offset in bits> = 0\n|\t10000\t\t; when <curve offset in bits> = 1\nBezier Polyline Element\n<Bezier polyline element> ::= [ <NumberOfPoints> ]\n<First Point> {<OnCurve> <Next Point>} [ 1 <point terminator>]\n; Same data format for PolyBezCurve, and PolygonBezCurve\n; <numberOfPoints> appears only when in flat coordinate moed\n; “1 <point terminator>” appears only when in compact coordinate mode\n<NumberOfPoints> ::= 'unsigned_NumberOfPointsInBits_bit integer'\n<OnCurve> ::= 0 | 1\n; 0 – off curve\n; 1 – on curve\nNOTE:\tOnly cubic and quadratic Bezier curves are supported. It means only one or two successive off-curve points are allowed. The first point of a curve must be on-curve. The last point must also be on-curve if it is Bezier polyline but is not necessary for Bezier polygon.\nPolygon Element\nPolygon element is actually a closed polyline (including circular and Bezier polyline)\n<polygon element> ::= ( 00 <polyline element> ) | (01 <circular polyline element> )\n| (10 <Bezier polyline element> )\nSimple Shape Element\n<simple shape element> ::= (0 <rectangle element> ) | (1 <ellipse element> )\n<rectangle element>::=<Point><Width><Height><rounded flag> <Angle>\n<ellipse element>::=<Point><Width><Height> <Angle>\n<Width> ::= <X> | <Offset X>\t; <Offset X> is used when <Offset Bit Use> exists in the <basic element header>\n; if the element is in global scope in compact coordinate mode, use unit of\n;  (global envelope width/ (number of X grid lines –1 ))\n<Height>::= 0 | (1 <HeightValue> )\t; 0 means the height is same as width, height will not be encoded\n<HeightValue> ::= <Y> | <Offset Y>\n; <Offset Y> is used when <Offset Bit Use> exists in the <basic element header>\n; if the element is in global scope in compact coordinate mode, use unit of\n;  (global envelope height/ (number of Y grid lines –1 ))\n<rounded flag> ::=\t0 | 1\t; 0 for straight corner, 1 for rounded corner\nSpecial Shape Element\n<special shape element> ::=\t<point> <angle>\n00 ( <vertex> < diameter >\t\t; regular polygon\n|\t01 ( <vertex> <vertex angle> < diameter >\t; star\n|\t10 ( <rectangle size> <rows> <columns> )\t; grid\n|\t11\t\t\t\t; not used\n<diameter > ::= <X> | <Offset X>\t; diameter of circle or vertex\n; <Offset X> is used when <Offset Bit Use> exists in the <basic element header>\n; if the element is in global scope in compact coordinate mode, use unit of\n;  (global envelope width/ (number of X grid lines –1 ))\n<rectangle size>::= <width> <height>\n<vertex> ::= 000…111\t\t; number of vertex = <vertex> + 3\n<vertex angle> ::= 00…11\t; 00 for 0 degree, 01 for 36 degree\n; 10 for 60 degree, 11 for 90 degree\n<rows> ::= 0000…1111\t\t; rows = <rows> + 1\n<columns> ::= 0000…1111\t; columns = <columns> + 1\nText Element\n<text element> ::= <point> <font size> <angle> <text code mode> <string length> { <char> }\n; <point> is top-left  corner of the text.\n<font size> ::= <Y> | <Offset Y>\t; <Offset Y> is used when <Offset Bit Use> exists in the <basic element\n; header>\n; if the element is in global scope in compact coordinate mode, use unit of\n;  (global envelope height/ (number of Y grid lines –1 ))\nLocal Envelope Element\n<local envelope element> ::= ( 0 <local envelope description> <point> )\n; local start\n; <point> is top- left corner of the local envelope in global coordinates.\n; Elements in the local envelope scope use local coordinates and measurements\n|     1\t; local end\n<local envelope description> ::= <coordinate resolution> <MaxLocalXYInBits>\n<MaxLocalXYInBits> ::= 00…11\t; 00 for 3 bits(max value 7), 01 for 4 bits (max value 15),\n; 10 for 5 bits (max value 31), 11 for 6 bits (max value 63)\nGroup Element\n<group element> ::=       (0 (0 | (1 <transform>) ) <display> )\t; start of group. Transform is optional\n|\t1\t\t\t\t; end of group\n<display> ::=  0 | 1\t\t\t; 0 – no display when render; 1 – display when render\nRe-use Element\n<re-use element> ::=  <element index>\t; point to the element to be re-used\n; only <basic element>,<group element> and\n; <re-use element> can be reused\n<transform>\t\t; re-use with transformation\n0 | (1 <array parameter>)\t; array. It should be performed as the last step\n0 | (1 <OverrideAttributeSet> )\n<element index> ::= <index value>\t; the element sequence number in whole drawing. Start from 0.\n<array parameter> ::= <columns> [ <array width> ] <rows> [ < array height> ]\n; <array height> indicates whole height of the array, appears when <rows> is non-zero\n; element interval at X direction equals to <width>/<columns>\n; <array width> indicates whole width of the array, appears when <colunms> is non-zero\n; element interval at Y direction equals to <height>/<rows>\n; The top left element in the array is at the position specified in <transform>\n<array width> ::= <X>\t\t; if the element is in globale scope in compact coordinate mode, use unit of\n;  (global envelope width/ (number of X grid lines –1 ))\n<array height>::= 0 | (1 <Y> )\t; 0 means the height is same as width, height will not be encoded\n; if the element is in globale scope in compact coordinate mode, use unit of\n;  (global envelope height/ (number of Y grid lines –1 ))\nFrame Element\n<Frame> ::= <KeepLastFrameContentFlag><HasFilledColorFlag>[< fill color >]\n; <fill color> is new background color for the frame\n<KeepLastFrameContentFlag>::='unsigned 1-bit integer'\n;  keep the image of the last frame on the screen, or clear it\n; value 0 - Do not keep last frame content.\n; value 1 - Keep last frame content.\n<HasFilledColorFlag> ::='unsigned 1-bit integer'\n; value 0 - no filled color\n; value 1 - has filled color\nSimple Animation Element\n<simple animation element> ::=\t<cycle type>\n( 0 | ( 1 <visibility parameter> )\n( 0 | ( 1 <transform> )\t; begin transform\n( 0 | ( 1 <transform> )\t; end transform\n( 0 | 1 )\t\t; 0 for no bouncing.  1 for bouncing\n<rotation direction>\n<round rotation flag>\n<round rotation flag> ::= 0 | 1\t; 0  for no round rotation.\n; 1 for round rotation and will override angles defined in <transform>\n<cycle type> ::= 0 | 1\t\t; 0 indicates short animation cycle; 1 indicates long animation cycle\n<visibility parameter> ::= <visibility timing>\n<visibility timing> ::= 0000…1111 | 00000000…11111111\n; One blinking cycle is  divided into four equal time steps for short\n;  animation cycle or eight steps for long animation cycle. <visibility timing> is a map of time steps in\n; which 0 represents invisible and 1 represents visible. Note that in above map, consequence time steps\n; is from left to right, or from first order to later order in bit stream.\n<rotation direction> ::=\t0 | 1\t; 1 for clockwise rotating. 0 for counter-clockwise rotating\nNOTE:\tFor all individual values in the transform, linear interpolation is used.\nStandard Animation Element\n<standard animation element>::= <element index> <BeginTransform><EndTransform><Rotation Direction>\n<Round> 0 | (1 <BeginColor><EndColor> ) <BeginTime><Duration><ExistAfter>\n<BeginTransform> ::= 0 | (1<Transform> )\t; begin position\n;0 – means use (start from) default transform:; Angle=0, TranslateX=0, TranslateY=0, ScaleX=256, ScaleY=256, Cx=0, Cy=0\n;1 – means Transform follows\n<EndTransform> ::= 0 | (1 <Transform> )\t; end position\n;0 – means use (end at) default transform\t\t; Angle=0, TranslateX=0, TranslateY=0, ScaleX=256, ScaleY=256, Cx=0, Cy=0\n;1 – means Transform follows\n<Rotation Direction> ::= 0 | 1\t;0 – counter clockwise\n;1 – clockwise\n<Round> ::= 0 | 1\t;0 – no rotation\n;1 – rotate 360 degrees\n<BeginColor> ::= ( 0 | (1 <line color> ) ) ( 0 | (1 <fill color> ) )\n;0 – use default colors\n;1 – use specified colors\n<EndColor> ::= ( 0 | (1 <line color> ) ) ( 0 | (1 <fill color> ) )\n;0 – use default colors\n;1 – use specified colors\n<BeginTime> ::= 'unsigned 12-bit integer'\t;<BeginTime> is in units of 10ms\n<Duration> ::= 'unsigned 12-bit integer'\t; <Duration> is in units of 10ms\n<ExistAfter> :: = 0 | ( 1 <AnimationRepeat>)\t; 0 – animation element will disappear after the animation is finished\n; 1 – animation element will persist after the animation is finished\n<AnimationRepeat>::= 0 | ( 1 <Bouncing> )\t; 0 – no repeat, animated element will stay\n; at <EndTransform>\n; 1 – animation will repeat, duration will be <Duration>\n<Bouncing>:= 0 | 1\t\t\t; 0 – no bouncing, animation will repeat as from begin\n; position to end position\n; 1 – repeat with bouncing. Animation will be\n; repeated as end position ->\n; begin position, then begin position->end position,\n; then end position->begin position …\nNOTE:\tFor all individual values in the transform, linear interpolation is used. Similarity, color interpolation uses linear RGB color space. Out of range color values are allowed.\nExtended Element\n<Extended> ::= <SizeOfSize><Size><ExtendedElementType>{<payload>}\n<SizeOfSize>::='unsigned_5_bit integer'\n; the bit size of the Size field\n<Size>::='unsigned-<SizeOfSize>-bit integer'\n; size of extended element data after ExtendedElementType, in bytes\n<ExtendedElementType>::='unsigned_8_bit integer'\n; element type of extended element\n<payload>::='unsigned_8_bit integer'\n; encoded extended element data. The size should be the same as the Size field of Extended, above.\nPosition and Measurement\n<First Point>::=<point>\t\t; first point of a polyline or polygon (including circular and\n; Bezier polygons)\n<Next Point> ::= <point> |\t; when use absolute mode\n<Offset>\t\t; when use offset mode\n;  in flat coordinate system, only offset mode  is used.\n<point> ::= <X> <Y>\n<X> ::= 'signed MaxXInBits2-bit integer'\t; when in flat coordinate mode and <XYAllPositive> = 0\n| 'unsigned MaxXInBits2-bit integer'\t; when in flat coordinate mode and <XYAllPositive> = 1\n| 'unsigned MaxXInBits1+4-bit integer'\t; when in compact coordinate mode and in global scope\n| 'unsigned MaxLocalXYInBits+3-bit integer'\t; when in compact coordinate mode and in local scope\n| 'unsigned MaxXInBits0+3-bit integer'\t; when in character size WVG (use standard header)\n| 'unsigned MaxXYBits0+3-bit integer'\t; when in character size WVG (use compact header)\n<Y> ::= 'signed MaxYInBits2-bit integer'\t; when in flat coordinate mode and <XYAllPositive> = 0\n| 'unsigned MaxYInBits2-bit integer'\t; when in flat coordinate mode and <XYAllPositive> = 1\n| 'unsigned MaxYInBits1+4-bit integer'\t; when in compact coordinate mode and in global scope\n| 'unsigned MaxLocalXYInBits+3-bit integer'\t; when in compact coordinate mode and in local scope\n| 'unsigned MaxYInBits0+3-bit integer'\t; when in character size WVG (use standard header)\n| 'unsigned MaxXYBits0+3-bit integer'\t; when in character size WVG (use compact header)\n; Note: in compact coordinate mode,<X> and <Y> do not use the maximum number of the unsigned integer\n<Offset> ::= <Offset X> <Offset Y>\n<Offset X> ::= <signed offset X>\t\t; when used by <Next Point>\n| <unsigned offset X>\t\t; when used in other cases\n<Offset Y> ::= <signed offset Y>\t\t; when used by <Next Point>\n| <unsigned offset Y>\t\t\t; when used in other cases\n<signed offset X> = 'signed OffsetXInBitsLevel1-bit integer'\n;when in flat coordinate mode and <offset bit use> = 0\n| 'signed OffsetXInBitsLevel2-bit integer'\n;when in flat coordinate mode and <offset bit use> = 1\n| 'signed 3-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n| 'signed 4-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n<signed offset Y> = 'signed OffsetYInBitsLevel1-bit integer'\n;when in flat coordinate mode and <offset bit use> = 0\n| 'signed OffsetYInBitsLevel2-bit integer'\n;when in flat coordinate mode and <offset bit use> = 1\n| 'signed 3-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n| 'signed 4-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n<unsigned offset X> ::= 'unsigned OffsetXInBitsLevel1-bit integer'\n;when in flat coordinate mode and <offset bit use> = 0\n| 'unsigned OffsetXInBitsLevel2-bit integer'\n;when in flat coordinate mode and <offset bit use> = 1\n| 'unsigned 3-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n| 'unsigned 4-bit integer'\t;when in compact coordinate mode and <offset bit use> = 1\n<unsigned offset Y> ::= 'unsigned OffsetYInBitsLevel1-bit integer'\n;when in flat coordinate mode and <offset bit use> = 0\n| 'unsigned OffsetYInBitsLevel2-bit integer'\n;when in flat coordinate mode and <offset bit use> = 1\n| 'unsigned 3-bit integer'\t;when in compact coordinate mode and <offset bit use> = 0\n| 'unsigned 4-bit integer'\t;when in compact coordinate mode and <offset bit use> = 1\nG.7\tWeb Safe Color Palette\nWebsafe color palette can be defined as in following C syntax using 24-bit RGB color (in form of {red, blue, green} ). The first index of the array indicates value of <8-bit websafe color>\nint websafePalette[256][3] =\n{\n{ 255, 255, 255 }, { 255, 204, 255 }, { 255, 153, 255 }, { 255, 102, 255 },\n{ 255,  51, 255 }, { 255,   0, 255 }, { 255, 255, 204 }, { 255, 204, 204 },\n{ 255, 153, 204 }, { 255, 102, 204 }, { 255,  51, 204 }, { 255,   0, 204 },\n{ 255, 255, 153 }, { 255, 204, 153 }, { 255, 153, 153 }, { 255, 102, 153 },\n{ 255,  51, 153 }, { 255,   0, 153 }, { 204, 255, 255 }, { 204, 204, 255 },\n{ 204, 153, 255 }, { 204, 102, 255 }, { 204,  51, 255 }, { 204,   0, 255 },\n{ 204, 255, 204 }, { 204, 204, 204 }, { 204, 153, 204 }, { 204, 102, 204 },\n{ 204,  51, 204 }, { 204,   0, 204 }, { 204, 255, 153 }, { 204, 204, 153 },\n{ 204, 153, 153 }, { 204, 102, 153 }, { 204,  51, 153 }, { 204,   0, 153 },\n{ 153, 255, 255 }, { 153, 204, 255 }, { 153, 153, 255 }, { 153, 102, 255 },\n{ 153,  51, 255 }, { 153,   0, 255 }, { 153, 255, 204 }, { 153, 204, 204 },\n{ 153, 153, 204 }, { 153, 102, 204 }, { 153,  51, 204 }, { 153,   0, 204 },\n{ 153, 255, 153 }, { 153, 204, 153 }, { 153, 153, 153 }, { 153, 102, 153 },\n{ 153,  51, 153 }, { 153,   0, 153 }, { 102, 255, 255 }, { 102, 204, 255 },\n{ 102, 153, 255 }, { 102, 102, 255 }, { 102,  51, 255 }, { 102,   0, 255 },\n{ 102, 255, 204 }, { 102, 204, 204 }, { 102, 153, 204 }, { 102, 102, 204 },\n{ 102,  51, 204 }, { 102,   0, 204 }, { 102, 255, 153 }, { 102, 204, 153 },\n{ 102, 153, 153 }, { 102, 102, 153 }, { 102,  51, 153 }, { 102,   0, 153 },\n{  51, 255, 255 }, {  51, 204, 255 }, {  51, 153, 255 }, {  51, 102, 255 },\n{  51,  51, 255 }, {  51,   0, 255 }, {  51, 255, 204 }, {  51, 204, 204 },\n{  51, 153, 204 }, {  51, 102, 204 }, {  51,  51, 204 }, {  51,   0, 204 },\n{  51, 255, 153 }, {  51, 204, 153 }, {  51, 153, 153 }, {  51, 102, 153 },\n{  51,  51, 153 }, {  51,   0, 153 }, {   0, 255, 255 }, {   0, 204, 255 },\n{   0, 153, 255 }, {   0, 102, 255 }, {   0,  51, 255 }, {   0,   0, 255 },\n{   0, 255, 204 }, {   0, 204, 204 }, {   0, 153, 204 }, {   0, 102, 204 },\n{   0,  51, 204 }, {   0,   0, 204 }, {   0, 255, 153 }, {   0, 204, 153 },\n{   0, 153, 153 }, {   0, 102, 153 }, {   0,  51, 153 }, {   0,   0, 153 },\n{ 255, 255, 102 }, { 255, 204, 102 }, { 255, 153, 102 }, { 255, 102, 102 },\n{ 255,  51, 102 }, { 255,   0, 102 }, { 255, 255,  51 }, { 255, 204,  51 },\n{ 255, 153,  51 }, { 255, 102,  51 }, { 255,  51,  51 }, { 255,   0,  51 },\n{ 255, 255,   0 }, { 255, 204,   0 }, { 255, 153,   0 }, { 255, 102,   0 },\n{ 255,  51,   0 }, { 255,   0,   0 }, { 204, 255, 102 }, { 204, 204, 102 },\n{ 204, 153, 102 }, { 204, 102, 102 }, { 204,  51, 102 }, { 204,   0, 102 },\n{ 204, 255,  51 }, { 204, 204,  51 }, { 204, 153,  51 }, { 204, 102,  51 },\n{ 204,  51,  51 }, { 204,   0,  51 }, { 204, 255,   0 }, { 204, 204,   0 },\n{ 204, 153,   0 }, { 204, 102,   0 }, { 204,  51,   0 }, { 204,   0,   0 },\n{ 153, 255, 102 }, { 153, 204, 102 }, { 153, 153, 102 }, { 153, 102, 102 },\n{ 153,  51, 102 }, { 153,   0, 102 }, { 153, 255,  51 }, { 153, 204,  51 },\n{ 153, 153,  51 }, { 153, 102,  51 }, { 153,  51,  51 }, { 153,   0,  51 },\n{ 153, 255,   0 }, { 153, 204,   0 }, { 153, 153,   0 }, { 153, 102,   0 },\n{ 153,  51,   0 }, { 153,   0,   0 }, { 102, 255, 102 }, { 102, 204, 102 },\n{ 102, 153, 102 }, { 102, 102, 102 }, { 102,  51, 102 }, { 102,   0, 102 },\n{ 102, 255,  51 }, { 102, 204,  51 }, { 102, 153,  51 }, { 102, 102,  51 },\n{ 102,  51,  51 }, { 102,   0,  51 }, { 102, 255,   0 }, { 102, 204,   0 },\n{ 102, 153,   0 }, { 102, 102,   0 }, { 102,  51,   0 }, { 102,   0,   0 },\n{  51, 255, 102 }, {  51, 204, 102 }, {  51, 153, 102 }, {  51, 102, 102 },\n{  51,  51, 102 }, {  51,   0, 102 }, {  51, 255,  51 }, {  51, 204,  51 },\n{  51, 153,  51 }, {  51, 102,  51 }, {  51,  51,  51 }, {  51,   0,  51 },\n{  51, 255,   0 }, {  51, 204,   0 }, {  51, 153,   0 }, {  51, 102,   0 },\n{  51,  51,   0 }, {  51,   0,   0 }, {   0, 255, 102 }, {   0, 204, 102 },\n{   0, 153, 102 }, {   0, 102, 102 }, {   0,  51, 102 }, {   0,   0, 102 },\n{   0, 255,  51 }, {   0, 204,  51 }, {   0, 153,  51 }, {   0, 102,  51 },\n{   0,  51,  51 }, {   0,   0,  51 }, {   0, 255,   0 }, {   0, 204,   0 },\n{   0, 153,   0 }, {   0, 102,   0 }, {   0,  51,   0 }, {  17,  17,  17 },\n{  34,  34,  34 }, {  68,  68,  68 }, {  85,  85,  85 }, { 119, 119, 119 },\n{ 136, 136, 136 }, { 170, 170, 170 }, { 187, 187, 187 }, { 221, 221, 221 },\n{ 238, 238, 238 }, { 192, 192, 192 }, { 128,   0,   0 }, { 128,   0, 128 },\n{   0, 128,   0 }, {   0, 128, 128 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 },\n{   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }, {   0,   0,   0 }\n};\nAnnex H (informative):Development Guidelines for Creation of Polyhony Using SP-MIDI\nWhile Scalable Polyphony-MIDI (SP-MIDI) [38] is a full-featured standard for synthesizing music, using a few guidelines SP-MIDI [38, 39] can be optimized for wireless devices. These guidelines can be grouped as optimizing individual notes, and to minimize the overall size of a melody.\nH.1.\tRunning status\nIn the Musical Instrument Digital Interface (MIDI) standard, a key-on or a key-off event will use at most three bytes each, cf. [40], However, in case several key events occur on the same MIDI-channel, running status can be used. In principle running status means that the first byte of, e.g. key-on is omitted. In addition, the key-on event having a velocity of zero is equivalent to the key-off event. Thus, combining running status and using key-on with zero velocity, as the key-off event will reduce the number of bytes needed to encode key events.\nEXAMPLE: Without running status, the sequence\n91 2E 23 8E, 91 2B 50 8E, 81 2E 64 00, 81 2B 64 00\nmeans  “Key 2E ON” Velocity 23 MIDI Ch 1”, “Key 2B ON Velocity 50 MIDI Ch 1”, “Key 2E OFF Velocity 64 MIDI Ch 1”, “Key 2B OFF Velocity 64 MIDI Ch 1”. Using running status will reduce the sequence into\n91 2E 23 8E, 2B 50 8E, 2E 00 00, 2B 00 00,\nThat is, the command byte is omitted and velocity zero is used for key off.\nH.2\tFile type considerations\nThe SP-MIDI content can be stored in, a Standard MIDI File (SMF) of type 0 or type 1 [40]. In a type 0 SMF, one header chunk and one track chunk is used. In a type 1 SMF one header chunk and several track chunks are used. SMF type 2 should not be used\nH.3\tFile size reduction\nIn general it is more efficient to store the MIDI data as a type 1 file. The increased efficiency is reached if each track contains one MIDI channel and one instrument (This is often the case). Evidently, running status can be applied on each individual track reducing the track size. To further reduce the size of the file use one track per used MIDI channel. That is, if a temple/conductor track exists merge it with the first instrument track. Remove, all meta events which are not necessary, e.g. \"track name\", \"lyric\". To summarize, the following measures can be taken in order to reduce the SMF:\n1)\tuse SMF type 1 (or check if type 1 is smaller than type 0 and use the smallest);\n2)\tuse running status;\n3)\tone and only one instrument per track. Try not to change channels;\n4)\tdo not change tempo in the middle of the music, i.e., only set tempo once;\n5)\tuse beat, instead of SMPTE, to set tempo;\n6)\tcopyright is on automatically;\n7)\tremove controller messages, which are optional according to [39];\n8)\tturn off the options below:\n-\tsequence Number - MIDI sequence ids;\n-\ttext - embedded text for anything;\n-\tsequence / track name;\n-\tinstrument name;\n-\tlyric;\n-\tmarker - for synchronization purposes;\n-\tcue point;\n-\tmidi channel presix - associate channels with all events following;\n-\tsequencer-specific settings.\nItems 1 to 3 above optimize the notes, while items 4 to 8 optimize the overall melody. The above measures will provide an SMF, which is ready for compression. However, prior to compression the composer/content author can consider to use few values for key velocity and thereby increasing the redundancy of the file.\nH.4\tRestrictions\nContent creators should not expect the full support for the following features:\n-\tMIDI message channel pressure;\n-\tMIDI message pitch bend;\n-\tindividual stereophonic panoramic (pan) as expressed in table 5 in [39];\n-\tMIDI message master volume.\nContent creators should not expect a time granularity better than 5ms to be supported by the SME.\nTo ensure interoperability, the first value of the MIP table should be no more than 6 voices.\nAnnex I (normative):SMS in MME\nI.1\tGeneral\nAn EPS network using SMS in MME delivers short message services over EPS NAS signalling.\nFor the architecture and the definition of reference points for SMS in MME see 3GPP TS 23.272 [45], annex C.\nBetween the architecture and the reference points for SMS in MME and the architecture and the reference points shown in clause 4.1, figure 5, of the present specification the following mapping can be established:\nTable I.1: Mapping between architecture and reference points for SMS in MME and the present specification\nSMS in MME\npresent specification\nHSS\nHLR\nNetwork entities\nMME\nMSC + VLR\nE-UTRAN\n(not shown in figure 5)\nUE\nMS\n(not applicable)\nMME (NOTE 1)\nS6a\n(not shown in figure 5)\nS6c/C\n2\nReference points\nSGd\n3\n(not applicable, MME internal)\n4\nUu + S1-MME\n5\n(not applicable)\n6\nNOTE 1: In figure 5, the MME is only acting as a relay for SMS transfer via the SGs.\nFor the purpose of supporting SMS in MME, the MME shall implement the requirements specified in the present specification for the MSC and the VLR with the following modifications:\n1)\t\"GSM/UMTS system\" is to be replaced with \"EPS\".\n2)\tThroughout the text and in the figures, message names, parameter names and cause values:\n\"MSC\" is to be replaced with \"MME\";\n\"VLR\" is to be replaced with \"MME internal subscriber register\";\n\"HLR\" is to be replaced with \"HSS/HLR\";\n\"MS\" is to be replaced with \"UE\";\n\"non GPRS\" is to be replaced with \"EPS\";\n\"IMSI detached\" is to be replaced with \"EPS detached\".\n3)\tThe protocol used on reference point 2 (reference point S6c) is based on Diameter (see 3GPP TS 29.338 [50]).\n4)\tThe protocol used on reference point 3 is based on Diameter (see 3GPP TS 29.338 [50]).\n5)\tReference point 4 is MME internal, and operations performed on this reference point are not standardized. In the message flows of clause 10, the MME replaces the combination of MSC and VLR, and messages exchanged between MSC and VLR are replaced with MME internal communication.\n6)\tThe protocol used between HSS and MME (reference point S6a) is based on Diameter (see 3GPP TS 29.272 [46]). In the alert procedure in clause 10.3:\nMAP ReadyForSM is to be replaced with Diameter NotifyRequest (ReadyforSM).\nI.2\tRegistration of MME for SMS\nThe registration (and removal of registration) procedures for SMS in MME are described in 3GPP TS 23.272 [45].\nI.2.1\tVoid\nI.2.2\tVoid\nAnnex J (normative):SGSN supporting Diameter based protocol for SMS\nJ.1\tGeneral\nFor SGSN supporting Diameter based interfaces and protocols, instead of using MAP based interfaces for communication between the SGSN and the central SMS functions (SMS-GMSC, SMS-IWMSC, SMS-Router), Diameter based interfaces are used.\nWhen the SGSN supports Diameter based protocol for SMS, the SGSN uses the interfaces and procedures defined in 3GPP TS 29.338 [50] to transfer short messages between the SGSN, the SMS-IWMSC, the SMS-GMSC and the SMS Router.\nImpacts for SGSN supporting Diameter based protocol for SMS to the existing architecture and the reference points shown in clause 4.1, figure 5 of the present specification are summarized in the following mapping table:\nTable J.1: Mapping between architecture and reference points for SMS over SGSN using Diameter interface and the present specification\nSMS over SGSN via Diameter interface\npresent specification\n(SMS over SGSN via MAP interface)\nHSS\nHLR\nNetwork entities\nSGSN\nSGSN\nS6d\n2 (Note 1)\nReference points\nS6c/C\n2\nGdd\n3 (Note 2)\nNOTE 1: Corresponding MAP interface is referred to as “Gr” interface in GPRS architecture.\nNOTE 2: Corresponding MAP interface is referred to as “Gd” interface in GPRS architecture.\nFor the purpose of supporting SMS over SGSN via Diameter interface, the SGSN shall implement the requirements specified in the present specification for SMS over SGSN via MAP interface with the following modifications:\n1)\tThroughout the text and in the figures, message names, parameter names and cause values:\n\"3GPP TS 29.002 [15]\" is to be replaced with \"3GPP TS 29.338 [50]\".\n\"HLR\" is to be replaced with \"HSS/HLR\";\n\"MAP\" is to be replaced with \"Diameter\";\n\"MAP interface\" is to be replaced with \"Diameter interface\";\n\"called party SSN\" is to be replaced with \" Destination-host AVP\" when it relates to SGSN;\n\"absent subscriber error indication\" is to be replaced with \"absent user diagnostic \".\n2)\tThe protocol used on reference point 2 (reference point S6c) is based on Diameter (see 3GPP TS 29.338 [50]). In the short message mobile terminated procedure in clause 10.1\nFunctionality of MAP InformSC and MAP sendRoutingInfoForShortMsg are to be replaced with Diameter Send Routing Info For SM Request.\n3)\tThe protocol used on reference point 3 (reference point Gdd) is based on Diameter (see 3GPP TS 29.338 [50]). In clause 4.2 on inter-PLMN transfer:\nCCITT SS no 7 is to be replaced with Diameter.\n4)\tThe protocol used between HSS and SGSN (reference point S6d) is based on Diameter (see 3GPP TS 29.272 [46]). In the alert procedure in clause 10.3:\nMAP ReadyForSM is to be replaced with Diameter Notify Request (ReadyforSM).\nAnnex K (normative):SMS in 5GS\nK.1\tGeneral\nA 5GS network delivers short message services over 5GS NAS signalling.\nFor the architecture and the definition of reference points for SMS in 5GS see 3GPP TS 23.501 [51], clause 4.4.2.\nBetween the architecture and the reference points for SMS in 5GS and the architecture and the reference points shown in clause 4.1, in figure 5 of the present specification, the following mapping is used:\nTable K.1: Mapping between architecture and reference points for SMS in 5GS and the present specification\nSMS in 5GS\npresent specification\nUDM\nHSS/HLR\nNetwork entities\nSMSF\nMSC + VLR\nUE\nMS\nAMF\nMME (NOTE 1)\nN20/Namf/Nsmsf\n(not shown in figure 5)\nN21/Nsmsf\n(not shown in figure 5)\nN8/Nudm\n(not shown in figure 5)\nNot shown in 3GPP TS 23.501 (NOTE 3)\n2\nReference points\nNot shown in 3GPP TS 23.501 (NOTE 2)\n3\n(not applicable)\n4\nN1\n5\n(not applicable)\n6\nNOTE 1: In figure 5, the MME is only acting as a relay for SMS transfer via the SGs.\nNOTE 2: Reference point 3 is used between the SMSF and SMS-GMSC/IWMSC and SMS Router.\nNOTE 3: Reference point 2 or S6c is used between the UDM and SMS-GMSC/SMS Router. With reference point 2, the UDM and the SMS-GMSC/SMS Router use MAP as defined in 3GPP TS 29.002 [15] between HLR and SMS-GMSC/SMS Router or use HTTP/2 as defined in 3GPP TS 23.540 [53] between UDM and SMS-GMSC/SMS Router. With reference point S6c, the UDM and the SMS-GMSC/SMS Router use Diameter as defined in 3GPP TS 29.338 [50] between HSS and SMS-GMSC/SMS Router.\nFor the purpose of supporting SMS in 5GS, the SMSF shall implement the requirements specified in the present specification for the MSC and the VLR with the following modifications:\n1)\t\"GSM/UMTS system\" is to be replaced with \"5GS\".\n2)\tThroughout the text and in the figures, message names, parameter names and cause values:\n\"MSC\" is to be replaced with \"SMSF\";\n\"VLR\" is to be replaced with \"SMSF internal subscriber register\";\n\"HLR\" is to be replaced with \"UDM/HSS/HLR\";\n\"MS\" is to be replaced with \"UE\"; and\n\"non GPRS\" is to be replaced with \"5GS\".\n3)\tThe protocol used on reference point 2 is based on MAP as specified in 3GPP TS 29.002 [15]. In addition, it optionally may be based on Diameter as specified for reference point S6c (see 3GPP TS 29.338 [50]) or based on HTTP/2 as specified for Nudm and Nrouter service-based interfaces (see 3GPP TS 23.540 [53]).\n4)\tThe protocol used on reference point 3 is based on MAP as specified in 3GPP TS 29.002 [15]. In addition, it optionally may be based on Diameter as specified for reference point SGd (see 3GPP TS 29.338 [50]) or based on HTTP/2 as specified for Nrouter service-based interface (see 3GPP TS 23.540 [53]).\n5)\tReference point 4 is SMSF internal, and operations performed on this reference point are not standardized. In the message flows of clause 10, the SMSF replaces the combination of MSC and VLR, and messages exchanged between MSC and VLR are replaced with SMSF internal communication.\nThe architecture for SMS in 5GS is defined in 3GPP TS 23.501 [51] and uses the following reference points:\nN1:\tReference point between the UE and the AMF.\nN8:\tReference point between the UDM and the AMF.\nN20:\tReference point between the AMF and the SMSF.\nN21:\tReference point between SMSF and the UDM.\nThe following service based interfaces are used for SMS in 5GS:\nNamf:\tService-based interface exhibited by AMF. Usage of Namf service operations for SMS in 5GS is defined in 3GPP TS 23.502 [52] and in 3GPP TS 23.540 [53].\nNsmsf:\tService-based interface exhibited by SMSF. Usage of Nsmsf service operations for SMS in 5GS is defined in 3GPP TS 23.502 [52].] and in 3GPP TS 23.540 [53].\nNudm:\tService-based interface exhibited by UDM. Usage of Nudm service operations for SMS in 5GS is defined in 3GPP TS 23.502 [52] and in 3GPP TS 23.540 [53].\nK.2\tSupport for SMS when UE is registered to both 5GS and EPS\nWhen a UE is operating in dual-registration mode as specified 3GPP TS 23.501 [8] and is registered to the network via:\n-\tMME; and\n-\tAMF;\nand SMS in EPS uses SMS over SGs, the network shall deliver an MT short message either via SMS over SGs in EPS or SMS over NAS in 5GS based on local policy. In case the network determines the MT short message delivery fails, e.g. the UE is not reachable, the network may try delivering the short message via the not yet tried option for delivering the MT short message. If the network tries to deliver an MT short message via SMS over SGs in EPS and SMS over NAS in 5GS then the mobile not reachable flags specified in clause 3.2.8 of this specification are only set if MT short message delivery fails via both options.\nNOTE 1:\tThis version of the specification does not specify an architecture that provides a standardized interface between SMSF and VLR.\nEditor's note:\tSupport for SMS in MME specified in Annex I for dual registration requires further study.\nAnnex L (informative):Change history\nTSG\nTSG TDoc\nVers\nCR\nRev\nPh\nCat\nSubject\nNew Vers\nWork Item\nT#4\nTP-99126\n2.0.0\nNew\nCreation of 3GPP 23.040 v3.0.0 out of GSM 03.40 v7.1.0\n3.0.0\nT#4\nTP-99124\n3.0.0\n001\nR99\nA\nClarification concerning SMSC address checking in the MS for concatenated messages and replace message types\n3.1.0\nTEI\nT#4\nTP-99146\n3.0.0\n002\nR99\nA\nGuidance regarding the SMSC address in a Status Report\n3.1.0\nTEI\nT#5\nTP-99177\n3.1.0\n003\nR99\nA\nChange to reserved port number range for SMS\n3.2.0\nTEI\nT#5\nTP-99177\n3.1.0\n004\nR99\nB\nNew TP-PID value for delivery of ANSI-136 Short Messages\n3.2.0\nSMS\nT#5\nTP-99177\n3.1.0\n005\nR99\nD\nIEI values in concatenated SM's\n3.2.0\nSMS\nT#6\nTP-99237\n3.2.0\n007\nR99\nF\nAdaptations for UMTS\n3.3.0\nTEI\nT#6\nTP-99237\n3.2.0\n006\nR99\nC\nDuplicate messages\n3.3.0\nTEI\nT#6\nTP-99237\n3.2.0\n008\nR99\nA\nConcatenated Short Message\n3.3.0\nTEI\nT#7\nTP-000024\n3.3.0\n009\nR99\nB\nEnhancement of the Message Content in SMS\n3.4.0\nMMS\nT#7\nTP-000024\n3.3.0\n010\nR99\nB\nMultiple Information Elements\n3.4.0\nTEI\nT#7\nTP-000024\n3.3.0\n011\nR99\nB\nSMS E-MAIL PARAMETERS\n3.4.0\nTEI\n-\n-\n3.4.0\n-\n-\nR99\n-\nEditorial graphics update to make visible\n3.4.1\n-\nT#8\nTP-000073\n3.4.1\n012\nR99\nF\nAlignment in Enhanced Messaging Service\n3.5.0\nEMS\nT#8\nTP-000073\n3.4.1\n014\nR99\nF\nCorrection to text on SMS TimeZone\n3.5.0\nTEI\nT#8\nTP-000073\n3.4.1\n015\nR99\nF\nCorrection of TP-PID\n3.5.0\nTEI\nT#8\nTP-000074\n3.5.0\n013\nRel4\nB\nAddition of numbering plan value for Service Centre Specific Addresses\n4.0.0\nTEI\nT#9\nTP-000144\n4.0.0\n016\nRel4\nF\nPresence of TP-PI\n4.1.0\nSMS TEI\nT#9\nTP-000144\n4.0.0\n017\nRel4\nD\nBig endian integer representation\n4.1.0\nSMS TEI\nT#9\nTP-000144\n4.0.0\n018\nRel4\nB\nSMS Address fields section needs clarification\n4.1.0\nSMS TEI\nT#9\nTP-000144\n4.0.0\n019\nRel4\nB\nUser prompt indication\n4.1.0\nSMS TEI\nT#11\nTP-010029\n4.1.0\n020\nRel4\nC\nPredefined animations for EMS\n4.2.0\nTEI4\nT#11\nTP-010029\n4.1.0\n021\nRel4\nC\nMessage Waiting Indication Status storage on the USIM\n4.2.0\nUICC1-CPHS\nT#12\nTP-010128\n4.2.0\n023\nRel4\nF\nClarification of User Prompt Indicator\n4.3.0\nTEI4\nT#12\nTP-010128\n4.2.0\n025\nRel4\nF\nClarification of Email Addressing for Email – SMS Interworking\n4.3.0\nTEI4\nT#12\nTP-010128\n4.2.0\n026\nRel4\nF\nRemoval of duplicated values in TP-PID section\n4.3.0\nTEI4\nT#12\nTP-010128\n4.2.0\n027\nRel4\nF\nApplication Port Addressing Clarification\n4.3.0\nTEI4\nT#12\nTP-010128\n4.3.0\n022\nRel5\nB\nAddition of text and background colour\n5.0.0\nMESS5-EMS\nT#12\nTP-010128\n4.3.0\n024\nRel5\nB\nObject Distribution Indicator\n5.0.0\nMESS5-EMS\nT#12\nTP-010149\n4.3.0\n028\n1\nRel5\nB\nExtended Objects in EMS\n5.0.0\nMESS5-EMS\nT#13\nTP-010194\n5.0.0\n029\nRel5\nB\nHyperlink Information Element\n5.1.0\nTEI5\nT#13\nTP-010194\n5.0.0\n031\nRel5\nA\nRemoval of EMS PID\n5.1.0\nTEI5\nT#13\nTP-010194\n5.0.0\n033\nRel5\nB\nEMS Delivery Request\n5.1.0\nTEI5\nT#14\nTP-010280\n5.1.0\n034\nRel5\nF\nCorrection of Data Format Delivery Request\n5.2.0\nTEI5\nT#14\nTP-010280\n5.1.0\n035\nRel5\nF\nInformation Element Classification\n5.2.0\nTEI5\nT#14\nTP-010280\n5.1.0\n036\nRel5\nF\nClarification of LZSS compression for “EXTENDED OBJECTS” in EMS\n5.2.0\nMESS5_EMS\nT#14\nTP-010280\n5.1.0\n037\nRel5\nF\nExtended Object Positioning\n5.2.0\nTEI5\nT#14\nTP-010280\n5.1.0\n040\nRel5\nF\nCorrection on SMS Information Element Data Length\n5.2.0\nTEI5\nT#15\nTP-020015\n5.2.0\n041\nRel5\nB\nWireless Vector Graphics in EMS\n5.3.0\nMESS5_EMS\nT#15\nTP-020079\n5.2.0\n042\n1\nRel5\nB\nPolyphonic Extended Object\n5.3.0\nMESS5_EMS\nT#15\nTP-020015\n5.2.0\n045\nRel5\nA\nMO-SMS duplicate message response\n5.3.0\nTEI5\nT#15\nTP-020015\n5.2.0\n046\n1\nRel5\nB\nSubaddressing scheme for SMS\n5.3.0\nTEI5\nT#15\nTP-020015\n5.2.0\n047\nRel5\nB\nAlternate Reply Address Element\n5.3.0\nTEI5\nT#15\nTP-020015\n5.2.0\n048\nRel5\nC\nExtended Object Data Request Command\n5.3.0\nMESS5_EMS\nT#16\nTP-020104\n5.3.0\n049\nRel5\nF\nClarification of bit value combinations within TP-PI\n5.4.0\nTEI5\nT#16\nTP-020104\n5.3.0\n050\nRel5\nF\nReferences to the TP-RD bit\n5.4.0\nTEI5\nT#16\nTP-020104\n5.3.0\n051\nRel5\nF\nTP-DCS values for SIM data download\n5.4.0\nTEI5\nT#16\nTP-020104\n5.3.0\n054\nRel5\nC\nClarification of the requirement for type 0 Short Messages\n5.4.0\nTEI5\nT#16\nTP-020104\n5.3.0\n055\nRel5\nF\nOccurrence of the Reply Address Element\n5.4.0\nTEI5\nT#16\nTP-020104\n5.3.0\n056\nRel5\nF\nWVG Corrections and Clarifications\n5.4.0\nMESS5-EMS\nT#16\nTP-020104\n5.3.0\n057\nRel5\nF\nWVG Corrections and Clarifications\n5.4.0\nMESS5-EMS\nT#16\nTP-020104\n5.3.0\n058\nRel5\nF\nWVG Clarifications for websafe color\n5.4.0\nMESS5-EMS\nT#16\nTP-020104\n5.3.0\n059\nRel5\nF\nAdd repeat and bouncing to Standard Animation for consistency with Simple Animation\n5.4.0\nMESS5-EMS\nT#16\nTP-020104\n5.3.0\n060\nRel5\nF\nAllow angle applied to special shape grid for consistency with other special shape elements\n5.4.0\nMESS5-EMS\nT#17\nTP-020204\n5.4.0\n061\nRel5\nF\nError in MS example error\n5.5.0\nTEI5\nT#17\nTP-020204\n5.5.0\n062\nRel6\nF\nIdentification of a directory number in the User Data Field\n6.0.0\nTEI6\nT#17\n6.0.0\nAddition of compression_test_vectors.zip to the specification zip-file\n6.0.1\nT#20\nTP-030114\n6.0.1\n063\nRel6\nF\nReserved values in TP-Status\n6.1.0\nTEI6\nT#20\nTP-030114\n6.0.1\n067\nRel6\nA\nMissing SMSs over MSC even if the MS is capable of such sending\n6.1.0\nTEI6\nT#21\nTP-030173\n6.1.0\n068\nRel6\nC\nVideomail message waiting indication in TP-UDH\n6.2.0\nTEI6\nT#23\nTP-040049\n6.2.0\n070\nRel6\nA\nCorrection of error message for MAP_ForwardShortMessage\n6.3.0\nTEI5\nT#23\nTP-040059\n6.2.0\n071\n1\nRel6\nC\nProcedure for confirming the existence of an SMS interworking agreement\n6.3.0\nTEI6\nT#24\nTP-040096\n6.3.0\n072\n1\nRel6\nB\nEnhanced Voice Mail Information\n6.4.0\nTEI6\nT#24\nTP-040094\n6.3.0\n073\nRel6\nF\nOptional IEI's\n6.4.0\nTEI6\nT#25\nTP-040200\n6.4.0\n076\n1\nRel6\nB\nSpecial Message Indication – introduction of Multiple Subscriber Profiles\n6.5.0\nTEI4, TEI6\nT#25\nTP-040171\n6.4.0\n077\nRel6\nF\nEnhanced Voice Mail Information – access number priority\n6.5.0\nTEI6\nCT#30\nCP-050545\n6.5.0\n082\n1\nRel-6\nF\nReference corrections\n6.6.0\nTEI6\nCT#31\nCP-060113\n6.6.0\n0084\n-\nRel-6\nF\nCorrection of reference [28]\n6.7.0\nTEI6\nCT#33\nCP-060457\n6.7.0\n0087\nRel-6\nF\nMax user data length in GSM 7bit concatenated uncompressed message with 16 bit reference number\n6.8.0\nTEI6\n2006-10\n6.8.0\nAdds compression test vectors file (identical to those of v6.6.0).\n6.8.1\n2007-03\nCP-070145\n6.8.1\n0088\n2\nRel-7\nB\nAddition of capability to route MT-SMs via the HPLMN of the receiving MS\n7.0.0\nSMSviaH\n2007-03\nCP-070154\n6.8.1\n0091\n-\nRel-7\nF\nMapping of SIP error codes to RP-ERROR\n7.0.0\nSMSIP\n2007-03\nCP-070154\n6.8.1\n0090\n1\nRel-7\nB\nSMS over IP\n7.0.0\nSMSIP\n2007-03\nCP-070155\n6.8.1\n0089\n1\nRel-7\nF\nMNRR correction\n7.0.0\nTEI7\n2007-03\n7.0.0\nVersion 7.0.1 created by MCC (Figure 3 was the area of overlapping CRs- \"MNRR\" box split according to CR#0089r1)\n7.0.1\n2007-12\nCP-070815\n7.0.1\n0092\n1\nRel-8\nC\nSMS Router Optimization\n8.0.0\nTEI8\n2008-03\nCP-080137\n8.0.0\n0094\nRel-8\nlanguage specific extension of the GSM7 alphabet\n8.1.0\nTEI8\n2008-06\nCP-080337\n8.1.0\n0100\n1\nRel-8\nA\nCorrection to clearing of mobile not reachable flags\n8.2.0\nTEI\n2008-09\nCP-080536\n8.2.0\n0101\n1\nRel-8\nF\nSMS 16 bit port addressing. Clarification of IANA's role\n8.3.0\nTEI8\n2008-09\n8.2.0\nEditorial corrections by MCC\n8.3.0\n2009-03\nCP-090122\n8.3.0\n0104\n1\nRel-8\nA\nSM termination correction\n8.4.0\nSMSIP\n2009-03\nRel-8\nEditorial cleanup by MCC\n8.4.0\n2009-06\nCP-090413\n8.4.0\n0107\nRel-8\nF\nUE reachability notification from IP-SM-GW\n8.5.0\nSAES\n2009-06\nCP-090430\n8.5.0\n0106\n1\nRel-9\nB\nSMS Message Loop prevention\n9.0.0\nTEI9\n2009-09\nCP-090679\n9.0.0\n0109\n1\nRel-9\nA\nClarification of reset of UNRI and UNRR\n9.1.0\nTEI8\n2010-03\nCP-100135\n9.1.0\n0110\n2\nRel-9\nF\nSMS. Removal of obsolete reference to  TS 43.047\n9.2.0\nTEI9\n2010-06\nCP-100501\n9.2.0\n0111\n5\nRel-9\nF\nRP-OA modification in SMS Router\n9.3.0\nTEI9\n2011-03\nCP-110197\n9.3.0\n0112\n1\nRel-10\nF\nMS recovery from SMS memory full situation\n10.0.0\nTEI10\n2011-12\nCP-110882\n10.0.0\n0113\nRel-11\nF\nCorrection of mapping of SIP transport errors to RP-ERRORs\n11.0.0\nTEI11\n2012-03\nCP-120125\n11.0.0\n0116\n1\nRel-11\nF\nIETF reference update\n11.1.0\nTEI11\n2012-06\nCP-120315\n11.1.0\n0117\n6\nRel-11\nB\nSupport of SMS in MME\n11.2.0\nSIMTC-PS_Only\n2012-06\nCP-120315\n11.1.0\n0119\n2\nRel-11\nB\nMobile station not reachable flag stored in the MME\n11.2.0\nSIMTC-PS_only\n2012-06\nCP-120309\n11.1.0\n0124\n1\nRel-11\nB\nSMS network structure update for supporting SMS over SGs\n11.2.0\nTEI11\n2012-06\nCP-120315\n11.1.0\n0126\n1\nRel-11\nB\nAddition of application port address for device triggering\n11.2.0\nSIMTC-Reach\n2012-06\nCP-120315\n11.1.0\n0125\n1\nRel-11\nB\nAddition of external identifier\n11.2.0\nSIMTC-Reach\n2012-09\nCP-120589\n11.2.0\n0128\nRel-11\nF\nExternal Identifier at the SMS Router\n11.3.0\nSIMTC-Reach\n2012-09\nCP-120589\n11.2.0\n0129\n1\nRel-11\nB\nFunctionalities to be supported by SMS Router\n11.3.0\nSIMTC-Reach\n2012-09\nCP-120589\n11.2.0\n0131\n1\nRel-11\nF\nClarification on Support of SMS in MME\n11.3.0\nSIMTC-PS_Only\n2012-09\nCP-120589\n11.2.0\n0132\nRel-11\nF\nAlert-SC based on IMSI\n11.3.0\nSIMTC-Reach\n2012-09\nCP-120590\n11.2.0\n0130\n5\nRel-11\nB\nRegistration of MME for SMS\n11.3.0\nSIMTC-PS_Only\n2012-12\nCP-120803\n11.3.0\n0133\n1\nRel-11\nB\nFiltering function to be supported by SMS-GMSC\n11.4.0\nSIMTC-Reach\n2012-12\nCP-120803\n11.3.0\n0134\n1\nRel-11\nF\nRemoval of Annex I.2\n11.4.0\nSIMTC-PS_Only\n2013-03\nCP-130086\n11.4.0\n0135\n5\nRel-11\nF\nDevice triggering using TP-PID\n11.5.0\nSIMTC-Reach\n2013-03\nCP-130108\n11.4.0\n0136\n1\nRel-11\nF\nCorrection of S6c reference\n11.5.0\nSIMTC-PS_Only\n2013-06\nCP-130259\n11.5.0\n0137\n1\nRel-12\nB\nSMS without MSISDN\n12.0.0\nSMSCI-CT\n2013-06\nCP-130264\n11.5.0\n0138\n1\nRel-12\nF\nSMS usage of Application Port range\n12.0.0\nTEI12\n2103-09\nCP-130510\n12.0.0\n0139\n1\nRel-12\nB\nClarification on MWD for single-shot short messages\n12.1.0\nTEI12\n2013-12\nCP-130756\n12.1.0\n0140\n2\nRel-12\nSupport for Diameter based interface between SGSN and SMS central functions\n12.2.0\nDia_SGSN_SMS\n2015-12\nCP-150713\n12.2.0\n0141\n1\nRel-13\nB\nMT-SMS absent subscriber due to eDRX\n13.0.0\neDRX-CT\n2016-03\nCP-160072\n13.0.0\n0143\n6\nRel-13\nB\nMS temporarily unavailable due to power savings\n13.1.0\neDRX-CT\n2016-03\nCP-160072\n13.0.0\n0144\n2\nRel-13\nB\nPrioritized SM retransmission by the SMS SC when the UE becomes reachable\n13.1.0\neDRX-CT\n2016-03\nCP-160072\n13.0.0\n0145\n2\nRel-13\nB\nMT SM transmission to a UE in eDRX within the SM-Delivery-Start-Time/Timer\n13.1.0\neDRX-CT\n2016-03\nCP-160072\n13.0.0\n0146\n2\nRel-13\nB\nMT SM retransmission by the SMS GMSC to a UE in eDRX at the time requested in the Delivery Report\n13.1.0\neDRX-CT\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2016-09\nCP-73\nCP-160492\n0147\n6\nB\nPrioritized SM retransmission by the SMS SC when the UE becomes reachable via VLR (SMS in the PS domain and SMS over SGs)\n13.2.0\n2016-09\nCP-73\nCP-160492\n0148\n4\nB\nMT SM retransmission by the SMS GMSC to a UE in eDRX at the time requested in the Delivery Report from the MSC (SMS in the PS domain and SMS over SGs)\n13.2.0\n2016-09\nCP-73\nCP-160492\n0149\n4\nB\nMT SM transmission to a UE in eDRX within the SM-Delivery-Start-Time/Timer (SMS in the PS domain and SMS over SGs)\n13.2.0\n2017-03\nCP-75\n-\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2018-03\nCP-79\nCP-180077\n0151\n1\nB\nSupport for SMS in 5GS\n15.0.0\n2018-06\nCP-80\nCP-181057\n0152\nC\nProtocols for SMSF and UDM\n15.1.0\n2018-09\nCP-81\nCP-182158\n0153\nF\nMobile radio interface layer 3 spec reference update\n15.2.0\n2019-03\nCP-83\nCP-190100\n0155\nF\nTrigger to establish a PDN connection of non-IP type using the default APN\n15.3.0\n2020-07\nSA-88e\n-\n-\n-\n-\nUpdate to Rel-16 version (MCC)\n16.0.0\n2021-03\nCP-91e\nCP-210133\n0158\n1\n-F\nClarification for SMS support over 5GS in the network entities\n17.0.0\n2021-03\nCP-91e\nCP-210133\n0159\n1\n-F\nCorrections for the used protocols in SMS interfaces\n17.0.0\n2021-06\nCP-92e\nCP-211150\n0160\n1\nD\nInclusive language review – TS 23.040\n17.1.0\n2022-03\nCP-95e\nCP-220268\n0161\n1\nB\nSMS with HTTP/2 SBI in 5GS\n17.2.0\n2023-06\nCP-100\nCP-231273\n0163\n1\nC\nAdding a Filler IE in the User Data Header of the TP-User Data\n17.3.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_10",
        "clause_8.2.2",
        "clause_9.3",
        "clause_9.3.5",
        "clause_9.3.4.1",
        "clause_4",
        "clause_5",
        "clause_2",
        "clause_6",
        "clause_9.2.3.24.10.3.1",
        "clause_9.2.3.24.10.3.3",
        "clause_9.2.3.24.10.1.11",
        "clause_3.2",
        "clause_4.1",
        "clause_10.3",
        "clause_10.1",
        "ts_29.338_clause_4.2",
        "ts_23.501_clause_4.4.2",
        "clause_3.2.8",
        "clause_4.3.0",
        "table_8.5",
        "table_03.40",
        "table_5",
        "figure_5",
        "ts_23.501_figure_5",
        "figure_3",
        "ts_24.011",
        "ts_23.038",
        "ts_23.040",
        "ts_29.002",
        "ts_23.060",
        "ts_23.272",
        "ts_29.338",
        "ts_29.272",
        "ts_23.501",
        "ts_23.540",
        "ts_23.502",
        "ts_3.3",
        "ts_3.4",
        "ts_5.4",
        "ts_43.047"
      ]
    }
  ]
}