{
  "metadata": {
    "specification_id": "ts_23.204",
    "version": "18.0.0",
    "title": "3GPP TS 23.204",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23204-i00/23204-i00.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:34:34.469148",
    "total_chunks": 40
  },
  "chunks": [
    {
      "chunk_id": "ts_23.204_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document specifies the new capabilities and enhancements needed to support SMS over a generic IP Connectivity Access Network (IP-CAN) using IMS capabilities (TS 23.228 [9]). These include (but are not limited) to:\n1\tEnhancements to the HSS;\n2\tCommunication between the SMS-GMSC/SMS-IWMSC and the HSS;\n3\tAuthentication of service usage and registration;\n4\tTransfer of UE Terminated SMS, UE Originated SMS, and Delivery reports;\n5\tMechanisms to handle SMS when there is more than one IP connection active with the UE, etc.\n6\tMechanisms to handle MT-SMS without MSISDN to IMS UE, and SMS between IMS UEs that support MSISDN-less SMS operation.\nThe document also specifies the capabilities and enhancements needed to support the service level interworking for the Short Message service as defined in the TS 23.040 [2] and in this specification and the Instant Messaging service as defined in OMA-TS-SIMPLE_IM-V1_0 [12]. The features supported from the IM specification are limited to the exchange of short or large immediate messages in pager mode.\nNOTE:\tThe page-mode immediate message as defined in TS 24.247[14] is considered as a subset of OMA-TS-SIMPLE-IM-V1_0 [12].\nThe document also specifies the capabilities and enhancements needed to support service level interworking for the Short Message service, as defined in the TS 23.040 [2] and in this specification and the OMA CPM service as defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17]. The features supported from the CPM specification are the exchange of short or large immediate messages in pager mode, as well as session-based messaging.\nThe service requirements are described in TS 22.340 [18].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.228",
        "ts_23.040",
        "ts_24.247",
        "ts_22.340"
      ]
    },
    {
      "chunk_id": "ts_23.204_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS) Point to Point (PP)\".\n[3]\tVoid.\n[4]\tVoid.\n[5]\tVoid.\n[6]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[7]\tVoid.\n[8]\tVoid.\n[9]\t3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".\n[10]\tVoid.\n[11]\tVoid.\n[12]\tOMA-TS-SIMPLE_IM-V1_0: \"Instant Messaging using SIMPLE\", http://www.openmobilealliance.org/.\n[13]\tIETF RFC 5438: \"Instant Message Disposition Notification\", February, 2009.\n[14]\t3GPP TS 24.247: \"Messaging service using the IP Multimedia (IM) Core Network (CN) subsystem; Stage 3\".\n[15]\tOMA-RD-CPM-V1_0: \"CPM Requirements\", http://www.openmobilealliance.org/.\n[16]\tOMA-AD-CPM-V1_0: \"CPM Architecture\", http://www.openmobilealliance.org/.\n[17]\tOMA-TS-CPM_Conv_Fnct-V1_0: \"CPM Conversation Functions\", http://www.openmobilealliance.org/.\n[18]\t3GPP TS 22.340: \"IP Multimedia System (IMS) messaging; Stage 1\".\n[19]\tIETF RFC 4975: \"The Message Session Relay Protocol (MSRP)\", September 2007.\n[20]\t3GPP TS 23.682: \"Architecture enhancements to facilitate communications with packet data networks and applications\".\n[21]\t3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service description; Stage 2\".\n[22]\t3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System (EPS); Stage 2\".\n[23]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[24]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_23.040",
        "ts_29.002",
        "ts_23.228",
        "ts_24.247",
        "ts_22.340",
        "ts_23.682",
        "ts_23.060",
        "ts_23.272",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.204_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following definitions apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1]:\nConverged IP Messaging: as defined in OMA-RD-CPM-V1_0 [15]. Converged IP Messaging supports one-to-one, one-to-many personal communications, and also communication with Applications.\nCPM Message: as defined in OMA-RD-CPM-V1_0 [15]: Information that is sent to one or more recipients. A CPM Message can contain several discrete Media (e.g. text, images, audio-clips, video-clips).\nCPM AS: An application server supporting the functionality of a CPM Participating Function and/or a CPM Controlling Function as defined in OMA-RD-CPM-V1_0 [15].\nIM origination: origination of an Instant Message by an IMS UE.\nIM termination: termination of an Instant Message by an IMS UE.\nIMS core: refers to the core session control elements of the IM CN Subsystem, i.e. the CSCFs, and the IBCF.\nInstant Message: an Instant Message as defined in the OMA-TS-SIMPLE_IM-V1_0 [12] and TS 24.247 [14]. The term Instant Message is also used to designate a CPM Message.\nInterworking Selection Function: as defined in OMA-AD-CPM-V1_0 [16]. The Interworking Selection Function selects an Interworking Function that should perform the actual interworking between CPM and SMS.\nMSISDN-less SMS operation: operation to support SMS communication without the need of MSISDN in the UE's IMS subscription profile.\nMSISDN-less Correlation ID: information element which consists of Receiver Identity (i.e. SIP-URI of B party), Sender Identity (i.e. SIP-URI of A party), and HLR Identity (i.e., HLR that serves the B party).\nNon-supporting MSISDN-less SMS UE: a UE which does not support MSISDN-less SMS operation as defined in this specification.\nSIMPLE IM service: the Instant Messaging Service as defined in the OMA-TS-SIMPLE_IM-V1_0 [12].\nSM origination: origination of a Short Message (including SMS over IP) by an SMS capable UE, as defined in TS 23.040 [2] and this specification.\nSM termination: termination of a Short Message (including SMS over IP) by an SMS capable UE, as defined in TS 23.040 [2] and this specification.\nSMS: the Short Message Service as defined in the TS 23.040 [2].\nSMSF: the SMS Function as defined in TS 23.501 [23].\nSMSIP MESSAGE: an immediate message as defined in TS 23.228 [9], which encapsulates a SM in its text body.\nSMSIP UE: a UE which supports SMSIP MESSAGE.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_21.905",
        "ts_24.247",
        "ts_23.040",
        "ts_23.501",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.204_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply:\nCPM\tConverged IP Messaging\nIM\tInstant Message\nIMDN\tInstant Message Disposition Notification\nIP‑SM‑GW\tIP-Short-Message-Gateway\nISF\tInterworking Selection Function\nSM\tShort Message",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.204_4",
      "section_id": "4",
      "section_title": "Void",
      "content": "4a\tArchitecture Requirements\n4a.1\tGeneral\nThe SMS-IP architecture supports the following:\n-\tNotification shall be sent to the HSS that a previously unreachable UE is now reachable.\n-\tFunctionality is required to be able to select the domain for message delivery between IMS and CS/PS, and to have the message delivered to the selected domain.\n-\tFunctionality is required to determine whether to transform the message format or not, and to perform the transformation of the message format when determined.\n-\tThe interworking function shall generate the appropriate charging-related information and provide the appropriate online charging mechanism (if it is applied for the Short Message Service and/or SIMPLE IM services and/or CPM based services) for the interworking services.\n4a.2\tTransport-level interworking\nFor transport-level interworking , the architecture allows for the following:\n-\tA registration and de-registration mechanism shall be supported where UEs are required to explicitly indicate their ability to send and receive encapsulated Short Messages.\n-\tIt shall provide for the transport of Short Message Service TP layer PDUs (TS 23.040 [2]) and associated RP layer information.\n4a.3\tService-level interworking\nFor service-level interworking, the architecture allows for the following:\n-\tThe service-level interworking is a value added service which requires service subscription. In addition, it shall also take the operator's policy, if available, into account, e.g. checking on the barring setting of the subscriber to determine whether to provide this interworking or not, so the service authorisation shall be supported before the interworking is executed.\n-\tThe service-level interworking applies as a fallback only if the users cannot communicate with each other using their chosen messaging service according to the user preference and operator policy. The location of the interworking service can be in the originating network and in the terminating network.\n-\tThe service-level interworking shall support interworking between OMA SIMPLE IM service as defined in OMA-TS-SIMPLE_IM-V1_0 [12] and Short Message Service, as defined in the TS 23.040 [2] and in the current specification.\n-\tThe service-level interworking shall support interworking between OMA CPM service as defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17] and Short Message Service, as defined in the TS 23.040 [2] and in the current specification.\n-\tThe service-level interworking shall take the capability of the terminating UE into account when possible.\n-\tThe service level interworking shall be transparent to the end user.\n-\tThe service-level interworking shall minimize the impact on the IMS architecture.\n-\tThe service-level interworking shall not impact existing functionality of the Short Message Service as described in TS 23.040 [2] or of the SIMPLE IM service enabler as described in OMA-TS-SIMPLE_IM-V1_0 [12] or of the CPM service enabler as described in OMA TS CPM_Conv_Fnct-V1_0 [17]. Existing security mechanisms for the SIMPLE IM service, the Converged IP Messaging service and the Short Message Service shall be reused.\n-\tThe interworking function shall be aware if the message should be interworked or not, e.g. specific types of Short Messages such as an over the air configuration message, shall not be interworked at service-level, but shall be instead transported as a Short Message via IMS, CS or PS.\n-\tIf an SMS user requests an SMS status report that the message was delivered to the recipient, then an SMS status report shall be generated when the message is delivered using Instant Message.\n-\tIf an IMS user requests a notification that the message was delivered to the recipient and the Instant Message is interworked to Short Message on the originating side, an SMS status report shall be interworked to a delivery notification when the message is delivered.\n-\tThe interworking functionality shall be executed in the following cases:\n-\tOriginating network:\n-\tThe sender is an IM user or a CPM user who has subscribed to the interworking function and the recipient is not routable in IMS;\n-\tThe operator policy on the originating side has been set to send the Instant Messages via Short Message Service.\n-\tTerminating network:\n-\tThe user preferences and/or the operator policy of the recipient have been set to receive the incoming Instant Messages via Short Message Service;\n-\tThe received message is a Short Message and the recipient is an IM user or a CPM user and has subscribed to the interworking service.\nNOTE:\tFor ensuring the integrity of the response messages from the IM UE or the CPM UE, it is strongly recommended that in networks where the IP-SM-GW is deployed, no intermediate nodes modify or terminate the message between the IP-SM-GW and the terminating IM UE or CPM UE. If intermediate nodes are deployed, they can send response messages that do not reflect the final response from the IM UE or CPM UE. Final responses from the IM UE or CPM UE are necessary to ensure correct charging and delivery reports on the Short Message Service side.\n4a.4\tSMS without MSISDN\nFor SMS without MSISDN interworking, the architecture allows for the following in addition to clause 4a.2:\n-\tIt shall provide for the transport of Mobile Terminating Short Message Service to UE without the need of MSISDN in the UE's IMS subscription profile.\n-\tIt shall provide for the transport of Mobile Originating Short Message Service from IMS UE that supports MSISDN-less SMS operation to other IMS UE.\n4a.5\tSMS without MSISDN interworking with Non-supporting MSISDN-less SMS UE\nThis version of the specification does not require the support of SMS communication between IMS UE that supports MSISDN-less SMS operation as defined in this specification and non-supporting MSISDN-less SMS UE.\nNOTE:\tIt is up to implementation on the IMS network that supports the MSISDN-less SMS operation to determine how to interwork with non-supporting MSISDN-less SMS UE if required.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.1",
      "section_id": "5.1",
      "section_title": "Reference architecture",
      "content": "Figure 5.1 below shows the overall architecture for providing SMS over a generic IP CAN.\nFigure 5.1: Architecture for providing SMS over a generic IP-CAN\nNOTE:\tNodes specific to the CPM functions such as ISF are either collocated with the IP-SM-GW or else are not shown.",
      "chunk_type": "general",
      "cross_references": [
        "figure_5.1"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.2.1",
      "section_id": "5.2.1",
      "section_title": "General",
      "content": "The clauses below describe the needed enhancements and specific considerations to existing interfaces in order to support SMS over a generic IP-CAN.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.204_5.2.2",
      "section_id": "5.2.2",
      "section_title": "C/S6c interface",
      "content": "The C or S6c interface allows the SMS-GMSC, using MAP or a Diameter based protocol, to obtain the address of the IP-Message-GW via mechanisms described in clause 5.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.2.3",
      "section_id": "5.2.3",
      "section_title": "Interface between the IP-SM-GW and the HLR/HSS",
      "content": "The interface(s) between the IP-SM-GW and the HLR/HSS is used for:\n-\tSupporting the registration and de-registration from the IP-SM-GW to the HLR/HSS for SMS delivery.\n-\tForwarding of the Send Routeing Information for Short Message requests from HLR/HSS to IP-SM-GW in order to return the address where the SM should be forwarded.\n-\tInterrogating the HLR/HSS using Send Routeing Information for Short Message to retrieve the IMSI and the current MSC, SGSN, MME and/or SMSF addresses.\n-\tInforming the HLR/HSS when a memory capacity exceeded condition ceases.\n-\tRetrieving SMS related data from the HLR/HSS: subscriber data of the short message service similar to the data for the current CS/PS domain and additional service data on the service authorisation of the encapsulated short message delivery via IMS, SC address for service-level interworking from Instant Message to Short Message if the SC address is stored in the HLR/HSS.\nBoth a Sh interface and either a J or S6c interface can be deployed between the IP-SM-GW and the HLR/HSS. During the functional allocation the change on existing MAP functions, when used, should be minimized. The deployment of the J or S6c interface is mandatory, since it is used for forwarding the SRI for SM message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.204_5.2.4",
      "section_id": "5.2.4",
      "section_title": "E/Gd/Gdd/SGd interface",
      "content": "The E/Gd/Gdd/SGd interface allows the IP-SM-GW to connect to the SMS‑GMSC, appearing to the SMS‑GMSC as an MSC, SGSN, MME or SMSF.\nFor interworking with SMS in MME as defined in TS 23.272 [22], Annex C, an IWF may be used as described in that clause.\nFor interworking with an SGSN supporting the Gdd interface, an IWF may be used as described in TS 23.060 [21].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.272",
        "ts_23.060"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.2.5",
      "section_id": "5.2.5",
      "section_title": "ISC interface",
      "content": "The ISC interface allows the IP-SM-GW to forward the receiving message to the SIP based UE via IMS core.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.204_5.3.1.1",
      "section_id": "5.3.1.1",
      "section_title": "General",
      "content": "The IP-SM-GW shall provide the protocol interworking for delivery of the short message between the IP-based UE and the SMS-SC. The message is routed to the SMS-SC for delivery to the SMS-based user or the message is received from the SMS-SC of an SMS-based UE for delivery to an IP-based UE.\nThe general functions of the IP-SM-GW are:\n-\tto determine the domain (CS/PS or IMS) for delivery of a Short Message;\n-\tto connect to the SMS‑GMSC using established MAP or Diameter based protocols, appearing to the SMS‑GMSC as an MSC, SGSN, MME or SMSF using the E, Gd/Gdd or SGd interfaces;\n-\tto respond to Send Routeing Information for Short Message requests made by the SMS-GMSC, and forwarded from the HSS, with its own address;\n-\tto connect to the SMS-IWMSC using established MAP or Diameter based protocols, appearing to the SMS-IWMSC as an MSC, SGSN, MME or SMSF using the E, Gd/Gdd or SGd interfaces;\n-\tto connect to the HSS using established MAP or Diameter based protocols , to obtain the address of MSC/SGSN/MME/SMSF address(es) for SM termination in CS/PS;\nNOTE:\tThe IP-SM-GW need not support all of the functionality defined in MAP in TS 29.002 [6].\n-\tto acquire and maintain knowledge of the association between the MSISDN, IMSI and the address of the S‑CSCF serving of the user;\n-\tto check that it has a valid address in SMS for the sender as well as the recipient when receiving an IMS message for an SMS user. The IP-SM-GW shall obtain a valid address for both from the SIP headers of the IMS message (e.g. the sender would be identified in the asserted id in form of TEL URI);\n-\tfor terminating procedures:\n-\tif TEL URI is available, it maps the recipient's address from an MSISDN/IMSI to TEL URI format when receiving an SMS for an IP-based UE, and then it is the responsibility of the IMS core to perform any further mapping towards a SIP URI as required;\n-\tif TEL URI is not available, it maps the recipient's address from an IMSI to SIP URI format when receiving an SMS for an IP-based UE.\n-\tto act as an Application Server towards the IMS core;\n-\tto perform domain selection to choose the appropriate domain to deliver a message to a recipient and to obtain the MSC, SGSN, MME and/or SMSF addresses from the HSS; and\n-\tto manage flags indicating user availability for SMS termination in the HSS and in IP-SM-GW.\n-\tfor MSISDN-less SMS operation:\n-\tif the recipient is not addressed with MSISDN but with SIP-URI, the originating IP-SM-GW sends the SM toward to the target IMS network,\n-\tif delivery to target UE failed, the terminating IP-SM-GW returns MSISDN-less correlation ID to allow the originating IMS network to retry later,\n-\tif originating IP-SM-GW receives temporary delivery failure with MSISDN-less correlation ID from target IMS network, it forwards the SM along with the MSISDN-less correlation ID to SMSC for store and forwarding.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.3.1.2",
      "section_id": "5.3.1.2",
      "section_title": "Transport-level interworking",
      "content": "The additional functions of the IP-SM-GW when interworking is done by carrying encapsulated Short Messages in IMS messages are:\n-\tto communicate with the UE using IMS messaging as transport while maintaining the format and functionality of the Short Message;\n-\tto carry the SMS status messages as encapsulated bodies of IMS messages;\n-\tto store the subscriber data of the short message service similar to the data for the current CS/PS domain and to perform the short message authorization as performed by the MSC/SGSN/MME/SMSF, as well as to store additional service data on the service authorisation of the encapsulated Short Message delivery via IMS and to perform the service authorization.\nNOTE 1:\tThe short message subscriber data of the CS/PS domain and additional service data on the authorisation of encapsulated Short Message delivery via IMS are retrieved from the HLR/HSS via third party registration procedure as specified in the clause 6.1. The IP‑SM‑GW can request the HSS to send a notification whenever the subscriber data and/or additional service data is updated, which the IP‑SM‑GW can then retrieve.\nNOTE 2:\tThe mechanism for prioritizing whether the short message is delivered via a GSM/UMTS or other IP‑CAN connection when the terminal is simultaneously connected to both access networks is outside the scope of this specification.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1"
      ]
    },
    {
      "chunk_id": "ts_23.204_5.3.1.3",
      "section_id": "5.3.1.3",
      "section_title": "Service-level interworking",
      "content": "The additional functions of the IP-SM-GW when service-level interworking is done between Short Messages and Instant Messages in IMS are:\n-\tto determine whether to transform the message format or not, and to perform the transformation of the message format when determined.\n-\tto use the SC address retrieved either as part of the subscriber data from the HSS at registration or as provisioned by configuration, when transforming the Instant Message into Short Message.\n-\tto perform the authorization for service-level interworking.\nThe additional functions of the IP-SM-GW when service-level interworking is done between Short Messages and CPM Messages in IMS are the same as functions performed for Instant Messages in IMS and additionally:\n-\tto translate a chat session invitation to a short message including instructions for the SMS user how to react (accept/reject) the chat session invitation, if operator policy mandates the consent of the SMS user. Otherwise the IP-SM-GW shall respond a chat session invitation on behalf of the SMS user (accept/reject), according to operator policy;\n-\tto translate the SMS user's answer to a chat session invitation to a proper response for the chat session invitation request;\n-\tto inform SMS user about the changes of group chat session parameters;\n-\tto translate a chat session teardown request to a short message, if operator policy mandates it; and\n-\tto translate the SMS user's request to leave a chat session to a proper CPM request.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.204_5.3.2",
      "section_id": "5.3.2",
      "section_title": "HSS/UDM",
      "content": "In order to support SMS over generic IP access, the HSS/UDM shall support the following functions:\n-\tstoring the pre-configured address of the IP-SM-GW on a subscriber basis;\nNOTE:\tIf all subscribers are assigned to a single IP‑SM‑GW address, the IP‑SM‑GW address does not need to be pre-configured in the HSS.\n-\thandling an indication that the terminal is registered with an IP-SM-GW for delivery of SMS;\n-\tstoring the SMSF address when the SMSF registers with the UDM as specified in TS 23.502 [24];\n-\tresponding to the \"send routing information for short message\" query from IP‑SM‑GW with the address of the MSC/SGSN/MME/SMSF;\n-\tforwarding the Send Routeing Information for Short Message, from an SMS-GMSC, towards the IP-SM-GW and forwarding any responses to the originator of the Send Routeing Information for Short Message;\n-\treturning the IMSI and the MSC, SGSN, MME and/or SMSF addresses as a response to Send Routeing Information for Short Message required from IP-SM-GW;\n-\talerting the SCs stored in the message waiting data when the terminal is registered with an IP‑SM‑GW for delivery of short message;\n-\treporting notification to the IP-SM-GW of the reachability of a UE at the transport layer after a delivery failure;\n-\taccepting delivery status reports from IP-SM-GWs instead of SMS-GMSC.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.0",
      "section_id": "6.0",
      "section_title": "General",
      "content": "The clause describes the procedures for the support of transport-level interworking between Short Message service and encapsulated Short Message via IP service, for the support of the service-level interworking for the Short Message service and Instant Messaging service as defined in OMA-TS-SIMPLE_IM-V1_0 [12], for the support of the service-level interworking for the Short Message service and Converged IP Messaging service as defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17] and for the support of receiving MT-SMS to a UE without MSISDN. Clauses only applying to either transport-level interworking or service-level interworking are indicated as such.\nNOTE:\tIn the procedures in the following clauses, the I‑CSCF, P‑CSCF and ASs such as IM AS, as well as nodes specific to CPM functions such as ISF, are not shown in the figures.\n6.0a\tSMS without MSISDN in IMS\n6.0a.1\tMO-SMS without MSISDN in IMS\nFor MO-SMS without MSISDN, the IP-SM-GW of the originating side fills the RP-OA field with a value that indicates UE is MSISDN-less to satisfy the protocol requirement. If the originating UE does not have MSISDN or the recipient UE is addressed with SIP-URI (i.e., recipient is not addressed with MSISDN) then IP-SM-GW first tries to deliver the SMS directly to the terminating IMS network. If the terminating IMS network does not accept SMS delivery without MSISDN and responds with a permanent error indication, then IP-SM-GW shall abort any further re-attempt and responds back to sender that SMS delivery has failed.\nIf the terminating IMS network indicates the SMS delivery failed due to temporary reasons (e.g, UE is not reachable) and the response has included the MSISDN-less correlation ID for the recipient then IP-SM-GW forwards both the SM and MSISDN-less correlation ID to the SMSC for storage and for subsequent retries.\n6.0a.2\tMT-SMS without MSISDN in IMS\nFor device triggering, the selection of IMS to deliver MT-SMS without MSISDN is defined in TS 23.682 [20].\nFor SMS between IMS UEs without MSISDN, the delivery of MT-SMS to the recipient is based on the identity from the SIP MESSAGE received from the originating IMS network or retrieved using the MSISDN-less correlation ID from the Forward-Short-Message received from SMSC.\nThis clause describes the additional functionality required for the delivery of MT-SMS toward a UE in IMS without MSISDN.\nDuring UE IMS registration procedure, the serving IP‑SM‑GW obtains IMSI of the UE from the S-CSCF and the serving IP-SM-GW address is indicated to HSS as defined in clause 6.1 and HSS stores this IP-SM-GW address. IP‑SM‑GW subscribes to event registration package to receive UE's IMPU (i.e. SIP URI). UE which does not have MSISDN will have at least one SIP-URI as IMPU. When IP-SM-GW receives SM from SMSC with IMSI as the recipient address (i.e. device triggering as defined in TS 23.682 [20]), IP‑SM‑GW shall try to deliver the MT-SMS via IMS without retrying to other domain.\nWhen IP-SM-GW receives a SM from originating IMS network via SIP MESSAGE and IP-SM-GW failed to deliver the SM to the recipient and future retry is allowed and possible, then IP-SM-GW shall return a MSISDN-less correlation ID along with an indication of temporary error pointing to unsuccessful delivery attempt to the originating IMS network. This MSISDN-less Correlation ID includes sender's SIP URI, recipient's SIP URI, and HLR-Id which identifies receiver's HLR.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.1",
        "ts_23.682"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.1",
      "section_id": "6.1",
      "section_title": "Registration procedure",
      "content": "Figure 6.1: Registration procedure\n1)\tThe UE establishes IP connection.\n2)\tAt any time after the establishment of the IP connection, the UE registers at the S-CSCF according to the IMS registration procedures.\nNOTE 1:\tFor simplicity, not all messages between UE and S-CSCF and between S-CSCF and HSS are shown in detail.\n3)\tS-CSCF checks the initial filter criteria retrieved from the HSS during the IMS registration procedure.\n4)\tAfter successful IMS registration and based on the retrieved initial filter criteria, the S-CSCF informs the IP-SM-GW (AS) about the registration of the user. IMSI is informed to the IP‑SM‑GW (AS) when there is no MSISDN in the UE's IMS subscription profile.\n5)\tThe IP-SM-GW (AS) returns OK to the S-CSCF.\n6)\tThe IP-SM-GW (AS) sends IP-SM-GW Register Req to the HSS.\n7)\tThe HSS stores the received IP-SM-GW address if necessary or for MT-SMS without MSISDN (see clause 6.0a.2), uses it as an indication that the UE is available to be accessed via the IMS to trigger an Alert service centre message if the message waiting flag is set, and responses to the IP-SM-GW (AS) with IP‑SM‑GW Register Res. IP‑SM‑GW gets the IMPU (SIP URI) for SMS delivery without TEL-URI from registration event package.\nNOTE 2:\tIP-SM-GW Register Res can include the SC address to be used for this user in the subscriber data (see also clause 6.7).\nNOTE 3:\tIf the IP‑SM‑GW address stored in the HSS via registration procedure is not the same as the preconfigured IP‑SM‑GW address (if any), then the short message delivery attempted during registration can be unnecessarily delayed.\n8)\tAfter successful registration of the IP‑SM‑GW address at the HSS the HSS checks whether message waiting data are stored and alerts all SCs using procedures described in TS 23.040 [2] (see also clause 6.5b).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.0",
        "clause_6.7",
        "ts_23.040_clause_6.5",
        "figure_6.1",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.2.1",
      "section_id": "6.2.1",
      "section_title": "UE initiated",
      "content": "Figure 6.2: UE initiated de-registration procedure\n1)\tAt any time after the registration procedure, the UE may initiate a de-registration procedure. The UE sends a De-Register request (Register request with Expires header having value 0) to the S-CSCF.\n2)\tS-CSCF responds to the UE with OK.\n3)\tS-CSCF checks the initial filter criteria retrieved from the HSS during the IMS registration procedure.\n4)\tBased on initial filter criteria the S-CSCF informs the IP-SM-GW (AS) about the de-registration of the user.\n5)\tThe IP-SM-GW (AS) returns OK to the S-CSCF.\n6)\tThe IP-SM-GW (AS) de-registers the UE at the HSS sending a De-register Req.\n7)\tThe HSS de-registers the UE and responds to the IP-SM-GW (AS) with De-register Res.\nNOTE:\tThe pre-configured IP‑SM‑GW address in the HSS, if any, is not removed, as it is used for subsequent SM termination.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.2.2",
      "section_id": "6.2.2",
      "section_title": "Network initiated",
      "content": "Figure 6.2a: Network initiated de-registration procedure\n1)\tAfter receiving a trigger (e.g. De-Register message from the S‑CSCF), the IP‑SM‑GW shall de-register the IP‑SM‑GW of a subscriber from the HSS sending a De-Register Req.\n2)\tThe HSS de-registers the UE and responds to the IP‑SM‑GW (AS) with De‑register Res.",
      "chunk_type": "requirement",
      "cross_references": [
        "figure_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.3",
      "section_id": "6.3",
      "section_title": "Transport-level interworking: Successful encapsulated Short Message origination procedure with MSISDN",
      "content": "Figure 6.3: Successful encapsulated Short Message origination procedure\n1)\tThe UE registers to S-CSCF according the IMS registration procedure. Note that I-CSCF and P-CSCF are not shown in this figure.\n2)\tUE submits the encapsulated Short Message (SMS-SUBMIT, SC Address) to the S-CSCF using an appropriate SIP method.\n3)\tS-CSCF forwards the encapsulated Short Message (SMS- SUBMIT, SC Address) to IP-SM-GW (AS) based on stored iFC.\n4)\tIP-SM-GW (AS) acknowledges the SIP message.\n5)\tSIP message acknowledge is forwarded by S-CSCF to UE.\n6)\tThe IP-SM-GW performs service authorization based on the stored subscriber data as described in the clause 6.1. The IP‑SM‑GW shall check whether the subscriber is authorised to use the short message service (e.g. Operator Determined Barring settings), similar to the authorization performed by MSC/SGSN in case the Short Message is delivered via CS or PS domain. In addition, the IP-SM-GW shall also check whether the user is authorised to use the encapsulated Short Message delivery via IMS. If the result of service authorization is negative, the IP-SM-GW shall not forward the message, and shall return the appropriate error information to the UE in a failure report. Otherwise, the IP-SM-GW (AS) extracts the Short Message (SMS- SUBMIT) and forwards it towards the SMS-SC (SC Address) via the SMS-IWMSC using standard MAP or Diameter based (SGd/Gdd) signalling (as described in TS 23.040 [2]).\n7)\tThe SMS-IWMSC forwards the Short Message (SMS-SUBMIT) to the SMS-SC (see TS 23.040 [2]).\n8)\tSMS-SC sends a Submit report (SMS-SUBMIT‑REPORT) to SMS-IWMSC (see TS 23.040 [2]).\n9)\tSMS-IWMSC sends the Submit report to IP-SM-GW (AS) (see TS 23.040 [2]).\n10)\tIP-SM-GW (AS) sends the Submit report to S-CSCF, encapsulated in an appropriate SIP request.\n11)\tThe S-CSCF sends the Submit report to the UE.\n12)\tThe UE acknowledges the SIP request.\n13)\tThe S-CSCF forwards the acknowledgement of the SIP request to IP-SM-GW (AS).\n6.3a\tTransport-level interworking: Short Message origination procedure without MSISDN\n6.3a.1\tInitial delivery of SMS without MSISDN\nFigure 6.3a.1 shows the initial SM delivery by IP-SM-GW during MO-SMS operation without MSISDN.\nFigure 6.3a.1: Short Message origination procedure for MSISDN-less operation\n1)\tThe UE-A registers to S-CSCF according the IMS registration procedure. Note that I-CSCF and P-CSCF are not shown in this figure.\n2)\tUE-A submits the encapsulated Short Message (SMS-SUBMIT, SC Address) to the S-CSCF using an appropriate SIP method. Since recipient does not have MSISDN, the UE-A fills the TP-DA field with value that indicates recipient UE is addressed without MSISDN, and indicates recipient's SIP URI in SIP MESSAGE (e.g. UE-A sets the R-URI to PSI (SMSC address) and the To header with recipient's SIP URI in the MESSAGE). Based on the existing procedure, P-CSCF fills the UE-A's default URI to p-asserted-identity before sending the MESSAGE to S-CSCF.\nNOTE:\tIt is up to stage 3 to define how recipient's SIP URI is to be indicated in the protocol level.\n3)\tS-CSCF forwards the encapsulated Short Message (SMS-SUBMIT, SC Address) to IP-SM-GW (AS) based on stored iFC.\n4)\tIP-SM-GW (AS) acknowledges the SIP message.\n5)\tSIP message acknowledge is forwarded by S-CSCF to UE-A.\n6)\tThe IP-SM-GW performs service authorization based on the stored subscriber data as described in the clause 6.1. The IP SM GW shall check whether the subscriber is authorised to use the short message service (e.g. Operator Determined Barring settings), similar to the authorization performed by MSC/SGSN in case the Short Message is delivered via CS or PS domain. In addition, the IP-SM-GW shall also check whether the user is authorised to use the encapsulated Short Message delivery via IMS. If the result of service authorization is negative, the IP-SM-GW shall not forward the message, and shall return the appropriate error information to the UE in a failure report. Otherwise, the IP-SM-GW (AS) extracts the Short Message (SMS-SUBMIT) and constructs the SMS-DELIVER and sends it towards the terminating IMS network.\n7)\tThe terminating IMS network tries to deliver the SM toward the designated recipient (see clause 6.4a).\n8)\tTerminating IMS network response with one of the following:\n8a)\tTerminating IMS network refuses or does not allow SMS delivery with MSISDN-less operation by sending back a permanent error.\n8b)\tTerminating IMS network is not able to deliver the SM to designated recipient and returns a MSISDN-less correlation ID to allow retries at a later time. IP-SM-GW then forwards the SM to SMSC for storage and forward operation (see clause 6.3a.2).\n8c)\tTerminating IMS network is successfully deliver the SM toward the designated recipient.\n9)\tProper response as determined in step 8a, 8b, or 8c is returned back to UE-A. For 8a, the response indicates to the UE-A that SMS to this recipient is failed permanently. For 8b, the response is the Submit report received from the SMSC. For 8c, the response indicates a successful delivery of the SM to the recipient.\n6.3a.2\tSubsequent re-delivery of SMS without MSISDN\nWhen the initial delivery attempt failed and retry is possible (see Figure 6.3a.1 step 8b), the IP-SM-GW forwards the SM to SMS-SC for storage and forwarding operation. Figure 6.3a.2 shows the subsequent re-delivery attempt of SM by SMS-SC.\nFigure 6.3a.2: Redelivery attempt of SM without MSISDN\n1)\tIP-SM-GW forwards the SM along with the MSISDN-less correlation ID received in step 8b of figure 6.3a.1 to SMS-SC/SMS-IWMSC.\n2a)\tSMS-SC/SMS-GMSC receives a trigger to re-deliver the SMS from HSS (see clause 6.5b) and queries the HSS for serving node information using the recipient's SIP URI and HLR-id from the MSISDN-less correlation ID.\n2b)\tSMS-GMSC forwards the SM along with the MSISDN-less correlation ID to the IP-SM-GW using the address (i.e. IP-SM-GW of UE-B) received from HSS in step 2a.\n3)\tIP-SM-GW (terminating) delivers SM to UE-B via the SIP MESSAGE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1",
        "clause_6.4",
        "clause_6.3",
        "clause_6.5",
        "figure_6.3",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.4",
      "section_id": "6.4",
      "section_title": "Transport-level interworking: Successful encapsulated Short Message termination procedure from SMS-GMSC",
      "content": "Figure 6.4: Successful encapsulated Short Message termination procedure\n1)\tThe UE registers to the S-CSCF according to the IMS registration procedure.\n2)\tThe SMS-SC forwards the Short Message (SMS‑DELIVER) to the SMS-GMSC.\n3)\tSteps 3a to 3c are performed if SMS GMSC interrogates the HSS with MSISDN. For MT-SMS without MSISDN as defined in clause 6.0a, step 3d is performed if an IP-SM-GW address is available and need not be retrieved, and steps 3e to 3f are performed if an IP-SM-GW address needs to be retrieved.\n3a)\tThe SMS‑GMSC interrogates the HSS (using MSISDN) to retrieve routeing information. Based on the pre-configured IP-SM-GW address for the user, the HSS forwards the request to the corresponding IP-SM-GW.\nNOTE 1:\tThe Send Routeing Info for SM request is not forwarded if it has been sent originally from the IP‑SM‑GW.\nNOTE 2:\tIf there is only a single IP‑SM‑GW address, the IP‑SM‑GW address does not need to be pre-configured in the HSS, the Send Routeing Info for SM request can be forwarded on the STP level.\n3b)\tThe HLR/HSS returns the addresses of the current MSC, SGSN, MME or SMSF to the IP‑SM‑GW for delivery of the Short Message in CS/PS domain. The HLR/HSS also returns the IMSI, for the IP‑SM‑GW to correlate the receipt of Short Message from the MT Correlation ID within the IMSI field of the Forward Short Message.\n3c)\tThe IP SM GW creates a MT Correlation ID as per TS 23.040 [2] which associates the Send Routeing Info for SM with the subsequent Forward Short Message messages(s), and stores this along with the IMSI of the receiving subscriber. The IP-SM-GW returns only one address, which is of itself, along with the MT Correlation ID as routeing information to the SMS-GMSC.\nNOTE 3:\tFor the case where the IP‑SM‑GW address is not pre-configured in the HSS, the Send Routeing Info for SM request will be forwarded on the STP level, the IP-SM-GW returns the address of itself as routeing information to SMS-GMSC upon receipt of the forwarded Send Routeing info for SM request.\n3d)\tInterrogation is skipped in the context of T4 device triggering if an up to date IP-SM-GW address is already available at the SMS-SC/SMS-GMSC.\n3e)\tThe SMS GMSC interrogates the HSS (using IMSI) to retrieve routeing information.\n3f)\tHLR/HSS returns the addresses of IP-SM-GW, MSC (MME), SGSN and/or SMSF. If IMS is to be used for MT-SMS then continue with step 4.\n4)\tIf steps 3a to 3c have been taken, SMS-GMSC delivers the Short Message (SMS‑DELIVER) to IP-SM-GW (AS) including the MT Correlation ID received from the IP‑SM‑GW, in the same manner that it delivers the Short Message to an MSC, SGSN, MME or SMSF. Otherwise, SMS-GMSC delivers the Short Message (SMS DELIVER) to IP-SM-GW (AS) including the IMSI.\n5)\tThe IP‑SM‑GW performs service authorization based on the stored subscriber data described in the clause 6.1. The IP‑SM‑GW shall check whether the subscriber is authorised to use the short message service (e.g. Operator Determined Barring settings), similar to the authorization performed by MSC/SGSN/MME/SMSF in case the Short Message is delivered via CS or PS domain. In addition, the IP‑SM‑GW shall also check whether the subscriber is authorised to use the encapsulated Short Message delivery via IMS. If the result of service authorization is negative, the IP‑SM‑GW shall not forward the message, and shall return the appropriate error information to the SMS-SC in a failure report. Domain selection function is not performed for MT-SMS without MSISDN (i.e. when IMSI is received in step 4) and IMS is used for delivery. Otherwise (i.e. when a MT Correlation ID is received in step 4), the IP-SM-GW performs domain selection function to determine the preferred domain for delivering the message according to operator policy and user preferences. The logic for selecting preferred route for message delivery is a matter of implementation.\n6)\tIf the preferred domain is IMS, the IP-SM-GW (AS) uses the TEL-URI associated with the IMSI of the message received for the target UE to send the Short Message (SMS‑DELIVER, SC Address) encapsulated in the appropriate SIP method towards the S-CSCF. If TEL URI is not available, SIP URI is used.\n7)\tS-CSCF forwards the encapsulated Short Message (SMS-DELIVER, SC Address) to the UE.\n8)\tThe UE acknowledges the SIP request.\nNOTE 4:\tThis is not yet the Delivery report.\n9)\tThe S-CSCF forwards the acknowledgement of the SIP request to the IP-SM-GW (AS).\n6.4a\tTransport-level interworking: Short Message termination procedure without MSISDN from IMS network\nFigure 6.4a: Short Message termination procedure without MSISDN\n1)\tThe UE-B registers to the S-CSCF according to the IMS registration procedure.\n2)\tThe originating IMS network which received the SM from the UE-A forwards the Short Message (SMS-DELIVER) to the terminating IMS network. It reaches the IP-SM-GW responsible for UE-B. For brevity, the intermediate IMS nodes interactions prior to reaching IP-SM-GW are not shown.\n3)\tIf local policy allows MSISDN-less SMS operation, IP-SM-GW tries to deliver the SM to UE-B.\n4a-4b)\tSM is successfully delivered to UE-B. A success Delivery report is sent to the originating IMS network.\n5a)\tIf IP-SM-GW tried to deliver the SM but encountered some error (e.g. UE is memory full, UE not reachable, etc) then:\n5b)\tIP-SM-GW returns a MSISDN-less Correlation ID to originating IMS network along with an indication of temporary failure.\n6a-6b)\tif the IP-SM-GW refuses the MSISDN-less SMS operation due to local policy or other permanent errors (e.g. protocol error), IP-SM-GW returns a permanent error indication to the originating IMS network.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.0",
        "clause_6.1",
        "figure_6.4",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.5",
      "section_id": "6.5",
      "section_title": "Transport-level interworking: Delivery Report procedure",
      "content": "Figure 6.5: Delivery report procedure\n1)\tThe UE has received the Short Message as described in clause 6.4 or clause  6.4a.\n2)\tThe UE sends a Delivery report (SMS‑DELIVER‑REPORT) to the S-CSCF, including either a positive or a negative acknowledgement to the Short Message received in step 1.\n3)\tThe S-CSCF forwards the Delivery report to the IP-SM-GW (AS). It shall be ensured that the Delivery report reaches the same IP-SM-GW that forwarded the Short Message in step 1.\n4)\tIP-SM-GW (AS) acknowledges, at the SIP level, the Delivery report to S-CSCF.\nNOTE:\tThis is the acknowledgement to the Forward Short Message in the SM termination procedure.\n5)\tS-CSCF forwards the SIP acknowledgement to the Delivery report to the UE.\n6)\tThe IP-SM-GW (AS) sends a Delivery report to the SMS-GMSC or to originating IMS network for MSISDN-less SMS operation.\n7)\tThe IP-SM-GW may send a Report SM Delivery Status to the HSS. This may trigger the Alert service centre procedure or an update of the message waiting data in the HSS as described in TS 23.040 [2], if necessary.\n8)\tThe SMS-GMSC may send a Report SM Delivery Status to the HSS. The HSS shall ignore the information provided in this report.\n6.5a\tUnsuccessful SM termination procedure\nWhen a Short Message fails to reach the UE via the selected domain, a failure delivery report is returned to the IP‑SM‑GW. The IP‑SM‑GW takes responsibility to re-attempt the delivery of the message in another domain which is listed in the sequence of the priority in the IP‑SM‑GW while the domain selection is performed during the SM termination procedure. If the message successfully reaches the UE after re-delivery, the IP‑SM‑GW forwards the received successful Delivery report to the SMS‑GMSC. Otherwise, if the message still fails after the IP‑SM‑GW has tried all selectable domains, the IP-SM-GW forwards the received unsuccessful Delivery report to the SMS‑GMSC and sends Report SM Delivery Status message to the HLR/HSS. The HLR/HSS then records the corresponding Messages Waiting Data (MWD), and an Alert service centre procedure may be initiated as described in clause 6.5b or 6.6. The IP-SM-GW sets UE-Not-Reachable-for-IP (UNRI) locally as defined in TS 23.040 [2].\nThe order in which domains are selected for message delivery by the IP‑SM‑GW is subject to operator policy and/or user preferences and any known or assumed timer values in the SMS-GMSC for the Forward Short Message message (see NOTE 1).\nThe following flow shows only an example order of selected domains, i.e. the IMS is the preferred domain, followed by the PS domain, and finally the CS domain.\nNOTE 1:\tIf the timer at the SMS-GMSC has been configured to a short value (near to the minimum value), the IP‑SM‑GW may not have sufficient time to try the message delivery in all three domains. This problem can be resolved by several implementation solutions, e.g. re-configuring the SMS-GMSC timer to be longer, enhancing the IP-SM-GW to try the delivery only in two or one domain(s).\nFigure 6.5a: Unsuccessful SM termination procedure\n1)\tAs described in clause 6.4, the Short Message is routed to the UE via S‑CSCF after the domain selection is performed in the IP‑SM‑GW and all the available domains have been listed in the sequence of the priority in the IP‑SM‑GW. The message fails to reach the UE, e.g. due to the UE not being reachable in IMS, or exceeded memory capacity of the UE.\n2)\tThe S‑CSCF sends an appropriate failure message according to normal IMS procedure as defined in TS 23.228 [9], and sends it to the IP‑SM‑GW (AS) including an appropriate error value. This Delivery report is an acknowledgement to the Short Message received by the S-CSCF in step 1.\nNOTE 2:\tWhen the failure message is sent from the UE, e.g. the UE notifies the network that the UE has been unable to accept a Short Message because its memory capacity has been exceeded, the S‑CSCF forwards the failure message to the IP‑SM‑GW (AS).\n3)\tIP‑SM‑GW (AS) acknowledges the failure message to S‑CSCF.\n4)\tThe IP‑SM‑GW verifies the error cause of the failure delivery report. If the error is due to exceeded memory capacity of the UE, the IP‑SM‑GW forwards the Delivery report (SMS‑DELIVER‑REPORT) back to the SMS-GMSC and the procedure continues as described in step 16. Otherwise, the IP‑SM‑GW forwards the Short Message to the domain which is listed in the second place in its priority list. It is supposed that the SGSN is selected.\n5)\tThe SGSN delivers the message to the UE but the message fails to reach the UE, e.g. the UE is not reachable in PS domain.\nNOTE 3:\tIf the delivery succeeds in the PS domain at this point, the procedure for successful message delivery over PS domain is described in clause 6.4.\n6)\tThe SGSN generates a Delivery report (SMS‑DELIVER‑REPORT) and sends it to the IP‑SM‑GW, including an appropriate error value. This Delivery report is an acknowledgement to the Short Message received by the SGSN in step 5.\n7)\tThe IP-SM-GW forwards the Short Message to the domain which is listed in the third place in its priority list. It is supposed that the MSC is selected.\n8)\tThe MSC delivers the message to the UE but the message fails to reach the UE, e.g. the UE is not reachable in CS domain.\nNOTE 4:\tIf the delivery succeeds in the CS domain at this point, the procedure for successful message delivery over CS domain is described in clause 6.4.\n9)\tThe MSC generates a Delivery report (SMS‑DELIVER‑REPORT) and sends it to the IP‑SM‑GW, including an appropriate error value. This Delivery report is an acknowledgement to the Short Message received by the MSC in step 8.\n10)\tThe IP-SM-GW forwards the Short Message to the domain which is listed in the forth place in its priority list. It is supposed that the MME is selected.\n11)\tThe MME delivers the message to the UE but the message fails to reach the UE, e.g., the UE is not reachable in PS domain.\n12)\tThe MME generates a Delivery report (SMS-DELIVER-REPORT) and sends it to the IP-SM-GW, including an appropriate error value. This Delivery report is an acknowledgement to the Short Message received by the MME in step 11.\n13)\tThe IP-SM-GW forwards the Short Message to the domain which is listed in the fifth place in its priority list. It is supposed that the SMSF is selected.\nNOTE 5:\tIf the IP-SM-GW acquires two SMSF addresses from the HSS, the IP-SM-GW tries to deliver the message one by one.\n14)\tThe SMSF delivers the message to the UE but the message fails to reach the UE, e.g. the UE is not reachable in PS domain.\n15)\tThe SMSF generates a Delivery report (SMS-DELIVER-REPORT) and sends it to the IP-SM-GW, including an appropriate error value. This Delivery report is an acknowledgement to the Short Message received by the SMSF in step 14.\n16)\tThe IP‑SM‑GW sends a Delivery report to the SMS‑GMSC.\nNOTE 6:\tThe SMS-GMSC is aware of the availability of the UE on only one domain (see clause 6.4), and so will not attempt redelivery to another domain after receiving a failure report.\n17)\tThe IP-SM-GW sends a Report SM Delivery Status to the HSS with accurate results from different domains. The HSS records the corresponding MWD, i.e. the SMS‑SC address which stores the un-delivered message and the failure reason which indicates that the message failed to be sent by IP‑SM‑GW due to the UE not being available or the memory capacity of the UE being exceeded. The IP-SM-GW sets UNRI locally.\n18)\tThe IP-SM-GW subscribes to the HSS for a one-time notification of the UE being reachable again. The HSS records the subscription and instructs the transport layer to report when the UE is reachable.\n19)\tThe SMS-GMSC sends a Report SM Delivery Status to the HSS. The HSS shall ignore the information provided in this report.\n6.5b\tAlert Service Centre procedure when UE is available\nWhen a Short Message is received in the IP-SM-GW for delivery to an IMS subscriber, the IP-SM-GW shall verify the registration status of the UE. If the UE is not registered in IMS, or is registered in IMS but does not advertise the Converged IP Messaging, SIMPLE IM or SMSIP capability, the Short Message shall not be interworked; neither at service level nor at transport level. Based on operator policy and user preferences, either the message is sent over CS/PS or an error indication is sent back to the SMS-SC. In the latter case, when the UE registers in IMS advertising the Converged IP Messaging, SIMPLE IM and/or the SMSIP capability at a later time, this information is sent to the SMS-SC and the delivery is attempted at that time, as an Instant Message or an encapsulated Short Message as appropriate.\nNOTE:\tThe service level or transport level interworking of a message is prohibited as identified in the above scenario in order to prevent the possibility of the message being deferred in the terminating network.\nIf the IP-SM-GW detects the UE is reachable for SMS over IP and the UE is registered with support of Converged IP Messaging, SIMPLE IM or SMSIP capability, the IP-SM-GW clears local UNRI and informs HLR/HSS that the UE is available again.\nIf the HLR/HSS has recorded the MWD with a failure reason that the message failed to be sent by IP‑SM‑GW due to the UE not being available, once the HLR/HSS receives a message from any of the domains indicating that the UE is available again, e.g. IMSI attached, or IMS registered, the HLR/HSS initiates an Alert service centre procedure to request the SMS-SC to re-send the stored message.\nThe following figure shows an example of how a deferred message is re-transmitted to an IMS UE upon the UE availability.\nFigure 6.5b: Alert service centre procedure when UE is available\n1)\tThe message is transmitted from SMS‑SC to IP‑SM‑GW for delivery to the subscriber, possibly after transport-level and/or service-level interworking. Prior to this interworking, the IP‑SM‑GW shall check for UE availability. If the UE is not registered in IMS, and delivery over CS/PS is unsuccessful (see clause 6.5a), the IP‑SM‑GW returns an appropriate error response to SMS‑SC. The SMS-SC then informs the HSS/HLR about the unavailability of the UE. After an unsuccessful SM termination procedure due to the UE being unavailable, the HSS records the MWD i.e. the SMS‑SC address which stores the un-delivered message and the failure reason which indicates that the message failed to be sent by IP‑SM‑GW due to the UE not being available, for a subsequent Alert service centre procedure.\nAt any time after the unsuccessful SM termination procedure, the UE may attach in the PS and or CS domain again, in which case a Ready for SM message from the SGSN, MSC, MME or SMSF is sent to the HLR/HSS as described in TS 23.040 [2]. The HLR/HSS initiates an Alert service centre procedure to the SM‑IWMSC when the user's MWD is not NULL, and the procedure continues as described in step 3.\n2)\tAt any time after the unsuccessful SM termination procedure, the status of the UE may indicate that the UE is available due to, e.g. registration in IMS (step 2a). At that point UE-Not-Reachable-for-IP (UNRI) is updated in HLR/HSS, as described in TS 23.040 [2]. After the IMS registration is finished, the procedure continues as described in step 3.\nAt any time after the unsuccessful SM termination procedure, the HSS can receive a notification from the transport layer e.g. MME that the UE is reachable again (step 2b). As the IP-SM-GW has subscribed to the event as described in clause 6.5a, the HSS shall notify the IP-SM-GW of the UE being reachable again (step 2c). If the UE is already registered in IMS, the IP-SM-GW shall then send a Ready for SM message to the HLR/HSS (step 2d) and the procedure continues as described in step 3. Otherwise, the IP-SM-GW discards the notification message. The procedure will resume when one of the conditions described in steps 1 and 2 is fulfilled.\n3)\tThe HLR/HSS checks the user's MWD. If MWD is not Null, the HLR/HSS initiates an Alert service centre message to the SMS‑IWMSC.\n4)\tThe SMS‑IWMSC forwards the Alert service centre procedure to the responding SMS‑SC.\n5)\tUpon receipt of the Alert service centre message, the SMS‑SC re-attempts to send the stored Short Message. The message is transmitted to IP-SM-GW and thereafter to the UE after appropriate interworking (transport-level and/or service-level interworking) is performed. The UE acknowledges the reception of the message.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.4",
        "clause_6.5",
        "figure_6.5",
        "ts_23.040",
        "ts_23.228"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.6",
      "section_id": "6.6",
      "section_title": "Transport-level interworking: Alert service centre procedure when memory capacity is available",
      "content": "If the HLR/HSS has recorded the MWD with a failure reason that the message failed to be sent by IP‑SM‑GW due to the memory capacity of the UE is exceeded, once the HLR/HSS receives a message from any of the domain indicating that the memory capacity of the UE is available again, e.g. form the IMS, PS or CS domain, the HLR/HSS initiates a Alert service centre procedure to request the SMSC to re-send the stored message.\nThe following figure only shows an example where the HLR/HSS invokes the Alert service centre procedure when the memory capacity available message is received from IMS.\nFigure 6.6: Alert service centre procedure when memory capacity is available\n1)\tIf SM termination attempts (via IP-SM-GW) failed because the UE's Memory Capacity Exceeded, the message to be transferred to IP Based UE is queued in the SMS-SC.\n2)\tUE sends a message to IP-SM-GW indicating that the UE has memory available to receive one or more Short Messages.\n3)\tIP-SM-GW notifies the HLR/HSS of memory being available in the UE.\n4)\tIf the HLR/HSS receives the indication that the UE has memory available to receive one or more Short Messages, it initiates a Alert service centre procedure with the SC address and the MSIsdn‑Alert to SMS‑IWMSC as described in TS 23.040 [2].\n5)\tThe SMS‑IWMSC forwards the Alert service centre message to the SMS-SC whose address was provided by the HLR/HSS in step 4.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.6",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.7",
      "section_id": "6.7",
      "section_title": "Service-level Interworking: IM or CPM capable UE sends an Instant Message to an SMS user",
      "content": "Figure 6.7: Successful IM origination to SMS procedure\n1)\tThe UE registers to S-CSCF according the IMS registration procedure.\n2)\tUE submits the Instant Message to the S-CSCF using an appropriate SIP method. The UE may request to hide its Public User Identity from the recipient within the Instant Message, as described in OMA‑TS‑SIMPLE_IM‑V1_0 [12] or in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n3)\tS-CSCF forwards the Instant Message to IP-SM-GW based on stored iFC.\nNOTE 1:\tSubscribers with no subscription for service level interworking will not be provided with the relevant iFCs.\n4)\tThe IP-SM-GW shall decide whether to perform service-level interworking depending on SIP request header (e.g. Request-URI), operator policy, when the Instant Message is not routable in the IMS. If an ISF is deployed in the network, the ISF may take the decision to interwork using SMS and sends the message to the IP-SM-GW to perform the interworking. If IP-SM-GW decided to perform service-level interworking, the IP-SM-GW performs service authorization based on the stored subscriber data retrieved from the HLR/HSS at the time of the registration procedure as specified in clause 6.1. The IP-SM-GW shall check whether the originating subscriber is authorised to use the interworking service. If the result of service authorization is negative, the IP-SM-GW shall not forward the message, and shall return the appropriate error information to the UE in a failure report. Otherwise, the IP-SM-GW shall use the SC Address in the subscriber data retrieved from the HSS at registration or provisioned by configuration and translates the Instant Message to a Short Message (SMS- SUBMIT) carrying SC Address, then forwards it towards SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). If the size of the content of the Instant Message is larger than the size of the content that one Short Message could transfer, the IP-SM-GW shall split the content of the Instant Message into several parts, translate them to concatenated Short Messages, and forward the concatenated Short Messages to the SMS-SC as described in TS 23.040 [2]. If the sender of the Instant Message requests to hide its Public User Identity from the recipient and operator policy allows for this, the IP-SM-GW shall anonymize the identity of the user to the recipient. Otherwise, if operator policy prohibits this, the IP SM GW shall return an appropriate error to the user.\n5)\tIf service authorization is successful, the IP-SM-GW acknowledges the Instant Message.\n6)\tInstant Message acknowledgement is forwarded by S-CSCF to UE.\nNOTE 2:\tSteps 5 and 6 can occur anytime after the subscriber authorization check has been performed by the IP‑SM‑GW.\n7)\tThe SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC (see TS 23.040 [2]).\n8)\tThe SMS-SC sends a Submit report (SMS-SUBMIT REPORT) to the SMS-IWMSC (see TS 23.040 [2]).\n9)\tSMS-IWMSC sends a Submit report to IP-SM-GW (see TS 23.040 [2]).\nNOTE 3:\tThe procedure can end in step 9. Steps 10 to 13 occur only if the IM user requested a processing notification in the Instant Message sent in step 2, as described in IETF IMDN RFC 5438 [13].\n10)\tIP-SM-GW translates the received Submit report to an appropriate Instant Message, and forwards it to the S‑CSCF. If the IP‑SM‑GW sent concatenated Short Messages to SMS-SC in step 4, the IP‑SM‑GW should wait for the last Submit report, and translate the last Submit report to an appropriate Instant Message, and forward it to the S‑CSCF.\n11)\tS-CSCF sends the translated Instant Message to the UE.\n12)\tUE acknowledges the translated Instant Message.\n13)\tAcknowledgement of the translated Instant Message is forwarded by S-CSCF to IP-SM-GW.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "figure_6.7",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.8.1",
      "section_id": "6.8.1",
      "section_title": "General",
      "content": "The interaction between transport-level interworking (between SMS over CS/PS and SMS over IMS) and service-level interworking (between Instant Messaging and SMS) depends on the user subscription and authorisation, on the UE capabilities, and on operator policy.\nIf a user is only subscribed to either transport-level interworking or service-level interworking, only procedures defined for the subscribed interworking may be performed.\nIf a user is subscribed to both transport-level interworking and service-level interworking, but the user is only authorised for one of the interworking when the message is processed, only the authorised interworking may be performed.\nIf a user is subscribed to both transport-level interworking and service-level interworking, and is authorised for both, the behaviour of the IP-SM-GW depends on the specific scenario, on the registered capabilities of the UE, and finally is defined by operator policy and user preferences.\nFor a user subscribed to service-level interworking, two Application Servers in the network are normally called upon to handle an Instant Message:\n-\tthe IM AS, defined in OMA-TS-SIMPLE_IM-V1_0 [12] or the CPM AS, defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n-\tthe IP-SM-GW.\nThe following clauses describe the different interaction scenarios.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.204_6.8.2",
      "section_id": "6.8.2",
      "section_title": "IMS Originating",
      "content": "In the originating network, a UE sends a SIP MESSAGE (Encapsulated Short Message or Instant Message). The originating S‑CSCF forwards the SIP MESSAGE to the IP-SM-GW based on the iFC. The subscription of the transport level interworking and the service level interworking applies for different iFC. However, the SIP MESSAGE is forwarded to the IP-SM-GW if the user subscribes to one of the interworking services. If there is no subscription for the interworking service, the S‑CSCF continues with the subsequent iFC check. After all the originating iFC triggers have been handled, the S‑CSCF attempts to route the message to the terminating IMS network. If it fails, an error is returned to the sender.\nNOTE 1:\tif an IM AS or a CPM AS is present in the network, Instant Messages are routed to it before going to the IP-SM-GW.\nNOTE 2:\tAn encapsulated Short Message uses the PSI of the SC as the Request-URI. If the user is not subscribed to transport-level interworking and the IP-SM-GW is not invoked, the ENUM query fails, and an error is returned to the sender.\nWhen the IP-SM-GW receives the SIP MESSAGE, it shall decide which interworking should be performed based on the content of the received SIP MESSAGE, as the IP-SM-GW can distinguish between an encapsulated Short Message and an Instant Message. If an encapsulated Short Message is received and if the subscriber is authorised for the service, the IP-SM-GW maps the encapsulated Short Message to a Short Message. Similarly, when an Instant Message is received, the IP-SM-GW considers performing the service-level interworking if the service is authorized: the IP‑SM‑GW shall decide whether to send the SIP MESSAGE via interworking service based on SIP request header (e.g., R‑URI), operator policy, when the Instant Message is not routeable in the IMS or when the IP-SM-GW is selected to handle the message.\nFigure 6.8.2.1: Performing interworking service on originating side",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.8.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.8.3",
      "section_id": "6.8.3",
      "section_title": "IMS Terminating",
      "content": "When the IP-SM-GW receives a Short Message from the legacy network on the terminating side, it performs the domain selection to determine the preferred domain to transfer the short message. If the selected network is IMS, the IP-SM-GW will determine whether the transport level interworking or the service level interworking is to be preformed based on the users' subscription and authorisation, and on the UE capability as indicated during IMS registration. If the user has subscribed to both services, is authorised for both and the UE has indicated its capability to receive both encapsulated Short Messages and Instant messages, the priority between the transport-level interworking and the service-level interworking is based on operator policy and user preferences.\nNOTE 1:\tIf the incoming Short Message is interworked to an Instant Message, the resulting Instant Message could be routed to the IM AS or CPM AS before being sent to the UE.\nFigure 6.8.3.1: Performing interworking service on terminating side for an incoming Short Message\nWhen the IP-SM-GW receives an Instant Message, based on user subscription and authorisation for service-level interworking, on operator policy and user preferences, and on UE capability indicated during IMS registration, the IP‑SM‑GW may perform service-level interworking to transform the message format to SMS and deliver the message to the UE. If the user is subscribed and authorised for transport-level interworking, and based on UE capability indicated during IMS registration, and on operator policy and user preferences, the message may be delivered as an encapsulated Short Message to the UE over IMS. Otherwise, the Short Message is delivered over CS/PS.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.8.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.9",
      "section_id": "6.9",
      "section_title": "Service-level Interworking: Concatenated Short Messages delivered as a large Instant Message",
      "content": "An IMS registered user with IM service or CPM service receives a concatenated short message delivered as two or more short messages. The information below describes the behaviour when the received concatenated Short Message exceeds the maximum payload size of an Instant Message.\nFigure 6.9: Concatenated Short Messages delivered as an IM large message\n1)\tThe UE registers to the S-CSCF according to the IMS registration procedure.\n2)\tThe SMS-SC forwards a Short Message that is part of a concatenation of two or more Short Messages to the SMS-GMSC.\n3a)\tThe SMS GMSC interrogates the HSS to retrieve routeing information. Based on the pre-configured IP-SM-GW address for the user, the HSS forwards the request to the corresponding IP-SM-GW.\n3b)\tThe HLR/HSS returns the IMSI and the address(es) of the current MSC, SGSN, MME and/or SMSF to the IP-SM-GW for delivery of the SMS SM in CS/PS domain.\n3c)\tThe IP-SM-GW creates a MT Correlation ID as per TS 23.040 [2], which associates the Routeing Info retrieval with the subsequent Forward Short Message messages(s), and stores this along with the IMSI of the receiving subscriber. The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the MT Correlation ID in the IMSI field, as routeing information. Alternatively, the IP-SM-GW may return the address(es) of the current MSC, SGSN, MME and/or SMSF, in which case, the subsequent procedure to forward the message is the same as defined in TS 23.040 [2].\n4)\tThe SMS-GMSC delivers the Short Message to the IP-SM-GW in the same manner that it delivers the Short Message to an MSC, SGSN, MME or SMSF, including the MT Correlation ID received from the IP-SM-GW, in place of the IMSI.\n5)\tThe IP-SM-GW checks whether the recipient is authorized for the interworking service. If the user is authorized, the IP-SM-GW recognizes that the received message is part of a concatenated Short Message and stores the received message.\nNOTE 1:\tThe IP-SM-GW needs to have access to a persistent storage in order to aggregate all the Short Message parts.\n6)\tThe IP-SM-GW acknowledges the Forward Short Message to the SMS-GMSC.\n7)\tThe SMS-GMSC may send a Report SM Delivery Status to the HSS. The HSS shall ignore the information provided in this report.\n8)\tThe SMS-GMSC sends a Delivery report (SMS-DELIVER-REPORT) to the SMS-SC.\n9)\tThe SMS-SC forwards the next Short Message that is part of a concatenation of two or more Short Messages to the SMS-GMSC.\nNOTE 2:\tIf this is not the last Short Message of the concatenation, then processing continues at step 4.\n10)\tIf this is the last Short Message of the concatenation, then the SMS GMSC delivers the Short Message to the IP-SM-GW in the same manner that it delivers the Short Message to an MSC, SGSN, MME or SMSF, including the MT Correlation ID received from the IP-SM-GW, in place of the IMSI.\n11)\tThe IP-SM-GW checks whether the recipient is authorized for the interworking service. If the user is authorized, the IP-SM-GW recognizes that the received message is part of a concatenated Short Message and stores it.\n12-13)\tOnce all the segments have been received, the IP-SM-GW establishes an MSRP session with the recipient's UE to deliver the message. The session invitation is sent to the recipient UE.\nNOTE 3:\tAs a matter of implementation efficiency, the IP-SM-GW may initiate the connection towards the recipient after receiving the first Forward Short Message and passing a service authorization check. This may help prevent timeouts at the SMS GMSC (while it waits for the final Delivery report) but may also result in unnecessary session initiation signalling if there is a failure in a service check for subsequently received Short Messages.\n14)\tThe IP-SM-GW delivers the message in one or more MSRP SEND requests to the recipient UE.\n15) -16)\tThe IP-SM-GW closes the session after message delivery is complete.\n17)\tThe IP-SM-GW acknowledges the Forward Short Message to the SMS-GMSC.\n18)\tThe IP-SM-GW may send a Report SM Delivery Status to the HLR/HSS for either of the following cases:\n-\tsetting of the Message Waiting flags when the Forward Short Message was unsuccessful;\n-\tclearing of the Message Waiting flags in HLR/HSS when the Forward Short Message was successful, but had previously failed.\nNOTE 4:\tSee TS 23.040 [2] for a full explanation of when the Message Waiting flags are set and unset.\n19)\tThe SMS-GMSC may send a Report SM Delivery Status to the HSS. The HSS shall ignore the information provided in this report.\n20)\tThe SMS-GMSC sends a Delivery report (SMS-DELIVER-REPORT) to the SMS-SC.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.9",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.10",
      "section_id": "6.10",
      "section_title": "Service-level interworking: Status Report procedure for Instant Message to Short Message interworking",
      "content": "Figure 6.10: Status report procedure for Instant Message to Short Message interworking\n1)\tAn Instant Message from the UE is successfully delivered to the SMS user after service-level interworking. The original Instant Message requested a Disposition Notification.\nNOTE 1:\tA Disposition Notification can be requested in the message sent by the UE in step 1 as described in IETF IMDN draft-ietf-simple-imdn [13]. If the requested Disposition Notification by the IM user is a request for a read notification, the IP-SM-GW ignores the request.\n2)\tThe SMS-SC sends a Status report to the SMS-GMSC.\nNOTE 2: The Status report will, from the SMS-GMSC's point of view be treated as any SM termination.\nNOTE 3:\tThe Status report is an optional message.\n3a)\tThe SMS GMSC interrogates the HLR/HSS to retrieve routeing information. Based on the pre-configured IP-SM-GW address for the user, the HLR/HSS forwards the request to the corresponding IP-SM-GW.\n3b)\tThe HLR/HSS returns the IMSI and the address(es) of the current MSC, SGSN, MME and/or SMSF to the IP-SM-GW for delivery of the Short Message in CS/PS domain.\n3c)\tThe IP-SM-GW creates a MT Correlation ID as per TS 23.040 [2], which associates the Routing Info retrieval with the subsequent Forward Short Message messages(s), and stores this along with the IMSI of the receiving subscriber. The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the MT Correlation ID in the IMSI field, as routeing information. Alternatively, the IP-SM-GW may return the address(es) of the current MSC, SGSN, MME and/or SMSF, in which case, the subsequent procedure to forward the message is the same as defined in TS 23.040 [2].\n4)\tThe SMS-GMSC sends the status report in the Forward Short Message to the IP-SM-GW.\nNOTE 4:\tSteps 5 to 11 only occur if the original IM requested a delivery notification in the Disposition Notification.\n5)\tThe IP-SM-GW translates and maps the Status report in the Forward Short Message into an Instant Message carrying a Delivery Notification as described in the IETF IMDN draft-ietf-simple-imdn [13]. The IP‑SM‑GW should keep the message id for a message for which IMDN was requested so it can send the message id to the UE in the IMDN.\n6-7)\tThe IP-SM-GW sends a Delivery Notification within an Instant Message to the S-CSCF, which sends the Instant Message to the UE.\n8-9)\tThe UE acknowledges receipt of the Instant Message containing the Delivery Notification to the S-CSCF. The S‑CSCF sends the acknowledgment to the IP-SM-GW.\n10)\tThe IP-SM-GW sends a Delivery report (SMS-DELIVER-REPORT) to the SMS-GMSC.\n11)\tThe SMS-GMSC sends an acknowledgement back to the SMS-SC.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.10",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.11",
      "section_id": "6.11",
      "section_title": "IM or CPM user sends an Instant Message to an SMSIP UE",
      "content": "An IMS registered user with SIMPLE IM service or CPM service sends an Instant Message via service-level interworking as an encapsulated Short Message to an SMSIP UE, which did not indicate support for SIMPLE IM or CPM when registering to IMS.\nNOTE 1:\tBased upon user subscription and depending on network deployment, other Application Servers could be processing the incoming Instant Message before the IP-SM-GW. The behaviour of the IM AS is described in OMA-TS-SIMPLE_IM-V1_0 [12]. The behaviour of the CPM AS is described in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\nFigure 6.11: Successful UE termination Instant Message to encapsulated Short Message procedure\n1)\tIM or CPM UE sends an Instant Message to the S-CSCF#1. The UE may request to hide its Public User Identity from the recipient within the Instant Message, as described in OMA‑TS‑SIMPLE_IM‑V1_0 [12] and in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n2)\tThe S-CSCF#1 forwards the Instant Message to the S-CSCF#2.\n3)\tThe S-CSCF#2 forwards the Instant Message to the IP-SM-GW based on iFC.\n4)\tBased on user subscription and authorisation for service-level interworking, on operator policy and user preferences, and on UE capability indicated during IMS registration, the IP-SM-GW shall decide whether to perform service-level interworking. If the user is subscribed and authorised for transport-level interworking, and based on UE capability indicated during IMS registration, and on operator policy and user preferences, the message may be delivered as an encapsulated Short Message to the UE over IMS. Otherwise, the Short Message is delivered over CS/PS, as described in clause 6.13. If the sender of the Instant Message requests to hide its Public User Identity from the recipient and operator policy allows for this, the IP‑SM‑GW shall anonymise the identity of the user to the recipient. Otherwise, if operator policy prohibits this, the IP‑SM‑GW shall return an appropriate error to the user.\nNOTE 2:\tIf a delivery notification was requested in the message sent by the UE in step 1 as described in IETF IMDN RFC 5438 [13], the procedure for delivery report described in clause 6.12 applies. Otherwise IP-SM-GW will just acknowledge, at the SIP level, the Delivery report received from the SMSIP UE.\n5)\tThe IP-SM-GW forwards the encapsulated Short Message to the S-CSCF#2.\n6)\tThe S-CSCF#2 forwards the encapsulated Short Message to the SMSIP UE.\n7)\tThe SMSIP UE acknowledges the translated encapsulated Short Message.\n8)\tThe S-CSCF forwards the acknowledgement of the translated encapsulated Short Message to the IP-SM-GW.\n9-11)\tThe IP-SM-GW forwards the acknowledgement of the translated encapsulated Short Message to the originating IM UE or CPM UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.13",
        "clause_6.12",
        "figure_6.11"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.12",
      "section_id": "6.12",
      "section_title": "Delivery report for an Instant Message delivered as encapsulated Short Message",
      "content": "This procedure follows the procedure described in clause 6.11, when the original Instant Message included a delivery notification request.\nFigure 6.12: Delivery report after a successful Instant Message to encapsulated Short Message procedure\nNOTE:\tAn encapsulated Short Message has been sent successfully according to the procedure described in clause 6.11 before the procedure below can be performed.\n1-2)\tThe SMSIP UE has received the Short Message as described in clause 6.11 and sends a Delivery report (SMS-DELIVER-REPORT) to the IP-SM-GW via the S-CSCF.\n3-4)\tThe IP-SM-GW acknowledges, at the SIP level, the Delivery report to the SMSIP UE via the S-CSCF.\n5-7)\tThe IP-SM-GW sends a Delivery Notification to the IM UE or CPM UE.\n8-10)\tThe IM UE or CPM UE acknowledges the reception of the Delivery Notification.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.11",
        "figure_6.12"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.13",
      "section_id": "6.13",
      "section_title": "Service-level interworking: IM or CPM capable UE sends an Instant Message to an SMS user with Interworking in the terminating side",
      "content": "This procedure describes the delivery of an Instant Message to a registered or an un-registered IMS subscriber. For the unregistered case, the S‑CSCF forwards the Instant Message to the IP‑SM‑GW based on the unregistered iFC of the subscriber.\nFigure 6.13: Successful IM terminating to SMS procedure with Interworking in the Terminating Side\n1)\tUE submits an Instant Message, destined to another IM user or CPM user in another IMS domain, using an appropriate SIP method. The UE may request to hide its Public User Identity from the recipient within the Instant Message, as described in OMA‑TS‑SIMPLE_IM‑V1_0 [12] and in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n2)\tThe S-CSCF resolves the destination domain and routes the message towards the S-CSCF in the terminating network (\"Terminating S-CSCF\").\n3)\tThe terminating S-CSCF forwards the Instant Message to the IM AS (\"Terminating IM AS\") or to the CPM AS (\"Terminating CPM AS\") based on stored iFC.\nNOTE:\tDepending on iFC configuration, it is possible that the IM AS or CPM AS is not triggered for the unregistered subscribers.\n4)\tThe terminating IM AS or CPM AS invokes terminating IM or CPM services as applicable for the destination IM or CPM user.\n5a)\tThe IM AS or CPM AS can forward the Instant Message back to the terminating S-CSCF, e.g. the terminating IM user is offline or the CPM user has no terminating interworking user preferences.\n5b)\tIn the case of the CPM AS, if terminating interworking user preferences are set, the Instant Message is routed directly to the IP-SM-GW in which case the procedure continues with step 7.\n6)\tThe terminating S-CSCF forwards the Instant Message to the IP-SM-GW, e.g. based on stored iFC.\n7)\tIf the user is authorized, the IP-SM-GW performs service-level interworking by converting the Instant Message to Short Message. The IP-SM-GW shall obtain the routeing information for the UE from the HLR/HSS and deliver the message to the UE. If the sender of the Instant Message requests to hide its Public User Identity from the recipient and operator policy allows for this, the IP‑SM‑GW shall anonymise the identity of the user to the recipient. Otherwise, if operator policy prohibits this, the IP‑SM‑GW shall return an appropriate error to the user.\n8)\tThe IP-SM-GW obtains the routeing information for the destination UE from the HLR/HSS.\n9)\tThe IP-SM-GW sends the Forward Short Message message to the target MSC/SGSN/MME/SMSF.\n10)\tThe MSC/SGSN/MME/SMSF sends the Short Message to the UE.\n11)\tThe UE acknowledges the receipt of the Short Message.\n12)\tThe MSC/SGSN/MME/SMSF sends a Delivery report (SMS-DELIVER-REPORT) to the IP-SM-GW.\n13)\tThe IP-SM-GW sends OK response to the terminating S-CSCF.\n14)\tThe S-CSCF forwards the OK to the terminating IM AS or CPM AS.\n15)\tThe terminating IM AS or CPM AS forwards the OK response back to the terminating S-CSCF.\n16)\tThe terminating S-CSCF forwards the OK back towards the originating S-CSCF.\n17)\tThe originating S-CSCF forwards the OK to the originating UE.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.13"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.14",
      "section_id": "6.14",
      "section_title": "Service-level interworking: IM or CPM user receives Short Message from an SMS user",
      "content": "An IMS registered user with SIMPLE IM or CPM service receives a Short Message formatted via service-level interworking to an Instant Message.\nFigure 6.14: Successful IM termination after service-level interworking\n1)\tThe UE registers to the S-CSCF according to the IMS registration procedure.\n2)\tThe SMS-SC forwards a Short Message to the SMS-GMSC.\n3a)\tThe SMS GMSC interrogates the HSS to retrieve routeing information. Based on the pre-configured IP-SM-GW address for the user, the HSS forwards the request to the corresponding IP-SM-GW.\n3b)\tThe HLR/HSS returns the IMSI and the address(es) of the current MSC, SGSN, MME and/or SMSF to the IP-SM-GW for delivery of the SM in CS/PS domain.\n3c)\tThe IP-SM-GW creates a MT Correlation ID as per TS 23.040 [2], which associates the Routing Info retrieval with the subsequent Forward Short Message messages(s), and stores this along with the IMSI of the receiving subscriber. The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the MT Correlation ID in the IMSI field, as routeing information.\n4)\tThe SMS-GMSC delivers the Short Message to the IP-SM-GW in the same manner that it delivers the Short Message to an MSC, SGSN, MME or SMSF, including the MT Correlation ID received from the IP-SM-GW, in place of the IMSI.\n5)\tThe IP-SM-GW checks whether the recipient is authorized for the interworking service.\nNOTE 1:\tThe IP-SM-GW will determine whether the transport-level interworking or the service-level interworking is to be performed according to clause 6.8.3.\n6)\tIf the user is authorized for service-level interworking, the IP-SM-GW converts the Short Message to an Instant Message. It sends the Instant Message using the appropriate SIP method towards the S-CSCF.\n7)\tThe S-CSCF forwards the Instant Message to the UE.\n8)\tThe UE acknowledges the SIP request to the S-CSCF.\n9)\tThe S-CSCF forwards the acknowledgement of the SIP request to the IP-SM-GW.\n10)\tThe IP-SM-GW acknowledges the Forward Short Message to the SMS-GMSC.\n11)\tThe SMS-GMSC sends a Delivery report (SMS‑DELIVER‑REPORT) to the SMS‑SC.\n12)\tThe IP‑SM‑GW may send a Report SM Delivery Status to the HLR/HSS.\n13)\tThe SMS-GMSC may send a Report SM Delivery Status to the HSS. The HSS shall ignore the information provided in this report.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.8.3",
        "figure_6.14",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.15.1",
      "section_id": "6.15.1",
      "section_title": "IP-SM-GW in the originating network",
      "content": "Figure 6.15.1: Chat session invitation to SMS user and Message data exchange (IP-SM-GW in originating network)\n1)\tThe UE registers to S-CSCF according to the IMS registration procedure.\n2)\tThe UE sends a session invitation request for a chat session to the S-CSCF, using the appropriate SIP method. The UE may request to hide its Public User Identity from the recipient within the session invitation.\n3)\tS-CSCF forwards the session invitation to the IP-SM-GW based on stored iFC.\nNOTE 1:\tSubscribers with no subscription for service level interworking will not be provided with the relevant iFCs.\n4)\tThe IP-SM-GW performs service authorization based on the stored subscriber data retrieved from the HLR/HSS at the time of the registration procedure as specified in clause 6.1. The IP-SM-GW shall check whether the originating subscriber is authorised to use the interworking service. If the result of service authorization is negative, the IP-SM-GW shall not forward the message, and shall return the appropriate error information to the UE in a failure report.  If the sender of the session invitation asks to hide its Public User Identity from the recipient and operator policy allows for this, the IP-SM-GW shall anonymize the identity of the user in all messages it sends to the recipient. If operator policy prohibits anonymity, the IP-SM-GW shall not perform interworking and shall send back an appropriate response.\nNOTE 2:\tSteps 5 to 7 are only executed if the operator policy is to check back with the SMS user before accepting the invitation on behalf of the SMS user. Otherwise, the process continues with step 8, as if the SMS user has responded with an acceptance of the chat session invitation.\n5)\tOtherwise, the IP-SM-GW correlates an MSISDN to this chat session. Any SMS sent from the SMS user to this MSISDN should be interworked into the chat session with which this MSISDN is correlated. The IP-SM-GW shall use the SC Address in the subscriber data retrieved from the HSS at registration or provisioned by configuration and translates the chat session invitation request to a Short Message (SMS- SUBMIT) carrying an SC Address, then forwards it towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The text in the Short Message is defined by the operator and should convey information to the SMS user that he is invited to send and receive messages in the context of a chat session, and include instructions on how to accept, reject and end the session. If no response is received in time, the IP-SM-GW will consider the session rejected and send an appropriate response to the session invitation.\nNOTE 3:\tThe MSISDN used as the sender of the Short Message is either the MSISDN of the CPM user or one that is assigned by the IP-SM-GW, depending on operator configuration.\n6)\tThe SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\n7)\tA Short Message is sent by the SMS user via the SMS-GMSC to the IP-SM-GW in accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14.\n8)\tIf the answer is positive, the IP-SM-GW acknowledges the session invitation. Otherwise the IP-SM-GW will consider the session rejected and send back an appropriate response.\n9)\tSession invitation acknowledgement is forwarded by S-CSCF to the CPM UE.\nNOTE 4:\tThe following steps are executed only if an SMS with a positive answer is received from the SMS user or if the operator policy indicated that the session is accepted without SMS user interaction. If a negative response to the invitation is received or if no response from the SMS user is received within an operator defined time, the IP-SM-GW will send a negative response to the chat invitation.\nNOTE 5:\tSteps 10 to 12 are repeated for each message sent from the CPM user towards the SMS user, and steps 13 to 14 are repeated for each message sent from the SMS user towards the CPM user.\n10)\tThe CPM user sends a message within the chat session containing data to the recipient SMS user.\n11)\tThe IP-SM-GW transforms the received message into a Short Message and sends a Short Message (SMS- SUBMIT) carrying the SC Address, then forwards it towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). According to operator policy, each SMS generated for the SMS user may include text instructions on how to leave the chat session.\n12)\tThe SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\n13)\tA Short Message is sent by the SMS user via the SMS-GMSC to the IP-SM-GW in accordance to steps 2 to 13 from clause 6.14.\nNOTE 6:\tStep 5 of the flow in clause 6.14 becomes this: The IP-SM-GW identifies that a session exists between the SMS user and the CPM user.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "clause_6.14",
        "figure_6.15.1",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.15.2",
      "section_id": "6.15.2",
      "section_title": "IP-SM-GW in the terminating network",
      "content": "The SMS user (SMS UE B) in this flow is a CPM user (CPM user B) whose preferences are set in his home network to receive his incoming chat sessions as Short Messages.\nFigure 6.15.2: Chat session invitation to SMS user and message data exchange (IP-SM-GW in terminating network)\n1)\tThe originating network for CPM user A sends a session invitation request for a chat session to a CPM user (CPM user B) in another IMS domain, using the appropriate SIP method. The UE may request to hide its Public User Identity from the recipient within the session invitation. The originating S-CSCF (not shown) resolves the destination domain and routes the session invitation towards the S-CSCF in the terminating network (\"terminating S-CSCF\").\n2)\tThe terminating S-CSCF forwards the session invitation to the IP-SM-GW based on stored iFC.\nNOTE 1:\tSubscribers with no subscription for service level interworking will not be provided with the relevant iFCs.\n3)\tAuthorization to continue is checked. If the sender of the session invitation asks to hide its Public User Identity from the recipient and operator policy allows for this, the IP SM GW shall anonymize the identity of the user in all messages it sends to the recipient. If operator policy prohibits anonymity, or if the IP-SM-GW cannot identify the sending party and the operator prohibits session invitations from unidentified users, the IP SM GW shall not perform interworking and send back an appropriate response.\nNOTE 2:\tSteps 5 to 7 are only executed if the operator policy is to check back with the SMS user before accepting the invitation on behalf of the SMS user. Otherwise, the process continues with step 8, as if the SMS user has responded with an acceptance of the chat session invitation.\n4)\tThe IP-SM-GW performs service-level interworking by converting the chat session invitation request to a Short Message. The IP-SM-GW obtains the routeing information for the destination UE from the HLR/HSS.\n5)\tThe IP-SM-GW sends the Forward Short Message message to the target MSC. The IP-SM-GW assigns an MSISDN representing the chat session to ensure that the reply to this SMS is sent back to this particular IP-SM-GW. Any SMS sent from the SMS user to this MSISDN should be interworked into the chat session with which this MSISDN is correlated. The text in the Short Message is defined by the operator and should convey information to the SMS user that he is invited to send and receive messages in the context of a chat session, and include instructions on how to accept, reject and end the session. The identity of the original sender (CPM user or group) is included as part of the operator provided invitation text. If no response is received in time, the IP-SM-GW will consider the session rejected and send an appropriate response to the session invitation.\n6)\tThe MSC/SGSN/MME/SMSF sends the Short Message to the SMS user.\n7)\tA Short Message is received via the SMS-GMSC from the SMS user by the IP-SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14, indicating the response to the chat session invitation. The message is targeted to the MSISDN representing the chat session which was assigned in step 5.\n8)\tIf the answer is positive, the IP-SM-GW acknowledges the session invitation. Otherwise the IP-SM-GW will consider the session rejected and send back an appropriate response.\n9)\tThe session invitation acknowledgement is forwarded by S-CSCF to the CPM UE.\nNOTE 3:\tThe following steps are executed only if an SMS with a positive answer is received from the SMS user or if the operator policy indicated that the session is accepted without SMS user interaction. In case a negative response to the invitation is received or if no response from the SMS user is received within an operator defined time, the IP-SM-GW will send a negative response to the chat invitation.\nNOTE 4:\tSteps 10 to 13 are repeated for each message sent from the CPM user towards the SMS user, and step 14 is repeated for each message sent from the SMS user towards the CPM user.\n10)\tThe CPM user sends a message within the chat session containing data to the recipient SMS user.\n11) The IP-SM-GW transforms the received message into a Short Message and obtains the routeing information for the destination UE from the HLR/HSS.\n12)\tThe IP-SM-GW sends a Short Message (SMS- DELIVER) towards the MSC/SGSN/MME/SMSF, as described in TS 23.040 [2]. The IP-SM-GW inserts the MSISDN representing the chat session as the sender of the message, to ensure that the reply to this SMS is sent back to it.\n13)\tThe MSC/SGSN/MME/SMSF forwards the Short Message (SMS- DELIVER) to the SMS user, and the SMS is delivered to the SMS user using standard SMS procedures as described in TS 23.040 [2]).\n14)\tA Short Message is received via the SMS-GMSC from the SMS user by the IP-SM-GW, in accordance to steps 2 to 13 from clause 6.14. The message is targeted to the MSISDN representing the chat session which was assigned in step 5.\nNOTE 5:\tStep 5 of the flow in clause 6.14 becomes this: \"The IP-SM-GW identifies that a session exists between the SMS user and the CPM user\".",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14",
        "figure_6.15.2",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.16.1",
      "section_id": "6.16.1",
      "section_title": "IP-SM-GW in the originating network",
      "content": "Figure 6.16.1: Chat session teardown request to SMS (IP-SM-GW in originating network)\n1)\tThe CPM UE sends a SIP BYE for an ongoing session to the S-CSCF.\n2)\tS-CSCF forwards the session teardown request to the IP-SM-GW. The IP-SM-GW performs service-level interworking by converting the session teardown request to a Short Message (SMS-SUBMIT) carrying the SC Address and including operator provided teardown text. The IP-SM-GW uses the SC Address in the subscriber data retrieved from the HSS at registration or provisioned by configuration.\n3)\tThe IP-SM-GW forwards the Short Message towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The text in the Short Message is defined by the operator and should convey information to the SMS user that the chat session is ending.\nNOTE 1:\tThe MSISDN used as the sender of the Short Message is either the MSISDN of the CPM user or one that was assigned by the IP-SM-GW at session establishment, depending on operator configuration.\n4)\tThe SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the SMS-SC (see TS 23.040 [2]).\nNOTE 2:\tSteps 3 to 4 are only executed if the operator policy requires that the SMS user be told the session is being torn down. Otherwise, the process continues with step 5.\n5)\tThe IP-SM-GW acknowledges the session teardown request and tears down the associated resources.\n6)\tThe session teardown acknowledgement is forwarded by the S-CSCF to the CPM UE.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.16.1",
        "ts_23.040"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.16.2",
      "section_id": "6.16.2",
      "section_title": "IP-SM-GW in the terminating network",
      "content": "The SMS user (SMS user B) in this flow is a CPM user (CPM user B) who has set his preferences in his home network to receive his incoming chat sessions as Short Messages.\nFigure 6.16.2: Chat session teardown request to SMS (IP-SM-GW in terminating network)\n1)\tThe CPM user's originating network sends a session teardown request for an ongoing chat session to the terminating S-CSCF.\n2)\tThe terminating S-CSCF forwards the session teardown request to the IP-SM-GW serving the SMS user. The IP-SM-GW performs service-level interworking by converting the session teardown request to a Short Message including operator provided teardown text.\n3)\tThe IP-SM-GW obtains the routeing information for the destination UE from the HLR/HSS.\n4)\tThe IP-SM-GW sends the Forward Short Message to the target MSC/SGSN/MME/SMSF. The IP-SM-GW inserts the MSISDN it had previously assigned to represent this chat session as the sender of the message.\nNOTE:\tSteps 3 to 5 are only executed if the operator policy requires that the SMS user be told the session is being torn down. Otherwise, the process continues with step 6.\n5)\tThe MSC/SGSN/MME/SMSF sends the Short Message to the SMS user.\n6)\tThe IP-SM-GW acknowledges the session teardown request and tears down the associated resources.\n7)\tThe session teardown acknowledgement is forwarded by S-CSCF towards the CPM user's originating network.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.16.2"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.17.1",
      "section_id": "6.17.1",
      "section_title": "IP-SM-GW in the originating network",
      "content": "Figure 6.17.1: Chat session teardown request to CPM UE (IP-SM-GW in originating network)\n1)\tA message is received from the SMS user via the SMS-GMSC by the IP-SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14, with the operator defined Short Message indicating the SMS user wants to leave the chat session.\n2)\tThe IP-SM-GW performs service-level interworking by recognizing that the Short Message corresponds to the operator defined teardown text indicating the SMS user wants to leave the chat session, so the IP-SM-GW sends a chat session teardown request.\n3)\tThe session teardown request is forwarded by S-CSCF to the CPM UE.\n4)\tThe CPM UE acknowledges the session teardown request.\n5)\tThe acknowledgement is forwarded by the S-CSCF to the IP-SM-GW.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14",
        "figure_6.17.1"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.17.2",
      "section_id": "6.17.2",
      "section_title": "IP-SM-GW in the terminating network",
      "content": "The SMS user in this flow is a CPM user who has set his preferences in his home network to receive his incoming chat sessions as Short Messages.\nFigure 6.17.2: Chat session teardown request to CPM UE (IP-SM-GW in terminating network)\n1)\tA message is received from the SMS user via the SMS-GMSC by the IP-SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 of clause 6.14, with the operator provided teardown text indicating the SMS user wants to leave the chat session.\n2)\tThe IP-SM-GW performs service-level interworking by recognizing that the Short Message corresponds to the operator provided teardown text indicating the SMS user wants to leave the chat session, so the IP-SM-GW sends a chat session teardown request.\n3)\tThe session teardown request is forwarded by the S-CSCF towards the CPM user's originating network.\n4)\tThe CPM user's originating network acknowledges the session teardown request and tears down the associated resources.\n5)\tThe acknowledgement is forwarded by the S-CSCF to the IP-SM-GW.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14",
        "figure_6.17.2"
      ]
    },
    {
      "chunk_id": "ts_23.204_6.18",
      "section_id": "6.18",
      "section_title": "Service-level interworking: Status Report procedure for chat session message to Short Message interworking",
      "content": "Figure 6.18: Status report procedure for chat session message to Short Message interworking\n1)\tA chat session message from the UE is successfully delivered to the SMS user after service-level interworking according to clause 6.15. The chat session message requested a success or failure delivery report.\nNOTE 1:\tA Request for success or failure delivery report can be requested in a chat session message sent by the UE as described in IETF RFC 4975 [19].\n2)\tThe SMS-SC sends a Status report to the SMS-GMSC.\nNOTE 2:\tThe Status report, from the SMS-GMSC's point of view, will be treated as any SM termination.\nNOTE 3:\tThe Status report is an optional message.\n3a)\tThe SMS GMSC interrogates the HLR/HSS to retrieve routeing information. Based on the pre-configured IP-SM-GW address for the user, the HLR/HSS forwards the request to the corresponding IP-SM-GW.\n3b)\tThe HLR/HSS returns the IMSI and the address(es) of the current MSC, SGSN, MME and/or SMSF to the IP-SM-GW for delivery of the Short Message in CS/PS domain.\n3c)\tThe IP-SM-GW creates a MT Correlation ID as per TS 23.040 [2], which associates the Routing Info retrieval with the subsequent Forward Short Message messages(s), and stores this along with the IMSI of the receiving subscriber. The IP-SM-GW returns to the SMS-GMSC the address of itself, along with the MT Correlation ID in the IMSI field, as routeing information. Alternatively, the IP-SM-GW may return the address(es) of the current MSC, SGSN, MME and/or SMSF, in which case, the subsequent procedure to forward the message is the same as defined in TS 23.040 [2].\n4)\tThe SMS-GMSC sends the status report in the Forward Short Message to the IP-SM-GW.\n5)\tThe IP-SM-GW translates and maps the Status report in the Forward Short Message into a report request as described in MSRP IETF RFC 4975 [19].\n6)\tThe IP-SM-GW sends a Delivery report (SMS-DELIVER-REPORT) to the SMS-GMSC.\n7)\tThe SMS-GMSC sends an acknowledgement back to the SMS-SC.\n8-9)\tThe IP-SM-GW sends a success of failure report based on the value in the status report.\nNOTE 4:\tStep 6 and 8 can happen independently of each other.\nAnnex A (informative):Service-level interworking: IM or CPM user sends an Instant Message to a group list including SMS users\nFigure A.1: IM user sends an Instant Message to a group list via service-level interworking\n1)\tThe UE registers to S-CSCF according the IMS registration procedure.\n2)\tUE generates Instant Message which includes group information, e.g. Group identifier in the Request-URI and/or recipient list in the body of the Instant Message. UE submits the Instant Message to the S-CSCF using an appropriate SIP method.\n3)\tBased on the stored iFC, S-CSCF forwards the Instant Message to an AS in charge of the group delivery, e.g., the controlling function server defined in OMA-TS-SIMPLE_IM-V1_0 [12] or the controlling function server defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n4)\tThe group delivery AS replicates per Instant Message for per recipient according to the group information it obtains acting as a B2BUA. See detail in OMA-TS-SIMPLE_IM-V1_0 [12] or in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n5)\tThe group delivery AS sends the generated multiple Instant Messages to S-CSCF (e.g., the Instant Messages can be delivered as what the list server does defined in the TS 24.247 [14]).\n6)\tThe S-CSCF forwards the Instant Messages to the IP-SM-GW based on the stored iFC.\n7)\tThe IP-SM-GW shall decide whether to perform service-level interworking depending on SIP request header (e.g. Request-URI), operator policy, when the Instant Message is not routeable in the IMS. If IP-SM-GW decided to perform service-level interworking, the IP-SM-GW performs service authorization based on the stored subscriber data retrieved from the HLR/HSS at the time of the third party registration procedure as described in the clause 6.1. The IP-SM-GW shall check whether the originating subscriber is authorised to use the interworking service .If the result of service authorization is negative, the IP-SM-GW shall not forward the message, and shall return the appropriate error information to the UE in a failure report. Otherwise, the IP-SM-GW shall translate the IMS message to a Short Message (SMS- SUBMIT) and forwards it towards the SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]).\n8)\tIf service authorization is successful, the IP-SM-GW acknowledges the Instant Messages.\n9-11)\tInstant Message acknowledgement is forwarded by S-CSCF to UE.\n12)\tThe SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the SMS-SC (see TS 23.040 [2]).\n13)\tThe SMS-SC sends multiple Submit reports (SMS-SUBMIT REPORT) to SMS-IWMSC (see TS 23.040 [2]).\n14)\tSMS-IWMSC sends the Submit reports to IP-SM-GW (see TS 23.040 [2]).\n15)\tIP-SM-GW translates the received Submit reports to appropriate IMS delivery notifications defined in RFC 5438 [13], and forwards the IMS delivery notifications to the S-CSCF.\n16)\tThe S-CSCF forwards the IMS delivery notifications to the group delivery AS.\n17)\tThe group delivery AS aggregates the delivery notifications of the same type from different recipients into a single delivery notification.\n18)\tThe group delivery AS sends the delivery notification to the S‑CSCF.\n19)\tThe S-CSCF forwards the delivery notification to the UE.\n20-23)\tAcknowledgement of the delivery notification is forwarded by S-CSCF to IP-SM-GW.\nAnnex B (informative):Group chat sessions\nB.1\tService-level interworking: IM or CPM user initiates a group chat and sends an Instant Message to a group list including SMS users\nThe flow in this clause is the same as that described in clause 6.15.1 with the difference that it is required that the IP-SM-GW assign an MSISDN for this group chat session so that it is clear for the SMS user that any message sent to the assigned MSISDN will be delivered to the group chat session participants, not just to the CPM UE that invited the SMS user.\nIn this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be in the PLMN of the SMS user if that user was also a CPM user and had terminating user preferences to deliver the session invitation via SMS.\nFigure B.1: CPM user initiates a group chat and messages are exchanged within the group chat via service-level interworking\n1)\tThe UE registers to S-CSCF according the IMS registration procedure.\n2)\tThe UE generates a chat session invitation which includes group information, e.g. Group identifier in the Request-URI and/or recipient list in the body of the chat session invitation. UE submits the Instant Message to the S-CSCF using an appropriate SIP method.\n3)\tBased on the stored iFC, S-CSCF forwards the session invitation to an AS in charge of handling group chat requests, e.g., the controlling function server defined in OMA-TS-SIMPLE_IM-V1_0 [12] or the controlling function server defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n4)\tThe group chat AS replicates a session invitation per recipient according to the group information it obtains acting as a B2BUA. See details in OMA-TS-SIMPLE_IM-V1_0 [12] or in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n5)\tThe group chat AS sends the generated multiple session invitations to the S-CSCF.\n6)\tThe group chat AS forwards one of the chat session invitations to the IP-SM-GW according to normal routing procedures (e.g., via S-CSCF).\nNOTE 1:\tNodes specific to the CPM functions such as ISF are either collocated with the IP-SM-GW or else are not shown.\n7)\tThe IP-SM-GW translates the chat session invitation request to a Short Message (SMS- SUBMIT) and forwards it towards the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The IP-SM-GW assigns an MSISDN representing the group chat session to ensure that the reply to this SMS is sent back to this particular IP-SM-GW. Any SMS sent from the SMS user to this MSISDN will be interworked into the group chat session with which this MSISDN is correlated. The text in the Short Message is defined by the operator and conveys information to the SMS user that he is invited to send and receive messages in the context of a group chat session, and includes instructions on how to accept, reject and end the session. The identity of the original sender (CPM user or group) is included as part of the operator provided invitation text.\n8)\tThe SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\n9)\tA Short Message is received from the SMS user via the SMS-GMSC by the IP-SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14, indicating the response to the group chat session invitation. The message is targeted to the MSISDN representing the group chat session which was assigned in step 7.\n10)\tIf the answer is positive or if operator policy is to accept the session invitation on behalf of the SMS user, the IP-SM-GW acknowledges the session invitation. Otherwise the IP-SM-GW will consider the session rejected and send back an appropriate response.\n11)\tThe session invitation acknowledgement is forwarded by S-CSCF to the group chat AS.\n12-13)\tThe group chat AS responds back to the group chat session initiator once the first user joins the group chat session.\nNOTE 2:\tThe following steps are executed only if an SMS with a positive answer is received from the SMS user or if the operator policy indicated that the session is accepted without SMS user interaction. In case a negative response to the invitation is received or if no response from the SMS user is received within an operator defined time, the IP-SM-GW shall send a negative response to the chat invitation.\n14-17)\tThe IP-SM-GW subscribes to the participant information changes.\nNOTE 3:\tSteps 18 to 21 are repeated for each message sent from any group chat session participant towards the SMS user, and steps 22 to 24 are repeated for each message sent from the SMS user towards the group chat session participants.\n18)\tThe CPM UE (or any group chat session participant) sends a message containing data to the group chat AS.\n19)\tFor the group chat session participant who is an SMS user, the message is routed towards the IP-SM-GW.\n20)\tThe IP-SM-GW identifies that a session exists between the SMS user and group chat AS and transforms the received message into a Short Message and sends a Short Message (SMS- SUBMIT) carrying the SC Address, then forwards it towards the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The IP-SM-GW inserts the address representing the group chat session as the sender of the message to ensure that the reply to this SMS is sent back to this particular IP-SM-GW.\n21)\tThe SMS-IWMSC forwards the Short Message (SMS- SUBMIT) to the group chat SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\n22)\tA Short Message is received from the SMS user via the SMS-GMSC by the IP-SM-GW, in accordance to steps 2 to 13 from clause 6.14. The message is targeted to the MSISDN representing the group chat session which was assigned in step 7.\nNOTE 4:\tStep 5 of the flow in clause 6.14 becomes this:  The IP-SM-GW identifies that a session exists between the SMS user and the CPM user. Steps 6 and 7 of the flow in clause 6.14 are replaced by steps 23 and 24 in this flow.\n23)\tThe IP-SM-GW identifies that a session exists between the SMS user and the group chat AS and transforms the received message into message data and sends it within the session towards the group chat AS.\n24)\tThe group chat AS forwards the message to all group chat participants.\nB.2\tService-level interworking: CPM user extends a one-to-one chat session into a group chat session\nThis flow is the same as that described in clause 6.15.1 with the difference that it is required that the IP-SM-GW assign an MSISDN when this group chat session starts if one was not assigned before, so that it is clear for the SMS user that any message sent to the assigned MSISDN will be delivered to the group chat session participants, not just to the CPM UE that invited the SMS user.\nIn this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be in the PLMN of the SMS user if that user was also a CPM user and had terminating user preferences to deliver the session invitation via SMS.\nFigure B.2: CPM user modifies a one-to-one chat session into a group chat session\n1)\tA one-to-one chat session is established between the CPM user and the SMS user.\n2)\tThe UE generates a chat session invitation which includes a recipient list in the body of the chat session invitation. The original SMS user who is part of the one-to-one chat session is included in that list An indication is added for the original SMS user in the list that the existing one-to-one session is to be replaced by the new session. The UE submits the chat session invitation to the S-CSCF.\n3)\tBased on the stored iFC, S-CSCF forwards the session invitation to an AS in charge of handling group chat requests, e.g., the controlling function server defined in OMA-TS-SIMPLE_IM-V1_0 [12] or the controlling function server defined in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n4)\tThe group chat AS replicates a session invitation per recipient according to the group information it obtains acting as a B2BUA. See details in OMA-TS-SIMPLE_IM-V1_0 [12] or in OMA-TS-CPM_Conv_Fnct-V1_0 [17].\n5)\tThe group chat AS sends the generated multiple session invitations to the S-CSCF.\n6)\tThe group chat AS sends one of the chat session invitations to the IP-SM-GW according to normal routing procedures (e.g., via S-CSCF). The chat session invitation will indicate that the existing session is to be replaced with a new session.\n7)\tThe IP-SM-GW translates the chat session invitation request to a Short Message (SMS- SUBMIT) and forwards it towards the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The IP-SM-GW assigns an MSISDN representing the group chat session, if one was not assigned for the one-to-one chat session, to ensure that the reply to this SMS is sent back to this particular IP-SM-GW. Any SMS sent from the SMS user to this MSISDN will be interworked into the group chat session with which this MSISDN is correlated. The text in the Short Message is defined by the operator and conveys information to the SMS user that the one-to-one session has been transformed into a group session and that he is invited to send and receive messages in the context of a group chat session, and includes instructions on how to accept, reject and end the session. The identity of the original sender (CPM user or group) is included as part of the operator provided invitation text.\n8)\tThe SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\n9)\tA Short Message is received from the SMS user via the SMS-GMSC by the IP-SM-GW, in accordance to steps 2 to 4 and steps 10 to 13 from clause 6.14, indicating the response to the group chat session invitation. The message is targeted to the MSISDN representing the group chat session which was assigned in step 7.\n10)\tIf the answer is positive or if operator policy is to accept the session invitation on behalf of the SMS user, the IP-SM-GW acknowledges the session invitation. Otherwise the IP-SM-GW will consider the session rejected and sends back an appropriate response.\n11)\tThe session invitation acknowledgement is forwarded by S-CSCF to the group chat AS.\n12-13)\tThe group chat AS responds back to the group chat session initiator once the first user joins the group chat session.\nB.3\tService-level interworking: IP-SM-GW informs SMS users about group chat participant changes\nIn this flow, the IP-SM-GW is in the PLMN of the CPM UE, but it could also be in the PLMN of the SMS user if that user was also a CPM user and had terminating user preferences to deliver the session invitation via SMS.\nFigure B.3: Sending participant information changes to an SMS user in a group chat session\n1)\tA group chat session including SMS user(s) set up by an IM or CPM user as described in clause B.1 steps 1-17.\n2)\tThe group chat AS detects change in participants of the group chat session (e.g. participant added or left the group chat session, that event is not shown in the flow).\n3-4)\tAs the IP-SM-GW has subscribed to participant information changes, the group chat AS notifies the IP-SM-GW about the participant change through the S-CSCF using an appropriate SIP method.\n5-6)\tThe IP-SM-GW acknowledges the notification.\n7)\tAccording to operator policy, the IP-SM-GW translates the participant change notification to a Short Message (SMS- SUBMIT) and forwards it towards the group chat SMS-SC (SC Address) via the SMS-IWMSC (as described in TS 23.040 [2]). The text in the Short Message is defined by the operator and conveys appropriate information to the SMS user.\n8)\tThe SMS-IWMSC forwards the Short Messages (SMS- SUBMIT) to the group chat SMS-SC and the SMS is delivered to the SMS user using standard SMS procedures (see TS 23.040 [2]).\nAnnex C (informative):Change History\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2007-12\nSP-38\nSP-070898\n0036\n1\nB\nNew Annex: IM user sends an Instant Message to a group list including SMS users\n8.0.0\n2007-12\nSP-38\nSP-070898\n0037\n3\nB\nIM capable UE sends an Instant Message to an SMS user\n8.0.0\n2007-12\nSP-38\nSP-070898\n0038\n4\nB\nRelationship between SMSIP and Service level interworking\n8.0.0\n2007-12\nSP-38\nSP-070898\n0039\n4\nB\nDefinition, Symbol, Abbreviation Clauses\n8.0.0\n2007-12\nSP-38\nSP-070898\n0041\n5\nB\nStatus Report for IM to SMS IW\n8.0.0\n2007-12\nSP-38\nSP-070898\n0043\n2\nB\nUpdating the scope for TS 23.204\n8.0.0\n2007-12\nSP-38\nSP-070898\n0044\n2\nB\nConcatenated Short Messages delivered as an large Instant Message\n8.0.0\n2007-12\nSP-38\nSP-070898\n0045\n2\nB\nIP-SM-GW Additional Features\n8.0.0\n2008-03\nSP-39\nSP-080109\n0047\n2\nC\nSC address retrieval for IM MO\n8.1.0\n2008-03\nSP-39\nSP-080108\n0050\n2\nA\nCorrection to Reference\n8.1.0\n2008-03\nSP-39\nSP-080109\n0053\n-\nD\nImplementing the documentation guidance from SA#38\n8.1.0\n2008-03\nSP-39\nSP-080109\n0056\n-\nF\nIM to SM interworking procedure corrections\n8.1.0\n2008-03\nSP-39\nSP-080109\n0058\n2\nB\nProcedures when disposition notification is requested by IMS UE\n8.1.0\n2008-03\nSP-39\nSP-080109\n0059\n3\nC\nAdding architecture requirement for service level interworking\n8.1.0\n2008-03\nSP-39\nSP-080109\n0060\n2\nC\nImplementing the functionality for SC address retrieval\n8.1.0\n2008-03\nSP-39\nSP-080109\n0061\n1\nF\nGeneral cleanup of the specification\n8.1.0\n2008-03\nSP-39\nSP-080109\n0062\n3\nC\nGeneral cleanup of new clauses agreed in SA2#62\n8.1.0\n2008-03\nSP-39\nSP-080109\n0063\n3\nC\nCorrectly adding SMS to IM interworking procedures and clean up\n8.1.0\n2008-06\nSP-40\nSP-080368\n0064\n1\nC\nAdding privacy functionality to the service level interworking\n8.2.0\n2008-06\nSP-40\nSP-080368\n0065\n2\nC\nIM delivery to unregistered IMS subscriber\n8.2.0\n2008-06\nSP-40\nSP-080368\n0066\n1\nF\nGeneral Cleanup (cont'd)\n8.2.0\n2008-06\nSP-40\nSP-080368\n0067\n4\nF\nDeferred message when SMS is transport or service level interworked\n8.2.0\n2008-06\nSP-40\nSP-080368\n0068\n1\nF\nCorrections for IM termination call flow\n8.2.0\n2008-06\nSP-40\nSP-080368\n0070\n1\nF\nArchitectural requirement corrections\n8.2.0\n2008-06\nSP-40\nSP-080368\n0072\n-\nF\nSMS delivery correction\n8.2.0\n2008-09\nSP-41\nSP-080585\n0074\n3\nB\nUpdate of TS 23.204 for SMS over IP procedures for E-UTRAN\n8.3.0\n2009-03\nSP-43\nSP-090111\n0077\n4\nA\nCorrection of procedure for SM termination through the home network\n8.4.0\n2009-03\nSP-43\nSP-090106\n0078\n1\nF\nReduction of unnecessary signalling\n8.4.0\n2009-12\nSP-46\n-\n-\n-\n-\nUpdate to Rel-9 version (MCC)\n9.0.0\n2010-03\nSP-47\nSP-100157\n0085\n-\nB\nIP-SM-GW enhancements for interworking with OMA CPM(Rel-9 CR0087 not included as instructed on the Rel-9 CR)\n10.0.0\n2010-06\nSP-48\nSP-100336\n0088\n-\nF\nScope and References Corrections of CPM-SMS IW\n10.1.0\n2010-06\nSP-48\nSP-100336\n0089\n-\nF\nClarify routing of messages for processing in the IP-SM-GW\n10.1.0\n2010-09\nSP-49\nSP-100557\n0090\n1\nF\nNOTE corrections\n10.2.0\n2011-06\nSP-52\nSP-110343\n0091\n-\nF\nIP-SM-GW address handling clarification\n11.0.0\n2011-09\nSP-53\nSP-110469\n0092\n-\nF\nMCC Implementation correction to CR0091\n11.1.0\n2012-06\nSP-56\nSP-120240\n0093\n5\nB\nServer to MSISDN-less IMS UE direction in IMS\n11.2.0\n2012-12\nSP-58\nSP-120717\n0095\n2\nF\nNokia Siemens Networks, LG Electronics\n11.3.0\n2012-12\nSP-58\nSP-120727\n0096\n2\nB\nSMS for IMS UE to IMS UE without MSISDN\n12.0.0\n2013-03\nSP-59\nSP-130091\n0097\n1\nF\nClarification on MSISDN-less SMS operation\n12.1.0\n2013-06\nSP-60\nSP-130322\n0101\n2\nA\nAdding the interface between IP-SM-GW and MME\n12.2.0\n2013-09\nSP-61\nSP-130370\n0103\n1\nA\nIP-SM-GW with Diameter interfaces for SMS in MME\n12.3.0\n2013-12\nSP-62\nSP-130535\n0104\n-\nB\nIP-SM-GW and Gdd interface\n12.4.0\n2015-12\n-\n-\n-\n-\n-\nUpdate to Rel-13 version (MCC)\n13.0.0\n2016-06\nSP-72\nSP-160284\n0108\n-\nA\nSMS w/o MSISDN with removal of Sh interaction\n13.1.0\n2017-03\n-\n-\n-\n-\n-\nUpdate to Rel-14 version (MCC)\n14.0.0\n2018-03\nSP-79\nSP-180094\n0109\n1\nF\nMT SMS domain selection by IP-SM-GW\n15.0.0\n2018-03\nSP-79\nSP-180094\n0110\n2\nF\nAddition of description on SMSF address\n15.0.0\n2019-12\nSP-86\nSP-191089\n0119\n1\nF\nAlignment to 23.040 on UE reachability notification from IP-SM-GW\n16.0.0\n2022-03\nSP-95E\n-\n-\n-\n-\nUpdate to Rel-17 version (MCC)\n17.0.0\n2024-03\n-\n-\n-\n-\n-\nUpdate to Rel-18 version (MCC)\n18.0.0",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.15",
        "clause_6.1",
        "clause_6.15.1",
        "clause_6.14",
        "figure_6.18",
        "ts_23.040",
        "ts_24.247",
        "ts_23.204"
      ]
    }
  ]
}