{
  "metadata": {
    "specification_id": "ts_23.273",
    "version": "18.9.0",
    "title": "3GPP TS 23.273",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/23_series/23273-i90/23273-i90.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:38:47.107132",
    "total_chunks": 164
  },
  "chunks": [
    {
      "chunk_id": "ts_23.273_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document specifies the stage 2 of the service-based architecture used for location services in the 5G system, and corresponding Network Functions (NFs), NF services and procedures, to meet the service requirements defined in TS 22.261 [3] and TS 22.071 [2].\nLocation Services specified in the present document include regulatory location services and commercial location services. The architecture and signalling procedures in NG-RAN are defined in TS 38.305 [9].",
      "chunk_type": "general",
      "cross_references": [
        "ts_22.261",
        "ts_22.071",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 22.071: \"Technical Specification Group Systems Aspects; Location Services (LCS)\".\n[3]\t3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".\n[4]\t3GPP TS 23.271: \"Functional stage 2 description of Location Services (LCS)\".\n[5]\t3GPP TS 43.059: \"Functional Stage 2 description of Location Services in GERAN\".\n[6]\tVoid.\n[7]\t3GPP TS 36.305: \"Stage 2 functional specification of User Equipment (UE) positioning in E-UTRAN\".\n[8]\t3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".\n[9]\t3GPP TS 38.305: \"Stage 2 functional specification of User Equipment (UE) positioning in NG-RAN\".\n[10]\t3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".\n[11]\t3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS); Stage 3\".\n[12]\t3GPP TS 29.572: \"5G System; Location Management Services; Stage 3\".\n[13]\tOMA MLP TS: \"Mobile Location Protocol\", [http://www.openmobilealliance.org].\n[14]\tVoid.\n[15]\t3GPP TS 38.455: \"NG-RAN; NR Positioning Protocol A (NRPPa)\".\n[16]\t3GPP TS 29.518: \"5G System; Access and Mobility Management Services; Stage 3\".\n[17]\t3GPP TS 25.305: \"Stage 2 functional specification of User Equipment (UE) positioning in UTRAN\".\n[18]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[19]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[20]\t3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\".\n[21]\t3GPP TS 23.316: \"Wireless and wireline convergence access support for the 5G System (5GS)\".\n[22]\tVoid.\n[23]\tITU-T Recommendation E.164: \"The international public telecommunication numbering plan\".\n[24]\t3GPP TS 23.222: \"Common Application Programming Interface (API) framework for 3GPP northbound APIs\".\n[25]\tRFC 2396: \"Uniform Resource Identifiers\".\n[26]\tRFC 3261: \"SIP: Session Initiation Protocol\".\n[27]\t3GPP TS 23.228: \"IP multimedia subsystem (IMS)\".\n[28]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[29]\t3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".\n[30]\t3GPP TS 32.271: \"Telecommunication management; Charging management; Location Services (LCS) charging\".\n[31]\t3GPP TS 32.298: \"Telecommunication management; Charging management; Charging Data Record (CDR) parameter description\".\n[32]\tVoid.\n[33]\t3GPP TS 29.571: \"5G System; Common Data Types for Service Based Interfaces; Stage 3\".\n[34]\tVoid.\n[35]\t3GPP TS 29.122: \"T8 reference point for Northbound APIs\".\n[36]\t3GPP TS 24.571: \"5G System (5GS); Control plane Location Services (LCS) procedures; Stage 3\".\n[37]\t3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support network data analytics services\".\n[38]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".\n[39]\t3GPP TS 22.104: \"Service requirements for cyber-physical control applications in vertical domains\".\n[40]\t3GPP TS 23.586: \"Architectural Enhancements to support Ranging based services and Sidelink Positioning\".\n[41]\t3GPP TS 23.503: \"Policy and charging control framework for the 5G System (5GS); Stage 2\".\n[42]\t3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage 2\".\n[43]\t3GPP TS 29.563: \"Home Subscriber Server (HSS) services for interworking with Unified Data Management (UDM); Stage 3\".\n[44]\t3GPP TS 33.536: \"Security aspects of 3GPP support for advanced Vehicle-to-Everything (V2X) services\".\n[45]\t3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in the 5G System (5GS)\".\n[46]\t3GPP TS 33.533: \"Security aspects of ranging based services and sidelink positioning\".\n[47]\t3GPP TS 38.355: \"Sidelink Positioning Protocol (SLPP)\".\n[48]\t3GPP TS 24.572: \" User Plane Location Services (LCS) Protocols And Procedures; Stage 3\".\n[49]\tOMA-AD-SUPL-V2_0: \"Secure User Plane Location Architecture Approved Version 2.0\".\n[50]\t3GPP TS 33.501: \" Security architecture and procedures for 5G system\".\n[51]\t3GPP TS 33.256: \"Security aspects of Uncrewed Aerial Systems (UAS)\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_22.071",
        "ts_22.261",
        "ts_23.271",
        "ts_43.059",
        "ts_36.305",
        "ts_23.032",
        "ts_38.305",
        "ts_23.167",
        "ts_24.501",
        "ts_29.572",
        "ts_38.455",
        "ts_29.518",
        "ts_25.305",
        "ts_23.501",
        "ts_23.502",
        "ts_37.355",
        "ts_23.316",
        "ts_23.222",
        "ts_23.228",
        "ts_23.003",
        "ts_29.002",
        "ts_32.271",
        "ts_32.298",
        "ts_29.571",
        "ts_29.122",
        "ts_24.571",
        "ts_23.288",
        "ts_38.413",
        "ts_22.104",
        "ts_23.586",
        "ts_23.503",
        "ts_23.632",
        "ts_29.563",
        "ts_33.536",
        "ts_33.503",
        "ts_33.533",
        "ts_38.355",
        "ts_24.572",
        "ts_33.501",
        "ts_33.256"
      ]
    },
    {
      "chunk_id": "ts_23.273_3.1",
      "section_id": "3.1",
      "section_title": "Definitions",
      "content": "For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\n5G enhanced positioning area: see TS 22.261 [3].\n5G positioning service area: see TS 22.261 [3].\nLCS Client: entity that interacts with GMLC for the purpose of obtaining location information for one or more UEs. The LCS Client may reside in the UE.\nFor the purposes of the present document, the following terms and definitions given in TS 23.271 [4] apply:\nCall Related: see TS 23.271 [4].\nCodeword: see TS 23.271 [4].\nCurrent Location: see TS 23.271 [4].\nDeferred location request: see TS 23.271 [4].\nDL Positioning: positioning of a target UE in which the target UE obtains downlink measurements for a 3GPP RAT.\nGNSS Assistance Data: see clause 6.5.2.1 of TS 37.355 [20].\nImmediate location request: see TS 23.271 [4].\nLast Known Location: see TS 23.271 [4].\nLCS (LoCation Services): see TS 23.271 [4].\nLocal Co-ordinates: see TS 23.032 [8].\nLocal Location: location determined by Local Co-ordinate(s).\nLocated UE: see TS 23.586 [40].\nLocation Estimate: see TS 23.271 [4].\nLOS/NLOS measurement indication: LOS-NLOS-Indicator as defined in TS 37.355 [20] or LOS/NLOS information as defined in TS 38.455 [15].\nPositioning Reference Unit (PRU): see TS 38.305 [9].\nMobile Base Station Relay: see TS 23.501 [18].\nPRU association: association of a PRU with an LMF by providing PRU related information to an LMF.\nPRU dis-association: remove the PRU related information to dis-associate a PRU with an LMF.\nPseudonym: see TS 23.271 [4].\nPseudonym mediation device: Functionality that verifies pseudonyms to verinyms.\nRAT Independent Positioning: positioning of a target UE in which the target UE obtains measurements not related to a 3GPP RAT.\nRequestor: see TS 23.271 [4].\nRequestor Identity: see TS 23.271 [4].\nResponse Method: for LCS Client using the OMA MLP protocol. Detail see TS 23.271 [4].\nScheduled Location Time: a future global time (e.g. UTC) at which a UE is to be located.\nService Type: see TS 23.271 [4].\nSidelink Positioning: see TS 23.586 [40]\nTarget UE: see TS 23.271 [4].\nUL Positioning: positioning of a target UE in which NG-RAN obtains uplink measurements of the target UE for a 3GPP RAT.\nUL+DL Positioning: positioning of a target UE using both DL Positioning and UL Positioning.\nVelocity: see TS 23.271 [4].\nVerinym: see TS 23.271 [4].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_37.355_clause_6.5.2.1",
        "ts_21.905",
        "ts_22.261",
        "ts_23.271",
        "ts_37.355",
        "ts_23.032",
        "ts_23.586",
        "ts_38.455",
        "ts_38.305",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.273_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nAPN\tAccess Point Name\nAPN-NI\tAPN Network Identifier\nEDT\tEarly Data Transmission\nE-SMLC\tEvolved Serving Mobile Location Centre\nGMLC\tGateway Mobile Location Centre\nHGMLC\tHome GMLC\nLCS\tLoCation Services\nLDR\tLocation Deferred Request\nLIR\tLocation Immediate Request\nLMF\tLocation Management Function\nLOS\tLine-Of-Sight\nLPI\tLCS Privacy Indicator\nLPHAP\tLow Power and High Accuracy Positioning\nLRF\tLocation Retrieval Function\nMBSR\tMobile Base Station Relay\nMO-LR\tMobile Originated Location Request\nMT-LR\tMobile Terminated Location Request\nNLOS\tNon-Line-Of-Sight\nNI-LR\tNetwork Induced Location Request\nPMD\tPseudonym mediation device functionality\nPOI\tPrivacy Override Indicator\nPRU\tPositioning Reference Unit\nSDT\tSmall Data Transmission\nTNAN\tTrusted Non-3GPP Access Network\nTNAP\tTrusted Non-3GPP Access Point\nTWAP\tTrusted WLAN Access Point\nVGMLC\tVisited GMLC\nSL-MO-LR\tSidelink Mobile Originating Location Request\nSL-MT-LR\tSidelink Mobile Terminating Location Request\nSUPL\tSecure User Plane Location",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.1",
      "section_id": "4.1",
      "section_title": "General Concepts",
      "content": "A general description of location services and service requirements are given in the specification TS 22.071 [2] and TS 22.261 [3]. Support of location services for GERAN, UTRAN and E-UTRAN access networks is described in TS 23.271 [4], TS 43.059 [5], TS 25.305 [17] and TS 36.305 [7].\nThe positioning of a UE can be supported by RAT dependent position methods, which rely on for example 3GPP RAT measurements obtained by a target UE and/or on measurements obtained by an Access Network of 3GPP RAT signals transmitted by a target UE. Positioning of a UE can also be supported by RAT independent position methods which may rely on non-RAT measurements obtained by a UE and/or on other information.\nThe Location Services defined in this specification are applicable to PLMN(s) and within a SNPN as described in clause 6, except for the following features, which are not supported in SNPNs:\n-\tinterworking with EPC;\n-\troaming; and\n-\tdirect access to SNPN via non-3GPP access.\nThe Location Service in PNI-NPN with signalling optimisation is defined as clause 5.13.\nThe positioning of a UE can be performed by either 3GPP access network or non-3GPP access network. A proper access type shall be determined to assure that the positioning result can fulfil the requested QoS and operator policy.\nLocation information for one or multiple target UEs may be requested by and reported to an LCS client or an AF within or external to a PLMN or SNPN, or a control plane NF within a PLMN or SNPN. Location information contained in the location request and location information contained in the location response are defined in clause 5.5.\nFor location request from LCS client (neither in the UE nor in the NG-RAN) or AF external to a PLMN or SNPN, privacy verification of the target UE shall be enabled to check whether it is allowed to acquire the UE location information based on UE LCS privacy profile and whether the LCS client or the AF is authorised to use the location service as defined in clause 5.4. Additionally, UEs may optionally support privacy notification and verification on behalf of a user. Privacy override is also supported for regulatory LCS services according to local regulation.\nThe capabilities of a target UE to support LCS may be signalled by the UE to a serving PLMN or to an SNPN at the AS, NAS and application (positioning protocol) levels to enable use of position methods supported by the UE.\nTo provide Location Service in the EPC interworking scenario, an EPC and 5GC common interface shall be used for the location request from LCS client or AF.\nRanging based services and Sidelink Positioning for a UE can be supported, and details are described in clause 5.17.\n4.1a\tTypes of Location Request\n4.1a.1\tNetwork Induced Location Request (NI-LR)\nWith a Network Induced Location Request (NI-LR), a serving AMF for a UE initiates localization of the UE for a regulatory service (e.g. an emergency call from the UE) or for verification of a UE location (country or international area) for NR satellite access.\n4.1a.2\tMobile Terminated Location Request (MT-LR)\nWith a Mobile Terminated Location Request (MT-LR), an LCS client or AF external to or internal to a serving PLMN sends a location request to the PLMN (which may be the HPLMN or VPLMN) for the location of a target UE.\n4.1a.3\tMobile Originated Location Request (MO-LR)\nWith a Mobile Originated Location Request (MO-LR), a UE sends a request to a serving PLMN for location related information for the UE.\n4.1a.4\tImmediate Location Request\nWith an immediate location request, an LCS client or AF sends or instigates a location request for a target UE (or group of target UEs) and expects to receive a response containing location information for the target UE (or group of target UEs) within a short time period which may be specified using QoS. In regulatory cases, one or more responses of the target UE's location information can be expected. An immediate location request may be used for an NI-LR, MT-LR or MO-LR.\n4.1a.5\tDeferred Location Request\nWith a deferred location request, an LCS client or AF sends a location request to a PLMN for a target UE (or group of target UEs) and expects to receive a response containing the indication of event occurrence and location information if requested for the target UE (or group of target UEs) at some future time (or times), which may be associated with specific events associated with the target UE (or group of target UEs). In this version of the specification, only deferred location requests for an MT-LR are supported.\n4.1a.5.1\tTypes of event\nThe following types of event are defined for a deferred location request.\na)\tUE availability: Any event in which the 5GCN has established a contact with the UE. This event is considered to be applicable when the UE is temporarily unavailable due to inaction by the user, or for temporarily loss of radio connectivity or IMSI detach and so on. The UE Available event only requires one response to an LCS client/AF and after this response, the UE Available event is concluded.\nb)\tArea: An event where the UE enters, leaves or remains within a pre-defined geographical area. At least one type of area event can be defined (i.e. entering, leaving or remaining within the area). The LCS client or AF may define the target area as a geographical area or as a geopolitical name of an area. The PLMN may translate and define the target area as the identities of one or more radio cells or tracking areas. The LCS client or AF may request an additional check about whether the UE is located within the provisioned target area. The area event may be reported one time only, or multiple times. The area event report shall contain an indication of the event occurrence. The location estimate may be included in the report. If an area event is detected by the UE but an event report cannot be sent (e.g. because the UE cannot access the network or due to a minimum reporting interval), a report shall be sent later when possible irrespective of whether the area event still applies for the current UE location. Area event reporting is controlled by a minimum and a maximum reporting time. The minimum reporting time defines the minimum allowed time between successive area events. The maximum reporting time defines the maximum time between successive reports. When a UE sends a report due to expiration of the maximum reporting time, the UE indicates expiration of the maximum reporting time as the trigger event. The maximum reporting time enables the AF, LCS client and HGMLC to remain aware of continuing support by the UE for the area event (e.g. to detect if area event reporting may have been aborted due to UE power off).\nNOTE:\tTo achieve more precise usage of area event in some scenario, e.g. for small target area, it may be useful if LCS Client/AF requests UE location estimate and compares the location estimate with the target area.\nc)\tPeriodic Location: An event where a defined periodic timer expires in the UE and activates a location report. If a periodic event is detected by the UE but an event report cannot be sent (e.g. because the UE cannot access the network temporarily), a report shall be sent later when possible and the periodic timer for the next event shall then be started. The reporting duration for periodic location shall equal the requested number of reports multiplied by the periodic interval even when reports are delayed.\nd)\tMotion: An event where the UE moves by more than some predefined straight line distance from a previous location. The motion event may be reported one time only, or multiple times. The motion event report shall contain an indication of the event occurrence. A location estimate may be included in the report if requested by the LCS client or AF. For successive motion event reports, motion is determined relative to the UE location corresponding to the immediately preceding event report (including an event report triggered by expiration of the maximum reporting time). If a motion event is detected by the UE but an event report is deferred (e.g. because the UE cannot access the network temporarily), a report shall be sent later when possible irrespective of whether the motion event still applies to the current UE location. Motion reporting is controlled by a minimum and a maximum reporting time. The minimum reporting time defines the minimum allowed time between successive event reports. The maximum reporting time defines the maximum time between successive reports. When a UE sends a report due to expiration of the maximum reporting time, the UE indicates expiration of the maximum reporting time as the trigger event. The maximum reporting time enables the AF, LCS client and HGMLC to remain aware of continuing support by the UE for the motion event (e.g. to detect if motion event reporting may have been aborted due to UE power off).\n4.1b\tLCS Quality of Service\nLCS Quality of Service is used to characterise the location request. It can either be determined by the operator or determined based on the negotiation with the LCS client or the AF. It is optional for LCS client or the AF to provide the LCS Quality of Service in the location request.\nLCS Quality of Service information is characterised by 3 key attributes:\n-\tLCS QoS Class as defined below.\n-\tAccuracy: i.e. Horizontal Accuracy (see clause 4.3.1 of TS 22.071 [2]) and Vertical Accuracy (see clause 4.3.2 of TS 22.071 [2].\n-\tResponse Time (e.g. no delay, low delay or delay tolerant as described in clause 4.3.3 of TS 22.071 [2]).\nNOTE 1:\tOne or two QoS values for Horizontal Accuracy, Vertical Accuracy can be provided in the location request in addition to a preferred accuracy when LCS QoS Class is set to Multiple QoS Class.\nThe LCS QoS Class defines the degree of adherence by the Location Service to another quality of service parameter (Accuracy), if requested. The 5G system shall attempt to satisfy the other quality of service parameter regardless of the use of QoS Class. There are 3 LCS QoS Classes:\n-\tBest Effort Class: This class defines the least stringent requirement on the QoS achieved for a location request. If a location estimate obtained does not fulfil the other QoS requirements, it should still be returned but with an appropriate indication that the requested QoS was not met. If no location estimate is obtained, an appropriate error cause is sent.\n-\tMultiple QoS Class: This class defines intermediate stringent requirements on the QoS achieved for a location request. If the obtained location estimate does not fulfil the most stringent (i.e. primary) other QoS requirements affected by the degree of adherence of the QoS class, then another location estimation may be triggered at LMF attempting less stringent other QoS requirements. The process may be iterated until the least stringent (i.e. minimum) other QoS requirements are attempted. If the least stringent other QoS requirements cannot be fulfilled by a location estimate, then the location estimate shall be discarded, and an appropriate error cause shall be sent.\nNOTE 2:\tAn AF may provide a location request with Multiple QoS Class via NEF. For an LCS client to provide a location request with Multiple QoS Class an Le interface implementation supporting Multiple QoS Class may be required.\nNOTE 3:\tMultiple QoS Class can only be applied for Deferred 5GC-MT-LR Procedure in this release of the specification.\n-\tAssured Class: This class defines the most stringent requirement on the accuracy achieved for a location request. If a location estimate obtained does not fulfil the other QoS requirements, then it shall be discarded, and an appropriate error cause shall be sent.\nNOTE 4:\tHow the LMF decides the positioning method is an implementation aspect not pre-determined by QoS criteria.\nFor LCS client, it may indicate accuracy defined in TS 29.572 [12], tables 6.1.6.3.2-1 and 6.1.6.3.5-1. For AF, it may either indicate the accuracy defined in TS 29.572 [12], table 6.1.6.3.2-1, or indicate a particular value e.g. PLMN ID defined in TS 29.122 [35], table 5.3.2.4.7-1.\n4.1c\tScheduled Location Time\nA scheduled location time allows an external LCS Client, AF or the UE to specify a time in the future at which a current location of the UE is to be obtained. A scheduled location time can be used with a 5GC-MT-LR, 5GC-MO-LR or deferred 5GC-MT-LR for periodic or triggered location events. The location preparation phase starts when a location related request is sent by an LCS Client, AF or UE requesting a current location of the UE. The request includes the scheduled location time T. As part of the location preparation phase, the 5GC, and UE interact to determine suitable position methods and schedule location measurements of the UE. The LMF coordinates the interaction and is aware of the scheduled location time. The location preparation phase ends at or near to the time T and is followed by a location execution phase in which the UE location is obtained and returned to the external LCS Client, AF or the UE.\nA scheduled location time only applies when an external LCS Client, AF or the UE is aware of a specific time in the future at which the location of the UE is needed. A location estimate returned to an LCS Client, AF or UE for a scheduled location time can be treated by the LCS Client, AF or UE as an estimate of the location of the UE at the scheduled location time.\nTo support the Scheduled Location Time in 5GC-MO-LR, the UE defers sending the request to AMF until the time remaining until the scheduled location time is within some implementation dependent threshold in order to avoid failure triggered by HTTP request timeout.\nWhen support the Scheduled Location Time in 5GC-MT-LR (i.e. the LCS Client/AF obtains one time UE location at Scheduled Location Time), to avoid failure triggered by HTTP request timeout, one of the following methods is applied:\n-\tThe LCS Client or AF defers sending the request until the time remaining until the scheduled location time is within some implementation dependent threshold; or\n-\tRe-using the deferred 5GC-MT-LR for periodic location events procedure to realize providing one time UE location at Scheduled Location Time by, e.g. set the value of total reporting number parameter in the location request to one.\nNOTE:\tWhich method to be used is implementation specific.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6",
        "clause_5.13",
        "clause_5.5",
        "clause_5.4",
        "clause_5.17",
        "ts_22.071_clause_4.3.1",
        "ts_22.071_clause_4.3.2",
        "ts_22.071_clause_4.3.3",
        "ts_29.572_table_6.1.6.3.2-1",
        "ts_29.122_table_5.3.2.4.7-1",
        "ts_22.071",
        "ts_22.261",
        "ts_23.271",
        "ts_43.059",
        "ts_25.305",
        "ts_36.305",
        "ts_29.572",
        "ts_29.122"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.2.1",
      "section_id": "4.2.1",
      "section_title": "Non-roaming reference architecture",
      "content": "Figure 4.2.1-1 shows an architectural reference model for 5GS LCS for a non-roaming UE and PRU in reference point representation.\nFigure 4.2.1-1: Non-roaming reference architecture for Location Services in reference point representation\nNOTE 1:\t(R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP access.\nNOTE 2:\tReference point interface related to charging functionality is not shown in this specification.\nNOTE 3:\tPRU refers to a Positioning Reference Unit realized by a UE as defined in clause 5.4.5 of TS 38.305 [9].\nFigure 4.2.1-2 shows an architectural reference model for 5GS LCS for a non-roaming UE and PRU in SBI representation.\nFigure 4.2.1-2: Non-roaming reference architecture for Location Services in SBI representation",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.305_clause_5.4.5",
        "figure_4.2.1-1",
        "ts_38.305_figure_4.2.1-2",
        "figure_4.2.1-2",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.2.2",
      "section_id": "4.2.2",
      "section_title": "Roaming reference architecture",
      "content": "Figure 4.2.2-1 shows an architectural reference model for 5GS LCS for a roaming UE and PRU in reference point representation.\nFigure 4.2.2-1: Roaming reference architecture for Location Services in reference point representation\nNOTE 1:\t(R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP access.\nNOTE 2:\tReference point interface related to charging functionality is not shown in this specification.\nNOTE 3:\tPRU refers to a Positioning Reference Unit realized by a UE as defined in clause 5.4.5 of TS 38.305 [9].\nFigure 4.2.2-2 shows an architectural reference model for 5GS LCS for a roaming UE and PRU in SBI representation.\nFigure 4.2.2-2: Roaming reference architecture for Location Services in SBI representation",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.305_clause_5.4.5",
        "figure_4.2.2-1",
        "ts_38.305_figure_4.2.2-2",
        "figure_4.2.2-2",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.2.3",
      "section_id": "4.2.3",
      "section_title": "Reference architecture with sidelink positioning",
      "content": "Architectural reference model for 5GS LCS with sidelink positioning in reference point representation and in SBI representation is in clause 4.2 of TS 23.586 [40].\n4.2a\tInterconnection between 5GC and EPC\n4.2a.1\tGeneral\nFor MT-LR Location Request, when a LCS service request is received at 5GC GMLC, the target UE may be served by either 5GC or EPC. An EPC/5GC common interface is used between the LCS Client and the 5GC GMLC to enable the location service request being handled based on whether the target UE is served by EPC or 5GC. The AF initiates the service request to the 5GC GMLC via NEF.\nNOTE: The LCS Client doesn't know if UE is currently served by EPC or 5GC.\nFor MT-LR Location Request, the 5GC interconnection with EPC happens:\n- when an LCS service request is received by the 5GC GMLC and the target UE is served by EPC in non-roaming case;\n- when an LCS request is received by the 5GC GMLC in the HPLMN of the target UE and the target UE is served by EPC in the VPLMN in roaming case.\n4.2a.2\tNon-roaming architecture\nFigure 4.2a.2-1 represents the non-roaming architecture of Location Services for interconnection between 5GC and EPC.\nFigure 4.2a.2-1: Non-roaming architecture of interconnection between 5GC and EPC\nNOTE 1:\tEPC GMLC and 5GC GMLC can be collocated in implementation, in such case, Lr' is not needed.\nNOTE 2:\tFor this release, Lr' is not standardized.\nNOTE 3:\tInterworking between 5GS and EPS is defined in clause 5.32.7 of TS 23.501 [18].\nNOTE 4:\tThe interaction between UDM and HSS, when they are deployed as separate network functions, is defined in TS 23.632 [42] and TS 29.563 [43] or it is implementation specific.\n4.2a.3\tRoaming architecture\nFigure 4.2a.3-1 and Figure 4.2a.3-2 represent the Roaming architecture of interconnection between 5GC and EPC.\nFigure 4.2a.3-1: Roaming architecture of Location Services for interconnection between 5GC and EPC (5GC GMLC and EPC GMLC are separately deployed in VPLMN)\nFigure 4.2a.3-2: Roaming architecture of Location Services for interconnection between 5GC and EPC (5GC GMLC and EPC GMLC are co-located in VPLMN)\n4.2b\tPositioning methods\nThe LCS feature utilises one or more positioning methods in order to determine the location of user equipment (UE). Determining the position of a UE involves two main steps:\n-\tRadio signal measurements or non-RAT measurements; and\n-\tPosition estimate computation based on the measurements.\nThe positioning methods for 3GPP access are described in clause 5.2.\nThe positioning methods for non-3GPP access are described in clause 5.3.1.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.586_clause_4.2",
        "ts_23.501_clause_5.32.7",
        "clause_5.2",
        "clause_5.3.1",
        "figure_4.2",
        "ts_23.586",
        "ts_23.501",
        "ts_23.632",
        "ts_29.563"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.1",
      "section_id": "4.3.1",
      "section_title": "Access Network",
      "content": "The Access Network is involved in the handling of various positioning procedures including positioning of a target UE, provision of location related information not associated with a particular target UE and transfer of positioning messages between an AMF or LMF and a target UE. The Access Network shall support determination of location estimates in geographical and/or local co-ordinates as defined in TS 23.032 [8].\nIn this version of the specification, location services are supported for NG-RAN and non-3GPP access.\nThe LCS specific functionalities of the radio access network elements are specified in TS 38.305 [9] for NG-RAN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.032",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.2",
      "section_id": "4.3.2",
      "section_title": "LCS Clients, Application Functions and Network Functions",
      "content": "AFs and NFs may access LCS services from a GMLC in the same trust domain (e.g. in the same PLMN) using the Ngmlc interface or Event Exposure with location information from an AMF in the same trust domain using the Namf interface. The NWDAF collects UE location information by accessing GMLC directly.\nLCS Clients may access LCS services from a GMLC (e.g. HGMLC) using the Le reference point.\nExternal AFs may access LCS services from an NEF using Nnef interface or CAPIF API. The CAPIF and associated API provider domain functions are specified in TS 23.222 [24].\nAn LCS Client or AF may access LCS services from a UE over a user plane connection for reporting of location events by the UE for a periodic or triggered 5GC-MT-LR when the UE is able to determine location estimates.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.222"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.3",
      "section_id": "4.3.3",
      "section_title": "Gateway Mobile Location Centre, GMLC",
      "content": "The Gateway Mobile Location Centre (GMLC) contains functionality required to support LCS. In one PLMN, there may be more than one GMLC.\nA GMLC is the first node an external LCS client accesses in a PLMN (i.e. the Le reference point is supported by the GMLC). AFs and NFs may access GMLC directly or via NEF. The GMLC may request routing information and/or target UE privacy information from the UDM via the Nudm interface. After performing authorization of an external LCS Client or AF and verifying target UE privacy, a GMLC forwards a location request to either a serving AMF using Namf interface or to a GMLC in another PLMN using the Ngmlc interface in the case of a roaming UE.\nThe target UE's privacy profile settings shall always be checked in the UE's home PLMN prior to delivering a location estimate.\nThe \"Visited GMLC\" (VGMLC) is the GMLC, which is associated with the serving node of the target UE.\nThe \"Home GMLC\" (HGMLC) is the GMLC residing in the target UE's home PLMN, which is responsible for the control of privacy checking of the target UE.\nAdditional functions which may be performed by a GMLC to support location services include the following:\n-\tAt an HGMLC, determine the serving AMF for a target UE when there is more than one serving AMF.\n-\tAt an HGMLC, determine whether to attempt a second location request for a target UE from a different AMF when location information returned by a first AMF does not meet QoS requirements and there is more than one serving AMF.\n-\tAt an HGMLC, support location requests from an external LCS client or NEF for a 5GC-MT-LR and deferred 5GC-MT-LR for periodic, triggered and UE available location events.\n-\tAt an HGMLC, support additional check of whether the UE is located within the requested target area for deferred 5GC-MT-LR for periodic, triggered and UE available location events.\n-\tAt an HGMLC, forward location requests for a roaming UE to a VGMLC or serving AMF in the VPLMN based on deployment configurations.\n-\tAt an HGMLC, receive event reports from a VGMLC or LMF for a deferred 5GC-MT-LR for periodic or triggered location and return to an external LCS Client or NEF.\n-\tAt an HGMLC, support cancelation of a periodic or triggered location.\n-\tAt an HGMLC, receive location information from an VGMLC for a 5GC-MO-LR and forwards to an LCS Client or an AF (via NEF) if requested by the UE.\n-\tAt a VGMLC, receive location requests from an HGMLC for a roaming UE and forward to a serving AMF.\n-\tAt a VGMLC, receive event reports from an LMF for a deferred 5GC-MT-LR for periodic or triggered location for a roaming UE and forward to an HGMLC.\n-\tAt a VGMLC, receive location information from an AMF for a 5GC-MO-LR and forwards to an HGMLC.\n-\tAt an HGMLC, reject the LCS request coming from a LCS client, e.g. when the number of Target UEs in the LCS request exceeds the Maximum Target UE Number of such client.\n-\tAt an HGMLC, allocate the reference number for each location request from an external LCS client for LDR.\n-\tAt an HGMLC, assign the pseudonym if pseudonym indicator is received in the service request and transfer it to external LCS client, e.g. when core network provides the UE's location information to LCS client. Resolve the verinym from the pseudonym, if it is received from the LCS client.\n-\tAt an HGMLC, resolve group identifier to identifier of individual UEs and aggregate responses to LCS Client or NEF during bulk operation procedure.\n-\tAt an HGMLC, verify a request for user plane reporting by an LCS Client or AF for a periodic or triggered 5GC-MT-LR and verify or assign parameters to the request to enable the target UE to establish a secure user plane connection to the LCS Client or AF. Subsequently, support the transfer of cumulative event reports from the target UE via control plane back to the LCS Client or AF.\n-\tDuring UE mobility between 5GS and EPS, the GMLC transfers the LCS request between 5GS and EPS, may map the LCS QoS and (re-)initiate the LCS sessions towards the 5GS to/from EPS.\n-\tAt an HGMLC, determine a reporting indication on how a target UE sends event reports when the UE is outside the event report allowed area based on LCS privacy profile data, LCS Client type, the type of periodic or triggered location reporting and associated parameters.\n-\tSupport aggregation of a single UE's location estimates over a period of time for a periodic or triggered 5GC-MT-LR event.\n-\tAt an HGMLC or a VGMLC, for a regulatory location service, support multiple location reports if requested by the LCS client.\n-\tAt an HGMLC, transform the universal location co-ordinates provided by the AMF into some local geographic reference system.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.3.4",
      "section_id": "4.3.4",
      "section_title": "Location Retrieval Function, LRF",
      "content": "The Location Retrieval Function (LRF) may be collocated with a GMLC or separate and is responsible for retrieving or validating location information, providing routing and/or correlation information for a UE which has initiated an IMS emergency session. The information is provided by an LRF to an E-CSCF. For more details, refer to TS 23.167 [10].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.5",
      "section_id": "4.3.5",
      "section_title": "UE",
      "content": "A target UE may support positioning according to four different modes:\n-\tUE assisted mode (the UE obtains location measurements and sends the measurements to another entity (e.g. an LMF) to compute a location);\n-\tUE based mode (the UE obtains location measurements and computes a location estimate making use of assistance data provided by serving PLMN);\n-\tstandalone mode (the UE obtains location measurements and computes a location estimate without making use of assistance data provided by serving PLMN);\n-\tnetwork based mode (a serving PLMN obtains location measurements of signals transmitted by a target UE and computes a location estimate).\nNOTE:\tThe transmission of UE signals for network based mode may or may not be transparent to the UE.\nPositioning procedures used by a UE for NG-RAN access are described in TS 38.305 [9].\nA limited set of UE positioning capabilities and UE user plane positioning capabilities can be transferred to the 5GCN in the 5GMM capability during registration of the UE as described in TS 24.501 [11]. Some of these positioning capabilities may be transferred subsequently to an LMF as described in TS 29.572 [12]. UE positioning capabilities may also be transferred directly to a location server (e.g. LMF).\nAdditional functions which may be supported by a UE to support location services include the following.\n-\tSupport location requests received from a network for 5GC-MT-LR, 5GC-NI-LR or a deferred 5GC-MT-LR for periodic or triggered location.\n-\tSupport location requests to a network for a 5GC-MO-LR.\n-\tSupport privacy notification and verification for a 5GC-MT-LR or deferred 5GC-MT-LR for periodic or triggered location.\n-\tSend updated privacy requirements to a serving AMF (for transfer to a UDR via UDM).\n-\tSupport periodic or triggered location reporting to an LMF.\n-\tSupport change of a serving LMF for periodic or triggered location reporting.\n-\tSupport cancelation of periodic or triggered location reporting.\n-\tSupport multiple simultaneous location sessions.\n-\tSupport the reception of unciphered and/or ciphered assistance data broadcast by NG-RAN.\n-\tSupport the reception of ciphering keys for the assistance data from the AMF.\n-\tSupport handling of 5GC-MT-LR, 5GC-NI-LR, 5GC-MO-LR and deferred 5GC-MT-LR for periodic or triggered location over a user plane connection between UE and LMF.\n-\tSupport reporting of location events for a periodic or triggered 5GC-MT-LR over a user plane connection to an LCS Client or AF with periodic cumulative event reports being sent over control plane to the LMF, H-GMLC and LCS Client or AF.",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.305",
        "ts_24.501",
        "ts_29.572"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.6",
      "section_id": "4.3.6",
      "section_title": "UDM",
      "content": "The UDM contains LCS subscriber LCS privacy profile and routing information. The UDM is accessible from an AMF, GMLC or NEF via the Nudm interface.\nThe UDM may also contain an indication whether a UE is allowed to serve as a PRU and indication whether PRU is stationary PRU as part of the UE subscription data.\nThe UDM may also contain LMF identifier(s) and indication of user plane positioning between UE and LMF in UE LCS subscription data.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.3.7",
      "section_id": "4.3.7",
      "section_title": "Access and Mobility Management Function, AMF",
      "content": "The AMF contains functionality responsible for managing positioning for a target UE for all types of location request. The AMF is accessible to the GMLC and NEF via the Namf interface, to the RAN via the N2 reference point and to the UE via the N1 reference point.\nFunctions which may be performed by an AMF to support location services include the following.\n-\tInitiate an NI-LR location request for a UE with an IMS emergency call or to know a UE geographical area with NR satellite access for PLMN selection verification.\n-\tReceive and manage location requests from a GMLC for a 5GC-MT-LR and deferred 5GC-MT-LR for periodic, triggered and UE available location events.\n-\tReceive and manage location requests from a UE for a 5GC-MO-LR.\n-\tReceive and manage Event Exposure request for location information from an NEF.\n-\tSelect an LMF.\n-\tReceive updated privacy requirements from a UE and transfer to a UDR via UDM.\n-\tSupport cancelation of periodic or triggered location reporting for a target UE.\n-\tSupport cancelation of a 5GC-MT-LR or 5GC-MO-LR during UE mobility from 5GS to EPS with N26 interface.\n-\tSupport change of a serving LMF for periodic or triggered location reporting for a target UE.\n-\tWhen assistance data is broadcast by 5GS in ciphered form, the AMF receives ciphering keys from the LMF and forwards to suitably subscribed UEs using mobility management procedures.\n-\tStore UE Positioning Capability received from an LMF and send the UE Positioning Capability along with the received location request to an LMF.\n-\tReceive and store UE user plane positioning capabilities (the user plane positioning using LCS-UPP and/or the user plane positioning using SUPL [49]) as part of the \"5GMM capability\" from UE.\n-\tReceive UL NAS Transport including a PRU Association, Association Update, or Disassociation Request (contained in an LCS supplementary service message) from a UE.\n-\tAMF may verify whether a UE can serve as a PRU based on UE subscription data after receiving the PRU Association Request, Association Update, or Disassociation. AMF may also use local policy to determine if UEs are allowed to serve as a PRU. AMF may verify based on subscription information or local policy if PRU can work as stationary PRU.\n-\tSends the PRU Association Request or PRU Disassociation Request to LMF and may include a UE verification indication indicating whether this UE is authorized to serve as a PRU.\n-\tSupport verifying whether UE is subscribed with user plane positioning between UE and LMF and triggering LMF to establish a User Plane Connection to UE if UE requested that.\n-\tSupport subscribing from LMF status of LCS user plane connection between a UE and the LMF.\n-\tStore in UE context that UE has a maintained User Plane connection with certain LMFs.\nNOTE:\tDetails of UE Positioning Capability is defined in TS 37.355 [20].\n-\tSupport of local configuration of a mapping table of UE identifier ranges and LMF identifier(s) or querying the UDM the LMF identifier for a UE for a 5GC-MO-LR.\n-\tSupport the 5G to EPS Handover by providing the target MME ID to GMLC as part of the LCS Service response.\n-\tSupport interaction with NWDAF to obtain UE related analytics to assist with UE location verification for NR satellite access.",
      "chunk_type": "general",
      "cross_references": [
        "ts_37.355"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.8",
      "section_id": "4.3.8",
      "section_title": "Location Management Function, LMF",
      "content": "The LMF manages the overall co-ordination and scheduling of resources required for the location of a UE that is registered with or accessing 5GCN. It also calculates or verifies a final location and any velocity estimate and may estimate the achieved accuracy. The LMF receives location requests for a target UE from the serving AMF using the Nlmf interface. The LMF interacts with the UE in order to exchange location information applicable to UE assisted and UE based position methods and interacts with the NG-RAN, N3IWF or TNAN in order to obtain location information.\nThe LMF shall determine the result of the positioning in geographical co-ordinates as defined in TS 23.032 [8] and/or in local co-ordinates as defined in TS 23.032 [8]. If requested and if available, the positioning result may also include the velocity of the UE. The coordinate type(s) is determined by LMF when receiving a location request, based on LCS Client type and supported GAD shapes. If the location request indicates regulatory LCS Client type the LMF shall determine a geographical location and optionally a location in local coordinates. For location request indicates a value added LCS Client type, the LMF may determine the UE location in local coordinates or geographical co-ordinates or both. If the supported GAD shapes is not received or Local Co-ordinates is not included in the supported GAD shapes, the LMF shall determine a geographical location.\nNOTE 1:\tSome RAT independent position methods (e.g. GNSS based position methods) can only determine a UE location in geographical co-ordinates. In such a case, the LMF may translate a UE location in geographical co-ordinates into a location in local co-ordinates when an origin for the local co-ordinates has known global coordinates. When an origin for the local co-ordinates does not have known global coordinates, position methods that can only determine a UE location in geographical co-ordinates cannot be used to determine a UE location in local co-ordinates.\nAdditional functions which may be performed by an LMF to support location services include the following.\n-\tSupport a request for a single location received from a serving AMF for a target UE.\n-\tSupport a request for periodic or triggered location received from a serving AMF for a target UE.\n-\tDetermine type and number of position methods and procedures based on UE and PLMN capabilities, QoS, UE connectivity state per access type, LCS Client type, co-ordinate type and optionally service type and indication of requiring reliable UE location information. If the indication of requiring reliable UE location information is received, the LMF selects positioning method as per the TS 33.256 [51].\n-\tReport UE location estimates directly to a GMLC for periodic or triggered location of a target UE.\n-\tSupport cancelation of periodic or triggered location for a target UE.\n-\tSupport cancelation of a 5GC-MT-LR or 5GC-MO-LR during UE mobility from 5GS to EPS with N26 interface.\n-\tSupport the provision of broadcast assistance data to UEs via NG-RAN in ciphered or unciphered form and forward any ciphering keys to subscribed UEs via the AMF.\n-\tSupport change of a serving LMF for periodic or triggered location reporting for a target UE.\n-\tSupport of receiving stored UE Positioning Capability from AMF and support of providing updated UE Positioning Capability to AMF.\n-\tMap the UE location to a geographical area where the PLMN is or is not allowed to operate based on the request from AMF.\n-\tSupport determination of a UE location at a scheduled location time.\n-\tSupport determination of indoor or outdoor for a location estimate.\n-\tDetermine whether to use user plane or control plane for positioning.\n-\tSupport handling of 5GC-MT-LR, 5GC-NI-LR, 5GC-MO-LR and deferred 5GC-MT-LR for periodic or triggered location over a user plane connection between UE and LMF over TLS.\nNOTE 2:\tHow the LMF uses the received UE user plane positioning capability for SUPL [49] is left to the implementation.\n-\tSupport collection of GNSS assistance data from AFs.\n-\tSupport service level PRU Association, PRU Association update or PRU Disassociation.\n-\tLMF supports verification of a PRU initiated Association or Disassociation by checking whether there is an PRU verified indication from AMF.\n-\tLMF stores the received PRU information contained in service level PRU Association message and removes the PRU information after PRU Disassociation.\n-\tLMF keeps PRU information for PRUs which are in OFF state.\n-\tLMF may indicate support of PRU function to NRF via NF profile and may further send the PRU indication via NF profile update if PRU is stationary PRU.\n-\tLMF may request a PRU to associate to a new LMF by returning a Routing ID of the new LMF.\nPRU ON/OFF states indicate temporarily availability of the PRU functionality of a UE at the serving LMF (e.g. PRU OFF due to other high priority tasks/energy saving at the UE, or the UE temporarily loses network coverage).\n-\tSupport selection of a PRU based on stored PRU information if the LMF needs to obtain the location measurements from the PRU to assist positioning of a target UE.\n-\tSupport to obtain PRU location measurements as described in clause 5.4.5 of TS 38.305 [9] by triggering the procedure in clause 6.11.\n-\tSupport to obtain PRU location measurements from other PRU serving LMF(s).\n-\tAs a serving LMF of target UE(s), support discovery and selection of other PRU serving LMF(s) by querying the NRF and support to request PRU location measurements from the selected LMF(s).\n-\tAs a serving LMF of PRU(s), support to provide PRU location measurements to other LMF(s) after receiving a request from other LMF(s).\n-\tSupport to determine UE location by considering obtained PRU location measurements.\nNOTE 3:\tCountry, area within a country, or an international area can be supported as different types of geographical area.\n-\tSupport a request for user plane reporting from a UE to an LCS Client or AF for a periodic or triggered 5GC-MT-LR. Subsequently, support the transfer of cumulative event reports from the target UE via control plane back to the H-GMLC and LCS Client or AF. Also support any request for assistance data received in a cumulative event report.\n-\tDetermine UE location for a UE connecting to a MBSR based on location and velocity of the MBSR and the timing of the location estimations for the target UE and MBSR.\n-\tFor a regulatory location service, support reporting of multiple INTERMEDIATE location estimates to GMLC.",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.305_clause_5.4.5",
        "clause_6.11",
        "ts_23.032",
        "ts_33.256",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.9",
      "section_id": "4.3.9",
      "section_title": "Network Exposure Function, NEF",
      "content": "An NEF provides a means of accessing location services by an external AF or internal AF. AFs access location services from an NEF using an API. Depending on QoS requirements, an NEF can forward a location request to a GMLC or request an event exposure for location information from serving AMF (optionally via a UDM). When event exposure via AMF is used, an NEF may request routing information and/or target UE privacy information from the UDM via the Nudm interface.\nAdditional functions which may be performed by an NEF to support location services include the following.\n-\tSupport location requests from an AF for immediate location and for deferred periodic and triggered location events.\n-\tSupport location information exposure to an AF based on the location request.\n-\tSupport determination of GMLC or AMF based on e.g. the QoS requirements from AF, type of the location request.\nNOTE:\tIf the GMLC or AMF are determined based on the QoS requirements and the QoS requirements include Multiple QoS class, the determination of GMLC or AMF is done based on the most stringent (i.e. primary) QoS requirements.\n-\tSelect the serving AMF for a target UE when there is more than one serving AMF.\n-\tDetermine whether to attempt a second location request for a target UE from a different AMF when location information returned by a first AMF does not meet QoS requirements and there is more than one serving AMF.\n-\tSupport UE LCS privacy profile provision from the AF.\n-\tSupport suspending and cancellation of a periodic or triggered location request.\n-\tSupport authorization of LCS request from the AF.\n-\tSupport rejecting the LCS request coming from an AF, e.g. when the number of Target UEs in the LCS request exceeds the Maximum Target UE Number of such client.\n-\tSupport allocating the reference number for each location request from an AF for LDR.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.3.10",
      "section_id": "4.3.10",
      "section_title": "Unified Data Repository, UDR",
      "content": "The UDR contains privacy data information for target UEs and may be updated by a serving AMF via UDM with new privacy information received from a UE.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.3.11",
      "section_id": "4.3.11",
      "section_title": "Positioning Reference Unit, PRU",
      "content": "A UE may support the functions of a PRU. The PRU supports the following functions including functions defined in TS 38.305 [9]:\n-\tSupport service level association, association update and disassociation with a serving LMF.\n-\tThe PRU sends service level association, association update or disassociation to LMF via LCS supplementary service message.\n-\tSupport association with multiple LMFs. e.g. for the case a PRU is in multiple LMF overlapped serving areas.\n-\tThe PRU information included in a PRU association or PRU association update contains one or more than one of the following aspects:\n-\tPRU Positioning Capabilities.\n-\tLocation information if known.\n-\tPRU ON/OFF state.\nPRU ON/OFF states indicate temporarily availability of the PRU functionality of a UE at the serving LMF.\nA UE accesses 5G network via NR satellite shall not operate as a PRU.",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.3.12",
      "section_id": "4.3.12",
      "section_title": "Network Repository Function, NRF",
      "content": "In addition to the functions defined in TS 23.501 [18], the NRF may perform the following functions:\n-\tSupport to store or update PRU existence indication in TAI level in LMF profile based on request from PRU serving LMF.\n-\tSupport LMF(s) with PRU function discovery by AMF.\n-\tLMF discovery by considering user plane Positioning Capability.\n-\tSupport LMF(s) associated with PRUs discovery by other LMF(s), according to target area in the discovery request and the LMF profiles with PRU existence indication in TAI level.\n-\tLMF discovery by considering the support of LCS when MBSR is involved.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.1",
      "section_id": "4.4.1",
      "section_title": "Le Reference Point",
      "content": "The Le reference point supports location requests sent by an LCS Client to a GMLC or LRF.\nThe Le reference point may be supported using the Mobile Location Protocol (MLP) defined by OMA [13].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.2",
      "section_id": "4.4.2",
      "section_title": "NL3 Reference Point",
      "content": "The NL3 reference point supports location requests forwarded by an HGMLC to a VGMLC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.3",
      "section_id": "4.4.3",
      "section_title": "N1 Reference Point",
      "content": "The N1 reference point supports transfer of supplementary services messages between a serving AMF and target UE to support privacy notification and verification and change of UE privacy preference. The N1 reference point also supports transfer of positioning protocol messages and location event reports between a target UE and an LMF via a serving AMF. The N1 reference point supports the transfer of ciphering keys from an AMF to a suitably subscribed UE to enable the UE to receive ciphered broadcast assistance data. All messages sent over the N1 reference point for support of location services are encapsulated in NAS Transport messages as defined in TS 24.501 [11].",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.501"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.4",
      "section_id": "4.4.4",
      "section_title": "N2 Reference Point",
      "content": "The N2 reference point supports transfer of positioning messages, via an AMF, between an LMF and a RAN node, or N3IWF in the case of untrusted non-3GPP access. The N2 reference point also supports transfer of messages, via an AMF, from an LMF to an NG-RAN node, which carry assistance data to be broadcast by the NG-RAN node. Positioning messages relevant to the N2 interface are defined in TS 38.455 [15].",
      "chunk_type": "general",
      "cross_references": [
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.6",
      "section_id": "4.4.6",
      "section_title": "NL5 Reference Point",
      "content": "The NL5 reference point supports location requests sent by an NEF or other NF to a GMLC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.7",
      "section_id": "4.4.7",
      "section_title": "NL2 Reference Point",
      "content": "The NL2 reference point supports location requests sent by a GMLC to a serving AMF for a target UE.\nMessages for the NL2 reference point are defined in TS 29.518 [16].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.518"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.8",
      "section_id": "4.4.8",
      "section_title": "NL6 Reference Point",
      "content": "The NL6 reference point supports queries from an HGMLC to a UDM for privacy subscription information for a target UE and routing information for a target UE.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.9",
      "section_id": "4.4.9",
      "section_title": "N51 Reference Point",
      "content": "The N51 reference point supports queries from an NEF to a serving AMF for the location of a target UE.\nMessages for the N51 reference point are defined in TS 29.518 [16].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.518"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.10",
      "section_id": "4.4.10",
      "section_title": "NL1 Reference Point",
      "content": "The NL1 reference point supports location requests for a target UE sent from a serving AMF for the target UE to an LMF. Location requests are supported for immediate location and for deferred location for periodic or triggered location events.\nThe NL1 reference point also supports the transfer from an LMF to an AMF of ciphering keys and associated data that enable deciphering by suitably subscribed UEs of ciphered broadcast assistance data.\nMessages for the NLI reference point are defined in in TS 29.518 [16] and TS 29.572 [12].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.518",
        "ts_29.572"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.11",
      "section_id": "4.4.11",
      "section_title": "N52 Reference Point",
      "content": "The N52 reference point supports queries from an NEF to a UDM for privacy subscription information for a target UE and routing information for a target UE. The N52 interface also supports a request from an NEF to a UDM to forward a location request from the NEF to a serving AMF for the target UE.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.12",
      "section_id": "4.4.12",
      "section_title": "NL7 Reference Point",
      "content": "The NL7 reference point supports location context transfer between two LMFs.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.13",
      "section_id": "4.4.13",
      "section_title": "NL8 Reference Point",
      "content": "The NL8 reference point supports LMF to receive location related analytics from NWDAF as defined in TS 23.288 [37].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.273_4.4.14",
      "section_id": "4.4.14",
      "section_title": "NL9 Reference Point",
      "content": "The NL9 reference point supports location requests sent by NWDAF to a GMLC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.15",
      "section_id": "4.4.15",
      "section_title": "NL10 Reference Point",
      "content": "The NL10 reference point supports LMF to send location requests to GMLC in case of 5GC-MT-LR involving MBSR. Additionally, this reference point is used by LMF to send location result directly to GMLC in case of Deferred Location or 5GC-MT-LR multiple location or in case of support for PNI-NPN architecture.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.4.16",
      "section_id": "4.4.16",
      "section_title": "NL11 Reference Point",
      "content": "NL11 reference point enables user plane between UE and LMF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_4.5",
      "section_id": "4.5",
      "section_title": "Service Based Interfaces to Support Location Services",
      "content": "The 5GS LCS architecture contains the following service-based interfaces for Location Services:\nNlmf:\tService-based interface exhibited by LMF.\nNgmlc:\tService-based interface exhibited by GMLC.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.1",
      "section_id": "5.1",
      "section_title": "LMF Discovery and Selection",
      "content": "LMF selection functionality is supported by the AMF to determine an LMF for location estimation of the target UE or Ranging/Sidelink Positioning between Target UE and SL Reference UE. The LMF selection functionality is also supported by the LMF if it determines that it is unsuitable or unable to support location for the current UE access network or serving cell for the deferred 5GC-MT-LR procedure for periodic, triggered location events, or Modification of User Plane Connection. The LMF selection functionality may also be supported by the GMLC and the GMLC provides the selected LMF ID to AMF.\nLMF reselection is a functionality supported by AMF when necessary, e.g. due to UE mobility.\nThe LMF selection/reselection may be performed at the AMF or LMF or GMLC based on the locally available information i.e. LMF profiles are configured locally at AMF or LMF or GMLC, or by querying NRF.\nThe following factors may be considered during the LMF selection:\n-\tLCS client type.\n-\tRequested Quality of Service information, e.g.:\n-\tLCS accuracy,\n-\tResponse time (latency),\n-\tAccess Type (3GPP /N3GPP).\nNOTE 1:\tLocation methods may differ depending on the Access Type, e.g. in the case of WLAN Access Location determination may just correspond to retrieval of IP addressing information from the N3IWF/TNGF; As another example, for Wireline access, Location determination may just correspond to retrieval of geo coordinates corresponding to a GLI as defined in clause 4.7.8 of TS 23.316 [21] or a HFC Node ID.\n-\tRAT type (e.g. 5G NR, eLTE, or any of the RAT Types specified for NR satellite access) and/or the serving AN node (i.e. gNB or NG-eNB) of the target UE.\n-\tRAN configuration information.\n-\tLMF capabilities, including:\n-\tthe support of Uu based positioning as defined in clause 4.3.8;\n-\tRanging/Sidelink positioning as defined in clause 4.3.8 of TS 23.586 [40];\n-\tLMF user plane positioning capabilities (the capability to support LCS-UPP).\n-\tLMF load.\n-\tLMF location.\n-\tIndication of either a single event report or multiple event reports.\n-\tDuration of event reporting.\n-\tNetwork slicing information, e.g. S-NSSAI and/or NSI ID.\n-\tLMF Service Area consisting of one or more TA(s).\n-\tSupported GAD shapes.\n-\tSupport LCS when MBSR is involved.\n-\tRequested UE has maintained user plane connection with certain LMFs.\nWhen receiving a NAS message from UE, including an LMF ID together with a LPP message (refer to step 25 in clause 6.3.1 for event reporting for a deferred 5GC-MT-LR), AMF sends the LPP message to the LMF, as indicated by the LMF ID.\nNOTE 2:\tDescription on how UE encapsulates the LMF ID in the NAS message is documented in TS 24.571 [36].\nUDM may store the LMF ID in UE subscription data. During the location procedure, GMLC received the LMF ID from the UDM and provides it to AMF.\nGMLC may be configured with the following parameters:\n-\tLMF ID and/or\n-\tper group ID and its correlating LMF ID.\nThe AMF may use locally provisioned configuration to determine LMF based on UE identify or its group information.\nNOTE 3:\tIt is AMF implementation specific for the priority of different selection criteria from GMLC, AMF and LMF.\nWhen the GMLC receives a MT location request from LCS client/AF, GMLC determines the LMF ID based on the configured parameters for an LCS Client/AF. In case a group ID is provided or derived from the location request, GMLC determines the correlating LMF ID based on the provisioned group ID.\nGMLC may have configuration with one or several dedicated LMF ID(s), irrelevant to any LCS client/AF. When the GMLC receives a MT location request from LCS client/AF, GMLC only determines the LMF ID within the configuration for all LCS client/AF.\nNOTE 4:\tWhen AMF can't access the LMF instance of the LMF ID, by default, AMF replies to corresponding error to GMLC. GMLC could retry or fail the request accordingly; with explicit configuration to serve as backup selection in this, AMF can also select different configured LMF instance.\n5.1a\tGMLC Discovery and Selection\nMore than one GMLC in the HPLMN can serve the location requests for a single UE. GMLC discovery and selection functionality is supported by AMF, LMF, NEF, LCS client and GMLC.\nA LCS client may be configured with GMLC address(es). It may also determine the GMLC address by performing a DNS query.\nA NEF, LMF, AMF or GMLC may be configured with GMLC address(es). Those NF may also query the NRF to get GMLC address(es).\nIn the following scenarios, information about the GMLC instance may be provided by UE, in such case, this GMLC instance is used:\n-\tIn the deferred MT-LR procedure, when UE reports the detected event to the AMF, it may also include the (H)GMLC address.\n-\tIn the MO-LR procedure, when UE initiates the LCS service request, it may also include the (H)GMLC address if the location estimation is reported to the (H)GMLC.\nAMF may be configured locally a mapping table of UE identity e.g. MSISDN and GMLC address. When receiving a MO-LR, AMF determines GMLC based on local configuration.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.316_clause_4.7.8",
        "clause_4.3.8",
        "ts_23.586_clause_4.3.8",
        "clause_6.3.1",
        "ts_23.316",
        "ts_23.586",
        "ts_24.571"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.2",
      "section_id": "5.2",
      "section_title": "3GPP access specific aspects",
      "content": "When 3GPP access type is selected, the positioning methods for 3GPP access defined in TS 38.305 [9] apply.\nAccess Type Selection for LCS Service is defined in clause 5.3.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.3.2",
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.3.1",
      "section_id": "5.3.1",
      "section_title": "Location Information for Non-3GPP Access",
      "content": "If the UE registered to non-3GPP access, following information can be regarded as UE location information:\nTable 5.3.1-1: Supported UE location information of non-3GPP access\nUntrusted non-3GPP Access\nTrusted non-3GPP Access\nWireline Access\nUE Side\nN5CW device Side for Trusted WLAN Access\n5G-RG side for Wireline Access\nUE local IP address,\nIn the case of WLAN access, BSSID of the attached AP or BSSID of detected AP,\nCivic address and/or geospatial location information (NOTE 1, NOTE 5, NOTE 6).\nUE/N5CW device local IP address (NOTE 2).\nIn the case of WLAN access, BSSID of the attached AP or BSSID of detected AP,\nCivic address and/or geospatial location information (NOTE 1, NOTE 5, NOTE 6).\nNull\nN3IWF Side for Untrusted non-3GPP Access;\nTNGF Side for trusted non-3GPP Access;\nTWIF Side for trusted WLAN Access;\nW-AGF Side for wireline Access\nUE local IP address and optionally UDP or TCP source port (NOTE 2)\nUE/N5CW device local IP address and optionally UDP or TCP source port (NOTE 2),\nTNAP/TWAP Id (NOTE 2)\nHFC node ID for 5G-CRG in clause 10.1 of TS 23.316 [21];\nGLI for 5G-BRG in clause 10.1 of TS 23.316 [21].\nAMF Side\nUE local IP address and optionally UDP or TCP source port (NOTE 3).\nLast known 3GPP access User Location Info (NOTE 4).\nUE/N5CW device local IP address and optionally UDP or TCP source port (NOTE 2, NOTE 3).\nLast known 3GPP access User Location Info (NOTE 4).\nTNAP/TWAP Id (NOTE 2)\nHFC node ID for 5G-CRG in clause 10.1 of TS 23.316 [21];\nGLI for 5G-BRG in clause 10.1 of TS 23.316 [21]\nNOTE 1:\tIn the case of WLAN access, the UE may retrieve its location from a WLAN AP, prior or after association with the AP, requesting the Civic Location ANQP element, the Geospatial Location ANQP element or both as specified in IEEE Std 802.11-2012, using ANQP procedures described in HS2.0 Rel-12 specification.\nNOTE 2:\tMore details can refer to clause 5.6.2 of TS 23.501 [18].\nNOTE 3:\tThis location information can be provided by location change event, more details can refer to clause 5.2.2.3.1 of TS 23.502 [19].\nNOTE 4:\tThis location information is also named as Last known Cell-Id, more details can refer to clause 5.6.2 of TS 23.501 [18].\nNOTE 5:\tGeospatial location information can be obtained if UE (e.g. laptop) has installed GNSS receiver, i.e. GPS.\nNOTE 6:\tSome Applications (e.g. Google Map) may map the WiFi AP's BSSID with the geospatial locations obtain through GPS when the UE switch on the GPS and WiFi simultaneously. When another UE detect the same AP, the Application will send the geospatial locations to the UE. Thus the UE obtain the geospatial locations even without switch on the GPS. If the Application map the geospatial locations to civic address, the UE can also obtain the civic address.\nIf the UE registered to 3GPP access and non-3GPP access simultaneously, following information can be regarded as UE location information:\n-\tAll location information when the UE only registered to non-3GPP access,\n-\tAll location information when the UE only registered to 3GPP access, more details can refer to TS 36.305 [7].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.316_clause_10.1",
        "ts_23.501_clause_5.6.2",
        "ts_23.502_clause_5.2.2.3.1",
        "table_5.3.1-1",
        "ts_23.316",
        "ts_23.501",
        "ts_23.502",
        "ts_36.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.3.2",
      "section_id": "5.3.2",
      "section_title": "Access Type Selection for LCS Service",
      "content": "The positioning of a UE can be performed via either 3GPP access network or non-3GPP access network.\nFor a MT-LR Location Service request, in order to select the positioning access type, the GMLC uses information retrieved from the UDM and optionally serving AMFs, e.g. access type, its serving AMF identity(ies), and UE connectivity state of this access, if available, and locally configured operator policy as follows:\n-\tIf only one AMF identity is provided by the UDM, the GMLC selects this AMF for UE positioning.\n-\tWhen the UE is concurrently served by multiple PLMNs respectively for 3GPP access and non-3GPP access, multiple AMF identities with corresponding access types may be provided by the UDM, and the GMLC selects one access type and its associated AMF, which may be based on access type and its AMF, UE connectivity state per access type information, if this is retrieved from UDM or AMFs, PLMN identity, and/or locally configured operator policy. If the location estimation result provided by this AMF cannot fulfil the QoS requirements, the GMLC may reselect another access type and its associated AMF from the candidate list provided by the UDM to perform positioning.\nWhen AMF receives a MT-LR Location Service request, the AMF shall provide to the LMF UE connectivity state per access type as well as the QoS requirement that are received from the GMLC.\nWhen AMF receives the event report from the UE for a periodic or triggered MT-LR Location Service, the AMF may select a LMF or use the LMF indicated by the UE as described in clause 6.4 and clause 6.3.1 and may provide the UE connectivity state per access type to the LMF.\nThe LMF determines the positioning access type and positioning method based on the QoS requirement, UE/network positioning capability, and UE connectivity state per access type received from the AMF and the locally configured operator policy.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4",
        "clause_6.3.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.1",
      "section_id": "5.4.1",
      "section_title": "General",
      "content": "An LCS client or AF may or may not be authorised to retrieve the UE location, e.g. for commercial use. UE LCS privacy is a feature which allows a UE and/or AF to control which LCS clients and AFs are and are not allowed access to UE location information. UE LCS privacy can be supported via subscription and via UE LCS privacy profile handling.\nWith subscription, privacy preferences for a UE are stored in a UE LCS privacy profile as part of UE subscription data in the UDM and queried from the UDM by another NF such as GMLC or NEF. The UDM may also store the UE privacy profile in the UDR. In this release of the specification, subscription of privacy preferences is restricted to the Call/Session unrelated Class as defined in clause 5.4.2.2.3 and the PLMN Operator Class as defined in clause 5.4.2.2.4.\nWith UE LCS privacy profile handling, the UE and/or AF can provide and update part of the UE privacy profile and provide it to the network as an update to the UDR. In this release of the specification, UE LCS privacy profile handling is restricted to the Location Privacy Indication as defined in clause 5.4.2.3.\nThe UE LCS privacy profile is used to indicate whether LCS requests from LCS clients and AFs are allowed or disallowed, together with the POI as defined in clause 5.4.4.\nNOTE:\tIn clause 5.4, even if the UE LCS privacy detail is only described for LCS client, the same detail is also applicable for AF, if no exception statement.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.4.2.2.3",
        "clause_5.4.2.2.4",
        "clause_5.4.2.3",
        "clause_5.4.4",
        "clause_5.4"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.1",
      "section_id": "5.4.2.1",
      "section_title": "General",
      "content": "The UE LCS privacy profile shall include information related to classes of LCS client, referred to as \"privacy classes\", which are permitted, or conditionally permitted, to obtain location information for the UE. Privacy classes are defined in clause 9.5.3 of TS 23.271 [4], but not all classes defined in TS 23.271 [4] are supported in this specification. Privacy classes are supported as described below. The differences between the Privacy classes for 5GS and those for EPS are described in Annex A.\nThe UE LCS privacy profile also includes the Location Privacy Indication, as defined in clause 5.4.2.3, which can be provided and updated by the UE and/or AFs.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.271_clause_9.5.3",
        "clause_5.4.2.3",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.2.1",
      "section_id": "5.4.2.2.1",
      "section_title": "Universal Class",
      "content": "The universal class defined in clause 9.5.3.1 of TS 23.271 [4] is not supported in this specification.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.5.3.1",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.2.2",
      "section_id": "5.4.2.2.2",
      "section_title": "Call/Session related Class",
      "content": "The call/session related class defined in clause 9.5.3.2 of TS 23.271 [4] is not supported in this specification.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.5.3.2",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.2.3",
      "section_id": "5.4.2.2.3",
      "section_title": "Call/Session unrelated Class",
      "content": "The call/session unrelated class defined in clause 9.5.3.3 of TS 23.271 [4] is supported for a 5GC-MT-LR. The subscription options for the Call/Session unrelated Class may be assigned to an identified value added LCS Client, AF, value added LCS Client group or service type as described in clause 7.1 and comprise one of the following alternatives:\n-\tpositioning allowed without notifying the UE user (default case);\n-\tpositioning allowed with notification to the UE user;\n-\tpositioning requires notification and verification by the UE user; positioning is allowed only if granted by the UE user or if there is no response to the notification;\n-\tpositioning requires notification and verification by the UE user; positioning is allowed only if granted by the UE user.\nNOTE:\tLCS service types are defined in TS 22.071 [2] and numeric values for LCS service types are listed in clause 17.7.8 of TS 29.002 [29].\nA default subscription as described in clause 9.5.3.3 of TS 23.271 [4] is included in the UE LCS privacy profile for any value added LCS client or AF not otherwise identified for the Call/Session unrelated Class and defines one of the following alternatives:\n-\tpositioning not allowed (default case);\n-\tpositioning allowed with notification to the UE user;\n-\tpositioning requires notification and verification by the UE user; positioning is allowed only if granted by the UE user or if there is no response to the notification;\n-\tpositioning requires notification and verification by the UE user; positioning is allowed only if granted by the UE user.\nThe subscription options for the Call/Session unrelated Class may further indicate additional information for each identified value added LCS client, for each identified service type and for the unidentified value added LCS clients as follows:\n-\tA valid time period for positioning;\n-\tA valid geographic area for positioning.\nThe UE LCS privacy profile may also indicate that any unidentified value added LCS client or an LCS Client associated with an identified service type shall provide a codeword in order to locate the UE, where the codeword is verified by either a GMLC or the UE. When verification by a GMLC is indicated, a list of one or more codewords is included as part of the UE LCS privacy profile.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.5.3.3",
        "clause_7.1",
        "ts_29.002_clause_17.7.8",
        "ts_23.271",
        "ts_22.071",
        "ts_29.002"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.2.4",
      "section_id": "5.4.2.2.4",
      "section_title": "PLMN Operator Class",
      "content": "The PLMN operator class defined in clause 9.5.3.4 of TS 23.271 [4] is supported.\nNOTE:\tThe PLMN Operator Class (except O&M LCS client in the VPLMN) can be applied to SNPN.\nBesides the types of client specified in clause 9.5.3.4 of TS 23.271 [4], the PLMN Operator Class also supports positioning by the following types of client:\n-\tNWDAF in the HPLMN (when the UE is currently being served by the HPLMN);\n-\tNWDAF in the VPLMN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.5.3.4",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.2.3",
      "section_id": "5.4.2.3",
      "section_title": "Location Privacy Indication (LPI)",
      "content": "The Location Privacy Indication is not defined in TS 23.271 [4]. The Location Privacy Indication defines whether LCS requests for UE from any LCS clients are allowed or disallowed.\nThe LPI at least includes one of the following global settings (for all LCS clients and AFs):\n-\tLocation for UE is disallowed (location for UE not allowed to any LCS client except where POI applies).\n-\tLocation for UE is allowed (default setting, and LCS requests for UE from LCS clients are authorized based on their associated privacy classes as defined in clause 5.4.2.2).\nNOTE:\tAdditional LPI values may be supported for additional differentiation of location request types.\nThe LPI also allows the following optional settings:\n-\tValid time period for LPI, including start time and end time.\nThe LPI takes precedence on the subscribed privacy classes as defined in clause 5.4.2.2. The LPI allows a UE to override the location preference of the subscribed privacy classes. The usage of LPI is described in clause 6.1.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.2.2",
        "clause_6.1.2",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.3",
      "section_id": "5.4.3",
      "section_title": "Provision of UE LCS privacy profile",
      "content": "A generation or change to the LPI in UE LCS privacy profile is determined by the UE and provided to the network using N1 NAS message. It may be updated by UE any time.\nAn authorized AF is allowed to provision the LPI in UE LCS privacy profile for specific UE(s) via NEF.\nNOTE:\tThe AF allowed to provision the UE LCS privacy profile is different from the AF sending location requests.\nThe LPI in UE LCS privacy profile may be provided or updated by the target UE during the 5GC-MT-LR and Deferred 5GC-MT-LR Procedure for Periodic, Triggered and UE Available Location Events. The updated profile is stored into the UDR by the UDM after the interaction with the AMF. The LPI in UE LCS privacy profile shall include an indication if location is allowed or disallowed and may include a valid time period for LPI as described in clause 5.4.2.3.\nIn addition, a notification is sent by the UDM in order to notify the subscribed consumer i.e. GMLC and NEF about the change of UE LCS privacy profile:\n-\tTarget UE identity (one or both of GPSI and SUPI);\n-\tUpdated UE LCS privacy profile.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.4",
      "section_id": "5.4.4",
      "section_title": "Privacy Override Indicator (POI)",
      "content": "The POI is used to determine whether the UE LCS privacy profile of the subscriber to be positioned shall be overridden by the request for location services. The POI is applicable only to regulatory services. The assignment of a POI value with an \"override\" or \"not override\" value in the LCS client profile (see clause 7.2.1) is done during the LCS client provisioning (out of scope of this specification). The type of LCS client requesting location information (i.e. emergency, law-enforcement etc.) shall determine the value of the POI assigned to the LCS client profile.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.2.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.5",
      "section_id": "5.4.5",
      "section_title": "LCS service authorization for an Immediate UE Location",
      "content": "UDM provides the UE LCS privacy profile to NEF and GMLC, if the information is available.\nFor a 5GC_MT_LR request for immediate location, the GMLC in the HPLMN, or the HGMLC when the UE is roaming, determines whether the LCS client or NF is authorized to retrieve UE location, based on the UE privacy profile.\nNOTE 1:\tThe UE LCS privacy profiles are not sent to the VGMLC.\nAuthorization is determined by first verifying whether the location request is allowed according to the Location Privacy Indication (LPI) defined in clause 5.4.2.3. If the location request is not allowed, an error response is returned to the LCS client, AF, or NF. If the location request is allowed according to the LPI, authorization is next verified according to the Call/Session unrelated Class for an LCS Client or AF or according to the PLMN Operator Class for an NF.\nFor the Call/Session unrelated Class client types where POI does not apply, the HGMLC determines one of the following indications to be included in the location request forwarded to the serving AMF, or VGMLC in the case of roaming:\n-\tLocation allowed without notification;\n-\tLocation allowed with notification;\n-\tLocation with notification and privacy verification; location allowed if no response;\n-\tLocation with notification and privacy verification; location restricted if no response.\nFor PLMN Operator Class client types that are permitted to receive UE location information or where POI applies, a \"location allowed without notification\" is included.\nFor a Call/Session unrelated Class client type, which a geographic area restriction was included in the UE LCS privacy profile, the (H)GMLC performs an initial location by including a \"location allowed without notification\" indication in the location request sent to the VGMLC or AMF. The (H)GMLC then determines, based on the obtained location, whether location of the UE is allowed. If location of the UE is allowed subject to notification or verification, the (H)GMLC initiates a second location request to the VGMLC or serving AMF for the purpose of notification and/or verification only and includes one of the following indications in the second location request forwarded to the serving AMF, or VGMLC in the case of roaming:\n-\tNotification only\n-\tNotification and privacy verification only\nWhen \"Notification and privacy verification only\" is included, the serving AMF shall report the result of privacy verification back to the (H)GMLC (i.e. location allowed, location not allowed or timeout on a response) and the (H)GMLC shall determine whether or not to return the location received for the first request back to the LCS client based or AF on this result.\nFor a direct NEF query to a serving AMF, or for an NEF query via the UDM, if GMLC is not involved, the NEF determines whether the AF is authorized to retrieve UE location, based on the UE LCS privacy profile.\nNOTE 2:\tNotification and verification are not supported for a direct NEF query to a serving AMF, or for an NEF query via the UDM. Consequently, when notification or verification are required, or may be required based on a geographic area restriction, an NEF shall forward a location request to a GMLC or return an error indication to the requesting AF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.2.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.4.6",
      "section_id": "5.4.6",
      "section_title": "LCS service authorization for a Deferred UE Location",
      "content": "Support of UE LCS privacy for a deferred UE location is the same as that described in clause 5.4.5 for an immediate UE location with the differences and qualifications described in this clause.\nAn (H)GMLC or NEF shall subscribe to notification of a change in the UE LCS privacy profile from the UDM at the start of a deferred 5GC-MT-LR procedure and shall verify UE privacy both at the start of the deferred 5GC-MT-LR procedure and for each location result returned to an LCS client or AF based on the most recent UE LCS privacy profile received from the UDM.\nIf the UE LCS privacy profile indicates notification or verification of a location request is required for a particular value added LCS client, the (H)GMLC indicates this in the initial location request sent to the serving AMF and the serving AMF notifies the UE or verifies the location request with the UE, as for an immediate location request, when the UE first becomes reachable. The serving AMF also indicates the type of deferred location request in the NAS Location Notification Invoke Request sent to the UE. However, the location notification or verification is not repeated for each UE location in the case of a periodic or triggered 5GC-MT-LR.\nFor a value added LCS client, AF, value added LCS client group or LCS service type, for which a geographic area restriction was included, the (H)GMLC includes any request for notification or verification of the location request in the initial location request sent to the serving AMF. The (H)GMLC then determines whether a location result can be returned to the LCS client or AF based on whether the location result is or is not restricted by the geographic area restriction. If the location result is allowed by the geographic area restriction, the (H)GMLC does not perform a second location request to the serving AMF for the purpose of notification and/or verification only. If the location result is not allowed by the geographic area restriction, the (H)GMLC discards the location result without notifying the LCS client or AF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4.5"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.5",
      "section_id": "5.5",
      "section_title": "Location service exposure",
      "content": "Location service can be exposed to the authorized control plane NF or the LCS client to obtain the UE location to enable their application and services using the MT-LR procedure. For the location service exposed to the AF which is not allowed to directly interact with the GMLC or AMF, CAPIF API may be used between NEF and the AF as described in clause 6.2.5.1 of TS 23.501 [18].\nFor location service exposure, there are two types of location service requests as defined in clause 4.1a.4 and clause 4.1a.5:\n-\tLocation Immediate Request (LIR); and\n-\tLocation Deferred Request (LDR).\nThe following attributes may be included in the location service requests:\n-\tTarget UE identity;\n-\tLCS Client identity or AF ID;\n-\tService identity, if needed;\n-\tCodeword, if needed;\n-\tType of Event definition, i.e. UE available, change of area, motion or periodic location, applicable to deferred location requests only;\n-\tIndication of requiring reliable UE location information;\n-\tDefinitions for change of area type deferred location requests. Following parameters may be defined, if needed:\na)\tIndication for event trigger, i.e. UE enters, leaves or is within requested target area;\nb)\tIndication of either a single event report or multiple event reports;\nc)\tMinimum time interval between area event reports, if multiple event reports are requested;\nd)\tIndication of the requested location estimate; i.e. whether the location estimate of the target UE should be contained in the change of area event report;\ne)\tDuration of event reporting;\nf)\tMaximum time interval between reports;\ng)\tMaximum sampling time for event detection;\nh)\tIndication to have an additional check whether UE is located within the requested target area, and when this additional check is requested, the location estimate is mandatory;\n-\tDefinitions for motion type deferred location requests. Following parameters may be defined, if needed:\na)\tLinear distance threshold;\nb)\tIndication of either a single event report or multiple event reports;\nc)\tMinimum time interval between motion event reports, if multiple event reports are requested;\nd)\tIndication of the requested location estimate; i.e. whether the location estimate of the target UE should be contained in the motion event report;\ne)\tDuration of event reporting;\ne)\tMaximum time interval between reports;\nf)\tMaximum sampling time for event detection;\n-\tDefinitions for periodic location type deferred location requests. Following parameters may be defined, if needed:\na)\tTime interval between successive location reports;\nb)\tTotal number of reports;\n-\tStart time, stop time (i.e. specifying the validity time of LCS request), if needed for LCS Client e.g. using the OMA MLP protocol;\n-\tInterval, applicable to periodical requests only;\n-\tRequested LCS Quality of Service information, if needed, i.e. accuracy, response time and LCS QoS Class;\n-\tRequested type of location, i.e. \"current location\", \"current or last known location\" or \"initial location\" applicable to LIR only (current location is only available for LDR);\n-\tSupported GAD shapes, if needed;\n-\tVelocity of the UE, if needed;\n-\tPriority, if needed;\n-\tService coverage (i.e. E.164 country codes for geographic areas, ITU-T Recommendation E.164 [23]), if needed;\n-\tRequested maximum age of location, if needed;\n-\tLocal coordinate reference system, if needed for LCS Client e.g. using the OMA MLP protocol;\n-\tTarget area, i.e. geographical area expressed as one of the following format, if needed:\na)\ta shape defined in TS 23.032 [8];\nb)\tlocal coordinate system for LCS Client e.g. using the OMA MLP protocol;\nc)\tE.164 country code for a geographic area [23] for LCS Client e.g. using the OMA MLP protocol;\nd)\tPLMN identity for LCS Client e.g. using the OMA MLP protocol;\ne)\tgeopolitical name of the area (e.g. London) for LCS Client e.g. using the OMA MLP protocol;\n-\tResponse Method, if needed for LCS Client e.g. using the OMA MLP protocol;\n-\tScheduled Location Time.\n-\tDefinitions for periodic or triggered location reporting from a UE to an LCS Client or AF over user plane. Following parameters may be defined, if needed:\na)\tRequest for user plane reporting;\nb)\tUser plane address of the LCS Client or AF;\nc)\tSecurity information to enable a secure connection.\nThe following attributes may be included in the location service response:\n-\tLocation indication of UE in geographical coordinates and/or local coordinates expressed as a shape as defined in TS 23.032 [8] or for LCS Client e.g. using the OMA MLP protocol, local coordinate reference system;\n-\tVelocity of the UE as defined in TS 23.032 [8], if requested and if available;\n-\tThe information about the positioning method used to obtain the location estimate of the UE, if it is available at the LCS server and if needed;\n-\tTime stamp of location estimate;\n-\tIndication when UE enters, is within or leaves the Geographical area, if needed;\n-\tAcknowledgement for a deferred location request, if needed.\n-\tRequest id, if needed.\n-\tIndication that the requested QoS was not met, if needed, only applicable if the request was for best effort class\n-\tIndication of a periodic event.\n-\tIndication of a motion event.\n-\tIndication that a deferred location request has been activated in a UE.\n-\tIndication of expiration of the maximum reporting interval for the area event or motion event for LCS Client e.g. using the OMA MLP protocol.\n-\tIndication of a cumulative event for user plane location reporting from a UE to an LCS Client or AF.\nIn addition, the information attributes of the location service request may be used also in the location service response.\nFor a LCS client in the core network, the LCS service request is sent to GMLC using Le interface.\nFor an AF not allowed to directly interact with the GMLC or AMF, the LCS service request is sent to NEF using the service based interface.\nFor an internal control plane NF, the LCS service request is sent to AMF or GMLC using the service based interface.\nNOTE:\tFor regulatory services, any control plane NF can be LCS client.\nTo support location service exposure through NEF, when NEF receives a LCS service request, it determines based on the location accuracy of the QoS requirement, e.g. lower or higher than cell-ID level, on whether to invoke the GMLC service or the AMF service for the LCS service request.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_6.2.5.1",
        "clause_4.1",
        "ts_23.501",
        "ts_23.032"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.6",
      "section_id": "5.6",
      "section_title": "LCS Charging",
      "content": "Charging Information for LCS service is collected at GMLC and AMF. For roaming case, the Charging Information shall be collected in both home PLMN and visited PLMN for inter-operator charging purpose.\nCharging mechanism for LCS service and the Charging Information collected at GMLC and at AMF are defined in TS 32.271 [30] and TS 32.298 [31].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_32.271",
        "ts_32.298"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.7.1",
      "section_id": "5.7.1",
      "section_title": "General",
      "content": "Concurrent Location Requests occur when any entity (e.g. UE, AMF, LMF, GMLC, NEF):\n-\tCase A: receives/initiates multiple LCS requests (e.g. 5GC-MT LR, 5GC-MO LR, 5GC-NI LR) for the location estimate of the same target UE within a time period; or\n-\tCase B: receives/initiates one or more new LCS request(s) (e.g. 5GC-MT LR, 5GC-MO LR, 5GC-NI LR) for the location estimate of the same target UE during the location session to support the old LCS request(s).\nIn either case, if allowed by the QoS requirements and privacy settings, the entity may combine the concurrent location requests by fully executing one of the requests and using the ensuing location estimate result(s) to satisfy the other request(s) without fully executing the latter. When concurrent location requests are supported, each entity needs to ensure it correlates each location/position response with the associated request and different concurrent location requests shall be treated separately without any dependency on one another by any entity.\nNOTE 1:\tCombining of location requests is not allowed for a deferred 5GC-MT-LR for periodic or triggered location for privacy reasons (e.g. a target UE would not be aware that location event reports were being sent to multiple AFs and/or external LCS clients).\nNOTE 2:\tAn entity (e.g. AMF, GMLC, NEF) may cache location information obtained for one location request and use this information to support later location requests for \"current or last known location\". This is not considered to be a case of concurrent location requests.\nIf the entity, either itself or in association with another entity, cannot support concurrent location requests or it can only support up to a certain number of concurrent location requests, it can reject or defer a new concurrent request or cancel one or more existing requests. For Case B, it can also allow the new location request to proceed concurrently with and separately from the previous requests.\nLCS Client/AF priority and any other relevant priority information (e.g. UE subscription preferences) should be considered when rejecting or deferring a concurrent request or when cancelling one or more existing requests. In particular, location requests associated with emergency services or lawful interception clients should be given priority over other location requests.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.7.2",
      "section_id": "5.7.2",
      "section_title": "Combining location requests by an H-GMLC or NEF",
      "content": "An H-GMLC or NEF may combine concurrent location requests (e.g. 5GC-MT LR, 5GC-MO LR, 5GC-NI LR) for the same target UE by executing only one request and using the ensuing location estimate result(s) to satisfy the other request(s). The conditions for this are as follows:\n-\tthe H-GMLC must be able to fully resolve privacy requirements for the other location request(s) without requiring notification or verification by the UE (though notification only as in steps 17-23 of clause 6.1.2 could still be used in the case of location dependent privacy); and\n-\tthe QoS for the other request(s) should be less strict than the QoS for the executed location request.\nAn H-GMLC may also combine concurrent location requests in the case of a bulk location request for a group of UEs as described in clause 6.8. In this case, location information for any UE in the group may be obtained from location information obtained from another concurrent location request for the same UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2",
        "clause_6.8"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.7.3",
      "section_id": "5.7.3",
      "section_title": "Combining location requests by a V-GMLC",
      "content": "A V GMLC may combine concurrent 5GC-MT LR and 5GC-MO-LR related location requests for the same target UE provided it is clear and unambiguous for any 5GC-MT LR that will not be fully executed (e.g. from the contents of any location request received from the H GMLC) that no outstanding privacy related actions are required for the UE (e.g. no privacy notification and/or privacy verification interaction with the UE). QoS requirements must also be satisfied for the non-executed location requests.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.7.4",
      "section_id": "5.7.4",
      "section_title": "Combining location requests by an AMF",
      "content": "An AMF may combine concurrent 5GC-MT LR, 5GC-MO LR and 5GC-NI LR location requests once any needed privacy related actions (e.g. UE notification and verification) have been performed for each 5GC-MT LR. (i.e. AMF may decide to not execute multiple positioning procedures for the concurrent location requests) QoS requirements must also be satisfied for the non-executed location requests.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.7.5",
      "section_id": "5.7.5",
      "section_title": "Combining location requests by an LMF",
      "content": "An LMF may combine concurrent location requests for the same target UE provided QoS requirements can be satisfied for the non-executed location requests.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.7.6",
      "section_id": "5.7.6",
      "section_title": "Combining location requests by a UE",
      "content": "A UE may combine concurrent location requests provided QoS requirements can be satisfied and provided any positioning procedures with an LMF remain supported according to the positioning protocol.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.8",
      "section_id": "5.8",
      "section_title": "Interworking with the IMS",
      "content": "When the location service request is initiated by the LCS Client / AF for the location estimation of a target UE in an IMS session, a SIP-URI or a TEL-URL maybe included in the request to identify the target UE. In that case, the H-GMLC of the UE shall be able to convert the SIP-URI/TEL-URL into SUPI of the target UE.\nNOTE 1:\tThe H-GMLC may query IMS-HSS or UDM to retrieve the SUPI of the target UE based on its SIP-URI/TEL-URL.\nNOTE 2:\tIf multiple SUPIs are resolved for the SIP-URI/TEL-URL, the H-GMLC behaviour is out of scope of this specification.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.9.1",
      "section_id": "5.9.1",
      "section_title": "General",
      "content": "A MBSR (i.e. mobile IAB-node) may have location service capability as specified in TS 38.305 [9] and participate in the location service of a UE. As the MBSR may be moving, the location service procedures need to be enhanced as following for an accurate estimation of the UE positioning:\n-\tThe UE reports the cell IDs of all the cells the UE performed DL positioning measurements on.\n-\tThe MBSR which performed the location service procedures for the UE includes it's cell ID in the reported UL positioning measurement.\n-\tThe AMF serving the UE provides the cell ID of serving cell of the UE and indicates, if possible, that the cell-ID belongs to a MBSR to the LMF in the location request. The AMF serving the UE also provides LMF with the additional ULI Information received from NG-RAN, so that the LMF can initiate the positioning procedure to obtain the location information of the MBSR.\n-\tAdditionally, the LMF uses the reported cell IDs to derive whether the cell ID(s) corresponds to a MBSR. There can be multiple MBSR cells in the measurement report.\n-\tThe LMF may also decide whether the cell ID(s) corresponds to MBSR(s) based on information received in a TRP information exchange i.e. that the cell-ID belongs to a MBSR and the UE-ID (GPSI) associated with MBSR.\n-\tTo aid the LMF to improve the accuracy of the UE location estimation, the MBSR velocity information and time of obtaining its location measurement data should be obtained by the LMF when available. The LMF uses the received location and velocity of the MBSR(s) when estimating the location of the Target UE.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_38.305"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.9.2",
      "section_id": "5.9.2",
      "section_title": "Obtaining location information for the MBSR",
      "content": "There are multiple options for an LMF to obtain the location information and velocity of the MBSR(s):\n-\tThe LMF can derive the location and velocity of the MBSR by triggering the gNB serving the MBSR using NRPPa or by requesting the GMLC to derive the location of the MBSR (UE) using the UE-ID of the MBSR. The GMLC triggers MT-LR procedure as specified in clause 6.11.1 or 6.11.2.\n-\tAs the timing of the location estimations for the Target UE and MBSR(s) is important for the quality of the location estimation of the Target UE, the LMF needs to reduce the timing offset of the positioning measurements, i.e. the positioning of the Target UE and MBSR can be scheduled with using the same scheduled location time and compensate for the potential time difference of the positioning measurements, e.g. taking velocity of MBSR into account.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.11.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.9.3",
      "section_id": "5.9.3",
      "section_title": "Privacy check for MBSR",
      "content": "If the positioning of the MBSR is performed for the location estimation of a Target UE (UE different from the MBSR), the privacy check in clause 5.4 is skipped for the MBSR. When the LMF requests the GMLC to derive the location of the MBSR (UE), the LMF includes a MBSR indication indicating the location of MBSR is requested to determine the location of a Target UE in the location request. The GMLC obtains the subscription information of the MBSR (UE) from the UDM. Based on the indication, and/or MBSR's subscription information, the GMLC skips the privacy check.\nIf the positioning of the MBSR is performed for the location estimation of the MBSR itself when it acts as a normal UE which is not authorized to operate as MBSR based on the subscription information, the UE privacy check procedure in clause 5.4 is performed.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.4"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.10",
      "section_id": "5.10",
      "section_title": "Support of Positioning over user plane connection between UE and LMF for non-regulatory service",
      "content": "LMF and UE may utilize a user plane connection to transfer supplementary services messages and LPP messages. User Plane protocol (LCS-UPP) to support supplementary services messages and LPP messages transport between the UE and the LMF is defined in TS 24.572 [48].\nIf LMF decides to use user plane the LMF should indicate the UE to use user plane for positioning with the information to establish a secure connection, and via this secure connection, position messages can be transferred between UE and the LMF. The URSP defined in TS 23.503 [41] is used by UE to determine how to route the position messages. The operator may provide LMF(s) address information and connection capability for LCS use in traffic descriptors and LCS user plane positioning dedicated PDU session parameters (e.g., DNN and S-NSSAI) in Route Selection Descriptors to the UE as part of the URSP rule. The position messages can be routed to an established PDU Session or can trigger the establishment of a new PDU Session. The LMF and UE may maintain the established user plane connection and the established user plane connection may be reused for subsequent user plane position messages transmission trigged by UE or LMF. If the LMF detects the user plane connection is not used for an implementation specific time, the LMF terminates the user plane connection. The supplementary services messages transferred over user plane only support event report messages, periodic triggered invoke messages and MS cancel deferred location messages.\nNOTE 1:\tIn this Release, the user plane connection between UE and LMF can not be used for regulatory positioning service.\nNOTE 2:\tFor one positioning procedure, the LMF selects either control plane or user plane to transfer the associated supplementary services messages and LPP messages. During the positioning procedure, the LMF and UE should avoid switching between control plane and user plane to transfer the messages above.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.572",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.11",
      "section_id": "5.11",
      "section_title": "Collection of GNSS assistance data",
      "content": "LMF may collect GNSS assistance data by reusing Data Collection from AF as described in clause 5.20a of TS 23.501 [18] and Naf_EventExposure service described in clause 5.2.19.2 of TS 23.502 [19]. The collection may be performed on a periodic basis.\nLMF generates a mapping table of GNSS assistant data and applicable area (e.g. TA lists). LMF may generate multiple sets of GNSS assistance data for the same location area, and each of them corresponds to a certain location accuracy. The accuracy of GNSS assistance data may vary for different areas.\nNOTE 1:\tThe multiple accuracy level of GNSS assistance data can be the reason the collection method, and /or calculation method.\nAfter the collection, LMF may send the collected GNSS assistance data to UEs via the procedures described in clause 6.14.1 (Broadcast of Assistance Data by an LMF) or clause 6.11.1 (UE Assisted and UE Based Positioning Procedure) during a positioning session.\nIn the case of using Broadcast of Assistance Data by an LMF, the LMF may provision one or more of GNSS assistance data to RAN. LMF may also provision one or more cyphered key(s) to UE from the AMF, and each cyphered key corresponds to a certain GNSS assistance data.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.20",
        "ts_23.502_clause_5.2.19.2",
        "clause_6.14.1",
        "clause_6.11.1",
        "ts_23.501",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.12",
      "section_id": "5.12",
      "section_title": "UE Unaware Positioning",
      "content": "UE Unaware Positioning applies to the regulatory location service. When UE Unaware Positioning is required by LCS Client/AF, if the UE is in CM_IDLE or RRC_INACTIVE state, the UE cannot be paged during the positioning procedure. In this case, the 5GC provides the latest stored UE location information to the LCS Client/AF if the requested LCS QoS can be achieved. If the UE is in CM_CONNECTED state, the LMF selects Uplink Positioning method to obtain UE location.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.13",
      "section_id": "5.13",
      "section_title": "Support of location service in PNI-NPN with signalling optimisation",
      "content": "Support of location service in PNI-NPN is based on the PNI-NPN description defined in clause 5.30.3 of TS 23.501 [18]. PNI-NPN architecture described in Annex C are supported.\nUnder the PNI-NPN architecture described in Annex C, the relevant Network Functions in local network are defined as follows:\n-\tLocal AMF, an AMF type function deployed in the local network, it supports:\n-\tFunctionalities related to AMF service operation \"NonUeN2MessageTransfer\" within Namf_Communication service, defined in TS 29.518 [16].\n-\tHandling \"UL and DL NON UE ASSOCIATED NRPPA TRANSPORT\", defined in TS 38.413 [38].\nNOTE 1:\tLocal AMF can support other functionalities defined in TS 23.501 [18].\nNOTE 2:\tIt is assumed only one local AMF is deployed in the local network.\n-\tLMF, deployed in the local network, it supports:\n-\tPre-configured with local AMF FQDN or communication address.\n-\tFor DL UE associated NRPPa signalling, sends the signaling message to the serving AMF.\n-\tFor DL NON UE associated NRPPa signalling, sends the signaling message to the local AMF.\n-\tNG-RAN, deployed in the local network, it supports:\n-\tPre-configured with local AMF FQDN or communication address.\n-\tEstablishes TNL association with local AMF.\n-\tFor UL UE associated NRPPa signalling, sends the signalling message to the serving AMF\n-\tFor UL NON UE associated NRPPa signalling, sends the signalling message to the local AMF\n-\tGMLC, deployed in the local network.\n-\tUDM, deployed in public network, it supports:\n-\tPre-configured with UE's allowed local network list.\n-\tFor GMLC request from a different network domain, verify GMLC request by checking whether the local network of GMLC is on the pre-configured UE's allowed local network list. For Nudm_SDM_Get request or Nudm_UECM_Get request from local network, sends the UE data (i.e. privacy setting of UE, current serving AMF address, SUPI) after successful verification.\nWhen UE access the NG-RAN in the local network, during the registration procedure or service request procedure, NG-RAN selects the serving AMF in the public network. With appropriate configuration, local AMF cannot be selected as the serving AMF for the UE.\nDuring the positioning procedure, if LMF determines network assisted positioning method, the positioning procedure defined in clause 6.11.2 is used and the AMF is the serving AMF. If the LMF determines to obtain Non-UE Associated Network Assistance Data, the positioning procedure defined in clause 6.11.3 is used and the AMF is the local AMF.\nFor MO-LR, immediate MT-LR and deferred MT-LR, the AMF provides the GMLC contact address and a reference number to LMF. When LMF determines UE location, LMF provides the UE location to GMLC directly, as defined in clause 6.3.1.\nNOTE 3:\tLMF should not determine to use E-CID positioning method for location service in PNI-NPN.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.501_clause_5.30.3",
        "clause_6.11.2",
        "clause_6.11.3",
        "clause_6.3.1",
        "ts_23.501",
        "ts_29.518",
        "ts_38.413"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.14",
      "section_id": "5.14",
      "section_title": "Event Report Allowed Area",
      "content": "During the deferred 5GC-MT-LR procedure, when the UE detects the triggered or periodic event happens, if it is inside the event report allowed area, the UE is allowed to generate and send the event report to network to reduce UE power consumption.\nThe event report allowed area is a list of cell(s) or TA(s) determined by GMLC based on the event report expected area provided by UE which is a geographical area and is sent to the UE during the deferred 5GC-MT-LR procedure.\nThe event report allowed area applies to the Area, Periodic Location and Motion event types. When the UE decides to send an event report (i.e. the event is detected or the maximum reporting time is expired), if the UE is inside the event report allowed area, the UE sends the event report. If the event report is not received from the UE for an implementation dependent time period, the AF or LCS Client or GMLC cancels the deferred 5GC-MT-LR procedure for periodic, or triggered location events.\nNOTE:\tThe UE can only send event report when the UE is inside of event report allowed area.\nThe event report allowed area can also be used differently if an area usage indication is provided together with the event report expected area by the UE. A reporting indication that is determined by GMLC based on the area usage indication means when the UE detects the triggered or periodic event happens, if it is outside the event report allowed area, the UE is allowed to generate and send the event report to network to reduce UE power consumption.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_5.15",
      "section_id": "5.15",
      "section_title": "Support of Low Power and High Accuracy Positioning",
      "content": "Service requirements for low power and high accuracy positioning (LPHAP) is defined in TS 22.261 [3] and TS 22.104 [39]. Support of low power and high accuracy positioning is optional in this release of specification.\nLow power and high accuracy positioning is supported via subscription and in the LCS related subscriber data in the UDM, an LPHAP indication may be included.\nDuring the positioning procedure, AMF provides the LPHAP indication to the LMF. The LPHAP indication is either obtained from the GMLC, or stored in the UE LCS context received during UE registration procedure.\nIf LMF receives from AMF of the LPHAP indication in the location request, LMF determines appropriate positioning method, e.g. network-based positioning method, or may determine to trigger the low power periodic and triggered 5GC-MT-LR procedures in clause 6.7 by taking into account the LPHAP indication. In addition, LMF may also send LPHAP Assistance Information defined in TS 38.455 [15] to RAN in the positioning procedure, as defined in clause 6.11.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7",
        "clause_6.11.2",
        "ts_22.261",
        "ts_22.104",
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.16",
      "section_id": "5.16",
      "section_title": "Location services assisted by NWDAF",
      "content": "LMF and AMF may utilize analytics from NWDAF to assist with location services as described in clause 6.21.\nNWDAF may provide Location Accuracy analytics as specified in clause 6.17 of TS 23.288 [37] to LMF. When LMF receives analytics for Location Accuracy from the NWDAF, it may use the analytics to determine indoor or outdoor for a location estimate, to select or adjust appropriate positioning methods for the requested location accuracy.\nNWDAF may provide UE related mobility analytics as specified in clause 6.7 of TS 23.288 [37] to AMF. The UE location information received in analytics can be used by AMF to perform the UE location verification for NR satellite access.\n5.16A\tNetwork data analytics assisted by LCS\nNWDAF may interact with the LCS system to request location information for a target UE or a group of UEs via Ngmlc services or NL9.\nNWDAF may request an aggregated report for a single UE from GMLC to include multiple UE location estimates for a period of time. NWDAF may also provide a reporting time to indicate the latest time for reporting.\nNOTE:\tThe value of the reporting time is left for NWDAF implementation. The reporting time should be earlier than the parameter 'time when analytics information is needed' (if applicable) defined in TS 23.288 [37].\n5.16B\tLCS Continuity During UE Mobility\nLCS session continuity during UE mobility applies to:\n-\tdeferred triggered/periodic MT-LR, immediate MT-LR and MO-LR procedures.\n-\tuplink, downlink or uplink and downlink positioning methods.\n5.16B.1\tMobility Between 5GS and EPS\nLCS continuity of UE in RRC-CONNECTED state enables transfer of a location session between 5GS and EPS. The LCS QoS may then be mapped from the source RAT to the target RAT.\nThe Lr' interface between the EPC-GMLC and 5GC-GMLC is implementation specific - or the EPC-GMLC and 5GC-GMLC may be co-located.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.21",
        "ts_23.288_clause_6.17",
        "ts_23.288_clause_6.7",
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.273_5.17",
      "section_id": "5.17",
      "section_title": "Support of Ranging and Sidelink Positioning",
      "content": "Ranging and Sidelink Positioning as defined in TS 23.586 [40] is supported. The following procedures have been specified to support the Network Assisted Sidelink Positioning:\n-\tSL-MO-LR involving LMF as defined in clause 6.20.1;\n-\tSL-MT-LR involving LMF as defined in clause 6.20.3;\n-\t5GC-MO-LR Procedure using SL positioning as defined in clause 6.20.2;\n-\t5GC-MT-LR Procedure using SL positioning as defined in clause 6.20.5;\n-\tSL-MT-LR for periodic, triggered Location Events as defined in clause 6.20.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.20.1",
        "clause_6.20.3",
        "clause_6.20.2",
        "clause_6.20.5",
        "clause_6.20.4",
        "ts_23.586"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.1.1",
      "section_id": "6.1.1",
      "section_title": "5GC-MT-LR procedure for the regulatory location service",
      "content": "Figure 6.1.1-1 illustrates the general network positioning for the LCS clients external to the PLMN for the regulatory location service for non-roaming scenario. In this scenario, it is assumed that the target UE is identified using an SUPI or GPSI.\nThis procedure is applicable to a request from an LCS client for a current location of the target UE, and it is assumed that the LCS client is authorised to use the location service and no privacy verification is required.\nFigure 6.1.1-1: 5GC-MT-LR procedure for the regulatory location service\n1.\tThe external location services client sends a request to the GMLC for a location for the target UE identified by an GPSI or an SUPI. The request may include the required QoS, UE unaware indication and Supported GAD shapes. If location is required for more than one UE, the steps following below may be repeated and in that case the GMLC shall verify whether the number of Target UEs in the LCS request is equal to or less than the Maximum Target UE Number of the LCS client. If Maximum Target UE Number is exceeded, the GMLC shall reject the LCS request, the step 2-10 are skipped, and then GMLC respond to the client with proper error cause in the step 11.\n2.\tThe GMLC invokes a Nudm_UECM_Get service operation towards the home UDM of the target UE to be located with the GPSI or SUPI of this UE.\n3.\tThe UDM returns the network addresses of the current serving AMF.\nNOTE:\tFor backward compatibility, the GMLC can use a Nudm_SDM_Get service operation to retrieve the SUPI of the target UE from a Rel-15 UDM as defined in clause 5.2.3.3.2 of TS 23.502 [19].\n4.\tThe GMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF to request the current location of the UE. The service operation includes the SUPI, and client type and may include the required QoS, UE unaware indication and Supported GAD shapes.\n5.\tIf the UE is in CM IDLE state and UE unaware indication is not included, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\nIf UE unaware indication is received by AMF, and the UE is in CM_IDLE state or in RRC_INACTIVE state (if known by AMF by requesting the NG-RAN to report RRC state information), the steps 6 - 9 are skipped.\n6.\tThe AMF selects an LMF based on the available information as defined in clause 5.1 or based on AMF local configuration. The LMF selection takes the 5G-AN currently serving the UE into account. The selection may use a NRF query.\n7.\tThe AMF invokes the Nlmf_Location_DetermineLocation service operation towards the LMF to request the current location of the UE. The service operation includes a LCS Correlation identifier, the serving cell identity of the Primary Cell in the Master RAN node and the Primary Cell in the Secondary RAN node when available based on Dual Connectivity scenarios, and the client type and may include an indication if UE supports LPP, the required QoS, UE Positioning Capability if available, UE unaware indication and Supported GAD shapes. If any of the procedures in clause 6.11.1 or clause 6.11.2 are used the service operation includes the AMF identity.\n8.\tThe LMF performs one or more of the positioning procedures described in clauses 6.11.1, 6.11.2 and 6.11.3. During this step the LMF may use the Namf_Communication_N1N2MessageTransfer service operation to request the transfer of a Positioning related N1 message to the UE or the transfer of a Network Positioning message to the serving NG-RAN node (gNB or NG-eNB) for the UE. The LMF shall determine a geographical location and optionally a location in local coordinates.\nIf UE unaware indication is received from AMF in step 7, the LMF selects Uplink Positioning method to obtain UE location and performs the positioning procedure described in clause 6.11.2.\n9.\tThe LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the current location of the UE and UE Positioning Capability if the UE Positioning Capability is received in step 8 including an indication that the capabilities are non-variable and not received from AMF in step 7. The service operation includes the LCS Correlation identifier, the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate.\nIf UE unaware indication is received from AMF in step 7 and the NG-RAN rejects the Network Positioning message as described in clause 6.11.2 with appropriate rejection cause (e.g. UE cannot be paged) in step 8, the LMF rejects the Nlmf_Location_DetermineLocation Request with appropriate rejection cause (e.g. UE cannot be paged).\n10.\tThe AMF returns the Namf_Location_ProvidePositioningInfo Response towards the GMLC/LRF to return the current location of the UE. The service operation includes the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate. The AMF stores the UE Positioning Capability in UE context when received from LMF.\nIf the AMF decides to skip steps 5 - 9 in step 5 based on the UE unaware indication and the UE state or the LMF rejects the Nlmf_Location_DetermineLocation Request with appropriate rejection cause (e.g. UE cannot be paged), the AMF may convert any last known location in the form of a cell ID or TAI into geographical information based on TS 23.032 [8] and as defined in clause 6.2.6.2.5 of TS 29.518 [16] and clauses 5.4.4.7, 5.4.4.8 and 5.4.4.9 of TS 29.571 [33] and answer to the GMLC with the geographical information together with the age of this location.\n11.\tThe GMLC sends the location service response to the external location services client.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_5.2.3.3.2",
        "ts_23.502_clause_4.2.3.3",
        "clause_5.1",
        "clause_6.11.1",
        "clause_6.11.2",
        "ts_23.032_clause_6.2.6.2.5",
        "figure_6.1.1-1",
        "ts_29.518_clause_6.2.6.2.5",
        "ts_23.502",
        "ts_23.032",
        "ts_29.518",
        "ts_29.571"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.1.2",
      "section_id": "6.1.2",
      "section_title": "5GC-MT-LR Procedure for the commercial location service",
      "content": "Figure 6.1.2-1 illustrates the general network positioning requested by the LCS clients, the AF or the NF (e.g. NWDAF). In this scenario, it is assumed that the target UE may be identified using an SUPI or GPSI. This procedure is applicable to a request from an LCS client, an NF or an AF for a current location of the target UE, and it is assumed that\n-\tPrivacy verification may be required for the location service request;\n-\tThe LCS client, or the AF or NF needs to be authorised to use the location service.\nFigure 6.1.2-1: 5GC-MT-LR Procedure for the commercial location services\n1.\tThe LCS Client, the NF or the AF (via NEF) sends a request to the (H)GMLC for a location and optionally a velocity for the target UE which may be identified by an GPSI or an SUPI. The request may include the required QoS, supported GAD shapes and other attributes. (H)GMLC (for 1a, 1c) or NEF (for 1b) authorizes the LCS Client, the NF or the AF for the usage of the LCS service. If the authorization fails, step 2-23 are skipped and (H)GMLC (for 1a, 1c) or NEF (for 1b) responds to the LCS Client, the NF or the AF the failure of the service authorization in step 24. In some cases, the (H)GMLC derives the GPSI or SUPI of the target UE and possibly the QoS from either subscription data or other data supplied by the LCS Client, the NF or the AF.\nThe LCS request may carry also the Service Identity (see TS 22.071 [2]) and the Codeword and the service coverage information. The (H)GMLC may verify that the Service Identity received in the LCS request matches one of the service identities allowed for the LCS client or AF. If the service identity does not match one of the service identities for the LCS client or AF, the (H)GMLC shall reject the LCS request. Otherwise, the (H)GMLC can map the received service identity in a corresponding service type.\nThe LCS service request may include a scheduled location time if a current location of the UE is required at a specific time in the future.\nThe LCS service request may include integrity requirements including Time-to-Alert (TTA), Target Integrity Risk (TIR) and Alert Limit(AL). Definitions of these parameters are specified in TS 38.305 [9].\nNOTE 1:\tIn this release of specification, integrity requirements are for GNSS integrity and RAT-dependent integrity. The applicable positioning methods for RAT-dependent integrity are specified in TS 38.305 [9].\nIf the LCS service request contains the pseudonym of the target UE and the (H)GMLC cannot resolve the PMD address from the pseudonym, the (H)GMLC itself determines the verinym (GPSI or SUPI) of the target UE. If the (H)GMLC can resolve the address of PMD from the pseudonym, the HGMLC requests the verinym from its associated PMD. If (H)GMLC is not able to obtain the verinym of the target UE, the (H)GMLC shall cancel the location request.\nIf a scheduled location time is not included and the requested type of location is \"current or last known location\" and the requested maximum age of location information is available, the (H)GMLC verifies whether it stores the previously obtained location estimate of the target UE. If the HGMLC stores the location estimate and timestamp of the location estimate (if available) and the location estimate satisfies the requested accuracy and the requested maximum age of location, the (H)GMLC checks the result of the privacy check at step 2. If the result of the privacy check for call/session unrelated class is \"Location allowed without notification\" then steps 3-23 may be skipped.\n1b-1\tAF sends the Nnef_EventExposure_Subscribe to the NEF.\n1b-2\tThe NEF identifies based on the QoS attribute received from the location request that higher than cell-ID level location accuracy is required and invokes the Ngmlc_Location_ProvideLocation_Request service operation to the (H)GMLC, which contains the attributes received from the AF request. The NEF may also invoke the Ngmlc_Location_ProvideLocation_Request service operation to the (H)GMLC for lower than cell-ID location accuracy as an implementation option or if a scheduled location time is included.\n1c.\tThe NF (e.g. NWDAF) invokes the Ngmlc_Location_ProvideLocation service operation to the (H)GMLC.\nIf location is required for more than one UE, the steps following below may be repeated and in that case the NEF or HGMLC receiving location request, shall verify whether the number of Target UEs in the Nnef_EventExposure_Subscribe, Ngmlc_Location_ProvideLocation or LCS request is equal to or less than the Maximum Target UE Number of the LCS client. If Maximum Target UE Number is exceeded, the NEF or HGMLC shall reject the Nnef_EventExposure_Subscribe, Ngmlc_Location_ProviceLocation or LCS request, the steps 2-23 are skipped, and then GMLC respond to the client with proper error cause in the step 24.\nNOTE 2:\tIf cell-ID level or lower than cell-ID level location accuracy is required in the location request, the NEF may invoke an Namf_EventExposure_Subscribe service operation to subscribe location event reporting from the AMF for the target UE as further described in clause 6.5.\n2.\tThe (H)GMLC invokes a Nudm_SDM_Get service operation towards the UDM of the target UE to get the privacy settings of the UE identified by its GPSI or SUPI. The UDM returns the target UE Privacy setting of the UE. The (H)GMLC checks the UE LCS privacy profile. If the target UE is not allowed to be located, steps 3-23 are skipped. The UDM may also reply (H)GMLC with an LPHAP indication, if stored in the UE LCS subscriber data.\n3.\tThe (H)GMLC invokes a Nudm_UECM_Get service operation towards the UDM of the target UE with GPSI or SUPI of this UE. The UDM returns the network addresses of the current serving AMF and additionally the address of a VGMLC (for roaming case). If the location request is an immediate location request, the (H)GMLC checks the country codes of the serving node addresses. If the (H)GMLC finds the current AMF is out of the service coverage of the (H)GMLC, the (H)GMLC returns an appropriate error message to the LCS client, the NF or the AF (via NEF).\nGMLC may determine the LMF ID based on the LCS data for an LCS Client/AF. In case a group ID is provided or derived from the location request, GMLC determines the LMF ID based on the provisioned Group ID.\nGMLC may be configured with an LMF ID, irrelevant to any LCS client/AF. When the GMLC receives a MT location request from LCS client/AF, GMLC determines the LMF ID for all LCS client/AF.\nNOTE 3:\tThe UDM is aware of the serving AMF address at UE registration on an AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19]. The UDM is aware of a serving VGMLC address at UE registration on an AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19].\nNOTE 4:\tThe HGMLC can also query the HSS of the target UE for a serving MME address as described in clause 9.1.1 of TS 23.271 [4]. The EPC-MT-LR procedure described in clause 9.1.15 of TS 23.271 [4], excluding the UE availability event, may then be performed instead of steps 4-23, e.g. if the HSS returns an MME address but the UDM does not return an AMF address.\n4.\tFor a non-roaming case, this step is skipped. In the case of roaming, the HGMLC may receive an address of a VGMLC (together with the network address of the current serving AMF) from the UDM in step 3, otherwise, the HGMLC may use the NRF service in the HPLMN to select an available VGMLC in the VPLMN, based on the VPLMN identification contained in the AMF address received in step 3. The HGMLC then sends the location request to the VGMLC by invoking the Ngmlc_Location_ProvideLocation service operation towards the VGMLC. In the cases when the HGMLC did not receive the address of the VGMLC, or when the VGMLC address is the same as the HGMLC address, or when both PLMN operators agree, the HGMLC sends the location service request message to the serving AMF. In this case, step 4 is skipped. If the result of privacy check indicates that the verification based on current location is needed, the HGMLC shall send a location request to the VGMLC (in the case of roaming) or to the AMF (in the case of non-roaming) indicating \"positioning allowed without notification\" and VGMLC shall invoke an Namf_Location_ProvidePositioningInfo Request service operation towards the AMF at step 5. H-GMLC also provides the LCS client type of AF, if received in step 41b‑2, or LCS client type of LCS client and other attributes to be sent to AMF in step 5.\n5.\tIn the case of roaming, the VGMLC first authorizes that the location request is allowed from this HGMLC, PLMN or from this country. If not, an error response is returned. The (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF to request the current location of the UE. The service operation includes the SUPI, the client type and may include the required LCS QoS, supported GAD shapes, scheduled location time, service type and other attributes as received or determined in step 1. If received in step 2, the (H)GMLC or VGMLC provides the LPHAP indication to the AMF.\nTo support location service in PNI-NPN with signalling optimisation, the H-GMLC also includes a contact address (Notification Target Address, e.g. a URI) and a Notification Correlation ID, which is used by LMF to provide location determination to H-GMLC directly.\nNOTE 5:\tThe location request forwarded at step 4 and step 5 may also carry the result of the privacy check in step 2 which may include a codeword provided by the LCS Client or AF and an indication of a privacy related action as described in clause 5.4.\n6.\tIf the UE is in CM IDLE state, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\nIf signalling connection establishment fails, step 7-13 are skipped and the AMF answers to the GMLC in step 14 with the last known location of the UE (i.e. Cell ID) together with the age of this location.\n7.\tIf the indicator of privacy check related action indicates that the UE must either be notified or notified with privacy verification and if the UE supports LCS notification (according to the UE capability information), a notification invoke message is sent to the target UE, indicating the identity of the LCS client and the , service type (if that is both supported and available) and whether privacy verification is required.\n8.\tThe target UE notifies the UE user of the location request and, if privacy verification was requested, waits for the user to grant or withhold permission. The UE then returns a notification result to the AMF indicating, if privacy verification was requested, whether permission is granted or denied for the current LCS request. If the UE user does not respond after a predetermined time period, the AMF shall infer a \"no response\" condition. The AMF shall return an error response in step 14 and if roaming VGMLC in step 15 to the HGMLC if privacy verification was requested and either the UE user denies permission or there is no response with the indication received from the (H)GMLC indicating barring of the location request and steps 10~13 are skipped.\nThe notification result may also indicate the Location Privacy Indication setting for subsequent LCS requests; i.e whether subsequent LCS requests, if generated, will be allowed or disallowed by the UE. The Location Privacy Indication may also indicate a time for disallowing the subsequent LCS requests.\n9.\tThe AMF invokes the Nudm_ParameterProvision_Update (LCS privacy) service operation to store in the UDM the Location Privacy Indication information received from the UE. The UDM may then store the updated UE privacy setting information into the UDR as the \"LCS privacy\" Data Subset of the Subscription Data.\n10-13.\tStep 10-13 are the same as steps 6-9 defined in clause 6.1.1 with the addition that LMF can also perform 6.11.4 as positioning procedure and service type may be indicated towards the LMF and the exception that the LMF may determine the UE location in local coordinates or geographical co-ordinates or both. If the supported GAD shapes is not received in step 11 or Local Co-ordinates is not included in the supported GAD shapes, the LMF shall determine a geographical location. If a scheduled location time is provided at step 5, steps 11 and 12 include the following additional differences.\n11.\tThe AMF includes the scheduled location time in the Nlmf_Location_DetermineLocation service operation sent towards the LMF. If received in step 5, the AMF provides the LPHAP indication to the LMF.\nIf H-GMLC contact address is received in step 5, AMF also includes the H-GMLC contact address and the Notification Correlation ID in the Nlmf_Location_DetermineLocation service operation and sends towards the LMF.\nBased on UE user plane positioning capabilities, if the target UE supports the UE user plane positioning capability for LCS-UPP, the AMF shall provide the SUPI and/or GPSI of the target UE (see TS 29.572 [12]) as UE identity in the Nlmf_Location_DetermineLocation Request.\nNOTE 6:\tIn this case, the AMF ensures that a consistent UE identity is used for a particular LMF by implementation.\n12.\tIf received in step 11 of the LPHAP indication, the LMF may determine an appropriate positioning method by taking into account the LPHAP indication. When sending a location request to the UE, the LMF may include the scheduled location time.\nNOTE 7:\tIf integrity requirements are received in step 11, LMF may determine to use GNSS positioning method and RAT-dependent positioning method. The applicable positioning methods for RAT-dependent integrity are specified in TS 38.305 [9].\nNOTE 8:\tLMF does not deliver the scheduled location time to NG-RAN as part of step 12.\nNOTE 9:\tThe LMF may send a location request to the UE at step 12 containing the scheduled location time sometime before the scheduled location time to allow the UE to enter CM Connected state shortly before the scheduled location time.\nIf H-GMLC contact address and the Notification Correlation ID is received in step 11, the LMF responds to AMF in the Nlmf_location_determineLocation Response to indicate that the location determination will be sent directly to GMLC. In this case, the LMF determines to use local AMF for obtaining Non-UE Associated Network Assistance Data, as described in clause 6.11.3.\nWhen LMF determines the UE location, it executes the step 28 as described in clause 6.3.1.\n14.\tThe AMF returns the Namf_Location_ProvidePositioningInfo Response towards the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not supported) to return the current location of the UE. The service operation includes the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate.\nIf indicated in step 13 that the location determination will be sent directly to GMLC, AMF responds to GMLC with Namf_location_providePositioningInfo Response to indicate that GMLC will receive the location from LMF directly.\n15.\tIn the case of roaming, the VGMLC forwards the location estimation of the target UE, its age, its accuracy and optionally the information about the positioning method received at step 14 to the HGMLC. For non-roaming scenario, this step is skipped.\n16.\tIf the privacy check in step 2 indicates that further privacy checks are needed, the (H)GMLC shall perform an additional privacy check in order to decide whether the (H)GMLC can forward the location information to the LCS client or AF or send a notification if the result of the privacy check requires the notification and verification based on current location. One example when this additional privacy check is needed is when the target UE user has defined different privacy settings for different geographical locations. When an additional privacy check is not needed, the (H)GMLC skips steps 17-23.\n17.\tIf the result of privacy checks in step 16 indicates that the notification (and verification) based on current location is needed, and in the case of roaming, the (H)GMLC shall send a location request to the VGMLC with location type indicating \"notification only\".\n18.\tThe (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF to request notification (and verification) based on current location.\n19.\tIf the UE is in CM IDLE state, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\n20.\tIf the indicator of privacy check related action indicates that the UE must either be notified or notified with privacy verification and if the UE supports LCS notification, the AMF sends a notification invoke message to the target UE, indicating the identity of the LCS client and the service type (if that is both supported and available) and whether privacy verification is required.\n21.\tStep 21 is the same as step 8.\n22.\tThe AMF returns the Namf_Location_ProvidePositioningInfo Response towards the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not supported) with an indication of the result of notification and verification procedure performed in steps 20-21.\n23.\tIn the case of roaming, the VGMLC forwards an indication of the result of notification and verification procedure to the HGMLC. For non-roaming scenario, this step is skipped.\n24.\tThe (H)GMLC sends the location service response to the LCS Client, the NF or the AF (via the NEF) if the target UE is allowed to be located by the LCS Client, the NF or the AF. Accordingly, NEF invokes Nnef_EventExposure_Notify or sends Nnef_EventExposure_Subscribe Response to the AF. If the location request from the LCS Client contained the pseudonym and the (H)GMLC resolved the verinym from the pseudonym in step 1, the (H)GMLC shall use the pseudonym of the target UE in the location response to the external LCS client. If the external LCS client or AF requires it, the (H)GMLC may first transform the universal location co-ordinates provided by the AMF into some local geographic reference system. The (H)GMLC may record charging information both for the LCS Client or AF and inter-network revenue charges from the AMF's network. The location service response from the (H)GMLC to the LCS Client, the NF or the AF may contain the information about the positioning method used and the indication whether the obtained location estimate satisfies the requested accuracy or not. If in step 2, step 15, step 16 or step 23 the (H)GMLC identifies that the target UE is not allowed to be located by the LCS Client, the NF or the AF, it rejects the LCS service request, and optionally indicate in the response the reason of the rejection, i.e. the target UE is not allowed to be located. If the LCS QoS Class is Assured and (H)GMLC detects that requested accuracy is not achieved, the (H)GMLC sends error response including failure cause.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.5",
        "ts_23.502_clause_4.2.2.2.2",
        "ts_23.271_clause_9.1.1",
        "ts_23.271_clause_9.1.15",
        "clause_5.4",
        "ts_23.502_clause_4.2.3.3",
        "clause_6.1.1",
        "clause_6.11.3",
        "clause_6.3.1",
        "figure_6.1.2-1",
        "ts_22.071",
        "ts_38.305",
        "ts_23.502",
        "ts_23.271",
        "ts_29.572"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.1.3",
      "section_id": "6.1.3",
      "section_title": "5GC-MT-LR multiple location procedure for the regulatory location service",
      "content": "Figure 6.1.3-1 illustrates an extension procedure of 5GC-MT-LR procedure for the regulatory location service defined in clause 6.1.1.\nThis procedure is applicable for providing multiple location estimates of the target UE to LCS client.\nFigure 6.1.3-1: 5GC-MT-LR multiple location procedure for the regulatory location service\n1.\tSteps 1-7 for 5GC-MT-LR procedure for the regulatory location service clause 6.1.1 are performed with the following differences:\n-\tAt step 1 in clause 6.1.1 the request from external location services client may include acceptance of INTERMEDIATE response and maximum response time.\n-\tAt step 4 in clause 6.1.1 Namf_Location_ProvidePositioningInfo service operation invoked by GMLC may include the acceptance of INTERMEDIATE response and maximum response time, GMLC contact address and LIR reference number. The LIR reference number is allocated by GMLC based on predefined rule.\n-\tAt step 7 in clause 6.1.1 Nlmf_Location_DetermineLocation service operation invoked by AMF may include additionally include acceptance of INTERMEDIATE response and maximum response time, GMLC contact address, LIR reference number for the INTERMEDIATE response. AMF can overwrite maximum response time to avoid timeout.\n2.\tLMF performs positioning procedures and determines multiple location estimates during the session.\n2.1.\tThis step is executed if the INTERMEDIATE result is available. The LMF invokes an Nlmf_Location_EventNotify service operation towards GMLC and provides the INTERMEDIATE location of the UE during the session and timestamp of the location estimate, and LIR reference number, and INTERMEDIATE event type.\n2.2.\tThis step is executed if step 2.1 was executed. The GMLC sends the INTERMEDIATE location of the UE and timestamp of the location estimate to external location services client.\n3.\tBased on step 9 in clause 6.1.1 the LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the FINAL location of the UE. LMF ensures that FINAL location will be transferred towards AMF within the maximum response time.\n4.\tSteps 10-11 for 5GC-MT-LR procedure for the regulatory location service clause 6.1.1 are performed with the following differences:\n-\tAt step 11 the FINAL location is sent from GMLC to LCS client.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1.1",
        "figure_6.1.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.1.4",
      "section_id": "6.1.4",
      "section_title": "5GC-MT-LR procedure involving Mobile Base Station Relay",
      "content": "Figure 6.1.4-1 illustrates the network positioning for the LCS clients when Mobile Base Station Relay(s) is involved.\nIn this scenario, it is assumed that the target UE may be identified using an SUPI or GPSI. The procedure follows the functionality in clause 5.9 and the 5G-MT-LR procedures in clauses 6.1.1 and 6.1.2. It is further assumed that:\n-\tThe NG-RAN in figure 6.1.4-1 is a donor-CU to the MBSR.\n-\tWhen the MBSR is integrated or fully migrated to a new gNB, the OAM triggers the LMF to perform TRP Information Exchange procedure. The LMF learns that a new integrated TRP at a gNB is mobile and its MBSR IAB UE ID (GPSI) via a TRP information exchange towards the gNB with the Cell ID of the TRP. The LMF may also performs NRPPa TRP information exchange procedure before the positioning procedure for a target UE, e.g. to determine the position capability of NG-RAN.\n-\tThe LMF that performs the location estimation of the MBSR can be different than the LMF that performs the location estimation of the target UE (not shown in figure 6.1.4-1).\nFigure 6.1.4-1: 5GC-MT-LR procedure involving Mobile Base Station Relay\n1.\t[Optional] The location services client sends a request to the GMLC for a location for the target UE identified by an GPSI or an SUPI. The UE may or may not be served by a MBSR.\n2.\tThe GMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF serving the target UE to request the current location of the target UE. The location procedure may be also triggered at the AMF for a 5GC-NI-LR as at step 1 in clause 6.10.1, or an event report sent by the UE for a deferred 5GC-MT-LR for periodic or triggered location as at step 25 in clause 6.3.1.\n3.\tThe 5GC-MT-LR procedure as specified in clause 6.1.1 step 5-8 or clause 6.1.2 step 6-12 are performed with the difference that the LMF selection also consider LMF capability supporting MBSR involvement. If the AMF is aware that the target UE is served by a MBSR, it would select the LMF that can support the MBSR handling.\nNOTE 1:\tThe step 4 to 11 may happen as part of step 3.\n4.\tLMF derives if any MBSR(s) is involved in the positioning of the target UE based on the cell-ID used for positioning measurements in the step 3. The AMF serving the target UE may indicate that the serving cell is an MBSR (if applicable). When the MBSR was integrated as a TRP (IAB-DU) with a gNB, the LMF may determine from in a TRP information exchange procedure that the cell-ID belongs to the MBSR and/or the UE-ID (GPSI) associated with MBSR.  The LMF, when the OAM provides a new Cell Id to the LMF, performs a TRP information exchange as specified in TS 38.455 [15] for the new Cell ID. When the MBSR is integrated or fully migrated in the NG-RAN, the Cell ID(s) of the MBSR is (are)provided to the LMF and, in the case of full migration, any stale Cell ID of fully migrated MBSR is removed from LMF by OAM. If the LMF selects any cell for UE positioning measurements, and the LMF determines it needs to perform a TRP information exchange with the cell, it shall perform TRP Information Exchange procedure as specified in TS 38.455 [15].As the MBSR can be mobile the LMF may need to determine an updated location of the MBSR by either performing step 5-7 (option 1) or performing step 8-10 (option 2) if option 1 is not feasible. If several MBSRs were derived, then step 5-7 or step 8-10 are be performed for each MBSR.\nNOTE 2:\tIt is assumed that for the case of MBSR's inter CU mobility, the OAM can timely update the Cell Id of the MBSR to the LMF so as to enable it to perform a proper TRP information exchange. Until the Cell Id of the MBSR is provided to LMF by OAM, the Cell of the MBSR is not used for location procedures.\n5.\t[Conditional] The LMF initiates a NRPPa TRP Information Exchange procedure to request the updated location information of the TRP(s) associated with MBSR(s) by directing the TRP information exchange messages to the gNB associated with the Cell ID(s), for example, by setting the NRPPa TRP Information Type Item IE to \"mobile TRP location info\". Donor-CU further send a F1 TRP INFORMATION REQUEST message to any MBSR IAB-DU.\n6.\t[Conditional] The MBSR IAB-UE initiates a 5GC-MO-LR procedure (as defined in clause 6.2) to get its location information. The MBSR IAB-UE's location info is used by the co-located MBSR IAB-DU to determine the updated location for its TRP.\n7.\t[Conditional] The MBSR IAB-DU report its updated TRP location, e.g. TRP's geo-coordinate, velocity and the time for obtaining them, to the Donor-CU, which is further forwarded to LMF.\n8.\t[Conditional] The LMF invokes the Ngmlc_Location_ProvideLocation_Request service operation to the GMLC by providing the identifier of MBSR IAB-UE and a scheduled location time. The LMF determines the identifier of MBSR IAB-UE based on the Cell ID of MBSR and the received the GPSI of the MBSR in a TRP information exchange when the MBSR was integrated as a TRP. LMF may receive the scheduled location time in step 3. Otherwise, LMF may generate the scheduled location time, e.g. based on response time.\n9.\t[Conditional] The GMLC determines the AMF serving the MBSR and step 4-10 in clause 6.1.1 or steps 4-23 in clause 6.1.2 is performed. The privacy check in clause 5.4 is skipped for the MBSR based on the subscription data of the MBSR (IAB-UE). The scheduled location time received in step 8 is also provided to the MBSR IAB-UE when sending a location request to the MBSR.\n10.\t[Conditional] The GMLC sends the location service response including the MBSR IAB-UE's location to the LMF.\n11.\t[Conditional] The LMF performs one of the positioning procedures with the target UE described in clauses 6.11.1 and 6.11.2. To reduce the timing offset of the positioning measurements, the UE positioning may be scheduled with the same scheduled location time as the MBSR positioning in step 9. LMF sends the same time with the scheduled location time in step 8 to the target UE in clause 6.11.1. If Network Assisted procedure is used, the NG-RAN may provide the MBSR updated location and velocity information and the time obtained them to the LMF via NRPPa message as defined in TS 38.455 [15].\n12.\tThe LMF uses the received location and velocity of the MBSR(s) when estimating the location of the target UE together with the measurements reports in step 3 or optionally the updated measurement reports in step 11.\n13.\tThe LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the current location of the target UE.\n14.\tThe AMF returns the Namf_Location_ProvidePositioningInfo Response towards the GMLC to return the current location of the target UE.\n15.\tThe GMLC sends the location service response to the location services client.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.9",
        "clause_6.10.1",
        "clause_6.3.1",
        "clause_6.1.1",
        "clause_6.1.2",
        "clause_6.2",
        "clause_5.4",
        "clause_6.11.1",
        "figure_6.1.4-1",
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.2",
      "section_id": "6.2",
      "section_title": "5GC-MO-LR Procedure",
      "content": "Figure 6.2-1 illustrates the general network positioning requested by the UE to the serving PLMN for obtaining the location related information of itself or just assistance data.\nFigure 6.2-1: 5GC-MO-LR Procedure\n1)\tIf the UE is in CM-IDLE state, UE instigates the UE triggered Service Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a signalling connection with the AMF.\n2)\tThe UE sends an MO-LR Request message included in a UL NAS TRANSPORT message. The MO-LR Request may optionally include up to three LPP positioning message(s). Different types of location services can be requested: location estimate of the UE, location estimate of the UE to be sent to an LCS client or AF, or location assistance data. If the UE is requesting its own location or that its own location be sent to an LCS client or AF, this message carries LCS requested QoS information (e.g. accuracy, response time, LCS QoS Class), the requested maximum age of location, the requested type of location (e.g. \"current location\", \"current or last known location\") and, optionally for a current location, a scheduled location time. If the UE is requesting that its location be sent to an LCS client, the message shall include the identity of the LCS client or the AF, and may include the address of the GMLC through which the LCS client or AF (via NEF) should be accessed. In addition, a Service Type indicates which MO-LR service of the LCS Client is requested by the UE may be included. The message also may include a pseudonym indicator to indicate a pseudonym should be assigned by the network and transferred to the LCS Client as the UE's identity. The message may also include integrity requirements including Time-to-Alert (TTA), Target Integrity Risk (TIR) and Alert Limit(AL). Definitions of these parameters are specified in TS 38.305 [9].\nNOTE 1:\tIn this release of specification, integrity requirements are for GNSS integrity and RAT-dependent integrity. The applicable positioning methods for RAT-dependent integrity are specified in TS 38.305 [9].\nIf the UE is instead requesting location assistance data, the embedded LPP message specifies the type of assistance data and the positioning method for which the assistance data applies.\nFor an LCS 5GC-MO-LR requesting location transfer to an LCS Client or AF, the AMF shall assign a GMLC address, i.e. VGMLC address, which is stored in the AMF. If a VGMLC address is not available, the AMF may reject the location request. The AMF verifies the subscription profile of the UE and decides if the requested service is allowed or not by checking the Mobile Originated data retrieved from UDM during the UE Registration Procedure, as defined in clause 4.2.2.2.2 of TS 23.502 [19].\nIf the requested type of location is \"current or last known location\" and the requested maximum age of location information is available, the AMF verifies whether it stores the previously obtained location estimate and related timestamp (if available) of the target UE. If the AMF stores the location estimate and the related timestamp (if available) and the location estimate satisfies the requested accuracy and the requested maximum age of the location, the AMF skips steps 3 - 6.\n3)\tThe AMF selects an LMF as described in clause 5.1. AMF may be configured locally a mapping table of UE identity e.g. MSISDN and LMF address. When receiving a MO-LR, AMF determines LMF based on local configuration or by retrieving from UDM in the UE LCS subscriber data. If the AMF is aware that the UE is served by a MBSR, it would select the LMF that can support the MBSR handling.\n4)\tThe AMF invokes the Nlmf_Location_DetermineLocation service operation towards the LMF. The service operation includes an LCS Correlation identifier, the serving cell identity, the client type, an indication whether a location estimate, or location assistance data is requested, UE Positioning Capability if available, a list of MO-LR subscribed assistance data and any embedded LPP message(s) in the MO-LR Request. If the UE's location is requested, the service request may include an indication if UE supports LPP, the requested QoS, Supported GAD shapes and any scheduled location time. If location assistance data is requested, the embedded LPP message(s) will convey the requested types of location assistance data. If any of the procedures in clause 6.11.1 or 6.11.2 are used the service operation includes the AMF identity. Once an AMF has selected an LMF it must continue to use that LMF for the duration of the session.\nTo support location service in PNI-NPN with signalling optimisation, the AMF also includes a contact address (Notification Target Address, e.g. a URI) and a Notification Correlation ID, which is used by LMF to provide location determination to H-GMLC directly.\nIf the AMF is aware that the UE is served by a MBSR, it provides the indication to the LMF.\nBased on UE user plane positioning capabilities, if the target UE supports the UE user plane positioning capability for LCS-UPP, the AMF shall provide the SUPI and/or GPSI of the target UE (see TS 29.572 [12]) as UE identity in the Nlmf_Location_DetermineLocation Request.\nNOTE 2:\tIn this case, the AMF ensures that a consistent UE identity is used for a particular LMF by implementation.\nNOTE 3:\tIf the UE is requesting its own location, AMF does not indicate support of a GAD shape for local co-ordinates, see TS 23.032 [8].\n5)\tIf the UE is requesting its own location, the actions described in clause 6.11 are performed together with the actions described for step 12 in clause 6.1.2 if a scheduled location time is present. If the UE is instead requesting location assistance data, the LMF transfers this data to the UE as described in clause 6.11.1. The LMF determines the exact location assistance data to transfer according to the type of data specified by the UE, the UE location capabilities, the MO-LR subscribed assistance data and the current cell.\nIf the LMF is informed that the UE is served by a MBSR, the LMF may perform the operation of clause 6.1.4 step 5 to step 7, or step 8 to step 10, to obtain the MBSR location information. The LMF will take the MBSR location into account when determining the UE's location.\nIf H-GMLC contact address and the Notification Correlation ID is received in step 11, and the LMF determines to use local AMF for obtaining Non-UE Associated Network Assistance Data, as described in clause 6.11.3, the LMF responds to AMF in the Nlmf_location_determineLocation Response to indicate that the location determination will be sent directly to GMLC.\nWhen LMF determines the UE location, it executes the step 28 as described in clause 6.3.1.\nNOTE 4:\tIf integrity requirements are received in step 4, LMF may determine to use GNSS positioning method and RAT-dependent positioning method. The applicable positioning methods for RAT-dependent integrity are specified in TS 38.305 [9].\n6)\tWhen a location estimate best satisfying the requested QoS has been obtained or when the requested location assistance data has been transferred to the UE, the LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF. The service operation includes the LCS Correlation identifier, the location estimate, if this was obtained, its age and accuracy and may include information about the positioning method.\nIf a location estimate was not successfully obtained, or if the requested location assistance data could not be transferred successfully to the UE, a failure cause is included in the service operation.\nThe service operation may also include the UE Positioning Capability if the UE Positioning Capability is received in step 5 including an indication that the capabilities are non-variable and not received from AMF in step 4.\nIf the UE is requesting location assistance data, steps 7 to 12 are skipped.\n7)\tIf the location estimate was successfully obtained, the AMF invokes the Ngmlc_Location_LocationUpdate service operation towards to the VGMLC assigned in the step 2. The service operation carries the identity of the UE, the event causing the location estimate (5GC-MO-LR) and the location estimate, its age, obtained accuracy indication and the LCS QoS Class requested by the target UE. In addition, the service operation may include the pseudonym indicator, the identity of the LCS Client, AF ID, the GMLC address, the timestamp of the location estimate and the Service Type specified by the UE, if available.\n8)\tIf the UE did not request transfer of its location to an LCS Client or AF in step 2, steps 8 to 11 are skipped. If the VGMLC is same NF instance as HGMLC this step is skipped. Otherwise VGMLC invokes the Ngmlc_Location_LocationUpdate service operation towards to the HGMLC (the VGMLC may query the NRF to obtain the address of the HGMLC) including the information received from the AMF.\n9a)\tIf the pseudonym indicator is included in the MO-LR Location Information, the HGMLC assigns a pseudonym to the UE. If the identified LCS Client is not accessible by the HGMLC, step 9a and step 10a are skipped. Otherwise the GMLC transfers the location information to the LCS client, carrying the identity or the pseudonym of the UE, the event causing the location estimate (5GC-MO‑LR), the Service Identity, if available, and the location estimate, the timestamp of the location estimate (if available) and its age, in accordance with the LCS QoS Class requested by the target UE. If the UE requested LCS QoS class was Assured, GMLC sends the result to the LCS client only if the result has been indicated to fulfil the requested accuracy. If the UE requested LCS QoS class was Best Effort, GMLC sends whatever result it received to the LCS client with an appropriate indication if the requested accuracy was not met.\nNOTE 5:\tThe HGMLC maps any Service Type Identity received in step 8 into a Service Identity.\n9b-1)\tIf the AF ID is included in step 1, the HGMLC assigns the NEF address based on local configuration or via NRF and invokes Ngmlc_Location_LocationUpdateNotify service request towards the NEF, carrying the AF ID. The location information parameters sent within this service operation are same as the step 9a except that no pseudonym is included.\n9b-2)\tIf the identified AF is not accessible by the NEF, step 9b-2 and step 10b-1 are skipped. Otherwise, the NEF transfer the location information to the identified AF by invoking the Nnef_Location_LocationUpdateNotify service.\n10a)\tIf the LCS Client does not support MO-LR (for temporary or permanent reasons) or cannot handle the location estimate of the UE, e.g. the LCS Client does not know the Service Identity, or the UE does not register to the LCS Client, the LCS Client has no corresponding data of the UE, the LCS Client shall return the Location Information ack message to the HGMLC with a suitable error cause. Otherwise, the LCS Client handles the location estimate according to the Service Identity, sends the GMLC or the HGMLC the Location Information ack message signalling that the location estimate of the UE has been handled successfully.\n10b-1)\tIf the AF cannot handle the location estimate of the UE, e.g. the UE does not register to the AF, the AF has no corresponding data of the UE, the AF shall respond to the Nnef_Location_LocationUpdateNotify service request with a suitable error cause. Otherwise, the AF handles the location estimate according to the Service Identity and respond to the Nnef_Location_LocationUpdateNotify service request indicating that the location estimate of the UE has been handled successfully.\n10b-2)\tThe NEF sends a Ngmlc_Location_LocationUpdateNotify service response towards the HGMLC with the outcome of the operation.\n11)\tIf the VGMLC is same NF instance as HGMLC this step is skipped. If the identified LCS Client or AF is not accessible, the HGMLC sends a Ngmlc_Location_LocationUpdate service response to VGMLC with an appropriate error cause. Otherwise, the response shall include an acknowledgement. The message shall specify whether the location estimate of the UE has been handled successfully by the identified LCS Client or AF, and if not, the corresponding error cause obtained in step 10. In addition, the HGMLC may record charging information both for the UE and inter-working revenues charges.\n12)\tIf the VGMLC receives the MO-LR Location Information Acknowledgement from the HGMLC, if the identified LCS Client or AF is not accessible, the VGMLC sends a Ngmlc_Location_LocationUpdate service response to AMF with an appropriate error cause. Otherwise, the response shall include an acknowledgement. The message shall specify whether the location estimate of the UE has been handled successfully by the identified LCS Client or AF, and if not, the corresponding error cause obtained in step 9 or 10. In addition, the VGMLC may record charging information both for the UE and inter-working revenue charges.\nIf the VGMLC receives Ngmlc_Location_LocationUpdate Request from the AMF and it is not required to send to any LCS Client or AF, the VGMLC may record charging information for the UE and response the Ngmlc_Location_LocationUpdate Request to the AMF.\n13)\tThe AMF sends an MO-LR Response message included in a DL NAS TRANSPORT message. If the UE is requesting its own location, the response carries any location estimate requested by the UE and the timestamp of the location estimate (if available) including the indication received from LMF whether the obtained location estimate satisfies the requested accuracy or not, or an indicator whether a location estimate was successfully transferred to the identified LCS client or AF. If the location estimate was successfully transferred to the identified LCS Client or AF, the MO-LR Response message shall specify whether the location estimate of the UE has been handled successfully by the identified LCS Client or AF, and if not, the corresponding error cause obtained in step 13. In addition, AMF may record charging information.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.2.3.2",
        "ts_23.502_clause_4.2.2.2.2",
        "clause_5.1",
        "clause_6.11.1",
        "clause_6.11",
        "clause_6.1.2",
        "clause_6.1.4",
        "clause_6.11.3",
        "clause_6.3.1",
        "figure_6.2-1",
        "ts_23.502",
        "ts_38.305",
        "ts_29.572",
        "ts_23.032"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.3.1",
      "section_id": "6.3.1",
      "section_title": "Initiation and Reporting of Location Events",
      "content": "Figure 6.3.1-1 summarizes the initiation and reporting of location events for a deferred 5GC-MT-LR procedure for Periodic, Triggered and UE Available Location Events. The procedure supports mobility of a UE within a VPLMN 5GCN and from a 5GCN to an EPC.\nFigure 6.3.1-1: Deferred 5GC-MT-LR for periodic, triggered and UE available location events\n1.\tThe external location services client, the NF or the AF (via NEF) sends a request to the (H)GMLC for location reporting for periodic, triggered or UE available location events. The request is sent as described for step 1 in clause 6.1.2 with the differences described here. The LCS Service Request provides the type of periodic or triggered location reporting being requested and associated parameters. For periodic location, the LCS Service Request includes the time interval between successive location reports, the total number of reports and may include location QoS. For periodic location reporting, the LCS Service Request may include a scheduled location time for the first periodic location report. For area event reporting, the LCS Service Request includes details of the target geographical area, an indication to have an additional check whether UE is located within the requested target area, whether the event to be reported is the UE being inside, entering into or leaving the target area, the duration of event reporting, the minimum and maximum time intervals between successive event reports, the maximum event sampling interval, whether location estimates shall be included in event reports (and associated location QoS), and whether only one location report is required or more than one. If the target area is expressed by a local coordinate system or a geopolitical name, the (H)GMLC shall convert the target area to a geographical area expressed by a shape as defined in TS 23.032 [8]. For motion event reporting, the LCS Service Request includes the threshold linear distance, the duration of event reporting, the minimum and maximum time intervals between successive event reports, the maximum event sampling interval, whether location estimates shall be included in event reports (and associated location QoS), and whether only one location report is required or more than one.\n1b-1\tAF invokes the Nnef_EventExposure_Subscribe service operation to the NEF.\n1b-2\tThe NEF forwards the request to the (H)GMLC. The NEF assigns a LDR refence number locally and sends it to (H-)GMLC,\n1c.\tThe NF (e.g. NWDAF) invokes the Ngmlc_Location_ProvideLocation service operation to the (H)GMLC.\nNOTE 1:\tIf the LCS Client/AF requests an additional check about whether the UE is located within the provisioned target area, the LCS Client/AF shall also request that location estimates shall be included in event reports.\n2.\tThe (H)GMLC may verify UE privacy requirements as for step 2 in clause 6.1.2. The (H)GMLC may also subscribe to and receive notification of UE privacy profile updates according to steps 0 and 4 of clause 6.12.1. The (H)GMLC may also receive the event report expected area and optionally an area usage indication from UDM. For area event reporting, if there is no overlap between the event report expected area and the area provided by the AF or LCS Client, the (H)GMLC rejects the location request with a failure cause.\n3.\tThe (H)GMLC queries the UDM for the AMF address and, in the case of roaming, a VGMLC address as for step 3 in clause 6.1.2.\nGMLC may determine the LMF ID based on the LCS data for an LCS Client/AF. In case a group ID is provided or derived from the location request, GMLC determines the LMF ID based on the provisioned Group ID.\nGMLC may be configured with an LMF ID, irrelevant to any LCS client/AF. When the GMLC receives a MT location request from LCS client/AF, GMLC determines the LMF ID for all LCS client/AF.\nNOTE 2:\tThe HGMLC may also query the HSS of the target UE for a serving MME address as described in clause 9.1.1 of TS 23.271 [4]. The deferred EPC-MT-LR procedure for Periodic and Triggered Location described in clause 9.1.19 of TS 23.271 [4] or the EPC-MT-LR procedure for the UE availability event described in clause 9.1.15 of TS 23.271 [4] may then be performed instead of steps 4-31 - e.g. if the HSS returns an MME address but the UDM does not return an AMF address.\n4.\tThis step is skipped for a non-roaming UE. For a roaming UE, the HGMLC obtains a VGMLC address if not received at step 3 and invokes the Ngmlc_Location_Provide Location Request service operation to forward the location request to the VGMLC as described for step 4 of in clause 6.1.2. The (H)GMLC also includes a contact address for the (H)GMLC (Notification Target Address, e.g. a URI) and an LDR reference number (Notification correlation ID) to be used for event reporting at steps 20 and 29. The LDR reference number is either allocated by (H)GMLC based on predefined rule, e.g. operator's policy if the location request is received in step 1a, or allocated by NEF, if the location request is received in step 1b. If the event report expected area is received in step 2, the (H)GMLC is responsible to determine the event report allowed area which includes a cell/TA list based on the event report expected area. In the case of an area event, if there is overlap(s) between the event report expected area and the area provided by the AF or LCS client, the (H)GMLC will separately derive the TA/cell lists and take the overlapped TA/cell lists as the event report allowed area. If the area usage indication is also received in step 2, the (H)GMLC is responsible to determine the reporting indication regarding how the UE will report when the UE is inside or outside the event report allowed area. The (H)GMLC may include the event report allowed area and optionally a reporting indication.\n5.\tThe (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo Request service operation to forward the location request to the serving AMF as described for step 5 in clause 6.1.2 and includes the (H)GMLC contact address and LDR reference number. The LDR reference number is either allocated by (H-)GMLC based on predefined rule, e.g. operator's policy if the location request is received in step 1a, or allocated by NEF, if the location request is received in step 1b. For area event reporting, the target geographical area is converted into a corresponding list of cell and/or tracking area identities. The service operation includes the event report allowed area, the reporting indication if they are determined by GMLC in step 4.\n6-8.\tIf the AMF supports a deferred location request, the AMF returns an acknowledgment to the external LCS client, the NF, or the AF, via the (H)GMLC and, in the case of roaming, the VGMLC, indicating that the request for deferred location was accepted. The VGMLC, when used, may optionally release resources for the deferred location request at this point.\n9.\tIf the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF waits for the UE to become reachable.\nNOTE 3:\tIn the event of mobility of the UE to another AMF or to EPC when the UE becomes reachable, the old AMF can return an event indication to the (H)GMLC as at steps 19 and 20 and may include the address of the new serving AMF or MME if known. If a new serving AMF or MME is not known, the (H)GMLC can repeat step 3 to query the UDM and HSS for the new AMF or MME address. If a new AMF address is received, the (H)GMLC can restart the procedure from step 4.\n10.\tOnce the UE is reachable, if the UE is then in CM IDLE state, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\nNOTE 4:\tThe AMF may decide to cancel the location request before the UE becomes reachable (e.g. due to lack of resources or due to a timeout on the UE becoming reachable) or when the UE becomes reachable (e.g. if the AMF executes NAS level congestion control on the UE, or for other reasons). The AMF then skips steps 10-18 and proceeds to step 19 to return an indication of location cancelation to the VGMLC or (H)GMLC.\n11-12.\tThe AMF performs steps 7-8 in clause 6.1.2 to notify the UE of the location request and verify privacy requirements if required by the location request received at step 5 and supported by the UE. The AMF includes in the notification to the UE the type of deferred location request in the case of periodic or triggered location.\n13.\tThe AMF selects an LMF as described for step 6 in clause 6.1.1. The selection may take into account the type of deferred location request (e.g. whether periodic or triggered) and any parameters for the deferred location request (e.g. the number of event reports required and/or the duration).\n14.\tThe AMF invokes the Nlmf_Location_DetermineLocation Request service operation towards the LMF to initiate a request for deferred UE location. For a request for periodic or triggered location, the service operation includes all the information received in step 4 or step 5 including the (H)GMLC contact address, LDR reference number, UE Positioning Capability if available and any scheduled location time and may include a list of allowed access types for event reporting at step 22. For a request for the UE available location event, the (H)GMLC contact address and LDR reference number are not included, except for the case to support location service in PNI-NPN with signalling optimisation described in clause 5.13. In all cases, the service operation includes an LCS Correlation identifier, the AMF identifier, the serving cell identity, the client type and may include an indication if UE supports LPP, the required QoS and Supported GAD shapes. The service operation includes the event report allowed area, the reporting indication if received by AMF in step 5. The AMF may include the UE ID (i.e. SUPI) in the service operation.\n15.\tThe LMF performs one or more of the positioning procedures described in clause 6.11.1, 6.11.2 and 6.11.3 and as described for step 8 in clause 6.1.1. During this step, the LMF may request and obtain the UE positioning capabilities (e.g. which may indicate the type(s) of periodic and triggered location supported by the UE and the access types supported by the UE for event reporting). The LMF may also obtain the UE location - e.g. for a request for the UE available location event or when an initial location is requested for periodic or triggered UE location. For a request for the UE available location event, the LMF skips steps 16 and 17.\n16.\tIf periodic or triggered location was requested, the LMF sends a supplementary services LCS Periodic-Triggered Invoke Request to the UE via the serving AMF by invoking the Namf_Communication_N1N2MessageTransfer service operation. The LCS Periodic-Triggered Location Invoke carries the location request information received from the AMF at step 14, including the (H)GMLC contact address, LDR reference number and any scheduled location time. The LCS Periodic-Triggered Location Invoke also includes a deferred routing identifier, which can be the identification of the LMF when the LMF will act as a serving LMF or a default LMF identification otherwise. The LCS Periodic-Triggered Location Invoke may indicate the allowed access types for event reporting at step 25 (e.g. one or more of NR, E-UTRA connected to 5GC, non-3GPP access connected to 5GC, any of the RAT Types specified for NR satellite access) and may include embedded positioning message(s) which indicates certain allowed or required location measurements (or a location estimate and the timestamp of the location estimate if available) at step 24 for each location event reported (e.g. based on the positioning capabilities of the UE obtained in step 14 and the allowed access types). As part of NAS transport of the LCS Periodic-Triggered Location Invoke from the serving AMF to the UE, the serving AMF includes an immediate routing identifier in the NAS transport message containing an LCS Correlation identifier - e.g. according to clause 6.11.1. The service operation includes the event report allowed area, the reporting indication received by LMF in step 14.\nNOTE 5:\tThe deferred routing identifier may be global (e.g. an IP address, UUID or URI) or may be local. The deferred routing identifier is used for routing in step 25. However, the immediate routing identifier included by the AMF in step 15 is used for routing in step 17.\n17.\tIf the request in step 16 can be supported, the UE returns a supplementary services acknowledgment to the LMF, which is transferred via the serving AMF using the immediate routing identifier and delivered to the LMF using an Namf_Communication_N1MessageNotify service operation.\n18.\tThe LMF invokes the Nlmf_Location_DetermineLocation Response service operation towards the AMF to respond to the request at step 14. For a request for the UE available location event, the response includes any UE location obtained at step 15 and the LMF then releases all resources and if (H)GMLC contact address and the Notification Correlation ID is received in step 14 for PNI-NPN signalling optimization, the LMF responds to AMF to indicate that the location determination will be sent directly to GMLC and step 19 is skipped and similarly with step 28, the LMF sends Nlmf_Location_EventNotify to (H)GMLC directly. For a periodic or triggered location request, the response includes any location obtained at step 15, a confirmation of whether periodic or triggered location was successfully activated in the UE according to steps 16 and 17 and the identification of the LMF in the case of successful activation with a serving LMF; the LMF also retains state information and resources for later steps if the LMF acts a serving LMF. If the multiple QoS class was used in the location request, the LMF provides the achieved Location QoS Accuracy in step 15. If the UE cannot support the periodic and triggered location request, the service operation returned to the AMF shall include a suitable error cause. The service operation also includes the UE Positioning Capability if the UE Positioning Capability is received in step 15 including an indication that the capabilities are non-variable and not received from AMF in step 14.\n19.\tThe AMF invokes the Namf_Location_EventNotify service operation towards the VGMLC for roaming, or (H)GMLC for non-roaming, and includes any location received at step 18 and, for periodic or triggered location, a confirmation of whether or not periodic or triggered location was successfully activated in the target UE. The VGMLC, if used, may be the same VGMLC used in steps 5 and 6 or may be a different VGMLC. In the case of a different VGMLC, the AMF includes the HGMLC contact address and LDR reference number. The AMF also includes the LMF identification and the achieved Location QoS Accuracy if received at step 18. The AMF may then release all resources for the location request and cease support for the procedure.\n20.\tThis step is skipped for a non-roaming UE. For a roaming UE, The VGMLC forwards the response received at step 19 to the HGMLC using the HGMLC contact address received at step 19 (for a different VGMLC) or received and stored at step 4 (for the same VGMLC) and includes the LDR reference number and any LMF identification that was received. The VGMLC may then release all resources for the location request and cease support for the procedure.\nNOTE 6:\tAs an optional optimization for a roaming UE, instead of performing steps 19 and 20, the AMF may invoke the Namf_Location_EventNotify service operation directly towards the HGMLC (e.g. if a VGMLC is not used or if the VGMLC ceases support after step 8).\n21.\tThe (H)GMLC forwards the response to the external LCS client, the NF or the AF (via the NEF). If the location request at step 1 was for the UE available location event, the procedure terminates here and further steps 22-31 are not performed.\n22.\tFor a periodic or triggered location request where steps 16 and 17 were successfully performed, the UE monitors for occurrence of the trigger or periodic event requested in step 16. For the area event or motion event, the UE monitors the requested event at intervals equal to or less than the maximum event sampling interval. An event trigger is detected by the UE when any of the following occur: (i) a requested area event or motion event has been detected and the minimum reporting time interval has elapsed since the last report (if this is not the first event report); (ii) a requested periodic location event has occurred; or (iii) the maximum reporting time for an area event or motion event has expired. When a trigger or periodic event is detected and if the UE is camped on or connected to (or can otherwise access) an access type allowed by the LMF at step 16, the UE proceeds to step 23. If the UE cannot access an allowed access type, the UE may skip reporting the trigger event or may report the trigger event at a later time when an allowed access type becomes available, according to requirements received from the LMF at step 16. When a scheduled location time is provided for periodic location request at step 16, a UE should perform steps 23-25 some time in advance of the scheduled location time for the first periodic event report or some time in advance of the periodic interval expiration for each succeeding periodic event report in order to enable location measurements at step 23 or step 27 to occur near to each of these times, respectively.\nIf the event report allowed area with no reporting indication is received in step 16, when UE detects the event happens, it further checks whether it is inside the event report allowed area. If yes, the steps 23 to 30c are performed. Otherwise, the steps 23 to 30c are skipped. If the event report allowed area with a reporting indication is received in step 16, when UE detects the event happens, it further checks whether it is outside the event report allowed area. If yes, the steps 23 to 30c are performed. Otherwise, the steps 23 to 30c are skipped.\n23.\tThe UE obtains any location measurements or a location estimate that were requested or allowed at step 16.\nNOTE 7:\tObtaining a location estimate when requested also applies to the trigger event corresponding to expiration of the maximum reporting interval for an area event or motion event.\n24.\tThe UE performs a UE triggered service request as defined in clause 4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a signalling connection with the AMF.\n25.\tThe UE sends a supplementary services event report message to the LMF which is transferred via the serving AMF (which may be different to the original serving AMF for steps 14-16) and is delivered to the LMF using an Namf_Communication_N1MessageNotify service operation. The event report may indicate the type of event being reported (e.g. whether a normal event or expiration of the maximum reporting interval) and may include embedded positioning message(s) which includes any location measurements or location estimate and the timestamp of the location estimate if available obtained at step 23. The UE also includes the deferred routing identifier received in step 16 in the NAS Transport message used to transfer the event report from the UE to the AMF. The AMF then forwards the event report to either the serving LMF or any suitable LMF based on whether the deferred routing identifier indicates a particular LMF or default (any) LMF. If a different LMF than the serving LMF is used, procedure in clause 6.4 is used. The UE also includes the (H)GMLC contact address, the LDR reference number, whether location estimates are to be reported and if so the location QoS in the event report and any scheduled location time indicated at step 16 for periodic reporting. If the default (any) LMF is used, the AMF shall provide the UE ID (i.e. SUPI) in the Namf_Communication_N1MessageNotify service operation.\nNOTE 8:\tWhen forwarding the event report message to the LMF in step 25, the AMF includes the deferred routing identifier received in step 25 as the LCS Correlation Identifier. The deferred routing identifier can assist a serving LMF in identifying the periodic or triggered location session if the same serving LMF had assigned the deferred routing identifier at step 16 or can indicate to the LMF that it is acting as a default LMF.\nNOTE 9:\tThe scheduled location time included at step 25 equals T + (N-1)*P, where T is the initial Scheduled Location Time, N is the Report Number (N≥1) and P is the time interval between successive periodic events.\n26.\tWhen the LMF receives the event report and if it can handle this event report, the LMF updates the status of event reporting(e.g. the number of event reports so far received from the UE and/or the duration of event reporting so far) and returns a supplementary services acknowledgment for the event report to the UE. The acknowledgment may optionally include a new deferred routing identifier indicating a new serving LMF or a default (any) LMF. When the LMF delivers the acknowledgement for the event report to the AMF by invoking an Namf_Communication_N1N2MessageTransfer service operation, the LMF shall provide the UE ID (i.e. SUPI). If the UE does not receive any response from the LMF after a predefined time, i.e. the current LMF does not support the deferred location request (for temporary or permanent reasons) or due to some radio access failures, the UE may re-send the report one or more times. If the UE sends the repeated event report more than the predefined maximum resending time and the UE still does not receive any response from AMF, the UE shall stop resending the report and reserve the event report, then record a corresponding flag to indicate that a report has been sent unsuccessfully. When the UE performs location update and detects the PLMN is changed, if the flag has been set, the UE shall send the report to the corresponding AMF, and the flag will be cleared upon a success of the sending.\nNOTE 10:\tInclusion of a new deferred routing identifier in the event report acknowledgment at step 26 may be used to change the serving LMF (e.g. if a UE moves into an area or to an access type that is better supported by a different LMF or if the serving LMF is overloaded) or to enable a default LMF to become a serving LMF.\n27.\tIf a location estimate is needed for event reporting, the LMF may perform one or more of the positioning procedures described in clauses 6.11.1, 6.11.2, 6.11.3 and 6.11.4 and as described for step 8 in clause 6.1.1 and step 12 in clause 6.1.2. The LMF then determines the UE location using the location measurements and/or location estimate(s) obtained at this step and/or received at step 25. The LMF may also determine the timestamp of the location estimate. If the positioning procedures described in clause 6.11.1 and clause 6.11.2 are used, when the LMF delivers the Namf_Communication_N1N2MessageTransfer to AMF, the LMF shall provide the UE ID (i.e. SUPI).\nNOTE 11:\tA precondition for the procedure in clause 6.11.1 is that an LCS Correlation identifier assigned by the serving AMF has been previously passed to the LMF. The LCS Correlation identifier is used in steps 1, 3, 6 and 7 in clause 6.11.1 to ensure that during a positioning session between the LMF and UE, positioning response messages from the UE are returned by the AMF to the correct LMF and carrying an indication (the LCS Correlation identifier) which can be recognized by the LMF. To retain this capability in step 27, the LMF shall assign a Correlation identifier indicating the LMF (and optionally a positioning session) for use at step 1 in clause 6.11.1. To enable an AMF to distinguish a Correlation identifier assigned by an LMF (used in this procedure) from a Correlation identifier assigned by the AMF (used otherwise for clause 6.11.1), the two types of Correlation identifier could be selected from different ranges, with or without a flag.\n28.\tIn the case of roaming, the LMF selects a VGMLC (which may be different to the VGMLC for steps 3-8 and steps 19-21), The LMF then invokes an Nlmf_Location_EventNotify service operation towards the selected VGMLC or (H)GMLC with an indication of the type of event being reported, the (H)GMLC contact address and LDR reference number, the identification of the LMF if this is a serving LMF, and any location estimate and the timestamp of the location estimate (if available) obtained at step 27. If multiple QoS class was used in the initial location request, the LMF provides the achieved Location QoS Accuracy in step 27.\nNOTE 12:\tIn the case of roaming, the LMF may select the VGMLC for step 28 using the NRF service or using configuration information in the LMF or may use the same VGMLC as for steps 3-8 (e.g. if the LMF acts as a serving LMF and received the VGMLC address from the AMF as part of step 14).\n29.\tThis step is skipped for a non-roaming UE. For a roaming UE, the VGMLC invokes an Ngmlc_Location_EventNotify service operation to forward the information received in step 28 (e.g. including the type of event being reported, the LDR reference number and possibly the LMF identification) to the HGMLC which identifies the periodic and triggered location request from the LDR reference number.\nNOTE 13:\tAs an optional optimization for a roaming UE, instead of performing steps 28 and 29, the LMF may invoke the Nlmf_Location_EventNotify service operation directly towards the HGMLC.\nNOTE 14:\tIn the event of mobility of the UE to an access network for which event reporting at step 22 is not allowed (e.g. an access network in EPS) or if the UE is otherwise unable to send event reports (e.g. due to being powered off), the (H)GMLC may not receive event reports at step 28 or step 29 at fixed intervals for periodic location or at intervals equal to or less than the maximum reporting interval for triggered location. In such a case, the (H)GMLC may cancel the periodic or triggered location reporting using the procedures defined in clause 6.3.3. The UE may also cancel the periodic or triggered location reporting either locally or using the procedure defined in clause 6.3.2 once the UE can access an access network that is allowed for event reporting.\n30.\tThe (H)GMLC uses the LDR reference number received in step 28 or step 29 to identify the periodic and triggered location request received in step 1 and then sends the type of event being reported and any location estimate and the timestamp of the location estimate (if available) and used positioning methods to the external LCS client, the NF or the AF (via the NEF), and sends the LDR reference number to LCS client. The (H)GMLC may also verify UE privacy requirements before reporting the event and any location to the external LCS client, the NF or the AF. If multiple QoS class was used in the initial location request, the LMF provides the achieved Location QoS Accuracy in step 27. If an indication to have an additional check is received at step 1, the (H)GMLC will verify the UE location estimate is within the target area, and send the event report to the LCS client, the NF or the AF.\n31.\tThe UE continues to monitor for further periodic or trigger events as in step 22 and instigates steps 23-30 each time a trigger event is detected.\nNOTE 15:\tService continuity for reporting of periodic or trigger events when a UE moves between 5GS and EPS is not supported in this release of the specification.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2",
        "clause_6.12.1",
        "ts_23.271_clause_9.1.1",
        "ts_23.271_clause_9.1.19",
        "ts_23.271_clause_9.1.15",
        "ts_23.502_clause_4.2.3.3",
        "clause_6.1.1",
        "clause_5.13",
        "clause_6.11.1",
        "ts_23.502_clause_4.2.3.2",
        "clause_6.4",
        "clause_6.11.2",
        "clause_6.3.3",
        "clause_6.3.2",
        "figure_6.3.1-1",
        "ts_23.032",
        "ts_23.271",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.3.2",
      "section_id": "6.3.2",
      "section_title": "Cancellation of Reporting of Location Events by a UE",
      "content": "Figure 6.3.2-1 summarizes a procedure to enable a UE to cancel a deferred 5GC-MT-LR procedure for periodic, or triggered location events (e.g. if the UE is powered off or if the UE cancels the location request based on user's input). It is assumed that a deferred 5GC-MT-LR for periodic or triggered location events has already been initiated in the UE according to steps 1-17 for the procedure in clause 6.3.1. If a network entity (e.g. (H)GMLC, AMF or LMF) cancels a deferred 5GC-MT-LR procedure for periodic or triggered location events, part of the procedure in clause 6.3.3 for cancellation by an AF, an NF or external LCS Client would be used to cancel towards the UE and part of the procedure in this clause would be used to cancel towards the AF, the NF or external LCS Client.\nFigure 6.3.2-1: UE Cancellation of a Deferred 5GC-MT-LR for periodic or triggered location events\n1.\tThe UE performs a UE triggered service request as defined in clause 4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a signalling connection with the AMF.\n2.\tThe UE sends a Cancel Location request message to the LMF which is transferred via the serving AMF and is delivered to the LMF using an Namf_Communication_N1MessageNotify service operation. The UE includes the deferred routing identifier originally received in step 16 of the procedure in clause 6.3.1 (or as updated by step 26 in clause 6.3.1 or by the procedure in clause 6.4) in the NAS Transport message used to transfer the cancel location request from the UE to the AMF. The AMF then forwards the cancel location request to either the serving LMF or any suitable LMF based on whether the deferred routing identifier indicates a particular LMF or any (default) LMF. The UE also includes the (H)GMLC contact address and the LDR reference number.\n3.\tIn the case of roaming, the LMF selects a VGMLC. The LMF then invokes an Nlmf_Location_EventNotify service operation towards the selected VGMLC or (H)GMLC with an indication of the cancelation of location event reporting, the (H)GMLC contact address and LDR reference number.\nNOTE 1:\tIn the case of roaming, the LMF may select the VGMLC for step 3 using the NRF service or using configuration information in the LMF or may use the same VGMLC as for steps 3-8 of clause 6.3.1 (e.g. if the LMF acts as a serving LMF and received the VGMLC address from the AMF as part of step 14 of clause 6.3.1).\n4.\tThis step is skipped for a non-roaming UE. For a roaming UE, the VGMLC invokes an Ngmlc_Location_EventNotify service operation to forward the cancel location request (including the LDR reference number) to the HGMLC which identifies the periodic and triggered location request from the LDR reference number.\nNOTE 2:\tAs an optional optimization for a roaming UE, instead of performing steps 3 and 4, the LMF may invoke the Nlmf_Location_EventNotify service operation directly towards the HGMLC.\n5.\tThe (H)GMLC uses the LDR reference number received in step 3 or step 4 to identify the periodic and triggered location request received in step 1 of clause 6.3.1 and then forwards the cancel location to the external LCS client, the NF or the AF (via the NEF).\n6.\tThe LMF returns an acknowledgment to the UE via the serving AMF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.3.3",
        "ts_23.502_clause_4.2.3.2",
        "clause_6.4",
        "figure_6.3.2-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.3.3",
      "section_id": "6.3.3",
      "section_title": "Cancellation of Reporting of Location Events by an AF, an NF or External LCS Client or GMLC",
      "content": "Figure 6.3.3-1 summarizes a procedure to enable an AF, an NF or External LCS Client or GMLC to cancel a deferred 5GC-MT-LR procedure for periodic, or triggered location. It is assumed that a deferred 5GC-MT-LR for periodic or triggered location events has already been requested according to the procedure in clause 6.3.1 up until at least step 20.\nFigure 6.3.3-1: Cancellation of a Deferred 5GC-MT-LR for periodic or triggered location events by an AF, an NF or External LCS Client\n1.\tThe external LCS client, the NF or the AF (via an NEF) send a request to cancel the periodic or triggered location to the (H)GMLC, the external LCS client, the NF or the AF shall include the identity of the deferred request.\nThe HGMLC may itself initiate the cancellation procedure, e.g. when it is notified that the UE LCS privacy profile stored in the UDM was changed. For every outstanding Deferred Location Request against that UE, the HGMLC shall perform a new privacy check based on the updated UE LCS privacy profile stored in the UDM. If the privacy check passes, i.e. the LCS Client is still allowed to position the target UE, the handling of the outstanding Deferred Location Request shall be continued. Otherwise, if the privacy check does not pass, i.e. the Location estimate of the target UE is not allowed to be provided to the LCS Client, the HGMLC shall initiate a cancellation procedure\nNOTE:\tGMLC may perform privacy check for more than one location request as a bulk operation.\n2.\tThe (H)GMLC queries the UDM to determine the serving AMF address as in step 3 of clause 6.3.1.\n3.\tFor a roaming UE, the HGMLC obtains a VGMLC address if not received at step 2 and invokes an Ngmlc_Location_CancelLocation service operation to forward the cancellation request to the VGMLC. The (H)GMLC also includes the contact address for the (H)GMLC and the LDR reference number in the request and the latest LMF identification received in step 20 or step 29 in clause 6.3.1 if either step has occurred and included an LMF identification.\n4.\tThe (H)GMLC or VGMLC invokes the Namf_Location_CancelLocation service operation to forward the cancellation request to the serving AMF and includes the (H)GMLC contact address, LDR reference number and LMF identification if available.\n5.\tIf an LMF identification was included in step 4, the AMF forwards the cancelation request to the indicated LMF by invoking an Nlmf_Location_CancelLocation service operation and includes the (H)GMLC contact address and LDR reference number. The LMF then releases all resources for the location request.\n6.\tIf the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF waits for the UE to become reachable.\n7.\tOnce the UE is reachable, if the UE is then in CM IDLE state, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\n8.\tThe AMF sends the cancelation request to the target UE and includes the (H)GMLC contact address and the LDR reference number. The UE then releases all resources for the location request.\n9.\tThe UE returns an acknowledgment to the AMF.\n10.\tThe AMF responds to Namf_Location_CancelLocation, then V-GMLC or (H)GMLC releases all resources for the location request. AMF releases all resources for the location request.\n11.\tFor a roaming UE, the VGMLC responds to Ngmlc_Location_CancelLocation, then HGMLC releases all resources for the location request.\n12.\t[Conditional] If the cancellation procedure is requested by HGMLC (i.e. the procedure is triggered in step 1c) and the cancelled location event is reported to external client, the NF or the AF (via NEF).",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "ts_23.502_clause_4.2.3.3",
        "figure_6.3.3-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.4",
      "section_id": "6.4",
      "section_title": "LMF Change Procedure",
      "content": "The LMF Change procedure supports change of a serving LMF during a deferred 5GC-MT-LR procedure for periodic, or triggered location events as defined in clause 6.3.1. When a serving LMF is used for the procedure in clause 6.3.1, mobility of the target UE may lead to a change of serving AMF for which the original serving LMF is not suitable. For example, the serving LMF may be very remote from the new serving AMF leading to higher resource utilisation for AMF to LMF signalling or the LMF may not be configured with information (e.g. a cell database) for the current access network for the UE to enable location. In such a case, the serving LMF may need to change. Figure 6.4-1 shows a procedure to enable change of the serving LMF when a UE sends an event report as at step 25 in clause 6.3.1.\nFigure 6.4-1: Change of serving LMF for periodic and triggered UE location events\nPrecondition:\tSteps 1-23 in clause 6.3.1 have already been performed and steps 22-30 may have been performed or repeated. A serving LMF is used and the current serving LMF is LMF1.\n1.\tThe UE performs a service request if needed as for step 24 in clause 6.3.1.\n2.\tThe UE sends a NAS Transport message containing a supplementary services event report message to the serving AMF. The NAS Transport message includes a deferred routing identifier indicating LMF1. Step 2 corresponds to part of step 25 for clause 6.3.1.\n3.\tBased on operator configuration and policy, the AMF may evaluate and determine that LMF1 is unsuitable or unable to support location for the current UE access network or serving cell and determines LMF2 as being a more suitable LMF. AMF may already have LMF2 information e.g. from previous NRF discovery or locally configured, otherwise AMF queries NRF and in response may get a set of LMF profiles. AMF selects new LMF (i.e. LMF2 in this case) for the current UE location based on LMF service area (consisting of one or more TA(s)) and also other information as listed in clause 5.1.\n4.\tThe AMF invokes the Namf_Communication_N1MessageNotify service operation towards LMF1. The service operation includes the event report received in step 2. If the AMF determined in step 3 that a new LMF2 should be used, it indicates that to the LMF1 as well.\n5.\tIf the AMF did not indicate a new LMF in step 4, based on the operator configuration and policy, LMF1 may evaluate and determine that it is unsuitable or unable to support location for the current UE access network or serving cell and determines LMF2 as being a more suitable LMF. LMF1 may already have LMF2 information e.g. from previous NRF discovery or locally configured, otherwise LMF1 queries NRF and in response may get a set of LMF profiles. LMF1 selects new LMF (i.e. LMF2 in this case) for the current UE location based on LMF service area (consisting of one or more TA(s)) and other information as listed in clause 5.1.\n6.\tLMF1 invokes an Nlmf_Location_LocationContextTransfer Request service operation towards LMF2 to provide the current location context of the UE and includes the event report message received in step 4. The service operation includes the AMF identity and all the information originally received by LMF1 for the periodic or triggered location request either from the AMF according to the procedure in clause 6.3.1 or from an earlier serving LMF according to this procedure. The service operation may also include the current status of event reporting (e.g. the number of event reports so far received from the UE and/or the duration of event reporting so far) and may include location related information for the UE such a previous location estimate and the timestamp of the location estimate (if available) or location measurements.\n7.\tLMF2 informs LMF1 of the location context transfer operation results. LMF1 then releases all resources for the procedure.\n8.\tLMF2 invokes the Namf_Communication_N1N2MessageTransfer service operation towards the AMF to request the transfer of a supplementary services Event Report Acknowledgment message to the UE. The Event Report Acknowledgment indicates a change of LMF and includes a deferred routing identifier indicating LMF2.\n9.\tThe AMF forwards the Event Report Acknowledgment to the UE in a NAS Transport message. The AMF also informs the LMF2 of the result of the delivery of the Event Report Acknowledgement.\n10.\tIf a location estimate is needed for event reporting, LMF2 may perform positioning of the UE and determines the UE location as at step 27 in clause 6.3.1. The rest of the procedure in clause 6.3.1 then continues from step 28 with LMF2 retaining state information to enable support of subsequent event reports from the UE.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.3.1",
        "clause_5.1",
        "figure_6.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.5.1",
      "section_id": "6.5.1",
      "section_title": "Unified Location Service Exposure Procedure without routing by a UDM",
      "content": "Figure 6.5.1-1 shows a unified location service exposure procedure provided by an NEF in an HPLMN for a target UE to an NF in the HPLMN or to an external AF outside the HPLMN. The procedure enables a request for an immediate location or for a deferred location for a target UE.\nFigure 6.5.1-1: Unified Location Service Exposure Procedure without routing by a UDM\n1a.\tAn external AF invokes an Nnef_EventExposure_Subscribe service operation towards an NEF in the HPLMN for a target UE and includes an identification of the UE (e.g. SUPI or GPSI) and details of the location request such as whether a current or last know immediate location or a deferred location is requested, the location accuracy and response time, maximum age of location, LDR request information and other information applicable to the type of request.\n1b.\tAs an alternative to step 1a, a consumer NF in the HPLMN for a target UE invokes an Nnef_EventExposure_Subscribe service operation towards an NEF in the HPLMN and includes a global identification of the UE (e.g. SUPI or GPSI) and details of the location request as in step 1a.\n2.\tBased on the service requirements in step 1a or step 1b (e.g. location QoS and whether an immediate or deferred location is requested) and on the availability of GMLC versus AMF based location service, the NEF determines whether the location request in step 1a or step 1b can be mapped to a GMLC based location service or to an AMF location event exposure service. The NEF determines to use whichever mapping is supported or, when both mappings are supported, may employ implementation or operator dependent procedures to make a choice. When a GMLC based location service is determined, steps 3-6 are performed and steps 7-15 are omitted. When an AMF location event exposure service is determined, steps 7-15 are performed and steps 3-6 are omitted. If NEF determines the location request is handled by AMF, it allocates an LDR reference number.\nNOTE 1:\tThe NEF may take the potential load to the system, e.g. AMF/UDM load, or GMLC load, into consideration when deciding which location service to use, or whether to reject the request from NF or AF. The NEF may also take into account QoS. For example, when QoS accuracy exceeds cell ID, the GMLC location service shall be used if available.\n3.\tWhen a GMLC based location service is determined in step 2, the NEF invokes an Ngmlc_Location_ProvideLocation Request service operation towards an HGMLC in the HPLMN. The service operation may include all of the information received from the AF or NF in step 1a or 1b.\n4.\tFor a request for an immediate location, the HGMLC performs steps 2-10 of the 5GC-MT-LR procedure in clause 6.1.1 in the case of regulatory location or steps 2-23 of the 5GC-MT-LR procedure in clause 6.1.2 in the case of commercial location. For a request for deferred location, the HGMLC performs steps 2-29 of the deferred 5GC-MT-LR procedure for periodic, triggered or UE available location events in clause 6.3.1.\n5.\tThe HGMLC invokes the Ngmlc_Location_ProvideLocation Response service operation towards the NEF to confirm the request in step 3 for a request for deferred location or to return the UE location for a request for an immediate location.\n6.\tIf deferred location was requested in step 1, the HGMLC invokes one or more Ngmlc_Location_EventNotify service operations towards the NEF, to convey a single UE location in the case of deferred location for the UE available event or to convey an indication of location activation in the UE followed by one or more location event reports in the case of deferred location for periodic or triggered location events.\n7.\tWhen an AMF location event exposure service is determined in step 2, if the NEF needs to verify the target UE privacy requirements, the NEF invokes a Nudm_SDM_Get service operation towards the UDM of the target UE to get the privacy settings of the UE identified by its GPSI or SUPI. The UDM returns the target UE Privacy setting and the SUPI of the UE. The NEF checks the privacy settings. If the target UE is not allowed to be located, steps 8-14 are skipped.\nNOTE 2:\tThe AMF location event exposure service does not support a real time query to the UE to verify UE privacy requirement by the user. If the NEF finds this is needed, the NEF either selects a GMLC location service or returns an error to the external AF or NF.\n8.\tThe NEF invokes a Nudm_UECM_Get service operation towards the UDM of the target UE with SUPI of this UE. The UDM returns the network addresses of the current serving AMF. If the location request is an immediate location request, the NEF checks the country codes of the serving node addresses. If the NEF finds out the current AMF locates out of the service coverage, the NEF returns an appropriate error message to the AF or NF.\nWhen the UE is concurrently served by multiple PLMNs respectively for 3GPP access and non-3GPP access, multiple AMF IDs with corresponding access type are provided by the UDM, the NEF selects one access type and its associated AMF based on principle defined in clause 5.3.2.\n9.\tThe NEF invokes an Namf_EventExposure Subscribe service operation towards the serving AMF for the target UE and indicates whether a one-time UE location is requested or multiple UE locations for some triggering event, if current or last known is requested, maximum age of location and includes information on location accuracy (e.g. cell ID or TA granularity). If the NEF has no direct access to AMF or is configured to use UDM for the AMF event exposure, procedure in clause 6.5.2 is used instead.\n10.\tThe AMF responds to the service operation in step 9.\n11.\tIf the UE is currently reachable and in CM-IDLE state and if current location is requested in step 9 with a cell ID accuracy and maximum age of location cannot be fulfilled based on AMF knowledge of the current or last known serving cell, the AMF perform a network triggered service request as described in TS 23.502 [19] to place the UE in CM-CONNECTED state.\n12.\tIf an immediate location is requested in step 9 which the AMF can support based on AMF knowledge of the current or last known serving cell or serving TA for the UE, the AMF uses this information. Otherwise, the AMF invokes the NG-RAN location reporting procedure defined in clause 4.10 of TS 23.502 [19] to obtain a single location or multiple UE locations according to the request in step 9. The AMF may convert any location that was obtained in the form of a cell ID or TAI into geographical information based on TS 23.032 [8] and as defined in clause 6.2.6.2.5 of TS 29.518 [16] and clauses 5.4.4.7, 5.4.4.8 and 5.4.4.9 of TS 29.571 [33] before proceeding to step 13.\n13.\tThe AMF invokes the Namf_EventExposure Notify service operation towards the NEF to provide the current or last known UE location as obtained at step 12.\nWhen the NEF obtains more than one serving AMF and corresponding access type from UDM at step 8, if the location information provided by AMF can not meet the required LCS QoS, the NEF may forward the location request to another AMF, i.e. Steps 9-15 is performed in another PLMN served by this AMF. In this case, if the access type associated with another AMF is non-3GPP access, procedure defined in clause 6.9.2 applies.\n14.\tIf the AMF invokes the NG-RAN location reporting procedure in step 12 to obtain multiple UE locations and receives multiple location reports from NG-RAN as part of step 12, the AMF invokes one or more additional Namf_EventExposure Notify service operations towards the NEF to provide each additional UE location provided by NG-RAN. The AMF may convert each additional UE location in the form of a cell ID or TAI into geographical information as in step 12.\nNOTE 4:\tAMF conversion of a UE location in the form of a cell ID or TAI into geographical information in step 12 and step 14 can be PLMN operator dependent. However, it is expected that AMF conversion will normally be needed for a roaming UE to avoid VPLMN cell ID and TAI configuration in the HPLMN NEF.\n15.\tIn the case of LDR, the NEF may itself initiate the Namf_EventExposure Unsubscribe service operation, e.g. if when the UE's privacy setting stored in the UDM was changed. For every outstanding Deferred Location Request against that UE, the NEF shall perform a new privacy check based on the updated privacy setting stored in the UDM. If the privacy check passes, i.e. the LCS Client is still allowed to position the target UE, the handling of the outstanding Deferred Location Request should be continued. Otherwise, if the privacy check does not pass, i.e. the Location estimate of the target UE is not allowed to be provided to the LCS Client, the NEF shall initiate a cancellation. Then AMF then releases all resources for the LDR request, and NEF shall send a notification of cancellation of LDR request to consumer AF or NF in the step 17a, 17b.\n16a, 16b.\tThe NEF returns the first UE location received at step 5 or step 13 or a confirmation of a request for deferred location received at step 5 in the case of a GMLC location service to the external AF (step 15a) or NF (step 15b).\n17a, 17b.\tIf one or more additional location reports are received at step 6 or step 14, the NEF returns one or more additional locations to the external AF (step 16a) or NF (step 16b). If step 15 occurs, a notification of cancellation of LDR request shall be sent to the consumer AF (step 17a) or consumer NF (step 17b).\nNOTE 5:\tAs part of step 16 and step 17, the NEF converts any UE location received in the form of a cell ID or TAI into geographical information prior to sending the location to a consumer AF or NF.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1.1",
        "clause_6.1.2",
        "clause_6.3.1",
        "clause_5.3.2",
        "clause_6.5.2",
        "ts_23.502_clause_4.10",
        "ts_23.032_clause_6.2.6.2.5",
        "clause_6.9.2",
        "figure_6.5.1-1",
        "ts_29.518_clause_6.2.6.2.5",
        "ts_23.502",
        "ts_23.032",
        "ts_29.518",
        "ts_29.571"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.5.2",
      "section_id": "6.5.2",
      "section_title": "Unified Location Service Exposure Procedure with routing via a UDM",
      "content": "Figure 6.5.2-1 shows the procedure used by an NEF to access the serving AMF for the UE when the NEF does not have direct access to the serving AMF or is configured to use UDM for AMF location event exposure service. When this procedure is used, steps 1-8 in Figure 6.5.2-1 replace steps 8-14 in Figure 6.5.1-1.\nFigure 6.5.2-1: Unified Location Service Exposure Procedure with routing by a UDM\n1.\tThe NEF invokes an Nudm_EventExposure Subscribe service operation towards the UDM for the target UE for location reporting and indicates whether a one-time UE location is requested or multiple UE locations for some triggering event and includes the UE identity (SUPI or GPSI) and information on location accuracy (e.g. cell ID or TA granularity). A correlation ID is also included.\n2.\tThe UDM invokes an Namf_EventExposure Subscribe service operation towards the serving AMF for the target UE for location reporting and includes the information received in the service operation for step 1 including the correlation ID and a URI for the NEF.\n3.\tThe AMF responds to the service operation in step 2.\n4.\tThe UDM responds to acknowledges the service operation in step 1.\n5.\tThe AMF performs a Network Triggered Service Request if needed as for step 11 of clause 6.5.1.\n6.\tThe AMF obtains a location of the UE or invokes a location reporting procedure with NG-RAN to obtain a UE location or multiple UE locations as for step 12 of clause 6.5.1.\n7.\tThe AMF invokes the Namf_EventExposure Notify service operation towards the NEF indicated by the URI received in step 2 and includes the first UE location obtained at step 6 and the correlation ID received at step 2.\n8.\tIf the AMF invokes a location reporting procedure with NG-RAN to obtain multiple UE locations at step 6, the AMF invokes one or more Namf_EventExposure Notify service operations towards the NEF to provide each additional UE location as in step 14 for clause 6.5.1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.5.1",
        "figure_6.5.2-1",
        "figure_6.5.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.6",
      "section_id": "6.6",
      "section_title": "NG-RAN Location Service Exposure Procedure",
      "content": "The NG-RAN Location Service Exposure procedure is not supported in this Release of the specification.",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_6.7",
      "section_id": "6.7",
      "section_title": "Low Power Periodic and Triggered 5GC-MT-LR Procedures",
      "content": "The low power periodic and triggered 5GC-MT-LR procedures may be used to support a request from an external LCS client or AF for deferred location for periodic or triggered location events. The procedures may be used as alternatives to the procedures in clause 6.3.1 and clause 6.4. If the procedures are used, cancellation of the reporting of location events is still supported using the procedures in clause 6.3.2 and clause 6.3.3.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.4",
        "clause_6.3.2",
        "clause_6.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.7.1",
      "section_id": "6.7.1",
      "section_title": "Event Reporting with no change of LMF",
      "content": "Figure 6.7.1-1 summarizes the initiation and reporting of location events for a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events using low power event reporting. This procedure is only applicable to a UE with E-UTRA access to 5GC.\nFigure 6.7.1-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure with no change of LMF\n1.\tSteps 1-23 for the deferred 5GC-MT-LR procedure for periodic or triggered location events in clause 6.3.1 are performed with the following exceptions.\n-\tAt step 14, the AMF includes an indication in the Nlmf_Location_DetermineLocation Request service operation that the UE supports and is allowed to use Control Plane CIoT 5GS Optimisation as described in clause 5.31.4 of TS 23.501 [18].\n-\tAt step 16, if the AMF indicates the UE supports and is allowed to use Control Plane CIoT 5GS Optimisation at step 14 and if the LMF decides to allow Control Plane CIoT 5GS Optimisation, the LMF includes an indication in the LCS Periodic-Triggered Invoke Request that the UE is allowed to use Control Plane CIoT 5GS Optimisation to send Event Reports. The LMF may also include criteria indicating when Control Plane CIoT 5GS Optimisation may be used to send Event Reports. The criteria may include a maximum duration for sending Event Reports using Control Plane CIoT 5GS Optimisation, a maximum number of consecutive Event Reports to be sent using Control Plane CIoT 5GS Optimisation or both.\nNOTE 1:\tAs part of negotiating 5G network behaviour during registration, a UE indicates in a Registration Request whether Control Plane CIoT 5GS Optimisation is supported for location event reporting. This indication may be passed to the LMF by the AMF at step 14 for clause 6.3.1.\n2.\tThe UE determines whether to report the event detected at step 22 in clause 6.3.1 using Control Plane CIoT 5GS Optimisation or using a NAS signalling connection. If the UE is currently in CM CONNECTED state or is not accessing E-UTRA connected to 5GC, the UE shall use a NAS signalling connection. Otherwise, the determination shall be based on criteria received from the LMF at step 14 in clause 6.3.1 when criteria are received. When the criteria include a maximum duration for sending event reports using Control Plane CIoT 5GS Optimisation, the UE shall report the event using a NAS signalling connection if the UE has not used a NAS signalling connection to report events during an immediately preceding time interval equal to the maximum duration. When the criteria include a maximum number of consecutive Event Reports to be sent using Control Plane CIoT 5GS Optimisation, the UE shall report the event using a NAS signalling connection if the UE has used Control Plane CIoT 5GS Optimisation to report each of the N previous events, where N equals the maximum number of consecutive Event Reports. In other cases, Control Plane CIoT 5GS Optimisation may be used to report the event if supported by the 3GPP access type. If use of a NAS signalling connection is determined, steps 24-31 for the procedure in clause 6.3.1 are performed and steps 3-11 below are skipped. If use of Control Plane CIoT 5GS Optimisation is determined, steps 3-11 below are performed.\n3.\tIf the UE and ng-eNB node both support EDT, the UE sends an RRCEarlyDataRequest message to the ng-eNB node and includes a NAS control plane service request.\nOtherwise, the UE established an RRC connection with the ng-eNB node and sends the NAS control plane service request. The NAS control plane service request includes an event report message which includes the information described in step 25 in clause 6.3.1 (e.g. the type of event being reported and any location measurements or location estimate obtained at step 23 in clause 6.3.1). The control plane service request also includes the deferred routing identifier received in step 16 in clause 6.3.1. The UE also includes a NAS Release Assistance Indication (NAS RAI) in the NAS message. The NAS RAI indicates a single response is expected.\nNOTE 2:\tEvent reporting using Control Plane CIoT 5GS Optimisation requires a single Event report acknowledgment from the LMF.\n4.\tThe ng-eNB node forwards the NAS message to the AMF in an N2 Initial UE message and includes an \"EDT Session\" indication if EDT was used at step 3.\n5.\tThe AMF checks the integrity of the NAS message and deciphers its contents. The AMF then invokes an Namf_Communication_N1MessageNotify service operation to forward the event report to either the serving LMF or any suitable LMF as described for step 25 for clause 6.3.1. The AMF includes an indication of Control Plane CIoT 5GS Optimisation in the service operation and the serving cell ID.\n6.\tThe AMF returns a NAS Service Accept to the ng-eNB node which is encapsulated in an N2 Downlink NAS Transport message.\n7.\tIf EDT was used at step 3, the ng-eNB node establishes an RRC connection to the UE.\n8.\tThe ng-eNB node sends an RRC DL Information Transfer message to the UE and includes the NAS Service Accept message received in step 6.\n9.\tThe LMF invokes an Namf_Communication_N1N2MessageTransfer operation to return an acknowledgment for the event report as described for step 26 for clause 6.3.1.\n10.\tThe AMF forwards the acknowledgment to the ng-eNB node in a NAS DL NAS Transport message which is encapsulated in an N2 Downlink NAS Transport message. The AMF also includes an \"end indication\" in the N2 message.\nNOTE 3:\tIf the AMF determines more data or signalling may be pending for the UE, the AMF does not include the \"end indication\" at step 10 and step 12 below is not performed.\n11.\tThe ng-eNB node sends an RRC DL Information Transfer message to the UE and includes the NAS message received in step 10.\n12.\tIf the \"end indication\" was received in step 10, the ng-eNB node releases the RRC connection.\n13.\tIf a location estimate is needed for event reporting, the LMF determines the UE location using the location measurements and/or location estimate received in the event report at step 5 and/or the serving cell ID provided by the AMF at step 5.\nNOTE 4:\tThe LMF does not attempt to obtain additional location measurements from the UE or from the NG-RAN.\n14.\tSteps 28-31 for clause 6.3.1 are performed to send the event report to the external client or AF and to continue event detection at the UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "ts_23.501_clause_5.31.4",
        "figure_6.7.1-1",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.7.2",
      "section_id": "6.7.2",
      "section_title": "Event Reporting with change of LMF",
      "content": "Figure 6.7.2-1 shows a procedure to enable change of the serving LMF when a UE sends an event report as at steps 3 and 4 in clause 6.7.1.\nFigure 6.7.2-1: Event Reporting with change of LMF\nPrecondition:\tStep 1 in clause 6.7.1 has already been performed and steps 2-11 in clause 6.7.1 may have been performed or repeated. A serving LMF is used and the current serving LMF is LMF1.\n1.\tSteps 2-4 for Event Reporting for no change of LMF in clause 6.7.1 are performed with the following exceptions.\n-\tAt step 3, the NAS control plane service request includes a deferred routing identifier indicating LMF1.\n2.\tSteps 3-8 for the LMF Change procedure in clause 6.4 are performed with the following exceptions.\n-\tAt step 4, the Namf_Communication_N1MessageNotify service operation includes an indication of Control Plane CIoT 5GS Optimisation.\n-\tAt step 6, the Nlmf_Location_LocationContextTransfer Request service operation includes an indication of Control Plane CIoT 5GS Optimisation and the serving cell ID.\n3.\tSteps 7-10 for Event Reporting for no change of LMF in clause 6.7.1 are performed with LMF2 replacing the LMF in clause 6.7.1. The rest of the procedure in clause 6.7.1 then continues in step 11 with LMF2 retaining state information to enable support of subsequent event reports from the UE.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.7.1",
        "clause_6.4",
        "figure_6.7.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.7.3",
      "section_id": "6.7.3",
      "section_title": "Event Reporting in RRC INACTIVE state for DL Positioning, RAT Independent Positioning or No Positioning",
      "content": "Figure 6.7.3-1 summarizes the initiation and reporting of location events for a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when a UE is in RRC INACTIVE state and when DL positioning, RAT independent positioning or no positioning is used for event reporting. This procedure is only applicable to a UE with NR access to 5GC.\nFigure 6.7.3-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC INACTIVE state with DL Positioning, RAT Independent Positioning or No Positioning\n1.\tSteps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered location events in clause 6.3.1 are performed with the following differences.\n-\tAt step 16 in clause 6.3.1, the LMF indicates to the UE that DL positioning, RAT Independent positioning or no positioning will be used for subsequent location reporting events when the UE is in RRC INACTIVE state. If DL positioning or RAT independent positioning will be used, the LMF includes an LPP positioning message in the LCS Periodic-Triggered Invoke Request sent to the UE at step 16, where the LPP positioning message requests DL location measurements, RAT independent location measurements or a location estimate based on these location measurements. If no location of the UE is needed for event reporting or if a location based on a Cell ID will suffice for the location QoS, the LMF does not include an LPP positioning message in the LCS Periodic-Triggered Invoke Request sent to the UE at step 16.\nNOTE 1:\tA deferred routing identifier indicating a default LMF cannot be included in the LCS Periodic-Triggered Location Invoke sent at step 16 in clause 6.3.1 because for event reporting at steps 5-11 below. the LMF needs to know which type of positioning was indicated at step 1 in order to correctly support these subsequent steps. However, a default LMF would not know which type of positioning had been indicated at step 1.\n2.\tThe UE enters RRC INACTIVE state some time before an event is detected at step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE follows the procedure described for steps 22-31 in clause 6.3.1 to report the event to the LMF and to the LCS Client or AF.\nNOTE 2:\tThe LMF is not aware of whether the UE is in RRC INACTIVE state. This allows the LMF to follow the procedure described here or the procedure described in clause 6.3.1 for event reporting. With the procedure described here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE state after the procedure is complete. With the procedure in clause 6.3.1, a UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED state during the procedure in clause 6.3.1.\n3.\tThe UE monitors for and detects a trigger event as described for step 22 in clause 6.3.1.\n4.\tIf DL positioning or RAT independent positioning was indicated at step 1, the UE obtains the location measurements or location estimate requested in the LPP message received in step 1. If DL positioning or RAT independent positioning was not indicated at step 1, this step is skipped.\n5.\tThe UE sends an RRC Resume Request with small data transmission (SDT) to a receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL Information Transfer message containing an UL NAS TRANSPORT message that includes a supplementary services event report message. If DL positioning or RAT independent positioning was indicated at step 1, the UE includes an LPP positioning message in the supplementary services event report message that includes the location measurements or location estimate obtained at step 4. If DL positioning or RAT independent positioning was not indicated at step 1, the UE does not include an LPP positioning message in the supplementary services event report message. The event report message also includes other information described in step 25 in clause 6.3.1 (e.g. the type of event being reported). The UL NAS TRANSPORT message also include the deferred routing identifier received in step 16 in clause 6.3.1.\n6.\tThe receiving gNB node forwards the UL NAS TRANSPORT message to the serving AMF in an N2 Uplink NAS Transport message.\nNOTE 3:\tIf the receiving gNB node is not the anchor gNB node for the UE, the UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor gNB node.\n7.\tThe AMF checks the integrity of the NAS message and deciphers its contents. The AMF then invokes an Namf_Communication_N1MessageNotify service operation to forward the event report to the serving LMF as described for step 25 in clause 6.3.1.\n8.\tThe LMF invokes an Namf_Communication_N1N2MessageTransfer operation to return an acknowledgment for the event report as described for step 26 in clause 6.3.1.\nNOTE 4:\tIf there is a change of LMF according to clause 6.4, the acknowledgment includes a deferred routing identifier for the new LMF as described in clause 6.4.\n9.\tThe AMF forwards the acknowledgment to the receiving gNB node in a DL NAS TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport message.\nNOTE 5:\tIf the receiving gNB node is not the anchor gNB node for the UE, the DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the anchor gNB node.\n10.\tThe receiving gNB node sends a Subsequent DL SDT message to the UE and includes the NAS message received in step 10.\n11.\tThe receiving gNB node sends an RRC Release message to the UE to keep the UE in RRC INACTIVE state.\n12.\tFollowing step 11, the UE remains in RRC INACTIVE state.\n13.\tIf a location estimate is needed for event reporting, the LMF determines the UE location using the location measurements or location estimate received at step 7 or a Cell ID provided by the AMF at step 7.\nNOTE 6:\tThe LMF does not attempt to obtain additional location measurements from the UE or from the NG-RAN.\n14.\tSteps 28-31 for clause 6.3.1 are performed to send the event report to the LCS client or AF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.4",
        "figure_6.7.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.7.4",
      "section_id": "6.7.4",
      "section_title": "Event Reporting in RRC INACTIVE state for UL Positioning",
      "content": "Figure 6.7.4-1 summarizes the initiation and reporting of location events for a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when a UE is in RRC INACTIVE state and when UL positioning is used for event reporting. This procedure is only applicable to a UE with NR access to 5GC.\nFigure 6.7.4-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC INACTIVE state with UL Positioning\n1.\tSteps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered location events in clause 6.3.1 are performed with the following differences.\n-\tAt step 16 in clause 6.3.1, the LMF indicates to the UE that UL positioning may be used for subsequent location reporting events when the UE is in RRC INACTIVE state by not including an LPP positioning message in the LCS Periodic-Triggered Invoke Request sent to the UE at step 16.\nNOTE 1:\tA deferred routing identifier indicating a default LMF cannot be included in the LCS Periodic-Triggered Location Invoke sent at step 16 in clause 6.3.1 because for event reporting at steps 4-11 below. the LMF needs to know which type of positioning was indicated at step 1 in order to correctly support these subsequent steps. However, a default LMF would not know which type of positioning had been indicated at step 1.\n2.\tThe UE enters RRC INACTIVE state some time before an event is detected at step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE follows the procedure described for steps 22-31 in clause 6.3.1 to report the event to the LMF and to the LCS Client or AF.\nNOTE 2:\tThe LMF is not aware of whether the UE is in RRC INACTIVE state. This allows the LMF to follow the procedure described here or the procedure described in clause 6.3.1 for event reporting. With the procedure described here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE state after the procedure is complete. With the procedure in clause 6.3.1, a UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED state during the procedure in clause 6.3.1.\n3.\tThe UE monitors for and detects a trigger event as described for step 22 in clause 6.3.1.\n4.\tThe UE sends an RRC Resume Request with small data transmission (SDT) to a receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL Information Transfer message containing an UL NAS TRANSPORT message that includes a supplementary services event report message. The UE does not include an LPP positioning message in the supplementary services event report message. The event report message includes other information described in step 25 in clause 6.3.1 (e.g. the type of event being reported). The UL NAS TRANSPORT message also includes the deferred routing identifier received in step 16 in clause 6.3.1.\n5.\tThe receiving gNB node forwards the UL NAS TRANSPORT message to the serving AMF in an N2 Uplink NAS Transport message.\nNOTE 3:\tIf the receiving gNB node is not the anchor gNB node for the UE, the UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor gNB node.\n6.\tThe AMF checks the integrity of the NAS message and deciphers its contents. The AMF then invokes an Namf_Communication_N1MessageNotify service operation to forward the event report to the serving LMF as described for step 25 in clause 6.3.1.\n7.\tThe LMF uses the Network Assisted Positioning Procedure in clause 6.11.2 to request the receiving gNB node to provide an UL configuration to the UE at step 11. The receiving gNB node then determines an UL Configuration to be used later at step 11 and indicates this to the LMF. The LMF also uses the Non-UE Associated Network Assistance Data procedure in clause 6.11.3 to request UL location measurements of the UE by NG-RAN gNB nodes.\nNOTE 4:\tBecause the UE is in RRC INACTIVE state and thus in CM CONNECTED state, step 2 of the Network Assisted Positioning Procedure in clause 6.11.2 whereby the AMF performs a Network Triggered Service Request will not be performed. This avoids a transition of the UE into RRC CONNECTED state.\n8.\tThe LMF invokes an Namf_Communication_N1N2MessageTransfer operation to return an acknowledgment for the event report as described for step 26 in clause 6.3.1.\nNOTE 5:\tIf there is a change of LMF according to clause 6.4, the acknowledgment includes a deferred routing identifier for the new LMF as described in clause 6.4.\n9.\tThe AMF forwards the acknowledgment to the receiving gNB node in a DL NAS TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport message.\nNOTE 6:\tIf the receiving gNB node is not the anchor gNB node for the UE, the DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the anchor gNB node.\n10.\tThe receiving gNB node sends a Subsequent DL SDT message to the UE and includes the NAS message received in step 10.\n11.\tThe receiving gNB node sends an RRC Release message to the UE to keep the UE in RRC INACTIVE state and includes the UL Configuration determined at step 7.\n12.\tThe UE transmits UL positioning signals according to the UL Configuration received at step 11. The NG-RAN gNB nodes that were requested to obtain UL location measurements at step 7 obtain the UL location measurements of the UL positioning signals transmitted by the UE.\n13.\tThe NG-RAN gNB nodes transfer the UL location measurements obtained at step 12 to the LMF according to the Non-UE Associated Network Assistance Data Procedure in clause 6.11.3.\n14.\tFollowing step 13, the UE remains in RRC INACTIVE state.\n15.\tThe LMF determines the UE location using the UL location measurements received at step 13.\nNOTE 7:\tThe LMF does not attempt to obtain additional location measurements from the UE or from the NG-RAN.\n16.\tSteps 28-31 in clause 6.3.1 are performed to send the event report to the LCS client or AF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.11.2",
        "clause_6.11.3",
        "clause_6.4",
        "figure_6.7.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.7.5",
      "section_id": "6.7.5",
      "section_title": "Event Reporting in RRC INACTIVE state for UL+DL Positioning",
      "content": "Figure 6.7.5-1 summarizes the initiation and reporting of location events for a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when a UE is in RRC INACTIVE state and when UL-DL positioning is used for event reporting. This procedure is only applicable to a UE with NR access to 5GC.\nFigure 6.7.5-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC INACTIVE state with UL+DL Positioning\n1.\tSteps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered location events in clause 6.3.1 are performed with the following differences.\n-\tAt step 16 in clause 6.3.1, the LMF indicates to the UE that UL+DL positioning will be used for subsequent location reporting events when the UE is in RRC INACTIVE state by including an LPP positioning message in the LCS Periodic-Triggered Invoke Request sent to the UE at step 16, where the LPP positioning message identifies an UL-DL positioning method and requests DL location measurements for this positioning method. The LMF also includes a deferred routing identifier in the LCS Periodic-Triggered Location Invoke which is an identification of the LMF.\nNOTE 1:\tA deferred routing identifier indicating a default LMF cannot be included in the LCS Periodic-Triggered Location Invoke sent at step 16 in clause 6.3.1 because for event reporting at steps 4-20 below. the LMF needs to know which type of positioning was indicated at step 1 in order to correctly support these subsequent steps. However, a default LMF would not know which type of positioning had been indicated at step 1.\n2.\tThe UE enters RRC INACTIVE state some time before an event is detected at step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE follows the procedure described for steps 22-31 in clause 6.3.1 to report the event to the LMF and to the LCS Client or AF.\nNOTE 2:\tThe LMF is not aware of whether the UE is in RRC INACTIVE state. This allows the LMF to follow the procedure described here or the procedure described in clause 6.3.1 for event reporting. With the procedure described here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE state after the procedure is complete. With the procedure in clause 6.3.1, a UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED state during the procedure in clause 6.3.1.\n3.\tThe UE monitors for and detects a trigger event as described for step 22 in clause 6.3.1.\n4.\tThe UE sends an RRC Resume Request with small data transmission (SDT) to a receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL Information Transfer message containing an UL NAS TRANSPORT message that includes a supplementary services event report message. The UE includes an LPP positioning message in the supplementary services event report message that includes a request for an UL Configuration to support the UL+DL positioning method indicated to the UE at step 1. The event report message also includes other information described in step 25 in clause 6.3.1 (e.g. the type of event being reported). The UL NAS TRANSPORT message also includes the deferred routing identifier received in step 16 in clause 6.3.1.\n5.\tThe receiving gNB node forwards the UL NAS TRANSPORT message to the serving AMF in an N2 Uplink NAS Transport message.\nNOTE 3:\tIf the receiving gNB node is not the anchor gNB node for the UE, the UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor gNB node.\n6.\tThe AMF checks the integrity of the NAS message and deciphers its contents. The AMF then invokes an Namf_Communication_N1MessageNotify service operation to forward the event report to the serving LMF as described for step 25 in clause 6.3.1.\n7.\tThe LMF uses the Network Assisted Positioning Procedure in clause 6.11.2 to request the receiving gNB node to provide an UL configuration to the UE at step 11. The receiving gNB node then determines an UL Configuration to be used later at step 11 and indicates this to the LMF. The LMF also uses the Non-UE Associated Network Assistance Data procedure in clause 6.11.3 to request UL location measurements of the UE by NG-RAN gNB nodes.\nNOTE 4:\tBecause the UE is in RRC INACTIVE state and thus in CM CONNECTED state, step 2 of the Network Assisted Positioning Procedure in clause 6.11.2 whereby the AMF performs a Network Triggered Service Request will not be performed. This avoids a transition of the UE into RRC CONNECTED state.\n8.\tThe LMF invokes an Namf_Communication_N1N2MessageTransfer operation to return an acknowledgment for the event report as described for step 26 in clause 6.3.1.\nNOTE 5:\tIf there is a change of LMF according to clause 6.4, the acknowledgment includes a deferred routing identifier for the new LMF as described in clause 6.4.\n9.\tThe AMF forwards the acknowledgment to the receiving gNB node in a DL NAS TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport message.\nNOTE 6:\tIf the receiving gNB node is not the anchor gNB node for the UE, the DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the anchor gNB node.\n10.\tThe receiving gNB node sends a Subsequent DL SDT message to the UE and includes the NAS message received in step 9.\n11.\tThe receiving gNB node sends an RRC Release message to the UE to keep the UE in RRC INACTIVE state and includes the UL Configuration determined at step 7.\n12.\tThe UE transmits UL positioning signals according to the UL Configuration received at step 11. The UE also obtains DL location measurements as requested at step 1. The NG-RAN gNB nodes that were requested to obtain UL location measurements at step 7 obtain the UL location measurements of the UL positioning signals transmitted by the UE.\n13.\tThe NG-RAN gNB nodes transfer the UL location measurements obtained at step 12 to the LMF according to the Non-UE Associated Network Assistance Data Procedure in clause 6.11.3.\n14.\tThe UE sends an RRC Resume Request with small data transmission to the receiving gNB node. The RRC Resume Request includes an RRC UL Information Transfer message containing an UL NAS TRANSPORT message that includes a supplementary services event report message. The event report message indicates that this is a second event report associated with the first event report sent at step 4 and includes an LPP positioning message that includes the DL location measurements obtained at step 12. The UL NAS TRANSPORT message also includes the deferred routing identifier received in either step 16 in clause 6.3.1 or step 10 in this procedure if there was a change of LMF.\nNOTE 7:\tThe LMF can be aware that UL+DL positioning is used from receipt at step 6 of the LPP positioning message in the supplementary services event report message that includes a request for an UL Configuration to support the UL+DL positioning method indicated to the UE at step 1. The LMF can thus expect to receive the second event report at step 14.\n15.\tThe receiving gNB node forwards the UL NAS TRANSPORT message to the serving AMF in an N2 Uplink NAS Transport message.\nNOTE 8:\tIf the receiving gNB node is not the anchor gNB node for the UE, the UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor gNB node.\n16.\tThe AMF checks the integrity of the NAS message and deciphers its contents. The AMF then invokes an Namf_Communication_N1MessageNotify service operation to forward the event report to the serving LMF as described for step 25 in clause 6.3.1.\n17.\tThe LMF invokes an Namf_Communication_N1N2MessageTransfer operation to return an acknowledgment for the event report as described for step 26 in clause 6.3.1.\n18.\tThe AMF forwards the acknowledgment to the receiving gNB node in a DL NAS TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport message.\nNOTE 9:\tIf the receiving gNB node is not the anchor gNB node for the UE, the DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the anchor gNB node.\n19.\tThe receiving gNB node sends a Subsequent DL SDT message to the UE and includes the NAS message received in step 18.\n20.\tThe receiving gNB node sends an RRC Release message to the UE to keep the UE in RRC INACTIVE state.\n21.\tFollowing step 20, the UE remains in RRC INACTIVE state.\n22.\tThe LMF determines the UE location using the UL location measurements received at step 13 and the DL location measurements received at step 16.\nNOTE 10:\tThe LMF does not attempt to obtain additional location measurements from the UE or from the NG-RAN.\n23.\tSteps 28-31 in clause 6.3.1 are performed to send the event report to the LCS client or AF.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.11.2",
        "clause_6.11.3",
        "clause_6.4",
        "figure_6.7.5-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.8",
      "section_id": "6.8",
      "section_title": "Bulk Operation of LCS Service Request Targeting to Multiple UEs",
      "content": "The procedure described in this clause applies to 5GC_MT_LR and Deferred 5GC-MT-LR request targeting to a group of UE identified by an external/internal group ID, if available.\nFigure 6.8-1: Bulk operation of LCS service request targeting to multiple UEs\n1.\tThis step is the same as step 1 of clause 6.1.2 and step 1 of clause 6.3.1, with the difference that the LCS request is targeting a group of UE identified by a group ID. The GMLC may map the external/internal group ID to the list of UE ID (i.e. SUPI) using Nudm_SDM_Get (Group Identifier Translation, External Group Identifier) service operation.\nNOTE:\tStep 1b-1 assumes the LCS QoS provided by AF indicate \"high-accuracy\", and NEF determines the location request is handled by GMLC.\n1b-2.\tThe NEF shall send a Ngmlc_Location_ProvideLocation Request to the GMLC with the group of UE identified by a group ID to indicate a bulk operation procedure. If deferred location is requested the NEF shall include an Event type to indicate that deferred location is requested and provides an LDR reference number (Notification Correlation ID) to be used for event reporting at steps 6b-1 and 11b-1. If immediate location is requested the NEF shall not provide an Event type to indicate that immediate location is requested and provides a Notification Correlation ID to be used for reporting at steps 6b-1.\n1c.\the NF (e.g. NWDAF) shall send a Ngmlc_Location_ProvideLocation Request to the GMLC with the group of UE identified by a group ID to indicate a bulk operation procedure.\n2a.\tIf deferred location is requested from the LCS Client, the GMLC responds with an acknowledgment.\n2b-1.\tThe GMLC responds with a Ngmlc_Location_ProvideLocation Response.\nGMLC may decide whether completely or partially (i.e. accept part of the UE(s) within the group identified by the group ID in step 1) reject the location request. If GMLC decides to partially reject the location request, GMLC will respond to the LCS client /AF with a proper error cause.\n2b-2.\tThe NEF acknowledges the execution of the Nnef_EventExposure_Subscribe.\n2c.\tIf deferred location is requested from the NF, the GMLC responds with an acknowledgment.\nSteps 3 to 5 are carried out once per UE.\n3.\tThe GMLC invokes a Nudm_SDM_Get (LCS privacy, SUPI) service operation towards the UDM to get the UE LCS privacy profile of the target UE. The GMLC checks the privacy settings. For the UE whose privacy setting does not allow it to be located, steps 4 and 5 are skipped. The GMLC may also subscribe to and receive notification of UE privacy profile updates according to steps 0 and 4 of clause 6.12.1.\n4.\tThe GMLC invokes a Nudm_UECM_Get service operation towards the UDM of the target UE with SUPI of this UE. The UDM returns the current serving AMF ID to the GMLC.\n5a.\tIf no AMF ID is returned at step 4:\n-\tif it is a deferred location request and the GMLC supports the storage of the LCS service request for a group of UE, the GMLC subscribes the UE reachability status to the UDM using Nudm_EventExposure_Subscribe service operation with the data key \"SUPI\";\n-\totherwise, this step is skipped and the GMLC returns an appropriate error cause to the LCS client or NEF at step 6.\n5b.\tIf the UDM returns the current serving AMF ID to the GMLC at step 4:\n-\tthe GMLC initiates 5GC_MT_LR procedure (from step 4 onwards) as described in clause 6.1.2, with the difference that Step 24 is skipped (as it is replaced by step 6 below); The GMLC shall not include the Notification Correlation ID received from NEF in step 1b-2.\n-\tor the GMLC initiates Deferred 5GC-MT-LR Procedure (from step 4 onwards) as described in clause 6.3.1 with the difference that steps 8,21 and 30 are skipped (as it is replaced by steps 2, 6 and 11 below) and that GMLC assign LDR reference numbers (separate number for each UE) to be used for event reporting at steps 20 and 29.\n6a.\tThe GMLC receives response messages as defined in clause 6.1.2 step 22 or 23 or GMLC receives notification messages as defined in clause 6.3.1 step 28 or 29. The GMLC sends one or more LCS Service Responses to the LCS Client to convey UE locations or event reports.\n6b-1.\tThe GMLC receives response messages as defined in clause 6.1.2 step 22 or 23 or GMLC receives notification messages as defined in clause 6.3.1 step 28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and invokes one or more Ngmlc_Location_EventNotify service operations towards the NEF to convey UE locations or event reports. GMLC may aggregate one or more UE location estimates / event reports in each message sent to NEF.\n6b-2.\tThe NEF invokes one or more Nnef_EventExposure_Notify service operations towards the AF, to convey UE locations or event reports , received from GMLC in step 6b-1.\n6c.\tThe GMLC receives response messages as defined in clause 6.1.2 step 22 or 23 or GMLC receives notification messages as defined in clause 6.3.1 steps 28 or 29. The GMLC sends one or more Ngmlc_Location_EventNotify to the NF to convey UE locations or event reports.\n7.\tFor the deferred location request, if any UE in the group didn't get its serving AMF ID at step 4, the GMLC may store the LCS service request locally if the GMLC supports the storage of the LCS service request for a group of UE; otherwise, this step is skipped.\nFurther steps apply to the UEs of the group who was not registered to the network when the LCS service request is received at GMLC.\n8.\tUE performs the registration as described in clause 4.2.2 of TS 23.502, during which an AMF is selected to serve the UE, and the AMF ID is stored into UDM.\n9.\tUDM notifies the GMLC who had subscribed the UE registration at step 5a using Nudm_EventExposure_Notify service operation, which includes \"SUPI\" and UE registration status.\n10.\tGMLC initiates Deferred 5GC-MT-LR Procedure as described in step 5b.\n11a.\tThe GMLC receives notification messages as defined in clause 6.3.1 step 28 or 29. The GMLC sends one or more LCS Service Responses to the LCS Client to convey UE locations or event reports.\n11b-1.\tThe GMLC receives notification messages as defined in clause 6.3.1 step 28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and invokes one or more Ngmlc_Location_EventNotify service operations towards the NEF to convey UE locations or event reports. GMLC may aggregate one or more UE location estimates / event reports in each message sent to NEF.\n11b-2.\tThe NEF invokes one or more Nnef_EventExposure_Notify service operations towards the AF, to convey event reports received from GMLC in step 11b-1.\n11c.\tThe GMLC receives notification messages as defined in clause 6.3.1 steps 28 or 29. The GMLC sends one or more Ngmlc_Location_EventNotify to the NF to convey UE locations or event reports.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2",
        "clause_6.3.1",
        "clause_6.12.1",
        "ts_23.502_clause_4.2.2",
        "figure_6.8-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.9.1",
      "section_id": "6.9.1",
      "section_title": "Common Positioning Procedures when a UE is served by only one PLMN",
      "content": "Figure 6.9.1-1 shows the common positioning procedures to support location services with non-3GPP access when UE is served by only one PLMN, which provides either non-3GPP access only or both 3GPP access and non-3GPP access. The common positioning procedures can be triggered by:\n-\t5GC-NI-LR procedure (described in clause 6.10.1), which assumes that the serving AMF is aware of the emergency session initiation - e.g. due to supporting an Emergency Registration procedure or assisting in establishing an emergency PDU Session. If such emergency session procedure is initiated via non-3GPP access, the AMF provides access type to LMF in step 2 in clause 6.10.1,the LMF shall use the access type provided by AMF in step 2 in clause 6.9.1; or\n-\t5GC-MT-LR procedure (described in clause 6.1.1 and 6.1.2 and 6.10.2), which is applicable to a request from an LCS client for a current location.\n-\t5GC-MO-LR procedure (described in clause 6.2), for this case, the access type is selected by the UE using the UE Local Configuration to initiate MO-LR procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2 with following differences:\n-\tThe AMF shall in step 4 of clause 6.2 include UE connectivity state per access type.\n-\tIn step 5 of clause 6.2 the modification in this clause shall be applied, the LMF shall also determine positioning methods and the positioning access type, which can be different with the access type selected by the UE.\n-\tDeferred 5GC-MT-LR procedure for periodic, triggered and UE available location events (described in clause 6.3.1), which is applicable to report of location event for a deferred 5GC-MT-LR procedure.\n-\tUnified Location Service Exposure Procedure (described in clause 6.5), which allows an NEF to provide location service exposure to an NF in HPLMN or to an external AF outside the HPLMN when requested by the NF or the AF.\nFigure 6.9.1-1: Common positioning procedures when UE is served by the one PLMN\n1.\tThe AMF invokes the Nlmf_Location_DetermineLocation service operation towards the LMF to request the current location of the UE, which includes the QoS requirement and UE connectivity state per access type.\n2.\tThe LMF determines the positioning access type and the positioning method based on the UE/network positioning capability, the QoS requirement and UE connectivity state per access type received from the AMF and the locally configured operator policy. The LMF may also determine the access type for transmission of an LPP message to the UE (e.g. in order to ensure the UE will be in a connected state for the selected positioning access type).\nWhen the LPP protocol in TS 37.355 [20] is determined to be used to obtain location information from the UE and the UE has both 3GPP and non-3GPP access, the AMF shall decide which access type should be used to transmit the location information if the LMF did not select an access type. For example, if the UE is in CM-IDLE state in 3GPP access and in CM-CONNECTED state in Non-3GPP access, AMF may prefer to select the N3IWF/TNGF/W-AGF to relay positioning signalling to UE, rather than performing paging procedures via the 3GPP access.\nWhen the NRPPa protocol in TS 38.455 [15] is determined to be used to obtain location information from the NG-RAN or N3IWF/TNGF/W-AGF:\n-\tIn the case that 3GPP Access is determined to be used to transmit the location information, the Network Assisted Positioning procedure in step 3b and/or the obtaining Non-UE Associated Network Assistance Data procedure in step 3c shall be performed.\n-\tIn the case that non-3GPP Access is determined to be used to obtain the location information, the Network Assisted Positioning procedure in step 3e shall be performed.\nWhen the LPP protocol in TS 37.355 [20] is determined to be used to obtain location information from the UE:\n-\tIn the case that 3GPP Access is determined to be used to relay the location information, the UE Assisted and UE Based Positioning procedure in step 3a shall be performed.\n-\tIn the case that non-3GPP Access is determined to be used to relay the location information, the UE Assisted and UE Based Positioning procedure in step 3d shall be performed.\n3a.\tThis step is same as the UE Assisted and UE Based Positioning procedure in clause 6.11.1.\n3b.\tThis step is same as the Network Assisted Positioning procedure in clause 6.11.2 with the difference that step 1 of clause 6.11.2 includes the selected Access Type (i.e. 3GPP access). The AMF forwards the Network Positioning message to the NG-RAN in step 3 of clause 6.11.2 based on the received Access Type.\n3c.\tThis step is same as the Obtaining Non-UE Associated Network Assistance Data procedure in clause 6.11.3.\n3d.\tThis step is same as the UE Assisted and UE Based Positioning procedure in clause 6.11.1 with the following difference:\n-\tThe NG-RAN in clause 6.11.1 is replaced by the N3IWF/TNGF/W-AGF in Figure 6.9.1-1;\n-\tSteps 2 and 5 in clause 6.11.1 are omitted;\n-\tThe location information returned by the UE can include information specified in clause 5.3.1.\n3e.\tThis step is same as the Network Assisted Positioning procedure in clause 6.11.2 with the following difference:\n-\tThe NG-RAN in clause 6.11.2 is replaced by the N3IWF/TNGF/W-AGF in Figure 6.9.1-1;\n-\tSteps 2 and 4 in clause 6.11.2 are omitted;\n-\tThe Access Type, i.e. non-3GPP access type, which is selected to provide the location information is included in step 1 of clause 6.11.2. The AMF forwards the Network Positioning message to the N3IWF/TNGF/W-AGF based on the received Access Type in step 1 of clause 6.11.2.\n-\tThe location information returned in step 5 of clause 6.11.2 is specified in clause 5.3.1.\nThe UE is replaced by 5G-RG in the case of wireline access type.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.10.1",
        "clause_6.9.1",
        "clause_6.1.1",
        "clause_6.2",
        "clause_6.3.1",
        "clause_6.5",
        "clause_6.11.1",
        "clause_6.11.2",
        "clause_6.11.3",
        "clause_5.3.1",
        "figure_6.9.1-1",
        "ts_37.355",
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.9.2",
      "section_id": "6.9.2",
      "section_title": "MT-LR Procedures when a UE is served by Different PLMNs for 3GPP Access and Non-3GPP Access",
      "content": "Figure 6.9.2-1 and Figure 6.9.2-2 show the enhanced MT-LR positioning procedures to support location service with non-3GPP access when the UE is served by different PLMNs for 3GPP access and non-3GPP access. The procedures can be triggered by the 5GC-MT-LR Procedures described in clause 6.1.1, clause 6.1.2 and clause 6.3, which are applicable to a request from an LCS client for an immediate current location or a deferred location.\nFigure 6.9.2-1: MT-LR positioning procedures when UE is served by the two VPLMNs\n1.\tThe step is same as step 1 in clause 6.1.1 or clause 6.3.1.\n2.\tThe step is same as step 2 in clause 6.1.1 or clause 6.3.1.\n3.\tThe step is same as step 3 in clause 6.1.1 or clause 6.3.1 with the difference that when the UE is served by more than one AMF the UDM provides to the HGMLC for each access type,\n-\tserving AMF identity with the corresponding PLMN Id,\n-\tpossibly a VGMLC address.\n4.\tWhen the HGMLC identifies that the UE is served by different PLMNs according to the returned information from the UDM in step 3 it may retrieve the CM state(s) per Access Type from the candidate AMFs by using Namf_EventExposure service, or from the UDM using Nudm_EventExposure service. The HGMLC selects one access type and its associated AMF based on the UDM returned information in step 3, QoS requirement, CM state(s) per Access type of the UE, PLMN identity and/or the locally configured operator policy.\nNOTE:\tThe locally configured operator policy in the HGMLC can include access type and CM state and PLMN priority for positioning. For example, the local policy can be 3GPP access first and/or connected state first and/or V-PLMN and/or H-PLMN first.\n5.\tThe HGMLC forwards the location request to the VGMLC-1 and may include the V-AMF-1 identity received in step 3 and the target UE identity (e.g. SUPI).\n6.\tThe VGMLC-1 invokes the Namf_Location_ProvideLocation_Request service operation to forward the location request to the V-AMF-1. Then the V-LMF-1 receives the location request from the V-AMF-1.\n7.\tThis step is same as step 2-3 of the Common Positioning Procedures in clause 6.9.1.\n8-9.\tThe VGMLC-1 receive the location service response from the V-LMF-1 and for a request for an immediate location, returns positioning results to the HGMLC. For an immediate location, the location service response contains positioning information, the information about the positioning method used and the indication of whether the obtained location estimate satisfies the requested LCS QoS (e.g. accuracy) or not (described in clause 9.1.1 of TS 23.271 [4]). For a request for a deferred location, the location service response indicates whether the location request was accepted.\n10.\tFor a request for an immediate location, if the HGMLC identifies that the location service response from the chosen PLMN meets required LCS QoS, it returns the results to the LCS Client directly. Otherwise, the HGMLC may forward the location request to another AMF (in another PLMN) so as to obtain the positioning result which can meet required LCS QoS shown as step 11. For a request for a deferred location, if the HGMLC identifies that location service was accepted (by the chosen PLMN), it returns this indication to the LCS Client directly. Otherwise, the HGMLC may forward the location request to another AMF (in another PLMN).\n11.\tThis step obtains the immediate positioning information or requests a deferred location from another PLMN, the details are the same as steps 5-9.\n12-13.\tThe HGMLC returns a location service response to the LCS client. For a request for immediate location, if the positioning result from the other PLMN meets the QoS requirement, the HGMLC returns it to the LCS client. Otherwise, the HGMLC returns final location service response without including any positioning result. For a request for deferred location, if the result from the other PLMN indicates acceptance of the location request, the HGMLC returns this to the LCS client. Otherwise, the HGMLC returns a final location service response indicating failure of the deferred location request.\nFigure 6.9.2-2: MT-LR positioning procedures when UE is served by HPLMN and VPLMN\nFigure 6.9.2-2 shows the MT-LR positioning procedures when the UE is served by the H-PLMN and a V-PLMN. The difference with procedures shown in Figure 6.9.2-1 is that the HGMLC interacts with AMF directly shown in step 11 of Figure 6.9.2-2 without involving VGMLC shown in step 11 of Figure 6.9.2-1. In scenarios where the HGMLC prioritizes location by the H-PLMN rather than V-PLMN at step 4, steps 5-9 may be replaced by step 11 and step 11 (when step 11 occurs) is then replaced by steps 5-9.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1.1",
        "clause_6.1.2",
        "clause_6.3",
        "clause_6.3.1",
        "clause_6.9.1",
        "ts_23.271_clause_9.1.1",
        "figure_6.9.2-1",
        "figure_6.9.2-2",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.9.3",
      "section_id": "6.9.3",
      "section_title": "MO-LR Procedures when UE is served by the Different PLMNs via 3GPP Access and Non-3GPP Access",
      "content": "When UE is served by the different PLMNs via 3GPP access and Non-3GPP access, UE uses the UE Local Configuration to select the access to initiate MO-LR procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2. If Non-3GPP access is selected, the following difference exists:\n-\tThe NG-RAN in 5GC-MO-LR Procedure in clause 6.2 is corresponding to the N3IWF/TNGF;\n-\tStep 5 in 5GC-MO-LR Procedure in clause 6.2 is the same as step 3d or 3e in Common Positioning Procedure when UE is served by the same PLMN in clause 6.9.1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.2",
        "clause_6.9.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.9.4",
      "section_id": "6.9.4",
      "section_title": "NI-LR Procedures when a UE is served by Different PLMNs for 3GPP access and non-3GPP access",
      "content": "When UE is served by the different PLMNs via 3GPP access and non-3GPP access, the UE selects one access to register to the 5GC for emergency services as defined in TS 23.167 [10], or request the establishment of a PDU Session related to an emergency session.\nThe NI-LR procedures are the same as the 5GC-NI-LR Procedure (described in clause 6.10.1) with the difference that:\n-\tif the procedures are performed for non-3GPP access, NG-RAN in Figure 6.10.1 is replaced by an N3IWF/TNGF/W-AGF and the UE Positioning in step 3 in Figure 6.10.1 is performed according to steps 3d and 3e in Figure 6.9.1-1.\n-\tIn step 2 in 5GC-NI-LR Procedure in clause 6.10.1, AMF also provides access type to LMF. LMF shall use the access type provided by AMF for positioning.\nThe UE is replaced by 5G-RG in the case of wireline access type.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.10.1",
        "figure_6.10.1",
        "figure_6.9.1-1",
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.10.1",
      "section_id": "6.10.1",
      "section_title": "5GC-NI-LR Procedure",
      "content": "Figure 6.10.1-1 shows a Network Induced Location Request (NI-LR) procedure for a UE in the case where the UE initiates an emergency session or other session using NG-RAN. The procedure assumes that the serving AMF is aware of the regulatory service associated with the session (e.g. emergency session initiation - e.g. due to supporting an Emergency Registration procedure or assisting in establishing an emergency PDU Session). The procedure can also be used to verify UE location for NR satellite access.\nFigure 6.10.1-1: 5GC Network Induced Location Request (5GC-NI-LR) for a UE\n1.\tA trigger for AMF to initiate the 5GC-NI-LR procedure happens, e.g. the UE registers to the 5GC for emergency services or requests the establishment of a PDU Session related to an applicable regulatory service (e.g. emergency session initiation) or the AMF decides to verify UE location via LCS procedure for a UE registered for NR satellite access.\n2.\tFor verifying UE location via LCS service for NR satellite access this step is mandatory, for other triggers this step is optional. The AMF selects an LMF based on NRF query or configuration in AMF and invokes the Nlmf_Location_DetermineLocation service operation towards the LMF to request the current location of the UE. The service operation includes a LCS Correlation identifier, the serving cell identity of the Primary Cell in the Master RAN node and the Primary Cell in the Secondary RAN node when available based on Dual Connectivity scenarios, and an indication of a location request from a regulatory services client (e.g. emergency services) and may include an indication if UE supports LPP, the required QoS and Supported GAD shapes, the UE Positioning Capability if available. When AMF needs to know the geographical area of the UE to check whether the PLMN is allowed to operate in the area, an indication of this is included. When AMF needs to verify the location of the UE when a UE registers via NR satellite access, the AMF includes in indication in the request to the LMF that the request is for UE location verification. If any of the procedures in clause 6.11.1 or 6.11.2 are used the service operation includes the AMF identity. Optionally, the AMF may also request UE related analytics containing UE location information (e.g., UE mobility analytics) from NWDAF to assist with UE location verification for NR satellite access as described in clause 6.21.2.\n3.\t[Conditional] If step 2 occurs, the LMF performs one or more of the positioning procedures described in clause 6.11.1, 6.11.2 and 6.11.3. If the AMF included an indication at step 2, the LMF maps the UE location to a geographical area where a PLMN is or is not allowed to operate.\n4.\t[Conditional] If step 3 occurs, the LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the current location of the UE. The service operation includes the LCS Correlation identifier, the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate. The service operation also includes the UE Positioning Capability if the UE Positioning Capability is received in step 3 including an indication that the capabilities are non-variable and not received from AMF in step 2. When UE geographical area determination for location verification is indicated at step 2, the service operation also returns the geographical area where a PLMN is or is not allowed to operate determined at step 3.\nNOTE 1:\tAny remaining procedures for regulatory services other than emergency services are not addressed in this flow. The remaining steps are applicable for emergency services.\n5.\t[Conditional] For emergency services, the AMF selects an GMLC based on NRF query or configuration in AMF. The information regarding the endpoint in the GMLC to deliver the event notification, is obtained from the NRF as specified in clause 7.1.2 of TS 23.501 [18] or from local configuration in the AMF. AMF invokes the Namf_Location_EventNotify service operation towards the selected GMLC to notify the GMLC of an emergency session initiation. The service operation includes the SUPI or the PEI, and the GPSI if available, the identity of the AMF, an indication of an emergency session and any location obtained in step 3.\n6.\t[Conditional] For emergency services, the GMLC forwards the location to an external emergency services client or may wait for a request for the location from the external emergency services client (not shown in Figure 6.10.1-1) before forwarding the location.\n7.\t[Conditional] For emergency services, the emergency services session and emergency PDU Session are released.\n8.\t[Conditional] For emergency services, the AMF invokes the Namf_Location_EventNotify service operation towards the GMLC to notify the GMLC that the emergency session was released to enable the GMLC and LRF to release any resources associated with the emergency session.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.11.1",
        "clause_6.21.2",
        "ts_23.501_clause_7.1.2",
        "figure_6.10.1-1",
        "ts_23.501"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.10.2",
      "section_id": "6.10.2",
      "section_title": "5GC-MT-LR Procedure without UDM Query",
      "content": "Figure 6.10.2-1 illustrates a location request for an emergency services session, where an emergency services client (e.g. a Public Safety Answering Point) identifies the target UE and the serving LRF using correlation information that was previously provided to it by the IMS Core. The signalling used to provide the correlation information to the PSAP is defined in TS 23.167 [10]. The correlation information may be used by the LRF to retrieve other information previously provided to it by the IMS Core and/or AMF as described for Figure 6.10.1-1. This allows the GMLC associated with the LRF to request a location from the AMF without needing to query the UDM of the target UE for the serving AMF address. This scenario therefore supports location of emergency sessions from roamers and USIM-less and other non-registered UEs, and requires that identifying information for the UE and AMF have been provided to the GMLC/LRF as described in clauses 6.10.1 and 6.10.3.\nFigure 6.10.2-1: 5GC-MT-LR Procedure without UDM Query\n1.\tThe external emergency services client (e.g. a PSAP) sends a request to the LRF for a location for the target UE and includes correlation information identifying the target UE. The request may include the required QoS and Supported GAD shapes. The LRF address and the correlation information would have been previously provided to the external client when the emergency session from the UE was established.\n2.\tThe LRF/GMLC determines the AMF by associating the correlation information received from the external client with other information received previously from the AMF as described in step 5 of clause 6.10.1 and step 7 of clause 6.10.3. The GMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF to request the current location of the UE. The service operation includes the SUPI or the PEI or GPSI and an indication of a location request from an emergency services client and may include the required QoS and Supported GAD shapes. The AMF identifies the target UE using the SUPI or in the case of a USIM-less emergency session, or non-registered USIM emergency session, the PEI.\n3.\tThe AMF selects an LMF based on NRF query or configuration in AMF and invokes the Nlmf_Location_DetermineLocation service operation towards the LMF to request the current location of the UE. The service operation includes a LCS Correlation identifier, the serving cell identity and an indication of a location request from an emergency services client and may include an indication if UE supports LPP, the required QoS and Supported GAD shapes, UE Positioning Capability if available. If any of the procedures in clause 6.11.1 or clause 6.11.2 are used the service operation includes the AMF identity.\n4.\tThe LMF performs one or more of the positioning procedures described in clauses 6.11.1, 6.11.2 and 6.11.3.\n5.\tThe LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the current location of the UE. The service operation includes the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate. The service operation also includes the UE Positioning Capability if the UE Positioning Capability is received in step 4 including an indication that the capabilities are non-variable and not received from AMF in step 3.\n6.\tThe AMF returns the Namf_Location_ProvidePositioningInfo Response towards the GMLC/LRF to return the current location of the UE. The service operation includes the LCS Correlation identifier, the location estimate, its age and accuracy and may include information about the positioning method and the timestamp of the location estimate.\n7.\tThe LRF sends the location service response to the external emergency services client.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.10.1",
        "clause_6.10.3",
        "clause_6.11.1",
        "clause_6.11.2",
        "figure_6.10.2-1",
        "figure_6.10.1-1",
        "ts_23.167"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.10.3",
      "section_id": "6.10.3",
      "section_title": "Location continuity for Handover of an Emergency session from NG-RAN",
      "content": "Figure 6.10.3-1 shows support for location continuity for handover of an emergency session from NG-RAN on the source side to either NG-RAN or another 3GPP RAN on the target side. The procedure applies when control plane location according to Figures 6.10.1-1 and 6.10.2-1 is used for location of the UE on the source side. The procedure is based on the procedures for location continuity currently defined in clause 9.4.5.4 of TS 23.271 [4].\nNOTE:\tIf User Plane (SUPL) Location Protocol [49] is used on the source (NG-RAN) side, then the current procedure for location continuity in TS 23.271 [4] can be used.\nFigure 6.10.3-1: Location Continuity for Handover of an Emergency session from NG-RAN\n1.\tFollowing the request for an emergency session, the UE establishes a PDU Session for emergency services and an IMS emergency session for NG-RAN access, during which an LRF is assigned in the serving network IMS and a source GMLC may be chosen. The 5GC-NI-LR procedure of Figure 6.10.1-1 is also performed which provides the source AMF identity to the GMLC and LRF and optionally an initial location for the UE.\n2.\tAt some later time, the LRF may need the UE location and requests the source GMLC to invoke the Namf_Location_ProvidePositioningInfo service operation towards the AMF to request the current location of the UE. The service operation includes the SUPI or the PEI, the required QoS and an indication of a location request from an emergency services client.\n3.\tIf step 2 occurs or if support for an NI-LR is required, the source AMF starts a location session to obtain the location of the UE as described in clause 6.10.2 or clause 6.10.1.\n4.\tThe source AMF receives a request to handover the UE to a cell associated with a different target node which may be another AMF for intra-RAN handover or a different type of node (e.g. an MME) for inter-RAN handover (e.g. to E-UTRAN connected to EPC).\n5.\tThe handover procedure is executed as specified in clause 4.9.1.3 of TS 23.502 [19].\n6.\tAny location session started in step 3 may terminate normally before step 6. If not, the source AMF shall abort the location session once step 5 is complete.\n7a.\tIf steps 2 and 3 has occurred, the source AMF returns the Namf_Location_ProvidePositioningInfo Response towards the GMLC to return any location estimate and the timestamp of the location estimate (if available) obtained for the UE. The service operation includes the target node identity.\n7b.\tIf steps 2 and 7a do not occur, the source AMF may invoke the Namf_Location_EventNotify service operation towards the source GMLC (i.e. the GMLC used in step 1) to indicate the handover. The service operation includes the SUPI or the PEI and the GPSI if available, an event type indicating handover and the identity of the target node.\n8a.\tFor inter-RAN handover (e.g. to E-UTRAN connected to EPC) and if control plane location will be used on the target side, the target node (e.g. MME) may send a Subscriber Location Report to a GMLC on the target side after completion of the handover in step 6. The Subscriber Location Report carries the UE identity (IMSI, MSISDN and/or IMEI), an event type indicating handover and the identity of the target node. The target node may determine the target GMLC from configuration information.\n8b.\tFor intra-RAN handover and if control plane location will be used on the target side, the target AMF may invoke the Namf_Location_EventNotify service operation towards the GMLC to indicate the handover. The service operation includes the SUPI or the PEI and the GPSI if available, an event type indicating handover and the identity of the target node.\n9.\tReconfiguration of the LRF and the source and target GMLCs may occur in a manner outside the scope of 3GPP.\n10.\tIf the LRF needs a location estimate for the UE after handover has occurred and if control plane location is used on the target side, the LRF may instigate an MT-LR request via the target Node.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.4.5.4",
        "clause_6.10.2",
        "clause_6.10.1",
        "ts_23.502_clause_4.9.1.3",
        "figure_6.10.3-1",
        "ts_23.271_figure_6.10.3-1",
        "figure_6.10.1-1",
        "ts_23.271",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.10.4",
      "section_id": "6.10.4",
      "section_title": "5GC-MT-LR multiple location procedure without UDM Query",
      "content": "Figure 6.10.4-1 illustrates an extension procedure of 5GC-MT-LR procedure without UDM Query for the regulatory location service defined in clause 6.10.2.\nThis procedure is applicable for providing multiple location estimates of the target UE to emergency services client.\nFigure 6.10.4-1: 5GC-MT-LR Multiple Location Procedure without UDM Query\n1.\tSteps 1-3 for 5GC-MT-LR procedure without UDM Query in clause 6.10.2 are performed with the following differences:\n-\tAt step 1 in clause 6.10.2 the request from external emergency client (e.g. a PSAP) location services client may include the acceptance of INTERMEDIATE response and maximum response time.\n-\tAt step 2 in clause 6.10.2 Namf_Location_ProvidePositioningInfo service operation invoked by GMLC may include the acceptance of INTERMEDIATE response and maximum response time, GMLC contact address and LIR reference number. The LIR reference number is allocated by GMLC based on predefined rule.\n-\tAt step 3 in clause 6.10.2 Nlmf_Location_DetermineLocation service operation invoked by AMF may include the acceptance of INTERMEDIATE response and maximum response time, GMLC contact address, and LIR reference number. AMF can overwrite maximum response time to avoid timeout.\n2.\tLMF performs positioning procedures and determines multiple location estimates during the session.\n2.1\tThis step is executed if INTERMEDIATE response is available. The LMF invokes an Nlmf_Location_EventNotify service operation towards GMLC and provides the INTERMEDIATE location of the UE and timestamp of the location estimate, and LIR reference number, and INTERMEDIATE event type.\n2.2\tThis step is executed if step 2.1 was executed. The GMLC sends the INTERMEDIATE location of the UE and timestamp of the location estimate to external location services client.\n3.\tBased on step 5 in clause 6.10.2 the LMF returns the Nlmf_Location_DetermineLocation Response towards the AMF to return the FINAL location of the UE. LMF ensures that FINAL location will be transferred towards AMF within the maximum response time.\n4.\tSteps 6-7 for 5GC-MT-LR procedure without UDM Query in clause 6.10.2 are performed with the following differences:\n-\tAt step 7 the FINAL location is sent from GMLC to the external services client.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.10.2",
        "figure_6.10.4-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.11.0",
      "section_id": "6.11.0",
      "section_title": "General",
      "content": "The procedures defined in clause 6.11 are applicable to both a UE and PRU. Wherever, a UE is referenced in these procedures, a PRU may be used instead.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.11"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.11.1",
      "section_id": "6.11.1",
      "section_title": "UE Assisted and UE Based Positioning Procedure",
      "content": "Figure 6.11.1-1 shows a positioning procedure used by an LMF to support UE based positioning, UE assisted positioning and delivery of assistance data. The procedure is based on use of the LPP protocol defined in TS 37.355 [20] between the LMF and UE.\nFigure 6.11.1-1: UE Assisted and UE Based Positioning Procedure\nPrecondition:\tA LCS Correlation identifier and the AMF identity has been passed to the LMF by the serving AMF.\n1.\tThe LMF invokes the Namf_Communication_N1N2MessageTransfer service operation towards the AMF to request the transfer of a Downlink (DL) Positioning message to the UE. The service operation includes the DL Positioning message. The Session ID parameter of the Namf_Communication_N1N2MessageTransfer service operation is set to the LCS Correlation identifier. The Downlink Positioning message may request location information from the UE, provide assistance data to the UE or query for the UE capabilities if the UE Positioning Capability is not received from AMF.\n2.\tIf the UE is in CM IDLE state, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.\n3.\tThe AMF forwards the Downlink Positioning message to the UE in a DL NAS TRANSPORT message. The AMF includes a Routing identifier, in the DL NAS TRANSPORT message, which is set to the LCS Correlation identifier. The Downlink Positioning message may request the UE to response to the network, e.g. may request the UE to acknowledge the Downlink Positioning message, to return location information or to return capabilities, as defined in TS 37.355 [20].\n4.\tThe UE stores any assistance data provided in the Downlink Positioning message and performs any positioning measurements and/or location computation requested by the Downlink Positioning message.\n5.\tIf the UE has entered CM-IDLE state during step 4 and needs to responses to the request received in step 3, the UE instigates the UE triggered Service Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a signalling connection with the AMF.\n6.\t[Conditional] The UE sends to the AMF the Uplink Positioning message included in a NAS TRANSPORT message, e.g. to acknowledge the Downlink Positioning message, to return any location information obtained in step 4 or returns any capabilities, as requested in step 3. When the UE sends Uplink Positioning message in a NAS TRANSPORT message, the UE shall also include in the UL NAS TRANSPORT message the Routing identifier received in step 3.\n7.\t[Conditional] The AMF invokes the Namf_Communication_N1MessageNotify service operation towards the LMF indicated by the routing identifier received in step 6. The service operation includes the Uplink Positioning message received in step 6 and the LCS Correlation identifier. Steps 6 and 7 may be repeated if the UE needs to send multiple Uplink Positioning messages to respond to the request received in Step 3. Steps 1 to 7 may be repeated to send new assistance data, and to request further location information and further UE capabilities.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.2.3.3",
        "ts_23.502_clause_4.2.3.2",
        "figure_6.11.1-1",
        "ts_37.355",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.11.2",
      "section_id": "6.11.2",
      "section_title": "Network Assisted Positioning Procedure",
      "content": "Figure 6.11.2-1 shows a procedure that may be used by an LMF to support network assisted and network based positioning. The procedure may be based on UE associated NRPPa  signalling in TS 38.455 [15] between the LMF and NG-RAN.\nFigure 6.11.2-1: Network Assisted Positioning Procedure\nPrecondition:\tA LCS Correlation identifier and the AMF identity have been passed to the LMF by the serving AMF. In the case of PRU, LCS Correlation identifier is generated by LMF and provided to AMF during PRU Registration Accept message.\n1.\tThe LMF invokes the Namf_Communication_N1N2MessageTransfer service operation towards the AMF to request the transfer of a Network Positioning message to the serving NG-RAN node (gNB or ng-eNB) for the UE. The service operation includes the Network Positioning message and may indicate if the positioning is initiated towards a PRU and the LCS Correlation identifier. The Network Positioning message may request location information for the UE from the NG-RAN and may include UE unaware indication if it is received by LMF from AMF. LMF may provide an LPHAP Assistance Information to RAN in an NRPPa message, if LPHAP indication is received in step 11 clause 6.1.2.\n2.\tIf the UE is in CM IDLE state and there is no UE unaware indication for the UE in the UE's location context, the AMF initiates a network triggered Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19], to establish a signalling connection with the UE. If positioning towards a PRU is indicated in step 1, the AMF verifies the UE is a valid PRU before initiating the procedure.\nIf the UE is in CM-IDLE state and there is UE unaware indication for the UE in the UE's location context, the AMF should reject the forwarding request of the Network Positioning message with a proper rejection cause value and steps 3-6 are skipped.\n3.\tThe AMF forwards the Network Positioning message to the serving NG-RAN node in an N2 Transport message. The AMF includes a Routing identifier, in the N2 Transport message, identifying the LMF.\n4.\tThe serving NG-RAN node obtains any location information for the UE requested in step 3.\nIf UE unaware indication is received in the Network Positioning message, and the UE is in RRC_INACTIVE state, the NG-RAN rejects the Network Positioning message with appropriate rejection cause (e.g. UE cannot be paged).\n5.\tThe serving NG-RAN node returns any location information obtained in step 4 to the AMF in a Network Positioning message included in an N2 Transport message. The serving NG-RAN node shall also include the Routing identifier in the N2 Transport message received in step 3.\n6.\tThe AMF invokes the Namf_Communication_N2InfoNotify service towards the LMF indicated by the routing identifier received in step 5. The service operation includes the Network Positioning message received in step 5 and the LCS Correlation identifier. Steps 1 to 6 may be repeated to request further location information and further NG-RAN capabilities.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1.2",
        "ts_23.502_clause_4.2.3.3",
        "figure_6.11.2-1",
        "ts_38.455",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.11.3",
      "section_id": "6.11.3",
      "section_title": "Obtaining Non-UE Associated Network Assistance Data",
      "content": "Figure 6.11.3-1 shows a procedure which may be used by an LMF to support network assisted and network based positioning. This procedure is not associated with a UE location session. It is used to obtain network assistance data from a NG-RAN node (e.g. gNB or ng-eNB). The procedure may be based on non-UE associated NRPPa signalling in TS 38.455 [15] between the LMF and NG-RAN.\nFigure 6.11.3-1: Procedure for Obtaining Non-UE Associated Network Assistance Data\nNOTE 1:\tIt is not required that serving AMF to be used in this procedure. To support location service in the PNI-NPN, local AMF is used instead of serving AMF, as defined in clause 5.13.\n1.\tThe LMF invokes the Namf_Communication_NonUeN2MessageTransfer service operation towards the AMF to request the transfer of a Network Positioning message to a NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation includes the Network Positioning message and the target NG-RAN node identity. The Network Positioning message may request position related information from the NG-RAN.\n2.\tThe AMF forwards the Network Positioning message to the target NG-RAN node indicated in step 1 in an N2 Transport message. The AMF includes a Routing identifier, in the N2 Transport message, identifying the LMF.\n3.\tThe target NG-RAN node obtains any position related information requested in step 2.\n4.\tThe target NG-RAN node returns any position related information obtained in step 3 to the AMF in a Network Positioning message included in an N2 Transport message. The target NG-RAN node shall also include the Routing identifier in the N2 Transport message received in step 2.\n5.\tThe AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation towards the LMF indicated by the routing identifier received in step 4. The service operation includes the Network Positioning message received in step 4. Steps 1 to 5 may be repeated to request further position related information from the NG-RAN.\nNOTE 2:\tLCS Correlation ID is not applicable to this procedure.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.13",
        "figure_6.11.3-1",
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.11.4",
      "section_id": "6.11.4",
      "section_title": "Positioning Procedure over User Plane",
      "content": "The flow below shows a positioning procedure used by an LMF and/or UE over User Plane. The procedure is based on use of the LPP protocol defined in TS 37.355 [20] between the LMF and UE. Prerequisite of this procedures is User Plane establishment between UE and LMF described in in clause 6.18.\nFigure 6.11.4-1: Positioning Procedure over User Plane\n1.\t[Optional] The UE or LMF use the Secure UP transfer one or multiple LPP message(s). If LMF starts the procedure the LMF may request location information and/or measurements from the UE, and/or provide assistance data to/from the UE and/or query for the capabilities; if UE starts procedure, UE may request assistance data from LMF and/or providing location data and/or capability information to LMF.\n2.\t[Optional] The UE or LMF processes capabilities information, assistance data, and/or location measurements/calculations.\n3.\t[Optional] The UE or LMF may send one or multiple LPP message(s) using the Secure UP transfer.\nNOTE:\tStep 1, step 2 and step 3 can occur in any order, sequentially or concurrently.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.18",
        "figure_6.11.4-1",
        "ts_37.355"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.12.1",
      "section_id": "6.12.1",
      "section_title": "UE Location Privacy Setting Procedure Initiated by UE",
      "content": "Figure 6.12.1-1: UE Location Privacy Setting procedure initiated by UE\n0.\tNF (e.g. GMLC, NEF) may subscribe to UDM notifications of UE LCS privacy profile updates.\nNOTE:\tNF can decide to subscribe to such notifications while a deferred location request is on-going.\n1.\tIf the UE has generated or updated the UE Location Privacy Indication, the UE sends the Location Privacy Indication to the AMF via UE Location Privacy Setting Request in N1 NAS message. The UE Location Privacy Indication indicates whether allows or disallows the subsequent LCS requests for the UE, as defined in clause 5.4. If the UE has generated or updated the event report expected area and optionally the area usage indication, e.g. based on UE power status, the UE Location Privacy Setting Request includes the event report expected area and the area usage indication.\n2.\tThe AMF invokes a Nudm_ParameterProvision_Update (LCS privacy) service operation towards the UDM and the service operation carries the Location Privacy Indication information and may include event report expected area and the area usage indication. The UDM stores or updates the UE LCS privacy profile in the UDR by invoking a Nudr_DM_Update (SUPI, Subscription Data) service operation accordingly.\n3.\tThe AMF responses to the UE via UE Location Privacy Setting Response in N1 NAS message.\n4.\tUDM notifies the subscribed Network Function (e.g. GMLC, NEF) of the updated UE LCS privacy profile via Nudm_SDM_Notification Notify message.\n5.\tNF (e.g. GMLC, NEF) may unsubscribe to UDM notifications of UE LCS privacy profile updates e.g. if a deferred location procedure is cancelled.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.4",
        "figure_6.12.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.12.2",
      "section_id": "6.12.2",
      "section_title": "UE Location Privacy Setting Procedure Initiated by AF",
      "content": "The procedure is defined by using the procedure in clause 4.15.6.2 of TS 23.502 [19] to set the Location Privacy Indication parameters and should in addition unsubscribe to UDM notifications of UE LCS privacy profile updates e.g. if a deferred location procedure is cancelled.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.502_clause_4.15.6.2",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.13.1",
      "section_id": "6.13.1",
      "section_title": "MT-LR Procedure",
      "content": "Figure 6.13.1-1 illustrates network positioning requested by the LCS clients or the AF external to the PLMN for the case where the LCS Client or AF is associated with a GMLC in 5GC domain and the UE is served by the EPC domain. Both non-roaming and roaming scenarios are described. For non-roaming scenario both the case of separate EPC GMLC and 5GC GMLC connected with Lr reference point and the case with combined 5GC GMLC and EPC GMLC are described. For roaming scenario, the 5GC GMLC in the HPLMN uses NL3 to interconnect with the combined 5GC+EPCGMLC in the VPLMN.\nFigure 6.13.1-1: MT-LR procedure with 5GC and EPC interaction\n1.\tSteps 1-3 in clause 6.1.2 are performed.\n2.\tFor non-roaming case and if 5GC GMLC and EPC GMLC are combined, steps 2a and 2b are skipped. Otherwise the 5GC GMLC may derive an address of a EPC GMLC or 5GC+EPC GMLC, either received together with the network address of the current serving node) from the UDM/HSS in step 1, by internal configuration or by query to NRF.\n2a.\tIf an address of a EPC GMLC is derived, the 5GC GMLC then sends the Lr location request to the EPC GMLC. If the result of privacy check indicates that the notification (and verification) based on current location is needed, the 5GC GMLC shall send a location request to the VGMLC indicating \"positioning allowed without notification\".\n2b.\tIf an address of an 5GC+EPC GMLC is derived, the 5GC GMLC invokes a Ngmlc_Location_ProvideLocation service operation towards the 5GC+EPC GMLC. If the result of privacy check indicates that the notification (and verification) based on current location is needed, the 5GC GMLC invokes the service request indicating \"positioning allowed without notification\"\n3\tSteps 2-9 or 9b in clause 9.1.15 of TS 23.271 [4] are performed.\n4.\tFor non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 4a and 4b are skipped. Otherwise the following applies:\n4a.\tIf step 2a was performed, the EPC GMLC forwards the location estimation of the target UE, its age, its accuracy and optionally the information about the positioning method to the 5GC GMLC.\n4b.\tIf step 2b was performed, the 5GC+EPC GMLC forwards the location estimation of the target UE, its age, its accuracy and optionally the information about the positioning method to the 5GC+EPC GMLC in a Ngmlc_Location_ProvideLocation service Response.\n5.\tIf the privacy check in step 1 indicates that further privacy checks are needed, the 5GC GMLC shall perform an additional privacy check in order to decide whether the 5GC GMLC can forward the location information to the LCS client or AF or send a notification if the result of the privacy check requires the notification and verification based on current location. One example when this additional privacy check is needed is when the target UE user has defined different privacy settings for different geographical locations. When an additional privacy check is not needed, the (H)GMLC skips steps 6-8.\n6.\tFor non-roaming case and if5GC GMLC and EPC GMLC are combined, step 6a and 6b are skipped. Otherwise the following applies:\n6a.\tIf step 2a was performed and if the result of privacy checks in step 5 indicates that the notification (and verification) based on current location is needed, and in the case of roaming, the 5GC GMLC shall send a location request to the EPC GMLC indicating \"notification only\".\n6b.\tIf step 2b was performed and if the result of privacy checks in step 5 indicates that the notification (and verification) based on current location is needed, and in the case of roaming, the 5GC GMLC shall invokes a Ngmlc_Location_ProvideLocation service operation to the 5GC+EPC GMLC indicating \"notification only\".\n7.\tThe EPC post positioning notification and verification procedure in clause 9.1.18 of TS 23.271 [4] is performed.\n8.\tFor non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 8a and 8b are skipped. Otherwise the following applies:\n8a.\tIf step 2a was performed, the EPC GMLC forwards an indication of the result of notification and verification procedure to the 5GC GMLC.\n8b.\tIf step 2b was performed, the 5GC+EPC GMLC forwards an indication of the result of notification and verification procedure to the 5GC GMLC.\n9.\tSteps 24 in clause 6.1.2 are performed.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.1.2",
        "ts_23.271_clause_9.1.15",
        "ts_23.271_clause_9.1.18",
        "figure_6.13.1-1",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.13.2",
      "section_id": "6.13.2",
      "section_title": "MO-LR Transfer to a Third Party Procedure",
      "content": "Figure 6.13.2-1 illustrates the UE requesting its location to be sent to a Third Party (i.e. an external LCS Client) for the case where the LCS Client is associated with a GMLC in 5GC domain and the UE is served by the EPC domain. Both non-roaming and roaming scenarios are described. For non-roaming scenario both the case of separate 5GC GMLC and EPC GMLC connected with Lr reference point and the case with co-located 5GC GMLC and EPC GMLC are described. For roaming scenario, when the combined 5GC GMLC and EPC GMLC are deployed in the HPLMN, it uses NL3 to interconnect with the EPCGMLC in the VPLMN.\nFigure 6.13.2-1: MO-LR procedure with 5GC and EPC interaction\n1Steps 1-6 in clause 9.2.6 of TS 23.271 [4] are performed.\n2.\tFor non-roaming case and if 5GC GMLC and EPC GMLC is combined, this step is skipped. Otherwise the EPC GMLC sends Location Update Notification Request towards to the 5GC GMLC including the information received in step 1.\n3\tSteps 9-10 in clause 6.2 are performed.\n4.\tFor non-roaming case and if 5GC GMLC and EPC GMLC are combined, this step is skipped. Otherwise if the identified LCS Client is not accessible, the EPC GMLC sends a Location Update Notification response to AMF with an appropriate error cause. Otherwise, the response shall include an acknowledgement. The message shall specify whether the location estimate of the UE has been handled successfully by the identified LCS Client, and if not, the corresponding error cause obtained in step.\n5\tSteps 13-14 in clause 9.2.6 of TS 23.271 [4] are performed.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.271_clause_9.2.6",
        "clause_6.2",
        "figure_6.13.2-1",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.14.1",
      "section_id": "6.14.1",
      "section_title": "Broadcast of Assistance Data by an LMF",
      "content": "The following procedure is used by the LMF to support broadcasting of network assistance data to target UEs. This procedure is not associated with a UE location session. It is used in an AMF to send network assistance data to an NG-RAN node for broadcasting by the NG-RAN node to target UEs. NG-RAN positioning procedures related to LMF and NG-RAN node communication are specified in TS 38.455 [15].\nFigure 6.14.1-1: Broadcasting Network Assistance Data\n1.\tThe LMF invokes the Namf_Communication_NonUeN2MessageTransfer service operation towards the AMF to request the transfer of a Network Assistance Data message to an NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation includes the Network Assistance Data message and the target NG-RAN node identity. The Network Assistance Data message includes assistance data which may be optionally ciphered. LMF may send one or multiple sets of GNSS assistance data to the target NG-RAN node.\nLMF receives the GNSS assistance data by means of describing in clause 6.15, or other means not specified in the present document.\n2.\tThe AMF forwards the Network Assistance Data message to the target NG-RAN node indicated in step 1 in an N2 Transport message. The AMF includes a Routing identifier, in the N2 Transport message, identifying the LMF.\n3.\tThe NG-RAN node broadcasts the assistance data contained in the Network Assistance Data message.\n4.\tThe target NG-RAN node may return feedback on assistance information broadcasting to the AMF in a Network Assistance Feedback message. The target NG-RAN node shall also include the Routing identifier in the N2 Transport message received in step 2.\n5.\tThe AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation towards the LMF indicated by the routing identifier received in step 4. The service operation includes the Network Assistance Data Feedback message received in step 4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.15",
        "ts_38.455_figure_6.14.1-1",
        "ts_38.455"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.14.2",
      "section_id": "6.14.2",
      "section_title": "Delivery of Ciphering Keys to UEs for Broadcast Assistance Data",
      "content": "The following procedure is used by the LMF and the AMF to distribute ciphering keys to UEs to enable UEs to decipher broadcast assistance data that was ciphered by the LMF. This procedure is not associated with a UE location session. The procedure makes use of the Registration procedure defined in TS 23.502 [19].\nFigure 6.14.2-1: Delivery of Ciphering Keys to UEs for Broadcast Assistance Data\n1.\tThe LMF invokes the Nlmf_Broadcast_CipheringKeyData Notify service operation towards the AMF carrying one or more ciphering keys used to cipher network assistance data that is broadcast to UEs according to the procedure in clause 6.14.1. For each ciphering key, the LMF includes a ciphering key value, a ciphering key identifier, a validity period, a set of applicable tracking areas and a set of applicable types of broadcast assistance data.\nNOTE 1:\tThe LMF may send a new ciphering key to the AMF at a time T1 if this will start to be used to cipher network assistance data at a later time T2 (e.g. will replace a previous ciphering key which expires at time T2). The value of (T2 - T1) should exceed the longest periodic registration timer of any UE subscribed to receive ciphering keys to ensure that periodic registration can be used to request new ciphering keys as described in note 2.\n2.\tThe AMF stores the ciphering keys including the validity periods, applicable tracking areas and the types of applicable broadcast assistance data.\n3.\tA UE sends a Registration Request to a RAN node. The Registration Request may be sent as part of normal mobility management, A Registration Request may also be sent specifically to request and obtain ciphering keys. The UE includes in the Registration Request an indication that ciphering keys are requested. Other details of the Registration Request are as defined in TS 23.502 [19].\nNOTE 2:\tA UE should request new ciphering keys using a Registration Request caused by periodic registration if the remaining validity period for one or more ciphering keys received earlier by the UE is less than the periodic registration timer value. This can help avoid all UEs initiating a Registration procedure at the same time to obtain new ciphering keys when a validity period for a ciphering key is about to expire. A UE should also request new ciphering keys for a Registration Request caused by entering a new tracking area if previous ciphering keys are not applicable to the new tracking area.\n4.\tThe RAN node selects the AMF if the UE is in CM IDLE state or determines the AMF for CM CONNECTED state.\n5.\tThe RAN node forwards the Registration Request to the AMF.\n6.\tThe AMF returns a Registration Accept to the RAN node as defined in TS 23.502 [19]. If the UE is subscribed to receive ciphered broadcast data, the AMF includes in the Registration Accept one or more ciphering keys applicable to the current tracking area for the UE. The AMF also includes for each ciphering key the ciphering key value, the ciphering key identifier, the validity period, the set of applicable tracking areas and the set of applicable types of broadcast assistance data.\nNOTE 3:\tThe AMF does not need to keep a record of ciphering keys delivered to a UE and may instead send all ciphering keys stored at step 2 that are applicable to the current tracking area, for which the UE has a subscription and whose validity period has not yet expired.\n7.\tThe RAN node forwards the Registration Accept to the UE. The UE may start to use each ciphering key to decipher network assistance data that is broadcast according to the procedure in clause 6.14.1 once the validity period for the ciphering key has started and if the UE is currently in an applicable tracking area. The UE shall cease using a ciphering key when entering a tracking area not applicable to the ciphering key. The UE shall cease using and shall delete a ciphering key when the validity period for the ciphering key has expired.\nNOTE 4:\tA UE that receives no ciphering keys in response to a request for ciphering keys may assume that the UE does not have a subscription to receive ciphering keys in the serving PLMN.\n8.\tThe AMF deletes all information for a ciphering key when the validity period has expired.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14.1",
        "ts_23.502_figure_6.14.2-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.15.1",
      "section_id": "6.15.1",
      "section_title": "GNSS assistance data collection from untrusted AF via NEF",
      "content": "The following procedure is used by LMF to collect GNSS assistance information from AFs via the NEF.\nFigure 6.15.1-1: GNSS assistance data collection from untrusted AF\n1a-1c.\tReuse the steps 1a-1c in figure 6.2.2.3-1 of TS 23.288 [37] with following difference:\n-\tThe AF should also provide its serving area to NEF. NEF should map the serving area into TA(s) if it is presented as geographical location and update the NEF profile in NRF including the serving area information.\n1d-1e.\tReuse the steps 1d-1e in figure 6.2.2.3-1 of TS 23.288 [37] with following difference:\n-\tWhen LMF needs to discovery the available data from AFs and the appropriated NEF to collect GNSS assistance data, LMF additionally provides TAs in the Nnrf_NFDiscovery_Request_request service operation.\n2-5.\tReuse the steps 2-5 in figure 6.2.2.3-1 of TS 23.288 [37] with following difference:\n-\tBesides available GNSS assistance data, AF also provides associated serving area of the GNSS assistance data and optional precise global coordinates of the source of the GNSS assistance data. NEF may map the serving area into a TA or TA list.\n-\tWhen subscribing for the event GNSS Assistance Data with the AF, the LMF may also indicate an event filter which contains a location area (i.e. TA or TA list) to AF via NEF. The NEF may map the location area into a geographical location.\n6.\tAfter LMF gets the GNSS assistance data, it can send the assistance data to UE via the procedures described in clauses 6.14 or 6.11.1 during a positioning session.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.15.1-1",
        "ts_23.288_figure_6.2.2.3-1",
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.15.2",
      "section_id": "6.15.2",
      "section_title": "GNSS assistance data collection from trusted AF",
      "content": "For trusted AFs, LMF collects GNSS assistance data through AFs directly. LMF discovers trusted AFs covering LMF serving area through NRF and subscribes to GNSS assistance data exposure from discovered trusted AFs.\nFigure 6.15.2-1: GNSS assistance data collection from trusted AF\n1a-1c.\tAF invokes Nnrf_NFManagement_NFUpdate_request service operation to register its GNSS related information including Event IDs, and associated AF identification, Application ID(s) and its serving area (TAs). NRF stores the received AF update information and sends Nnrf_NFManagement_NFUpdate_response message to AF.\n1d-1e.\tWhen LMF needs to discovery the available GNSS assistance data from AFs, LMF provide TAs to NRF through Nnrf_NFDiscovery service to discover related AFs.\n2.\tLMF subscribes to or cancels subscription to GNSS assistance data in AF by invoking the Naf_EventExposure_Subscribe/Naf_EventExposure_Unsubscribe service operation. The LMF may also indicate an event filter which contains a location area (i.e. TA or TA list) to AF.\n3.\tAF notifies the LMF with the available GNSS assistance data by invoking Naf_EventExposure_Notify service operation. AF also provides associated serving area (TAs) of the GNSS assistance data and optional precise global coordinates of the source of the GNSS assistance data. The AF notifies the LMF with the data by invoking Nnef_EventExposure_Notify service operation.\n4.\tAfter LMF gets the GNSS assistance data, it can send the data to UE via the procedures described in clauses 6.14 or 6.11.1 during a positioning session.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.15.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.16.1",
      "section_id": "6.16.1",
      "section_title": "Reporting of Location Events to an LCS Client or AF via user plane",
      "content": "Figure 6.16.1-1 shows a procedure for event reporting from a UE to an LCS Client or AF when a User Plane connection is established directly from the UE to the LCS Client or AF. This procedure is applicable when the target UE is able to determine its location.\nFigure 6.16.3-1: Reporting of Location Events to an LCS Client or AF via user plane\n1.\tSteps 1-21 in clause 6.3.1 for the deferred 5GC-MT-LR procedure for periodic or triggered location are performed with the following differences.\n-\tAt step 1, the LCS Client or AF includes a request for user plane reporting in the LCS Service Request and may include a user plane address of the LCS Client or AF and security information to enable a secure connection. The H-GMLC verifies that both the target UE and the LCS Client or AF are subscribed to user plane reporting. If the LCS Client or AF did not include a user plane address or security information, the H-GMLC obtains a default user plane address and/or default security information from subscription data for the LCS Client or AF. The H-GMLC determines criteria for sending cumulative events reports over control plane. The criteria can include a cumulative event report timer and/or a maximum number of user plane event reports.\n-\tAt steps 4, 5 and 14, the request for user plane reporting, the user plane address, the security information and the criteria for sending cumulative events reports over control plane are forwarded in sequence to the V-GMLC (if used), serving AMF and LMF.\n-\tAt step 14 or step 15, the LMF gets the UE capabilities and verifies that the UE is able to support position methods that allow the UE to determine its own location.\n-\tAt step 16, the LMF includes the request for user plane reporting, the user plane address, the security information and the criteria for sending cumulative events reports in the supplementary services LCS Periodic-Triggered Invoke Request sent to the target UE.\n-\tAt step 17, the target UE indicates to the LMF whether event reporting via user plane can be supported by the target UE. If event reporting via user plane cannot be supported by the target UE, a failure response is returned to the LCS Client or AF at steps 18-21.\n2.\tThe UE establishes a secure user plane connection with TLS to the LCS Client or AF using the user plane address and the security information received at step 1.\n3.\tThe UE monitors for and detects the occurrence of a trigger or periodic event as described for step 22 of the procedure in clause 6.3.1.\n4a.\tThe UE obtains location measurements and determines a current location.\n4b.\tIf the UE is unable to determine its location at step 4a, the UE sends an event report to the LCS Client or AF over control plane as described for steps 24-30 in clause 6.3.1.\n5.\tThe UE sends an Event Report to the LCS Client or AF over the secure user plane connection established at step 2. The event report indicates the type of event being reported and includes the location determined at step 4a.\n6.\tThe LCS Client or AF may return an Event Report Acknowledgment to the UE over the secure user plane with TLS connection established at step 2.\n7.\tThe UE continues to monitor for and detect further trigger or periodic events as at step 3 and repeats steps 4-6 for each detected trigger or periodic event.\n8.\tThe UE monitors the criteria received at step 1 for sending of cumulative event reports. If a cumulative event report timer was received at step 1, the UE starts the timer following step 1 and after each cumulative event report is sent. If a maximum number of user plane event reports was received at step 1, the UE maintains a count of the number of user plane event reports sent at step 5. When the cumulative event report timer expires or when the count of user plane events reports sent at step 5 reaches the maximum number of user plane event reports, the UE sends a cumulative event report and restarts the timer and the count of user plane event reports. The UE sends the cumulative event report to the LMF, H-GMLC and LCS Client or AF over the control plane portion of the periodic or triggered deferred 5GC-MT-LR using steps 25-30 of the procedure in clause 6.3.1. The cumulative event report indicates to the LMF, H-GMLC and External LCS Client or AF that the control plane portion of the periodic or triggered deferred 5GC-MT-LR is still active, that the UE is reporting events via user plane and may include statistics on the events reported since the last cumulative event report was sent (e.g. the number of event reports).\nA target UE may also send a cumulative event report at step 8 to obtain assistance data from the LMF to assist with location at step 4a. In this case, the target UE includes a positioning LPP request for assistance data in the cumulative event report sent to the LMF at step 25 in clause 6.3.1 and the LMF uses step 27 in clause 6.3.1. to return the requested assistance data to the target UE. In this case, the cumulative event report timer and the count of user plane event reports are restarted and a cumulative event report is sent on to the H-GMLC and LCS Client or AF by the LMF (but without the embedded positioning LPP request for assistance data).\nDuring step 8, the LMF change procedure in clause 6.4 may be used to forward the cumulative event report (and any request for assistance data) to another LMF if the current LMF can no longer support the periodic or triggered MT-LR due to a change in target UE location (e.g. a change to the target UE TAI). In this case, the new LMF can return any assistance data to the UE (if this was requested) and can forward the cumulative event report to the H-GMLC and LCS Client or AF.\nNOTE:\tWhen using step 8 to request assistance data, the UE may perform step 8 well before performing step 4a for a user plane event report in order to avoid extra delay in sending the user plane event report.\n9.\tAfter the UE has sent the final event report and received an acknowledgment using steps 5 and 6 or step 4b, the UE shall release the user plane connection to the LCS Client or AF if the LCS Client or AF has not yet initiated release of the user plane connection",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.4",
        "figure_6.16.1-1",
        "figure_6.16.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.16.2",
      "section_id": "6.16.2",
      "section_title": "Cancellation of Reporting of Location Events with a User Plane Connection",
      "content": "A UE may cancel a deferred 5GC-MT-LR procedure for periodic, or triggered location events where a user plane connection is used by the following the procedure defined in clause 6.3.2. After the UE receives the acknowledgment of the cancellation at step 6 in clause 6.3.2, the UE shall release the user plane connection to the LCS Client or AF if the LCS Client or AF has not yet initiated release of the user plane connection.\nAn AF or External LCS Client or a GMLC may cancel a deferred 5GC-MT-LR procedure for periodic or triggered location where a user plane connection is used by the following the procedure defined in clause 6.3.3. After the UE has returned the acknowledgment of the cancellation at step 9 in clause 6.3.3, the UE shall release the user plane connection to the LCS Client or AF if the LCS Client or AF has not yet initiated release of the user plane connection.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.2",
        "clause_6.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.17.1",
      "section_id": "6.17.1",
      "section_title": "PRU Association Procedure",
      "content": "Figure 6.17.1-1 shows a procedure used by a PRU to associate as a PRU with a serving LMF. The procedure is used for initial PRU Association with the serving LMF which may occur when the PRU first starts to access the HPLMN. The procedure can also be used to perform a PRU Association update to inform the serving LMF of the continued availability of the PRU or to inform the serving LMF of some change to the PRU such as a change of location (e.g. a change of tracking area or change of serving AMF) or a change of the PRU positioning capabilities. The PRU shall only perform the Association procedure in the HPLMN.\nFigure 6.17.1-1: PRU Association Procedure\nPrecondition:\tThe PRU is currently registered in the HPLMN. For initial PRU Association, a Routing Identifier may have been configured in the PRU indicating the serving LMF. For subsequent PRU Association, a Routing ID indicating a serving LMF has been returned to the PRU at step 6a or 6b of a previous PRU Association procedure.\nNOTE 1:\tA Correlation ID and a Routing ID are different terms for the same identifier. The term \"Correlation ID\" is used for an identifier in service operations between an AMF and LMF while the term \"Routing ID\" is used for an identifier in a NAS message sent over the N1 reference point between a PRU and AMF.\n1.\tThe PRU performs a UE Triggered Service Request if in CM IDLE state.\n2.\tThe PRU sends a supplementary services PRU Association Request to the serving AMF in an UL NAS TRANSPORT message and includes any preconfigured Routing ID for an initial Association or the Routing ID if received at step 6a or step 6b for a previous PRU Association procedure. The PRU Association Request is included in the UL NAS TRANSPORT message at the NAS level. The PRU Association Request includes a reason for the PRU Association (e.g. initial PRU Association, or PRU Association update), the PRU's positioning capabilities, location information (if known) or PRU ON/OFF state.\n3.\tThe AMF verifies whether the sender of the PRU Association Request is a PRU using subscription information from the UDM. AMF verifies based on subscription information or local policy if PRU can work as stationary PRU.\n4.\tThe AMF selects the serving LMF based on the criteria defined in clause 5.1 or one of the Routing ID if included in the UL NAS TRANSPORT message of step 2. The AMF may override the Routing ID based on criteria of clause 5.1. The AMF transfers the PRU Association Request to the serving LMF using an Namf_Communication_N1MessageNotify service operation. The AMF includes in the Namf_Communication_N1MessageNotify service operation an indication of whether the request corresponds to a PRU subscription and indication if PRU is stationary. The AMF also includes the SUPI, TAI and cell ID of the PRU.\n5a.\tIf the AMF indicates in step 4 that the request corresponds to a PRU and if the LMF can accept the PRU Association, the serving LMF returns a PRU Association Accept, as a supplementary services message, using Namf_Communication_N1N2MessageTransfer service operation towards the AMF, and a Correlation ID. The Correlation ID is assigned by the serving LMF to identify the serving LMF and optionally the PRU. The PRU Association Accept indicates conditions for performing PRU Association updates with the serving LMF which may include a periodic PRU Association update timer and PRU Association update based on a change of PRU location, change of PRU TAI, change of serving AMF, or change of PRU ON/OFF state. For a PRU whose state is OFF, PRU information is kept at the serving LMF.\nNOTE 2:\tA periodic PRU Association is independent of a periodic NAS Registration and may occur with greater, equal or lesser frequency.\n6a.\tThe serving AMF forwards the PRU Association Accept and a Routing ID equal to the Correlation ID to the PRU in a DL NAS TRANSPORT message. The PRU stores the Routing ID which is used for any further PRU Association update with the serving LMF. This Routing ID overrides any Routing ID used in previous Association updates, if any.\n5b.\tIf the AMF indicates in step 4 that the request does not correspond to a PRU subscription or if the serving LMF cannot accept the PRU Association for some other reason (e.g. the serving LMF is not the correct serving LMF for the PRU), the serving LMF returns a PRU Association Reject message, using Namf_Communication_N1N2MessageTransfer service operation towards the AMF, and may include the Routing ID of a new serving LMF if the request at step 4 corresponds to a PRU.\n6b.\tThe serving AMF forwards the PRU Association Reject in a DL NAS TRANSPORT message to the PRU.\n7.\tIf PRU Association is performed successfully as in steps 5a and 6a, the serving LMF may optionally verify any PRU location provided at step 4 or obtain a more accurate location of the PRU using the procedures defined in clause 6.11. The LMF also stores information received for the PRU. If PRU Association update including only a state change is performed, the serving LMF may consider the previously verified PRU location is valid.\n8.\tIf PRU Association is performed successfully as in steps 5a and 6a and if this is an initial PRU Association or if this is a PRU Association update and information for the PRU has changed and if PRU is stationary the serving LMF may optionally instigate an Nnrf_NFManagement_NFUpdate Request service operation towards an NRF and includes an existence indication of a PRU associated with a TAI.\nThe LMF also indicates to the NRF to remove the TAI associated existence of PRU(s) when there are no longer any PRUs associated in the LMF for this TAI.\n9.\tIf step 8 requested by LMF the NRF returns a confirmation response to the serving LMF.\n10.\tAfter being rejected at step 6b, if there are new available Routing ID(s), the PRU may perform a PRU Association procedure with the new serving LMF.\nNOTE 3:\tThe PRU may be configured with a limit on the number and/or duration of unsuccessful PRU Association attempts. When this limit is reached the PRU considers itself disassociated.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.1",
        "clause_6.11",
        "figure_6.17.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.17.2",
      "section_id": "6.17.2",
      "section_title": "LMF Initiated PRU Disassociation Procedure",
      "content": "Figure 6.17.2-1 shows a procedure used by a serving LMF to disassociate an already associated PRU. The procedure may be used prior to the serving LMF becoming unavailable (e.g. for maintenance, removal or replacement) or to transfer the PRU to a different serving LMF for other reasons.\nFigure 6.17.2-1: LMF Initiated PRU Disassociation Procedure\nPrecondition:\tThe PRU has previously associated with the serving LMF using the procedure in clause 6.17.1.\n1.\tThe serving LMF sends a PRU Disassociation Request as a supplementary services message, using the Namf_Communication_N1N2MessageTransfer service operation, and a Correlation ID identifying the serving LMF. The PRU Disassociation Request may include a Routing ID for a new serving LMF.\nNOTE:\tThe Correlation ID for the serving LMF is transferred to the serving AMF to provide the Routing ID for step 3. The Routing ID for a new serving LMF, if provided, is included inside the PRU Disassociation Request and is not visible to the serving AMF. This Routing ID is different to the Routing ID for steps 3, 4 and 5 and enables the PRU to perform an Association with a new serving LMF at step 8.\n2.\tIf the PRU is in CM IDLE state, the serving AMF performs a Network Triggered service request to place the PRU in CM CONNECTED state.\n3.\tThe serving AMF forwards the PRU Disassociation Request and a Routing ID equal to the Correlation ID to the PRU using DL NAS TRANSPORT message.\n4.\tThe PRU returns a supplementary services PRU Disassociation Accept to the serving AMF in an UL NAS TRANSPORT message and includes the Routing ID received in step 3.\n5.\tThe serving AMF forwards the PRU Disassociation Accept to the serving LMF indicated by the Routing ID received at step 4 and includes a Correlation ID equal to the Routing ID.\n6.\tIf the serving LMF has indicated the PRU to an NRF during PRU Association and if serving LMF does not have any PRU to the TAI, the serving LMF issues an Nnrf_NFManagement_NFUpdate Request service operation towards the NRF and requests an indication of PRU removal. The NRF then removes the TAI associated PRU existence indication.\n7.\tThe NRF returns a confirmation response to the serving LMF.\n8.\tIf the PRU received a new Routing ID for a new serving LMF at step 3, the PRU may perform a PRU Association with the new serving LMF as described in clause 6.17.1.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.17.1",
        "figure_6.17.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.17.3",
      "section_id": "6.17.3",
      "section_title": "PRU Initiated PRU Disassociation Procedure",
      "content": "Figure 6.17.3-1 shows a procedure used by a PRU to disassociate from a serving LMF. The procedure may be used prior to the PRU becoming unavailable (e.g. for a software upgrade or power down) or when the PRU will be transferred to a different serving LMF.\nFigure 6.17.3-1: PRU Initiated PRU Disassociation Procedure\nPrecondition:\nThe PRU has previously associated with the serving LMF using the procedure in clause 6.17.1 and is currently registered in the HPLMN.\n1.\tThe PRU performs a UE Triggered Service Request if in CM IDLE state.\n2.\tThe PRU sends a supplementary services PRU Disassociation Request to the serving AMF in an UL NAS TRANSPORT message and includes the Routing ID received at step 6a for the procedure in clause 6.17.1 for a previous PRU Association procedure. The PRU also indicates whether an acknowledgment is expected. The PRU Disassociation Request is included in the UL NAS TRANSPORT message at the NAS level.\nNOTE 1:\tA PRU could indicate whether an acknowledgment is expected according to whether the PRU expects to be still able to receive the acknowledgment at a later time.\n3.\tThe AMF verifies whether the sender of the PRU Disassociation Request is a PRU using subscription information from the UDM.\n4.\tThe AMF selects the serving LMF based on the Routing ID and optionally the current TAI and transfers the PRU Disassociation Request to the serving LMF using an Namf_Communication_N1MessageNotify service operation. The AMF includes in the Namf_Communication_N1MessageNotify service operation an indication of whether the sender of the PRU Disassociation Request is a PRU. The AMF also includes the SUPI of the PRU.\n5.\tThe serving LMF verifies that the PRU is currently associated in the serving LMF. If the PRU is not currently associated in the serving LMF, the serving LMF performs steps 6 and 7 but not steps 8 and 9.\nNOTE 2:\tInconsistency between Association in a PRU versus a serving LMF might arise if a PRU is powered off or loses network coverage and if the serving LMF then performs an LMF initiated PRU Disassociation.\n6.\tIf the PRU has indicated that an acknowledgment is expected, the serving LMF returns a PRU Disassociation Accept, as a supplementary services message, using an Namf_Communication_N1N2MessageTransfer service operation towards the AMF, and a Correlation ID.\n7.\tThe serving AMF forwards the PRU Disassociation Accept and a Routing ID equal to the Correlation ID to the PRU in a DL NAS TRANSPORT message.\n8.\tIf the serving LMF has indicated the PRU to an NRF during a previous PRU Association and if serving LMF does not have any PRU to the TAI, the serving LMF invokes an Nnrf_NFManagement_NFUpdate Request service operation towards the NRF and requests an indication of PRU removal. The NRF then removes the TAI associated PRU existence indication.\n9.\tThe NRF returns a confirmation response to the serving LMF.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.17.1",
        "figure_6.17.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.17.4",
      "section_id": "6.17.4",
      "section_title": "Positioning of a target UE",
      "content": "Figure 6.17.4-1 shows a procedure used by a serving LMF for a target UE to obtain a location of the target UE using location information provided by one or more PRUs.\nFigure 6.17.4-1: Location of a target UE using PRUs\n1.\tThe serving LMF for the target UE and other PRU serving LMFs may use the procedures defined in clause 6.11 to obtain location information from one or more PRUs associated in the serving LMF and in the other PRU serving LMFs that is not related to the target UE. For example, the location information may include location information for the PRU(s) or for the NG-RAN or both.\n2.\tThe serving LMF for the target UE receives a location request from the serving AMF for the target UE. The location request may be included in an Nlmf_Location_DetermineLocation Request service operation for a 5GC-MO-LR, 5GC-MT-LR or 5GC-NI-LR for the target UE. Alternatively, the location request may be implied by receipt of an Namf_Communication_N1MessageNotify service operation carrying a supplementary services event report from the target UE for a periodic or triggered 5GC-MT-LR.\n3.\tThe serving LMF uses the procedures defined in clause 6.11 to obtain location information for the target UE from the target UE and/or from the NG-RAN and may determine pre-calculated location of target UE. During the procedures, the LMF decides to use PRUs to improve the positioning result.\n4.\tThe serving LMF selects one or more PRUs associated with the serving LMF based on the PRU ON/OFF state information to assist in locating the target UE. The selected PRU(s) may be nearby to an initial location estimate for the target UE obtained at step 3 or indicated by a serving cell identifier for the target UE received at step 2.\nNOTE 1:\tThe PRU selection criteria are implementation specific and may be based on operator policies.\n5.\tThe serving LMF may optionally invoke an Nnrf_NFDiscovery Request service operation to an NRF. The service operation includes a PRU indication and an area which could be TAs decided by the serving LMF of the target UE based on the serving cell of the target UE.\n6.\tIf step 5 is performed, the NRF selects one or more other PRU serving LMFs based on the PRU indication and the area received in step 5 and sends an Nnrf_NFDiscovery Response to the serving LMF of target UE. The service operation includes the profiles of the other PRU serving LMFs selected by the NRF.\n7.\tIf steps 5 and 6 are performed, the serving LMF of the target UE may send an Nlmf_Location_MeasurementData Request service operation to one or more of the other PRU serving LMFs indicated at step 6. The service operation for each of the other PRU serving LMFs includes target UE cell ID or pre-calculated location of target UE in step 3 and may include time windows for scheduling of PRU measurements.\nNOTE 2:\tThe time window(s) is the Time Window Information SRS List and the Time Window Information Measurement List specified in TS 38.455 [15] when network assisted positioning is used and is the NR-DL-PRS-MeasurementTimeWindowsConfig specified in TS 37.355 [20] when UE assisted positioning is used.\n8.\tThe serving LMF uses the procedure defined in clause 6.11.1 to obtain location information (e.g. PRU location coordinates, associated location quality/uncertainty of the PRU together with any performed location measurements) related to the target UE from the PRU(s) selected at step 4.\n9.\tIf steps 5-7 are performed and if PRU information is included in the PRU serving LMF profile sent by the NRF to the target UE serving LMF, each of the other PRU serving LMFs for step 7 uses the procedure defined in clause 6.11.1 to obtain the location measurements and/or location requested at step 7 from each of the PRUs identified at step 7 for this LMF.\nIf steps 5-7 are performed PRU serving LMFs for step 7 selects one or more PRUs based on the locally associated PRU information and information in the location measurements requested (the target UE cell ID, or pre-calculated location of target UE), and uses the procedure defined in clause 6.11.1 to obtain the location measurements requested at step 7 from each of the selected PRUs.\nNOTE 2:\tSteps 3, 8 and 9 can be performed in any order, including simultaneously. If the LMF determines that simultaneous measurements for UE and PRU(s) are needed, the LMF determines time window(s) in a positioning method dependent manner for simultaneous measurements and sends the time window(s) to UE, PRU(s) and NG-RAN. Definition of the time window and the associated configuration parameters, and the corresponding positioning methods are specified in TS 37.355 [20] and TS 38.455 [15].\n10.\tIf step 9 is performed, each of the other PRU serving LMFs for step 9 returns the location measurements and the known PRU location obtained from PRUs at step 9 to the serving LMF for the target UE.\n11.\tThe serving LMF for the target UE determines the location of the target UE based on the location information obtained at step 1 (if step 1 is performed), step 3, step 8 and step 10.\n12a.\tIf an Nlmf_Location_DetermineLocation Request service operation for a 5GC-MO-LR, 5GC-MT-LR or 5GC-NI-LR was received at step 2, the serving LMF returns the location estimate of the target UE to the serving AMF.\n12b.\tIf an Namf_Communication_N1MessageNotify service operation carrying a supplementary services event report from the target UE for a periodic or triggered 5GC-MT-LR was received at step 2, the serving LMF sends an event report for the target UE to a GMLC with the location estimate obtained at step 11 as described in clause 6.3.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.11",
        "clause_6.11.1",
        "clause_6.3.1",
        "figure_6.17.4-1",
        "ts_38.455",
        "ts_37.355"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.18.0",
      "section_id": "6.18.0",
      "section_title": "General",
      "content": "Clause 6.18 describes the management of the user plane connection between UE and LMF. LMF or UE may trigger the establishment of the user plane connection.\nUE and LMF may maintain the established user plane connection. LMF may modify or terminate the established user plane connection between UE and LMF. In this Release, one UE shall have maximum one LCS-UPP connection.\nPrecondition:\nThe LMF can send its user plane information (i.e. IP address or FQDN) to the UE via a DL NAS TRANSPORT message of the AMF. If LMF sends its FQDN to the UE, a DNS server/resolver is used to resolve the IP address of LMF (e.g. EASDF or local DNS for local LMF address resolution). UE uses URSP which includes user plane positioning related PDU session parameters (e.g. a dedicated DNN and S-NSSAI) to establish a PDU session used for user plane positioning. SMF should select a PSA UPF (located in central site or local site) connecting with the LMF for this PDU session, based on S-NSSAI, DNN and UE location information, etc.\nSession break out for local LMF service for user plane positioning can be supported by preconfiguring SMF with local LMF(s) IP address(es)/network prefix(es) and their DNAIs for positioning dedicated PDU session in certain service area(s) for local PSA and UL CL/BP insertion.\nNOTE 1:\tBased on preconfigured local LMF information, SMF can subscribe to UE location information from AMF and perform additional local PSA and UL CL/BP insertion and corresponding forwarding rules configuration if UE moves to a location where it can be served by local LMF(s).\nNOTE 2:\tIn this Release, to avoid LMF selection conflicts, the LMFs use their dedicated FQDNs which are different from each other, but their FQDNs can have common parts in support of usage as Traffic descriptor in URSP.\nNOTE 3:\tIt is up to operator to determine appropriate QoS parameters for user plane connection between UE and LMF.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.18"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.18.1",
      "section_id": "6.18.1",
      "section_title": "LMF initiated User Plane Connection",
      "content": "LMF may trigger the user plane connection establishment after receiving a location request from AMF if target UE does not have user plane connection with LMF. AMF may subscribe from LMF the status of LCS user plane connection for the target UE, using a Nlmf_Location_UP Subscribe message if the UE supports user plane positioning. Figure 6.18.1-1 shows a procedure triggered by LMF to support positioning over the user plane connection between UE and LMF.\nFigure 6.18.1-1: Positioning via a User Plane Connection between UE and LMF initiated by LMF\nNOTE 1:\tUser Plane protocol (LCS-UPP) to support generic transport between the UE and the LMF is defined in TS 24.572 [48].\n1.\tBased on UE user plane positioning capability, control plane congestion status (e.g. AMF load status) and other implementation factors, LMF decides whether to use the positioning procedure via a user plane connection between UE and LMF.\nLMF may invoke Nnrf_NFDiscovery service operation to retrieve control plane congestion status (e.g. AMF load information). LMF may also invoke Nnrf_NFManagement_NFStatusSubscribe service to subscribe specific AMF load information. Based on AMF load information, LMF may determine to use user plane positioning, if there is available user plane connection between UE and LMF.\nSteps 2-8 are skipped if there is already a user plane connection context of the target UE in LMF and LMF determines to utilize the user plane connection for positioning.\nNOTE 2:\tLMF can select user plane positioning for specific positioning methods (e.g. motion sensor-based method) and it is based on implementation and local configuration to determine which positioning method requires user plane transport.\nNOTE 3:\tThe procedure can also be triggered when LMF receives a location request from AMF via control plane signalling as defined in clause 6.1 and clause 6.3.\n2.\t[Conditional] If LMF decides to utilize user plane for positioning and there is no established secure user plane connection between the UE and LMF, LMF invokes Namf_communication_N1N2MessageTransfer service operation to send the user plane information to AMF in a NAS container to indicate UE to utilize user plane over TLS for positioning. The user plane information includes the user plane positioning address of the LMF. The LMF allocates LCS-UP binding ID to be used to associate the user plane connection to be established with the target UE and includes this LCS-UP binding ID in the user plane information. The LMF associates the target UE identity (SUPI and/or GPSI) with this LCS-UP binding ID.\nIf the UE supports the user plane positioning capability and AMF has not subscribed the status of LCS user plane connection, the AMF may subscribe from LMF the status of LCS user plane connection.\nNOTE 4:\tSecurity mechanism to support user plane positioning is defined in Annex Q.2 of TS 33.501 [50].\n3.\t[Conditional] When AMF receives the user plane information from LMF in step 2, AMF sends it to UE via a DL NAS TRANSPORT message.\n4.\t[Conditional] If there is no established applicable PDU session for the user plane positioning, the UE uses the URSP as defined in TS 23.503 [41] which includes user plane positioning related PDU session parameters, e.g. a dedicated DNN and S-NSSAI, to establish the PDU session for user plane positioning. UE establishes a secured user plane connection with LMF. If LMF send its FQDN to the UE, a DNS server/resolver is used to resolve the IP address of LMF (e.g. EASDF or local DNS for local LMF address resolution). After the secured user plane connection been established successfully, the UE sends the LCS-UP binding ID received in step 3 to LMF via the secured user plane connection to enable LMF to perform the correlation of the UE with the secured user plane connection. The LCS-UP binding ID will be released once the correlation is complete.\n5.\t[Conditional] UE sends an acknowledgement to LMF through AMF to indicate a success of user plane connection establishment for positioning service or a failure to utilize the user plane connection as defined in TS 24.572 [48].\n6\t[Conditional] AMF sends the acknowledgement received in step 5 to the LMF via Namf_N1messageNotify service.\n7.\t[Conditional] LMF indicates AMF in the Nlmf_Location_UPNotify message that user plane connection between the UE and LMF has been established.\n8.\t[Conditional] The AMF stores the LCS-UP connection context as part of UE context.\n9.\tIf LMF or UE determines to utilize the user plane connection for positioning and the secure user plane connection is established, LPP messages are transferred between UE and LMF for UE based positioning, UE assisted positioning and delivery of assistance data. Supplementary services messages including event report messages, periodic triggered invoke messages and MS cancel deferred location messages may also be transferred between LMF and UE via the established user plane connection.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1",
        "clause_6.3",
        "figure_6.18.1-1",
        "ts_24.572",
        "ts_33.501",
        "ts_23.503"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.18.2",
      "section_id": "6.18.2",
      "section_title": "UE initiated User Plane Connection",
      "content": "UE may trigger the user plane connection establishment if the UE does not have user plane connection with LMF. Figure 6.18.2-1 shows a procedure triggered by UE to support positioning over the user plane connection between UE and LMF.\nFigure 6.18.2-1: Positioning via a User Plane Connection between UE and LMF, initiated by UE\n1.\tUE sends a user plane connection establishment request to AMF via NAS Message, if there is no established secure user plane connection between the UE and LMF and UE decides to request a user plane connection for upcoming positioning requests.\n2.\t[Conditional] If the UE is authorized based on UE Subscription to use the user plane positioning, AMF selects an LMF which capable to establish a user plane session for positioning with the UE. AMF may either query the NRF or based on local configuration to discover and select a proper LMF.\n3.\t[Conditional] The AMF sends a Nlmf_Location_UPConfig Request towards LMF to request set up of an LCS-UP connection. The AMF shall include the target UE identity (see TS 29.572 [12]) (SUPI and/or GPSI) in the request.\n4.\t[Conditional] If LMF accepts to utilize user plane for positioning and there is no established secure user plane connection between the UE and LMF, LMF sends a user plane information to AMF to indicate UE to accept and utilize user plane for positioning. The user plane information includes the user plane positioning address of the LMF. The LMF allocates a LCS-UP binding ID to associate the user plane connection to be established with the target UE and includes the LCS-UP binding ID in the user plane information. The LMF associates the target UE identity (SUPI and/or GPSI) with the LCS-UP binding ID.\n5.\t[Conditional] When AMF receives the user plane information from LMF in step 4, AMF forwards it to UE via a DL NAS TRANSPORT message.\n6.\t[Conditional] If there is no established secure user plane connection, UE establishes a secured user plane connection with LMF. UE uses the user plane positioning address of the LMF, together with the information in the URSP, to determine the PDU session parameters including DNN+S-NSSAI. UE uses the PDU session parameter to establish PDU session. When SMF receives the request, it selects a proper UPF based on the DNN+S-NSSAI, and establishes the connection between the UPF and LMF.\nAfter the secured user plane connection has been established successfully, the UE sends the LCS-UP binding ID received in step 4 to LMF via the secured user plane connection to enable LMF to perform the correlation of the UE with this secured user plane connection. The LCS-UP binding ID will be released once the correlation is complete.\n7.\t[Conditional] UE sends an acknowledgement to LMF through AMF to indicate a success of user plane connection establishment for positioning service or a failure to utilize the user plane connection as defined in TS 24.572 [48].\n8.\t[Conditional] AMF sends the acknowledgement received in step 7 to the LMF via Namf_N1messageNotify service.\n9.\t[Conditional] LMF responds to AMF that user plane connection between the UE and LMF has been established.\n10.\t[Conditional] The AMF stores the LCS-UP connection context as part of UE context\n11.\t[Conditional] After the secure user plane connection is established, if LMF determines to utilize the user plane connection for positioning after receiving a positioning request from AMF, or UE determines to utilize the user plane connection for positioning, LPP messages are transferred between UE and LMF for UE based positioning, UE assisted positioning and delivery of assistance data. Supplementary services messages including event report messages, periodic triggered invoke messages and MS cancel deferred location messages may also be transferred between LMF and UE via the established user plane connection.",
      "chunk_type": "general",
      "cross_references": [
        "figure_6.18.2-1",
        "ts_29.572",
        "ts_24.572"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.18.3",
      "section_id": "6.18.3",
      "section_title": "Modification of User Plane Connection between UE and LMF",
      "content": "The figure 6.18.3-1 shows how a secure user plane connection between UE and LMF is modified. The flow describes change of LMF but applies also when source and target LMF is the same. The procedure can also be used to terminate the user plane connection to Source LMF not selecting any Target LMF.\nFigure 6.18.3-1: Connection modification between UE and LMFs\n1a.\t[Conditional] The LMF discovers a need to change LMF or re-establish the user plane connection between UE and LMF or terminate the user plane connection, e.g. after receiving an event report via user plane from UE or after receiving an AMF relocation information from a target AMF (target AMF obtains from source AMF the UE LCS-UP context which indicates UE has maintained LCS-UP connection with the source LMF, the target AMF may inform the source LMF about the AMF change using the Nlmf_Locatoion_UPConfig request). The LMF sends an Nlmf_Location_UPNotify message that includes connection move (termination and establishment) or termination is required and if connection move is requested then message may include target LMF identification. The address of the AMF was provided to LMF as a \"Notification Target Address\" in latest Nlmf_Location_UPConfig message or Nlmf_Location_UP Subscribe message. If the LMF is going to terminate the user plane connection, step 1a, step 3, step 6 and step 7 are performed and other steps are skipped.\nIf the request is to terminate the user plane connection, the AMF releases the LCS-UP context.\nNOTE 1:\tThe LMF change procedure is independent from the SSC mode of the PDU Session with dedicated DNN used for positioning. For SSC mode 2/3, PSA UPF connection with the LMF can be relocated with UE movement and LMF can discover the need to change LMF to reduce the user plane path latency.\n1b.\t[Conditional] The AMF should perform LMF reselection if a target LMF identification received from source LMF for user plane positioning, or AMF may perform LMF reselection if a UE established a LCS UP connection with the source LMF moves to a new location (which may be out of serving area of source LMF and in serving area of target LMF) and select the target LMF for the current UE location based on LMF service area, LMF user plane positioning capability information and other information listed in clause 5.1. LMF needs to be capable to establish a user plane session for positioning with the UE. After AMF relocation, the target AMF may trigger the LMF reselection and LCS-UP connection modification procedure, e.g. if the source LMF does not perform LMF reselection.\n2.\t[Conditional] Steps 3-10 of figure 6.18.2-1 are performed between AMF (or Target AMF), UE, and Target LMF with addition that UE also terminate connection to Source LMF.\n3.\tThe AMF sends an Nlmf_Location_UPConfig Request towards the source LMF. The message may include a request for the Source LMF to terminate a specific user plane connection to the UE and the Target LMF identification. Alternatively, it may include information about AMF reallocation.\nNOTE 2:\tAMF relocation does not necessarily always cause LMF reselection, the AMF relocation information can keep the LMF informed.\n4-5.[Conditional] The source LMF may invoke an Nlmf_Location_LocationContextTransfer Request service operation towards the target LMF to provide the current location context(s) of the UE, if there is user plane based periodic and triggered UE location events report context(s). The target LMF informs source LMF of the location context transfer operation results.\n6.\t[Conditional] If the user plane connection to source LMF is still active, the source LMF terminates the connection to the UE.\n7.\tThe LMF sends Nlmf_Location_UPConfig Response message to AMF to confirm connection termination or acknowledge change of AMF. If this procedure is used for termination, the AMF will release the LCS-UP context after receiving the response message.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1",
        "figure_6.18.3-1",
        "figure_6.18.2-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.0",
      "section_id": "6.19.0",
      "section_title": "General",
      "content": "Clause 6.19.1 describes the location service continuity procedure for Immediate Location Request. Clause 6.19.2 describes the location service continuity procedure for deferred MT-LR. The GMLC in clause 6.19.1 and clause 6.19.2 can be a single co-located EPC-GMLC and 5GC-GMLC or a separate EPC-GMLC and 5GC-GMLC with the non-standardized Lr' interface.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.19.1",
        "clause_6.19.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.1.1",
      "section_id": "6.19.1.1",
      "section_title": "Location Service Continuity from 5GS to EPS with N26 Interface for Immediate Location Request",
      "content": "Figure 6.19.1.1-1: Location Service Continuity from 5GS to EPS with N26 Interface for Immediate Location Request\n1.\tTarget UE positioning is started in 5GS, e.g. steps 1-12 of 5GC-MT-LR procedure in clause 6.1.2, or steps 1-5 of 5GC-MO-LR procedure in clause 6.2.\n2.\tLMF handles the ongoing LCS session\n3.\t5GS to EPS handover happens successfully as described in figure 4.11.1.2.1-1 of TS 23.502 [19] - AMF receives the relocation complete notification message from MME and record the target MME ID.\n4.\tAMF instructs the LMF to cancel the ongoing LCS session.\n5.\tThe LCS Session on 5GS is cancelled by LMF.\n6.\tLMF sends the Nlmf_Location_DetermineLocation Response to AMF after the cancellation is complete, LMF may include the current available location result in the response even it doesn't meet the requested QoS.\n7.\t[Conditional] If the location request is received from 5GC-GMLC, AMF responds failure to the 5GC-GMLC with Namf_Location_ProvidePositioningInfo Response indicating failure of the LCS session with cause = HO to EPC while also including the target MME ID for the UE. The response may contain the location result from LMF at step 6.\nNOTE:\tThe LCS session cancellation with the UE and NG-RAN is to be completed before the UE is handed over to LTE.\n8.\t[Conditional] If the step 7 is performed, the 5GC-GMLC forwards the location request to the EPC-GMLC including all the parameters of the LCS Request and the target MME ID. The location result from step 6 and 7 may also be included as one of the candidates of EPC-GMLC's location result.\n9.\tThe EPC-GMLC may reconstruct the request (e.g. area information in EUTRA for area event), it forwards the LCS Request to the Target MME received at step 8 in the case of MT-LR. The LCS session is started in EPS (e.g. steps 2-10 in Figure 9.18 of TS 23.271 [4]). In the case of MO-LR, the UE restarts the EPC-MO-LR.\n10.\t[Conditional] If step 8 is performed, the UE location estimate is returned by the EPC-GMLC to the 5GC-GMLC\n11.\t[Conditional] If step 10 is performed, 5GC-GMLC forwards the result from EPC-GMLC to the AF/LCS Client. AF/LCS Client is transparent to the Handover process.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2",
        "clause_6.2",
        "figure_6.19.1.1-1",
        "ts_23.502_figure_4.11.1.2.1-1",
        "ts_23.271_figure_9.18",
        "ts_23.502",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.1.2",
      "section_id": "6.19.1.2",
      "section_title": "Location Service Continuity from EPS to 5GS with N26 Interface for Immediate Location Request",
      "content": "Figure 6.19.1.2-1: Location Service Continuity from EPS to 5GS with N26 Interface for Immediate Location Request\n1.\tTarget UE positioning is started in EPS, e.g. Steps 1-7 of EPC-MT-LR procedure in Figure 9.18 or steps 1-4 of EPC-MO-LR procedure in Figure 9.8d of TS 23.271 [4].\n2.\tDuring the EPC-MT-LR or EPC-MO-LR, EPS to 5GS handover happens successfully, as described in steps 1-14 in figure 4.11.1.2.2.2-1 of TS 23.502 [19] - MME receives Forward Relocation Complete Notification from the AMF and stored the AMF ID.\n3.\t[Conditional] If the location request is received from EPC-GMLC, MME sends Subscriber Location Report to GMLC with Handover event type, UE identifies and AMF ID as target node information, EPC-GMLC identifies the handover by event type and target AMF.\n4.\tThe LCS session is cancelled as described in clause 9.4.3a of TS 23.271 [4].\n5.\t[Conditional] If step 3 is performed, the EPC-GMLC forwards the location request to the 5GC-GMLC including all the parameters of the LCS Request and the target AMF ID.\n6.\tThe 5GC-GMLC may reconstruct the request (e.g. convert the area information for area event), it forwards the LCS Request to the Target AMF received in the case of MT-LR. The LCS session is started in 5GS. In the case of MO-LR, the UE restarts the 5GC-MO-LR.\n7.\t[Conditional] If step 5 is performed, the response is returned by the 5GC-GMLC to the EPC-GMLC.\n8.\t[Conditional] If step 7 is performed, EPC-GMLC forwards the response from 5GC-GMLC to the LCS Client.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.271_clause_9.4.3",
        "figure_6.19.1.2-1",
        "figure_9.18",
        "ts_23.271_figure_9.8",
        "ts_23.502_figure_4.11.1.2.2.2-1",
        "ts_23.271",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.1.3",
      "section_id": "6.19.1.3",
      "section_title": "Location Service Continuity from 5GS to EPS without N26 Interface for Immediate Location Request",
      "content": "Figure 6.19.1.3-1: Location Service Continuity from 5GS to EPS without N26 Interface for Immediate Location Request\n1.\tTarget UE positioning is started in 5GS, e.g. Steps 1-12 of 5GC-MT-LR procedure in clause 6.1.2, or steps 1-5 of 5GC-MO-LR procedure in clause 6.2.\n2.\t[Conditional] If the 5GC-GMLC sends the message in step 4 or step 5 in Figure 6.1.2-1, 5GC-GMLC invokes the Nudm_EventExposure_Subscribe to HSS+UDM to subscribe the CN Type change event report.\n3.\tLMF handles the ongoing LCS session.\n4.\t5GS to EPS mobility happens successfully as described in Figure 4.11.2.2-1 of TS 23.502 [19].\n5.\t[Conditional] If step 2 is performed, the UDM detects that the CN Type of UE changes, the UDM notifies the CN Type of UE to 5GC-GMLC by invoking the Nudm_EventExposure_Notify service operation.\n6a.\tThe LMF invokes Nlmf_Location_DetermineLocation Response including failure.\n6b.\tThe AMF invokes Namf_Location_ProvidePositioningInfo Response including failure.\n7.\tThe steps 8~ 11 in the location service continuity from 5GS to EPS with N26 interface for immediate location request in clause 6.19.1.1 are performed in the case of MT-LR. In the case of MO-LR, the UE restarts the EPC-MO-LR procedure.\nNOTE:\tThe 5GC-MT-LR in 5GS may be failed because of timeout of the location request. The 5GC-GMLC can trigger the step 6 when the LIR in 5GS is failed.\n8.\t[Conditional] If step 2 is performed, 5GC-GMLC invokes the Nudm_EventExposure_UnSubscribe to HSS+UDM to cancel the subscription of the CN Type change event report.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.1.2",
        "clause_6.2",
        "clause_6.19.1.1",
        "figure_6.19.1.3-1",
        "figure_6.1.2-1",
        "ts_23.502_figure_4.11.2.2-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.1.4",
      "section_id": "6.19.1.4",
      "section_title": "Location Service Continuity from EPS to 5GS without N26 Interface for Immediate Location Request",
      "content": "Figure 6.19.1.4-1: Location Service Continuity from EPS to 5GS without N26 Interface for Immediate Location Request\n1.\tTarget UE positioning is started in EPS, e.g. Steps 1-7 of EPC-MT-LR procedure in Figure 9.18, or steps 1-4 of EPC-MO-LR procedure in Figure 9.8d in TS 23.271 [4].\n2a-2c.\t[Conditional] If the EPC-GMLC initiates the location request, the EPC-GMLC requests the 5GC-GMLC to subscribe the CN Type change event report. The 5GC-GMLC invokes the Nudm_EventExposure_Subscribe to HSS+UDM to subscribe the CN Type change event report.\n3.\tE-SMLC handles the ongoing LCS session.\n4.\tEPS to 5GS mobility happens successfully as described in Figure 4.11.2.3-1 of TS 23.502 [19].\n5.\t[Conditional] If step 2 is performed, the UDM detects that the CN Type of UE changes, the UDM notifies the CN Type of UE to 5GC-GMLC by invoking the Nudm_EventExposure_Notify service operation. The 5GC-GMLC notifies the CN Type of UE to EPC-GMLC.\n6.\tThe steps 5~ 8 in the location service continuity from EPS to 5GS with N26 interface for immediate location request in clause 6.19.1.2 are performed in the case of MT-LR. In the case of MO-LR, the UE restarts the EPC-MO-LR procedure.\nNOTE:\tThe EPC-MT-LR in EPS may be failed because of timeout of the location request. The EPC-GMLC can trigger the step 6 when the LIR in EPS is failed.\n7.\t[Conditional] If step 2 is performed, 5GC-GMLC invokes the Nudm_EventExposure_UnSubscribe to HSS+UDM to cancel the subscription of the CN Type change event report.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.19.1.2",
        "figure_6.19.1.4-1",
        "figure_9.18",
        "ts_23.271_figure_9.8",
        "ts_23.502_figure_4.11.2.3-1",
        "ts_23.271",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.2",
      "section_id": "6.19.2",
      "section_title": "Location Service Continuity between EPS and 5GS (bi-direction) for deferred MT-LR",
      "content": "This clause shows the procedure to support location service continuity between EPS and 5GS (bi-direction) for deferred MT-LR. Clause 6.19.2.1 shows the procedure for 5GS to EPS handover case and clause 6.19.2.2 shows the procedure for the EPS to 5GS handover case.\nCancellation of the reporting of location events is still supported using the procedures in clause 6.3.2 and clause 6.3.3 and clauses 9.1.19.2 and 9.1.19.3 of TS 23.271 [4], with the enhancement that for the UE or Client initiated cancel procedure in EPS, after EPC-(H)GMLC receiving LCS Cancel Service request, it also transfers the request to 5GC-(H)GMLC then 5GC-(H)GMLC initiate the cancel procedure of clause 6.3.3; for UE or Client initiated cancel procedure in 5GS, after 5GC-(H)GMLC receiving LCS Cancel Service request, it also transfers the request to EPC-(H)GMLC to release context in EPC-(H)GMLC.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.19.2.1",
        "clause_6.19.2.2",
        "clause_6.3.2",
        "clause_6.3.3",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.2.1",
      "section_id": "6.19.2.1",
      "section_title": "Location Service Continuity from 5GS to EPS",
      "content": "Figure 6.19.2.1-1: LCS Continuity Solution for 5GS to EPS Mobility\n1.\tSame as step 1 of deferred 5GC-MT-LR procedure in clause 6.3.1, with the enhancement that 5GC-(H)GMLC obtains the LDR reference number and EPC-(H)GMLC address from EPC-(H)GMLC for the periodic or triggered location session. If the deferred LCS service request in this step contains multiple location QoS, location QoS mapping is performed by 5GC-(H)GMLC and a mapped location QoS applicable to EPS is also transferred to LMF.\nNOTE 1:\tMultiple QoS class is supported in 5GS but not in EPS.\n2.\tTarget UE positioning starts in 5GS with steps 2~15 of deferred 5GC-MT-LR procedure in clause 6.3.1.\n-\tIf handover happens before step 16 in clause 6.3.1, the UE has not received the LCS Periodic-Triggered Invoke Request message. After handover complete, the AMF notifies 5GC-GMLC. The 5GS to EPS handover notification also includes the MME ID for the target UE. The 5GC-GMLC sends the location request with the mapped location QoS to EPC-GMLC to trigger the deferred/periodic MT-LR in EPS (i.e. steps 3-11 in clause 6.19.1.1 are performed with the enhancement in step 8 that 5GC-GMLC perform location QoS mapping, then obtain and forward the mapped location QoS which can be applicable to EPS to EPC-GMLC, the mapping may be performed by choosing the most stringent values from the \"LocationQoS\" and set the \"LcsQoSClass\" in \"LocationQoS\" as the \"Best Effort\" and with the difference that in step 9 in clause 6.19.1.1, the performed procedure is the steps 3-20 of Deferred EPC-MT-LR in clause 9.1.19.1 in TS 23.271 [4]) and steps 3a-9 are not performed;\n-\tIf handover or UE movement with IDLE state happens after step 16 in clause 6.3.1, the UE has received the LCS Periodic-Triggered Invoke Request message. The UE does not release the deferred MT-LR context after handover or movement with IDLE state. The following steps 3a-9 are performed;\n3a.\t[Conditional] In the periodic or triggered 5GC-MT-LR case, if the LCS QoS class in location request is \"multiple QoS class\" and there is a mapped location QoS mapped by GMLC in the location request, the LMF includes the mapped location QoS in step 3b if the access type allowed for the UE for event reporting includes \"E-UTRAN connected to EPC\".\n3b~3c.\t[Conditional] In the deferred periodic or triggered 5GC-MT-LR case, LMF sends the LCS Periodical-Triggered Invoke Request to UE. If step 3a is performed, besides the multiple location QoS, the request also includes the mapped location QoS used for EPS. UE response to LMF with the LCS Periodical-Triggered Invoke Return Result.\n4.\t[Conditional] LMF sends the Nlmf_Location_DetermineLocation Response to AMF.\n5.\t[Conditional] UE may stay in 5GC over a period of time and the deferred 5GC-MT-LR procedure can continue in 5GS.\n6.\t[Conditional] 5GS to EPS handover happens or UE moves to EPS with IDLE state. The LMF in 5GS does not release resource for the deferred MT-LR session after this step.\n7-8.\t[Conditional] For the deferred periodic or triggered MT-LR case, when the event is detected by UE in EPS, the UE shall send an LCS MO-LR Invoke message for event report to the MME. If the location QoS is multiple QoS in 5GS, the UE shall include the mapped location QoS which is applicable to EPS in the LCS MO-LR Invoke message.\n9.\t[Conditional] For the deferred periodic or triggered MT-LR case, the procedure continues with step 15-23 as described in Figure 9.1.19.1-1 of TS 23.271 [4]\n10-11.\t[Conditional] EPC-(H)GMLC sends LCS Service Response to 5GC-(H)GMLC and 5GC-(H)GMLC performs the step 30 of Figure 6.3.1-1.\nNOTE 2:\tIf UE detects handover is not complete but the event is triggered, i.e. Step 8 happens before handover complete, the UE waits for handover complete to send the triggered LCS MO-LR Invoke message. For area event, the geographical area can be mapped into cell(s)/TAI(s) corresponding to 5GS and EPS, so UE can detect area event based on received cell(s)/TAI(s) no matter it is in 5GS or EPS.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.19.1.1",
        "ts_23.271_clause_9.1.19.1",
        "figure_6.19.2.1-1",
        "ts_23.271_figure_9.1.19.1-1",
        "figure_6.3.1-1",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.19.2.2",
      "section_id": "6.19.2.2",
      "section_title": "Location Service Continuity from EPS to 5GS",
      "content": "Figure 6.19.2.2-1: LCS Continuity Solution for EPS to 5GS Mobility\n1.\tTarget UE positioning starts in 5GS with steps 1-3 of deferred 5GC-MT-LR for periodic, triggered and UE available location events procedure in clause 6.3.1.\n2.\tThe target UE is registered in EPC, 5GC-GMLC sends LCS Service Request to EPC-GMLC. The 5GC-GMLC derives the address of EPC-GMLC by using the mechanisms described in step 2 in clause 6.13.1.\n3.\tTarget UE positioning starts in EPS with steps 1-16 of deferred EPC-MT-LR procedure for Periodic and Triggered Location procedure in Figure 9.1.19.1-1 of TS 23.271 [4], with enhancement that EPC-(H)GMLC obtains LDR reference number and 5GC-(H)GMLC address from 5GC-(H)GMLC for the periodic or triggered location session.\n-\tIf handover happens before step 9 in clause 9.1.19.1 of TS 23.271 [4], the UE has not received the LCS Periodic-Triggered Event Invoke message. After handover complete, the MME notifies EPC-GMLC. The EPS to 5GS handover notification also includes the AMF ID for the target UE. The EPC-GMLC sends the location request to 5GC-GMLC to trigger the deferred/periodic MT-LR in 5GS (i.e., steps 3-8 in clause 6.19.1.2 are performed with the difference that in step 6, the performed procedure is the steps 2-29 of Deferred 5GC-MT-LR procedure clause 6.3.1) and steps 4-7 are not performed;\n-\tIf handover or UE movement with IDLE state happens after step 9 in clause 9.1.19.1, the UE has received the LCS Periodic-Triggered Event Invoke message. The following steps 4-7 are performed.\n4.\t[Conditional] 5GS to EPS handover happens or UE moves to EPS with IDLE state.\n5-7.\t[Conditional] For the deferred periodic or triggered MT-LR case, when the event is detected by UE in 5GS, the UE should send an Event Report message to the LMF through AMF.\nFor the deferred periodic or triggered MT-LR case, the procedure continues with steps 26-30 as described in clause 6.3.1.\nNOTE:\tIf UE detects handover is not complete but the event is triggered, i.e. Step 5 happens before handover complete, the UE waits for handover complete to send the event report message.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.13.1",
        "ts_23.271_clause_9.1.19.1",
        "clause_6.19.1.2",
        "clause_9.1.19.1",
        "figure_6.19.2.2-1",
        "ts_23.271_figure_9.1.19.1-1",
        "ts_23.271"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.20.1",
      "section_id": "6.20.1",
      "section_title": "Procedures of SL-MO-LR involving LMF",
      "content": "Figure 6.20.1-1 illustrates a procedure to enable a UE to obtain Ranging/Sidelink Positioning location results using one or more other UEs with the assistance of an LMF in a serving PLMN for UE1.\nThe Ranging/Sidelink Positioning location results may include absolute locations, relative locations, i.e. distances and/or directions from other UEs, velocities and relative velocities, depending on the service request. The Ranging/Sidelink Positioning location results may be represented by a geographical coordinate or a local coordinate or both.\nIf the Target UE decides to initiate SL-MO-LR procedure, it includes one or multiple SL reference UE(s) / Located UE (s) in the service request. See TS 23.586 [40] for more information on how this generic procedure can be used.\nFigure 6.20.1-1: SL-MO-LR Procedure\nPrecondition:\tUE1 is in coverage and registered with a serving PLMN that supports Ranging/Sidelink Positioning. UEs 2 to n may or may not be in coverage and, if in coverage and are registered in the same serving PLMN as UE1 as specified in clause 5.5.1 of TS 23.586 [40].\nIn this procedure, the information in the SLPP messages sent between UEs 2 to n and UE-1 is included in the SLPP messages in the supplementary service messages sent between UE-1 and the LMF. For this case, the supplementary service messages are used in the following steps 8, 9, 10, 11, 13, 14, 15, 19 and 23. When information other than SLPP message(s) for UE1 need to be included, supplementary service message is used to send the information, otherwise, only the SLPP message(s) is used between UE-1 and LMF.\n1.\tThe procedures and signalling specified in clause 6.2 of TS 23.586 [40] are used to provision the Ranging/Sidelink positioning service authorization and policy/parameter provisioning to UEs 1 to n.\n2.\tBased on a trigger of service request (e.g. received from the application layer), which includes UE1/.../UEn, UE discovery is performed for Ranging/Sidelink positioning as specified in clause 6.4 of TS 23.586 [40]:\n-\tIf UE1 is the target UE, UE1 discovers UEs 2 to n.\n3.\tSecure groupcast and/or unicast links are established between UEs 1 to n to enable UE1 to exchange Ranging and Sidelink Positioning Protocol (RSPP) messages over PC5-U reference point with each of UEs 2 to n and possibly enabling UEs 2 to n to exchange RSPP over PC5-U between each other as defined in clause 5.3 of TS 23.586 [40]. Groupcast and/or unicast links are only established between UEs 1 to n that are registered in the same PLMN.\nSecurity mechanisms defined for V2X unicast mode communication in TS 33.536 [44] and for 5G ProSe unicast mode Direct Communication in TS 33.503 [45] are reused. The Security procedures for RSPP signalling using groupcast mode is specified in TS 33.533 [46].\n4.\tUE1 and UEs 2 to n may communicate over PC5 for authorization of Ranging/Sidelink positioning. Each UE verifies that Ranging/Sidelink positioning is permitted, including whether Ranging/SL positioning results may be transferred to an LCS Client or AF if this is used, according to any service authorization and policy/parameter provisioning received at step 1. This step is specified in TS 33.533 [46].\n5.\tThe Ranging/Sidelink positioning capabilities exchange between UE-1 and UEs 2 to n is performed using SLPP message(s) as specified in TS 38.355 [47] via the groupcast and/or unicast links established in step 3.\nStep 4 and 5 may be performed to transfer the information of UEs which are not served by the LMF.\nNOTE 1:\tUE2/.../UEn is not assumed to be served by the same LMF serving UE1.\n6.\tBased on the Ranging/Sidelink positioning capabilities of UE1/.../UEn, the target UE determines SL-MO-LR is to be performed.\n7.\tIf UE1 is in CM-IDLE state, UE1 instigates a UE triggered Service Request in order to establish a signalling connection with the serving AMF of UE1.\n8.\tUE1 sends a supplementary services SL-MO-LR request message to the serving AMF in an UL NAS TRANSPORT message. The SL-MO-LR request indicates the other UEs 2 to n (using Application Layer ID), indicates any assistance data needed, indicates whether location calculation assistance is needed, and indicates whether location results should be transferred to an LCS client or AF. The message may include the identity of the LCS client or the AF and may include the address of the GMLC through which the LCS client or AF (via NEF) should be accessed. In addition, a Service Type indicating which MO-LR service of the LCS Client is requested by the UE may be included. For location calculation assistance from the LMF, the preferred type of Ranging/Sidelink positioning location results (e.g. absolute locations, relative locations or distances and directions between pairs of UEs, velocities and relative velocities) and the required QoS are included.\n9.\tThe serving AMF selects an LMF serving UE1 (e.g. an LMF that supports Ranging/Sidelink positioning) and sends an Nlmf_Location_DetermineLocation service operation towards the LMF with the information from the SL-MO-LR Request. The service operation includes a LCS Correlation identifier. AMF may include its stored information from step 21, the sidelink positioning capabilities of UE1 in the service operation.\n10.\tThe LMF may send a request to UE1 for the required capabilities of UEs 2 to n using supplementary service message with embedded SLPP message(s) as specified in TS 38.355 [47] and the correlated application layer ID(s) for SLPP message(s) for UEs 2 to n. The LMF requests for the capabilities of UE1 by SLPP message.\nLMF may also provide the list of candidate Located UE(s), identified by the Application Layer ID by supplementary service message to UE1, if absolute location is requested at step 8. LMF also includes capabilities of each candidate Located UE in the request, if available, when Target UE selecting Located UE is indicated.\n11.\tUE 1 returns its capabilities to the LMF using SLPP message as specified in TS 38.355 [47] if requested by the LMF at step 10. UE1 may additionally return the capabilities of the other UEs if requested by the LMF at step 10 using supplementary service message(s) with embedded SLPP message(s) and the correlated Application Layer ID(s). UE1 requests the capabilities of UE2 to n separately using SLPP message over PC5 if step 5 is not performed. After checking the capabilities of the UEs, LMF may downselect the UEs (so called, down-selected list of UEs) for SL positioning operation. UE 1 also indicates the selected Located UE(s) to the LMF in the response.\nNOTE 2:\tThe embedded SLPP message(s) can be differentiated by the correlated Application Layer ID(s) included in the supplementary service message.\n12.\tIf Target UE's absolute location information is required at step 8, LMF can either retrieved the location of the Located UE(s) locally if available or triggers 5GC-MT-LR procedure to the (V)GMLC to acquire the absolute location of the Located UE(s) using Application Layer ID of the Located UE(s). LMF may use the QoS requirement for Target UE's positioning received at step 8 to derive the required QoS for Located UE(s) positioning and includes the required QoS for Located UE positioning in the request to GMLC. If scheduled location time is used in step 15, LMF includes the same scheduled location time in the request to GMLC. (V)GMLC requests to retrieve the mapping of Application Layer ID to GPSI as specified in clause 4.3.9 of TS 23.586 [40]. If mapping of Application Layer ID to GPSI is not available for any of these Located UE(s), the UE(s) is considered as roaming UE. The (V)GMLC uses local configuration to get home PLMN ID. The (V)GMLC triggers 5GC-MT-LR procedure to the home GMLC of each of these roaming Located UE(s) to acquire the absolute location of the UE(s).\n13.\tUE1 may send a request for specific assistance data to the LMF, if not requested in step 8.\n-\tFor the specific assistance data used by UE1, the request is transmitted by SLPP message.\n-\tFor the specific assistance data used by UE2/…/UEn, the request is transmitted by supplementary service message with embedded SLPP messages and correlated Application Layer IDs.\n14.\tLMF sends the requested assistance data to UE1 and optionally a down-selected list of UEs using an SLPP message for UE1 assistance data and using supplementary service message(s) with embedded SLPP message(s) for UE 2 to n assistance data as specified in TS 38.355 [47] and the correlated Application Layer ID(s). UE1 forwards the assistance data received from LMF to UE2/.../UEn (or the indicated downselection thereof) using SLPP messages as specified in TS 38.355 [47]. The assistance data may assist UEs 1 to n (or the indicated downselection thereof) to obtain Sidelink location measurements at step 16 and/or may assist UE1 to calculate Ranging/Sidelink positioning location results at step 18 and may include the absolute location(s) of Located UE(s) in case the LMF determines to use Network-assisted SL Positioning and if absolute location information is requested in step 8.\nNOTE 3:\tSteps 10 and 11 can be omitted if UE1 includes messages containing the capabilities of UEs 1 to n in the SL-MO-LR request at step 8 and step 9. Step 13 can be omitted if UE1 includes a message containing the request for specific assistance data in the SL-MO-LR request at step 8.\n15.\tIf the SL-MO-LR request at step 8 indicated location calculation assistance is needed and/or indicated transfer of Ranging/Sidelink positioning location results to an LCS Client or AF, the LMF sends a request for location information of UE1 by SLPP message and location information of UE2-UEn by supplementary service message. If LMF determines to apply Network-assisted Sidelink Positioning, LMF includes in the request the indication of Network-assisted Sidelink Positioning. If scheduled location time is not received at step 9. LMF may generate a scheduled location time, e.g. based on response time, and include the scheduled location time in the request.\n16.\tUE1 performs a Ranging/Sidelink positioning procedure among UEs 1 to n (or the indicated downselection thereof) in which UEs obtain Sidelink location measurements and UEs 2 to n (or the indicated downselection thereof) transfer their Sidelink location measurements to UE1. If scheduled location time is received at step 15, Sidelink positioning/ranging is performed at the scheduled location time. This procedure is specified in TS 38.355 [47].\n17. For the case of Network-assisted SL Positioning (i.e., the indication of Network-assisted SL Positioning is received in step 15), if Target UE's absolute location information is required at step 8 and if absolute location of Located UE(s) is not available, the Target UE may send a supplementary services request to the Located UE(s) to request their locations. The Located UEs may already know their locations or may trigger 5GC-MO-LR procedure to acquire their own absolute location, after which a Located UE may provide the location of the Located UE to the Target UE. The QoS requirement for Target UE's positioning, is used by the Target UE to derive the required QoS for Located UE(s) positioning. The required QoS for Located UE(s) positioning is included in the request.\nNOTE 4:\tBased on implementation, a Located UE may locally check whether it is allowed to share its absolute location.\n18.\tIf LMF determined in step 15 to use Network-assisted Sidelink Positioning, at least one of UE1/.../UEn calculates Ranging/Sidelink positioning location results based on the Sidelink location measurements obtained at step 16 and possibly using assistance data received at step 14 as specified in TS 38.355 [47]. The Ranging/Sidelink positioning location results can include absolute locations, relative locations i.e. distance and/or directions related to the UEs.\n19.\tIf UE1 received a request for location information at step 15, UE1 sends a response using supplementary service message with embedded SLPP message(s) as specified in TS 38.355 [47] and the correlated Application Layer ID(s) for SLPP message(s) for UEs 2 to n to the LMF to include the Sidelink location measurements obtained at step 16 or the Ranging/Sidelink positioning location results obtained at step 18 if step 18 was performed. In the response message, UEs 2 to n (or the indicated downselection thereof) are identified by its Application Layer ID. If only UE1's location information is sent, UE1 sends a response using SLPP message for UE1 to LMF.\n20.\tIf the LMF will calculate location results, the LMF calculates Ranging/Sidelink positioning location results for the target UE based on the Sidelink location measurements received at step 19 and absolute location of Located UE(s) at step 12 or step 17. The Ranging/Sidelink positioning location results can include absolute locations, relative locations i.e. distance and/or directions related to the UEs, depending on the location request received in step 8.\n21.\tThe LMF returns an Nlmf_Location_DetermineLocation service operation response to the AMF and includes the Ranging/Sidelink positioning location results received at step 19 or calculated at step 20. The service operation may also contain the UE1's sidelink positioning capabilities if the capabilities are received in step 11 including an indication that the capabilities are non-variable and not received from AMF in step 9.\n22.\tIf Ranging/Sidelink positioning location results were received at step 21, the AMF performs steps 7-12 of clause 6.2 to send the Ranging/Sidelink positioning location results to the GMLC and to an AF or LCS Client if this was requested at step 8. The Ranging/Sidelink positioning location results include the identities for the respective UEs received at step 8. The AMF may store the UE1's sidelink positioning capabilities from step 21.\nNOTE 5:\tSending location results to an AF or LCS Client may require privacy verification from UEs and/or from the HPLMNs of UEs.\n23.\tThe AMF returns a supplementary services SL-MO-LR response to UE1 in a DL NAS TRANSPORT message and includes any Ranging/Sidelink positioning location results received at step 21 if the SL-MO-LR request at step 8 indicated location calculation assistance is needed.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.586_clause_5.5.1",
        "ts_23.586_clause_6.2",
        "ts_23.586_clause_6.4",
        "ts_23.586_clause_5.3",
        "ts_23.586_clause_4.3.9",
        "clause_6.2",
        "figure_6.20.1-1",
        "ts_23.586",
        "ts_33.536",
        "ts_33.503",
        "ts_33.533",
        "ts_38.355"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.20.2",
      "section_id": "6.20.2",
      "section_title": "5GC-MO-LR Procedure using Ranging/SL positioning",
      "content": "This procedure is used to estimate the location of a UE based on the location of one or more Located UEs and the distance and/or direction between the UE and the Located UE(s). 5GC-MO-LR Procedure as defined in clause 6.2 applies with the following differences:\n-\tIn step 3, the AMF may take the UE's Ranging/Sidelink Positioning capability into account for LMF selection.\n-\tIn step 4, the AMF provides the UE's Ranging/Sidelink Positioning capability to LMF.\n-\tStep 5 is replaced by step 10-16 of clause 6.20.3 with the following adaptations:\n-\tUE1 is the target UE, and UE2/.../UEn is the Located UE.\n-\tIn step 10, the type of required location results is absolute  location, and the other UEs 2 to n are the candidate Located UE(s) if included. After LMF determines that the assistance of Located UE is needed for Target UE Positioning, LMF decides that Target UE or LMF selects Located UE, and SL-MT-LR request also includes the indication of Target UE/LMF selecting Located UE. LMF includes capabilities of each candidate Located UE in the request, if available, when Target UE selecting Located UE is indicated.\n-\tIn step 14, if UE1 receives the indication of LMF selecting Located UE in step 11, SL-MT-LR response includes the obtained information of all the discovered Located UEs. LMF performs the Located UE selection based on the obtained information of all the discovered Located UEs, and sends Application Layer ID of the selected Located UEs to the UE1 in step 16. If UE1 receives the indication of Target UE selecting Located UE in SL-MT-LR request, UE1 performs the Located UE selection, and SL-MT-LR response includes Application Layer ID of the selected Located UEs.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.2",
        "clause_6.20.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.20.3",
      "section_id": "6.20.3",
      "section_title": "Procedures of SL-MT-LR involving LMF",
      "content": "The SL-MT-LR procedure is used to estimate the relative locations or distances and/or directions between the UEs or absolute location of a Target UE.\nFigure 6.20.3-1 illustrates a procedure to enable an LCS Client or AF to obtain Ranging/Sidelink Positioning location results for a group of n UEs (n≥2), i.e. UE1, UE2, ..., UEn. In the procedure, the GMLC determines a UE among the n UEs to be designated UE1 (i.e. Target UE in TS 23.586 [40]) and one or more other UEs designated UE2, UE3, ..., UEn (n≥2) (i.e. Reference/Located UEs in TS 23.586 [40]). The Ranging/Sidelink Positioning location results may include absolute locations, relative locations or distances and directions related to the UEs, velocities and relative velocities based on the service request. The Ranging/Sidelink Positioning location results may be represented by a geographical coordinate or a local coordinate or both.\nProcedure for periodic and triggered SL-MT-LR is defined in clause 6.20.4.\nFigure 6.20.3-1: SL-MT-LR Procedure\nPrecondition:\tAt least one of the n UEs is in coverage and registered with a serving PLMN that supports Ranging/Sidelink Positioning.\n1.\tThe LCS Client or the AF (via NEF) sends an LCS service request by invoking the Ngmlc_Location_ProvideLocation service operation to the (H)GMLC for Ranging/Sidelink Positioning location results for the n UEs which may each be identified by an Application Layer ID and/or a GPSI and/or a SUPI. The request may include the required QoS, the required location results (e.g. absolute locations, relative locations or distances and/or directions related to the UEs, velocities and relative velocities), the SL reference UE(s) in case of relative locations, distance, or direction, Located UE(s) and Coordinate ID defined in TS 38.455 [15] representing a local coordinate in case of absolute locations. The information of UE initiating the Ranging/SL Positioning may be included to help (H)GMLC select the corresponding UE in step 3. The (H)GMLC or NEF authorizes the LCS Client or the AF for the usage of the LCS service. If the authorization fails, the remaining steps are skipped and the (H)GMLC or NEF responds to the LCS Client or the AF with the failure of the service authorization.\nIn addition, an Application Layer ID shall be used for each of the n UEs to enable discovery of the UEs at step 12. If any of the UEs belongs to another PLMN, then (H)GMLC requests the Home GMLC of each of those UEs to retrieve the mapping information between Application Layer ID and GPSI. The Home GMLC of each of those UEs queries the NEF in its own PLMN for the mapping Application Layer ID as specified in clause 4.3.9 of TS 23.586 [40].\n2.\tThe (H)GMLC invokes a Nudm_SDM_Get service operation towards the UDM of each of the n UEs to get the privacy settings of the UE identified by its GPSI or SUPI. The UDM returns the UE Privacy setting of the UE. The (H)GMLC checks the UE Ranging/SL Positioning privacy profile. If only the UE's SUPI is provided to the (H)GMLC, (H)GMLC can get the UE's GPSI along with the privacy settings. If Application layer IDs of the UEs are not provided to the (H)GMLC, the (H)GMLC can query the NEF for the mapping Application Layer ID as specified in clause 4.3.9 of TS 23.586 [40]. If any of UEs belong to another PLMN, then (H)GMLC sends a request to the Home GMLC of each of those UEs to check the Ranging/SL positioning privacy information of those UE(s) identified by GPSI or SUPI. The Home GMLC of each of those UEs queries the UDM in its own PLMN via Nudm_SDM_Get service operation to get the privacy settings of the UE and sends back the privacy check result to the (H)GMLC.\n3.\tThe (H)GMLC invokes a Nudm_UECM_Get service operation towards the UDM of each of the n UEs (for which GPSI or SUPI is available), one at a time, using the GPSI or SUPI of each UE. The (H)GMLC selects the UE (e.g. which is treated as UE1 in following steps) that initiates the Ranging/SL Positioning and selects the corresponding serving AMF, based on UE subscription and UE reachability. If the UE is not reachable, the (H)GMLC does not select such UE to initiate the Ranging/SL Positioning.\nNOTE:\tThe UDM is aware of the serving AMF address at UE registration on an AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19]. The UDM is aware of a serving (V)GMLC address at UE registration on an AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19].\n4.\tFor a non-roaming case, this step is skipped. In the case of roaming, the (H)GMLC may receive an address of a (V)GMLC (together with the network address of the current serving AMF) from the UDM in step 3, otherwise, the (H)GMLC may use the NRF service in the (H)PLMN to select an available (V)GMLC in the (V)PLMN, based on the (V)PLMN identification contained in the AMF address received in step 3. The (H)GMLC then sends the location request to the (V)GMLC by invoking the Ngmlc_Location_ProvideLocation service operation towards the (V)GMLC. In the cases when the (H)GMLC did not receive the address of the (V)GMLC, or when the (V)GMLC address is the same as the (H)GMLC address, or when both PLMN operators agree, the (H)GMLC sends the location service request message to the serving AMF. In this case, step 4 is skipped. The (H)-GMLC also provides the LCS client type of AF, if received in step 1, or LCS client type of LCS client and other attributes to be sent to AMF in step 5.\n5.\tIn the case of roaming, the (V)GMLC first authorizes that the location request is allowed from this (H)GMLC, PLMN or from this country. If not, an error response is returned. The (H)GMLC or (V)GMLC invokes the Namf_Location_ProvidePositioningInfo service operation towards the AMF serving UE1 to request Ranging/Sidelink positioning location results of the n UEs. The service operation includes the SUPI of UE1, Application layer IDs of the UEs, the client type and may include the required LCS QoS, the required location results (e.g. relative locations i.e. distances and directions between pairs of UEs, velocities and relative velocities) and other attributes as received or determined in step 1.\n6.\tIf UE1 is in CM-IDLE state, the AMF initiates a network triggered Service Request procedure to establish a signalling connection with UE1.\nIf signalling connection establishment fails, steps 7-17 are skipped.\n7-8.\tIf the indicator of privacy check indicates an action is needed, then same operation as that of step 7-8 of clause 6.1.2 is carried out.\n9.\tThe serving AMF selects an LMF serving UE1 (e.g. an LMF that supports Ranging/Sidelink Positioning) and sends an Nlmf_Location_DetermineLocation service operation towards the LMF with the information received at step 5 e.g. required location results (e.g. relative locations i.e. distances and directions between pairs of UEs velocities and relative velocities), SL reference UE(s) in case of relative locations, Located UE(s) in the case of absolute location, Application layer IDs of the UEs if received in step 5 and whether UE1 supports RSPP. The service operation includes a LCS Correlation identifier. The AMF may include its stored sidelink positioning capabilities of UE1 provided in step 17.\n10.\tThe LMF sends an SL-MT-LR request to the serving AMF as a supplementary services message, using the Namf_Communication_N1N2MessageTransfer service operation, and the session ID parameter is set to the LCS Correlation identifier.\nThe SL-MT-LR request may include the Application Layer IDs of the other UEs 2 to n, the types of required location results (e.g. relative locations or distances and/or directions) and SL reference UE(s) in the case of relative locations.\nThe SL-MT-LR request may include the Application Layer IDs of the other UEs 2 to n, the types of required location results (absolute location), Located UE(s) and Coordinate ID in the case of absolute locations.\n11.\tThe serving AMF forwards the SL-MT-LR request and a Routing identifier equal to the LCS Correlation identifier to UE1 using a DL NAS TRANSPORT message.\n12.\tUE1 attempts to discover the other UE 2 to n using their Application Layer IDs, if not already discovered using procedure defined in clause 6.4 of TS 23.586 [40].\n13.\tUE1 obtains the required sidelink positioning capabilities of the discovered UEs via SLPP if not already obtained.\n14.\tUE1 returns a supplementary services SL-MT-LR response to the serving AMF in an UL NAS TRANSPORT message and includes the Routing identifier received in step 11. Supplementary services message may include embedded SLPP message(s) which contain UEs' Ranging capabilities and the correlated Application Layer ID(s).\nThe SL-MT-LR response indicates which of UEs 2 to n have been discovered and the sidelink positioning capabilities of the discovered UEs.\n15.\tThe serving AMF forwards the SL-MT-LR response to the LMF indicated by the Routing identifier received at step 14 and includes a LCS Correlation identifier equal to the Routing identifier.\n16.\tRanging/Sidelink Positioning of UE1 and the other discovered UEs occurs as for an SL-MO-LR as described for steps 12-20 of clause 6.20.1 with the difference that Ranging/Sidelink Positioning location measurement data or results are always returned to the LMF and the LMF indicates to UE1 at step 15 of clause 6.20.1 whether the Ranging/Sidelink Positioning location results will be calculated by the LMF (at step 20) or by UE1 (at step 18).\nFor the undiscovered UEs or UEs for which the Ranging/Sidelink Positioning location measurements cannot be obtained based on their sidelink positioning capabilities among the other UEs 2 to n, the LMF may interact with GMLC to initiate the 5GC-MT-LR procedure using Application Layer ID for UE2 to n to get their absolute locations. In order to calculate the relative locations or distances and/or directions between UE1 and these UEs, if the absolute location of UE1 is not known yet, the LMF will trigger the 5GC-MT-LR procedure to derive the location of UE1. The LMF uses the absolute locations of all the UEs to calculate the relative locations or distances and/or directions between the pairs of these UEs. LMF may determine the Ranging/Sidelink Positioning location results in local coordinate if Coordinate ID is received in step 9.\nTo fulfil the required QoS, the LMF may determine to use both Ranging/SL Positioning and Uu absolute Positioning to obtain the location results.\n17-20.\tThe LMF returns the Ranging/Sidelink positioning location results via AMF and GMLC to the LCS Client or AF as in steps 13-15 and step 24 of clause 6.1.2. The LMF result may also include the UE1's sidelink positioning capabilities if the capabilities are received in step 15 including an indication that the capabilities are non-variable and not received from the AMF in step 9. The results also include failure information of the UE(s) that was not discovered or the requested information was not possible to derive.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.20.4",
        "ts_23.586_clause_4.3.9",
        "ts_23.502_clause_4.2.2.2.2",
        "clause_6.1.2",
        "ts_23.586_clause_6.4",
        "clause_6.20.1",
        "figure_6.20.3-1",
        "ts_23.586",
        "ts_38.455",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.20.4",
      "section_id": "6.20.4",
      "section_title": "Procedures of SL-MT-LR for periodic, triggered Location Events",
      "content": "The periodic and triggered SL-MT-LR procedure is based on SL-MT-LR procedure in clause 6.20.3, and used to estimate the relative locations or distances and/or directions between the UEs periodically or following certain trigger events. LCS Client or AF to obtain Ranging/Sidelink Positioning location results for a group of n UEs (n≥2), i.e. UE1, UE2, ..., UEn either periodically or when certain trigger events occur.\nFigure 6.20.4-1: Periodic and Triggered SL-MT-LR Procedure\nIn this figure, the SLPP messages between UE 2 to n and LMF are forwarded by UE1 to the LMF or sent by the LMF to UE1 in the embedded SLPP message(s) in the supplementary services request/response.\nThe following additions apply compared to the procedure in clause 6.20.3:\n1.\tThe LCS service request further includes periodic or trigger event parameters. For periodic location, the LCS Service Request includes the time interval between successive location reports and the total number of reports. For triggered location. the LCS Service Request includes details of the trigger event, the duration of event reporting, the minimum and maximum time intervals between successive event reports, the maximum event sampling interval, whether location results shall be included in event reports, and whether only one location report is required or more than one. Trigger events can be one of the following;\n-\tranging event with distance threshold and threshold type (a, b, c or d): a trigger event occurs if the distances between at least one UE of the n UEs and each of the other UEs are such that any distance for the one UE is less than the threshold (type a), any distance for the one UE exceeds the threshold (type b), all distances for the one UE are less than the threshold (type c), or all distances for the one UE exceed the threshold (type d).\n4.\tIn the message sent by (H)GMLC, the (H)GMLC also includes a contact address for the (H)GMLC (Notification Target Address, e.g. a URI) and an LDR reference number (Notification correlation ID) to be used for event reporting at steps 24-31 defined for periodic and triggered SL-MT-LR procedure only. The LDR reference number is either allocated by (H-)GMLC based on predefined rule or allocated by NEF, if the location request is sent by an NEF at step 1.\n5.\tThe message Namf_Location_ProvidePositioningInfo service operation towards the AMF is to request periodic or triggered Ranging/Sidelink positioning location results of the n UEs. The service operation further includes the periodic or trigger event parameters and other attributes as received or determined in steps 1 and 4.\nNOTE 1:\tThe location request is sent to one VGMLC at step 4 for roaming and to one AMF at step 5, which is the serving AMF for UE1.\n10.\tThe LMF sends a supplementary services Periodic-Triggered SL-MT-LR request to the serving AMF. The LCS Periodic-Triggered SL-MT-LR request further includes a deferred routing identifier, which can be the identification of the LMF when the LMF will act as a serving LMF or a default LMF identification otherwise. The LCS Periodic-Triggered SL-MT-LR request may include the QoS and allowed or required location results at step 24 for each location event reported. The LCS Periodic-Triggered SL-MT-LR request also includes the Application Layer IDs of UEs 2 to n, the address for the (H)GMLC and LDR reference number. The requested location results (e.g. absolute locations, relative locations, distances, directions, velocities and relative velocities) for the target UE and QoS.\n11.\tThe SL-MT-LR request from AMF is Periodic-Triggered, and the Routing identifier is immediate Routing identifier.\nNOTE 2:\tThe deferred routing identifier may be global (e.g. an IP address, UUID or URI) or may be local. The deferred routing identifier is used for routing in steps 24 and 25. The immediate routing identifier included by the AMF in step 11 is used for routing in steps 14 and 15.\n14.\tThe SL-MT-LR response from UE1 is Periodic-Triggered, and Routing identifier is immediate Routing identifier. The supplementary services Periodic-Triggered SL-MT-LR response indicates whether UE1 and other UEs 2 to n accept the periodic or triggered location request and which of UEs 2 to n were discovered by UE1 at step 12.\n15.\tThe SL-MT-LR response forwarded by AMF is Periodic-Triggered, and Correlation identifier is immediate Routing identifier.\nNOTE 3:\tStep 16 in clause 6.20.3 enables the LMF to obtain the capabilities and initial location results for the UEs 1 to n.\n17-20.\tThe Ranging/Sidelink positioning location results returned by LMF to LCS Client or AF is initial one.\nThe following additional steps are dedicated for Periodic and Triggered SL-MT-LR Procedure:\n21.\tThe UEs 1 to n periodically perform Ranging/Sidelink positioning in order to support steps 22 and 24.\nNOTE 4:\tThe UEs 1 to n may perform Ranging/Sidelink positioning at intervals of the maximum event sampling interval provided at step 1.\n22.\tUE1 monitors for occurrence of the trigger or periodic event requested in step 11. For a trigger event, UE1 monitors the requested event at intervals equal to or less than the maximum event sampling interval. An event trigger is detected by UE1 when any of the following occur: (i) a requested non-periodic trigger event has been detected and the minimum reporting time interval has elapsed since the last report (if this is not the first event report); (ii) a requested periodic location event has occurred; or (iii) the maximum reporting time for a non-periodic trigger event has expired.\n23.\tUE1 performs a UE triggered service request as defined in clause 4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a signalling connection with the AMF.\n24.\tUE1 sends a supplementary services event report message to the serving AMF using the Namf_Communication_N1N2MessageTransfer service operation, and includes the deferred Routing ID received in step 11. The event report indicates the type of event being reported (e.g. whether a normal event or expiration of the maximum reporting interval) and may include location results obtained at step 21. UE1 also includes the (H)GMLC contact address, the LDR reference number, whether location results are to be reported and if so the location QoS in the event report.\n25.\tThe AMF forwards the event report to the LMF indicated by the deferred Routing ID received at step 24 and includes a Correlation ID equal to the deferred Routing ID.\n26.\tWhen the LMF receives the event report and if it can handle this event report, the LMF updates the status of event reporting (e.g. the number of event reports so far received from UE1 and/or the duration of event reporting so far) and returns a supplementary services acknowledgment for the event report to the serving AMF using the Namf_Communication_N1N2MessageTransfer service operation, and a Correlation ID identifying the LMF. The acknowledgment may optionally include a new deferred routing identifier indicating a new serving LMF or a default (any) LMF.\n27.\tThe serving AMF forwards the event report Ack and an immediate Routing ID equal to the Correlation ID to UE1 using a DL NAS TRANSPORT message. If UE1 does not receive any response from the LMF after a predefined time, i.e. the current LMF does not support the deferred location request (for temporary or permanent reasons) or due to some radio access failures, UE1 may re-send the report one or more times.\nNOTE 5:\tInclusion of a new deferred routing identifier in the event report acknowledgment at step 26 may be used to change the serving LMF (e.g. if a UE moves into an area that is better supported by a different LMF or if the serving LMF is overloaded) or to enable a default LMF to become a serving LMF.\n28.\tIf location results are needed for event reporting and not received at step 25, the LMF may instigate Ranging/Sidelink Positioning of UEs 1 to n as at step 16.\n29-31.\tThe LMF returns the event report and any location results obtained at step 25 or step 28 to the LCS Client or AF as in steps 28-30 of clause 6.3.1.\n32.\tUEs 1 to n continue to periodically perform Ranging/Sidelink positioning as in step 21.\n33.\tUE1 continues to monitor for further periodic or trigger events as in step 22 and instigates steps 23-31 each time a periodic or trigger event is detected.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_6.20.3",
        "ts_23.502_clause_4.2.3.2",
        "clause_6.3.1",
        "figure_6.20.4-1",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.20.5",
      "section_id": "6.20.5",
      "section_title": "5GC-MT-LR Procedure using Ranging/SL positioning",
      "content": "The procedure is used to estimate the location of a UE by using the location of one or more Located UEs and the distance and/or direction between the UE and the Located UE(s).\nNOTE:\tThe procedure can be triggered by GMLC, e.g. if the location result of Target UE determined by previous MT-LR procedure for the same request cannot fulfil the required QoS.\nProcedure of Figure 6.1.2-1 can be reused, with the following adaptations:\n-\tIn step 10 of Figure 6.1.2-1, the AMF may take the UE's  Ranging/Sidelink Positioning capability into account for LMF selection.\n-\tIn step 11 of Figure 6.1.2-1, the AMF provides the UE's  Ranging/Sidelink Positioning capability to LMF.\n-\tStep 12 of Figure 6.1.2-1 replaced by the step 10-16 of Figure 6.20.3-1 with the following adaptations:\n-\tUE1 is the Target UE, and UEs 2 to n are Located UEs.\n-\tIn step 10, the type of required location results is absolute  location, and the other UEs 2 to n are the candidate Located UE(s) if included. After LMF determines that the assistance of Located UE is needed for Target UE Positioning, LMF decides that Target UE or LMF selects Located UE, and SL-MT-LR request also includes the indication of Target UE/LMF selecting Located UE. LMF includes capabilities of each candidate Located UE in the request, if available, when Target UE selecting Located UE is indicated.\n-\tIn step 14, if UE1 receives the indication of LMF selecting Located UE in step 11, SL-MT-LR response includes the obtained information of all the discovered Located UEs. LMF performs the Located UE selection based on the obtained information of all the discovered Located UEs, and sends Application Layer ID of the selected Located UEs to the UE1 in step 16. If UE1 receives the indication of Target UE selecting Located UE in SL-MT-LR request, UE1 performs the Located UE selection, and SL-MT-LR response includes Application Layer ID of the selected Located UEs.",
      "chunk_type": "procedure",
      "cross_references": [
        "figure_6.1.2-1",
        "figure_6.20.3-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.21.1",
      "section_id": "6.21.1",
      "section_title": "General",
      "content": "This clause specifies procedures for NF in the LCS system to interact with NWDAF for data analytics. General framework for NF in the LCS system to interact with NWDAF for data analytics refers to the clauses 6.1.1 and 6.1.2 of TS 23.288 [37].\nClause 6.21.2 describes the procedures of Location Accuracy Analytics retrieved by LMF.\nClause 6.21.3 describes the procedures of UE Mobility Analytics retrieved by AMF.\nNOTE:\tIn this release of specification, only AMF and LMF can be NF service consumers to NWDAF.\nThe procedure in Figure 6.21-1 can be used by a 5GC NF involved in 5GC location services to get optional assistance from NWDAF as shown below.\nFigure 6.21-1: Procedure for NWDAF assistance to location services\n1.\tThe AMF may invoke Nlmf_Location_DeterminationLocation service operation towards the LMF to request the current location of the UE.\n2.\tAssistance from NWDAF for location services may be requested from the LMF and/or AMF.\n3.\tThe LMF may trigger UE positioning.\n4.\tThe LMF may return the location estimate to AMF as specified in clause 8.3.2.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.288_clause_6.21.2",
        "clause_6.21.3",
        "clause_8.3.2",
        "figure_6.21-1",
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.21.1",
      "section_id": "6.21.1",
      "section_title": "Location Accuracy Analytics Retrieval by LMF",
      "content": "LMF may request Location Accuracy Analytics from NWDAF to retrieve the location accuracy.\nThe procedure to request Location accuracy analytics by LMF is referred to clause 6.17.4 of TS 23.288 [37]. In Figure 6.17.4-1 of TS 23.288 [37] the Analytics consumer is replaced by LMF. Pre-condition of the procedure is NWDAF has a trained supervised ML model for deriving Location Accuracy Analytics.\nNOTE:\tTo assist the determination of the positioning methods for the requested LCS accuracy with the LCS accuracy analytics, LMF may know the accuracy of the positioning method(s) and NLOS/LOS measurement indication if the positioning method is NR based.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.288_clause_6.17.4",
        "ts_23.288_figure_6.17.4-1",
        "ts_23.288"
      ]
    },
    {
      "chunk_id": "ts_23.273_6.21.2",
      "section_id": "6.21.2",
      "section_title": "UE Mobility Analytics Retrieval by AMF",
      "content": "AMF may request assistance for UE location verification for NR satellite access as described in clause 6.10.1 by requesting or subscribing to UE mobility analytics from NWDAF. With NWDAF-based UE location statistics and predictions and UE location estimated by LMF, AMF can further assist UE location verification for NR satellite access.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.10.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_7.1",
      "section_id": "7.1",
      "section_title": "UDM",
      "content": "For each UE subscriber the UDM stores LCS related data as part of the Subscriber Data Management (SDM) service as defined in clause 5.2.3.3.1 of TS 23.502 [19].\nThe privacy profile data is defined in table 7.1-1 containing data for the privacy classes for which location of the target UE is permitted. For the meaning of each LCS privacy profile data type and included data, refer to clause 5.4.2.\nTable 7.1-1: LCS privacy profile data stored in the UDM for a UE Subscriber\nPrivacy Profile Data Type\nPresence\nUDM data\nLocation Privacy Indication\nM\nO\nIndication of one of the following mutually exclusive global settings:\n-\tLocation is disallowed.\n-\tLocation is allowed (default).\nTime period when the Location Privacy Indication is valid.\nCall/session Unrelated Class\nM\nO\nO\nO\nO\nO\nO\nO\nO\nO\nO\nO\nO\nO\nFor any LCS client or AF not in the external LCS client list or otherwise identified for the Call/session Unrelated Class, the following data may be present:\n-\tOne of the following mutually exclusive options:\n-\tLocation not allowed (default case)\n-\tLocation allowed with notification.\n-\tLocation with notification and privacy verification; location allowed if no response.\n-\tLocation with notification and privacy verification; location restricted if no response.\n-\tTime period when positioning is allowed.\n-\tGeographical area where positioning is allowed.\n-\tIndication that codeword shall be checked in UE or one or more codeword values to be checked in GMLC.\nExternal LCS client list: a list of zero or more LCS clients, AFs and LCS Client groups with the following data for each entry:\n-\tOne of the following mutually exclusive options:\n-\tLocation allowed without notification (default case).\n-\tLocation allowed with notification.\n-\tLocation with notification and privacy verification; location allowed if no response\n-\tLocation with notification and privacy verification; location restricted if no response\n-\tTime period when positioning is allowed\n-\tGeographical area where positioning is allowed\nService types list: a list of one or more service types for which the LCS client is allowed to locate the particular UE. The possible service types are defined in TS 22.071 [2]. The following data may be present for each service type in the list:\n-\tOne of the following mutually exclusive options:\n-\tLocation allowed without notification (default case)\n-\tLocation allowed with notification\n-\tLocation with notification and privacy verification; location allowed if no response.\n-\tLocation with notification and privacy verification; location restricted if no response.\n-\tTime period when positioning is allowed.\n-\tGeographical area where positioning is allowed.\n-\tIndication that codeword shall be checked in UE or one or more codeword values to be checked in GMLC.\nPLMN Operator Class\nO\nLCS client list: a list of one or more generic classes of LCS client that are allowed to locate the particular UE. The following classes are distinguished:\n-\tLCS client broadcasting location related information.\n-\tO&M LCS client in the HPLMN.\n-\tO&M LCS client in the VPLMN.\n-\tLCS client recording anonymous location information.\n-\tLCS Client supporting a bearer service, teleservice or supplementary service to the target UE.\n-\tNWDAF in the HPLMN (when the UE is currently being served by the HPLMN).\n-\tNWDAF in the VPLMN.\nUser Plane Connection between UE and LCS Client or AF\nO\nIndication of one of the following mutually exclusive global settings:\n-\tUE is allowed to report periodic or triggered location events via user plane to an LCS Client or AF\n-\tUE is not allowed to report periodic or triggered location events via user plane to an LCS Client or AF (default).\nEvent report expected area\nO\nPresents a geographical area generated by UE, which is used by GMLC to determine event report allowed area for the UE.\nArea usage indication\nO\nIndication of one of the following mutually exclusive global settings on using event report allowed area:\n-\tInside reporting (default).\n-\tOutside reporting.\nGMLC address list\nO\nAddresses of GMLC located in local network(s) which are allowed to be used for the UE positioning. The GMLC address is used to identify the local network for verification of location service in PNI-NPN.\nThe Mobile Originating data is defined in table 7.1-2 containing the LCS MO-LR services that a UE can receive.\nTable 7.1-2: LCS Mobile Originated data for a UE Subscriber\nMO-LR Data\nPresence\nUDM data\nMobile Originated data\nM\nList of MO-LR services allowed for a UE subscriber:\n-\tBasic Self Location (UE can receive its own location).\n-\tAutonomous Self Location (UE can receive location assistance data).\n-\tTransfer to Third Party.\nList of Assistance Data Types for MO-LR\nO\nA list of one or more types of location assistance data that may be provided to the UE in the MO-LR procedure.\nThe LCS broadcasting data is defined in table 7.1-3 containing a list of assistance data types for which ciphering keys should be provided to the UE if requested by the UE.\nTable 7.1-3: LCS broadcasting data for a UE subscriber\nBroadcasting Data\nPresence\nDescription\nList of Assistance Data Types\nO\nA list of one or more types of location assistance data for which ciphering keys should be provided to the UE if requested by the UE when the assistance data is broadcast using ciphering.\nOther UE LCS subscriber data is defined in table 7.1-4 containing UE's subscription data related with LCS.\nTable 7.1-4: UE LCS subscriber data\nUE LCS subscriber data\nPresence\nDescription\nPRU indication\nO\nWhen present, it is used to indicate that the UE is allowed to serve as a PRU.\nLPHAP indication\nO\nWhen present, it indicates a UE requires low power and high accuracy positioning.\nLMF ID\nO\nAn LMF ID which presents an LMF deployed in local network to support location service for the UE.\nIndication of user plane positioning between UE and LMF\nO\nWhen present, it indicates that the UE is allowed to use the user plane positioning between UE and LMF.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_5.2.3.3.1",
        "clause_5.4.2",
        "table_7.1-1",
        "table_7.1-2",
        "table_7.1-3",
        "table_7.1-4",
        "ts_23.502",
        "ts_22.071"
      ]
    },
    {
      "chunk_id": "ts_23.273_7.2.1",
      "section_id": "7.2.1",
      "section_title": "Information for an LCS Client",
      "content": "The GMLC holds information for external LCS clients which are permitted to request location information for UE subscribers. Table 7.2.1-1 shows the information which may be stored in the GMLC for an external LCS Client.\nTable 7.2.1-1: GMLC Information for an External LCS Client\nLCS Client Information\nStatus\nDescription\nLCS Client Type\nM\nIdentifies the type of LCS client from among the following:\n-\tEmergency Services\n-\tValue Added Services\n-\tPLMN Operator Services\n-\tLawful Intercept Services\nExternal identifier\nO\nA list of one or more identifiers used to identify an external LCS client. The identifier may be used for a 5GC-MT-LR and/or 5GC-MO-LR. The format of the identifier is an international E.164 address, ITU-T Recommendation E.164 [23].\nAuthentication data\nMO\nData employed to authenticate an external LCS client if the authentication is not done by a security gateway – details are outside the scope of the present document\nInternal identifier\nO\nIdentifies the sub-type of a PLMN operator services LCS Client from among the following:\n-\tLCS client broadcasting location related information\n-\tO&M LCS client in the HPLMN\n-\tO&M LCS client in the VPLMN\n-\tLCS client recording anonymous location information\n-\tLCS Client supporting a bearer service, teleservice or supplementary service to the target UE\nClient name\nO\nAn address string which is associated with the LCS client's external identity (i.e. E.164 address).\nClient name type\nO\nIndication of the type of the LCS client name. The type of the LCS client name can be one of the following:\n-\tLogical name\n-\tMSISDN\n-\tE-mail address (RFC 2396 [25])\n-\tURL (RFC 2396 [25])\n-\tSIP URL (RFC 3261 [26])\n-\tIMS public identity (1 23.228 [27])\n-\tGPSI\nPrivacy Override Indication\nO\nIndication of whether the LCS client possesses the POI capability (only applicable to lawful intercept and emergency services clients)\nAuthorized UE List\nO\nA list of SUPIs and/or groups of SUPI for which the LCS client may issue a request for a 5GC-MT-LR for immediate or deferred location.\nPriority\nO\nThe priority of the LCS client\nQoS parameters\nM\nThe default QoS requirements for the LCS client, comprising:\n-\tAccuracy\n-\tResponse time\n-\tLCS QoS Class\nService Coverage\nO\nA list of E.164 country codes for geographic areas, ITU-T Recommendation E.164 [23] where the LCS client is permitted to request and receive UE location information.\nAllowed LCS Request Types\nM\nIndicates which of the following are allowed:\n-\tRequest of current immediate location\n-\tRequest of current or last known immediate location\n-\tRequest of deferred location for the UE available event\n-\tRequest of deferred location for UE periodic events\n-\tRequest of deferred location for the Area Event\n-\tRequest of deferred location for the Motion Event\nLocal Co-ordinate System\nO\nDefinition of the co-ordinate system(s) in which a location estimate shall be provided – details are outside the scope of the present document\nAccess Barring List(s)\nO\nList(s) of SUPIs or groups of SUPI for which a location request is barred\nService types\nO\nList of service type allowed for the LCS client.\nMaximum Target UE Number\nO\nThe maximum number of the Target UEs in one LCS request. For a specific LCS Client, this parameter may have different values for different service types.\nUser Plane location reporting\nO\nIndicates whether or not the LCS Client is allowed to request event reporting for a periodic or triggered MT-LR over user plane.\nO\nDefault user plane address for event reporting over user plane.\nO\nDefault security information for event reporting over user plane.\nCorrelated LMF ID\nO\nAn LMF ID correlated with the LCS client, and/or\nAn LMF ID correlated with a group ID and the LCS client.",
      "chunk_type": "general",
      "cross_references": [
        "table_7.2.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.1",
      "section_id": "8.1",
      "section_title": "AMF Services",
      "content": "AMF services related to location service are defined in clause 5.2.2 of TS 23.502 [19].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_5.2.2",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.2",
      "section_id": "8.2",
      "section_title": "UDM Services",
      "content": "UDM services related to location service are defined in clause 5.2.3 of TS 23.502 [19].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_5.2.3",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.1",
      "section_id": "8.3.1",
      "section_title": "General",
      "content": "The following table shows the LMF Services and LMF Service Operations.\nTable 8.3.1-1: List of LMF Services\nService Name\nService Operations\nOperation\nSemantics\nExample Consumer(s)\nNlmf_Location\nDetermineLocation\nRequest/Response\nAMF\nEventNotify\nNotify\nGMLC\nCancelLocation\nRequest/Response\nAMF\nLocationContextTransfer\nRequest/Response\nLMF\nMeasurementData\nRequest/Response\nLMF\nUPConfig\nRequest/Response\nAMF\nUPSubcribe\nSubscribe/Notify\nAMF\nUPNotify\nAMF\nNlmf_Broadcast\nCipheringKeyData\nNotify\nAMF",
      "chunk_type": "definition",
      "cross_references": [
        "table_8.3.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.1",
      "section_id": "8.3.2.1",
      "section_title": "General",
      "content": "Service description: This service enables an NF to request location determination for a target UE. The following are the key functionalities of this NF service.\n-\tAllow the consumer NF to request the current geodetic and optionally local and/or civic location of a target UE.\n-\tAllow the consumer NF to subscribe/unsubscribe the geodetic and optionally local and/or civic location of a target UE for some certain events.\n-\tAllow the consumer NF to get notified about the geodetic and optionally local and/or civic location of a target UE when some certain events are detected.\n-\tAllows the consumer NF to cancel location event reporting for a target UE.\n-\tAllows the consumer NF to cancel a 5GC-MT-LR or 5GC-MO-LR during UE mobility from 5GS to EPS with N26 interface.\n-\tAllows the consumer NF to transfer location context information for location event reporting for a target UE.\n-\tAllows the consumer NF to request the PRU location measurement.\n-\tAllows the consumer NF to request to set up, modify or terminate a secure LCS-UP connection for a target UE.\n-\tAllows the consumer NF to get notified about status or modification of a secure LCS-UP connection for a target UE.\nThe events to trigger location estimation notification are defined in clause 4.1a.5.1",
      "chunk_type": "definition",
      "cross_references": [
        "clause_4.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.2",
      "section_id": "8.3.2.2",
      "section_title": "Nlmf_Location_DetermineLocation service operation",
      "content": "Service operation name: Nlmf_Location_DetermineLocation\nDescription: Provides UE location information to the consumer NF.\nNOTE:\tFor deferred location request, this service operation is used to implicitly subscribe to the notification of the UE location information.\nInput, Required: Client Type, LCS Correlation Identifier.\nInput, Optional: Serving cell identifier of the Primary Cell in the Master RAN node and the Primary Cell in the Secondary RAN node when available based on Dual Connectivity scenarios if the UE is using 3GPP access, required Location QoS instance(s), Supported GAD shapes, target UE identity (see clause 6.1.6.2.2, TS 29.572 [12]), service type, indication of requiring reliable UE location information, AMF identity if a UE associated Namf_Communication service is to be invoked by LMF, Type of request for a 5GC-MO-LR, Embedded LPP message(s) for a 5GC-MO-LR (1-3 messages), subscribed assistance data for a 5GC-MO-LR, Deferred location type, Deferred location parameters, indication if UE supports LPP or not, UE connectivity state per access type, Notification Target Address, Notification Correlation ID, indication of UE geographical area determination for PLMN selection verification, UE Positioning Capability, UE User Plane Positioning Capabilities (the user plane positioning using LCS-UPP and/or the user plane positioning using SUPL [49]), Ranging/Sidelink Positioning Capability, TNAPId (see TS 29.571 [33]), TWAPId (see TS 29.571 [33]), Scheduled Location Time, request for user plane reporting to an LCS Client or AF, user plane address of an LCS Client or AF, user plane security information for an LCS Client or AF, cumulative event report timer, maximum number of user plane event reports to an LCS Client or AF, event report allowed area, reporting indication, UE unaware indication, LPHAP indication, the serving cell identity belongs to a MBSR indication, Additional ULI, Application layer IDs of the UEs for Ranging/Sidelink positioning.\nOutput, Required: Success/Failure indication\nOutput, Optional: Geodetic Location, Local Location including Coordinate ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement indication, Position Methods Used (in the case of success indication provided), Serving LMF identification, Failure Cause (in the case of failure indication provided), achieved Location QoS Accuracy, UE geographical area where a PLMN is or is not allowed to operate, UE Positioning Capability, Ranging/Sidelink Positioning Capability, the timestamp of the Location, indication that the location determination will be sent directly to GMLC.\nSee clause 6.1, clause 6.2, clause 6.3.1, clause 6.9.1, clause 6.20.3 and clause 6.20.4 for examples of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.572_clause_6.1.6.2.2",
        "clause_6.1",
        "clause_6.2",
        "clause_6.3.1",
        "clause_6.9.1",
        "clause_6.20.3",
        "clause_6.20.4",
        "ts_29.572",
        "ts_29.571"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.3",
      "section_id": "8.3.2.3",
      "section_title": "Nlmf_Location_EventNotify service operation",
      "content": "Service operation name: Nlmf_Location_EventNotify.\nService operation description: Allow the consumer NF to get notified about the geodetic and optionally local and/or civic location of a target UE when some certain events are detected, either the events implicitly subscribed by the AMF using Nlmf_Location_DetermineLocation service operation or the cancellation of reporting of periodic or triggered location events.\nInput, Required: Notification Correlation ID, UE (SUPI and if available GPSI).\nInput, Optional: Geodetic Location, Local Location including Coordinate ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement indication, Position Methods Used (in the case of success indication provided), Notification Target address, Serving LMF identification, Failure Cause (in the case of failure indication provided), achieved Location QoS Accuracy, the timestamp of the Location, Type of event (e.g. including a cumulative event report for events reported via user plane), statistics on events reported via a user plane since the last cumulative event report.\nOutput, Required: None.\nOutput, Optional: Success/Failure indication.\nSee clause 6.3.1 and clause 6.3.2 for examples of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.1",
        "clause_6.3.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.4",
      "section_id": "8.3.2.4",
      "section_title": "Nlmf_Location_CancelLocation service operation",
      "content": "Service operation name: Nlmf_Location_CancelLocation\nDescription: The consumer NF cancels a deferred 5GC-MT-LR procedure for periodic or triggered location request, 5GC-MT-LR and 5GC-MO-LR procedure during UE mobility from 5GS to EPS with N26 interface.\nInput, Required: Notification Target Address and Notification Correlation ID for deferred 5GC-MT-LR procedure cancellation. LCS Correlation ID for 5GC-MT-LR and 5GC-MO-LR procedures cancellation.\nInput, Optional: None.\nOutput, Required: Success/Failure indication\nOutput, Optional: None.\nSee clause 6.3.3 for an example of usage of this service operation to cancel a deferred 5GC-MT-LR procedure for periodic or triggered location request. See clause 6.19.1.1 for an example of usage of this service operation to cancel 5GC-MT-LR and 5GC-MO-LR procedures during UE mobility from 5GS to EPS with N26 interface.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.3",
        "clause_6.19.1.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.5",
      "section_id": "8.3.2.5",
      "section_title": "Nlmf_Location_LocationContextTransfer service operation",
      "content": "Service operation name: Nlmf_Location_LocationContextTransfer\nDescription: Transfers location context information for location event reporting for a target UE from the consumer NF.\nInput, Required: AMF identity, Location QoS, Supported GAD shapes, Deferred location type, Deferred location parameters, Notification Target Address, Notification Correlation ID, Embedded event report message.\nInput, Optional: Event reporting status, UE location information, LOS/NLOS measurement indication, Indoor/Outdoor indication, UE Positioning Capabilities, Scheduled Location Time, the timestamp of the Location, request for user plane reporting to an LCS Client or AF, cumulative event report timer, maximum number of user plane event reports to an LCS Client or AF.\nOutput, Required: Success/Failure indication\nOutput, Optional: None.\nSee clause 6.4 for an example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.4"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.6",
      "section_id": "8.3.2.6",
      "section_title": "Nlmf_Location_MeasurementData service operation",
      "content": "Service operation name: Nlmf_Location_MeasurementData\nDescription: Provides PRU location measurements to the consumer NF.\nInput, Required: Target UE cell ID.\nInput, Optional: Pre-calculated location of target UE, time window(s).\nNOTE:\tThe time window(s) is the Time Window Information SRS List and the Time Window Information Measurement List specified in TS 38.455 [15] when network assisted positioning is used and is the NR-DL-PRS-MeasurementTimeWindowsConfig specified in TS 37.355 [20] when UE assisted positioning is used.\nOutput, Required: PRU location measurement(s) and associated PRU known location.\nOutput, Optional: None.\nSee clause 6.17 for an example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.17",
        "ts_38.455",
        "ts_37.355"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.2.7",
      "section_id": "8.3.2.7",
      "section_title": "Nlmf_Location_UPConfig service operation",
      "content": "Service operation name: Nlmf_Location_UPConfig\nDescription: The consumer NF requests to set up, modify or terminate a secure LCS-UP connection for a target UE.\nInput, Required: Notification Target Address, Notification Correlation ID, UE identifier (GPSI, SUPI).\nInput, Optional: AMF reallocation indication, LCS-UP connection termination indication, LCS-UP connection set up request indication, Target LMF identifier.\nOutput, Required: Success/Failure indication\nOutput, Optional: Failure Cause (in the case of failure indication provided).\nSee clauses 6.18.2 and 6.18.3 for an example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.3.2.8",
      "section_id": "8.3.2.8",
      "section_title": "Nlmf_Location_UPSubscribe service operation",
      "content": "Service operation name: Nlmf_Location_UPSubscribe\nDescription: Allow the consumer NF to subscribe about status of a secure LCS-UP connection for a target UE.\nInput, Required: Notification Target Address, Notification Correlation ID, UE identifier (SUPI and if available GPSI).\nInput, Optional: None.\nOutputs, Required: Subscription Correlation ID.\nOutputs, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.3.2.9",
      "section_id": "8.3.2.9",
      "section_title": "Nlmf_Location_UPNotify service operation",
      "content": "Service operation name: Nlmf_Location_UPNotify\nDescription: Allow the consumer NF get notified about status or modification of a secure LCS-UP connection for a target UE.\nInput, Required: Notification Correlation ID, LCS-UP connection status (established, released or move indication).\nInput, Optional: Target LMF identifier (only applicable in case of move of the connection).\nOutput, Required: None.\nOutput, Optional: None.\nSee clauses 6.18.1 and 6.18.3 for an example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.3.2.10",
      "section_id": "8.3.2.10",
      "section_title": "Nlmf_Location_UPUnSubscribe service operation",
      "content": "Service operation name: Nlmf_Location_UPUnSubscribe\nDescription: Allow the consumer NF to unsubscribe about status of a secure LCS-UP connection for a target UE.\nInput, Required: Subscription Correlation ID.\nInput, Optional: None.\nOutputs, Required: None.\nOutputs, Optional: None.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.3.3.1",
      "section_id": "8.3.3.1",
      "section_title": "General",
      "content": "Service description: This service enables an NF to receive information related to broadcast of location assistance by an LMF. The following are the key functionalities of this NF service.\n-\tAllow the consumer NF to be notified about ciphering keys used to cipher broadcast assistance data.\nThe events to trigger ciphering key notification are defined in clause 6.14.2.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_6.14.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.3.3.2",
      "section_id": "8.3.3.2",
      "section_title": "Nlmf_Broadcast_CipheringKeyData service operation",
      "content": "Service operation name: Nlmf_Broadcast_CipheringKeyData\nDescription: Provides ciphering key data to the consumer NF.\nInput, Required: For each ciphering key: ciphering key value, ciphering key identifier, validity period, set of applicable types of broadcast assistance data.\nInput, Optional: For each ciphering key: set of applicable tracking areas.\nOutput, Required: For each ciphering key: ciphering key identifier, success/failure indication.\nOutput, Optional: none.\nSee clause 6.14.2 for an example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.14.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.1",
      "section_id": "8.4.1",
      "section_title": "General",
      "content": "The following table shows the GMLC Services and GMLC Service Operations.\nTable 8.4.1-1: List of GMLC Services\nService Name\nService Operations\nOperation\nSemantics\nExample Consumer(s)\nNgmlc_Location\nProvideLocation\nRequest / Response\nGMLC, NEF, NWDAF, LMF\nLocationUpdate\nRequest / Response\nAMF, GMLC\nLocationUpdateNotify\nNotify\nNEF, NWDAF\nCancellLocation\nRequest / Response\nGMLC, NEF, NWDAF\nEventNotify\nNotify\nGMLC, NEF, NWDAF",
      "chunk_type": "definition",
      "cross_references": [
        "table_8.4.1-1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.2.1",
      "section_id": "8.4.2.1",
      "section_title": "General",
      "content": "Service description: This service enables an NF to request location determination for a target UE or to request relative locations, distance, or direction between UEs. The following are the key functionalities of this NF service.\n-\tAllow the consumer NF to request the current geodetic and optionally local and/or civic location of a target UE.\n-\tAllow the consumer NF to subscribe/unsubscribe the geodetic and optionally local and/or civic location of a target UE for some certain events.\n-\tAllow the consumer NF to cancel an on-going periodic or triggered location request of a target UE.\n-\tAllow the consumer NF to get notified about the geodetic and optionally local and/or civic location of a target UE when some certain events are detected.\n-\tAllow the consumer NF to request the relative locations, distance, or direction between UEs.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.4.2.2",
      "section_id": "8.4.2.2",
      "section_title": "Ngmlc_Location_ProvideLocation service operation",
      "content": "Service operation name: Ngmlc_Location_ProvideLocation\nDescription: Provides UE location information to the consumer NF.\nNOTE 1:\tFor deferred location request, this service operation is used to implicitly subscribe to the notification of the UE location information.\nNOTE 2:\tFor bulk LCS service request from NEF to GMLC, this service operation is used to implicitly subscribe to the notification of UE location information\nInput, Required: UE identifier (GPSI, SUPI, Application layer ID of the UEs for Ranging/Sidelink positioning, Internal Group Identifier or External Group Identifier), Client Type.\nInput, Optional: Required QoS instance(s), Supported GAD shapes, UE privacy requirements, LCS Client Identification, Service type, indication of requiring reliable UE location information, Notification Target Address, Notification Correlation ID, Event Type (defined in clause 4.1a.5.1), Scheduled Location Time, request for user plane reporting to an LCS Client or AF, user plane address of an LCS Client or AF, user plane security information for an LCS Client or AF, cumulative event report timer, maximum number of user plane event reports to an LCS Client or AF, event report expected area, reporting indication, LPHAP indication and:\n-\tFor periodic event type, optional input further includes the time interval between successive location reports, the total number of reports, location QoS.\n-\tFor area event type, optional input further includes target geographical area(s) with optionally associated required QoS instance, whether the event to be reported is the UE being inside, entering into or leaving the target area, the duration of event reporting, the minimum and maximum time intervals between successive event reports, the maximum event sampling interval, whether location estimates and associated location QoS shall be included in event reports, and whether only one location report is required or more than one.\n-\tFor motion event type, optional input further includes the threshold linear distance, the duration of event reporting, the minimum and maximum time intervals between successive event reports, the maximum event sampling interval, whether location estimates and associated location QoS shall be included in event reports, and whether only one location report is required or more than one.\n-\tFor ranging and Sidelink positioning, input further includes related UE identifiers for Located UEs or SL Reference UEs (GPSI, Application layer ID), requested location type (absolute locations, relative locations or distances and/or directions related to the UEs, velocities and relative velocities), Local Co-ordinate or Global Co-ordinate, and Coordinate ID.\nOutput, Required: Success/Failure indication\nOutput, Optional: Geodetic location, Local Location including Coordinate ID, civic location, age of location, Indoor/Outdoor indication, LOS/NLOS measurement indication, position methods used (in the case of success indication provided), failure cause (in the case of failure indication provided), achieved Location QoS Accuracy, the timestamp of the Location, Ranging result.\nSee clauses 6.3.1 and 6.8 for examples of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.1"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.2.3",
      "section_id": "8.4.2.3",
      "section_title": "Ngmlc_Location_LocationUpdate service operation",
      "content": "Service operation name: Ngmlc_Location_LocationUpdate\nDescription: Consumer NF provides UE location information to the GMLC.\nInput, Required: UE identifier (GPSI or SUPI), event causing the location estimate (5GC-MO-LR), location estimate, age of location estimate, accuracy indication, LCS QoS class.\nInput, Optional: pseudonym indicator, identity of the LCS client, identity of the AF, GMLC address, service type specified by UE, the timestamp of the location estimate.\nOutput, Required: Success/Failure indication\nOutput, Optional: Failure Cause (in the case of failure indication provided).\nSee clause 6.2 for example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.2.4",
      "section_id": "8.4.2.4",
      "section_title": "Ngmlc_Location_EventNotify service operation",
      "content": "Service operation name: Ngmlc_Location_EventNotify\nDescription: Allow the consumer NF to get notified about the geodetic and optionally local and/or civic location of one or more target UEs when some certain events, either the events implicitly subscribed by the AMF using Ngmlc_Location_ProvideLocation service operation, or the cancellation of reporting of periodic or triggered location events, are detected or at bulk reporting of location.\nInput, Required: Notification Correlation ID, UE (SUPI and if available GPSI), Type of location related event (e.g. deferred location for the UE available event, activation of location for periodic or triggered location, mobility of a target UE to a new AMF or MME for a deferred location, cumulative event report for events reported via user plane).\nInput, Optional: Geodetic Location, Local Location including Coordinate ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement indication, Position Methods Used (in the case of success indication provided), Failure Cause (in the case of failure indication provided), address of a new AMF or MME, achieved Location QoS Accuracy, the timestamp of the Location, statistics on events reported since the last cumulative event report.\nOutput, Required: None.\nOutput, Optional: None.\nSee clauses 6.3 and 6.8 for examples of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.4.2.5",
      "section_id": "8.4.2.5",
      "section_title": "Ngmlc_Location_CancelLocation service operation",
      "content": "Service operation name: Ngmlc_Location_CancelLocation\nDescription: The consumer NF uses this service operation to cancel a deferred 5GC-MT-LR procedure for periodic or triggered location.\nInput, Required: UE Identification (SUPI), Notification Target address, Notification Correlation ID.\nInput, Optional: None.\nOutput, Required: None.\nOutput, Optional: None.\nSee clause 6.3.3 for example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.3.3"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.2.6",
      "section_id": "8.4.2.6",
      "section_title": "Ngmlc_Location_LocationUpdateNotify service operation",
      "content": "Service operation name: Ngmlc_Location_LocationUpdateNotify\nDescription: Provides UE location information to the consumer NF.\nInput, Required: UE identifier (GPSI or SUPI), identity of the AF, event causing the location estimate (5GC-MO-LR), location estimate, age of location estimate, accuracy indication, LCS QoS class.\nInput, Optional: Service identity (mapped from service type by HGMLC), the timestamp of the location estimate.\nOutput, Required: Success/Failure indication.\nOutput, Optional: Failure Cause (in the case of failure indication provided).\nSee clause 6.2 for example of usage of this service operation.",
      "chunk_type": "general",
      "cross_references": [
        "clause_6.2"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.4.2.7",
      "section_id": "8.4.2.7",
      "section_title": "Ngmlc_Location_PrivacyCheck_IDMapping service operation",
      "content": "Service operation name: Ngmlc_Location_PrivacyCheck_IDMapping\nDescription: Consumer NF requests privacy check and ID mapping for certain UEs involved in Ranging.\nInput, Required: UEs identifier (GPSI, Application Layer ID).\nInput, Optional: None.\nOutput, Required: Success/Failure indication, UEs identifier (Application Layer ID, GPSI).\nOutput, Optional: Failure Cause (in the case of failure indication provided).",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_23.273_8.5",
      "section_id": "8.5",
      "section_title": "NEF Services",
      "content": "For 5GC-MT-LR procedures, location reporting is one of the monitoring events, as defined in clause 4.15.3.1 of TS 23.502 [19], supported by Nnef_EventExposure service.\nNnef_EventExposure service operations are defined in clause 5.2.6.2 of TS 23.502 [19].\nThe attributes that may be included in the location service request and response are listed in clause 5.5.\nFor 5GC-MO-LR procedure, if UE requests to report its location to AF, the location reporting is supported by Nnef_Location_LocationUpdateNotify service operation defined in clause 5.2.6.21 of TS 23.502 [19].",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_4.15.3.1",
        "ts_23.502_clause_5.2.6.2",
        "clause_5.5",
        "ts_23.502_clause_5.2.6.21",
        "ts_23.502"
      ]
    },
    {
      "chunk_id": "ts_23.273_8.6",
      "section_id": "8.6",
      "section_title": "UDR Services",
      "content": "UDR services related to location service are defined in clause 5.2.3 of TS 23.502 [19].\nAnnex A (informative):Differences with TS 23.271 [4]\nA.0\tGeneral\nDifferences with TS 23.271 [4] are described here where these may impact service to a target UE, LCS client, or client AF or NF. The differences are restricted to those applicable to a UE with EPS access in the case of TS 23.271 [4] and do not include all differences applicable to GERAN or UTRAN access.\nA.1\tDifferences in Parameters for a Location Request\nTable A.1-1 shows a list of parameters applicable to a location request sent by an external LCS client to a GMLC which are defined in TS 23.271 [4], differences if any with this TS, and comments on these including any significant consequences.\nTable A.1-1: Differences in Parameters for a Location Request with TS 23.271 [4]\nLocation Request Parameter\nDifference\nComments\nTarget UE Identity\nGPSI, SUPI or pseudonym in this TS\nMSISDN, IMSI or pseudonym in TS 23.271 [4]\nLCS QoS\nNone\nSupported GAD shapes\nNone\nLCS Client type\nNone\nCalled Party Number\nNot supported in this TS\nIf provided, this parameter should be ignored by a GMLC\nAPN NI\nNot supported in this TS\nIf provided, this parameter should be ignored by a GMLC\nService Identity\nNone\nCodeword\nNone\nService coverage information\nNone\nRequestor Identity\nNot supported in this TS\nIf provided, this parameter should be ignored by a GMLC\nType of Requestor Identity\nNot supported in this TS\nIf provided, this parameter should be ignored by a GMLC\nType of a deferred location request\nNone\nPeriodic Location parameters\nNone\nArea Event parameters\nNone\nMotion Event parameters\nNone\nA.2\tDifferences in Information Storage in the UDR/UDM versus HSS/GMLC for EPS\nTable A.2-1 shows a list of LCS information storage items for a UE in the UDR and UDM defined in this TS and for the HSS and/or GMLC defined in TS 23.271 [4], differences if any between this TS and TS 23.271 [4], and comments on these including any significant consequences.\nTable A.2-1: Differences in Information Storage for a UE in the UDR/UDM versus HSS/GMLC for EPS\nInformation Storage Item(s)\nDifference\nComments\nUE Privacy Universal Class\nNot supported in this TS\nThis privacy class should not be supported for 5GC capable UEs on the EPS side to avoid differences in LCS privacy support between EPS access and 5GS access for the same UE. (Note 1)\nUE Location Privacy Indication\nNot supported in TS 23.271 [4]\nThis indication can create differences between LCS client access to a UE which has 5GS access versus EPS access. (Note 1)\nUE Privacy Call/Session related Class\nNot supported in this TS\nThis privacy class should not be supported for 5GC capable UEs on the EPS side to avoid differences in LCS privacy support between EPS access and 5GS access for the same UE. (Note 1)\nUE Privacy Call/Session unrelated Class\nSupported as defined in TS 23.271 [4] with the following differences:\n-\tInformation related to an RGMLC is not included\n-\tAn optional time period is not supported in TS 23.271 [4]\n-\tAn optional geographic area is not supported in TS 23.271 [4]\nThis privacy class can create differences between LCS client access to a UE which has 5GS access versus EPS access. (Note 1)\nUE Privacy PLMN Operator Class\nNone\nUE LCS Mobile Originating Data\nNone\nNOTE 1:\tA PLMN operator can avoid any difference in UE privacy support for EPS access versus 5GS access by only storing information for UE privacy (in the UE LCS privacy profile) in a UDR (and UDM) and not in an HSS or GMLC.\nA.3\tDifferences in Information Storage in the GMLC\nTable A.3-1 shows a list of information storage items in the GMLC for an LCS Client defined in this TS and in TS 23.271 [4], differences if any between this TS and TS 23.271 [4], and comments on these including any significant consequences.\nTable A.3-1: Differences in Information Storage for an LCS Client in the GMLC\nInformation Storage Item(s)\nDifference\nComments\nLCS Client Type\nNone\nLCS Client Type\nNone\nExternal identity\nNone\nAuthentication data\nNone\nCall/session related identity\nNot supported in this TS\nThis information item can create differences between LCS client access to a UE which has 5GS access versus EPS access. (Note 1)\nInternal identity\nNone\nClient name\nNone\nClient name type\nNo difference except that this TS adds a Client Name type in the form of a GPSI.\nA GPSI can be an MSISDN or External Identifier in the form of \"username@realm\" as defined in TS 23.003 [28].\nTS 23.271 [4] allows an MSISDN but the External Identifier is not included.\nOverride capability\nNone\nAuthorized UE List\nNone\nPriority\nNone\nQoS parameters\nNone\nService Coverage\nNone\nAllowed LCS + Request Types\nTS 23.271 [4] includes the following items which are not in this TS:\n-\tNon-call related CS-MT-LR/PS-MT-LR/EPC-MT-LR\n-\tCall/session related CS-MT-LR/PS-MT-LR/EPC-MT-LR\n-\tSpecification or negotiation of priority\n-\tSpecification or negotiation of QoS parameters\n-\tSpecification or negotiation of Service Coverage parameter\nThis TS includes the following items which are not in TS 23.271 [4]:\n-\tRequest of deferred location for the UE available event\n-\tRequest of deferred location for UE periodic events\n-\tRequest of deferred location for the Area Event\n-\tRequest of deferred location for the Motion Event\nThis TS should take precedence (Note 1)\nLocal Co-ordinate System\nNone\nAccess Barring List(s)\nTS 23.271 [4] includes a list of MSISDNs.\nThis TS includes a list of SUPIs\nThis TS can take precedence (Note 1)\nService Identities\nNone\nMaximum Target UE Number\nNone\nNOTE 1:\tA PLMN operator can avoid any difference in LCS Client support for a target UE with EPS access versus 5GS access by only storing information for an LCS Client in a GMLC as defined in this TS.\nA.4\tDifferences with TS 23.271 [4] on Privacy\nA.4.1\tDifferences in UE LCS Privacy\nTable A.4.1-1 shows a list of UE LCS privacy features defined in this specification and in TS 23.271 [4], differences if any between these, and comments on these including any significant consequences.\nTable A.4.1-1: Differences in UE LCS Privacy with TS 23.271 [4]\nUE LCS Privacy Feature\nDifference\nComments\nPrivacy Override Indicator (POI)\nNone\nUE Privacy Universal Class\nNot supported in this TS\nThis class allows a UE to subscribe to location by any LCS client. For such a UE, a 5GC GMLC will not support such location.\nLocation Privacy Indication\nNot supported in TS 23.271 [4]\nAs defined in clause 5.4.2.3.\nUE Privacy Call/Session related Class\nNot supported in this TS\nThis class permits location by LCS clients to which the UE has established a PS session.\nA 5GC GMLC will not allow such location. However, the location can be allowed as part of the Call/Session unrelated class.\nUE Privacy Call/Session unrelated Class\nSupported as defined in TS 23.271 [4] with the following differences:\nAn optional valid time period is added\nAn optional valid geographic area is added\nThe optional valid time period and valid geographic area allow more precise control of location reporting. For example, tracking of employees by an employer can be restricted to a work location and/or normal work hours.\nUE Privacy PLMN Operator Class\nSupported as defined in TS 23.271 [4]\nAnnex B (informative):LCS privacy selection rule in serving NF\nB.1\tLCS privacy selection flow rule\nA 5GS-MT-LR may be applied to more than one LCS privacy data in the LCS privacy profile, e.g. one or more privacy classes as defined in clause 5.4.2.2 and LPI as defined in clause 5.4.2.3. The 5GS-MT-LR may also require POI as defined in clause 5.4.4. The Privacy selection flow is shown in Figure B.1-1.\nFigure B.1-1: Privacy selection flow diagram\nAnnex C (informative):PNI-NPN architecture to support location service with signalling optimisation\nFigure C-1 shows the PNI-NPN architecture to support location services with optimisation of signalling latency and privacy, with the corresponding functional descriptions are defined in clause 5.13.\nWhen UE access the NG-RAN in the local network, during the registration procedure or service request procedure, NG-RAN selects the Serving AMF in the public network. With appropriate configuration, local AMF cannot be selected as the serving AMF for the UE.\nAssuming NG-RAN 1 is the serving RAN of UE. NG-RAN 2 and NG-RAN 3 illustrated in the figure below is for positioning signal measurement.\nFigure C-1 PNI-NPN architecture to support location service with signalling optimisation\nAnnex D (informative):Change history\nChange history\nDate\nMeeting\nTDoc\nCR\nRev\nCat\nSubject/Comment\nNew version\n2019-05\nSP#84\nSP-190455\n-\n-\n-\nMCC Editorial update for presentation to TSG SA#84 for approval\n1.0.0\n2019-06\nSP#84\n-\n-\n-\n-\nMCC editorial update for publication after approval at TSG SA#84\n16.0.0\n2019-09\nSP#85\nSP-190606\n0001\n1\nF\nCorrection on UE Assisted and UE Based Positioning Procedure\n16.1.0\n2019-09\nSP#85\nSP-190606\n0002\n1\nF\nCorrection on LCS privacy selection flow rule\n16.1.0\n2019-09\nSP#85\nSP-190606\n0003\n-\nF\nCorrections to EPC Interconnection\n16.1.0\n2019-09\nSP#85\nSP-190606\n0005\n1\nF\nCorrections to LCS Privacy feature\n16.1.0\n2019-09\nSP#85\nSP-190606\n0006\n3\nB\nSupport of Concurrent Location Request\n16.1.0\n2019-09\nSP#85\nSP-190606\n0008\n-\nF\nClarification on positioning access selection in the 5GC-MO-LR procedure\n16.1.0\n2019-09\nSP#85\nSP-190606\n0010\n2\nB\nBroadcast of Assistance Data for NR\n16.1.0\n2019-09\nSP#85\nSP-190606\n0011\n1\nF\nCorrection and Improvement of Low Power Periodic and Triggered Location\n16.1.0\n2019-09\nSP#85\nSP-190606\n0021\n1\nF\nHandling of NG-RAN Location Service Exposure Procedure\n16.1.0\n2019-09\nSP#85\nSP-190606\n0022\n1\nF\n3GPP access specific aspects\n16.1.0\n2019-09\nSP#85\nSP-190606\n0024\n1\nF\nClarification of 5GC-MT-LR procedure for the commercial location service\n16.1.0\n2019-09\nSP#85\nSP-190606\n0025\n1\nF\nCompletion of 5GC-MO-LR Procedure for TS 23.273\n16.1.0\n2019-09\nSP#85\nSP-190606\n0028\n2\nF\nCompletion of Unified Location Service Exposure Procedure for TS 23.273\n16.1.0\n2019-09\nSP#85\nSP-190606\n0030\n2\nF\nClarification of CHF in eLCS architecture\n16.1.0\n2019-09\nSP#85\nSP-190606\n0032\n1\nF\nIMS Interworking for location service\n16.1.0\n2019-09\nSP#85\nSP-190606\n0036\n1\nF\nUpdate of location service exposure description\n16.1.0\n2019-12\nSP#86\nSP-191070\n0033\n3\nF\nPackage of corrections\n16.2.0\n2019-12\nSP#86\nSP-191070\n0037\n2\nF\nDelete Editor's Notes\n16.2.0\n2019-12\nSP#86\nSP-191070\n0041\nF\nUpdate the status of event reporting\n16.2.0\n2019-12\nSP#86\nSP-191070\n0045\n-\nF\nAdd Coordinate Reference System\n16.2.0\n2019-12\nSP#86\nSP-191070\n0046\n-\nF\nCorrections to bulk operation MT-LR procedure\n16.2.0\n2019-12\nSP#86\nSP-191070\n0047\n1\nF\nCorrections to MT-LR procedure for 3GPP and Non-3GPP access\n16.2.0\n2019-12\nSP#86\nSP-191070\n0048\n2\nF\nRemoval of the EN on the location information in Clause 5.3.1\n16.2.0\n2019-12\nSP#86\nSP-191070\n0049\n2\nF\nCorrection on Broadcast of Assistance Data by an LMF\n16.2.0\n2019-12\nSP#86\nSP-191070\n0055\n1\nF\nCompletion of Deferred 5GC-MT-LR procedure for TS 23.273\n16.2.0\n2019-12\nSP#86\nSP-191070\n0056\n1\nF\nCompletion of 5GC-MT-LR Procedure for TS 23.273\n16.2.0\n2019-12\nSP#86\nSP-191070\n0057\n1\nF\nCorrections to Location Services for Miscellaneous Errors and Inconsistencies\n16.2.0\n2019-12\nSP#86\nSP-191070\n0059\n-\nF\nUpdate of the LMF selection function\n16.2.0\n2019-12\nSP#86\nSP-191070\n0060\n2\nF\nCorrection of the procedure of obtaining Non-UE Associated Network Assistance Data\n16.2.0\n2019-12\nSP#86\nSP-191061\n0061\n1\nF\nCorrections to MO-LR procedure\n16.2.0\n2019-12\nSP#86\nSP-191070\n0062\n1\nF\nCorrections to LCS Assistance Data Broadcast procedure\n16.2.0\n2019-12\nSP#86\nSP-191070\n0074\n1\nF\nCompletion of Cancellation of a Deferred 5GC-MT-LR procedure for TS 23.273\n16.2.0\n2019-12\nSP#86\nSP-191070\n0076\n2\nF\nCompletion of Unified Location Service Exposure Procedure\n16.2.0\n2019-12\nSP#86\nSP-191070\n0080\n-\nF\nAddition of exception support for Periodic or Triggered Location Reporting\n16.2.0\n2020-03\nSP#87E\nSP-200064\n0070\n2\nF\nPackage of editorial modification for procedures\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0075\n2\nF\nClarification on LCS QoS\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0081\n1\nF\nClarification on GMLC and NEF authorization and privacy check\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0089\n1\nF\nIncorrect Services Operation for LMF non UE message transfer\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0091\n-\nF\nCorrections to LMF selection\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0092\n1\nF\nTS23.273 - Correction on User Location Information\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0095\n1\nF\nClarification on group authorization and location reporting method for bulk operation\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0103\n1\nF\nComplementing the function of EventNotify service operation\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0105\n1\nF\nCorrection to cancellation of reporting of location events procedure\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0106\n1\nD\nPackage of editorial modification\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0107\n1\nF\nCorrection to roaming architecture for NEF\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0108\nF\nCorrection to LMF function\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0111\n1\nF\nCorrection to the service operation between AF and NEF\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0112\n1\nF\nUpdate the functionality of GMLC\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0113\n1\nF\nUpdate the Cancellation procedure of deferred MT-LR\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0114\n1\nF\nUpdate the Response Method\n16.3.0\n2020-03\nSP#87E\nSP-200064\n0115\n1\nF\nLocation Exposure\n16.3.0\n2020-07\nSP#88E\nSP-200423\n0116\n1\nF\nCorrection to service exposure descriptions\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0117\n-\nF\nCorrection to use of NEF Service operations in procedures\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0119\n1\nF\nClarification on MT-LR procedure\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0120\n1\nF\nAdd NEF function in location service exposure procedure\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0121\n1\nF\nLocation Exposure\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0122\n1\nF\nClarification on Information Elements in location procedure\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0123\n1\nF\nLocation QoS\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0124\n-\nF\nResolve EN for NG-RAN Location Service Exposure\n16.4.0\n2020-07\nSP#88E\nSP-200423\n0125\n1\nF\nClarification of several procedures\n16.4.0\n2020-07\nSP#88E\nSP-200422\n0126\n-\nF\nRemoval of I-NEF\n16.4.0\n2020-12\nSP#90E\nSP-200948\n0131\n1\nF\nCorrection to Bulk Operation\n16.5.0\n2020-12\nSP#90E\nSP-200948\n0136\n1\nF\nCorrection of NAS message used for event reporting\n16.5.0\n2021-03\nSP#91E\nSP-210056\n0140\n-\nF\nClarification on UDM interaction\n16.6.0\n2021-03\nSP#91E\nSP-210056\n0141\n-\nF\nCorrection on source of Client type information\n16.6.0\n2021-03\nSP#91E\nSP-210056\n0142\n-\nF\nCorrection of NEF service type in bulk operation procedure\n16.6.0\n2021-03\nSP#91E\nSP-210056\n0143\n-\nF\nCorrection to conveyed area event information\n16.6.0\n2021-03\nSP#91E\nSP-210056\n0153\n1\nF\nClarification of LCS client type provided by AF\n16.6.0\n2021-03\nSP#91E\nSP-210063\n0144\n1\nC\nLocation estimate in Local Coordinates\n17.0.0\n2021-03\nSP#91E\nSP-210063\n0145\n-\nC\nAdd MO-LR subscribed Assistance Data\n17.0.0\n2021-03\nSP#91E\nSP-210063\n0146\n-\nC\nClarification on requesting current location from AMF.\n17.0.0\n2021-03\nSP#91E\nSP-210063\n0157\n-\nF\nCorrection on Access Network\n17.0.0\n2021-03\nSP#91E\nSP-210063\n0159\n1\nC\nLMF Change Procedure\n17.0.0\n2021-06\nSP#92E\nSP-210338\n0150\n4\nC\nSupport for Multiple QoS Class in deferred location requests\n17.1.0\n2021-06\nSP#92E\nSP-210325\n0161\n1\nF\nAssistance Data Delivery in 5G-MO-LR\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0163\n1\nC\nAdd a new procedure for unified location service exposure for NF in serving PLMN\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0164\n1\nC\nAdd the usage of the requested maximum age of location in the 5GC-MO-LR\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0165\n1\nC\nAdd local co-ordinate in procedures\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0166\nB\nAdd definition and usage for 5G positioning area and 5G enhanced positioning area\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0167\n1\nC\nAdd description of GMLC corrects the area event report\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0170\n-\nF\nCorrection the spec number for LPP protocol\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0172\n-\nF\nAdd UE connectivity state per access type as the input of Nlmf_Location_DetermineLocation service\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0174\n1\nC\nLMF Parameters Support for non-3GPP Access\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0175\n1\nC\nSupport for Area Decision of Satellite Access\n17.1.0\n2021-06\nSP#92E\nSP-210338\n0176\n1\nB\nUE positioning capability storage\n17.1.0\n2021-09\nSP#93E\nSP-210913\n0147\n4\nF\nAdd time of position determination to Deferred MT-LR periodic\n17.2.0\n2021-09\nSP#93E\nSP-210905\n0182\n-\nA\nInconsistent Location Information for Non-3GPP Access\n17.2.0\n2021-09\nSP#93E\nSP-210905\n0184\n1\nA\nClarify conveyance of Service type\n17.2.0\n2021-09\nSP#93E\nSP-210913\n0185\n1\nF\nUpdate LMF function and service operation\n17.2.0\n2021-09\nSP#93E\nSP-210913\n0186\n1\nF\nUpdate 5GC-NI-LR procedure\n17.2.0\n2021-09\nSP#93E\nSP-210913\n0187\n1\nB\nIntroduction of the Scheduled Location Time\n17.2.0\n2021-09\nSP#93E\nSP-210913\n0192\n1\nF\nSatellite RAT Type in LMF selection\n17.2.0\n2021-12\nSP#94E\nSP-211280\n0151\n6\nB\nAddition of a Scheduled Location Time\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0194\n2\nA\nClarification on use of service type and service identity in MO-LR procedure\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0196\n1\nF\nAdd timestamp of location estimate\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0200\n1\nF\nStore UE positioning capability in failed case\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0201\n-\nF\nRemoval of Editor's Note concerning storage of UE Positioning Capabilities\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0202\n1\nF\nIdentification of Position Methods not able to support Local Coordinates\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0204\n-\nA\nRemove SUPI in response to Nudm_SDM\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0206\n1\nF\nEditorial changes for eLCS_Ph2\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0208\n-\nA\nCorrect the allowed access type for event report\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0209\n1\nF\nLocation Services applicable to SNPN(s)\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0213\n1\nA\nReplacing  NR-RAN with ng-eNB in case of EDT reporting of LCS event\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0215\n1\nA\nUpdate MO-LR procedure\n17.3.0\n2021-12\nSP#94E\nSP-211280\n0218\n1\nF\nUpdate AMF functionality for satellite access UE\n17.3.0\n2021-12\nSP#94E\nSP-211273\n0220\n1\nA\nRemoval of description that LMF ID is provided by UE\n17.3.0\n2022-03\nSP#95E\nSP-220049\n0222\n-\nF\nMultiple QoS Class applicable procedure\n17.4.0\n2022-03\nSP#95E\nSP-220049\n0223\n-\nF\nPLMN Operator Class applicable to SNPN\n17.4.0\n2022-03\nSP#95E\nSP-220049\n0225\n1\nF\nUpdate to Scheduled Location Time\n17.4.0\n2022-06\nSP#96\nSP-220392\n0228\n1\nB\nPeriodic and Triggered 5GC-MT-LR Procedure in RRC INACTIVE state\n17.5.0\n2022-06\nSP#96\nSP-220391\n0230\n1\nA\nCorrection to the 5GC-MT-LR Procedure for the commercial location service\n17.5.0\n2022-09\nSP#97E\nSP-220772\n0231\n1\nF\nClarification and correction on country verification for satellite access\n17.6.0\n2022-09\nSP#97E\nSP-220772\n0232\n1\nC\nAddition of GNSS integrity requirement to in the location request\n17.6.0\n2022-12\nSP#98E\nSP-221064\n0243\n2\nF\nSupport an indication of reliable UE location information requirement\n17.7.0\n2022-12\nSP#98E\nSP-221094\n0237\n1\nB\nMultiple location report for MT-LR Immediate Location Request for the regulatory service\n18.0.0\n2022-12\nSP#98E\nSP-221141\n0240\n3\nB\nSupport of Mobile Base Station Relay for Location Service\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0242\n2\nB\nUE location reporting only when the UE locates in the target area defined with  finer granularity\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0246\n2\nB\nSupport of User Plane Positioning\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0247\n-\nB\nSupport of GNSS assistance data collection from AF\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0249\n2\nB\nPrivacy Check for NWDAF requesting UE location from GMLC\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0251\n1\nB\nSupport of UE Positioning without UE/User Awareness\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0253\n3\nB\nIntroduce new feature: support of LCS in PNI-NPN\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0254\n1\nB\nIntroduce new feature: local LMF and GMLC selection\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0258\n2\nB\nVerification of location for NTN access\n18.0.0\n2022-12\nSP#98E\nSP-221081\n0264\n1\nB\nSupport of a UE user plane connection to an LCS Client or AF for periodic or triggered 5GC-MT-LR event reporting\n18.0.0\n2023-03\nSP#99\nSP-230045\n0244\n9\nB\nGeneral description to support PRUs\n18.1.0\n2023-03\nSP#99\nSP-230045\n0263\n7\nB\nSupport of PRUs\n18.1.0\n2023-03\nSP#99\nSP-230045\n0265\n1\nB\nPRU verification by AMF during PRU positioning\n18.1.0\n2023-03\nSP#99\nSP-230045\n0269\n1\nB\nEnable additional check in target area in deferred area event\n18.1.0\n2023-03\nSP#99\nSP-230045\n0271\n4\nB\nEnhance the Triggered Location for UE power saving purpose\n18.1.0\n2023-03\nSP#99\nSP-230045\n0272\n1\nF\nUpdate LMF and GMLC service operations to support cumulative event report\n18.1.0\n2023-03\nSP#99\nSP-230045\n0274\n1\nF\nUpdate LMF service operation to support UE unaware indication\n18.1.0\n2023-03\nSP#99\nSP-230045\n0276\n1\nB\nSupport of User Unaware Positioning\n18.1.0\n2023-03\nSP#99\nSP-230045\n0283\n6\nB\nIntroduce new feature: support of low power and high accuracy positioning\n18.1.0\n2023-03\nSP#99\nSP-230045\n0284\n5\nC\nPositioning procedure update for PNI-NPN deployment\n18.1.0\n2023-03\nSP#99\nSP-230045\n0285\n-\nC\nClarification on additional check for location events\n18.1.0\n2023-03\nSP#99\nSP-230045\n0286\n4\nB\nintroduce new feature: NWDAF assisted positioning\n18.1.0\n2023-03\nSP#99\nSP-230045\n0287\n1\nC\nProcedure update with additional LCS NF discovery and selection method\n18.1.0\n2023-03\nSP#99\nSP-230078\n0288\n1\nB\nMT-LR procedure for when a MBSR is involved in the location of a UE.\n18.1.0\n2023-03\nSP#99\nSP-230045\n0289\n1\nF\nClarification on LMF Discovery and Selection\n18.1.0\n2023-03\nSP#99\nSP-230045\n0290\nF\nClarification on Location service in PNI-NPN\n18.1.0\n2023-03\nSP#99\nSP-230032\n0294\n1\nA\nAMF instead of LMF for NI and HO correlation with GMLC\n18.1.0\n2023-03\nSP#99\nSP-230035\n0296\n-\nA\nUpdate of GNSS integrity requirement provisioning\n18.1.0\n2023-03\nSP#99\nSP-230074\n0297\n2\nB\nIntroduce Sidelink positioning procedure into LCS architecture\n18.1.0\n2023-03\nSP#99\nSP-230045\n0298\n4\nB\nAdding NWDAF to LCS architecture\n18.1.0\n2023-03\nSP#99\nSP-230046\n0304\n1\nF\nClarification on Location service in PNI-NPN\n18.1.0\n2023-03\nSP#99\nSP-230046\n0305\n4\nB\nInclusion of NWDAF as GMLC services\n18.1.0\n2023-03\nSP#99\nSP-230046\n0306\n4\nB\nNWDAF assisted LMF positioning method determination\n18.1.0\n2023-03\nSP#99\nSP-230046\n0308\n-\nB\nClarification on establishment of LCS user plane connection\n18.1.0\n2023-03\nSP#99\nSP-230046\n0310\n2\nB\nProcedures of positioning over the user plane connection between UE and LMF\n18.1.0\n2023-03\nSP#99\nSP-230046\n0311\n1\nF\nTerminology clarification of eLCS_ph3\n18.1.0\n2023-03\nSP#99\nSP-230046\n0312\n1\nF\nUE LCS subscriber data\n18.1.0\n2023-03\nSP#99\nSP-230046\n0313\n1\nF\nUpdate AMF and UDM functionality description to support local LMF selection\n18.1.0\n2023-03\nSP#99\nSP-230046\n0314\n1\nF\nCorrect an editorial error\n18.1.0\n2023-03\nSP#99\nSP-230074\n0320\n1\nB\nSupport of Ranging and Sidelink Positioning\n18.1.0\n2023-03\nSP#99\nSP-230046\n0323\n2\nC\nUpdate of Collection of GNSS assistance data\n18.1.0\n2023-03\nSP#99\nSP-230046\n0325\n2\nB\nLCS User Plane Architecture and Interface\n18.1.0\n2023-03\nSP#99\nSP-230046\n0327\n2\nB\nLocation service bi-directional continuity between EPS and 5GS\n18.1.0\n2023-06\nSP#100\nSP-230485\n0318\n1\nB\nUpdates to LMF selection to suport Ranging/Sidelink Positioning\n18.2.0\n2023-06\nSP#100\nSP-230485\n0321\n11\nB\nSupport of MT-LR for Ranging and Sidelink Positioning\n18.2.0\n2023-06\nSP#100\nSP-230485\n0322\n10\nB\nRanging and Sidelink Positioning MO-LR procedure\n18.2.0\n2023-06\nSP#100\nSP-230445\n0328\n1\nB\nUpdate PRU's NRF impact\n18.2.0\n2023-06\nSP#100\nSP-230445\n0329\n3\nB\nAdding Positioning Procedure over LCS-UP\n18.2.0\n2023-06\nSP#100\nSP-230496\n0334\n-\nF\nClarification on conditions for privacy check for MBSR\n18.2.0\n2023-06\nSP#100\nSP-230445\n0335\n4\nB\nResolve two ambiguous aspects of event report allowed area\n18.2.0\n2023-06\nSP#100\nSP-230445\n0336\n1\nB\nThe terminology replacing of power saving area\n18.2.0\n2023-06\nSP#100\nSP-230445\n0337\n1\nB\nClarifications on NWDAF assisting LCS\n18.2.0\n2023-06\nSP#100\nSP-230445\n0338\n7\nB\nLCS services assisted by NWDAF analytics\n18.2.0\n2023-06\nSP#100\nSP-230496\n0339\n4\nB\nUpdate of the Location Services involving Mobile Base Station Relay\n18.2.0\n2023-06\nSP#100\nSP-230445\n0349\n3\nB\nLocation service continuity between EPS and 5GS (bi-direction) for deferred MT-LR\n18.2.0\n2023-06\nSP#100\nSP-230445\n0354\n4\nF\nAdd new LMF service operations\n18.2.0\n2023-06\nSP#100\nSP-230445\n0355\n4\nF\nUpdate the Architecture of Location Service for interconnection between 5GC and EPC\n18.2.0\n2023-06\nSP#100\nSP-230445\n0356\n1\nF\nUpdate the Location Service Continuity between EPS and 5GS for Immediate Location Request\n18.2.0\n2023-06\nSP#100\nSP-230445\n0357\n1\nF\nRemove the Editor's Notes\n18.2.0\n2023-06\nSP#100\nSP-230445\n0364\n3\nC\nResolve the EN on the session break out for local LMF service\n18.2.0\n2023-06\nSP#100\nSP-230445\n0365\n2\nF\nClarification on the low power or high accuracy positioning\n18.2.0\n2023-06\nSP#100\nSP-230445\n0367\n3\nF\nProcedure update for multiple set of GNSS assistance data broadcast\n18.2.0\n2023-06\nSP#100\nSP-230445\n0368\n1\nF\nClarification of PRU UE using NR satellite access\n18.2.0\n2023-06\nSP#100\nSP-230446\n0369\n4\nF\nFurther clarification on the support of PRUs\n18.2.0\n2023-06\nSP#100\nSP-230446\n0373\n1\nB\nClarification of Missing LMF ID in AMF logic\n18.2.0\n2023-06\nSP#100\nSP-230446\n0379\n2\nF\nAlignment of description for Routing identifier of LMF with RAN3 incoming LS\n18.2.0\n2023-06\nSP#100\nSP-230446\n0380\n3\nB\nNLOS/LOS measurement indication\n18.2.0\n2023-06\nSP#100\nSP-230446\n0381\n1\nB\nUpdate PRU related positioning procedure\n18.2.0\n2023-06\nSP#100\nSP-230446\n0383\n2\nB\nLMF initiated User Plane Disconnection\n18.2.0\n2023-06\nSP#100\nSP-230465\n0385\n1\nF\nRevisions on UE unaware positioning\n18.2.0\n2023-06\nSP#100\nSP-230446\n0387\n3\nB\nFunctional description update for UP positioning\n18.2.0\n2023-06\nSP#100\nSP-230446\n0388\n1\nF\nRemoval of functional description of inter-LMF GNSS assistance data transfer\n18.2.0\n2023-06\nSP#100\nSP-230446\n0389\n1\nB\nSupport of AMF reselection of LMF for user plane positioning\n18.2.0\n2023-06\nSP#100\nSP-230446\n0392\n2\nC\nClarification on user plane positioning determination\n18.2.0\n2023-06\nSP#100\nSP-230446\n0393\n3\nB\nLCS User Plane EN removal and alignments\n18.2.0\n2023-06\nSP#100\nSP-230446\n0394\n3\nB\nLCS Supplementary Service with UE verification\n18.2.0\n2023-09\nSP#101\nSP-230839\n0402\n1\nF\nFix Modification of User Plane Connection between UE and LMF\n18.3.0\n2023-09\nSP#101\nSP-230839\n0403\n1\nF\nFix Missing Interface between LMF and GMLC\n18.3.0\n2023-09\nSP#101\nSP-230839\n0406\n2\nF\nClarification on the UE user plane Positioning capability\n18.3.0\n2023-09\nSP#101\nSP-230839\n0407\n2\nF\nClarification on the Nlmf_location_UP service operation\n18.3.0\n2023-09\nSP#101\nSP-230839\n0408\n1\nF\nClarification on NWDAF-assisted LCS services section\n18.3.0\n2023-09\nSP#101\nSP-230860\n0410\n1\nF\nUpdates on functionalities on supporting multiple location reports\n18.3.0\n2023-09\nSP#101\nSP-230839\n0411\n-\nF\nIndoor or outdoor indication addition on GMLC services\n18.3.0\n2023-09\nSP#101\nSP-230839\n0412\n2\nF\nSignalling optimization alignment for UE available location event\n18.3.0\n2023-09\nSP#101\nSP-230839\n0414\n2\nF\nQoS parameters clarification for user plane positioning between UE and LMF\n18.3.0\n2023-09\nSP#101\nSP-230839\n0415\n2\nF\nUE user plane positioning capability clarification\n18.3.0\n2023-09\nSP#101\nSP-230839\n0424\n1\nF\nCorrection on PRU discovery\n18.3.0\n2023-09\nSP#101\nSP-230855\n0426\n2\nF\nCleanup about the usage of GPSI\n18.3.0\n2023-09\nSP#101\nSP-230839\n0430\n3\nF\nClarification on user plane positioning connection establishment\n18.3.0\n2023-09\nSP#101\nSP-230839\n0431\n-\nF\nClarification on determination to use UP positioning\n18.3.0\n2023-09\nSP#101\nSP-230839\n0436\n3\nF\nFurther clarification on PRU on/off states\n18.3.0\n2023-12\nSP#102\nSP-231270\n0416\n8\nF\nSL-MO-LR for Ranging and Sidelink Positioning corrections\n18.4.0\n2023-12\nSP#102\nSP-231270\n0417\n1\nF\nRanging and Sidelink Positioning feature corrections\n18.4.0\n2023-12\nSP#102\nSP-231270\n0418\n1\nF\nSL-MT-LR for periodic, triggered Location Events corrections\n18.4.0\n2023-12\nSP#102\nSP-231270\n0421\n2\nF\nUpdate on 5GC-MT-LR Procedure using SL positioning\n18.4.0\n2023-12\nSP#102\nSP-231270\n0423\n3\nF\nUpdates to MO and MT LR for SL positioning\n18.4.0\n2023-12\nSP#102\nSP-231270\n0428\n4\nF\nUpdates about the discovery and selection of Located UE\n18.4.0\n2023-12\nSP#102\nSP-231270\n0435\n9\nF\nSolution update for ranging procedure\n18.4.0\n2023-12\nSP#102\nSP-231276\n0444\n1\nF\nUpdate of the Location Services involving Mobile Base Station Relay\n18.4.0\n2023-12\nSP#102\nSP-231270\n0445\n1\nF\nMissing information in the subscription data for exposure via CP\n18.4.0\n2023-12\nSP#102\nSP-231246\n0447\n1\nF\nClarification and correction on multiple QoS Class Handling During Service Continuity from 5GS to EPS\n18.4.0\n2023-12\nSP#102\nSP-231246\n0451\n1\nF\nClarification on the scope of LCS-SS messages transferred via the LCS user plane\n18.4.0\n2023-12\nSP#102\nSP-231246\n0452\n3\nF\nSolution update on user plane positioning\n18.4.0\n2023-12\nSP#102\nSP-231276\n0461\n-\nF\nMBSR support in 5GC-MO-LR procedure\n18.4.0\n2023-12\nSP#102\nSP-231276\n0462\n-\nF\nAdding the LMF to the consumers of GMLC services\n18.4.0\n2023-12\nSP#102\nSP-231246\n0464\n3\nB\nThe AMF notifies the UE protocol capability to the LMF\n18.4.0\n2023-12\nSP#102\nSP-231246\n0467\n2\nF\nUpdate for trigger for secure user plane establishment via user plane\n18.4.0\n2023-12\nSP#102\nSP-231270\n0469\n1\nF\nResolving the SLPP message forwarding\n18.4.0\n2023-12\nSP#102\nSP-231270\n0472\n1\nF\nAdding SLPP to SL-MT-LR supplementary service response\n18.4.0\n2023-12\nSP#102\nSP-231246\n0473\n1\nF\nIntroduce LPHAP Assistance Information\n18.4.0\n2023-12\nSP#102\nSP-231246\n0474\n2\nF\nUpdate  simultaneous measurements for target UE and PRU\n18.4.0\n2023-12\nSP#102\nSP-231246\n0475\n1\nF\nUpdate integrity requirements\n18.4.0\n2023-12\nSP#102\nSP-231246\n0476\n1\nF\nParameters update for LMF user plane service operation\n18.4.0\n2023-12\nSP#102\nSP-231246\n0479\n1\nF\nUpdate of Procedures of User Plane Connection between UE and LMF\n18.4.0\n2023-12\nSP#102\nSP-231276\n0482\n2\nF\nAdding the Additional ULI to the LMF service operation\n18.4.0\n2023-12\nSP#102\nSP-231608\n0486\n4\nF\nUE Capability Update for SL-MT-LR and SL-MO-LR\n18.4.0\n2024-03\nSP#103\nSP-240087\n0409\n3\nF\nClarification on the reporting indication\n18.5.0\n2024-03\nSP#103\nSP-240108\n0443\n3\nF\nUpdate about the usage of SUPI in SL-MT-LR\n18.5.0\n2024-03\nSP#103\nSP-240108\n0450\n3\nF\nHandling ID Translation and privacy check in case of UEs belong to different PLMNs\n18.5.0\n2024-03\nSP#103\nSP-240087\n0481\n1\nF\nDescription Update on LCS in PNI-NPN Feature\n18.5.0\n2024-03\nSP#103\nSP-240108\n0489\n4\nF\nUpdate on GMLC and LMF Services\n18.5.0\n2024-03\nSP#103\nSP-240087\n0490\n1\nF\nClarifications on determination of user plane positioning\n18.5.0\n2024-03\nSP#103\nSP-240087\n0495\n1\nF\nUpdate integrity requirements\n18.5.0\n2024-03\nSP#103\nSP-240087\n0496\n1\nF\nUpdate LMF service operation\n18.5.0\n2024-03\nSP#103\nSP-240087\n0498\n1\nF\nUpdate of user plane positioning solution\n18.5.0\n2024-03\nSP#103\nSP-240108\n0499\n1\nF\nCorrections for alignments to TS 23.273/TS 23.586/SA3/RAN WGs\n18.5.0\n2024-03\nSP#103\nSP-240108\n0504\n4\nF\nCorrections of usage of SLPP and supplementary service messages for Ranging_SL procedures\n18.5.0\n2024-03\nSP#103\nSP-240108\n0505\n1\nF\nCorrections to SL-MT-LR procedure\n18.5.0\n2024-03\nSP#103\nSP-240078\n0509\n1\nA\nAdding GPSI to 5GC-MT-LR Procedure without UDM Query procedure\n18.5.0\n2024-03\nSP#103\nSP-240079\n0511\n-\nA\nUpdate GMLC local coordinate functionality\n18.5.0\n2024-06\nSP#104\nSP-240601\n0516\n3\nF\nRemoval of Ranging exposure service to Client UE through 5GC\n18.6.0\n2024-06\nSP#104\nSP-240601\n0517\n2\nF\nSupport for UE Ranging/SL Positioning privacy profile\n18.6.0\n2024-06\nSP#104\nSP-240587\n0521\n2\nF\nAdd the binding mechanism between LCS user plane connection and the UE\n18.6.0\n2024-06\nSP#104\nSP-240587\n0522\nC\nClean up the user plane positioning\n18.6.0\n2024-09\nSP#105\nSP-241253\n0534\n1\nF\nAlignment of clauses 4.3.12 and 5.1\n18.7.0\n2024-09\nSP#105\nSP-241242\n0540\n2\nF\nUpdate LCS Architecture with user plane positioning\n18.7.0\n2024-09\nSP#105\nSP-241250\n0545\n-\nF\nCorrections to application ID in SL-MT-LR  and LMF service operation\n18.7.0\n2024-09\nSP#105\nSP-241242\n0552\n2\nF\nClarify AMF relocation for LCS-UP connection modification\n18.7.0\n2024-09\nSP#105\nSP-241242\n0557\n3\nF\nUpdate on the LCS-UP procedure\n18.7.0\n2024-09\nSP#105\nSP-241242\n0563\n2\nF\nLocation Service Continuity Update and Editorial Update\n18.7.0\n2024-09\nSP#105\nSP-241240\n0565\n1\nA\nClarification on the usage of reliable indication\n18.7.0\n2024-12\nSP#106\nSP-241464\n0562\n3\nA\nThe deferred 5GC-MT-LR procedure correction\n18.8.0\n2024-12\nSP#106\nSP-241467\n0572\n2\nF\nOne Transmission Path used for One Positioning Procedure\n18.8.0\n2024-12\nSP#106\nSP-241467\n0575\n1\nF\nLCS-UP clarification\n18.8.0\n2024-12\nSP#106\nSP-241467\n0579\n1\nF\nClarification of event filter for GNSS assistance data collection\n18.8.0\n2024-12\nSP#106\nSP-241467\n0585\n-\nF\nRemove N6 from roaming reference architecture\n18.8.0\n2024-12\nSP#106\nSP-241467\n0591\n1\nF\nClarification on the User Plane LCS\n18.8.0\n2024-12\nSP#106\nSP-241479\n0599\n1\nF\nUpdates on UE privacy checking for SA3 alignment\n18.8.0\n2024-12\nSP#106\nSP-241467\n0609\n2\nF\nClarification of  LCS Correlation ID in NRPPa\n18.8.0\n2024-12\nSP#106\nSP-241467\n0611\n-\nF\nLCS-UP security  attributes alignment to TS 33.501\n18.8.0\n2024-12\nSP#106\nSP-241467\n0615\nF\nSupport of PRU Usage Extension\n18.8.0\n2025-03\nSP#107\nSP-250031\n0645\n3\nF\nClarify number of user plane connections for user plane positioning\n18.9.0\n2025-03\nSP#107\nSP-250049\n0648\n1\nF\nCorrection on RangingSideLink positioning procedure\n18.9.0\n2025-03\nSP#107\nSP-250031\n0661\n-\nF\nClarification on LMF re-selection of LCS UP positioning\n18.9.0\n2025-03\nSP#107\nSP-250031\n0692\n2\nF\nCommon Procedure Types Sync with 38.305\n18.9.0",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.502_clause_5.2.3",
        "ts_23.271_clause_5.4.2.3",
        "clause_5.4.2.2",
        "clause_5.4.2.3",
        "clause_5.4.4",
        "clause_5.13",
        "clause_5.3.1",
        "clause_18.3.0",
        "ts_23.502",
        "ts_23.271",
        "ts_23.003",
        "ts_16.1",
        "ts_23.273",
        "ts_17.1",
        "ts_18.1",
        "ts_18.2",
        "ts_18.3",
        "ts_18.4",
        "ts_18.5",
        "ts_23.586",
        "ts_33.501"
      ]
    }
  ]
}