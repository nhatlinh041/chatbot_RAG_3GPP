{
  "metadata": {
    "specification_id": "ts_29.273",
    "version": "18.6.0",
    "title": "3GPP TS 29.273",
    "file_path": "/content/drive/MyDrive/RAG_thesis/data/29_series/29273-i60/29273-i60.docx"
  },
  "export_info": {
    "export_date": "2025-07-26T09:15:59.524322",
    "total_chunks": 280
  },
  "chunks": [
    {
      "chunk_id": "ts_29.273_1",
      "section_id": "1",
      "section_title": "Scope",
      "content": "The present document defines the stage-3 protocol description for several reference points for the non-3GPP access in EPS:\n-\tThe SWa reference point between an un-trusted non-3GPP IP access and the 3GPP AAA Server/Proxy.\n-\tThe STa reference point between a trusted non-3GPP IP access and the 3GPP AAA Server/Proxy.\n-\tThe SWd reference point between the 3GPP AAA Proxy and 3GPP AAA Server.\n-\tThe SWx reference point between the 3GPP AAA Server and the HSS.\n-\tThe S6b reference point between the 3GPP AAA Server/Proxy and the PDN GW.\n-\tThe SWm reference point between the 3GPP AAA Server/Proxy and the ePDG.\n-\tThe reference point between the 3GPP AAA Server/Proxy and the EIR.\nThe present document also defines the stage 3 protocol description for the following reference points defined for Non-seamless WLAN offload in 5GS:\n-\tthe SWa' reference point between a non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWO NF; and\n-\tthe SWd' reference point between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWO NF.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_2",
      "section_id": "2",
      "section_title": "References",
      "content": "The following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non‑specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\tIETF RFC 5779: \"Diameter Proxy Mobile IPv6: Mobility Access Gateway and Local Mobility Anchor Interaction with Diameter Server \".\n[3]\t3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".\n[4]\tIETF RFC 4005: \"Diameter Network Access Server Application\"\n[5]\tIETF RFC 4072: \"Diameter Extensible Authentication Protocol (EAP) Application\"\n[6]\tIETF RFC 5447 \"Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction\".\n[7]\tVoid.\n[8]\tIETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".\n[9]\tIETF RFC 5777: \"Traffic Classification and Quality of Service (QoS) Attributes for Diameter\".\n[10]\tVoid\n[11]\tIETF RFC 5778: \"Diameter Mobile IPv6: Support for Home Agent to Diameter Server Interaction\".\n[12]\tVoid\n[13]\t3GPP TS 24.303: \"Mobility management based on Dual-Stack Mobile IPv6; Stage 3\".\n[14]\t3GPP TS 23.003: \"Numbering, addressing and identification\".\n[15]\tIETF RFC 4282: \"The Network Access Identifier\".\n[16]\t3GPP TS 33.203: \"3G security; Access security for IP-based services\".\n[17]\t3GPP TS 29.230: \"Diameter applications; 3GPP specific codes and identifiers\".\n[18]\tIETF RFC 4004: \"Diameter Mobile IPv4 Application\".\n[19]\t3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security aspects of non-3GPP accesses\".\n[20]\tIETF RFC 4006: \"Diameter Credit-Control Application\".\n[21]\tVoid.\n[22]\t3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and Message Elements\".\n[23]\t3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".\n[24]\t3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol; Protocol details\".\n[25]\t3GPP2 X. S0057-B: \"EUTRAN – eHRPD Connectivity and Interworking: Core Network Aspects\".\n[26]\t3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via non-3GPP access networks\".\n[27]\tIETF RFC 5448: \"Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA')\".\n[28]\tIETF RFC 6611: \"Mobile IPv6 (MIPv6) Bootstrapping for the Integrated Scenario\".\n[29]\t3GPP TS 29.272: \"Evolved Packet System; MME and SGSN Related Interfaces Based on Diameter Protocol\".\n[30]\t3GPP TS 32.299: \"Charging management; Diameter charging applications\".\n[31]\t3GPP TS 29.061: \"Interworking between the Public Land Mobile Network (PLMN) supporting packet based services and Packet Data Networks (PDN)\".\n[32]\t3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment trace; Trace control and configuration management\".\n[33]\tVoid.\n[34]\t3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".\n[35]\tIETF RFC 1035: \"Domain Names - Implementation and Specification\".\n[36]\tVoid.\n[37]\tIETF RFC 5729: \"Clarifications on the Routing of Diameter Requests Based on the Username and the Realm\".\n[38]\t3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C); Stage 3\".\n[39]\t3GPP TS 23.139: \"3GPP System-Fixed Broadband Access Network Interworking; Stage 2\".\n[40]\tIEEE Std 802.11-2012: \"IEEE Standard for Information technology - Telecommunications and information exchange between systems - Local and metropolitan area networks - Specific requirements - Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".\n[41]\tVoid.\n[42]\tVoid.\n[43]\t3GPP TS 24.139: \"3GPP system - fixed broadband access network interworking\".\n[44]\tIETF RFC 4187: \"Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)\".\n[45]\t3GPP TS 23.203: \"Policy and Charging Control Architecture\".\n[46]\tIETF RFC 5580: \"Carrying Location Objects in RADIUS and Diameter\".\n[47]\tIETF RFC 7683: \"Diameter Overload Indication Conveyance\".\n[48]\tETSI TS 283 034: \"Telecommunications and Internet converged Services and Protocols for Advanced Networking (TISPAN); Network Attachment Sub-System (NASS); e4 interface based on the DIAMETER protocol\".\n[49]\t3GPP TS 23.008: \"Organization of subscriber data\".\n[50]\tVoid\n[51]\tVoid\n[52]\t3GPP TS 23.380: \"IMS Restoration Procedures\".\n[53]\tIETF RFC 7944: \"Diameter Routing Message Priority\".\n[54]\tIETF RFC 8583: \"Diameter Load Information Conveyance\".\n[55]\tIETF RFC 6696: \"EAP Extensions for the EAP Re-authentication Protocol (ERP)\".\n[56]\tIETF RFC 6734: \"Diameter Attribute-Value Pairs for Cryptographic Key Transport\".\n[57]\tIETF RFC 6942: \"Diameter Support for the EAP Re-authentication Protocol (ERP)\".\n[58]\tIETF RFC 6733: \"Diameter Base Protocol\".\n[59]\t3GPP TS 23.501: \"System Architecture for the 5G System\".\n[60]\t3GPP TS 33.501: \"Security architecture and procedures for 5G system\".",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905",
        "ts_23.402",
        "ts_24.303",
        "ts_23.003",
        "ts_33.203",
        "ts_29.230",
        "ts_33.402",
        "ts_29.228",
        "ts_29.212",
        "ts_29.229",
        "ts_24.302",
        "ts_29.272",
        "ts_32.299",
        "ts_29.061",
        "ts_32.422",
        "ts_29.303",
        "ts_29.274",
        "ts_23.139",
        "ts_24.139",
        "ts_23.203",
        "ts_23.008",
        "ts_23.380",
        "ts_23.501",
        "ts_33.501"
      ]
    },
    {
      "chunk_id": "ts_29.273_3.1.1",
      "section_id": "3.1.1",
      "section_title": "General",
      "content": "For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1].\nMulti-connection mode (MCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nNon-Seamless WLAN offload (NSWO): Non-Seamless Non-3GPP offload when the access network is WLAN.\nSingle-connection mode (SCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nTransparent single-connection mode (TSCM): see definition in clause 3.1 of 3GPP TS 23.402 [3].\nTrusted WLAN Identifier (TWID): Identifier of a given Trusted WLAN, a combination of, e.g., an SSID and/or an HESSID as defined in IEEE Std 802.11-2012 [40].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402_clause_3.1",
        "ts_21.905",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_3.1.2",
      "section_id": "3.1.2",
      "section_title": "Handling of Information Elements",
      "content": "In the tables that describe the Information Elements transported by each Diameter command, each Information Element is marked as (M) Mandatory, (C) Conditional or (O) Optional in the Category \"Cat.\" column. For the correct handling of the Information Elements and their precedence to any included ABNF definition of the command as defined according to their category types, see the description detailed in clause 6 of the 3GPP TS 29.228 [22].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.228_clause_6",
        "ts_29.228"
      ]
    },
    {
      "chunk_id": "ts_29.273_3.2",
      "section_id": "3.2",
      "section_title": "Abbreviations",
      "content": "For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].\nAE\tAuthentication Extension\nDRMP\tDiameter Routing Message Priority\nDSCP\tDifferentiated Services Code Point\nEIR\tEquipment Identity Register\nEPC\tEvolved Packet Core\nER\tEAP Re-authentication\nERP\tEAP Re-Authentication Protocol\nePDG\tEvolved Packet Data Gateway\neHRPD\tevolved High Rate Packet Data\nFA\tForeign Agent\nFACoA\tFA Care-of-Address\nHA\tHome Agent\nHBM\tHost Based Mobility\nHESSID\tHomogenous Extended Service Set Identifier\nHSGW\teHRPD Serving Gateway\nLMA\tLocal Mobility Anchor\nMAG\tMobile Access Gateway\nMIPv4\tMobile IP version 4\nMN\tMobile Node\nNBM\tNetwork Based Mobility\nNAS\tNetwork Access Server\nNSWO\tNon-Seamless WLAN offload\nNSWOF\tNon-Seamless WLAN offload Function\nPBU\tProxy Binding Update\nPDN GW\tPDN Gateway\nPGW\tPDN Gateway, the abbreviation of PDN GW\nPMIP/PMIPv6\tProxy Mobile IP version 6\nRRP\tMIPv4 Registration Reply\nRRQ\tMIPv4 Registration Request\nSA\tSecurity Association\nSGW\tServing Gateway\nSIPTO\tSelected IP Traffic Offload\nSSID\tService Set Identifier\nTWAN\tTrusted WLAN Access Network\nWLCP\tWireless LAN Control Plane Protocol",
      "chunk_type": "general",
      "cross_references": [
        "ts_21.905"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.1",
      "section_id": "4.1.1",
      "section_title": "General",
      "content": "The SWa reference point is defined between the untrusted non-3GPP IP access and the 3GPP AAA Server or Proxy in EPS. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWa reference point is optionally used to authenticate and authorize the UE for the access to the EPS. It is up to the non-3GPP operator's policy whether this interface and the procedures defined in this clause are used.\nNOTE:\tFrom the EPS operator's view, the tunnel authentication and authorization procedures described in clause 7 (SWm description) and clause 9 are required to ensure the user's authentication and authorization when the UE is attached to an untrusted non-3GPP IP access.\nThe same procedures as defined for STa reference points are used also in the SWa, but with reduced message content. As an exception, the service authorization information update procedure is not applicable for the SWa reference point.\nThe SWa' reference point is defined between the non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWOF in 5GS. The definition of the reference point and its functionality is given in clause 4.2.15 of 3GPP TS 23.501 [59] and Annex S of 3GPP TS 33.501 [60]. It reuses the same stage 3 protocol definition as defined for SWa in EPC, with specific requirements for NSWO in 5GS specified in clause 4.1.2.5.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_7",
        "clause_9",
        "ts_23.501_clause_4.2.15",
        "clause_4.1.2.5",
        "ts_23.402",
        "ts_23.501",
        "ts_33.501"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.1.1",
      "section_id": "4.1.2.1.1",
      "section_title": "General",
      "content": "This procedure follows the STa Authentication and Authorization procedure, with the following differences:\n-\tInformation elements that would reflect information about the user's service request and about the access network are not included or are optional in the authentication and authorization request.\n-\tThe information elements that describe the user's subscription profile are not downloaded to the non-3GPP access network.\nNOTE:\tThe information elements related to the IP Mobility Mode Selection function are not supported over this interface.\nTable 4.1.2.1/1: SWa Authentication and Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in the IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP-payload\nM\nThis IE shall contain the Encapsulated EAP payload used for the UE – 3GPP AAA Server mutual authentication\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nUE Layer-2 address\nCalling-Station-ID\nM\nThis IE shall carry the Layer-2 address of the UE.\nAccess Type\nRAT-Type\nC\nIf present, this IE shall contain the untrusted non-3GPP access network technology type that is serving the UE.\nAccess Network Identity\nANID\nO\nIf present, this IE shall contain the access network identifier used for key derivation at the HSS. (See 3GPP TS 24.302 [26] for all possible values)\nIt shall be included if the non-3GPP access network selects the EAP-AKA' authentication method.\nFull Name for Network\nFull-Network-Name\nO\nIf present, this IE shall contain the full name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network\nShort Name for Network\nShort-Network-Name\nO\nIf present, this IE shall contain the short name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network\nTransport Access Type\nTransport-Access-Type\nC\nFor interworking with Fixed Broadband access networks (see 3GPP TS 23.139 [39]), if the access network needs to receive the IMSI of the UE in the authentication response, then this information element shall be present, and it shall contain the value \"BBF\" (see clause 5.2.3.19).\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nAAA Failure Indication\nAAA-Failure-Indication\nO\nIf present, this information element shall indicate that the request is sent after the non-3GPP access network has determined that a previously assigned 3GPP AAA Server is unavailable.\nWLAN Location Information\nAccess-Network-Info\nO\nIf present, this IE shall contain the location information of the WLAN Access Network where the UE is attached.\nWLAN Location Timestamp\nUser-Location-Info-Time\nO\nThis IE may be present if the WLAN Location Information IE is present.\nWhen present, this IE shall contain the NTP time at which the UE was last known to be in the location reported in the WLAN Location Information.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nThis information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 4.1.2.1/2: SWa Authentication and Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP payload\nM\nThis IE shall contain the Encapsulated EAP payload used for UE- 3GPP AAA Server mutual authentication.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code /\nExperimental- Result\nM\nThis IE shall contain the result of the operation. Result codes are as in Diameter base protocol (see IETF RFC 6733 [58]). Experimental-Result AVP shall be used for SWa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSession Alive Time\nSession-Timeout\nO\nThis AVP may be present if the Result-Code AVP is set to DIAMETER _SUCCESS. If present, it shall contain the maximum number of seconds the user session is allowed to remain active.\nAccounting Interim Interval\nAccounting Interim-Interval\nO\nIf present, this IE shall contain the Charging duration\nPairwise Master Key\nEAP-Master-Session-Key\nC\nThis IE shall be present if the Result-Code AVP is set to DIAMETER_SUCCESS.\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be present if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nTrust Relationship Indicator\nAN-Trusted\nM\nThis AVP shall contain the 3GPP AAA Server's decision on handling the non-3GPP access network, i.e. trusted or untrusted. For the SWa case, the value \"UNTRUSTED\" shall be used.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nPermanent User Identity\nMobile-Node-Identifier\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS and if the Transport Access Type in the request command indicated that the UE is accessing the EPC from a Fixed Broadband access network (i.e., the Transport-Access-Type AVP takes the value \"BBF\"); it shall contain an AAA/HSS assigned permanent user identity (i.e. an IMSI in root NAI format as defined in clause 19 of 3GPP TS 23.003 [14]) to be used by the non-3GPP access network in subsequent PCC procedure for identifying the user in the EPS network. This IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nMPS Priority\nMPS-Priority\nC\nThis information element shall be sent to the non-3GPP WLAN access if the UE has an MPS subscription in the HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "clause_5.2.3.19",
        "table_4.1.2.1",
        "ts_24.302_table_4.1.2.1",
        "ts_23.003",
        "ts_24.302",
        "ts_23.139",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.1.2",
      "section_id": "4.1.2.1.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The detailed behaviour of the 3GPP AAA Server follows the behaviour defined for the STa Authentication and Authorization procedure (refer to clause 5.1.2.1.2), with the following deviations:\n-\tThe 3GPP AAA Server shall handle the non-3GPP access network as untrusted.\n-\tThe 3GPP AAA Server marks the trust relationship as \"untrusted\" with the User Identity.\n-\tThe authentication method shall be selected based on the presence of the Access Network Identity as specified in 3GPP TS 33.402 [19]: if this information element is present, the EAP-AKA' method as specified in IETF RFC 5448 [27] is used; otherwise, the EAP-AKA method as specified in IETF RFC 4187 [44] is used.\nWhen a WLAN Access Network provides WLAN Location Information to the 3GPP AAA Server that it considers as network provided location, the 3GPP AAA Server should store this information for the duration of the WLAN session of the UE, along with the WLAN Location Timestamp if received from the WLAN Access Network, or with the timestamp at which the WLAN Location Information is received from the WLAN Access Network, and provide it to the ePDG during a subsequent Authentication and Authorization procedure or Authorization procedure over the SWm reference point (see clauses 7.1.2.1.2 and 7.1.2.2.2).\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when a WLAN Access Network provides WLAN Location Information to the 3GPP AAA Server that it does not consider as network provided location.\nNOTE:\tIt is up to local 3GPP AAA Server policies to decide whether the location information received from the WLAN access network can be considered as network provided location.\nIf 3GPP AAA Server receives a DER command from the non-3GPP access network containing a High-Priority-Access-Info AVP with the HPA_Configured bit set, if allowed by operator policy, the 3GPP AAA Server shall treat the command and all subsequent commands (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set in the DEA command if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS. The 3GPP AAA Server shall treat the command and all subsequent commands (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nThe 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and the DER command received from the non-3GPP access network did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.2.1.2",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.1.3",
      "section_id": "4.1.2.1.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The detailed behaviour of the 3GPP AAA Proxy follows the behaviour defined for the STa Authentication and Authorization procedure (refer to clause 5.1.2.1.3), with the following exception:\n-\tThe 3GPP AAA Proxy shall insert or overwrite Visited-Network-Identifier AVP before forwarding the request to the 3GPP AAA Server.\nNOTE:\tIf the untrusted WLAN is operated by the VPLMN's equivalent PLMN, the 3GPP AAA proxy can receive the Visited-Network-Identifier AVP from the Authentication and Authorization Request message.\n-\tThe 3GPP AAA Proxy shall handle the non-3GPP access network as untrusted and marks the trust relationship as \"untrusted\".\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy shall record the authentication state of the user.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.2.1.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.2",
      "section_id": "4.1.2.2",
      "section_title": "SWa HSS/AAA Initiated Detach",
      "content": "This procedure equals with the STa HSS/AAA Initiated Detach procedure, refer to clause 5.1.2.2.\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when it becomes aware that the WLAN session of the UE is terminated.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.3",
      "section_id": "4.1.2.3",
      "section_title": "SWa Non-3GPP Access Network Initiated Detach",
      "content": "This procedure equals with the STa Non-3GPP Access Network Initiated Detach procedure, refer to clause 5.1.2.4.\nThe 3GPP AAA Server shall delete any stored WLAN Location Information and WLAN Location Timestamp associated with the UE when it becomes aware that the WLAN session of the UE is terminated.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.4.1",
      "section_id": "4.1.2.4.1",
      "section_title": "General",
      "content": "This procedure is optional and it may be invoked by the 3GPP AAA Server, if the operator policies require that the re-authentication of the user for the SWa is to be renewed and the untrusted non-3GPP access network supports the re-authentication.\nThis procedure shall be performed in two steps:\n-\tThe 3GPP AAA server shall issue an unsolicited re-auth request towards the untrusted non-3GPP access, indicating that both re-authentication and re-authorization of the user is needed. Upon receipt of such a request, the untrusted non-3GPP access shall respond to the request and shall indicate the disposition of the request. This procedure is mapped to the Diameter command codes Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages shall be as shown in tables 4.1.2.4.1/1 and 4.1.2.4.1/2.\n-\tUpon receiving the re-auth request, the untrusted non-3GPP access shall immediately invoke the SWa authentication and authorization procedure requesting the identity of the user via EAP and using DER/DEA commands, with the same session-ID but the content adapted to the needs of a re-authentication. Information element contents for these messages shall be as shown in tables 4.1.2.4.1/3 and 4.1.2.4.1/4.\nIf the re-authentication of the user is not successful, the untrusted non-3GPP access shall detach the user.\nTable 4.1.2.4.1/1: SWa Re-auth request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15], and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRe-Auth Request Type\nRe-Auth–Request-Type\nM\nThis information element shall define whether the user is to be authorized only or authenticated and authorized. AUTHORIZE_AUTHENTICATE shall be used in this case.\nRouting Information\nDestination-Host\nM\nThis information element shall be obtained from the Origin-Host AVP, which was included in a previous command received from the untrusted non-3GPP access.\nTable 4.1.2.4.1/2: SWa Re-auth response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter Base Protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP and the error code in the Experimental-Result-Code AVP.\nTable 4.1.2.4.1/3: SWa Authentication and Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP-payload\nM\nThis IE shall contain the Encapsulated EAP payload used for the UE – 3GPP AAA Server mutual authentication.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nThis information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 4.1.2.4.1/4: SWa Authentication and Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP payload\nO\nIf present, this IE shall contain the Encapsulated EAP payload used for UE- 3GPP AAA Server mutual authentication.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code /\nExperimental- Result\nM\nThis IE shall contain the result of the operation. Result codes are defined in the Diameter base protocol (see IETF RFC 6733 [58]). The Experimental-Result AVP shall be used for SWa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSession Alive Time\nSession-Timeout\nO\nIf present, this IE shall contain the maximum number of seconds the user session should remain active.\nAccounting Interim Interval\nAccounting Interim-Interval\nO\nIf present, this IE shall contain the Charging duration.\nPairwise Master Key\nEAP-Master-Session-Key\nC\nThis IE shall be sent if Result-Code AVP is set to DIAMETER_SUCCESS.\nMPS Priority\nMPS-Priority\nC\nThis information element shall be sent to the non-3GPP access network if the UE has an MPS subscription in the HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_4.1.2.4.1",
        "ts_24.302_table_4.1.2.4.1",
        "ts_23.003",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.4.2",
      "section_id": "4.1.2.4.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall trigger this procedure according to the local policies configured by the operator.\nThe 3GPP AAA Server shall use the same authentication method that was used during the full authentication executed at the UE's attach. If EAP-AKA' is used, the 3GPP AAA Server shall use the ANID parameter received during the authentication and authorization executed at the UE attach (refer to clause 4.1.2.1.1).\nIf 3GPP AAA Server receives a DER command from the non-3GPP access network containing a High-Priority-Access-Info AVP with the HPA_Configured bit set, if allowed by operator policy, the 3GPP AAA Server shall treat the command and all subsequent commands (if re-authentication and re-authorization is successful) for the UE with priority as specified in Annex C and Annex D.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set in the DEA command if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS.\nThe 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a DER request from the non-3GPP access network that does not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set and the 3GPP AAA Server has not received a Non-3GPP-User-Data AVP with an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.1.2.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.4.3",
      "section_id": "4.1.2.4.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The detailed behaviour of the 3GPP AAA Proxy follows the behaviour defined for the STa Re-Authorization and Re-Authentication Procedures (refer to clause 5.1.2.3.3), with the following addition:\n-\tWhen forwarding the authorization answer or the authentication and authorization answer, the 3GPP AAA Proxy shall record the authentication state of the user.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.1.2.3.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.1.2.5",
      "section_id": "4.1.2.5",
      "section_title": "SWa procedures for NSWO in 5GS",
      "content": "The SWa' interface between the non-3GPP WLAN access, possibly via a 3GPP AAA Proxy, and the NSWOF shall use the same stage 3 protocol definition as for the SWa interface in EPS, with the following modifications:\n-\tSWa' Authentication and Authorization procedure:\n-\tThe User Identity IE in the SWa' Authentication and Authorization Request and in the SWa' Authentication and Authorization Response shall contain the SUCI in NAI form as defined in clause 28.7.3 of 3GPP TS 23.003 [14]. In NSWO roaming scenario with a 3GPP AAA Proxy in the VPLMN (see clause 4.2.15 of 3GPP TS 23.501 [59]), the SUCI in NAI form shall be decorated as defined in clause 28.7.9 of 3GPP TS 23.003 [14] to enable the routing of SWa' signalling towards the 3GPP AAA Proxy in the VPLMN selected by the UE.\nNOTE 1:\tThis IE does not contain any leading digit to differentiate between authentication schemes.\nNOTE 2:\tThe realm in the SUCI in NAI form (starting by the first label \"5gc-nswo\") enables to route the signaling towards an NSWOF, as opposed to sending it to a 3GPP AAA Server, if the non-3GPP WLAN access also supports SWa signaling with a 3GPP AAA Server e.g. for a 4G subscriber.\n-\tEAP-AKA' as specified in RFC 5448 [27] shall be used as the authentication method.\n-\tThe NSWOF shall behave as specified in Annex S of 3GPP TS 33.501 [60]. The NSWOF shall send the MSK received from the AUSF in the Pairwise Master Key IE in the SWa' Authentication and Authorization Answer.\n-\tThe SWa HSS/AAA Initiated Detach, SWa Non-3GPP Access Network Initiated Detach and SWa Re-authentication and Re-Authorization are not supported.",
      "chunk_type": "procedure",
      "cross_references": [
        "ts_23.003_clause_28.7.3",
        "ts_23.501_clause_4.2.15",
        "ts_23.003_clause_28.7.9",
        "ts_23.003",
        "ts_23.501",
        "ts_33.501"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.1",
      "section_id": "4.2.1",
      "section_title": "General",
      "content": "The SWa reference point shall use the same Diameter application as the STa reference point. The first authentication command exchange (DER/DEA) is common between the SWa and STa reference points. During this initial exchange, the 3GPP AAA Server determines the HPLMN's trust relationship with the non-3GPP access network and communicates it to the non-3GPP access network and the UE as described in clause 5.1.2.1.2. The contents of the subsequent commands are dependent on this trust relationship determination and are specific to the SWa or STa reference points.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.2.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.2.1.1",
      "section_id": "4.2.2.1.1",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the 'R' bit set in the Command Flags field, is sent from a trusted non-3GPP access network to a 3GPP AAA Server.\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n[ RAT-Type ]\n…\n[ ANID ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n*[ Supported-Features ]\n[ AAA-Failure-Indication ]\n[ Transport-Access-Type ]\n[ OC-Supported-Features ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_4.2.2.1.2",
      "section_id": "4.2.2.1.2",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "The Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the 'R' bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a trusted non-3GPP access network NAS.\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n*[ Redirect-Host ]\n[ AN-Trusted ]\n*[ Supported-Features ]\n[Mobile-Node-Identifier]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_4.2.2.2",
      "section_id": "4.2.2.2",
      "section_title": "Commands for SWa HSS/AAA Initiated Detach",
      "content": "Refer to clause 5.2.2.2.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.2.3",
      "section_id": "4.2.2.3",
      "section_title": "Commands for Untrusted non-3GPP Access network Initiated Session Termination",
      "content": "Refer to clause 5.2.2.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.2.4.1",
      "section_id": "4.2.2.4.1",
      "section_title": "Re-Auth-Request (RAR) Command",
      "content": "The Diameter Re-Auth-Request (RAR) command, indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, shall be sent from a 3GPP AAA server to an untrusted non-3GPP access network NAS. ABNF for the RAR command shall be as follows:\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_4.2.2.4.2",
      "section_id": "4.2.2.4.2",
      "section_title": "Re-Auth-Answer (RAA) Command",
      "content": "The Diameter Re-Auth-Answer (RAA) command, indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, shall be sent from an untrusted non-3GPP access network NAS to a 3GPP AAA server. ABNF for the RAA command shall be as follows:\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_4.2.2.4.3",
      "section_id": "4.2.2.4.3",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "Refer to clause 4.2.2.1.1.",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.2.2.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.2.4.4",
      "section_id": "4.2.2.4.4",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "Refer to clause 4.2.2.1.2",
      "chunk_type": "general",
      "cross_references": [
        "clause_4.2.2.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.3",
      "section_id": "4.2.3",
      "section_title": "Information Elements",
      "content": "The information elements of SWa are the same as the IEs defined for the STa interface described in the clause 5.2.3.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_4.2.4",
      "section_id": "4.2.4",
      "section_title": "Session Handling",
      "content": "The session handling for the SWa interface is the same as the STa session handling described in the clause 5.2.4.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.1",
      "section_id": "5.1.1",
      "section_title": "General",
      "content": "The STa reference point is defined between a non-3GPP access network and the 3GPP AAA Server or between a non-3GPP access network and the 3GPP AAA Proxy. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nWhether a Non-3GPP access network is Trusted or Untrusted is not a characteristic of the access network; this decision shall be made during the access authentication and authorization procedure executed between the non-3GPP access network and the 3GPP AAA Server. This is implemented by the STa and SWa reference points sharing the same Diameter application and partly sharing the same authentication and authorization procedure. The STa and SWa reference points are clearly distinguished after the exchange of the first authentication and authorization messages, during which trusted/untrusted decision is made by the 3GPP AAA server and this decision is communicated to the non-3GPP access network. The other procedures are specific to the STa and SWa reference points.\nThe STa reference point shall be used to authenticate and authorize the UE.\nThe STa reference point may also be used to transport PMIPv6, GTPv2, or MIPv4 FA-CoA mode related mobility parameters in a case the UE attaches to the EPC using the S2a reference point. The procedures specified for EPC access via GTP based S2a are only applicable to trusted WLAN access networks (see clause 16 of 3GPP TS 23.402 [3]).\nAdditionally the STa reference point may also be used to transport DSMIPv6 related mobility parameters in case the UE attaches to the EPC using the S2c reference point. In particular, in this case the STa reference point may be used for conveying the Home Agent IP address or FQDN from the AAA server to the gateway of the trusted non-3GPP access for Home Agent discovery based on DHCPv6 (see TS 24.303 [13]).\nThis reference point shall be also used to transport charging-related information and optionally information about IP Mobility Mode Selection.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402_clause_16",
        "ts_23.402",
        "ts_24.303"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.1.1",
      "section_id": "5.1.2.1.1",
      "section_title": "General",
      "content": "These procedures are transported over Diameter, the Access (Re-)Authentication and Authorization between the trusted non-3GPP access network and the 3GPP AAA Proxy or Server. The STa interface and Diameter application shall be used for authenticating and authorizing the UE for EPC access in PMIPv6, GTPv2, MIPv4 FA-CoA mode or for TWAN access without EPC S2a access (i.e. non-seamless WLAN offload) via trusted non-3GPP accesses and non-3GPP accesses that are decided to be untrusted during the authentication and authorization procedure.\nWhen EAP-AKA' is used in the STa access authentication and either EPC access in NBM (PMIPv6 or GTPv2) or TWAN access without EPC S2a access (i.e. non-seamless WLAN offload) is used, the trusted non-3GPP access network shall support also the role of the NAS. Specifically, in the case where PMIPv6 is used, the network element of the non-3GPP access network acting as a MAG shall have also the role of the NAS. During the STa access authentication the NAS shall serve as pass-through EAP authenticator.\nDiameter usage over the STa interface:\n-\tWhen EAP is used, the trusted non-3GPP access authentication and authorization procedure shall be mapped to the Diameter-EAP-Request and Diameter-EAP-Answer command codes specified in IETF RFC 4072 [5].\n-\tFor (re)authentication procedures, the messaging described below shall be reused.\nDuring the STa Access Authentication and Authorization procedure the non-3GPP access network may provide information on its PMIPv6 or GTPv2 capabilities to the 3GPP AAA Server.\nDuring the STa Access Authentication and Authorization procedure the trusted non-3GPP access network shall provide information on the Access Network Identity (ANID) to the 3GPP AAA Server. Specifically, the TWAN shall set the Access Network Identity as specified in clause 8.1.1.2 of 3GPP TS 24.302 [26] for a WLAN access network.\nFor a trusted non-3GPP access, the 3GPP AAA Server may perform IP mobility mode selection between NBM and HBM. The 3GPP AAA Server may provide to the trusted non-3GPP access network an indication if either NBM or local IP address assignment (for HBM) shall be used.\nFor a trusted WLAN access,\n-\tthe TWAN should send information on whether it supports TSCM, SCM or MCM or any combination of them to the 3GPP AAA Server as specified in 3GPP TS 23.402 [63]. If it indicates support of the MCM, the TWAN shall also provide the 3GPP AAA Server with the TWAG's control plane IPv4 address, or IPv6 address or both (if it supports both IPv4 and IPv6), to be sent to the UE and used for WLCP if the MCM is selected.\n-\tif the user is successfully authenticated and authorized for this access, the 3GPP AAA Server:\n-\tshall select either TSCM, SCM or MCM and indicate to the TWAN the selected mode of operation. If the 3GPP AAA Server does not provide such an indication, the TSCM shall be used;\n-\tmay either only authorize the user to access to EPC via S2a (i.e. EPC-routed service only), or only authorize the user to access the TWAN without granting access to EPC via S2a (i.e. non-seamless WLAN offload service only), or authorize both EPC-routed and non-seamless WLAN offload services. If the SCM is selected, the 3GPP AAA Server shall indicate to the TWAN its decision to either authorize access to EPC via S2a or only authorize the user to access the TWAN without granting access to EPC via S2a, i.e. not both;\n-\twhen authorizing the SCM to be used for EPC access, the 3GPP AAA server shall forward the PDN connectivity parameters received from the UE to the TWAN, i.e. the UE requested PDN type (IPv4, IPv6 or IPv4v6), the attach type (initial attach or handover), optionally the requested APN (if received from the UE) and optionally the Protocol Configuration Options (if received from the UE));\n-\twhen authorizing the MCM for EPC access, the 3GPP AAA server shall derive the WLCP key as defined in 3GPP TS 33.402 [19] and shall provide the WLCP key to the TWAN to protect the WLCP signalling.\nif the user is successfully authenticated and authorized for this access, the TWAN:\n-\tshall decide the S2a protocol variant to use if access to EPC is authorized and the TWAN decides to establish S2a.\n-\tif the SCM has been authorized to be used for EPC access, the TWAN shall return an indication to the 3GPP AAA Server on whether the requested connectivity has been granted and, if so, also pass on to the 3GPP AAA Server the connectivity parameters to be provided to the UE, i.e. the selected APN, the selected PDN type (IPv4, IPv6 or IPv4v6), the IPv4 address (for PDN type IPv4 or IPv4v6), the IPv6 interface identifier (for PDN type IPv6 or IPv4v6), optionally the Protocol Configuration Options received from the PDN GW once S2a has been established, and the TWAG user plane MAC address. If the requested connectivity has not been granted, the TWAN should provide the 3GPP AAA Server with a cause indicating why the requested connectivity could not be granted; the TWAN may also provide a Session Management back-off timer to be sent to the UE to instruct the UE to not request new PDN connectivity to the same APN for the indicated time.\nWhen authorizing NBM to be used, the 3GPP AAA server shall return NBM related information back to the trusted non-3GPP access network.\nDuring the STa Access Authentication and Authorization procedure, when DSMIPv6 is used, the 3GPP AAA Server may provide a Home Agent IPv6 address (and optionally IPv4 address) or FQDN to the trusted non-3GPP access network. This is needed if the DHCPv6 option for Home Agent address discovery is chosen (see TS 24.303 [13] and IETF RFC 6611 [28]). If the Home Agent IPv6 address or FQDN is not included in the final Authentication and Authorization Answer by the 3GPP AAA server, the trusted non-3GPP access network shall not assign the Home Agent via DHCPv6.\nDuring the STa Access Authentication and Authorization procedure for MIPv4 FA-CoA mode using trusted non-3GPP access, the 3GPP AAA Server may provide the mobility security parameters FA-RK and FA-RK-SPI to the trusted non-3GPP access network.\nThe User-Name AVP may contain a decorated NAI (as defined in clause 19.3.3 of 3GPP TS 23.003 [14]). In this case the 3GPP AAA Proxy shall process the decorated NAI and support routing of the Diameter request messages based on the decorated NAI as described in IETF RFC 5729 [37].\nBased on local policies, EPC access for emergency services over a trusted non-3GPP access is supported as specified in clause 4.5.7.2.1 of 3GPP TS 23.402 [3] for:\n-\tUEs with a valid EPC subscription that are authenticated and authorized for EPC services;\n-\tUEs that are authenticated only;\n-\tUEs with an unauthenticated IMSI; and/or\n-\tUICC-less UEs.\nFor PMIPv6, GTPv2 and MIPv4 FA-CoA mode trusted non-3GPP accesses, upon mobility between 3GPP and non-3GPP accesses, for the PDNs the UE is already connected, the PDN GW identity for each of the already allocated PDN GW(s) with the corresponding PDN information is provided to the trusted non-3GPP system. The PDN GW identity is a FQDN and/or IP address of the PDN GW. The non-3GPP access network shall use the received PDN GW identity for mobility with IP address preservation or in case of static PDN GW assignment. If a FQDN is provided, the trusted non-3GPP system shall then derive it to IP address according to the selected mobility management protocol.\nNOTE:\tMobility with IP address preservation is not supported between TWAN and 3GPP access in TSCM.\nDuring the STa Access Authentication and Authorization procedure, the bootstrapping of an ER server in the TWAN with a given root key may be performed, as described in IETF RFC 6696 [55] and 3GPP TS 33.402 [19]. This procedure is used to provide an ER server with the keying material that will be used for further EAP re-authentication procedures using ERP.\nTable 5.1.2.1/1: STa Access Authentication and Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes, if it contains a NAI other than an Emergency NAI for Limited Service State.\nEAP payload\nEAP-payload\nM\nThis IE shall contain the Encapsulated EAP payload used for the UE – 3GPP AAA Server mutual authentication\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nUE Layer-2 address\nCalling-Station-ID\nM\nThis IE shall contain the Layer-2 address of the UE.\nSupported 3GPP QoS profile\nQoS-Capability\nO\nIf the non-3GPP access network supports QoS mechanisms, this information element may be included to contain the access network's QoS capabilities as defined in IETF RFC 5777 [9].\nMobility Capabilities\nMIP6-Feature-Vector\nC\nThis information element shall contain the mobility capabilities of the non-3GPP access network. This information shall be utilized if dynamic mobility mode selection is executed. This information may also be used to decide whether to authorize access to EPC to a user accessing a TWAN.\nThe PMIP6_SUPPORTED flag and/or the GTPv2 SUPPORTED flag shall be set if the non-3GPP access supports PMIPv6 and/or GTPv2. PMIP6_SUPPORTED flag is defined in IETF RFC 5779 [2].\nThe flag MIP6_INTEGRATED shall be set if DHCPv6 based Home Agent address discovery is supported as defined in IETF RFC 5447 [6].\nThe MIP4_SUPPORTED flag shall be set if the non-3GPP access supports MIPv4 FA-CoA mode.\nAccess Type\nRAT-Type\nM\nThis IE shall contain the non-3GPP access network technology type that is serving the UE.\nThe TWAN shall set the Access Type value to \"WLAN\".\nAccess Network Identity\nANID\nM\nThis IE shall contain the access network identifier used for key derivation at the HSS. (See 3GPP TS 24.302 [26] for all possible values)\nFull Name for Network\nFull-Network-Name\nO\nIf present, this IE shall contain the full name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network. If the Visited Network Identifier is present, this AVP shall be set.\nShort Name for Network\nShort-Network-Name\nO\nIf present, this IE shall contain the short name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network. If the Visited Network Identifier is present, this AVP shall be set.\nVisited Network Identifier\nVisited-Network-Identifier\nO\nIf present, this IE shall contain the Identifier that allows the home network to identify the Visited Network. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network.\nAPN Id\nService-Selection\nO\nIf present, this information element shall contain the Network Identifier part of the APN the user wants to connect to (if available).\nTerminal Information\nTerminal-Information\nO\nIf present, this information element shall contain information about the user's mobile equipment. The type of identity carried depends on the access technology type. For an HRPD access network, the 3GPP2‑MEID AVP shall be included in this grouped AVP.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nSelected Trusted WLAN Identifier\nWLAN-Identifier\nO\nIf present, this IE shall contain the WLAN Identifier selected by the UE to access the Trusted WLAN Access Network (see clause 16 of 3GPP TS 23.402 [3]).\nAAA Failure Indication\nAAA-Failure-Indication\nO\nIf present, this information element shall indicate that the request is sent after the non-3GPP access network has determined that a previously assigned 3GPP AAA Server is unavailable.\nDER Flags\nDER-Flags\nO\nThis Information Element contains a bit mask. See 5.2.3.20 for the meaning of the bits.\nTransport Access Type\nTransport-Access-Type\nC\nFor interworking with Fixed Broadband access networks (see 3GPP TS 23.139 [39]), if the access network needs to receive the IMSI of the UE in the authentication response, then this information element shall be present, and it shall contain the value \"BBF\" (see clause 5.2.3.19).\nSupported TWAN Connection Modes\nTWAN-Connection-Mode\nO\nThe TWAN should include this IE.\nIf present, this information element shall contain the TWAN connection modes supported by the TWAN, i.e. TSCM, SCM and/or MCM.\nProvided Connectivity Parameters\nTWAN-Connectivity-Parameters\nC\nThis information element shall be present if the 3GPP AAA Server has previously authorized the SCM to be used for EPC access.\nTWAN-Connectivity-Parameters is a grouped AVP.\nIf the requested connectivity has been granted, the following information elements shall be included:\n- selected APN\n- selected PDN type\n- UE IPv4 Address (for PDN type IPv4 or IPv4v6)\n- UE IPv6 Interface Identifier (for PDN type IPv6 or IPv4v6)\n- Protocol Configuration Options (if received from the PGW)\n- TWAG user plane MAC address\nThe absence of both an IPv4 address and an IPv6 Interface Identifier indicates that the requested connectivity could not be granted. If the requested connectivity has not been granted, the following information elements may be included:\n- a cause indicating why the requested connectivity has not been granted\n- a Session Management back-off timer to be sent to the UE\nTWAG Control Plane IP Address\nTWAG-CP-Address\nC\nThe TWAN shall include this IE if it indicates support of the MCM in the Supported TWAN Connection Modes IE. When present, this IE shall contain the TWAG Control Plane IPv4 Address, or the TWAG Control Plane IPv6 link local address, or both (if the TWAG supports IPv4 and IPv6), to be used for WLCP by the UE if the MCM is used.\nIMEI Check in VPLMN Result\nIMEI-Check-In-VPLMN-Result\nC\nThe 3GPP AAA Proxy shall include this IE if it has performed an IMEI check in the VPLMN. When present, this IE shall contain the result of the IMEI check.\nDomain-Specific Re-authentication Key Request\nERP-RK-Request\nO\nIf present, this IE indicates the willingness of an ER server located in the non-3GPP access network to act as the ER server for this session.\nWhen present, this IE shall contain the name of the realm in which the ER server is located.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nBased on operator policy, this information element shall be sent to the 3GPP AAA Server if the UE has access priority conveyed in an EAP response/identity message as described in 3GPP TS 24.302 [26].\nTable 5.1.2.1/2: Trusted non-3GPP Access Authentication and Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes, if it contains a NAI other than an Emergency NAI for Limited Service State.\nEAP payload\nEAP payload\nO\nIf present, this IE shall contain the Encapsulated EAP payload used for UE- 3GPP AAA Server mutual authentication.\nThis IE shall not be included if the UE has been authenticated and the 3GPP AAA Server authorizes the SCM for EPC access for the UE and the Result-Code AVP is set to DIAMETER_MULTI_ROUND_AUTH.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code /\nExperimental Result Code\nM\nThis IE shall contain the result of the operation. Result codes are as in Diameter base protocol (see IETF RFC 6733 [58]). Experimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSession Alive Time\nSession-Timeout\nO\nThis AVP may be present if the Result-Code AVP is set to DIAMETER _SUCCESS; if present, it contains the maximum number of seconds the session is allowed to remain active.\nAccounting Interim Interval\nAccounting Interim-Interval\nO\nIf present, this IE shall contain the Charging duration.\nPairwise Master Key\nEAP-Master-Session-Key\nC\nThis IE shall be present if Result-Code AVP is set to DIAMETER_SUCCESS.\nDefault APN\nContext-Identifier\nC\nThis AVP shall indicate the default APN for the user. If the Access Network Identity received in the Authentication and Authorization Request indicates WLAN (see clause 8.1.1.2 of 3GPP TS 24.302 [26]) and if the TSCM is selected, this AVP shall be set to the Default APN for Trusted WLAN if received from the HSS; otherwise this AVP shall be set to the subscriber's Default APN for 3GPP and other non-3GPP accesses.\nIt shall only be included if NBM is authorized for use, the non-3GPP access network was decided to be trusted, the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Answer and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nAPN-OI replacement\nAPN-OI-Replacement\nC\nThis AVP shall indicate the domain name to replace the APN-OI in the non-roaming case or in the home routed roaming case when constructing the PDN GW FQDN upon which a DNS resolution needs to be performed. See 3GPP TS 23.003 [3]. It shall only be included if NBM is authorized for use, the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Answer and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if EPC Access is authorized, the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Answer and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nWhen NBM is authorized for use, this AVP shall contain the default APN, the list of authorized APNs, including the wildcard APN if configured in the user's subscription, user profile information and PDN GW information.\nWhen local IP address assignment is used (for HBM), this AVP shall only be present if DHCP based Home Agent discovery is used and contain the Home Agent Information for discovery purposes.\nThe trusted non-3gpp access network knows if NBM is authorized for use or if a local IP address (for HBM) is assigned based on the flags in the MIP6-Feature-Vector.\nAPN-Configuration is a grouped AVP, defined in 3GPP TS 29.272 [29]. When NBM is authorized for use, the following information elements per APN may be included:\n- APN\n- Authorized 3GPP QoS profile\n- Statically allocated User IP Address (IPv4 and/or IPv6)\n- Allowed PDN types\n- PDN GW identity\n- PDN GW allocation type\n- VPLMN Dynamic Address Allowed\n- APN-AMBR\n- Visited Network Identifier (see clause 5.1.2.1.4)\n- SIPTO permission\nWhen DSMIPv6 is used, the following information elements per Home Agent may be included:\n- HA-APN (Home Agent APN as defined in 3GPP TS 23.003 [14])\n- Authorized 3GPP QoS profile\n- PDN GW identity\nWhen MIPv4 FACoA is used, the following information elements per APN may be included:\n- APN\n- Allowed PDN types\nServing GW Address\nMIP6-Agent-Info\nO\nThis AVP shall be used only in chained S2a-S8 cases and it shall be sent only if the Result-Code AVP is set to DIAMETER_SUCCESS.\nMobility Capabilities\nMIP6-Feature-Vector\nC\nThis information element shall only be sent if EPC Access is authorized and if the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nIt shall contain a AAA/HSS authorized set of mobility capabilities to the trusted non-3GPP access network, if dynamic mobility mode selection between NBM and HBM is done. It shall also be sent when authorizing access to EPC to a user accessing a TWAN.\nThe PMIP6_SUPPORTED and/or the GTPv2_SUPPORTED shall be set to indicate that NBM (PMIPv6 or GTPv2) is authorized for use.\nOtherwise, ASSIGN_LOCAL_IP or MIP4_SUPPORTED flag shall be set by the 3GPP AAA Server to mandate which HBM mobility protocol is used.\nThe MIP6_INTEGRATED flag shall be set if a Home Agent address is provided for DHCPv6 based Home Agent address discovery. In the latter case HA information for DHCPv6 discovery is provided via the APN-Configuration AVP.\nPermanent User Identity\nMobile-Node-Identifier\nC\nThis information element shall only be sent if the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nThis information element shall only be sent if NBM or MIPv4 is authorized for use, or when authorizing the user to access the TWAN without granting access to EPC S2a (i.e. non-seamless WLAN offload).\nIf the user is authenticated, it shall contain an AAA/HSS assigned permanent user identity (i.e. an IMSI in root NAI format as defined in clause 19 of 3GPP TS 23.003 [14]) to be used:\n- by the MAG in subsequent PBUs as the MN-ID identifying the user in the EPS network, or\n- by the trusted non-3GPP access network in subsequent MIPv4 RRQs as the MN-NAI identifying the user in the EPS network, or\n- by the trusted non-3GPP access network to derive the IMSI to be sent in subsequent Create Session Request on GTP S2a.\nFor an Emergency Attach, if the UE is UICC-less (i.e. the User Identity IE in the request contains an IMEI) or if the IMSI is not authenticated, the Permanent User Identity shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14].\nThis information element shall also be sent if HBM is authorized for use, or to access a Fixed Broadband access network without granting access to EPC S2a (i.e. non-seamless WLAN offload), and the Result-Code AVP is set to DIAMETER_SUCCESS and if the Transport Access Type in the request command indicated that the UE is accessing the EPC from a Fixed Broadband access network (i.e., the Transport-Access-Type AVP takes the value \"BBF\"); it shall contain an AAA/HSS assigned permanent user identity (i.e. an IMSI in root NAI format as defined in clause 19 of 3GPP TS 23.003 [14]) to be used:\n- by the trusted non-3GPP access network in subsequent PCC procedure for identifying the user in the EPS network.\nIf this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be sent if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nIf present, this information element shall contain the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\nUE AMBR\nAMBR\nC\nThis Information Element shall contain the UE AMBR of the user. It shall be present only if the non-3GPP access network was decided to be trusted, the Result-Code AVP is set to DIAMETER_SUCCESS and ANID is \"HRPD\".\nTrust Relationship Indicator\nAN-Trusted\nC\nThis AVP shall be included only in the first authentication and authorization response. If present, it shall contain the 3GPP AAA Server's decision on handling the non-3GPP access network trusted or untrusted.\nFor the STa case, the value \"TRUSTED\" shall be used.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nFA-RK\nMIP-FA-RK\nC\nThis AVP shall be present if MIPv4 FACoA mode is used, the MN-FA authentication extension is supported and the Result-Code AVP is set to DIAMETER_SUCCESS.\nFA-RK-SPI\nMIP-FA-RK-SPI\nC\nThis AVP shall be present if MIP-FA-RK is present\nTrace information\nTrace-Info\nC\nThis information element shall only be sent if the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is used to download the trace activation from the HSS to the non-3GPP access network.\nOnly the Trace-Data AVP shall be included to the Trace-Info AVP and shall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth-List\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List, for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nMSISDN\nSubscription-ID\nC\nThis AVP shall contain the MSISDN of the UE and shall be sent if it is available and the non-3GPP access network is trusted and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nDEA Flags\nDEA-Flags\nO\nThis Information Element contains a bit mask. See 5.2.3.21 for the meaning of the bits.\nSelected TWAN Connection Mode\nTWAN-Connection-Mode\nC\nThe 3GPP AAA Server shall include this IE if it selects either the SCM or MCM and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nWhen present, this IE shall indicate the selected mode of operation (either SCM or MCM).\nIf this IE is not present, the TWAN shall use TSCM.\nRequested Connectivity Parameters\nTWAN-Connectivity-Parameters\nC\nThis IE shall contain the requested connectivity parameters received from the UE if the 3GPP AAA Server authorizes the SCM for TWAN and the Result-Code AVP is set to DIAMETER_MULTI_ROUND_AUTH, and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\nWhen present, the following information elements shall be included:\n- attach type (initial attach or handover)\n- requested APN (if received from the UE, see NOTE 3) if the UE did not request an Emergency Attach.\n- requested PDN type\n- Protocol Configuration Options (if received from the UE)\nWLCP Key\nWLCP-Key\nC\nThis IE shall be present if the Result-Code AVP is set to DIAMETER_SUCCESS and the selected TWAN Connection Mode is MCM. If present, it shall contain the key for protecting WLCP signalling (see 3GPP TS 33.402 [19]).\nTerminal Information\nTerminal-Information\nC\nThis information element enables to convey the user's Mobile Equipment Identity to the non-3GPP access network in scenarios where the UE signals its Mobile Equipment Identity directly to the 3GPP AAA Server, i.e. when the Terminal-Information AVP is not received in the Authentication and Authorization Request.\nFor a trusted WLAN access, the 3GPP AAA Server shall include this IE if the user's Mobile Equipment Identity is available.\nWhen present, this grouped AVP shall contain the IMEI AVP and, if available, the Software Version AVP.\n(see NOTE 2)\nEmergency Services\nEmergency-Services\nC\nIf the 3GPP AAA Server supports IMS emergency sessions over TWAN (see clause 4.5.7 of 3GPP TS 23.402 [3]), it shall include this IE and set the Emergency-Indication bit when the UE indicates an Emergency Attach in EAP-AKA' signalling.\nEmergency Info\nEmergency-Info\nC\nWhen present, this IE shall contain the identity of the PDN GW dynamically allocated for emergency services. It shall be present for a non-roaming authenticated user, if this information was received from the HSS, the TWAN indicated support of IMS Emergency sessions and the Result-Code AVP is set to either:\n- DIAMETER_SUCCESS or\n- DIAMETER_MULTI_ROUND_AUTH and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\n(see NOTE 1)\nERP Keying Material\nKey\nC\nIf the 3GPP AAA Server supports ERP, this IE shall be present if the Result-Code AVP is set to DIAMETER_SUCCESS, the domain-specific re-authentication key was requested and the use of ERP is authorized for this user (see clause 8.2.3.27). In that case, this IE shall contain the Domain-Specific Root Key (DSRK) and the Extended Master Session Key name (EMSKname), and it may contain the DSRK lifetime.\nERP Realm\nERP-Realm\nC\nThis IE shall be present if the ERP Keying Material is present. This IE indicates the realm where the ER server is located; it also indicates the domain name to use as the realm part of the KeyName-NAI used during ERP-based re-authentication.\nUE Usage Type\nUE-Usage-Type\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the UE Usage Type of the subscriber.\nMPS Priority\nMPS-Priority\nC\nBased on operator policy, this information element shall be sent to the non-3GPP WLAN access if the UE has an MPS subscription in the HSS.\nNOTE 1:\tThe 3GPP AAA Server may decide to not include the AVP if the Result-Code AVP is set to DIAMETER_SUCESS and the AVP has already been sent in a previous message with the Result-Code AVP set to DIAMETER_MULTI_ROUND_AUTH and the TWAN-S2a-Connectivity-Indicator set in DEA-Flags. In that case, the TWAN shall consider the information received in the previous message as still applicable.\nNOTE 2:\tFor a trusted WLAN access, the UE signals its Mobile Equipment Identity to the 3GPP AAA Server via EAP-AKA' and the 3GPP AAA Server forwards this information to the TWAN in the Terminal-Information AVP in the Authentication and Authorization Answer.\nNOTE 3:\tThe Service-Selection AVP in the Requested Connectivity Parameters IE shall contain the APN requested by the UE, regardless of whether this APN is authorized by a matching APN or by the wildcard APN in the user's subscription.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_24.302_clause_8.1.1.2",
        "ts_23.003_clause_19.3.3",
        "ts_23.402_clause_4.5.7.2.1",
        "ts_23.003_clause_19",
        "ts_23.402_clause_16",
        "clause_5.2.3.19",
        "clause_5.1.2.1.4",
        "ts_23.402_clause_4.5.7",
        "clause_8.2.3.27",
        "table_5.1.2.1",
        "ts_24.302_table_5.1.2.1",
        "ts_24.302",
        "ts_23.402",
        "ts_33.402",
        "ts_24.303",
        "ts_23.003",
        "ts_29.229",
        "ts_23.139",
        "ts_29.272",
        "ts_29.061",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.1.2",
      "section_id": "5.1.2.1.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "On receipt of the first DER message, the 3GPP AAA Server shall check the validity of the ANID AVP and whether the non-3GPP access network is entitled to use the included value. The correct syntax of the ANID is checked as follows:\n-\tIn a non-roaming case, i.e. when the 3GPP AAA Server receives the request directly and not via the 3GPP AAA Proxy, checking ANID is mandatory;\n-\tIn a roaming case when the request is received via an 3GPP AAA proxy, checking ANID is optional. The 3GPP AAA Server may decide to check ANID based on local configuration, e.g. depending on the received visited network identifier.\n-\tIf the checking result shows that the included ANID value is not valid (not defined by 3GPP) or that the requesting entity is not entitled to use the received ANID value, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nThe 3GPP AAA Server shall check if user data exists in the 3GPP AAA Server (containing valid authentication information for the current access network identity). If not, the 3GPP AAA Server shall use the procedures defined in SWx interface to obtain access authentication and authorization data.\nIf IMEI check is required by operator policy and the TWAN is in the HPLMN, the 3GPP AAA Server shall:\n-\tretrieve the IMEI(SV) from the UE as specified in 3GPP TS 23.402 [26];\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status towards the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Server determines that the authentication and authorization procedure shall be stopped, it shall:\n-\tnotify the UE that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR), as specified in 3GPP TS 24.302 [26];\n-\trespond to the TWAN with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nIf the IMEI-Check-Required-In-VPLMN bit is set in the DER-Flags AVP of the first Authentication and Authorization Request message and the TWAN is in the VPLMN, the 3GPP AAA Server shall:\n-\tretrieve the IMEI(SV) from the UE as specified in 3GPP TS 23.402 [26];\n-\trequest the VPLMN to check the IMEI, by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the IMEI(SV) if available in the DEA message;\n-\tupon getting the IMEI-Check-In-VPLMN-Result AVP in the subsequent DER message, if the IMEI check failed in the VPLMN:\n-\tnotify the UE that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR), as specified in 3GPP TS 24.302 [26];\n-\trespond to the TWAN with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSee Annex A.2.3 and A.3.2.\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the non-3GPP access network included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nIf SWx authentication response indicates that:\n-\tThe user does not exist, then the 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_USER_UNKNOWN.\n-\tThe user does not have non-3GPP access subscription, then 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION.\n-\tThe user is not allowed to roam in the visited network, then 3GPP AAA Server shall respond the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\n-\tThe user is currently being served by a different 3GPP AAA Server, then the 3GPP AAA Server shall respond to the non-3GPP access network with the Result-Code set to DIAMETER_REDIRECT_INDICATION and the Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tThe user is not allowed to use the current access type, then the 3GPP AAA Server shall respond to the non-3GPP access network with Experimental-Result-Code DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\n-\tAny other error occurred, then the error code DIAMETER_UNABLE_TO_COMPLY shall be returned to the non-3GPP access network.\nWhen SWx authentication response includes the requested authentication information, the 3GPP AAA Server shall proceed with the authentication and authorization procedure. The 3GPP AAA Server shall use the procedures defined in SWx interface to obtain the user's subscription profile from HSS.\nBefore sending out the authentication challenge, the 3GPP AAA Server shall decide, whether the access network is handled as Trusted or Untrusted. The 3GPP AAA Server shall make the decision based on the Access Network Identifier and Visited Network Identity information elements, according to its local policies. The local policies of the 3GPP AAA Server shall be based on the security criteria described in 3GPP TS 33.402 [19].\nNOTE 1:\tThe network operator can configure this e.g. according to the roaming agreements with the non-3GPP AN operator or with VPLMN operator.\nIn a roaming case, if the 3GPP AAA Server has received the trust relationship indicator from the VPLMN (AN-Trusted AVP), the 3GPP AAA Server may use this information as input parameter to the trusted/untrusted evaluation.\nThe VPLMN trust relationship indicator may be utilized only if the appropriate trust relationship exists between the HPLMN and VPLMN operators.\nBased on the trusted/untrusted decision, the 3GPP AAA Server may send a trust relationship indication to the UE, as described in 3GPP TS 24.302 [26].\nThe 3GPP AAA Server shall indicate the trust relationship assessment of the non-3GPP access network to the UE in the AT_TRUST_IND attribute (in the EAP-Request/AKA'-Challenge) as defined in 3GPP TS 24.302 [26]. The 3GPP AAA Server shall also indicate the trust relationship assessment to the non-3GPP access network using AN-Trusted AVP in the DEA command.\nIf the decision is \"Trusted\", the STa authentication and authorization procedure is executed as described here, in clause 5.1.2.1 and it clauses. Otherwise, the SWa authentication and authorization procedure is executed as described in clause 4.1.2.1.\nThe 3GPP AAA Server marks the trust relationship as \"trusted\" with the User Identity. If the 3GPP AAA Server detects that an S6b session already exists for the corresponding UE and the S6b session was established as a result of an authentication request for DSMIPv6, the 3GPP AAA Server shall send the trust relationship to the PDN GW as specified in clause 9.1.2.5.\nThe 3GPP AAA Server shall run EAP-AKA' authentication as specified in 3GPP TS 33.402 [19]. Exceptions shall be treated as error situations and the result code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nOnce authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error):\n1)\tCheck if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED\n2)\tCheck the access type. If the received access type is listed in the user's disallowed RAT-Types,\nthis shall be treated as error and the Experimental-Result-Code DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED shall be returned.\nThe following steps are only executed if the non-3GPP access network was decided to be Trusted.\n3)\tIf the APN Id IE is present in the request, check if the user has a subscription for the requested APN or for the wildcard APN. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION\n4)\tfor a trusted WLAN access (i.e. ANID in the request indicates WLAN, see clause 8.1.1.2 of 3GPP TS 24.302 [26]), check if the user is authorized to access to EPC via S2a and/or non-seamless WLAN offload via the selected WLAN:\n-\tif no TWAN-Access-Info AVP was received from the HSS in the user's subscription, the 3GPP AAA Server shall consider that access to EPC and non-seamless WLAN Offload is authorized;\n-\tif one or more TWAN-Access-Info AVP(s) was received from the HSS in the user's subscription:\n-\tif the TWAN has signalled the selected Trusted WLAN in the request and the selected Trusted WLAN identifier contains only the SSID of the selected WLAN, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the selected trusted WLAN (i.e. including a WLAN-Identifier AVP with the same SSID and without HESSID information) if any;\nNOTE 2:\tWhen the TWAN does not include the HESSID in the request, the authorization information in the 3GPP AAA Server containing both SSID and HESSID is not applicable; therefore, in order to get specific authorization of the UE in this case, the operator needs to define authorization information for the SSID in question (without HESSID), or to rely on the \"wildcard\" authorization (i.e., a TWAN-Access-Info AVP not including a WLAN-Identifier AVP).\n-\tif the TWAN has signalled the selected Trusted WLAN in the request and the selected Trusted WLAN identifier contains both the SSID and the HESSID of the selected WLAN, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the selected trusted WLAN (i.e. including a WLAN-Identifier AVP with the same SSID and same HESSID);\nElse, if no match is found, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the HESSID of the selected Trusted WLAN identifier (i.e. TWAN-Access-Info including a WLAN-Identifier AVP with the same HESSID and without SSID information);\nElse, if no match is found, the 3GPP AAA Server shall authorize the access methods allowed by the TWAN-Access-Info AVP explicitly matching the SSID of the selected Trusted WLAN identifier (i.e. TWAN-Access-Info including a WLAN-Identifier AVP with the same SSID and without HESSID information) ;\n-\totherwise, if the selected Trusted WLAN does not match explicitly any of the TWAN-Access-Info or if TWAN has not signalled the selected Trusted WLAN Identifier, the 3GPP AAA Server shall apply the access methods allowed by the \"wildcard\" TWAN-Access-Info AVP (i.e. TWAN-Access-Info AVP not including a WLAN-Identifier AVP) if any;\n-\totherwise, if the \"wildcard\" TWAN-Access-Info is not present, the 3GPP AAA Server shall consider that access to EPC and non-seamless WLAN Offload is not authorized.\n5)\tCheck if the user is not authorized to perform non-seamless WLAN Offload and, if the user is also barred from using the subscribed APNs, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n6)\tIf present, check the flags of the received MIP6-Feature-Vector AVP:\n-\tIf the MIP6_INTEGRATED flag is set and the 3GPP AAA Server has authorized DHCP Home Agent assignment, the 3GPP AAA Server shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag set. If the HA assignment via DHCPv6 is not used, the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag not set shall be sent.\n-\tThe PMIP6_SUPPORTED and/or GTPv2 SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP access network supports NBM or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection between NBM and HBM. For a trusted WLAN access, if the user is successfully authenticated and authorized for this access, the 3GPP AAA Server may either only authorize the user to access to EPC via S2a (i.e. EPC-routed service only), or only authorize the user to access the TWAN without granting access to EPC via S2a (i.e. non-seamless WLAN offload service only), or authorize both EPC-routed and non-seamless WLAN offload services, taking also into account the subscriber profile, access network, the selected WLAN identifier if present, and the TWAN's non-seamless WLAN offload capability if present, and the authorized mode of operation (TSCM, SCM or MCM). The 3GPP AAA Server may authorize both EPC-routed and non-seamless WLAN offload services only if the MCM is selected, or in non-roaming scenarios if the TSCM is selected; the 3GPP AAA Server shall not authorize both EPC-routed and non-seamless WLAN offload services if the SCM is selected or in roaming scenarios if the TSCM is selected. If the 3GPP AAA Server decides that access to EPC is authorized and NBM should be used for such access, the PMIP6_SUPPORTED and GTPv2_SUPPORTED flags shall be set in the response to indicate that NBM is authorized for use for the UE by the trusted non 3GPP access network. If only the PMIPv6_SUPPORTED or the GTPv2_SUPPORTED flag is present in the response, the trusted non-3GPP access network shall assume that this also indicates that NBM is authorized for use. In addition, for a trusted WLAN access, the Non-seamless WLAN offload Authorization flag shall be set in the DEA-Flags AVP in the response if the non-seamless WLAN offload is authorized.If the 3GPP AAA Server decides to only authorize the user to access the TWAN without granting access to EPC S2a (i.e. non-seamless WLAN offload service only), none of the flags (PMIP6_SUPPORTED, GTPv2_SUPPORTED, MIP4_SUPPORTED, MIP6_INTEGRATED, ASSIGN_LOCAL_IP) shall be set in the response, i.e. the Mobility Capabilities IE is not sent in the response, and the Non-seamless WLAN offload Authorization flag shall be set in the DEA-Flags AVP in the response.\nIf the 3GPP AAA Server decides that a local IP address should be assigned for HBM, the ASSIGN_LOCAL_IP flag shall be set in the response to indicate to the trusted non 3GPP access network that a local IP address (for HBM) should be assigned. The 3GPP AAA Server shall not set the PMIP6_SUPPORTED/GTPv2_SUPPORTED and ASSIGN_LOCAL_IP flags both at the same time in the response.\n-\tThe MIP4_SUPPORTED flag indicates to the 3GPP AAA Server whether the trusted non-3GPP access network supports MIPv4 FA-CoA mode or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA Server may perform mobility mode selection. If the 3GPP AAA Server decides that MIPv4 FA-CoA mode should be used, the MIP4_SUPPORTED flag shall be set in the response.\nNOTE 3:\tWhen selecting DSMIPv6 the AAA server assumes that the trusted non 3GPP access gateway has the capability to assign a local IP address to the UE.\nFor Trusted WLAN access, the 3GPP AAA Server shall select the TWAN connection mode, i.e. either TSCM, SCM or MCM, taking into account the modes supported by the TWAN (as reported in the first DER message), those supported by the UE (as reported in the EAP payload, see 3GPP TS 24.302 [26]) and operator policy. The 3GPP AAA Server shall then indicate to the TWAN the TWAN connection mode it has selected, either explicitly using the Selected TWAN Connection Mode IE if it has selected SCM or MCM, or implicitly by not including the Selected TWAN Connection Mode IE if it has selected TSCM.\nFor Trusted WLAN access, if the 3GPP AAA Server has determined that the EAP-AKA' authentication is correct (i.e., the UE has sent a valid EAP-AKA' challenge response) and if the 3GPP AAA Server authorizes the SCM to be used for EPC access, the 3GPP AAA Server shall reply to the first DER message it receives with a result code set to DIAMETER_MULTI_ROUND_AUTH, leave the EAP-Payload AVP absent in the reply, and set the TWAN-S2a-Connectivity-Indicator bit to 1 in the DEA-Flags AVP; it shall also include in the response command all subscription-related parameters for the user, so the TWAN is able to proceed with the setup of the required S2a network connectivity (e.g., establishment of the GTP tunnel). After receiving a subsequent DER command from the TWAN, the 3GPP AAA Server shall check if the TWAN-S2a-Connectivity-Indicator is set, and if so, it may disregard the received EAP-Payload, since the EAP-AKA' challenge response has been already successfully checked. If the TWAN could not provide the requested S2a network connectivity and included a Session Management back-off timer in the DER command, the 3GPP AAA Server shall instruct the UE to not request new PDN connectivity to the same APN for the indicated time as specified in 3GPP TS 24.302 [26]. See Annex A.\nOnce the Authentication and Authorization procedure successfully finishes, the 3GPP AAA Server shall download, the authentication data, the list of authorized APN's if the UE did not indicate an Emergency Attach in EAP-AKA' signalling (see 3GPP TS 24.302 [26]), and the authorized mobility protocols in the authentication and authorization response from the HSS (see SWx procedure in Clause 8.1.2.1). If the Access Network Identity received in the Authentication and Authorization Request indicates WLAN (see clause 8.1.1.2 of 3GPP TS 24.302 [26]) and if the TSCM is selected, the 3GPP AAA Server shall set the Default APN in the Authentication and Authorization Answer to the Default APN for Trusted WLAN if received from the HSS, otherwise to the subscriber's Default APN for 3GPP and other non-3GPP accesses.\nFor a trusted WLAN access, if the user is authorized to access to EPC via S2a, and/or non-seamless WLAN offload via the selected WLAN, the 3GPP AAA Server shall send the user's Mobile Equipment Identity to the TWAN, if this information is available.\nOnce the Authentication and Authorization procedures successfully finish and if MIPv4 FACoA mode is used the 3GPP AAA Server shall calculate the MIPv4 FACoA mobility security parameters as defined in 3GPP TS 33.402 [19] and include these in the authentication and authorization response to the trusted non 3GPP access network.\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nFor Fixed Broadband access network, the 3GPP AAA Server shall determine if the UE is connected via a BBF-defined WLAN access according to the Transport-Access-type AVP. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA Server shall perform the enabling of the UE reflective QoS function as specified in 3GPP TS 24.139 [43].\nNOTE 4:\tThis behaviour is applicable for both fixed broadband access interworking and the fixed broadband access convergence. The architecture of fixed broadband access interworking is specified in 3GPP TS 23.139 [39]. The architecture of the fixed broadband access convergence is specified in 3GPP TS 23.203 [45].\nIf the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall proceed as specified above, but with the following modifications, for an Emergency Attach:\n1)\tThe 3GPP AAA Server shall reject the Authentication and Authorization Request and set the result code to DIAMETER_UNABLE_TO_COMPLY if the TWAN does not indicate support of IMS Emergency sessions in the DER-Flags AVP in the request.\n2)\tIf the UE does not have an IMSI:\n-\tif local policies allow emergency sessions for all UEs, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authentication and authorization data, shall skip the authorization checkings and shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n3)\tIf the UE has an IMSI but the IMSI is not authenticated:\n-\tif local policies allow emergency sessions for unauthenticated UEs with an IMSI, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authorization data, shall skip the authorization checkings, shall request the UE to provide its IMEI as specified in clause 13.4 of 3GPP TS 33.402 [19] and shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authentication failures in this clause.\n4)\tIf the UE has an authenticated IMSI but the UE is not authorized to access the EPC:\n-\tif local policies allow emergency sessions for any authenticated UE, the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services;\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authorization failures in this clause.\n5)\tWhen authorizing a UE to access to EPC for emergency services, the 3GPP AAA Server:\n-\tshall set the Emergency-Indication bit of the Emergency-Services IE in the answer;\n-\tshall not allow the use of non-seamless WLAN offload services.\nIn addition, if the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall also include the Emergency Info IE in the Authentication and Authorization Answer, for emergency and non-emergency Attach, if this information was received from the HSS, the user is not roaming, the TWAN indicated support of IMS Emergency sessions and the Result-Code AVP is set to either:\n-\tDIAMETER_SUCCESS or\n-\tDIAMETER_MULTI_ROUND_AUTH and TWAN-S2a-Connectivity-Indicator is set in DEA-Flags.\nOnce the Authentication and Authorization procedures successfully finish, if a domain-specific re-authentication key was requested and the use of ERP is authorized for this user based on subscription parameter, the 3GPP AAA Server which support ERP shall derive the DSRK from the EMSK and the domain name received in the request as specified in IETF RFC 6696[55] and shall include the DSRK, the EMSKname, and optionally the DSRK lifetime in the authentication and authorization response to the non-3GPP access network.\nOtherwise, when the 3GPP AAA Server does not support ERP, the domain-specific re-authentication key request is ignored if present in the authentication and authorization request.\nBased on operator policy, if the 3GPP AAA Server receives a DER command with a High-Priority-Access-Info AVP with the HPA_Configured bit set from the TWAN, the 3GPP AAA server shall treat the message with priority as specified in Annex C and Annex D.\nNOTE 5:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the network has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent messages with priority.\nBased on operator policy, the 3GPP AAA Server may include within the DEA command the MPS-Priority AVP with the MPS-EPS-Priority bit set to the TWAN if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS. The 3GPP AAA Server shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a Non-3GPP-User-Data AVP from the HSS without the MPS-Priority AVP with the MPS-EPS-Priority bit set and the last DER command received by the 3GPP AAA Server from the TWAN did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set.\nNOTE 6:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the TWAN indicates high priority access or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_11",
        "clause_5.1.2.1",
        "clause_4.1.2.1",
        "clause_9.1.2.5",
        "ts_24.302_clause_8.1.1.2",
        "clause_8.1.2.1",
        "ts_23.402_clause_4.5.7.2",
        "ts_23.003_clause_19",
        "ts_33.402_clause_13.4",
        "clause_8.1.2.3.3",
        "ts_23.402",
        "ts_24.302",
        "ts_33.402",
        "ts_24.139",
        "ts_23.139",
        "ts_23.203",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.1.3",
      "section_id": "5.1.2.1.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the non-3GPP access network is connected to a VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following additions.\nIf IMEI check is required by operator policy and the TWAN is in the VPLMN, the 3GPP AAA Proxy shall:\n-\tset the IMEI-Check-Required-In-VPLMN bit in the first Authentication and Authorization Request message sent to the 3GPP AAA Server;\n-\tupon receipt of a subsequent DER message with the IMEI-Check-Request-in-VPLMN bit set to 1 in the DER-Flags AVP,\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status towards the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tsend the result of the IMEI check to the 3GPP Server in the IMEI-Check-In- VPLMN-Result AVP.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nSee Annex A.2.3 and A.3.2.\nOn receipt of an authentication and authorization request, the 3GPP AAA Proxy\n-\tshall check the Visited-Network-Identifier AVP,\n-\tIf the AVP is not present, the 3GPP AAA Proxy shall insert it before forwarding the request to the 3GPP AAA Server.\n-\tIf the AVP is present, the 3GPP AAA Proxy may check and overwrite its value, depending on its local policy, e.g. the trusted non-3GPP access network is being operated by the VPLMN operator or by a third party.\n-\tshall check the ANID AVP. If the result of the checking shows that the included ANID value is not valid (not defined by 3GPP) or that the requesting entity is not entitled to use the received value, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and the authentication response shall be sent to the trusted non-3GPP access network.\n-\tmay take a decision about the trustworthiness of the non-3GPP access from VPLMN's point of view. If such decision is taken, it shall be based on the Access Network Identifier and optionally, on further information about the non-3GPP access network, according to the 3GPP AAA Proxy's local policies. These local policies shall reflect the security criteria described in 3GPP TS 33.402 [19], with the assumption that the PDN GW will be allocated in the VPLMN.\nNOTE 1:\tFor example, if hop-by-hop security relationship exists between the NAS and the 3GPP AAA Proxy, the 3GPP AAA Proxy may use the Origin-Host AVP to uniquely identify the NAS and the access network.\nThe decision about the trustworthiness of the non-3GPP access network is encoded to the VPLMN trust relationship indicator that is inserted to the authentication and authorization request.\nOn receipt of the first authentication and authorization request, the 3GPP AAA Proxy shall check locally configured information whether users from the HPLMN are allowed to activate a PDN connection from the non-3GPP access network via this (V)PLMN. If not, the Experimental-Result-Code shall be set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED and the authentication and authorization response shall be sent to the non-3GPP access network.\nNOTE 2:\tIt is assumed that there is a roaming agreement between the non-3GPP access network and the VPLMN.\nOn receipt of the first authentication and authorization request, a 3GPP AAA Proxy which supports ERP may check whether ERP is supported by the non-3GPP access network. If the non-3GPP access network supports ERP and there is an ER server requesting a domain-specific re-authentication key in the authentication and authorization request, the 3GPP AAA Proxy may not authorize it based on locally configured information, remove the domain-specific key request before forwarding the request. If the non-3GPP access network supports ERP and there is no ER server in the non-3GPP access network or if the ER server in the non-3GPP access network was not authorized based on locally configured information, the 3GPP AAA Proxy may act as ER server and include the domain-specific re-authentication key request into the first authentication and authorization request forwarded to the 3GPP AAA server.\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy\n-\tmay check locally configured information about using the chained S8-S2a option towards the given HPLMN. If chaining is required, the 3GPP AAA Proxy shall select a Serving GW from its network configuration database and shall include the Serving GW address in the answer.\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authentication and Authorization Successful).\n-\tmay check if ERP keying material is provided in the answer in response to the domain-specific re-authentication key requested by the 3GPP AAA Proxy acting as an ER server. If it is, the 3GPP AAA Proxy shall remove the ERP keying material from the answer forwarded to the non-3GPP access network and store the DSRK, the EMSKname and the DSRK lifetime. If there is no ERP keying material and the DEA-Flag does not indicate that ERP is supported by the 3GPP AAA Server, the 3GPP AAA Proxy shall not forward any ERP related messages to the 3GPP AAA Server.\n-\tshall forward the ERP keying material to the TWAN if received from the 3GPP AAA Server and the ER server is located in the TWAN.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_11",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.1.4",
      "section_id": "5.1.2.1.4",
      "section_title": "Trusted non-3GPP access network Detailed Behaviour",
      "content": "The trusted non-3GPP access network shall initiate the Trusted non-3GPP Access Authentication and Authorization procedure when the user attaches to the access network. During the authentication, it shall act as a pass-through EAP authenticator.\nIf the IMEI-Check-Request-In-VPLMN bit is set in the DEA-Flags AVP of the DEA message, the TWAN shall request the 3GPP AAA Proxy to check the IMEI, by setting the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP and including the IMEI(SV) in the DER message. See Annex A.2.3 and A.3.2.\nIf PMIPv6, GTPv2 or MIPv4 FACoA is used, at successful completion of the procedure, the trusted non-3GPP access network shall store the non-3GPP user data received from the 3GPP AAA Server. The trusted non-3GPP access network shall utilize these data\n-\tTo authorize the APNs received in PDN connection creation request from the UE;\n-\tTo authorize the requested home address types: IPv4 home address and/or IPv6 home network prefix;\n-\tTo check if the UE requested APN is authorized as such or based on the wildcard APN.\nNOTE 1:\tThe user will be allowed to create PDN connections only to the subscribed APNs and use the address types that are allowed by the subscribed PDN types.\nIf DSMIPv6 is used and if the trusted non-3GPP access network has received the PGW identity in form of the FQDN from the 3GPP AAA Server, then the trusted non-3GPP access network may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf MIPv4 FACoA is used and if the non-3GPP access network has received FA-RK-SPI and FA-RK from the 3GPP AAA Server , the trusted non-3GPPaccess network will use FA-RK key and FA-RK-SPI to further derive MN-FA shared key and MN-FA-SPI, as defined in 3GPP TS 33.402 [19]. These are used to process the MN-FA Authentication Extension in the RRQ/RRP messages if the extension is present.\nIf the subscriber is not roaming and the SIPTO-Permission information for an APN is present, the HSGW shall allow SIPTO for that APN only if the SIPTO-Permission information indicates so. If the subscriber is not roaming and the SIPTO-Permission information for an APN is not present, the HSGW may allow SIPTO for that APN. If the subscriber is roaming and the SIPTO-Permission information for an APN is present, the HSGW shall allow SIPTO for that APN only if the SIPTO-Permission information indicates so and the VPLMN Dynamic Address is allowed and the HSGW selects a PDN GW in the VPLMN. For the requested APN allowed for SIPTO, the trusted non-3GPP access network may use the 3GPP DNS mechanism to select a PGW which is close to the HSGW. Detailed behaviour is specified in 3GPP2 X.S0057 [25], 3GPP TS 23.402 [3] and 3GPP TS 29.303 [34].\nFor optimized handover of an emergency session from E-UTRAN to an S2a based cdma2000® HRPD access network, if the trusted non-3GPP access network supports Emergency services for users in limited service state, then the trusted non-3GPP access network shall skip the authentication procedure (for users without an IMSI or with an IMSI marked as unauthenticated); or if the trusted non-3GPP access network accepts that the authentication may fail (for users with an IMSI), it shall continue with the procedure. For these cases, the trusted non-3GPP access network shall release any non-emergency PDN connections.\nThe TWAN decides the S2a protocol variant to use if access to EPC is authorized and the TWAN decides to establish S2a. The TWAN may be configured with the S2a protocol variant(s) on a per PLMN granularity, or may retrieve information regarding the S2a protocol variants supported by the PDN GW (PMIPv6 or/and GTPv2) from the Domain Name Service Function as described in 3GPP TS 29.303[34]. For static PDN GW assignment, in order to determine the PLMN of the PDN GW, the TWAN may use the Visited Network Identifier, if received from the 3GPP AAA Server, or the FQDN of the PDN GW, if included in the MIP6-Agent-Info AVP of the APN in use; if none of them are available, it may use the PLMN where the 3GPP AAA Server is located. If the TWAN supports Dedicated Core Networks and receives the UE-Usage-Type from the 3GPP AAA Server, the TWAN shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34].\nFor trusted WLAN access, the TWAN should attempt the establishment of the S2a connectivity if the 3GPP AAA Server authorizes the SCM to be used for EPC access and the 3GPP AAA Server answers the authentication request with a result code of DIAMETER_MULTI_ROUND_AUTH and with the TWAN-S2a-Connectivity-Indicator bit set to 1 in the DEA-Flags AVP. After completing the S2a network connectivity actions, the TWAN shall re-issue a new DER command including the last EAP-Payload sent in a former request, and setting the TWAN-S2a-Connectivity-Indicator bit to 1 in the DER-Flags AVP. If the requested connectivity has been granted, the TWAN shall also provide the 3GPP AAA Server with the connectivity parameters provided to the UE; otherwise, the TWAN should also provide a cause indicating why the requested connectivity could not be granted and may provide a Session Management back-off timer to be sent to the UE to instruct the UE to not request new PDN connectivity to the same APN for the indicated time.\nIf GTPv2 is used on S2a and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user.\nIf the trusted non-3GPP access networkdetermines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the trusted non-3GPP access network receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.\nIf the TWAN supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the TWAN shall:\n-\tset the Emergency-Capability-Indication bit in the DER-Flags AVP to indicate support of IMS emergency sessions to the 3GPP AAA Server (to be forwarded to the UE via EAP-AKA' signalling).\n-\tinterpret the receipt of an Emergency NAI for Limited Service State or an IMSI-based Emergency NAI from the UE, or the Emergency-Services AVP from the 3GPP AAA Server, with the Emergency-Indication bit set, as an indication that the UE requests to access the EPC for emergency services;\n-\tgive preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload;\n-\tuse its Emergency Configuration Data to determine the APN to be associated with the emergency PDN connection and possibly the PGW to use;\n-\tuse the PGW identified in the Emergency PGW Identity IE, during a handover of an emergency PDN connection to a trusted WLAN access, if this information is received from the 3GPP AAA Server, the user is a non-roaming authenticated user and the TWAN is configured to use a dynamic PGW for emergency services for such users;\n-\tproceed during an Emergency Attach for a UE without a UICC or with an authenticated IMSI as specified above with the following modifications, if local policies (related with local regulations) in the TWAN allows unauthenticated emergency sessions:\n-\tif the UE is UICC-less, the User Identity IE in the Authentication and Authorization Request shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\tif the Permanent User Identity IE in the answer contains an IMEI based NAI but the User Identity IE in the request did not contain an IMEI based NAI, the TWAN shall determine that the IMSI was not authenticated and proceed accordingly with the setup of the Emergency PDN connection over S2b (see 3GPP TS 29.274 [38]).\nBased on operator policy, when sending a DER command, the TWAN shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set if the TWAN had received an indication from the UE that the UE has access priority in an EAP-Response/Identity message as described in 3GPP TS 24.302 [26]. The TWAN shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nThe TWAN shall remove the \"#hpa\" or \"#mps\" decoration from the username part of the NAI, if present, before forwarding the EAP-Response/Identity.\nNOTE 2:\tAlternatively, the TWAN can give priority to this UE after the network has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the TWAN handles all subsequent messages with priority.\nBased on operator policy, upon receiving a DEA command marked with a success code and with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the TWAN shall treat the UE with priority, e.g., as defined in Annex B, Annex C and Annex D. The TWAN shall discontinue priority treatment for the UE if the TWAN receives a DEA command without an MPS-Priority AVP with the MPS-EPS-Priority bit set and the last EAP‑Response/Identity message as described in 3GPP TS 24.302 [26] received by the TWAN did not contain an indication from the UE that the UE has access priority.\nNOTE 3:\tThe TWAN treats the UE with priority if either the indication that the UE has access priority in an EAP‑Response/Identity message or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.303_clause_5.8",
        "ts_23.402_clause_4.5.7.2",
        "ts_23.003_clause_19",
        "clause_8.1.2.3.3",
        "ts_29.303",
        "ts_33.402",
        "ts_23.402",
        "ts_29.274",
        "ts_23.003",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.2.1",
      "section_id": "5.1.2.2.1",
      "section_title": "General",
      "content": "This procedure is used between the 3GPP AAA/HSS and the trusted non-3GPP access network to instruct the non-3GPP access network to detach a specific user from the access network. The procedure is based on Diameter session abort messages.\nDiameter usage over the STa interface:\n-\tThis procedure is mapped to the Diameter command codes Diameter-Abort-Session-Request (ASR), Diameter‑Abort-Session-Answer (ASA), Diameter-Session-Termination-Request (STR) and Diameter-Session-Termination-Answer (STA) specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.2.1/1 and 5.1.2.2.1/2.\n-\tThe STa application id value of 16777250 shall be used as the Application Id in ASR/ASA/STR/STA commands.\nTable 5.1.2.2.1/1: Information Elements passed in ASR message\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15], and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuth-Session-State\nAuth-Session-State\nO\nIf present this information element shall indicate to the Non-3GPP access network whether the 3GPP AAA Server requires an STR message.\nTable 5.1.2.2.1/2: Information Elements passed in ASA message\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult-Code\nResult-Code\nM\nThis IE shall indicate the result of the operation.\nTable 5.1.2.2.1/3: Information Elements passed in STR message\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nTermination-Cause\nTermination-Cause\nM\nThis information element shall contain the reason why the session was terminated. It shall be set to \"DIAMETER_ADMINISTRATIVE\" to indicate that the session was terminated in response to an ASR message.\nTable 5.1.2.2.1/4: Information Elements passed in STA message\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult-Code\nResult-Code\nM\nThis IE shall contain the result of the operation.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_5.1.2.2.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.2.2",
      "section_id": "5.1.2.2.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall make use of this procedure to instruct the Non-3GPP access network to detach a specific user from the access network.\nIn the DSMIPv6 case, the 3GPP AAA Server shall initiate first the detach procedure over the S6b reference point towards the PDN GW. When this process has finalized, the 3GPP AAA Server can initiate the detach procedure of the UE from the non-3GPP access network.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the Non-3GPP access network. If it does require a STR from the Non-3GPP access network, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nOn receipt of the ASR command, the Non-3GPP access network shall check if the user is known in the Non-3GPP access network. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\nIf the user is known, the Non-3GPP access network shall perform the disconnection of all the PDN connections active for this user and remove any stored user information, except for emergency PDN connections which shall remain active, if the trusted Non-3GPP access supports Emergency services for users in limited service state.\nThe Non-3GPP access network shall set the Result-Code to DIAMETER_SUCCESS and send back the ASA command to the 3GPP AAA Server, which shall update the status of the subscriber on the detached access network.\nIf required by the 3GPP AAA Server, the Non-3GPP access network shall send an STR with the Termination-Cause set to DIAMETER_ADMINISTRATIVE. The 3GPP AAA Server shall set the Result-Code to DIAMETER_SUCCESS and return the STA command to the Non-3GPP access network.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.2.3",
      "section_id": "5.1.2.2.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "When the 3GPP AAA Proxy receives the ASR from the 3GPP AAA Server it shall route the request to the non-3GPP access network.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State AVP in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the non-3GPP access network onto the 3GPP AAA Server and shall return an STA command to the non-3GPP access network with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the ASA message with Diameter Result Code set to DIAMETER_SUCCESS, the 3GPP AAA Proxy shall route the successful response to the 3GPP AAA Server and shall release the resources associated with the session.\nWhen the 3GPP AAA Proxy receives the STR from the Non-3GPP access network, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the Non-3GPP access network.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.3.1",
      "section_id": "5.1.2.3.1",
      "section_title": "General",
      "content": "The STa Re-Authorization procedure shall be used between the 3GPP AAA Server and the trusted non-3GPP access network for enabling:\n-\tthe 3GPP AAA Server to modify the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example, removal of a specific APN associated with the subscriber, or change of the identity of a dynamically allocated PDN GW, or change of the identity of a dynamically allocated PDN GW for emergency services, see clause 8.1.2.3). In this case, this procedure is performed in two steps:\n-\tThe 3GPP AAA server shall issue an STa Re-Auth request towards the trusted non-3GPP access network. Upon receipt of such a request, the trusted non-3GPP access network shall respond to the request and shall indicate the disposition of the request. This procedure is mapped to the Diameter command Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.3.1/1 and 5.1.2.3.1/2.\n-\tUpon receiving the STa Re-Auth request, the non-3GPP access network shall immediately invoke the STa access authorization procedure, based on the reuse of the Diameter command codes AA-Request and AA-Answer commands specified in IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\n-\tthe trusted non-3GPP access network to retrieve the subscriber profile from the HSS. This procedure may be initiated at any time by the trusted non-3GPP access network for check if there is any modification in the user authorization parameters previously provided by the 3GPP AAA Server. In this one-step procedure, the trusted non-3GPP access network shall invoke the STa access authorization procedure, based on the reuse of the Diameter commands AA-Request and AA-Answer commands IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\nAfter receiving the authorization answer, the trusted non-3GPP access network will release the active PDN connections, for which the authorization has been revoked. If the authorization was rejected by the 3GPP AAA server (e.g. because the user's subscription for non-3GPP accesses has been terminated), the non-3GPP access network shall detach the user from the non-3GPP access network and release all resources. If an emergency PDN connection is active and the trusted non-3GPP access supports emergency services for users in limited service state, the non-3GPP access network shall keep the user attached in the non-3GPP access and the emergency PDN connection active. The non-emergency resources shall be released.\nThe STa Re-Authentication procedure shall be used between the 3GPP AAA Server and the trusted non-3GPP access network for re-authenticating the user. This procedure may be initiated at any time by the 3GPP AAA Server based on HPLMN operator policies configured in the 3GPP AAA server. This procedure is performed in two steps:\n-\tThe 3GPP AAA server issues an STa Re-Auth request towards the trusted non-3GPP access. Upon receipt of such a request, the trusted non-3GPP access network shall respond to the request and indicate the disposition of the request. This procedure is mapped to the Diameter command Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages are shown in tables 5.1.2.3.1/1 and 5.1.2.3.1/2.\n-\tUpon receiving the STa Re-Auth request, the trusted non-3GPP access network shall immediately invoke the STa Access Authentication and Authorization procedure, based on the Re-Auth Request Type provided by the 3GPP AAA server. This procedure is mapped to the Diameter command codes based on the reuse of the Diameter commands Diameter-EAP-Request and Diameter-EAP-Answer specified in IETF RFC 4072 [5]. Information element contents for these messages are shown in tables 5.1.2.3.1/5 and 5.1.2.3.1/6.\nIf the re-authentication of the user is not successful, the trusted non-3GPP access network will release all the active PDN connections of the user, except for emergency PDN connections which shall remain active if the trusted non-3GPP access network supports Emergency services for users in limited service state. After a successful authentication and authorization procedure, the trusted non-3GPP access network shall release the active PDN connections for which the authorization has been revoked.\nTable 5.1.2.3.1/1: STa Re-Auth request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRe-Auth Request Type\nRe-Auth–Request-Type\nM\nT This IE shall define whether the user is to be authorized only or authenticated and authorized. In this case, the following values shall be used:\nAUTHORIZE_AUTHENTICATE if the re-authentication of the user is requested;\nAUTHORIZE_ONLY if the update of the previously provided user authorization parameters is requested.\nRouting Information\nDestination-Host\nM\nThis information element shall be obtained from the Origin-Host AVP, which was included in a previous command received from the trusted non-3GPP access.\nTable 5.1.2.3.1/2: STa Re-Auth response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nTable 5.1.2.3.1/3: STa Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14] If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRequest-Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. In this case, it shall have the value:\nAUTHORIZE_ONLY\nMobility Capabilities\nMIP6-Feature-Vector\nC\nThis information element shall contain the mobility capabilities of the non-3GPP access network.\nThis AVP shall be included only if optimized idle mode mobility from E-UTRAN to HRPD access is executed. When included, the PMIP_SUPPORTED and the OPTIMIZED_IDLE_MODE_MOBILITY flags shall be set.\nRouting Information\nDestination-Host\nM\nThe 3GPP AAA Server name shall be obtained from the Origin-Host AVP of a previously received message.\nAccess Network Information\nAccess-Network-Info\nO\nIf present, this IE shall contain the identity and location information of the access network where the UE is attached.\nLocal Time Zone\nLocal-Time-Zone\nO\nIf present, this IE shall contain the time zone of the location in the access network where the UE is attached.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nBased on operator policy, this information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 5.1.2.3.1/4: STa Authorization response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nRegistration Result\nResult Code/ Experimental Result Code\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP\nRequest-Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_ONLY. See IETF RFC 4072 [5].\nSession Alive Time\nSession-Timeout\nO\nThis AVP may be present if the Result-Code AVP is set to DIAMETER _SUCCESS; if present, it shall contain the maximum number of seconds the user session is allowed to remain active. This AVP is defined in IETF RFC 6733 [58].\nAccounting Interim Interval\nAcct-Interim-Interval\nO\nIf present, this IE shall contain the Charging duration.\nDefault APN\nContext-Identifier\nC\nThis AVP shall indicate the default APN for the user. It shall only be included if NBM is authorized for use, the Emergency-Indication AVP was not present in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN-OI replacement\nAPN-OI-Replacement\nC\nThis AVP shall indicate the domain name to replace the APN-OI in the non-roaming case or in the home routed roaming case when constructing the PDN GW FQDN upon which it needs to perform a DNS resolution. See 3GPP TS 23.003 [3]. It shall only be included if NBM is authorized for use, the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nWhen NBM is authorized for use, this AVP shall contain the default APN, the list of authorized APNs, user profile information and PDN GW information.\nWhen local IP address assignment is used (for HBM), this AVP shall only be present if DHCP based Home Agent discovery is used and contain the Home Agent Information for discovery purposes.\nThe trusted Non-3GPP access network knows if NBM is authorized for use or if a local IP address (for HBM) is assigned based on the flags in the MIP6-Feature-Vector received during the STa access authentication and authorization procedure.\nAPN-Configuration is a grouped AVP, defined in 3GPP TS 29.272 [29]. When NBM is authorized for use, the following information elements per APN may be included:\n- APN\n- APN-AMBR\n- Authorized 3GPP QoS profile\n- Statically allocated User IP Address (IPv4 and/or IPv6)\n- Allowed PDN types (IPv4, IPv6, IPv4v6, IPv4_OR_IPv6)\n- PDN GW identity\n- PDN GW allocation type\n- VPLMN Dynamic Address Allowed\n- Visited Network Identifier (see clause 5.1.2.1.4)\nWhen DSMIPv6 with HA discovery based on DHCPv6 is used, the following information elements per Home Agent may be included:\n- HA-APN (Home Agent APN as defined in 3GPP TS 23.003 [14])\n- Authorized 3GPP QoS profile\n- PDN GW identity\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nIf present, this information element shall contain the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\nUE AMBR\nAMBR\nC\nThis Information Element shall contain the modified UE AMBR of the user. It shall be present if the Result-Code AVP is set to DIAMETER_SUCCESS and ANID is \"HRPD\".\nMobility Capabilities\nMIP6-Feature-Vector\nC\nThis information element shall only be sent if it has been received in the corresponding authorization request and the Result-Code AVP is set to DIAMETER_SUCCESS.\nWhen included, the PMIP_SUPPORTED and the OPTIMIZED_IDLE_MODE_MOBILITY flags shall be set.\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is used to download the trace activation from the HSS to the trusted non-3GPP access network.\nOnly the Trace-Data AVP shall be included to the Trace-Info AVP and\nshall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth-List\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List, for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nMSISDN\nSubscription-ID\nC\nThis AVP shall contain the MSISDN of the UE and shall be sent if it is available and the Result-Code AVP is set to DIAMETER_SUCCESS.\nEmergency Info\nEmergency-Info\nC\nThis IE shall contain the identity of the PDN GW dynamically allocated for emergency services. It shall be present for a non-roaming authenticated user, if this information was received from the HSS, the TWAN indicated support of IMS Emergency Sessions and the Result-Code AVP is set to DIAMETER_SUCCESS.\nUE Usage Type\nUE-Usage-Type\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the UE Usage Type of the subscriber.\nMPS Priority\nMPS-Priority\nC\nBased on operator policy, this information element shall be sent to the non-3GPP WLAN access if the UE has an MPS subscription in the HSS.\nTable 5.1.2.3.1/5: STa Access Authentication and Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and it shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP-payload\nM\nThis IE shall contain the Encapsulated EAP payload used for the UE – 3GPP AAA Server mutual authentication\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. In this case, it shall have the value AUTHORIZE_AUTHENTICATE.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nBased on operator policy, this information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 5.1.2.3.1/6: Trusted non-3GPP Access Authentication and Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and it shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes, if it contains a NAI other than an Emergency NAI for Limited Service State.\nEAP payload\nEAP payload\nM\nThis IE shall contain the Encapsulated EAP payload used for UE- 3GPP AAA Server mutual authentication.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code /\nExperimental Result Code\nM\nThis IE shall contain the result of the operation. Result codes are as in Diameter base protocol (see IETF RFC 6733 [58]). Experimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSession Alive Time\nSession-Timeout\nO\nThis AVP may be present if the Result-Code AVP is set to DIAMETER _SUCCESS; if present, it contains the maximum number of seconds the user session is allowed to remain active. This AVP is defined in IETF RFC 6733 [58].\nAccounting Interim Interval\nAccounting Interim-Interval\nO\nIf present, this IE shall contain the Charging duration.\nPairwise Master Key\nEAP-Master-Session-Key\nC\nThis IE shall be sent if Result-Code AVP is set to DIAMETER_SUCCESS.\nDefault APN\nContext-Identifier\nC\nThis AVP shall indicate the default APN for the user. It shall only be included if NBM is authorized for use, the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN-OI replacement\nAPN-OI-Replacement\nC\nThis AVP shall indicate the domain name to replace the APN-OI in the non-roaming case or in the home routed roaming case when constructing the PDN GW FQDN upon which it needs to perform a DNS resolution. See 3GPP TS 23.003 [3]. It shall only be included if NBM is authorized for use, the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the non-3GPP access network was decided to be trusted, the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Answer and the Result-Code AVP is set to DIAMETER_SUCCESS.\nWhen NBM is authorized for use this AVP shall contain the default APN, the list of authorized APNs, user profile information and PDN GW information.\nWhen local IP address assignment is used (for HBM), this AVP shall only be present if DHCP based Home Agent discovery is used and contain the Home Agent Information for discovery purposes.\nThe trusted non-3GPP access network knows if NBM is authorized for use or if a local IP address (for HBM) is assigned based on the flags in the MIP6-Feature-Vector.\nAPN-Configuration is a grouped AVP, defined in 3GPP TS 29.272 [29]. When NBM is authorized for use, the following information elements per APN may be included:\n- APN\n- APN-AMBR\n- Authorized 3GPP QoS profile\n- User IP Address (IPv4 and/or IPv6)\n- Allowed PDN types (IPv4, IPv6, IPv4v6, IPv4_OR_IPv6)\n- PDN GW identity\n- PDN GW allocation type\n- VPLMN Dynamic Address Allowed\n- APN-AMBR\n- Visited Network Identifier (see clause 5.1.2.1.4)\nWhen DSMIPv6 with HA discovery based on DHCPv6 is used, the following information elements per Home Agent may be included:\n- HA-APN (Home Agent APN as defined in 3GPP TS 23.003 [14])\n- Authorized 3GPP QoS profile\n- PDN GW identity\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nIf present, this information element shall contain the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\nUE AMBR\nAMBR\nC\nThis Information Element shall contain the UE AMBR of the user. It shall be present only if the non-3GPP access network was decided to be trusted, the Result-Code AVP is set to DIAMETER_SUCCESS and ANID is \"HRPD\".\nFA-RK\nMIP-FA-RK\nC\nThis AVP shall be present if MIPv4 is used, MN-FA authentication extension is supported and the Result-Code AVP is set to DIAMETER_SUCCESS.\nFA-RK-SPI\nMIP-FA-RK-SPI\nC\nThis AVP shall be present if MIP-FA-RK is present\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is used to download the trace activation from the HSS to the trusted non-3GPP access network.\nOnly the Trace-Data AVP shall be included to the Trace-Info AVP and\nshall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth-List\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List, for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nMSISDN\nSubscription-ID\nC\nThis AVP shall contain the MSISDN of the UE and shall be sent if it is available and the Result-Code AVP is set to DIAMETER_SUCCESS.\nWLCP Key\nWLCP-Key\nC\nThis IE shall be present if the Result-Code AVP is set to DIAMETER_SUCCESS and the TWAN Connection Mode previously selected is MCM. If present, it shall contain the key for protecting WLCP signalling (see 3GPP TS 33.402 [19]).\nEmergency Info\nEmergency-Info\nC\nThis IE shall contain the identity of the PDN GW dynamically allocated for emergency services. It shall be present for a non-roaming authenticated user, if this information was received from the HSS, the TWAN indicated support of IMS Emergency Sessions and the Result-Code AVP is set to DIAMETER_SUCCESS.\nUE Usage Type\nUE-Usage-Type\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the UE Usage Type of the subscriber.\nMPS Priority\nMPS-Priority\nC\nBased on operator policy, this information element shall be sent to the non-3GPP access network if the UE has an MPS subscription in the HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_8.1.2.3",
        "ts_23.003_clause_19",
        "clause_5.1.2.1.4",
        "table_5.1.2.3.1",
        "ts_24.302_table_5.1.2.3.1",
        "ts_23.003",
        "ts_24.302",
        "ts_29.272",
        "ts_29.061",
        "ts_32.422",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.3.2",
      "section_id": "5.1.2.3.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "Handling of Re-Auth Request:\nThe 3GPP AAA Server shall make use of this procedure to indicate the following:\n-\tIf the relevant service authorization information shall be updated in the trusted non-3GPP access network, the Re‑Auth‑Request‑Type shall be set to AUTHORIZE_ONLY. This procedure may be triggered by the HSS sending a subscription data update (refer to clause 8.1.2.3) or by local policies, e.g. periodic re-authorization configured by the operator. As for the STa reference point, only a single Diameter authorization session is used for a user, this procedure is initiated for all the PDN connections of this user, i.e. a single instance of Re-authorization Request shall be used per user.\n-\tIf the re-authentication and re-authorization of the user shall be executed, the Re‑Auth‑Request‑Type shall be set to AUTHORIZE_AUTHENTICATE. This procedure may be triggered e.g. by the expiration of a timer started at the successful completion of the last (re-)authentication of the user, depending on the local policies configured in the 3GPP AAA Server.\nHandling of Authorization Request:\nThe 3GPP AAA Server shall check that the user exists in the 3GPP AAA Server. The check shall be based on Diameter Session-Id. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN. If the user exists, the 3GPP AAA Server shall perform the authorization checking described in clause 5.1.2.1.2.\nIf the Authorization request contained the MIP6-Feature-Vector with the OPTIMIZED_IDLE_MODE_MOBILITY flag set, the 3GPP AAA server shall request the user data from the HSS, in order to retrieve up-to-date PDN GW information.\nHandling of Authentication and Authorization Requests:\nThe 3GPP AAA Server shall execute the re-authentication of the user, using a full authentication or fast re-authentication, as described in 3GPP TS 33.402 [19], clause 6.2 and 6.3. If full authentication is executed and there are no valid authentication vectors for the given non-3GPP access network available in the 3GPP AAA Server, it shall fetch authentication vectors from the HSS. A combined authentication and authorization shall be executed, with reduced message content described in Tables 5.1.2.3.1/5 and 5.1.2.3.1/6. The QoS-Capability, Access Network Identity, Access Type, Visited Network Identifier, Terminal Information elements received during the initial authentication and authorization procedure as well as the trustworthiness of the non-3GPP AN and the IP mobility mode selected during that procedure shall be considered as valid. If re-authentication of the user is successful and MIPv4 FACoA mode is used the 3GPP AAA Server shall create the MIPv4 FACoA security parameters as defined in 3GPP TS 33.402 [19].\nIf the re-authentication of the user is unsuccessful, the 3GPP AAA Server shall:\n-\tTerminate all S6b authorization sessions connected to the user, as described in clause 9.1.2.4\n-\tRemove all APN-PDN GW bindings from the HSS, as described in clauses 8.1.2.2.2.1 and 8.1.2.2.2.2.\n-\tDe-register the user from the HSS, as described in clauses 8.1.2.2.2.1 and 8.1.2.2.2.2. Depending on the cause of the re-authentication being unsuccessful, the Server Assignment Type shall be set to AUTHENTICATION_FAILURE or AUTHENTICATION_TIMEOUT.\n-\tRelease all resources connected to the user.\nBased on operator policy, if the 3GPP AAA Server receives a DER or an AAR command with a High-Priority-Access-Info AVP with the HPA_Configured bit set from the TWAN, the 3GPP AAA server shall treat the command with priority as specified in Annex C and Annex D.\nNOTE 1:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the network has successfully re-authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent commands with priority.\nBased on operator policy, the 3GPP AAA Server may include within the DEA or AAA command the MPS-Priority AVP with the MPS-EPS-Priority bit set, to the TWAN if the 3GPP AAA Server has received an MPS-Priority AVP with the MPS-EPS-Priority bit set from the HSS. The 3GPP AAA Server shall treat the command and all subsequent commands (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nThe 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a Non-3GPP-User-Data AVP from the HSS without the MPS-Priority AVP with the MPS-EPS-Priority bit set and the last DER or AAR command received by the 3GPP AAA Server from the TWAN did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set.\nNOTE 2:\tThe 3GPP AAA Server treats the UE with priority if either the DER or AAR command from the TWAN indicates high priority access or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2.3",
        "clause_5.1.2.1.2",
        "ts_33.402_clause_6.2",
        "clause_9.1.2.4",
        "clause_8.1.2.3.3",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.3.3",
      "section_id": "5.1.2.3.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the Non-3GPP access network is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following additions.\nWhen forwarding the authorization answer or the authentication and authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authentication and Authorization Successful).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.3.4",
      "section_id": "5.1.2.3.4",
      "section_title": "Trusted Non-3GPP Access Network Detailed Behaviour",
      "content": "Upon receiving the re-auth request, the trusted non-3GPP access network shall perform the following checks and if an error is detected, the non-3GPP access network shall stop processing the request and return the corresponding error code.\nCheck the Re-Auth–Request-Type AVP:\n1)\tIf it indicates AUTHENTICATE_ONLY, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\n2)\tIf it indicates AUTHORIZE_AUTHENTICATE, the authentication and authorization of the user is initiated, as defined in 3GPP TS 33.402, with the Diameter message contents described by Tables 5.1.2.3.1/5 and 5.1.2.3.1/6.\n3)\tIf it indicates AUTHORIZE_ONLY, the non-3GPP access network shall just perform an authorization procedure as described by Tables 5.1.2.3.1/3 and 5.1.2.3.1/4.\nAfter successful authorization or authentication and authorization procedure, the trusted non-3GPP access network shall overwrite, for the subscriber identity indicated in the request and the received session, the current authorization information with the information received from the 3GPP AAA Server.\nFor the TWAN access, if the TWAN receives the PDN GW Identity from 3GPP AAA Server which is different from the currently selected PDN GW for the same APN, the TWAN shall not tear down the existing PDN connection.\nIf the TWAN supports Dedicated Core Networks and receives the UE-Usage-Type from the 3GPP AAA Server, the TWAN shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34] for new PDN connections.\nThe release of a PDN connection shall be initiated if the user's subscription for the APN belonging to an active PDN connection has been terminated.\nIf the authorization or authentication and authorization procedure was unsuccessful, the non-3GPP access network shall detach the user from the non-3GPP access and release all resources. If the trusted non-3GPP access supports emergency services for users in limited service state, and there is an emergency PDN connection active for such user, the non-3GPP access network shall keep the user attached in the non-3GPP access and the emergency PDN connection active. The non-emergency resources shall be released.\nThe trusted Non-3GPP access network shall initiate the re-authorization of the user in a one-step procedure (i.e. without receiving a re-authorization request from the AAA Server) if the PDN GW information needs to be updated for optimized idle mode mobility from E-UTRAN to HRPD access.\nIf GTPv2 is used on S2a and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user. If the Trace-Info AVP including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the trusted non-3GPP access network shall send a GTPv2 Trace Session Deactivation message to the PGW to stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor the TWAN access, the TWAN shall send the identification, location information of the Access Point where the UE is attached, and the local time zone of the UE, in the authorization request towards the 3GPP AAA Server that follows a re-authorization request issued by the 3GPP AAA Server to the TWAN.\nBased on operator policy, when sending a DER or an AAR command, the TWAN shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set if the TWAN had received an indication from the UE that the UE has access priority in an EAP-Response/Identity message as described in 3GPP TS 24.302 [26]. The TWAN shall treat the command and all subsequent commands (if re-authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nNOTE 1:\tAlternatively, the TWAN can give priority to this UE after the network has successfully re-authenticated the UE as described in clause 8.1.2.3.3, at which time the TWAN handles all subsequent commands with priority.\nBased on operator policy, upon receiving a DEA or an AAA command marked with a success code and with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the TWAN shall treat the UE with priority, e.g., as defined in Annex B, Annex C and Annex D.\nThe TWAN shall discontinue priority treatment for the UE if the TWAN receives a DEA or an AAA command without the MPS-Priority AVP with the MPS-EPS-Priority bit set and the last EAP‑Response/Identity message from the UE did not contain an indication from the UE that the UE has access priority as described in 3GPP TS 24.302 [26].\nNOTE 2:\tThe TWAN treats the UE with priority if either the indication that the UE has access priority in an EAP‑Response/Identity message or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.303_clause_5.8",
        "clause_8.1.2.3.3",
        "ts_33.402",
        "ts_29.303",
        "ts_29.274",
        "ts_32.422",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.4.1",
      "section_id": "5.1.2.4.1",
      "section_title": "General",
      "content": "The STa reference point allows the non-3GPP access network to inform the 3GPP AAA server that the session resources of the non-3GPP access network assigned to a given user are being released.\nThe procedure shall be initiated by the non-3GPP access network and removes non-3GPP access information from the 3GPP AAA Server. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nTable 5.1.2.4.1/1: STa Session Termination Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user in NAI format as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nTermination Cause\nTermination-Cause\nM\nThis IE shall contain the reason for the disconnection.\nTable 5.1.2.4.1/2: STa Session Termination Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors as defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nExperimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_5.1.2.4.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.4.2",
      "section_id": "5.1.2.4.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "Upon reception of the Session Termination Request message from the non-3GPP access network, the 3GPP AAA Server shall check that there is an ongoing session associated to the two parameters received (Session-Id and User-Name).\nIf an active session is found and it belongs to the user identified by the User-Name parameter, the 3GPP AAA Server shall deregister itself as the managing 3GPP AAA Server for the subscriber following the procedures listed in 8.1.2.2.2. In case of a deregistration success, the 3GPP AAA Server shall release the session resources associated to the specified session and a Session Termination Response shall be sent to the non-3GPP access network, indicating DIAMETER_SUCCESS. If deregistration from the HSS fails, the 3GPP AAA Server shall return a Session-Termination Response with the Diameter Error DIAMETER_UNABLE_TO_COMPLY.\nOtherwise, the 3GPP AAA Server returns a Session Termination Response with the Diameter Error DIAMETER_UNKNOWN_SESSION_ID",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.4.3",
      "section_id": "5.1.2.4.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the non-3GPP access network is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the non-3GPP access network, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the non-3GPP access network and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.5.1",
      "section_id": "5.1.2.5.1",
      "section_title": "General",
      "content": "The STa reference point allows the non-3GPP access network to perform re-authentication using ERP.\nERP allows the UE and the ER server to mutually verify proof of possession of key material derived from a previous successful EAP authentication and to establish a security association between the UE and the non-3GPP access network.\nWhen this procedure is used, the ER server is collocated either with a TWAP or the 3GPP AAA Proxy or the 3GPP AAA Server. When the ER is located in the TWAP, ERP re-authentication procedures are out of the scope of this specification.\nWhen ERP is used, the ERP re-authentication procedure shall be mapped to the Diameter-EAP-Request and Diameter-EAP-Answer command codes specified in IETF RFC 4072 [5].\nTable 5.1.2.5.1/1: STa ERP Re-authentication Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nKeyName-NAI\nUser-Name\nM\nThis information element shall contain the KeyName-NAI (as defined in clause 19.3.8 of 3GPP TS 23.003 [14]) in the context of EAP re-authentication using ERP as described in IETF RFC 6696 [55] and 3GPP TS 33.402 [19].\nEAP-Initiate\nEAP-payload\nM\nThis IE shall contain the EAP-Initiate/Re-auth message used for the UE – ER Server mutual authentication.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE defines whether the user is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nDER-Flags\nDER-Flags\nM\nThis Information Element contains a bit mask. See clause 5.2.3.20.\nTable 5.1.2.5.1/2: STa ERP Re-authentication Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nKeyName-NAI\nUser-Name\nM\nThis information element shall contain the KeyName-NAI (as defined in clause 19.3.8 of 3GPP TS 23.003 [14]) in the context of EAP re-authentication using ERP as described in IETF RFC 6696 [55] and 3GPP TS 33.402 [19].\nEAP-Finish\nEAP payload\nO\nIf present, this IE shall contain the EAP-Finish as described in IETF RFC 6942 [57].\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code /\nExperimental Result Code\nM\nThis IE shall contain the result of the operation. Result codes are as in Diameter Base Protocol (IETF RFC 3588 [7]). Experimental-Result AVP shall be used for STa errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nERP Keying Material\nKey\nC\nThis IE shall be present if the ERP re-authentication is successful. In that case, this IE shall contain the Re-authentication MSK (rMSK) derived by ERP and may contain the rMSK lifetime.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19.3.8",
        "clause_5.2.3.20",
        "table_5.1.2.5.1",
        "ts_23.003",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.1.2.5.2",
      "section_id": "5.1.2.5.2",
      "section_title": "ER server located in 3GPP AAA Proxy or 3GPP AAA Server Detailed Behaviour",
      "content": "Upon reception of the ERP re-authentication request from the non-3GPP access network, the 3GPP AAA Proxy or the 3GPP AAA Server acting as ER server shall search in its local database for a valid, unexpired root key matching the keyName part of the KeyName-NAI.\nIf the root key is not found, the 3GPP AAA Proxy or 3GPP AAA Server shall set the Result-Code to DIAMETER_UNABLE_TO_COMPLY and the answer shall include an EAP-Payload AVP encapsulating an EAP Failure indicating that the ERP re-authentication has failed.\nIf such root key is found, the 3GPP AAA Server shall generate the ERP keying material as described in IETF RFC 6696 [55], shall include the requested ERP keying material in the answer and the result code shall be set to DIAMETER_SUCCESS.\nNOTE:\tOnly the ERP Implicit Bootstrapping mode defined in IETF RFC 6696 [55] is supported in this release.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.1.2.5.3",
      "section_id": "5.1.2.5.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "Upon reception of the ERP authentication request from the non-3GPP access network, the 3GPP AAA Proxy shall check if the realm part of the KeyName-NAI is its own domain name. If not, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nIf the keyName part of the KeyName-NAI is its own domain name, the 3GPP AAA Proxy shall behave as described in clause 5.1.2.5.2.\nNOTE:\tIn roaming case, the location of the ER server in the home 3GPP AAA Server is not supported in this release.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.5.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.1",
      "section_id": "5.2.1",
      "section_title": "General",
      "content": "The STa reference point shall be based on Diameter, as defined in IETF RFC 6733 [58], and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nIn the case of a trusted non-3GPP IP access where PMIPv6 is used as mobility protocol, the MAG to 3GPP AAA server or the MAG to 3GPP AAA proxy communication shall use the MAG to AAA interface functionality defined in IETF RFC 5779 [2] and the NAS to AAA interface functionality defined in IETF RFC 5447 [6].\nThe trusted non-3GPP access network to AAA interface functionality over the STa reference defines a new Application Id:\n-\t\"STa\" with value 16777250.\nThe STa application reuses existing EAP (IETF RFC 4072 [5]) application commands, command ABNFs, and application logic and procedures.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.1.1",
      "section_id": "5.2.2.1.1",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a non-3GPP access network NAS to a 3GPP AAA server. The ABNF is re-used from the IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n…\n[ RAT-Type ]\n[ ANID ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n[ QoS-Capability ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ Service-Selection ]\n[ Terminal-Information ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n[ AAA-Failure-Indication ]\n[ WLAN-Identifier ]\n[ DER-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n* 2 [ TWAG-CP-Address ]\n[ ERP-RK-Request ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.1.2",
      "section_id": "5.2.2.1.2",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "The Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a non-3GPP access network NAS. The ABNF is re-used from the IETF RFC 5779 [2]. The ABNF also contains AVPs that are reused from IETF RFC 4072 [5].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n[ 3GPP-Charging-Characteristics ]\n[ AMBR ]\n*[ Redirect-Host ]\n[ AN-Trusted ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ Supported-Features ]\n[ MIP-FA-RK ]\n[ MIP-FA-RK-SPI ]\n[ NSWO-Authorization ]\n[ DEA-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n[ WLCP-Key ]\n[ Terminal-Information ]\n[ UE-Usage-Type ]\n[ Emergency-Services ]\n[ Emergency-Info ]\n[ Key ]\n[ ERP-Realm ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.2.1",
      "section_id": "5.2.2.2.1",
      "section_title": "Abort-Session-Request (ASR) Command",
      "content": "The Abort-Session-Request (ASR) command, indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a non-3GPP access network NAS. ABNF for the ASR commands is as follows:\n< Abort-Session-Request >  ::=\t< Diameter Header: 274, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.2.2",
      "section_id": "5.2.2.2.2",
      "section_title": "Abort-Session-Answer (ASA) Command",
      "content": "The Abort-Session-Answer (ASA) command, indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, is sent from a non-3GPP access network NAS to a 3GPP AAA Server/Proxy. ABNF for the ASA commands is as follows:\n< Abort-Session-Answer >  ::=\t< Diameter Header: 274, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.2.3",
      "section_id": "5.2.2.2.3",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a trusted non-3GPP access network to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.2.4",
      "section_id": "5.2.2.2.4",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a trusted non-3GPP access network. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.1",
      "section_id": "5.2.2.3.1",
      "section_title": "Re-Auth-Request (RAR) Command",
      "content": "The Diameter Re-Auth-Request (RAR) command, indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server to a Trusted Non-3GPP access network. ABNF for the RAR command is as follows:\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.2",
      "section_id": "5.2.2.3.2",
      "section_title": "Re-Auth-Answer (RAA) Command",
      "content": "The Diameter Re-Auth-Answer (ASA) command, indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, is sent from a Trusted Non-3GPP access network to a 3GPP AAA Server/Proxy. ABNF for the RAA commands is as follows:\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.3",
      "section_id": "5.2.2.3.3",
      "section_title": "AA-Request (AAR) Command",
      "content": "The AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from a Trusted Non-3GPP access network to a 3GPP AAA Server/Proxy. The ABNF is re-used from IETF RFC 4005 [4], adding AVPs from IETF RFC 5779 [2].\n< AA-Request >  ::=\t< Diameter Header: 265, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ Destination-Host ]\n[ User-Name ]\n[ MIP6-Feature-Vector ]\n[ Access-Network-Info ]\n[ Local-Time-Zone ]\n[ OC-Supported-Features ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.4",
      "section_id": "5.2.2.3.4",
      "section_title": "AA-Answer (AAA) Command",
      "content": "The AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a Trusted Non-3GPP access network. The ABNF is re-used from IETF RFC 4005 [4], adding AVPs from IETF RFC 5779 [2].\n< AA-Answer > ::=\t< Diameter Header: 265, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ 3GPP-Charging-Characteristics ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n[ UE-Usage-Type ]\n[ Emergency-Info]\n*[ Load ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.5",
      "section_id": "5.2.2.3.5",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "Refer to clause 5.2.2.1.1",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.2.3.6",
      "section_id": "5.2.2.3.6",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "Refer to clause 5.2.2.1.2",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.2.4.1",
      "section_id": "5.2.2.4.1",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a non-3GPP access network to a 3GPP AAA server. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.2.4.2",
      "section_id": "5.2.2.4.2",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a non-3GPP access network. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58], Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.1",
      "section_id": "5.2.3.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the STa interface protocol in NBM mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 5.2.3.1/1: Diameter STa AVPs\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nMIP6-Feature-Vector\n124\n5.2.3.3\nUnsigned64\nM\nV,P\nQoS-Capability\n578\n5.2.3.4\nGrouped\nM\nV,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nRAT-Type\n1032\n5.2.3.6\nEnumerated\nM,V\nP\nANID\n1504\n5.2.3.7\nUTF8String\nM,V\nP\nAN-Trusted\n1503\n5.2.3.9\nEnumerated\nM,V\nP\nMIP-FA-RK\n1506\n5.2.3.12\nOctetString\nM,V\nP\nMIP-FA-RK-SPI\n1507\n5.2.3.13\nUnsigned32\nM,V\nP\nFull-Network-Name\n1516\n5.2.3.14\nOctetString\nV\nM,P\nShort-Network-Name\n1517\n5.2.3.15\nOctetString\nV\nM,P\nWLAN-Identifier\n1509\n5.2.3.18\nGrouped\nV\nM,P\nMobile-Node-Identifier\n506\n5.2.3.2\nUTF8String\nM\nV,P\nAAA-Failure-Indication\n1518\n8.2.3.21\nUnsigned32\nV\nM,P\nTransport-Access-Type\n1519\n5.2.3.19\nEnumerated\nV\nM,P\nAPN-Configuration\n1430\n8.2.3.7\nGrouped\nM,V\nP\nVisited-Network-Identifier\n600\n9.2.3.1.2\nOctetString\nM,V\nP\nDER-Flags\n1520\n5.2.3.20\nUnsigned32\nV\nM,P\nDEA-Flags\n1521\n5.2.3.21\nUnsigned32\nV\nM,P\nSSID\n1524\n5.2.3.22\nUTF8String\nV\nM,P\nHESSID\n1525\n5.2.3.23\nUTF8String\nV\nM,P\nAccess-Network-Info\n1526\n5.2.3.24\nGrouped\nV\nM,P\nTWAN-Connection-Mode\n1527\n5.2.3.25\nUnsigned32\nV\nM,P\nTWAN-Connectivity-Parameters\n1528\n5.2.3.26\nGrouped\nV\nM,P\nConnectivity-Flags\n1529\n5.2.3.27\nUnsigned32\nV\nM,P\nTWAN-PCO\n1530\n5.2.3.28\nOctetString\nV\nM,P\nTWAG-CP-Address\n1531\n5.2.3.29\nAddress\nV\nM,P\nTWAG-UP-Address\n1532\n5.2.3.30\nUTF8String\nV\nM,P\nTWAN-S2a-Failure-Cause\n1533\n5.2.3.31\nUnsigned32\nV\nM,P\nSM-Back-Off-Timer\n1534\n5.2.3.32\nUnsigned32\nV\nM,P\nWLCP-Key\n1535\n5.2.3.33\nOctetString\nV\nM,P\nEmergency-Services\n1538\n7.2.3.4\nUnsigned32\nV\nM,P\nIMEI-Check-In-VPLMN-Result\n1540\n5.2.3.35\nUnsigned32\nV\nM,P\nHigh-Priority-Access-Info\n1542\n5.2.3.36\nUnsigned32\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58],.\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nThe following table describes the Diameter AVPs re-used by the STa interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within STa. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 5.2.3.1/2: STa re-used Diameter AVPs\nAttribute Name\nReference\nComments\nM-bit\nAccounting-Interim-Interval\nIETF RFC 6733 [58]\nAuth-Request-Type\nIETF RFC 6733 [58]\nCalling-Station-Id\nIETF RFC 4005 [4]\nSubscription-ID\nIETF RFC 4006 [20]\nMust not set\nEAP-Master-Session-Key\nIETF RFC 4072 [5]\nEAP-Payload\nIETF RFC 4072 [5]\nRAT-Type\n3GPP TS 29.212 [23]\nRe-Auth-Request-Type\nIETF RFC 6733 [58]\nSession-Timeout\nIETF RFC 6733 [58]\nUser-Name\nIETF RFC 6733 [58]\nTerminal-Information\n3GPP TS 29.272 [29]\nMIP6-Agent-Info\nIETF RFC 5447 [6]\nAPN-OI-Replacement\n3GPP TS 29.272 [29]\nSupported-Features\n3GPP TS 29.229 [24]\nFeature-List-ID\n3GPP TS 29.229 [24]\nSee clause 5.2.3.10\nFeature-List\n3GPP TS 29.229 [24]\nSee clause 5.2.3.11\nBSSID\n3GPP TS 32.299 [30]\nLocation-Information\nIETF RFC 5580 [46]\nLocation-Data\nIETF RFC 5580 [46]\nOperator-Name\nIETF RFC 5580 [46]\nLogical-Access-ID\nETSI TS 283 034 [48]\nLocal-Time-Zone\n3GPP TS 29.272 [29]\nPDN-Type\n3GPP TS 29.272 [29]\nServed-Party-IP-Address\n3GPP TS 32.299 [30]\nOC-Supported-Features\nIETF RFC 7683 [47]\nSee clause 8.2.3.22\nOC-OLR\nIETF RFC 7683 [47]\nSee clause 8.2.3.23\nDRMP\nIETF RFC 7944 [53]\nSee clause 8.2.3.25\nMust not set\nEmergency-Info\n3GPP TS 29.272 [29]\nLoad\nIETF RFC 8583 [54]\nSee clause 8.2.3.26\nMust not set\nERP-RK-Request\nIETF RFC 6942 [57]\nMust not set\nKey\nIETF RFC 6734 [56]\nThis is a grouped AVP containing Key-Type, Keying-Material and, optionally, Key-Lifetime.\nMust not set\nERP-Realm\nIETF RFC 6942 [57]\nMust not set\nUE-Usage-Type\n3GPP TS 29.272 [29]\nMPS-Priority\n3GPP TS 29.272 [29]\nMust not set\nNOTE 1:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies.\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nOnly those AVP initially defined in this reference point or AVP with values initially defined in this reference point and for this procedure are described in the following clause.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.229_clause_5.2.3.10",
        "ts_29.229_clause_5.2.3.11",
        "clause_8.2.3.22",
        "clause_8.2.3.23",
        "clause_8.2.3.25",
        "clause_8.2.3.26",
        "table_5.2.3.1",
        "ts_29.212",
        "ts_29.272",
        "ts_29.229",
        "ts_32.299"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.2",
      "section_id": "5.2.3.2",
      "section_title": "Mobile-Node-Identifier",
      "content": "The Mobile-Node-Identifier AVP (AVP Code 506) is of type UTF8String.\nThe Mobile-Node-Identifier AVP is returned in an answer message that ends a successful authentication (and possibly an authorization) exchange between the AAA client and the AAA server. The returned Mobile Node Identifier may be used as the PMIPv6 MN-ID or as the MIPv4 MN-NAI or to derive the IMSI to be sent in GTPv2 signalling.\nThe Mobile-Node-Identifier is defined on IETF RFC 5779 [2].",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.3",
      "section_id": "5.2.3.3",
      "section_title": "MIP6-Feature-Vector",
      "content": "The MIP6-Feature-Vector AVP (AVP Code 124) is of type Unsigned64 and contains a 64 bit flags field of supported mobile IP capabilities of the non-3GPP access network (when this AVP is used in the request commands) and the mobile IP capabilities the 3GPP AAA Server has authorized (when this AVP is used in the response commands).\nThe following capabilities are defined for STa interface:\n-\tMIP6_INTEGRATED (0x0000000000000001)This flag is set by the non-3GPP access network and the 3GPP AAA Server. It means that the Mobile IPv6 integrated scenario bootstrapping functionality is supported.\n-\tPMIP6_SUPPORTED (0x0000010000000000)When this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports PMIPv6.When this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that NBM shall be used.\n-\tASSIGN_LOCAL_IP (0x0000080000000000)This flag is set by the 3GPP AAA Server.When this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that the non-3GPP access network shall assign to the user a local IP address (for HBM).\n-\tMIP4_SUPPORTED (0x0000100000000000)This flag is set by the non-3GPP access network, the PDN GW and the 3GPP AAA Server. When this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports MIPv4 FA-CoA mode. When this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that MIPv4 FA-CoA mode shall be used. When this flag is set by the PDN GW and 3GPP AAA Server over the S6b interface, it shows that MIPv4 mobility protocol is used on the S2a interface.\n-\tOPTIMIZED_IDLE_MODE_MOBILITY (0x0000200000000000)This flag is set by the Trusted Non-3GPP access network if the PDN GW information needs to be updated for the case of idle mode mobility from E-UTRAN to HRPD access.\n-\tGTPv2_SUPPORTED (0x0000400000000000)When this flag is set by the non-3GPP access network it indicates to the 3GPP AAA Server that it supports GTPv2.When this flag is set by the 3GPP AAA Server it indicates to the non-3GPP access network that NBM shall be used.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.4",
      "section_id": "5.2.3.4",
      "section_title": "QoS Capability",
      "content": "This AVP is FFS",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.5",
      "section_id": "5.2.3.5",
      "section_title": "Service-Selection",
      "content": "The Service-Selection AVP is of type of UTF8String. This AVP contains an APN Network Identifier (i.e., an APN without the Operator Identifier), and it shall consist of one or more labels according to DNS naming conventions (IETF RFC 1035 [35]) describing the access point to the packet data network.\nThe contents of the Service-Selection AVP shall be formatted as a character string composed of one or more labels separated by dots (\".\").\nThe Service-Selection AVP is defined in IETF RFC 5778 [11].",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.6",
      "section_id": "5.2.3.6",
      "section_title": "RAT-Type",
      "content": "The RAT-Type AVP (AVP code 1032) is of type Enumerated and is used to identify the radio access technology that is serving the UE. It follows the specification described in TS 29.212 [23].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.212"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.7",
      "section_id": "5.2.3.7",
      "section_title": "ANID",
      "content": "The ANID AVP is of type UTF8String; this AVP contains the Access Network Identity; see 3GPP TS 24.302 [26] for defined values.",
      "chunk_type": "general",
      "cross_references": [
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.8",
      "section_id": "5.2.3.8",
      "section_title": "AMBR",
      "content": "Please refer to 3GPP TS 29.272 [29] for the encoding of this AVP.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.9",
      "section_id": "5.2.3.9",
      "section_title": "AN-Trusted",
      "content": "The AN-Trusted AVP (AVP Code 1503) is of type Enumerated.\nThe AN-Trusted AVP sent from the 3GPP AAA Server to the Non-3GPP access network conveys the decision about the access network being trusted or untrusted by the HPLMN.\nThe following values are defined:\nTRUSTED (0)\nThis value is used when the non-3GPP access network is to be handled as trusted.\nUNTRUSTED (1)\nThis value is used when the non-3GPP access network is to be handled as untrusted.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.10",
      "section_id": "5.2.3.10",
      "section_title": "Feature-List-ID AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the STa/SWa application.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.11",
      "section_id": "5.2.3.11",
      "section_title": "Feature-List AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the STa/SWa application.\nNOTE:\tThere are no STa/SWa features defined for this release.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.12",
      "section_id": "5.2.3.12",
      "section_title": "MIP-FA-RK",
      "content": "The MIP-FA-RK AVP is of type OctetString; this AVP contains the FA-RK used to calculate the security parameters needed for the MN-FA authentication extension as defined by 3GPP TS 33.402 [19].",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.13",
      "section_id": "5.2.3.13",
      "section_title": "MIP-FA-RK-SPI",
      "content": "The MIP-FA-RK-SPI AVP is of type Unsigned32; this AVP contains the security index used in identifying the security context for the FA-RK as defined by 3GPP TS 33.402 [19].",
      "chunk_type": "general",
      "cross_references": [
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.14",
      "section_id": "5.2.3.14",
      "section_title": "Full-Network-Name",
      "content": "The Full-Network-Name AVP is of type OctetString; this AVP shall contain the Full Network Name and be encoded as the Full name value field of the AT_FULL_NAME_FOR_NETWORK attribute specified in clause 8.2.5.1 of 3GPP TS 24.302 [26].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.302_clause_8.2.5.1",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.15",
      "section_id": "5.2.3.15",
      "section_title": "Short-Network-Name",
      "content": "The Short-Network-Name AVP is of type OctetString; this AVP shall contain the Short Network Name and be encoded as the Short name value field of the AT_SHORT_NAME_FOR_NETWORK attribute specified in clause 8.2.5.2 of 3GPP TS 24.302 [26].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.302_clause_8.2.5.2",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.18",
      "section_id": "5.2.3.18",
      "section_title": "WLAN-Identifier",
      "content": "The WLAN-Identifier AVP is of type Grouped. It contains the type and value of an IEEE 802.11 identifier of a Trusted WLAN.\nAVP Format:\nWLAN-Identifier ::=\t< AVP Header: 1509 10415 >\n[SSID ]\n[HESSID ]\n*[ AVP ]",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.19",
      "section_id": "5.2.3.19",
      "section_title": "Transport-Access-Type",
      "content": "The Transport-Acess-Type AVP (AVP code 1519) is of type Enumerated and is used to identify the transport access technology that is serving the UE.\nThe following values are defined:\nBBF (0)\nThis value shall be used to indicate a BBF transport access network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.20",
      "section_id": "5.2.3.20",
      "section_title": "DER-Flags",
      "content": "The DER-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.20/1:\nTable 5.2.3.20/1: DER-Flags\nBit\nName\nDescription\n0\nNSWO-Capability-Indication\nThis bit, when set, indicates to the 3GPP AAA proxy/server that the TWAN supports non-seamless WLAN offload service (see clause 16 of 3GPP TS 23.402 [3]).\n1\nTWAN-S2a-Connectivity-Indicator\nThis bit is only applicable to the TWAN authentication and authorization procedure, when authorizing the SCM for EPC access.\nWhen set, it indicates to the 3GPP AAA Server that the TWAN has completed the necessary S2a network connectivity actions, and the 3GPP AAA Sever can finalize the EAP conversation by sending a final EAP 'Success' or 'Failure' response to the TWAN.\n2\nIMEI-Check-Required-In-VPLMN\nThis bit is only applicable to the TWAN authentication and authorization procedure, when the UE and the network support Mobile Equipment Identity signalling over trusted WLAN.\nWhen set, it indicates to the 3GPP AAA Server that the 3GPP AAA Server shall retrieve the IMEI(SV) from the UE and return it to the VPLMN with the IMEI-Check-Request-In-VPLMN bit set in the DEA-Flags.\n3\nIMEI-Check-Request-In-VPLMN\nThis bit is only applicable to the TWAN authentication and authorization procedure, when the UE and the network support Mobile Equipment Identity signalling over trusted WLAN.\nWhen set, it indicates that the 3GPP AAA Proxy shall perform the IMEI(SV) check in the VPLMN and send the IMEI check result to the 3GPP AAA Server.\n4\nEmergency-Capability-Indication\nThis bit, when set, indicates to the 3GPP AAA Server that the TWAN supports IMS emergency sessions (see clause 4.5.7 of 3GPP TS 23.402 [3]).\n5\nERP-Support-Indication\nThis bit, when set, indicates to the 3GPP AAA proxy/server that the non-3GPP access network supports EAP extensions for the EAP Re-authentication Protocol (ERP).\n6\nERP-Re-Authentication\nThis bit, when set, indicates to the 3GPP AAA proxy/server that the authentication request is sent for EAP re-authentication based on ERP.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.402_clause_16",
        "ts_23.402_clause_4.5.7",
        "table_5.2.3.20",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.21",
      "section_id": "5.2.3.21",
      "section_title": "DEA-Flags",
      "content": "The DEA-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.21/1:\nTable 5.2.3.21/1: DEA-Flags\nBit\nName\nDescription\n0\nNSWO-Authorization\nThis bit, when set, indicates to the TWAN that the non-seamless WLAN offload service is authorized (see clause 16 of 3GPP TS 23.402 [3]).\n1\nTWAN-S2a-Connectivity-Indicator\nThis bit is only applicable to the TWAN authentication and authorization procedure, when authorizing the SCM for EPC access; when set, it indicates to the TWAN that the EAP-AKA' authentication has been successful (i.e., the 3GPP AAA Server has checked the validity of the challenge response sent by the UE), and the network connectivity set up may proceed at the TWAN.\n2\nIMEI-Check-Request-In-VPLMN\nThis bit is only applicable to the TWAN authentication and authorization procedure, when the UE and the network support Mobile Equipment Identity signalling over trusted WLAN.\nWhen set, it indicates that the VPLMN shall perform the IMEI check and return the outcomes to the 3GPP AAA Server.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the recever of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.402_clause_16",
        "table_5.2.3.21",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.22",
      "section_id": "5.2.3.22",
      "section_title": "SSID",
      "content": "The SSID AVP is of type UTF8String and it shall contain the Service Set Identifier which identifies a specific 802.11 extended service set (see IEEE Std 802.11-2012 [40]). It shall contain a string of 1 to 32 octets.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.23",
      "section_id": "5.2.3.23",
      "section_title": "HESSID",
      "content": "The HESSID AVP is of type UTF8String and it shall contain a 6-octet MAC address that identifies the Homogenous Extended Service Set (see IEEE Std 802.11-2012 [40]). It shall be encoded in upper-case ASCII characters with the octet values separated by dash characters. It shall contain a string of 17 octets. Example: \"00-10-A4-23-19-C0\".",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.24",
      "section_id": "5.2.3.24",
      "section_title": "Access-Network-Info",
      "content": "The Access-Network-Info AVP is of type Grouped.\nFor a Trusted WLAN, it shall contain the SSID of the WLAN and, unless otherwise determined by the TWAN operator's policies, it shall contain at least one of the following elements:\n-\tthe BSSID,\n-\tthe civic address of the access point to which the UE is attached,\n-\tthe Logical Access ID (see ETSI ES 283 034 [48]) associated to the access point to which the UE is attached.\nIt may also contain the name of the TWAN operator (either a PLMN-ID or an operator name in realm format).\nFor an untrusted WLAN, it shall contain the same information as specified above for a trusted WLAN, where the operator name indicates the WLAN operator name.\nAVP Format:\nAccess-Network-Info ::=\t< AVP Header: 1526 10415 >\n[ SSID ]\n[ BSSID ]\n[ Location-Information ]\n[ Location-Data ]\n[ Operator-Name ]\n[ Logical-Access-ID ]\n*[ AVP ]\nThe Location-Data and Location-Information AVPs are defined in IETF RFC 5580 [46]; the content of Location-Information shall indicate that the encoding follows a civic location profile, by setting the \"Code\" field to 0.\nThe Operator-Name AVP is defined in IETF RFC 5580 [46]; the first 8 bits contain the Namespace ID field, whose values are managed by IANA, and are encoded as a single ASCII character. Only values \"1\" (Realm) and \"2\" (E212, containing MCC and MNC values) shall be used in this specification.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.25",
      "section_id": "5.2.3.25",
      "section_title": "TWAN-Connection-Mode",
      "content": "The TWAN-Connection-Mode AVP (AVP Code 1527) is of type Unsigned32 and it shall contain a 32 bit flags field which is used to indicate the connection modes supported by the TWAN (when this AVP is used in the request commands) and the selected TWAN connection mode the 3GPP AAA Server has authorized (when this AVP is used in the response commands).\nTable 5.2.3.25/1: TWAN-Connection-Mode\nBit\nName\nDescription\n0\nTSC-MODE\nThis bit, when set by the TWAN, indicates to the 3GPP AAA Server that the TWAN supports the TSCM.\n1\nSC-MODE\nThis bit, when set by the TWAN, indicates to the 3GPP AAA Server that the TWAN supports the SCM.\nThis bit, when set by the 3GPP AAA Server, indicates to the TWAN that the SCM shall be used.\n2\nMC-MODE\nThis bit, when set by the TWAN, indicates to the 3GPP AAA Server that the TWAN supports the MCM.\nThis bit, when set by the 3GPP AAA Server, indicates to the TWAN that the MCM shall be used.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.2.3.25"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.26",
      "section_id": "5.2.3.26",
      "section_title": "TWAN-Connectivity-Parameters",
      "content": "The TWAN-Connectivity-Parameters AVP is of type Grouped.\nAVP Format:\nTWAN-Connectivity-Parameters ::=\t< AVP Header: 1528 10415 >\n[ Connectivity-Flags ]\n[ Service-Selection ]\n[ PDN-Type ]\n* 2 [ Served-Party-IP-Address ]\n[ TWAN-PCO ]\n[ TWAG-UP-Address ]\n[ TWAN-S2a-Failure-Cause ]\n[ SM-Back-Off-Timer ]\n*[ AVP ]\nThe Service-Selection AVP indicates the APN requested by the UE (requested connectivity parameters) or the APN selected by the TWAN (provided connectivity parameters). It shall contain both the network identifier part and the operator identifier part of the Access Point Name.\nThe PDN-Type AVP indicates the PDN type requested by the UE (requested connectivity parameters) or the PDN type allocated by the network (provided connectivity parameter). It may be set to IPv4, IPv6 or IPv4v6.\nThe UE's Served-Party-IP-Address AVP may be present 0, 1 or 2 times. These AVPs shall be present if the S2a connection was successfully established, and they shall contain either of:\n-\tan IPv4 address, or\n-\tan IPv6 interface identifier, or\n-\tboth, an IPv4 address and an IPv6 interface identifier.\nFor the IPv6 interface identifier, the higher 64 bits of the address shall be set to zero.\nThe TWAN-S2a-Failure-Cause AVP may be present to indicate the cause of S2a connectivity establishment failure.\nThe SM-Back-Off-Timer AVP may be present to provide a Session Management back-off timer to be sent to the UE. The exact value of the SM-Back-Off-Timer is operator dependant.",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.27",
      "section_id": "5.2.3.27",
      "section_title": "Connectivity-Flags",
      "content": "The Connectivity-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.26/1:\nTable 5.2.3.26/1: Connectivity-Flags\nBit\nName\nDescription\n0\nInitial-Attach-Indicator\nThis bit may be set by the 3GPP AAA Server.\nThis bit, when set, indicates that a UE performs the Initial Attach procedure from non-3GPP access network. When not set, it indicates that a UE performs the Handover procedure.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.2.3.26"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.28",
      "section_id": "5.2.3.28",
      "section_title": "TWAN-PCO",
      "content": "The TWAN-PCO AVP is of type OctetString and shall contain the Protocol Configuration Options for the UE.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.29",
      "section_id": "5.2.3.29",
      "section_title": "TWAG-CP-Address",
      "content": "The TWAG-CP-Address AVP is of type Address and shall contain the TWAG control-plane IPv4 and/or IPv6 address that the TWAG supports, to be used for WLCP by the UE if MCM is selected.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.30",
      "section_id": "5.2.3.30",
      "section_title": "TWAG-UP-Address",
      "content": "The TWAG-UP-Address AVP is of type UTF8String and shall contain a 6-octet MAC address that identifies the TWAG user-plane MAC address to be used for encapsulating user plane packets between the UE and the TWAN, when SCM is used.\nIt shall be encoded in upper-case ASCII characters with the octet values separated by dash characters. It shall contain a string of 17 octets. Example: \"00-10-A4-23-19-C0\".",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_5.2.3.31",
      "section_id": "5.2.3.31",
      "section_title": "TWAN-S2a-Failure-Cause",
      "content": "The TWAN-S2a-Failure-Cause AVP (AVP Code 1533) is of type Unsigned32 and it shall contain a 32 bit cause value field which is used to indicate the cause of S2a connectivity establishment failure to the 3GPP AAA Server by the TWAN. The description of the TWAN-S2a-Failure-Cause value is specified as in Table 5.2.3.30/1:\nTable 5.2.3.30/1: TWAN-S2a-Failure-Cause value description\nCause value\n(decimal)\nCause Value\nMeaning\n26\nInsufficient resources\nThis cause is used to indicate that the requested service cannot be provided due to insufficient resources.\n27\nUnknown APN\nThis cause is used to indicate that the requested service was rejected because the access point name could not be resolved.\n29\nUser authentication failed\nThis cause is used to indicate that the requested service was rejected by the external packet data network due to a failed user authentication\n30\nRequest rejected by TWAN or PDN GW\nThis cause is used to indicate that the requested service or operation was rejected by the TWAN or PDN GW.\n31\nRequest rejected, unspecified\nThis cause is used to indicate that the requested service or operation was rejected due to unspecified reasons.\n32\nService option not supported\nThis cause is used to indicate that the UE requests a service which is not supported by the PLMN.\n33\nRequested service option not subscribed\nThis cause is used to indicate that the UE requests a service option which it has no subscription.\n34\nService option temporarily out of order\nThis cause is used to indicate that the network cannot serve the request because of temporary outage of one or more functions required for supporting the service.\n38\nNetwork failure\nThis cause is used to indicate that the requested service was rejected due to an error situation in the network.\n50\nPDN type IPv4 only allowed\nThis value is used to indicate that only PDN type IPv4 is allowed for the requested PDN connectivity.\n51\nPDN type IPv6 only allowed\nThis value is used to indicate that only PDN type IPv6 is allowed for the requested PDN connectivity.\n54\nPDN connection does not exist\nThis value is used at handover from a 3GPP access network to indicate that the network does not have any information about the requested PDN connection.\n113\nMultiple accesses to a PDN connection not allowed\nThis value is used to indicate that the request for the additional access to a PDN connection was rejected by the PDN GW.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.2.3.30"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.32",
      "section_id": "5.2.3.32",
      "section_title": "SM-Back-Off-Timer",
      "content": "The SM-Back-Off-Timer AVP is of type Unsigned32 and it shall contain the session management back-off timer value in seconds. The session management back-off timer is provided to the UE as specified in clause 8.1.4.16 of 3GPP TS 24.302 [26].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.302_clause_8.1.4.16",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.33",
      "section_id": "5.2.3.33",
      "section_title": "WLCP-Key",
      "content": "The WLCP-Key AVP (AVP Code 1535) is of type OctetString and it shall contain the WLCP Key used for protecting the WLCP signalling between the UE and the TWAN, as specified in 3GPP TS 33.402 [19].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.35",
      "section_id": "5.2.3.35",
      "section_title": "IMEI-Check-In-VPLMN-Result",
      "content": "The IMEI-Check-In-VPLMN-Result AVP (AVP Code 1540) is of type Unsigned32 and it shall contain a 32 bit cause value field which is used to indicate the result of the IMEI check performed in the VPLMN. The description of the IMEI-Check-In-VPLMN-Result value is specified as in Table 5.2.3.35/1:\nTable 5.2.3.35/1: IMEI-Check-In-VPLMN-Result value description\nCause value\n(decimal)\nCause Value\nMeaning\n0\nSuccessful\nThis cause is used to indicate that the IMEI check has been performed successfully in the VPLMN.\n1\nIllegal_ME\nThis cause is used to indicate that the IMEI check has failed in the VPLMN due to an illegal Mobile Equipment.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.2.3.35"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.3.36",
      "section_id": "5.2.3.36",
      "section_title": "High-Priority-Access-Info",
      "content": "The High-Priority-Access-Info AVP (AVP code 1542) is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 5.2.3.36/1:\nTable 5.2.3.36/1: High-Priority-Access-Info\nBit\nName\nDescription\n0\nHPA_Configured\nThis bit, when set, indicates that the UE is configured for high priority access.\nNOTE: \tBits not defined in this table shall be cleared by the sending TWAN and discarded by the receiving AAA Server.\nNOTE:\tThe TWAN sets the HPA_Configured bit if the TWAN had received an indication from the UE that the UE has access priority in an EAP-Response/Identity message as described in 3GPP TS 24.302 [26].",
      "chunk_type": "requirement",
      "cross_references": [
        "table_5.2.3.36",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_5.2.4",
      "section_id": "5.2.4",
      "section_title": "Session Handling",
      "content": "The Diameter protocol between the non-3GPP access network and the 3GPP AAA Server or 3GPP AAA Proxy, shall always keep the session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify a given user. In order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_6.1.1",
      "section_id": "6.1.1",
      "section_title": "General",
      "content": "The SWd reference point connects the 3GPP AAA Proxy and the 3GPP AAA Server in EPS. The functionality of the SWd reference point is to transport authentication, authorization and related information in AAA messages including:\n-\tCarrying data for authentication signalling between 3GPP AAA Proxy and 3GPP AAA Server;\n-\tCarrying data for authorization signalling between 3GPP AAA Proxy and 3GPP AAA Server\n-\tCarrying charging signalling per user;\n-\tCarrying keying data for the purpose of radio interface integrity protection and encryption;\n-\tCarrying authentication data for the purpose of tunnel establishment, tunnel data authentication and encryption, for the case in which the ePDG is in the VPLMN;\n-\tCarrying mapping of a user identifier and a tunnel identifier sent from the ePDG to the 3GPP AAA Proxy through the 3GPP AAA Server;\n-\tUsed for purging a user from the access network for immediate service termination;\n-\tEnabling the identification of the operator networks amongst which the roaming occurs;\n-\tIf QoS mechanisms are applied: carrying data for AN QoS capabilities/policies (e.g. the supported 3GPP QoS profiles) within authentication request from 3GPP AAA Proxy to 3GPP AAA Server.\n-\tCarrying the IP Mobility Capabilities between 3GPP AAA Proxy and 3GPP AAA Server.\nThe SWd' reference point is defined between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWOF in 5GS. The definition of the reference point and its functionality is given in clause 4.2.15 of 3GPP TS 23.501 [59] and Annex S of 3GPP TS 33.501 [60]. It reuses the same stage 3 protocol definition as defined for SWd in EPC, with specific requirements for NSWO in 5GS specified in clause 6.1.2.4.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.501_clause_4.2.15",
        "clause_6.1.2.4",
        "ts_23.501",
        "ts_33.501"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.1.1",
      "section_id": "6.1.2.1.1",
      "section_title": "Trusted Non-3GPP Access Authentication and Authorization",
      "content": "When used in connection with the STa interface, the SWd interface shall support the trusted non-3GPP access authentication and authorization procedure defined in clause 5.1.2.1. For this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the trusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall check the presence and value of the visited network identifier. If the AVP was missing, it shall insert it, if the AVP was present, it may overwrite the AVP value before forwarding the request.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authentication and authorization answer that it forwards to the trusted non-3GPP access network, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\n-\tThe 3GPP AAA Proxy may decide about the trustworthiness of the non-3GPP access from the VPLMN point of view and insert a trust relationship indicator to the authentication and authorization request.\n-\tIf it supports the ER server functionality, the 3GPP AAA Proxy may decide about the use of ERP for re-authentication and indicate its willingness to act as the ER server for this session into the first authentication and authorization request forwarded to the 3GPP AAA server.\nThe 3GPP AAA Proxy shall decide about using the S2a-PMIP based S8 chaining and in case it has selected that option, it shall select the Serving GW to be invoked and it shall add the Serving GW address to the authentication and authorization answer that is sent upon successful completion of the authentication.\nTable 6.1.2.1.1/1 describes the trusted non-3GPP access authentication and authorization request forwarded on the SWd interface.\nTable 6.1.2.1.1-1: Trusted non-3GPP Access Authentication and Authorization Request on SWd\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP payload\nEAP-payload\nM\nThis IE shall contain the Encapsulated EAP payload used for the UE – 3GPP AAA Server mutual authentication\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the user is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nUE Layer-2 address\nCalling-Station-ID\nM\nThis IE shall contain the Layer-2 address of the UE.\nSupported 3GPP QoS profile\nQoS-Capability\nO\nIf the trusted non-3GPP Access supports QoS mechanisms, this information element may be included to contain the access network's QoS capabilities as defined in IETF RFC 5777 [9].\nMobility Capabilities\nMIP6-Feature-Vector\nC\nThis information element shall contain the mobility capabilities of the trusted non-3GPP access network, if dynamic mobility mode selection is done. This information may also be used to decide whether to authorize access to EPC to a user accessing a TWAN.\nThe PMIP6_SUPPORTED flag and/or the GTPv2_SUPPORTED flag shall be set if the trusted non-3GPP access network supports PMIPv6 and/or GTPv2. PMIP6_SUPPORTED flag is defined in IETF RFC 5779 [2].\nThe flag MIP6_INTEGRATED shall be set if DHCPv6 based Home Agent address discovery is supported as defined in IETF RFC 5447 [6].\nThe MIP4_SUPPORTED flag shall be set if the trusted non-3GPP access supports MIPv4 FA-CoA mode.\nAccess Type\nRAT-Type\nM\nThis IE shall contain the trusted non-3GPP access network technology type that is serving the UE.\nAccess Network Identity\nANID\nM\nThis IE shall contain the access network identifier used for key derivation at the HSS. (See 3GPP TS 24.302 [26] for all possible values)\nVisited Network Identifier\nVisited-Network-Identifier\nM\nThis IE shall contain the Identifier that allows the home network to identify the Visited Network.\nFull Name for Network\nFull-Network-Name\nO\nThis IE shall contain the full name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network. If the Visited Network Identifier is present, this AVP shall be set.\nShort Name for Network\nShort-Network-Name\nO\nThis IE shall contain the short name for network as specified in 3GPP TS 24.302 [26]. This AVP may be inserted by the non-3GPP access network depending on its local policy and only when it is not connected to the UE's Home Network. If the Visited Network Identifier is present, this AVP shall be set.\nAPN Id\nService-Selection\nO\nIf present, this information element shall contain the Network Identifier part of the APN the user wants to connect to (if available).\nTerminal Information\nTerminal-Information\nO\nIf present, this information element shall contain information about the user's mobile equipment. The type of identity carried depends on the access technology type. For HRPD access network, the 3GPP2‑MEID AVP shall be included in this grouped AVP.\nTrust Relationship Indicator\nAN-Trusted\nO\nIf present, This AVP shall express the trusted/untrusted decision about the non-3GPP IP access, from the VPLMN's point of view. The value \"TRUSTED\" shall be used in this case.\nSelected Trusted WLAN Identifier\nWLAN-Identifier\nO\nIf present, this IE shall contain the trusted WLAN Identifier selected by the UE to access the trusted WLAN Access Network (see clause 16 of 3GPP TS 23.402 [3]).\nDER Flags\nDER-Flags\nO\nThis Information Element contains a bit mask. See 5.2.3.20 for the meaning of the bits.\nTransport Access Type\nTransport-Access-Type\nC\nFor interworking with Fixed Broadband access networks (see 3GPP TS 23.139 [39]), if the access network needs to receive the IMSI of the UE in the authentication response, then this information element shall be present, and it shall contain the value \"BBF\" (see clause 5.2.3.19).\nSupported TWAN Connection Modes\nTWAN-Connection-Mode\nO\nThe TWAN should include this IE.\nIf present, this information element shall contain the TWAN connection modes supported by the TWAN, i.e.TSCM, SCM and/or MCM.\nProvided Connectivity Parameters\nTWAN-Connectivity-Parameters\nC\nThis information element shall be present if the 3GPP AAA Server has previously authorized the SCM to be used for EPC access.\nTWAN-Connectivity-Parameters is a grouped AVP.\nIf the requested connectivity has been granted, the following information elements shall be included:\n- selected APN\n- selected PDN type\n- UE IPv4 Address (for PDN type IPv4 or IPv4v6)\n- UE IPv6 Interface Identifier (for PDN type IPv6 or IPv4v6)\n- Protocol Configuration Options (if received from the PGW)\n- TWAG user plane MAC address\nThe absence of both an IPv4 address and an IPv6 Interface Identifier indicates that the requested connectivity could not be granted. If the requested connectivity has not been granted, the following information elements may be included:\n- a cause indicating why the requested connectivity has not been granted\nTWAG Control Plane IP Address\nTWAG-CP-Address\nC\nThe TWAN shall include this IE if it indicates support of the MCM in the Supported TWAN Connection Modes IE. When present, this IE shall contain the TWAG Control Plane IPv4 Address, or the TWAG Control Plane IPv6 link local address, or both (if the TWAG supports IPv4 and IPv6), to be used for WLCP by the UE if the MCM is used.\nDomain-Specific Re-authentication Key Request\nERP-RK-Request\nO\nIf present, this IE indicates the willingness of an ER server in the non-3GPP access network or the 3GPP AAA proxy to act as the ER server for this session.\nWhen present, this IE shall contain the name of the realm in which the ER server is located.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nThis information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nNOTE:\tFor more details on the 3GPP AAA Proxy behaviour, refer to clause 5.1.2.1.3.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.1",
        "ts_23.003_clause_19",
        "ts_23.402_clause_16",
        "clause_5.2.3.19",
        "clause_5.1.2.1.3",
        "table_6.1.2.1.1",
        "table_6.1.2.1.1-1",
        "ts_23.003",
        "ts_24.302",
        "ts_23.402",
        "ts_23.139"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.1.2",
      "section_id": "6.1.2.1.2",
      "section_title": "HSS/AAA Initiated Detach for Trusted non-3GPP Access",
      "content": "When used in connection with the STa interface, the SWd interface shall support the HSS initiated detach procedure defined in clause 5.1.2.2.\nFor this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the access network GW as a stateful Diameter proxy.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.1.3",
      "section_id": "6.1.2.1.3",
      "section_title": "Access and Service Authorization information update",
      "content": "When used in connection with the STa interface, the SWd interface shall support the trusted non-3GPP access and service authorization information update procedure defined in clause 5.1.2.3. For this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the trusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall check the presence and value of the visited network identifier. If the AVP was missing, it shall insert it, if the AVP was present, it may overwrite the AVP value before forwarding the request.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authentication and authorization answer that it forwards to the trusted non-3GPP access network, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\nTable 6.1.2.1.3/1 describes the trusted non-3GPP access authorization request forwarded on the SWd interface. As the content is very similar to that of the request received on the STa interface, only those AVPs are listed that are handled differently on the two interfaces.\nTable 6.1.2.1.3/1: Trusted Non-3GPP Access Authorization Request on SWd interface\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRequest-Type\nAuth-Req-Type\nM\nThis IE shall contain the Authorization Request Type. The following values only shall be used:\nAUTHORIZE_ONLY\nThis value shall indicate the initial request for authorization of the user to the APN.\nVisited Network Identifier\nVisited-Network-Identifier\nM\nThis IE shall contain an identifier that allows the home network to identify the Visited Network.\nRouting Information\nDestination-Host\nM\nThis IE shall contain the 3GPP AAA Server name that is obtained from the Origin-Host AVP of a previously received message.\nSupported 3GPP QoS profile\nQoS-Capability\nO\nIf the trusted non-3GPP Access supports QoS mechanisms, this information element may be included to contain the access network's QoS capabilities as defined in IETF RFC 5777 [9].\nAccess Type\nRAT-Type\nO\nIf present, this IE contain the trusted non-3GPP access network access technology type that is serving the UE.\nNOTE:\tFor more details on the 3GPP AAA Proxy behaviour, refer to clause 5.1.2.3.3.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.3",
        "ts_23.003_clause_19",
        "clause_5.1.2.3.3",
        "table_6.1.2.1.3",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.1.4",
      "section_id": "6.1.2.1.4",
      "section_title": "Trusted non-3GPP Access Network Initiated Session Termination",
      "content": "When used in connection with the STa reference point, the SWd reference point shall support the access network initiated session termination procedures as defined in clause 5.1.2.4\nFor this procedure, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the access network gateway as a stateful Diameter proxy.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.2",
      "section_id": "6.1.2.2",
      "section_title": "Untrusted non-3GPP Access / ePDG related procedures",
      "content": "When used in connection with the SWm reference point, the SWd reference point shall support the following procedures:\n-\tAuthentication procedures as defined in clause 7.1.2.1\n-\tAuthorization procedures as defined in clause 7.1.2.2\n-\tAccess network/ePDG initiated session termination procedures as defined in clause 7.1.2.3\n-\tHSS/AAA initiated detach procedures as defined in clause 7.1.2.4\n-\tService authorization information update procedures as defined in clause 7.1.2.5\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the ePDG as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication or an authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authorization answer that it forwards to the ePDG, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\n-\tThe 3GPP AAA Proxy shall decide about using the S8-S2b chaining and in case it has selected that option, it shall select the Serving GW to be invoked and it shall add the Serving GW address to the authentication answer that is sent upon successful completion of the authentication.\nNOTE:\tFor more detailed behavior of the 3GPP AAA Proxy, refer to clauses 7.1.2.1.3 and 7.1.2.2.3 respectively.\nWhen used in connection with the SWa interface point, the SWd reference point shall support the following procedures:\n-\tAuthentication and authorization procedure as defined in clause 4.1.2.1\n-\tHSS/AAA initiated detach procedures as defined in clause 4.1.2.2\n-\tUntrusted non-3GPP access network initiated detach procedures as defined in clause 4.1.2.3\n-\tRe-Authentication and Re-Authorization Procedure as defined in clause 4.1.2.4\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the untrusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall insert the visited network identifier.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_7.1.2.1",
        "clause_7.1.2.2",
        "clause_7.1.2.3",
        "clause_7.1.2.4",
        "clause_7.1.2.5",
        "clause_4.1.2.1",
        "clause_4.1.2.2",
        "clause_4.1.2.3",
        "clause_4.1.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.3",
      "section_id": "6.1.2.3",
      "section_title": "PDN GW related procedures",
      "content": "When used in connection with the S6b reference point, the SWd reference point shall support the following procedures:\n-\tAuthentication and authorization procedures when using DSMIP as defined in clause 9.1.2.1\n-\tAuthorization procedures when using NBM as defined in clause 9.1.2.2\n-\tPDN GW initiated session termination procedures as defined in clause 9.1.2.3\n-\tHSS/AAA initiated detach procedures as defined in clause 9.1.2.4\n-\tService authorization information update procedures as defined in clause 9.1.2.5\nFor all these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the 3GPP AAA Server and the PDN GW as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication or authorization request, if roaming is not allowed for the users of the given HPLMN\n-\tThe 3GPP AAA Proxy may modify the service authorization information in the authorization answers that it forwards to the PDN GW, in order to enforce the QoS limitations according to the local policies and the roaming agreement with the home operator.\nNOTE:\tFor more detailed behavior of the 3GPP AAA Proxy, refer to clauses 9.1.2.1.4, 9.1.2.2.4, 9.1.2.3.4, and 9.1.2.4.4, respectively.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_9.1.2.1",
        "clause_9.1.2.2",
        "clause_9.1.2.3",
        "clause_9.1.2.4",
        "clause_9.1.2.5"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.1.2.4",
      "section_id": "6.1.2.4",
      "section_title": "SWd' procedures for NSWO in 5GS",
      "content": "The SWd' interface between the 3GPP AAA Proxy, possibly via an intermediate 3GPP AAA Proxy, and the NSWOF shall support the same procedures as defined for SWa' in clause 4.1.2.5.\nFor these procedures, the 3GPP AAA Proxy shall forward the Diameter commands received from the NSWOF and the untrusted non-3GPP access network as a stateful Diameter proxy, with the following exceptions:\n-\tThe 3GPP AAA Proxy may reject an authentication and authorization request, if roaming is not allowed for the users of the given HPLMN.\n-\tWhen forwarding an authentication and authorization request, the 3GPP AAA Proxy shall insert the visited network identifier.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_4.1.2.5"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.1",
      "section_id": "6.2.1",
      "section_title": "General",
      "content": "The SWd reference point shall be based on Diameter, as defined in IETF RFC 6733 [58] and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nThere is no separate application ID defined for the SWd interface. The application ID used by the 3GPP AAA Proxy depends on the command sent over SWd.\nNOTE:\tEven though the 3GPP AAA Proxy may add new AVPs to the Diameter commands forwarded to/from the 3GPP AAA Server, there is no AVP present in the SWd reference point that would not be present in the interface that is used in connection with it. Therefore, the same Application ID can be used.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_6.2.2.1.1",
      "section_id": "6.2.2.1.1",
      "section_title": "Commands for STa PMIPv6 or GTPv2 authentication and authorization procedures",
      "content": "6.2.2.1.1.1\tDiameter-EAP-Request (DER) Command\nThe Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a trusted non-3GPP access network NAS to a 3GPP AAA server. The ABNF is re-used from the IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ Calling-Station-Id ]\n…\n[ RAT-Type ]\n[ ANID ]\n[ QoS-Capability ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ Service-Selection ]\n[ Terminal-Information ]\n[ AN-Trusted ]\n[ Full-Network-Name ]\n[ Short-Network-Name ]\n*[ Supported-Features ]\n[ WLAN-Identifier ]\n[ DER-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n* 2 [ TWAG-CP-Address ]\n[TWAN-S2a-Failure-Cause]\n[ ERP-RK-Request ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]\n6.2.2.1.1.2\tDiameter-EAP-Answer (DEA) Command\nThe Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a 3GPP AAA Proxy. The ABNF is re-used from the IETF RFC 5779 [2]. The ABNF also contains AVPs that are reused from IETF RFC 4072 [5].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777250 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Result-Code }\n[ Experimental-Result ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Auth-Request-Type }\n[ EAP-Payload ]\n[ User-Name ]\n[ Session-Timeout ]\n[ Accounting-Interim-Interval ]\n[ EAP-Master-Session-Key ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n*[ Redirect-Host ] ]\n[ Trace-Info ]\n[ Subscription-ID ]\n*[ Supported-Features ]\n[ DEA-Flags ]\n[ TWAN-Connection-Mode ]\n[ TWAN-Connectivity-Parameters ]\n[ Terminal-Information ]\n[ Key ]\n[ ERP-Realm ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "procedure",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_6.2.2.1.2",
      "section_id": "6.2.2.1.2",
      "section_title": "Commands for STa HSS/AAA Initiated Detach for Trusted non-3GPP Access",
      "content": "The ABNFs defined for the STa interface in clause 5.2.2.2 and in its clauses apply.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.2.1.3",
      "section_id": "6.2.2.1.3",
      "section_title": "Commands for STa Access and Service Authorization Update Procedure",
      "content": "The ABNFs defined for the STa interface in clause 5.2.2.3 and in its clauses apply.",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_5.2.2.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.2.1.4",
      "section_id": "6.2.2.1.4",
      "section_title": "Commands for Trusted non-3GPP Access network Initiated Session Termination",
      "content": "The ABNFs defined for the STa interface in clause 5.2.2.4 and in its clauses apply.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.2.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.2.2",
      "section_id": "6.2.2.2",
      "section_title": "Commands used in connection with the SWm interface",
      "content": "The ABNFs defined for the SWm interface in clause 7.2.2 and in its clauses apply.",
      "chunk_type": "general",
      "cross_references": [
        "clause_7.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.2.3",
      "section_id": "6.2.2.3",
      "section_title": "Commands used in connection with the S6b interface",
      "content": "The ABNFs defined for the S6b interface in clause 9.2.2 and in its clauses apply.",
      "chunk_type": "general",
      "cross_references": [
        "clause_9.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_6.2.3.1",
      "section_id": "6.2.3.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the SWd interface protocol in NBM mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 6.2.3.1/1: Diameter SWd AVPs\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nMIP6-Feature-Vector\n124\n5.2.3.3\nUnsigned64\nM\nV,P\nQoS-Capability\n578\n5.2.3.4\nGrouped\nM\nV,P\nRAT-Type\n1032\n5.2.3.6\nEnumerated\nM,V\nP\nANID\n1504\n5.2.3.7\nUTF8String\nM,V\nP\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nMobile-Node-Identifier\n506\n5.2.3.2\nUTF8String\nM\nV,P\nAN-Trusted\n1503\n5.2.3.9\nEnumerated\nM,V\nP\nFull-Network-Name\n1516\n5.2.3.14\nOctetString\nV\nM,P\nShort-Network-Name\n1517\n5.2.3.15\nOctetString\nV\nM,P\nWLAN-Identifier\n1509\n5.2.3.18\nGrouped\nV\nM,P\nAPN-Configuration\n1430\n8.2.3.7\nGrouped\nM,V\nP\nVisited-Network-Identifier\n600\n9.2.3.1.2\nOctetString\nM,V\nP\nDER-Flags\n1520\n5.2.3.20\nUnsigned32\nV\nM,P\nDEA-Flags\n1521\n5.2.3.21\nUnsigned32\nV\nM,P\nSSID\n1524\n5.2.3.22\nUTF8String\nV\nM,P\nHESSID\n1525\n5.2.3.23\nUTF8String\nV\nM,P\nTWAN-Connection-Mode\n1527\n5.2.3.25\nUnsigned32\nV\nM,P\nTWAN-Connectivity-Parameters\n1528\n5.2.3.26\nGrouped\nV\nM,P\nConnectivity-Flags\n1529\n5.2.3.27\nUnsigned32\nV\nM,P\nTWAN-PCO\n1530\n5.2.3.28\nOctetString\nV\nM,P\nTWAG-CP-Address\n1531\n5.2.3.29\nAddress\nV\nM,P\nTWAG-UP-Address\n1532\n5.2.3.30\nUTF8String\nV\nM,P\nTWAN-S2a-Failure-Cause\n1533\n5.2.3.31\nUnsigned32\nV\nM,P\nHigh-Priority-Access-Info\n1542\n5.2.3.36\nUnsigned32\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nThe following table describes the Diameter AVPs re-used by the SWd interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWd. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 6.2.3.1/2: SWd re-used Diameter AVPs\nAttribute Name\nReference\nComments\nM-bit\nAccounting-Interim-Interval\nIETF RFC 6733 [58]\nAuth-Request-Type\nIETF RFC 6733 [58]\nCalling-Station-Id\nIETF RFC 4005 [6]\nSubscription-ID\nIETF RFC 4006 [20]\nMust not set\nEAP-Master-Session-Key\nIETF RFC 4072 [5]\nEAP-Payload\nIETF RFC 4072 [5]\nRAT-Type\n3GPP TS 29.212 [23]\nRe-Auth-Request-Type\nIETF RFC 6733 [58]\nSession-Timeout\nIETF RFC 6733 [58]\nUser-Name\nIETF RFC 6733 [58]\nTerminal-Information\n3GPP TS 29.272 [29]\nAPN-OI-Replacement\n3GPP TS 29.272 [29]\nSupported-Features\n3GPP TS 29.229 [24]\nSee NOTE 1.\nFeature-List-ID\n3GPP TS 29.229 [24]\nSee NOTE 1.\nFeature-List\n3GPP TS 29.229 [24]\nSee NOTE 1.\nPDN-Type\n3GPP TS 29.272 [29]\nServed-Party-IP-Address\n3GPP TS 32.299 [30]\nDRMP\nIETF RFC 7944 [53]\nSee clause 8.2.3.25\nMust not set\nERP-RK-Request\nIETF RFC 6942 [57]\nMust not set\nERP-Realm\nIETF RFC 6942 [57]\nMust not set\nKey\nIETF RFC 6734 [56]\nThis is a grouped AVP containing Key-Type, Keying-Material and, optionally, Key-Lifetime.\nMust not set\nMPS-Priority\n3GPP TS 29.272 [29]\nMust not set\nNOTE 1:\tThere is no separate Diameter application ID defined for the SWd interface so a separate supported feature list is not required. The supported features depend on the command being proxied over SWd.\nNOTE 2:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies.\nNOTE 3:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nOnly those AVP initially defined in this reference point and for this procedure are described in the following clauses.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_8.2.3.25",
        "table_6.2.3.1",
        "ts_29.212",
        "ts_29.272",
        "ts_29.229",
        "ts_32.299"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.1",
      "section_id": "7.1.1",
      "section_title": "General",
      "content": "The SWm reference point is defined between the ePDG and the 3GPP AAA Server or between the ePDG and the 3GPP AAA Proxy. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWm reference point shall be used to authenticate and authorize the UE.\nThe SWm reference point is also used to transport NBM related mobility parameters in a case the UE attaches to the EPC via the S2b (based on PMIPv6 or GTPv2) and SWn reference points (i.e. IP Mobility Mode Selection information).\nAdditionally the SWm reference point may also be used to transport DSMIPv6 related mobility parameters in case the UE attaches to the EPC using the S2c reference point. In particular, in this case the SWm reference point may be used for conveying the Home Agent IP address or FQDN from the AAA server to the ePDG for Home Agent discovery based on IKEv2 (see TS 24.303 [13]).",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402",
        "ts_24.303"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.1.1",
      "section_id": "7.1.2.1.1",
      "section_title": "General",
      "content": "The authentication and authorization procedure shall be used between the ePDG and 3GPP AAA Server/Proxy. When a PDN connection is activated by the UE an IKEv2 exchange shall be initiated. It shall be invoked by the ePDG, on receipt from the UE of a \"tunnel establishment request\" message. This shall take the form of forwarding an IKEv2 exchange with the purpose of authenticating in order to set up an IKE Security Association (SA) between the UE and the ePDG.\nDuring the Access Authentication and Authorization procedure the ePDG may provide information on its PMIPv6 or GTPv2 capabilities to the 3GPP AAA Server. The 3GPP AAA Server may perform IP mobility mode selection between NBM or HBM as specified in clause 4.1.3.2 of 3GPP TS 23.402 [3]. The 3GPP AAA Server may provide to the ePDG an indication if either NBM or local IP address assignment shall be used. If NBM shall be used, the ePDG then decides the S2b protocol variant to use.\nThe User-Name AVP may contain a decorated NAI (as defined in clause 19.3.3 of 3GPP TS 23.003 [14]). In this case the 3GPP AAA Proxy shall process the decorated NAI and support routing of the Diameter request messages based on the decorated NAI as described in IETF RFC 5729 [37].\nUpon a successful authorization, when NBM is used, the 3GPP AAA server shall return NBM related information back to the ePDG. This information may include the assigned PDN GW, UE IPv6 HNP and/or UE IPv4-HoA.\nUpon a successful authorization, when DSMIPv6 is used, to enable HA address discovery based on IKEv2 (see TS 24.303 [13]), the 3GPP AAA server may also download PDN GW identity to the ePDG.\nThe PDN GW identity is a FQDN and/or IP address of the PDN GW. If a FQDN is provided, the ePDG shall derive it to IP address according to the selected mobility management protocol.\nIf DSMIPv6 is used, a single IKE SA is used for all PDN connections of the user. If PMIPv6 or GTPv2 is used, a separate IKE SA is created for each PDN connection of the user (refer to 3GPP TS 24.302 [26]).\nEach new additional IKE SA shall be handled in a different Diameter session. In such cases, the IP mobility mode selected during the first authentication and authorization procedure is valid for all PDN connections of the user, therefore, dynamic IP mobility mode selection is not executed during the further procedures. The ePDG may select the same or different S2b protocol variant(s) towards different PDN GWs when NBM has been selected.\nBased on local policies, EPC access for emergency services over an untrusted WLAN access is supported as specified in clause 4.5.7.2.1 of 3GPP TS 23.402 [3] for:\n-\tUEs with a valid EPC subscription that are authenticated and authorized for EPC services;\n-\tUEs that are authenticated only;\n-\tUEs with an unauthenticated IMSI; and/or\n-\tUICC-less UEs.\nThe SWm reference point shall perform authentication and authorization based on the reuse of the DER/DEA command set defined in Diameter EAP application, IETF RFC 4072 [5].\nTable 7.1.2.1.1/1: Authentication and Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes, if it contains a NAI other than an Emergency NAI for Limited Service State.\nEAP payload\nEAP-Payload\nM\nThis information element shall contain the encapsulated EAP payload used for the UE - 3GPP AAA Server mutual authentication\nAuthentication Request Type\nAuth-Request- Type\nM\nThis information element shall indicate whether the user is to be authenticated only, authorized only or both. It shall have the value of AUTHORIZE_AUTHENTICATE.\nAPN\nService-Selection\nC\nThis information element shall contain the Network Identifier part of the APN for which the UE is requesting authorization. This AVP shall be present if the ePDG has received an APN from the UE and the UE did not indicate the establishment of an emergency session in the IKEv2 signalling. This AVP shall be absent if the UE indicated the establishment of an emergency session during the IKEv2 tunnel establishment (see clause 7.2.5 of 3GPP TS 24.302 [26]).\nVisited Network Identifier (See 9.2.3.1.2)\nVisited-Network-Identifier\nC\nThis information element shall contain the identifier that allows the home network to identify the Visited Network.\nThis AVP shall be present if the ePDG is not in the UE's home network i.e. the UE is roaming.\nAccess Type\nRAT-Type\nC\nThis information element shall be present if the access type is known by the ePDG. If present, it shall contain the non-3GPP access network access technology type that is serving the UE. When not known by the ePDG, this information element should be present and, in that case, it shall take the value VIRTUAL (1).\nMobility features\nMIP6-Feature-Vector\nO\nThis AVP shall be present, if the handling of any of the flags listed here requires dynamic (i.e. per user) handling for the VPLMN-HPLMN relation of the ePDG and 3GPP AAA Server. If present, the AVP shall contain the mobility features supported by the ePDG. Flags that are not relevant in the actual relation shall be set to zero.\nIf dynamic IP mobility mode selection is used, the PMIP6_SUPPORTED flag and/or the GTPv2_SUPPORTED flag shall be set by the ePDG if PMIPv6 and/or GTPv2 are supported. PMIP6_SUPPORTED flag is defined in IETF RFC 5779 [2].\nThe MIP6_INTEGRATED flag shall be used to indicate to the 3GPP AAA server that the ePDG supports IKEv2 based Home Agent address discovery.\nAAA Failure Indication\nAAA-Failure-Indication\nO\nIf present, this information element shall indicate that the request is sent after the ePDG has determined that a previously assigned 3GPP AAA Server is unavailable.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nUE local IP address\nUE-Local-IP-Address\nO\nThe ePDG shall include this IE based on local policy for Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39].\nThe ePDG may also include this IE, regardless of Fixed Broadband access network interworking.\nIf present, it shall contain the source IPv4 or IPv6 address of the IKE_SA_AUTH message from the UE.\nTerminal Information\nTerminal-Information\nC\nThe ePDG shall include this IE and set it to the user's Mobile Equipment Identity, if this information is available.\nFor an untrusted WLAN access, this grouped AVP shall contain the IMEI AVP and, if available, the Software-Version AVP.\nWhen the RAT type is not known by the ePDG, but the UE has provided the IMEI(SV), this grouped AVP shall contain the IMEI AVP and, if available, the Software-Version AVP.\nEmergency Services\nEmergency-Services\nC\nAn ePDG which supports emergency services shall include this information element, with the Emergency-Indication bit set, if the UE indicated the establishment of an emergency session during the IKEv2 tunnel establishment (see clause 7.2.5 of 3GPP TS 24.302 [26]).\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nBased on operator policy, this information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 7.1.2.1.1/2: Authentication and Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nO\nThis information element, if present, shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes, if it contains a NAI other than an Emergency NAI for Limited Service State.\nEAP payload\nEAP-Payload\nO\nIf present, this information element shall contain the encapsulated EAP payload used for UE - 3GPP AAA Server mutual authentication\nMaster-Session-Key\nEAP-Master-Session-Key\nC\nThis IE shall contain keying material for protecting the communication between the user and the ePDG. It shall be present when Result Code is set to DIAMETER_SUCCESS.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult code\nResult-Code / Experimental-Result-Code\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]) or as per in NASREQ (see IETF RFC 4005 [4].\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be sent if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nMobility Capabilities\nMIP6-Feature-Vector\nO\nThis AVP shall be present if it was received in the authentication and authorization request and the authentication and authorization succeeded. It shall contain the authorized mobility features. Flags that are not relevant in the actual relation shall be set to zero.\nThe PMIP6_SUPPORTED flag and/or the GTPv2_SUPPORTED flag shall be set to indicate that NBM (PMIPv6 or GTPv2) is to be used. The ASSIGN_LOCAL_IP flag shall be set to indicate that a local IP address is to be assigned.\nThe MIP6_INTEGRATED flag shall be set if a Home Agent address is provided for IKEv2 based Home Agent address discovery. In the latter case HA information for IKEv2 discovery is provided via the APN-Configuration AVP.\nAPN-OI replacement\nAPN-OI-Replacement\nC\nThis AVP shall indicate the domain name to replace the APN-OI in the non-roaming case or in the home routed roaming case when constructing the PDN GW FQDN upon which it needs to perform a DNS resolution. See 3GPP TS 23.003 [3]. It shall only be included if NBM is used, the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS and the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request.\nThe APN-Configuration is a grouped AVP, defined in 3GPP TS 29.272 [29]. When NBM is used, the following information elements per APN may be included:\n- APN\n- APN-AMBR\n- Authorized 3GPP QoS Profile\n- User home IP Address (if static IPv4 and/or IPv6 is allocated to the UE's subscribed APN)\n- Allowed PDN types\n- PDN GW identity (if the PDN connection was active in case of HO, or if there is a static PDN GW allocated to the UE's subscribed APN)\n- PDN GW allocation type\n- VPLMN Dynamic Address Allowed\n- Visited Network Identifier\n- Interworking-5GS-Indicator\nWhen local IP address assignment is used, this AVP shall only be present if IKEv2 based Home Agent discovery is used and\n- if the PDN connection was active in case of HO, or\n- if there is static PDN GW allocated to the UE's subscribed APN, or\n- if the 3GPP AAA Server/Proxy selects the PDN GW based on the identity of the ePDG\nIn these cases, the following information elements shall be included:\n- HA-APN (Home Agent APN as defined in 3GPP TS 23.003 [14])\n- PDN GW identity\nNOTE 1.\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is used to download the trace activation from the HSS to the ePDG.\nOnly the Trace-Data AVP shall be included to the Trace-Info AVP and\nshall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List, for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nMSISDN\nSubscription-ID\nC\nThis AVP shall contain the MSISDN of the UE and shall be sent only if it is available.\nSession time\nSession-Timeout\nC\nIf the authorization succeeded, then this IE shall contain the time this authorization is valid for.\nPermanent User Identity\nMobile-Node-Identifier\nC\nThis information element shall be present if NBM is used.\nIf the user is authenticated, it shall contain an AAA/HSS assigned permanent user identity (i.e. IMSI in root NAI format as defined in clause 19 of 3GPP TS 23.003 [14]) to be used by:\n- the MAG in subsequent PBUs as the MN-ID identifying the user in the EPS network for PMIP based S2b,\n- by the ePDG to derive the IMSI to send in subsequent Create Session Request for GTP based S2b.\nFor an emergency PDN connection, if the UE is UICC-less (i.e. the User Identity IE in the request contains an IMEI) or if the IMSI is not authenticated, the Permanent User Identity shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14].\nIf this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nServing GW Address\nMIP6-Agent-Info\nO\nThis AVP shall be used only in chained S2b-S8 cases and it shall be sent only if the Result-Code AVP is set to DIAMETER_SUCCESS.\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nThis information element contains the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nWLAN Location Information\nAccess-Network-Info\nO\nIf present, this IE shall contain the location information of the WLAN Access Network where the UE is attached.\nWLAN Location Timestamp\nUser-Location-Info-Time\nC\nThis IE should be present if the WLAN Location Information IE is present.\nWhen present, this IE shall contain the NTP time at which the UE was last known to be in the location reported in the WLAN Location Information.\nEmergency Info\nEmergency-Info\nC\nThis IE shall only be present if the Result-Code AVP is set to DIAMETER_SUCCESS. When present, it shall contain the identity of the dynamically allocated PDN-GW used for the establishment of emergency PDN connections. It shall be present for a non-roaming authenticated user, if this information was received from the HSS and if the Emergency-Services AVP is present, with the Emergency-Indication bit set, in the Authentication and Authorization Request.\nUE Usage Type\nUE-Usage-Type\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the UE Usage Type of the subscriber.\nCore Network Restrictions\nCore-Network-Restrictions\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the Core Network Restrictions of the subscriber.\nMPS Priority\nMPS-Priority\nC\nBased on operator policy, this information element shall be sent to the ePDG if the UE has an MPS subscription in the HSS.\nNOTE 1:\tIf a static PDN GW allocated to the UE's subscribed APN has been received from the HSS, the 3GPP AAA Server/Proxy shall only provide the static PDN GW identity in the Authentication and Authorization Answer.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402_clause_4.1.3.2",
        "ts_23.003_clause_19.3.3",
        "ts_23.402_clause_4.5.7.2.1",
        "ts_23.003_clause_19",
        "ts_24.302_clause_7.2.5",
        "table_7.1.2.1.1",
        "ts_24.302_table_7.1.2.1.1",
        "ts_23.402",
        "ts_23.003",
        "ts_24.303",
        "ts_24.302",
        "ts_29.229",
        "ts_23.139",
        "ts_29.272",
        "ts_32.422",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.1.2",
      "section_id": "7.1.2.1.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "On receipt of the DER message, the 3GPP AAA Server shall check that the user data exists in the 3GPP AAA Server. If not, the 3GPP AAA Server shall use the procedures defined for the SWx interface to obtain access authentication and authorization data.\nIf the HSS returns DIAMETER_ERROR_USER_UNKWNOWN, the 3GPP AAA Server shall return the same error to the ePDG.\nIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the ePDG with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\nOtherwise, the 3GPP AAA Server shall proceed with the authentication and authorization procedure. The 3GPP AAA Server shall use the procedures defined in SWx interface to obtain authorization data from HSS.\nIf IMEI check is required by operator policy and the ePDG is in the HPLMN, the 3GPP AAA Server shall:\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status with the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Server determines that the authentication and authorization procedure shall be stopped, it shall respond to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the ePDG included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nIf the user does not have non-3GPP access subscription, then 3GPP AAA Server shall respond to the ePDG with Experimental-Result-Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION.\nIf a Visited- Network-Identifier is present in the request and if the user is not allowed to roam in the visited network, then the 3GPP AAA Server shall return Experimental-Result-Code set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED.\nIf the user is not allowed to use the current access type, then the 3GPP AAA Server shall return Experimental-Result-Code set to DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\nOtherwise the 3GPP AAA Server shall run EAP-AKA as specified in 3GPP TS 33.402 [19]. Exceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authentication information shall be returned.\nUpon receiving the authentication and authorization request from the ePDG, the 3GPP AAA Server marks the trust relationship as \"untrusted\" with the User Identity. If the 3GPP AAA Server detects that an S6b session already exists for this UE and the S6b session was established as a result of an authentication request for DSMIPv6, the 3GPP AAA Server shall send the trust relationship to the PDN GW as specified in clause 9.1.2.5.\nOnce authentication is successfully completed, the 3GPP AAA Server shall perform the following authorization checking (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error code):\n1)\tCheck if the user is barred to use the non 3GPP Access. If it is so, then the Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED\n2)\tCheck whether the user is barred to use the subscribed APNs. If it is so, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n3)\tif the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request, check if there was request for an APN received. If not, the default APN of the user is selected to be used during the actual authentication and authorization procedure.\n4)\tif the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authentication and Authorization Request, check if user has a subscription for the requested APN or for the wildcard APN. If not, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION\n5)\tIf present, check the flags of the received MIP6-Feature-Vector AVP: The evaluation of the flags is executed only in the first authentication and authorization procedure for the user after an initial attach or handover, in all the subsequent procedures, the AAA Server shall insert the same values.\n-\tIf the MIP6_INTEGRATED flag is set and the 3GPP AAA server has authorized IKEv2 Home Agent assignment, the 3GPP AAA server shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag set. In this case, the 3GPP AAA Sever may select the Home Agent based on the identity of the ePDG as included in the Origin-Host AVP in the authentication and authorization request if no static PDN GW identity is received from the HSS. If the HA assignment via IKEv2 is not used, the MIP6-Feature-Vector AVP with the MIP6_INTEGRATED flag not set shall be sent.\n-\tThe PMIP6_SUPPORTED and/or GTPv2_SUPPORTED flag indicates to the 3GPP AAA server whether the ePDG supports NBM or not. As specified in 3GPP TS 23.402 [3], based on the information it has regarding the UE (see 3GPP TS 24.302 [26]), local/home network capabilities and local/home network policies, the 3GPP AAA server may perform mobility mode selection. If the 3GPP AAA server decides that NBM should be used, the PMIP6_SUPPORTED and GTPv2_SUPPORTED flags shall be set in the response to indicate the NBM support of the UE to the ePDG. If only the PMIP6_SUPPORTED or the GTPv2_SUPPORTED flag is present in the response, the ePDG shall assume that this also indicates the NBM support of the UE to the ePDG and the ePDG may select any S2b protocol variant (PMIPv6 or GTPv2). If the 3GPP AAA server decides that a local IP address should be assigned, the ASSIGN_LOCAL_IP flag shall be set in the response to indicate to the ePDG that a local IP address should be assigned.\nNOTE 1:\tWhen selecting DSMIPv6, the AAA server assumes that the ePDG has the capability to assign a local IP address to the UE.\n-\tThe 3GPP AAA server shall not set the PMIP6_SUPPORTED/GTPv2_SUPPORTED and ASSIGN_LOCAL_IP flags both at the same time in the response.\nUpon successful authentication and authorization, the Result-Code shall be set to DIAMETER_SUCCESS and:\n-\tif the Emergency-Indication bit of the Emergency-Services AVP was not set in the Authentication and Authorization Request, the 3GPP AAA Server shall return user data relevant to the APN as received from the HSS. If the requested APN received from UE is authorized by the wildcard APN, the 3GPP AAA Server shall include the wildcard APN in the Service-Selection AVP of the APN-Configuration AVP;\n-\tif the Emergency-Services AVP was present, with the Emergency-Indication bit set, in the Authentication and Authorization Request, the 3GPP AAA Server shall include the Emergency Info IE if this information was received from the HSS and the user is not roaming.\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nFor Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39], the 3GPP AAA server shall determine if the UE is connected via a BBF-defined WLAN access according to the UE local IP address in UE-Local-IP-Address AVP from the ePDG. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA server shall perform the enabling UE reflective QoS function as specified in 3GPP TS 24.139 [43].\nThe 3GPP AAA Server shall interpret the receipt of the Emergency-Services AVP, with the Emergency-Indication bit set, as an indication that the UE requests to access the EPC for emergency services.\nThe 3GPP AAA Server shall give preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload.\nIf the 3GPP AAA Server has WLAN Location Information about the UE, the 3GPP AAA Server shall provide it to the ePDG, along with the WLAN Location Timestamp if available (see clause 4.1.2.1.2).\nIf the 3GPP AAA Server supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]), the 3GPP AAA Server shall proceed as specified above, but with the following modifications, for an Emergency Attach:\n1)\tif the UE does not have an IMSI:\n-\tif local policies allow emergency sessions for all UEs, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authentication and authorization data, skip the authorization checkings and authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set to DIAMETER_ERROR_USER_UNKNOWN.\n2)\tif the UE has an IMSI but the IMSI is not authenticated:\n-\tif local policies allow emergency sessions for unauthenticated UEs with an IMSI, the 3GPP AAA Server shall skip the procedures defined for the SWx interface to obtain access authorization data, shall skip the authorization checkings and shall return an answer with the DIAMETER_ERROR_USER_UNKWNOWN Result-Code to the ePDG to request the UE to provide its IMEI as specified in clause 13.3 of 3GPP TS 33.402 [19].\nNOTE 2:\tAccording to the procedure specified in clause 7.4.4 of 3GPP TS 24.302 [26], this results in an ePDG, that is configured to support unauthenticated emergency session over WLAN and Mobile Equipment Identity signalling over untrusted WLAN, to query the UE's IMSI and to initiate a new Authentication and Authorization procedure with the same parameters as provided in the first Authentication and Authorization Request but with the addition of the UE's IMEI in the Terminal-Information AVP.\nIf the Authentication and Authorization Request also included the UE's IMEI (i.e. new authentication and authorization procedure after the ePDG queried the UE), the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services. The Permanent User Identity IE in the answer shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14];\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authentication failures in this clause.\n3)\tif the UE has an authenticated IMSI but the UE is not authorized to access the EPC:\n-\tif local policies allow emergency sessions for any authenticated UE, the 3GPP AAA Server shall authorize the UE to access to EPC for emergency services;\n-\totherwise the 3GPP AAA Server shall reject the request with the Experimental-Result-Code set as specified for authorization failures in this clause.\nIf 3GPP AAA Server receives a DER command from the ePDG containing a High-Priority-Access-Info AVP with the HPA_Configured bit set, if allowed by operator policy, the 3GPP AAA Server shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nNOTE 3:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the 3GPP AAA Server has successfully authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent messages with priority.\nNOTE 4:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the ePDG indicates high priority access or the HSS has indicated an MPS subscription for the UE.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set with the DEA command if the HSS has indicated an MPS subscription for the UE.\nThe 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives a DER command from the ePDG without a High-Priority-Access-Info AVP with the HPA_Configured bit set and the last Non-3GPP-User-Data AVP from the HSS did not contain an MPS-Priority AVP with the MPS-EPS-Priority bit set.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_11",
        "clause_9.1.2.5",
        "clause_4.1.2.1.2",
        "ts_23.402_clause_4.5.7.2",
        "ts_23.003_clause_19",
        "ts_33.402_clause_13.3",
        "ts_24.302_clause_7.4.4",
        "clause_8.1.2.3.3",
        "ts_33.402",
        "ts_23.402",
        "ts_24.302",
        "ts_23.139",
        "ts_24.139",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.1.3",
      "section_id": "7.1.2.1.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy shall be required to handle roaming cases in which the ePDG is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy with the following additions.\nIf IMEI check is required by operator policy and the ePDG is in the VPLMN, the 3GPP AAA Proxy shall:\n-\tif the IMEI(SV) is available, check the Mobile Equipment's identity status with the EIR, using the ME Identity Check procedure (see clause 11);\n-\tupon getting the IMEI check result from the EIR, determine whether to continue or stop the authentication and authorization procedure;\n-\tif the IMEI(SV) is not available, determine whether to continue or stop the authentication and authorization procedure based on operator policy;\n-\tif the 3GPP AAA Proxy determines that the authentication and authorization procedure shall be stopped, it shall:\n-\trespond to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT, and\n-\tsend a SWm Session Termination Request towards the 3GPP AAA Server (see clause 7.1.2.3).\nSpecific operator policies may be configured for emergency services, regarding whether to check the IMEI and, if the IMEI needs to be checked, whether to continue or stop the authentication and authorization procedure upon getting the IMEI check result or when the IMEI(SV) is not available.\nOn receipt of the first authentication and authorization request, the 3GPP AAA Proxy shall check locally configured information whether users from the HPLMN are allowed to activate a PDN connection from the non-3GPP access network via this (V)PLMN. If not, the Experimental-Result-Code shall be set to DIAMETER_ERROR_ROAMING_NOT_ALLOWED and the authentication response shall be sent to the ePDG.\nOn receipt of the authentication and authorization answer that completes a successful authentication, the 3GPP AAA Proxy\n-\tmay check locally configured information about using the chained S8-S2b option towards the given HPLMN. If chaining is required, the 3GPP AAA Proxy shall select a Serving GW from its network configuration database and shall include the Serving GW address in the response.\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).\n-\tmay select the Home Agent based on the identity of the ePDG as included in the Origin-Host AVP in the authentication and authorization request if IKEv2 based Home Agent discovery is used and VPLMN Dynamic Address Allowed AVP is received. In this case, the 3GPP AAA proxy shall include the Home Agent addresses in the APN-Configuration AVP in the response and the MIP6-Feature-Vector AVP with the MIP6-INTEGRATED flag set if no static PDN GW identity is received from the 3GPP AAA Server.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_11",
        "clause_7.1.2.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.1.4",
      "section_id": "7.1.2.1.4",
      "section_title": "ePDG Detailed Behaviour",
      "content": "The ePDG shall initiate a new authentication and authorization procedure for each new IKE_SA. Each IKE_SA shall be handled in a different session.\nThe ePDG shall set flags signalling its capabilities to the same value in all authentication and authorization procedure for the same user (include the same MIP6-Feature-Vector). During the second and further authentication and authorization procedures, the ePDG shall discard the flag values received from the AAA Server and reuse the values received during the first procedure executed for the user.\nAn ePDG which supports emergency services shall include the Emergency-Services AVP, with the Emergency-Indication bit set, if the UE indicated the establishment of an emergency session during the IKEv2 tunnel establishment (see clause 7.2.5 of 3GPP TS 24.302 [26]).\nFor PMIPv6/GTPv2 based S2b, when receiving a Serving GW address in an authentication response, the ePDG shall check, whether it has already a Serving GW address stored for the user.\n-\tIf it has no Serving GW address available, it shall store the received value and use it as LMA address when creating PMIP bindings.\n-\tIf it has already a stored Serving GW address value, it shall ignore the received SGW-Address AVP.\nNOTE 1:\tIn case of untrusted access, there is an authentication session started for all PDN connection setup requests of a user. These sessions may invoke different 3GPP AAA Proxies, which in turn may assign different Serving GWs to the user. The ePDG behaviour ensures that in spite of this possibility, the same Serving GW is used for all PDN connections of the user.\nNOTE 2:\tThe ePDG knows if NBM is used or if a local IP address is assigned based on the flags in the MIP6-Feature-Vector or based on preconfigured information. If the PMIP6_SUPPORTED and/or the GTPv2_SUPPORTED flag is set in the MIP6-Feature-Vector received from the 3GPP AAA Server, the ePDG knows that NBM is used.\nFor PMIPv6/GTPv2 based S2b and a PDN connection other than for emergency services, the ePDG shall utilize the downloaded APN configuration data to authorize the UE requested home address types: IPv4 home address and/or IPv6 home network prefix.\nFor GTPv2 based S2b and a PDN connection for emergency services, the ePDG shall ignore APN configuration data received from the 3GPP AAA Server and shall use its Emergency Configuration Data to determine the APN to be associated with the emergency PDN connection and possibly the PGW to use (see clause 4.5.7.2 of 3GPP TS 23.402 [3]). During a handover of an emergency PDN connection to an untrusted WLAN access, the ePDG shall use the PGW identified in the Emergency Info IE if this information is received from the 3GPP AAA Server, the user is a non-roaming authenticated user and the ePDG is configured to use a dynamic PGW for emergency services for such users.\nThe ePDG may use the Visited_Network_Identifier to determine the S2b protocol type (PMIPv6 or GTPv2). The ePDG may be configured with the S2b protocol variant(s) on a per HPLMN granularity, or may retrieve information regarding the S2b protocol variants supported by the PDN GW (PMIPv6 or/and GTPv2) from the Domain Name Service Function as described in 3GPP TS 29.303[34]. If the ePDG supports Dedicated Core Networks and received the UE-Usage-Type from the 3GPP AAA Server, the ePDG shall select the PGW as specified in clause 5.8 of 3GPP TS 29.303 [34].\nThe ePDG shall select a SMF+PGW-C for PDN connections that may be subject to mobility to 5GS, e.g. for UEs supporting N1 mode (see 3GPP TS 24.302 [26]) and not restricted to interworking with 5GS by user subscription (i.e. \"5GC not allowed\" bit within Core-Network-Restrictions AVP is not set and Interworking-5GS-Indicator AVP is set to \"SUBSCRIBED\" value) as specified in clause 5.12.3 of 3GPP TS 29.303 [34].\nIf GTPv2 is used on S2b and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user.\nIf DSMIPv6 is used and if ePDG has received the PGW identity in form of the FQDN from the 3GPP AAA server, then the ePDG may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf the ePDG determines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the ePDG receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.\nThe ePDG shall give preferential treatment to UEs which access the EPC for emergency services, e.g. in scenarios including network overload.\nThe ePDG shall store the WLAN Location Information associated with the UE when it receives such information from the 3GPP AAA Server.\nIf IMEI check is required by operator policy, the ePDG shall be configured to retrieve the IMEI(SV) from the UE (as specified in 3GPP TS 23.402 [26]) during the authentication and authorization procedure.\nIf the ePDG supports IMS Emergency sessions over WLAN (see clause 4.5.7.2 of 3GPP TS 23.402 [3]) and if local policies in the ePDG allows unauthenticated emergency sessions, the ePDG shall proceed during an Emergency Attach for a UE without a UICC or with an unauthenticated IMSI as specified above with the following modifications:\n1)\tIf the UE is UICC-less, the User Identity IE in the Authentication and Authorization Request shall contain the IMEI in Emergency NAI for Limited Service State format as defined in clause 19 of 3GPP TS 23.003 [14].\n2)\tIf the User Identity IE does not contain an IMEI (i.e. the UE has an IMSI), the ePDG shall request the IMEI from the UE as specified in clause 13.3 of 3GPP TS 33.402 [19] and clause 7.4.4 of 3GPP TS 24.302 [26] and include the IMEI in the Terminal-Information AVP in the next Authentication and Authorization Request message.The Authentication and Authorization Request in step 8 of clause 13.3 of 3GPP TS 33.402 [19] (i.e. after querying the UE's IMSI) shall contain the same parameters as provided in the first Authentication and Authorization Request (step 3) but with the addition of the IMEI in the Terminal-Information AVP.\nNOTE 3:\tThe IMEI cannot be signalled to the 3GPP AAA Server in the first Authentication and Authorization Request sent to the 3GPP AAA Server, since the ePDG requests the IMEI to the UE in the first IKE_AUTH_Response message after getting the first Authentication and Authorization Answer from the 3GPP AAA Server.\nNOTE 4:\tThe Authentication and Authorization Requests in steps 3 and 8 of clause 13.3 of 3GPP TS 33.402 [19] are handled independently from each other by the 3GPP AAA Server.\n3)\tIf the Permanent User Identity IE in the answer contains an IMEI based NAI but the User Identity IE in the request did not contain an IMEI based NAI, the ePDG shall derive that the IMSI was not authenticated and proceed accordingly with the setup of the Emergency PDN connection over S2b (see 3GPP TS 29.274 [38]).\nWhen sending a DER command to the 3GPP AAA Server, if the ePDG had received an indication that the UE has access priority in an IKE_AUTH request message as described in 3GPP TS 24.302 [26] and if allowed by operator policy, the ePDG shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set, to the DER command.\nIf the ePDG receives a DEA command with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the ePDG shall treat the message and all subsequent messages (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The ePDG shall discontinue priority treatment for the UE if the ePDG receives a DEA command without an MPS-Priority AVP with the MPS-EPS-Priority bit set and ePDG has not received an indication that the UE has access priority from the UE in an IKE_AUTH request message as described in 3GPP TS 24.302 [26].\nNOTE 5:\tThe ePDG treats the UE with priority if either the indication that the UE has access priority in an IKE_AUTH request message or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.302_clause_7.2.5",
        "ts_23.402_clause_4.5.7.2",
        "ts_29.303_clause_5.8",
        "ts_29.303_clause_5.12.3",
        "ts_23.003_clause_19",
        "ts_33.402_clause_13.3",
        "ts_33.402_clause_7.4.4",
        "ts_24.302_clause_7.4.4",
        "ts_24.302",
        "ts_23.402",
        "ts_29.303",
        "ts_29.274",
        "ts_23.003",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.2.1",
      "section_id": "7.1.2.2.1",
      "section_title": "General",
      "content": "This procedure shall be used between the ePDG and 3GPP AAA Server and Proxy. It shall be invoked by the ePDG, upon receipt of a valid Re-Authorization Request message from the 3GPP AAA Server (see clause 7.1.2.5). It may also be initiated by the ePDG, when the ePDG detects a change of the outer IP address of the UE, to:\n-\tupdate the 3GPP AAA Server with the new UE local IP address; and\n-\tretrieve the most up to date WLAN Location Information stored at the 3GPP AAA Server, when the 3GPP AAA server has sent WLAN Location Information during the initial Authentication and Authorization procedure (see clause 4.5.7.2.8 of 3GPP TS 23.402 [3]).\nThis procedure shall be used by the ePDG to update the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example, removal of a specific APN associated with the subscriber, or change of the identity of a dynamically allocated PDN GW, see clause 8.1.2.3).\nThis procedure is mapped to the Diameter command codes AA-Request (AAR) and AA-Answer (AAA) specified in RFC 4005 [4]. Information element contents for these messages are shown in tables 7.1.2.2.1/1 and 7.1.2.2.1/2.\nTable 7.1.2.2.1/1: SWm Authorization Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRequest Type\nAuth-Request -Type\nM\nThis information element shall contain the type of request. It shall have the value AUTHORIZE_ONLY.\nAAR Flags\nAAR-Flags\nO\nThis IE contains a bit mask. See 7.2.3.5 for the meaning of the bits.\nThis IE may be present and indicate that the ePDG requests to retrieve the most up to date WLAN Location Information of the UE, if the ePDG received the WLAN Location Information during the initial Authentication and Authorization procedure.\nUE local IP address\nUE-Local-IP-Address\nC\nThis IE shall be present if the ePDG provided the UE Local IP address in the initial Authentication and Authorization Request and the UE Local IP address has changed.\nHigh Priority Access Info\nHigh-Priority-Access-Info\nC\nBased on operator policy, this information element shall be sent to the 3GPP AAA Server if the UE has access priority as described in 3GPP TS 24.302 [26].\nTable 7.1.2.2.1/2: SWm Authorization Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15], and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRequest Type\nAuth-Request -Type\nM\nIt shall contain the value AUTHORIZE_ONLY. See IETF RFC 4072 [5].\nRegistration Result\nResult-Code/ Experimental Result Code\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]) or as per in NASREQ (see IETF RFC 4005 [4]).\nUE IPv4 Home Address\nPMIP6-IPv4-Home-Address\nO\nIf the authorization succeeded, and the user has an IPv4-HoA statically defined as part of his profile data, then this IE may be present. It shall contain the IPv4-HoA allocated and assigned to the UE.\nAPN-OI replacement\nAPN-OI-Replacement\nC\nThis AVP shall indicate the domain name to replace the APN-OI in the non-roaming case or in the home routed roaming case when constructing the PDN GW FQDN upon which it needs to perform a DNS resolution. See 3GPP TS 23.003 [3]. It shall only be included if NBM is used, the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, and the Result-Code AVP is set to DIAMETER_SUCCESS.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS and the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request.\nAPN-Configuration is a grouped AVP, defined in 3GPP TS 29.272 [29]. When NBM is used, the following information elements per APN may be included:\n- APN\n- APN-AMBR\n- Authorized 3GPP QoS profile\n- Statically allocated User IP Address (IPv4 and/or IPv6)\n- Allowed PDN types\n- PDN GW identity\n- PDN GW allocation type\n- VPLMN Dynamic Address Allowed\n- Visited Network Identifier\n- Interworking-5GS-Indicator\nWhen local IP address assignment is used, this AVP shall only be present if IKEv2 based Home Agent discovery is used and\n- if the PDN connection was active in case of HO, or\n- if there is static PDN GW allocated to the UE's subscribed APN.\nIn these cases, the following information elements shall be included:\n- HA-APN (Home Agent APN as defined in 3GPP TS 23.003 [14])\n- PDN GW identity\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is used to download the trace activation from the HSS to the ePDG.\nOnly the Trace-Data AVP shall be included if trace activation is requested. Only the Trace-Reference AVP shall be included if trace deactivation is requested.\nIf the Trace-Data AVP is included, it shall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List, for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nMSISDN\nSubscription-ID\nC\nThis AVP shall contain the MSISDN of the UE and shall be sent only if it is available.\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nIf present, this information element shall contain the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\nSession time\nSession-Timeout\nC\nIf the authorization succeeded, then this IE shall contain the time this authorization is valid for.\nWLAN Location Information\nAccess-Network-Info\nO\nIf present, this IE shall contain the location information of the WLAN Access Network where the UE is attached.\nWLAN Location Timestamp\nUser-Location-Info-Time\nC\nThis IE should be present if the WLAN Location Information IE is present.\nWhen present, this IE shall contain the NTP time at which the UE was last known to be in the location reported in the WLAN Location Information.\nCore Network Restrictions\nCore-Network-Restrictions\nC\nThis IE shall be present if this information is available in the user subscription. When present, this IE shall contain the Core Network Restrictions of the subscriber.\nMPS Priority\nMPS-Priority\nC\nBased on operator policy, this information element shall be sent to the ePDG if the UE has an MPS subscription in the HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_7.1.2.5",
        "ts_23.402_clause_4.5.7.2.8",
        "clause_8.1.2.3",
        "ts_23.003_clause_19",
        "table_7.1.2.2.1",
        "ts_24.302_table_7.1.2.2.1",
        "ts_23.402",
        "ts_23.003",
        "ts_24.302",
        "ts_29.272",
        "ts_32.422",
        "ts_29.061"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.2.2",
      "section_id": "7.1.2.2.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall process the steps in the following order (if there is an error in any of the steps, the 3GPP AAA Server shall stop processing and return the corresponding error code):\n1)\tCheck that the user exists in the 3GPP AAA Server. The check shall be based on Diameter Session-id and User Name. If the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2)\tIf the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, check whether the user is allowed to access the APN. If not, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.\n3)\tThe Result-Code shall be set to DIAMETER_SUCCESS and, if the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, the 3GPP AAA Server shall return user data relevant to the APN as received from the HSS.\n4)\tIf the WLAN-Location-Info-Request bit is set to 1 in the AAR-Flags AVP and if the 3GPP AAA Server knows the WLAN Location Information of the UE, the 3GPP AAA Server shall provide it to the ePDG, along with the WLAN Location Timestamp if available (see clause 4.1.2.1.2).\nIf the Emergency-Indication bit of the Emergency-Services AVP was not set in the initial Authentication and Authorization Request, once the Authentication and Authorization procedure successfully finishes, the 3GPP AAA Server shall download, together with authentication data, the list of authorized APNs and the authorized mobility protocols in the authentication and authorization response from the HSS (see SWx procedure in Clause 8.1.2.1).\nExceptions to the cases specified here shall be treated by 3GPP AAA Server as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization information shall be returned.\nIf the 3GPP AAA Server answers with DIAMETER_AUTHORIZATION_REJECTED, it shall terminate locally the associated SWm Diameter session.\nIf 3GPP AAA Server receives an AAR command from the ePDG containing a High-Priority-Access-Info AVP with the HPA_Configured bit set, if allowed by operator policy, the 3GPP AAA Server shall treat the message and all subsequent messages (if re-authentication is successful) for the UE with priority as specified in Annex C and Annex D.\nNOTE 1:\tAlternatively, the 3GPP AAA Server can give priority to this UE after the 3GPP AAA Server has successfully re-authenticated the UE as described in clause 8.1.2.3.3, at which time the 3GPP AAA Server handles all subsequent messages with priority.\nNOTE 2:\tThe 3GPP AAA Server treats the UE with priority if either the AAR command from the ePDG indicates high priority access or the HSS has indicated an MPS subscription for the UE.\nBased on operator policy, the 3GPP AAA Server shall include the MPS-Priority AVP with the MPS-EPS-Priority bit set within the AAA command if the HSS has indicated an MPS subscription for the UE in its Non-3GPP-User-Data AVP with the MPS-Priority AVP with the MPS-EPS-Priority bit set.\nThe 3GPP AAA Server shall discontinue priority treatment for the UE if the 3GPP AAA Server receives an AAR command from the ePDG that does not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set and the last Non-3GPP-User-Data AVP from the HSS did not contain the MPS-Priority AVP with the MPS-EPS-Priority bit set.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_4.1.2.1.2",
        "clause_8.1.2.1",
        "clause_8.1.2.3.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.2.3",
      "section_id": "7.1.2.2.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy shall be required to handle roaming cases in which the ePDG is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy, with the following extensions.\nOn receipt of the authorization answer, the 3GPP AAA Proxy:\n-\tShall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tShall record the state of the connection (i.e. Authorization Successful).\nIf the 3GPP AAA Proxy receives a DIAMETER_AUTHORIZATION_REJECTED response from the 3GPP AAA Server, it shall forward it to the ePDG, and terminate locally the associated SWm Diameter session.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.2.4",
      "section_id": "7.1.2.2.4",
      "section_title": "ePDG Detailed Behaviour",
      "content": "Upon receipt of a valid Re-Authorization Request message from the 3GPP AAA Server, the ePDG shall initiate the authorization procedure after successfully completing the authentication of the user. The ePDG shall initiate a separate authorization session for each IKE_SA of the user. When initiated by the ePDG to retrieve the most up to date WLAN Location Information stored at the 3GPP AAA Server, the ePDG shall initiate the authorization procedure for one IKE_SA of the user.\nIf NBM is used, at successful completion of the procedure, the ePDG shall store the APN configuration data received from the 3GPP AAA Server. The ePDG shall utilize these data to authorize the requested home address types: IPv4 home address and/or IPv6 home network prefix.\nNOTE 1:\tThe user will be allowed to create PDN connections only to the subscribed APNs and use the address types that are allowed by the subscribed PDN types.\nUpon receiving the authorization response:\n-\tIf NBM is used and if any other Result-Code than DIAMETER_SUCCESS was received in the response, the ePDG shall release the corresponding PDN connection (PMIPv6 binding or GTPv2 tunnel) and IKE_SA of the user, and terminate locally the associated SWm Diameter session.\n-\tIf DSMIPv6 is used,\n-\tIf any other Result-Code than DIAMETER_SUCCESS was received, the ePDG shall release the corresponding IKE_SA of the user, and terminate locally the associated SWm Diameter session.\n-\tIf the Result-Code DIAMETER_SUCCESS was received in the response, the ePDG shall update the previously provided authorization parameters.\nNOTE 2:\tThe ePDG knows if NBM is used or if a local IP address is assigned based on the flags in the MIP6-Feature-Vector received during the initial authentication and authorization procedure or based on preconfigured information. If the PMIP6_SUPPORTED and/or the GTPv2_SUPPORTED flag are set in the MIP6-Feature-Vector received from the 3GPP AAA Server, the ePDG knows that NBM is used.\nIf GTPv2 is used on S2b and if the Trace-Info AVP including Trace-Data has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Activation message (see 3GPP TS 29.274 [38]) to the PGW to start a trace session for the user. If the Trace-Info AVP including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the ePDG shall send a GTPv2 Trace Session Deactivation message to the PGW to stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nIf DSMIPv6 is used and if ePDG has received the PGW identity in form of the FQDN from the 3GPP AAA server, then the ePDG may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nThe ePDG shall store the WLAN Location Information associated with the UE when it receives such information from the 3GPP AAA Server. The ePDG shall delete any stored WLAN Location Information associated with the UE when it receives from the 3GPP AAA Server an Authorization Answer not including any WLAN Location Information and the WLAN-Location-Info-Request bit was set to 1 in the AAR-Flags AVP.\nThe ePDG shall select a SMF+PGW-C for PDN connections that may be subject to mobility to 5GS, e.g. for UEs supporting N1 mode (see 3GPP TS 24.302 [26]) and not restricted to interworking with 5GS by user subscription ( i.e. \"5GC not allowed \" bit within Core-Network-Restrictions AVP is not set and Interworking-5GS-Indicator AVP is set to \"SUBSCRIBED\" value) as specified in clause 5.12.3 of 3GPP TS 29.303 [34].\nThe ePDG may trigger the Detach Procedure (see 3GPP TS 23.402 [3]), if the Core-Network-Restrictions AVP is changed to restrict to connect to current network due to the non-3GPP subscriber profile is changed.\nWhen sending an AAR command to the 3GPP AAA Server, if the ePDG had received an indication that the UE has access priority in an IKE_AUTH request message as described in 3GPP TS 24.302 [26] and if allowed by operator policy, the ePDG shall add a High-Priority-Access-Info AVP with the HPA_Configured bit set, to the AAR command.\nIf the ePDG receives an AAA command with the MPS-Priority AVP with the MPS-EPS-Priority bit set, the ePDG shall treat the command and all subsequent commands (if authentication is successful) for the UE with priority as specified in Annex C and Annex D. The ePDG shall discontinue priority treatment for the UE if the ePDG receives an AAA command without an MPS-Priority AVP with the MPS-EPS-Priority bit set and the ePDG has not received an indication that the UE has access priority from the UE in an IKE_AUTH message as described in 3GPP TS 24.302 [26].\nNOTE 3:\tThe ePDG treats the UE with priority if either the indication that the UE has access priority in an IKE_AUTH request message is received or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.303_clause_5.12.3",
        "ts_29.274",
        "ts_32.422",
        "ts_29.303",
        "ts_24.302",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.3.1",
      "section_id": "7.1.2.3.1",
      "section_title": "General",
      "content": "The SWm reference point allows the ePDG to inform the 3GPP AAA Server/Proxy about the termination of an IKE_SA between UE and ePDG, and that therefore the mobility session established on the ePDG for all associated PDN connections are to be removed.\nThe SWm Session Termination Request procedure shall be initiated by the ePDG to the 3GPP AAA Server which shall remove associated non-3GPP Access information. The AAA Server shall then return the SWm Session Termination Answer containing the result of the operation. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nTable 7.1.2.3.1/1: SWm Session Termination Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nTermination Cause\nTermination-Cause\nM\nThis information element shall contain the reason for the disconnection.\nTable 7.1.2.3.1/2: SWm Session Termination Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code\nM\nThis IE shall contain the result of the operation.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_7.1.2.3.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.3.2",
      "section_id": "7.1.2.3.2",
      "section_title": "3GPP AAA Server Detailed Behavior",
      "content": "Upon reception of the Session Termination Request message from the ePDG, the 3GPP AAA Server shall check that there is an ongoing session associated to the two parameters received (Session-Id and User-Name).\nIf an active session is found and it belongs to the user identified by the User-Name parameter, the 3GPP AAA Server shall release the session resources associated to the specified session and a Session Termination Response shall be sent to the ePDG, indicating DIAMETER_SUCCESS.\nOtherwise, the 3GPP AAA Server returns a Session Termination Response with the Diameter Error DIAMETER_UNKNOWN_SESSION_ID.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.3.3",
      "section_id": "7.1.2.3.3",
      "section_title": "3GPP AAA Proxy Detailed Behavior",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the ePDG is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the ePDG, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the ePDG, and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.4.1",
      "section_id": "7.1.2.4.1",
      "section_title": "General",
      "content": "The SWm reference point shall allow the 3GPP AAA Server to request the termination of an IKE_SA between UE and ePDG, and therefore the termination of all mobility session established for all associated PDN connections.\nIf the user has several accesses (IKE_SA) active at an ePDG, a separate Session Termination procedure shall be initiated for each of them.\nThe procedure shall be initiated by the 3GPP AAA Server. This procedure is based on the reuse of NASREQ IETF RFC 4005 [4] ASR, ASA, STR and STA commands.\nTable 7.1.2.4.1/1: SWm Abort Session Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuth-Session-State\nAuth-Session-State\nO\nIf present, this information element indicates to the ePDG whether the 3GPP AAA Server requires an STR message.\nTable 7.1.2.4.1/2: SWm Abort Session Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code\nM\nThis IE shall contain the result of the operation.\nTable 7.1.2.4.1/3: SWm Session Termination Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nTermination-Cause\nTermination-Cause\nM\nThis information element shall contain the reason why the session was terminated. It shall be set to \"DIAMETER_ADMINISTRATIVE\" to indicate that the session was terminated in response to an ASR message.\nTable 7.1.2.4.1/4: SWm Session Termination Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult-Code\nResult-Code\nM\nThis IE shall contain the result of the operation.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_7.1.2.4.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.4.2",
      "section_id": "7.1.2.4.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall make use of this procedure to instruct the ePDG to terminate the IKE_SA between UE and ePDG.\nIn the DSMIPv6 case, the 3GPP AAA Server shall initiate first the detach procedure over the S6b reference point towards the PDN GW. When this process has finalized, the 3GPP AAA Server can initiate the termination of the IKE_SA towards the ePDG.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the ePDG. If it does require a STR from the ePDG, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nOn receipt of the ASR command, the ePDG shall check if there is an ongoing session associated with the received Session-Id. If an active session is found and it belongs to the user identified by the User-Name parameter, the ePDG shall terminate the associated IKE_SA between UE and ePDG and return an ASA to the 3GPP AAA Server with the Result-Code to DIAMETER_SUCCESS. Otherwise, the ePDG shall return an ASA to the 3GPP AAA Server with the Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.\nOn receipt of the ASA with a Result-Code of DIAMETER_SUCCESS, the 3GPP AAA Server shall release any local resources associated with the specified session.\nIf required by the 3GPP AAA Server, the ePDG shall send an STR with the Termination-Cause set to DIAMETER_ADMINISTRATIVE. The 3GPP AAA Server shall set the Result-Code to DIAMETER_SUCCESS and return the STA command to the ePDG.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.4.3",
      "section_id": "7.1.2.4.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "When the 3GPP AAA Proxy receives the ASR from the 3GPP AAA Server it shall route the request to the ePDG.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the ePDG onto the 3GPP AAA Server and shall return an STA command to the ePDG with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the ASA message with Diameter Result Code set to DIAMETER_SUCCESS, the 3GPP AAA Proxy shall route the successful response to the 3GPP AAA Server and shall release any local resources associated with the session.\nWhen the 3GPP AAA Proxy receives the STR from ePDG, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the ePDG.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.5.1",
      "section_id": "7.1.2.5.1",
      "section_title": "General",
      "content": "This procedure shall be used between the 3GPP AAA Server and the ePDG for the purpose of modifying the previously provided authorization parameters. This may happen due to a modification of the subscriber profile in the HSS (for example change of the identity of a dynamically allocated PDN GW, see clause 8.1.2.3).\nThis procedure shall be performed in two steps:\n-\tThe 3GPP AAA Server shall issue an unsolicited re-authorization request towards the ePDG. Upon receipt of such a request, the ePDG shall respond to the request and indicate the disposition of the request. This procedure is based on the Diameter commands Re-Auth-Request and Re-Auth-Answer specified in IETF RFC 6733 [58]. Information element contents for these messages shall be as shown in tables 7.1.2.5.1/1 and 7.1.2.5.1/2.\n-\tUpon receiving the re-authorization request, the ePDG shall immediately invoke the authorization procedure specified in 7.1.2.2 for the session indicated in the request. This procedure is based on the Diameter commands AA-Request (AAR) and AA-Answer (AAA) specified in IETF RFC 4005 [4]. Information element contents for these messages are shown in tables 7.1.2.2.1/1 and 7.1.2.2.1/2.\nTable 7.1.2.5.1/1: SWm Authorization Information Update Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRe-Auth Request Type\nRe-Auth-Request-Type\nM\nThis IE shall define whether the user is to be authorized only or authenticated and authorized. AUTHORIZE_ONLY shall be set in this case.\nRouting Information\nDestination-Host\nM\nThis information element shall be obtained from the Origin-Host AVP, which was included in a previous command received from the trusted non-3GPP access.\nTable 7.1.2.5.1/2: SWm Authorization Information Update Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. If this IE contains an identity based on IMSI, this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nResult\nResult-Code\nM\nThis IE shall contain the result of the operation.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_8.1.2.3",
        "ts_23.003_clause_19",
        "table_7.1.2.5.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.1.2.5.2",
      "section_id": "7.1.2.5.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA server shall make use of the re-authorization procedure defined in the Diameter base protocol, IETF RFC 6733 [58] to indicate that relevant service authorization information shall be updated in the ePDG.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.1.2.5.3",
      "section_id": "7.1.2.5.3",
      "section_title": "ePDG Detailed Behaviour",
      "content": "Upon receipt of the Re-authorization Request message from the 3GPP AAA Server or the 3GPP AAA Proxy, the ePDG shall check that there is an ongoing session associated to any of the parameters received in the message (identified by the Session-Id AVP and the User-Name AVP).\nIf an active session is found, the ePDG shall initiate an authorization procedure for the session identified by the Session-Id AVP and the User-Name AVP and a Re-authorization Answer message shall be sent to the 3GPP AAA Server or the 3GPP AAA Proxy with the Result-Code indicating DIAMETER_SUCCESS. This new authorization procedure shall be performed as described in clause 7.1.2.2.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then an Re-authorization Answer message shall be sent to the 3GPP AAA Server or the 3GPP AAA Proxy with the Result-Code indicating DIAMETER_UNKNOWN_SESSION_ID.\nExceptions to the cases specified here shall be treated by ePDG as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY and, therefore, no authorization procedure shall be initiated.\nTable 7.1.2.5.3/1 details the valid result codes that the ePDG can return in the response.\nTable 7.1.2.5.3/1: Re-authorization Answer valid result codes\nResult-Code AVP value\nCondition\nDIAMETER_SUCCESS\nThe request succeeded.\nDIAMETER_UNKNOWN_SESSION_ID\nThe request failed because the user is not found in ePDG.\nDIAMETER_UNABLE_TO_COMPLY\nThe request failed.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.1.2.2",
        "table_7.1.2.5.3"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.1",
      "section_id": "7.2.1",
      "section_title": "General",
      "content": "The SWm reference point shall be based on Diameter, as defined in IETF RFC 6733 [58] and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 4072 [5], which provides a Diameter application to support the transport of EAP (IETF RFC 3748 [8]) frames over Diameter.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5447 [6], which defines Diameter extensions for Mobile IPv6 NAS to AAA interface.\nIn the case of an untrusted non-3GPP IP access, the MAG to 3GPP AAA server or the MAG to 3GPP AAA proxy communication shall use the MAG to AAA interface functionality defined in IETF RFC 5779 [2] and the NAS to AAA interface functionality defined in IETF RFC 5447 [6].\nThe Diameter application for the SWm reference point shall use the Diameter Application Id with value 16777264.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.1.1",
      "section_id": "7.2.2.1.1",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 5779 [2].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n{ EAP-Payload }\n[ User-Name ]\n[ RAT-Type ]\n[ Service-Selection ]\n[ MIP6-Feature-Vector ]\n[ QoS-Capability ]\n[ Visited-Network-Identifier ]\n[ AAA-Failure-Indication ]\n*[ Supported-Features ]\n[ UE-Local-IP-Address ]\n[ OC-Supported-Features ]\n[ Terminal-Information ]\n[ Emergency- Services ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.1.2",
      "section_id": "7.2.2.1.2",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "The Diameter-EAP-Answer (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to the ePDG. The ABNF is based on the one in IETF RFC 5779 [2].\n< Diameter-EAP-Answer > ::=\t< Diameter Header: 268, PXY, 16777264>\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ EAP-Payload ]\n[ User-Name ]\n[ EAP-Master-Session-Key ]\n[ APN-OI-Replacement ]\n[ APN-Configuration ]\n[ MIP6-Feature-Vector ]\n[ Mobile-Node-Identifier ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ Session-Timeout ]\n[ MIP6-Agent-Info ]\n[ 3GPP-Charging-Characteristics ]\n*[ Redirect-Host ]\n*[ Supported-Features ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ UE-Usage-Type ][ Emergency-Info ]\n[ Core-Network-Restrictions ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.1.3",
      "section_id": "7.2.2.1.3",
      "section_title": "Diameter-AA-Request (AAR) Command",
      "content": "The AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from an ePDG to a 3GPP AAA Server/Proxy.\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Request-Type }\n[ User-Name ]\n[ OC-Supported-Features ]\n[ AAR-Flags ]\n[ UE-Local-IP-Address ]\n[ High-Priority-Access-Info ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.1.4",
      "section_id": "7.2.2.1.4",
      "section_title": "Diameter-AA-Answer (AAA) Command",
      "content": "The AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from 3GPP AAA Server/Proxy to an ePDG.\n<AA-Answer> ::=\t< Diameter Header: 265, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ APN-OI-Replacement ]\n[ APN-Configuration ]\n[ Trace-Info ]\n[ Subscription-ID ]\n[ 3GPP-Charging-Characteristics ]\n[ Session-Timeout ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n[ Access-Network-Info ]\n[ User-Location-Info-Time ]\n[ Core-Network-Restrictions ]\n[ MPS-Priority ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.2.1",
      "section_id": "7.2.2.2.1",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 6733 [58], and is defined as follows:\n< Session-Termination-Request > ::=\t< Diameter Header: 275, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.2.2",
      "section_id": "7.2.2.2.2",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit clear in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a ePDG. The ABNF is based on the one in IETF RFC 6733 [58], and is defined as follows:\n< Session-Termination-Answer > ::=\t< Diameter Header: 275, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.3.1",
      "section_id": "7.2.2.3.1",
      "section_title": "Abort-Session-Request (ASR) Command",
      "content": "The Abort-Session-Request (ASR) command shall be indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, and shall be sent from a 3GPP AAA Server/Proxy to an ePDG. The ABNF is based on that in IETF RFC 4005 [4].\n< Abort-Session-Request > ::=\t< Diameter Header: 274, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.3.2",
      "section_id": "7.2.2.3.2",
      "section_title": "Abort-Session-Answer (ASA) Command",
      "content": "The Abort-Session-Answer (ASA) command shall be indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, and shall be sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on that in IETF RFC 4005 [4].\n< Abort-Session-Answer > ::=\t< Diameter Header: 274, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.3.3",
      "section_id": "7.2.2.3.3",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from an ePDG to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.3.4",
      "section_id": "7.2.2.3.4",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to an ePDG. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.4.1",
      "section_id": "7.2.2.4.1",
      "section_title": "Re-Auth-Request (RAR) Command",
      "content": "The Re-Auth-Request (RAR) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field, and shall be sent from a 3GPP AAA Server/Proxy to a ePDG. The ABNF is based on the one in IETF RFC 4005 [4] and is defined as follows.\n< Re-Auth-Request > ::=\t< Diameter Header: 258, REQ, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.2.4.2",
      "section_id": "7.2.2.4.2",
      "section_title": "Re-Auth-Answer (RAA) Command",
      "content": "The Re-Auth-Answer (RAA) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field, and shall be sent from a ePDG to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 4005 [4] and is defined as follows.\n< Re-Auth-Answer > ::=\t< Diameter Header: 258, PXY, 16777264 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n…\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_7.2.3.1",
      "section_id": "7.2.3.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the SWm interface protocol for untrusted non-3GPP access, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 7.2.3.1/1: Diameter SWm AVPs\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nAPN-Configuration\n1430\n8.2.3.7\nGrouped\nM,V\nP\nMobile-Node-Identifier\n506\n5.2.3.2\nOctetString\nM\nV,P\nMIP6-Feature-Vector\n124\n5.2.3.3\nUnsigned64\nM\nV,P\nQoS-Capability\n578\n9.2.3.2.4\nGrouped\nM\nV,P\nRAT-Type\n1032\n5.2.3.6\nEnumerated\nM,V\nP\nVisited-Network-Identifier\n600\n9.2.3.1.2\nOctetString\nM,V\nP\nTrace-Info\n1505\n8.2.3.1.3\nGrouped\nV\nM,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nAAA-Failure-Indication\n1518\n8.2.3.21\nUnsigned32\nV\nM,P\nEmergency- Services\n1538\n7.2.3.4\nUnsigned32\nV\nM,P\nAccess-Network-Info\n1526\n5.2.3.24\nGrouped\nV\nM,P\nAAR-Flags\n1539\n7.2.3.5\nUnsigned32\nV\nM,P\nHigh-Priority-Access-Info\n1542\n5.2.3.36\nUnsigned32\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nThe following table describes the Diameter AVPs re-used by the SWm interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWm. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol defined in IETF RFC 6733 [58], do not need to be supported.\nTable 7.2.3.1/2: SWm re-used Diameter AVPs\nAttribute Name\nReference\nComments\nM-bit\nAuth-Request-Type\nIETF RFC 6733 [58]\nSubscription-ID\nIETF RFC 4006 [20]\nEAP-Master-Session-Key\nIETF RFC 4072 [5]\nEAP-Payload\nIETF RFC 4072 [5]\nRe-Auth-Request-Type\nIETF RFC 6733 [58]\nSession-Timeout\nIETF RFC 6733 [58]\nUser-Name\nIETF RFC 6733 [58]\nMIP6-Agent-Info\nIETF RFC 5447 [6]\nAPN-OI-Replacement\n3GPP TS 29.272 [29]\nTerminal-Information\n3GPP TS 29.272 [29]\nSupported-Features\n3GPP TS 29.229 [24]\nFeature-List-ID\n3GPP TS 29.229 [24]\nSee clause 7.2.3.2\nFeature-List\n3GPP TS 29.229 [24]\nSee clause 7.2.3.3\n3GPP-Charging-Characteristics\n3GPP TS 29.061 [31]\nUE-Local-IP-Address\n3GPP TS 29.212 [23]\nOC-Supported-Features\nIETF RFC 7683 [47]\nSee clause 8.2.3.22\nOC-OLR\nIETF RFC 7683 [47]\nSee clause 8.2.3.23\nUser-Location-Info-Time\n3GPP TS 29.212 [23]\nSee clause 5.3.101\nDRMP\nIETF RFC 7944 [53]\nSee clause 8.2.3.25\nMust not set\nEmergency-Info\n3GPP TS 29.272 [29]\nLoad\nIETF RFC 8583 [54]\nSee clause 8.2.3.26\nMust not set\nUE-Usage-Type\n3GPP TS 29.272 [29]\nCore-Network-Restrictions\n3GPP TS 29.272 [29]\nMPS-Priority\n3GPP TS 29.272 [29]\nMust not set\nNOTE 1:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies.\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nOnly those AVP initially defined in this reference point and for this procedure are described in the following clauses.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.229_clause_7.2.3.2",
        "ts_29.229_clause_7.2.3.3",
        "clause_8.2.3.22",
        "clause_8.2.3.23",
        "ts_29.212_clause_5.3.101",
        "clause_8.2.3.25",
        "clause_8.2.3.26",
        "table_7.2.3.1",
        "ts_29.272",
        "ts_29.229",
        "ts_29.061",
        "ts_29.212"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.3.2",
      "section_id": "7.2.3.2",
      "section_title": "Feature-List-ID AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the SWm application.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.3.3",
      "section_id": "7.2.3.3",
      "section_title": "Feature-List AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the SWm application.\nNOTE:\tThere are no SWm features defined for this release.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.3.4",
      "section_id": "7.2.3.4",
      "section_title": "Emergency-Services",
      "content": "The Emergency-Services AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 7.2.3.4/1:\nTable 7.2.3.4/1: Emergency-Services\nBit\nName\nDescription\n0\nEmergency-Indication\nThis bit, when set, indicates a request to establish a PDN connection for emergency services.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_7.2.3.4"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.3.5",
      "section_id": "7.2.3.5",
      "section_title": "AAR-Flags",
      "content": "The AAR-Flags AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 7.2.3.5/1:\nTable 7.2.3.5/1: AAR-Flags\nBit\nName\nDescription\n0\nWLAN-Location-Info-Request\nThis bit, when set, indicates an ePDG request to retrieve the most up to date WLAN Location Information of the UE stored at the 3GPP AAA Server.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_7.2.3.5"
      ]
    },
    {
      "chunk_id": "ts_29.273_7.2.4",
      "section_id": "7.2.4",
      "section_title": "Session Handling",
      "content": "The Diameter protocol between the ePDG and the 3GPP AAA Server or the 3GPP AAA Proxy shall always keep the session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify\n-\ta PDN Connection of a given user, if NBM is used\n-\ta user, if DSMIPv6 is used.\nIn order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.1.1",
      "section_id": "8.1.1",
      "section_title": "General",
      "content": "The SWx reference point is defined between the 3GPP AAA Server and the HSS. The description of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nThe SWx reference point is used to authorize the UE and to transport NBM related mobility parameters when NBM is used to establish connectivity to the EPC.\nThe SWx is used to authenticate and authorize the UE when the S2a, S2b or S2c reference points are used to connect to EPC. This reference point is also used to update the HSS with the PDN-GW address information. Additionally, this reference point may be used to retrieve and update other mobility related parameters including static QoS profiles for non-3GPP accesses.\nAdditional requirements for the SWx interface can be found in clause 12 of 3GPP TS 23.402 [3].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402_clause_12",
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.1.1",
      "section_id": "8.1.2.1.1",
      "section_title": "General",
      "content": "This procedure is used between the 3GPP AAA Server and the HSS. The procedure is invoked by the 3GPP AAA Server when a new set of authentication information for a given subscriber is to be retrieved from an HSS. This can happen for example, when a new trusted or untrusted non 3GPP/IP access subscriber has accessed the 3GPP AAA Server for authentication or when a new set of authentication information is required for one of the subscribers already registered in the 3GPP AAA server. The procedure shall be invoked by 3GPP AAA Server when it detects that the VPLMN or access network has changed.\nTable 8.1.2.1.1/1: Authentication request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI, formatted according to 3GPP TS 23.003 [14], clause 2.2.\nVisited Network Identifier\nVisited-Network-Identifier\nC\nThis IE shall contain the identifier that allows the home network to identify the Visited Network. The 3GPP AAA Server shall include this information element when received from signalling across the SWd.\nNumber Authentication Items\nSIP-Number-Auth-Items\nM\nThis information element shall indicate the number of authentication vectors requested\nAuthentication Data\nSIP-Auth-Data-Item\nM\nSee tables 8.1.2.1.1/2 and 8.1.2.1.1/3 for the contents of this information element. The content shown in table 8.1.2.1.1/2 shall be used for a normal authentication request; the content shown in table 8.1.2.1.1/3 shall be used for an authentication request after synchronization failure.\nRouting Information\nDestination-Host\nC\nIf the 3GPP AAA Server knows the HSS name, this AVP shall be present.\nThis information is available if the 3GPP AAA Server already has the HSS name stored. The HSS name shall be obtained from the Origin-Host AVP, which is received from a previous command from the HSS or from the SLF;\notherwise only the Destination-Realm is included so that it is resolved to an HSS address in an SLF-like function. Once resolved the Destination-Host AVP is included with the suitable HSS address and it is stored in the 3GPP AAA Server for further usage.\nAccess Network Identity\nANID\nC\nThis IE shall contain the access network identifier used for key derivation at the HSS. (See 3GPP TS 24. 302 [26] for all possible values).\nThis IE shall be present if the Authentication Method is EAP-AKA'.\nAccess Type\nRAT-Type\nM\nThis IE shall contain the radio access technology that is serving the UE. (See 3GPP TS 29.212 [23] for all possible values).\nWhen this IE is not received by the 3GPP AAA Server, neither from the ePDG nor from the non-3GPP access network, it shall take the value VIRTUAL (1).\nTrust Relationship Indicator\nAN-Trusted\nO\nWhen present, this AVP shall contain the 3GPP AAA Server's decision on handling the non-3GPP access network, i.e. trusted or untrusted.\nTerminal Information\nTerminal-Information\nO\nThis information element shall contain information about the user's mobile equipment. The AVP shall be present only if received from the non-3GPP access network, in authentication and authorization request. The AVP shall be transparently forwarded by the 3GPP AAA server.\n(see NOTE 1)\nAAA Failure Indication\nAAA-Failure-Indication\nO\nIf present, this information element shall indicate that the 3GPP AAA Server currently registered in the HSS, is unavailable.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nNOTE 1:\tThe Terminal-Information AVP is not present in this message for a WLAN access.\nTable 8.1.2.1.1/2: Authentication Data content - request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nAuthentication Method\nSIP-Authentication-Scheme\nM\nThis information element shall indicate the authentication method\nIt shall contain one of the values EAP-AKA or EAP-AKA'. EAP-AKA is specified in IETF RFC 4187 [44] and EAP-AKA' is specified in IETF RFC 5448 [27].\nTable 8.1.2.1.1/3: Authentication Data content - request, synchronization failure\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nAuthentication Method\nSIP-Authentication-Scheme\nM\nThis information element shall indicate the authentication method\nIt shall contain one of the values EAP-AKA or EAP-AKA'.\nAuthorization Information\nSIP-Authorization\nM\nThis IE shall contain the concatenation of Rand, as sent to the terminal, and auts, as received from the terminal. Rand and auts shall both be binary encoded.\nTable 8.1.2.1.1/4: Authentication answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See I IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI, formatted according to 3GPP TS 23.003 [14], clause 2.2.\nNumber Authentication Items\nSIP-Number-Auth-Items\nC\nThis AVP shall indicate the number of authentication vectors delivered in the Authentication Data information element.\nIt shall be present when the result is DIAMETER_SUCCESS.\nAuthentication Data\nSIP-Auth-Data-Item\nC\nIf the SIP-Number-Auth-Items AVP is equal to zero or it is not present, then this AVP shall not be present.\nSee table 8.1.2.1.1/5 for the contents of this information element.\n3GPP AAA Server Name\n3GPP-AAA- Server-Name\nC\nThis AVP shall contain the Diameter address of the 3GPP AAA Server.\nThis AVP shall be sent when the user has been previously authenticated by another 3GPP AAA Server and therefore there is another 3GPP AAA Server serving the user.\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nTable 8.1.2.1.1/5: Authentication Data content - response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nItem Number\nSIP-Item-Number\nC\nThis information element shall be present in a SIP-Auth-Data-Item grouped AVP in circumstances where there are multiple occurrences of SIP-Auth-Data-Item AVPs, and the order in which they should be processed is significant.\nIn this scenario, SIP-Auth-Data-Item AVPs with a low SIP-Item-Number value should be processed before SIP-Auth-Data-Items AVPs with a high SIP-Item-Number value.\nAuthentication Method\nSIP-AuthenticationScheme\nM\nThis IE shall contain one of the values EAP-AKA or EAP-AKA'.\nAuthentication Information\nAKA\nSIP-Authenticate\nM\nThis IE shall contain, binary encoded, the concatenation of the authentication challenge RAND and the token AUTN. See 3GPP TS 33.203 [16] for further details about RAND and AUTN.\nAuthorization Information\nAKA\nSIP-Authorization\nM\nThis IE shall contain binary encoded, the expected response XRES. See 3GPP TS 33.203 [16] for further details about XRES.\nConfidentiality Key\nAKA\nConfidentiality-Key\nM\nThis information element shall contain the confidentiality key CK or CK'. It shall be binary encoded.\nIntegrity Key\nAKA\nIntegrity-Key\nM\nThis information element shall contain the integrity key IK or IK'. It shall be binary encoded.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_2.2",
        "table_8.1.2.1.1",
        "ts_23.003",
        "ts_29.212",
        "ts_29.229",
        "ts_33.203"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.1.2",
      "section_id": "8.1.2.1.2",
      "section_title": "Detailed behaviour",
      "content": "The HSS shall, in the following order (if there is an error in any of the steps, the HSS shall stop processing and return the corresponding error code):\n1.\tCheck that the user exists in the HSS. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tCheck that the user has non-3GPP subscription and that the user is allowed in the EPC. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTON.\n3.\tIf the user has an MPS subscription, the HSS handles the response with priority as specified in Annex C and Annex D.\n4.\tIf a Visited-Network-Identifier is present, check that the user is allowed to roam in the visited network. If the user is not allowed to roam in the visited network, Experimental-Result-Code shall be set to DIAMETER_ERROR _ROAMING_NOT_ALLOWED.\n5.\tCheck the access type. If the access type indicates any value that is restricted for the user, then the Experimental-Result-Code shall be set to DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED.\n6.\tBased on operator's policy, if the Trust Relationship Indicator is present and indicates any value that is restricted for the user, then the Experimental-Result-Code shall be set to DIAMETER_ERROR_TRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED or DIAMETER_ERROR_UNTRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED.\n7.\tThe HSS shall check if there is an existing 3GPP AAA Server already assisting the user\n-\tIf there is a 3GPP AAA Server already serving the user, the HSS shall compare the 3GPP AAA server name received in the request to the 3GPP AAA Server name stored in the HSS.\n-\tIf they are not identical and the received message contains the AAA-Failure-Indication AVP, the HSS shall remove the old 3GPP AAA Server name previously assigned for this subscriber, and store the name of the new 3GPP AAA Server that sent the request containing the AAA-Failure-Indication AVP, and continue from step 6. The HSS should attempt to notify the old 3GPP AAA Server about the new server assignment, by means of the network initiated de-registration procedure (see clause 8.1.2.2.3) indicating as reason code \"NEW_SERVER_ASSIGNED\".\n-\tIf they are not identical the HSS shall return the old 3GPP AAA Server to the requester 3GPP AAA Server and return an error by setting the Experimental-Result-Code to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.\n-\tThe requester 3GPP AAA Server, upon detection of a 3GPP AAA Server name in the response assumes that the user already has a 3GPP AAA Server assigned, so makes use of Diameter redirect function to indicate the 3GPP AAA Server name where to address the authentication request.\n8.\tThe HSS shall check the request type.\n-\tIf the request indicates there is a synchronization failure, the HSS shall process AUTS as described in 3GPP TS 33.203 [16] and return the requested authentication information. The Result-Code shall be set to DIAMETER_SUCCESS.\n-\tIf the request indicates authentication, the HSS shall generate the authentication vectors for the requested authentication method, EAP-AKA or EAP-AKA', as described in 3GPP TS 33.402 [19]. The HSS shall download Authentication-Data-Item up to a maximum specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-Request. The result code shall be set to DIAMETER_SUCCESS.\n-\tIf there is no 3GPP AAA Server already serving the user, the HSS shall store the received 3GPP AAA Server name.\nExceptions to the cases specified here shall be treated by HSS as error situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY. No authentication information shall be returned.\nOrigin-Host AVP shall contain the 3GPP AAA Server identity.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2.2.3",
        "ts_33.203",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.2.1",
      "section_id": "8.1.2.2.1",
      "section_title": "General",
      "content": "According to the requirements described in 3GPP TS 23.402 [3], SWx reference point shall enable:\n-\tRegistration of the 3GPP AAA Server serving an authorized trusted or untrusted non-3GPP access user in the HSS.\n-\tRetrieval of charging-related information from HSS.\n-\tDeregistration procedure between the 3GPP AAA Server and the HSS.\n-\tRetrieval of subscriber profile from HSS.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.2.2",
      "section_id": "8.1.2.2.2",
      "section_title": "UE/PDN Registration/DeRegistration Notification",
      "content": "8.1.2.2.2.1\tGeneral\nThis procedure is used between the 3GPP AAA Server and the HSS.\n-\tTo register the current 3GPP AAA Server address in the HSS for a given non-3GPP user. This procedure is invoked by the 3GPP AAA Server after a new subscriber has been authenticated by the 3GPP AAA Server.\n-\tTo de-register the current 3GPP AAA Server address in the HSS for a given non-3GPP user. This procedure is invoked when the 3GPP AAA Server removes the access information for a non-3GPP user after all sessions for the user (i.e. the STa, SWm, S6b sessions) have been terminated.\n-\tTo download the subscriber profile to the 3GPP AAA Server on demand. This procedure is invoked when for some reason the subscription profile of a subscriber is lost.\n-\tTo update the HSS with the identity and the PLMN ID of a dynamically allocated PDN GW as a result of the first PDN connection establishment associated to an APN.\n-\tTo update the HSS with the identity of the dynamically allocated PDN GW selected for the establishment of an emergency PDN connection.\nTable 8.1.2.2.2.1/1: Non-3GPP IP Access Registration request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI and shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nServer Assignment Type\nServer-Assignment-Type\nM\nThis IE shall contain the type of procedure the 3GPP AAA Server requests in the HSS.\nWhen this IE contains REGISTRATION value, the 3GPP AAA Server requests the HSS to perform a registration of the non-3GPP user.\nWhen this IE contains USER_DEREGISTRATION / ADMINISTRATIVE_DEREGISTRATION / AUTHENTICATION_FAILURE / AUTHENTICATION_TIMEOUT, the 3GPP AAA Server requests the HSS to de-register the non-3GPP user.\nWhen this IE contains AAA_USER_DATA_REQUEST value, the 3GPP AAA Server requests the HSS to download the subscriber user profile towards the 3GPP AAA Server as part of 3GPP AAA Server initiated profile download request, but no registration is requested.\nWhen this IE contains PGW_UPDATE value, the 3GPP AAA Server requests the HSS to update the PGW identity for the non-3GPP user for an APN in the user subscription or for emergency services.\nAny other value shall be considered as an error case.\nRouting Information\nDestination-Host\nC\nIf the 3GPP AAA Server knows the HSS name this AVP shall be present.\nThis information is available if the 3GPP AAA Server already has the HSS name stored. The HSS name shall be obtained from the Origin-Host AVP, which is received from the HSS as part of authentication response;\notherwise only the Destination-Realm is included so that it is resolved to an HSS address in an SLF-like function. Once resolved the Destination‑Host AVP shall be included with the suitable HSS address and it shall be stored in the 3GPP AAA Server for further usage.\nPGW identity\nMIP6-Agent-Info\nC\nThis IE shall contain, either the identity of the dynamically allocated PDN GW, or the identity of a dynamically allocated PDN GW selected for the establishment of emergency PDN connections, and is included if the Server-Assignment-Type is set to PGW_UPDATE.\nPGW PLMN ID\nVisited-Network-Identifier\nC\nThis IE shall contain the identity of the PLMN where the PDN-GW was allocated, in cases of dynamic PDN-GW assignment. It shall be present when the PGW Identity is present and does not contain an FQDN.\nContext Identifier\nContext-Identifier\nO\nFor non-emergency PDN connection establishment, this parameter shall identify the APN Configuration with which the reallocated PDN GW shall be correlated, and it may be included if it is available and the Server-Assignment-Type is set to PGW_UPDATE.\nFor emergency PDN connection establishment, this information element shall be left absent.\nAPN Id\nService-Selection\nC\nFor non-emergency PDN connection establishment, this information element shall contain the Network Identifier part of the APN, and it shall be included if the Server-Assignment-Type is set to PGW_UPDATE.\nFor emergency PDN connection establishment, this information element shall be left absent.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nTerminal Information\nTerminal-Information\nC\nThe 3GPP AAA Server shall include this IE and set it to the user's Mobile Equipment Identity, if this information is available, and if the Server-Assignment-Type is set to REGISTRATION.\nThis IE shall also be present, independently of the value of the Server-Assignment-Type, if the Terminal-Information has changed from the last value previously reported to the HSS.\nThis grouped AVP shall contain the IMEI AVP and, if available, the Software-Version AVP, for a trusted or untrusted WLAN access.\nWhen the RAT type is not known by the 3GPP AAA Server, but the UE has provided the IMEI(SV), this grouped AVP shall contain the IMEI AVP and, if available, the Software-Version AVP.\nEmergency Services\nEmergency-Services\nC\nThe 3GPP AAA Server shall include this information element, and set the Emergency-Indication bit, to notify the HSS that a new PDN-GW has been selected for the establishment of an emergency PDN connection, whose identity is conveyed in the \"PGW identity\" IE. This IE shall only be included when the Server-Assignment-Type is set to PGW_UPDATE.\nTable 8.1.2.2.2.1/2: Non-3GPP IP Access Registration response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI and shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nRegistration result\nResult-Code / Experimental-Result\nM\nThis IE contains the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nUser Profile\nNon-3GPP-User-Data\nC\nThis IE shall contain the relevant user profile. Clause 8.2.3.1 details the contents of the AVP.\nIt shall be present when Server-Assignment-Type in the request is equal to AAA_USER_DATA_REQUEST or REGISTRATION and the Result-Code is equal to DIAMETER_SUCCESS.\n3GPP AAA Server Name\n3GPP-AAA- Server-Name\nC\nThis AVP shall contain the Diameter address of the 3GPP AAA Server.\nThis AVP shall be present when the user has been previously authenticated by another 3GPP AAA Server and therefore there is another 3GPP AAA Server serving the user.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\n8.1.2.2.2.2\tDetailed behaviour\nWhen a new trusted or untrusted non-3GPP IP access subscriber has been authenticated by the 3GPP AAA Server, the 3GPP AAA Server initiates the registration towards the HSS. The HSS shall, in the event of an error in any of the steps, stop processing and return the corresponding error code.\nAt reception of the Non-3GPP IP Access Registration, the HSS shall perform (in the following order):\n1.\tCheck that the user is known. If not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.\n2.\tIf the user has an MPS subscription, the HSS handles the response with priority as specified in Annex C and Annex D.\n3.\tThe HSS shall check if there is an existing 3GPP AAA Server already assisting the user\n-\tIf there is a 3GPP AAA Server already serving the user, the HSS shall compare the 3GPP AAA Server name received in the request to the 3GPP AAA Server name stored in the HSS.\n-\tIf they are not identical the HSS shall return the old 3GPP AAA Server to the requester 3GPP AAA Server and return an error by setting the Experimental-Result-Code to DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.The requester 3GPP AAA Server, upon detection of a 3GPP AAA Server name in the response assumes that the user already has a 3GPP AAA Server assigned, so makes use of Diameter redirect function to indicate the 3GPP AAA Server name where to address the Non-3GPP IP Access Registration request.\n-\tIf they are identical but there is no APN configuration information in HSS for the user, the HSS shall return the Experimental Result Code DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION and it shall remove the 3GPP AAA Server name previously assigned for this subscriber.\n-\tIf there is not a 3GPP AAA Server already serving the user, the HSS shall return an error, setting the Result-Code to DIAMETER_UNABLE_TO_COMPLY in the Response command.\n4.\tAfter the HSS has determined that the requesting 3GPP AAA server is identical to the registered 3GPP AAA server, the HSS shall check the Server Assignment Type value received in the request:\n-\tIf it indicates REGISTRATION, the HSS shall set the subscribers User Status to REGISTERED for the authenticated and authorized trusted or untrusted non-3GPP IP access subscriber, download the relevant user profile information and set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. For those APNs that have been authorized as a consequence of having the Wildcard APN in the user subscription, the HSS shall include the specific APN name and associated PDN-GW identity inside the Specific-APN-Info AVP of the Wildcard APN.\n-\tIf it indicates USER_DEREGISTRATION / ADMINISTRATIVE_DEREGISTRATION / AUTHENTICATION_FAILURE / AUTHENTICATION_TIMEOUT, the HSS shall remove the 3GPP AAA Server name previously assigned for the subscriber, set the User Status for the subscriber to NOT_REGISTERED and set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. The HSS shall not remove the stored dynamic PGW-ID and APN information for the subscriber.\n-\tIf it indicates AAA_USER_DATA_REQUEST, the HSS shall download the relevant user profile information to the requester 3GPP AAA Server and set the Result-Code AVP to DIAMETER_SUCCESS in the Response command.\n-\tIf it indicates PGW_UPDATE, the HSS shall check if the subscriber is registered.\n-\tIf the subscriber is registered and the Emergency-Services AVP is present in the request, with the Emergency-Indication bit set, the HSS shall store the PDN GW Identity as the PDN GW used to establish emergency PDN connections by the non-3GPP access network, and update the MME with this information as specified in 3GPP TS 29.272 [29].\n-\tIf the subscriber is registered and the Emergency-Indication bit of the Emergency-Services AVP is not set in the request, and there is not a static PDN GW subscribed, the HSS shall store the PGW identity and PLMN (if it is received in the command) for the non-3GPP user and the APN identified by the APN Id or by the Context Identifier if present in the request; otherwise, the HSS shall not update or delete the stored PDN GW and, for this case, shall set the result code to DIAMETER_UNABLE_TO_COMPLY.\n-\tIf the APN corresponding to the PGW identity is not present in the subscription but the wild card APN is present in the subscription, the HSS shall store the new PDN GW identity and PLMN for an APN if present in the request. The HSS shall set the Result-Code AVP to DIAMETER_SUCCESS in the Server-Assignment-Response command. If the Context Identifier is included in the request, the HSS may use it to locate the APN Configuration.\n-\tIf the APN corresponding to the PGW identity is not present in the subscription and the wild card APN is not present in the subscription, the HSS shall reject the request and set the Result-Code AVP to DIAMETER_UNABLE_TO_COMPLY.\n-\tIf the subscriber is not registered, the HSS shall reject the request and set the Experimental-Result-Code AVP to DIAMETER_ERROR_IDENTITY_NOT_REGISTERED.\n-\tIf it indicates any other value, the Result-Code shall be set to DIAMETER_UNABLE_TO COMPLY, and no registration/de-registration or profile download procedure shall be performed.\nThe Origin-Host AVP shall contain the 3GPP AAA Server identity.\nIf the subscription data received for a certain APN indicates that the APN was authorized as a consequence of having the Wildcard APN in the user subscription in HSS, then the 3GPP AAA Server shall not store this APN data beyond the lifetime of the UE sessions related to the specific APN and the 3GPP AAA Server shall delete them upon disconnection of the UE. If the PGW Identity contains an FQDN of the PDN GW, the 3GPP AAA Server shall retrieve the PGW PLMN ID from the MIP-Home-Agent-Host AVP within the MIP6-Agent-Info AVP which contains the PGW Identity.\nFor trusted WLAN access, if the transparent single-connection mode is used as specified in 3GPP TS 24.302 [26], the 3GPP AAA Server may be configured by local policy to not update the HSS with the PGW Identity used over TWAN for the default APN of the user (i.e. to skip the Non-3GPP IP Access Registration request with Server-Assignment-Type set to \"PGW_UPDATE\").\nNOTE:\tThis 3GPP AAA Server option can be used when the same APN is configured for TWAN and other access technologies in which case the network can select different PDN GWs for PDN connections to this APN. Updating the HSS with the selected PDN GW identity for Trusted WLAN access could affect PDN connections over other access technologies.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_2.2",
        "clause_8.2.3.1",
        "table_8.1.2.2.2.1",
        "ts_23.003",
        "ts_29.229",
        "ts_29.272",
        "ts_24.302"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.2.3",
      "section_id": "8.1.2.2.3",
      "section_title": "Network Initiated De-Registration by HSS, Administrative",
      "content": "8.1.2.2.3.1\tGeneral\nThis procedure is used between the 3GPP AAA Server and the HSS to remove a previous registration and all associated state. When the de-registration procedure is initiated by HSS, indicating that a subscription has to be removed, the 3GPP AAA Server subsequently triggers the detach procedure via the appropriate interface.\nTable 8.3.2.3: Network Initiated Deregistration by HSS request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI and shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nReason for de-registration\nDeregistration-Reason\nM\nThis IE shall contain the reason for the de‑registration as the HSS shall send to the 3GPP AAA server a reason for the de‑registration.\nThe de-registration reason shall be composed of two parts: one textual message (if available) that is intended to be forwarded to the user that is de‑registered, and one reason code (see 3GPP TS 29.229 [24]) that determines the behaviour of the 3GPP AAA Server.\nRouting Information\nDestination-Host\nM\nThis IE shall contain the 3GPP AAA server name that is obtained from the Origin-Host AVP, which is received from the 3GPP AAA Server,\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nTable 8.3.2.4: Network Initiated Deregistration by HSS response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the Result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\n8.1.2.2.3.2\tDetailed behaviour\nThe HSS shall de-register the affected identity and invoke this procedure to inform the 3GPP AAA server to remove the subscribed user from the 3GPP AAA Server.\nThe HSS shall send in the Deregistration-Reason AVP the reason for the de-registration, composed by a textual message (if available) aimed for the user and a reason code that determines the action the 3GPP AAA server has to perform. The possible reason codes are:\n-\tPERMANENT_TERMINATION: The non-3gpp subscription or service profile(s) has been permanently terminated or the Core Network Restrictions do not allow access to EPC anymore. The HSS shall clear the user's 3GPP AAA Server name and set the User Status to NOT_REGISTERED. The 3GPP AAA Server should start the network initiated de-registration towards the user.\n-\tNEW_SERVER_ASSIGNED: The HSS indicates to the 3GPP AAA Server that a new 3GPP AAA Server has been allocated to the user (e.g. because the previous assigned 3GPP AAA Server was found unavailable at a certain point). The 3GPP AAA Server shall remove all user data and session information for the user indicated in the de-registration request. The 3GPP AAA Server shall not start the network initiated de-registration towards the user.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.003_clause_2.2",
        "table_8.3.2.3",
        "table_8.3.2.4",
        "ts_23.003",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.3.1",
      "section_id": "8.1.2.3.1",
      "section_title": "General",
      "content": "According to the requirements described in 3GPP TS 23.402 [3], 3GPP TS 32.422 [32] and 3GPP TS 23.380 [52], SWx reference point shall enable:\n-\tIndication to 3GPP AAA Server of change of non-3GPP subscriber profile within HSS;\n-\tActivation and deactivation of the subscriber and equipment trace in the PDN GW.\n-\tRequest of identity and location information of the access network and/or UE local time zone.\n-\tIndication to the 3GPP AAA Server that the HSS-based P-CSCF restoration procedure for WLAN, shall be executed as described in 3GPP TS 23.380 [52] clause 5.6.\nThis procedure is used between the 3GPP AAA Server and the HSS. The procedure is invoked by the HSS when the subscriber profile has been modified and needs to be sent to the 3GPP AAA Server. This may happen due to a modification in the HSS.\nThe procedure is also invoked by the HSS to update the 3GPP AAA Server with\n-\tthe identity of a dynamically allocated PDN GW which is included in the APN-Configuration AVP in the User Profile as a result of the first PDN connection establishment associated with an APN over 3GPP access; or\n-\tthe identity of a dynamically allocated PGN GW for emergency services as a result of the establishment of an emergency PDN connection in E-UTRAN.\nThis procedure is mapped to the Diameter command codes Push-Profile-Request (PPR) and Push-Profile-Answer (PPA) specified in the 3GPP TS 29.229 [24]. Information element contents for these messages are shown in tables 8.1.2.3.1/1 and 8.1.2.3.1/2.\nTable 8.1.2.3.1/1: User Profile Update request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI and shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nUser profile\nNon-3GPP-User-Data\nM\nThis IE shall contain the updated user profile. Clause 8.2.3.1 details the contents of the AVP.\nIn case of trace activation or deactivation, the Trace-Info AVP shall be included, and this may be the only AVP that is present under this grouped AVP.\nRouting Information\nDestination-Host\nM\nThis IE shall contain the 3GPP AAA Server name that is obtained from the Origin-Host AVP, which is received from the 3GPP AAA Server\nPPR Flags\nPPR-Flags\nO\nThis Information Element contains a bit mask. See 8.2.3.17 for the meaning of the bits.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nTable 8.1.2.3.1/2: User Profile Update response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nAccess Network Information\nAccess-Network-Info\nO\nIf present, this IE shall contain the identity and location information of the access network where the UE is attached.\nLocal Time Zone\nLocal-Time-Zone\nO\nIf present, this IE shall contain the time zone of the location in the access network where the UE is attached.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "ts_23.003_clause_2.2",
        "clause_8.2.3.1",
        "table_8.1.2.3.1",
        "ts_23.402",
        "ts_32.422",
        "ts_23.380",
        "ts_29.229",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.3.2",
      "section_id": "8.1.2.3.2",
      "section_title": "HSS Detailed behaviour",
      "content": "The HSS shall make use of this procedure to update the relevant user profile in the 3GPP AAA server (e.g. change of subscription data or change of the identity of a dynamically allocated PDN GW associated with an APN), or activate / deactivate subscriber and equipment trace in the PDN GW.\nThe HSS shall make use of this procedure to request the identity, location information and UE local time zone of the access network where the UE is currently attached. In this case, the HSS shall set the Access-Network-Info-Request and/or the UE-Local-Time-Zone-Request bits in the PPR-Flags AVP; if the HSS sends this command for the only purpose of requesting access network information or the local time zone of the UE (i.e., the user profile is not actually modified), the Non-3GPP-User-Data shall be included in the command as an empty AVP. The HSS shall only invoke this procedure if the 3GPP AAA Server has indicated support for the corresponding feature (see clause 8.2.3.16).\nThe HSS shall make use of this procedure to request to the 3GPP AAA Server the execution of the HSS-based P-CSCF restoration procedure, as described in 3GPP TS 23.380 [52] clause 5.4 if the 3GPP AAA Server indicated the support of this procedure in an earlier command to the HSS. In this case, the HSS shall set the \"P-CSCF Restoration Request\" bit in the PPR Flags and the procedure shall only be used for the purpose of the P-CSCF restoration for WLAN; then, the Non-3GPP-User-Data AVP shall be included as an empty AVP. .\nThe HSS shall make use of this procedure to update the identity of a dynamically allocated PDN GW for emergency services in the 3GPP AAA server, if the 3GPP AAA Server indicated the support of the Emergency Services Continuity feature in an earlier command to the HSS.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.2.3.16",
        "ts_23.380_clause_5.4",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.3.3",
      "section_id": "8.1.2.3.3",
      "section_title": "3GPP AAA Server Detailed behaviour",
      "content": "When the HSS-initiated user profile update procedure is successful, the 3GPP AAA Server shall overwrite entirely, for the subscriber identity indicated in the request, the currently stored user profile data with the information received from the HSS, if at least one APN-Configuration AVP is included in the Non-3GPP-User-Data AVP received from HSS. If no APN-Configurations are included in the Non-3GPP-User-Data AVP, the 3GPP AAA Server shall only update the currently stored user profile data with the new received data from the HSS.\nIf the HSS-initiated user profile update procedure is not successful, the 3GPP AAA Server shall not modify the stored user profile.\nAfter a successful user profile download, the 3GPP AAA Server shall initiate re-authentication procedure as described in clause 7.2.2.4 if the subscriber has previously been authenticated and authorized to untrusted non-3GPP access. If the subscriber has previously been authenticated and authorized to trusted non-3GPP IP Access then the 3GPP AAA Server shall initiate a re-authorization procedure as described in clause 5.1.2.3.\nAs multiple authorization sessions may exist for the user (see clause 7.1.2.1), the 3GPP AAA Server shall examine the need to execute re-authorization for each of these sessions, and may execute the multiple re-authorization procedures in parallel. In case the user's non-3GPP subscription has been deleted or the user's APN has been barred, the re-authorization shall be executed in all ongoing user related authorization sessions. Otherwise, the re-authorization procedure shall be invoked for the authorization sessions for which at least one of the following conditions is fulfilled:\n-\tThe user's subscribed APN has been deleted from the HSS.\n-\tThe APN configuration data has been previously downloaded to the ePDG and the new version of APN configuration received from HSS reflects a modification in these data.\nFollowing a successful download of subscription and equipment trace data, the 3GPP AAA Server shall forward the trace data by initiating reauthorization towards all PDN GWs that have an active authorization session.\nWhen the UE is attached to a trusted WLAN, if the HSS has invoked the User Profile Update procedure by setting the Access-Network-Info-Request and/or UE-Local-Time-Zone-Request bits in the PPR-Flags, the 3GPP AAA Server shall initiate a re-authorization procedure towards the TWAN by setting the Re-Auth–Request-Type to AUTHORIZE_ONLY; the TWAN shall send the identification, location information of the Access Point where the UE is attached and the local time zone of the UE, in the subsequent authorization request (AAR command) that follows the re-authorization request/answer exchange (RAR/RAA). If the 3GPP AAA Server determines that the UE is not currently attached to a trusted WLAN, it shall not initiate any re-authorization procedure towards the access network, and it shall not include any network access information or UE local time zone in the response to the HSS.\nNOTE:\tThe 3GPP AAA Server cannot answer the Push Profile Request received from the HSS until the AAR command has been received from the TWAN, since it needs to receive the information from the access network, before sending back the Push Profile Answer to the HSS.\nIf the 3GPP AAA Server receives the Push-Profile-Request command with an empty Non-3GPP-User-Data AVP, but some other action is indicated by setting any of the bits in the PPR-Flags AVP, the 3GPP AAA Server shall ignore the Non-3GPP-User-Data AVP, i.e., it shall not apply any changes to the stored user profile.\nWhen the PPR Flags are received with the \"P-CSCF Restoration Request\" bit set, if an IMS PDN connection is established via a trusted or untrusted WLAN access for which the PGW has indicated the support of the P-CSCF restoration feature in an earlier command, the 3GPP AAA Server shall execute the HSS-based P-CSCF restoration for WLAN procedure, as described in 3GPP TS 23.380 [52] clause 5.6. Otherwise, the 3GPP AAA Server does not execute the HSS-based P-CSCF restoration for WLAN procedure.\nTable 8.1.2.3.3/1 details the valid result codes that the 3GPP AAA Server can return in the response.\nTable 8.1.2.3.3/1: User profile response valid result codes\nResult-Code AVP value\nCondition\nDIAMETER_SUCCESS\nThe request succeeded.\nDIAMETER_ERROR_USER_UNKNOWN\nThe request failed because the user is not found in 3GPP AAA Server.\nDIAMETER_UNABLE_TO_COMPLY\nThe request failed.\nBased on operator policy, if the 3GPP AAA Server receives from the HSS a Non-3GPP-User-Data AVP with an MPS-Priority AVP with the MPS-EPS-Priority bit set, the 3GPP AAA Server shall treat commands for the UE with priority as specified in Annex C and Annex D. If the 3GPP AAA Server receives a Non-3GPP-User-Data AVP without an MPS-Priority AVP with the MPS-EPS-Priority bit set and if the last DER or AAR command received by the 3GPP AAA Server from the ePDG or from the non-3GPP access network did not contain a High-Priority-Access-Info AVP with the HPA_Configured bit set, the 3GPP AAA Server shall discontinue priority treatment of commands for the UE.\nNOTE 2:\tThe 3GPP AAA Server treats the UE with priority if either the DER command from the ePDG indicates high priority access or the HSS has indicated an MPS subscription for the UE.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_7.2.2.4",
        "clause_5.1.2.3",
        "clause_7.1.2.1",
        "ts_23.380_clause_5.6",
        "table_8.1.2.3.3",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.4.1",
      "section_id": "8.1.2.4.1",
      "section_title": "HSS Reset Indication",
      "content": "8.1.2.4.1.1\tGeneral\nThis procedure is used by the HSS to indicate to the 3GPP AAA Server that it has restarted, and the registration data and the dynamic data stored for a set of users may have been lost.\nThis procedure is mapped to the Diameter command codes Push-Profile-Request (PPR) and Push-Profile-Answer (PPA) specified in the 3GPP TS 29.229 [24]. Information Element contents for these messages are shown in tables 8.1.2.4.1.1/1 and 8.1.2.4.1.1/2.\nTable 8.1.2.4.1.1/1: HSS Reset Indication Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nUser List\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall indicate the users affected by the HSS restart. It shall contain either:- The string \"*\", if all users are affected by the restart- The leading digits of the IMSI series of the set of users affected by the restart.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nPPR Flags\nPPR-Flags\nM\nThis Information Element contains a bit mask. See 8.2.3.17 for the meaning of the bits. The HSS shall set the Reset-Indication bit when sending PPR to the 3GPP AAA Server.\nTable 8.1.2.4.1.1/2: HSS Reset Indication Response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\n8.1.2.4.1.2\tHSS Detailed behaviour\nThe HSS shall use this procedure to indicate to the 3GPP AAA Server about a restart event, affecting a set of users, for whom their registration data and dynamic data may have been lost. The HSS shall only send this command if the 3GPP AAA Server has indicated support for the \"HSS Restoration\" feature. In this case, the HSS shall set the Reset-Indication bit in the PPR-Flags AVP in the PPR command.\nNOTE:\tIf there are multiple 3GPP AAA Servers deployed in the HPLMN, and the HSS is configured (in an implementation-specific manner) in such a way that it can determine that a certain 3GPP AAA Server does not contain any of the users affected by the restart, it can skip sending the PPR command to that specific 3GPP AAA Server.\n8.1.2.4.1.3\t3GPP AAA Server Detailed behaviour\nIf the 3GPP AAA Server supports the \"HSS Restoration\" feature, it shall answer with a successful result to the PPR command, and it shall mark those users affected by the HSS restart as \"pending to be restored in HSS\".\nThe 3GPP AAA Server shall use the HSS Identity received in the Origin-Host AVP (by comparing it with the value stored after a successful MAA command) and may make use of the received \"User List\" Information Element in order to determine which subscriber records are impacted, if any. If the 3GPP AAA Server determines that there are no subscribers affected by the HSS restart, it shall answer with a successful result to the HSS.",
      "chunk_type": "general",
      "cross_references": [
        "table_8.1.2.4.1.1",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.1.2.4.2",
      "section_id": "8.1.2.4.2",
      "section_title": "HSS Restoration",
      "content": "8.1.2.4.2.1\tGeneral\nThis procedure is used by the 3GPP AAA Server to restore in the HSS the registration data and the dynamic data for a certain user. The 3GPP AAA Sever shall use this procedure only after having received a previous indication from HSS of a restart event affecting that user.\nThis procedure is mapped to the Diameter command codes Server-Assignment-Request (SAR) and Server-Assignment-Answer (SAA) specified in the 3GPP TS 29.229 [24]. Information element contents for these messages are shown in tables 8.1.2.4.2.1/1 and 8.1.2.4.2.1/2.\nTable 8.1.2.4.2.1/1: HSS Restoration Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the IMSI of the user, for whom the registration data and dynamic data is being restored in HSS, and it shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nServer Assignment Type\nServer-Assignment-Type\nM\nThis IE shall contain the value \"RESTORATION\".\nActive APN\nActive-APN\nC\nThis Information Element, if present, contains the list of active APNs stored by the 3GPP AAA Server for this user, including the identity of the PDN GW assigned to each APN. For the explicitly subscribed APNs, the following information shall be present:\n- Context-Identifier: context id of subscribed APN in use\n- Service-Selection: name of subscribed APN in use\n- MIP6-Agent-Info: including PDN GW identity in use for subscribed APN\n- Visited-Network-Identifier: identifies the PLMN where the PDN GW was allocated\nFor the Wildcard APN, the following information shall be present:\n- Context-Identifier: context id of the Wildcard APN\n- Specific-APN-Info: list of APN-in use and related PDN GW identity when the subscribed APN is the wildcard APN\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\nTable 8.1.2.4.2.1/2: HSS Restoration Response\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nM\nThis information element shall contain the user IMSI and shall be formatted according to 3GPP TS 23.003 [14], clause 2.2.\nRegistration result\nResult-Code / Experimental-Result\nM\nThis IE contains the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for SWx errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host.\n8.1.2.4.2.2\tHSS Detailed behaviour\nUpon receipt of the SAR command, if the HSS supports the \"HSS Restoration\" feature, and the user's IMSI is known, the HSS shall update the registration data (from the Origin-Host AVP received in the 3GPP AAA Server command) and dynamic data of the user (included in the \"Active APN\" Information Element), and answer with a successful result.\n8.1.2.4.2.3\t3GPP AAA Server Detailed behaviour\nThe 3GPP AAA Server shall use this command to update the HSS with the registration data and dynamic data it has for a user affected by the HSS restart, identified by the \"User List\" IE received previously in the PPR command, and marked in the 3GPP AAA Server as \"pending to be restored in HSS\". The 3GPP AAA Server shall only make use of this procedure in the HSS has indicated support for the \"HSS Restoration\" feature.\nThe 3GPP AAA Server shall invoke the SAR command towards the HSS, after having received further interactions over other reference points (S6b, STa, SWm …) for a user marked as \"pending to be restored in HSS\".\nOnce the 3GPP AAA Server receives confirmation from HSS, in the SAA command, that the user has been successfully restored in the HSS, via the \"HSS Restoration Response\" command, it shall clear the \"pending to be restored in HSS\" flag for that user.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.003_clause_2.2",
        "table_8.1.2.4.2.1",
        "ts_29.229",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.1",
      "section_id": "8.2.1",
      "section_title": "General",
      "content": "The SWx reference point shall be Diameter based. This is defined as an IETF vendor specific Diameter application, where the Vendor ID is 3GPP. The Application Id used shall be 16777265.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.2.1",
      "section_id": "8.2.2.1",
      "section_title": "Authentication Procedure",
      "content": "The Multimedia-Authentication-Request (MAR) command, indicated by the Command-Code field set to 303 and the 'R' bit set in the Command Flags field, is sent by the 3GPP AAA Server to the HSS in order to request security information. This corresponds to clause 8.1.2.1.\nMessage Format\n< Multimedia-Auth-Request > ::=  < Diameter Header: 303, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n[ Destination-Host ]\n{ User-Name }\n[ RAT-Type ]\n[ AN-Trusted ]\n[ ANID ]\n[ Visited-Network-Identifier]\n[ Terminal-Information ]\n{ SIP-Auth-Data-Item }\n{ SIP-Number-Auth-Items }\n[AAA-Failure-Indication ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nThe Multimedia-Authentication-Answer (MAA) command, indicated by the Command-Code field set to 303 and the 'R' bit cleared in the Command Flags field, is sent by a server in response to the Multimedia-Authentication-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Multimedia-Auth-Answer > ::=  < Diameter Header: 303, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ User-Name}\n[ SIP-Number-Auth-Items ]\n*[ SIP-Auth-Data-Item ]\n[ 3GPP-AAA-Server-Name ]\n[ OC-Supported-Features ]\n[ OC-OLR ] ]\n*[ Load ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_8.1.2.1",
        "ts_29.229_clause_6.2",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.2.2",
      "section_id": "8.2.2.2",
      "section_title": "HSS Initiated Update of User Profile Procedure",
      "content": "The Push-Profile-Request (PPR) command, indicated by the Command-Code field set to 305 and the 'R' bit set in the Command Flags field, is sent by the HSS to the 3GPP AAA Server in order to update the subscription data whenever a modification has occurred in the subscription data; this corresponds to clause 8.1.2.3. This command is also sent by HSS to indicate a restart event to the 3GPP AAA Server, so the registration data and the dynamic data previously stored in HSS can be restored; this corresponds to clause 8.1.2.4.1.\nMessage Format\n< Push-Profile-Request > ::=\t< Diameter Header: 305, REQ, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Host }\n{ Destination-Realm }\n{ User-Name }\n[ Non-3GPP-User-Data ]\n[ PPR-Flags ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nThe Push-Profile-Answer (PPA) command, indicated by the Command-Code field set to 305 and the 'R' bit cleared in the Command Flags field, is sent by the HSS in response to the Push-Profile-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Push-Profile-Answer > ::=\t< Diameter Header: 305, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n[ Access-Network-Info ]\n[ Local-Time-Zone ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_8.1.2.3",
        "clause_8.1.2.4.1",
        "ts_29.229_clause_6.2",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.2.3",
      "section_id": "8.2.2.3",
      "section_title": "Non-3GPP IP Access Registration Procedure",
      "content": "The Server-Assignment-Request (SAR) command, indicated by the Command-Code field set to 301 and the 'R' bit set in the Command Flags field, is sent by the 3GPP AAA Server to the HSS; this corresponds to clause 8.1.2.2.2. This command is also sent by the 3GPP AAA Server to restore the registration data and the dynamic data previously stored in HSS, which may have been lost after a restart; this corresponds to clause 8.1.2.4.2.\nMessage Format\n< Server-Assignment-Request > ::=\t< Diameter Header: 301, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n[ Destination-Host ]\n{ Destination-Realm }\n[ Service-Selection ]\n[ Context-Identifier ]\n[ MIP6-Agent-Info ]\n[ Visited-Network-Identifier ]\n{ User-Name}\n{ Server-Assignment-Type }\n*[ Active-APN ]\n[ OC-Supported-Features ]\n*[ Supported-Features ]\n[ Terminal-Information ]\n[ Emergency-Services ]\n…\n*[ AVP ]\nThe Server-Assignment-Answer (SAA) command, indicated by the Command-Code field set to 301 and the 'R' bit cleared in the Command Flags field, is sent by the HSS to the 3GPP AAA Server to confirm the registration, de‑registration, user profile download or restoration procedure. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n< Server-Assignment-Answer > ::=\t< Diameter Header: 301, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ User-Name}\n[ Non-3GPP-User-Data ]\n[ 3GPP-AAA-Server-Name ]\n[ OC-Supported-Features ]\n[ OC-OLR ] ]\n*[ Load ]\n*[ Supported-Features ]\n…\n*[ AVP ]\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_8.1.2.2.2",
        "clause_8.1.2.4.2",
        "ts_29.229_clause_6.2",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.2.4",
      "section_id": "8.2.2.4",
      "section_title": "Network Initiated De-Registration by HSS Procedure",
      "content": "The Registration-Termination-Request (RTR) command, indicated by the Command-Code field set to 304 and the \"R\" bit set in the Command Flags field, is sent by a Diameter Multimedia server to a Diameter Multimedia client in order to request the de-registration of a user. This corresponds to clause 8.1.2.2.3.\nMessage Format\n<Registration-Termination-Request> ::=\t< Diameter Header: 304, REQ, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Host }\n{ Destination-Realm }\n{ User-Name }\n{ Deregistration-Reason }\n*[ Supported-Features ]\n…\n*[ AVP ]\nThe Registration-Termination-Answer (RTA) command, indicated by the Command-Code field set to 304 and the \"R\" bit cleared in the Command Flags field, is sent by a client in response to the Registration-Termination-Request command. The Result-Code or Experimental-Result AVP may contain one of the values defined in clause 6.2 of 3GPP TS 29.229 [24] in addition to the values defined in IETF RFC 6733 [58].\nMessage Format\n<Registration-Termination-Answer> ::=\t< Diameter Header: 304, PXY, 16777265 >\n< Session-Id >\n[ DRMP ]\n{ Vendor-Specific-Application-Id }\n[ Result-Code ]\n[ Experimental-Result ]\n{ Auth-Session-State }\n{ Origin-Host }\n{ Origin-Realm }\n*[ Supported-Features ]\n…\n*[ AVP ]\nNOTE:\tAs the Diameter commands described in this specification have been defined based on the former specification of the Diameter base protocol, the Vendor-Specific-Application-Id AVP is still listed as a required AVP (an AVP indicated as {AVP}) in the command code format specifications defined in this specification to avoid backward compatibility issues, even if the use of this AVP has been deprecated in the new specification of the Diameter base protocol (IETF RFC 6733 [58]).",
      "chunk_type": "procedure",
      "cross_references": [
        "clause_8.1.2.2.3",
        "ts_29.229_clause_6.2",
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.0",
      "section_id": "8.2.3.0",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the SWx interface protocol, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.\nTable 8.2.3.0/1: Diameter SWx AVPs\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nNon-3GPP-User-Data\n1500\n8.2.3.1\nGrouped\nM,V\nP\nNon-3GPP-IP-Access\n1501\n8.2.3.3\nEnumerated\nM,V\nP\nNon-3GPP-IP-Access-APN\n1502\n8.2.3.4\nEnumerated\nM,V\nP\nANID\n1504\n5.2.3.7\nUTF8String\nM,V\nP\nTrace-Info\n1505\n8.2.3.13\nGrouped\nV\nM,P\nPPR-Flags\n1508\n8.2.3.17\nUnsigned32\nV\nM,P\nTWAN-Default-APN-Context-Id\n1512\n8.2.3.18\nUnsigned32\nV\nM,P\nTWAN-Access-Info\n1510\n8.2.3.19\nGrouped\nV\nM,P\nAccess-Authorization-Flags\n1511\n8.2.3.20\nUnsigned32\nV\nM,P\nWLAN-Identifier\n1509\n5.2.3.18\nGrouped\nV\nM,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nAAA-Failure-Indication\n1518\n8.2.3.21\nUnsigned32\nV\nM,P\nAccess-Network-Info\n1524\n5.2.3.24\nGrouped\nV\nM,P\n3GPP-AAA-Server-Name\n318\n8.2.3.24\nDiameterIdentity\nM, V\nP\nERP-Authorization\n1541\n8.2.3.27\nUnsigned32\nV\nM,P\nAN-Trusted\n1503\n5.2.3.9\nEnumerated\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see ETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nThe following table describes the Diameter AVPs re-used by the SWx interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use within SWx. Other AVPs from existing Diameter Applications, except for the AVPs from Diameter base protocol (see IETF RFC 6733 [58]), do not need to be supported.\nTable 8.2.3.0/2: SWx re-used Diameter AVPs\nAttribute Name\nReference\nComments\nM-bit\nUser-Name\nETF RFC 6733 [58]\nSession-Timeout\nETF RFC 6733 [58]\nSubscription-ID\nIETF RFC 4006 [20]\nMIP6-Agent-Info\nIETF RFC 5447 [6]\nMIP6-Feature-Vector\nIETF RFC 5447 [6]\nService-Selection\nIETF RFC 5778 [11]\n3GPP-Charging-Characteristics\n3GPP TS 29.061 [31]\nRAT-Type\n3GPP TS 29.212 [23]\nVisited-Network-Identifier\n3GPP TS 29.229 [24]\nSIP-Number-Auth-Items\n3GPP TS 29.229 [24]\nSIP-Item-Number\n3GPP TS 29.229 [24]\nSIP-Auth-Data-Item\n3GPP TS 29.229 [24]\nSIP-Authentication-Scheme\n3GPP TS 29.229 [24]\nSIP-Authenticate\n3GPP TS 29.229 [24]\nSIP-Authorization\n3GPP TS 29.229 [24]\nConfidentiality-Key\n3GPP TS 29.229 [24]\nIntegrity-Key\n3GPP TS 29.229 [24]\nServer-Assignment-Type\n3GPP TS 29.229 [24]\nDeregistration-Reason\n3GPP TS 29.229 [24]\nSupported-Features\n3GPP TS 29.229 [24]\nFeature-List-ID\n3GPP TS 29.229 [24]\nFeature-List\n3GPP TS 29.229 [24]\nAPN-Configuration\n3GPP TS 29.272 [29]\nContext-Identifier\n3GPP TS 29.272 [29]\nTerminal-Information\n3GPP TS 29.272 [29]\nAMBR\n3GPP TS 29.272 [29]\nAPN-OI-Replacement\n3GPP TS 29.272 [29]\nTrace-Reference\n3GPP TS 29.272 [29]\nTrace-Data\n3GPP TS 29.272 [29]\nActive-APN\n3GPP TS 29.272 [29]\nBSSID\n3GPP TS 32.299 [30]\nLocation-Information\nIETF RFC 5580 [46]\nLocation-Data\nIETF RFC 5580 [46]\nOperator-Name\nIETF RFC 5580 [46]\nLocal-Time-Zone\n3GPP TS 29.272 [29]\nOC-Supported-Features\nIETF RFC 7683 [47]\nSee clause 8.2.3.22\nMust not set\nOC-OLR\nIETF RFC 7683 [47]\nSee clause 8.2.3.23\nMust not set\nDRMP\nIETF RFC 7944 [53]\nSee clause 8.2.3.25\nMust not set\nEmergency-Info\n3GPP TS 29.272 [29]\nLoad\nIETF RFC 8583 [54]\nSee clause 8.2.3.26\nMust not set\nUE-Usage-Type\n3GPP TS 29.272 [29]\nCore-Network-Restrictions\n3GPP TS 29.272 [29]\nMPS-Priority\n3GPP TS 29.272 [29]\nMust not set\nNOTE 1:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies.\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.\nOnly those AVP initially defined in this reference point or AVP with values initially defined in this reference point and for this procedure are described in the following clauses.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_8.2.3.22",
        "clause_8.2.3.23",
        "clause_8.2.3.25",
        "clause_8.2.3.26",
        "table_8.2.3.0",
        "ts_29.061",
        "ts_29.212",
        "ts_29.229",
        "ts_29.272",
        "ts_32.299"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.1",
      "section_id": "8.2.3.1",
      "section_title": "Non-3GPP-User-Data",
      "content": "The Non-3GPP-User-Data AVP is of type Grouped. It contains the information related to the user profile relevant for EPS.\nAVP format:\nNon-3GPP-User-Data ::=\t< AVP Header: 1500 10415 >\n[ Subscription-ID ]\n[ Non-3GPP-IP-Access ]\n[ Non-3GPP-IP-Access-APN ]\n*[ RAT-Type ]\n[ Session-Timeout ]\n[ MIP6-Feature-Vector ]\n[ AMBR ]\n[ 3GPP-Charging-Characteristics ]\n[ Context-Identifier ]\n[ APN-OI-Replacement ]\n*[ APN-Configuration ]\n[ Trace-Info ]\n[ TWAN-Default-APN-Context-Id ]\n*[ TWAN-Access-Info]\n[ UE-Usage-Type ]\n[ Emergency-Info ]\n[ ERP-Authorization ]\n[ Core-Network-Restrictions ]\n[ MPS-Priority ]\n*[ AVP ]\nThe Subscription-ID, if present in this grouped AVP, shall contain either an MSISDN (if this identity is present in the subscription), or an External Identifier (if the subscriber does not have an MSISDN identity but has an External Identifier in the subscription).\nThe AMBR included in this grouped AVP shall include the AMBR associated to the user's subscription (UE-AMBR).\nThe APN-OI-Replacement included in this grouped AVP shall include the UE level APN-OI-Replacement associated to the user's subscription. This APN-OI-Replacement has lower priority than APN level APN-OI-Replacement that is included in the APN-Configuration AVP.\nThe Non-3GPP-User-Data AVP shall only contain APN-Configuration AVP(s) configured in the user subscription with an IP PDN type.\nThe Context-Identifier in this grouped AVP shall identify the user's default APN configuration. The TWAN-Default-APN-Context-Id AVP identifies the default APN configuration for EPC access over Trusted WLAN. This AVP shall be present if the default APN configuration for EPC access over Trusted WLAN differs from the default APN configuration for 3GPP access and other non-3GPP accesses. This AVP may be present otherwise.\nThe RAT-Type AVP(s) shall include the access technology type(s) not allowed for the user as specified in clause 2.13.126 of 3GPP TS 23.008 [49].\nThe Emergency-Info AVP shall contain the identity of the PDN-GW used for the establishment of emergency PDN connections.\nThe MIP6-Feature-Vector may provide HSM and/or NBM authorization information (see clause 8.2.3.28).\nFor the conditions specified in clause 8.1.2.3.2, the Non-3GPP-User-Data AVP shall be empty, i.e. not include any AVP.\nIf the Non-3GPP-User-Data AVP is not empty, the Non-3GPP-IP-Acess AVP, the Non-3GPP-IP-Access-APN AVP, the Context-Identifier AVP and at least one item of the APN-Configuration AVP shall always be included, except when the Non-3GPP-User-Data AVP is used for downloading trace activation or deactivation information on the SWx interface, for an already registered user, or when the Non-3GPP-User-Data is used for downloading the Emergency-Info. In those specific cases, the Trace-Info AVP, or respectively the Emergency-Info AVP, shall be included and the presence of any further AVPs is optional.\nThe MPS-Priority AVP shall be present if an MPS subscription exists in the HSS for the UE.",
      "chunk_type": "general",
      "cross_references": [
        "ts_23.008_clause_2.13.126",
        "clause_8.2.3.28",
        "clause_8.1.2.3.2",
        "ts_23.008"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.2",
      "section_id": "8.2.3.2",
      "section_title": "Subscription-ID",
      "content": "The Subscription-ID AVP is of type Grouped and indicates the user identity to be used for charging purposes. It is defined in the IETF RFC 4006 [20]. EPC shall make use only of the MSISDN and External Identifier values.\nWhen the identity to be conveyed is an MSISDN, the AVP Subscription-Id-Type shall be set to value \"END_USER_E164\".\nWhen the identity to be conveyed is an External Identifier, the AVP Subscription-Id-Type shall be set to value \"END_USER_NAI\".\nThen AVP Subscription-Id-Data, with type UTF8String, shall contain the identity of the user.\nAVP format:\nSubscription-Id ::=\t< AVP Header: 443 >\n[ Subscription-Id-Type ]\n[ Subscription-Id-Data ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.3",
      "section_id": "8.2.3.3",
      "section_title": "Non-3GPP-IP-Access",
      "content": "The Non-3GPP-IP-Access AVP (AVP code 1501) is of type Enumerated, and allows operators to determine if the subscriber is barred from using the non-3GPP access network. The following values are defined:\nNON_3GPP_SUBSCRIPTION_ALLOWED (0)\nThe subscriber has non-3GPP subscription and is authorized to use the non-3GPP access network.\nNON_3GPP_SUBSCRIPTION_BARRED (1)\nThe subscriber is barred from using the non-3GPP access network.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.4",
      "section_id": "8.2.3.4",
      "section_title": "Non-3GPP-IP-Access-APN",
      "content": "The Non-3GPP-IP-Access-APN AVP (AVP code 1502) is of type Enumerated, and allows operator to disable all APNs for a subscriber at one time. The following values are defined:\nNon_3GPP_APNS_ENABLE (0)\nEnable all APNs for a subscriber.\nNon_3GPP_APNS_DISABLE (1)\nDisable all APNs for a subscriber",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.5",
      "section_id": "8.2.3.5",
      "section_title": "RAT-Type",
      "content": "The RAT-Type AVP (AVP code 1032) is of type Enumerated. The encoding of the AVP is specified in 3GPP TS 29.212 [23].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.212"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.6",
      "section_id": "8.2.3.6",
      "section_title": "Session-Timeout",
      "content": "The Session-Timeout AVP is of type Unsigned32. It is defined in IETF RFC 6733 [58] and indicates the maximum period for a session measured in seconds. This AVP is used for re-authentication purposes. If this field is not used, the non-3GPP Access Node will apply default time intervals.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.7",
      "section_id": "8.2.3.7",
      "section_title": "APN-Configuration",
      "content": "The APN-Configuration AVP is of type Grouped AVP and is defined in 3GPP TS 29.272 [29].\nThe following AVPs defined in the APN-Configuration AVP in 3GPP TS 29.272 [29] are not applicable to Non-3GPP accesses and therefore need not be included in the APN-Configuration AVP over the SWx, SWd, SWm, STa and S6b reference points:\n-\tLIPA-Permission AVP\n-\tRestoration-Priority AVP\n-\tSIPTO-Local-Network-Permission AVP\n-\tWLAN-offloadability AVP\n-\tNon-IP-PDN-Type-Indicator AVP\n-\tNon-IP-Data-Delivery-Mechanism AVP\n-\tSCEF-ID AVP\n-\tSCEF-Realm AVP\n-\tPreferred-Data-Mode AVP",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.8",
      "section_id": "8.2.3.8",
      "section_title": "ANID",
      "content": "The ANID AVP is defined in clause 5.2.3.7.",
      "chunk_type": "general",
      "cross_references": [
        "clause_5.2.3.7"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.9",
      "section_id": "8.2.3.9",
      "section_title": "SIP-Auth-Data-Item",
      "content": "The SIP-Auth-Data-Item AVP is defined in 3GPP TS 29.229 [24]. The optional AVPs that are needed in SWx reference point are included in the ABNF representation below.\nAVP format:\nSIP-Auth-Data-Item ::=\t< AVP Header: 612 10415 >\n[ SIP-Item-Number ]\n[ SIP-Authentication-Scheme ]\n[ SIP-Authenticate ]\n[ SIP-Authorization ]\n[ Confidentiality-Key ]\n[ Integrity-Key ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.10",
      "section_id": "8.2.3.10",
      "section_title": "Confidentiality-Key",
      "content": "The Confidentiality-Key AVP is defined in 3GPP TS 29.229 [24]. It is of type OctetString, and contains the Confidentiality Key (CK') or, after key derivation using the Access Network Identifier, the Confidentiality Key (CK'). For the 3GPP AAA server it is transparent whether the value received corresponds to CK or CK'.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.11",
      "section_id": "8.2.3.11",
      "section_title": "Integrity-Key",
      "content": "The Integrity-Key AVP is defined in 3GPP TS 29.229 [24]. It is of type OctetString, and contains the Integrity Key (IK) or, after key derivation using the Access Network Identifier, the Integrity Key (IK'). For the 3GPP AAA server it is transparent whether the value received corresponds to IK or IK'.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.12",
      "section_id": "8.2.3.12",
      "section_title": "Server-Assignment-Type AVP",
      "content": "The Server-Assignment-Type AVP is defined in 3GPP TS 29.229 [24] and it is of type Enumerated, and indicates the type of server update being performed in a Server-Assignment-Request operation. As part of the SWx protocol specification, the following values are additionally defined:\nAAA_USER_DATA_REQUEST (12)\nThis value is used to request the non-3GPP user profile data from the 3GPP AAA Server to the HSS.\nPGW_UPDATE (13)\nThis value is used to store, update or delete the PDN-GW Identity in the HSS, as requested from the 3GPP AAA Server.\nRESTORATION (14)\nThis value is used to store in the HSS registration data and dynamic data that may have been potentially lost after a restart event.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.13",
      "section_id": "8.2.3.13",
      "section_title": "Trace-Info",
      "content": "The Trace-Info AVP is of type Grouped. This AVP shall contain the information related to subscriber and equipment trace function and the required action, i.e. activation of deactivation\nAVP format\nTrace-Info ::= < AVP header: 1505 10415>\n[Trace-Data]\n[Trace-Reference]\n*[AVP]\nEither the Trace-Data or the Trace-Reference AVP shall be included. When trace activation is needed, Trace-Data AVP shall be included, while the trace deactivation request shall be signalled by including the Trace-Reference directly under the Trace-Info. The Trace-Reference AVP is of type OctetString. The Diameter AVP is defined in 3GPP TS 29.272 [29].",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.14",
      "section_id": "8.2.3.14",
      "section_title": "Trace-Data",
      "content": "The Trace-Data AVP is of type Grouped. The Diameter AVP is defined in 3GPP TS 29.272 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.15",
      "section_id": "8.2.3.15",
      "section_title": "Feature-List-ID AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the SWx application.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.16",
      "section_id": "8.2.3.16",
      "section_title": "Feature-List AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the SWx application. The meaning of the bits shall be as defined in table 8.2.3.16/1.\nTable 8.2.3.16/1: Features of Feature-List-ID 1 used in SWx\nFeature bit\nFeature\nM/O\nDescription\n0\nHSS Restoration\nO\nHSS Restoration\nThis feature is applicable for the MAR/MAA, PPR/PPA and SAR/SAA command pairs.\nIf the 3GPP AAA Server does not indicate support for this feature in a former MAR or SAR command, the HSS shall not send a PPR command to indicate a restart event to the 3GPP AAA Server.\n1\nAccess-Network-Information-Retrieval\nO\nAccess Network Information Retrieval\nThis feature is applicable for the MAR/MAA and PPR/PPA and SAR/SAA command pairs.\nIf the 3GPP AAA Server does not indicate support for this feature in a former MAR or SAR command, the HSS shall not send a PPR command to request access network information from the 3GPP AAA Server.\n2\nUE Local Time Zone Retrieval\nO\nUE Local Time Zone Retrieval\nThis feature is applicable for the MAR/MAA and PPR/PPA and SAR/SAA command pairs.\nIf the 3GPP AAA Server does not indicate support for this feature in a former MAR or SAR command, the HSS shall not send a PPR command to request the local time zone of the UE from the 3GPP AAA Server.\n3\nP-CSCF Restoration for WLAN\nO\nSupport of P-CSCF Restoration for WLAN\nThis feature is applicable to the MAR/MAA and PPR/PPA and SAR/SAA command pairs over the SWx interface, when the 3GPP AAA Server supports the execution of the P-CSCF restoration procedures for WLAN as described in 3GPP TS 23.380 [52] clause 5.6.\nIf the 3GPP AAA Server does not indicate support of this feature in a former MAR or SAR command, the HSS shall not send a PPR command requesting the execution of HSS-based P-CSCF restoration procedures for WLAN,\n4\nEmergency Services Continuity\nO\nSupport of Emergency Services Continuity\nThis feature is applicable to the PPR/PPA and SAR/SAA command pairs over the SWx interface, when the HSS and the 3GPP AAA Server support the continuity of emergency services upon mobility between 3GPP and WLAN accesses, as specified in clause 4.5.7.2 of 3GPP TS 23.402 [3].\nIf the 3GPP AAA Server does not indicate support of this feature in a former SAR command, the HSS shall not include the Emergency Info in a SAA command and shall not send a PPR command to update the Emergency Info.\nIf the HSS does not indicate support of this feature in a former SAA command (e.g. during the registration of the non-3GPP user), the 3GPP AAA Server shall not send a SAR command to update the Emergency Info.\nIf the HSS supports this feature on SWx, it shall also support the Emergency Service Continuity feature on S6a, see 3GPP TS 29.272 [29].\n5\nERP\nO\nSupport of EAP Reauthentication Protocol\nThis feature is applicable to the MAR/MAA and PPR/PPA command pairs over the SWx interface.\nIf the 3GPP AAA Server does not indicate support of this feature in a former MAR command, the HSS shall not include ERP authorization data in the subscription profile, and it shall not send subsequent PPR commands to update the ERP authorization status of this user.\nIf the HSS does not indicate support of this feature in the MAA command, the 3GPP AAA Server shall not expect the reception of explicit authorization of ERP in the subscription profile, and may allow/disallow ERP for all subscribers, according to local policy.\n6\nDedicated Core Networks\nO\nSupport of Dedicated Core Networks\nThis feature is applicable to the SAR/SAA and PPR/PPA command pairs over the SWx interface.\nIf the 3GPP AAA Server does not indicate support of this feature in the SAR command, the HSS shall not send DCN-related subscription data (e.g., UE Usage Type) in SAA, and shall not send subsequent PPR commands when such subscription data are updated.\nIf the 3GPP AAA Server does not indicate support of this feature in the PPA command and the HSS has already sent DCN-related subscription data in PPR, the HSS may store this indication and not send further updates related to DCN subscription data.\nFeature bit: The order number of the bit within the Supported-Features AVP, e.g. \"1\".\nFeature: A short name that can be used to refer to the bit and to the feature.\nM/O: Defines if the implementation of the feature is mandatory (\"M\") or optional (\"O\").\nDescription: A clear textual description of the feature.\nFeatures that are not indicated in the Supported-Features AVPs within a given application message shall not be used to construct that message.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "ts_23.402_clause_4.5.7.2",
        "table_8.2.3.16",
        "ts_29.229",
        "ts_23.380",
        "ts_23.402",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.17",
      "section_id": "8.2.3.17",
      "section_title": "PPR-Flags",
      "content": "The PPR-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 8.2.3.17/1:\nTable 8.2.3.17/1: PPR-Flags\nBit\nName\nDescription\n0\nReset-Indication\nThis bit, when set, indicates that the HSS has undergone a restart event and the registration data and dynamic data needs to be restored, if available at the 3GPP AAA Server.\n1\nAccess-Network-Info-Request\nThis bit, when set, indicates that the HSS requests the 3GPP AAA Server the identity and location information of the access network where the UE is currently attached.\n2\nUE-Local-Time-Zone-Request\nThis bit, when set, indicates that the HSS requests the 3GPP AAA Server the time zone of the location in the access network where the UE is attached.\n3\nP-CSCF Restoration Request\nThis bit, when set, indicates to the 3GPP AAA Server that the HSS requests the execution of the HSS-based P-CSCF restoration procedures for WLAN, as described in 3GPP TS 23.380 [52] clause 5.6.\nNOTE:\tBits not defined in this table shall be cleared by the sending HSS and discarded by the receiving 3GPP AAA Server.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "table_8.2.3.17",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.18",
      "section_id": "8.2.3.18",
      "section_title": "TWAN-Default-APN-Context-Id",
      "content": "The TWAN-Default-APN-Context-Id AVP is of the type Unsigned32 and shall identify the context identifier of the subscriber's default APN to be used for Trusted WLAN access to EPC over S2a.\nNote: The default APN for Trusted WLAN access to EPC over S2a can differ from the default APN for 3GPP and other non-3GPP accesses.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.19",
      "section_id": "8.2.3.19",
      "section_title": "TWAN-Access-Info",
      "content": "The TWAN-Access-Info AVP is of type Grouped.\nIf no WLAN-Identifier AVP is included in the TWAN-Access-Info AVP, the allowed access methods shall apply to any arbitrary Trusted WLAN. See clause 5.1.2.1.2.\nIf the Access-Authorization-Flags AVP is not present in the TWAN-Access-Info AVP, EPC access and Non-Seamless WLAN Offload shall be considered to be not allowed.\nA specific Trusted-WLAN shall appear in at most one TWAN-Access-Info AVP.\nThere shall be at most one TWAN-Access-Info AVP not including any WLAN-Identifier.\nAVP Format:\nTWAN-Access-Info::=\t< AVP Header: 1510 10415 >\n[ Access-Authorization-Flags ]\n[ WLAN-Identifier ]\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.1.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.20",
      "section_id": "8.2.3.20",
      "section_title": "Access-Authorization-Flags",
      "content": "The Access-Authorization-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 8.2.3.20/1:\nTable 8.2.3.20/1: Access-Authorization-Flags\nBit\nName\nDescription\n0\nEPC-Access-Authorization\nThis bit, when set, indicates that the UE is allowed to access the EPC when connected via Trusted WLAN access. This flag, when not set, indicates that the UE is not allowed to access EPC when connected via Trusted WLAN access.\n1\nNSWO-Access-Authorization\nThis bit, when set, indicates that the UE is allowed Non-Seamless WLAN Offload access via Trusted WLAN access. This flag, when not set, indicates that the UE is not allowed to Non-Seamless WLAN Offload via Trusted WLAN access.\nNOTE:\tBits not defined in this table shall be cleared by the sending HSS and discarded by the receiving 3GPP AAA Server.\nNOTE:\tUE is allowed to access the EPC when connected via Trusted WLAN access only if the Non-3GPP-IP-Access-APN AVP does not disable all APNs and the EPC-Access-Authorization bit is set.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_8.2.3.20"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.21",
      "section_id": "8.2.3.21",
      "section_title": "AAA-Failure-Indication",
      "content": "The AAA-Failure-Indication AVP is of type Unsigned32 and it shall contain a bitmask. The meaning of the bits is defined in table 8.2.3.21/1:\nTable 8.2.3.21/1: AAA-Failure-Indication\nBit\nName\nDescription\n0\nAAA Failure\nThis bit, when set, indicates that a previously assigned 3GPP AAA Server is unavailable.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_8.2.3.21"
      ]
    },
    {
      "chunk_id": "ts_29.273_8.2.3.22",
      "section_id": "8.2.3.22",
      "section_title": "OC-Supported-Features",
      "content": "The OC-Supported-Features AVP is of type Grouped and it is defined in IETF RFC 7683 [47]. This AVP is used to support Diameter overload control mechanism, see Annex B for more information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.23",
      "section_id": "8.2.3.23",
      "section_title": "OC-OLR",
      "content": "The OC-OLR AVP is of type Grouped and it is defined in IETF RFC 7683 [47]. This AVP is used to support Diameter overload control mechanism, see Annex B for more information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.24",
      "section_id": "8.2.3.24",
      "section_title": "3GPP-AAA-Server-Name",
      "content": "The 3GPP-AAA-Server-Name AVP is of type DiameterIdentity, and defines the Diameter address of the 3GPP AAA Server node.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.25",
      "section_id": "8.2.3.25",
      "section_title": "DRMP",
      "content": "The DRMP AVP is of type Enumerated and is defined in IETF RFC 7944 [53]. This AVP allows the 3GPP functional entities to indicate the relative priority of Diameter messages. The DRMP AVP may be used to set the DSCP marking for transport of the associated Diameter message.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.26",
      "section_id": "8.2.3.26",
      "section_title": "Load",
      "content": "The Load AVP is of type Grouped and it is defined in IETF RFC 8583 [54]. This AVP is used to support Diameter load control mechanism, see Annex E for more information.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.27",
      "section_id": "8.2.3.27",
      "section_title": "ERP-Authorization",
      "content": "The ERP-Authorization AVP is of type Unsigned32 and it indicates whether the subscriber is authorized, or not, to make use of the EAP Reauthentication Protocol. The following values are defined:\nERP_NOT_AUTHORIZED (0)\nERP_AUTHORIZED (1)",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.3.28",
      "section_id": "8.2.3.28",
      "section_title": "MIP6-Feature-Vector",
      "content": "The MIP6-Feature-Vector AVP (AVP Code 124) is of type Unsigned64 and contains a 64 bit flags field of the mobile IP capabilities authorized by the HSS.\nThe following capabilities are defined for the SWx interface:\n-\tMIP6_INTEGRATED (0x0000000000000001)This flag means that DSMIPv6 is authorized.\n-\tPMIP6_SUPPORTED (0x0000010000000000)This flag means that NBM is authorized.\n-\tMIP4_SUPPORTED (0x0000100000000000)This flag means that MIPv4 is authorized.\n-\tGTPv2_SUPPORTED (0x0000400000000000)This flag means that NBM is authorized.\nNBM shall be considered as authorized if at least one of the PMIP6_SUPPORTED and GTPv2_SUPPORTED flag is set.\nNOTE:\tThe selection of the protocol variant (GTPv2 or PMIPv6) on S2a/S2b is determined solely by the TWAN/ePDG. It does not matter whether the HSS sets the PMIP6_SUPPORTED and/or GTPv2_SUPPORTED flags to authorize NBM.\nBased on operator policy, the 3GPP AAA Server may also authorize the use of NBM, irrespective of the presence or content of the MIP6-Feature-Vector AVP in the Non-3GPP User Data.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.2.4",
      "section_id": "8.2.4",
      "section_title": "Session Handling",
      "content": "The Diameter protocol between the 3GPP AAA Server and the HSS shall not keep the session state and each Diameter request/response interaction shall be transported over a different diameter session which is implicitly terminated.\nIn order to indicate that session state shall not be maintained, the diameter client and server shall include the Auth-Session-State AVP set to the value NO_STATE_MAINTAINED (1), as described in IETF RFC 6733 [58]. As a consequence, the server shall not maintain any state information about this session and the client shall not send any session termination request. Neither the Authorization-Lifetime AVP nor the Session-Timeout AVP shall be present in requests or responses.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_8.3",
      "section_id": "8.3",
      "section_title": "User identity to HSS resolution",
      "content": "The User identity to HSS resolution mechanism enables the 3GPP AAA server to find the identity of the HSS that holds the subscriber data for a given user identity when multiple and separately addressable HSSs have been deployed by the network operator. The resolution mechanism is not required in networks that utilise a single HSS or when a 3GPP AAA server is configured to use pre-defined HSS address/identity.\nThis User identity to HSS resolution mechanism may rely on routing capabilitites provided by Diameter and be implemented in the home operator network within dedicated Diameter Agents (Redirect Agents or Proxy Agents) responsible for determining the HSS identity based on the provided user identity. If this Diameter based implementation is selected by the Home network operator, the principles described below shall apply.\nIn networks where more than one independently addressable HSS are utilized by a network operator, and the 3GPP AAA server is not configured to use pre-defined HSS address/identity, each 3GPP AAA server shall be configured with the address/identity of the Diameter Agent (Redirect Agent or Proxy Agent) implementing this resolution mechanism.\nTo get the HSS identity that holds the subscriber data for a given user identity, the 3GPP AAA server shall send the Diameter request normally destined to the HSS to a pre-configured address/identity of a Diameter agent supporting the User identity to HSS resolution mechanism.\n-\tIf this Diameter request is received by a Diameter Redirect Agent, the Diameter Redirect Agent shall determine the HSS identity based on the provided user identity and sends to the 3GPP AAA server a notification of redirection towards the HSS identity, in response to the Diameter request. Multiple HSS identities may be included in the response from the Diameter Redirect Agent, as specified in IETF RFC 6733 [58]. In such a case, the 3GPP AAA server shall send the Diameter request to the first HSS identity in the ordered list received in the Diameter response from the Diameter Redirect Agent. If no successful response to the Diameter request is received, the 3GPP AAA server shall send a Diameter request to the next HSS identity in the ordered list. This procedure shall be repeated until a successful response from an HSS is received.\n-\tIf this Diameter request is received by a Diameter Proxy Agent, the Diameter Proxy Agent shall determine the HSS identity based on the provided user identity and - if the Diameter load control mechanism is supported (see IETF RFC 8583 [54]) - optionally also based on previously received load values from Load AVPs of type HOST. The Diameter Proxy Agent shall then forward the Diameter request directly to the determined HSS. The 3GPP AAA server shall determine the HSS identity from the response to the Diameter request received from the HSS.\nAfter the User identity to HSS resolution, the 3GPP AAA server shall store the HSS identity/name/Realm and shall use it in further Diameter requests associated to the same user dentity.\nNOTE:\tAlternatives to the user identity to HSS resolution Diameter based implementation are outside the scope of this specification.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.1",
      "section_id": "9.1.1",
      "section_title": "General",
      "content": "The S6b reference point is defined between the 3GPP AAA Server and the PDN-GW. The definition of the reference point and its functionality is given in 3GPP TS 23.402 [3].\nWhen the UE attaches to the EPC using the S2c reference point, the S6b reference point is used to authenticate and authorize the UE, and update the PDN-GW address to the 3GPP AAA server and HSS.\nWhen the UE attaches to the EPC using the S2a/S2b reference point in the PMIPv6 or GTPv2 mode, the S6b reference point is used to update the 3GPP AAA server or the 3GPP AAA proxy with the PDN-GW address information and with the selected S2a/S2b protocol variant. Furthermore, this reference point may be used to retrieve and update other mobility related parameters including static QoS profiles for non-3GPP accesses.\nThe S6b reference point is also used to authenticate and authorize the incoming MIPv4 Registration Request in the case the UE attaches to the EPC over the S2a reference point using MIPv4 FACoA procedures.\nThe S6b reference point is used by the 3GPP AAA Server in the case the UE attaches to the EPC using the S2c reference point to indicate to the PDN GW that a PDN GW reallocation shall be performed. This indication triggers the actual Home Agent reallocation procedure as specified in 3GPP TS 24.303 [13].\nThe S6b reference point is also used to download subscriber and equipment trace information to the PDN GW.\nThe S6b reference point is also used by the 3GPP AAA Server to indicate to the PDN GW that the HSS-based P-CSCF restoration procedure for WLAN shall be executed as described in 3GPP TS 23.380 [52] clause 5.6.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "ts_23.402",
        "ts_24.303",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.1.1",
      "section_id": "9.1.2.1.1",
      "section_title": "General",
      "content": "The S6b interface shall enable the authentication and authorization between the UE and the 3GPP AAA Server/Proxy for DSMIPv6.\nWhen an UE performs the DSMIPv6 initial attach, it runs an IKEv2 exchange with the PDN GW as specified in 3GPP TS 24.303 [13]. In this exchange EAP AKA is used for UE authentication over IKEv2. The PDN GW acts as an IKEv2 responder and an EAP pass-through authenticator for this authentication.\nThe S6b authentication and authorization procedure is invoked by the PDN GW after receiving an IKE_SA_AUTH message from the UE. The S6b reference point performs authentication based on reuse of the DER/DEA command set defined in Diameter EAP. The exact procedure follows the steps specified in IETF RFC 5778 [11].\nNOTE:\tThis procedure is only used with DSMIPv6-capable UEs; therefore, only PDNs with PDN Types IPv6 or IPv4v6 are accessible in this case.\nTable 9.1.2.1/1: Authentication and Authorization Request\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nUser identity\nUser-Name\nM\nThis information element shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the UE is to be authenticated only, authorized only or both. AUTHORIZE_AUTHENTICATE shall be used in this case.\nEAP Payload\nEAP-Payload\nM\nThis IE shall contain the Encapsulated payload for UE – 3GPP AAA Server mutual authentication\nPGW PLMN ID\nVisited-Network-Identifier\nC\nThis IE shall contain the identifier that allows the home network to identify the PLMN where the PGW is located. It shall be present when the PGW Identity does not contain an FQDN.\nAccess Type\nRAT-Type\nC\nThis Information Element shall contain the non-3GPP access network technology type that is serving the UE.\nThis IE shall be present if it is available when the PDN GW sends the request.\nPDN GW Identity\nMIP6 -Agent-Info\nM\nThis IE shall contain the FQDN and/or IPv6 address(es) of the PDN GW that the user shall be connected to.\nIf the PDN GW includes the IP address in the PDN GW Identity, it shall include the HA IPv6 address and, if used, the IPv4 address, as DSMIPv6 is used.\nMIP Subscriber Profile\nMIP6-Feature-Vector\nM\nThis AVP shall be included to inform the 3GPP AAA Server about the used mobility protocol. None of the PMIP6_SUPPORTED or MIP4_SUPPORTED flags shall be set, since DSMIPv6 is used in this case.\nAPN\nService-Selection\nO\nIf present, this IE shall contain the Network Identifier part of the APN extracted from the IKE_AUTH message.\nIt shall include the APN that the user shall be connected to. It shall be only included if received from UE. In case it is not received, the 3GPP AAA Server shall assign the received PDN-GW identity to the default APN.\nQoS capabilities\nQoS-Capability\nO\nThis IE shall be included if present in the request message. It shall indicate to the 3GPP AAA Server that the PGW requests downloading a static QoS profile for the UE. The PGW may include this IE only at the initial attach of the UE.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nCare of Address\nMIP-Careof-Address\nO\nIf present, this IE shall contain the IPv4 or the IPv6 Care of Address of the UE as defined in IETF RFC 5778 [11]\nAAA Failure Indication\nAAA-Failure-Indication\nO\nIf present, this information element shall indicate that the request is sent after the PDN-GW has determined that a previously assigned 3GPP AAA Server is unavailable.\nDER S6b Flags\nDER-S6b-Flags\nO\nThis Information Element contains a bit mask. See 9.2.3.7 for the meaning of the bits.\nUE local IP address\nUE-Local-IP-Address\nO\nThe PDN GW shall include this IE based on local policy for Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39]. If present, it shall contain the source IPv4 or IPv6 address of the IKE_SA_AUTH message from the UE.\nTable 9.1.2.1/2: Authentication and Authorization Answer\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nUser Identity\nUser-Name\nO\nThis information element, if present, shall contain the identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]. This IE shall include the leading digit used to differentiate between authentication schemes.\nEAP Payload\nEAP-Payload\nO\nIf present, this IE shall contain the Encapsulated payload for UE – 3GPP AAA Server mutual authentication\nMaster Session Key\nEAP-Master-Session-Key\nC\nThis IE shall contain the Keying material for protecting the communication between the UE and PDN GW. It shall be present only if the result code is set to success.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_AUTHENTICATE. See IETF RFC 4072 [5].\nResult Code\nResult-Code / Experimental-Result-Code\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]) or as per in NASREQ (see IETF RFC 4005 [58]). The Result-Code DIAMETER_MULTI_ROUND_AUTH shall be used in the responses that trigger further requests from the PDN GW and DIAMETER_SUCCESS shall be included at the successful completion of the authentication and authorization procedure.\nThe Experimental-Result AVP shall be used for S6b errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nIf the Result-Code is set to DIAMETER_SUCCESS_RELOCATE_HA as defined in IETF RFC 5778 [11], then the 3GPP AAA server is indicating to the PGW that it shall initiate a HA switch procedure towards the UE.\nMIP Subscriber Profile\nMIP6-Feature-Vector\nC\nThis AVP shall be present if the authorization was successful. None of the PMIP6_SUPPORTED or MIP4_SUPPORTED flags shall be set, since DSMIPv6 is used in this case.\nPermanent User Identity\nMobile-Node-Identifier\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS.\nThis IE shall contain an AAA/HSS assigned permanent user identity (i.e. an IMSI in root NAI format as defined in clause 19 of 3GPP TS 23.003 [14]). This IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS.\nThis AVP shall contain the default APN, the list of authorized APNs, user profile information.\nAPN-Configuration is a grouped AVP including the following information elements per APN:\n- APN\n- Authorized 3GPP QoS profile\n- Statically allocated User IP Address (IPv4 and/or IPv6)\n- Allowed PDN type (IPv4, IPv6, IPv4v6, IPv4_OR_IPv6)\n- APN-AMBR\nReallocated PGW Address\nMIP6-Agent-Info\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS_RELOCATE_HA indicating to the PDN GW that it shall initiate a HA switch procedure towards the UE.\nThis information element shall contain the PDN GW identity of the target PDN GW.\nSession Time\nSession-Timeout\nC\nIf the authentication and authorization succeeded, then this IE shall contain the time this authorization is valid for.\nQoS resources\nQoS-Resources\nC\nThis AVP shall be included only if the QoS-Capability AVP was received in the authorization request and the authorization succeeded. Then the 3GPP AAA server shall include a static QoS profile in this IE during the UE initial attach if the PDN GW included QoS-Capabilities AVP in the request message and the UE has been provisioned with a static QoS profile. The QoS profile template value in this IE shall be set to 0.\nUE Charging Data\n3GPP-Charging-Characteristics\nO\nIf present, this information element shall contain the type of charging method to be applied to the user (see 3GPP TS 29.061 [31]).\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be sent if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nTrust Relationship Indicator\nAN-Trusted\nC\nThis AVP shall contain the 3GPP AAA Server's decision on handling the non-3GPP access network, i.e. trusted, or untrusted.\nThis AVP shall be present if the 3GPP AAA Server is able to make decision on whether the access network is Trusted or Untrusted.\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated for the user in the HSS and signalling based activation is to be used to download the trace activation from the HSS to the PDN GW.\nOnly the Trace-Data AVP shall be included to the Trace-Info AVP and\nshall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List,for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_9.1.2.1",
        "ts_24.303",
        "ts_23.003",
        "ts_29.229",
        "ts_23.139",
        "ts_29.061",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.1.2",
      "section_id": "9.1.2.1.2",
      "section_title": "PDN GW Detailed Behaviour",
      "content": "After completing the IKE_SA_INIT exchange, upon receipt of an IKE_AUTH message, including the IDi payload but not the AUTH payload, the PDN GW shall send an Diameter-EAP-Request (DER) message towards the 3GPP AAA Server / Proxy. The EAP Payload AVP shall contain an EAP-Response/Identity with the identity extracted from the IDi field.\nUpon receipt of an IKE_AUTH message with an EAP payload from the UE, the PDN GW shall send an Diameter-EAP-Request (DER) with the EAP Payload AVP containing the according EAP-Response to the 3GPP AAA Server / Proxy.\nUpon receipt of a Diameter-EAP-Answer (DEA) message from the 3GPP AAA Server / Proxy, the PDN GW shall then send an IKE_AUTH message containing the according EAP Payload to the UE.\nUpon receipt of an IKE_AUTH message with the AUTH payload after the EAP authentication was successful, the PDN_GW shall proceed as specified in 3GPP TS 24.303 [13].\nIf the handover indication to the PGW is missing, i.e. IPv6 Home Network Prefix assigned to the UE is not included in IKE_AUTH request message as specified in 3GPP TS 24.303 [13], the PGW shall notify 3GPP AAA Server that the UE performs initial attach by setting Initial-Attach-Indicator in the DER-S6b-flags AVP.\nThe PDN GW shall utilize the downloaded APN configuration data, among others, to decide whether the user's request for an IPv4 home address and/or IPv6 home address prefix shall be accepted or rejected.\nIf the Result-Code AVP is set to DIAMETER_SUCCESS_RELOCATE_HA and if the PGW has received a PGW identity in form of the FQDN from the 3GPP AAA server, then the PGW may obtain the IP address of the Home Agent functionality of that PGW as described in 3GPP TS 29.303 [34].\nIf Trace-Info AVP has been received in the authentication and authorization response, the PDN GW shall start a trace session for the user. For details, see 3GPP TS 32.422 [32].\nIf the PDN-GW determines that a previously assigned 3GPP AAA Sever is unavailable, it may attempt to send a new authentication and authorization request to an alternate 3GPP AAA Server. If the PDN-GW receives from this new server a redirect indication towards the former server (due to the HSS having stored the former 3GPP AAA Server identity), it shall terminate all previously existing sessions and PDN connections for that user, and it shall re-send again the request towards the new server, but it shall include the AAA-Failure-Indication AVP in the new request.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_24.303",
        "ts_29.303",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.1.3",
      "section_id": "9.1.2.1.3",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "For S6b, on receipt of the DER message, the 3GPP AAA Server shall process the DER message according to 3GPP TS 33.402 [19].\nUpon successful completion, a DIAMETER_SUCCESS shall be returned to indicate successful authentication procedure and authentication information shall be returned. If the APN requested by the PDN GW is authorized by the wildcard APN, the 3GPP AAA Server shall include the wildcard APN in the Service-Selection AVP of the APN-Configuration AVP. The AAA server shall also include, among others, the MIP6-Feature-Vector AVP, including the subscriber profile of the UE in terms of DSMIPv6 feature the UE is authorized to use.\nIf the HSS indicates that the user is currently being served by a different PDN GW, the 3GPP AAA Server shall respond to to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the new assigned PDN GW identity in the MIP6-Agent-Info AVP.\nIf receiving the UE Care of Address from the PDN GW and Initial-Attach-Indicator set by the PGW in DER-S6b-flags, the 3GPP AAA Server may select a different PDN GW which is closer to the UE than the currently serving PDN GW as specified in 3GPP TS 23.402 [3] based on the received UE Care of Address. In this case, the 3GPP AAA Server shall respond to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the selected PDN GW identity in the MIP6-Agent-Info AVP.\nIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDG-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\nIf the 3GPP AAA Server receives a request message not related to any existing session and is able to recognize that the PDN-GW included the AAA-Failure-Indication AVP in the request, the 3GPP AAA Server shall also include the AAA-Failure-Indication AVP over the SWx interface, while retrieving the access authentication and authorization data from the HSS.\nThe 3GPP AAA Server shall run EAP-AKA as specified in 3GPP TS 33.402 [19]. Exceptions shall be treated as error situations and the result code shall be set to DIAMETER_UNABLE_TO_COMPLY.\nBefore sending out the AKA challenge, the 3GPP AAA Server shall decide whether the access network is handled as Trusted or Untrusted and set the value of the AN-Trusted AVP correspondingly in the answer message to indicate the trust relationship of the access network to the PDN GW. The 3GPP AAA Server shall make the decision based on the UE Identity and the trust relationship information marked during the authentication and authorization procedure over STa, SWa or SWm. If the 3GPP AAA server is unable to determine the trust relationship of the access network, it shall not include the AN-Trusted AVP in the answer message to the PDN GW.\nFor Fixed Broadband access network interworking as specified in 3GPP TS 23.139 [39],\n-\tFor trusted access, the 3GPP AAA server shall determine if the UE is connected via a BBF-defined WLAN access according to the UE local IP address in UE-Local-IP-Address AVP from the PDN GW. If the UE is connected via a BBF-defined WLAN access, the 3GPP AAA server shall perform the enabling UE reflective QoS function as specified in 3GPP TS 24.139 [43].\n-\tFor untrusted access, the UE local IP address is assigned by the ePDG and not by the non-3GPP access network. Hence, in this case the 3GPP AAA Server shall ignore the UE local IP address in UE-Local-IP-Address AVP from the PDN GW.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_33.402",
        "ts_23.402",
        "ts_23.139",
        "ts_24.139"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.1.4",
      "section_id": "9.1.2.1.4",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authentication answer that completes a successful authentication, the 3GPP AAA Proxy shall record the state of the connection (i.e. Authentication Successful).\nIf receiving the UE Care of Address from the PDN GW which is in the VPLMN, the 3GPP AAA Proxy may select a different PDN GW which is closer to the UE than the currently serving PDN GW as specified in 3GPP TS 23.402 [3] based on the received UE Care of Address. In this case, the 3GPP AAA Proxy shall respond to the PDN GW with the Result-Code set to DIAMETER_SUCCESS_RELOCATE_HA and include the selected PDN GW identity in the MIP6-Agent-Info AVP.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.2.1",
      "section_id": "9.1.2.2.1",
      "section_title": "General",
      "content": "The following authorization procedures take place upon a reception of a PBU at the PDN GW from the MAG or upon a reception of a Create Session Request at the PDN GW from the trusted non-3GPP access network or from the ePDG.\nThe PDN GW shall update its identity to the 3GPP AAA Server and HSS. Static QoS profile information may also be downloaded at the same time. If the PDN GW reports to the 3GPP AAA server that GTPv2 is used over the S2a or S2b interface, the 3GPP AAA Server may decide not to download parameters to the PDN GW on the S6b interface which are already provided to the PGW via the trusted non-3GPP access network through the STa and GTPv2 based S2a interfaces or via the ePDG through the SWm and the GTPv2 based S2b interfaces (e.g, static QoS profile, Trace Information, APN-AMBR).\nThe procedures are based on the reuse of NASREQ IETF RFC 4005 [4] AAR and AAA commands and the Diameter extensions defined for PMIP in IETF RFC 5779 [2].\nTable 9.1.2.2.1/1: Authorization request\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall defines whether the UE is to be authenticated only, authorized only or both. AUTHORIZE_ONLY shall be used in this case.\nPDN GW Identity\nMIP6-Agent-Info\nC\nIf present, this IE shall contain the identity of the selected PDN GW for the UE and the corresponding PDN connection. It shall be present on the first authorization request sent by the PGW to the 3GPP AAA Server for a given APN. Also, it shall be present to communicate to the 3GPP AAA Server the identity of the PDN GW used for the establishment of emergency PDN connections.\nPGW PLMN ID\nVisited-Network-Identifier\nC\nThis IE shall contain the identifier that allows the home network to identify the PLMN where the PGW is located. It shall be present when the PGW Identity is present and does not contain an FQDN.\nMobility features\nMIP6-Feature-Vector\nM\nThis IE shall contain the mobility features used by the PDN GW. The PDN GW shall set the PMIP6_SUPPORTED flag or the GTPv2_SUPPORTED flag according to the protocol variant used over the S2a or the S2b interface.\nAPN\nService-Selection\nM\nThis IE shall contain the Network Identifier part of the APN extracted from the PBU or the Create Session Request message.\nFor emergency PDN connection establishment (i.e., when Emergency-Services AVP is present, with the Emergency-Indication bit set), this IE may be ignored by the 3GPP AAA Server.\nQoS capabilities\nQoS-Capability\nO\nIf included in the request message, this IE shall indicate to the 3GPP AAA server that the PDN GW requests downloading a static QoS profile for the UE. The PDN GW may include this IE only at the initial attach of the UE. The PDN GW should not include this IE if GTPv2 is used over the S2a or the S2b interface. The PDN GW shall not include this IE if the Emergency-Indication bit of the Emergency-Services AVP is set in the message.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nOrigination Time Stamp\nOrigination-Time-Stamp\nC\nThe PGW shall include this IE if it received the Origination Time Stamp from the MME/SGSN or TWAN/ePDG and if the PGW supports the procedure specified in clause 13.2 of 3GPP TS 29.274 [38].\nIf included in the request message, this IE shall contain the Origination Time Stamp value provided to the PGW in the Create Session Request or PBU message. This indicates the time at which the originating entity initiated the request.\nMaximum Wait Time\nMaximum-Wait-Time\nC\nThe PGW shall include this IE if it received the Maximum Wait Time from the MME/SGSN or TWAN/ePDG, and the PGW supports the procedure specified in clause 13.3 of 3GPP TS 29.274 [38], and the 3GPP AAA Server pertains to the same PLMN as the PGW or if the 3GPP AAA Server pertains to a different PLMN and operator policy in the PGW allows to use this procedure towards this PLMN.\nIf included in the request message, this IE shall contain the Maximum Wait Time provided to the PGW in the Create Session Request or PBU message.This indicates the duration during which the originator of the request waits for a response.\nEmergency Services\nEmergency-Services\nC\nThe PGW shall include this information element, with the Emergency-Indication bit set, during the establishment of an emergency PDN connection.\nTable 9.1.2.2.1/2: Authorization answer\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nResult code\nResult-Code\nM\nThis IE shall contain the result of the operation. The possible values of the Result-Code AVP are defined in IETF RFC 6733 [58]. This IE shall be set to DIAMETER_SUCCESS if the update of the PDN GW identity succeeded. It shall be set to DIAMETER_AUTHORIZATION_REJECTED if the update of the PDN GW identity failed.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_ONLY. See IETF RFC 4072 [5].\nAuthorized mobility features\nMIP6-Feature-Vector\nC\nThe 3GPP AAA Server shall insert this AVP if the authorization was successful. The PMIP6_SUPPORTED or the GTPv2_SUPPORTED flag shall be set according to the value received in the Authorization request.\nSession time\nSession-Timeout\nC\nIf the authorization succeeded, then this IE shall contain the time this authorization is valid for.\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS.\nThis AVP shall contain the user profile information.\nAPN-Configuration is a grouped AVP and shall include the following information elements:\n- APN\n- Authorized 3GPP QoS profile\n- APN-AMBR\nThis information element need not be included in the Authorization answer, if the MIP6-Feature-Vector in the Authorization request indicates that GTPv2 is used over S2a or S2b.\nThis information element shall not be included in the Authorization Answer if the Emergency-Indication bit of the Emergency-Services AVP is set in the Authorization Request.\nQoS resources\nQoS-Resources\nC\nThis AVP shall be included only if the QoS-Capability AVP was received in the authorization request and the authorization succeeded. Then the 3GPP AAA server shall include a static QoS profile in this IE during the UE initial attach if the PDN GW included a QoS-Capabilities AVP in the request message and the UE has been provisioned with a static QoS profile. The QoS profile template value in this IE shall be set to 0.\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be sent if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the MIP6-Feature-Vector in the Authorization request indicates that PMIPv6 is used over S2a or S2b and if the subscriber and equipment trace has been activated or deactivated for the user in the HSS GW and signalling based activation is used to download the trace (de)activation from the HSS to the PDN GW.\nIn an authorization response sent during the authorization procedure at PDN connection setup, the Trace-Data AVP shall be included.\nIn an authorization response sent during the service authorization information update procedure,\n- the Trace-data AVP shall be included if trace activation is requested\n- the Trace-Reference AVP shall be included, if trace deactivation is requested.\nIf the Trace-Data AVP is included, it shall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List,for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "ts_29.274_clause_13.2",
        "ts_29.274_clause_13.3",
        "table_9.1.2.2.1",
        "ts_23.003",
        "ts_29.229",
        "ts_29.274",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.2.2",
      "section_id": "9.1.2.2.2",
      "section_title": "PDN GW Detailed Behaviour",
      "content": "Upon receipt of a PBU message from the MAG or upon receipt of a Create Session Request from the trusted non-3GPP access network or the ePDG which requires the establishment of a new PDN connection via the non-3GPP access, the PDN GW shall initiate an authorization procedure, by sending an Authorization Request message to the 3GPP AAA server or to the 3GPP AAA Proxy, with the Auth-Request-Type set to AUTHORIZE_ONLY, in order to update the PGW Address for the APN and the selected S2a or S2b protocol variant, as well as to optionally download any UE specific APN profile information such as IP address allocation information, QoS Information, Session timeouts, Session Idle timeouts etc.\nThe Create Session Request received from the trusted non-3GPP access network or the ePDG may include the identities of the 3GPP AAA server assigned to the UE i.e. the Origin-Host and Origin-Realm of the 3GPP AAA server included in the DEA message received by the ePDG/TWAN over SWm or STa interface. If supported, the PDN GW shall use these identities to address the Authorization Request message to the selected 3GPP AAA server.\nThe PDN GW shall include in the request the APN where the user shall be connected to. The PGW shall additionally include the Emergency-Services AVP, with the Emergency-Indication bit set, during the establishment of an emergency PDN connection.\nThe PDN GW Identity and PLMN shall only be included in the initial request to the 3GPP AAA server; subsequent authorization messages (due to a handover to a different MAG, for instance) shall not include it again.\nAfter reception of the Authorization Response message, the PDN GW shall check that the Result-Code is set to DIAMETER_SUCCESS and, if so, it shall proceed to connect the user to the specified APN.\nFor PMIPv6 based S2a or S2b, if Trace-Info AVP including Trace-Data has been received in the authorization response, the PDN GW shall start a trace session for the user. If Trace-Info including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the PDN GW shall stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor GTPv2 based S2a or S2b, the PDN GW shall ignore the Trace-Info AVP if received in the authorization response.\nNOTE:\tFor GTPv2 based S2a or S2b, trace is activated and deactivated via the STa and S2a interfaces or via the SWm and S2b interfaces.",
      "chunk_type": "general",
      "cross_references": [
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.2.3",
      "section_id": "9.1.2.2.3",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "Upon receipt of the Authorization Request message from the PDN GW, the 3GPP AAA Server shall check whether the user's profile is available.\nIf the user's data exist in the 3GPP AAA Server, it shall check, whether it also has an active access authorization session for the user.\n-\tIf not, the 3GPP AAA Server shall reject the authorization request, including the Result-Code DIAMETER_AUTHORIZATION_REJECTED.\n-\tIf the 3GPP AAA Server has an existing authorization session,\n-\tIf the APN requested by the PDN GW is included in the list of authorized APNs of the user or if the Emergency-Indication bit of the Emergency-Services AVP is set in the Authorization Request, then the 3GPP AAA Server shall:\n-\tset the Result-Code to DIAMETER_SUCCESS;\n-\tinclude the APN-Configuration AVP in the authorization answer if PMIP is used over S2a or S2b; the APN-Configuration AVP may also be included if GTPv2 is used over S2a or S2b. When the APN-Configuration AVP is included in the authorization answer, the Service-Selection AVP within the APN-Configuration AVP shall contain the wildcard APN if the APN requested by the PDN GW is authorized by the wildcard APN;\n-\tupdate the PDN GW information for the APN for the UE on the HSS as specified in clause 8.1.2.2.2, if the Emergency-Indication bit of the Emergency-Services AVP is not set in the Authorization Request; and\n-\tupdate on the HSS the PDN GW Identity used for the establishment of emergency PDN connections for the UE, as specified in clause 8.1.2.2.2, based on operator policy (e.g. on whether the operator uses a static PDN GW or not for emergency services), if the Emergency-Services AVP is present, with the Emergency-Indication bit set, in the Authorization Request and the user is non-roaming and authenticated.\n-\tIf the APN requested by the PDN GW is not included in the list of authorized APNs and the Emergency-Indication AVP is not present in the Authorization Request, then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\nIf the user's profile does not exist in the 3GPP AAA Server, it shall retrieve the Diameter identity of the 3GPP AAA Server currently serving the user from the HSS following the procedures for subscriber profile download as specified in clause 8.1.2.2.2. Depending on the HSS response,\n-\tIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDN-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tIf the HSS returns DIAMETER_ERROR_USER_UNKNOWN, the 3GPP AAA Server shall return the same error to the PDN GW.\n-\tIf the HSS sends the user's profile to the 3GPP AAA Server, the authorization shall be rejected by setting the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. The 3GPP AAA Server shall delete the downloaded user profile.\nNOTE 1:\tThe last outcome corresponds to the case that the user has no active access authorization procedure. This is considered as an error situation, e.g. the Trusted Non-3GPP access network may have sent PBU without authorizing the user.\nNOTE 2:\tAfter the 3GPP AAA Server has accepted a new S6b session from a particular PGW, the 3GPP AAA server can consider that any existing S6b session(s) for the same UE – APN combination supported via a different PGW (i.e. with a different Origin-Host AVP) is obsolete and can send ASR command(s) to initiate the termination of the hanging session(s) in that PGW.\nIf the 3GPP AAA Server supports the detection and handling of late arriving requests as specified in clause 13.2 of 3GPP TS 29.274 [38], upon receipt of an Authorization Request which collides with an existing session context, for the same UE and APN but a different PGW (i.e. different Origin-Host AVP), the 3GPP AAA Server shall accept the new Authorization Request only if it contains a more recent Origination Time Stamp than the Origination Time Stamp stored for the existing S6b session. An incoming Authorization Request shall be considered as more recent than an existing session and be accepted if no Origination Time Stamp information was provided for at least one of the two sessions. The 3GPP AAA Server shall reject an incoming Authorization Request whose Origination Time Stamp is less recent than the Origination Time Stamp of the existing session by setting the Experimental-Result-Code to DIAMETER_ERROR_LATE_OVERLAPPING_REQUEST.\nIf the 3GPP AAA Server supports the detection and handling of late arriving requests as specified in clause 13.3 of 3GPP TS 29.274 [38], upon receipt of an Authorization Request which contains the Origination Time Stamp and the Maximum Wait Time parameters, the 3GPP AAA Server should check that the request has not already timed out at the originating entity. The 3GPP AAA Server may perform additional similar checks before sending the answer, e.g. upon receipt of a response from the HSS. The 3GPP-AAA Server should reject an Authorization Request that is known to have timed out by setting the Experimental-Result-Code to DIAMETER_ERROR_TIMED_OUT_REQUEST.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2.2.2",
        "ts_29.274_clause_13.2",
        "ts_29.274_clause_13.3",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.2.4",
      "section_id": "9.1.2.2.4",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.3.1",
      "section_id": "9.1.2.3.1",
      "section_title": "General",
      "content": "The S6b reference point allows the PDN GW to inform the 3GPP AAA server that the UE disconnected a PDN connection associated to an APN, or that the PDN connection was handed over to the 3GPP access, and therefore the mobility session established for this PDN connection is to be removed.\nThe procedure shall be initiated by the PDN GW. These procedures are based on the reuse of Diameter STR and STA commands as specified in IETF RFC 6733 [58].\nEach PDN connection shall be identified by the Diameter Session-Id parameter.\nTable 9.1.2.3.1/1: S6b Session Termination Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nTermination Cause\nTermination-Cause\nM\nThis IE shall contain the reason for the disconnection, according to the values and reasons described in IETF RFC 6733 [58]. In particular:\n- If the session is terminated as a result of a PDN disconnection initiated by the UE, the Termination-Cause shall be set to the value DIAMETER_LOGOUT (1)\n- If the session is terminated as a result of a PDN handover towards 3GPP access, the Termination-Cause shall be set to the value DIAMETER_USER_MOVED (7)\nTable 9.1.2.3.1/2: S6b Session Termination Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for S6b errors.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_9.1.2.3.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.3.2",
      "section_id": "9.1.2.3.2",
      "section_title": "PDN GW Detailed Behaviour",
      "content": "The PDN GW shall make use of this procedure when the PDN Connection associated to the diameter session is, either disconnected, or handed over to the 3GPP access.\nUpon receipt of the Session Termination Answer message from the 3GPP AAA Server or from the 3GPP AAA Proxy, the PDN GW shall check the Result Code AVP, and in case of a DIAMETER_SUCCESS code, it shall release the context associated to the active session identified by the Session-Id parameter used in the initial authorization exchange.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.3.3",
      "section_id": "9.1.2.3.3",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "Upon receipt of the Session Termination Request message from the PDN GW or from the 3GPP AAA Proxy, the 3GPP AAA Server shall check that there is an ongoing session associated to any of the parameters received in the message (Session-Id and User Name).\nIf an active session is found, the 3GPP AAA Server shall release the session context associated to the specified session, and a Session Termination Answer message shall be sent to the PDN GW or 3GPP AAA Proxy, indicating DIAMETER_SUCCESS.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then a Session Termination Answer message shall be sent to the PDN GW or 3GPP AAA Proxy, indicating DIAMETER_UNKNOWN_SESSION_ID.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.3.4",
      "section_id": "9.1.2.3.4",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Session Termination Request message from the PDN GW, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server.\nOn receipt of the Session Termination Answer message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the PDN GW, and it shall release any local resources associated to the specified sessions only if the result code is set to DIAMETER_SUCCESS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.4.1",
      "section_id": "9.1.2.4.1",
      "section_title": "General",
      "content": "The S6b reference point allows the 3GPP AAA server to order a PDN GW to remove a PDN connection previously activated by the UE.\nThis procedure shall be initiated by the 3GPP AAA server. This indicates to the PDN GW to remove the corresponding PDN connection (identified by Session-ID AVP and User-Name AVP). This procedure is based on the reuse of NASREQ IETF RFC 4005 [4] ASR, ASA, STR and STA commands.\nThe 3GPP AAA Server shall include the Auth-Session-State AVP in the ASR command with a value of NO_STATE_MAINTAINED if it does not require a STR from the PDN GW. If it does require a STR from the PDN GW, the 3GPP AAA Server shall either omit the Auth-Session-State AVP from the ASR command or include the Auth-Session-State AVP in the ASR command with a value of STATE_MAINTAINED.\nTable 9.1.2.4.1/1: S6b Abort Session Request\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuth-Session-State\nAuth-Session-State\nO\nIf present, this information element shall indicate to the PDN GW whether the 3GPP AAA Server requires an STR message.\nTable 9.1.2.4.1/2: S6b Abort Session Answer\nInformation Element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for S6b errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nTable 9.1.2.4.1/3: S6b Session Termination Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nTermination-Cause\nTermination-Cause\nM\nThis information element shall contain the reason why the session was terminated. It shall be set to \"DIAMETER_ADMINISTRATIVE\" to indicate that the session was terminated in response to an ASR message.\nTable 9.1.2.4.1/4: S6b Session Termination Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult-Code\nResult-Code\nM\nThis IE shall indicate the result of the operation.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_9.1.2.4.1",
        "ts_23.003"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.4.2",
      "section_id": "9.1.2.4.2",
      "section_title": "PDN GW Detailed Behaviour",
      "content": "Upon receipt of the Abort Session Request message from the 3GPP AAA Server or from the 3GPP AAA Proxy, the PDN GW shall check that there is an ongoing session with the received session-ID.\nIf an active session is found:\n-\tIn the PMIPv6 or GTPv2 or MIPv4 cases, the PDN GW shall release any resources associated with the identified diameter session, but it shall not terminate any associated PDN connection.\n-\tIn the DSMIPv6 case, the PDN GW shall initiate a termination procedure for the associated PDN connection, and shall release any resources associated with the identified diameter session.\nIf the termination procedure is successful for the identified session, an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_SUCCESS.\nIf the Session-Id included in the request does not correspond with any active session, or if an active session is found but it does not belong to the user identified by the User Name parameter, then an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_UNKNOWN_SESSION_ID.\nIf the termination procedure for the identified session cannot be completed successfully, an Abort Session Answer message shall be sent to the 3GPP AAA Server or 3GPP AAA Proxy, indicating DIAMETER_UNABLE_TO_COMPLY.\nIf the termination procedure was successful for the identified session and the STR is required by the 3GPP AAA Server, the PDN GW shall send an STR to the 3GPP AAA Server with the Termination-Cause set to DIAMETER_ADMINISTRATIVE.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.4.3",
      "section_id": "9.1.2.4.3",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall intiate a separate procedure for each active PDN connection of the user, even if the user has several PDN connections via the same PDN GW.\nUpon receipt of the Abort Session Answer message from the PDN GW or from the 3GPP AAA Proxy, the 3GPP AAA Server shall check the Result Code AVP, and in case of a DIAMETER_SUCCESS code, it shall release the context associated to the active session identified by the Session-Id parameter.\nIf the error code DIAMETER_UNABLE_TO_COMPLY is received in the Result Code AVP, the 3GPP AAA Server shall not release the context for the identified session.\nIf the error code DIAMETER_UNKNOWN_SESSION_ID is received in the Result Code AVP, the 3GPP AAA Server shall release the context for the identified session.\nOn receipt of the STR from PDN GW, the 3GPP AAA Server shall return an STA command with the Result-Code set to DIAMETER_SUCCESS.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.4.4",
      "section_id": "9.1.2.4.4",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the Abort Session Request message from the 3GPP AAA Server, the 3GPP AAA Proxy shall route the message to the PDN GW.\nIf the 3GPP AAA Proxy requires an STR but the 3GPP AAA Server does not, the 3GPP AAA Proxy may override the value of the Auth-Session-State in the ASR and set it to STATE_MAINTAINED. In this case, the 3GPP AAA Proxy shall not forward the STR received from the PDN GW onto the 3GPP AAA Server and shall return an STA command to the PDN GW with the Result-Code set to DIAMETER_SUCCESS. The 3GPP AAA Proxy shall not override the value of the Auth-Session-State AVP under any other circumstances.\nOn receipt of the Abort Session Answer message from the PDN GW, the 3GPP AAA Proxy shall route the message to the 3GPP AAA Server, and it shall release any local resources associated to the specified session only if the result code is set to DIAMETER_SUCCESS.\nWhen the 3GPP AAA Proxy receives the STR from PDN GW, it shall route the request to the 3GPP AAA Server. On receipt of the STA message, the 3GPP AAA Proxy shall route the response to the PDN GW.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.5.1",
      "section_id": "9.1.2.5.1",
      "section_title": "General",
      "content": "The S6b reference point allows the 3GPP AAA server to modify the authorization information previously provided to the PDN GW, i.e. during Service Authentication and Authorization when using DSMIPv6, or Service Authorization using PMIPv6 or GTPv2 or MIPv4, or the service authorization information provided during a previous Service Authorization update. This procedure is triggered by the modification of the non-3GPP profile of the UE or by activating or deactivating subscriber and equipment trace in the HSS or by the request of a P-CSCF restoration for WLAN. This procedure is also triggered by the authentication and authorization via STa or SWm, when the 3GPP AAA Server detects that an S6b session already exists for the UE, as specified in clause 5.1.2.1.2 and 7.1.2.1.2. In this case, the 3GPP AAA Server shall use this procedure to send the trust relationship to the PDN GW.\nThe Service Authorization Information Update procedure is performed in two steps:\n1.\tThe 3GPP AAA server issues an unsolicited re-authentication and/or re-authorization request towards the PDN GW. Upon receipt of this request, the PDN GW responds to the request and indicates the disposition of the request. If the re-authorization request is used for the purpose of the P-CSCF restoration for WLAN, only the P-CSCF Restoration Request bit shall be set in the RAR Flags. This procedure is based on the reuse of Diameter RAR and RAA commands as specified in IETF RFC 6733 [58]. The information element content for these messages is shown in tables 9.1.2.5.1/1 and 9.1.2.5.1/2.\n2.\tAfter receiving the re-authorization request, the PDN GW invokes the authorization procedure for the APN identified by the session ID included in the former re-authorization request message. The authorization procedure for PMIPv6 or GTPv2 is described in the clause 9.1.2.2. Tables 9.1.2.5.1/3 and 9.1.2.5.1/4 describe the message contents in case of DSMIPv6.\nTable 9.1.2.5.1/1: S6b Re-authorization request\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nRequest Type\nRe-Auth-Request-Type\nM\nThis shall define whether re-authentication or re-authorization is required. AUTHORIZE_ONLY shall be used in this case.\nRAR Flags\nRAR-Flags\nC\nThis Information Element contains a bit mask. See 9.2.3.1.5 for the meaning of the bits.\nTable 9.1.2.5.1/2: S6b Re-authorization response\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for S6b errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nTable 9.1.2.5.1/3: Authorization Request when using DSMIPv6\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nUser identity\nUser-Name\nM\nThis information element shall contain the permanent identity of the user. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE defines whether the UE is to be authenticated only, authorized only or both. AUTHORIZE_ONLY shall be used in this case.\nPGW PLMN ID\nVisited-Network-Identifier\nC\nThis IE shall contain the identifier that allows the home network to identify the PLMN where the PGW is located. It shall be present when the PGW Identity does not contain an FQDN.\nAccess Type\nRAT-Type\nM\nThis IE shall contain the non-3GPP access network technology type that is serving the UE.\nPDN GW Identity\nMIP6 -Agent-Info\nM\nThis IE shall contain the FQDN and/or IP address(es) of the PDN GW that the user is connected to.\nAPN\nService-Selection\nO\nThis IE shall contain the Network Identifier part of the APN extracted from the IKE_AUTH message.\nIt shall include the APN that the user shall be connected to. It shall be only included if received from UE. In case it is not received, the 3GPP AAA server shall assign the received PDN-GW identity to the default APN.\nQoS capabilities\nQoS-Capability\nC\nIf included in the request message, this IE shall indicate to the 3GPP AAA server that the PGW is capable of downloading a static QoS profile for the UE. The PGW shall include this IE only during UE the initial attach.\nTable 9.1.2.5.1/4: Authorization Answer when using DSMIPv6\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nResult Code\nResult-Code / Experimental-Result-Code\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used for errors defined in the Diameter base protocol (see IETF RFC 6733 [58]) or as per in NASREQ (see IETF RFC 4005 [4]). 1xxx should be used for multi-round, 2xxx for success.\nThe Experimental-Result AVP shall be used for S6b errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_ONLY. See IETF RFC 4072 [5].\nAPN and PGW Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS.\nThis AVP shall contain the default APN, the list of authorized APNs, and user profile information.\nThe APN-Configuration is a grouped AVP and shall include the following information elements per APN:\n- APN\n- Authorized 3GPP QoS profile\n- Statically allocated User IP Address (IPv4 and/or IPv6)\n- VPLMN Dynamic Address Allowed.\nThis information element might not be present if the authorization procedure is triggered by the 3GPP AAA Server to send the trust relationship to the PDN GW.\nSession Time\nSession-Timeout\nC\nIf the authentication and authorization succeeded, then this IE shall contain the time this authorization is valid for.\nThis information element might not be present if the authorization procedure is triggered by the 3GPP AAA Server to send the trust relationship to the PDN GW.\nQoS resources\nQoS-Resources\nC\nIf the authentication and authorization succeeded, then the 3GPP AAA server shall include a static QoS profile in this IE during the UE initial attach if the PGW included QoS-Capabilities AVP in the request message and the UE has been provisioned with a static QoS profile. The QoS profile template value in this IE shall be set to 0.\nThis IE shall contain the QoS Profile authorized by the 3GPP AAA server for the requested APN based on the subscribed QoS parameters.\nThis information element might not be present if the authorization procedure is triggered by the 3GPP AAA Server to send the trust relationship to the PDN GW.\nTrace information\nTrace-Info\nC\nThis AVP shall be included if the subscriber and equipment trace has been activated or deactivated for the user in the HSS and signaling based activation is used to download the trace (de)activation from the HSS to the PDN GW.\nTrace-data AVP shall be included (directly under the Trace-Info) if trace activation is requested\nTrace-Reference AVP shall be included, if trace deactivation is requested.\nIf the Trace-Data AVP is included, it shall contain the following AVPs:\n- Trace-Reference\n- Trace-Depth\n- Trace-Event-List, for PGW\n- Trace-Collection-Entity\nThe following AVPs may also be included in the Trace-Data AVP:\n- Trace-Interface-List,for PGW, if this AVP is not present, trace report generation is requested for all interfaces for PGW listed in 3GPP TS 32.422 [32]\n- Trace-NE-Type-List, with the only allowed value being \"PDN GW\". If this AVP is not included, trace activation in PDN GW is required\nTrace-Reporting-Consumer-Uri shall be included for Streaming based Reporting as defined in 3GPP TS 32.422 [32]. If the receiving node supports Streaming based Reporting and Trace-Reporting-Consumer-Uri AVP is present, the Trace-Collection-Entity AVP shall be ignored.\nTrust Relationship Indicator\nAN-Trusted\nC\nThis AVP shall contain the 3GPP AAA Server's decision on handling the non-3GPP access network, i.e. trusted, or untrusted.\nThis AVP shall be sent if this re-authorization procedure is triggered by the authentication and authorization via STa or SWm, when the 3GPP AAA Server detects that an S6b session already exists for the UE and the S6b session was established as a result of an authentication request for DSMIPv6.",
      "chunk_type": "definition",
      "cross_references": [
        "clause_5.1.2.1.2",
        "clause_9.1.2.2",
        "ts_23.003_clause_19",
        "table_9.1.2.5.1",
        "ts_23.003",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.5.2",
      "section_id": "9.1.2.5.2",
      "section_title": "Detailed Behaviour",
      "content": "The 3GPP AAA server shall make use of this procedure in two steps to indicate and update relevant service authorization information in the PDN GW.\nThe 3GPP AAA server shall send a re-authorization request for all authorization sessions that are active for the user except for the request of a P-CSCF restoration for WLAN which only applies to the session related to the IMS APN.\nEach PDN GW, upon reception of an unsolicited re-authentication and/or re-authorization request shall perform the following check and if there is an error detected, the PDN GW shall stop processing and return the corresponding error code.\nCheck the Re-Auth-Request-Type AVP:\n1.\tIf it indicates AUTHENTICATE_ONLY, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\n2.\tIf it indicates AUTHORIZE_ONLY, then, depending on the used IP mobility protocol:\n-\tIn case of PMIPv6 or GTPv2, the PDN GW shall perform an authorization procedure as described in clause 9.1.2.2. If the P-CSCF Restoration Request bit in the RAR Flags is set:\n-\tfor the case where the PDN GW triggers the extended P-CSCF restoration mechanism, the PDN GW may send the authorisation request with only mandatory AVPs.\n-\tfor the case where the PDN GW triggers the basic P-CSCF restoration mechanism, the PDN GW shall send a Session Termination Request to the 3GPP AAA Server.\n-\tIn case of DSMIPv6, the PDN GW shall perform an authorization procedure, sending an authorization request described in Tables 9.1.5.1/3 and 9.1.5.1/4. If the Trust-Relationship-Update flag is set in the RAR Flags present in the request, the PDN GW may send an authorization request with only mandatory AVPs.\n3.\tIf it indicates AUTHORIZE_AUTHENTICATE, Result-Code shall be set to DIAMETER_INVALID_AVP_VALUE.\nWhen receiving the authorization request, if the authorization procedure is triggered by the 3GPP AAA Server to send the trust relationship to the PDN GW, the 3GPP AAA Server shall send the trust relationship of the access network for the subscriber to the PDN GW with Result-Code DIAMETER_SUCCESS. If the received AA-Request is triggered by the P-CSCF Restoration Request bit set in the RAR Flags sent to the PDN GW, the 3GPP AAA Server may send an authorization answer to the PDN GW with Result-Code DIAMETER_SUCCESS with only the mandatory AVPs described in Table 9.1.2.2.1/2. Otherwise, the 3GPP AAA Server shall check, whether\n-\tthe subscriber still has non-3GPP subscription to access EPC network\n-\tthe non-3GPP APNs are enabled for the user, and\n-\tthe updated user profile contains the APN, for which the given authorization session was created.\nIf any of the checked conditions are not met, the 3GPP AAA Server shall set the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. Otherwise, it shall respond with Result-Code DIAMETER_SUCCESS.\nAfter successful service authorization information update procedure, the PDN GW shall overwrite the stored user and APN data, for the subscriber identity indicated in the request, with the information received from the 3GPP AAA server. A session termination shall be initiated if the subscriber is no longer authorized to use the activated APN. If only trust relationship of the access network is received, the PDN GW shall keep all stored user and APN data for the subscriber identity as indicated in the request.\nIf the P-CSCF-Restoration-Request bit in the RAR Flags is set, the PDN GW shall keep all stored user data and APN data for the subscriber identity indicated in the request unless this data is present in the authorisation answer and proceed with the P-CSCF restoration for WLAN as specified in 3GPP TS 23.380 [52].\nFor PMIPv6 based S2a or S2b, if Trace-Info AVP including Trace-Data has been received in the authorization response, the PDN GW shall start a trace session for the user. If Trace-Info including Trace-Reference (directly under the Trace-Info) has been received in the authorization response, the PDN GW shall stop the ongoing trace session, identified by the Trace-Reference. For details, see 3GPP TS 32.422 [32].\nFor GTPv2 based S2a or S2b, the PDN GW shall ignore the Trace-Info AVP if received in the authorization response.\nNOTE:\tFor GTPv2 based S2a or S2b, trace is activated and deactivated via the STa and S2a interfaces or via the SWm and S2b interfaces.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_9.1.2.2",
        "table_9.1.2.2.1",
        "ts_23.380",
        "ts_32.422"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.6.1",
      "section_id": "9.1.2.6.1",
      "section_title": "General",
      "content": "The following authorization procedures take place upon a reception of a RRQ at the PDN GW from the FA.\nThe PDN GW shall update its identity to the 3GPP AAA Server and HSS. Static QoS profile information may also be downloaded at the same time.\nMIPv4 security parameters shall be exchanged between the PDN GW and the 3GPP AAA Server.\nThe procedures are based on the reuse of NASREQ IETF RFC 4005 [4] AAR and AAA commands.\nTable 9.1.2.6.1/1: Authorization request\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nPermanent User Identity\nUser-Name\nM\nThis IE shall contain the permanent user identity. The identity shall be represented in NAI form as specified in IETF RFC 4282 [15] and shall be formatted as defined in clause 19 of 3GPP TS 23.003 [14]; this IE shall not include the leading digit prepended in front of the IMSI used to differentiate between authentication schemes.\nAuthentication Request Type\nAuth-Request-Type\nM\nThis IE shall define whether the UE is to be authenticated only, authorized only or both. AUTHORIZE_ONLY shall be used in this case.\nPDN GW Identity\nMIP6-Agent-Info\nO\nThis IE shall contain the address and possibly the FQDN of the selected PDN GW for the UE and the corresponding PDN connection\nPGW PLMN ID\nVisited-Network-Identifier\nC\nThis IE shall contain the identifier that allows the home network to identify the PLMN where the PGW is located. It shall be present when the PGW Identity is present and does not contain an FQDN.\nMobility features\nMIP6-Feature-Vector\nM\nThis IE shall contain the mobility features used by the PDN GW. The MIP4_SUPPORTED flag shall be set\nAPN\nService-Selection\nC\nIf present this IE shall contain the Network Identifier part of the APN extracted from the RRQ message. In case it is not received, the 3GPP AAA Server shall assign the received PDN-GW identity to the default APN.\nQoS capabilities\nQoS-Capability\nO\nIf included in the request message, this IE shall indicate to the 3GPP AAA Server that the PDN GW requests downloading of a static QoS profile for the UE. The PDN GW may include this IE only at the initial attach of the UE.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nMN-HA security parameter index\nMIP-MN-HA-SPI\nC\nThis IE shall contain the MN-HA security parameter index which is used in identifying MN-HA shared key as defined by 3GPP TS 33.402 [19]. It shall be included when the PDN-GW does not have the MN-HA shared key required to verify the MIPv4 RRQ message.\nTable 9.1.2.6.1/2: Authorization answer\nInformation Element Name\nMapping to Diameter AVP\nCat.\nDescription\nResult code\nResult-Code\nM\nThis IE shall contain the result of the operation. The possible values of the Result-Code AVP are defined in IETF RFC 6733 [58]. This IE shall be set to DIAMETER_SUCCESS if the authorization of a MAG or the update of the PDN GW identity succeeded. It shall be set to DIAMETER_AUTHORIZATION_REJECTED if the authorization of a new MAG or the update of the PDN GW identity failed.\nAuthentication Request Type\nAuth-Request-Type\nM\nIt shall contain the value AUTHORIZE_ONLY. See IETF RFC 4072 [5].\nAuthorized mobility features\nMIP6-Feature-Vector\nC\nThe 3GPP AAA Server shall insert this AVP if the authorization was successful. The MIP4_SUPPORTED flag shall be set.\nSession time\nSession-Timeout\nC\nIf the authorization succeeded, then this IE shall contain the time this authorization is valid for.\nQoS resources\nQoS-Resources\nC\nThis AVP shall be included only if the QoS-Capability AVP was received in the authorization request and the authorization succeeded. Then the 3GPP AAA Server shall include a static QoS profile in this IE during the UE initial attach if the PDN GW included QoS-Capabilities AVP in the request message and the UE has been provisioned with a static QoS profile. The QoS profile template value in this IE shall be set to 0.\n3GPP AAA Server URI\nRedirect-Host\nC\nThis information element shall be sent if the Result-Code value is set to DIAMETER_REDIRECT_INDICATION. When the user has previously been authenticated by another 3GPP AAA Server, it shall contain the Diameter URI of the 3GPP AAA Server currently serving the user. The node receiving this IE shall behave as defined in the Diameter base protocol (see IETF RFC 6733 [58]). The command shall contain zero or more occurrences of this information element. When choosing a destination for the redirected message from multiple Redirect-Host AVPs, the receiver shall send the Diameter request to the first 3GPP AAA Server in the ordered list received in the Diameter response. If no successful response to the Diameter request is received, the receiver shall send the Diameter request to the next 3GPP AAA Server in the ordered list. This procedure shall be repeated until a successful response is received from a 3GPP AAA Server.\nSupported Features\n(See 3GPP TS 29.229 [24])\nSupported-Features\nO\nIf present, this information element shall contain the list of features supported by the origin host for the lifetime of the Diameter session.\nMN-HA shared key\nMIP-Session-Key\nC\nThis information element contains the MN-HA shared key as defined by 3GPP TS 33.402 [19], it shall be included if the Result-Code value is set to DIAMETER_SUCCESS and the MIP-MN-HA-SPI was sent in the authorization request..\nAPN Data\nAPN-Configuration\nC\nThis information element shall only be sent if the Result-Code AVP is set to DIAMETER_SUCCESS.\nThis AVP shall contain the user profile information.\nAPN-Configuration is a grouped AVP and shall include the following information elements:\n- APN\n- Authorized 3GPP QoS profile\n- APN-AMBR",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.003_clause_19",
        "table_9.1.2.6.1",
        "ts_23.003",
        "ts_29.229",
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.6.2",
      "section_id": "9.1.2.6.2",
      "section_title": "PDN GW Detailed Behaviour",
      "content": "Upon receipt of a RRQ message from the FA, the PDN GW shall initiate an authorization procedure, by sending an Authorization Request message to the 3GPP AAA Server or to the 3GPP AAA Proxy, with the Auth-Request-Type set to AUTHORIZE_ONLY, in order to update the PGW Address for the APN, as well as to download any UE specific APN profile information such as IP address allocation information, QoS Information, Session timeouts, Session Idle timeouts, MIPv4 security parameters etc.\nIf the APN was included in the RRQ message, the PDN GW shall include in the request the APN where the user shall be connected.\nThe PDN GW Identity shall only be included in the initial request to the 3GPP AAA Server; subsequent authorization messages (due to a handover to a different FA, for instance) shall not include it again.\nIf the PDN GW does not have a MN-HA shared key associated with the SPI received in the RRQ MN-HA-AE, the PDN GW shall include the SPI in the Authorization Request to the 3GPP AAA Server.\nAfter successful reception of the Authorization Request message, the PDN GW shall check that the Result-Code is set to DIAMETER_SUCCESS and, if so, it shall use the MN-HA key to verify the MN-HA AE of the RRQ received from the FA.\nIf the PDN-GW successfully verifies the MN-HA-AE it shall proceed to connect the user to the specified APN, and will send the RRP message to the FA.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.1.2.6.3",
      "section_id": "9.1.2.6.3",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "Upon receipt of the Authorization Request message from the PDN GW, the 3GPP AAA Server shall update the PDN GW information for the APN for the UE on the HSS. If the APN was not received from the PDN GW the 3GPP AAA Server shall assign the received PDN-GW identity to the default APN .\nThe 3GPP AAA Server must check that the user exists. If the user's data exists in the 3GPP AAA Server, it shall check, whether it also has an active access authorization session for the user.\n-\tIf not, the 3GPP AAA Server shall reject the authorization request, including the Result-Code DIAMETER_AUTHORIZATION_REJECTED.\n-\tIf the 3GPP AAA Server has an existing authorization session,\n-\tIf the APN requested by the PDN GW is included in the list of authorized APNs of the user, then the 3GPP AAA Server shall include the Service-Selection AVP in the authorization answer. If no APN was requested the Service-Selection AVP shall contain the default APN.\n-\tIf the MN-HA-SPI was included in the request and it matches the SPI belonging to a SA of the user then\tthe 3GPP AAA Server shall include the MIP-Session-Key of the SA in the authorization answer and set\tthe Result-Code to DIAMETER_SUCCESS.\n-\tIf the MN-HA-SPI was included in the request and there is no match with a SPI belonging to a SA of the user then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\n-\tIf the APN requested by the PDN GW is not included in the list of authorized APNs, then the status code DIAMETER_AUTHORIZATION_REJECTED shall be returned to the PDN GW to indicate an unsuccessful authorization.\nIf the user's profile does not exist in the 3GPP AAA Server, it shall retrieve the Diameter identity of the 3GPP AAA Server currently serving the user from the HSS following the procedures for subscriber profile download as specified in clause 8.1.2.2.2. Depending on the HSS response,\n-\tIf the HSS indicates that the user is currently being served by a different 3GPP AAA Server, the 3GPP AAA Server shall respond to the PDG-GW with the Result-Code set to DIAMETER_REDIRECT_INDICATION and Redirect-Host set to the Diameter URI of the 3GPP AAA Server currently serving the user (this Diameter URI shall be constructed based on the Diameter Identity included in the 3GPP-AAA-Server-Name AVP returned in the SWx authentication response from the HSS).\n-\tIf the HSS returns DIAMETER_ERROR_USER_UNKNOWN, the 3GPP AAA Server shall return the same error to the PDN GW.\n-\tIf the HSS sends the user's profile to the 3GPP AAA Server, the authorization shall be rejected by setting the Result-Code to DIAMETER_AUTHORIZATION_REJECTED. The 3GPP AAA Server shall delete the downloaded user profile.\nNOTE:\tThe last outcome corresponds to the case that the user has no active access authorization procedure. This is considered as an error situation, e.g. the Trusted Non-3GPP access network may have sent RRQ without authorizing the user.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_8.1.2.2.2"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.1.2.6.4",
      "section_id": "9.1.2.6.4",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy is required to handle roaming cases in which the PDN GW is located in the VPLMN. The 3GPP AAA Proxy shall act as a stateful proxy.\nOn receipt of the authorization answer, the 3GPP AAA Proxy\n-\tshall check locally configured information for the maximum allowed static QoS parameters valid for visitors from the given HPLMN and modify the QoS parameters received from the 3GPP AAA Server, to enforce the policy limitations.\n-\tshall record the state of the connection (i.e. Authorization Successful).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.1",
      "section_id": "9.2.1",
      "section_title": "General",
      "content": "The S6b reference point shall be based on Diameter, as defined in IETF RFC 6733 [58], and contain the following additions and extensions:\n-\tIETF RFC 4005 [4], which defines a Diameter protocol application used for Authentication, Authorization and Accounting (AAA) services in the Network Access Server (NAS) environment.\n-\tIETF RFC 5779 [2], which defines a Diameter extensions and application for PMIPv6 MAG to AAA and LMA to AAA interfaces.\n-\tIETF RFC 5777 [9], which defines attribute value pairs to convey QoS information between Diameter peers.\nThe PDN GW to 3GPP AAA server or the PDN GW to 3GPP AAA proxy communication shall use the LMA to AAA interface functionality defined in IETF RFC 5779 [2] to update the 3GPP AAA server with PDN GW identity, indicate the protocol selected on S2a or S2b and optionally retrieve mobility related parameters and static QoS profiles, when PMIPv6 or GTPv2 based S2a or S2b is used.\nThe PDN-GW acts as a LMA when the UE attaches to the EPC using the S2a or S2b reference points and PMIPv6 is used. The PDN GW also follows the LMA to AAA interface functionality defined in IETF RFC 5779 [2] when UE attaches to the EPC using S2a or S2b reference point and GTPv2 is used. The PDN GW acts as HA when the UE attaches to the EPC using the S2a reference point and MIPv4 is used.\nIn the case the UE attached to the EPC using the S2c reference point, then the communication between the PDN GW and HA, IETF RFC 5778 [11] shall be used. The Application Id to be advertised over the S6b reference point corresponds to the DSMIPv6 \"Diameter Mobile IPv6 IKE (MIP6I)\" Application Id as defined in IETF RFC 5778 [11].\nIKEv2 EAP-based initiator authentication is used for authenticating and authorizing the UE and updating the PDN-GW identity. In this case, the PDN GW shall behave as described in 3GPP TS 33.402 [19].",
      "chunk_type": "definition",
      "cross_references": [
        "ts_33.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.2.1.1",
      "section_id": "9.2.2.1.1",
      "section_title": "Diameter-EAP-Request (DER) Command",
      "content": "The Diameter-EAP-Request (DER) command, indicated by the Command-Code field set to 268 and the \"R\" bit set in the Command Flags field, is sent from a PGW to a 3GPP AAA server. The Command Code value and the ABNF are re-used from the IETF RFC 5778 [11].\n< Diameter-EAP-Request > ::=\t< Diameter Header: 268, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ RAT-Type ]\n[ User-Name ]\n[ Service-Selection ]\n{ EAP-Payload }\n[ MIP6-Feature-Vector ]\n[ MIP6-Agent-Info ]\n[ QoS-Capability ]\n[ Visited-Network-Identifier ]\n[ MIP-Careof-Address ]\n[ AAA-Failure-Indication ]\n*[ Supported-Features ]\n[DER-S6b-Flags]\n[ UE-Local-IP-Address]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.1.2",
      "section_id": "9.2.2.1.2",
      "section_title": "Diameter-EAP-Answer (DEA) Command",
      "content": "The Diameter-EAP-Answer (DEA) command, indicated by the Command-Code field set to 268 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a PGW. The Command Code value and the ABNF are re-used from the IETF RFC 5778 [11].\n<Diameter-EAP-Answer> ::= < Diameter Header: 268, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n[ EAP-Payload ]\n[ EAP-Master-Session-Key ]\n[ Mobile-Node-Identifier ]\n[ APN-Configuration ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ 3GPP-Charging-Characteristics ]\n*[ QoS-Resources ]\n*[ Redirect-Host ]\n[ Trace-Info ]\n*[ Supported-Features ]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.2.1",
      "section_id": "9.2.2.2.1",
      "section_title": "AA-Request (AAR) Command",
      "content": "The AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from the PDN GW to the 3GPP AAA Server. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\nNOTE:\tThis command is used for the S6b Authorization Procedure for PMIPv6 or GTPv2, and also for the S6b Service Authorization Information Update procedure for PMIPv6, GTPv2 or DSMIPv6 following a previous RAR/RAA command exchange initiated by the 3GPP AAA Server.\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ User-Name ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ QoS-Capability ]\n[ Service-Selection ]\n[ OC-Supported-Features ]\n[ Origination-Time-Stamp ]\n[ Maximum-Wait-Time ]\n*[ Supported-Features ]\n[ Emergency- Services ]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.2.2",
      "section_id": "9.2.2.2.2",
      "section_title": "AA-Answer (AAA) Command",
      "content": "The AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from the 3GPP AAA Server to the PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Answer command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\nNOTE:\tThis command is used for the S6b Authorization Procedure for PMIPv6 or GTPv2, and also for the S6b Service Authorization Information Update procedure for PMIPv6, GTPv2 or DSMIPv6 following a previous RAR/RAA command exchange initiated by the 3GPP AAA Server.\n<AA-Answer> ::=\t< Diameter Header: 265, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n...\n[ MIP6-Feature-Vector ]\n[ Session-Timeout ]\n[ APN-Configuration ]\n[ QoS-Resources ]\n[ AN-Trusted ]\n*[ Redirect-Host ]\n[ Trace-Info ]\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ Supported-Features ]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.3.1",
      "section_id": "9.2.2.3.1",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from a PDN GW to a 3GPP AAA server. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.3.2",
      "section_id": "9.2.2.3.2",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA server to a PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.4.1",
      "section_id": "9.2.2.4.1",
      "section_title": "Abort-Session-Request (ASR) Command",
      "content": "The Abort-Session-Request (ASR) command, indicated by the Command-Code field set to 274 and the \"R\" bit set in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to a PDN GW. The ABNF is based on the one in IETF RFC 4005 [4].\n< Abort-Session-Request > ::=\t< Diameter Header: 274, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n[ User-Name ]\n[ Auth-Session-State ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.4.2",
      "section_id": "9.2.2.4.2",
      "section_title": "Abort-Session-Answer (ASA) Command",
      "content": "The Abort-Session-Answer (ASA) command, indicated by the Command-Code field set to 274 and the \"R\" bit cleared in the Command Flags field, is sent from a PDN GW to a 3GPP AAA Server/Proxy. The ABNF is based on the one in IETF RFC 4005 [4].\n< Abort-Session-Answer > ::=\t< Diameter Header: 274, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.4.3",
      "section_id": "9.2.2.4.3",
      "section_title": "Session-Termination-Request (STR) Command",
      "content": "The Session-Termination-Request (STR) command, indicated by the Command-Code field set to 275 and the \"R\" bit set in the Command Flags field, is sent from an PDN GW to a 3GPP AAA Server/Proxy. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Request command.\n<Session-Termination-Request> ::=\t< Diameter Header: 275, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Application-Id }\n{ Termination-Cause }\n[ User-Name ]\n[ OC-Supported-Features ]\n…\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.4.4",
      "section_id": "9.2.2.4.4",
      "section_title": "Session-Termination-Answer (STA) Command",
      "content": "The Session-Termination-Answer (STA) command, indicated by the Command-Code field set to 275 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server/Proxy to an PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 6733 [58] Session-Termination-Answer command.\n<Session-Termination-Answer> ::=\t< Diameter Header: 275, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.5.1",
      "section_id": "9.2.2.5.1",
      "section_title": "AA-Request (AAR) Command",
      "content": "The AA-Request (AAR) command, indicated by the Command-Code field set to 265 and the \"R\" bit set in the Command Flags field, is sent from a PDN GW to a 3GPP AAA Server. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Request command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n<AA-Request> ::=\t< Diameter Header: 265, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Auth-Request-Type }\n[ User-Name ]\n[ MIP6-Agent-Info ]\n[ MIP6-Feature-Vector ]\n[ Visited-Network-Identifier ]\n[ QoS-Capability ]\n[ Service-Selection ]\n*[ Supported-Features ]\n[MIP-MN-HA-SPI]\n[ OC-Supported-Features ]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.5.2",
      "section_id": "9.2.2.5.2",
      "section_title": "AA-Answer (AAA) Command",
      "content": "The AA-Answer (AAA) command, indicated by the Command-Code field set to 265 and the \"R\" bit cleared in the Command Flags field, is sent from a 3GPP AAA Server to a PDN GW. The Command Code value and ABNF are re-used from the IETF RFC 4005 [4] AA-Answer command. New AVPs are added using the *[AVP] extension mechanism in the original ABNF.\n<AA-Answer> ::=\t< Diameter Header: 265, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Auth-Application-Id }\n{ Auth-Request-Type }\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ OC-Supported-Features ]\n[ OC-OLR ]\n*[ Load ]\n...\n[ MIP6-Feature-Vector ]\n[ Session-Timeout ]\n[ APN-Configuration ]\n[ QoS-Resources ]\n*[ Redirect-Host ]\n*[ Supported-Features ]\n[MIP-Session-Key]\n...\n*[ AVP ]",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.6.1",
      "section_id": "9.2.2.6.1",
      "section_title": "Re-Auth-Request (RAR) Command",
      "content": "The Diameter Re-Auth-Request (RAR) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit set in the Command Flags field and is sent from a 3GPP AAA Server or 3GPP AAA Proxy to a PDN-GW. The ABNF for the RAR command shall be as follows:\n< Re-Auth-Request >  ::=\t< Diameter Header: 258, REQ, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Origin-Host }\n{ Origin-Realm }\n{ Destination-Realm }\n{ Destination-Host }\n{ Auth-Application-Id }\n{ Re-Auth-Request-Type }\n[ User-Name ]\n[RAR-Flags ]\n...\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.2.6.2",
      "section_id": "9.2.2.6.2",
      "section_title": "Re-Auth-Answer (RAA) Command",
      "content": "The Diameter Re-Auth-Answer (ASA) command shall be indicated by the Command-Code field set to 258 and the \"R\" bit cleared in the Command Flags field and is sent from a PDN-GW to a 3GPP AAA Server or 3GPP AAA Proxy. The ABNF for the RAA commands shall be as follows:\n< Re-Auth-Answer >  ::=\t< Diameter Header: 258, PXY, 16777272 >\n< Session-Id >\n[ DRMP ]\n{ Result-Code }\n{ Origin-Host }\n{ Origin-Realm }\n[ User-Name ]\n...\n*[ AVP ]",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.0",
      "section_id": "9.2.3.0",
      "section_title": "General",
      "content": "The following clauses describes the Diameter AVPs defined for the S6b interface protocol in the different modes of operation (DSMIPv6, PMIPv6/GTPv2, MIPv4…).\nFor all AVPs which contain bit masks and are of the type Unsigned32, bit 0 shall be the least significant bit. For example, to get the value of bit 0, a bit mask of 0x00000001 should be used.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.1.1",
      "section_id": "9.2.3.1.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the S6b interface protocol in DSMIPv6 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.1.1/1: Diameter S6b AVPs for DSMIPv6\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nMIP6-Agent-Info\n486\n9.2.3.2.2\nGrouped\nM\nV,P\nMIP6-Feature-Vector\n124\n9.2.3.2.3\nUnsigned64\nM\nV,P\nVisited-Network-Identifier\n600\n9.2.3.1.2\nOctetString\nM,V\nP\nRAR-Flags\n1522\n9.2.3.1.5\nUnsigned32\nV\nM,P\nQoS-Capability\n578\n9.2.3.2.4\nGrouped\nM\nV,P\nQoS-Resources\n508\n9.2.3.2.5\nGrouped\nM\nV,P\nTrace-Info\n1505\n8.2.3.13\nGrouped\nV\nM,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nTrust-Relationship-Update\n1515\n9.2.3.1.4\nEnumerated\nV\nM,P\nAAA-Failure-Indication\n1518\n8.2.3.21\nUnsigned32\nV\nM,P\nDER-S6b-Flags\n1523\n9.2.3.7\nUnsigned32\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.",
      "chunk_type": "definition",
      "cross_references": [
        "table_9.2.3.1.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.1.2",
      "section_id": "9.2.3.1.2",
      "section_title": "Visited-Network-Identifier",
      "content": "The Visited-Network-Identifier AVP contains an identifier that helps the home network to identify the visited network (e.g. the visited network domain name). The Vendor-Id shall be set to 10415 (3GPP).\nThe AVP shall be encoded as:\nmnc<MNC>.mcc<MCC>.3gppnetwork.org\nIf MNC consists of only 2 digits, a leading digit \"0\" shall be added to the MNC value (e.g., if MNC=15 and MCC=234, the value of Visited-Network-Identifier shall be \"mnc015.mcc234.3gppnetwork.org\").",
      "chunk_type": "parameter",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.1.5",
      "section_id": "9.2.3.1.5",
      "section_title": "RAR-Flags",
      "content": "The RAR-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be as defined in table 9.2.3.1.5/1:\nTable 9.2.3.1.5/1: RAR-Flags\nBit\nName\nDescription\n0\nTrust-Relationship-Update-indication\nThis bit, when set, indicates to the PDN GW that the 3GPP AAA server only initiates the re-authorization procedure send the trust relationship to the PDN GW, and the PDN GW shall not perform any authorization procedure towards the UE.\n1\nP-CSCF Restoration Request\nThis bit, when set, shall indicate to the PDN GW that the 3GPP AAA Server requests the execution of the HSS-based P-CSCF restoration procedures for WLAN, as described in 3GPP TS 23.380 [52] clause 5.6.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the recever of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "table_9.2.3.1.5",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.1",
      "section_id": "9.2.3.2.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the S6b interface protocol in PMIPv6 or GTPv2 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.2.1/1: Diameter S6b AVPs for PMIPv6 or GTPv2\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nMIP6-Agent-Info\n486\n9.2.3.2.2\nGrouped\nM\nV,P\nMIP6-Feature-Vector\n124\n9.2.3.2.3\nUnsigned64\nM\nV,P\nQoS-Capability\n578\n9.2.3.2.4\nGrouped\nM\nV,P\nQoS-Resources\n508\n9.2.3.2.5\nGrouped\nM\nV,P\nTrace-Info\n1505\n8.2.3.13\nGrouped\nV\nM,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nVisited-Network-Identifier\n600\n9.2.3.1.2\nOctetString\nM,V\nP\nOrigination-Time-Stamp\n1536\n9.2.3.2.6\nUnsigned64\nV\nM,P\nMaximum-Wait-Time\n1537\n9.2.3.2.7\nUnsigned32\nV\nM,P\nEmergency- Services\n1538\n7.2.3.5\nUnsigned32\nV\nM,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.",
      "chunk_type": "definition",
      "cross_references": [
        "table_9.2.3.2.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.2",
      "section_id": "9.2.3.2.2",
      "section_title": "MIP6-Agent-Info",
      "content": "The MIP6-Agent-Info AVP contains the PDN GW identity or (for the chained S2 - PMIP based S8 case) the Serving GW address information. This AVP is defined in IETF RFC 5447 [6]. The identity of PDN GW is either an IP address transported in MIP-Home-Agent-Address or an FQDN transported in MIP-Home-Agent-Host. The PDN GW may use its IP address if a single IP address can be used for all Access Networks and protocols towards the PDN GW. In all other cases the PDN GW shall use its FQDN. MAG/AAA/HSS shall use FQDN if known. The grouped AVP has the following grammar:\nMIP6-Agent-Info ::=\t< AVP Header: 486 >\n*2[ MIP-Home-Agent-Address ]\n[ MIP-Home-Agent-Host ]\n[ MIP6-Home-Link-Prefix ]\n*[ AVP ]\nNOTE:\tThe AVP MIP6-Home-Link-Prefix is not used in S6b, but it is included here to reflect the complete IETF definition of the grouped AVP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.3",
      "section_id": "9.2.3.2.3",
      "section_title": "MIP6-Feature-Vector",
      "content": "The MIP6-Feature-Vector AVP contains a 64 bit flags field of supported mobility capabilities of the NAS. This AVP is defined in IETF RFC 5447 [6]. The NAS may include this AVP in a request message to indicate the mobility capabilities of the NAS to the 3GPP AAA server. Similarly, the Diameter server may include this AVP in an answer message to inform the NAS about which of the NAS indicated capabilities are supported or authorized by the 3GPP AAA Server.\nFollowing capabilities are supported on S6b reference point in PMIPv6 or GTPv2 mode:\n-\tPMIP6_SUPPORTED\n-\tIP4_HOA_SUPPORTED\n-\tGTPv2_SUPPORTED",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.4",
      "section_id": "9.2.3.2.4",
      "section_title": "QoS-Capability",
      "content": "The QoS-Capability AVP contains a list of supported Quality of Service profile templates (and therefore the support of the respective parameter AVPs). This AVP is defined in IETF RFC 5777 [9].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.5",
      "section_id": "9.2.3.2.5",
      "section_title": "QoS-Resources",
      "content": "The QoS-Resources AVP includes a description of the Quality of Service resources for policing traffic flows. This AVP is defined in IETF RFC 5777 [9].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.6",
      "section_id": "9.2.3.2.6",
      "section_title": "Origination-Time-Stamp",
      "content": "The Origination-Time-Stamp is of type Unsigned64. It indicates the UTC time when the originating entity initiated the request. It shall contain the number of milliseconds since 00:00:00 on 1 January 1900 UTC.\nNOTE:\tThis AVP contains the same numeric value, in milliseconds, as received over the GTPv2 protocol from the originating entity (see 3GPP TS 29.274 [38], clause 8.119).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.274_clause_8.119",
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.2.7",
      "section_id": "9.2.3.2.7",
      "section_title": "Maximum-Wait-Time",
      "content": "The Maximum-Wait-Time is of type Unsigned32. It indicates the number of milliseconds since the Origination-Time-Stamp during which the originator of a request waits for a response. See 3GPP TS 29.274 [38].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.274"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.3",
      "section_id": "9.2.3.3",
      "section_title": "S6b Re-used Diameter AVPs",
      "content": "Table 9.2.3.3/1: S6b re-used Diameter AVPs\nAttribute Name\nReference\nComments\nSupported-Features\n3GPP TS 29.229 [24]\nFeature-List-ID\n3GPP TS 29.229 [24]\nSee clause 9.2.3.4\nFeature-List\n3GPP TS 29.229 [24]\nSee clause 9.2.3.5\nMIP-Careof-Address\nIETF RFC 5778 [11]\nUE-Local-IP-Address\n3GPP TS 29.212 [23]\nOC-Supported-Features\nIETF RFC 7683 [47]\nSee clause 8.2.3.22\nOC-OLR\nIETF RFC 7683 [47]\nSee clause 8.2.3.23\nDRMP\nIETF RFC 7944 [53]\nSee clause 8.2.3.25\nLoad\nIETF RFC 8583 [54]\nSee clause 8.2.3.26\nNOTE 1:\tThe M-bit settings for re-used AVPs override those of the defining specifications that are referenced. Values include: \"Must set\", \"Must not set\". If the M-bit setting is blank, then the defining specification applies.\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.229_clause_9.2.3.4",
        "ts_29.229_clause_9.2.3.5",
        "clause_8.2.3.22",
        "clause_8.2.3.23",
        "clause_8.2.3.25",
        "clause_8.2.3.26",
        "table_9.2.3.3",
        "ts_29.229",
        "ts_29.212"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.4",
      "section_id": "9.2.3.4",
      "section_title": "Feature-List-ID AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. For this release, the Feature-List-ID AVP value shall be set to 1 for the S6b application.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.5",
      "section_id": "9.2.3.5",
      "section_title": "Feature-List AVP",
      "content": "The syntax of this AVP is defined in 3GPP TS 29.229 [24]. A null value indicates that there is no feature used by the S6b application. The meaning of the bits shall be as defined in table 9.2.3.5/1.\nTable 9.2.3.5/1: Features of Feature-List-ID 1 used in S6b\nFeature bit\nFeature\nM/O\nDescription\n0\nP-CSCF Restoration for WLAN\nO\nSupport of P-CSCF Restoration for WLAN\nThis feature is applicable to the AAR/AAA and RAR/RAA command pairs over the S6b interface, when the PDN GW supports the execution of the P-CSCF restoration procedures for WLAN for the related IMS PDN connection as described in 3GPP TS 23.380 [52] clause 5.6.\nIf the PDN-GW does not indicate support of this feature in a former AAR command, the 3GPP AAA Server shall not send a RAR command requesting the execution of the HSS-based P-CSCF restoration procedures for WLAN,\nFeature bit: The order number of the bit within the Supported-Features AVP, e.g. \"1\".\nFeature: A short name that can be used to refer to the bit and to the feature.\nM/O: Defines if the implementation of the feature is mandatory (\"M\") or optional (\"O\").\nDescription: A clear textual description of the feature.\nFeatures that are not indicated in the Supported-Features AVPs within a given application message shall not be used to construct that message.",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_23.380_clause_5.6",
        "table_9.2.3.5",
        "ts_29.229",
        "ts_23.380"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.1",
      "section_id": "9.2.3.6.1",
      "section_title": "General",
      "content": "The following table describes the Diameter AVPs defined for the S6b interface protocol in MIPv4 mode, their AVP Code values, types, possible flag values and whether or not the AVP may be encrypted.\nTable 9.2.3.6.1/1: Diameter S6b AVPs for MIPv4 FACoA\nAVP Flag rules\nAttribute Name\nAVP Code\nClause defined\nValue Type\nMust\nMay\nShould not\nMust not\nMIP6-Agent-Info\n486\n9.2.3.6.2\nGrouped\nM\nV,P\nMIP6-Feature-Vector\n124\n9.2.3.6.3\nUnsigned64\nM\nV,P\nQoS-Capability\n578\n9.2.3.6.4\nGrouped\nM\nV,P\nQoS-Resources\n508\n9.2.3.6.5\nGrouped\nM\nV,P\nMIP-MN-HA-SPI\n491\n9.2.3.6.6\nUnsigned32\nM\nV,P\nMIP-Session-Key\n343\n9.2.3.6.7\nOctetString\nM\nV,P\nService-Selection\n493\n5.2.3.5\nUTF8String\nM\nV,P\nNOTE 1:\tThe AVP header bit denoted as \"M\", indicates whether support of the AVP is required. The AVP header bit denoted as \"V\", indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see IETF RFC 6733 [58].\nNOTE 2:\tIf the M-bit is set for an AVP and the receiver does not understand the AVP, it shall return a rejection. If the M-bit is not set for an AVP, the receiver shall not return a rejection, whether or not it understands the AVP. If the receiver understands the AVP but the M-bit value does not match with the definition in this table, the receiver shall ignore the M-bit.",
      "chunk_type": "definition",
      "cross_references": [
        "table_9.2.3.6.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.2",
      "section_id": "9.2.3.6.2",
      "section_title": "MIP6-Agent-Info",
      "content": "The MIP6-Agent-Info AVP contains the PDN GW identity. This AVP is defined in IETF RFC 5447 [6]. The identity of PDN GW is either an IP address transported in MIP-Home-Agent-Address or an FQDN transported in MIP-Home-Agent-Host. The PDN GW may use its IP address if a single IP address can be used for all Access Networks and protocols towards the PDN GW. In all other cases the PDN GW shall use its FQDN. The FA/3GPP AAA Server/HSS shall use FQDN if known. The grouped AVP has the following grammar:\nMIP6-Agent-Info ::=\t< AVP Header: 486 >\n*2[ MIP-Home-Agent-Address ]\n[ MIP-Home-Agent-Host ]\n[ MIP6-Home-Link-Prefix ]\n*[ AVP ]\nNOTE:\tThe AVP MIP6-Home-Link-Prefix is not used in S6b, but it is included here to reflect the complete IETF definition of the grouped AVP.",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.3",
      "section_id": "9.2.3.6.3",
      "section_title": "MIP6-Feature-Vector",
      "content": "The MIP6-Feature-Vector AVP contains a 64 bit flags field of supported mobility capabilities of the NAS. This AVP is defined in IETF RFC 5447 [6]. The NAS may include this AVP in a request message to indicate the mobility capabilities of the NAS to the 3GPP AAA Server. Similarly, the Diameter server may include this AVP in an answer message to inform the NAS about which of the NAS indicated capabilities are supported or authorized by the 3GPP AAA Server.\nFollowing capabilities are supported on S6b reference point in MIPv4 FACoA mode:\n-\tMIP4_SUPPORTED",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.4",
      "section_id": "9.2.3.6.4",
      "section_title": "QoS-Capability",
      "content": "The QoS-Capability AVP contains a list of supported Quality of Service profile templates (and therefore the support of the respective parameter AVPs). This AVP is defined in IETF RFC 5777 [9].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.5",
      "section_id": "9.2.3.6.5",
      "section_title": "QoS-Resources",
      "content": "The QoS-Resources AVP includes a description of the Quality of Service resources for policing traffic flows. This AVP is defined in IETF RFC 5777 [9].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.6",
      "section_id": "9.2.3.6.6",
      "section_title": "MIP-MN-HA-SPI",
      "content": "The MIP-MN-HA-SPI AVP contains the index of the security association between the Mobile Node and the HA. This AVP is defined in IETF RFC 5778 [11].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.6.7",
      "section_id": "9.2.3.6.7",
      "section_title": "MIP-Session-Key",
      "content": "The MIP-Session-Key AVP contains the MN-HA shared key. This AVP is defined in IETF RFC 4004 [18].",
      "chunk_type": "general",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_9.2.3.7",
      "section_id": "9.2.3.7",
      "section_title": "DER-S6b-Flags",
      "content": "The DER-S6b-Flags AVP is of type Unsigned32 and it shall contain a bit mask. The meaning of the bits shall be asdefined in table 9.2.3.7/1:\nTable 9.2.3.7/1: DER-S6b-Flags\nBit\nName\nDescription\n0\nInitial-Attach-Indicator\nThis bit, when set, indicates that a UE performs the Initial Attach procedure from non-3GPP access network. When not set, it indicates that a UE performs the Handover procedure.\nNOTE:\tBits not defined in this table shall be cleared by the sender and discarded by the receiver of the command.",
      "chunk_type": "requirement",
      "cross_references": [
        "table_9.2.3.7"
      ]
    },
    {
      "chunk_id": "ts_29.273_9.2.4",
      "section_id": "9.2.4",
      "section_title": "Session Handling",
      "content": "The Diameter protocol between the PDN-GW and the 3GPP AAA Server or the 3GPP AAA Proxy shall always keep session state, and use the same Session-Id parameter for the lifetime of each Diameter session.\nA Diameter session shall identify a PDN Connection for a given user and an APN, while the PDN Connection is kept alive in the non-3GPP access. When the PDN Connection is either disconnected on the non-3GPP access, or handed over to the 3GPP access, the diameter session shall be terminated. In order to indicate that the session state is to be maintained, the Diameter client and server shall not include the Auth-Session-State AVP, either in the request or in the response messages (see IETF RFC 6733 [58]).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.1",
      "section_id": "10.1",
      "section_title": "General",
      "content": "This clause defines result code values that shall be supported by all Diameter implementations that conform to this specification.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.2",
      "section_id": "10.2",
      "section_title": "Success",
      "content": "Result codes that fall within the Success category shall be used to inform a peer that a request has been successfully completed. The Result-Code AVP values defined in Diameter base protocol (IETF RFC 6733 [58]) shall be applied.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.1",
      "section_id": "10.3.1",
      "section_title": "General",
      "content": "Errors that fall within the Permanent Failures category shall be used to inform the peer that the request has failed, and should not be attempted again. The Result-Code AVP values defined in Diameter base protocol (IETF RFC 6733 [58]) shall be applied. When one of the result codes defined here is included in a response, it shall be inside an Experimental-Result AVP and the Result-Code AVP shall be absent.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.2",
      "section_id": "10.3.2",
      "section_title": "DIAMETER_ERROR_USER_UNKNOWN (5001)",
      "content": "This result code shall be sent by the HSS to indicate that the user identified by the IMSI is unknown (see 3GPP TS 29.229 [24]).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_10.3.3",
      "section_id": "10.3.3",
      "section_title": "DIAMETER_ERROR_IDENTITY_NOT_REGISTERED (5003)",
      "content": "This result code shall be sent by the HSS to indicate that there is currently no 3GPP AAA Server registered for the user (see 3GPP TS 29.229 [24]).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_10.3.4",
      "section_id": "10.3.4",
      "section_title": "DIAMETER_ERROR_ROAMING_NOT_ALLOWED (5004)",
      "content": "This result code shall be sent by the HSS to indicate that the subscriber is not allowed to roam in a certain non-3GPP V-PLMN (see 3GPP TS 29.229 [24]).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_10.3.5",
      "section_id": "10.3.5",
      "section_title": "DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED (5005)",
      "content": "This result code shall be sent by the HSS to indicate that the node identity trying to be registered by a 3GPP AAA Server is already registered for a specific user (see 3GPP TS 29.229 [24]).",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.229"
      ]
    },
    {
      "chunk_id": "ts_29.273_10.3.6",
      "section_id": "10.3.6",
      "section_title": "DIAMETER_ERROR_USER_NO_NON_3GPP_SUBSCRIPTION (5450)",
      "content": "This result code shall be sent by the HSS to indicate that no non-3GPP subscription is associated with the IMSI.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.7",
      "section_id": "10.3.7",
      "section_title": "DIAMETER_ERROR_USER_NO_APN_SUBSCRIPTION (5451)",
      "content": "This result code shall be sent by the 3GPP AAA Server to indicate that the requested APN is not included in the user's profile, and therefore is not authorized for that user.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.8",
      "section_id": "10.3.8",
      "section_title": "DIAMETER_ERROR_RAT_TYPE_NOT_ALLOWED (5452)",
      "content": "This result code shall be sent by the HSS to indicate the RAT type the UE is using is not allowed for the IMSI.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.9",
      "section_id": "10.3.9",
      "section_title": "DIAMETER_ERROR_LATE_OVERLAPPING_REQUEST (5453)",
      "content": "This result code shall be sent by the 3GPP AAA Server to indicate that the incoming request collides with an existing session which has a more recent time stamp than the time stamp of the new request.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.10",
      "section_id": "10.3.10",
      "section_title": "DIAMETER_ERROR_TIMED_OUT_REQUEST (5454)",
      "content": "This result code shall be sent by the 3GPP AAA Server to indicate that the incoming request is known to have already timed out at the originating entity.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.11",
      "section_id": "10.3.11",
      "section_title": "DIAMETER_ERROR_ILLEGAL_EQUIPMENT (5554)",
      "content": "This result code shall be sent by the 3GPP AAA Server or 3GPP AAA Proxy to indicate that the Mobile Equipment used is not acceptable to the network (e.g. the Mobile Equipment is on the prohibited list of the EIR).",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.12",
      "section_id": "10.3.12",
      "section_title": "DIAMETER_ERROR_TRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED (5455)",
      "content": "This result code shall be sent by the HSS to indicate that trusted non-3GPP access is not authorized for the user.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.3.13",
      "section_id": "10.3.13",
      "section_title": "DIAMETER_ERROR_UNTRUSTED_NON_3GPP_ACCESS_NOT_ALLOWED (5456)",
      "content": "This result code shall be sent by the HSS to indicate that untrusted non-3GPP access is not authorized for the user.",
      "chunk_type": "requirement",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_10.4.1",
      "section_id": "10.4.1",
      "section_title": "General",
      "content": "Result codes that fall within the transient failures category shall be used to inform a peer that the request could not be satisfied at the time it was received, but may be able to satisfy the request in the future. The Result-Code AVP values defined in Diameter base protocol ( IETF RFC 6733 [58]) shall be applied. When one of the result codes defined here is included in a response, it shall be inside an Experimental-Result AVP and the Result-Code AVP shall be absent.\nThere are no Transient Error codes defined in this specification.",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_11.1.1",
      "section_id": "11.1.1",
      "section_title": "General",
      "content": "The definition of the reference point between the 3GPP AAA Server or 3GPP AAA Proxy and the EIR and its functionality is specified in clauses 7.2 and 16.2 in 3GPP TS 23.402 [3].\nThe 3GPP AAA Server/Proxy – EIR reference point is used to check the Mobile Equipment's identity status (e.g. to check that it has not been stolen, or, to verify that it does not have faults).",
      "chunk_type": "definition",
      "cross_references": [
        "ts_23.402"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.1.2.1.1",
      "section_id": "11.1.2.1.1",
      "section_title": "General",
      "content": "The Mobile Equipment Identity Check Procedure shall be used between the 3GPP AAA Server and the EIR if the TWAN or ePDG is in the HPLMN, or between the 3GPP AAA Proxy and the EIR if the TWAN or ePDG is in the VPLMN, to check the Mobile Equipment's identity status (e.g. to check that it has not been stolen, or, to verify that it does not have faults).\nThe Diameter Identity of the EIR is locally configured in the 3GPP AAA Server and 3GPP AAA Proxy.\nThis procedure is mapped to the commands ME-Identity-Check-Request/Answer (ECR/ECA) in the Diameter application specified in clause 7 of 3GPP TS 29.272 [29].\nTable 11.1.2.1.1/1 specifies the involved information elements for the request.\nTable 11.1.2.1.1/2 specifies the involved information elements for the answer.\nTable 11.1.2.1.1/1: ME Identity Check Request\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nTerminal Information\nTerminal-Information\nM\nThis information element shall contain the information about the used mobile equipment i.e. the IMEI. Within this Information Element, only the IMEI and the Software-Version AVPs shall be used on the 3GPP AAA Server/Proxy – EIR interface.\nIMSI\nUser-Name (See IETF RFC 6733 [58])\nO\nThis information element shall contain the user IMSI, formatted according to 3GPP TS 23.003 [3], clause 2.2.\nTable 11.1.2.1.1/2: ME Identity Check Answer\nInformation element name\nMapping to Diameter AVP\nCat.\nDescription\nResult\nResult-Code / Experimental-Result\nM\nThis IE shall contain the result of the operation.\nThe Result-Code AVP shall be used to indicate success / errors as defined in the Diameter base protocol (see IETF RFC 6733 [58]).\nThe Experimental-Result AVP shall be used for errors. This is a grouped AVP which shall contain the 3GPP Vendor ID in the Vendor-Id AVP, and the error code in the Experimental-Result-Code AVP.\nThe following errors are applicable in this case:\n- Unknown equipment\nEquipment Status\nEquipment-Status\nC\nThis information element shall contain the status of the requested mobile equipment as defined in 3GPP TS 22.016 [13].\nIt shall be present if the result of the ME Identity Check is DIAMETER_SUCCESS.",
      "chunk_type": "definition",
      "cross_references": [
        "ts_29.272_clause_7",
        "ts_23.003_clause_2.2",
        "ts_29.272_table_11.1.2.1.1",
        "table_11.1.2.1.1",
        "ts_23.003_table_11.1.2.1.1",
        "ts_29.272",
        "ts_23.003",
        "ts_22.016"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.1.2.1.2",
      "section_id": "11.1.2.1.2",
      "section_title": "3GPP AAA Server Detailed Behaviour",
      "content": "The 3GPP AAA Server shall make use of this procedure to check the ME identity, if the 3GPP AAA Server is configured to check the IMEI with the EIR and if the ePDG or TWAN is in the HPLMN.\nTerminal-Information, when sent by the 3GPP AAA Server to the EIR, shall contain the IMEI AVP, and it may contain also the Software-Version AVP.\nIMSI may be sent together with Terminal Information to the EIR for operator-determined purposes.\nWhen receiving the ME Identity Check answer from the EIR, the 3GPP AAA Server shall check the result code and the equipment status. Dependent upon the result, the 3GPP AAA Server shall determine whether to continue or stop the authentication and authorization procedure, see clause 5.1.2.1 and 7.1.2.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.1.2.1.3",
      "section_id": "11.1.2.1.3",
      "section_title": "3GPP AAA Proxy Detailed Behaviour",
      "content": "The 3GPP AAA Proxy shall make use of this procedure to check the ME identity, if the 3GPP AAA Proxy is configured to check the IMEI with the EIR and if the ePDG or TWAN is in the VPLMN.\nTerminal-Information, when sent by the 3GPP AAA Proxy to the EIR, shall contain the IMEI AVP, and it may contain also the Software-Version AVP.\nIMSI may be sent together with Terminal Information to the EIR for operator-determined purposes.\nWhen receiving the ME Identity Check answer from the EIR, the 3GPP AAA Proxy shall check the result code and the equipment status. Dependent upon the result, the 3GPP AAA Server shall determine whether to continue or stop the authentication and authorization procedure, see clause 5.1.2.1 and 7.1.2.1.",
      "chunk_type": "requirement",
      "cross_references": [
        "clause_5.1.2.1"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.1.2.1.4",
      "section_id": "11.1.2.1.4",
      "section_title": "EIR Detailed Behaviour",
      "content": "See clause 6.2.1.3 of 3GPP TS 29.272 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272_clause_6.2.1.3",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.2.1",
      "section_id": "11.2.1",
      "section_title": "General",
      "content": "The 3GPP AAA Server/Proxy – EIR reference point shall be based on Diameter, as defined in IETF RFC 6733 [58]. It shall be defined as an IETF vendor specific Diameter application, where the vendor is 3GPP. The vendor identifier assigned by IANA to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.\nThe Diameter application used over the 3GPP AAA Server/Proxy – EIR reference point is the S13/S13' Diameter application, and the application identifier is 16777252 (allocated by IANA).",
      "chunk_type": "definition",
      "cross_references": []
    },
    {
      "chunk_id": "ts_29.273_11.2.2.1.1",
      "section_id": "11.2.2.1.1",
      "section_title": "ME-Identity-Check-Request (ECR) Command",
      "content": "See clause 7.2.19 of 3GPP TS 29.272 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272_clause_7.2.19",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.2.2.1.2",
      "section_id": "11.2.2.1.2",
      "section_title": "ME-Identity-Check-Answer (ECA) Command",
      "content": "See clause 7.2.20 of 3GPP TS 29.272 [29].",
      "chunk_type": "general",
      "cross_references": [
        "ts_29.272_clause_7.2.20",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.2.3.1",
      "section_id": "11.2.3.1",
      "section_title": "General",
      "content": "The following table specifies the Diameter AVPs re-used by the 3GPP AAA Server/Proxy - EIR interface protocol from existing Diameter Applications, including a reference to their respective specifications and when needed, a short description of their use for the 3GPP AAA Server/Proxy – EIR interface.\nAny other AVPs from existing Diameter Applications, except for the AVPs from Diameter Base Protocol, do not need to be supported. The AVPs from Diameter base protocol specified in IETF RFC 6733 [58] are not included in table 11.2.3.1/1, but they may be re-used for the 3GPP AAA Server/Proxy - EIR protocol.\nTable 11.2.3.1/1: Diameter AVPs re-used for the 3GPP AAA Server/Proxy – EIR interface\nAttribute Name\nReference\nComments\nM-bit\nTerminal-Information\n3GPP TS 29.272 [29]\nUser-Name\nIETF RFC 6733 [58]\nEquipment-Status\n3GPP TS 29.272 [29]",
      "chunk_type": "definition",
      "cross_references": [
        "table_11.2.3.1",
        "ts_29.272"
      ]
    },
    {
      "chunk_id": "ts_29.273_11.2.4",
      "section_id": "11.2.4",
      "section_title": "Session Handling",
      "content": "The Diameter sessions between the 3GPP AAA Server and the EIR, and between the 3GPP AAA Proxy and the EIR, shall be handled as specified for the Diameter sessions between the MME and the EIR in clause 7.1.4 of 3GPP TS 29.272 [29].\nAnnex A (informative):Trusted WLAN authentication and authorization procedure\nA.1\tGeneral\nThis clause provides example call flows for the Trusted WLAN authentication and authorization procedure.\nCall flows for TSCM or SCM for Non-seamless WLAN Offload are not represented as they can be easily derived from the normative part of this specification.\nThis Annex is informative and the normative descriptions in this specification and in 3GPP TS 33.402 [19] prevail over the descriptions in this Annex if there is any difference.\nA.2\tCall Flow for SCM and EPC-routed access\nA.2.1\tSuccessful call flow\nFigure Annex A.2-1 describes a successful call flow for SCM and EPC-routed access, i.e. with S2a connectivity being granted to the UE.\nFigure Annex A.2-1: TWAN Authentication and Authorization Procedure for SCM and EPC routed access – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM) and in which it also requests the UE to provide its Mobile Equipment Identity. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge in which it also indicates the requested connection mode. If the UE requests SCM and an EPC-routed access, the UE also indicates the requested APN, PDN type, Initial Attach/Handover indication and/or PCO. The user's Mobile Equipment Identity is also included, if available and if requested by the 3GPP AAA Server.\n9.\tThe TWAN forwards the EAP payload to 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tIf the 3GPP AAA Server authorizes the SCM for EPC access for the UE, the 3GPP AAA Server includes the UE requested APN, PDN type, Initial Attach/Handover indication and/or PCO in the DEA message with the Result-Code AVP set to DIAMETER_MULTI_ROUND_AUTH. The 3GPP AAA Server also sets the TWAN-S2a-Connectivity Indicator in the DEA-Flags AVP to request the TWAN to proceed with the establishment of the S2a connectivity. The 3GPP AAA Server also includes the user's Mobile Equipment Identity, if available.\n12.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment.\n13.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n14.\tThe PDN GW returns a Create Session Response/PBA message to the TWAN, including the IP address(es) allocated for the UE.\n15.\tThe TWAN includes the provided Connectivity Parameters received from the PDN GW and sets the TWAN-S2a-Connectivity Indicator in the DER-Flags AVP in the DER message to the 3GPP AAA Server. The 3GPP AAA Server ignores the EAP payload included in the DER message.\n16.\tThe 3GPP AAA Server includes the PDN connectivity parameters in the AKA'-Notification and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n17.\tThe TWAN forwards the EAP payload to the UE.\n18-19. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwardsto the 3GPP AAA Server.\n20-21. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCESS. The subscription information need not to be included in the DEA message (if not changed).\nA.2.2\tUnsuccessful call flow\nFigure Annex A.2-2 describes an unsuccessful call flow for SCM and EPC-routed access, where S2a connectivity can not been granted to the UE due to an overload condition in the network for the APN requested by the UE.\nFigure Annex A.2-2: TWAN Authentication and Authorization Procedure for SCM and EPC routed access – UE request rejected with a Session Management back-off timer.\n1. to 11.\tSame as Figure Annex A.2-1.\n12.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment, or skips this step and goes directly to step 14 if it is already aware of an overload condition for the requested APN and the UE request cannot be served by another PGW and if it decides to reject this UE request.\n13.\tThe PDN GW rejects the UE request, possibly including overload control information.\n14.\tThe TWAN rejects the request due to an overload condition for the APN requested by the UE. The TWAN returns the cause \"insufficient resources\" and provides a Session Management back-off timer to be sent to the UE. The TWAN also sets the TWAN-S2a-Connectivity Indicator in the DER-Flags AVP in the DER message to the 3GPP AAA Server. The 3GPP AAA Server ignores the EAP payload included in the DER message.\n15.\tThe 3GPP AAA Server forwards the Session Management back-off timer received from the TWAN encapsulated in the AKA'-Notification and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n16.\tThe TWAN forwards the EAP payload to the UE.\n17-18. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwards to the 3GPP AAA Server.\n19-20. The 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_UNABLE_TO_COMPLY.\nA.2.3\tCall flow with IMEI check in VPLMN\nFigure Annex A.2-3 describes a roaming call flow for SCM and EPC-routed access, with IMEI check performed in the VPLMN.\nFigure Annex A.2-3: TWAN Authentication and Authorization Procedure for SCM and EPC routed access, with IMEI check performed in the VPLMN\n1. to 3. Same as Figure A.2-1.\n4.\tIf IMEI check is required by operator policy, the 3GPP AAA Proxy sets the IMEI-Check-Required-In-VPLMN bit in the DER-Flags AVP.\n5. to 9. Same as Figure A.2-1.\n9A. The 3GPP AAA Server requests the VPLMN to perform the IMEI check by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the Terminal-Information AVP in the DEA message.\n9B. The TWAN returns the IMEI-Check-Request-In-VPLMN flag in the DER-Flags AVP and the Terminal-Information AVP to the 3GPP AAA Proxy.\n9C. The 3GPP AAA Proxy performs the IMEI check in the VPLMN and forwards the DER to the 3GPP AAA Server, replacing the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP by the IMEI-Check-In-VPLMN-Result AVP.\n10. to 21. Same as Figure A.2-1 if the IMEI check in VPLMN was successful.Otherwise the 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nA.3\tCall Flow for MCM for EPC-routed access and/or NSWO\nA.3.1\tSuccessful call flow\nFigure Annex A.3-1 describes a successful call flow for MCM, for EPC-routed access and/or Non-seamless WLAN offload.\nFigure Annex A.3-1: TWAN Authentication and Authorization Procedure for MCM – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. For MCM, the TWAN also provides the TWAG's control plane IPv4 and/or IPv6 addresses to be used by the UE for WLCP if the MCM is selected. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM) and, for MCM, the WLCP transport(s) supported by the TWAN (i.e. IPv4 and/or IPv6), and in which it also requests the UE to provide its Mobile Equipment Identity. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge in which it also indicates the requested connection mode. In this example, the UE requests the MCM. The user's Mobile Equipment Identity is also included, if available and if requested by the 3GPP AAA Server.\n9.\tThe TWAN forwards the EAP payload to the 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tThe 3GPP AAA Server includes the information required for the MCM in the AKA'-Notification as specified in 3GPP TS 24.302[26] (e.g. NSWO authorization, TWAG control plane address) and sends the DEA message to the TWAN. The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n12.\tThe TWAN forwards the EAP payload to the UE.\n13-14. The UE responds with an EAP-RSP/AKA'-Notification message that the TWAN forwardsto the 3GPP AAA Server.\n15-16. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCCESS. The DEA message also indicates to the TWAN the selected connected mode (MCM), the user's subscription information, whether the user is authorized for EPC and/or non-seamless WLAN offload, the WLCP key for WLCP signalling protection, and the user's Mobile Equipment Identity if it is available.Dependent on the authorizations received from the 3GPP AAA server, the UE may subsequently initiate the establishement of PDN connections to access the EPC and/or proceeed with non-seamless WLAN offload.\nA.3.2\tCall flow with IMEI check in VPLMN\nFigure Annex A.3-x describes a roaming call flow for MCM, for EPC-routed access and/or Non-seamless WLAN offload, with IMEI check performed in the VPLMN.\nFigure Annex A.3-x: TWAN Authentication and Authorization Procedure for MCM, with an IMEI check in the VPLMN\n1. to 3. Same as Figure A.3-1.\n4.\tIf IMEI check is required by operator policy, the 3GPP AAA Proxy sets the IMEI-Check-Required-In-VPLMN bit in the DER-Flags AVP.\n5. to 9. Same as Figure A.3-1.\n9A. The 3GPP AAA Server requests the VPLMN to perform the IMEI check by setting the IMEI-Check-Request-In-VPLMN bit in the DEA-Flags AVP and including the Terminal-Information AVP in the DEA message.\n9B. The TWAN returns the IMEI-Check-Request-In-VPLMN flag in the DER-Flags AVP and the Terminal-Information AVP to the 3GPP AAA Proxy.\n9C. The 3GPP AAA Proxy performs the IMEI check in the VPLMN and forwards the DER to the 3GPP AAA Server, replacing the IMEI-Check-Request-In-VPLMN bit in the DER-Flags AVP by the IMEI-Check-In-VPLMN-Result AVP.\n10. to 16. Same as Figure A.3-1 if the IMEI check in VPLMN was successful.Otherwise the 3GPP AAA Server sends an EAP Failure message that the TWAN forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_ERROR_ILLEGAL_EQUIPMENT.\nA.4\tCall Flow for TSCM and EPC-routed access\nFigure Annex A.4-1 describes a successful call flow for TSCM for EPC-routed access, i.e with S2a connectivity being granted to the UE.\nFigure Annex A.4-1: TWAN Authentication and Authorization Procedure for TSCM – successful case\n1.\tA connection is established between the UE and the TWAN, using a specific procedure based on IEEE 802.11 [40].\n2.\tThe TWAN sends an EAP Request/Identity to the UE.\n3.\tThe UE sends an EAP Response/Identity message to the TWAN.\n4.\tThe TWAN forwards the EAP payload received from the UE to the 3GPP AAA Server and also indicates the supported TWAN connection modes in the DER message. The routing path may include one or several 3GPP AAA proxies for roaming case.\n5.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n6.\tThe 3GPP AAA Server sends an EAP Request/AKA'-Challenge in which it also indicates to the UE the TWAN connection modes supported by the network (e.g. TSCM, SCM and MCM). The Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.\n7.\tThe TWAN forwards the EAP payload to the UE.\n8.\tThe UE sends the EAP Response/AKA'-Challenge. In this example, the UE does not signal any requested connection mode in that message, which indicates a request for TSCM.\n9.\tThe TWAN forwards the EAP payload to the 3GPP AAA Server.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards to the UE in step 12 or 16. The Result-Code AVP in the DEA message is set to DIAMETER_SUCCESS. The DEA message also contains the user's subscription information, whether the user is authorized for EPC and/or non-seamless WLAN offload. The 3GPP AAA Server does not signal any selected TWAN connection mode in the DEA message, which indicates to the TWAN that TSCM is selected.\n12.\tThe TWAN forwards the EAP Success message to the UE, when using layer 3 attach trigger.\n13.\tThe TWAN sends a Create Session Request/PBU message to the PDN GW to initiate the S2a tunnel establishment (assuming EPC access has been authorized).\n14.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n15.\tThe PDN GW returns a Create Session Response/PBA message to the TWAN, including the IP address(es) allocated for the UE.\n16.\tThe TWAN forwards the EAP Success message to the UE, when using layer 2 attach trigger.\nAnnex B (normative):Diameter overload control mechanism\nB.1\tGeneral\nIETF RFC 7683 [47] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\nDepending on regional/national requirements and network operator policy, priority traffic (e.g., MPS) shall be the last to be throttled and shall be exempted from throttling due to Diameter overload control up to the point where requested traffic reduction cannot be achieved without throttling the priority traffic.\nB.2\tSWx interface\nB.2.1\tGeneral\nThe Diameter overload control mechanism is an optional feature over the SWx interface.\nIt is recommended to make use of IETF RFC 7683 [47] on the SWx interface where, when applied, the 3GPP AAA server shall behave as a reacting node and the HSS as a reporting node.\nB.2.2\tHSS behaviour\nThe HSS requests traffic reduction from the 3GPP AAA server when it is in an overload situation, by including OC-OLR AVP in answer commands as described in IETF RFC 7683 [47].\nThe HSS identifies that it is in an overload situation by implementation specific means. For example, the HSS may take into account the traffic over the SWx interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe HSS determines the specific contents of the OC-OLR AVP in overload reports and the HSS decides when to send OC-OLR AVPs by implementation specific means.\nB.2.3\t3GPP AAA server behaviour\nThe 3GPP AAA server applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].\nRequested traffic reduction is achieved by the 3GPP AAA server by implementation specific means. For example, it may implement message throttling with prioritization.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may request traffic reduction over the interfaces (e.g STa, SWm, S6b) towards the access nodes if the Diameter overload control mechanism is supported on these interfaces.\nAnnex C gives guidance on message prioritisation over the SWx interface.\nB.3\tSTa interface\nB.3.1\tGeneral\nThe Diameter overload control mechanism is an optional feature over the STa interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the STa interface where, when applied, the trusted non 3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nB.3.2\t3GPP AAA server behaviour\nThe 3GPP AAA server requests traffic reduction from the trusted non 3GPP access network when it is in an overload situation, by including OC-OLR AVP in answer commands as described in IETF RFC 7683 [47].\nThe 3GPP AAA server identifies that it is in an overload situation by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the STa interfaces or other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe 3GPP AAA server determines the specific contents of the OC-OLR AVP in overload reports and the 3GPP AAA server decides when to send OC-OLR AVPs by implementation specific means.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may also request traffic reduction over the STa interfaces towards the trusted access networks nodes.\nB.3.3\tTrusted non 3GPP access network behaviour\nThe trusted non 3GPP access network applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].\nRequested traffic reduction is achieved by the trusted non 3GPP access network by implementation specific means. For example, it may implement message throttling with prioritization.\nAnnex C gives guidance on message prioritisation over the STa interface.\nB.4\tS6b interface\nB.4.1\tGeneral\nThe Diameter overload control mechanism is an optional feature over the S6b interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the S6b interface where, when applied, the PDN-GW shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nB.4.2\t3GPP AAA server behaviour\nThe 3GPP AAA server requests traffic reduction from the PDN-GW when it is in an overload situation, by including OC-OLR AVP in answer commands, as described in IETF RFC 7683 [47].\nThe 3GPP AAA server identifies that it is in an overload situation by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the S6b interfaces and other interfaces, the level of usage of internal resources (CPU, memory), the access to external resources etc.\nThe 3GPP AAA server determines the specific contents of the OC-OLR AVP in overload reports and when the 3GPP AAA server decides when to send OC-OLR AVPs by implementation specific means.\nThe 3GPP AAA server, when requested to apply traffic reduction over the SWx interface, may also request traffic reduction over the S6b interfaces towards the PDN-GWs.\nB.4.3\tPDN-GW behaviour\nThe PDN-GW applies required traffic reduction received in answer commands to subsequent applicable requests, as per IETF RFC 7683 [47].Requested traffic reduction is achieved by the PDN-GW by implementation specific means. For example, it may implement message throttling with prioritization.\nAnnex C gives guidance on message prioritisation over the S6b interface.\nB.5\tSWa Interface\nB.5.1\tGeneral\nThe Diameter overload control mechanism is an optional feature over the SWa interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the SWa interface where, when applied, the untrusted non-3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nB.5.2\t3GPP AAA server behaviour\nThe 3GPP AAA server behaviour is the same as described in clause B.3.2 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\nB.5.3\tuntrusted non-3GPP access network behaviour\nThe untrusted non-3GPP access network behaviour is the same as described in clause B.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\nAnnex C gives guidance on message prioritisation over the SWa interface.\nB.6\tSWm Interface\nB.6.1\tGeneral\nThe Diameter overload control mechanism is an optional feature over the SWm interface.\nIt is recommended to make use of the IETF RFC 7683 [47] over the SWm interface where, when applied, the ePDG shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nB.6.2\t3GPP AAA server behaviour\nThe 3GPP AAA server behaviour is the same as described in clause B.3.2 for STa by replacing\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\nB.6.3\tePDG behaviour\nThe ePDG behaviour is the same as described in clause B.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\nAnnex C gives guidance on message prioritisation over the SWm interface.\nAnnex C (Informative):Diameter overload control node behaviour\nC.1\tIntroduction\nAnnex C gives guidance on the Diameter overload control node behaviours regarding message prioritisation over non 3GPP access interfaces.\nC.2\tMessage prioritization over SWx\nThis clause gives an analysis of possible behaviours of the 3GPP AAA server regarding message prioritisation as guidance and for an informative purpose.\nWhen the HSS is overloaded, the 3GPP AAA server will receive overload reports from the HSS requesting a reduction of the requests sent by the 3GPP AAA server. This will apply to MAR and SAR requests.\nThe 3GPP AAA server can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages.\nThe 3GPP AAA server can take into account if it has already registered the user:\n-\tDiameter requests related to PDN connections for emergency services have the highest priority. Depending on regional/national requirements and network operator policy, these Diameter requests are the last to be throttled, when the 3GPP AAA Server has to apply traffic reduction;\n-\tif the user is not already registered in the 3GPP AAA server and the user is not establishing a PDN connection for emergency services, the 3GPP AAA server gives a lower priority to the MAR command to be sent to the HSS. This will correspond to the following cases:\n-\tthe user is not registered for non 3GPP access in the HSS and is doing an attach on a non 3GPP access;\n-\tthe user is not registered for non 3GPP access in the HSS and is doing an handover from a 3GPP access; if the MAR command is throttled, the PDN connection will be then maintained in the 3GPP access;\n-\tthe user is registered in the HSS but with another 3GPP AAA server, apart a restoration case (see further), this relates to a new session. There is nevertheless a limitation for an inter RAT mobility between non 3GPP accesses when such a MAR is throttled, this is considered as acceptable;\n-\tafter a not throttled and successful MAR, the subsequent requests (SARs) have a higher priority, otherwise it would mean that the initial MAR command processed by the (overloaded) HSS has been useless. An example is the call flow described in Annex C;\n-\tif the user is registered in the 3GPP AAA server, the 3GPP AAA server gives a higher priority to the MAR or SAR commands to be sent to the HSS as to maintain the service to the user;\tnevertheless, if a SAR indicates a PGW_UPDATE and is related to an additional Diameter session over S6b for the user, so to establish an additional PDN connection, a lower priority may be given to this SAR;\n-\tin a restoration procedure due to the failure of the old 3GPP AAA server, the new 3GPP AAA server is informed of such a restoration procedure by the presence of the AAA-Failure-Indication AVP in the request received from the access. As restoration procedures may be a source of a high signalling traffic and contribute to a HSS overload, the new 3GPP AAA server may give a lower priority to such MAR messages;\n-\tthe deregistration of the user by the 3GPP AAA server has a higher priority as releasing resources in the HSS.\nC.3\tMessage prioritisation over STa, SWm and SWa\nThis clause gives an analysis of possible behaviours of the trusted non 3GPP access network over STa, of the untrusted non 3GPP access network over SWa and of the ePDG over SWm regarding message prioritisation as guidance and for an informative purpose.\nIn the rest of the clause, a reacting node identifies:\n-\ta trusted non 3GPP access network over STa;\n-\tan untrusted non 3GPP access network over SWa;\n-\tan ePDG over SWm.\nAs applying Diameter overload control over SWm and SWa may overlap, this is an operator policy to apply Diameter overload control either on SWm or on SWa or on both.\nWhen the 3GPP AAA server is overloaded, the reacting node will receive overload reports from the 3GPP AAA server requesting a reduction of requests sent by the reacting node. This will apply to DER, STR (and also AAR for STa and SWm) commands.\nThe reacting node can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages. The reacting node can take into account the following considerations:\n-\tDiameter requests related to PDN connections for emergency services have the highest priority. Depending on regional/national requirements and network operator policy, these Diameter requests are the last to be throttled, when the reacting node has to apply traffic reduction;\n-\tif the user has no existing context in the reacting node and the user is not establishing a PDN connection for emergency services, the reacting node gives a lower priority to authentication and authorisation procedures, so to DER commands. This avoids adding new users on the 3GPP AAA server. There is nevertheless a consequence in limiting an inter RAT mobility between non 3GPP accesses when such a DER is throttled, this is considered as acceptable;\n-\tif the initial request was not throttled, the subsequent requests have a higher priority, otherwise it would mean that the initial request processed by the (overloaded) 3GPP AAA server has been useless. An example is the call flow described in Annex A.2 for STa;\n-\tIf the user has an existing context in the reacting node, new requests have a higher priority so to maintain the service to the user;\n-\tDER Requests (and also AAR for STa) resulting from the reception of a re-authentication re-authorisation procedure (or also re-authorisation procedure over STa) from the 3GPP AAA server have a higher priority, so to maintain the service to the user;\n-\tThe trusted non 3GPP access network has the possibility (see 5.1.2.3.1clause), at any time, to send a AAR command for check if there is any modification in the user authorization parameters previously provided by the 3GPP AAA Server. The trusted non 3GPP access network may defer such AAR requests to diminish the traffic without impacting the service to the user;\n-\tSession termination procedures initiated by the reacting node may have a higher priority as releasing resources in the 3GPP AAA server.\nC.4\tMessage prioritization over S6b\nThis clause gives an analysis of possible behaviours of the PDN-GW regarding message prioritisation as guidance and for an informative purpose.\nWhen the 3GPP AAA server is overloaded, the PDN-GW will receive overload reports from the 3GPP AAA server requesting a reduction of requests sent by the PDN-GW. This will apply to AAR and STR commands.\nThe PDN-GW can consider some messages with a lower or a higher priority; lower priority messages will be candidates for throttling before higher priority messages.\nFollowing considerations can be taken into account:\n-\tAn important point to consider is that UEs accessing the PDN-GW via S2a or S2b have already been previously authorized to use the non 3GPP access (i.e. via STa or SWm or SWa). The AAR command over S6b following this initial authorisation has a higher priority, otherwise, if the AAR is throttled, it would mean that the initial authorisation procedure (and its process by the 3GPP AAA server) has been useless;\n-\tAn exception is in the Multi Connection Mode (MCM) (described in 3GPP TS 23.402 [3]), where after a first PDN connection being established, the UE requests the establishment of additional PDN connections. As the priority, when overload in the 3GPP AAA server, is to maintain the existing service in preference to setting up new services for the user, such AAR commands over S6b may have a lower priority;\n-\tTraffic reduction over the STa or SWm or SWa interfaces with the throttling of new authentication authorisation procedures, results in diminishing requests for new PDN connections to the PDN-GW and diminishing the traffic over S6b;\n-\tregarding the 3GGP AAA Server behaviour, it is better to request traffic reduction over the STa or SWm or SWa interfaces than over the S6b interface, so following the principle to request the traffic reduction as early and as close as possible to the traffic source (i.e. the UE);\n-\tAAR Requests resulting from the reception of a re-authorisation procedure from the 3GPP AAA server have a higher priority, so to maintain the service to the user;\n-\tthe session termination procedures over S6b initiated by the PDN-GW resulting from a UE request may have a higher priority as releasing resources in the 3GPP AAA server.\nAnnex D (normative):Diameter message priority mechanism\nD.1\tGeneral\nIETF RFC 7944 [53] specifies a Diameter routing message priority mechanism that allows Diameter nodes to indicate the relative priority of Diameter messages. With this information, other Diameter nodes may leverage the relative priority of Diameter messages into routing, resource allocation, set the DSCP marking for transport of the associated Diameter message, and also abatement decisions when overload control is applied.\nD.2\tSWa, STa, SWd, SWm, SWx, S6b interfaces\nThe Diameter message priority mechanism is an optional feature which may apply on one or several of the SWa, STa, SWd, SWm, SWx, S6b interfaces.\nIt is recommended to make use of IETF RFC 7944 [53] over the SWa, STa, SWd, SWm, SWx, S6b interfaces of an operator network when the overload control defined in Annex C is applied on these interfaces.\nA 3GPP functional entity supporting the Diameter message priority mechanism over an interface listed above shall comply with IETF RFC 7944 [53].\nA 3GPP functional entity sending a request shall determine the required priority according to its policies. When priority is required, it shall include the DRMP AVP indicating the required priority level in the request it sends, and shall prioritise the request according to the required priority level.\nWhen the 3GPP functional element receives the corresponding response, it shall prioritise the received response according to the priority level received within the DRMP AVP if present in the response, otherwise according to the priority level of the corresponding request.\nWhen a 3GPP functional entity receives a request, it shall handle the request according to the received DRMP AVP priority level. For the response, it may modify the priority level received in the DRMP AVP according to its policies and shall handle the response according to the required priority level. If the required priority level is different from the priority level received in the request, it shall include the DRMP AVP in the response.\nIf:\n-\ta 3GPP functional entity supports using the Diameter message priority mechanism for DSCP marking purposes,\n-\tthe transport network utilizes DSCP marking, and\n-\tmessage-dependant DSCP marking is possible for the protocol stack transporting Diameter,\nthen the 3GPP functional entity shall set the DSCP marking for transport of the request or response according to the required priority level.\nDiameter requests related to high priority traffic (e.g, MPS, emergency) shall contain a DRMP AVP with a high priority of which the level value is operator dependent.\nWhen not-explicitly requested, the inclusion and priority value of the DRMP AVP in Diameter messages are implementation specific.\nAnnex E (informative):Untrusted WLAN authentication and authorization procedure\nE.1\tGeneral\nThis clause provides example call flows for the Untrusted WLAN authentication and authorization procedure.\nThis Annex is informative and the normative descriptions in this specification and in 3GPP TS 33.402 [19] prevail over the descriptions in this Annex if there is any difference.\nSee clause 8.2.2 of 3GPP TS 33.402 [19] for details on the IKEv2 and EAP-AKA procedures. This clause focuses on the SWm, S6b and SWx signalling interactions.\nE.2\tSuccessful call flow\nFigure Annex E.2-1 describes a successful Untrusted WLAN authentication and authorization call flow.\nFigure Annex E.2-1: Untrusted WLAN Authentication and Authorization Procedure – successful case\n3.\tThe ePDG sends the EAP-RSP/Identity payload to the 3GPP AAA Server and also indicates the user identity and requested APN, if received from the UE.\n4.\tThe 3GPP AAA Server retrieves authentication vectors for the UE from the HSS.\n5.\tThe 3GPP AAA Server sends an EAP Request/AKA-Challenge.\n6.\tThe ePDG forwards the EAP payload to the UE and also requests the UE to provide its Mobile Equipment Identity if required.\n8.\tThe ePDG forwards the EAP payload to the 3GPP AAA Server. The user's Mobile Equipment Identity is also included, if available.\n9.\tIf dynamic IP mobility selection is executed, the selected mobility mode is sent to the UE in an AKA-Notification request.\n10.\tIf the 3GPP AAA Server successfully authentifies the UE, the 3GPP AAA Server downloads the user's subscription information from the HSS.\n11.\tIf the 3GPP AAA Server authorizes the access for the UE, the 3GPP AAA Server sends an EAP Success message that the ePDG forwards to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCESS. The subscription information, keying material and permanent user identity are also provided to the ePDG.\n14.\tThe ePDG sends a Create Session Request/PBU message to the PDN GW to initiate the S2b tunnel establishment.\n15.\tThe PDN GW informs the 3GPP AAA Server/HSS of its PDN GW identity and the APN corresponding to the UE's PDN Connection.\n16.\tThe PDN GW returns a Create Session Response/PBA message to the ePDG, including the IP address(es) allocated for the UE.\n17.\tThe IKEv2 negotiation completes. The ePDG provides the UE IP address to the UE.\nE.3\tCall flow with IMEI check in VPLMN\nFigure Annex E.3-1 describes a roaming call flow, with IMEI check performed in the VPLMN.\nFigure Annex E.3-1: Untrusted WLAN Authentication and Authorization Procedure, with IMEI check performed in the VPLMN\n1. to 5. Same as Figure E.2-1.\n6.\tIf IMEI check is required by operator policy, the ePDG requests the UE to provide its Mobile Equipment Identity.\n7.\tSame as Figure E.2-1.\n8.\tThe ePDG includes the Terminal-Information AVP in the DER command. If IMEI check is required by operator policy, the 3GPP AAA Proxy performs the IMEI check in the VPLMN. If the IMEI check allows to continue the authentication and authorization procedure, the 3GPP AAA Proxy forwards the DER to the 3GPP AAA Server (as shown in this figure). Otherwise the 3GPP AAA Proxy responds to the ePDG with the Experimental-Result-Code DIAMETER_ERROR_ILLEGAL_EQUIPMENT and sends a SWm Session Termination Request towards the 3GPP AAA Server.\n9 to 17. Same as Figure E.2-1 if the IMEI check in VPLMN was successful.\nAnnex F (normative):Diameter load control mechanism\nF.1\tGeneral\nIETF RFC 8583 [54] specifies a Diameter overload control mechanism which includes the definition and the transfer of related AVPs between Diameter nodes.\nF.2\tSWx interface\nF.2.1\tGeneral\nThe Diameter load control mechanism is an optional feature over the SWx interface.\nIt is recommended to make use of IETF RFC 8583 [54] on the SWx interface where, when applied, the 3GPP AAA server shall behave as a reacting node and the HSS as a reporting node.\nF.2.2\tHSS behaviour\nThe HSS may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe HSS calculates its current load by implementation specific means. For example, the HSS may take into account the traffic over the SWx interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe HSS determines when to send Load AVPs of type HOST by implementation specific means.\nF.2.3\t3GPP AAA server behaviour\nWhen performing next hop Diameter Agent selection for requests that are routed based on realm, the 3GPP AAA server may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\nF.3\tSTa interface\nF.3.1\tGeneral\nThe Diameter load control mechanism is an optional feature over the STa interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the STa interface where, when applied, the trusted non 3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nF.3.2\t3GPP AAA server behaviour\nThe 3GPP AAA server may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe 3GPP AAA server calculates its current load by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the STa interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe 3GPP AAA server determines when to send Load AVPs of type HOST by implementation specific means.\nF.3.3\tTrusted non 3GPP access network behaviour\nWhen performing next hop Diameter Agent selection for requests that are routed based on realm, the Trusted non 3GPP access network may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\nF.4\tS6b interface\nF.4.1\tGeneral\nThe Diameter load control mechanism is an optional feature over the S6b interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the S6b interface where, when applied, the PDN-GW shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nF.4.2\t3GPP AAA server behaviour\nThe 3GPP AAA server may report its current load by including a Load AVP of type HOST in answer commands as described in IETF RFC 8583 [54].\nThe 3GPP AAA server calculates its current load by implementation specific means. For example, the 3GPP AAA server may take into account the traffic over the S6b interface or other interfaces, the level of usage of internal resources (e.g. CPU, memory), the access to external resources, etc.\nThe 3GPP AAA server determines when to send Load AVPs of type HOST by implementation specific means.\nF.4.3\tPDN-GW behaviour\nWhen performing next hop Diameter Agent selection for requests that are routed based on realm, the PDN-GW may take into account load values from Load AVPs of type PEER received from candidate next hop Diameter nodes, as per IETF RFC 8583 [54].\nF.5\tSWa Interface\nF.5.1\tGeneral\nThe Diameter load control mechanism is an optional feature over the SWa interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the SWa interface where, when applied, the untrusted non-3GPP access network shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nF.5.2\t3GPP AAA server behaviour\nThe 3GPP AAA server behaviour is the same as described in clause F.3.2 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\nF.5.3\tuntrusted non-3GPP access network behaviour\nThe untrusted non-3GPP access network behaviour is the same as described in clause F.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by untrusted non 3GPP access network;\n-\tSTa by SWa.\nF.6\tSWm Interface\nF.6.1\tGeneral\nThe Diameter load control mechanism is an optional feature over the SWm interface.\nIt is recommended to make use of the IETF RFC 8583 [54] over the SWm interface where, when applied, the ePDG shall behave as a reacting node and the 3GPP AAA server as a reporting node.\nF.6.2\t3GPP AAA server behaviour\nThe 3GPP AAA server behaviour is the same as described in clause F.3.2 for STa by replacing\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\nF.6.3\tePDG behaviour\nThe ePDG behaviour is the same as described in clause F.3.3 for STa by replacing:\n-\ttrusted non 3GPP access network by ePDG;\n-\tSTa by SWm.\nAnnex G (informative):Change history\nDate\nTSG #\nTSG Doc.\nCR\nRev\nCat\nSubject/Comment\nNew\n2008-12\nCT#42\nCP-080717\nV2.0.0 approved in CT#42\n8.0.0\n2009-03\nCT#43\nCP-090051\n0002\n2\nClarification on QoS Resource on S6b\n8.1.0\nCP-090051\n0003\n1\nContext Identifier for Update or Removal of PDN GW\nCP-090051\n0007\n-\nClarification on the S6b Authorization Procedure for DSMIPv6\nCP-090051\n0009\n-\nClarification on DHCPv6/IKEv2 based HA discovery\nCP-090051\n0010\n1\nClarification on AAA server authentication/authorization\nCP-090051\n0011\n1\nDifference of S6b and H2\nCP-090051\n0013\n1\nSTR on HSS/AAA initiated detach over STa\nCP-090051\n0014\n1\nSTR on 3GPP AAA Server initiated detach over SWm\nCP-090051\n0015\n1\nSTR on 3GPP AAA Server initiated detach over S6b\nCP-090051\n0016\n1\nMultiple 3GPP AAA identities\nCP-090051\n0019\n1\nUser-Name AVP contains only the IMSI\nCP-090051\n0020\n-\nRemoval of APN-Barring-Type Reference\nCP-090051\n0021\n1\nCharging AVPs\nCP-090051\n0022\n1\nMIP6-Agent-Info Definition and Usage\nCP-090051\n0023\n1\nREAUTHENTICATION_FAILURE Correction\nCP-090051\n0025\n1\nDefinition of Server-Assignment-Type values\nCP-090051\n0026\n-\nMultiple Occurrences of SIP-Auth-Data-Item AVP\nCP-090051\n0028\n1\nUsing MIP6-Agent-Info for SGW address\nCP-090051\n0029\n1\nMIP6-Agent-Info corrections\nCP-090051\n0030\n1\nTrace activation in PDN GW over the SWx and S6b interfaces\nCP-090051\n0031\n1\nSignalling VPLMN Trust of non-3GPP AN\nCP-090051\n0033\n-\nCorrections in Visited Network Identifier definitions\nCP-090051\n0034\n2\nService Authorization Information update on S6b when using DSMIP\nCP-090051\n0035\n4\nSTa/SWa clarifications\nCP-090051\n0036\n1\nIP address authorization corrections\nCP-090051\n0037\n2\nSWm Authentication Correction\nCP-090051\n0039\n1\nSWm corrections - others\nCP-090051\n0040\n3\nSWm Service Authorization Information Update corrections\nCP-090051\n0041\n5\nCombined Authentication and authorization procedure on SWm\nCP-090051\n0042\n2\nS6b related corrections\nCP-090051\n0044\n2\nCorrections to S6b/HA clause 9\nCP-090039\n0045\n3\nUser to HSS resolution\nCP-090051\n0080\n1\nCorrections to STR procedures for AAA_UNKNOWN_SESSION_ID\nCP-090051\n0081\n1\nCorrections to S6b STR procedures\nCP-090236\n0082\n1\nPDN GW update for Wildcard APN\nCP-090051\n0083\n-\nRFC 5447 References\n2009-06\nCT#44\nCP-090289\n0084\n1\nUse of Access-Restriction-Data AVP\n8.2.0\nCP-090289\n0085\n-\nDifference between S6b and H2\nCP-090289\n0086\n1\nCorrections to 29.273\nCP-090289\n0087\n1\nInclusion of static IP address\nCP-090289\n0088\n1\nHome Agent discovery\nCP-090289\n0090\n-\nIncorrect command for user profile updates\nCP-090289\n0092\n1\nHome Agent discovery\nCP-090289\n0093\n1\nFormatting of APN in Service-Selection AVP\nCP-090289\n0094\n-\nUpdate of AVP Codes\nCP-090289\n0096\n1\nSTa/SWa separation correction\nCP-090289\n0097\n-\nSWa corrections\nCP-090289\n0098\n1\nSTa re-authorization and re-authentication\nCP-090289\n0101\n2\nSWa re-authentication\nCP-090289\n0102\n1\nAdding APN-OI-Replacement\nCP-090289\n0103\n2\nHA reallocation clarification\n2009-09\nCT#45\nCP-090537\n0105\n2\nCorrection on APN-OI-Replacement\n8.3.0\nCP-090537\n0106\n-\nCorrection on the Description of Mobility Features over S6b\nCP-090537\n0111\n-\nEAP-AKA' IETF RFC Reference\nCP-090537\n0112\n-\nRemoval of Remaining Editor Notes\nCP-090537\n0113\n1\nMIP6_SPLIT flag removal\nCP-090537\n0108\n3\nSupport of optimized idle mode mobility\nCP-090537\n0115\n-\nE-UTRAN - eHRPD Connectivity and Interworking Reference\nCP-090537\n0116\n2\nDetailed behaviour in error cases\nCP-090537\n0118\n1\nApplication IDs\nCP-090537\n0119\n-\nService-Selection AVP Code\nCP-090537\n0120\n-\nPDN-Type AVP\nCP-090537\n0121\n1\nClarifications on PGW Handling on S6b/H2\n2009-09\nCT#45\nCP-090562\n0117\n1\nEmergency Support in AAA interfaces\n9.0.0\n2009-12\nCT#46\nCP-090793\n0122\n2\nAPN level APN-OI-Replacement\nCP-090774\n0126\n3\nCorrection of Allowed PDN Types\n9.1.0\nCP-090774\n0128\n2\nIncorrect HSS behaviour on deregistration\nCP-090774\n0130\n2\nMIP6 Agent Info\nCP-090774\n0132\nNonce\nCP-090774\n0136\n-\n3GPP AAA Server detailed behaviour at HSS Initiated Update of User Profile\nCP-090774\n0140\n2\nStatic PDN GW\nCP-090787\n0141\nRemoval of Definition of APN-Configuration\nCP-090774\n0143\n1\nPGW deregistration via S6b\nCP-090774\n0145\n1\nAdd Supported-Features AVP to STa/SWa\nCP-090774\n0147\n-\nAdd Supported-Features AVP to SWm\nCP-090774\n0149\n-\nAdd Supported-Features AVP to SWx\nCP-090774\n0151\n-\nAdd Supported-Features AVP to S6b\nCP-090774\n0153\n1\nCorrection of Application ID\nCP-090774\n0155\n1\nError Handling\nCP-090774\n0157\n-\nHSS/AAA-Initiated Disconnection\n2010-03\nCT#47\nCP-10024\n0163\n1\nCorrection in Subscription-ID\n9.2.0\nCP-10024\n0165\n-\nNAI decoration and realm-based routing clarifications\nCP-10024\n0167\n-\nIETF References update\nCP-10024\n0169\n-\nPermanent User Identity\nCP-10024\n0171\n1\nStatic PDN GW\nCP-10024\n0173\n-\nQoS AVP Codes\nCP-10024\n0175\n-\nIndication of PLMN ID of the selected PGW\nCP-10044\n0176\n-\nContext-Identifier in Registration Request\n2010-06\nCT#48\nCP-100290\n0179\n1\nCorrections on Session Termination between the PGW and the AAA\n9.3.0\nCP-100277\n0180\n-\nCorrections to implementation of CR 128 and CR 175\nCP-100277\n0181\n-\nPGW Identity upon successful authorization on SWm\n2010-06\nCT#48\nCP-100443\n0184\n-\nAmbiguity of Presence Conditions of IEs and AVP ABNF\n9.4.0\nCP-100457\n0188\n-\nIETF References\nCP-100457\n0189\n1\nSWm missing AVPs\n2010-09\nCT#49\nCP-100603\n0187\n1\nRemoval of Invalid Reference\n10.0.0\n2010-12\nCT#50\nCP-100679\n0197\n1\nCorrecting PDN GW behaviour for S6b\n10.1.0\nCP-100698\n0194\n1\nUpdate APN and PDN GW in the 3GPP AAA Server on SWx\nCP-100698\n0195\n1\nUpdate APN and PDN GW in Non-3GPP IP Access over the STa & SWm interfaces\nCP-100686\n0196\n3\nSWm and S6b procedures for GTP based S2b\nCP-100707\n0200\n-\nMIP6 Feature Vector flags assignment\nCP-100707\n0203\n-\nSWx AVP Bits Definition\nCP-100707\n0206\n-\nVisited-Network-Identifier Data Type\n2011-03\nCT#51\nCP-110051\n0210\n1\nUsage of Auth-Request-Type in response messages\n10.2.0\nCP-110073\n0208\n2\nCorrection on PGW PLMN ID\n2011-06\nCT#52\nCP-110359\n0214\n1\nTrace-Depth-List correction\n10.3.0\nCP-110359\n0217\n1\nMIPv4 security parameters on the STa and S6b interfaces\nCP-110359\n0221\n1\nPGW Update\nCP-110359\n0223\n1\nAPN Configuration for SWx\nCP-110360\n0219\n-\nAuthentication Timeout\n2011-12\nCT#54\nCP-110778\n0227\n1\nS6b session handling after handover to 3GPP access\n10.4.0\nCP-110778\n0235\n1\nIncorrect access name on SWa\nCP-110793\n0228\n5\nCorrection on Trust Relationship Indication\nCP-110793\n0238\n-\nImplementation Error of CR 196 R3\n2011-12\nCT#54\nCP-110812\n0225\n4\nSWx Restoration\n11.0.0\n2012-03\nCT#55\nCP-120016\n0257\n1\nWrong Command Code in STa AA-Answer\n11.1.0\nCP-120020\n0251\n2\nAuthorize the requested home address types\nCP-120020\n0260\n-\nContent of Service-Selection AVP\nCP-120040\n0245\n1\nWildcard APN in the user subscription\nCP-120040\n0253\n-\nPermanent User Identity in SWm Authentication and Authorization Answer\nCP-120040\n0255\n-\nEncoding of Visited-Network-Identifier AVP\nCP-120040\n0256\n-\nRe-Authorization Errors\nCP-120042\n0254\n1\nPermanent User Identity at SWa\nCP-120044\n0240\n1\nPDN GW reallocation based on UE's location\n2012-06\nCT#56\nCP-120225\n0243\n3\nTrust Relationship Indication\n11.2.0\nCP-120238\n0264\n-\nS6b procedures for GTP based S2a\nCP-120247\n0265\n2\nMissing IE in TS 29.273\nCP-120247\n0266\n-\nEmergency scenario for STa interface\nCP-120247\n0267\n2\nVisited Network Identifier\nCP-120247\n0278\n1\nNetwork Name\nCP-120238\n0268\n6\nSTa & SWd procedures for GTP S2a & Trusted WLAN access\nCP-120238\n0269\n1\nDefault APN  for 'Trusted WLAN access'\nCP-120238\n0270\n3\nInforming Serving SSID to the AAA Server\nCP-120238\n0271\n1\nAvoiding registration of PDN-GW identity for TWAN\nCP-120238\n0275\n1\nClarifications on TWAN behaviour\nCP-120237\n0273\n2\nPDN GW selection for S2c during tunnel establishment\n2012-09\nCT#57\nCP-120441\n0285\n-\nUpdate of IETF draft status to RFC\n11.3.0\nCP-120447\n0287\n2\nPGW selection in eHRPD for SIPTO\nCP-120461\n0272\n3\nRecovering from AAA Server failure\nCP-120474\n0279\n1\nTransport Access Type AVP for BBAI\nCP-120477\n0280\n1\nNSWO-Capability & NSWO-Authorization AVPs\nCP-120477\n0281\nAccess Type for TWAN access\nCP-120656\n0292\n1\nReference list correction to align with the corrected TS 29.212 title\n2012-12\nCT#58\nCP-120711\n0307\n1\nRemoval of AVP Encryption\n11.4.0\nCP-120733\n0293\n-\nRepeat information for Trusted non-3GPP access network\nCP-120733\n0300\n5\nMatching WLAN-ID between Selected WLAN ID and TWAN Access Info\nCP-120733\n0301\n1\nUpdate of draft-ietf-radext-ieee802ext reference\nCP-120747\n0294\n-\nCorrection on Auth-Request-Type\nCP-120747\n0295\n-\nDescription of Result IE\nCP-120728\n0297\n2\nInformation Elements for SWa interface\nCP-120728\n0299\n1\nSession ID in the SWm Authorization procedure\nCP-120750\n0302\n1\nTrace Info for PGW\nCP-120750\n0303\n1\nAdd the definition of trace-reference\nCP-120741\n0309\n2\nUse of Flag instead of Enumerated AVPs\n2013-03\nCT#59\nCP-130022\n0314\n2\nAbout EAP-AKA' challenge message\n11.5.0\nCP-130022\n0315\n1\nTWAN Authorization when HE-SSID is not provided\nCP-130022\n0317\n-\nMissing P-Bit settings in Information Element tables\nCP-130022\n0316\n-\nPresence condition of PGW-ID AVP in S6b AAR command\n2013-06\nCT#60\nCP-130288\n0313\n3\nNew DER-S6b-flags on S6b interface\n11.6.0\nCP-130288\n0325\n1\nMIP4 supported flag\nCP-130288\n0323\n1\n3GPP AAA Proxy behavior\nCP-130288\n0321\n1\nDefinition of HA-APN\nCP-130288\n0320\n2\nTrust relationship for PGW\nCP-130293\n0318\n2\nUE local IP address for SWm or S6b\n2013-06\nCT#60\nCP-130381\n0326\n1\nEAP-AKA clarification\n12.0.0\nCP-130381\n0319\n2\nClarification for Routing Policies\n2013-09\nCT#61\nCP-130459\n0333\n1\nCategory of Authentication Data Information Element in SWx/MAR command\n12.1.0\nCP-130472\n0329\n2\nAdd 3GPP AAA Proxy detailed Behaviour on SWa\nCP-130472\n0331\n1\nCorrection on IP Mobility Mode Selection function\nCP-130461\n0327\n2\nClarification on provision of HA information for DHCP-based HA discovery on STa\nCP-130461\n0332\n-\nApplicability of IP Filters and Routing Policies functionality on EPC\n2013-12\nCT#62\nCP-130602\n0351\n-\nEAP Payload\n12.2.0\nCP-130640\n0338\n-\nClarification on Trust Relationship Indicator\nCP-130640\n0339\n1\nMIP6-Agent-Info over the S6b interface\nCP-130640\n0346\n-\nClarification of M-bit handling\nCP-130640\n0354\n1\nReflective QoS for BBF convergence\nCP-130606\n0341\n-\nIMSI for BBF in trusted S2c case\nCP-130616\n0343\n4\nNSWO via the trusted WLAN\nCP-130616\n0345\n1\nVPLMN trust relationship indicator\nCP-130616\n0356\n1\nEPC Access Authorization\nCP-130633\n0353\n1\nPGW update on SWx\n2014-03\nCT#63\nCP-140023\n0366\n1\nReplacement of IETF WLAN AVPs\n12.3.0\nCP-140033\n0361\n-\nIncorrect Diameter commands\nCP-140033\n0363\n1\nCondition for sending APN Information\nCP-140030\n0364\n1\nRetrieval of Network Provided Location Information via HSS\nCP-140033\n0367\n-\nRAT Type correction\n2014-06\nCT#64\nCP-140247\n0368\n-\nSTa Authentication for Trusted WLAN access\n12.4.0\nCP-140253\n0369\n4\nIMSI for BBF convergence\nCP-140253\n0370\n1\nReflective QoS in BBF architecture\nCP-140252\n0373\n2\nCivic Address Encoding\nCP-140252\n0377\n-\nTWAN-BSSID AVP re-naming\nCP-140243\n0374\n3\nDiameter overload over SWx\nCP-140243\n0375\n3\nDiameter overload  over STa and S6b\n2014-09\nCT#65\nCP-140510\n0379\n2\nSession Management back-off timer for UE in Single-Connection mode\n12.5.0\nCP-140516\n0381\n2\nRemove TS 23.234 from TS 29.273\nCP-140516\n0382\n1\nRemove TS 29.234 from TS 29.273\nCP-140519\n0383\n1\nCircuit ID in NetLoc-TWLAN\n2014-12\nCT#66\nCP-140771\n0385\n-\nCorrect wrong references to 3GPP specifications that define Diameter experimental result codes 5001 to 5005\n12.6.0\nCP-140771\n0397\n3\nRestricted RAT Types\nCP-140784\n0386\n1\nWLCP key for WLCP signalling protection\nCP-140784\n0387\n1\nTWAN authentication and authorization call flows for MCM and TSCM\nCP-140784\n0398\n1\nBack-off timer refers to Tw1\nCP-140790\n0389\n3\nDiameter Overload over SWm and SWa\nCP-140754\n0394\n2\nLeading Digit of User-Name AVP\nCP-140757\n0396\n-\nIncorrect implementation of CR on EAP-Payload\n2015-03\nCT#67\nCP-150021\n0401\n1\nUsage of decorated NAI\n12.7.0\nCP-150021\n0404\n1\nClarification of user de-registration\n2015-06\nCT#68\nCP-150276\n0416\n1\nCorrection of the type of the Redirect-Host AVP\n12.8.0\nCP-150250\n0407\n-\nRepeated SWm session for default APN\n2015-06\nImplemented Rel-13 CRs removed (0410r1, 0417r1, 0418r1, 0405r1)\n12.8.1\n2015-06\nCT#68\nCP-150268\n0410\n1\nThe value of SM-Back-Off-Timer\n13.0.0\nCP-150268\n0417\n1\nClarification on the S6b Service Authorization Information Update procedure for DSMIPv6\nCP-150268\n0418\n1\nRemoving EPC before Root NAI\nCP-150268\n0405\n1\nPDN GW Identity\n2015-09\nCT#68\nCP-150455\n0422\n1\nIMEI(SV) signalling for untrusted WLAN access\n13.1.0\nCP-150455\n0423\n2\nIMEI(SV) signalling for trusted WLAN access\nCP-150455\n0424\n1\nIMEI(SV) signalling during Non-3GPP IP Access Registration\nCP-150442\n0425\n1\n3GPP AAA Server sends an ASR command to clean up possible hanging resources\nCP-150442\n0426\n3\nOverlapping transaction over S6b\nCP-150451\n0427\n1\nDefault access type for SCM\nCP-150447\n0428\n-\nReference to a wrong clause in TS 23.008\n2015-12\nCT#70\nCP-150770\n0429\n5\nEmergency PDN connection over untrusted WLAN access\n13.2.0\nCP-150770\n0430\n3\nNetwork provided WLAN Location Information for PDN connection establishment over S2b\nCP-150764\n0431\n1\nUE local IP address in Authentication and Authorization Request over SWm\nCP-150780\n0433\n3\nP-CSCF Restoration for WLAN over SWx\nCP-150780\n0434\n5\nAuthorisation procedure with the extended P-CSCF restoration mechanism for WLAN\nCP-150787\n0435\n-\nTransfer of IMEI from 3GPP AAA Server to HSS over SWx\nCP-150773\n0436\n3\nMultiple accesses to a PDN connection not allowed for SCM\nCP-150748\n0438\n-\nVisited-Network-Identifier for untrusted WLAN\nCP-150748\n0443\n2\nBlocking TWAN access to EPC\nCP-150782\n0439\n1\nHandling of S6b Authorization Request without Origination Timestamp\nCP-150846\n0440\n4\nDiameter message priority over non 3GPP access\nCP-150759\n0444\n1\nReference to DOIC updated  with  IETF RFC 7683\n2016-03\nCT#71\nCP-160035\n0446\n-\nRemove the default access AVP\n13.3.0\nCP-160042\n0447\n-\nExtension on TWAN-S2a-Failure-Cause\nCP-160042\n0448\n1\nAuthorize the UE requested APN\nCP-160037\n0449\n-\nCorrection of CR implementation on Emergency PDN connection over untrusted WLAN access\nCP-160037\n0450\n1\nePDG retrieval of WLAN Location Information\nCP-160153\n0452\n2\nResult-Codes for P-CSCF Restoration\n2016-06\nCT#72\nCP-160220\n0453\n1\nRAT type not allowed\n13.4.0\n2016-06\nCT#72\nCP-160220\n0454\n1\nWildcard APN for SWx and S6b\n13.4.0\n2016-06\nCT#72\nCP-160220\n0455\n2\nClarification on the use of SAR message when AAA has no profile\n13.4.0\n2016-06\nCT#72\nCP-160220\n0456\n1\nWildcard authorized APN in TWAN\n13.4.0\n2016-06\nCT#72\nCP-160220\n0457\n2\nAPN information over S6b\n13.4.0\n2016-06\nCT#72\nCP-160231\n0458\n-\nRemoval of NBIFOM reference\n13.4.0\n2016-06\nCT#72\nCP-160223\n0459\n2\nIncorrect usage of term \"Untrusted WLAN\" when RAT type is not known\n13.4.0\n2016-09\nCT#73\nCP-160418\n0463\n-\nAPN subscription check in the STa authentication and authorization procedure\n13.5.0\n2016-09\nCT#73\nCP-160418\n0465\n1\nTransferring AAA identifier from the ePDG/TWAN to the PGW\n13.5.0\n2016-09\nCT#73\nCP-160436\n0461\n1\n3GPP AAA Server/Proxy – EIR reference point\n14.0.0\n2016-09\nCT#73\nCP-160436\n0462\n2\nSTa and SWm extensions for IMEI check\n14.0.0\n2016-12\nCT#74\nCP-160674\n0466\n2\nDestination-Host correction on STa & SWm\n14.1.0\n2016-12\nCT#74\nCP-160674\n3GPP AAA Server behaviour in the user profile updated procedure\n14.1.0\n2016-12\nCT#74\nCP-160674\n0489\n1\nHandling of Undefined bit in DER-Flags\n14.1.0\n2016-12\nCT#74\nCP-160679\n0468\n4\nHandover of Emergency PDN Connections\n14.1.0\n2016-12\nCT#74\nCP-160679\n0471\n1\nIMEI check for Emergency Attach over WLAN\n14.1.0\n2016-12\nCT#74\nCP-160679\n0473\n1\nEmergency services over untrusted WLAN for unauthenticated or unauthorized UEs\n14.1.0\n2016-12\nCT#74\nCP-160679\n0474\n2\nSupport of Emergency sessions over Trusted WLAN\n14.1.0\n2016-12\nCT#74\nCP-160682\n0469\n1\nMissing IMEI-Check-In-VPLMN-Result AVP\n14.1.0\n2016-12\nCT#74\nCP-160682\n0477\n1\nIMEI check call flow for untrusted WLAN\n14.1.0\n2016-12\nCT#74\nCP-160657\n0476\n1\nAPN-Configuration AVP format for Non-3GPP accesses\n14.1.0\n2016-12\nCT#74\nCP-160681\n0484\n2\nLoad Control\n14.1.0\n2016-12\nCT#74\nCP-160653\n0486\n-\nRenaming of Emergency-Indication AVP\n14.1.0\n2016-12\nCT#74\nCP-160664\n0491\n-\nCorrection to change IETF drmp draft version to official RFC 7944\n14.1.0\n2016-12\nCT#74\nCP-160651\n0492\n-\nDiscontinuation of the I-WLAN feature\n14.1.0\n2017-03\nCT#75\nCP-170050\n0493\n1\nDIAMETER_ERROR_ILLEGAL_EQUIPMENT code\n14.2.0\n2017-03\nCT#75\nCP-170044\n0494\n1\nEmergency-Info AVP in Non-3GPP IP Access Registration response\n14.2.0\n2017-03\nCT#75\nCP-170049\n0495\n1\nAddition of ERP support for TWAN Interworking\n14.2.0\n2017-03\nCT#75\nCP-170037\n0496\n1\nBit ordering in Diameter AVPs used as bit-masks\n14.2.0\n2017-03\nCT#75\nCP-170037\n0497\n1\nHandling of AAA Failure Indication over SWa\n14.2.0\n2017-03\nCT#75\nCP-170037\n0498\n1\nSWm Behaviour after Failed Re-Authorization\n14.2.0\n2017-03\nCT#75\nCP-170048\n0499\n1\nUpdate of reference for the Diameter base protocol\n14.2.0\n2017-03\nCT#75\nCP-170048\n0500\n1\nHandling of the Vendor-Specific-Application-Id\n14.2.0\n2017-06\nCT#76\nCP-171033\n0466\n1\nNAI for emergency services over WLAN access to EPC\n14.3.0\n2017-06\nCT#76\nCP-171018\n0503\n1\nSupport for signaling transport level packet marking\n14.3.0\n2017-06\nCT#76\nCP-171035\n0505\n1\nOnly ERP Implicit Bootstrapping mode is supported in Rel-14\n14.3.0\n2017-06\nCT#76\nCP-171042\n0507\n-\nDefinition of Origination-Time-Stamp AVP\n14.3.0\n2017-09\nCT#77\nCP-172019\n0509\n1\nEmergency sessions over untrusted WLAN with an unauthenticated IMSI\n14.4.0\n2017-09\nCT#77\nCP-172015\n0511\n-\nPGW selection for WLAN with deployed DCNs\n14.4.0\n2017-09\nCT#77\nCP-172013\n0514\n-\nCorrection of DRMP Procedures\n14.4.0\n2017-09\nCT#77\nCP-172023\n0508\n-\nMIP6-Feature-Vector over SWx\n15.0.0\n2017-09\nCT#77\nCP-172023\n0512\n3\nExternal-ID in non-3GPP subscription profile\n15.0.0\n2017-12\nCT#78\nCP-173026\n0515\n-\nAuthorization procedure initiated by ePDG\n15.1.0\n2018-06\nCT#80\nCP-181123\n0518\n-\nFull-Network-Name and Short-Network-Name AVPs\n15.2.0\n2019-03\nCT#83\nCP-190032\n0519\n1\nMobility between EPC/ePDG and 5GS\n15.3.0\n2019-09\nCT#85\nCP-192094\n0521\n2\ndraft-ietf-dime-load published as RFC 8583\n15.4.0\n2020-03\nCT#87e\nCP-200047\n0522\n-\nAPN-OI-Replacement not applicable for Emergency services\n16.0.0\n2020-06\nCT#88e\nCP-201053\n0523\n-\nAPN-OI-Replacement\n16.1.0\n2020-09\nCT#89e\nCP-202043\n0525\n1\nAAA Deregistration\n16.2.0\n2021-03\nCT#91e\nCP-210027\n0526\n1\nUse of Inclusive Language\n17.0.0\n2021-09\nCT#93e\nCP-212053\n0528\n1\nD\nEditorial correction on WLAN Location Information AVP name\n17.1.0\n2022-03\nCT#95e\nCP-220040\n0529\n1\nF\n29.273 Addition of MPS statement to Annex B\n17.2.0\n2022-03\nCT#95e\nCP-220053\n0530\n-\nB\nNon-Seamless WLAN offload in 5GS\n17.2.0\n2022-06\nCT#96\nCP-221030\n0531\n1\nF\nNSWO in 5GS\n17.3.0\n2022-09\nCT#97e\nCP-222034\n0533\n-\nF\nCorrections for NSWO in 5GS\n17.4.0\n2022-09\nCT#97e\nCP-222022\n0532\n-\nF\nTrust Relationship Indicator over SWx\n18.0.0\n2022-12\nCT#98e\nCP-223048\n0536\n-\nA\nCorrecting a label in SUCI in NAI format\n18.1.0\n2022-12\nCT#98e\nCP-223038\n0534\n-\nF\nExperimental Result Codes for trusted / untrusted non-3GPP access not allowed\n18.1.0\n2023-03\nCT#99\nCP-230079\n0539\n1\nA\nStage 2 alignments for Non-seamless WLAN offload in 5GS\n18.2.0\n2023-09\nCT#101\nCP-232033\n0545\n-\nF\nUpdate on AAA Command for Core-Network Restriction\n18.3.0\n2023-09\nCT#101\nCP-232055\n0540\n1\nB\nMPS for WLAN EPC trusted attach\n18.3.0\n2023-09\nCT#101\nCP-232055\n0541\n1\nB\nMPS for WLAN EPC untrusted attach\n18.3.0\n2024-03\nCT#103\nCP-240053\n0551\n3\nF\nCorrections on the Core-Network Restriction\n18.4.0\n2024-03\nCT#103\nCP-240050\n0546\n2\nF\nMPS for WLAN miscellaneous corrections\n18.4.0\n2024-03\nCT#103\nCP-240050\n0547\n-\nF\nMPS for WLAN reAuth updates\n18.4.0\n2024-12\nCT#106\nCP-243022\n0553\n1\nF\nSupport of Trace Reporting Consumer URI\n18.5.0\n2025-03\nCT#107\nCP-250029\n0554\n-\nF\nHigh-Priority-Access-Info AVP code\n18.6.0",
      "chunk_type": "requirement",
      "cross_references": [
        "ts_29.272_clause_7.1.4",
        "ts_33.402_clause_8.2.2",
        "clause_9",
        "ts_29.272",
        "ts_33.402",
        "ts_24.302",
        "ts_23.402",
        "ts_29.273",
        "ts_29.212",
        "ts_23.234",
        "ts_29.234",
        "ts_23.008"
      ]
    }
  ]
}